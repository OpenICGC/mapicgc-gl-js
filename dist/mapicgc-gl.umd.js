(function(Sh,gm){typeof exports=="object"&&typeof module<"u"?gm(exports):typeof define=="function"&&define.amd?define(["exports"],gm):(Sh=typeof globalThis<"u"?globalThis:Sh||self,gm(Sh.mapicgcgl={}))})(this,function(Sh){"use strict";function gm(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const o=Object.getOwnPropertyDescriptor(r,n);o&&Object.defineProperty(i,n,o.get?o:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var Kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function e_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var GT={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(Kd,function(){var t={},r={};function n(c,s,m){if(r[c]=m,c==="index"){var x="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",I={};return r.shared(I),r.index(t,I),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),t}}n("shared",["exports"],function(c){function s(p,u,g,C){return new(g||(g=Promise))(function(P,Q){function V(he){try{te(C.next(he))}catch(h){Q(h)}}function K(he){try{te(C.throw(he))}catch(h){Q(h)}}function te(he){var h;he.done?P(he.value):(h=he.value,h instanceof g?h:new g(function(l){l(h)})).then(V,K)}te((C=C.apply(p,u||[])).next())})}function m(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}typeof SuppressedError=="function"&&SuppressedError;var x=I;function I(p,u){this.x=p,this.y=u}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,u){return this.clone()._rotateAround(p,u)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var u=p.x-this.x,g=p.y-this.y;return u*u+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,u){return Math.atan2(this.x*u-this.y*p,this.x*p+this.y*u)},_matMult:function(p){var u=p[2]*this.x+p[3]*this.y;return this.x=p[0]*this.x+p[1]*this.y,this.y=u,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var u=Math.cos(p),g=Math.sin(p),C=g*this.x+u*this.y;return this.x=u*this.x-g*this.y,this.y=C,this},_rotateAround:function(p,u){var g=Math.cos(p),C=Math.sin(p),P=u.y+C*(this.x-u.x)+g*(this.y-u.y);return this.x=u.x+g*(this.x-u.x)-C*(this.y-u.y),this.y=P,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(p){return p instanceof I?p:Array.isArray(p)?new I(p[0],p[1]):p};var F=m(x),O=z;function z(p,u,g,C){this.cx=3*p,this.bx=3*(g-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=g,this.p2y=C}z.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var g=p,C=0;C<8;C++){var P=this.sampleCurveX(g)-p;if(Math.abs(P)<u)return g;var Q=this.sampleCurveDerivativeX(g);if(Math.abs(Q)<1e-6)break;g-=P/Q}var V=0,K=1;for(g=p,C=0;C<20&&(P=this.sampleCurveX(g),!(Math.abs(P-p)<u));C++)p>P?V=g:K=g,g=.5*(K-V)+V;return g},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var ie=m(O);let ne,ue;function ce(){return ne==null&&(ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ne}function de(){if(ue==null&&(ue=!1,ce())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let C=0;C<5*5;C++){const P=4*C;u.fillStyle=`rgb(${P},${P+1},${P+2})`,u.fillRect(C%5,Math.floor(C/5),1,1)}const g=u.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&g[C]!==C){ue=!0;break}}}return ue||!1}function be(p,u,g,C){const P=new ie(p,u,g,C);return function(Q){return P.solve(Q)}}const Te=be(.25,.1,.25,1);function je(p,u,g){return Math.min(g,Math.max(u,p))}function Ge(p,u,g){const C=g-u,P=((p-u)%C+C)%C+u;return P===u?g:P}function $e(p){for(var u=arguments.length,g=new Array(u>1?u-1:0),C=1;C<u;C++)g[C-1]=arguments[C];for(const P of g)for(const Q in P)p[Q]=P[Q];return p}let Ue=1;function lt(p,u,g){const C={};for(const P in p)C[P]=u.call(g||this,p[P],P,p);return C}function nt(p,u,g){const C={};for(const P in p)u.call(g||this,p[P],P,p)&&(C[P]=p[P]);return C}function De(p){return Array.isArray(p)?p.map(De):typeof p=="object"&&p?lt(p,De):p}const Fe={};function Je(p){Fe[p]||(typeof console<"u"&&console.warn(p),Fe[p]=!0)}function We(p,u,g){return(g.y-p.y)*(u.x-p.x)>(u.y-p.y)*(g.x-p.x)}function Et(p){let u=0;for(let g,C,P=0,Q=p.length,V=Q-1;P<Q;V=P++)g=p[P],C=p[V],u+=(C.x-g.x)*(g.y+C.y);return u}function Ct(p){return typeof WorkerGlobalScope<"u"&&p!==void 0&&p instanceof WorkerGlobalScope}let Lt=null;function _t(p){return typeof ImageBitmap<"u"&&p instanceof ImageBitmap}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Mt(p,u,g,C,P){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const Q=new VideoFrame(p,{timestamp:0});try{const V=Q==null?void 0:Q.format;if(!V||!V.startsWith("BGR")&&!V.startsWith("RGB"))throw new Error(`Unrecognized format ${V}`);const K=V.startsWith("BGR"),te=new Uint8ClampedArray(C*P*4);if(yield Q.copyTo(te,function(he,h,l,f,v){const E=4*Math.max(-h,0),M=(Math.max(0,l)-l)*f*4+E,D=4*f,G=Math.max(0,h),$=Math.max(0,l);return{rect:{x:G,y:$,width:Math.min(he.width,h+f)-G,height:Math.min(he.height,l+v)-$},layout:[{offset:M,stride:D}]}}(p,u,g,C,P)),K)for(let he=0;he<te.length;he+=4){const h=te[he];te[he]=te[he+2],te[he+2]=h}return te}finally{Q.close()}})}let Wt,Ee;const Xe="AbortError";function et(){return new Error(Xe)}const At={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ft(p){return At.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))]}const wt="global-dispatcher";class Pt extends Error{constructor(u,g,C,P){super(`AJAXError: ${g} (${u}): ${C}`),this.status=u,this.statusText=g,this.url=C,this.body=P}}const It=()=>Ct(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ht=function(p,u){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){const C=ft(p.url);if(C)return C(p,u);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,targetMapId:wt},u)}if(!(/^file:/.test(g=p.url)||/^file:/.test(It())&&!/^\w+:/.test(g))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,P){return s(this,void 0,void 0,function*(){const Q=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:It(),signal:P.signal});C.type==="json"&&Q.headers.set("Accept","application/json");const V=yield fetch(Q);if(!V.ok){const he=yield V.blob();throw new Pt(V.status,V.statusText,C.url,he)}const K=C.type==="arrayBuffer"||C.type==="image"?V.arrayBuffer():C.type==="json"?V.json():V.text(),te=yield K;if(P.signal.aborted)throw et();return{data:te,cacheControl:V.headers.get("Cache-Control"),expires:V.headers.get("Expires")}})}(p,u);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,mustQueue:!0,targetMapId:wt},u)}var g;return function(C,P){return new Promise((Q,V)=>{const K=new XMLHttpRequest;K.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(K.responseType="arraybuffer");for(const te in C.headers)K.setRequestHeader(te,C.headers[te]);C.type==="json"&&(K.responseType="text",K.setRequestHeader("Accept","application/json")),K.withCredentials=C.credentials==="include",K.onerror=()=>{V(new Error(K.statusText))},K.onload=()=>{if(!P.signal.aborted)if((K.status>=200&&K.status<300||K.status===0)&&K.response!==null){let te=K.response;if(C.type==="json")try{te=JSON.parse(K.response)}catch(he){return void V(he)}Q({data:te,cacheControl:K.getResponseHeader("Cache-Control"),expires:K.getResponseHeader("Expires")})}else{const te=new Blob([K.response],{type:K.getResponseHeader("Content-Type")});V(new Pt(K.status,K.statusText,C.url,te))}},P.signal.addEventListener("abort",()=>{K.abort(),V(et())}),K.send(C.body)})}(p,u)};function ii(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;const u=new URL(p),g=window.location;return u.protocol===g.protocol&&u.host===g.host}function gi(p,u,g){g[p]&&g[p].indexOf(u)!==-1||(g[p]=g[p]||[],g[p].push(u))}function mi(p,u,g){if(g&&g[p]){const C=g[p].indexOf(u);C!==-1&&g[p].splice(C,1)}}class Mi{constructor(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$e(this,g),this.type=u}}class kt extends Mi{constructor(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",$e({error:u},g))}}class ot{on(u,g){return this._listeners=this._listeners||{},gi(u,g,this._listeners),this}off(u,g){return mi(u,g,this._listeners),mi(u,g,this._oneTimeListeners),this}once(u,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},gi(u,g,this._oneTimeListeners),this):new Promise(C=>this.once(u,C))}fire(u,g){typeof u=="string"&&(u=new Mi(u,g||{}));const C=u.type;if(this.listens(C)){u.target=this;const P=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const K of P)K.call(this,u);const Q=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const K of Q)mi(C,K,this._oneTimeListeners),K.call(this,u);const V=this._eventedParent;V&&($e(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(u))}else u instanceof kt&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,g){return this._eventedParent=u,this._eventedParentData=g,this}}var xt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ri=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ei(p,u){const g={};for(const C in p)C!=="ref"&&(g[C]=p[C]);return Ri.forEach(C=>{C in u&&(g[C]=u[C])}),g}function ut(p,u){if(Array.isArray(p)){if(!Array.isArray(u)||p.length!==u.length)return!1;for(let g=0;g<p.length;g++)if(!ut(p[g],u[g]))return!1;return!0}if(typeof p=="object"&&p!==null&&u!==null){if(typeof u!="object"||Object.keys(p).length!==Object.keys(u).length)return!1;for(const g in p)if(!ut(p[g],u[g]))return!1;return!0}return p===u}function jt(p,u){p.push(u)}function ni(p,u,g){jt(g,{command:"addSource",args:[p,u[p]]})}function di(p,u,g){jt(u,{command:"removeSource",args:[p]}),g[p]=!0}function li(p,u,g,C){di(p,g,C),ni(p,u,g)}function Ki(p,u,g){let C;for(C in p[g])if(Object.prototype.hasOwnProperty.call(p[g],C)&&C!=="data"&&!ut(p[g][C],u[g][C]))return!1;for(C in u[g])if(Object.prototype.hasOwnProperty.call(u[g],C)&&C!=="data"&&!ut(p[g][C],u[g][C]))return!1;return!0}function tr(p,u,g,C,P,Q){p=p||{},u=u||{};for(const V in p)Object.prototype.hasOwnProperty.call(p,V)&&(ut(p[V],u[V])||g.push({command:Q,args:[C,V,u[V],P]}));for(const V in u)Object.prototype.hasOwnProperty.call(u,V)&&!Object.prototype.hasOwnProperty.call(p,V)&&(ut(p[V],u[V])||g.push({command:Q,args:[C,V,u[V],P]}))}function Ar(p){return p.id}function Er(p,u){return p[u.id]=u,p}class Nt{constructor(u,g,C,P){this.message=(u?`${u}: `:"")+C,P&&(this.identifier=P),g!=null&&g.__line__&&(this.line=g.__line__)}}function Ji(p){for(var u=arguments.length,g=new Array(u>1?u-1:0),C=1;C<u;C++)g[C-1]=arguments[C];for(const P of g)for(const Q in P)p[Q]=P[Q];return p}class ci extends Error{constructor(u,g){super(g),this.message=g,this.key=u}}class $t{constructor(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[C,P]of g)this.bindings[C]=P}concat(u){return new $t(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const Zi={kind:"null"},Qt={kind:"number"},Bi={kind:"string"},Ii={kind:"boolean"},Gt={kind:"color"},vi={kind:"object"},Jt={kind:"value"},mr={kind:"collator"},Sr={kind:"formatted"},ze={kind:"padding"},we={kind:"resolvedImage"},oe={kind:"variableAnchorOffsetCollection"};function Y(p,u){return{kind:"array",itemType:p,N:u}}function le(p){if(p.kind==="array"){const u=le(p.itemType);return typeof p.N=="number"?`array<${u}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${u}>`}return p.kind}const ge=[Zi,Qt,Bi,Ii,Gt,Sr,vi,Y(Jt),ze,we,oe];function _e(p,u){if(u.kind==="error")return null;if(p.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!_e(p.itemType,u.itemType))&&(typeof p.N!="number"||p.N===u.N))return null}else{if(p.kind===u.kind)return null;if(p.kind==="value"){for(const g of ge)if(!_e(g,u))return null}}return`Expected ${le(p)} but found ${le(u)} instead.`}function Ce(p,u){return u.some(g=>g.kind===p.kind)}function ve(p,u){return u.some(g=>g==="null"?p===null:g==="array"?Array.isArray(p):g==="object"?p&&!Array.isArray(p)&&typeof p=="object":g===typeof p)}function Me(p,u){return p.kind==="array"&&u.kind==="array"?p.itemType.kind===u.itemType.kind&&typeof p.N=="number":p.kind===u.kind}const Oe=.96422,Ve=.82521,it=4/29,yt=6/29,Bt=3*yt*yt,Yt=yt*yt*yt,qt=Math.PI/180,Kt=180/Math.PI;function si(p){return(p%=360)<0&&(p+=360),p}function Ci(p){let[u,g,C,P]=p,Q,V;const K=wi((.2225045*(u=Hi(u))+.7168786*(g=Hi(g))+.0606169*(C=Hi(C)))/1);u===g&&g===C?Q=V=K:(Q=wi((.4360747*u+.3850649*g+.1430804*C)/Oe),V=wi((.0139322*u+.0971045*g+.7141733*C)/Ve));const te=116*K-16;return[te<0?0:te,500*(Q-K),200*(K-V),P]}function Hi(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function wi(p){return p>Yt?Math.pow(p,1/3):p/Bt+it}function Ui(p){let[u,g,C,P]=p,Q=(u+16)/116,V=isNaN(g)?Q:Q+g/500,K=isNaN(C)?Q:Q-C/200;return Q=1*ti(Q),V=Oe*ti(V),K=Ve*ti(K),[st(3.1338561*V-1.6168667*Q-.4906146*K),st(-.9787684*V+1.9161415*Q+.033454*K),st(.0719453*V-.2289914*Q+1.4052427*K),P]}function st(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function ti(p){return p>yt?p*p*p:Bt*(p-it)}function zt(p){return parseInt(p.padEnd(2,p),16)/255}function zi(p,u){return hr(u?p/100:p,0,1)}function hr(p,u,g){return Math.min(Math.max(u,p),g)}function sn(p){return!p.some(Number.isNaN)}const bn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ur{constructor(u,g,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=g,this.b=C,this.a=P,Q||(this.r*=P,this.g*=P,this.b*=P,P||this.overwriteGetter("rgb",[u,g,C,P]))}static parse(u){if(u instanceof ur)return u;if(typeof u!="string")return;const g=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const P=bn[C];if(P){const[V,K,te]=P;return[V/255,K/255,te/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const V=C.length<6?1:2;let K=1;return[zt(C.slice(K,K+=V)),zt(C.slice(K,K+=V)),zt(C.slice(K,K+=V)),zt(C.slice(K,K+V)||"ff")]}if(C.startsWith("rgb")){const V=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[K,te,he,h,l,f,v,E,M,D,G,$]=V,X=[h||" ",v||" ",D].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const se=[he,f,M].join(""),Ae=se==="%%%"?100:se===""?255:0;if(Ae){const me=[hr(+te/Ae,0,1),hr(+l/Ae,0,1),hr(+E/Ae,0,1),G?zi(+G,$):1];if(sn(me))return me}}return}}const Q=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Q){const[V,K,te,he,h,l,f,v,E]=Q,M=[te||" ",h||" ",f].join("");if(M==="  "||M==="  /"||M===",,"||M===",,,"){const D=[+K,hr(+he,0,100),hr(+l,0,100),v?zi(+v,E):1];if(sn(D))return function(G){let[$,X,se,Ae]=G;function me(Be){const Se=(Be+$/30)%12,ke=X*Math.min(se,1-se);return se-ke*Math.max(-1,Math.min(Se-3,9-Se,1))}return $=si($),X/=100,se/=100,[me(0),me(8),me(4),Ae]}(D)}}}(u);return g?new ur(...g,!1):void 0}get rgb(){const{r:u,g,b:C,a:P}=this,Q=P||1/0;return this.overwriteGetter("rgb",[u/Q,g/Q,C/Q,P])}get hcl(){return this.overwriteGetter("hcl",function(u){const[g,C,P,Q]=Ci(u),V=Math.sqrt(C*C+P*P);return[Math.round(1e4*V)?si(Math.atan2(P,C)*Kt):NaN,V,g,Q]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ci(this.rgb))}overwriteGetter(u,g){return Object.defineProperty(this,u,{value:g}),g}toString(){const[u,g,C,P]=this.rgb;return`rgba(${[u,g,C].map(Q=>Math.round(255*Q)).join(",")},${P})`}}ur.black=new ur(0,0,0,1),ur.white=new ur(1,1,1,1),ur.transparent=new ur(0,0,0,0),ur.red=new ur(1,0,0,1);class gn{constructor(u,g,C){this.sensitivity=u?g?"variant":"case":g?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,g){return this.collator.compare(u,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mn{constructor(u,g,C,P,Q){this.text=u,this.image=g,this.scale=C,this.fontStack=P,this.textColor=Q}}class lr{constructor(u){this.sections=u}static fromString(u){return new lr([new mn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof lr?u:lr.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class Rn{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Rn)return u;if(typeof u=="number")return new Rn([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const g of u)if(typeof g!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new Rn(u)}}toString(){return JSON.stringify(this.values)}}const ps=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qr{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Qr)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let g=0;g<u.length;g+=2){const C=u[g],P=u[g+1];if(typeof C!="string"||!ps.has(C)||!Array.isArray(P)||P.length!==2||typeof P[0]!="number"||typeof P[1]!="number")return}return new Qr(u)}}toString(){return JSON.stringify(this.values)}}class xn{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new xn({name:u,available:!1}):null}}function So(p,u,g,C){return typeof p=="number"&&p>=0&&p<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof g=="number"&&g>=0&&g<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[p,u,g,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[p,u,g,C]:[p,u,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cs(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof ur||p instanceof gn||p instanceof lr||p instanceof Rn||p instanceof Qr||p instanceof xn)return!0;if(Array.isArray(p)){for(const u of p)if(!cs(u))return!1;return!0}if(typeof p=="object"){for(const u in p)if(!cs(p[u]))return!1;return!0}return!1}function Wi(p){if(p===null)return Zi;if(typeof p=="string")return Bi;if(typeof p=="boolean")return Ii;if(typeof p=="number")return Qt;if(p instanceof ur)return Gt;if(p instanceof gn)return mr;if(p instanceof lr)return Sr;if(p instanceof Rn)return ze;if(p instanceof Qr)return oe;if(p instanceof xn)return we;if(Array.isArray(p)){const u=p.length;let g;for(const C of p){const P=Wi(C);if(g){if(g===P)continue;g=Jt;break}g=P}return Y(g||Jt,u)}return vi}function Js(p){const u=typeof p;return p===null?"":u==="string"||u==="number"||u==="boolean"?String(p):p instanceof ur||p instanceof lr||p instanceof Rn||p instanceof Qr||p instanceof xn?p.toString():JSON.stringify(p)}class ws{constructor(u,g){this.type=u,this.value=g}static parse(u,g){if(u.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!cs(u[1]))return g.error("invalid value");const C=u[1];let P=Wi(C);const Q=g.expectedType;return P.kind!=="array"||P.N!==0||!Q||Q.kind!=="array"||typeof Q.N=="number"&&Q.N!==0||(P=Q),new ws(P,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class dr{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const Fr={string:Bi,number:Qt,boolean:Ii,object:vi};class Vn{constructor(u,g){this.type=u,this.args=g}static parse(u,g){if(u.length<2)return g.error("Expected at least one argument.");let C,P=1;const Q=u[0];if(Q==="array"){let K,te;if(u.length>2){const he=u[1];if(typeof he!="string"||!(he in Fr)||he==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);K=Fr[he],P++}else K=Jt;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return g.error('The length argument to "array" must be a positive integer literal',2);te=u[2],P++}C=Y(K,te)}else{if(!Fr[Q])throw new Error(`Types doesn't contain name = ${Q}`);C=Fr[Q]}const V=[];for(;P<u.length;P++){const K=g.parse(u[P],P,Jt);if(!K)return null;V.push(K)}return new Vn(C,V)}evaluate(u){for(let g=0;g<this.args.length;g++){const C=this.args[g].evaluate(u);if(!_e(this.type,Wi(C)))return C;if(g===this.args.length-1)throw new dr(`Expected value to be of type ${le(this.type)}, but found ${le(Wi(C))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Or={"to-boolean":Ii,"to-color":Gt,"to-number":Qt,"to-string":Bi};class Cn{constructor(u,g){this.type=u,this.args=g}static parse(u,g){if(u.length<2)return g.error("Expected at least one argument.");const C=u[0];if(!Or[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&u.length!==2)return g.error("Expected one argument.");const P=Or[C],Q=[];for(let V=1;V<u.length;V++){const K=g.parse(u[V],V,Jt);if(!K)return null;Q.push(K)}return new Cn(P,Q)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let g,C;for(const P of this.args){if(g=P.evaluate(u),C=null,g instanceof ur)return g;if(typeof g=="string"){const Q=u.parseColor(g);if(Q)return Q}else if(Array.isArray(g)&&(C=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:So(g[0],g[1],g[2],g[3]),!C))return new ur(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new dr(C||`Could not parse color from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"padding":{let g;for(const C of this.args){g=C.evaluate(u);const P=Rn.parse(g);if(P)return P}throw new dr(`Could not parse padding from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"variableAnchorOffsetCollection":{let g;for(const C of this.args){g=C.evaluate(u);const P=Qr.parse(g);if(P)return P}throw new dr(`Could not parse variableAnchorOffsetCollection from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"number":{let g=null;for(const C of this.args){if(g=C.evaluate(u),g===null)return 0;const P=Number(g);if(!isNaN(P))return P}throw new dr(`Could not convert ${JSON.stringify(g)} to number.`)}case"formatted":return lr.fromString(Js(this.args[0].evaluate(u)));case"resolvedImage":return xn.fromString(Js(this.args[0].evaluate(u)));default:return Js(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const An=["Unknown","Point","LineString","Polygon"];class Hr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?An[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let g=this._parseColorCache[u];return g||(g=this._parseColorCache[u]=ur.parse(u)),g}}class Hs{constructor(u,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],P=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new $t,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=C,this.key=C.map(K=>`[${K}]`).join(""),this.scope=Q,this.errors=V,this.expectedType=P,this._isConstant=g}parse(u,g,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return g?this.concat(g,C,P)._parse(u,Q):this._parse(u,Q)}_parse(u,g){function C(P,Q,V){return V==="assert"?new Vn(Q,[P]):V==="coerce"?new Cn(Q,[P]):P}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const P=u[0];if(typeof P!="string")return this.error(`Expression name must be a string, but found ${typeof P} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[P];if(Q){let V=Q.parse(u,this);if(!V)return null;if(this.expectedType){const K=this.expectedType,te=V.type;if(K.kind!=="string"&&K.kind!=="number"&&K.kind!=="boolean"&&K.kind!=="object"&&K.kind!=="array"||te.kind!=="value")if(K.kind!=="color"&&K.kind!=="formatted"&&K.kind!=="resolvedImage"||te.kind!=="value"&&te.kind!=="string")if(K.kind!=="padding"||te.kind!=="value"&&te.kind!=="number"&&te.kind!=="array")if(K.kind!=="variableAnchorOffsetCollection"||te.kind!=="value"&&te.kind!=="array"){if(this.checkSubtype(K,te))return null}else V=C(V,K,g.typeAnnotation||"coerce");else V=C(V,K,g.typeAnnotation||"coerce");else V=C(V,K,g.typeAnnotation||"coerce");else V=C(V,K,g.typeAnnotation||"assert")}if(!(V instanceof ws)&&V.type.kind!=="resolvedImage"&&this._isConstant(V)){const K=new Hr;try{V=new ws(V.type,V.evaluate(K))}catch(te){return this.error(te.message),null}}return V}return this.error(`Unknown expression "${P}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,g,C){const P=typeof u=="number"?this.path.concat(u):this.path,Q=C?this.scope.concat(C):this.scope;return new Hs(this.registry,this._isConstant,P,g||null,Q,this.errors)}error(u){for(var g=arguments.length,C=new Array(g>1?g-1:0),P=1;P<g;P++)C[P-1]=arguments[P];const Q=`${this.key}${C.map(V=>`[${V}]`).join("")}`;this.errors.push(new ci(Q,u))}checkSubtype(u,g){const C=_e(u,g);return C&&this.error(C),C}}class ca{constructor(u,g,C){this.type=mr,this.locale=C,this.caseSensitive=u,this.diacriticSensitive=g}static parse(u,g){if(u.length!==2)return g.error("Expected one argument.");const C=u[1];if(typeof C!="object"||Array.isArray(C))return g.error("Collator options argument must be an object.");const P=g.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Ii);if(!P)return null;const Q=g.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Ii);if(!Q)return null;let V=null;return C.locale&&(V=g.parse(C.locale,1,Bi),!V)?null:new ca(P,Q,V)}evaluate(u){return new gn(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}const uo=8192;function Ea(p,u){p[0]=Math.min(p[0],u[0]),p[1]=Math.min(p[1],u[1]),p[2]=Math.max(p[2],u[0]),p[3]=Math.max(p[3],u[1])}function Ne(p,u){return!(p[0]<=u[0]||p[2]>=u[2]||p[1]<=u[1]||p[3]>=u[3])}function Ze(p,u){const g=(180+p[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,P=Math.pow(2,u.z);return[Math.round(g*P*uo),Math.round(C*P*uo)]}function dt(p,u,g){const C=p[0]-u[0],P=p[1]-u[1],Q=p[0]-g[0],V=p[1]-g[1];return C*V-Q*P==0&&C*Q<=0&&P*V<=0}function Ot(p,u){let g=!1;for(let V=0,K=u.length;V<K;V++){const te=u[V];for(let he=0,h=te.length;he<h-1;he++){if(dt(p,te[he],te[he+1]))return!1;(P=te[he])[1]>(C=p)[1]!=(Q=te[he+1])[1]>C[1]&&C[0]<(Q[0]-P[0])*(C[1]-P[1])/(Q[1]-P[1])+P[0]&&(g=!g)}}var C,P,Q;return g}function ui(p,u){for(let g=0;g<u.length;g++)if(Ot(p,u[g]))return!0;return!1}function Gi(p,u,g,C){const P=C[0]-g[0],Q=C[1]-g[1],V=(p[0]-g[0])*Q-P*(p[1]-g[1]),K=(u[0]-g[0])*Q-P*(u[1]-g[1]);return V>0&&K<0||V<0&&K>0}function br(p,u,g){for(const he of g)for(let h=0;h<he.length-1;++h)if((K=[(V=he[h+1])[0]-(Q=he[h])[0],V[1]-Q[1]])[0]*(te=[(P=u)[0]-(C=p)[0],P[1]-C[1]])[1]-K[1]*te[0]!=0&&Gi(C,P,Q,V)&&Gi(Q,V,C,P))return!0;var C,P,Q,V,K,te;return!1}function En(p,u){for(let g=0;g<p.length;++g)if(!Ot(p[g],u))return!1;for(let g=0;g<p.length-1;++g)if(br(p[g],p[g+1],u))return!1;return!0}function kn(p,u){for(let g=0;g<u.length;g++)if(En(p,u[g]))return!0;return!1}function is(p,u,g){const C=[];for(let P=0;P<p.length;P++){const Q=[];for(let V=0;V<p[P].length;V++){const K=Ze(p[P][V],g);Ea(u,K),Q.push(K)}C.push(Q)}return C}function wn(p,u,g){const C=[];for(let P=0;P<p.length;P++){const Q=is(p[P],u,g);C.push(Q)}return C}function iu(p,u,g,C){if(p[0]<g[0]||p[0]>g[2]){const P=.5*C;let Q=p[0]-g[0]>P?-C:g[0]-p[0]>P?C:0;Q===0&&(Q=p[0]-g[2]>P?-C:g[2]-p[0]>P?C:0),p[0]+=Q}Ea(u,p)}function Va(p,u,g,C){const P=Math.pow(2,C.z)*uo,Q=[C.x*uo,C.y*uo],V=[];for(const K of p)for(const te of K){const he=[te.x+Q[0],te.y+Q[1]];iu(he,u,g,P),V.push(he)}return V}function Tr(p,u,g,C){const P=Math.pow(2,C.z)*uo,Q=[C.x*uo,C.y*uo],V=[];for(const te of p){const he=[];for(const h of te){const l=[h.x+Q[0],h.y+Q[1]];Ea(u,l),he.push(l)}V.push(he)}if(u[2]-u[0]<=P/2){(K=u)[0]=K[1]=1/0,K[2]=K[3]=-1/0;for(const te of V)for(const he of te)iu(he,u,g,P)}var K;return V}class Ha{constructor(u,g){this.type=Ii,this.geojson=u,this.geometries=g}static parse(u,g){if(u.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(cs(u[1])){const C=u[1];if(C.type==="FeatureCollection"){const P=[];for(const Q of C.features){const{type:V,coordinates:K}=Q.geometry;V==="Polygon"&&P.push(K),V==="MultiPolygon"&&P.push(...K)}if(P.length)return new Ha(C,{type:"MultiPolygon",coordinates:P})}else if(C.type==="Feature"){const P=C.geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new Ha(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Ha(C,C)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(g,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=g.canonicalID();if(C.type==="Polygon"){const K=is(C.coordinates,Q,V),te=Va(g.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of te)if(!Ot(he,K))return!1}if(C.type==="MultiPolygon"){const K=wn(C.coordinates,Q,V),te=Va(g.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of te)if(!ui(he,K))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(g,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=g.canonicalID();if(C.type==="Polygon"){const K=is(C.coordinates,Q,V),te=Tr(g.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of te)if(!En(he,K))return!1}if(C.type==="MultiPolygon"){const K=wn(C.coordinates,Q,V),te=Tr(g.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of te)if(!kn(he,K))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Dl{constructor(u,g){this.type=g.type,this.name=u,this.boundExpression=g}static parse(u,g){if(u.length!==2||typeof u[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const C=u[1];return g.scope.has(C)?new Dl(C,g.scope.get(C)):g.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class Jn{constructor(u,g,C,P){this.name=u,this.type=g,this._evaluate=C,this.args=P}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,g){const C=u[0],P=Jn.definitions[C];if(!P)return g.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(P)?P[0]:P.type,V=Array.isArray(P)?[[P[1],P[2]]]:P.overloads,K=V.filter(he=>{let[h]=he;return!Array.isArray(h)||h.length===u.length-1});let te=null;for(const[he,h]of K){te=new Hs(g.registry,To,g.path,null,g.scope);const l=[];let f=!1;for(let v=1;v<u.length;v++){const E=u[v],M=Array.isArray(he)?he[v-1]:he.type,D=te.parse(E,1+l.length,M);if(!D){f=!0;break}l.push(D)}if(!f)if(Array.isArray(he)&&he.length!==l.length)te.error(`Expected ${he.length} arguments, but found ${l.length} instead.`);else{for(let v=0;v<l.length;v++){const E=Array.isArray(he)?he[v]:he.type,M=l[v];te.concat(v+1).checkSubtype(E,M.type)}if(te.errors.length===0)return new Jn(C,Q,h,l)}}if(K.length===1)g.errors.push(...te.errors);else{const he=(K.length?K:V).map(l=>{let[f]=l;return v=f,Array.isArray(v)?`(${v.map(le).join(", ")})`:`(${le(v.type)}...)`;var v}).join(" | "),h=[];for(let l=1;l<u.length;l++){const f=g.parse(u[l],1+h.length);if(!f)return null;h.push(le(f.type))}g.error(`Expected arguments of type ${he}, but found (${h.join(", ")}) instead.`)}return null}static register(u,g){Jn.definitions=g;for(const C in g)u[C]=Jn}}function To(p){if(p instanceof Dl)return To(p.boundExpression);if(p instanceof Jn&&p.name==="error"||p instanceof ca||p instanceof Ha)return!1;const u=p instanceof Cn||p instanceof Vn;let g=!0;return p.eachChild(C=>{g=u?g&&To(C):g&&C instanceof ws}),!!g&&Ga(p)&&ua(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ga(p){if(p instanceof Jn&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof Ha)return!1;let u=!0;return p.eachChild(g=>{u&&!Ga(g)&&(u=!1)}),u}function gs(p){if(p instanceof Jn&&p.name==="feature-state")return!1;let u=!0;return p.eachChild(g=>{u&&!gs(g)&&(u=!1)}),u}function ua(p,u){if(p instanceof Jn&&u.indexOf(p.name)>=0)return!1;let g=!0;return p.eachChild(C=>{g&&!ua(C,u)&&(g=!1)}),g}function ja(p,u){const g=p.length-1;let C,P,Q=0,V=g,K=0;for(;Q<=V;)if(K=Math.floor((Q+V)/2),C=p[K],P=p[K+1],C<=u){if(K===g||u<P)return K;Q=K+1}else{if(!(C>u))throw new dr("Input is not a number.");V=K-1}return 0}class Sa{constructor(u,g,C){this.type=u,this.input=g,this.labels=[],this.outputs=[];for(const[P,Q]of C)this.labels.push(P),this.outputs.push(Q)}static parse(u,g){if(u.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return g.error("Expected an even number of arguments.");const C=g.parse(u[1],1,Qt);if(!C)return null;const P=[];let Q=null;g.expectedType&&g.expectedType.kind!=="value"&&(Q=g.expectedType);for(let V=1;V<u.length;V+=2){const K=V===1?-1/0:u[V],te=u[V+1],he=V,h=V+1;if(typeof K!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',he);if(P.length&&P[P.length-1][0]>=K)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',he);const l=g.parse(te,h,Q);if(!l)return null;Q=Q||l.type,P.push([K,l])}return new Sa(Q,C,P)}evaluate(u){const g=this.labels,C=this.outputs;if(g.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=g[0])return C[0].evaluate(u);const Q=g.length;return P>=g[Q-1]?C[Q-1].evaluate(u):C[ja(g,P)].evaluate(u)}eachChild(u){u(this.input);for(const g of this.outputs)u(g)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Ic(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var qa=ho;function ho(p,u,g,C){this.cx=3*p,this.bx=3*(g-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=g,this.p2y=C}ho.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var g=p,C=0;C<8;C++){var P=this.sampleCurveX(g)-p;if(Math.abs(P)<u)return g;var Q=this.sampleCurveDerivativeX(g);if(Math.abs(Q)<1e-6)break;g-=P/Q}var V=0,K=1;for(g=p,C=0;C<20&&(P=this.sampleCurveX(g),!(Math.abs(P-p)<u));C++)p>P?V=g:K=g,g=.5*(K-V)+V;return g},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var Pr=Ic(qa);function ha(p,u,g){return p+g*(u-p)}function us(p,u,g){return p.map((C,P)=>ha(C,u[P],g))}const dn={number:ha,color:function(p,u,g){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[P,Q,V,K]=us(p.rgb,u.rgb,g);return new ur(P,Q,V,K,!1)}case"hcl":{const[P,Q,V,K]=p.hcl,[te,he,h,l]=u.hcl;let f,v;if(isNaN(P)||isNaN(te))isNaN(P)?isNaN(te)?f=NaN:(f=te,V!==1&&V!==0||(v=he)):(f=P,h!==1&&h!==0||(v=Q));else{let $=te-P;te>P&&$>180?$-=360:te<P&&P-te>180&&($+=360),f=P+g*$}const[E,M,D,G]=function($){let[X,se,Ae,me]=$;return X=isNaN(X)?0:X*qt,Ui([Ae,Math.cos(X)*se,Math.sin(X)*se,me])}([f,v??ha(Q,he,g),ha(V,h,g),ha(K,l,g)]);return new ur(E,M,D,G,!1)}case"lab":{const[P,Q,V,K]=Ui(us(p.lab,u.lab,g));return new ur(P,Q,V,K,!1)}}},array:us,padding:function(p,u,g){return new Rn(us(p.values,u.values,g))},variableAnchorOffsetCollection:function(p,u,g){const C=p.values,P=u.values;if(C.length!==P.length)throw new dr(`Cannot interpolate values of different length. from: ${p.toString()}, to: ${u.toString()}`);const Q=[];for(let V=0;V<C.length;V+=2){if(C[V]!==P[V])throw new dr(`Cannot interpolate values containing mismatched anchors. from[${V}]: ${C[V]}, to[${V}]: ${P[V]}`);Q.push(C[V]);const[K,te]=C[V+1],[he,h]=P[V+1];Q.push([ha(K,he,g),ha(te,h,g)])}return new Qr(Q)}};class rs{constructor(u,g,C,P,Q){this.type=u,this.operator=g,this.interpolation=C,this.input=P,this.labels=[],this.outputs=[];for(const[V,K]of Q)this.labels.push(V),this.outputs.push(K)}static interpolationFactor(u,g,C,P){let Q=0;if(u.name==="exponential")Q=Vr(g,u.base,C,P);else if(u.name==="linear")Q=Vr(g,1,C,P);else if(u.name==="cubic-bezier"){const V=u.controlPoints;Q=new Pr(V[0],V[1],V[2],V[3]).solve(Vr(g,1,C,P))}return Q}static parse(u,g){let[C,P,Q,...V]=u;if(!Array.isArray(P)||P.length===0)return g.error("Expected an interpolation type expression.",1);if(P[0]==="linear")P={name:"linear"};else if(P[0]==="exponential"){const he=P[1];if(typeof he!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);P={name:"exponential",base:he}}else{if(P[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(P[0])}`,1,0);{const he=P.slice(1);if(he.length!==4||he.some(h=>typeof h!="number"||h<0||h>1))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);P={name:"cubic-bezier",controlPoints:he}}}if(u.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(Q=g.parse(Q,2,Qt),!Q)return null;const K=[];let te=null;C==="interpolate-hcl"||C==="interpolate-lab"?te=Gt:g.expectedType&&g.expectedType.kind!=="value"&&(te=g.expectedType);for(let he=0;he<V.length;he+=2){const h=V[he],l=V[he+1],f=he+3,v=he+4;if(typeof h!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(K.length&&K[K.length-1][0]>=h)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const E=g.parse(l,v,te);if(!E)return null;te=te||E.type,K.push([h,E])}return Me(te,Qt)||Me(te,Gt)||Me(te,ze)||Me(te,oe)||Me(te,Y(Qt))?new rs(te,C,P,Q,K):g.error(`Type ${le(te)} is not interpolatable.`)}evaluate(u){const g=this.labels,C=this.outputs;if(g.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=g[0])return C[0].evaluate(u);const Q=g.length;if(P>=g[Q-1])return C[Q-1].evaluate(u);const V=ja(g,P),K=rs.interpolationFactor(this.interpolation,P,g[V],g[V+1]),te=C[V].evaluate(u),he=C[V+1].evaluate(u);switch(this.operator){case"interpolate":return dn[this.type.kind](te,he,K);case"interpolate-hcl":return dn.color(te,he,K,"hcl");case"interpolate-lab":return dn.color(te,he,K,"lab")}}eachChild(u){u(this.input);for(const g of this.outputs)u(g)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Vr(p,u,g,C){const P=C-g,Q=p-g;return P===0?0:u===1?Q/P:(Math.pow(u,Q)-1)/(Math.pow(u,P)-1)}class $a{constructor(u,g){this.type=u,this.args=g}static parse(u,g){if(u.length<2)return g.error("Expectected at least one argument.");let C=null;const P=g.expectedType;P&&P.kind!=="value"&&(C=P);const Q=[];for(const K of u.slice(1)){const te=g.parse(K,1+Q.length,C,void 0,{typeAnnotation:"omit"});if(!te)return null;C=C||te.type,Q.push(te)}if(!C)throw new Error("No output type");const V=P&&Q.some(K=>_e(P,K.type));return new $a(V?Jt:C,Q)}evaluate(u){let g,C=null,P=0;for(const Q of this.args)if(P++,C=Q.evaluate(u),C&&C instanceof xn&&!C.available&&(g||(g=C.name),C=null,P===this.args.length&&(C=g)),C!==null)break;return C}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class nl{constructor(u,g){this.type=g.type,this.bindings=[].concat(u),this.result=g}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const g of this.bindings)u(g[1]);u(this.result)}static parse(u,g){if(u.length<4)return g.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const C=[];for(let Q=1;Q<u.length-1;Q+=2){const V=u[Q];if(typeof V!="string")return g.error(`Expected string, but found ${typeof V} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(V))return g.error("Variable names must contain only alphanumeric characters or '_'.",Q);const K=g.parse(u[Q+1],Q+1);if(!K)return null;C.push([V,K])}const P=g.parse(u[u.length-1],u.length-1,g.expectedType,C);return P?new nl(C,P):null}outputDefined(){return this.result.outputDefined()}}class Rl{constructor(u,g,C){this.type=u,this.index=g,this.input=C}static parse(u,g){if(u.length!==3)return g.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=g.parse(u[1],1,Qt),P=g.parse(u[2],2,Y(g.expectedType||Jt));return C&&P?new Rl(P.type.itemType,C,P):null}evaluate(u){const g=this.index.evaluate(u),C=this.input.evaluate(u);if(g<0)throw new dr(`Array index out of bounds: ${g} < 0.`);if(g>=C.length)throw new dr(`Array index out of bounds: ${g} > ${C.length-1}.`);if(g!==Math.floor(g))throw new dr(`Array index must be an integer, but found ${g} instead.`);return C[g]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Io{constructor(u,g){this.type=Ii,this.needle=u,this.haystack=g}static parse(u,g){if(u.length!==3)return g.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=g.parse(u[1],1,Jt),P=g.parse(u[2],2,Jt);return C&&P?Ce(C.type,[Ii,Bi,Qt,Zi,Jt])?new Io(C,P):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(C.type)} instead`):null}evaluate(u){const g=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!C)return!1;if(!ve(g,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${le(Wi(g))} instead.`);if(!ve(C,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${le(Wi(C))} instead.`);return C.indexOf(g)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class Ko{constructor(u,g,C){this.type=Qt,this.needle=u,this.haystack=g,this.fromIndex=C}static parse(u,g){if(u.length<=2||u.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=g.parse(u[1],1,Jt),P=g.parse(u[2],2,Jt);if(!C||!P)return null;if(!Ce(C.type,[Ii,Bi,Qt,Zi,Jt]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(C.type)} instead`);if(u.length===4){const Q=g.parse(u[3],3,Qt);return Q?new Ko(C,P,Q):null}return new Ko(C,P)}evaluate(u){const g=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!ve(g,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${le(Wi(g))} instead.`);if(!ve(C,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${le(Wi(C))} instead.`);if(this.fromIndex){const P=this.fromIndex.evaluate(u);return C.indexOf(g,P)}return C.indexOf(g)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class cc{constructor(u,g,C,P,Q,V){this.inputType=u,this.type=g,this.input=C,this.cases=P,this.outputs=Q,this.otherwise=V}static parse(u,g){if(u.length<5)return g.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return g.error("Expected an even number of arguments.");let C,P;g.expectedType&&g.expectedType.kind!=="value"&&(P=g.expectedType);const Q={},V=[];for(let he=2;he<u.length-1;he+=2){let h=u[he];const l=u[he+1];Array.isArray(h)||(h=[h]);const f=g.concat(he);if(h.length===0)return f.error("Expected at least one branch label.");for(const E of h){if(typeof E!="number"&&typeof E!="string")return f.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return f.error("Numeric branch labels must be integer values.");if(C){if(f.checkSubtype(C,Wi(E)))return null}else C=Wi(E);if(Q[String(E)]!==void 0)return f.error("Branch labels must be unique.");Q[String(E)]=V.length}const v=g.parse(l,he,P);if(!v)return null;P=P||v.type,V.push(v)}const K=g.parse(u[1],1,Jt);if(!K)return null;const te=g.parse(u[u.length-1],u.length-1,P);return te?K.type.kind!=="value"&&g.concat(1).checkSubtype(C,K.type)?null:new cc(C,P,K,Q,V,te):null}evaluate(u){const g=this.input.evaluate(u);return(Wi(g)===this.inputType&&this.outputs[this.cases[g]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Wo{constructor(u,g,C){this.type=u,this.branches=g,this.otherwise=C}static parse(u,g){if(u.length<4)return g.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return g.error("Expected an odd number of arguments.");let C;g.expectedType&&g.expectedType.kind!=="value"&&(C=g.expectedType);const P=[];for(let V=1;V<u.length-1;V+=2){const K=g.parse(u[V],V,Ii);if(!K)return null;const te=g.parse(u[V+1],V+1,C);if(!te)return null;P.push([K,te]),C=C||te.type}const Q=g.parse(u[u.length-1],u.length-1,C);if(!Q)return null;if(!C)throw new Error("Can't infer output type");return new Wo(C,P,Q)}evaluate(u){for(const[g,C]of this.branches)if(g.evaluate(u))return C.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[g,C]of this.branches)u(g),u(C);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[g,C]=u;return C.outputDefined()})&&this.otherwise.outputDefined()}}class Ao{constructor(u,g,C,P){this.type=u,this.input=g,this.beginIndex=C,this.endIndex=P}static parse(u,g){if(u.length<=2||u.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=g.parse(u[1],1,Jt),P=g.parse(u[2],2,Qt);if(!C||!P)return null;if(!Ce(C.type,[Y(Jt),Bi,Jt]))return g.error(`Expected first argument to be of type array or string, but found ${le(C.type)} instead`);if(u.length===4){const Q=g.parse(u[3],3,Qt);return Q?new Ao(C.type,C,P,Q):null}return new Ao(C.type,C,P)}evaluate(u){const g=this.input.evaluate(u),C=this.beginIndex.evaluate(u);if(!ve(g,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${le(Wi(g))} instead.`);if(this.endIndex){const P=this.endIndex.evaluate(u);return g.slice(C,P)}return g.slice(C)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function uc(p,u){return p==="=="||p==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Xo(p,u,g,C){return C.compare(u,g)===0}function kl(p,u,g){const C=p!=="=="&&p!=="!=";return class lN{constructor(Q,V,K){this.type=Ii,this.lhs=Q,this.rhs=V,this.collator=K,this.hasUntypedArgument=Q.type.kind==="value"||V.type.kind==="value"}static parse(Q,V){if(Q.length!==3&&Q.length!==4)return V.error("Expected two or three arguments.");const K=Q[0];let te=V.parse(Q[1],1,Jt);if(!te)return null;if(!uc(K,te.type))return V.concat(1).error(`"${K}" comparisons are not supported for type '${le(te.type)}'.`);let he=V.parse(Q[2],2,Jt);if(!he)return null;if(!uc(K,he.type))return V.concat(2).error(`"${K}" comparisons are not supported for type '${le(he.type)}'.`);if(te.type.kind!==he.type.kind&&te.type.kind!=="value"&&he.type.kind!=="value")return V.error(`Cannot compare types '${le(te.type)}' and '${le(he.type)}'.`);C&&(te.type.kind==="value"&&he.type.kind!=="value"?te=new Vn(he.type,[te]):te.type.kind!=="value"&&he.type.kind==="value"&&(he=new Vn(te.type,[he])));let h=null;if(Q.length===4){if(te.type.kind!=="string"&&he.type.kind!=="string"&&te.type.kind!=="value"&&he.type.kind!=="value")return V.error("Cannot use collator to compare non-string types.");if(h=V.parse(Q[3],3,mr),!h)return null}return new lN(te,he,h)}evaluate(Q){const V=this.lhs.evaluate(Q),K=this.rhs.evaluate(Q);if(C&&this.hasUntypedArgument){const te=Wi(V),he=Wi(K);if(te.kind!==he.kind||te.kind!=="string"&&te.kind!=="number")throw new dr(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${te.kind}, ${he.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const te=Wi(V),he=Wi(K);if(te.kind!=="string"||he.kind!=="string")return u(Q,V,K)}return this.collator?g(Q,V,K,this.collator.evaluate(Q)):u(Q,V,K)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}}}const Lc=kl("==",function(p,u,g){return u===g},Xo),Ah=kl("!=",function(p,u,g){return u!==g},function(p,u,g,C){return!Xo(0,u,g,C)}),ru=kl("<",function(p,u,g){return u<g},function(p,u,g,C){return C.compare(u,g)<0}),nu=kl(">",function(p,u,g){return u>g},function(p,u,g,C){return C.compare(u,g)>0}),Iu=kl("<=",function(p,u,g){return u<=g},function(p,u,g,C){return C.compare(u,g)<=0}),Ol=kl(">=",function(p,u,g){return u>=g},function(p,u,g,C){return C.compare(u,g)>=0});class Ka{constructor(u,g,C,P,Q){this.type=Bi,this.number=u,this.locale=g,this.currency=C,this.minFractionDigits=P,this.maxFractionDigits=Q}static parse(u,g){if(u.length!==3)return g.error("Expected two arguments.");const C=g.parse(u[1],1,Qt);if(!C)return null;const P=u[2];if(typeof P!="object"||Array.isArray(P))return g.error("NumberFormat options argument must be an object.");let Q=null;if(P.locale&&(Q=g.parse(P.locale,1,Bi),!Q))return null;let V=null;if(P.currency&&(V=g.parse(P.currency,1,Bi),!V))return null;let K=null;if(P["min-fraction-digits"]&&(K=g.parse(P["min-fraction-digits"],1,Qt),!K))return null;let te=null;return P["max-fraction-digits"]&&(te=g.parse(P["max-fraction-digits"],1,Qt),!te)?null:new Ka(C,Q,V,K,te)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class Wa{constructor(u){this.type=Sr,this.sections=u}static parse(u,g){if(u.length<2)return g.error("Expected at least one argument.");const C=u[1];if(!Array.isArray(C)&&typeof C=="object")return g.error("First argument must be an image or text section.");const P=[];let Q=!1;for(let V=1;V<=u.length-1;++V){const K=u[V];if(Q&&typeof K=="object"&&!Array.isArray(K)){Q=!1;let te=null;if(K["font-scale"]&&(te=g.parse(K["font-scale"],1,Qt),!te))return null;let he=null;if(K["text-font"]&&(he=g.parse(K["text-font"],1,Y(Bi)),!he))return null;let h=null;if(K["text-color"]&&(h=g.parse(K["text-color"],1,Gt),!h))return null;const l=P[P.length-1];l.scale=te,l.font=he,l.textColor=h}else{const te=g.parse(u[V],1,Jt);if(!te)return null;const he=te.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,P.push({content:te,scale:null,font:null,textColor:null})}}return new Wa(P)}evaluate(u){return new lr(this.sections.map(g=>{const C=g.content.evaluate(u);return Wi(C)===we?new mn("",C,null,null,null):new mn(Js(C),null,g.scale?g.scale.evaluate(u):null,g.font?g.font.evaluate(u).join(","):null,g.textColor?g.textColor.evaluate(u):null)}))}eachChild(u){for(const g of this.sections)u(g.content),g.scale&&u(g.scale),g.font&&u(g.font),g.textColor&&u(g.textColor)}outputDefined(){return!1}}class Ul{constructor(u){this.type=we,this.input=u}static parse(u,g){if(u.length!==2)return g.error("Expected two arguments.");const C=g.parse(u[1],1,Bi);return C?new Ul(C):g.error("No image name provided.")}evaluate(u){const g=this.input.evaluate(u),C=xn.fromString(g);return C&&u.availableImages&&(C.available=u.availableImages.indexOf(g)>-1),C}eachChild(u){u(this.input)}outputDefined(){return!1}}class Xa{constructor(u){this.type=Qt,this.input=u}static parse(u,g){if(u.length!==2)return g.error(`Expected 1 argument, but found ${u.length-1} instead.`);const C=g.parse(u[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${le(C.type)} instead.`):new Xa(C):null}evaluate(u){const g=this.input.evaluate(u);if(typeof g=="string"||Array.isArray(g))return g.length;throw new dr(`Expected value to be of type string or array, but found ${le(Wi(g))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Aa={"==":Lc,"!=":Ah,">":nu,"<":ru,">=":Ol,"<=":Iu,array:Vn,at:Rl,boolean:Vn,case:Wo,coalesce:$a,collator:ca,format:Wa,image:Ul,in:Io,"index-of":Ko,interpolate:rs,"interpolate-hcl":rs,"interpolate-lab":rs,length:Xa,let:nl,literal:ws,match:cc,number:Vn,"number-format":Ka,object:Vn,slice:Ao,step:Sa,string:Vn,"to-boolean":Cn,"to-color":Cn,"to-number":Cn,"to-string":Cn,var:Dl,within:Ha};function sl(p,u){let[g,C,P,Q]=u;g=g.evaluate(p),C=C.evaluate(p),P=P.evaluate(p);const V=Q?Q.evaluate(p):1,K=So(g,C,P,V);if(K)throw new dr(K);return new ur(g/255,C/255,P/255,V,!1)}function Nl(p,u){return p in u}function Ys(p,u){const g=u[p];return g===void 0?null:g}function da(p){return{type:p}}function re(p){return{result:"success",value:p}}function Ie(p){return{result:"error",value:p}}function at(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function mt(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function vt(p){return!!p.expression&&p.expression.interpolated}function Tt(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function pi(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function ri(p){return p}function rr(p,u){const g=u.type==="color",C=p.stops&&typeof p.stops[0][0]=="object",P=C||!(C||p.property!==void 0),Q=p.type||(vt(u)?"exponential":"interval");if(g||u.type==="padding"){const h=g?ur.parse:Rn.parse;(p=Ji({},p)).stops&&(p.stops=p.stops.map(l=>[l[0],h(l[1])])),p.default=h(p.default?p.default:u.default)}if(p.colorSpace&&(V=p.colorSpace)!=="rgb"&&V!=="hcl"&&V!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var V;let K,te,he;if(Q==="exponential")K=nr;else if(Q==="interval")K=jr;else if(Q==="categorical"){K=ki,te=Object.create(null);for(const h of p.stops)te[h[0]]=h[1];he=typeof p.stops[0][0]}else{if(Q!=="identity")throw new Error(`Unknown function type "${Q}"`);K=Hn}if(C){const h={},l=[];for(let E=0;E<p.stops.length;E++){const M=p.stops[E],D=M[0].zoom;h[D]===void 0&&(h[D]={zoom:D,type:p.type,property:p.property,default:p.default,stops:[]},l.push(D)),h[D].stops.push([M[0].value,M[1]])}const f=[];for(const E of l)f.push([h[E].zoom,rr(h[E],u)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:rs.interpolationFactor.bind(void 0,v),zoomStops:f.map(E=>E[0]),evaluate:(E,M)=>{let{zoom:D}=E;return nr({stops:f,base:p.base},u,D).evaluate(D,M)}}}if(P){const h=Q==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:rs.interpolationFactor.bind(void 0,h),zoomStops:p.stops.map(l=>l[0]),evaluate:l=>{let{zoom:f}=l;return K(p,u,f,te,he)}}}return{kind:"source",evaluate(h,l){const f=l&&l.properties?l.properties[p.property]:void 0;return f===void 0?qi(p.default,u.default):K(p,u,f,te,he)}}}function qi(p,u,g){return p!==void 0?p:u!==void 0?u:g!==void 0?g:void 0}function ki(p,u,g,C,P){return qi(typeof g===P?C[g]:void 0,p.default,u.default)}function jr(p,u,g){if(Tt(g)!=="number")return qi(p.default,u.default);const C=p.stops.length;if(C===1||g<=p.stops[0][0])return p.stops[0][1];if(g>=p.stops[C-1][0])return p.stops[C-1][1];const P=ja(p.stops.map(Q=>Q[0]),g);return p.stops[P][1]}function nr(p,u,g){const C=p.base!==void 0?p.base:1;if(Tt(g)!=="number")return qi(p.default,u.default);const P=p.stops.length;if(P===1||g<=p.stops[0][0])return p.stops[0][1];if(g>=p.stops[P-1][0])return p.stops[P-1][1];const Q=ja(p.stops.map(h=>h[0]),g),V=function(h,l,f,v){const E=v-f,M=h-f;return E===0?0:l===1?M/E:(Math.pow(l,M)-1)/(Math.pow(l,E)-1)}(g,C,p.stops[Q][0],p.stops[Q+1][0]),K=p.stops[Q][1],te=p.stops[Q+1][1],he=dn[u.type]||ri;return typeof K.evaluate=="function"?{evaluate(){for(var h=arguments.length,l=new Array(h),f=0;f<h;f++)l[f]=arguments[f];const v=K.evaluate.apply(void 0,l),E=te.evaluate.apply(void 0,l);if(v!==void 0&&E!==void 0)return he(v,E,V,p.colorSpace)}}:he(K,te,V,p.colorSpace)}function Hn(p,u,g){switch(u.type){case"color":g=ur.parse(g);break;case"formatted":g=lr.fromString(g.toString());break;case"resolvedImage":g=xn.fromString(g.toString());break;case"padding":g=Rn.parse(g);break;default:Tt(g)===u.type||u.type==="enum"&&u.values[g]||(g=void 0)}return qi(g,p.default,u.default)}Jn.register(Aa,{error:[{kind:"error"},[Bi],(p,u)=>{let[g]=u;throw new dr(g.evaluate(p))}],typeof:[Bi,[Jt],(p,u)=>{let[g]=u;return le(Wi(g.evaluate(p)))}],"to-rgba":[Y(Qt,4),[Gt],(p,u)=>{let[g]=u;const[C,P,Q,V]=g.evaluate(p).rgb;return[255*C,255*P,255*Q,V]}],rgb:[Gt,[Qt,Qt,Qt],sl],rgba:[Gt,[Qt,Qt,Qt,Qt],sl],has:{type:Ii,overloads:[[[Bi],(p,u)=>{let[g]=u;return Nl(g.evaluate(p),p.properties())}],[[Bi,vi],(p,u)=>{let[g,C]=u;return Nl(g.evaluate(p),C.evaluate(p))}]]},get:{type:Jt,overloads:[[[Bi],(p,u)=>{let[g]=u;return Ys(g.evaluate(p),p.properties())}],[[Bi,vi],(p,u)=>{let[g,C]=u;return Ys(g.evaluate(p),C.evaluate(p))}]]},"feature-state":[Jt,[Bi],(p,u)=>{let[g]=u;return Ys(g.evaluate(p),p.featureState||{})}],properties:[vi,[],p=>p.properties()],"geometry-type":[Bi,[],p=>p.geometryType()],id:[Jt,[],p=>p.id()],zoom:[Qt,[],p=>p.globals.zoom],"heatmap-density":[Qt,[],p=>p.globals.heatmapDensity||0],"line-progress":[Qt,[],p=>p.globals.lineProgress||0],accumulated:[Jt,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[Qt,da(Qt),(p,u)=>{let g=0;for(const C of u)g+=C.evaluate(p);return g}],"*":[Qt,da(Qt),(p,u)=>{let g=1;for(const C of u)g*=C.evaluate(p);return g}],"-":{type:Qt,overloads:[[[Qt,Qt],(p,u)=>{let[g,C]=u;return g.evaluate(p)-C.evaluate(p)}],[[Qt],(p,u)=>{let[g]=u;return-g.evaluate(p)}]]},"/":[Qt,[Qt,Qt],(p,u)=>{let[g,C]=u;return g.evaluate(p)/C.evaluate(p)}],"%":[Qt,[Qt,Qt],(p,u)=>{let[g,C]=u;return g.evaluate(p)%C.evaluate(p)}],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(p,u)=>{let[g,C]=u;return Math.pow(g.evaluate(p),C.evaluate(p))}],sqrt:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.sqrt(g.evaluate(p))}],log10:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.log(g.evaluate(p))/Math.LN10}],ln:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.log(g.evaluate(p))}],log2:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.log(g.evaluate(p))/Math.LN2}],sin:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.sin(g.evaluate(p))}],cos:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.cos(g.evaluate(p))}],tan:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.tan(g.evaluate(p))}],asin:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.asin(g.evaluate(p))}],acos:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.acos(g.evaluate(p))}],atan:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.atan(g.evaluate(p))}],min:[Qt,da(Qt),(p,u)=>Math.min(...u.map(g=>g.evaluate(p)))],max:[Qt,da(Qt),(p,u)=>Math.max(...u.map(g=>g.evaluate(p)))],abs:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.abs(g.evaluate(p))}],round:[Qt,[Qt],(p,u)=>{let[g]=u;const C=g.evaluate(p);return C<0?-Math.round(-C):Math.round(C)}],floor:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.floor(g.evaluate(p))}],ceil:[Qt,[Qt],(p,u)=>{let[g]=u;return Math.ceil(g.evaluate(p))}],"filter-==":[Ii,[Bi,Jt],(p,u)=>{let[g,C]=u;return p.properties()[g.value]===C.value}],"filter-id-==":[Ii,[Jt],(p,u)=>{let[g]=u;return p.id()===g.value}],"filter-type-==":[Ii,[Bi],(p,u)=>{let[g]=u;return p.geometryType()===g.value}],"filter-<":[Ii,[Bi,Jt],(p,u)=>{let[g,C]=u;const P=p.properties()[g.value],Q=C.value;return typeof P==typeof Q&&P<Q}],"filter-id-<":[Ii,[Jt],(p,u)=>{let[g]=u;const C=p.id(),P=g.value;return typeof C==typeof P&&C<P}],"filter->":[Ii,[Bi,Jt],(p,u)=>{let[g,C]=u;const P=p.properties()[g.value],Q=C.value;return typeof P==typeof Q&&P>Q}],"filter-id->":[Ii,[Jt],(p,u)=>{let[g]=u;const C=p.id(),P=g.value;return typeof C==typeof P&&C>P}],"filter-<=":[Ii,[Bi,Jt],(p,u)=>{let[g,C]=u;const P=p.properties()[g.value],Q=C.value;return typeof P==typeof Q&&P<=Q}],"filter-id-<=":[Ii,[Jt],(p,u)=>{let[g]=u;const C=p.id(),P=g.value;return typeof C==typeof P&&C<=P}],"filter->=":[Ii,[Bi,Jt],(p,u)=>{let[g,C]=u;const P=p.properties()[g.value],Q=C.value;return typeof P==typeof Q&&P>=Q}],"filter-id->=":[Ii,[Jt],(p,u)=>{let[g]=u;const C=p.id(),P=g.value;return typeof C==typeof P&&C>=P}],"filter-has":[Ii,[Jt],(p,u)=>{let[g]=u;return g.value in p.properties()}],"filter-has-id":[Ii,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Ii,[Y(Bi)],(p,u)=>{let[g]=u;return g.value.indexOf(p.geometryType())>=0}],"filter-id-in":[Ii,[Y(Jt)],(p,u)=>{let[g]=u;return g.value.indexOf(p.id())>=0}],"filter-in-small":[Ii,[Bi,Y(Jt)],(p,u)=>{let[g,C]=u;return C.value.indexOf(p.properties()[g.value])>=0}],"filter-in-large":[Ii,[Bi,Y(Jt)],(p,u)=>{let[g,C]=u;return function(P,Q,V,K){for(;V<=K;){const te=V+K>>1;if(Q[te]===P)return!0;Q[te]>P?K=te-1:V=te+1}return!1}(p.properties()[g.value],C.value,0,C.value.length-1)}],all:{type:Ii,overloads:[[[Ii,Ii],(p,u)=>{let[g,C]=u;return g.evaluate(p)&&C.evaluate(p)}],[da(Ii),(p,u)=>{for(const g of u)if(!g.evaluate(p))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(p,u)=>{let[g,C]=u;return g.evaluate(p)||C.evaluate(p)}],[da(Ii),(p,u)=>{for(const g of u)if(g.evaluate(p))return!0;return!1}]]},"!":[Ii,[Ii],(p,u)=>{let[g]=u;return!g.evaluate(p)}],"is-supported-script":[Ii,[Bi],(p,u)=>{let[g]=u;const C=p.globals&&p.globals.isSupportedScript;return!C||C(g.evaluate(p))}],upcase:[Bi,[Bi],(p,u)=>{let[g]=u;return g.evaluate(p).toUpperCase()}],downcase:[Bi,[Bi],(p,u)=>{let[g]=u;return g.evaluate(p).toLowerCase()}],concat:[Bi,da(Jt),(p,u)=>u.map(g=>Js(g.evaluate(p))).join("")],"resolved-locale":[Bi,[mr],(p,u)=>{let[g]=u;return g.evaluate(p).resolvedLocale()}]});class Br{constructor(u,g){var C;this.expression=u,this._warningHistory={},this._evaluator=new Hr,this._defaultValue=g?(C=g).type==="color"&&pi(C.default)?new ur(0,0,0,0):C.type==="color"?ur.parse(C.default)||null:C.type==="padding"?Rn.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Qr.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=g&&g.type==="enum"?g.values:null}evaluateWithoutErrorHandling(u,g,C,P,Q,V){return this._evaluator.globals=u,this._evaluator.feature=g,this._evaluator.featureState=C,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V,this.expression.evaluate(this._evaluator)}evaluate(u,g,C,P,Q,V){this._evaluator.globals=u,this._evaluator.feature=g||null,this._evaluator.featureState=C||null,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V||null;try{const K=this.expression.evaluate(this._evaluator);if(K==null||typeof K=="number"&&K!=K)return this._defaultValue;if(this._enumValues&&!(K in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(te=>JSON.stringify(te)).join(", ")}, but found ${JSON.stringify(K)} instead.`);return K}catch(K){return this._warningHistory[K.message]||(this._warningHistory[K.message]=!0,typeof console<"u"&&console.warn(K.message)),this._defaultValue}}}function Lr(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in Aa}function On(p,u){const g=new Hs(Aa,To,[],u?function(P){const Q={color:Gt,string:Bi,number:Qt,enum:Bi,boolean:Ii,formatted:Sr,padding:ze,resolvedImage:we,variableAnchorOffsetCollection:oe};return P.type==="array"?Y(Q[P.value]||Jt,P.length):Q[P.type]}(u):void 0),C=g.parse(p,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?re(new Br(C,u)):Ie(g.errors)}class qs{constructor(u,g){this.kind=u,this._styleExpression=g,this.isStateDependent=u!=="constant"&&!gs(g.expression)}evaluateWithoutErrorHandling(u,g,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,g,C,P,Q,V)}evaluate(u,g,C,P,Q,V){return this._styleExpression.evaluate(u,g,C,P,Q,V)}}class eo{constructor(u,g,C,P){this.kind=u,this.zoomStops=C,this._styleExpression=g,this.isStateDependent=u!=="camera"&&!gs(g.expression),this.interpolationType=P}evaluateWithoutErrorHandling(u,g,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,g,C,P,Q,V)}evaluate(u,g,C,P,Q,V){return this._styleExpression.evaluate(u,g,C,P,Q,V)}interpolationFactor(u,g,C){return this.interpolationType?rs.interpolationFactor(this.interpolationType,u,g,C):0}}function Lo(p,u){const g=On(p,u);if(g.result==="error")return g;const C=g.value.expression,P=Ga(C);if(!P&&!at(u))return Ie([new ci("","data expressions not supported")]);const Q=ua(C,["zoom"]);if(!Q&&!mt(u))return Ie([new ci("","zoom expressions not supported")]);const V=fa(C);return V||Q?V instanceof ci?Ie([V]):V instanceof rs&&!vt(u)?Ie([new ci("",'"interpolate" expressions cannot be used with this property')]):re(V?new eo(P?"camera":"composite",g.value,V.labels,V instanceof rs?V.interpolation:void 0):new qs(P?"constant":"source",g.value)):Ie([new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ta{constructor(u,g){this._parameters=u,this._specification=g,Ji(this,rr(this._parameters,this._specification))}static deserialize(u){return new Ta(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function fa(p){let u=null;if(p instanceof nl)u=fa(p.result);else if(p instanceof $a){for(const g of p.args)if(u=fa(g),u)break}else(p instanceof Sa||p instanceof rs)&&p.input instanceof Jn&&p.input.name==="zoom"&&(u=p);return u instanceof ci||p.eachChild(g=>{const C=fa(g);C instanceof ci?u=C:!u&&C?u=new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&C&&u!==C&&(u=new ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function zl(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(const u of p.slice(1))if(!zl(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const ol={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ql(p){if(p==null)return{filter:()=>!0,needGeometry:!1};zl(p)||(p=Ps(p));const u=On(p,ol);if(u.result==="error")throw new Error(u.value.map(g=>`${g.key}: ${g.message}`).join(", "));return{filter:(g,C,P)=>u.value.evaluate(g,C,{},P),needGeometry:pa(p)}}function hc(p,u){return p<u?-1:p>u?1:0}function pa(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(let u=1;u<p.length;u++)if(pa(p[u]))return!0;return!1}function Ps(p){if(!p)return!0;const u=p[0];return p.length<=1?u!=="any":u==="=="?al(p[1],p[2],"=="):u==="!="?La(al(p[1],p[2],"==")):u==="<"||u===">"||u==="<="||u===">="?al(p[1],p[2],u):u==="any"?(g=p.slice(1),["any"].concat(g.map(Ps))):u==="all"?["all"].concat(p.slice(1).map(Ps)):u==="none"?["all"].concat(p.slice(1).map(Ps).map(La)):u==="in"?Vl(p[1],p.slice(2)):u==="!in"?La(Vl(p[1],p.slice(2))):u==="has"?Ia(p[1]):u==="!has"?La(Ia(p[1])):u!=="within"||p;var g}function al(p,u,g){switch(p){case"$type":return[`filter-type-${g}`,u];case"$id":return[`filter-id-${g}`,u];default:return[`filter-${g}`,p,u]}}function Vl(p,u){if(u.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(g=>typeof g!=typeof u[0])?["filter-in-large",p,["literal",u.sort(hc)]]:["filter-in-small",p,["literal",u]]}}function Ia(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function La(p){return["!",p]}function Fs(p){const u=typeof p;if(u==="number"||u==="boolean"||u==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let P="[";for(const Q of p)P+=`${Fs(Q)},`;return`${P}]`}const g=Object.keys(p).sort();let C="{";for(let P=0;P<g.length;P++)C+=`${JSON.stringify(g[P])}:${Fs(p[g[P]])},`;return`${C}}`}function Lu(p){let u="";for(const g of Ri)u+=`/${Fs(p[g])}`;return u}function Sn(p){const u=p.value;return u?[new Nt(p.key,u,"constants have been deprecated as of v8")]:[]}function on(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function fn(p){if(Array.isArray(p))return p.map(fn);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){const u={};for(const g in p)u[g]=fn(p[g]);return u}return on(p)}function Yn(p){const u=p.key,g=p.value,C=p.valueSpec||{},P=p.objectElementValidators||{},Q=p.style,V=p.styleSpec,K=p.validateSpec;let te=[];const he=Tt(g);if(he!=="object")return[new Nt(u,g,`object expected, ${he} found`)];for(const h in g){const l=h.split(".")[0],f=C[l]||C["*"];let v;if(P[l])v=P[l];else if(C[l])v=K;else if(P["*"])v=P["*"];else{if(!C["*"]){te.push(new Nt(u,g[h],`unknown property "${h}"`));continue}v=K}te=te.concat(v({key:(u&&`${u}.`)+h,value:g[h],valueSpec:f,style:Q,styleSpec:V,object:g,objectKey:h,validateSpec:K},g))}for(const h in C)P[h]||C[h].required&&C[h].default===void 0&&g[h]===void 0&&te.push(new Nt(u,g,`missing required property "${h}"`));return te}function ll(p){const u=p.value,g=p.valueSpec,C=p.style,P=p.styleSpec,Q=p.key,V=p.arrayElementValidator||p.validateSpec;if(Tt(u)!=="array")return[new Nt(Q,u,`array expected, ${Tt(u)} found`)];if(g.length&&u.length!==g.length)return[new Nt(Q,u,`array length ${g.length} expected, length ${u.length} found`)];if(g["min-length"]&&u.length<g["min-length"])return[new Nt(Q,u,`array length at least ${g["min-length"]} expected, length ${u.length} found`)];let K={type:g.value,values:g.values};P.$version<7&&(K.function=g.function),Tt(g.value)==="object"&&(K=g.value);let te=[];for(let he=0;he<u.length;he++)te=te.concat(V({array:u,arrayIndex:he,value:u[he],valueSpec:K,validateSpec:p.validateSpec,style:C,styleSpec:P,key:`${Q}[${he}]`}));return te}function cl(p){const u=p.key,g=p.value,C=p.valueSpec;let P=Tt(g);return P==="number"&&g!=g&&(P="NaN"),P!=="number"?[new Nt(u,g,`number expected, ${P} found`)]:"minimum"in C&&g<C.minimum?[new Nt(u,g,`${g} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&g>C.maximum?[new Nt(u,g,`${g} is greater than the maximum value ${C.maximum}`)]:[]}function fo(p){const u=p.valueSpec,g=on(p.value.type);let C,P,Q,V={};const K=g!=="categorical"&&p.value.property===void 0,te=!K,he=Tt(p.value.stops)==="array"&&Tt(p.value.stops[0])==="array"&&Tt(p.value.stops[0][0])==="object",h=Yn({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(v){if(g==="identity")return[new Nt(v.key,v.value,'identity function may not have a "stops" property')];let E=[];const M=v.value;return E=E.concat(ll({key:v.key,value:M,valueSpec:v.valueSpec,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:l})),Tt(M)==="array"&&M.length===0&&E.push(new Nt(v.key,M,"array must have at least one stop")),E},default:function(v){return v.validateSpec({key:v.key,value:v.value,valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec})}}});return g==="identity"&&K&&h.push(new Nt(p.key,p.value,'missing required property "property"')),g==="identity"||p.value.stops||h.push(new Nt(p.key,p.value,'missing required property "stops"')),g==="exponential"&&p.valueSpec.expression&&!vt(p.valueSpec)&&h.push(new Nt(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(te&&!at(p.valueSpec)?h.push(new Nt(p.key,p.value,"property functions not supported")):K&&!mt(p.valueSpec)&&h.push(new Nt(p.key,p.value,"zoom functions not supported"))),g!=="categorical"&&!he||p.value.property!==void 0||h.push(new Nt(p.key,p.value,'"property" property is required')),h;function l(v){let E=[];const M=v.value,D=v.key;if(Tt(M)!=="array")return[new Nt(D,M,`array expected, ${Tt(M)} found`)];if(M.length!==2)return[new Nt(D,M,`array length 2 expected, length ${M.length} found`)];if(he){if(Tt(M[0])!=="object")return[new Nt(D,M,`object expected, ${Tt(M[0])} found`)];if(M[0].zoom===void 0)return[new Nt(D,M,"object stop key must have zoom")];if(M[0].value===void 0)return[new Nt(D,M,"object stop key must have value")];if(Q&&Q>on(M[0].zoom))return[new Nt(D,M[0].zoom,"stop zoom values must appear in ascending order")];on(M[0].zoom)!==Q&&(Q=on(M[0].zoom),P=void 0,V={}),E=E.concat(Yn({key:`${D}[0]`,value:M[0],valueSpec:{zoom:{}},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:cl,value:f}}))}else E=E.concat(f({key:`${D}[0]`,value:M[0],valueSpec:{},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec},M));return Lr(fn(M[1]))?E.concat([new Nt(`${D}[1]`,M[1],"expressions are not allowed in function stops.")]):E.concat(v.validateSpec({key:`${D}[1]`,value:M[1],valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec}))}function f(v,E){const M=Tt(v.value),D=on(v.value),G=v.value!==null?v.value:E;if(C){if(M!==C)return[new Nt(v.key,G,`${M} stop domain type must match previous stop domain type ${C}`)]}else C=M;if(M!=="number"&&M!=="string"&&M!=="boolean")return[new Nt(v.key,G,"stop domain value must be a number, string, or boolean")];if(M!=="number"&&g!=="categorical"){let $=`number expected, ${M} found`;return at(u)&&g===void 0&&($+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(v.key,G,$)]}return g!=="categorical"||M!=="number"||isFinite(D)&&Math.floor(D)===D?g!=="categorical"&&M==="number"&&P!==void 0&&D<P?[new Nt(v.key,G,"stop domain values must appear in ascending order")]:(P=D,g==="categorical"&&D in V?[new Nt(v.key,G,"stop domain values must be unique")]:(V[D]=!0,[])):[new Nt(v.key,G,`integer expected, found ${D}`)]}}function ns(p){const u=(p.expressionContext==="property"?Lo:On)(fn(p.value),p.valueSpec);if(u.result==="error")return u.value.map(C=>new Nt(`${p.key}${C.key}`,p.value,C.message));const g=u.value.expression||u.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!g.outputDefined())return[new Nt(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!gs(g))return[new Nt(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!gs(g))return[new Nt(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!ua(g,["zoom","feature-state"]))return[new Nt(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!Ga(g))return[new Nt(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ss(p){const u=p.key,g=p.value,C=p.valueSpec,P=[];return Array.isArray(C.values)?C.values.indexOf(on(g))===-1&&P.push(new Nt(u,g,`expected one of [${C.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(C.values).indexOf(on(g))===-1&&P.push(new Nt(u,g,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(g)} found`)),P}function Mo(p){return zl(fn(p.value))?ns(Ji({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Po(p)}function Po(p){const u=p.value,g=p.key;if(Tt(u)!=="array")return[new Nt(g,u,`array expected, ${Tt(u)} found`)];const C=p.styleSpec;let P,Q=[];if(u.length<1)return[new Nt(g,u,"filter array must have at least 1 element")];switch(Q=Q.concat(ss({key:`${g}[0]`,value:u[0],valueSpec:C.filter_operator,style:p.style,styleSpec:p.styleSpec})),on(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&on(u[1])==="$type"&&Q.push(new Nt(g,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&Q.push(new Nt(g,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(P=Tt(u[1]),P!=="string"&&Q.push(new Nt(`${g}[1]`,u[1],`string expected, ${P} found`)));for(let V=2;V<u.length;V++)P=Tt(u[V]),on(u[1])==="$type"?Q=Q.concat(ss({key:`${g}[${V}]`,value:u[V],valueSpec:C.geometry_type,style:p.style,styleSpec:p.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&Q.push(new Nt(`${g}[${V}]`,u[V],`string, number, or boolean expected, ${P} found`));break;case"any":case"all":case"none":for(let V=1;V<u.length;V++)Q=Q.concat(Po({key:`${g}[${V}]`,value:u[V],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":P=Tt(u[1]),u.length!==2?Q.push(new Nt(g,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="string"&&Q.push(new Nt(`${g}[1]`,u[1],`string expected, ${P} found`));break;case"within":P=Tt(u[1]),u.length!==2?Q.push(new Nt(g,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="object"&&Q.push(new Nt(`${g}[1]`,u[1],`object expected, ${P} found`))}return Q}function ga(p,u){const g=p.key,C=p.validateSpec,P=p.style,Q=p.styleSpec,V=p.value,K=p.objectKey,te=Q[`${u}_${p.layerType}`];if(!te)return[];const he=K.match(/^(.*)-transition$/);if(u==="paint"&&he&&te[he[1]]&&te[he[1]].transition)return C({key:g,value:V,valueSpec:Q.transition,style:P,styleSpec:Q});const h=p.valueSpec||te[K];if(!h)return[new Nt(g,V,`unknown property "${K}"`)];let l;if(Tt(V)==="string"&&at(h)&&!h.tokens&&(l=/^{([^}]+)}$/.exec(V)))return[new Nt(g,V,`"${K}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(l[1])} }\`.`)];const f=[];return p.layerType==="symbol"&&(K==="text-field"&&P&&!P.glyphs&&f.push(new Nt(g,V,'use of "text-field" requires a style "glyphs" property')),K==="text-font"&&pi(fn(V))&&on(V.type)==="identity"&&f.push(new Nt(g,V,'"text-font" does not support identity functions'))),f.concat(C({key:p.key,value:V,valueSpec:h,style:P,styleSpec:Q,expressionContext:"property",propertyType:u,propertyKey:K}))}function ul(p){return ga(p,"paint")}function to(p){return ga(p,"layout")}function io(p){let u=[];const g=p.value,C=p.key,P=p.style,Q=p.styleSpec;g.type||g.ref||u.push(new Nt(C,g,'either "type" or "ref" is required'));let V=on(g.type);const K=on(g.ref);if(g.id){const te=on(g.id);for(let he=0;he<p.arrayIndex;he++){const h=P.layers[he];on(h.id)===te&&u.push(new Nt(C,g.id,`duplicate layer id "${g.id}", previously used at line ${h.id.__line__}`))}}if("ref"in g){let te;["type","source","source-layer","filter","layout"].forEach(he=>{he in g&&u.push(new Nt(C,g[he],`"${he}" is prohibited for ref layers`))}),P.layers.forEach(he=>{on(he.id)===K&&(te=he)}),te?te.ref?u.push(new Nt(C,g.ref,"ref cannot reference another ref layer")):V=on(te.type):u.push(new Nt(C,g.ref,`ref layer "${K}" not found`))}else if(V!=="background")if(g.source){const te=P.sources&&P.sources[g.source],he=te&&on(te.type);te?he==="vector"&&V==="raster"?u.push(new Nt(C,g.source,`layer "${g.id}" requires a raster source`)):he!=="raster-dem"&&V==="hillshade"?u.push(new Nt(C,g.source,`layer "${g.id}" requires a raster-dem source`)):he==="raster"&&V!=="raster"?u.push(new Nt(C,g.source,`layer "${g.id}" requires a vector source`)):he!=="vector"||g["source-layer"]?he==="raster-dem"&&V!=="hillshade"?u.push(new Nt(C,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="line"||!g.paint||!g.paint["line-gradient"]||he==="geojson"&&te.lineMetrics||u.push(new Nt(C,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new Nt(C,g,`layer "${g.id}" must specify a "source-layer"`)):u.push(new Nt(C,g.source,`source "${g.source}" not found`))}else u.push(new Nt(C,g,'missing required property "source"'));return u=u.concat(Yn({key:C,value:g,valueSpec:Q.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${C}.type`,value:g.type,valueSpec:Q.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:g,objectKey:"type"}),filter:Mo,layout:te=>Yn({layer:g,key:te.key,value:te.value,style:te.style,styleSpec:te.styleSpec,validateSpec:te.validateSpec,objectElementValidators:{"*":he=>to(Ji({layerType:V},he))}}),paint:te=>Yn({layer:g,key:te.key,value:te.value,style:te.style,styleSpec:te.styleSpec,validateSpec:te.validateSpec,objectElementValidators:{"*":he=>ul(Ji({layerType:V},he))}})}})),u}function po(p){const u=p.value,g=p.key,C=Tt(u);return C!=="string"?[new Nt(g,u,`string expected, ${C} found`)]:[]}const ms={promoteId:function(p){let{key:u,value:g}=p;if(Tt(g)==="string")return po({key:u,value:g});{const C=[];for(const P in g)C.push(...po({key:`${u}.${P}`,value:g[P]}));return C}}};function ro(p){const u=p.value,g=p.key,C=p.styleSpec,P=p.style,Q=p.validateSpec;if(!u.type)return[new Nt(g,u,'"type" is required')];const V=on(u.type);let K;switch(V){case"vector":case"raster":return K=Yn({key:g,value:u,valueSpec:C[`source_${V.replace("-","_")}`],style:p.style,styleSpec:C,objectElementValidators:ms,validateSpec:Q}),K;case"raster-dem":return K=function(te){var he;const h=(he=te.sourceName)!==null&&he!==void 0?he:"",l=te.value,f=te.styleSpec,v=f.source_raster_dem,E=te.style;let M=[];const D=Tt(l);if(l===void 0)return M;if(D!=="object")return M.push(new Nt("source_raster_dem",l,`object expected, ${D} found`)),M;const G=on(l.encoding)==="custom",$=["redFactor","greenFactor","blueFactor","baseShift"],X=te.value.encoding?`"${te.value.encoding}"`:"Default";for(const se in l)!G&&$.includes(se)?M.push(new Nt(se,l[se],`In "${h}": "${se}" is only valid when "encoding" is set to "custom". ${X} encoding found`)):v[se]?M=M.concat(te.validateSpec({key:se,value:l[se],valueSpec:v[se],validateSpec:te.validateSpec,style:E,styleSpec:f})):M.push(new Nt(se,l[se],`unknown property "${se}"`));return M}({sourceName:g,value:u,style:p.style,styleSpec:C,validateSpec:Q}),K;case"geojson":if(K=Yn({key:g,value:u,valueSpec:C.source_geojson,style:P,styleSpec:C,validateSpec:Q,objectElementValidators:ms}),u.cluster)for(const te in u.clusterProperties){const[he,h]=u.clusterProperties[te],l=typeof he=="string"?[he,["accumulated"],["get",te]]:he;K.push(...ns({key:`${g}.${te}.map`,value:h,validateSpec:Q,expressionContext:"cluster-map"})),K.push(...ns({key:`${g}.${te}.reduce`,value:l,validateSpec:Q,expressionContext:"cluster-reduce"}))}return K;case"video":return Yn({key:g,value:u,valueSpec:C.source_video,style:P,validateSpec:Q,styleSpec:C});case"image":return Yn({key:g,value:u,valueSpec:C.source_image,style:P,validateSpec:Q,styleSpec:C});case"canvas":return[new Nt(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ss({key:`${g}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:P,validateSpec:Q,styleSpec:C})}}function Ma(p){const u=p.value,g=p.styleSpec,C=g.light,P=p.style;let Q=[];const V=Tt(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new Nt("light",u,`object expected, ${V} found`)]),Q;for(const K in u){const te=K.match(/^(.*)-transition$/);Q=Q.concat(te&&C[te[1]]&&C[te[1]].transition?p.validateSpec({key:K,value:u[K],valueSpec:g.transition,validateSpec:p.validateSpec,style:P,styleSpec:g}):C[K]?p.validateSpec({key:K,value:u[K],valueSpec:C[K],validateSpec:p.validateSpec,style:P,styleSpec:g}):[new Nt(K,u[K],`unknown property "${K}"`)])}return Q}function ma(p){const u=p.value,g=p.styleSpec,C=g.sky,P=p.style,Q=Tt(u);if(u===void 0)return[];if(Q!=="object")return[new Nt("sky",u,`object expected, ${Q} found`)];let V=[];for(const K in u)V=V.concat(C[K]?hs({key:K,value:u[K],valueSpec:C[K],style:P,styleSpec:g}):[new Nt(K,u[K],`unknown property "${K}"`)]);return V}function Pa(p){const u=p.value,g=p.styleSpec,C=g.terrain,P=p.style;let Q=[];const V=Tt(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new Nt("terrain",u,`object expected, ${V} found`)]),Q;for(const K in u)Q=Q.concat(C[K]?p.validateSpec({key:K,value:u[K],valueSpec:C[K],validateSpec:p.validateSpec,style:P,styleSpec:g}):[new Nt(K,u[K],`unknown property "${K}"`)]);return Q}function Tn(p){let u=[];const g=p.value,C=p.key;if(Array.isArray(g)){const P=[],Q=[];for(const V in g)g[V].id&&P.includes(g[V].id)&&u.push(new Nt(C,g,`all the sprites' ids must be unique, but ${g[V].id} is duplicated`)),P.push(g[V].id),g[V].url&&Q.includes(g[V].url)&&u.push(new Nt(C,g,`all the sprites' URLs must be unique, but ${g[V].url} is duplicated`)),Q.push(g[V].url),u=u.concat(Yn({key:`${C}[${V}]`,value:g[V],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return u}return po({key:C,value:g})}const Fo={"*":()=>[],array:ll,boolean:function(p){const u=p.value,g=p.key,C=Tt(u);return C!=="boolean"?[new Nt(g,u,`boolean expected, ${C} found`)]:[]},number:cl,color:function(p){const u=p.key,g=p.value,C=Tt(g);return C!=="string"?[new Nt(u,g,`color expected, ${C} found`)]:ur.parse(String(g))?[]:[new Nt(u,g,`color expected, "${g}" found`)]},constants:Sn,enum:ss,filter:Mo,function:fo,layer:io,object:Yn,source:ro,light:Ma,sky:ma,terrain:Pa,string:po,formatted:function(p){return po(p).length===0?[]:ns(p)},resolvedImage:function(p){return po(p).length===0?[]:ns(p)},padding:function(p){const u=p.key,g=p.value;if(Tt(g)==="array"){if(g.length<1||g.length>4)return[new Nt(u,g,`padding requires 1 to 4 values; ${g.length} values found`)];const C={type:"number"};let P=[];for(let Q=0;Q<g.length;Q++)P=P.concat(p.validateSpec({key:`${u}[${Q}]`,value:g[Q],validateSpec:p.validateSpec,valueSpec:C}));return P}return cl({key:u,value:g,valueSpec:{}})},variableAnchorOffsetCollection:function(p){const u=p.key,g=p.value,C=Tt(g),P=p.styleSpec;if(C!=="array"||g.length<1||g.length%2!=0)return[new Nt(u,g,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Q=[];for(let V=0;V<g.length;V+=2)Q=Q.concat(ss({key:`${u}[${V}]`,value:g[V],valueSpec:P.layout_symbol["text-anchor"]})),Q=Q.concat(ll({key:`${u}[${V+1}]`,value:g[V+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:P}));return Q},sprite:Tn};function hs(p){const u=p.value,g=p.valueSpec,C=p.styleSpec;return p.validateSpec=hs,g.expression&&pi(on(u))?fo(p):g.expression&&Lr(fn(u))?ns(p):g.type&&Fo[g.type]?Fo[g.type](p):Yn(Ji({},p,{valueSpec:g.type?C[g.type]:g}))}function ys(p){const u=p.value,g=p.key,C=po(p);return C.length||(u.indexOf("{fontstack}")===-1&&C.push(new Nt(g,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&C.push(new Nt(g,u,'"glyphs" url must include a "{range}" token'))),C}function As(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xt,g=[];return g=g.concat(hs({key:"",value:p,valueSpec:u.$root,styleSpec:u,style:p,validateSpec:hs,objectElementValidators:{glyphs:ys,"*":()=>[]}})),p.constants&&(g=g.concat(Sn({key:"constants",value:p.constants,style:p,styleSpec:u,validateSpec:hs}))),Zr(g)}function Ir(p){return function(u){return p({...u,validateSpec:hs})}}function Zr(p){return[].concat(p).sort((u,g)=>u.line-g.line)}function an(p){return function(){for(var u=arguments.length,g=new Array(u),C=0;C<u;C++)g[C]=arguments[C];return Zr(p.apply(this,g))}}As.source=an(Ir(ro)),As.sprite=an(Ir(Tn)),As.glyphs=an(Ir(ys)),As.light=an(Ir(Ma)),As.sky=an(Ir(ma)),As.terrain=an(Ir(Pa)),As.layer=an(Ir(io)),As.filter=an(Ir(Mo)),As.paintProperty=an(Ir(ul)),As.layoutProperty=an(Ir(to));const Gn=As,ya=Gn.light,Fa=Gn.paintProperty,go=Gn.layoutProperty;function Zo(p,u){let g=!1;if(u&&u.length)for(const C of u)p.fire(new kt(new Error(C.message))),g=!0;return g}class Oi{constructor(u,g,C){const P=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const V=new Int32Array(this.arrayBuffer);u=V[0],this.d=(g=V[1])+2*(C=V[2]);for(let te=0;te<this.d*this.d;te++){const he=V[3+te],h=V[3+te+1];P.push(he===h?null:V.subarray(he,h))}const K=V[3+P.length+1];this.keys=V.subarray(V[3+P.length],K),this.bboxes=V.subarray(K),this.insert=this._insertReadonly}else{this.d=g+2*C;for(let V=0;V<this.d*this.d;V++)P.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=u,this.padding=C,this.scale=g/u,this.uid=0;const Q=C/g*u;this.min=-Q,this.max=u+Q}insert(u,g,C,P,Q){this._forEachCell(g,C,P,Q,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(g),this.bboxes.push(C),this.bboxes.push(P),this.bboxes.push(Q)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,g,C,P,Q,V){this.cells[Q].push(V)}query(u,g,C,P,Q){const V=this.min,K=this.max;if(u<=V&&g<=V&&K<=C&&K<=P&&!Q)return Array.prototype.slice.call(this.keys);{const te=[];return this._forEachCell(u,g,C,P,this._queryCell,te,{},Q),te}}_queryCell(u,g,C,P,Q,V,K,te){const he=this.cells[Q];if(he!==null){const h=this.keys,l=this.bboxes;for(let f=0;f<he.length;f++){const v=he[f];if(K[v]===void 0){const E=4*v;(te?te(l[E+0],l[E+1],l[E+2],l[E+3]):u<=l[E+2]&&g<=l[E+3]&&C>=l[E+0]&&P>=l[E+1])?(K[v]=!0,V.push(h[v])):K[v]=!1}}}}_forEachCell(u,g,C,P,Q,V,K,te){const he=this._convertToCellCoord(u),h=this._convertToCellCoord(g),l=this._convertToCellCoord(C),f=this._convertToCellCoord(P);for(let v=he;v<=l;v++)for(let E=h;E<=f;E++){const M=this.d*E+v;if((!te||te(this._convertFromCellCoord(v),this._convertFromCellCoord(E),this._convertFromCellCoord(v+1),this._convertFromCellCoord(E+1)))&&Q.call(this,u,g,C,P,M,V,K,te))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,g=3+this.cells.length+1+1;let C=0;for(let V=0;V<this.cells.length;V++)C+=this.cells[V].length;const P=new Int32Array(g+C+this.keys.length+this.bboxes.length);P[0]=this.extent,P[1]=this.n,P[2]=this.padding;let Q=g;for(let V=0;V<u.length;V++){const K=u[V];P[3+V]=Q,P.set(K,Q),Q+=K.length}return P[3+u.length]=Q,P.set(this.keys,Q),Q+=this.keys.length,P[3+u.length+1]=Q,P.set(this.bboxes,Q),Q+=this.bboxes.length,P.buffer}static serialize(u,g){const C=u.toArrayBuffer();return g&&g.push(C),{buffer:C}}static deserialize(u){return new Oi(u.buffer)}}const Jo={};function Pi(p,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Jo[p])throw new Error(`${p} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:p,writeable:!1}),Jo[p]={klass:u,omit:g.omit||[],shallow:g.shallow||[]}}Pi("Object",Object),Pi("TransferableGridIndex",Oi),Pi("Color",ur),Pi("Error",Error),Pi("AJAXError",Pt),Pi("ResolvedImage",xn),Pi("StylePropertyFunction",Ta),Pi("StyleExpression",Br,{omit:["_evaluator"]}),Pi("ZoomDependentExpression",eo),Pi("ZoomConstantExpression",qs),Pi("CompoundExpression",Jn,{omit:["_evaluate"]});for(const p in Aa)Aa[p]._classRegistryKey||Pi(`Expression_${p}`,Aa[p]);function hl(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function Hl(p,u){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error)return p;if(hl(p)||_t(p))return u&&u.push(p),p;if(ArrayBuffer.isView(p)){const g=p;return u&&u.push(g.buffer),g}if(p instanceof ImageData)return u&&u.push(p.data.buffer),p;if(Array.isArray(p)){const g=[];for(const C of p)g.push(Hl(C,u));return g}if(typeof p=="object"){const g=p.constructor,C=g._classRegistryKey;if(!C)throw new Error(`can't serialize object of unregistered class ${g.name}`);if(!Jo[C])throw new Error(`${C} is not registered.`);const P=g.serialize?g.serialize(p,u):{};if(g.serialize){if(u&&P===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Q in p){if(!p.hasOwnProperty(Q)||Jo[C].omit.indexOf(Q)>=0)continue;const V=p[Q];P[Q]=Jo[C].shallow.indexOf(Q)>=0?V:Hl(V,u)}p instanceof Error&&(P.message=p.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(P.$name=C),P}throw new Error("can't serialize object of type "+typeof p)}function Li(p){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error||hl(p)||_t(p)||ArrayBuffer.isView(p)||p instanceof ImageData)return p;if(Array.isArray(p))return p.map(Li);if(typeof p=="object"){const u=p.$name||"Object";if(!Jo[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:g}=Jo[u];if(!g)throw new Error(`can't deserialize unregistered class ${u}`);if(g.deserialize)return g.deserialize(p);const C=Object.create(g.prototype);for(const P of Object.keys(p)){if(P==="$name")continue;const Q=p[P];C[P]=Jo[u].shallow.indexOf(P)>=0?Q:Li(Q)}return C}throw new Error("can't deserialize object of type "+typeof p)}class Gl{constructor(){this.first=!0}update(u,g){const C=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=g):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=g),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=C,!0))}}const Ei={"Latin-1 Supplement":p=>p>=128&&p<=255,Arabic:p=>p>=1536&&p<=1791,"Arabic Supplement":p=>p>=1872&&p<=1919,"Arabic Extended-A":p=>p>=2208&&p<=2303,"Hangul Jamo":p=>p>=4352&&p<=4607,"Unified Canadian Aboriginal Syllabics":p=>p>=5120&&p<=5759,Khmer:p=>p>=6016&&p<=6143,"Unified Canadian Aboriginal Syllabics Extended":p=>p>=6320&&p<=6399,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"CJK Radicals Supplement":p=>p>=11904&&p<=12031,"Kangxi Radicals":p=>p>=12032&&p<=12255,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Hiragana:p=>p>=12352&&p<=12447,Katakana:p=>p>=12448&&p<=12543,Bopomofo:p=>p>=12544&&p<=12591,"Hangul Compatibility Jamo":p=>p>=12592&&p<=12687,Kanbun:p=>p>=12688&&p<=12703,"Bopomofo Extended":p=>p>=12704&&p<=12735,"CJK Strokes":p=>p>=12736&&p<=12783,"Katakana Phonetic Extensions":p=>p>=12784&&p<=12799,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"CJK Unified Ideographs Extension A":p=>p>=13312&&p<=19903,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"CJK Unified Ideographs":p=>p>=19968&&p<=40959,"Yi Syllables":p=>p>=40960&&p<=42127,"Yi Radicals":p=>p>=42128&&p<=42191,"Hangul Jamo Extended-A":p=>p>=43360&&p<=43391,"Hangul Syllables":p=>p>=44032&&p<=55215,"Hangul Jamo Extended-B":p=>p>=55216&&p<=55295,"Private Use Area":p=>p>=57344&&p<=63743,"CJK Compatibility Ideographs":p=>p>=63744&&p<=64255,"Arabic Presentation Forms-A":p=>p>=64336&&p<=65023,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Arabic Presentation Forms-B":p=>p>=65136&&p<=65279,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function no(p){for(const u of p)if(jl(u.charCodeAt(0)))return!0;return!1}function mo(p){for(const u of p)if(!Mc(u.charCodeAt(0)))return!1;return!0}function Mc(p){return!(Ei.Arabic(p)||Ei["Arabic Supplement"](p)||Ei["Arabic Extended-A"](p)||Ei["Arabic Presentation Forms-A"](p)||Ei["Arabic Presentation Forms-B"](p))}function jl(p){return!(p!==746&&p!==747&&(p<4352||!(Ei["Bopomofo Extended"](p)||Ei.Bopomofo(p)||Ei["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||Ei["CJK Compatibility Ideographs"](p)||Ei["CJK Compatibility"](p)||Ei["CJK Radicals Supplement"](p)||Ei["CJK Strokes"](p)||!(!Ei["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||Ei["CJK Unified Ideographs Extension A"](p)||Ei["CJK Unified Ideographs"](p)||Ei["Enclosed CJK Letters and Months"](p)||Ei["Hangul Compatibility Jamo"](p)||Ei["Hangul Jamo Extended-A"](p)||Ei["Hangul Jamo Extended-B"](p)||Ei["Hangul Jamo"](p)||Ei["Hangul Syllables"](p)||Ei.Hiragana(p)||Ei["Ideographic Description Characters"](p)||Ei.Kanbun(p)||Ei["Kangxi Radicals"](p)||Ei["Katakana Phonetic Extensions"](p)||Ei.Katakana(p)&&p!==12540||!(!Ei["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!Ei["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||Ei["Unified Canadian Aboriginal Syllabics"](p)||Ei["Unified Canadian Aboriginal Syllabics Extended"](p)||Ei["Vertical Forms"](p)||Ei["Yijing Hexagram Symbols"](p)||Ei["Yi Syllables"](p)||Ei["Yi Radicals"](p))))}function Pc(p){return!(jl(p)||function(u){return!!(Ei["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Ei["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Ei["Letterlike Symbols"](u)||Ei["Number Forms"](u)||Ei["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Ei["Control Pictures"](u)&&u!==9251||Ei["Optical Character Recognition"](u)||Ei["Enclosed Alphanumerics"](u)||Ei["Geometric Shapes"](u)||Ei["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Ei["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Ei["CJK Symbols and Punctuation"](u)||Ei.Katakana(u)||Ei["Private Use Area"](u)||Ei["CJK Compatibility Forms"](u)||Ei["Small Form Variants"](u)||Ei["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(p))}function Fc(p){return p>=1424&&p<=2303||Ei["Arabic Presentation Forms-A"](p)||Ei["Arabic Presentation Forms-B"](p)}function Dc(p,u){return!(!u&&Fc(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||Ei.Khmer(p))}function Rc(p){for(const u of p)if(Fc(u.charCodeAt(0)))return!0;return!1}const Za=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(p){this.pluginStatus=p.pluginStatus,this.pluginURL=p.pluginURL}setMethods(p){this.applyArabicShaping=p.applyArabicShaping,this.processBidirectionalText=p.processBidirectionalText,this.processStyledBidirectionalText=p.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class yn{constructor(u,g){this.zoom=u,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.zoomHistory=g.zoomHistory,this.transition=g.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gl,this.transition={})}isSupportedScript(u){return function(g,C){for(const P of g)if(!Dc(P.charCodeAt(0),C))return!1;return!0}(u,Za.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,g=u-Math.floor(u),C=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:g+(1-g)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*g}}}class Bs{constructor(u,g){this.property=u,this.value=g,this.expression=function(C,P){if(pi(C))return new Ta(C,P);if(Lr(C)){const Q=Lo(C,P);if(Q.result==="error")throw new Error(Q.value.map(V=>`${V.key}: ${V.message}`).join(", "));return Q.value}{let Q=C;return P.type==="color"&&typeof C=="string"?Q=ur.parse(C):P.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?P.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(Q=Qr.parse(C)):Q=Rn.parse(C),{kind:"constant",evaluate:()=>Q}}}(g===void 0?u.specification.default:g,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,g,C){return this.property.possiblyEvaluate(this,u,g,C)}}class Do{constructor(u){this.property=u,this.value=new Bs(u,void 0)}transitioned(u,g){return new Mu(this.property,this.value,g,$e({},u.transition,this.transition),u.now)}untransitioned(){return new Mu(this.property,this.value,null,{},0)}}class ql{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return De(this._values[u].value.value)}setValue(u,g){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Do(this._values[u].property)),this._values[u].value=new Bs(this._values[u].property,g===null?void 0:De(g))}getTransition(u){return De(this._values[u].transition)}setTransition(u,g){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Do(this._values[u].property)),this._values[u].transition=De(g)||void 0}serialize(){const u={};for(const g of Object.keys(this._values)){const C=this.getValue(g);C!==void 0&&(u[g]=C);const P=this.getTransition(g);P!==void 0&&(u[`${g}-transition`]=P)}return u}transitioned(u,g){const C=new Ac(this._properties);for(const P of Object.keys(this._values))C._values[P]=this._values[P].transitioned(u,g._values[P]);return C}untransitioned(){const u=new Ac(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].untransitioned();return u}}class Mu{constructor(u,g,C,P,Q){this.property=u,this.value=g,this.begin=Q+P.delay||0,this.end=this.begin+P.duration||0,u.specification.transition&&(P.delay||P.duration)&&(this.prior=C)}possiblyEvaluate(u,g,C){const P=u.now||0,Q=this.value.possiblyEvaluate(u,g,C),V=this.prior;if(V){if(P>this.end)return this.prior=null,Q;if(this.value.isDataDriven())return this.prior=null,Q;if(P<this.begin)return V.possiblyEvaluate(u,g,C);{const K=(P-this.begin)/(this.end-this.begin);return this.property.interpolate(V.possiblyEvaluate(u,g,C),Q,function(te){if(te<=0)return 0;if(te>=1)return 1;const he=te*te,h=he*te;return 4*(te<.5?h:3*(te-he)+h-.75)}(K))}}return Q}}class Ac{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,g,C){const P=new $s(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,g,C);return P}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class su{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return De(this._values[u].value)}setValue(u,g){this._values[u]=new Bs(this._values[u].property,g===null?void 0:De(g))}serialize(){const u={};for(const g of Object.keys(this._values)){const C=this.getValue(g);C!==void 0&&(u[g]=C)}return u}possiblyEvaluate(u,g,C){const P=new $s(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,g,C);return P}}class _a{constructor(u,g,C){this.property=u,this.value=g,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,g,C,P){return this.property.evaluate(this.value,this.parameters,u,g,C,P)}}class $s{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class bi{constructor(u){this.specification=u}possiblyEvaluate(u,g){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(g)}interpolate(u,g,C){const P=dn[this.specification.type];return P?P(u,g,C):u}}class sr{constructor(u,g){this.specification=u,this.overrides=g}possiblyEvaluate(u,g,C,P){return new _a(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(g,null,{},C,P)}:u.expression,g)}interpolate(u,g,C){if(u.value.kind!=="constant"||g.value.kind!=="constant")return u;if(u.value.value===void 0||g.value.value===void 0)return new _a(this,{kind:"constant",value:void 0},u.parameters);const P=dn[this.specification.type];if(P){const Q=P(u.value.value,g.value.value,C);return new _a(this,{kind:"constant",value:Q},u.parameters)}return u}evaluate(u,g,C,P,Q,V){return u.kind==="constant"?u.value:u.evaluate(g,C,P,Q,V)}}class $l extends sr{possiblyEvaluate(u,g,C,P){if(u.value===void 0)return new _a(this,{kind:"constant",value:void 0},g);if(u.expression.kind==="constant"){const Q=u.expression.evaluate(g,null,{},C,P),V=u.property.specification.type==="resolvedImage"&&typeof Q!="string"?Q.name:Q,K=this._calculate(V,V,V,g);return new _a(this,{kind:"constant",value:K},g)}if(u.expression.kind==="camera"){const Q=this._calculate(u.expression.evaluate({zoom:g.zoom-1}),u.expression.evaluate({zoom:g.zoom}),u.expression.evaluate({zoom:g.zoom+1}),g);return new _a(this,{kind:"constant",value:Q},g)}return new _a(this,u.expression,g)}evaluate(u,g,C,P,Q,V){if(u.kind==="source"){const K=u.evaluate(g,C,P,Q,V);return this._calculate(K,K,K,g)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(g.zoom)-1},C,P),u.evaluate({zoom:Math.floor(g.zoom)},C,P),u.evaluate({zoom:Math.floor(g.zoom)+1},C,P),g):u.value}_calculate(u,g,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:g}:{from:C,to:g}}interpolate(u){return u}}class kc{constructor(u){this.specification=u}possiblyEvaluate(u,g,C,P){if(u.value!==void 0){if(u.expression.kind==="constant"){const Q=u.expression.evaluate(g,null,{},C,P);return this._calculate(Q,Q,Q,g)}return this._calculate(u.expression.evaluate(new yn(Math.floor(g.zoom-1),g)),u.expression.evaluate(new yn(Math.floor(g.zoom),g)),u.expression.evaluate(new yn(Math.floor(g.zoom+1),g)),g)}}_calculate(u,g,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:g}:{from:C,to:g}}interpolate(u){return u}}class Oc{constructor(u){this.specification=u}possiblyEvaluate(u,g,C,P){return!!u.expression.evaluate(g,null,{},C,P)}interpolate(){return!1}}class Cs{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const g in u){const C=u[g];C.specification.overridable&&this.overridableProperties.push(g);const P=this.defaultPropertyValues[g]=new Bs(C,void 0),Q=this.defaultTransitionablePropertyValues[g]=new Do(C);this.defaultTransitioningPropertyValues[g]=Q.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=P.possiblyEvaluate({})}}}Pi("DataDrivenProperty",sr),Pi("DataConstantProperty",bi),Pi("CrossFadedDataDrivenProperty",$l),Pi("CrossFadedProperty",kc),Pi("ColorRampProperty",Oc);const dh="-transition";class jn extends ot{constructor(u,g){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),g.layout&&(this._unevaluatedLayout=new su(g.layout)),g.paint)){this._transitionablePaint=new ql(g.paint);for(const C in u.paint)this.setPaintProperty(C,u.paint[C],{validate:!1});for(const C in u.layout)this.setLayoutProperty(C,u.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $s(g.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};g!=null&&this._validate(go,`layers.${this.id}.layout.${u}`,u,g,C)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,g):this.visibility=g)}getPaintProperty(u){return u.endsWith(dh)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(g!=null&&this._validate(Fa,`layers.${this.id}.paint.${u}`,u,g,C))return!1;if(u.endsWith(dh))return this._transitionablePaint.setTransition(u.slice(0,-11),g||void 0),!1;{const P=this._transitionablePaint._values[u],Q=P.property.specification["property-type"]==="cross-faded-data-driven",V=P.value.isDataDriven(),K=P.value;this._transitionablePaint.setValue(u,g),this._handleSpecialPaintPropertyUpdate(u);const te=this._transitionablePaint._values[u].value;return te.isDataDriven()||V||Q||this._handleOverridablePaintPropertyUpdate(u,K,te)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,g,C){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,g){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,g)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),nt(u,(g,C)=>!(g===void 0||C==="layout"&&!Object.keys(g).length||C==="paint"&&!Object.keys(g).length))}_validate(u,g,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!Q||Q.validate!==!1)&&Zo(this,u.call(Gn,{key:g,layerType:this.type,objectKey:C,value:P,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const g=this.paint.get(u);if(g instanceof _a&&at(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1}}const ou={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $i{constructor(u,g){this._structArray=u,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ni{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,g){return u._trim(),g&&(u.isTransferred=!0,g.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const g=Object.create(this.prototype);return g.arrayBuffer=u.arrayBuffer,g.length=u.length,g.capacity=u.arrayBuffer.byteLength/g.bytesPerElement,g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qn(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,g=0,C=0;return{members:p.map(P=>{const Q=ou[P.type].BYTES_PER_ELEMENT,V=g=Pu(g,Math.max(u,Q)),K=P.components||1;return C=Math.max(C,Q),g+=Q*K,{name:P.name,type:P.type,components:K,offset:V}}),size:Pu(g,Math.max(C,u)),alignment:u}}function Pu(p,u){return Math.ceil(p/u)*u}class Ds extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g){const C=this.length;return this.resize(C+1),this.emplace(C,u,g)}emplace(u,g,C){const P=2*u;return this.int16[P+0]=g,this.int16[P+1]=C,u}}Ds.prototype.bytesPerElement=4,Pi("StructArrayLayout2i4",Ds);class tn extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,g,C)}emplace(u,g,C,P){const Q=3*u;return this.int16[Q+0]=g,this.int16[Q+1]=C,this.int16[Q+2]=P,u}}tn.prototype.bytesPerElement=6,Pi("StructArrayLayout3i6",tn);class Yo extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,g,C,P)}emplace(u,g,C,P,Q){const V=4*u;return this.int16[V+0]=g,this.int16[V+1]=C,this.int16[V+2]=P,this.int16[V+3]=Q,u}}Yo.prototype.bytesPerElement=8,Pi("StructArrayLayout4i8",Yo);class Ro extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,g,C,P,Q,V)}emplace(u,g,C,P,Q,V,K){const te=6*u;return this.int16[te+0]=g,this.int16[te+1]=C,this.int16[te+2]=P,this.int16[te+3]=Q,this.int16[te+4]=V,this.int16[te+5]=K,u}}Ro.prototype.bytesPerElement=12,Pi("StructArrayLayout2i4i12",Ro);class au extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,g,C,P,Q,V)}emplace(u,g,C,P,Q,V,K){const te=4*u,he=8*u;return this.int16[te+0]=g,this.int16[te+1]=C,this.uint8[he+4]=P,this.uint8[he+5]=Q,this.uint8[he+6]=V,this.uint8[he+7]=K,u}}au.prototype.bytesPerElement=8,Pi("StructArrayLayout2i4ub8",au);class Rs extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g){const C=this.length;return this.resize(C+1),this.emplace(C,u,g)}emplace(u,g,C){const P=2*u;return this.float32[P+0]=g,this.float32[P+1]=C,u}}Rs.prototype.bytesPerElement=8,Pi("StructArrayLayout2f8",Rs);class Jr extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V,K,te,he,h){const l=this.length;return this.resize(l+1),this.emplace(l,u,g,C,P,Q,V,K,te,he,h)}emplace(u,g,C,P,Q,V,K,te,he,h,l){const f=10*u;return this.uint16[f+0]=g,this.uint16[f+1]=C,this.uint16[f+2]=P,this.uint16[f+3]=Q,this.uint16[f+4]=V,this.uint16[f+5]=K,this.uint16[f+6]=te,this.uint16[f+7]=he,this.uint16[f+8]=h,this.uint16[f+9]=l,u}}Jr.prototype.bytesPerElement=20,Pi("StructArrayLayout10ui20",Jr);class Un extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V,K,te,he,h,l,f){const v=this.length;return this.resize(v+1),this.emplace(v,u,g,C,P,Q,V,K,te,he,h,l,f)}emplace(u,g,C,P,Q,V,K,te,he,h,l,f,v){const E=12*u;return this.int16[E+0]=g,this.int16[E+1]=C,this.int16[E+2]=P,this.int16[E+3]=Q,this.uint16[E+4]=V,this.uint16[E+5]=K,this.uint16[E+6]=te,this.uint16[E+7]=he,this.int16[E+8]=h,this.int16[E+9]=l,this.int16[E+10]=f,this.int16[E+11]=v,u}}Un.prototype.bytesPerElement=24,Pi("StructArrayLayout4i4ui4i24",Un);class ko extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,g,C)}emplace(u,g,C,P){const Q=3*u;return this.float32[Q+0]=g,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}ko.prototype.bytesPerElement=12,Pi("StructArrayLayout3f12",ko);class Al extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const g=this.length;return this.resize(g+1),this.emplace(g,u)}emplace(u,g){return this.uint32[1*u+0]=g,u}}Al.prototype.bytesPerElement=4,Pi("StructArrayLayout1ul4",Al);class Ja extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V,K,te,he){const h=this.length;return this.resize(h+1),this.emplace(h,u,g,C,P,Q,V,K,te,he)}emplace(u,g,C,P,Q,V,K,te,he,h){const l=10*u,f=5*u;return this.int16[l+0]=g,this.int16[l+1]=C,this.int16[l+2]=P,this.int16[l+3]=Q,this.int16[l+4]=V,this.int16[l+5]=K,this.uint32[f+3]=te,this.uint16[l+8]=he,this.uint16[l+9]=h,u}}Ja.prototype.bytesPerElement=20,Pi("StructArrayLayout6i1ul2ui20",Ja);class Da extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,g,C,P,Q,V)}emplace(u,g,C,P,Q,V,K){const te=6*u;return this.int16[te+0]=g,this.int16[te+1]=C,this.int16[te+2]=P,this.int16[te+3]=Q,this.int16[te+4]=V,this.int16[te+5]=K,u}}Da.prototype.bytesPerElement=12,Pi("StructArrayLayout2i2i2i12",Da);class Kl extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q){const V=this.length;return this.resize(V+1),this.emplace(V,u,g,C,P,Q)}emplace(u,g,C,P,Q,V){const K=4*u,te=8*u;return this.float32[K+0]=g,this.float32[K+1]=C,this.float32[K+2]=P,this.int16[te+6]=Q,this.int16[te+7]=V,u}}Kl.prototype.bytesPerElement=16,Pi("StructArrayLayout2f1f2i16",Kl);class lu extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,g,C,P)}emplace(u,g,C,P,Q){const V=12*u,K=3*u;return this.uint8[V+0]=g,this.uint8[V+1]=C,this.float32[K+1]=P,this.float32[K+2]=Q,u}}lu.prototype.bytesPerElement=12,Pi("StructArrayLayout2ub2f12",lu);class yo extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,g,C)}emplace(u,g,C,P){const Q=3*u;return this.uint16[Q+0]=g,this.uint16[Q+1]=C,this.uint16[Q+2]=P,u}}yo.prototype.bytesPerElement=6,Pi("StructArrayLayout3ui6",yo);class va extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G){const $=this.length;return this.resize($+1),this.emplace($,u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G)}emplace(u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G,$){const X=24*u,se=12*u,Ae=48*u;return this.int16[X+0]=g,this.int16[X+1]=C,this.uint16[X+2]=P,this.uint16[X+3]=Q,this.uint32[se+2]=V,this.uint32[se+3]=K,this.uint32[se+4]=te,this.uint16[X+10]=he,this.uint16[X+11]=h,this.uint16[X+12]=l,this.float32[se+7]=f,this.float32[se+8]=v,this.uint8[Ae+36]=E,this.uint8[Ae+37]=M,this.uint8[Ae+38]=D,this.uint32[se+10]=G,this.int16[X+22]=$,u}}va.prototype.bytesPerElement=48,Pi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",va);class dl extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct)}emplace(u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct,Ye){const tt=32*u,gt=16*u;return this.int16[tt+0]=g,this.int16[tt+1]=C,this.int16[tt+2]=P,this.int16[tt+3]=Q,this.int16[tt+4]=V,this.int16[tt+5]=K,this.int16[tt+6]=te,this.int16[tt+7]=he,this.uint16[tt+8]=h,this.uint16[tt+9]=l,this.uint16[tt+10]=f,this.uint16[tt+11]=v,this.uint16[tt+12]=E,this.uint16[tt+13]=M,this.uint16[tt+14]=D,this.uint16[tt+15]=G,this.uint16[tt+16]=$,this.uint16[tt+17]=X,this.uint16[tt+18]=se,this.uint16[tt+19]=Ae,this.uint16[tt+20]=me,this.uint16[tt+21]=Be,this.uint16[tt+22]=Se,this.uint32[gt+12]=ke,this.float32[gt+13]=He,this.float32[gt+14]=qe,this.uint16[tt+30]=ct,this.uint16[tt+31]=Ye,u}}dl.prototype.bytesPerElement=64,Pi("StructArrayLayout8i15ui1ul2f2ui64",dl);class Gr extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const g=this.length;return this.resize(g+1),this.emplace(g,u)}emplace(u,g){return this.float32[1*u+0]=g,u}}Gr.prototype.bytesPerElement=4,Pi("StructArrayLayout1f4",Gr);class N extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,g,C)}emplace(u,g,C,P){const Q=3*u;return this.uint16[6*u+0]=g,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}N.prototype.bytesPerElement=12,Pi("StructArrayLayout1ui2f12",N);class A extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,g,C)}emplace(u,g,C,P){const Q=4*u;return this.uint32[2*u+0]=g,this.uint16[Q+2]=C,this.uint16[Q+3]=P,u}}A.prototype.bytesPerElement=8,Pi("StructArrayLayout1ul2ui8",A);class b extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,g){const C=this.length;return this.resize(C+1),this.emplace(C,u,g)}emplace(u,g,C){const P=2*u;return this.uint16[P+0]=g,this.uint16[P+1]=C,u}}b.prototype.bytesPerElement=4,Pi("StructArrayLayout2ui4",b);class L extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const g=this.length;return this.resize(g+1),this.emplace(g,u)}emplace(u,g){return this.uint16[1*u+0]=g,u}}L.prototype.bytesPerElement=2,Pi("StructArrayLayout1ui2",L);class k extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,g,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,g,C,P)}emplace(u,g,C,P,Q){const V=4*u;return this.float32[V+0]=g,this.float32[V+1]=C,this.float32[V+2]=P,this.float32[V+3]=Q,u}}k.prototype.bytesPerElement=16,Pi("StructArrayLayout4f16",k);class y extends $i{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class a extends Ja{get(u){return new y(this,u)}}Pi("CollisionBoxArray",a);class d extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}d.prototype.size=48;class _ extends va{get(u){return new d(this,u)}}Pi("PlacedSymbolArray",_);class B extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}B.prototype.size=64;class S extends dl{get(u){return new B(this,u)}}Pi("SymbolInstanceArray",S);class U extends Gr{getoffsetX(u){return this.float32[1*u+0]}}Pi("GlyphOffsetArray",U);class H extends tn{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}Pi("SymbolLineVertexArray",H);class q extends $i{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}q.prototype.size=12;class w extends N{get(u){return new q(this,u)}}Pi("TextAnchorOffsetArray",w);class T extends $i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}T.prototype.size=8;class R extends A{get(u){return new T(this,u)}}Pi("FeatureIndexArray",R);class j extends Ds{}class Z extends Ds{}class W extends Ds{}class J extends Ro{}class ee extends au{}class ae extends Rs{}class fe extends Jr{}class pe extends Un{}class xe extends ko{}class Pe extends Al{}class Le extends Da{}class rt extends lu{}class Ke extends yo{}class Re extends b{}const Qe=qn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=Qe;class bt{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=u}prepareSegment(u,g,C,P){let Q=this.segments[this.segments.length-1];return u>bt.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Q||Q.vertexLength+u>bt.MAX_VERTEX_ARRAY_LENGTH||Q.sortKey!==P)&&(Q={vertexOffset:g.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},P!==void 0&&(Q.sortKey=P),this.segments.push(Q)),Q}get(){return this.segments}destroy(){for(const u of this.segments)for(const g in u.vaos)u.vaos[g].destroy()}static simpleSegment(u,g,C,P){return new bt([{vertexOffset:u,primitiveOffset:g,vertexLength:C,primitiveLength:P,vaos:{},sortKey:0}])}}function ht(p,u){return 256*(p=je(Math.floor(p),0,255))+je(Math.floor(u),0,255)}bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pi("SegmentVector",bt);const Rt=qn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dt={exports:{}},hi={exports:{}};hi.exports=function(p,u){var g,C,P,Q,V,K,te,he;for(C=p.length-(g=3&p.length),P=u,V=3432918353,K=461845907,he=0;he<C;)te=255&p.charCodeAt(he)|(255&p.charCodeAt(++he))<<8|(255&p.charCodeAt(++he))<<16|(255&p.charCodeAt(++he))<<24,++he,P=27492+(65535&(Q=5*(65535&(P=(P^=te=(65535&(te=(te=(65535&te)*V+(((te>>>16)*V&65535)<<16)&4294967295)<<15|te>>>17))*K+(((te>>>16)*K&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(te=0,g){case 3:te^=(255&p.charCodeAt(he+2))<<16;case 2:te^=(255&p.charCodeAt(he+1))<<8;case 1:P^=te=(65535&(te=(te=(65535&(te^=255&p.charCodeAt(he)))*V+(((te>>>16)*V&65535)<<16)&4294967295)<<15|te>>>17))*K+(((te>>>16)*K&65535)<<16)&4294967295}return P^=p.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0};var Vt=hi.exports,_i={exports:{}};_i.exports=function(p,u){for(var g,C=p.length,P=u^C,Q=0;C>=4;)g=1540483477*(65535&(g=255&p.charCodeAt(Q)|(255&p.charCodeAt(++Q))<<8|(255&p.charCodeAt(++Q))<<16|(255&p.charCodeAt(++Q))<<24))+((1540483477*(g>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),C-=4,++Q;switch(C){case 3:P^=(255&p.charCodeAt(Q+2))<<16;case 2:P^=(255&p.charCodeAt(Q+1))<<8;case 1:P=1540483477*(65535&(P^=255&p.charCodeAt(Q)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0};var Si=Vt,Yi=_i.exports;Dt.exports=Si,Dt.exports.murmur3=Si,Dt.exports.murmur2=Yi;var Ti=m(Dt.exports);class yr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,g,C,P){this.ids.push(fr(u)),this.positions.push(g,C,P)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const g=fr(u);let C=0,P=this.ids.length-1;for(;C<P;){const V=C+P>>1;this.ids[V]>=g?P=V:C=V+1}const Q=[];for(;this.ids[C]===g;)Q.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return Q}static serialize(u,g){const C=new Float64Array(u.ids),P=new Uint32Array(u.positions);return ji(C,P,0,C.length-1),g&&g.push(C.buffer,P.buffer),{ids:C,positions:P}}static deserialize(u){const g=new yr;return g.ids=u.ids,g.positions=u.positions,g.indexed=!0,g}}function fr(p){const u=+p;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:Ti(String(p))}function ji(p,u,g,C){for(;g<C;){const P=p[g+C>>1];let Q=g-1,V=C+1;for(;;){do Q++;while(p[Q]<P);do V--;while(p[V]>P);if(Q>=V)break;Ur(p,Q,V),Ur(u,3*Q,3*V),Ur(u,3*Q+1,3*V+1),Ur(u,3*Q+2,3*V+2)}V-g<C-V?(ji(p,u,g,V),g=V+1):(ji(p,u,V+1,C),C=V)}}function Ur(p,u,g){const C=p[u];p[u]=p[g],p[g]=C}Pi("FeaturePositionMap",yr);class rn{constructor(u,g){this.gl=u.gl,this.location=g}}class Mr extends rn{constructor(u,g){super(u,g),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Kr extends rn{constructor(u,g){super(u,g),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class Cr extends rn{constructor(u,g){super(u,g),this.current=ur.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const es=new Float32Array(16);function Nr(p){return[ht(255*p.r,255*p.g),ht(255*p.b,255*p.a)]}class pr{constructor(u,g,C){this.value=u,this.uniformNames=g.map(P=>`u_${P}`),this.type=C}setUniform(u,g,C){u.set(C.constantOr(this.value))}getBinding(u,g,C){return this.type==="color"?new Cr(u,g):new Mr(u,g)}}class _r{constructor(u,g){this.uniformNames=g.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,g){this.pixelRatioFrom=g.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=g.tlbr,this.patternTo=u.tlbr}setUniform(u,g,C,P){const Q=P==="u_pattern_to"?this.patternTo:P==="u_pattern_from"?this.patternFrom:P==="u_pixel_ratio_to"?this.pixelRatioTo:P==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Q&&u.set(Q)}getBinding(u,g,C){return C.substr(0,9)==="u_pattern"?new Kr(u,g):new Mr(u,g)}}class or{constructor(u,g,C,P){this.expression=u,this.type=C,this.maxValue=0,this.paintVertexAttributes=g.map(Q=>({name:`a_${Q}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new P}populatePaintArray(u,g,C,P,Q){const V=this.paintVertexArray.length,K=this.expression.evaluate(new yn(0),g,{},P,[],Q);this.paintVertexArray.resize(u),this._setPaintValue(V,u,K)}updatePaintArray(u,g,C,P){const Q=this.expression.evaluate({zoom:0},C,P);this._setPaintValue(u,g,Q)}_setPaintValue(u,g,C){if(this.type==="color"){const P=Nr(C);for(let Q=u;Q<g;Q++)this.paintVertexArray.emplace(Q,P[0],P[1])}else{for(let P=u;P<g;P++)this.paintVertexArray.emplace(P,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ln{constructor(u,g,C,P,Q,V){this.expression=u,this.uniformNames=g.map(K=>`u_${K}_t`),this.type=C,this.useIntegerZoom=P,this.zoom=Q,this.maxValue=0,this.paintVertexAttributes=g.map(K=>({name:`a_${K}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new V}populatePaintArray(u,g,C,P,Q){const V=this.expression.evaluate(new yn(this.zoom),g,{},P,[],Q),K=this.expression.evaluate(new yn(this.zoom+1),g,{},P,[],Q),te=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(te,u,V,K)}updatePaintArray(u,g,C,P){const Q=this.expression.evaluate({zoom:this.zoom},C,P),V=this.expression.evaluate({zoom:this.zoom+1},C,P);this._setPaintValue(u,g,Q,V)}_setPaintValue(u,g,C,P){if(this.type==="color"){const Q=Nr(C),V=Nr(P);for(let K=u;K<g;K++)this.paintVertexArray.emplace(K,Q[0],Q[1],V[0],V[1])}else{for(let Q=u;Q<g;Q++)this.paintVertexArray.emplace(Q,C,P);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(P))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,g){const C=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,P=je(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);u.set(P)}getBinding(u,g,C){return new Mr(u,g)}}class qr{constructor(u,g,C,P,Q,V){this.expression=u,this.type=g,this.useIntegerZoom=C,this.zoom=P,this.layerId=V,this.zoomInPaintVertexArray=new Q,this.zoomOutPaintVertexArray=new Q}populatePaintArray(u,g,C){const P=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(P,u,g.patterns&&g.patterns[this.layerId],C)}updatePaintArray(u,g,C,P,Q){this._setPaintValues(u,g,C.patterns&&C.patterns[this.layerId],Q)}_setPaintValues(u,g,C,P){if(!P||!C)return;const{min:Q,mid:V,max:K}=C,te=P[Q],he=P[V],h=P[K];if(te&&he&&h)for(let l=u;l<g;l++)this.zoomInPaintVertexArray.emplace(l,he.tl[0],he.tl[1],he.br[0],he.br[1],te.tl[0],te.tl[1],te.br[0],te.br[1],he.pixelRatio,te.pixelRatio),this.zoomOutPaintVertexArray.emplace(l,he.tl[0],he.tl[1],he.br[0],he.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],he.pixelRatio,h.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Rt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Rt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wr{constructor(u,g,C){this.binders={},this._buffers=[];const P=[];for(const Q in u.paint._values){if(!C(Q))continue;const V=u.paint.get(Q);if(!(V instanceof _a&&at(V.property.specification)))continue;const K=$n(Q,u.type),te=V.value,he=V.property.specification.type,h=V.property.useIntegerZoom,l=V.property.specification["property-type"],f=l==="cross-faded"||l==="cross-faded-data-driven";if(te.kind==="constant")this.binders[Q]=f?new _r(te.value,K):new pr(te.value,K,he),P.push(`/u_${Q}`);else if(te.kind==="source"||f){const v=fl(Q,he,"source");this.binders[Q]=f?new qr(te,he,h,g,v,u.id):new or(te,K,he,v),P.push(`/a_${Q}`)}else{const v=fl(Q,he,"composite");this.binders[Q]=new ln(te,K,he,h,g,v),P.push(`/z_${Q}`)}}this.cacheKey=P.sort().join("")}getMaxValue(u){const g=this.binders[u];return g instanceof or||g instanceof ln?g.maxValue:0}populatePaintArrays(u,g,C,P,Q){for(const V in this.binders){const K=this.binders[V];(K instanceof or||K instanceof ln||K instanceof qr)&&K.populatePaintArray(u,g,C,P,Q)}}setConstantPatternPositions(u,g){for(const C in this.binders){const P=this.binders[C];P instanceof _r&&P.setConstantPatternPositions(u,g)}}updatePaintArrays(u,g,C,P,Q){let V=!1;for(const K in u){const te=g.getPositions(K);for(const he of te){const h=C.feature(he.index);for(const l in this.binders){const f=this.binders[l];if((f instanceof or||f instanceof ln||f instanceof qr)&&f.expression.isStateDependent===!0){const v=P.paint.get(l);f.expression=v.value,f.updatePaintArray(he.start,he.end,h,u[K],Q),V=!0}}}}return V}defines(){const u=[];for(const g in this.binders){const C=this.binders[g];(C instanceof pr||C instanceof _r)&&u.push(...C.uniformNames.map(P=>`#define HAS_UNIFORM_${P}`))}return u}getBinderAttributes(){const u=[];for(const g in this.binders){const C=this.binders[g];if(C instanceof or||C instanceof ln)for(let P=0;P<C.paintVertexAttributes.length;P++)u.push(C.paintVertexAttributes[P].name);else if(C instanceof qr)for(let P=0;P<Rt.members.length;P++)u.push(Rt.members[P].name)}return u}getBinderUniforms(){const u=[];for(const g in this.binders){const C=this.binders[g];if(C instanceof pr||C instanceof _r||C instanceof ln)for(const P of C.uniformNames)u.push(P)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,g){const C=[];for(const P in this.binders){const Q=this.binders[P];if(Q instanceof pr||Q instanceof _r||Q instanceof ln){for(const V of Q.uniformNames)if(g[V]){const K=Q.getBinding(u,g[V],V);C.push({name:V,property:P,binding:K})}}}return C}setUniforms(u,g,C,P){for(const{name:Q,property:V,binding:K}of g)this.binders[V].setUniform(K,P,C.get(V),Q)}updatePaintBuffers(u){this._buffers=[];for(const g in this.binders){const C=this.binders[g];if(u&&C instanceof qr){const P=u.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;P&&this._buffers.push(P)}else(C instanceof or||C instanceof ln)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(u){for(const g in this.binders){const C=this.binders[g];(C instanceof or||C instanceof ln||C instanceof qr)&&C.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const g=this.binders[u];(g instanceof or||g instanceof ln||g instanceof qr)&&g.destroy()}}}class Mn{constructor(u,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const P of u)this.programConfigurations[P.id]=new Wr(P,g,C);this.needsUpload=!1,this._featureMap=new yr,this._bufferOffset=0}populatePaintArrays(u,g,C,P,Q,V){for(const K in this.programConfigurations)this.programConfigurations[K].populatePaintArrays(u,g,P,Q,V);g.id!==void 0&&this._featureMap.add(g.id,C,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,g,C,P){for(const Q of C)this.needsUpload=this.programConfigurations[Q.id].updatePaintArrays(u,this._featureMap,g,Q,P)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function $n(p,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${u}-`,"").replace(/-/g,"_")]}function fl(p,u,g){const C={color:{source:Rs,composite:k},number:{source:Gr,composite:Rs}},P=function(Q){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[Q]}(p);return P&&P[g]||C[u][g]}Pi("ConstantBinder",pr),Pi("CrossFadedConstantBinder",_r),Pi("SourceExpressionBinder",or),Pi("CrossFadedCompositeBinder",qr),Pi("CompositeExpressionBinder",ln),Pi("ProgramConfiguration",Wr,{omit:["_buffers"]}),Pi("ProgramConfigurationSet",Mn);const $r=8192,_n=Math.pow(2,14)-1,ea=-_n-1;function ks(p){const u=$r/p.extent,g=p.loadGeometry();for(let C=0;C<g.length;C++){const P=g[C];for(let Q=0;Q<P.length;Q++){const V=P[Q],K=Math.round(V.x*u),te=Math.round(V.y*u);V.x=je(K,ea,_n),V.y=je(te,ea,_n),(K<V.x||K>V.x+1||te<V.y||te>V.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return g}function Ks(p,u){return{type:p.type,id:p.id,properties:p.properties,geometry:u?ks(p):[]}}function Oo(p,u,g,C,P){p.emplaceBack(2*u+(C+1)/2,2*g+(P+1)/2)}class so{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(g=>g.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.indexArray=new Ke,this.segments=new bt,this.programConfigurations=new Mn(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(u,g,C){const P=this.layers[0],Q=[];let V=null,K=!1;P.type==="circle"&&(V=P.layout.get("circle-sort-key"),K=!V.isConstant());for(const{feature:te,id:he,index:h,sourceLayerIndex:l}of u){const f=this.layers[0]._featureFilter.needGeometry,v=Ks(te,f);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),v,C))continue;const E=K?V.evaluate(v,{},C):void 0,M={id:he,properties:te.properties,type:te.type,sourceLayerIndex:l,index:h,geometry:f?v.geometry:ks(te),patterns:{},sortKey:E};Q.push(M)}K&&Q.sort((te,he)=>te.sortKey-he.sortKey);for(const te of Q){const{geometry:he,index:h,sourceLayerIndex:l}=te,f=u[h].feature;this.addFeature(te,he,h,C),g.featureIndex.insert(f,he,h,l,this.index)}}update(u,g,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,g,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,g,C,P){for(const Q of g)for(const V of Q){const K=V.x,te=V.y;if(K<0||K>=$r||te<0||te>=$r)continue;const he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),h=he.vertexLength;Oo(this.layoutVertexArray,K,te,-1,-1),Oo(this.layoutVertexArray,K,te,1,-1),Oo(this.layoutVertexArray,K,te,1,1),Oo(this.layoutVertexArray,K,te,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),he.vertexLength+=4,he.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,{},P)}}function Fu(p,u){for(let g=0;g<p.length;g++)if(zc(u,p[g]))return!0;for(let g=0;g<u.length;g++)if(zc(p,u[g]))return!0;return!!cu(p,u)}function Ra(p,u,g){return!!zc(p,u)||!!Nc(u,p,g)}function In(p,u){if(p.length===1)return Xh(u,p[0]);for(let g=0;g<u.length;g++){const C=u[g];for(let P=0;P<C.length;P++)if(zc(p,C[P]))return!0}for(let g=0;g<p.length;g++)if(Xh(u,p[g]))return!0;for(let g=0;g<u.length;g++)if(cu(p,u[g]))return!0;return!1}function dc(p,u,g){if(p.length>1){if(cu(p,u))return!0;for(let C=0;C<u.length;C++)if(Nc(u[C],p,g))return!0}for(let C=0;C<p.length;C++)if(Nc(p[C],u,g))return!0;return!1}function cu(p,u){if(p.length===0||u.length===0)return!1;for(let g=0;g<p.length-1;g++){const C=p[g],P=p[g+1];for(let Q=0;Q<u.length-1;Q++)if(Uc(C,P,u[Q],u[Q+1]))return!0}return!1}function Uc(p,u,g,C){return We(p,g,C)!==We(u,g,C)&&We(p,u,g)!==We(p,u,C)}function Nc(p,u,g){const C=g*g;if(u.length===1)return p.distSqr(u[0])<C;for(let P=1;P<u.length;P++)if(Du(p,u[P-1],u[P])<C)return!0;return!1}function Du(p,u,g){const C=u.distSqr(g);if(C===0)return p.distSqr(u);const P=((p.x-u.x)*(g.x-u.x)+(p.y-u.y)*(g.y-u.y))/C;return p.distSqr(P<0?u:P>1?g:g.sub(u)._mult(P)._add(u))}function Xh(p,u){let g,C,P,Q=!1;for(let V=0;V<p.length;V++){g=p[V];for(let K=0,te=g.length-1;K<g.length;te=K++)C=g[K],P=g[te],C.y>u.y!=P.y>u.y&&u.x<(P.x-C.x)*(u.y-C.y)/(P.y-C.y)+C.x&&(Q=!Q)}return Q}function zc(p,u){let g=!1;for(let C=0,P=p.length-1;C<p.length;P=C++){const Q=p[C],V=p[P];Q.y>u.y!=V.y>u.y&&u.x<(V.x-Q.x)*(u.y-Q.y)/(V.y-Q.y)+Q.x&&(g=!g)}return g}function DA(p,u,g){const C=g[0],P=g[2];if(p.x<C.x&&u.x<C.x||p.x>P.x&&u.x>P.x||p.y<C.y&&u.y<C.y||p.y>P.y&&u.y>P.y)return!1;const Q=We(p,u,g[0]);return Q!==We(p,u,g[1])||Q!==We(p,u,g[2])||Q!==We(p,u,g[3])}function Zh(p,u,g){const C=u.paint.get(p).value;return C.kind==="constant"?C.value:g.programConfigurations.get(u.id).getMaxValue(p)}function xd(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function Ru(p,u,g,C,P){if(!u[0]&&!u[1])return p;const Q=F.convert(u)._mult(P);g==="viewport"&&Q._rotate(-C);const V=[];for(let K=0;K<p.length;K++)V.push(p[K].sub(Q));return V}let uu,wd;Pi("CircleBucket",so,{omit:["layers"]});var jg={get paint(){return wd=wd||new Cs({"circle-radius":new sr(xt.paint_circle["circle-radius"]),"circle-color":new sr(xt.paint_circle["circle-color"]),"circle-blur":new sr(xt.paint_circle["circle-blur"]),"circle-opacity":new sr(xt.paint_circle["circle-opacity"]),"circle-translate":new bi(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new bi(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bi(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bi(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sr(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sr(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sr(xt.paint_circle["circle-stroke-opacity"])})},get layout(){return uu=uu||new Cs({"circle-sort-key":new sr(xt.layout_circle["circle-sort-key"])})}},ta=1e-6,Wl=typeof Float32Array<"u"?Float32Array:Array;function Jh(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function fh(p,u,g){var C=u[0],P=u[1],Q=u[2],V=u[3],K=u[4],te=u[5],he=u[6],h=u[7],l=u[8],f=u[9],v=u[10],E=u[11],M=u[12],D=u[13],G=u[14],$=u[15],X=g[0],se=g[1],Ae=g[2],me=g[3];return p[0]=X*C+se*K+Ae*l+me*M,p[1]=X*P+se*te+Ae*f+me*D,p[2]=X*Q+se*he+Ae*v+me*G,p[3]=X*V+se*h+Ae*E+me*$,p[4]=(X=g[4])*C+(se=g[5])*K+(Ae=g[6])*l+(me=g[7])*M,p[5]=X*P+se*te+Ae*f+me*D,p[6]=X*Q+se*he+Ae*v+me*G,p[7]=X*V+se*h+Ae*E+me*$,p[8]=(X=g[8])*C+(se=g[9])*K+(Ae=g[10])*l+(me=g[11])*M,p[9]=X*P+se*te+Ae*f+me*D,p[10]=X*Q+se*he+Ae*v+me*G,p[11]=X*V+se*h+Ae*E+me*$,p[12]=(X=g[12])*C+(se=g[13])*K+(Ae=g[14])*l+(me=g[15])*M,p[13]=X*P+se*te+Ae*f+me*D,p[14]=X*Q+se*he+Ae*v+me*G,p[15]=X*V+se*h+Ae*E+me*$,p}Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)});var hu,ph=fh;function gh(p,u,g){var C=u[0],P=u[1],Q=u[2],V=u[3];return p[0]=g[0]*C+g[4]*P+g[8]*Q+g[12]*V,p[1]=g[1]*C+g[5]*P+g[9]*Q+g[13]*V,p[2]=g[2]*C+g[6]*P+g[10]*Q+g[14]*V,p[3]=g[3]*C+g[7]*P+g[11]*Q+g[15]*V,p}hu=new Wl(4),Wl!=Float32Array&&(hu[0]=0,hu[1]=0,hu[2]=0,hu[3]=0);class Yh extends jn{constructor(u){super(u,jg)}createBucket(u){return new so(u)}queryRadius(u){const g=u;return Zh("circle-radius",this,g)+Zh("circle-stroke-width",this,g)+xd(this.paint.get("circle-translate"))}queryIntersectsFeature(u,g,C,P,Q,V,K,te){const he=Ru(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),V.angle,K),h=this.paint.get("circle-radius").evaluate(g,C)+this.paint.get("circle-stroke-width").evaluate(g,C),l=this.paint.get("circle-pitch-alignment")==="map",f=l?he:function(E,M){return E.map(D=>kf(D,M))}(he,te),v=l?h*K:h;for(const E of P)for(const M of E){const D=l?M:kf(M,te);let G=v;const $=gh([],[M.x,M.y,0,1],te);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=$[3]/V.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=V.cameraToCenterDistance/$[3]),Ra(f,D,G))return!0}return!1}}function kf(p,u){const g=gh([],[p.x,p.y,0,1],u);return new F(g[0]/g[3],g[1]/g[3])}class ia extends so{}let Qc;Pi("HeatmapBucket",ia,{omit:["layers"]});var Bd={get paint(){return Qc=Qc||new Cs({"heatmap-radius":new sr(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sr(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bi(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oc(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bi(xt.paint_heatmap["heatmap-opacity"])})}};function eA(p,u,g,C){let{width:P,height:Q}=u;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==P*Q*g)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${P*Q*g}`)}else C=new Uint8Array(P*Q*g);return p.width=P,p.height=Q,p.data=C,p}function pl(p,u,g){let{width:C,height:P}=u;if(C===p.width&&P===p.height)return;const Q=eA({},{width:C,height:P},g);Cd(p,Q,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,C),height:Math.min(p.height,P)},g),p.width=C,p.height=P,p.data=Q.data}function Cd(p,u,g,C,P,Q){if(P.width===0||P.height===0)return u;if(P.width>p.width||P.height>p.height||g.x>p.width-P.width||g.y>p.height-P.height)throw new RangeError("out of range source coordinates for image copy");if(P.width>u.width||P.height>u.height||C.x>u.width-P.width||C.y>u.height-P.height)throw new RangeError("out of range destination coordinates for image copy");const V=p.data,K=u.data;if(V===K)throw new Error("srcData equals dstData, so image is already copied");for(let te=0;te<P.height;te++){const he=((g.y+te)*p.width+g.x)*Q,h=((C.y+te)*u.width+C.x)*Q;for(let l=0;l<P.width*Q;l++)K[h+l]=V[he+l]}return u}class Au{constructor(u,g){eA(this,u,1,g)}resize(u){pl(this,u,1)}clone(){return new Au({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,g,C,P,Q){Cd(u,g,C,P,Q,1)}}class gl{constructor(u,g){eA(this,u,4,g)}resize(u){pl(this,u,4)}replace(u,g){g?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,g,C,P,Q){Cd(u,g,C,P,Q,4)}}function Ed(p){const u={},g=p.resolution||256,C=p.clips?p.clips.length:1,P=p.image||new gl({width:g,height:C});if(Math.log(g)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${g}`);const Q=(V,K,te)=>{u[p.evaluationKey]=te;const he=p.expression.evaluate(u);P.data[V+K+0]=Math.floor(255*he.r/he.a),P.data[V+K+1]=Math.floor(255*he.g/he.a),P.data[V+K+2]=Math.floor(255*he.b/he.a),P.data[V+K+3]=Math.floor(255*he.a)};if(p.clips)for(let V=0,K=0;V<C;++V,K+=4*g)for(let te=0,he=0;te<g;te++,he+=4){const h=te/(g-1),{start:l,end:f}=p.clips[V];Q(K,he,l*(1-h)+f*h)}else for(let V=0,K=0;V<g;V++,K+=4)Q(0,K,V/(g-1));return P}Pi("AlphaImage",Au),Pi("RGBAImage",gl);class mh extends jn{createBucket(u){return new ia(u)}constructor(u){super(u,Bd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ed({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Of;var qg={get paint(){return Of=Of||new Cs({"hillshade-illumination-direction":new bi(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bi(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bi(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bi(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bi(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bi(xt.paint_hillshade["hillshade-accent-color"])})}};class Uf extends jn{constructor(u){super(u,qg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Nf=qn([{name:"a_pos",components:2,type:"Int16"}],4),{members:zf}=Nf;var fc={exports:{}};function Uo(p,u,g){g=g||2;var C,P,Q,V,K,te,he,h=u&&u.length,l=h?u[0]*g:p.length,f=tA(p,0,l,g,!0),v=[];if(!f||f.next===f.prev)return v;if(h&&(f=function(M,D,G,$){var X,se,Ae,me=[];for(X=0,se=D.length;X<se;X++)(Ae=tA(M,D[X]*$,X<se-1?D[X+1]*$:M.length,$,!1))===Ae.next&&(Ae.steiner=!0),me.push(Hf(Ae));for(me.sort(Vf),X=0;X<me.length;X++)G=iA(me[X],G);return G}(p,u,f,g)),p.length>80*g){C=Q=p[0],P=V=p[1];for(var E=g;E<l;E+=g)(K=p[E])<C&&(C=K),(te=p[E+1])<P&&(P=te),K>Q&&(Q=K),te>V&&(V=te);he=(he=Math.max(Q-C,V-P))!==0?32767/he:0}return ml(f,v,g,C,P,he,0),v}function tA(p,u,g,C,P){var Q,V;if(P===Ld(p,u,g,C)>0)for(Q=u;Q<g;Q+=C)V=kA(Q,p[Q],p[Q+1],V);else for(Q=g-C;Q>=u;Q-=C)V=kA(Q,p[Q],p[Q+1],V);return V&&Kg(V,V.next)&&(Gf(V),V=V.next),V}function ka(p,u){if(!p)return p;u||(u=p);var g,C=p;do if(g=!1,C.steiner||!Kg(C,C.next)&&Ws(C.prev,C,C.next)!==0)C=C.next;else{if(Gf(C),(C=u=C.prev)===C.next)break;g=!0}while(g||C!==u);return u}function ml(p,u,g,C,P,Q,V){if(p){!V&&Q&&function(h,l,f,v){var E=h;do E.z===0&&(E.z=yh(E.x,E.y,l,f,v)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==h);E.prevZ.nextZ=null,E.prevZ=null,function(M){var D,G,$,X,se,Ae,me,Be,Se=1;do{for(G=M,M=null,se=null,Ae=0;G;){for(Ae++,$=G,me=0,D=0;D<Se&&(me++,$=$.nextZ);D++);for(Be=Se;me>0||Be>0&&$;)me!==0&&(Be===0||!$||G.z<=$.z)?(X=G,G=G.nextZ,me--):(X=$,$=$.nextZ,Be--),se?se.nextZ=X:M=X,X.prevZ=se,se=X;G=$}se.nextZ=null,Se*=2}while(Ae>1)}(E)}(p,C,P,Q);for(var K,te,he=p;p.prev!==p.next;)if(K=p.prev,te=p.next,Q?Sd(p,C,P,Q):ku(p))u.push(K.i/g|0),u.push(p.i/g|0),u.push(te.i/g|0),Gf(p),p=te.next,he=te.next;else if((p=te)===he){V?V===1?ml(p=Qf(ka(p),u,g),u,g,C,P,Q,2):V===2&&$g(p,u,g,C,P,Q):ml(ka(p),u,g,C,P,Q,1);break}}}function ku(p){var u=p.prev,g=p,C=p.next;if(Ws(u,g,C)>=0)return!1;for(var P=u.x,Q=g.x,V=C.x,K=u.y,te=g.y,he=C.y,h=P<Q?P<V?P:V:Q<V?Q:V,l=K<te?K<he?K:he:te<he?te:he,f=P>Q?P>V?P:V:Q>V?Q:V,v=K>te?K>he?K:he:te>he?te:he,E=C.next;E!==u;){if(E.x>=h&&E.x<=f&&E.y>=l&&E.y<=v&&Id(P,K,Q,te,V,he,E.x,E.y)&&Ws(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Sd(p,u,g,C){var P=p.prev,Q=p,V=p.next;if(Ws(P,Q,V)>=0)return!1;for(var K=P.x,te=Q.x,he=V.x,h=P.y,l=Q.y,f=V.y,v=K<te?K<he?K:he:te<he?te:he,E=h<l?h<f?h:f:l<f?l:f,M=K>te?K>he?K:he:te>he?te:he,D=h>l?h>f?h:f:l>f?l:f,G=yh(v,E,u,g,C),$=yh(M,D,u,g,C),X=p.prevZ,se=p.nextZ;X&&X.z>=G&&se&&se.z<=$;){if(X.x>=v&&X.x<=M&&X.y>=E&&X.y<=D&&X!==P&&X!==V&&Id(K,h,te,l,he,f,X.x,X.y)&&Ws(X.prev,X,X.next)>=0||(X=X.prevZ,se.x>=v&&se.x<=M&&se.y>=E&&se.y<=D&&se!==P&&se!==V&&Id(K,h,te,l,he,f,se.x,se.y)&&Ws(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;X&&X.z>=G;){if(X.x>=v&&X.x<=M&&X.y>=E&&X.y<=D&&X!==P&&X!==V&&Id(K,h,te,l,he,f,X.x,X.y)&&Ws(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;se&&se.z<=$;){if(se.x>=v&&se.x<=M&&se.y>=E&&se.y<=D&&se!==P&&se!==V&&Id(K,h,te,l,he,f,se.x,se.y)&&Ws(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Qf(p,u,g){var C=p;do{var P=C.prev,Q=C.next.next;!Kg(P,Q)&&Bb(P,C,C.next,Q)&&RA(P,Q)&&RA(Q,P)&&(u.push(P.i/g|0),u.push(C.i/g|0),u.push(Q.i/g|0),Gf(C),Gf(C.next),C=p=Q),C=C.next}while(C!==p);return ka(C)}function $g(p,u,g,C,P,Q){var V=p;do{for(var K=V.next.next;K!==V.prev;){if(V.i!==K.i&&yT(V,K)){var te=Cb(V,K);return V=ka(V,V.next),te=ka(te,te.next),ml(V,u,g,C,P,Q,0),void ml(te,u,g,C,P,Q,0)}K=K.next}V=V.next}while(V!==p)}function Vf(p,u){return p.x-u.x}function iA(p,u){var g=function(P,Q){var V,K=Q,te=P.x,he=P.y,h=-1/0;do{if(he<=K.y&&he>=K.next.y&&K.next.y!==K.y){var l=K.x+(he-K.y)*(K.next.x-K.x)/(K.next.y-K.y);if(l<=te&&l>h&&(h=l,V=K.x<K.next.x?K:K.next,l===te))return V}K=K.next}while(K!==Q);if(!V)return null;var f,v=V,E=V.x,M=V.y,D=1/0;K=V;do te>=K.x&&K.x>=E&&te!==K.x&&Id(he<M?te:h,he,E,M,he<M?h:te,he,K.x,K.y)&&(f=Math.abs(he-K.y)/(te-K.x),RA(K,P)&&(f<D||f===D&&(K.x>V.x||K.x===V.x&&Td(V,K)))&&(V=K,D=f)),K=K.next;while(K!==v);return V}(p,u);if(!g)return u;var C=Cb(g,p);return ka(C,C.next),ka(g,g.next)}function Td(p,u){return Ws(p.prev,p,u.prev)<0&&Ws(u.next,p,p.next)<0}function yh(p,u,g,C,P){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-g)*P|0)|p<<8))|p<<4))|p<<2))|p<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-C)*P|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function Hf(p){var u=p,g=p;do(u.x<g.x||u.x===g.x&&u.y<g.y)&&(g=u),u=u.next;while(u!==p);return g}function Id(p,u,g,C,P,Q,V,K){return(P-V)*(u-K)>=(p-V)*(Q-K)&&(p-V)*(C-K)>=(g-V)*(u-K)&&(g-V)*(Q-K)>=(P-V)*(C-K)}function yT(p,u){return p.next.i!==u.i&&p.prev.i!==u.i&&!function(g,C){var P=g;do{if(P.i!==g.i&&P.next.i!==g.i&&P.i!==C.i&&P.next.i!==C.i&&Bb(P,P.next,g,C))return!0;P=P.next}while(P!==g);return!1}(p,u)&&(RA(p,u)&&RA(u,p)&&function(g,C){var P=g,Q=!1,V=(g.x+C.x)/2,K=(g.y+C.y)/2;do P.y>K!=P.next.y>K&&P.next.y!==P.y&&V<(P.next.x-P.x)*(K-P.y)/(P.next.y-P.y)+P.x&&(Q=!Q),P=P.next;while(P!==g);return Q}(p,u)&&(Ws(p.prev,p,u.prev)||Ws(p,u.prev,u))||Kg(p,u)&&Ws(p.prev,p,p.next)>0&&Ws(u.prev,u,u.next)>0)}function Ws(p,u,g){return(u.y-p.y)*(g.x-u.x)-(u.x-p.x)*(g.y-u.y)}function Kg(p,u){return p.x===u.x&&p.y===u.y}function Bb(p,u,g,C){var P=Xg(Ws(p,u,g)),Q=Xg(Ws(p,u,C)),V=Xg(Ws(g,C,p)),K=Xg(Ws(g,C,u));return P!==Q&&V!==K||!(P!==0||!Wg(p,g,u))||!(Q!==0||!Wg(p,C,u))||!(V!==0||!Wg(g,p,C))||!(K!==0||!Wg(g,u,C))}function Wg(p,u,g){return u.x<=Math.max(p.x,g.x)&&u.x>=Math.min(p.x,g.x)&&u.y<=Math.max(p.y,g.y)&&u.y>=Math.min(p.y,g.y)}function Xg(p){return p>0?1:p<0?-1:0}function RA(p,u){return Ws(p.prev,p,p.next)<0?Ws(p,u,p.next)>=0&&Ws(p,p.prev,u)>=0:Ws(p,u,p.prev)<0||Ws(p,p.next,u)<0}function Cb(p,u){var g=new Os(p.i,p.x,p.y),C=new Os(u.i,u.x,u.y),P=p.next,Q=u.prev;return p.next=u,u.prev=p,g.next=P,P.prev=g,C.next=g,g.prev=C,Q.next=C,C.prev=Q,C}function kA(p,u,g,C){var P=new Os(p,u,g);return C?(P.next=C.next,P.prev=C,C.next.prev=P,C.next=P):(P.prev=P,P.next=P),P}function Gf(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Os(p,u,g){this.i=p,this.x=u,this.y=g,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ld(p,u,g,C){for(var P=0,Q=u,V=g-C;Q<g;Q+=C)P+=(p[V]-p[Q])*(p[Q+1]+p[V+1]),V=Q;return P}fc.exports=Uo,fc.exports.default=Uo,Uo.deviation=function(p,u,g,C){var P=u&&u.length,Q=Math.abs(Ld(p,0,P?u[0]*g:p.length,g));if(P)for(var V=0,K=u.length;V<K;V++)Q-=Math.abs(Ld(p,u[V]*g,V<K-1?u[V+1]*g:p.length,g));var te=0;for(V=0;V<C.length;V+=3){var he=C[V]*g,h=C[V+1]*g,l=C[V+2]*g;te+=Math.abs((p[he]-p[l])*(p[h+1]-p[he+1])-(p[he]-p[h])*(p[l+1]-p[he+1]))}return Q===0&&te===0?0:Math.abs((te-Q)/Q)},Uo.flatten=function(p){for(var u=p[0][0].length,g={vertices:[],holes:[],dimensions:u},C=0,P=0;P<p.length;P++){for(var Q=0;Q<p[P].length;Q++)for(var V=0;V<u;V++)g.vertices.push(p[P][Q][V]);P>0&&g.holes.push(C+=p[P-1].length)}return g};var u0=m(fc.exports);function Zg(p,u,g,C,P){jf(p,u,g||0,C||p.length-1,P||Eb)}function jf(p,u,g,C,P){for(;C>g;){if(C-g>600){var Q=C-g+1,V=u-g+1,K=Math.log(Q),te=.5*Math.exp(2*K/3),he=.5*Math.sqrt(K*te*(Q-te)/Q)*(V-Q/2<0?-1:1);jf(p,u,Math.max(g,Math.floor(u-V*te/Q+he)),Math.min(C,Math.floor(u+(Q-V)*te/Q+he)),P)}var h=p[u],l=g,f=C;for(_h(p,g,u),P(p[C],h)>0&&_h(p,g,C);l<f;){for(_h(p,l,f),l++,f--;P(p[l],h)<0;)l++;for(;P(p[f],h)>0;)f--}P(p[g],h)===0?_h(p,g,f):_h(p,++f,C),f<=u&&(g=f+1),u<=f&&(C=f-1)}}function _h(p,u,g){var C=p[u];p[u]=p[g],p[g]=C}function Eb(p,u){return p<u?-1:p>u?1:0}function Jg(p,u){const g=p.length;if(g<=1)return[p];const C=[];let P,Q;for(let V=0;V<g;V++){const K=Et(p[V]);K!==0&&(p[V].area=Math.abs(K),Q===void 0&&(Q=K<0),Q===K<0?(P&&C.push(P),P=[p[V]]):P.push(p[V]))}if(P&&C.push(P),u>1)for(let V=0;V<C.length;V++)C[V].length<=u||(Zg(C[V],u,1,C[V].length-1,qf),C[V]=C[V].slice(0,u));return C}function qf(p,u){return u.area-p.area}function $f(p,u,g){const C=g.patternDependencies;let P=!1;for(const Q of u){const V=Q.paint.get(`${p}-pattern`);V.isConstant()||(P=!0);const K=V.constantOr(null);K&&(P=!0,C[K.to]=!0,C[K.from]=!0)}return P}function Kf(p,u,g,C,P){const Q=P.patternDependencies;for(const V of u){const K=V.paint.get(`${p}-pattern`).value;if(K.kind!=="constant"){let te=K.evaluate({zoom:C-1},g,{},P.availableImages),he=K.evaluate({zoom:C},g,{},P.availableImages),h=K.evaluate({zoom:C+1},g,{},P.availableImages);te=te&&te.name?te.name:te,he=he&&he.name?he.name:he,h=h&&h.name?h.name:h,Q[te]=!0,Q[he]=!0,Q[h]=!0,g.patterns[V.id]={min:te,mid:he,max:h}}}return g}class Yg{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(g=>g.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new Ke,this.indexArray2=new Re,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.segments2=new bt,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(u,g,C){this.hasPattern=$f("fill",this.layers,g);const P=this.layers[0].layout.get("fill-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:K,id:te,index:he,sourceLayerIndex:h}of u){const l=this.layers[0]._featureFilter.needGeometry,f=Ks(K,l);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C,g.availableImages):void 0,E={id:te,properties:K.properties,type:K.type,sourceLayerIndex:h,index:he,geometry:l?f.geometry:ks(K),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((K,te)=>K.sortKey-te.sortKey);for(const K of V){const{geometry:te,index:he,sourceLayerIndex:h}=K;if(this.hasPattern){const l=Kf("fill",this.layers,K,this.zoom,g);this.patternFeatures.push(l)}else this.addFeature(K,te,he,C,{});g.featureIndex.insert(u[he].feature,te,he,h,this.index)}}update(u,g,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,g,this.stateDependentLayers,C)}addFeatures(u,g,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,g,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,zf),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,g,C,P,Q){for(const V of Jg(g,500)){let K=0;for(const v of V)K+=v.length;const te=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray),he=te.vertexLength,h=[],l=[];for(const v of V){if(v.length===0)continue;v!==V[0]&&l.push(h.length/2);const E=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),M=E.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(M+v.length-1,M),h.push(v[0].x),h.push(v[0].y);for(let D=1;D<v.length;D++)this.layoutVertexArray.emplaceBack(v[D].x,v[D].y),this.indexArray2.emplaceBack(M+D-1,M+D),h.push(v[D].x),h.push(v[D].y);E.vertexLength+=v.length,E.primitiveLength+=v.length}const f=u0(h,l);for(let v=0;v<f.length;v+=3)this.indexArray.emplaceBack(he+f[v],he+f[v+1],he+f[v+2]);te.vertexLength+=K,te.primitiveLength+=f.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}let Sb,h0;Pi("FillBucket",Yg,{omit:["layers","patternFeatures"]});var Wf={get paint(){return h0=h0||new Cs({"fill-antialias":new bi(xt.paint_fill["fill-antialias"]),"fill-opacity":new sr(xt.paint_fill["fill-opacity"]),"fill-color":new sr(xt.paint_fill["fill-color"]),"fill-outline-color":new sr(xt.paint_fill["fill-outline-color"]),"fill-translate":new bi(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new bi(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new $l(xt.paint_fill["fill-pattern"])})},get layout(){return Sb=Sb||new Cs({"fill-sort-key":new sr(xt.layout_fill["fill-sort-key"])})}};class _T extends jn{constructor(u){super(u,Wf)}recalculate(u,g){super.recalculate(u,g);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Yg(u)}queryRadius(){return xd(this.paint.get("fill-translate"))}queryIntersectsFeature(u,g,C,P,Q,V,K){return In(Ru(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),V.angle,K),P)}isTileClipped(){return!0}}const A0=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),vT=qn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:d0}=A0;var Ou={},f0=x,p0=OA;function OA(p,u,g,C,P){this.properties={},this.extent=g,this.type=0,this._pbf=p,this._geometry=-1,this._keys=C,this._values=P,p.readFields(bT,this,u)}function bT(p,u,g){p==1?u.id=g.readVarint():p==2?function(C,P){for(var Q=C.readVarint()+C.pos;C.pos<Q;){var V=P._keys[C.readVarint()],K=P._values[C.readVarint()];P.properties[V]=K}}(g,u):p==3?u.type=g.readVarint():p==4&&(u._geometry=g.pos)}function xT(p){for(var u,g,C=0,P=0,Q=p.length,V=Q-1;P<Q;V=P++)C+=((g=p[V]).x-(u=p[P]).x)*(u.y+g.y);return C}OA.types=["Unknown","Point","LineString","Polygon"],OA.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,g=p.readVarint()+p.pos,C=1,P=0,Q=0,V=0,K=[];p.pos<g;){if(P<=0){var te=p.readVarint();C=7&te,P=te>>3}if(P--,C===1||C===2)Q+=p.readSVarint(),V+=p.readSVarint(),C===1&&(u&&K.push(u),u=[]),u.push(new f0(Q,V));else{if(C!==7)throw new Error("unknown command "+C);u&&u.push(u[0].clone())}}return u&&K.push(u),K},OA.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,g=1,C=0,P=0,Q=0,V=1/0,K=-1/0,te=1/0,he=-1/0;p.pos<u;){if(C<=0){var h=p.readVarint();g=7&h,C=h>>3}if(C--,g===1||g===2)(P+=p.readSVarint())<V&&(V=P),P>K&&(K=P),(Q+=p.readSVarint())<te&&(te=Q),Q>he&&(he=Q);else if(g!==7)throw new Error("unknown command "+g)}return[V,te,K,he]},OA.prototype.toGeoJSON=function(p,u,g){var C,P,Q=this.extent*Math.pow(2,g),V=this.extent*p,K=this.extent*u,te=this.loadGeometry(),he=OA.types[this.type];function h(v){for(var E=0;E<v.length;E++){var M=v[E];v[E]=[360*(M.x+V)/Q-180,360/Math.PI*Math.atan(Math.exp((180-360*(M.y+K)/Q)*Math.PI/180))-90]}}switch(this.type){case 1:var l=[];for(C=0;C<te.length;C++)l[C]=te[C][0];h(te=l);break;case 2:for(C=0;C<te.length;C++)h(te[C]);break;case 3:for(te=function(v){var E=v.length;if(E<=1)return[v];for(var M,D,G=[],$=0;$<E;$++){var X=xT(v[$]);X!==0&&(D===void 0&&(D=X<0),D===X<0?(M&&G.push(M),M=[v[$]]):M.push(v[$]))}return M&&G.push(M),G}(te),C=0;C<te.length;C++)for(P=0;P<te[C].length;P++)h(te[C][P])}te.length===1?te=te[0]:he="Multi"+he;var f={type:"Feature",geometry:{type:he,coordinates:te},properties:this.properties};return"id"in this&&(f.id=this.id),f};var wT=p0,Tb=Ib;function Ib(p,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(rA,this,u),this.length=this._features.length}function rA(p,u,g){p===15?u.version=g.readVarint():p===1?u.name=g.readString():p===5?u.extent=g.readVarint():p===2?u._features.push(g.pos):p===3?u._keys.push(g.readString()):p===4&&u._values.push(function(C){for(var P=null,Q=C.readVarint()+C.pos;C.pos<Q;){var V=C.readVarint()>>3;P=V===1?C.readString():V===2?C.readFloat():V===3?C.readDouble():V===4?C.readVarint64():V===5?C.readVarint():V===6?C.readSVarint():V===7?C.readBoolean():null}return P}(g))}Ib.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var u=this._pbf.readVarint()+this._pbf.pos;return new wT(this._pbf,u,this.extent,this._keys,this._values)};var BT=Tb;function Lb(p,u,g){if(p===3){var C=new BT(g,g.readVarint()+g.pos);C.length&&(u[C.name]=C)}}Ou.VectorTile=function(p,u){this.layers=p.readFields(Lb,{},u)},Ou.VectorTileFeature=p0,Ou.VectorTileLayer=Tb;const Md=Ou.VectorTileFeature.types,g0=Math.pow(2,13);function Xf(p,u,g,C,P,Q,V,K){p.emplaceBack(u,g,2*Math.floor(C*g0)+V,P*g0*2,Q*g0*2,Math.round(K))}class m0{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(g=>g.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new J,this.centroidVertexArray=new j,this.indexArray=new Ke,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(u,g,C){this.features=[],this.hasPattern=$f("fill-extrusion",this.layers,g);for(const{feature:P,id:Q,index:V,sourceLayerIndex:K}of u){const te=this.layers[0]._featureFilter.needGeometry,he=Ks(P,te);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),he,C))continue;const h={id:Q,sourceLayerIndex:K,index:V,geometry:te?he.geometry:ks(P),properties:P.properties,type:P.type,patterns:{}};this.hasPattern?this.features.push(Kf("fill-extrusion",this.layers,h,this.zoom,g)):this.addFeature(h,h.geometry,V,C,{}),g.featureIndex.insert(P,h.geometry,V,K,this.index,!0)}}addFeatures(u,g,C){for(const P of this.features){const{geometry:Q}=P;this.addFeature(P,Q,P.index,g,C)}}update(u,g,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,g,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,d0),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,vT.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,g,C,P,Q){const V={x:0,y:0,vertexCount:0};for(const K of Jg(g,500)){let te=0;for(const E of K)te+=E.length;let he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const E of K){if(E.length===0||Pb(E))continue;let M=0;for(let D=0;D<E.length;D++){const G=E[D];if(D>=1){const $=E[D-1];if(!Mb(G,$)){he.vertexLength+4>bt.MAX_VERTEX_ARRAY_LENGTH&&(he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const X=G.sub($)._perp()._unit(),se=$.dist(G);M+se>32768&&(M=0),Xf(this.layoutVertexArray,G.x,G.y,X.x,X.y,0,0,M),Xf(this.layoutVertexArray,G.x,G.y,X.x,X.y,0,1,M),V.x+=2*G.x,V.y+=2*G.y,V.vertexCount+=2,M+=se,Xf(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,0,M),Xf(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,1,M),V.x+=2*$.x,V.y+=2*$.y,V.vertexCount+=2;const Ae=he.vertexLength;this.indexArray.emplaceBack(Ae,Ae+2,Ae+1),this.indexArray.emplaceBack(Ae+1,Ae+2,Ae+3),he.vertexLength+=4,he.primitiveLength+=2}}}}if(he.vertexLength+te>bt.MAX_VERTEX_ARRAY_LENGTH&&(he=this.segments.prepareSegment(te,this.layoutVertexArray,this.indexArray)),Md[u.type]!=="Polygon")continue;const h=[],l=[],f=he.vertexLength;for(const E of K)if(E.length!==0){E!==K[0]&&l.push(h.length/2);for(let M=0;M<E.length;M++){const D=E[M];Xf(this.layoutVertexArray,D.x,D.y,0,0,1,1,0),V.x+=D.x,V.y+=D.y,V.vertexCount+=1,h.push(D.x),h.push(D.y)}}const v=u0(h,l);for(let E=0;E<v.length;E+=3)this.indexArray.emplaceBack(f+v[E],f+v[E+2],f+v[E+1]);he.primitiveLength+=v.length/3,he.vertexLength+=te}for(let K=0;K<V.vertexCount;K++)this.centroidVertexArray.emplaceBack(Math.floor(V.x/V.vertexCount),Math.floor(V.y/V.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}function Mb(p,u){return p.x===u.x&&(p.x<0||p.x>$r)||p.y===u.y&&(p.y<0||p.y>$r)}function Pb(p){return p.every(u=>u.x<0)||p.every(u=>u.x>$r)||p.every(u=>u.y<0)||p.every(u=>u.y>$r)}let Fb;Pi("FillExtrusionBucket",m0,{omit:["layers","features"]});var CT={get paint(){return Fb=Fb||new Cs({"fill-extrusion-opacity":new bi(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sr(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bi(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bi(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $l(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sr(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sr(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bi(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ET extends jn{constructor(u){super(u,CT)}createBucket(u){return new m0(u)}queryRadius(){return xd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,g,C,P,Q,V,K,te){const he=Ru(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),V.angle,K),h=this.paint.get("fill-extrusion-height").evaluate(g,C),l=this.paint.get("fill-extrusion-base").evaluate(g,C),f=function(E,M,D,G){const $=[];for(const X of E){const se=[X.x,X.y,0,1];gh(se,se,M),$.push(new F(se[0]/se[3],se[1]/se[3]))}return $}(he,te),v=function(E,M,D,G){const $=[],X=[],se=G[8]*M,Ae=G[9]*M,me=G[10]*M,Be=G[11]*M,Se=G[8]*D,ke=G[9]*D,He=G[10]*D,qe=G[11]*D;for(const ct of E){const Ye=[],tt=[];for(const gt of ct){const St=gt.x,Xt=gt.y,xi=G[0]*St+G[4]*Xt+G[12],oi=G[1]*St+G[5]*Xt+G[13],Ai=G[2]*St+G[6]*Xt+G[14],fi=G[3]*St+G[7]*Xt+G[15],Fi=Ai+me,ai=fi+Be,Zt=xi+Se,Vi=oi+ke,Qi=Ai+He,gr=fi+qe,Dr=new F((xi+se)/ai,(oi+Ae)/ai);Dr.z=Fi/ai,Ye.push(Dr);const zr=new F(Zt/gr,Vi/gr);zr.z=Qi/gr,tt.push(zr)}$.push(Ye),X.push(tt)}return[$,X]}(P,l,h,te);return function(E,M,D){let G=1/0;In(D,M)&&(G=em(D,M[0]));for(let $=0;$<M.length;$++){const X=M[$],se=E[$];for(let Ae=0;Ae<X.length-1;Ae++){const me=X[Ae],Be=[me,X[Ae+1],se[Ae+1],se[Ae],me];Fu(D,Be)&&(G=Math.min(G,em(D,Be)))}}return G!==1/0&&G}(v[0],v[1],f)}}function Zf(p,u){return p.x*u.x+p.y*u.y}function em(p,u){if(p.length===1){let g=0;const C=u[g++];let P;for(;!P||C.equals(P);)if(P=u[g++],!P)return 1/0;for(;g<u.length;g++){const Q=u[g],V=p[0],K=P.sub(C),te=Q.sub(C),he=V.sub(C),h=Zf(K,K),l=Zf(K,te),f=Zf(te,te),v=Zf(he,K),E=Zf(he,te),M=h*f-l*l,D=(f*v-l*E)/M,G=(h*E-l*v)/M,$=C.z*(1-D-G)+P.z*D+Q.z*G;if(isFinite($))return $}return 1/0}{let g=1/0;for(const C of u)g=Math.min(g,C.z);return g}}const Jf=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:y0}=Jf,ST=qn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:TT}=ST,Db=Ou.VectorTileFeature.types,IT=Math.cos(Math.PI/180*37.5),Rb=Math.pow(2,14)/.5;class UA{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(g=>g.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(g=>{this.gradients[g.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new ae,this.indexArray=new Ke,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(u,g,C){this.hasPattern=$f("line",this.layers,g);const P=this.layers[0].layout.get("line-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:K,id:te,index:he,sourceLayerIndex:h}of u){const l=this.layers[0]._featureFilter.needGeometry,f=Ks(K,l);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C):void 0,E={id:te,properties:K.properties,type:K.type,sourceLayerIndex:h,index:he,geometry:l?f.geometry:ks(K),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((K,te)=>K.sortKey-te.sortKey);for(const K of V){const{geometry:te,index:he,sourceLayerIndex:h}=K;if(this.hasPattern){const l=Kf("line",this.layers,K,this.zoom,g);this.patternFeatures.push(l)}else this.addFeature(K,te,he,C,{});g.featureIndex.insert(u[he].feature,te,he,h,this.index)}}update(u,g,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,g,this.stateDependentLayers,C)}addFeatures(u,g,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,g,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,TT)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,y0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,g,C,P,Q){const V=this.layers[0].layout,K=V.get("line-join").evaluate(u,{}),te=V.get("line-cap"),he=V.get("line-miter-limit"),h=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const l of g)this.addLine(l,u,K,te,he,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}addLine(u,g,C,P,Q,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<u.length-1;G++)this.totalDistance+=u[G].dist(u[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const K=Db[g.type]==="Polygon";let te=u.length;for(;te>=2&&u[te-1].equals(u[te-2]);)te--;let he=0;for(;he<te-1&&u[he].equals(u[he+1]);)he++;if(te<(K?3:2))return;C==="bevel"&&(Q=1.05);const h=this.overscaling<=16?15*$r/(512*this.overscaling):0,l=this.segments.prepareSegment(10*te,this.layoutVertexArray,this.indexArray);let f,v,E,M,D;this.e1=this.e2=-1,K&&(f=u[te-2],D=u[he].sub(f)._unit()._perp());for(let G=he;G<te;G++){if(E=G===te-1?K?u[he+1]:void 0:u[G+1],E&&u[G].equals(E))continue;D&&(M=D),f&&(v=f),f=u[G],D=E?E.sub(f)._unit()._perp():M,M=M||D;let $=M.add(D);$.x===0&&$.y===0||$._unit();const X=M.x*D.x+M.y*D.y,se=$.x*D.x+$.y*D.y,Ae=se!==0?1/se:1/0,me=2*Math.sqrt(2-2*se),Be=se<IT&&v&&E,Se=M.x*D.y-M.y*D.x>0;if(Be&&G>he){const qe=f.dist(v);if(qe>2*h){const ct=f.sub(f.sub(v)._mult(h/qe)._round());this.updateDistance(v,ct),this.addCurrentVertex(ct,M,0,0,l),v=ct}}const ke=v&&E;let He=ke?C:K?"butt":P;if(ke&&He==="round"&&(Ae<V?He="miter":Ae<=2&&(He="fakeround")),He==="miter"&&Ae>Q&&(He="bevel"),He==="bevel"&&(Ae>2&&(He="flipbevel"),Ae<Q&&(He="miter")),v&&this.updateDistance(v,f),He==="miter")$._mult(Ae),this.addCurrentVertex(f,$,0,0,l);else if(He==="flipbevel"){if(Ae>100)$=D.mult(-1);else{const qe=Ae*M.add(D).mag()/M.sub(D).mag();$._perp()._mult(qe*(Se?-1:1))}this.addCurrentVertex(f,$,0,0,l),this.addCurrentVertex(f,$.mult(-1),0,0,l)}else if(He==="bevel"||He==="fakeround"){const qe=-Math.sqrt(Ae*Ae-1),ct=Se?qe:0,Ye=Se?0:qe;if(v&&this.addCurrentVertex(f,M,ct,Ye,l),He==="fakeround"){const tt=Math.round(180*me/Math.PI/20);for(let gt=1;gt<tt;gt++){let St=gt/tt;if(St!==.5){const xi=St-.5;St+=St*xi*(St-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*xi*xi+(.848013+X*(.215638*X-1.06021)))}const Xt=D.sub(M)._mult(St)._add(M)._unit()._mult(Se?-1:1);this.addHalfVertex(f,Xt.x,Xt.y,!1,Se,0,l)}}E&&this.addCurrentVertex(f,D,-ct,-Ye,l)}else if(He==="butt")this.addCurrentVertex(f,$,0,0,l);else if(He==="square"){const qe=v?1:-1;this.addCurrentVertex(f,$,qe,qe,l)}else He==="round"&&(v&&(this.addCurrentVertex(f,M,0,0,l),this.addCurrentVertex(f,M,1,1,l,!0)),E&&(this.addCurrentVertex(f,D,-1,-1,l,!0),this.addCurrentVertex(f,D,0,0,l)));if(Be&&G<te-1){const qe=f.dist(E);if(qe>2*h){const ct=f.add(E.sub(f)._mult(h/qe)._round());this.updateDistance(f,ct),this.addCurrentVertex(ct,D,0,0,l),f=ct}}}}addCurrentVertex(u,g,C,P,Q){let V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const K=g.y*P-g.x,te=-g.y-g.x*P;this.addHalfVertex(u,g.x+g.y*C,g.y-g.x*C,V,!1,C,Q),this.addHalfVertex(u,K,te,V,!0,-P,Q),this.distance>Rb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,g,C,P,Q,V))}addHalfVertex(u,g,C,P,Q,V,K){let{x:te,y:he}=u;const h=.5*(this.lineClips?this.scaledDistance*(Rb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((te<<1)+(P?1:0),(he<<1)+(Q?1:0),Math.round(63*g)+128,Math.round(63*C)+128,1+(V===0?0:V<0?-1:1)|(63&h)<<2,h>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const l=K.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),K.primitiveLength++),Q?this.e2=l:this.e1=l}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,g){this.distance+=u.dist(g),this.updateScaledDistance()}}let _0,kb;Pi("LineBucket",UA,{omit:["layers","patternFeatures"]});var Ob={get paint(){return kb=kb||new Cs({"line-opacity":new sr(xt.paint_line["line-opacity"]),"line-color":new sr(xt.paint_line["line-color"]),"line-translate":new bi(xt.paint_line["line-translate"]),"line-translate-anchor":new bi(xt.paint_line["line-translate-anchor"]),"line-width":new sr(xt.paint_line["line-width"]),"line-gap-width":new sr(xt.paint_line["line-gap-width"]),"line-offset":new sr(xt.paint_line["line-offset"]),"line-blur":new sr(xt.paint_line["line-blur"]),"line-dasharray":new kc(xt.paint_line["line-dasharray"]),"line-pattern":new $l(xt.paint_line["line-pattern"]),"line-gradient":new Oc(xt.paint_line["line-gradient"])})},get layout(){return _0=_0||new Cs({"line-cap":new bi(xt.layout_line["line-cap"]),"line-join":new sr(xt.layout_line["line-join"]),"line-miter-limit":new bi(xt.layout_line["line-miter-limit"]),"line-round-limit":new bi(xt.layout_line["line-round-limit"]),"line-sort-key":new sr(xt.layout_line["line-sort-key"])})}};class LT extends sr{possiblyEvaluate(u,g){return g=new yn(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),super.possiblyEvaluate(u,g)}evaluate(u,g,C,P){return g=$e({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(u,g,C,P)}}let tm;class MT extends jn{constructor(u){super(u,Ob),this.gradientVersion=0,tm||(tm=new LT(Ob.paint.properties["line-width"].specification),tm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const g=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(g)&&g._styleExpression.expression instanceof Sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,g){super.recalculate(u,g),this.paint._values["line-floorwidth"]=tm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new UA(u)}queryRadius(u){const g=u,C=Ub(Zh("line-width",this,g),Zh("line-gap-width",this,g)),P=Zh("line-offset",this,g);return C/2+Math.abs(P)+xd(this.paint.get("line-translate"))}queryIntersectsFeature(u,g,C,P,Q,V,K){const te=Ru(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),V.angle,K),he=K/2*Ub(this.paint.get("line-width").evaluate(g,C),this.paint.get("line-gap-width").evaluate(g,C)),h=this.paint.get("line-offset").evaluate(g,C);return h&&(P=function(l,f){const v=[];for(let E=0;E<l.length;E++){const M=l[E],D=[];for(let G=0;G<M.length;G++){const $=M[G-1],X=M[G],se=M[G+1],Ae=G===0?new F(0,0):X.sub($)._unit()._perp(),me=G===M.length-1?new F(0,0):se.sub(X)._unit()._perp(),Be=Ae._add(me)._unit(),Se=Be.x*me.x+Be.y*me.y;Se!==0&&Be._mult(1/Se),D.push(Be._mult(f)._add(X))}v.push(D)}return v}(P,h*K)),function(l,f,v){for(let E=0;E<f.length;E++){const M=f[E];if(l.length>=3){for(let D=0;D<M.length;D++)if(zc(l,M[D]))return!0}if(dc(l,M,v))return!0}return!1}(te,P,he)}isTileClipped(){return!0}}function Ub(p,u){return u>0?u+2*p:p}const Nb=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),v0=qn([{name:"a_projected_pos",components:3,type:"Float32"}],4);qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zb=qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const b0=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qb=qn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function PT(p,u,g){return p.sections.forEach(C=>{C.text=function(P,Q,V){const K=Q.layout.get("text-transform").evaluate(V,{});return K==="uppercase"?P=P.toLocaleUpperCase():K==="lowercase"&&(P=P.toLocaleLowerCase()),Za.applyArabicShaping&&(P=Za.applyArabicShaping(P)),P}(C.text,u,g)}),p}qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nA={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var _o=24,x0=Kn,Vb=function(p,u,g,C,P){var Q,V,K=8*P-C-1,te=(1<<K)-1,he=te>>1,h=-7,l=g?P-1:0,f=g?-1:1,v=p[u+l];for(l+=f,Q=v&(1<<-h)-1,v>>=-h,h+=K;h>0;Q=256*Q+p[u+l],l+=f,h-=8);for(V=Q&(1<<-h)-1,Q>>=-h,h+=C;h>0;V=256*V+p[u+l],l+=f,h-=8);if(Q===0)Q=1-he;else{if(Q===te)return V?NaN:1/0*(v?-1:1);V+=Math.pow(2,C),Q-=he}return(v?-1:1)*V*Math.pow(2,Q-C)},Hb=function(p,u,g,C,P,Q){var V,K,te,he=8*Q-P-1,h=(1<<he)-1,l=h>>1,f=P===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=C?0:Q-1,E=C?1:-1,M=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(K=isNaN(u)?1:0,V=h):(V=Math.floor(Math.log(u)/Math.LN2),u*(te=Math.pow(2,-V))<1&&(V--,te*=2),(u+=V+l>=1?f/te:f*Math.pow(2,1-l))*te>=2&&(V++,te/=2),V+l>=h?(K=0,V=h):V+l>=1?(K=(u*te-1)*Math.pow(2,P),V+=l):(K=u*Math.pow(2,l-1)*Math.pow(2,P),V=0));P>=8;p[g+v]=255&K,v+=E,K/=256,P-=8);for(V=V<<P|K,he+=P;he>0;p[g+v]=255&V,v+=E,V/=256,he-=8);p[g+v-E]|=128*M};function Kn(p){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(p)?p:new Uint8Array(p||0),this.pos=0,this.type=0,this.length=this.buf.length}Kn.Varint=0,Kn.Fixed64=1,Kn.Bytes=2,Kn.Fixed32=5;var im=4294967296,Gb=1/im,jb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function pc(p){return p.type===Kn.Bytes?p.readVarint()+p.pos:p.pos+1}function Es(p,u,g){return g?4294967296*u+(p>>>0):4294967296*(u>>>0)+(p>>>0)}function w0(p,u,g){var C=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));g.realloc(C);for(var P=g.pos-1;P>=p;P--)g.buf[P+C]=g.buf[P]}function qb(p,u){for(var g=0;g<p.length;g++)u.writeVarint(p[g])}function $b(p,u){for(var g=0;g<p.length;g++)u.writeSVarint(p[g])}function Wn(p,u){for(var g=0;g<p.length;g++)u.writeFloat(p[g])}function B0(p,u){for(var g=0;g<p.length;g++)u.writeDouble(p[g])}function Kb(p,u){for(var g=0;g<p.length;g++)u.writeBoolean(p[g])}function Wb(p,u){for(var g=0;g<p.length;g++)u.writeFixed32(p[g])}function vh(p,u){for(var g=0;g<p.length;g++)u.writeSFixed32(p[g])}function Pd(p,u){for(var g=0;g<p.length;g++)u.writeFixed64(p[g])}function Xb(p,u){for(var g=0;g<p.length;g++)u.writeSFixed64(p[g])}function rm(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+16777216*p[u+3]}function Fd(p,u,g){p[g]=u,p[g+1]=u>>>8,p[g+2]=u>>>16,p[g+3]=u>>>24}function Zb(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+(p[u+3]<<24)}Kn.prototype={destroy:function(){this.buf=null},readFields:function(p,u,g){for(g=g||this.length;this.pos<g;){var C=this.readVarint(),P=C>>3,Q=this.pos;this.type=7&C,p(P,u,this),this.pos===Q&&this.skip(C)}return u},readMessage:function(p,u){return this.readFields(p,u,this.readVarint()+this.pos)},readFixed32:function(){var p=rm(this.buf,this.pos);return this.pos+=4,p},readSFixed32:function(){var p=Zb(this.buf,this.pos);return this.pos+=4,p},readFixed64:function(){var p=rm(this.buf,this.pos)+rm(this.buf,this.pos+4)*im;return this.pos+=8,p},readSFixed64:function(){var p=rm(this.buf,this.pos)+Zb(this.buf,this.pos+4)*im;return this.pos+=8,p},readFloat:function(){var p=Vb(this.buf,this.pos,!0,23,4);return this.pos+=4,p},readDouble:function(){var p=Vb(this.buf,this.pos,!0,52,8);return this.pos+=8,p},readVarint:function(p){var u,g,C=this.buf;return u=127&(g=C[this.pos++]),g<128?u:(u|=(127&(g=C[this.pos++]))<<7,g<128?u:(u|=(127&(g=C[this.pos++]))<<14,g<128?u:(u|=(127&(g=C[this.pos++]))<<21,g<128?u:function(P,Q,V){var K,te,he=V.buf;if(K=(112&(te=he[V.pos++]))>>4,te<128||(K|=(127&(te=he[V.pos++]))<<3,te<128)||(K|=(127&(te=he[V.pos++]))<<10,te<128)||(K|=(127&(te=he[V.pos++]))<<17,te<128)||(K|=(127&(te=he[V.pos++]))<<24,te<128)||(K|=(1&(te=he[V.pos++]))<<31,te<128))return Es(P,K,Q);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(g=C[this.pos]))<<28,p,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var p=this.readVarint();return p%2==1?(p+1)/-2:p/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var p=this.readVarint()+this.pos,u=this.pos;return this.pos=p,p-u>=12&&jb?function(g,C,P){return jb.decode(g.subarray(C,P))}(this.buf,u,p):function(g,C,P){for(var Q="",V=C;V<P;){var K,te,he,h=g[V],l=null,f=h>239?4:h>223?3:h>191?2:1;if(V+f>P)break;f===1?h<128&&(l=h):f===2?(192&(K=g[V+1]))==128&&(l=(31&h)<<6|63&K)<=127&&(l=null):f===3?(te=g[V+2],(192&(K=g[V+1]))==128&&(192&te)==128&&((l=(15&h)<<12|(63&K)<<6|63&te)<=2047||l>=55296&&l<=57343)&&(l=null)):f===4&&(te=g[V+2],he=g[V+3],(192&(K=g[V+1]))==128&&(192&te)==128&&(192&he)==128&&((l=(15&h)<<18|(63&K)<<12|(63&te)<<6|63&he)<=65535||l>=1114112)&&(l=null)),l===null?(l=65533,f=1):l>65535&&(l-=65536,Q+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),Q+=String.fromCharCode(l),V+=f}return Q}(this.buf,u,p)},readBytes:function(){var p=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,p);return this.pos=p,u},readPackedVarint:function(p,u){if(this.type!==Kn.Bytes)return p.push(this.readVarint(u));var g=pc(this);for(p=p||[];this.pos<g;)p.push(this.readVarint(u));return p},readPackedSVarint:function(p){if(this.type!==Kn.Bytes)return p.push(this.readSVarint());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readSVarint());return p},readPackedBoolean:function(p){if(this.type!==Kn.Bytes)return p.push(this.readBoolean());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readBoolean());return p},readPackedFloat:function(p){if(this.type!==Kn.Bytes)return p.push(this.readFloat());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readFloat());return p},readPackedDouble:function(p){if(this.type!==Kn.Bytes)return p.push(this.readDouble());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readDouble());return p},readPackedFixed32:function(p){if(this.type!==Kn.Bytes)return p.push(this.readFixed32());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readFixed32());return p},readPackedSFixed32:function(p){if(this.type!==Kn.Bytes)return p.push(this.readSFixed32());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed32());return p},readPackedFixed64:function(p){if(this.type!==Kn.Bytes)return p.push(this.readFixed64());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readFixed64());return p},readPackedSFixed64:function(p){if(this.type!==Kn.Bytes)return p.push(this.readSFixed64());var u=pc(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed64());return p},skip:function(p){var u=7&p;if(u===Kn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Kn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Kn.Fixed32)this.pos+=4;else{if(u!==Kn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(p,u){this.writeVarint(p<<3|u)},realloc:function(p){for(var u=this.length||16;u<this.pos+p;)u*=2;if(u!==this.length){var g=new Uint8Array(u);g.set(this.buf),this.buf=g,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(p){this.realloc(4),Fd(this.buf,p,this.pos),this.pos+=4},writeSFixed32:function(p){this.realloc(4),Fd(this.buf,p,this.pos),this.pos+=4},writeFixed64:function(p){this.realloc(8),Fd(this.buf,-1&p,this.pos),Fd(this.buf,Math.floor(p*Gb),this.pos+4),this.pos+=8},writeSFixed64:function(p){this.realloc(8),Fd(this.buf,-1&p,this.pos),Fd(this.buf,Math.floor(p*Gb),this.pos+4),this.pos+=8},writeVarint:function(p){(p=+p||0)>268435455||p<0?function(u,g){var C,P;if(u>=0?(C=u%4294967296|0,P=u/4294967296|0):(P=~(-u/4294967296),4294967295^(C=~(-u%4294967296))?C=C+1|0:(C=0,P=P+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(Q,V,K){K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,K.buf[K.pos]=127&(Q>>>=7)}(C,0,g),function(Q,V){var K=(7&Q)<<4;V.buf[V.pos++]|=K|((Q>>>=3)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q)))))}(P,g)}(p,this):(this.realloc(4),this.buf[this.pos++]=127&p|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=p>>>7&127))))},writeSVarint:function(p){this.writeVarint(p<0?2*-p-1:2*p)},writeBoolean:function(p){this.writeVarint(!!p)},writeString:function(p){p=String(p),this.realloc(4*p.length),this.pos++;var u=this.pos;this.pos=function(C,P,Q){for(var V,K,te=0;te<P.length;te++){if((V=P.charCodeAt(te))>55295&&V<57344){if(!K){V>56319||te+1===P.length?(C[Q++]=239,C[Q++]=191,C[Q++]=189):K=V;continue}if(V<56320){C[Q++]=239,C[Q++]=191,C[Q++]=189,K=V;continue}V=K-55296<<10|V-56320|65536,K=null}else K&&(C[Q++]=239,C[Q++]=191,C[Q++]=189,K=null);V<128?C[Q++]=V:(V<2048?C[Q++]=V>>6|192:(V<65536?C[Q++]=V>>12|224:(C[Q++]=V>>18|240,C[Q++]=V>>12&63|128),C[Q++]=V>>6&63|128),C[Q++]=63&V|128)}return Q}(this.buf,p,this.pos);var g=this.pos-u;g>=128&&w0(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g},writeFloat:function(p){this.realloc(4),Hb(this.buf,p,this.pos,!0,23,4),this.pos+=4},writeDouble:function(p){this.realloc(8),Hb(this.buf,p,this.pos,!0,52,8),this.pos+=8},writeBytes:function(p){var u=p.length;this.writeVarint(u),this.realloc(u);for(var g=0;g<u;g++)this.buf[this.pos++]=p[g]},writeRawMessage:function(p,u){this.pos++;var g=this.pos;p(u,this);var C=this.pos-g;C>=128&&w0(g,C,this),this.pos=g-1,this.writeVarint(C),this.pos+=C},writeMessage:function(p,u,g){this.writeTag(p,Kn.Bytes),this.writeRawMessage(u,g)},writePackedVarint:function(p,u){u.length&&this.writeMessage(p,qb,u)},writePackedSVarint:function(p,u){u.length&&this.writeMessage(p,$b,u)},writePackedBoolean:function(p,u){u.length&&this.writeMessage(p,Kb,u)},writePackedFloat:function(p,u){u.length&&this.writeMessage(p,Wn,u)},writePackedDouble:function(p,u){u.length&&this.writeMessage(p,B0,u)},writePackedFixed32:function(p,u){u.length&&this.writeMessage(p,Wb,u)},writePackedSFixed32:function(p,u){u.length&&this.writeMessage(p,vh,u)},writePackedFixed64:function(p,u){u.length&&this.writeMessage(p,Pd,u)},writePackedSFixed64:function(p,u){u.length&&this.writeMessage(p,Xb,u)},writeBytesField:function(p,u){this.writeTag(p,Kn.Bytes),this.writeBytes(u)},writeFixed32Field:function(p,u){this.writeTag(p,Kn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(p,u){this.writeTag(p,Kn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(p,u){this.writeTag(p,Kn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(p,u){this.writeTag(p,Kn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(p,u){this.writeTag(p,Kn.Varint),this.writeVarint(u)},writeSVarintField:function(p,u){this.writeTag(p,Kn.Varint),this.writeSVarint(u)},writeStringField:function(p,u){this.writeTag(p,Kn.Bytes),this.writeString(u)},writeFloatField:function(p,u){this.writeTag(p,Kn.Fixed32),this.writeFloat(u)},writeDoubleField:function(p,u){this.writeTag(p,Kn.Fixed64),this.writeDouble(u)},writeBooleanField:function(p,u){this.writeVarintField(p,!!u)}};var C0=m(x0);const E0=3;function FT(p,u,g){p===1&&g.readMessage(DT,u)}function DT(p,u,g){if(p===3){const{id:C,bitmap:P,width:Q,height:V,left:K,top:te,advance:he}=g.readMessage(RT,{});u.push({id:C,bitmap:new Au({width:Q+2*E0,height:V+2*E0},P),metrics:{width:Q,height:V,left:K,top:te,advance:he}})}}function RT(p,u,g){p===1?u.id=g.readVarint():p===2?u.bitmap=g.readBytes():p===3?u.width=g.readVarint():p===4?u.height=g.readVarint():p===5?u.left=g.readSVarint():p===6?u.top=g.readSVarint():p===7&&(u.advance=g.readVarint())}const Jb=E0;function Yf(p){let u=0,g=0;for(const V of p)u+=V.w*V.h,g=Math.max(g,V.w);p.sort((V,K)=>K.h-V.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),g),h:1/0}];let P=0,Q=0;for(const V of p)for(let K=C.length-1;K>=0;K--){const te=C[K];if(!(V.w>te.w||V.h>te.h)){if(V.x=te.x,V.y=te.y,Q=Math.max(Q,V.y+V.h),P=Math.max(P,V.x+V.w),V.w===te.w&&V.h===te.h){const he=C.pop();K<C.length&&(C[K]=he)}else V.h===te.h?(te.x+=V.w,te.w-=V.w):V.w===te.w?(te.y+=V.h,te.h-=V.h):(C.push({x:te.x+V.w,y:te.y,w:te.w-V.w,h:V.h}),te.y+=V.h,te.h-=V.h);break}}return{w:P,h:Q,fill:u/(P*Q)||0}}const No=1;class nm{constructor(u,g){let{pixelRatio:C,version:P,stretchX:Q,stretchY:V,content:K}=g;this.paddedRect=u,this.pixelRatio=C,this.stretchX=Q,this.stretchY=V,this.content=K,this.version=P}get tl(){return[this.paddedRect.x+No,this.paddedRect.y+No]}get br(){return[this.paddedRect.x+this.paddedRect.w-No,this.paddedRect.y+this.paddedRect.h-No]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*No)/this.pixelRatio,(this.paddedRect.h-2*No)/this.pixelRatio]}}class sm{constructor(u,g){const C={},P={};this.haveRenderCallbacks=[];const Q=[];this.addImages(u,C,Q),this.addImages(g,P,Q);const{w:V,h:K}=Yf(Q),te=new gl({width:V||1,height:K||1});for(const he in u){const h=u[he],l=C[he].paddedRect;gl.copy(h.data,te,{x:0,y:0},{x:l.x+No,y:l.y+No},h.data)}for(const he in g){const h=g[he],l=P[he].paddedRect,f=l.x+No,v=l.y+No,E=h.data.width,M=h.data.height;gl.copy(h.data,te,{x:0,y:0},{x:f,y:v},h.data),gl.copy(h.data,te,{x:0,y:M-1},{x:f,y:v-1},{width:E,height:1}),gl.copy(h.data,te,{x:0,y:0},{x:f,y:v+M},{width:E,height:1}),gl.copy(h.data,te,{x:E-1,y:0},{x:f-1,y:v},{width:1,height:M}),gl.copy(h.data,te,{x:0,y:0},{x:f+E,y:v},{width:1,height:M})}this.image=te,this.iconPositions=C,this.patternPositions=P}addImages(u,g,C){for(const P in u){const Q=u[P],V={x:0,y:0,w:Q.data.width+2*No,h:Q.data.height+2*No};C.push(V),g[P]=new nm(V,Q),Q.hasRenderCallback&&this.haveRenderCallbacks.push(P)}}patchUpdatedImages(u,g){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in u.updatedImages)this.patchUpdatedImage(this.iconPositions[C],u.getImage(C),g),this.patchUpdatedImage(this.patternPositions[C],u.getImage(C),g)}patchUpdatedImage(u,g,C){if(!u||!g||u.version===g.version)return;u.version=g.version;const[P,Q]=u.tl;C.update(g.data,void 0,{x:P,y:Q})}}var Uu;Pi("ImagePosition",nm),Pi("ImageAtlas",sm),c.ah=void 0,(Uu=c.ah||(c.ah={}))[Uu.none=0]="none",Uu[Uu.horizontal=1]="horizontal",Uu[Uu.vertical=2]="vertical",Uu[Uu.horizontalOnly=3]="horizontalOnly";const ep=-17;class tp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,g){const C=new tp;return C.scale=u||1,C.fontStack=g,C}static forImage(u){const g=new tp;return g.imageName=u,g}}class Dd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,g){const C=new Dd;for(let P=0;P<u.sections.length;P++){const Q=u.sections[P];Q.image?C.addImageSection(Q):C.addTextSection(Q,g)}return C}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let g="";for(let C=0;C<u.length;C++){const P=u.charCodeAt(C+1)||null,Q=u.charCodeAt(C-1)||null;g+=P&&Pc(P)&&!nA[u[C+1]]||Q&&Pc(Q)&&!nA[u[C-1]]||!nA[u[C]]?u[C]:nA[u[C]]}return g}(this.text)}trim(){let u=0;for(let C=0;C<this.text.length&&rp[this.text.charCodeAt(C)];C++)u++;let g=this.text.length;for(let C=this.text.length-1;C>=0&&C>=u&&rp[this.text.charCodeAt(C)];C--)g--;this.text=this.text.substring(u,g),this.sectionIndex=this.sectionIndex.slice(u,g)}substring(u,g){const C=new Dd;return C.text=this.text.substring(u,g),C.sectionIndex=this.sectionIndex.slice(u,g),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,g)=>Math.max(u,this.sections[g].scale),0)}addTextSection(u,g){this.text+=u.text,this.sections.push(tp.forText(u.scale,u.fontStack||g));const C=this.sections.length-1;for(let P=0;P<u.text.length;++P)this.sectionIndex.push(C)}addImageSection(u){const g=u.image?u.image.name:"";if(g.length===0)return void Je("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(tp.forImage(g)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ip(p,u,g,C,P,Q,V,K,te,he,h,l,f,v,E,M){const D=Dd.fromFeature(p,P);let G;l===c.ah.vertical&&D.verticalizePunctuation();const{processBidirectionalText:$,processStyledBidirectionalText:X}=Za;if($&&D.sections.length===1){G=[];const me=$(D.toString(),oA(D,he,Q,u,C,v,E));for(const Be of me){const Se=new Dd;Se.text=Be,Se.sections=D.sections;for(let ke=0;ke<Be.length;ke++)Se.sectionIndex.push(0);G.push(Se)}}else if(X){G=[];const me=X(D.text,D.sectionIndex,oA(D,he,Q,u,C,v,E));for(const Be of me){const Se=new Dd;Se.text=Be[0],Se.sectionIndex=Be[1],Se.sections=D.sections,G.push(Se)}}else G=function(me,Be){const Se=[],ke=me.text;let He=0;for(const qe of Be)Se.push(me.substring(He,qe)),He=qe;return He<ke.length&&Se.push(me.substring(He,ke.length)),Se}(D,oA(D,he,Q,u,C,v,E));const se=[],Ae={positionedLines:se,text:D.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:l,iconsInText:!1,verticalizable:!1};return function(me,Be,Se,ke,He,qe,ct,Ye,tt,gt,St,Xt){let xi=0,oi=ep,Ai=0,fi=0;const Fi=Ye==="right"?1:Ye==="left"?0:.5;let ai=0;for(const Dr of He){Dr.trim();const zr=Dr.getMaxScale(),pn=(zr-1)*_o,os={positionedGlyphs:[],lineOffset:0};me.positionedLines[ai]=os;const Nn=os.positionedGlyphs;let vn=0;if(!Dr.length()){oi+=qe,++ai;continue}for(let cn=0;cn<Dr.length();cn++){const vr=Dr.getSection(cn),zn=Dr.getSectionIndex(cn),un=Dr.getCharCode(cn);let en=0,ds=null,Ss=null,_s=null,Xs=_o;const Ts=!(tt===c.ah.horizontal||!St&&!jl(un)||St&&(rp[un]||(Zt=un,Ei.Arabic(Zt)||Ei["Arabic Supplement"](Zt)||Ei["Arabic Extended-A"](Zt)||Ei["Arabic Presentation Forms-A"](Zt)||Ei["Arabic Presentation Forms-B"](Zt))));if(vr.imageName){const Fn=ke[vr.imageName];if(!Fn)continue;_s=vr.imageName,me.iconsInText=me.iconsInText||!0,Ss=Fn.paddedRect;const xr=Fn.displaySize;vr.scale=vr.scale*_o/Xt,ds={width:xr[0],height:xr[1],left:No,top:-Jb,advance:Ts?xr[1]:xr[0]},en=pn+(_o-xr[1]*vr.scale),Xs=ds.advance;const Us=Ts?xr[0]*vr.scale-_o*zr:xr[1]*vr.scale-_o*zr;Us>0&&Us>vn&&(vn=Us)}else{const Fn=Se[vr.fontStack],xr=Fn&&Fn[un];if(xr&&xr.rect)Ss=xr.rect,ds=xr.metrics;else{const Us=Be[vr.fontStack],oo=Us&&Us[un];if(!oo)continue;ds=oo.metrics}en=(zr-vr.scale)*_o}Ts?(me.verticalizable=!0,Nn.push({glyph:un,imageName:_s,x:xi,y:oi+en,vertical:Ts,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:zn,metrics:ds,rect:Ss}),xi+=Xs*vr.scale+gt):(Nn.push({glyph:un,imageName:_s,x:xi,y:oi+en,vertical:Ts,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:zn,metrics:ds,rect:Ss}),xi+=ds.advance*vr.scale+gt)}Nn.length!==0&&(Ai=Math.max(xi-gt,Ai),am(Nn,0,Nn.length-1,Fi,vn)),xi=0;const Pn=qe*zr+vn;os.lineOffset=Math.max(vn,pn),oi+=Pn,fi=Math.max(Pn,fi),++ai}var Zt;const Vi=oi-ep,{horizontalAlign:Qi,verticalAlign:gr}=Od(ct);(function(Dr,zr,pn,os,Nn,vn,Pn,cn,vr){const zn=(zr-pn)*Nn;let un=0;un=vn!==Pn?-cn*os-ep:(-os*vr+.5)*Pn;for(const en of Dr)for(const ds of en.positionedGlyphs)ds.x+=zn,ds.y+=un})(me.positionedLines,Fi,Qi,gr,Ai,fi,qe,Vi,He.length),me.top+=-gr*Vi,me.bottom=me.top+Vi,me.left+=-Qi*Ai,me.right=me.left+Ai}(Ae,u,g,C,G,V,K,te,l,he,f,M),!function(me){for(const Be of me)if(Be.positionedGlyphs.length!==0)return!1;return!0}(se)&&Ae}const rp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function om(p,u,g,C,P,Q){if(u.imageName){const V=C[u.imageName];return V?V.displaySize[0]*u.scale*_o/Q+P:0}{const V=g[u.fontStack],K=V&&V[p];return K?K.metrics.advance*u.scale+P:0}}function S0(p,u,g,C){const P=Math.pow(p-u,2);return C?p<u?P/2:2*P:P+Math.abs(g)*g}function sA(p,u,g){let C=0;return p===10&&(C-=1e4),g&&(C+=150),p!==40&&p!==65288||(C+=50),u!==41&&u!==65289||(C+=50),C}function Rd(p,u,g,C,P,Q){let V=null,K=S0(u,g,P,Q);for(const te of C){const he=S0(u-te.x,g,P,Q)+te.badness;he<=K&&(V=te,K=he)}return{index:p,x:u,priorBreak:V,badness:K}}function kd(p){return p?kd(p.priorBreak).concat(p.index):[]}function oA(p,u,g,C,P,Q,V){if(Q!=="point")return[];if(!p)return[];const K=[],te=function(f,v,E,M,D,G){let $=0;for(let X=0;X<f.length();X++){const se=f.getSection(X);$+=om(f.getCharCode(X),se,M,D,v,G)}return $/Math.max(1,Math.ceil($/E))}(p,u,g,C,P,V),he=p.text.indexOf("​")>=0;let h=0;for(let f=0;f<p.length();f++){const v=p.getSection(f),E=p.getCharCode(f);if(rp[E]||(h+=om(E,v,C,P,u,V)),f<p.length()-1){const M=!((l=E)<11904||!(Ei["Bopomofo Extended"](l)||Ei.Bopomofo(l)||Ei["CJK Compatibility Forms"](l)||Ei["CJK Compatibility Ideographs"](l)||Ei["CJK Compatibility"](l)||Ei["CJK Radicals Supplement"](l)||Ei["CJK Strokes"](l)||Ei["CJK Symbols and Punctuation"](l)||Ei["CJK Unified Ideographs Extension A"](l)||Ei["CJK Unified Ideographs"](l)||Ei["Enclosed CJK Letters and Months"](l)||Ei["Halfwidth and Fullwidth Forms"](l)||Ei.Hiragana(l)||Ei["Ideographic Description Characters"](l)||Ei["Kangxi Radicals"](l)||Ei["Katakana Phonetic Extensions"](l)||Ei.Katakana(l)||Ei["Vertical Forms"](l)||Ei["Yi Radicals"](l)||Ei["Yi Syllables"](l)));(yl[E]||M||v.imageName)&&K.push(Rd(f+1,h,te,K,sA(E,p.getCharCode(f+1),M&&he),!1))}}var l;return kd(Rd(p.length(),h,te,K,0,!0))}function Od(p){let u=.5,g=.5;switch(p){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:u,verticalAlign:g}}function am(p,u,g,C,P){if(!C&&!P)return;const Q=p[g],V=(p[g].x+Q.metrics.advance*Q.scale)*C;for(let K=u;K<=g;K++)p[K].x-=V,p[K].y+=P}function kT(p,u,g){const{horizontalAlign:C,verticalAlign:P}=Od(g),Q=u[0]-p.displaySize[0]*C,V=u[1]-p.displaySize[1]*P;return{image:p,top:V,bottom:V+p.displaySize[1],left:Q,right:Q+p.displaySize[0]}}function T0(p,u,g,C,P,Q){const V=p.image;let K;if(V.content){const D=V.content,G=V.pixelRatio||1;K=[D[0]/G,D[1]/G,V.displaySize[0]-D[2]/G,V.displaySize[1]-D[3]/G]}const te=u.left*Q,he=u.right*Q;let h,l,f,v;g==="width"||g==="both"?(v=P[0]+te-C[3],l=P[0]+he+C[1]):(v=P[0]+(te+he-V.displaySize[0])/2,l=v+V.displaySize[0]);const E=u.top*Q,M=u.bottom*Q;return g==="height"||g==="both"?(h=P[1]+E-C[0],f=P[1]+M+C[2]):(h=P[1]+(E+M-V.displaySize[1])/2,f=h+V.displaySize[1]),{image:V,top:h,right:l,bottom:f,left:v,collisionPadding:K}}const Ud=255,Nu=128,bh=Ud*Nu;function I0(p,u){const{expression:g}=u;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new yn(p+1))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:P}=g;let Q=0;for(;Q<C.length&&C[Q]<=p;)Q++;Q=Math.max(0,Q-1);let V=Q;for(;V<C.length&&C[V]<p+1;)V++;V=Math.min(C.length-1,V);const K=C[Q],te=C[V];return g.kind==="composite"?{kind:"composite",minZoom:K,maxZoom:te,interpolationType:P}:{kind:"camera",minZoom:K,maxZoom:te,minSize:g.evaluate(new yn(K)),maxSize:g.evaluate(new yn(te)),interpolationType:P}}}function np(p,u,g){let C="never";const P=p.get(u);return P?C=P:p.get(g)&&(C="always"),C}const L0=Ou.VectorTileFeature.types,OT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lm(p,u,g,C,P,Q,V,K,te,he,h,l,f){const v=K?Math.min(bh,Math.round(K[0])):0,E=K?Math.min(bh,Math.round(K[1])):0;p.emplaceBack(u,g,Math.round(32*C),Math.round(32*P),Q,V,(v<<1)+(te?1:0),E,16*he,16*h,256*l,256*f)}function cm(p,u,g){p.emplaceBack(u.x,u.y,g),p.emplaceBack(u.x,u.y,g),p.emplaceBack(u.x,u.y,g),p.emplaceBack(u.x,u.y,g)}function sp(p){for(const u of p.sections)if(Rc(u.text))return!0;return!1}class Vc{constructor(u){this.layoutVertexArray=new pe,this.indexArray=new Ke,this.programConfigurations=u,this.segments=new bt,this.dynamicLayoutVertexArray=new xe,this.opacityVertexArray=new Pe,this.hasVisibleVertices=!1,this.placedSymbolArray=new _}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,g,C,P){this.isEmpty()||(C&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Nb.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,v0.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,OT,!0),this.opacityVertexBuffer.itemSize=1),(C||P)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pi("SymbolBuffers",Vc);class zu{constructor(u,g,C){this.layoutVertexArray=new u,this.layoutAttributes=g,this.indexArray=new C,this.segments=new bt,this.collisionVertexArray=new rt}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,zb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pi("CollisionBuffers",zu);class NA{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(V=>V.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jh([]),this.placementViewportMatrix=Jh([]);const g=this.layers[0]._unevaluatedLayout._values;this.textSizeData=I0(this.zoom,g["text-size"]),this.iconSizeData=I0(this.zoom,g["icon-size"]);const C=this.layers[0].layout,P=C.get("symbol-sort-key"),Q=C.get("symbol-z-order");this.canOverlap=np(C,"text-overlap","text-allow-overlap")!=="never"||np(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=Q!=="viewport-y"&&!P.isConstant(),this.sortFeaturesByY=(Q==="viewport-y"||Q==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(V=>c.ah[V])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=u.sourceID}createArrays(){this.text=new Vc(new Mn(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new Vc(new Mn(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new U,this.lineVertexArray=new H,this.symbolInstances=new S,this.textAnchorOffsets=new w}calculateGlyphDependencies(u,g,C,P,Q){for(let V=0;V<u.length;V++)if(g[u.charCodeAt(V)]=!0,(C||P)&&Q){const K=nA[u.charAt(V)];K&&(g[K.charCodeAt(0)]=!0)}}populate(u,g,C){const P=this.layers[0],Q=P.layout,V=Q.get("text-font"),K=Q.get("text-field"),te=Q.get("icon-image"),he=(K.value.kind!=="constant"||K.value.value instanceof lr&&!K.value.value.isEmpty()||K.value.value.toString().length>0)&&(V.value.kind!=="constant"||V.value.value.length>0),h=te.value.kind!=="constant"||!!te.value.value||Object.keys(te.parameters).length>0,l=Q.get("symbol-sort-key");if(this.features=[],!he&&!h)return;const f=g.iconDependencies,v=g.glyphDependencies,E=g.availableImages,M=new yn(this.zoom);for(const{feature:D,id:G,index:$,sourceLayerIndex:X}of u){const se=P._featureFilter.needGeometry,Ae=Ks(D,se);if(!P._featureFilter.filter(M,Ae,C))continue;let me,Be;if(se||(Ae.geometry=ks(D)),he){const ke=P.getValueAndResolveTokens("text-field",Ae,C,E),He=lr.factory(ke);sp(He)&&(this.hasRTLText=!0),(!this.hasRTLText||Za.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&Za.isParsed())&&(me=PT(He,P,Ae))}if(h){const ke=P.getValueAndResolveTokens("icon-image",Ae,C,E);Be=ke instanceof xn?ke:xn.fromString(ke)}if(!me&&!Be)continue;const Se=this.sortFeaturesByKey?l.evaluate(Ae,{},C):void 0;if(this.features.push({id:G,text:me,icon:Be,index:$,sourceLayerIndex:X,geometry:Ae.geometry,properties:D.properties,type:L0[D.type],sortKey:Se}),Be&&(f[Be.name]=!0),me){const ke=V.evaluate(Ae,{},C).join(","),He=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const qe of me.sections)if(qe.image)f[qe.image.name]=!0;else{const ct=no(me.toString()),Ye=qe.fontStack||ke,tt=v[Ye]=v[Ye]||{};this.calculateGlyphDependencies(qe.text,tt,He,this.allowVerticalPlacement,ct)}}}Q.get("symbol-placement")==="line"&&(this.features=function(D){const G={},$={},X=[];let se=0;function Ae(ke){X.push(D[ke]),se++}function me(ke,He,qe){const ct=$[ke];return delete $[ke],$[He]=ct,X[ct].geometry[0].pop(),X[ct].geometry[0]=X[ct].geometry[0].concat(qe[0]),ct}function Be(ke,He,qe){const ct=G[He];return delete G[He],G[ke]=ct,X[ct].geometry[0].shift(),X[ct].geometry[0]=qe[0].concat(X[ct].geometry[0]),ct}function Se(ke,He,qe){const ct=qe?He[0][He[0].length-1]:He[0][0];return`${ke}:${ct.x}:${ct.y}`}for(let ke=0;ke<D.length;ke++){const He=D[ke],qe=He.geometry,ct=He.text?He.text.toString():null;if(!ct){Ae(ke);continue}const Ye=Se(ct,qe),tt=Se(ct,qe,!0);if(Ye in $&&tt in G&&$[Ye]!==G[tt]){const gt=Be(Ye,tt,qe),St=me(Ye,tt,X[gt].geometry);delete G[Ye],delete $[tt],$[Se(ct,X[St].geometry,!0)]=St,X[gt].geometry=null}else Ye in $?me(Ye,tt,qe):tt in G?Be(Ye,tt,qe):(Ae(ke),G[Ye]=se-1,$[tt]=se-1)}return X.filter(ke=>ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,G)=>D.sortKey-G.sortKey)}update(u,g,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,g,this.layers,C),this.icon.programConfigurations.updatePaintArrays(u,g,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,g){const C=this.lineVertexArray.length;if(u.segment!==void 0){let P=u.dist(g[u.segment+1]),Q=u.dist(g[u.segment]);const V={};for(let K=u.segment+1;K<g.length;K++)V[K]={x:g[K].x,y:g[K].y,tileUnitDistanceFromAnchor:P},K<g.length-1&&(P+=g[K+1].dist(g[K]));for(let K=u.segment||0;K>=0;K--)V[K]={x:g[K].x,y:g[K].y,tileUnitDistanceFromAnchor:Q},K>0&&(Q+=g[K-1].dist(g[K]));for(let K=0;K<g.length;K++){const te=V[K];this.lineVertexArray.emplaceBack(te.x,te.y,te.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(u,g,C,P,Q,V,K,te,he,h,l,f){const v=u.indexArray,E=u.layoutVertexArray,M=u.segments.prepareSegment(4*g.length,E,v,this.canOverlap?V.sortKey:void 0),D=this.glyphOffsetArray.length,G=M.vertexLength,$=this.allowVerticalPlacement&&K===c.ah.vertical?Math.PI/2:0,X=V.text&&V.text.sections;for(let se=0;se<g.length;se++){const{tl:Ae,tr:me,bl:Be,br:Se,tex:ke,pixelOffsetTL:He,pixelOffsetBR:qe,minFontScaleX:ct,minFontScaleY:Ye,glyphOffset:tt,isSDF:gt,sectionIndex:St}=g[se],Xt=M.vertexLength,xi=tt[1];lm(E,te.x,te.y,Ae.x,xi+Ae.y,ke.x,ke.y,C,gt,He.x,He.y,ct,Ye),lm(E,te.x,te.y,me.x,xi+me.y,ke.x+ke.w,ke.y,C,gt,qe.x,He.y,ct,Ye),lm(E,te.x,te.y,Be.x,xi+Be.y,ke.x,ke.y+ke.h,C,gt,He.x,qe.y,ct,Ye),lm(E,te.x,te.y,Se.x,xi+Se.y,ke.x+ke.w,ke.y+ke.h,C,gt,qe.x,qe.y,ct,Ye),cm(u.dynamicLayoutVertexArray,te,$),v.emplaceBack(Xt,Xt+1,Xt+2),v.emplaceBack(Xt+1,Xt+2,Xt+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),se!==g.length-1&&St===g[se+1].sectionIndex||u.programConfigurations.populatePaintArrays(E.length,V,V.index,{},f,X&&X[St])}u.placedSymbolArray.emplaceBack(te.x,te.y,D,this.glyphOffsetArray.length-D,G,he,h,te.segment,C?C[0]:0,C?C[1]:0,P[0],P[1],K,0,!1,0,l)}_addCollisionDebugVertex(u,g,C,P,Q,V){return g.emplaceBack(0,0),u.emplaceBack(C.x,C.y,P,Q,Math.round(V.x),Math.round(V.y))}addCollisionDebugVertices(u,g,C,P,Q,V,K){const te=Q.segments.prepareSegment(4,Q.layoutVertexArray,Q.indexArray),he=te.vertexLength,h=Q.layoutVertexArray,l=Q.collisionVertexArray,f=K.anchorX,v=K.anchorY;this._addCollisionDebugVertex(h,l,V,f,v,new F(u,g)),this._addCollisionDebugVertex(h,l,V,f,v,new F(C,g)),this._addCollisionDebugVertex(h,l,V,f,v,new F(C,P)),this._addCollisionDebugVertex(h,l,V,f,v,new F(u,P)),te.vertexLength+=4;const E=Q.indexArray;E.emplaceBack(he,he+1),E.emplaceBack(he+1,he+2),E.emplaceBack(he+2,he+3),E.emplaceBack(he+3,he),te.primitiveLength+=4}addDebugCollisionBoxes(u,g,C,P){for(let Q=u;Q<g;Q++){const V=this.collisionBoxArray.get(Q);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,P?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zu(Le,b0.members,Re),this.iconCollisionBox=new zu(Le,b0.members,Re);for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.addDebugCollisionBoxes(g.textBoxStartIndex,g.textBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.iconBoxStartIndex,g.iconBoxEndIndex,g,!1),this.addDebugCollisionBoxes(g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,!1)}}_deserializeCollisionBoxesForSymbol(u,g,C,P,Q,V,K,te,he){const h={};for(let l=g;l<C;l++){const f=u.get(l);h.textBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.textFeatureIndex=f.featureIndex;break}for(let l=P;l<Q;l++){const f=u.get(l);h.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalTextFeatureIndex=f.featureIndex;break}for(let l=V;l<K;l++){const f=u.get(l);h.iconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.iconFeatureIndex=f.featureIndex;break}for(let l=te;l<he;l++){const f=u.get(l);h.verticalIconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalIconFeatureIndex=f.featureIndex;break}return h}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const C=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,g){const C=u.placedSymbolArray.get(g),P=C.vertexStartIndex+4*C.numGlyphs;for(let Q=C.vertexStartIndex;Q<P;Q+=4)u.indexArray.emplaceBack(Q,Q+1,Q+2),u.indexArray.emplaceBack(Q+1,Q+2,Q+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(u),C=Math.cos(u),P=[],Q=[],V=[];for(let K=0;K<this.symbolInstances.length;++K){V.push(K);const te=this.symbolInstances.get(K);P.push(0|Math.round(g*te.anchorX+C*te.anchorY)),Q.push(te.featureIndex)}return V.sort((K,te)=>P[K]-P[te]||Q[te]-Q[K]),V}addToSortKeyRanges(u,g){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===g?C.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const C=this.symbolInstances.get(g);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((P,Q,V)=>{P>=0&&V.indexOf(P)===Q&&this.addIndicesForPlacedSymbol(this.text,P)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let um,Yb;Pi("SymbolBucket",NA,{omit:["layers","collisionBoxArray","features","compareText"]}),NA.MAX_GLYPHS=65535,NA.addDynamicAttributes=cm;var M0={get paint(){return Yb=Yb||new Cs({"icon-opacity":new sr(xt.paint_symbol["icon-opacity"]),"icon-color":new sr(xt.paint_symbol["icon-color"]),"icon-halo-color":new sr(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new sr(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sr(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new bi(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new bi(xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new sr(xt.paint_symbol["text-opacity"]),"text-color":new sr(xt.paint_symbol["text-color"],{runtimeType:Gt,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new sr(xt.paint_symbol["text-halo-color"]),"text-halo-width":new sr(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new sr(xt.paint_symbol["text-halo-blur"]),"text-translate":new bi(xt.paint_symbol["text-translate"]),"text-translate-anchor":new bi(xt.paint_symbol["text-translate-anchor"])})},get layout(){return um=um||new Cs({"symbol-placement":new bi(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new bi(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bi(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sr(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bi(xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bi(xt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bi(xt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bi(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new bi(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bi(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new sr(xt.layout_symbol["icon-size"]),"icon-text-fit":new bi(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bi(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new sr(xt.layout_symbol["icon-image"]),"icon-rotate":new sr(xt.layout_symbol["icon-rotate"]),"icon-padding":new sr(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new bi(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new sr(xt.layout_symbol["icon-offset"]),"icon-anchor":new sr(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bi(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bi(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bi(xt.layout_symbol["text-rotation-alignment"]),"text-field":new sr(xt.layout_symbol["text-field"]),"text-font":new sr(xt.layout_symbol["text-font"]),"text-size":new sr(xt.layout_symbol["text-size"]),"text-max-width":new sr(xt.layout_symbol["text-max-width"]),"text-line-height":new bi(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new sr(xt.layout_symbol["text-letter-spacing"]),"text-justify":new sr(xt.layout_symbol["text-justify"]),"text-radial-offset":new sr(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bi(xt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sr(xt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sr(xt.layout_symbol["text-anchor"]),"text-max-angle":new bi(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new bi(xt.layout_symbol["text-writing-mode"]),"text-rotate":new sr(xt.layout_symbol["text-rotate"]),"text-padding":new bi(xt.layout_symbol["text-padding"]),"text-keep-upright":new bi(xt.layout_symbol["text-keep-upright"]),"text-transform":new sr(xt.layout_symbol["text-transform"]),"text-offset":new sr(xt.layout_symbol["text-offset"]),"text-allow-overlap":new bi(xt.layout_symbol["text-allow-overlap"]),"text-overlap":new bi(xt.layout_symbol["text-overlap"]),"text-ignore-placement":new bi(xt.layout_symbol["text-ignore-placement"]),"text-optional":new bi(xt.layout_symbol["text-optional"])})}};class op{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:Zi,this.defaultValue=u}evaluate(u){if(u.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(u.formattedSection))return g.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pi("FormatSectionOverride",op,{omit:["defaultValue"]});class Nd extends jn{constructor(u){super(u,M0)}recalculate(u,g){if(super.recalculate(u,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const P=[];for(const Q of C)P.indexOf(Q)<0&&P.push(Q);this.layout._values["text-writing-mode"]=P}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,g,C,P){const Q=this.layout.get(u).evaluate(g,{},C,P),V=this._unevaluatedLayout._values[u];return V.isDataDriven()||Lr(V.value)||!Q?Q:function(K,te){return te.replace(/{([^{}]+)}/g,(he,h)=>K&&h in K?String(K[h]):"")}(g.properties,Q)}createBucket(u){return new NA(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of M0.paint.overridableProperties){if(!Nd.hasPaintOverride(this.layout,u))continue;const g=this.paint.get(u),C=new op(g),P=new Br(C,g.property.specification);let Q=null;Q=g.value.kind==="constant"||g.value.kind==="source"?new qs("source",P):new eo("composite",P,g.value.zoomStops),this.paint._values[u]=new _a(g.property,Q,g.parameters)}}_handleOverridablePaintPropertyUpdate(u,g,C){return!(!this.layout||g.isDataDriven()||C.isDataDriven())&&Nd.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,g){const C=u.get("text-field"),P=M0.paint.properties[g];let Q=!1;const V=K=>{for(const te of K)if(P.overrides&&P.overrides.hasOverride(te))return void(Q=!0)};if(C.value.kind==="constant"&&C.value.value instanceof lr)V(C.value.value.sections);else if(C.value.kind==="source"){const K=he=>{Q||(he instanceof ws&&Wi(he.value)===Sr?V(he.value.sections):he instanceof Wa?V(he.sections):he.eachChild(K))},te=C.value;te._styleExpression&&K(te._styleExpression.expression)}return Q}}let ex;var P0={get paint(){return ex=ex||new Cs({"background-color":new bi(xt.paint_background["background-color"]),"background-pattern":new kc(xt.paint_background["background-pattern"]),"background-opacity":new bi(xt.paint_background["background-opacity"])})}};class F0 extends jn{constructor(u){super(u,P0)}}let zA;var tx={get paint(){return zA=zA||new Cs({"raster-opacity":new bi(xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new bi(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bi(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bi(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new bi(xt.paint_raster["raster-saturation"]),"raster-contrast":new bi(xt.paint_raster["raster-contrast"]),"raster-resampling":new bi(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new bi(xt.paint_raster["raster-fade-duration"])})}};class ix extends jn{constructor(u){super(u,tx)}}class D0 extends jn{constructor(u){super(u,{}),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rx{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zd=63710088e-1;class xh{constructor(u,g){if(isNaN(u)||isNaN(g))throw new Error(`Invalid LngLat object: (${u}, ${g})`);if(this.lng=+u,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xh(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const g=Math.PI/180,C=this.lat*g,P=u.lat*g,Q=Math.sin(C)*Math.sin(P)+Math.cos(C)*Math.cos(P)*Math.cos((u.lng-this.lng)*g);return zd*Math.acos(Math.min(Q,1))}static convert(u){if(u instanceof xh)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new xh(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new xh(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const nx=2*Math.PI*zd;function sx(p){return nx*Math.cos(p*Math.PI/180)}function R0(p){return(180+p)/360}function ox(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function ax(p,u){return p/sx(u)}function k0(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}class hm{constructor(u,g){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+g,this.z=+C}static fromLngLat(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=xh.convert(u);return new hm(R0(C.lng),ox(C.lat),ax(g,C.lat))}toLngLat(){return new xh(360*this.x-180,k0(this.y))}toAltitude(){return this.z*sx(k0(this.y))}meterInMercatorCoordinateUnits(){return 1/nx*(u=k0(this.y),1/Math.cos(u*Math.PI/180));var u}}function Am(p,u,g){var C=2*Math.PI*6378137/256/Math.pow(2,g);return[p*C-2*Math.PI*6378137/2,u*C-2*Math.PI*6378137/2]}class Qu{constructor(u,g,C){if(u<0||u>25||C<0||C>=Math.pow(2,u)||g<0||g>=Math.pow(2,u))throw new Error(`x=${g}, y=${C}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=g,this.y=C,this.key=Qd(0,u,u,g,C)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,g,C){const P=(V=this.y,K=this.z,te=Am(256*(Q=this.x),256*(V=Math.pow(2,K)-V-1),K),he=Am(256*(Q+1),256*(V+1),K),te[0]+","+te[1]+","+he[0]+","+he[1]);var Q,V,K,te,he;const h=function(l,f,v){let E,M="";for(let D=l;D>0;D--)E=1<<D-1,M+=(f&E?1:0)+(v&E?2:0);return M}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,P)}isChildOf(u){const g=this.z-u.z;return g>0&&u.x===this.x>>g&&u.y===this.y>>g}getTilePoint(u){const g=Math.pow(2,this.z);return new F((u.x*g-this.x)*$r,(u.y*g-this.y)*$r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class O0{constructor(u,g){this.wrap=u,this.canonical=g,this.key=Qd(u,g.z,g.z,g.x,g.y)}}class Xl{constructor(u,g,C,P,Q){if(u<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${C}`);this.overscaledZ=u,this.wrap=g,this.canonical=new Qu(C,+P,+Q),this.key=Qd(g,u,C,P,Q)}clone(){return new Xl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-u;return u>this.canonical.z?new Xl(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xl(u,this.wrap,u,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(u,g){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-u;return u>this.canonical.z?Qd(this.wrap*+g,u,this.canonical.z,this.canonical.x,this.canonical.y):Qd(this.wrap*+g,u,u,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const g=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>g&&u.canonical.y===this.canonical.y>>g}children(u){if(this.overscaledZ>=u)return[new Xl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,C=2*this.canonical.x,P=2*this.canonical.y;return[new Xl(g,this.wrap,g,C,P),new Xl(g,this.wrap,g,C+1,P),new Xl(g,this.wrap,g,C,P+1),new Xl(g,this.wrap,g,C+1,P+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new Xl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new Xl(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new O0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new hm(u.x-this.wrap,u.y))}}function Qd(p,u,g,C,P){(p*=2)<0&&(p=-1*p-1);const Q=1<<g;return(Q*Q*p+Q*P+C).toString(36)+g.toString(36)+u.toString(36)}Pi("CanonicalTileID",Qu),Pi("OverscaledTileID",Xl,{omit:["posMatrix"]});class U0{constructor(u,g,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,K=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void Je(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=g.height;const te=this.dim=g.height-2;switch(this.data=new Uint32Array(g.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=P,this.greenFactor=Q,this.blueFactor=V,this.baseShift=K;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let he=0;he<te;he++)this.data[this._idx(-1,he)]=this.data[this._idx(0,he)],this.data[this._idx(te,he)]=this.data[this._idx(te-1,he)],this.data[this._idx(he,-1)]=this.data[this._idx(he,0)],this.data[this._idx(he,te)]=this.data[this._idx(he,te-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(te,-1)]=this.data[this._idx(te-1,0)],this.data[this._idx(-1,te)]=this.data[this._idx(0,te-1)],this.data[this._idx(te,te)]=this.data[this._idx(te-1,te-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let he=0;he<te;he++)for(let h=0;h<te;h++){const l=this.get(he,h);l>this.max&&(this.max=l),l<this.min&&(this.min=l)}}get(u,g){const C=new Uint8Array(this.data.buffer),P=4*this._idx(u,g);return this.unpack(C[P],C[P+1],C[P+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,g){if(u<-1||u>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(u+1)}unpack(u,g,C){return u*this.redFactor+g*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new gl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,g,C){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let P=g*this.dim,Q=g*this.dim+this.dim,V=C*this.dim,K=C*this.dim+this.dim;switch(g){case-1:P=Q-1;break;case 1:Q=P+1}switch(C){case-1:V=K-1;break;case 1:K=V+1}const te=-g*this.dim,he=-C*this.dim;for(let h=V;h<K;h++)for(let l=P;l<Q;l++)this.data[this._idx(l,h)]=u.data[this._idx(l+te,h+he)]}}Pi("DEMData",U0);class N0{constructor(u){this._stringToNumber={},this._numberToString=[];for(let g=0;g<u.length;g++){const C=u[g];this._stringToNumber[C]=g,this._numberToString[g]=C}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class z0{constructor(u,g,C,P,Q){this.type="Feature",this._vectorTileFeature=u,u._z=g,u._x=C,u._y=P,this.properties=u.properties,this.id=Q}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const g in this)g!=="_geometry"&&g!=="_vectorTileFeature"&&(u[g]=this[g]);return u}}class dm{constructor(u,g){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Oi($r,16,0),this.grid3D=new Oi($r,16,0),this.featureIndexArray=new R,this.promoteId=g}insert(u,g,C,P,Q,V){const K=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,P,Q);const te=V?this.grid3D:this.grid;for(let he=0;he<g.length;he++){const h=g[he],l=[1/0,1/0,-1/0,-1/0];for(let f=0;f<h.length;f++){const v=h[f];l[0]=Math.min(l[0],v.x),l[1]=Math.min(l[1],v.y),l[2]=Math.max(l[2],v.x),l[3]=Math.max(l[3],v.y)}l[0]<$r&&l[1]<$r&&l[2]>=0&&l[3]>=0&&te.insert(K,l[0],l[1],l[2],l[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ou.VectorTile(new C0(this.rawTileData)).layers,this.sourceLayerCoder=new N0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,g,C,P){this.loadVTLayers();const Q=u.params||{},V=$r/u.tileSize/u.scale,K=Ql(Q.filter),te=u.queryGeometry,he=u.queryPadding*V,h=Q0(te),l=this.grid.query(h.minX-he,h.minY-he,h.maxX+he,h.maxY+he),f=Q0(u.cameraQueryGeometry),v=this.grid3D.query(f.minX-he,f.minY-he,f.maxX+he,f.maxY+he,(D,G,$,X)=>function(se,Ae,me,Be,Se){for(const He of se)if(Ae<=He.x&&me<=He.y&&Be>=He.x&&Se>=He.y)return!0;const ke=[new F(Ae,me),new F(Ae,Se),new F(Be,Se),new F(Be,me)];if(se.length>2){for(const He of ke)if(zc(se,He))return!0}for(let He=0;He<se.length-1;He++)if(DA(se[He],se[He+1],ke))return!0;return!1}(u.cameraQueryGeometry,D-he,G-he,$+he,X+he));for(const D of v)l.push(D);l.sort(V0);const E={};let M;for(let D=0;D<l.length;D++){const G=l[D];if(G===M)continue;M=G;const $=this.featureIndexArray.get(G);let X=null;this.loadMatchingFeature(E,$.bucketIndex,$.sourceLayerIndex,$.featureIndex,K,Q.layers,Q.availableImages,g,C,P,(se,Ae,me)=>(X||(X=ks(se)),Ae.queryIntersectsFeature(te,se,me,X,this.z,u.transform,V,u.pixelPosMatrix)))}return E}loadMatchingFeature(u,g,C,P,Q,V,K,te,he,h,l){const f=this.bucketLayerIDs[g];if(V&&!function(D,G){for(let $=0;$<D.length;$++)if(G.indexOf(D[$])>=0)return!0;return!1}(V,f))return;const v=this.sourceLayerCoder.decode(C),E=this.vtLayers[v].feature(P);if(Q.needGeometry){const D=Ks(E,!0);if(!Q.filter(new yn(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!Q.filter(new yn(this.tileID.overscaledZ),E))return;const M=this.getId(E,v);for(let D=0;D<f.length;D++){const G=f[D];if(V&&V.indexOf(G)<0)continue;const $=te[G];if(!$)continue;let X={};M&&h&&(X=h.getState($.sourceLayer||"_geojsonTileLayer",M));const se=$e({},he[G]);se.paint=ap(se.paint,$.paint,E,X,K),se.layout=ap(se.layout,$.layout,E,X,K);const Ae=!l||l(E,$,X);if(!Ae)continue;const me=new z0(E,this.z,this.x,this.y,M);me.layer=se;let Be=u[G];Be===void 0&&(Be=u[G]=[]),Be.push({featureIndex:P,feature:me,intersectionZ:Ae})}}lookupSymbolFeatures(u,g,C,P,Q,V,K,te){const he={};this.loadVTLayers();const h=Ql(Q);for(const l of u)this.loadMatchingFeature(he,C,P,l,h,V,K,te,g);return he}hasLayer(u){for(const g of this.bucketLayerIDs)for(const C of g)if(u===C)return!0;return!1}getId(u,g){let C=u.id;return this.promoteId&&(C=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[g]],typeof C=="boolean"&&(C=Number(C))),C}}function ap(p,u,g,C,P){return lt(p,(Q,V)=>{const K=u instanceof $s?u.get(V):null;return K&&K.evaluate?K.evaluate(g,C,P):K})}function Q0(p){let u=1/0,g=1/0,C=-1/0,P=-1/0;for(const Q of p)u=Math.min(u,Q.x),g=Math.min(g,Q.y),C=Math.max(C,Q.x),P=Math.max(P,Q.y);return{minX:u,minY:g,maxX:C,maxY:P}}function V0(p,u){return u-p}function H0(p,u,g,C,P){const Q=[];for(let V=0;V<p.length;V++){const K=p[V];let te;for(let he=0;he<K.length-1;he++){let h=K[he],l=K[he+1];h.x<u&&l.x<u||(h.x<u?h=new F(u,h.y+(u-h.x)/(l.x-h.x)*(l.y-h.y))._round():l.x<u&&(l=new F(u,h.y+(u-h.x)/(l.x-h.x)*(l.y-h.y))._round()),h.y<g&&l.y<g||(h.y<g?h=new F(h.x+(g-h.y)/(l.y-h.y)*(l.x-h.x),g)._round():l.y<g&&(l=new F(h.x+(g-h.y)/(l.y-h.y)*(l.x-h.x),g)._round()),h.x>=C&&l.x>=C||(h.x>=C?h=new F(C,h.y+(C-h.x)/(l.x-h.x)*(l.y-h.y))._round():l.x>=C&&(l=new F(C,h.y+(C-h.x)/(l.x-h.x)*(l.y-h.y))._round()),h.y>=P&&l.y>=P||(h.y>=P?h=new F(h.x+(P-h.y)/(l.y-h.y)*(l.x-h.x),P)._round():l.y>=P&&(l=new F(h.x+(P-h.y)/(l.y-h.y)*(l.x-h.x),P)._round()),te&&h.equals(te[te.length-1])||(te=[h],Q.push(te)),te.push(l)))))}}return Q}Pi("FeatureIndex",dm,{omit:["rawTileData","sourceLayerCoder"]});class zo extends F{constructor(u,g,C,P){super(u,g),this.angle=C,P!==void 0&&(this.segment=P)}clone(){return new zo(this.x,this.y,this.angle,this.segment)}}function Vd(p,u,g,C,P){if(u.segment===void 0||g===0)return!0;let Q=u,V=u.segment+1,K=0;for(;K>-g/2;){if(V--,V<0)return!1;K-=p[V].dist(Q),Q=p[V]}K+=p[V].dist(p[V+1]),V++;const te=[];let he=0;for(;K<g/2;){const h=p[V],l=p[V+1];if(!l)return!1;let f=p[V-1].angleTo(h)-h.angleTo(l);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),te.push({distance:K,angleDelta:f}),he+=f;K-te[0].distance>C;)he-=te.shift().angleDelta;if(he>P)return!1;V++,K+=h.dist(l)}return!0}function G0(p){let u=0;for(let g=0;g<p.length-1;g++)u+=p[g].dist(p[g+1]);return u}function j0(p,u,g){return p?.6*u*g:0}function q0(p,u){return Math.max(p?p.right-p.left:0,u?u.right-u.left:0)}function lx(p,u,g,C,P,Q){const V=j0(g,P,Q),K=q0(g,C)*Q;let te=0;const he=G0(p)/2;for(let h=0;h<p.length-1;h++){const l=p[h],f=p[h+1],v=l.dist(f);if(te+v>he){const E=(he-te)/v,M=dn.number(l.x,f.x,E),D=dn.number(l.y,f.y,E),G=new zo(M,D,f.angleTo(l),h);return G._round(),!V||Vd(p,G,K,V,u)?G:void 0}te+=v}}function cx(p,u,g,C,P,Q,V,K,te){const he=j0(C,Q,V),h=q0(C,P),l=h*V,f=p[0].x===0||p[0].x===te||p[0].y===0||p[0].y===te;return u-l<u/4&&(u=l+u/4),$0(p,f?u/2*K%u:(h/2+2*Q)*V*K%u,u,he,g,l,f,!1,te)}function $0(p,u,g,C,P,Q,V,K,te){const he=Q/2,h=G0(p);let l=0,f=u-g,v=[];for(let E=0;E<p.length-1;E++){const M=p[E],D=p[E+1],G=M.dist(D),$=D.angleTo(M);for(;f+g<l+G;){f+=g;const X=(f-l)/G,se=dn.number(M.x,D.x,X),Ae=dn.number(M.y,D.y,X);if(se>=0&&se<te&&Ae>=0&&Ae<te&&f-he>=0&&f+he<=h){const me=new zo(se,Ae,$,E);me._round(),C&&!Vd(p,me,Q,C,P)||v.push(me)}}l+=G}return K||v.length||V||(v=$0(p,l/2,g,C,P,Q,V,!0,te)),v}Pi("Anchor",zo);const Hd=No;function K0(p,u,g,C){const P=[],Q=p.image,V=Q.pixelRatio,K=Q.paddedRect.w-2*Hd,te=Q.paddedRect.h-2*Hd,he=p.right-p.left,h=p.bottom-p.top,l=Q.stretchX||[[0,K]],f=Q.stretchY||[[0,te]],v=(qe,ct)=>qe+ct[1]-ct[0],E=l.reduce(v,0),M=f.reduce(v,0),D=K-E,G=te-M;let $=0,X=E,se=0,Ae=M,me=0,Be=D,Se=0,ke=G;if(Q.content&&C){const qe=Q.content;$=du(l,0,qe[0]),se=du(f,0,qe[1]),X=du(l,qe[0],qe[2]),Ae=du(f,qe[1],qe[3]),me=qe[0]-$,Se=qe[1]-se,Be=qe[2]-qe[0]-X,ke=qe[3]-qe[1]-Ae}const He=(qe,ct,Ye,tt)=>{const gt=lp(qe.stretch-$,X,he,p.left),St=cp(qe.fixed-me,Be,qe.stretch,E),Xt=lp(ct.stretch-se,Ae,h,p.top),xi=cp(ct.fixed-Se,ke,ct.stretch,M),oi=lp(Ye.stretch-$,X,he,p.left),Ai=cp(Ye.fixed-me,Be,Ye.stretch,E),fi=lp(tt.stretch-se,Ae,h,p.top),Fi=cp(tt.fixed-Se,ke,tt.stretch,M),ai=new F(gt,Xt),Zt=new F(oi,Xt),Vi=new F(oi,fi),Qi=new F(gt,fi),gr=new F(St/V,xi/V),Dr=new F(Ai/V,Fi/V),zr=u*Math.PI/180;if(zr){const Nn=Math.sin(zr),vn=Math.cos(zr),Pn=[vn,-Nn,Nn,vn];ai._matMult(Pn),Zt._matMult(Pn),Qi._matMult(Pn),Vi._matMult(Pn)}const pn=qe.stretch+qe.fixed,os=ct.stretch+ct.fixed;return{tl:ai,tr:Zt,bl:Qi,br:Vi,tex:{x:Q.paddedRect.x+Hd+pn,y:Q.paddedRect.y+Hd+os,w:Ye.stretch+Ye.fixed-pn,h:tt.stretch+tt.fixed-os},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:Dr,minFontScaleX:Be/V/he,minFontScaleY:ke/V/h,isSDF:g}};if(C&&(Q.stretchX||Q.stretchY)){const qe=W0(l,D,E),ct=W0(f,G,M);for(let Ye=0;Ye<qe.length-1;Ye++){const tt=qe[Ye],gt=qe[Ye+1];for(let St=0;St<ct.length-1;St++)P.push(He(tt,ct[St],gt,ct[St+1]))}}else P.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:K+1},{fixed:0,stretch:te+1}));return P}function du(p,u,g){let C=0;for(const P of p)C+=Math.max(u,Math.min(g,P[1]))-Math.max(u,Math.min(g,P[0]));return C}function W0(p,u,g){const C=[{fixed:-Hd,stretch:0}];for(const[P,Q]of p){const V=C[C.length-1];C.push({fixed:P-V.stretch,stretch:V.stretch}),C.push({fixed:P-V.stretch,stretch:V.stretch+(Q-P)})}return C.push({fixed:u+Hd,stretch:g}),C}function lp(p,u,g,C){return p/u*g+C}function cp(p,u,g,C){return p-u*g/C}class up{constructor(u,g,C,P,Q,V,K,te,he,h){if(this.boxStartIndex=u.length,he){let l=V.top,f=V.bottom;const v=V.collisionPadding;v&&(l-=v[1],f+=v[3]);let E=f-l;E>0&&(E=Math.max(10,E),this.circleDiameter=E)}else{let l=V.top*K-te[0],f=V.bottom*K+te[2],v=V.left*K-te[3],E=V.right*K+te[1];const M=V.collisionPadding;if(M&&(v-=M[0]*K,l-=M[1]*K,E+=M[2]*K,f+=M[3]*K),h){const D=new F(v,l),G=new F(E,l),$=new F(v,f),X=new F(E,f),se=h*Math.PI/180;D._rotate(se),G._rotate(se),$._rotate(se),X._rotate(se),v=Math.min(D.x,G.x,$.x,X.x),E=Math.max(D.x,G.x,$.x,X.x),l=Math.min(D.y,G.y,$.y,X.y),f=Math.max(D.y,G.y,$.y,X.y)}u.emplaceBack(g.x,g.y,v,l,E,f,C,P,Q)}this.boxEndIndex=u.length}}class UT{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NT;if(this.data=u,this.length=this.data.length,this.compare=g,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],g=this.data.pop();return this.length--,this.length>0&&(this.data[0]=g,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:g,compare:C}=this,P=g[u];for(;u>0;){const Q=u-1>>1,V=g[Q];if(C(P,V)>=0)break;g[u]=V,u=Q}g[u]=P}_down(u){const{data:g,compare:C}=this,P=this.length>>1,Q=g[u];for(;u<P;){let V=1+(u<<1),K=g[V];const te=V+1;if(te<this.length&&C(g[te],K)<0&&(V=te,K=g[te]),C(K,Q)>=0)break;g[u]=K,u=V}g[u]=Q}}function NT(p,u){return p<u?-1:p>u?1:0}function ux(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,P=1/0,Q=-1/0,V=-1/0;const K=p[0];for(let v=0;v<K.length;v++){const E=K[v];(!v||E.x<C)&&(C=E.x),(!v||E.y<P)&&(P=E.y),(!v||E.x>Q)&&(Q=E.x),(!v||E.y>V)&&(V=E.y)}const te=Math.min(Q-C,V-P);let he=te/2;const h=new UT([],Gd);if(te===0)return new F(C,P);for(let v=C;v<Q;v+=te)for(let E=P;E<V;E+=te)h.push(new QA(v+he,E+he,he,p));let l=function(v){let E=0,M=0,D=0;const G=v[0];for(let $=0,X=G.length,se=X-1;$<X;se=$++){const Ae=G[$],me=G[se],Be=Ae.x*me.y-me.x*Ae.y;M+=(Ae.x+me.x)*Be,D+=(Ae.y+me.y)*Be,E+=3*Be}return new QA(M/E,D/E,0,v)}(p),f=h.length;for(;h.length;){const v=h.pop();(v.d>l.d||!l.d)&&(l=v,g&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,f)),v.max-l.d<=u||(he=v.h/2,h.push(new QA(v.p.x-he,v.p.y-he,he,p)),h.push(new QA(v.p.x+he,v.p.y-he,he,p)),h.push(new QA(v.p.x-he,v.p.y+he,he,p)),h.push(new QA(v.p.x+he,v.p.y+he,he,p)),f+=4)}return g&&(console.log(`num probes: ${f}`),console.log(`best distance: ${l.d}`)),l.p}function Gd(p,u){return u.max-p.max}function QA(p,u,g,C){this.p=new F(p,u),this.h=g,this.d=function(P,Q){let V=!1,K=1/0;for(let te=0;te<Q.length;te++){const he=Q[te];for(let h=0,l=he.length,f=l-1;h<l;f=h++){const v=he[h],E=he[f];v.y>P.y!=E.y>P.y&&P.x<(E.x-v.x)*(P.y-v.y)/(E.y-v.y)+v.x&&(V=!V),K=Math.min(K,Du(P,v,E))}}return(V?1:-1)*Math.sqrt(K)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var vo;c.ap=void 0,(vo=c.ap||(c.ap={}))[vo.center=1]="center",vo[vo.left=2]="left",vo[vo.right=3]="right",vo[vo.top=4]="top",vo[vo.bottom=5]="bottom",vo[vo["top-left"]=6]="top-left",vo[vo["top-right"]=7]="top-right",vo[vo["bottom-left"]=8]="bottom-left",vo[vo["bottom-right"]=9]="bottom-right";const wh=7,jd=Number.POSITIVE_INFINITY;function hp(p,u){return u[1]!==jd?function(g,C,P){let Q=0,V=0;switch(C=Math.abs(C),P=Math.abs(P),g){case"top-right":case"top-left":case"top":V=P-wh;break;case"bottom-right":case"bottom-left":case"bottom":V=-P+wh}switch(g){case"top-right":case"bottom-right":case"right":Q=-C;break;case"top-left":case"bottom-left":case"left":Q=C}return[Q,V]}(p,u[0],u[1]):function(g,C){let P=0,Q=0;C<0&&(C=0);const V=C/Math.SQRT2;switch(g){case"top-right":case"top-left":Q=V-wh;break;case"bottom-right":case"bottom-left":Q=-V+wh;break;case"bottom":Q=-C+wh;break;case"top":Q=C-wh}switch(g){case"top-right":case"bottom-right":P=-V;break;case"top-left":case"bottom-left":P=V;break;case"left":P=C;break;case"right":P=-C}return[P,Q]}(p,u[0])}function Ap(p,u,g){var C;const P=p.layout,Q=(C=P.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(u,{},g);if(Q){const K=Q.values,te=[];for(let he=0;he<K.length;he+=2){const h=te[he]=K[he],l=K[he+1].map(f=>f*_o);h.startsWith("top")?l[1]-=wh:h.startsWith("bottom")&&(l[1]+=wh),te[he+1]=l}return new Qr(te)}const V=P.get("text-variable-anchor");if(V){let K;K=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[P.get("text-radial-offset").evaluate(u,{},g)*_o,jd]:P.get("text-offset").evaluate(u,{},g).map(he=>he*_o);const te=[];for(const he of V)te.push(he,hp(he,K));return new Qr(te)}return null}function X0(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zT(p,u,g,C,P,Q,V,K,te,he,h){let l=Q.textMaxSize.evaluate(u,{});l===void 0&&(l=V);const f=p.layers[0].layout,v=f.get("icon-offset").evaluate(u,{},h),E=Ax(g.horizontal),M=V/24,D=p.tilePixelRatio*M,G=p.tilePixelRatio*l/24,$=p.tilePixelRatio*K,X=p.tilePixelRatio*f.get("symbol-spacing"),se=f.get("text-padding")*p.tilePixelRatio,Ae=function(tt,gt,St){let Xt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const xi=tt.get("icon-padding").evaluate(gt,{},St),oi=xi&&xi.values;return[oi[0]*Xt,oi[1]*Xt,oi[2]*Xt,oi[3]*Xt]}(f,u,h,p.tilePixelRatio),me=f.get("text-max-angle")/180*Math.PI,Be=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",Se=f.get("icon-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point",ke=f.get("symbol-placement"),He=X/2,qe=f.get("icon-text-fit");let ct;C&&qe!=="none"&&(p.allowVerticalPlacement&&g.vertical&&(ct=T0(C,g.vertical,qe,f.get("icon-text-fit-padding"),v,M)),E&&(C=T0(C,E,qe,f.get("icon-text-fit-padding"),v,M)));const Ye=(tt,gt)=>{gt.x<0||gt.x>=$r||gt.y<0||gt.y>=$r||function(St,Xt,xi,oi,Ai,fi,Fi,ai,Zt,Vi,Qi,gr,Dr,zr,pn,os,Nn,vn,Pn,cn,vr,zn,un,en,ds){const Ss=St.addToLineVertexArray(Xt,xi);let _s,Xs,Ts,Fn,xr=0,Us=0,oo=0,ao=0,Zl=-1,gc=-1;const na={};let Hu=Ti("");if(St.allowVerticalPlacement&&oi.vertical){const Oa=ai.layout.get("text-rotate").evaluate(vr,{},en)+90;Ts=new up(Zt,Xt,Vi,Qi,gr,oi.vertical,Dr,zr,pn,Oa),Fi&&(Fn=new up(Zt,Xt,Vi,Qi,gr,Fi,Nn,vn,pn,Oa))}if(Ai){const Oa=ai.layout.get("icon-rotate").evaluate(vr,{}),_c=ai.layout.get("icon-text-fit")!=="none",VA=K0(Ai,Oa,un,_c),fu=Fi?K0(Fi,Oa,un,_c):void 0;Xs=new up(Zt,Xt,Vi,Qi,gr,Ai,Nn,vn,!1,Oa),xr=4*VA.length;const Ua=St.iconSizeData;let vc=null;Ua.kind==="source"?(vc=[Nu*ai.layout.get("icon-size").evaluate(vr,{})],vc[0]>bh&&Je(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ud}. Reduce your "icon-size".`)):Ua.kind==="composite"&&(vc=[Nu*zn.compositeIconSizes[0].evaluate(vr,{},en),Nu*zn.compositeIconSizes[1].evaluate(vr,{},en)],(vc[0]>bh||vc[1]>bh)&&Je(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ud}. Reduce your "icon-size".`)),St.addSymbols(St.icon,VA,vc,cn,Pn,vr,c.ah.none,Xt,Ss.lineStartIndex,Ss.lineLength,-1,en),Zl=St.icon.placedSymbolArray.length-1,fu&&(Us=4*fu.length,St.addSymbols(St.icon,fu,vc,cn,Pn,vr,c.ah.vertical,Xt,Ss.lineStartIndex,Ss.lineLength,-1,en),gc=St.icon.placedSymbolArray.length-1)}const mc=Object.keys(oi.horizontal);for(const Oa of mc){const _c=oi.horizontal[Oa];if(!_s){Hu=Ti(_c.text);const fu=ai.layout.get("text-rotate").evaluate(vr,{},en);_s=new up(Zt,Xt,Vi,Qi,gr,_c,Dr,zr,pn,fu)}const VA=_c.positionedLines.length===1;if(oo+=hx(St,Xt,_c,fi,ai,pn,vr,os,Ss,oi.vertical?c.ah.horizontal:c.ah.horizontalOnly,VA?mc:[Oa],na,Zl,zn,en),VA)break}oi.vertical&&(ao+=hx(St,Xt,oi.vertical,fi,ai,pn,vr,os,Ss,c.ah.vertical,["vertical"],na,gc,zn,en));const yc=_s?_s.boxStartIndex:St.collisionBoxArray.length,_l=_s?_s.boxEndIndex:St.collisionBoxArray.length,Bh=Ts?Ts.boxStartIndex:St.collisionBoxArray.length,_p=Ts?Ts.boxEndIndex:St.collisionBoxArray.length,px=Xs?Xs.boxStartIndex:St.collisionBoxArray.length,J0=Xs?Xs.boxEndIndex:St.collisionBoxArray.length,Y0=Fn?Fn.boxStartIndex:St.collisionBoxArray.length,Ch=Fn?Fn.boxEndIndex:St.collisionBoxArray.length;let Hc=-1;const vp=(Oa,_c)=>Oa&&Oa.circleDiameter?Math.max(Oa.circleDiameter,_c):_c;Hc=vp(_s,Hc),Hc=vp(Ts,Hc),Hc=vp(Xs,Hc),Hc=vp(Fn,Hc);const gx=Hc>-1?1:0;gx&&(Hc*=ds/_o),St.glyphOffsetArray.length>=NA.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,vr.sortKey);const QT=Ap(ai,vr,en),[VT,HT]=function(Oa,_c){const VA=Oa.length,fu=_c==null?void 0:_c.values;if((fu==null?void 0:fu.length)>0)for(let Ua=0;Ua<fu.length;Ua+=2){const vc=fu[Ua+1];Oa.emplaceBack(c.ap[fu[Ua]],vc[0],vc[1])}return[VA,Oa.length]}(St.textAnchorOffsets,QT);St.symbolInstances.emplaceBack(Xt.x,Xt.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,Zl,gc,Hu,yc,_l,Bh,_p,px,J0,Y0,Ch,Vi,oo,ao,xr,Us,gx,0,Dr,Hc,VT,HT)}(p,gt,tt,g,C,P,ct,p.layers[0],p.collisionBoxArray,u.index,u.sourceLayerIndex,p.index,D,[se,se,se,se],Be,te,$,Ae,Se,v,u,Q,he,h,V)};if(ke==="line")for(const tt of H0(u.geometry,0,0,$r,$r)){const gt=cx(tt,X,me,g.vertical||E,C,24,G,p.overscaling,$r);for(const St of gt)E&&qd(p,E.text,He,St)||Ye(tt,St)}else if(ke==="line-center"){for(const tt of u.geometry)if(tt.length>1){const gt=lx(tt,me,g.vertical||E,C,24,G);gt&&Ye(tt,gt)}}else if(u.type==="Polygon")for(const tt of Jg(u.geometry,0)){const gt=ux(tt,16);Ye(tt[0],new zo(gt.x,gt.y,0))}else if(u.type==="LineString")for(const tt of u.geometry)Ye(tt,new zo(tt[0].x,tt[0].y,0));else if(u.type==="Point")for(const tt of u.geometry)for(const gt of tt)Ye([gt],new zo(gt.x,gt.y,0))}function hx(p,u,g,C,P,Q,V,K,te,he,h,l,f,v,E){const M=function($,X,se,Ae,me,Be,Se,ke){const He=Ae.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,qe=[];for(const ct of X.positionedLines)for(const Ye of ct.positionedGlyphs){if(!Ye.rect)continue;const tt=Ye.rect||{};let gt=Jb+1,St=!0,Xt=1,xi=0;const oi=(me||ke)&&Ye.vertical,Ai=Ye.metrics.advance*Ye.scale/2;if(ke&&X.verticalizable&&(xi=ct.lineOffset/2-(Ye.imageName?-(_o-Ye.metrics.width*Ye.scale)/2:(Ye.scale-1)*_o)),Ye.imageName){const cn=Se[Ye.imageName];St=cn.sdf,Xt=cn.pixelRatio,gt=No/Xt}const fi=me?[Ye.x+Ai,Ye.y]:[0,0];let Fi=me?[0,0]:[Ye.x+Ai+se[0],Ye.y+se[1]-xi],ai=[0,0];oi&&(ai=Fi,Fi=[0,0]);const Zt=Ye.metrics.isDoubleResolution?2:1,Vi=(Ye.metrics.left-gt)*Ye.scale-Ai+Fi[0],Qi=(-Ye.metrics.top-gt)*Ye.scale+Fi[1],gr=Vi+tt.w/Zt*Ye.scale/Xt,Dr=Qi+tt.h/Zt*Ye.scale/Xt,zr=new F(Vi,Qi),pn=new F(gr,Qi),os=new F(Vi,Dr),Nn=new F(gr,Dr);if(oi){const cn=new F(-Ai,Ai-ep),vr=-Math.PI/2,zn=_o/2-Ai,un=new F(5-ep-zn,-(Ye.imageName?zn:0)),en=new F(...ai);zr._rotateAround(vr,cn)._add(un)._add(en),pn._rotateAround(vr,cn)._add(un)._add(en),os._rotateAround(vr,cn)._add(un)._add(en),Nn._rotateAround(vr,cn)._add(un)._add(en)}if(He){const cn=Math.sin(He),vr=Math.cos(He),zn=[vr,-cn,cn,vr];zr._matMult(zn),pn._matMult(zn),os._matMult(zn),Nn._matMult(zn)}const vn=new F(0,0),Pn=new F(0,0);qe.push({tl:zr,tr:pn,bl:os,br:Nn,tex:tt,writingMode:X.writingMode,glyphOffset:fi,sectionIndex:Ye.sectionIndex,isSDF:St,pixelOffsetTL:vn,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}return qe}(0,g,K,P,Q,V,C,p.allowVerticalPlacement),D=p.textSizeData;let G=null;D.kind==="source"?(G=[Nu*P.layout.get("text-size").evaluate(V,{})],G[0]>bh&&Je(`${p.layerIds[0]}: Value for "text-size" is >= ${Ud}. Reduce your "text-size".`)):D.kind==="composite"&&(G=[Nu*v.compositeTextSizes[0].evaluate(V,{},E),Nu*v.compositeTextSizes[1].evaluate(V,{},E)],(G[0]>bh||G[1]>bh)&&Je(`${p.layerIds[0]}: Value for "text-size" is >= ${Ud}. Reduce your "text-size".`)),p.addSymbols(p.text,M,G,K,Q,V,he,u,te.lineStartIndex,te.lineLength,f,E);for(const $ of h)l[$]=p.text.placedSymbolArray.length-1;return 4*M.length}function Ax(p){for(const u in p)return p[u];return null}function qd(p,u,g,C){const P=p.compareText;if(u in P){const Q=P[u];for(let V=Q.length-1;V>=0;V--)if(C.dist(Q[V])<g)return!0}else P[u]=[];return P[u].push(C),!1}const ra=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vu{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,C]=new Uint8Array(u,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const P=C>>4;if(P!==1)throw new Error(`Got v${P} data when expected v1.`);const Q=ra[15&C];if(!Q)throw new Error("Unrecognized array type.");const[V]=new Uint16Array(u,2,1),[K]=new Uint32Array(u,4,1);return new Vu(K,V,Q,u)}constructor(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,P=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=C,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Q=ra.indexOf(this.ArrayType),V=2*u*this.ArrayType.BYTES_PER_ELEMENT,K=u*this.IndexArrayType.BYTES_PER_ELEMENT,te=(8-K%8)%8;if(Q<0)throw new Error(`Unexpected typed array class: ${C}.`);P&&P instanceof ArrayBuffer?(this.data=P,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+K+te,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+V+K+te),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+K+te,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Q]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=u)}add(u,g){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=u,this.coords[this._pos++]=g,C}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return dp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,g,C,P){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Q,coords:V,nodeSize:K}=this,te=[0,Q.length-1,0],he=[];for(;te.length;){const h=te.pop()||0,l=te.pop()||0,f=te.pop()||0;if(l-f<=K){for(let D=f;D<=l;D++){const G=V[2*D],$=V[2*D+1];G>=u&&G<=C&&$>=g&&$<=P&&he.push(Q[D])}continue}const v=f+l>>1,E=V[2*v],M=V[2*v+1];E>=u&&E<=C&&M>=g&&M<=P&&he.push(Q[v]),(h===0?u<=E:g<=M)&&(te.push(f),te.push(v-1),te.push(1-h)),(h===0?C>=E:P>=M)&&(te.push(v+1),te.push(l),te.push(1-h))}return he}within(u,g,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:Q,nodeSize:V}=this,K=[0,P.length-1,0],te=[],he=C*C;for(;K.length;){const h=K.pop()||0,l=K.pop()||0,f=K.pop()||0;if(l-f<=V){for(let D=f;D<=l;D++)dx(Q[2*D],Q[2*D+1],u,g)<=he&&te.push(P[D]);continue}const v=f+l>>1,E=Q[2*v],M=Q[2*v+1];dx(E,M,u,g)<=he&&te.push(P[v]),(h===0?u-C<=E:g-C<=M)&&(K.push(f),K.push(v-1),K.push(1-h)),(h===0?u+C>=E:g+C>=M)&&(K.push(v+1),K.push(l),K.push(1-h))}return te}}function dp(p,u,g,C,P,Q){if(P-C<=g)return;const V=C+P>>1;Z0(p,u,V,C,P,Q),dp(p,u,g,C,V-1,1-Q),dp(p,u,g,V+1,P,1-Q)}function Z0(p,u,g,C,P,Q){for(;P>C;){if(P-C>600){const he=P-C+1,h=g-C+1,l=Math.log(he),f=.5*Math.exp(2*l/3),v=.5*Math.sqrt(l*f*(he-f)/he)*(h-he/2<0?-1:1);Z0(p,u,g,Math.max(C,Math.floor(g-h*f/he+v)),Math.min(P,Math.floor(g+(he-h)*f/he+v)),Q)}const V=u[2*g+Q];let K=C,te=P;for($d(p,u,C,g),u[2*P+Q]>V&&$d(p,u,C,P);K<te;){for($d(p,u,K,te),K++,te--;u[2*K+Q]<V;)K++;for(;u[2*te+Q]>V;)te--}u[2*C+Q]===V?$d(p,u,C,te):(te++,$d(p,u,te,P)),te<=g&&(C=te+1),g<=te&&(P=te-1)}}function $d(p,u,g,C){fp(p,g,C),fp(u,2*g,2*C),fp(u,2*g+1,2*C+1)}function fp(p,u,g){const C=p[u];p[u]=p[g],p[g]=C}function dx(p,u,g,C){const P=p-g,Q=u-C;return P*P+Q*Q}var fm;c.bc=void 0,(fm=c.bc||(c.bc={})).create="create",fm.load="load",fm.fullLoad="fullLoad";let pp=null,gp=[];const pm=1e3/60,mp="loadTime",yp="fullLoadTime",fx={mark(p){performance.mark(p)},frame(p){const u=p;pp!=null&&gp.push(u-pp),pp=u},clearMetrics(){pp=null,gp=[],performance.clearMeasures(mp),performance.clearMeasures(yp);for(const p in c.bc)performance.clearMarks(c.bc[p])},getPerformanceMetrics(){performance.measure(mp,c.bc.create,c.bc.load),performance.measure(yp,c.bc.create,c.bc.fullLoad);const p=performance.getEntriesByName(mp)[0].duration,u=performance.getEntriesByName(yp)[0].duration,g=gp.length,C=1/(gp.reduce((Q,V)=>Q+V,0)/g/1e3),P=gp.filter(Q=>Q>pm).reduce((Q,V)=>Q+(V-pm)/pm,0);return{loadTime:p,fullLoadTime:u,fps:C,percentDroppedFrames:P/(g+P)*100,totalFrames:g}}};c.$=bt,c.A=Wl,c.B=function(p){if(Lt==null){const u=p.navigator?p.navigator.userAgent:null;Lt=!!p.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Lt},c.C=class{constructor(p,u){this.target=p,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new rx(()=>this.process()),this.subscription=function(g,C,P,Q){return g.addEventListener(C,P,!1),{unsubscribe:()=>{g.removeEventListener(C,P,!1)}}}(this.target,"message",g=>this.receive(g)),this.globalScope=Ct(self)?p:window}registerMessageHandler(p,u){this.messageHandlers[p]=u}sendAsync(p,u){return new Promise((g,C)=>{const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[P]={resolve:g,reject:C},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[P];const K={id:P,type:"<cancel>",origin:location.origin,targetMapId:p.targetMapId,sourceMapId:this.mapId};this.target.postMessage(K)},{once:!0});const Q=[],V=Object.assign(Object.assign({},p),{id:P,sourceMapId:this.mapId,origin:location.origin,data:Hl(p.data,Q)});this.target.postMessage(V,{transfer:Q})})}receive(p){const u=p.data,g=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[g];const C=this.abortControllers[g];return delete this.abortControllers[g],void(C&&C.abort())}if(Ct(self)||u.mustQueue)return this.tasks[g]=u,this.taskQueue.push(g),void this.invoker.trigger();this.processTask(g,u)}}process(){if(this.taskQueue.length===0)return;const p=this.taskQueue.shift(),u=this.tasks[p];delete this.tasks[p],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(p,u)}processTask(p,u){return s(this,void 0,void 0,function*(){if(u.type==="<response>"){const P=this.resolveRejects[p];return delete this.resolveRejects[p],P?void(u.error?P.reject(Li(u.error)):P.resolve(Li(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(p,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const g=Li(u.data),C=new AbortController;this.abortControllers[p]=C;try{const P=yield this.messageHandlers[u.type](u.sourceMapId,g,C);this.completeTask(p,null,P)}catch(P){this.completeTask(p,P)}})}completeTask(p,u,g){const C=[];delete this.abortControllers[p];const P={id:p,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?Hl(u):null,data:Hl(g,C)};this.target.postMessage(P,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=bi,c.E=ot,c.F=function(){var p=new Wl(16);return Wl!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},c.G=wt,c.H=function(p,u,g){var C,P,Q,V,K,te,he,h,l,f,v,E,M=g[0],D=g[1],G=g[2];return u===p?(p[12]=u[0]*M+u[4]*D+u[8]*G+u[12],p[13]=u[1]*M+u[5]*D+u[9]*G+u[13],p[14]=u[2]*M+u[6]*D+u[10]*G+u[14],p[15]=u[3]*M+u[7]*D+u[11]*G+u[15]):(P=u[1],Q=u[2],V=u[3],K=u[4],te=u[5],he=u[6],h=u[7],l=u[8],f=u[9],v=u[10],E=u[11],p[0]=C=u[0],p[1]=P,p[2]=Q,p[3]=V,p[4]=K,p[5]=te,p[6]=he,p[7]=h,p[8]=l,p[9]=f,p[10]=v,p[11]=E,p[12]=C*M+K*D+l*G+u[12],p[13]=P*M+te*D+f*G+u[13],p[14]=Q*M+he*D+v*G+u[14],p[15]=V*M+h*D+E*G+u[15]),p},c.I=nm,c.J=function(p,u,g){var C=g[0],P=g[1],Q=g[2];return p[0]=u[0]*C,p[1]=u[1]*C,p[2]=u[2]*C,p[3]=u[3]*C,p[4]=u[4]*P,p[5]=u[5]*P,p[6]=u[6]*P,p[7]=u[7]*P,p[8]=u[8]*Q,p[9]=u[9]*Q,p[10]=u[10]*Q,p[11]=u[11]*Q,p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},c.K=fh,c.L=function(p,u){const g={};for(let C=0;C<u.length;C++){const P=u[C];P in p&&(g[P]=p[P])}return g},c.M=xh,c.N=R0,c.O=ox,c.P=F,c.Q=Xl,c.R=gl,c.S=ce,c.T=ql,c.U=de,c.V=Mt,c.W=$r,c.X=qn,c.Y=hm,c.Z=class extends Yo{},c._=s,c.a=At,c.a$=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]+p[3]*u[3]},c.a0=Qu,c.a1=Nt,c.a2=p=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(g=>{u.onloadstart=()=>{g(u)};for(const C of p){const P=window.document.createElement("source");ii(C)||(u.crossOrigin="Anonymous"),P.src=C,u.appendChild(P)}})},c.a3=function(){return Ue++},c.a4=a,c.a5=NA,c.a6=Ql,c.a7=Ks,c.a8=yn,c.a9=z0,c.aA=De,c.aB=function(p,u){if(!p)return[{command:"setStyle",args:[u]}];let g=[];try{if(!ut(p.version,u.version))return[{command:"setStyle",args:[u]}];ut(p.center,u.center)||g.push({command:"setCenter",args:[u.center]}),ut(p.zoom,u.zoom)||g.push({command:"setZoom",args:[u.zoom]}),ut(p.bearing,u.bearing)||g.push({command:"setBearing",args:[u.bearing]}),ut(p.pitch,u.pitch)||g.push({command:"setPitch",args:[u.pitch]}),ut(p.sprite,u.sprite)||g.push({command:"setSprite",args:[u.sprite]}),ut(p.glyphs,u.glyphs)||g.push({command:"setGlyphs",args:[u.glyphs]}),ut(p.transition,u.transition)||g.push({command:"setTransition",args:[u.transition]}),ut(p.light,u.light)||g.push({command:"setLight",args:[u.light]}),ut(p.terrain,u.terrain)||g.push({command:"setTerrain",args:[u.terrain]}),ut(p.sky,u.sky)||g.push({command:"setSky",args:[u.sky]});const C={},P=[];(function(V,K,te,he){let h;for(h in K=K||{},V=V||{})Object.prototype.hasOwnProperty.call(V,h)&&(Object.prototype.hasOwnProperty.call(K,h)||di(h,te,he));for(h in K)Object.prototype.hasOwnProperty.call(K,h)&&(Object.prototype.hasOwnProperty.call(V,h)?ut(V[h],K[h])||(V[h].type==="geojson"&&K[h].type==="geojson"&&Ki(V,K,h)?jt(te,{command:"setGeoJSONSourceData",args:[h,K[h].data]}):li(h,K,te,he)):ni(h,K,te))})(p.sources,u.sources,P,C);const Q=[];p.layers&&p.layers.forEach(V=>{"source"in V&&C[V.source]?g.push({command:"removeLayer",args:[V.id]}):Q.push(V)}),g=g.concat(P),function(V,K,te){K=K||[];const he=(V=V||[]).map(Ar),h=K.map(Ar),l=V.reduce(Er,{}),f=K.reduce(Er,{}),v=he.slice(),E=Object.create(null);let M,D,G,$,X;for(let se=0,Ae=0;se<he.length;se++)M=he[se],Object.prototype.hasOwnProperty.call(f,M)?Ae++:(jt(te,{command:"removeLayer",args:[M]}),v.splice(v.indexOf(M,Ae),1));for(let se=0,Ae=0;se<h.length;se++)M=h[h.length-1-se],v[v.length-1-se]!==M&&(Object.prototype.hasOwnProperty.call(l,M)?(jt(te,{command:"removeLayer",args:[M]}),v.splice(v.lastIndexOf(M,v.length-Ae),1)):Ae++,$=v[v.length-se],jt(te,{command:"addLayer",args:[f[M],$]}),v.splice(v.length-se,0,M),E[M]=!0);for(let se=0;se<h.length;se++)if(M=h[se],D=l[M],G=f[M],!E[M]&&!ut(D,G))if(ut(D.source,G.source)&&ut(D["source-layer"],G["source-layer"])&&ut(D.type,G.type)){for(X in tr(D.layout,G.layout,te,M,null,"setLayoutProperty"),tr(D.paint,G.paint,te,M,null,"setPaintProperty"),ut(D.filter,G.filter)||jt(te,{command:"setFilter",args:[M,G.filter]}),ut(D.minzoom,G.minzoom)&&ut(D.maxzoom,G.maxzoom)||jt(te,{command:"setLayerZoomRange",args:[M,G.minzoom,G.maxzoom]}),D)Object.prototype.hasOwnProperty.call(D,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?tr(D[X],G[X],te,M,X.slice(6),"setPaintProperty"):ut(D[X],G[X])||jt(te,{command:"setLayerProperty",args:[M,X,G[X]]}));for(X in G)Object.prototype.hasOwnProperty.call(G,X)&&!Object.prototype.hasOwnProperty.call(D,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?tr(D[X],G[X],te,M,X.slice(6),"setPaintProperty"):ut(D[X],G[X])||jt(te,{command:"setLayerProperty",args:[M,X,G[X]]}))}else jt(te,{command:"removeLayer",args:[M]}),$=v[v.lastIndexOf(M)+1],jt(te,{command:"addLayer",args:[G,$]})}(Q,u.layers,g)}catch(C){console.warn("Unable to compute style diff:",C),g=[{command:"setStyle",args:[u]}]}return g},c.aC=function(p){const u=[],g=p.id;return g===void 0&&u.push({message:`layers.${g}: missing required property "id"`}),p.render===void 0&&u.push({message:`layers.${g}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&u.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),u},c.aD=function p(u,g){if(Array.isArray(u)){if(!Array.isArray(g)||u.length!==g.length)return!1;for(let C=0;C<u.length;C++)if(!p(u[C],g[C]))return!1;return!0}if(typeof u=="object"&&u!==null&&g!==null){if(typeof g!="object"||Object.keys(u).length!==Object.keys(g).length)return!1;for(const C in u)if(!p(u[C],g[C]))return!1;return!0}return u===g},c.aE=lt,c.aF=nt,c.aG=class extends rn{constructor(p,u){super(p,u),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},c.aH=Mr,c.aI=class extends rn{constructor(p,u){super(p,u),this.current=es}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let u=1;u<16;u++)if(p[u]!==this.current[u]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},c.aJ=Kr,c.aK=class extends rn{constructor(p,u){super(p,u),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},c.aL=class extends rn{constructor(p,u){super(p,u),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},c.aM=Cr,c.aN=function(p,u,g,C,P,Q,V){var K=1/(u-g),te=1/(C-P),he=1/(Q-V);return p[0]=-2*K,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*te,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*he,p[11]=0,p[12]=(u+g)*K,p[13]=(P+C)*te,p[14]=(V+Q)*he,p[15]=1,p},c.aO=ur,c.aP=ph,c.aQ=class extends Kl{},c.aR=Qb,c.aS=class extends yo{},c.aT=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},c.aU=Ed,c.aV=j,c.aW=class extends L{},c.aX=Ke,c.aY=function(p,u){var g=p[0],C=p[1],P=p[2],Q=p[3],V=p[4],K=p[5],te=p[6],he=p[7],h=p[8],l=p[9],f=p[10],v=p[11],E=p[12],M=p[13],D=p[14],G=p[15],$=u[0],X=u[1],se=u[2],Ae=u[3],me=u[4],Be=u[5],Se=u[6],ke=u[7],He=u[8],qe=u[9],ct=u[10],Ye=u[11],tt=u[12],gt=u[13],St=u[14],Xt=u[15];return Math.abs(g-$)<=ta*Math.max(1,Math.abs(g),Math.abs($))&&Math.abs(C-X)<=ta*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(P-se)<=ta*Math.max(1,Math.abs(P),Math.abs(se))&&Math.abs(Q-Ae)<=ta*Math.max(1,Math.abs(Q),Math.abs(Ae))&&Math.abs(V-me)<=ta*Math.max(1,Math.abs(V),Math.abs(me))&&Math.abs(K-Be)<=ta*Math.max(1,Math.abs(K),Math.abs(Be))&&Math.abs(te-Se)<=ta*Math.max(1,Math.abs(te),Math.abs(Se))&&Math.abs(he-ke)<=ta*Math.max(1,Math.abs(he),Math.abs(ke))&&Math.abs(h-He)<=ta*Math.max(1,Math.abs(h),Math.abs(He))&&Math.abs(l-qe)<=ta*Math.max(1,Math.abs(l),Math.abs(qe))&&Math.abs(f-ct)<=ta*Math.max(1,Math.abs(f),Math.abs(ct))&&Math.abs(v-Ye)<=ta*Math.max(1,Math.abs(v),Math.abs(Ye))&&Math.abs(E-tt)<=ta*Math.max(1,Math.abs(E),Math.abs(tt))&&Math.abs(M-gt)<=ta*Math.max(1,Math.abs(M),Math.abs(gt))&&Math.abs(D-St)<=ta*Math.max(1,Math.abs(D),Math.abs(St))&&Math.abs(G-Xt)<=ta*Math.max(1,Math.abs(G),Math.abs(Xt))},c.aZ=function(p,u){return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},c.a_=function(p,u,g){return p[0]=u[0]*g[0],p[1]=u[1]*g[1],p[2]=u[2]*g[2],p[3]=u[3]*g[3],p},c.aa=function(p){const u={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(g,C,P,Q)=>{const V=P||Q;return u[C]=!V||V.toLowerCase(),""}),u["max-age"]){const g=parseInt(u["max-age"],10);isNaN(g)?delete u["max-age"]:u["max-age"]=g}return u},c.ab=function(p,u){const g=[];for(const C in p)C in u||g.push(C);return g},c.ac=je,c.ad=function(p,u,g){var C=Math.sin(g),P=Math.cos(g),Q=u[0],V=u[1],K=u[2],te=u[3],he=u[4],h=u[5],l=u[6],f=u[7];return u!==p&&(p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=Q*P+he*C,p[1]=V*P+h*C,p[2]=K*P+l*C,p[3]=te*P+f*C,p[4]=he*P-Q*C,p[5]=h*P-V*C,p[6]=l*P-K*C,p[7]=f*P-te*C,p},c.ae=function(p){var u=new Wl(16);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u},c.af=gh,c.ag=function(p,u){let g=0,C=0;if(p.kind==="constant")C=p.layoutSize;else if(p.kind!=="source"){const{interpolationType:P,minZoom:Q,maxZoom:V}=p,K=P?je(rs.interpolationFactor(P,u,Q,V),0,1):0;p.kind==="camera"?C=dn.number(p.minSize,p.maxSize,K):g=K}return{uSizeT:g,uSize:C}},c.ai=function(p,u,g){let{uSize:C,uSizeT:P}=u,{lowerSize:Q,upperSize:V}=g;return p.kind==="source"?Q/Nu:p.kind==="composite"?dn.number(Q/Nu,V/Nu,P):C},c.aj=cm,c.ak=function(p,u,g,C){const P=u.y-p.y,Q=u.x-p.x,V=C.y-g.y,K=C.x-g.x,te=V*Q-K*P;if(te===0)return null;const he=(K*(p.y-g.y)-V*(p.x-g.x))/te;return new F(p.x+he*Q,p.y+he*P)},c.al=H0,c.am=Fu,c.an=Jh,c.ao=_o,c.aq=np,c.ar=function(p,u){var g=u[0],C=u[1],P=u[2],Q=u[3],V=u[4],K=u[5],te=u[6],he=u[7],h=u[8],l=u[9],f=u[10],v=u[11],E=u[12],M=u[13],D=u[14],G=u[15],$=g*K-C*V,X=g*te-P*V,se=g*he-Q*V,Ae=C*te-P*K,me=C*he-Q*K,Be=P*he-Q*te,Se=h*M-l*E,ke=h*D-f*E,He=h*G-v*E,qe=l*D-f*M,ct=l*G-v*M,Ye=f*G-v*D,tt=$*Ye-X*ct+se*qe+Ae*He-me*ke+Be*Se;return tt?(p[0]=(K*Ye-te*ct+he*qe)*(tt=1/tt),p[1]=(P*ct-C*Ye-Q*qe)*tt,p[2]=(M*Be-D*me+G*Ae)*tt,p[3]=(f*me-l*Be-v*Ae)*tt,p[4]=(te*He-V*Ye-he*ke)*tt,p[5]=(g*Ye-P*He+Q*ke)*tt,p[6]=(D*se-E*Be-G*X)*tt,p[7]=(h*Be-f*se+v*X)*tt,p[8]=(V*ct-K*He+he*Se)*tt,p[9]=(C*He-g*ct-Q*Se)*tt,p[10]=(E*me-M*se+G*$)*tt,p[11]=(l*se-h*me-v*$)*tt,p[12]=(K*ke-V*qe-te*Se)*tt,p[13]=(g*qe-C*ke+P*Se)*tt,p[14]=(M*X-E*Ae-D*$)*tt,p[15]=(h*Ae-l*X+f*$)*tt,p):null},c.as=X0,c.at=Od,c.au=Vu,c.av=function(){const p={},u=xt.$version;for(const g in xt.$root){const C=xt.$root[g];if(C.required){let P=null;P=g==="version"?u:C.type==="array"?[]:{},P!=null&&(p[g]=P)}}return p},c.aw=Gl,c.ax=It,c.ay=function(p){p=p.slice();const u=Object.create(null);for(let g=0;g<p.length;g++)u[p[g].id]=p[g];for(let g=0;g<p.length;g++)"ref"in p[g]&&(p[g]=ei(p[g],u[p[g].ref]));return p},c.az=function(p){if(p.type==="custom")return new D0(p);switch(p.type){case"background":return new F0(p);case"circle":return new Yh(p);case"fill":return new _T(p);case"fill-extrusion":return new ET(p);case"heatmap":return new mh(p);case"hillshade":return new Uf(p);case"line":return new MT(p);case"raster":return new ix(p);case"symbol":return new Nd(p)}},c.b=_t,c.b0=Ge,c.b1=O0,c.b2=ax,c.b3=function(p,u,g,C,P){var Q,V=1/Math.tan(u/2);return p[0]=V/g,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,P!=null&&P!==1/0?(p[10]=(P+C)*(Q=1/(C-P)),p[14]=2*P*C*Q):(p[10]=-1,p[14]=-2*C),p},c.b4=function(p,u,g){var C=Math.sin(g),P=Math.cos(g),Q=u[4],V=u[5],K=u[6],te=u[7],he=u[8],h=u[9],l=u[10],f=u[11];return u!==p&&(p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[4]=Q*P+he*C,p[5]=V*P+h*C,p[6]=K*P+l*C,p[7]=te*P+f*C,p[8]=he*P-Q*C,p[9]=h*P-V*C,p[10]=l*P-K*C,p[11]=f*P-te*C,p},c.b5=be,c.b6=Te,c.b7=function(p){return p*Math.PI/180},c.b8=function(p,u){return p[0]=u[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=u[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},c.b9=class extends tn{},c.ba=zd,c.bb=fx,c.bd=Pt,c.be=function(p,u){At.REGISTERED_PROTOCOLS[p]=u},c.bf=function(p){delete At.REGISTERED_PROTOCOLS[p]},c.bg=function(p,u){const g={};for(let P=0;P<p.length;P++){const Q=u&&u[p[P].id]||Lu(p[P]);u&&(u[p[P].id]=Q);let V=g[Q];V||(V=g[Q]=[]),V.push(p[P])}const C=[];for(const P in g)C.push(g[P]);return C},c.bh=Pi,c.bi=N0,c.bj=dm,c.bk=sm,c.bl=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=$r/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;const u=p.bucket.layers[0],g=u.layout,C=u._unevaluatedLayout._values,P={layoutIconSize:C["icon-size"].possiblyEvaluate(new yn(p.bucket.zoom+1),p.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new yn(p.bucket.zoom+1),p.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new yn(18))};if(p.bucket.textSizeData.kind==="composite"){const{minZoom:he,maxZoom:h}=p.bucket.textSizeData;P.compositeTextSizes=[C["text-size"].possiblyEvaluate(new yn(he),p.canonical),C["text-size"].possiblyEvaluate(new yn(h),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){const{minZoom:he,maxZoom:h}=p.bucket.iconSizeData;P.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new yn(he),p.canonical),C["icon-size"].possiblyEvaluate(new yn(h),p.canonical)]}const Q=g.get("text-line-height")*_o,V=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",K=g.get("text-keep-upright"),te=g.get("text-size");for(const he of p.bucket.features){const h=g.get("text-font").evaluate(he,{},p.canonical).join(","),l=te.evaluate(he,{},p.canonical),f=P.layoutTextSize.evaluate(he,{},p.canonical),v=P.layoutIconSize.evaluate(he,{},p.canonical),E={horizontal:{},vertical:void 0},M=he.text;let D,G=[0,0];if(M){const se=M.toString(),Ae=g.get("text-letter-spacing").evaluate(he,{},p.canonical)*_o,me=mo(se)?Ae:0,Be=g.get("text-anchor").evaluate(he,{},p.canonical),Se=Ap(u,he,p.canonical);if(!Se){const Ye=g.get("text-radial-offset").evaluate(he,{},p.canonical);G=Ye?hp(Be,[Ye*_o,jd]):g.get("text-offset").evaluate(he,{},p.canonical).map(tt=>tt*_o)}let ke=V?"center":g.get("text-justify").evaluate(he,{},p.canonical);const He=g.get("symbol-placement"),qe=He==="point"?g.get("text-max-width").evaluate(he,{},p.canonical)*_o:0,ct=()=>{p.bucket.allowVerticalPlacement&&no(se)&&(E.vertical=ip(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,qe,Q,Be,"left",me,G,c.ah.vertical,!0,He,f,l))};if(!V&&Se){const Ye=new Set;if(ke==="auto")for(let gt=0;gt<Se.values.length;gt+=2)Ye.add(X0(Se.values[gt]));else Ye.add(ke);let tt=!1;for(const gt of Ye)if(!E.horizontal[gt])if(tt)E.horizontal[gt]=E.horizontal[0];else{const St=ip(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,qe,Q,"center",gt,me,G,c.ah.horizontal,!1,He,f,l);St&&(E.horizontal[gt]=St,tt=St.positionedLines.length===1)}ct()}else{ke==="auto"&&(ke=X0(Be));const Ye=ip(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,qe,Q,Be,ke,me,G,c.ah.horizontal,!1,He,f,l);Ye&&(E.horizontal[ke]=Ye),ct(),no(se)&&V&&K&&(E.vertical=ip(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,qe,Q,Be,ke,me,G,c.ah.vertical,!1,He,f,l))}}let $=!1;if(he.icon&&he.icon.name){const se=p.imageMap[he.icon.name];se&&(D=kT(p.imagePositions[he.icon.name],g.get("icon-offset").evaluate(he,{},p.canonical),g.get("icon-anchor").evaluate(he,{},p.canonical)),$=!!se.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=$:p.bucket.sdfIcons!==$&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==p.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}const X=Ax(E.horizontal)||E.vertical;p.bucket.iconsInText=!!X&&X.iconsInText,(X||D)&&zT(p.bucket,he,E,D,p.imageMap,P,f,v,G,$,p.canonical)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},c.bm=UA,c.bn=Yg,c.bo=m0,c.bp=Ou,c.bq=C0,c.br=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},c.bs=function(p,u,g,C,P){return s(this,void 0,void 0,function*(){if(de())try{return yield Mt(p,u,g,C,P)}catch{}return function(Q,V,K,te,he){const h=Q.width,l=Q.height;Wt&&Ee||(Wt=new OffscreenCanvas(h,l),Ee=Wt.getContext("2d",{willReadFrequently:!0})),Wt.width=h,Wt.height=l,Ee.drawImage(Q,0,0,h,l);const f=Ee.getImageData(V,K,te,he);return Ee.clearRect(0,0,h,l),f.data}(p,u,g,C,P)})},c.bt=U0,c.bu=m,c.bv=x,c.bw=x0,c.bx=On,c.by=function(p){return p.message===Xe},c.bz=Za,c.c=et,c.d=p=>s(void 0,void 0,void 0,function*(){if(p.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(p)],{type:"image/png"});try{return createImageBitmap(u)}catch(g){throw new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=$e,c.f=p=>new Promise((u,g)=>{const C=new Image;C.onload=()=>{u(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Ft})},C.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(p)],{type:"image/png"});C.src=p.byteLength?URL.createObjectURL(P):Ft}),c.g=ft,c.h=(p,u)=>Ht($e(p,{type:"json"}),u),c.i=Ct,c.j=kt,c.k=Mi,c.l=(p,u)=>Ht($e(p,{type:"arrayBuffer"}),u),c.m=Ht,c.n=function(p){return new C0(p).readFields(FT,[])},c.o=Au,c.p=Yf,c.q=Cs,c.r=ya,c.s=ii,c.t=Zo,c.u=Ei,c.v=xt,c.w=Je,c.x=Gn,c.y=function(p){let[u,g,C]=p;return g+=90,g*=Math.PI/180,C*=Math.PI/180,{x:u*Math.cos(g)*Math.sin(C),y:u*Math.sin(g)*Math.sin(C),z:u*Math.cos(C)}},c.z=dn}),n("worker",["./shared"],function(c){class s{constructor(we){this.keyCache={},we&&this.replace(we)}replace(we){this._layerConfigs={},this._layers={},this.update(we,[])}update(we,oe){for(const le of we){this._layerConfigs[le.id]=le;const ge=this._layers[le.id]=c.az(le);ge._featureFilter=c.a6(ge.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of oe)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const Y=c.bg(Object.values(this._layerConfigs),this.keyCache);for(const le of Y){const ge=le.map(Ve=>this._layers[Ve.id]),_e=ge[0];if(_e.visibility==="none")continue;const Ce=_e.source||"";let ve=this.familiesBySource[Ce];ve||(ve=this.familiesBySource[Ce]={});const Me=_e.sourceLayer||"_geojsonTileLayer";let Oe=ve[Me];Oe||(Oe=ve[Me]=[]),Oe.push(ge)}}}class m{constructor(we){const oe={},Y=[];for(const Ce in we){const ve=we[Ce],Me=oe[Ce]={};for(const Oe in ve){const Ve=ve[+Oe];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const it={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};Y.push(it),Me[Oe]={rect:it,metrics:Ve.metrics}}}const{w:le,h:ge}=c.p(Y),_e=new c.o({width:le||1,height:ge||1});for(const Ce in we){const ve=we[Ce];for(const Me in ve){const Oe=ve[+Me];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Ve=oe[Ce][Me].rect;c.o.copy(Oe.bitmap,_e,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},Oe.bitmap)}}this.image=_e,this.positions=oe}}c.bh("GlyphAtlas",m);class x{constructor(we){this.tileID=new c.Q(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.uid=we.uid,this.zoom=we.zoom,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.collectResourceTiming,this.returnDependencies=!!we.returnDependencies,this.promoteId=we.promoteId,this.inFlightDependencies=[]}parse(we,oe,Y,le){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=we,this.collisionBoxArray=new c.a4;const ge=new c.bi(Object.keys(we.layers).sort()),_e=new c.bj(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const Ce={},ve={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Me=oe.familiesBySource[this.source];for(const wi in Me){const Ui=we.layers[wi];if(!Ui)continue;Ui.version===1&&c.w(`Vector tile source "${this.source}" layer "${wi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=ge.encode(wi),ti=[];for(let zt=0;zt<Ui.length;zt++){const zi=Ui.feature(zt),hr=_e.getId(zi,wi);ti.push({feature:zi,id:hr,index:zt,sourceLayerIndex:st})}for(const zt of Me[wi]){const zi=zt[0];zi.source!==this.source&&c.w(`layer.source = ${zi.source} does not equal this.source = ${this.source}`),zi.minzoom&&this.zoom<Math.floor(zi.minzoom)||zi.maxzoom&&this.zoom>=zi.maxzoom||zi.visibility!=="none"&&(I(zt,this.zoom,Y),(Ce[zi.id]=zi.createBucket({index:_e.bucketLayerIDs.length,layers:zt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source})).populate(ti,ve,this.tileID.canonical),_e.bucketLayerIDs.push(zt.map(hr=>hr.id)))}}const Oe=c.aE(ve.glyphDependencies,wi=>Object.keys(wi).map(Number));this.inFlightDependencies.forEach(wi=>wi==null?void 0:wi.abort()),this.inFlightDependencies=[];let Ve=Promise.resolve({});if(Object.keys(Oe).length){const wi=new AbortController;this.inFlightDependencies.push(wi),Ve=le.sendAsync({type:"getGlyphs",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},wi)}const it=Object.keys(ve.iconDependencies);let yt=Promise.resolve({});if(it.length){const wi=new AbortController;this.inFlightDependencies.push(wi),yt=le.sendAsync({type:"getImages",data:{icons:it,source:this.source,tileID:this.tileID,type:"icons"}},wi)}const Bt=Object.keys(ve.patternDependencies);let Yt=Promise.resolve({});if(Bt.length){const wi=new AbortController;this.inFlightDependencies.push(wi),Yt=le.sendAsync({type:"getImages",data:{icons:Bt,source:this.source,tileID:this.tileID,type:"patterns"}},wi)}const[qt,Kt,si]=yield Promise.all([Ve,yt,Yt]),Ci=new m(qt),Hi=new c.bk(Kt,si);for(const wi in Ce){const Ui=Ce[wi];Ui instanceof c.a5?(I(Ui.layers,this.zoom,Y),c.bl({bucket:Ui,glyphMap:qt,glyphPositions:Ci.positions,imageMap:Kt,imagePositions:Hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ui.hasPattern&&(Ui instanceof c.bm||Ui instanceof c.bn||Ui instanceof c.bo)&&(I(Ui.layers,this.zoom,Y),Ui.addFeatures(ve,this.tileID.canonical,Hi.patternPositions))}return this.status="done",{buckets:Object.values(Ce).filter(wi=>!wi.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:Hi,glyphMap:this.returnDependencies?qt:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?Ci.positions:null}})}}function I(ze,we,oe){const Y=new c.a8(we);for(const le of ze)le.recalculate(Y,oe)}class F{constructor(we,oe,Y){this.actor=we,this.layerIndex=oe,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(we,oe){return c._(this,void 0,void 0,function*(){const Y=yield c.l(we.request,oe);try{return{vectorTile:new c.bp.VectorTile(new c.bq(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(le){const ge=new Uint8Array(Y.data);let _e=`Unable to parse the tile at ${we.request.url}, `;throw _e+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.messge}`,new Error(_e)}})}loadTile(we){return c._(this,void 0,void 0,function*(){const oe=we.uid,Y=!!(we&&we.request&&we.request.collectResourceTiming)&&new c.br(we.request),le=new x(we);this.loading[oe]=le;const ge=new AbortController;le.abort=ge;try{const _e=yield this.loadVectorTile(we,ge);if(delete this.loading[oe],!_e)return null;const Ce=_e.rawData,ve={};_e.expires&&(ve.expires=_e.expires),_e.cacheControl&&(ve.cacheControl=_e.cacheControl);const Me={};if(Y){const Ve=Y.finish();Ve&&(Me.resourceTiming=JSON.parse(JSON.stringify(Ve)))}le.vectorTile=_e.vectorTile;const Oe=le.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[oe]=le,this.fetching[oe]={rawTileData:Ce,cacheControl:ve,resourceTiming:Me};try{const Ve=yield Oe;return c.e({rawTileData:Ce.slice(0)},Ve,ve,Me)}finally{delete this.fetching[oe]}}catch(_e){throw delete this.loading[oe],le.status="done",this.loaded[oe]=le,_e}})}reloadTile(we){return c._(this,void 0,void 0,function*(){const oe=we.uid;if(!this.loaded||!this.loaded[oe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[oe];if(Y.showCollisionBoxes=we.showCollisionBoxes,Y.status==="parsing"){const le=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[oe]){const{rawTileData:_e,cacheControl:Ce,resourceTiming:ve}=this.fetching[oe];delete this.fetching[oe],ge=c.e({rawTileData:_e.slice(0)},le,Ce,ve)}else ge=le;return ge}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(we){return c._(this,void 0,void 0,function*(){const oe=this.loading,Y=we.uid;oe&&oe[Y]&&oe[Y].abort&&(oe[Y].abort.abort(),delete oe[Y])})}removeTile(we){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[we.uid]&&delete this.loaded[we.uid]})}}class O{constructor(){this.loaded={}}loadTile(we){return c._(this,void 0,void 0,function*(){const{uid:oe,encoding:Y,rawImageData:le,redFactor:ge,greenFactor:_e,blueFactor:Ce,baseShift:ve}=we,Me=le.width+2,Oe=le.height+2,Ve=c.b(le)?new c.R({width:Me,height:Oe},yield c.bs(le,-1,-1,Me,Oe)):le,it=new c.bt(oe,Ve,Y,ge,_e,Ce,ve);return this.loaded=this.loaded||{},this.loaded[oe]=it,it})}removeTile(we){const oe=this.loaded,Y=we.uid;oe&&oe[Y]&&delete oe[Y]}}function z(ze,we){if(ze.length!==0){ie(ze[0],we);for(var oe=1;oe<ze.length;oe++)ie(ze[oe],!we)}}function ie(ze,we){for(var oe=0,Y=0,le=0,ge=ze.length,_e=ge-1;le<ge;_e=le++){var Ce=(ze[le][0]-ze[_e][0])*(ze[_e][1]+ze[le][1]),ve=oe+Ce;Y+=Math.abs(oe)>=Math.abs(Ce)?oe-ve+Ce:Ce-ve+oe,oe=ve}oe+Y>=0!=!!we&&ze.reverse()}var ne=c.bu(function ze(we,oe){var Y,le=we&&we.type;if(le==="FeatureCollection")for(Y=0;Y<we.features.length;Y++)ze(we.features[Y],oe);else if(le==="GeometryCollection")for(Y=0;Y<we.geometries.length;Y++)ze(we.geometries[Y],oe);else if(le==="Feature")ze(we.geometry,oe);else if(le==="Polygon")z(we.coordinates,oe);else if(le==="MultiPolygon")for(Y=0;Y<we.coordinates.length;Y++)z(we.coordinates[Y],oe);return we});const ue=c.bp.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},de=c.bv,be=c.bp.VectorTileFeature,Te=je;function je(ze,we){this.options=we||{},this.features=ze,this.length=ze.length}function Ge(ze,we){this.id=typeof ze.id=="number"?ze.id:void 0,this.type=ze.type,this.rawGeometry=ze.type===1?[ze.geometry]:ze.geometry,this.properties=ze.tags,this.extent=we||4096}je.prototype.feature=function(ze){return new Ge(this.features[ze],this.options.extent)},Ge.prototype.loadGeometry=function(){var ze=this.rawGeometry;this.geometry=[];for(var we=0;we<ze.length;we++){for(var oe=ze[we],Y=[],le=0;le<oe.length;le++)Y.push(new de(oe[le][0],oe[le][1]));this.geometry.push(Y)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ze=this.geometry,we=1/0,oe=-1/0,Y=1/0,le=-1/0,ge=0;ge<ze.length;ge++)for(var _e=ze[ge],Ce=0;Ce<_e.length;Ce++){var ve=_e[Ce];we=Math.min(we,ve.x),oe=Math.max(oe,ve.x),Y=Math.min(Y,ve.y),le=Math.max(le,ve.y)}return[we,Y,oe,le]},Ge.prototype.toGeoJSON=be.prototype.toGeoJSON;var $e=c.bw,Ue=Te;function lt(ze){var we=new $e;return function(oe,Y){for(var le in oe.layers)Y.writeMessage(3,nt,oe.layers[le])}(ze,we),we.finish()}function nt(ze,we){var oe;we.writeVarintField(15,ze.version||1),we.writeStringField(1,ze.name||""),we.writeVarintField(5,ze.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<ze.length;oe++)Y.feature=ze.feature(oe),we.writeMessage(2,De,Y);var le=Y.keys;for(oe=0;oe<le.length;oe++)we.writeStringField(3,le[oe]);var ge=Y.values;for(oe=0;oe<ge.length;oe++)we.writeMessage(4,Ct,ge[oe])}function De(ze,we){var oe=ze.feature;oe.id!==void 0&&we.writeVarintField(1,oe.id),we.writeMessage(2,Fe,ze),we.writeVarintField(3,oe.type),we.writeMessage(4,Et,oe)}function Fe(ze,we){var oe=ze.feature,Y=ze.keys,le=ze.values,ge=ze.keycache,_e=ze.valuecache;for(var Ce in oe.properties){var ve=oe.properties[Ce],Me=ge[Ce];if(ve!==null){Me===void 0&&(Y.push(Ce),ge[Ce]=Me=Y.length-1),we.writeVarint(Me);var Oe=typeof ve;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(ve=JSON.stringify(ve));var Ve=Oe+":"+ve,it=_e[Ve];it===void 0&&(le.push(ve),_e[Ve]=it=le.length-1),we.writeVarint(it)}}}function Je(ze,we){return(we<<3)+(7&ze)}function We(ze){return ze<<1^ze>>31}function Et(ze,we){for(var oe=ze.loadGeometry(),Y=ze.type,le=0,ge=0,_e=oe.length,Ce=0;Ce<_e;Ce++){var ve=oe[Ce],Me=1;Y===1&&(Me=ve.length),we.writeVarint(Je(1,Me));for(var Oe=Y===3?ve.length-1:ve.length,Ve=0;Ve<Oe;Ve++){Ve===1&&Y!==1&&we.writeVarint(Je(2,Oe-1));var it=ve[Ve].x-le,yt=ve[Ve].y-ge;we.writeVarint(We(it)),we.writeVarint(We(yt)),le+=it,ge+=yt}Y===3&&we.writeVarint(Je(7,1))}}function Ct(ze,we){var oe=typeof ze;oe==="string"?we.writeStringField(1,ze):oe==="boolean"?we.writeBooleanField(7,ze):oe==="number"&&(ze%1!=0?we.writeDoubleField(3,ze):ze<0?we.writeSVarintField(6,ze):we.writeVarintField(5,ze))}ce.exports=lt,ce.exports.fromVectorTileJs=lt,ce.exports.fromGeojsonVt=function(ze,we){we=we||{};var oe={};for(var Y in ze)oe[Y]=new Ue(ze[Y].features,we),oe[Y].name=Y,oe[Y].version=we.version,oe[Y].extent=we.extent;return lt({layers:oe})},ce.exports.GeoJSONWrapper=Ue;var Lt=c.bu(ce.exports);const _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},Ft=Math.fround||(Mt=new Float32Array(1),ze=>(Mt[0]=+ze,Mt[0]));var Mt;const Wt=3,Ee=5,Xe=6;class et{constructor(we){this.options=Object.assign(Object.create(_t),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:oe,minZoom:Y,maxZoom:le}=this.options;oe&&console.time("total time");const ge=`prepare ${we.length} points`;oe&&console.time(ge),this.points=we;const _e=[];for(let ve=0;ve<we.length;ve++){const Me=we[ve];if(!Me.geometry)continue;const[Oe,Ve]=Me.geometry.coordinates,it=Ft(wt(Oe)),yt=Ft(Pt(Ve));_e.push(it,yt,1/0,ve,-1,1),this.options.reduce&&_e.push(0)}let Ce=this.trees[le+1]=this._createTree(_e);oe&&console.timeEnd(ge);for(let ve=le;ve>=Y;ve--){const Me=+Date.now();Ce=this.trees[ve]=this._createTree(this._cluster(Ce,ve)),oe&&console.log("z%d: %d clusters in %dms",ve,Ce.numItems,+Date.now()-Me)}return oe&&console.timeEnd("total time"),this}getClusters(we,oe){let Y=((we[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,we[1]));let ge=we[2]===180?180:((we[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)Y=-180,ge=180;else if(Y>ge){const Ve=this.getClusters([Y,le,180,_e],oe),it=this.getClusters([-180,le,ge,_e],oe);return Ve.concat(it)}const Ce=this.trees[this._limitZoom(oe)],ve=Ce.range(wt(Y),Pt(_e),wt(ge),Pt(le)),Me=Ce.data,Oe=[];for(const Ve of ve){const it=this.stride*Ve;Oe.push(Me[it+Ee]>1?At(Me,it,this.clusterProps):this.points[Me[it+Wt]])}return Oe}getChildren(we){const oe=this._getOriginId(we),Y=this._getOriginZoom(we),le="No cluster with the specified id.",ge=this.trees[Y];if(!ge)throw new Error(le);const _e=ge.data;if(oe*this.stride>=_e.length)throw new Error(le);const Ce=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),ve=ge.within(_e[oe*this.stride],_e[oe*this.stride+1],Ce),Me=[];for(const Oe of ve){const Ve=Oe*this.stride;_e[Ve+4]===we&&Me.push(_e[Ve+Ee]>1?At(_e,Ve,this.clusterProps):this.points[_e[Ve+Wt]])}if(Me.length===0)throw new Error(le);return Me}getLeaves(we,oe,Y){const le=[];return this._appendLeaves(le,we,oe=oe||10,Y=Y||0,0),le}getTile(we,oe,Y){const le=this.trees[this._limitZoom(we)],ge=Math.pow(2,we),{extent:_e,radius:Ce}=this.options,ve=Ce/_e,Me=(Y-ve)/ge,Oe=(Y+1+ve)/ge,Ve={features:[]};return this._addTileFeatures(le.range((oe-ve)/ge,Me,(oe+1+ve)/ge,Oe),le.data,oe,Y,ge,Ve),oe===0&&this._addTileFeatures(le.range(1-ve/ge,Me,1,Oe),le.data,ge,Y,ge,Ve),oe===ge-1&&this._addTileFeatures(le.range(0,Me,ve/ge,Oe),le.data,-1,Y,ge,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(we){let oe=this._getOriginZoom(we)-1;for(;oe<=this.options.maxZoom;){const Y=this.getChildren(we);if(oe++,Y.length!==1)break;we=Y[0].properties.cluster_id}return oe}_appendLeaves(we,oe,Y,le,ge){const _e=this.getChildren(oe);for(const Ce of _e){const ve=Ce.properties;if(ve&&ve.cluster?ge+ve.point_count<=le?ge+=ve.point_count:ge=this._appendLeaves(we,ve.cluster_id,Y,le,ge):ge<le?ge++:we.push(Ce),we.length===Y)break}return ge}_createTree(we){const oe=new c.au(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<we.length;Y+=this.stride)oe.add(we[Y],we[Y+1]);return oe.finish(),oe.data=we,oe}_addTileFeatures(we,oe,Y,le,ge,_e){for(const Ce of we){const ve=Ce*this.stride,Me=oe[ve+Ee]>1;let Oe,Ve,it;if(Me)Oe=ft(oe,ve,this.clusterProps),Ve=oe[ve],it=oe[ve+1];else{const Yt=this.points[oe[ve+Wt]];Oe=Yt.properties;const[qt,Kt]=Yt.geometry.coordinates;Ve=wt(qt),it=Pt(Kt)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ve*ge-Y)),Math.round(this.options.extent*(it*ge-le))]],tags:Oe};let Bt;Bt=Me||this.options.generateId?oe[ve+Wt]:this.points[oe[ve+Wt]].id,Bt!==void 0&&(yt.id=Bt),_e.features.push(yt)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,oe){const{radius:Y,extent:le,reduce:ge,minPoints:_e}=this.options,Ce=Y/(le*Math.pow(2,oe)),ve=we.data,Me=[],Oe=this.stride;for(let Ve=0;Ve<ve.length;Ve+=Oe){if(ve[Ve+2]<=oe)continue;ve[Ve+2]=oe;const it=ve[Ve],yt=ve[Ve+1],Bt=we.within(ve[Ve],ve[Ve+1],Ce),Yt=ve[Ve+Ee];let qt=Yt;for(const Kt of Bt){const si=Kt*Oe;ve[si+2]>oe&&(qt+=ve[si+Ee])}if(qt>Yt&&qt>=_e){let Kt,si=it*Yt,Ci=yt*Yt,Hi=-1;const wi=((Ve/Oe|0)<<5)+(oe+1)+this.points.length;for(const Ui of Bt){const st=Ui*Oe;if(ve[st+2]<=oe)continue;ve[st+2]=oe;const ti=ve[st+Ee];si+=ve[st]*ti,Ci+=ve[st+1]*ti,ve[st+4]=wi,ge&&(Kt||(Kt=this._map(ve,Ve,!0),Hi=this.clusterProps.length,this.clusterProps.push(Kt)),ge(Kt,this._map(ve,st)))}ve[Ve+4]=wi,Me.push(si/qt,Ci/qt,1/0,wi,-1,qt),ge&&Me.push(Hi)}else{for(let Kt=0;Kt<Oe;Kt++)Me.push(ve[Ve+Kt]);if(qt>1)for(const Kt of Bt){const si=Kt*Oe;if(!(ve[si+2]<=oe)){ve[si+2]=oe;for(let Ci=0;Ci<Oe;Ci++)Me.push(ve[si+Ci])}}}}return Me}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,oe,Y){if(we[oe+Ee]>1){const _e=this.clusterProps[we[oe+Xe]];return Y?Object.assign({},_e):_e}const le=this.points[we[oe+Wt]].properties,ge=this.options.map(le);return Y&&ge===le?Object.assign({},ge):ge}}function At(ze,we,oe){return{type:"Feature",id:ze[we+Wt],properties:ft(ze,we,oe),geometry:{type:"Point",coordinates:[(Y=ze[we],360*(Y-.5)),It(ze[we+1])]}};var Y}function ft(ze,we,oe){const Y=ze[we+Ee],le=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ge=ze[we+Xe],_e=ge===-1?{}:Object.assign({},oe[ge]);return Object.assign(_e,{cluster:!0,cluster_id:ze[we+Wt],point_count:Y,point_count_abbreviated:le})}function wt(ze){return ze/360+.5}function Pt(ze){const we=Math.sin(ze*Math.PI/180),oe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return oe<0?0:oe>1?1:oe}function It(ze){const we=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function Ht(ze,we,oe,Y){for(var le,ge=Y,_e=oe-we>>1,Ce=oe-we,ve=ze[we],Me=ze[we+1],Oe=ze[oe],Ve=ze[oe+1],it=we+3;it<oe;it+=3){var yt=ii(ze[it],ze[it+1],ve,Me,Oe,Ve);if(yt>ge)le=it,ge=yt;else if(yt===ge){var Bt=Math.abs(it-_e);Bt<Ce&&(le=it,Ce=Bt)}}ge>Y&&(le-we>3&&Ht(ze,we,le,Y),ze[le+2]=ge,oe-le>3&&Ht(ze,le,oe,Y))}function ii(ze,we,oe,Y,le,ge){var _e=le-oe,Ce=ge-Y;if(_e!==0||Ce!==0){var ve=((ze-oe)*_e+(we-Y)*Ce)/(_e*_e+Ce*Ce);ve>1?(oe=le,Y=ge):ve>0&&(oe+=_e*ve,Y+=Ce*ve)}return(_e=ze-oe)*_e+(Ce=we-Y)*Ce}function gi(ze,we,oe,Y){var le={id:ze===void 0?null:ze,type:we,geometry:oe,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var _e=ge.geometry,Ce=ge.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")mi(ge,_e);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var ve=0;ve<_e.length;ve++)mi(ge,_e[ve]);else if(Ce==="MultiPolygon")for(ve=0;ve<_e.length;ve++)for(var Me=0;Me<_e[ve].length;Me++)mi(ge,_e[ve][Me])}(le),le}function mi(ze,we){for(var oe=0;oe<we.length;oe+=3)ze.minX=Math.min(ze.minX,we[oe]),ze.minY=Math.min(ze.minY,we[oe+1]),ze.maxX=Math.max(ze.maxX,we[oe]),ze.maxY=Math.max(ze.maxY,we[oe+1])}function Mi(ze,we,oe,Y){if(we.geometry){var le=we.geometry.coordinates,ge=we.geometry.type,_e=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),Ce=[],ve=we.id;if(oe.promoteId?ve=we.properties[oe.promoteId]:oe.generateId&&(ve=Y||0),ge==="Point")kt(le,Ce);else if(ge==="MultiPoint")for(var Me=0;Me<le.length;Me++)kt(le[Me],Ce);else if(ge==="LineString")ot(le,Ce,_e,!1);else if(ge==="MultiLineString"){if(oe.lineMetrics){for(Me=0;Me<le.length;Me++)ot(le[Me],Ce=[],_e,!1),ze.push(gi(ve,"LineString",Ce,we.properties));return}xt(le,Ce,_e,!1)}else if(ge==="Polygon")xt(le,Ce,_e,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Me=0;Me<we.geometry.geometries.length;Me++)Mi(ze,{id:ve,geometry:we.geometry.geometries[Me],properties:we.properties},oe,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Me=0;Me<le.length;Me++){var Oe=[];xt(le[Me],Oe,_e,!0),Ce.push(Oe)}}ze.push(gi(ve,ge,Ce,we.properties))}}function kt(ze,we){we.push(Ri(ze[0])),we.push(ei(ze[1])),we.push(0)}function ot(ze,we,oe,Y){for(var le,ge,_e=0,Ce=0;Ce<ze.length;Ce++){var ve=Ri(ze[Ce][0]),Me=ei(ze[Ce][1]);we.push(ve),we.push(Me),we.push(0),Ce>0&&(_e+=Y?(le*Me-ve*ge)/2:Math.sqrt(Math.pow(ve-le,2)+Math.pow(Me-ge,2))),le=ve,ge=Me}var Oe=we.length-3;we[2]=1,Ht(we,0,Oe,oe),we[Oe+2]=1,we.size=Math.abs(_e),we.start=0,we.end=we.size}function xt(ze,we,oe,Y){for(var le=0;le<ze.length;le++){var ge=[];ot(ze[le],ge,oe,Y),we.push(ge)}}function Ri(ze){return ze/360+.5}function ei(ze){var we=Math.sin(ze*Math.PI/180),oe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return oe<0?0:oe>1?1:oe}function ut(ze,we,oe,Y,le,ge,_e,Ce){if(Y/=we,ge>=(oe/=we)&&_e<Y)return ze;if(_e<oe||ge>=Y)return null;for(var ve=[],Me=0;Me<ze.length;Me++){var Oe=ze[Me],Ve=Oe.geometry,it=Oe.type,yt=le===0?Oe.minX:Oe.minY,Bt=le===0?Oe.maxX:Oe.maxY;if(yt>=oe&&Bt<Y)ve.push(Oe);else if(!(Bt<oe||yt>=Y)){var Yt=[];if(it==="Point"||it==="MultiPoint")jt(Ve,Yt,oe,Y,le);else if(it==="LineString")ni(Ve,Yt,oe,Y,le,!1,Ce.lineMetrics);else if(it==="MultiLineString")li(Ve,Yt,oe,Y,le,!1);else if(it==="Polygon")li(Ve,Yt,oe,Y,le,!0);else if(it==="MultiPolygon")for(var qt=0;qt<Ve.length;qt++){var Kt=[];li(Ve[qt],Kt,oe,Y,le,!0),Kt.length&&Yt.push(Kt)}if(Yt.length){if(Ce.lineMetrics&&it==="LineString"){for(qt=0;qt<Yt.length;qt++)ve.push(gi(Oe.id,it,Yt[qt],Oe.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Yt.length===1?(it="LineString",Yt=Yt[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Yt.length===3?"Point":"MultiPoint"),ve.push(gi(Oe.id,it,Yt,Oe.tags))}}}return ve.length?ve:null}function jt(ze,we,oe,Y,le){for(var ge=0;ge<ze.length;ge+=3){var _e=ze[ge+le];_e>=oe&&_e<=Y&&(we.push(ze[ge]),we.push(ze[ge+1]),we.push(ze[ge+2]))}}function ni(ze,we,oe,Y,le,ge,_e){for(var Ce,ve,Me=di(ze),Oe=le===0?tr:Ar,Ve=ze.start,it=0;it<ze.length-3;it+=3){var yt=ze[it],Bt=ze[it+1],Yt=ze[it+2],qt=ze[it+3],Kt=ze[it+4],si=le===0?yt:Bt,Ci=le===0?qt:Kt,Hi=!1;_e&&(Ce=Math.sqrt(Math.pow(yt-qt,2)+Math.pow(Bt-Kt,2))),si<oe?Ci>oe&&(ve=Oe(Me,yt,Bt,qt,Kt,oe),_e&&(Me.start=Ve+Ce*ve)):si>Y?Ci<Y&&(ve=Oe(Me,yt,Bt,qt,Kt,Y),_e&&(Me.start=Ve+Ce*ve)):Ki(Me,yt,Bt,Yt),Ci<oe&&si>=oe&&(ve=Oe(Me,yt,Bt,qt,Kt,oe),Hi=!0),Ci>Y&&si<=Y&&(ve=Oe(Me,yt,Bt,qt,Kt,Y),Hi=!0),!ge&&Hi&&(_e&&(Me.end=Ve+Ce*ve),we.push(Me),Me=di(ze)),_e&&(Ve+=Ce)}var wi=ze.length-3;yt=ze[wi],Bt=ze[wi+1],Yt=ze[wi+2],(si=le===0?yt:Bt)>=oe&&si<=Y&&Ki(Me,yt,Bt,Yt),wi=Me.length-3,ge&&wi>=3&&(Me[wi]!==Me[0]||Me[wi+1]!==Me[1])&&Ki(Me,Me[0],Me[1],Me[2]),Me.length&&we.push(Me)}function di(ze){var we=[];return we.size=ze.size,we.start=ze.start,we.end=ze.end,we}function li(ze,we,oe,Y,le,ge){for(var _e=0;_e<ze.length;_e++)ni(ze[_e],we,oe,Y,le,ge,!1)}function Ki(ze,we,oe,Y){ze.push(we),ze.push(oe),ze.push(Y)}function tr(ze,we,oe,Y,le,ge){var _e=(ge-we)/(Y-we);return ze.push(ge),ze.push(oe+(le-oe)*_e),ze.push(1),_e}function Ar(ze,we,oe,Y,le,ge){var _e=(ge-oe)/(le-oe);return ze.push(we+(Y-we)*_e),ze.push(ge),ze.push(1),_e}function Er(ze,we){for(var oe=[],Y=0;Y<ze.length;Y++){var le,ge=ze[Y],_e=ge.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")le=Nt(ge.geometry,we);else if(_e==="MultiLineString"||_e==="Polygon"){le=[];for(var Ce=0;Ce<ge.geometry.length;Ce++)le.push(Nt(ge.geometry[Ce],we))}else if(_e==="MultiPolygon")for(le=[],Ce=0;Ce<ge.geometry.length;Ce++){for(var ve=[],Me=0;Me<ge.geometry[Ce].length;Me++)ve.push(Nt(ge.geometry[Ce][Me],we));le.push(ve)}oe.push(gi(ge.id,_e,le,ge.tags))}return oe}function Nt(ze,we){var oe=[];oe.size=ze.size,ze.start!==void 0&&(oe.start=ze.start,oe.end=ze.end);for(var Y=0;Y<ze.length;Y+=3)oe.push(ze[Y]+we,ze[Y+1],ze[Y+2]);return oe}function Ji(ze,we){if(ze.transformed)return ze;var oe,Y,le,ge=1<<ze.z,_e=ze.x,Ce=ze.y;for(oe=0;oe<ze.features.length;oe++){var ve=ze.features[oe],Me=ve.geometry,Oe=ve.type;if(ve.geometry=[],Oe===1)for(Y=0;Y<Me.length;Y+=2)ve.geometry.push(ci(Me[Y],Me[Y+1],we,ge,_e,Ce));else for(Y=0;Y<Me.length;Y++){var Ve=[];for(le=0;le<Me[Y].length;le+=2)Ve.push(ci(Me[Y][le],Me[Y][le+1],we,ge,_e,Ce));ve.geometry.push(Ve)}}return ze.transformed=!0,ze}function ci(ze,we,oe,Y,le,ge){return[Math.round(oe*(ze*Y-le)),Math.round(oe*(we*Y-ge))]}function $t(ze,we,oe,Y,le){for(var ge=we===le.maxZoom?0:le.tolerance/((1<<we)*le.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:Y,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<ze.length;Ce++){_e.numFeatures++,Zi(_e,ze[Ce],ge,le);var ve=ze[Ce].minX,Me=ze[Ce].minY,Oe=ze[Ce].maxX,Ve=ze[Ce].maxY;ve<_e.minX&&(_e.minX=ve),Me<_e.minY&&(_e.minY=Me),Oe>_e.maxX&&(_e.maxX=Oe),Ve>_e.maxY&&(_e.maxY=Ve)}return _e}function Zi(ze,we,oe,Y){var le=we.geometry,ge=we.type,_e=[];if(ge==="Point"||ge==="MultiPoint")for(var Ce=0;Ce<le.length;Ce+=3)_e.push(le[Ce]),_e.push(le[Ce+1]),ze.numPoints++,ze.numSimplified++;else if(ge==="LineString")Qt(_e,le,ze,oe,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ce=0;Ce<le.length;Ce++)Qt(_e,le[Ce],ze,oe,ge==="Polygon",Ce===0);else if(ge==="MultiPolygon")for(var ve=0;ve<le.length;ve++){var Me=le[ve];for(Ce=0;Ce<Me.length;Ce++)Qt(_e,Me[Ce],ze,oe,!0,Ce===0)}if(_e.length){var Oe=we.tags||null;if(ge==="LineString"&&Y.lineMetrics){for(var Ve in Oe={},we.tags)Oe[Ve]=we.tags[Ve];Oe.mapbox_clip_start=le.start/le.size,Oe.mapbox_clip_end=le.end/le.size}var it={geometry:_e,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Oe};we.id!==null&&(it.id=we.id),ze.features.push(it)}}function Qt(ze,we,oe,Y,le,ge){var _e=Y*Y;if(Y>0&&we.size<(le?_e:Y))oe.numPoints+=we.length/3;else{for(var Ce=[],ve=0;ve<we.length;ve+=3)(Y===0||we[ve+2]>_e)&&(oe.numSimplified++,Ce.push(we[ve]),Ce.push(we[ve+1])),oe.numPoints++;le&&function(Me,Oe){for(var Ve=0,it=0,yt=Me.length,Bt=yt-2;it<yt;Bt=it,it+=2)Ve+=(Me[it]-Me[Bt])*(Me[it+1]+Me[Bt+1]);if(Ve>0===Oe)for(it=0,yt=Me.length;it<yt/2;it+=2){var Yt=Me[it],qt=Me[it+1];Me[it]=Me[yt-2-it],Me[it+1]=Me[yt-1-it],Me[yt-2-it]=Yt,Me[yt-1-it]=qt}}(Ce,ge),ze.push(Ce)}}function Bi(ze,we){var oe=(we=this.options=function(le,ge){for(var _e in ge)le[_e]=ge[_e];return le}(Object.create(this.options),we)).debug;if(oe&&console.time("preprocess data"),we.maxZoom<0||we.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(we.promoteId&&we.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(le,ge){var _e=[];if(le.type==="FeatureCollection")for(var Ce=0;Ce<le.features.length;Ce++)Mi(_e,le.features[Ce],ge,Ce);else Mi(_e,le.type==="Feature"?le:{geometry:le},ge);return _e}(ze,we);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",we.indexMaxZoom,we.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(le,ge){var _e=ge.buffer/ge.extent,Ce=le,ve=ut(le,1,-1-_e,_e,0,-1,2,ge),Me=ut(le,1,1-_e,2+_e,0,-1,2,ge);return(ve||Me)&&(Ce=ut(le,1,-_e,1+_e,0,-1,2,ge)||[],ve&&(Ce=Er(ve,1).concat(Ce)),Me&&(Ce=Ce.concat(Er(Me,-1)))),Ce}(Y,we),Y.length&&this.splitTile(Y,0,0,0),oe&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ii(ze,we,oe){return 32*((1<<ze)*oe+we)+ze}function Gt(ze,we){return we?ze.properties[we]:ze.id}function vi(ze,we){if(ze==null)return!0;if(ze.type==="Feature")return Gt(ze,we)!=null;if(ze.type==="FeatureCollection"){const oe=new Set;for(const Y of ze.features){const le=Gt(Y,we);if(le==null||oe.has(le))return!1;oe.add(le)}return!0}return!1}function Jt(ze,we){const oe=new Map;if(ze!=null)if(ze.type==="Feature")oe.set(Gt(ze,we),ze);else for(const Y of ze.features)oe.set(Gt(Y,we),Y);return oe}Bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bi.prototype.splitTile=function(ze,we,oe,Y,le,ge,_e){for(var Ce=[ze,we,oe,Y],ve=this.options,Me=ve.debug;Ce.length;){Y=Ce.pop(),oe=Ce.pop(),we=Ce.pop(),ze=Ce.pop();var Oe=1<<we,Ve=Ii(we,oe,Y),it=this.tiles[Ve];if(!it&&(Me>1&&console.time("creation"),it=this.tiles[Ve]=$t(ze,we,oe,Y,ve),this.tileCoords.push({z:we,x:oe,y:Y}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",we,oe,Y,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var yt="z"+we;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(it.source=ze,le){if(we===ve.maxZoom||we===le)continue;var Bt=1<<le-we;if(oe!==Math.floor(ge/Bt)||Y!==Math.floor(_e/Bt))continue}else if(we===ve.indexMaxZoom||it.numPoints<=ve.indexMaxPoints)continue;if(it.source=null,ze.length!==0){Me>1&&console.time("clipping");var Yt,qt,Kt,si,Ci,Hi,wi=.5*ve.buffer/ve.extent,Ui=.5-wi,st=.5+wi,ti=1+wi;Yt=qt=Kt=si=null,Ci=ut(ze,Oe,oe-wi,oe+st,0,it.minX,it.maxX,ve),Hi=ut(ze,Oe,oe+Ui,oe+ti,0,it.minX,it.maxX,ve),ze=null,Ci&&(Yt=ut(Ci,Oe,Y-wi,Y+st,1,it.minY,it.maxY,ve),qt=ut(Ci,Oe,Y+Ui,Y+ti,1,it.minY,it.maxY,ve),Ci=null),Hi&&(Kt=ut(Hi,Oe,Y-wi,Y+st,1,it.minY,it.maxY,ve),si=ut(Hi,Oe,Y+Ui,Y+ti,1,it.minY,it.maxY,ve),Hi=null),Me>1&&console.timeEnd("clipping"),Ce.push(Yt||[],we+1,2*oe,2*Y),Ce.push(qt||[],we+1,2*oe,2*Y+1),Ce.push(Kt||[],we+1,2*oe+1,2*Y),Ce.push(si||[],we+1,2*oe+1,2*Y+1)}}},Bi.prototype.getTile=function(ze,we,oe){var Y=this.options,le=Y.extent,ge=Y.debug;if(ze<0||ze>24)return null;var _e=1<<ze,Ce=Ii(ze,we=(we%_e+_e)%_e,oe);if(this.tiles[Ce])return Ji(this.tiles[Ce],le);ge>1&&console.log("drilling down to z%d-%d-%d",ze,we,oe);for(var ve,Me=ze,Oe=we,Ve=oe;!ve&&Me>0;)Me--,Oe=Math.floor(Oe/2),Ve=Math.floor(Ve/2),ve=this.tiles[Ii(Me,Oe,Ve)];return ve&&ve.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Me,Oe,Ve),ge>1&&console.time("drilling down"),this.splitTile(ve.source,Me,Oe,Ve,ze,we,oe),ge>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Ji(this.tiles[Ce],le):null):null};class mr extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(we,oe){return c._(this,void 0,void 0,function*(){const Y=we.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!le)return null;const ge=new class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=Ce.length,this._features=Ce}feature(Ce){return new class{constructor(ve){this._feature=ve,this.extent=c.W,this.type=ve.type,this.properties=ve.tags,"id"in ve&&!isNaN(ve.id)&&(this.id=parseInt(ve.id,10))}loadGeometry(){if(this._feature.type===1){const ve=[];for(const Me of this._feature.geometry)ve.push([new c.P(Me[0],Me[1])]);return ve}{const ve=[];for(const Me of this._feature.geometry){const Oe=[];for(const Ve of Me)Oe.push(new c.P(Ve[0],Ve[1]));ve.push(Oe)}return ve}}toGeoJSON(ve,Me,Oe){return ue.call(this,ve,Me,Oe)}}(this._features[Ce])}}(le.features);let _e=Lt(ge);return _e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),{vectorTile:ge,rawData:_e.buffer}})}loadData(we){var oe;return c._(this,void 0,void 0,function*(){(oe=this._pendingRequest)===null||oe===void 0||oe.abort();const Y=!!(we&&we.request&&we.request.collectResourceTiming)&&new c.br(we.request);this._pendingRequest=new AbortController;try{let le=yield this.loadGeoJSON(we,this._pendingRequest);if(delete this._pendingRequest,typeof le!="object")throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`);if(ne(le,!0),we.filter){const _e=c.bx(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(ve=>_e.value.evaluate({zoom:0},ve))}}this._geoJSONIndex=we.cluster?new et(function(_e){let{superclusterOptions:Ce,clusterProperties:ve}=_e;if(!ve||!Ce)return Ce;const Me={},Oe={},Ve={accumulated:null,zoom:0},it={properties:null},yt=Object.keys(ve);for(const Bt of yt){const[Yt,qt]=ve[Bt],Kt=c.bx(qt),si=c.bx(typeof Yt=="string"?[Yt,["accumulated"],["get",Bt]]:Yt);Me[Bt]=Kt.value,Oe[Bt]=si.value}return Ce.map=Bt=>{it.properties=Bt;const Yt={};for(const qt of yt)Yt[qt]=Me[qt].evaluate(Ve,it);return Yt},Ce.reduce=(Bt,Yt)=>{it.properties=Yt;for(const qt of yt)Ve.accumulated=Bt[qt],Bt[qt]=Oe[qt].evaluate(Ve,it)},Ce}(we)).load(le.features):function(_e,Ce){return new Bi(_e,Ce)}(le,we.geojsonVtOptions),this.loaded={};const ge={};if(Y){const _e=Y.finish();_e&&(ge.resourceTiming={},ge.resourceTiming[we.source]=JSON.parse(JSON.stringify(_e)))}return ge}catch(le){if(delete this._pendingRequest,c.by(le))return{abandoned:!0};throw le}})}reloadTile(we){const oe=this.loaded;return oe&&oe[we.uid]?super.reloadTile(we):this.loadTile(we)}loadGeoJSON(we,oe){return c._(this,void 0,void 0,function*(){const{promoteId:Y}=we;if(we.request){const le=yield c.h(we.request,oe);return this._dataUpdateable=vi(le.data,Y)?Jt(le.data,Y):void 0,le.data}if(typeof we.data=="string")try{const le=JSON.parse(we.data);return this._dataUpdateable=vi(le,Y)?Jt(le,Y):void 0,le}catch{throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`)}if(!we.dataDiff)throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${we.source}`);return function(le,ge,_e){var Ce,ve,Me,Oe;if(ge.removeAll&&le.clear(),ge.remove)for(const Ve of ge.remove)le.delete(Ve);if(ge.add)for(const Ve of ge.add){const it=Gt(Ve,_e);it!=null&&le.set(it,Ve)}if(ge.update)for(const Ve of ge.update){let it=le.get(Ve.id);if(it==null)continue;const yt=!Ve.removeAllProperties&&(((Ce=Ve.removeProperties)===null||Ce===void 0?void 0:Ce.length)>0||((ve=Ve.addOrUpdateProperties)===null||ve===void 0?void 0:ve.length)>0);if((Ve.newGeometry||Ve.removeAllProperties||yt)&&(it=Object.assign({},it),le.set(Ve.id,it),yt&&(it.properties=Object.assign({},it.properties))),Ve.newGeometry&&(it.geometry=Ve.newGeometry),Ve.removeAllProperties)it.properties={};else if(((Me=Ve.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Bt of Ve.removeProperties)Object.prototype.hasOwnProperty.call(it.properties,Bt)&&delete it.properties[Bt];if(((Oe=Ve.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const{key:Bt,value:Yt}of Ve.addOrUpdateProperties)it.properties[Bt]=Yt}}(this._dataUpdateable,we.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(we){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(we){return this._geoJSONIndex.getClusterExpansionZoom(we.clusterId)}getClusterChildren(we){return this._geoJSONIndex.getChildren(we.clusterId)}getClusterLeaves(we){return this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset)}}class Sr{constructor(we){this.self=we,this.actor=new c.C(we),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(oe,Y)=>{if(this.externalWorkerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.externalWorkerSourceTypes[oe]=Y},this.self.addProtocol=c.be,this.self.removeProtocol=c.bf,this.self.registerRTLTextPlugin=oe=>{if(c.bz.isParsed())throw new Error("RTL text plugin already registered.");c.bz.setMethods(oe)},this.actor.registerMessageHandler("loadDEMTile",(oe,Y)=>this._getDEMWorkerSource(oe,Y.source).loadTile(Y)),this.actor.registerMessageHandler("removeDEMTile",(oe,Y)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(oe,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(oe,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("getClusterChildren",(oe,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("getClusterLeaves",(oe,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("loadData",(oe,Y)=>this._getWorkerSource(oe,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("loadTile",(oe,Y)=>this._getWorkerSource(oe,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("reloadTile",(oe,Y)=>this._getWorkerSource(oe,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("abortTile",(oe,Y)=>this._getWorkerSource(oe,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("removeTile",(oe,Y)=>this._getWorkerSource(oe,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("removeSource",(oe,Y)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[oe]||!this.workerSources[oe][Y.type]||!this.workerSources[oe][Y.type][Y.source])return;const le=this.workerSources[oe][Y.type][Y.source];delete this.workerSources[oe][Y.type][Y.source],le.removeSource!==void 0&&le.removeSource(Y)})),this.actor.registerMessageHandler("setReferrer",(oe,Y)=>c._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("syncRTLPluginState",(oe,Y)=>this._syncRTLPluginState(oe,Y)),this.actor.registerMessageHandler("importScript",(oe,Y)=>c._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("setImages",(oe,Y)=>this._setImages(oe,Y)),this.actor.registerMessageHandler("updateLayers",(oe,Y)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(oe).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("setLayers",(oe,Y)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(oe).replace(Y)}))}_setImages(we,oe){return c._(this,void 0,void 0,function*(){this.availableImages[we]=oe;for(const Y in this.workerSources[we]){const le=this.workerSources[we][Y];for(const ge in le)le[ge].availableImages=oe}})}_syncRTLPluginState(we,oe){return c._(this,void 0,void 0,function*(){c.bz.setState(oe);const Y=c.bz.getPluginURL();if(oe.pluginStatus==="loaded"&&!c.bz.isParsed()&&Y!=null){this.self.importScripts(Y);const le=c.bz.isParsed();if(le)return le;throw new Error(`RTL Text Plugin failed to import scripts from ${Y}`)}return!1})}_getAvailableImages(we){let oe=this.availableImages[we];return oe||(oe=[]),oe}_getLayerIndex(we){let oe=this.layerIndexes[we];return oe||(oe=this.layerIndexes[we]=new s),oe}_getWorkerSource(we,oe,Y){if(this.workerSources[we]||(this.workerSources[we]={}),this.workerSources[we][oe]||(this.workerSources[we][oe]={}),!this.workerSources[we][oe][Y]){const le={sendAsync:(ge,_e)=>(ge.targetMapId=we,this.actor.sendAsync(ge,_e))};switch(oe){case"vector":this.workerSources[we][oe][Y]=new F(le,this._getLayerIndex(we),this._getAvailableImages(we));break;case"geojson":this.workerSources[we][oe][Y]=new mr(le,this._getLayerIndex(we),this._getAvailableImages(we));break;default:this.workerSources[we][oe][Y]=new this.externalWorkerSourceTypes[oe](le,this._getLayerIndex(we),this._getAvailableImages(we))}}return this.workerSources[we][oe][Y]}_getDEMWorkerSource(we,oe){return this.demWorkerSources[we]||(this.demWorkerSources[we]={}),this.demWorkerSources[we][oe]||(this.demWorkerSources[we][oe]=new O),this.demWorkerSources[we][oe]}}return c.i(self)&&(self.worker=new Sr(self)),Sr}),n("index",["exports","./shared"],function(c,s){var m="4.0.2";let x,I;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((a,d)=>{const _=requestAnimationFrame(a);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),d(s.c())})}),getImageData(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(y).getImageData(-a,-a,y.width+2*a,y.height+2*a)},getImageCanvasContext(y){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=y.width,a.height=y.height,d.drawImage(y,0,0,y.width,y.height),d},resolveURL:y=>(x||(x=document.createElement("a")),x.href=y,x.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(I==null&&(I=matchMedia("(prefers-reduced-motion: reduce)")),I.matches)}};class O{static testProp(a){if(!O.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in O.docStyle)return a[d];return a[0]}static create(a,d,_){const B=window.document.createElement(a);return d!==void 0&&(B.className=d),_&&_.appendChild(B),B}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){O.docStyle&&O.selectProp&&(O.userSelect=O.docStyle[O.selectProp],O.docStyle[O.selectProp]="none")}static enableDrag(){O.docStyle&&O.selectProp&&(O.docStyle[O.selectProp]=O.userSelect)}static setTransform(a,d){a.style[O.transformProp]=d}static addEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(d,_,"passive"in B?B:B.capture)}static removeEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(d,_,"passive"in B?B:B.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",O.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",O.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",O.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,_){const B=d.boundingClientRect;return new s.P((_.clientX-B.left)/d.x-a.clientLeft,(_.clientY-B.top)/d.y-a.clientTop)}static mousePos(a,d){const _=O.getScale(a);return O.getPoint(a,_,d)}static touchPos(a,d){const _=[],B=O.getScale(a);for(let S=0;S<d.length;S++)_.push(O.getPoint(a,B,d[S]));return _}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}O.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,O.selectProp=O.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),O.transformProp=O.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(y){!ue&&ne&&(ce?de(y):ie=y)}};let ie,ne,ue=!1,ce=!1;function de(y){const a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,ne),y.isContextLost())return;z.supported=!0}catch{}y.deleteTexture(a),ue=!0}var be,Te;typeof document<"u"&&(ne=document.createElement("img"),ne.onload=function(){ie&&de(ie),ie=null,ce=!0},ne.onerror=function(){ue=!0,ie=null},ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let a,d,_,B;y.resetRequestQueue=()=>{a=[],d=0,_=0,B={}},y.addThrottleControl=q=>{const w=_++;return B[w]=q,w},y.removeThrottleControl=q=>{delete B[q],U()},y.getImage=function(q,w){let T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((R,j)=>{z.supported&&(q.headers||(q.headers={}),q.headers.accept="image/webp,*/*"),s.e(q,{type:"image"}),a.push({abortController:w,requestParameters:q,supportImageRefresh:T,state:"queued",onError:Z=>{j(Z)},onSuccess:Z=>{R(Z)}}),U()})};const S=q=>s._(this,void 0,void 0,function*(){q.state="running";const{requestParameters:w,supportImageRefresh:T,onError:R,onSuccess:j,abortController:Z}=q,W=T===!1&&!s.i(self)&&!s.g(w.url)&&(!w.headers||Object.keys(w.headers).reduce((ae,fe)=>ae&&fe==="accept",!0));d++;const J=W?H(w,Z):s.m(w,Z);try{const ae=yield J;delete q.abortController,q.state="completed",ae.data instanceof HTMLImageElement||s.b(ae.data)?j(ae):ae.data&&j({data:yield(ee=ae.data,typeof createImageBitmap=="function"?s.d(ee):s.f(ee)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete q.abortController,R(ae)}finally{d--,U()}var ee}),U=()=>{const q=(()=>{for(const w of Object.keys(B))if(B[w]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=d;w<q&&a.length>0;w++){const T=a.shift();T.abortController.signal.aborted?w--:S(T)}},H=(q,w)=>new Promise((T,R)=>{const j=new Image,Z=q.url,W=q.credentials;W&&W==="include"?j.crossOrigin="use-credentials":(W&&W==="same-origin"||!s.s(Z))&&(j.crossOrigin="anonymous"),w.signal.addEventListener("abort",()=>{j.src="",R(s.c())}),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,T({data:j})},j.onerror=()=>{j.onerror=j.onload=null,w.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=Z})}(be||(be={})),be.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Te||(Te={}));class je{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,_){const B=function(S){const U=S.match(Ge);if(!U)throw new Error(`Unable to parse URL "${S}"`);return{protocol:U[1],authority:U[2],path:U[3]||"/",params:U[4]?U[4].split("&"):[]}}(a);return B.path+=`${d}${_}`,function(S){const U=S.params.length?`?${S.params.join("&")}`:"";return`${S.protocol}://${S.authority}${S.path}${U}`}(B)}setTransformRequest(a){this._transformRequestFn=a}}const Ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $e(y){var a=new s.A(3);return a[0]=y[0],a[1]=y[1],a[2]=y[2],a}var Ue,lt=function(y,a,d){return y[0]=a[0]-d[0],y[1]=a[1]-d[1],y[2]=a[2]-d[2],y};Ue=new s.A(3),s.A!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0);var nt=function(y){var a=y[0],d=y[1];return a*a+d*d};function De(y){const a=[];if(typeof y=="string")a.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:_,url:B}of y){const S=`${_}${B}`;d.indexOf(S)===-1&&(d.push(S),a.push({id:_,url:B}))}}return a}(function(){var y=new s.A(2);s.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Fe{constructor(a,d,_,B){this.context=a,this.format=_,this.texture=a.gl.createTexture(),this.update(d,B)}update(a,d,_){const{width:B,height:S}=a,U=!(this.size&&this.size[0]===B&&this.size[1]===S||_),{context:H}=this,{gl:q}=H;if(this.useMipmap=!!(d&&d.useMipmap),q.bindTexture(q.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===q.RGBA&&(!d||d.premultiply!==!1)),U)this.size=[B,S],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texImage2D(q.TEXTURE_2D,0,this.format,this.format,q.UNSIGNED_BYTE,a):q.texImage2D(q.TEXTURE_2D,0,this.format,B,S,0,this.format,q.UNSIGNED_BYTE,a.data);else{const{x:w,y:T}=_||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texSubImage2D(q.TEXTURE_2D,0,w,T,q.RGBA,q.UNSIGNED_BYTE,a):q.texSubImage2D(q.TEXTURE_2D,0,w,T,B,S,q.RGBA,q.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&q.generateMipmap(q.TEXTURE_2D)}bind(a,d,_){const{context:B}=this,{gl:S}=B;S.bindTexture(S.TEXTURE_2D,this.texture),_!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=S.LINEAR),a!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,_||a),this.filter=a),d!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Je(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class We extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let _=!0;const B=d.data||d.spriteData;return this._validateStretch(d.stretchX,B&&B.width)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,B&&B.height)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const B of a){if(B[0]<_||B[1]<B[0]||d<B[1])return!1;_=B[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const _=d.spriteData,B=_&&_.width||d.data.width,S=_&&_.height||d.data.height;return!(a[0]<0||B<a[0]||a[1]<0||S<a[1]||a[2]<0||B<a[2]||a[3]<0||S<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const B=this.getImage(a);if(_&&(B.data.width!==d.data.width||B.data.height!==d.data.height))throw new Error(`size mismatch between old image (${B.data.width}x${B.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=B.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,_)=>{let B=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(B=!1);this.isLoaded()||B?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const _ of a){let B=this.getImage(_);B||(this.fire(new s.k("styleimagemissing",{id:_})),B=this.getImage(_)),B?d[_]={data:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],_=this.getImage(a);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const B={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new s.I(B,_);this.patterns[a]={bin:B,position:S}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const S in this.patterns)a.push(this.patterns[S].bin);const{w:d,h:_}=s.p(a),B=this.atlasImage;B.resize({width:d||1,height:_||1});for(const S in this.patterns){const{bin:U}=this.patterns[S],H=U.x+1,q=U.y+1,w=this.getImage(S).data,T=w.width,R=w.height;s.R.copy(w,B,{x:0,y:0},{x:H,y:q},{width:T,height:R}),s.R.copy(w,B,{x:0,y:R-1},{x:H,y:q-1},{width:T,height:1}),s.R.copy(w,B,{x:0,y:0},{x:H,y:q+R},{width:T,height:1}),s.R.copy(w,B,{x:T-1,y:0},{x:H-1,y:q},{width:1,height:R}),s.R.copy(w,B,{x:0,y:0},{x:H+T,y:q},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||s.w(`Image with ID: "${d}" was not found`),Je(_)&&this.updateImage(d,_)}}}const Et=1e20;function Ct(y,a,d,_,B,S,U,H,q){for(let w=a;w<a+_;w++)Lt(y,d*S+w,S,B,U,H,q);for(let w=d;w<d+B;w++)Lt(y,w*S+a,1,_,U,H,q)}function Lt(y,a,d,_,B,S,U){S[0]=0,U[0]=-Et,U[1]=Et,B[0]=y[a];for(let H=1,q=0,w=0;H<_;H++){B[H]=y[a+H*d];const T=H*H;do{const R=S[q];w=(B[H]-B[R]+T-R*R)/(H-R)/2}while(w<=U[q]&&--q>-1);q++,S[q]=H,U[q]=w,U[q+1]=Et}for(let H=0,q=0;H<_;H++){for(;U[q+1]<H;)q++;const w=S[q],T=H-w;y[a+H*d]=B[w]+T*T}}class _t{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return s._(this,void 0,void 0,function*(){const d=[];for(const S in a)for(const U of a[S])d.push(this._getAndCacheGlyphsPromise(S,U));const _=yield Promise.all(d),B={};for(const{stack:S,id:U,glyph:H}of _)B[S]||(B[S]={}),B[S][U]=H&&{id:H.id,bitmap:H.bitmap.clone(),metrics:H.metrics};return B})}_getAndCacheGlyphsPromise(a,d){return s._(this,void 0,void 0,function*(){let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return{stack:a,id:d,glyph:B};if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,{stack:a,id:d,glyph:B};const S=Math.floor(d/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:a,id:d,glyph:B};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){const H=_t.loadGlyphRange(a,S,this.url,this.requestManager);_.requests[S]=H}const U=yield _.requests[S];for(const H in U)this._doesCharSupportLocalGlyph(+H)||(_.glyphs[+H]=U[+H]);return _.ranges[S]=!0,{stack:a,id:d,glyph:U[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](a)||s.u["Hangul Syllables"](a)||s.u.Hiragana(a)||s.u.Katakana(a))}_tinySDF(a,d,_){const B=this.localIdeographFontFamily;if(!B||!this._doesCharSupportLocalGlyph(_))return;let S=a.tinySDF;if(!S){let H="400";/bold/i.test(d)?H="900":/medium/i.test(d)?H="500":/light/i.test(d)&&(H="200"),S=a.tinySDF=new _t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:B,fontWeight:H})}const U=S.draw(String.fromCharCode(_));return{id:_,bitmap:new s.o({width:U.width||60,height:U.height||60},U.data),metrics:{width:U.glyphWidth/2||24,height:U.glyphHeight/2||24,left:U.glyphLeft/2+.5||0,top:U.glyphTop/2-27.5||-8,advance:U.glyphAdvance/2||24,isDoubleResolution:!0}}}}_t.loadGlyphRange=function(y,a,d,_){return s._(this,void 0,void 0,function*(){const B=256*a,S=B+255,U=_.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${B}-${S}`),Te.Glyphs),H=yield s.l(U,new AbortController);if(!H||!H.data)throw new Error(`Could not load glyph range. range: ${a}, ${B}-${S}`);const q={};for(const w of s.n(H.data))q[w.id]=w;return q})},_t.TinySDF=class{constructor(){let{fontSize:y=24,buffer:a=3,radius:d=8,cutoff:_=.25,fontFamily:B="sans-serif",fontWeight:S="normal",fontStyle:U="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=_,this.radius=d;const H=this.size=y+4*a,q=this._createCanvas(H),w=this.ctx=q.getContext("2d",{willReadFrequently:!0});w.font=`${U} ${S} ${y}px ${B}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(y){const a=document.createElement("canvas");return a.width=a.height=y,a}draw(y){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:B,actualBoundingBoxRight:S}=this.ctx.measureText(y),U=Math.ceil(d),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-B))),q=Math.min(this.size-this.buffer,U+Math.ceil(_)),w=H+2*this.buffer,T=q+2*this.buffer,R=Math.max(w*T,0),j=new Uint8ClampedArray(R),Z={data:j,width:w,height:T,glyphWidth:H,glyphHeight:q,glyphTop:U,glyphLeft:0,glyphAdvance:a};if(H===0||q===0)return Z;const{ctx:W,buffer:J,gridInner:ee,gridOuter:ae}=this;W.clearRect(J,J,H,q),W.fillText(y,J,J+U);const fe=W.getImageData(J,J,H,q);ae.fill(Et,0,R),ee.fill(0,0,R);for(let pe=0;pe<q;pe++)for(let xe=0;xe<H;xe++){const Pe=fe.data[4*(pe*H+xe)+3]/255;if(Pe===0)continue;const Le=(pe+J)*w+xe+J;if(Pe===1)ae[Le]=0,ee[Le]=Et;else{const rt=.5-Pe;ae[Le]=rt>0?rt*rt:0,ee[Le]=rt<0?rt*rt:0}}Ct(ae,0,0,w,T,w,this.f,this.v,this.z),Ct(ee,J,J,H,q,w,this.f,this.v,this.z);for(let pe=0;pe<R;pe++){const xe=Math.sqrt(ae[pe])-Math.sqrt(ee[pe]);j[pe]=Math.round(255-255*(xe/this.radius+this.cutoff))}return Z}};class Ft{constructor(){this.specification=s.v.light.position}possiblyEvaluate(a,d){return s.y(a.expression.evaluate(d))}interpolate(a,d,_){return{x:s.z.number(a.x,d.x,_),y:s.z.number(a.y,d.y,_),z:s.z.number(a.z,d.z,_)}}}let Mt;class Wt extends s.E{constructor(a){super(),Mt=Mt||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ft,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Mt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.r,a,d))for(const _ in a){const B=a[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),B):this._transitionable.setValue(_,B)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||_.validate!==!1)&&s.t(this,a.call(s.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Ee{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const _=a.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(a,d)),this.dashEntry[_]}getDashRanges(a,d,_){const B=[];let S=a.length%2==1?-a[a.length-1]*_:0,U=a[0]*_,H=!0;B.push({left:S,right:U,isDash:H,zeroLength:a[0]===0});let q=a[0];for(let w=1;w<a.length;w++){H=!H;const T=a[w];S=q*_,q+=T,U=q*_,B.push({left:S,right:U,isDash:H,zeroLength:T===0})}return B}addRoundDash(a,d,_){const B=d/2;for(let S=-_;S<=_;S++){const U=this.width*(this.nextRow+_+S);let H=0,q=a[H];for(let w=0;w<this.width;w++){w/q.right>1&&(q=a[++H]);const T=Math.abs(w-q.left),R=Math.abs(w-q.right),j=Math.min(T,R);let Z;const W=S/_*(B+1);if(q.isDash){const J=B-Math.abs(W);Z=Math.sqrt(j*j+J*J)}else Z=B-Math.sqrt(j*j+W*W);this.data[U+w]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(a){for(let H=a.length-1;H>=0;--H){const q=a[H],w=a[H+1];q.zeroLength?a.splice(H,1):w&&w.isDash===q.isDash&&(w.left=q.left,a.splice(H,1))}const d=a[0],_=a[a.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const B=this.width*this.nextRow;let S=0,U=a[S];for(let H=0;H<this.width;H++){H/U.right>1&&(U=a[++S]);const q=Math.abs(H-U.left),w=Math.abs(H-U.right),T=Math.min(q,w);this.data[B+H]=Math.max(0,Math.min(255,(U.isDash?T:-T)+128))}}addDash(a,d){const _=d?7:0,B=2*_+1;if(this.nextRow+B>this.height)return s.w("LineAtlas out of space"),null;let S=0;for(let H=0;H<a.length;H++)S+=a[H];if(S!==0){const H=this.width/S,q=this.getDashRanges(a,this.width,H);d?this.addRoundDash(q,H,_):this.addRegularDash(q)}const U={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=B,this.dirty=!0,U}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Xe="maplibre_preloaded_worker_pool";class et{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<et.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xe]}numActive(){return Object.keys(this.active).length}}const At=Math.floor(F.hardwareConcurrency/2);let ft,wt;function Pt(){return ft||(ft=new et),ft}et.workerCount=s.B(globalThis)?Math.max(Math.min(At,3),1):1;class It{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let B=0;B<_.length;B++){const S=new s.C(_[B],d);S.name=`Worker ${B}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const _=[];for(const B of this.actors)_.push(B.sendAsync({type:a,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const _ of this.actors)_.registerMessageHandler(a,d)}}function Ht(){return wt||(wt=new It(Pt(),s.G),wt.registerMessageHandler("getResource",(y,a,d)=>s.m(a,d))),wt}function ii(y,a){const d=s.F();return s.H(d,d,[1,1,0]),s.J(d,d,[.5*y.width,.5*y.height,1]),s.K(d,d,y.calculatePosMatrix(a.toUnwrapped()))}function gi(y,a,d,_,B,S){const U=function(R,j,Z){if(R)for(const W of R){const J=j[W];if(J&&J.source===Z&&J.type==="fill-extrusion")return!0}else for(const W in j){const J=j[W];if(J.source===Z&&J.type==="fill-extrusion")return!0}return!1}(B&&B.layers,a,y.id),H=S.maxPitchScaleFactor(),q=y.tilesIn(_,H,U);q.sort(mi);const w=[];for(const R of q)w.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(a,d,y._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,B,S,H,ii(y.transform,R.tileID))});const T=function(R){const j={},Z={};for(const W of R){const J=W.queryResults,ee=W.wrappedTileID,ae=Z[ee]=Z[ee]||{};for(const fe in J){const pe=J[fe],xe=ae[fe]=ae[fe]||{},Pe=j[fe]=j[fe]||[];for(const Le of pe)xe[Le.featureIndex]||(xe[Le.featureIndex]=!0,Pe.push(Le))}}return j}(w);for(const R in T)T[R].forEach(j=>{const Z=j.feature,W=y.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=W});return T}function mi(y,a){const d=y.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Mi(y,a,d){return s._(this,void 0,void 0,function*(){let _=y;if(y.url?_=(yield s.h(a.transformRequest(y.url,Te.Source),d)).data:yield F.frameAsync(d),!_)return null;const B=s.L(s.e(_,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(B.vectorLayerIds=_.vector_layers.map(S=>S.id)),B})}class kt{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}extend(a){const d=this._sw,_=this._ne;let B,S;if(a instanceof s.M)B=a,S=a;else{if(!(a instanceof kt))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(kt.convert(a)):this.extend(s.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(s.M.convert(a)):this;if(B=a._sw,S=a._ne,!B||!S)return this}return d||_?(d.lng=Math.min(B.lng,d.lng),d.lat=Math.min(B.lat,d.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new s.M(B.lng,B.lat),this._ne=new s.M(S.lng,S.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:_}=s.M.convert(a);let B=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&B}static convert(a){return a instanceof kt?a:a&&new kt(a)}static fromLngLat(a){const _=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,B=_/Math.cos(Math.PI/180*a.lat);return new kt(new s.M(a.lng-B,a.lat-_),new s.M(a.lng+B,a.lat+_))}}class ot{constructor(a,d,_){this.bounds=kt.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),_=Math.floor(s.N(this.bounds.getWest())*d),B=Math.floor(s.O(this.bounds.getNorth())*d),S=Math.ceil(s.N(this.bounds.getEast())*d),U=Math.ceil(s.O(this.bounds.getSouth())*d);return a.x>=_&&a.x<S&&a.y>=B&&a.y<U}}class xt extends s.E{constructor(a,d,_,B){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(d,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(B)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(s.e(this,a),a.bounds&&(this.tileBounds=new ot(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,Te.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let B="reloadTile";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((S,U)=>{a.reloadPromise={resolve:S,reject:U}})}else a.actor=this.dispatcher.getActor(),B="loadTile";a.abortController=new AbortController;try{const S=yield a.actor.sendAsync({type:B,data:_},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,S)}catch(S){if(delete a.abortController,a.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const _=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(_.resolve).catch(_.reject)}}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"abortTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ri extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.setEventedParent(B),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.L(d,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(s.e(this,a),a.bounds&&(this.tileBounds=new ot(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return s.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const _=yield be.getImage(this.map._requestManager.transformRequest(d,Te.Tile),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&a.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const B=this.map.painter.context,S=B.gl,U=_.data;a.texture=this.map.painter.getTileTexture(U.width),a.texture?a.texture.update(U,{useMipmap:!0}):(a.texture=new Fe(B,U,S.RGBA,{useMipmap:!0}),a.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(_){if(delete a.abortController,a.aborted)a.state="unloaded";else if(_)throw a.state="errored",_}})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ei extends Ri{constructor(a,d,_,B){super(a,d,_,B),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,Te.Tile);a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const B=yield be.getImage(_,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(B&&B.data){const S=B.data;this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&a.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const U=s.b(S)&&s.S()?S:yield this.readImageNow(S),H={type:this.type,uid:a.uid,source:this.id,rawImageData:U,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const q=yield a.actor.sendAsync({type:"loadDEMTile",data:H});a.dem=q,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(B){if(delete a.abortController,a.aborted)a.state="unloaded";else if(B)throw a.state="errored",B}})}readImageNow(a){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const d=a.width+2,_=a.height+2;try{return new s.R({width:d,height:_},yield s.V(a,-1,-1,d,_))}catch{}}return F.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,_=Math.pow(2,d.z),B=(d.x-1+_)%_,S=d.x===0?a.wrap-1:a.wrap,U=(d.x+1+_)%_,H=d.x+1===_?a.wrap+1:a.wrap,q={};return q[new s.Q(a.overscaledZ,S,d.z,B,d.y).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y).key]={backfilled:!1},d.y>0&&(q[new s.Q(a.overscaledZ,S,d.z,B,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y-1).key]={backfilled:!1}),d.y+1<_&&(q[new s.Q(a.overscaledZ,S,d.z,B,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y+1).key]={backfilled:!1}),q}unloadTile(a){return s._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class ut extends s.E{constructor(a,d,_,B){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(B),this._data=d.data,this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const S=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:s.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.W,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,_){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:_}})}_updateWorkerData(a){return s._(this,void 0,void 0,function*(){const d=s.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),Te.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let B=null;_.resourceTiming&&_.resourceTiming[this.id]&&(B=_.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(S,{resourceTiming:B}),this.fire(new s.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const _={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const B=yield this.actor.sendAsync({type:d,data:_},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(B,this.map.painter,d==="reloadTile")})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ni extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(B),this.options=d}load(a){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield be.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this.fire(new s.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(s.Y.fromLngLat);this.tileID=function(B){let S=1/0,U=1/0,H=-1/0,q=-1/0;for(const j of B)S=Math.min(S,j.x),U=Math.min(U,j.y),H=Math.max(H,j.x),q=Math.max(q,j.y);const w=Math.max(H-S,q-U),T=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),R=Math.pow(2,T);return new s.a0(T,Math.floor((S+H)/2*R),Math.floor((U+q)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(B=>this.tileID.getTilePoint(B)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,s.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,s.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class di extends ni{constructor(a,d,_,B){super(a,d,_,B),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,Te.Source).url);try{const d=yield s.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class li extends ni{constructor(a,d,_,B){super(a,d,_,B),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(U=>typeof U!="number"))||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(d,this.canvas,_.RGBA,{premultiply:!0});let B=!1;for(const S in this.tiles){const U=this.tiles[S];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture,B=!0)}B&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Ki={},tr=y=>{switch(y){case"geojson":return ut;case"image":return ni;case"raster":return Ri;case"raster-dem":return ei;case"vector":return xt;case"video":return di;case"canvas":return li}return Ki[y]};class Ar extends s.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=Ht(),this.queue=[]}_sendPluginStateToWorker(){return s._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new s.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return s._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=F.resolveURL(a),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),d||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield s.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let Er=null;function Nt(){return Er||(Er=new Ar),Er}class Ji{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=s.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,S){const U={};if(!S)return U;for(const H of B){const q=H.layerIds.map(w=>S.getLayer(w)).filter(Boolean);if(q.length!==0){H.layers=q,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(w=>q.filter(T=>T.id===w)[0]));for(const w of q)U[w.id]=H}}return U}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const B in this.buckets){const S=this.buckets[B];if(S instanceof s.a5){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const B in this.buckets){const S=this.buckets[B];if(S instanceof s.a5&&S.hasRTLText){this.hasRTLText=!0,Nt().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const B in this.buckets){const S=this.buckets[B];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(B).queryRadius(S))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const _ in this.buckets){const B=this.buckets[_];B.uploadPending()&&B.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,_,B,S,U,H,q,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:B,cameraQueryGeometry:S,scale:U,tileSize:this.tileSize,pixelPosMatrix:T,transform:q,params:H,queryPadding:this.queryPadding*w},a,d,_):{}}querySourceFeatures(a,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const B=_.loadVTLayers(),S=d&&d.sourceLayer?d.sourceLayer:"",U=B._geojsonTileLayer||B[S];if(!U)return;const H=s.a6(d&&d.filter),{z:q,x:w,y:T}=this.tileID.canonical,R={z:q,x:w,y:T};for(let j=0;j<U.length;j++){const Z=U.feature(j);if(H.needGeometry){const ee=s.a7(Z,!0);if(!H.filter(new s.a8(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!H.filter(new s.a8(this.tileID.overscaledZ),Z))continue;const W=_.getId(Z,S),J=new s.a9(Z,q,w,T,W);J.tile=R,a.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const _=s.aa(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let B=!1;if(this.expirationTime>_)B=!1;else if(d)if(this.expirationTime<d)B=!0;else{const S=this.expirationTime-d;S?this.expirationTime=_+Math.max(S,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const B in this.buckets){if(!d.style.hasLayer(B))continue;const S=this.buckets[B],U=S.layers[0].sourceLayer||"_geojsonTileLayer",H=_[U],q=a[U];if(!H||!q||Object.keys(q).length===0)continue;S.update(q,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=d&&d.style&&d.style.getLayer(B);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=F.now()+a}setDependencies(a,d){const _={};for(const B of d)_[B]=!0;this.dependencies[a]=_}hasDependency(a,d){for(const _ of a){const B=this.dependencies[_];if(B){for(const S of d)if(B[S])return!0}}return!1}}class ci{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,_){const B=a.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);const S={value:d,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(a,S)},_)),this.data[B].push(S),this.order.push(B),this.order.length>this.max){const U=this._getAndRemoveByKey(this.order[0]);U&&this.onRemove(U)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const _=a.wrapped().key,B=d===void 0?0:this.data[_].indexOf(d),S=this.data[_][B];return this.data[_].splice(B,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const _ in this.data)for(const B of this.data[_])a(B.value)||d.push(B);for(const _ of d)this.remove(_.value.tileID,_)}}class $t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,_){const B=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][B]=this.stateChanges[a][B]||{},s.e(this.stateChanges[a][B],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const S in this.state[a])S!==B&&(this.deletedStates[a][S]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][B]===null){this.deletedStates[a][B]={};for(const S in this.state[a][B])_[S]||(this.deletedStates[a][B][S]=null)}else for(const S in _)this.deletedStates[a]&&this.deletedStates[a][B]&&this.deletedStates[a][B][S]===null&&delete this.deletedStates[a][B][S]}removeFeatureState(a,d,_){if(this.deletedStates[a]===null)return;const B=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&d!==void 0)this.deletedStates[a][B]!==null&&(this.deletedStates[a][B]=this.deletedStates[a][B]||{},this.deletedStates[a][B][_]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][B])for(_ in this.deletedStates[a][B]={},this.stateChanges[a][B])this.deletedStates[a][B][_]=null;else this.deletedStates[a][B]=null;else this.deletedStates[a]=null}getState(a,d){const _=String(d),B=s.e({},(this.state[a]||{})[_],(this.stateChanges[a]||{})[_]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const S=this.deletedStates[a][d];if(S===null)return{};for(const U in S)delete B[U]}return B}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const _={};for(const B in this.stateChanges){this.state[B]=this.state[B]||{};const S={};for(const U in this.stateChanges[B])this.state[B][U]||(this.state[B][U]={}),s.e(this.state[B][U],this.stateChanges[B][U]),S[U]=this.state[B][U];_[B]=S}for(const B in this.deletedStates){this.state[B]=this.state[B]||{};const S={};if(this.deletedStates[B]===null)for(const U in this.state[B])S[U]={},this.state[B][U]={};else for(const U in this.deletedStates[B]){if(this.deletedStates[B][U]===null)this.state[B][U]={};else for(const H of Object.keys(this.deletedStates[B][U]))delete this.state[B][U][H];S[U]=this.state[B][U]}_[B]=_[B]||{},s.e(_[B],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const B in a)a[B].setFeatureState(_,d)}}class Zi extends s.E{constructor(a,d,_){super(),this.id=a,this.dispatcher=_,this.on("data",B=>{B.dataType==="source"&&B.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((B,S,U,H)=>{const q=new(tr(S.type))(B,S,U,H);if(q.id!==B)throw new Error(`Expected Source id to be ${B} instead of ${q.id}`);return q})(a,d,_,this),this._tiles={},this._cache=new ci(0,B=>this._unloadTile(B)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $t,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,_)}catch(B){a.state="errored",B.status!==404?this._source.fire(new s.j(B,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new s.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(a),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Qt).map(a=>a.key)}getRenderableIds(a){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,a)&&d.push(this._tiles[_]);return a?d.sort((_,B)=>{const S=_.tileID,U=B.tileID,H=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),q=new s.P(U.canonical.x,U.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-U.overscaledZ||q.y-H.y||q.x-H.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(Qt).map(_=>_.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return s._(this,void 0,void 0,function*(){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,a,d))})}_tileLoaded(a,d,_){a.timeAdded=F.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let B=0;B<d.length;B++){const S=d[B];if(a.neighboringTiles&&a.neighboringTiles[S]){const U=this.getTileByID(S);_(a,U),_(U,a)}}function _(B,S){B.needsHillshadePrepare=!0,B.needsTerrainPrepare=!0;let U=S.tileID.canonical.x-B.tileID.canonical.x;const H=S.tileID.canonical.y-B.tileID.canonical.y,q=Math.pow(2,B.tileID.canonical.z),w=S.tileID.key;U===0&&H===0||Math.abs(H)>1||(Math.abs(U)>1&&(Math.abs(U+q)===1?U+=q:Math.abs(U-q)===1&&(U-=q)),S.dem&&B.dem&&(B.dem.backfillBorder(S.dem,U,H),B.neighboringTiles&&B.neighboringTiles[w]&&(B.neighboringTiles[w].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,_,B){for(const S in this._tiles){let U=this._tiles[S];if(B[S]||!U.hasData()||U.tileID.overscaledZ<=d||U.tileID.overscaledZ>_)continue;let H=U.tileID;for(;U&&U.tileID.overscaledZ>d+1;){const w=U.tileID.scaledTo(U.tileID.overscaledZ-1);U=this._tiles[w.key],U&&U.hasData()&&(H=w)}let q=H;for(;q.overscaledZ>d;)if(q=q.scaledTo(q.overscaledZ-1),a[q.key]){B[H.key]=H;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=a.overscaledZ-1;_>=d;_--){const B=a.scaledTo(_),S=this._getLoadedTile(B);if(S)return S}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,_=Math.ceil(a.height/this._source.tileSize)+1,B=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,B):B;this._cache.setMaxSize(S)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const _={};for(const B in this._tiles){const S=this._tiles[B];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),_[S.tileID.key]=S}this._tiles=_;for(const B in this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(const B in this._tiles)this._setTileReloadTimer(B,this._tiles[B])}}update(a,d){if(this.transform=a,this.terrain=d,!this._sourceLoaded||this._paused)return;let _;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new s.Q(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(_=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(T=>this._source.hasTile(T)))):_=[];const B=a.coveringZoomLevel(this._source),S=Math.max(B-Zi.maxOverzooming,this._source.minzoom),U=Math.max(B+Zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const T={};for(const R of _)if(R.canonical.z>this._source.minzoom){const j=R.scaledTo(R.canonical.z-1);T[j.key]=j;const Z=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));T[Z.key]=Z}_=_.concat(Object.values(T))}const H=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,H&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const q=this._updateRetainedTiles(_,B);if(Bi(this._source.type)){const T={},R={},j=Object.keys(q),Z=F.now();for(const W of j){const J=q[W],ee=this._tiles[W];if(!ee||ee.fadeEndTime!==0&&ee.fadeEndTime<=Z)continue;const ae=this.findLoadedParent(J,S);ae&&(this._addTile(ae.tileID),T[ae.tileID.key]=ae.tileID),R[W]=J}this._retainLoadedChildren(R,B,U,q);for(const W in T)q[W]||(this._coveredTiles[W]=!0,q[W]=T[W]);if(d){const W={},J={};for(const ee of _)this._tiles[ee.key].hasData()?W[ee.key]=ee:J[ee.key]=ee;for(const ee in J){const ae=J[ee].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(W[ae[0].key]=q[ae[0].key]=ae[0],W[ae[1].key]=q[ae[1].key]=ae[1],W[ae[2].key]=q[ae[2].key]=ae[2],W[ae[3].key]=q[ae[3].key]=ae[3],delete J[ee])}for(const ee in J){const ae=this.findLoadedParent(J[ee],this._source.minzoom);if(ae){W[ae.tileID.key]=q[ae.tileID.key]=ae.tileID;for(const fe in W)W[fe].isChildOf(ae.tileID)&&delete W[fe]}}for(const ee in this._tiles)W[ee]||(this._coveredTiles[ee]=!0)}}for(const T in q)this._tiles[T].clearFadeHold();const w=s.ab(this._tiles,q);for(const T of w){const R=this._tiles[T];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){const _={},B={},S=Math.max(d-Zi.maxOverzooming,this._source.minzoom),U=Math.max(d+Zi.maxUnderzooming,this._source.minzoom),H={};for(const q of a){const w=this._addTile(q);_[q.key]=q,w.hasData()||d<this._source.maxzoom&&(H[q.key]=q)}this._retainLoadedChildren(H,d,U,_);for(const q of a){let w=this._tiles[q.key];if(w.hasData())continue;if(d+1>this._source.maxzoom){const R=q.children(this._source.maxzoom)[0],j=this.getTile(R);if(j&&j.hasData()){_[R.key]=R;continue}}else{const R=q.children(this._source.maxzoom);if(_[R[0].key]&&_[R[1].key]&&_[R[2].key]&&_[R[3].key])continue}let T=w.wasRequested();for(let R=q.overscaledZ-1;R>=S;--R){const j=q.scaledTo(R);if(B[j.key])break;if(B[j.key]=!0,w=this.getTile(j),!w&&T&&(w=this._addTile(j)),w){const Z=w.hasData();if((T||Z)&&(_[j.key]=j),T=w.wasRequested(),Z)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let _,B=this._tiles[a].tileID;for(;B.overscaledZ>0;){if(B.key in this._loadedParentTiles){_=this._loadedParentTiles[B.key];break}d.push(B.key);const S=B.scaledTo(B.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;B=S}for(const S of d)this._loadedParentTiles[S]=_}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const _=d;return d||(d=new Ji(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,_||this._source.fire(new s.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=d.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,_){const B=[],S=this.transform;if(!S)return B;const U=_?S.getCameraQueryGeometry(a):a,H=a.map(W=>S.pointCoordinate(W,this.terrain)),q=U.map(W=>S.pointCoordinate(W,this.terrain)),w=this.getIds();let T=1/0,R=1/0,j=-1/0,Z=-1/0;for(const W of q)T=Math.min(T,W.x),R=Math.min(R,W.y),j=Math.max(j,W.x),Z=Math.max(Z,W.y);for(let W=0;W<w.length;W++){const J=this._tiles[w[W]];if(J.holdingForFade())continue;const ee=J.tileID,ae=Math.pow(2,S.zoom-J.tileID.overscaledZ),fe=d*J.queryPadding*s.W/J.tileSize/ae,pe=[ee.getTilePoint(new s.Y(T,R)),ee.getTilePoint(new s.Y(j,Z))];if(pe[0].x-fe<s.W&&pe[0].y-fe<s.W&&pe[1].x+fe>=0&&pe[1].y+fe>=0){const xe=H.map(Le=>ee.getTilePoint(Le)),Pe=q.map(Le=>ee.getTilePoint(Le));B.push({tile:J,tileID:ee,queryGeometry:xe,cameraQueryGeometry:Pe,scale:ae})}}return B}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Bi(this._source.type)){const a=F.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,_){this._state.updateState(a=a||"_geojsonTileLayer",d,_)}removeFeatureState(a,d,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,_)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,_){const B=this._tiles[a];B&&B.setDependencies(d,_)}reloadTilesForDependencies(a,d){for(const _ in this._tiles)this._tiles[_].hasDependency(a,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(a,d))}}function Qt(y,a){const d=Math.abs(2*y.wrap)-+(y.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return y.overscaledZ-a.overscaledZ||_-d||a.canonical.y-y.canonical.y||a.canonical.x-y.canonical.x}function Bi(y){return y==="raster"||y==="image"||y==="video"}Zi.maxOverzooming=10,Zi.maxUnderzooming=3;class Ii{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ac(a,0,1);let d=1,_=this._distances[d];const B=a*this.paddedLength+this.padding;for(;_<B&&d<this._distances.length;)_=this._distances[++d];const S=d-1,U=this._distances[S],H=_-U,q=H>0?(B-U)/H:0;return this.points[S].mult(1-q).add(this.points[d].mult(q))}}function Gt(y,a){let d=!0;return y==="always"||y!=="never"&&a!=="never"||(d=!1),d}class vi{constructor(a,d,_){const B=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let U=0;U<this.xCellCount*this.yCellCount;U++)B.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,B,S){this._forEachCell(d,_,B,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(B),this.bboxes.push(S)}insertCircle(a,d,_,B){this._forEachCell(d-B,_-B,d+B,_+B,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(B)}_insertBoxCell(a,d,_,B,S,U){this.boxCells[S].push(U)}_insertCircleCell(a,d,_,B,S,U){this.circleCells[S].push(U)}_query(a,d,_,B,S,U,H){if(_<0||a>this.width||B<0||d>this.height)return[];const q=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=B){if(S)return[{key:null,x1:a,y1:d,x2:_,y2:B}];for(let w=0;w<this.boxKeys.length;w++)q.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const T=this.circles[3*w],R=this.circles[3*w+1],j=this.circles[3*w+2];q.push({key:this.circleKeys[w],x1:T-j,y1:R-j,x2:T+j,y2:R+j})}}else this._forEachCell(a,d,_,B,this._queryCell,q,{hitTest:S,overlapMode:U,seenUids:{box:{},circle:{}}},H);return q}query(a,d,_,B){return this._query(a,d,_,B,!1,null)}hitTest(a,d,_,B,S,U){return this._query(a,d,_,B,!0,S,U).length>0}hitTestCircle(a,d,_,B,S){const U=a-_,H=a+_,q=d-_,w=d+_;if(H<0||U>this.width||w<0||q>this.height)return!1;const T=[];return this._forEachCell(U,q,H,w,this._queryCellCircle,T,{hitTest:!0,overlapMode:B,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},S),T.length>0}_queryCell(a,d,_,B,S,U,H,q){const{seenUids:w,hitTest:T,overlapMode:R}=H,j=this.boxCells[S];if(j!==null){const W=this.bboxes;for(const J of j)if(!w.box[J]){w.box[J]=!0;const ee=4*J,ae=this.boxKeys[J];if(a<=W[ee+2]&&d<=W[ee+3]&&_>=W[ee+0]&&B>=W[ee+1]&&(!q||q(ae))&&(!T||!Gt(R,ae.overlapMode))&&(U.push({key:ae,x1:W[ee],y1:W[ee+1],x2:W[ee+2],y2:W[ee+3]}),T))return!0}}const Z=this.circleCells[S];if(Z!==null){const W=this.circles;for(const J of Z)if(!w.circle[J]){w.circle[J]=!0;const ee=3*J,ae=this.circleKeys[J];if(this._circleAndRectCollide(W[ee],W[ee+1],W[ee+2],a,d,_,B)&&(!q||q(ae))&&(!T||!Gt(R,ae.overlapMode))){const fe=W[ee],pe=W[ee+1],xe=W[ee+2];if(U.push({key:ae,x1:fe-xe,y1:pe-xe,x2:fe+xe,y2:pe+xe}),T)return!0}}}return!1}_queryCellCircle(a,d,_,B,S,U,H,q){const{circle:w,seenUids:T,overlapMode:R}=H,j=this.boxCells[S];if(j!==null){const W=this.bboxes;for(const J of j)if(!T.box[J]){T.box[J]=!0;const ee=4*J,ae=this.boxKeys[J];if(this._circleAndRectCollide(w.x,w.y,w.radius,W[ee+0],W[ee+1],W[ee+2],W[ee+3])&&(!q||q(ae))&&!Gt(R,ae.overlapMode))return U.push(!0),!0}}const Z=this.circleCells[S];if(Z!==null){const W=this.circles;for(const J of Z)if(!T.circle[J]){T.circle[J]=!0;const ee=3*J,ae=this.circleKeys[J];if(this._circlesCollide(W[ee],W[ee+1],W[ee+2],w.x,w.y,w.radius)&&(!q||q(ae))&&!Gt(R,ae.overlapMode))return U.push(!0),!0}}}_forEachCell(a,d,_,B,S,U,H,q){const w=this._convertToXCellCoord(a),T=this._convertToYCellCoord(d),R=this._convertToXCellCoord(_),j=this._convertToYCellCoord(B);for(let Z=w;Z<=R;Z++)for(let W=T;W<=j;W++)if(S.call(this,a,d,_,B,this.xCellCount*W+Z,U,H,q))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,B,S,U){const H=B-a,q=S-d,w=_+U;return w*w>H*H+q*q}_circleAndRectCollide(a,d,_,B,S,U,H){const q=(U-B)/2,w=Math.abs(a-(B+q));if(w>q+_)return!1;const T=(H-S)/2,R=Math.abs(d-(S+T));if(R>T+_)return!1;if(w<=q||R<=T)return!0;const j=w-q,Z=R-T;return j*j+Z*Z<=_*_}}function Jt(y,a,d,_,B){const S=s.F();return a?(s.J(S,S,[1/B,1/B,1]),d||s.ad(S,S,_.angle)):s.K(S,_.labelPlaneMatrix,y),S}function mr(y,a,d,_,B){if(a){const S=s.ae(y);return s.J(S,S,[B,B,1]),d||s.ad(S,S,-_.angle),S}return _.glCoordMatrix}function Sr(y,a,d){let _;d?(_=[y.x,y.y,d(y.x,y.y),1],s.af(_,_,a)):(_=[y.x,y.y,0,1],yt(_,_,a));const B=_[3];return{point:new s.P(_[0]/B,_[1]/B),signedDistanceFromCamera:B}}function ze(y,a){return .5+y/a*.5}function we(y,a){const d=y[0]/y[3],_=y[1]/y[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function oe(y,a,d,_,B,S,U,H,q,w){const T=_?y.textSizeData:y.iconSizeData,R=s.ag(T,d.transform.zoom),j=[256/d.width*2+1,256/d.height*2+1],Z=_?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Z.clear();const W=y.lineVertexArray,J=_?y.text.placedSymbolArray:y.icon.placedSymbolArray,ee=d.transform.width/d.transform.height;let ae=!1;for(let fe=0;fe<J.length;fe++){const pe=J.get(fe);if(pe.hidden||pe.writingMode===s.ah.vertical&&!ae){it(pe.numGlyphs,Z);continue}let xe;if(ae=!1,w?(xe=[pe.anchorX,pe.anchorY,w(pe.anchorX,pe.anchorY),1],s.af(xe,xe,a)):(xe=[pe.anchorX,pe.anchorY,0,1],yt(xe,xe,a)),!we(xe,j)){it(pe.numGlyphs,Z);continue}const Pe=ze(d.transform.cameraToCenterDistance,xe[3]),Le=s.ai(T,R,pe),rt=U?Le/Pe:Le*Pe,Ke=new s.P(pe.anchorX,pe.anchorY),Re=Sr(Ke,B,w).point,Qe={projections:{},offsets:{}},pt=ge(pe,rt,!1,H,a,B,S,y.glyphOffsetArray,W,Z,Re,Ke,Qe,ee,q,w);ae=pt.useVertical,(pt.notEnoughRoom||ae||pt.needsFlipping&&ge(pe,rt,!0,H,a,B,S,y.glyphOffsetArray,W,Z,Re,Ke,Qe,ee,q,w).notEnoughRoom)&&it(pe.numGlyphs,Z)}_?y.text.dynamicLayoutVertexBuffer.updateData(Z):y.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Y(y,a,d,_,B,S,U,H,q,w,T,R,j){const Z=H.glyphStartIndex+H.numGlyphs,W=H.lineStartIndex,J=H.lineStartIndex+H.lineLength,ee=a.getoffsetX(H.glyphStartIndex),ae=a.getoffsetX(Z-1),fe=Oe(y*ee,d,_,B,S,U,H.segment,W,J,q,w,T,R,j);if(!fe)return null;const pe=Oe(y*ae,d,_,B,S,U,H.segment,W,J,q,w,T,R,j);return pe?{first:fe,last:pe}:null}function le(y,a,d,_){return y===s.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*_?{useVertical:!0}:(y===s.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function ge(y,a,d,_,B,S,U,H,q,w,T,R,j,Z,W,J){const ee=a/24,ae=y.lineOffsetX*ee,fe=y.lineOffsetY*ee;let pe;if(y.numGlyphs>1){const xe=y.glyphStartIndex+y.numGlyphs,Pe=y.lineStartIndex,Le=y.lineStartIndex+y.lineLength,rt=Y(ee,H,ae,fe,d,T,R,y,q,S,j,W,J);if(!rt)return{notEnoughRoom:!0};const Ke=Sr(rt.first.point,U,J).point,Re=Sr(rt.last.point,U,J).point;if(_&&!d){const Qe=le(y.writingMode,Ke,Re,Z);if(Qe)return Qe}pe=[rt.first];for(let Qe=y.glyphStartIndex+1;Qe<xe-1;Qe++)pe.push(Oe(ee*H.getoffsetX(Qe),ae,fe,d,T,R,y.segment,Pe,Le,q,S,j,W,J));pe.push(rt.last)}else{if(_&&!d){const Pe=Sr(R,B,J).point,Le=y.lineStartIndex+y.segment+1,rt=new s.P(q.getx(Le),q.gety(Le)),Ke=Sr(rt,B,J),Re=Ke.signedDistanceFromCamera>0?Ke.point:_e(R,rt,Pe,1,B,J),Qe=le(y.writingMode,Pe,Re,Z);if(Qe)return Qe}const xe=Oe(ee*H.getoffsetX(y.glyphStartIndex),ae,fe,d,T,R,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,q,S,j,W,J);if(!xe)return{notEnoughRoom:!0};pe=[xe]}for(const xe of pe)s.aj(w,xe.point,xe.angle);return{}}function _e(y,a,d,_,B,S){const U=Sr(y.add(y.sub(a)._unit()),B,S).point,H=d.sub(U);return d.add(H._mult(_/H.mag()))}function Ce(y,a){const{projectionCache:d,lineVertexArray:_,labelPlaneMatrix:B,tileAnchorPoint:S,distanceFromAnchor:U,getElevation:H,previousVertex:q,direction:w,absOffsetX:T}=a;if(d.projections[y])return d.projections[y];const R=new s.P(_.getx(y),_.gety(y)),j=Sr(R,B,H);if(j.signedDistanceFromCamera>0)return d.projections[y]=j.point,j.point;const Z=y-w;return _e(U===0?S:new s.P(_.getx(Z),_.gety(Z)),R,q,T-U+1,B,H)}function ve(y,a,d){return y._unit()._perp()._mult(a*d)}function Me(y,a,d,_,B,S,U,H){const{projectionCache:q,direction:w}=H;if(q.offsets[y])return q.offsets[y];const T=d.add(a);if(y+w<_||y+w>=B)return q.offsets[y]=T,T;const R=Ce(y+w,H),j=ve(R.sub(d),U,w),Z=d.add(j),W=R.add(j);return q.offsets[y]=s.ak(S,T,Z,W)||T,q.offsets[y]}function Oe(y,a,d,_,B,S,U,H,q,w,T,R,j,Z){const W=_?y-a:y+a;let J=W>0?1:-1,ee=0;_&&(J*=-1,ee=Math.PI),J<0&&(ee+=Math.PI);let ae,fe,pe=J>0?H+U:H+U+1,xe=B,Pe=B,Le=0,rt=0;const Ke=Math.abs(W),Re=[];let Qe;for(;Le+rt<=Ke;){if(pe+=J,pe<H||pe>=q)return null;Le+=rt,Pe=xe,fe=ae;const ht={projectionCache:R,lineVertexArray:w,labelPlaneMatrix:T,tileAnchorPoint:S,distanceFromAnchor:Le,getElevation:Z,previousVertex:Pe,direction:J,absOffsetX:Ke};if(xe=Ce(pe,ht),d===0)Re.push(Pe),Qe=xe.sub(Pe);else{let Rt;const Dt=xe.sub(Pe);Rt=Dt.mag()===0?ve(Ce(pe+J,ht).sub(xe),d,J):ve(Dt,d,J),fe||(fe=Pe.add(Rt)),ae=Me(pe,Rt,xe,H,q,fe,d,ht),Re.push(fe),Qe=ae.sub(fe)}rt=Qe.mag()}const pt=Qe._mult((Ke-Le)/rt)._add(fe||Pe),bt=ee+Math.atan2(xe.y-Pe.y,xe.x-Pe.x);return Re.push(pt),{point:pt,angle:j?bt:0,path:Re}}const Ve=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function it(y,a){for(let d=0;d<y;d++){const _=a.length;a.resize(_+4),a.float32.set(Ve,3*_)}}function yt(y,a,d){const _=a[0],B=a[1];return y[0]=d[0]*_+d[4]*B+d[12],y[1]=d[1]*_+d[5]*B+d[13],y[3]=d[3]*_+d[7]*B+d[15],y}const Bt=100;class Yt{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new vi(a.width+200,a.height+200,25),_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new vi(a.width+200,a.height+200,25);this.transform=a,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Bt,this.screenBottomBoundary=a.height+Bt,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,_,B,S,U){const H=this.projectAndGetPerspectiveRatio(B,a.anchorPointX,a.anchorPointY,U),q=_*H.perspectiveRatio,w=a.x1*q+H.point.x,T=a.y1*q+H.point.y,R=a.x2*q+H.point.x,j=a.y2*q+H.point.y;return!this.isInsideGrid(w,T,R,j)||d!=="always"&&this.grid.hitTest(w,T,R,j,d,S)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[w,T,R,j],offscreen:this.isOffscreen(w,T,R,j)}}placeCollisionCircles(a,d,_,B,S,U,H,q,w,T,R,j,Z,W){const J=[],ee=new s.P(d.anchorX,d.anchorY),ae=Sr(ee,U,W),fe=ze(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),pe=(T?S/fe:S*fe)/s.ao,xe=Sr(ee,H,W).point,Pe=Y(pe,B,d.lineOffsetX*pe,d.lineOffsetY*pe,!1,xe,ee,d,_,H,{projections:{},offsets:{}},!1,W);let Le=!1,rt=!1,Ke=!0;if(Pe){const Re=.5*j*fe+Z,Qe=new s.P(-100,-100),pt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Ii,ht=Pe.first,Rt=Pe.last;let Dt=[];for(let _i=ht.path.length-1;_i>=1;_i--)Dt.push(ht.path[_i]);for(let _i=1;_i<Rt.path.length;_i++)Dt.push(Rt.path[_i]);const hi=2.5*Re;if(q){const _i=Dt.map(Si=>Sr(Si,q,W));Dt=_i.some(Si=>Si.signedDistanceFromCamera<=0)?[]:_i.map(Si=>Si.point)}let Vt=[];if(Dt.length>0){const _i=Dt[0].clone(),Si=Dt[0].clone();for(let Yi=1;Yi<Dt.length;Yi++)_i.x=Math.min(_i.x,Dt[Yi].x),_i.y=Math.min(_i.y,Dt[Yi].y),Si.x=Math.max(Si.x,Dt[Yi].x),Si.y=Math.max(Si.y,Dt[Yi].y);Vt=_i.x>=Qe.x&&Si.x<=pt.x&&_i.y>=Qe.y&&Si.y<=pt.y?[Dt]:Si.x<Qe.x||_i.x>pt.x||Si.y<Qe.y||_i.y>pt.y?[]:s.al([Dt],Qe.x,Qe.y,pt.x,pt.y)}for(const _i of Vt){bt.reset(_i,.25*Re);let Si=0;Si=bt.length<=.5*Re?1:Math.ceil(bt.paddedLength/hi)+1;for(let Yi=0;Yi<Si;Yi++){const Ti=Yi/Math.max(Si-1,1),yr=bt.lerp(Ti),fr=yr.x+Bt,ji=yr.y+Bt;J.push(fr,ji,Re,0);const Ur=fr-Re,rn=ji-Re,Mr=fr+Re,Kr=ji+Re;if(Ke=Ke&&this.isOffscreen(Ur,rn,Mr,Kr),rt=rt||this.isInsideGrid(Ur,rn,Mr,Kr),a!=="always"&&this.grid.hitTestCircle(fr,ji,Re,a,R)&&(Le=!0,!w))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!w&&Le||!rt||fe<this.perspectiveRatioCutoff?[]:J,offscreen:Ke,collisionDetected:Le}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,B=1/0,S=-1/0,U=-1/0;for(const T of a){const R=new s.P(T.x+Bt,T.y+Bt);_=Math.min(_,R.x),B=Math.min(B,R.y),S=Math.max(S,R.x),U=Math.max(U,R.y),d.push(R)}const H=this.grid.query(_,B,S,U).concat(this.ignoredGrid.query(_,B,S,U)),q={},w={};for(const T of H){const R=T.key;if(q[R.bucketInstanceId]===void 0&&(q[R.bucketInstanceId]={}),q[R.bucketInstanceId][R.featureIndex])continue;const j=[new s.P(T.x1,T.y1),new s.P(T.x2,T.y1),new s.P(T.x2,T.y2),new s.P(T.x1,T.y2)];s.am(d,j)&&(q[R.bucketInstanceId][R.featureIndex]=!0,w[R.bucketInstanceId]===void 0&&(w[R.bucketInstanceId]=[]),w[R.bucketInstanceId].push(R.featureIndex))}return w}insertCollisionBox(a,d,_,B,S,U){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:S,collisionGroupID:U,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,B,S,U){const H=_?this.ignoredGrid:this.grid,q={bucketInstanceId:B,featureIndex:S,collisionGroupID:U,overlapMode:d};for(let w=0;w<a.length;w+=4)H.insertCircle(q,a[w],a[w+1],a[w+2])}projectAndGetPerspectiveRatio(a,d,_,B){let S;return B?(S=[d,_,B(d,_),1],s.af(S,S,a)):(S=[d,_,0,1],yt(S,S,a)),{point:new s.P((S[0]/S[3]+1)/2*this.transform.width+Bt,(-S[1]/S[3]+1)/2*this.transform.height+Bt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S[3]*.5}}isOffscreen(a,d,_,B){return _<Bt||a>=this.screenRightBoundary||B<Bt||d>this.screenBottomBoundary}isInsideGrid(a,d,_,B){return _>=0&&a<this.gridRightBoundary&&B>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=s.an([]);return s.H(a,a,[-100,-100,0]),a}}function qt(y,a,d){return a*(s.W/(y.tileSize*Math.pow(2,d-y.tileID.overscaledZ)))}class Kt{constructor(a,d,_,B){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):B&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class si{constructor(a,d,_,B,S){this.text=new Kt(a?a.text:null,d,_,S),this.icon=new Kt(a?a.icon:null,d,B,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ci{constructor(a,d,_){this.text=a,this.icon=d,this.skipFade=_}}class Hi{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class wi{constructor(a,d,_,B,S){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=B,this.tileID=S}}class Ui{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function st(y,a,d,_,B){const{horizontalAlign:S,verticalAlign:U}=s.at(y);return new s.P(-(S-.5)*a+_[0]*B,-(U-.5)*d+_[1]*B)}function ti(y,a,d,_,B,S){const{x1:U,x2:H,y1:q,y2:w,anchorPointX:T,anchorPointY:R}=y,j=new s.P(a,d);return _&&j._rotate(B?S:-S),{x1:U+j.x,y1:q+j.y,x2:H+j.x,y2:w+j.y,anchorPointX:T,anchorPointY:R}}class zt{constructor(a,d,_,B,S){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new Yt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Ui(B),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,B){const S=_.getBucket(d),U=_.latestFeatureIndex;if(!S||!U||d.id!==S.layerIds[0])return;const H=_.collisionBoxArray,q=S.layers[0].layout,w=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),T=_.tileSize/s.W,R=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),j=q.get("text-pitch-alignment")==="map",Z=q.get("text-rotation-alignment")==="map",W=qt(_,1,this.transform.zoom),J=Jt(R,j,Z,this.transform,W);let ee=null;if(j){const fe=mr(R,j,Z,this.transform,W);ee=s.K([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[S.bucketInstanceId]=new wi(S.bucketInstanceId,U,S.sourceLayerIndex,S.index,_.tileID);const ae={bucket:S,layout:q,posMatrix:R,textLabelPlaneMatrix:J,labelToScreenMatrix:ee,scale:w,textPixelRatio:T,holdingForFade:_.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:s.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(B)for(const fe of S.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:xe,symbolInstanceEnd:Pe}=fe;a.push({sortKey:pe,symbolInstanceStart:xe,symbolInstanceEnd:Pe,parameters:ae})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(a,d,_,B,S,U,H,q,w,T,R,j,Z,W,J,ee){const ae=s.ap[a.textAnchor],fe=[a.textOffset0,a.textOffset1],pe=st(ae,_,B,fe,S),xe=this.collisionIndex.placeCollisionBox(ti(d,pe.x,pe.y,U,H,this.transform.angle),R,q,w,T.predicate,ee);if((!J||this.collisionIndex.placeCollisionBox(ti(J,pe.x,pe.y,U,H,this.transform.angle),R,q,w,T.predicate,ee).box.length!==0)&&xe.box.length>0){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:fe,width:_,height:B,anchor:ae,textBoxScale:S,prevAnchor:Pe},this.markUsedJustification(Z,ae,j,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,j),this.placedOrientations[j.crossTileID]=W),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(a,d,_){const{bucket:B,layout:S,posMatrix:U,textLabelPlaneMatrix:H,labelToScreenMatrix:q,textPixelRatio:w,holdingForFade:T,collisionBoxArray:R,partiallyEvaluatedTextSize:j,collisionGroup:Z}=a.parameters,W=S.get("text-optional"),J=S.get("icon-optional"),ee=s.aq(S,"text-overlap","text-allow-overlap"),ae=ee==="always",fe=s.aq(S,"icon-overlap","icon-allow-overlap"),pe=fe==="always",xe=S.get("text-rotation-alignment")==="map",Pe=S.get("text-pitch-alignment")==="map",Le=S.get("icon-text-fit")!=="none",rt=S.get("symbol-z-order")==="viewport-y",Ke=ae&&(pe||!B.hasIconData()||J),Re=pe&&(ae||!B.hasTextData()||W);!B.collisionArrays&&R&&B.deserializeCollisionBoxes(R);const Qe=this.retainedQueryData[B.bucketInstanceId].tileID,pt=this.terrain?(ht,Rt)=>this.terrain.getElevation(Qe,ht,Rt):null,bt=(ht,Rt)=>{var Dt,hi;if(d[ht.crossTileID])return;if(T)return void(this.placements[ht.crossTileID]=new Ci(!1,!1,!1));let Vt=!1,_i=!1,Si=!0,Yi=null,Ti={box:null,offscreen:null},yr={box:null,offscreen:null},fr=null,ji=null,Ur=null,rn=0,Mr=0,Kr=0;Rt.textFeatureIndex?rn=Rt.textFeatureIndex:ht.useRuntimeCollisionCircles&&(rn=ht.featureIndex),Rt.verticalTextFeatureIndex&&(Mr=Rt.verticalTextFeatureIndex);const Cr=Rt.textBox;if(Cr){const pr=qr=>{let Wr=s.ah.horizontal;if(B.allowVerticalPlacement&&!qr&&this.prevPlacement){const Mn=this.prevPlacement.placedOrientations[ht.crossTileID];Mn&&(this.placedOrientations[ht.crossTileID]=Mn,Wr=Mn,this.markUsedOrientation(B,Wr,ht))}return Wr},_r=(qr,Wr)=>{if(B.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Mn of B.writingModes)if(Mn===s.ah.vertical?(Ti=Wr(),yr=Ti):Ti=qr(),Ti&&Ti.box&&Ti.box.length)break}else Ti=qr()},or=ht.textAnchorOffsetStartIndex,ln=ht.textAnchorOffsetEndIndex;if(ln===or){const qr=(Wr,Mn)=>{const $n=this.collisionIndex.placeCollisionBox(Wr,ee,w,U,Z.predicate,pt);return $n&&$n.box&&$n.box.length&&(this.markUsedOrientation(B,Mn,ht),this.placedOrientations[ht.crossTileID]=Mn),$n};_r(()=>qr(Cr,s.ah.horizontal),()=>{const Wr=Rt.verticalTextBox;return B.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Wr?qr(Wr,s.ah.vertical):{box:null,offscreen:null}}),pr(Ti&&Ti.box&&Ti.box.length)}else{let qr=s.ap[(hi=(Dt=this.prevPlacement)===null||Dt===void 0?void 0:Dt.variableOffsets[ht.crossTileID])===null||hi===void 0?void 0:hi.anchor];const Wr=($n,fl,$r)=>{const _n=$n.x2-$n.x1,ea=$n.y2-$n.y1,ks=ht.textBoxScale,Ks=Le&&fe==="never"?fl:null;let Oo={box:[],offscreen:!1},so=ee==="never"?1:2,Fu="never";qr&&so++;for(let Ra=0;Ra<so;Ra++){for(let In=or;In<ln;In++){const dc=B.textAnchorOffsets.get(In);if(qr&&dc.textAnchor!==qr)continue;const cu=this.attemptAnchorPlacement(dc,$n,_n,ea,ks,xe,Pe,w,U,Z,Fu,ht,B,$r,Ks,pt);if(cu&&(Oo=cu.placedGlyphBoxes,Oo&&Oo.box&&Oo.box.length))return Vt=!0,Yi=cu.shift,Oo}qr?qr=null:Fu=ee}return Oo};_r(()=>Wr(Cr,Rt.iconBox,s.ah.horizontal),()=>{const $n=Rt.verticalTextBox;return B.allowVerticalPlacement&&!(Ti&&Ti.box&&Ti.box.length)&&ht.numVerticalGlyphVertices>0&&$n?Wr($n,Rt.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),Ti&&(Vt=Ti.box,Si=Ti.offscreen);const Mn=pr(Ti&&Ti.box);if(!Vt&&this.prevPlacement){const $n=this.prevPlacement.variableOffsets[ht.crossTileID];$n&&(this.variableOffsets[ht.crossTileID]=$n,this.markUsedJustification(B,$n.anchor,ht,Mn))}}}if(fr=Ti,Vt=fr&&fr.box&&fr.box.length>0,Si=fr&&fr.offscreen,ht.useRuntimeCollisionCircles){const pr=B.text.placedSymbolArray.get(ht.centerJustifiedTextSymbolIndex),_r=s.ai(B.textSizeData,j,pr),or=S.get("text-padding");ji=this.collisionIndex.placeCollisionCircles(ee,pr,B.lineVertexArray,B.glyphOffsetArray,_r,U,H,q,_,Pe,Z.predicate,ht.collisionCircleDiameter,or,pt),ji.circles.length&&ji.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),Vt=ae||ji.circles.length>0&&!ji.collisionDetected,Si=Si&&ji.offscreen}if(Rt.iconFeatureIndex&&(Kr=Rt.iconFeatureIndex),Rt.iconBox){const pr=_r=>{const or=Le&&Yi?ti(_r,Yi.x,Yi.y,xe,Pe,this.transform.angle):_r;return this.collisionIndex.placeCollisionBox(or,fe,w,U,Z.predicate,pt)};yr&&yr.box&&yr.box.length&&Rt.verticalIconBox?(Ur=pr(Rt.verticalIconBox),_i=Ur.box.length>0):(Ur=pr(Rt.iconBox),_i=Ur.box.length>0),Si=Si&&Ur.offscreen}const es=W||ht.numHorizontalGlyphVertices===0&&ht.numVerticalGlyphVertices===0,Nr=J||ht.numIconVertices===0;if(es||Nr?Nr?es||(_i=_i&&Vt):Vt=_i&&Vt:_i=Vt=_i&&Vt,Vt&&fr&&fr.box&&this.collisionIndex.insertCollisionBox(fr.box,ee,S.get("text-ignore-placement"),B.bucketInstanceId,yr&&yr.box&&Mr?Mr:rn,Z.ID),_i&&Ur&&this.collisionIndex.insertCollisionBox(Ur.box,fe,S.get("icon-ignore-placement"),B.bucketInstanceId,Kr,Z.ID),ji&&(Vt&&this.collisionIndex.insertCollisionCircles(ji.circles,ee,S.get("text-ignore-placement"),B.bucketInstanceId,rn,Z.ID),_)){const pr=B.bucketInstanceId;let _r=this.collisionCircleArrays[pr];_r===void 0&&(_r=this.collisionCircleArrays[pr]=new Hi);for(let or=0;or<ji.circles.length;or+=4)_r.circles.push(ji.circles[or+0]),_r.circles.push(ji.circles[or+1]),_r.circles.push(ji.circles[or+2]),_r.circles.push(ji.collisionDetected?1:0)}if(ht.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(B.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ht.crossTileID]=new Ci(Vt||Ke,_i||Re,Si||B.justReloaded),d[ht.crossTileID]=!0};if(rt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ht=B.getSortedSymbolIndexes(this.transform.angle);for(let Rt=ht.length-1;Rt>=0;--Rt){const Dt=ht[Rt];bt(B.symbolInstances.get(Dt),B.collisionArrays[Dt])}}else for(let ht=a.symbolInstanceStart;ht<a.symbolInstanceEnd;ht++)bt(B.symbolInstances.get(ht),B.collisionArrays[ht]);if(_&&B.bucketInstanceId in this.collisionCircleArrays){const ht=this.collisionCircleArrays[B.bucketInstanceId];s.ar(ht.invProjMatrix,U),ht.viewportMatrix=this.collisionIndex.getViewportMatrix()}B.justReloaded=!1}markUsedJustification(a,d,_,B){let S;S=B===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.as(d)];const U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const H of U)H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=S>=0&&H!==S?0:_.crossTileID)}markUsedOrientation(a,d,_){const B=d===s.ah.horizontal||d===s.ah.horizontalOnly?d:0,S=d===s.ah.vertical?d:0,U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const H of U)a.text.placedSymbolArray.get(H).placedOrientation=B;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const B=d?d.symbolFadeChange(a):1,S=d?d.opacities:{},U=d?d.variableOffsets:{},H=d?d.placedOrientations:{};for(const q in this.placements){const w=this.placements[q],T=S[q];T?(this.opacities[q]=new si(T,B,w.text,w.icon),_=_||w.text!==T.text.placed||w.icon!==T.icon.placed):(this.opacities[q]=new si(null,B,w.text,w.icon,w.skipFade),_=_||w.text||w.icon)}for(const q in S){const w=S[q];if(!this.opacities[q]){const T=new si(w,B,!1,!1);T.isHidden()||(this.opacities[q]=T,_=_||w.text.placed||w.icon.placed)}}for(const q in U)this.variableOffsets[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.variableOffsets[q]=U[q]);for(const q in H)this.placedOrientations[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.placedOrientations[q]=H[q]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const _={};for(const B of d){const S=B.getBucket(a);S&&B.latestFeatureIndex&&a.id===S.layerIds[0]&&this.updateBucketOpacities(S,_,B.collisionBoxArray)}}updateBucketOpacities(a,d,_){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const B=a.layers[0],S=B.layout,U=new si(null,0,!1,!1,!0),H=S.get("text-allow-overlap"),q=S.get("icon-allow-overlap"),w=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=S.get("text-rotation-alignment")==="map",R=S.get("text-pitch-alignment")==="map",j=S.get("icon-text-fit")!=="none",Z=new si(null,0,H&&(q||!a.hasIconData()||S.get("icon-optional")),q&&(H||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const W=(J,ee,ae)=>{for(let fe=0;fe<ee/4;fe++)J.opacityVertexArray.emplaceBack(ae);J.hasVisibleVertices=J.hasVisibleVertices||ae!==ps};for(let J=0;J<a.symbolInstances.length;J++){const ee=a.symbolInstances.get(J),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:fe,crossTileID:pe}=ee;let xe=this.opacities[pe];d[pe]?xe=U:xe||(xe=Z,this.opacities[pe]=xe),d[pe]=!0;const Pe=ee.numIconVertices>0,Le=this.placedOrientations[ee.crossTileID],rt=Le===s.ah.vertical,Ke=Le===s.ah.horizontal||Le===s.ah.horizontalOnly;if(ae>0||fe>0){const Re=Rn(xe.text);W(a.text,ae,rt?ps:Re),W(a.text,fe,Ke?ps:Re);const Qe=xe.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(ht=>{ht>=0&&(a.text.placedSymbolArray.get(ht).hidden=Qe||rt?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Qe||Ke?1:0);const pt=this.variableOffsets[ee.crossTileID];pt&&this.markUsedJustification(a,pt.anchor,ee,Le);const bt=this.placedOrientations[ee.crossTileID];bt&&(this.markUsedJustification(a,"left",ee,bt),this.markUsedOrientation(a,bt,ee))}if(Pe){const Re=Rn(xe.icon),Qe=!(j&&ee.verticalPlacedIconSymbolIndex&&rt);ee.placedIconSymbolIndex>=0&&(W(a.icon,ee.numIconVertices,Qe?Re:ps),a.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=xe.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(W(a.icon,ee.numVerticalIconVertices,Qe?ps:Re),a.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Re=a.collisionArrays[J];if(Re){let Qe=new s.P(0,0);if(Re.textBox||Re.verticalTextBox){let bt=!0;if(w){const ht=this.variableOffsets[pe];ht?(Qe=st(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),T&&Qe._rotate(R?this.transform.angle:-this.transform.angle)):bt=!1}Re.textBox&&zi(a.textCollisionBox.collisionVertexArray,xe.text.placed,!bt||rt,Qe.x,Qe.y),Re.verticalTextBox&&zi(a.textCollisionBox.collisionVertexArray,xe.text.placed,!bt||Ke,Qe.x,Qe.y)}const pt=!!(!Ke&&Re.verticalIconBox);Re.iconBox&&zi(a.iconCollisionBox.collisionVertexArray,xe.icon.placed,pt,j?Qe.x:0,j?Qe.y:0),Re.verticalIconBox&&zi(a.iconCollisionBox.collisionVertexArray,xe.icon.placed,!pt,j?Qe.x:0,j?Qe.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=J.invProjMatrix,a.placementViewportMatrix=J.viewportMatrix,a.collisionCircleArray=J.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function zi(y,a,d,_,B){y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0)}const hr=Math.pow(2,25),sn=Math.pow(2,24),bn=Math.pow(2,17),ur=Math.pow(2,16),gn=Math.pow(2,9),mn=Math.pow(2,8),lr=Math.pow(2,1);function Rn(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,d=Math.floor(127*y.opacity);return d*hr+a*sn+d*bn+a*ur+d*gn+a*mn+d*lr+a}const ps=0;class Qr{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,_,B,S){const U=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(U,B,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,U.sort((H,q)=>H.sortKey-q.sortKey));this._currentPartIndex<U.length;)if(d.placeLayerBucketPart(U[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class xn{constructor(a,d,_,B,S,U,H,q){this.placement=new zt(a,d,U,H,q),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_){const B=F.now(),S=()=>!this._forceFullPlacement&&F.now()-B>2;for(;this._currentPlacementIndex>=0;){const U=d[a[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=H)&&(!U.maxzoom||U.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Qr(U)),this._inProgressLayer.continuePlacement(_[U.source],this.placement,this._showCollisionBoxes,U,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const So=512/s.W/2;class cs{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this._symbolsByKey={};const B=new Map;for(let S=0;S<d.length;S++){const U=d.get(S),H=U.key,q=B.get(H);q?q.push(U):B.set(H,[U])}for(const[S,U]of B){const H={positions:U.map(q=>({x:Math.floor(q.anchorX*So),y:Math.floor(q.anchorY*So)})),crossTileIDs:U.map(q=>q.crossTileID)};if(H.positions.length>128){const q=new s.au(H.positions.length,16,Uint16Array);for(const{x:w,y:T}of H.positions)q.add(w,T);q.finish(),delete H.positions,H.index=q}this._symbolsByKey[S]=H}}getScaledCoordinates(a,d){const{x:_,y:B,z:S}=this.tileID.canonical,{x:U,y:H,z:q}=d.canonical,w=So/Math.pow(2,q-S),T=(H*s.W+a.anchorY)*w,R=B*s.W*So;return{x:Math.floor((U*s.W+a.anchorX)*w-_*s.W*So),y:Math.floor(T-R)}}findMatches(a,d,_){const B=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let S=0;S<a.length;S++){const U=a.get(S);if(U.crossTileID)continue;const H=this._symbolsByKey[U.key];if(!H)continue;const q=this.getScaledCoordinates(U,d);if(H.index){const w=H.index.range(q.x-B,q.y-B,q.x+B,q.y+B).sort();for(const T of w){const R=H.crossTileIDs[T];if(!_[R]){_[R]=!0,U.crossTileID=R;break}}}else if(H.positions)for(let w=0;w<H.positions.length;w++){const T=H.positions[w],R=H.crossTileIDs[w];if(Math.abs(T.x-q.x)<=B&&Math.abs(T.y-q.y)<=B&&!_[R]){_[R]=!0,U.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:d}=a;return d})}}class Wi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Js{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const _ in this.indexes){const B=this.indexes[_],S={};for(const U in B){const H=B[U];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+d),S[H.tileID.key]=H}this.indexes[_]=S}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let S=0;S<d.symbolInstances.length;S++)d.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const B=this.usedCrossTileIDs[a.overscaledZ];for(const S in this.indexes){const U=this.indexes[S];if(Number(S)>a.overscaledZ)for(const H in U){const q=U[H];q.tileID.isChildOf(a)&&q.findMatches(d.symbolInstances,a,B)}else{const H=U[a.scaledTo(Number(S)).key];H&&H.findMatches(d.symbolInstances,a,B)}}for(let S=0;S<d.symbolInstances.length;S++){const U=d.symbolInstances.get(S);U.crossTileID||(U.crossTileID=_.generate(),B[U.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new cs(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.getCrossTileIDsLists())for(const B of _)delete this.usedCrossTileIDs[a][B]}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const B=this.indexes[_];for(const S in B)a[B[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,B[S]),delete B[S],d=!0)}return d}}class ws{constructor(){this.layerIndexes={},this.crossTileIDs=new Wi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_){let B=this.layerIndexes[a.id];B===void 0&&(B=this.layerIndexes[a.id]=new Js);let S=!1;const U={};B.handleWrapJump(_);for(const H of d){const q=H.getBucket(a);q&&a.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),B.addBucket(H.tileID,q,this.crossTileIDs)&&(S=!0),U[q.bucketInstanceId]=!0)}return B.removeStaleBuckets(U)&&(S=!0),S}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const dr=(y,a)=>s.t(y,a&&a.filter(d=>d.identifier!=="source.canvas")),Fr=s.av();class Vn extends s.E{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlTextPluginStateChange=()=>{for(const _ in this.sourceCaches){const B=this.sourceCaches[_].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[_].reload()}},this.map=a,this.dispatcher=new It(Pt(),a._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(_,B)=>this.getGlyphs(_,B)),this.dispatcher.registerMessageHandler("getImages",(_,B)=>this.getImages(_,B)),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new _t(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ee(256,512),this.crossTileSymbolIndex=new ws,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.ax()),Nt().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const B=this.sourceCaches[_.sourceId];if(!B)return;const S=B.getSource();if(S&&S.vectorLayerIds)for(const U in this._layers){const H=this._layers[U];H.source===S.id&&this._validateLayer(H)}})}loadURL(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const B=this.map._requestManager.transformRequest(a,Te.Style);this._loadStyleRequest=new AbortController,s.h(B,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,d,_)}).catch(S=>{this._loadStyleRequest=null,S&&this.fire(new s.j(S))})}loadJSON(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Fr,{validate:!1})}_load(a,d,_){var B;const S=d.transformStyle?d.transformStyle(_,a):a;if(!d.validate||!dr(this,s.x(S))){this._loaded=!0,this.stylesheet=S;for(const U in S.sources)this.addSource(U,S.sources[U],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Wt(this.stylesheet.light),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const a=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const _=s.az(d);_.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=_}}_loadSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,B;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,U,H,q){return s._(this,void 0,void 0,function*(){const w=De(S),T=H>1?"@2x":"",R={},j={};for(const{id:Z,url:W}of w){const J=U.transformRequest(U.normalizeSpriteURL(W,T,".json"),Te.SpriteJSON);R[Z]=s.h(J,q);const ee=U.transformRequest(U.normalizeSpriteURL(W,T,".png"),Te.SpriteImage);j[Z]=be.getImage(ee,q)}return yield Promise.all([...Object.values(R),...Object.values(j)]),function(Z,W){return s._(this,void 0,void 0,function*(){const J={};for(const ee in Z){J[ee]={};const ae=F.getImageCanvasContext((yield W[ee]).data),fe=(yield Z[ee]).data;for(const pe in fe){const{width:xe,height:Pe,x:Le,y:rt,sdf:Ke,pixelRatio:Re,stretchX:Qe,stretchY:pt,content:bt}=fe[pe];J[ee][pe]={data:null,pixelRatio:Re,sdf:Ke,stretchX:Qe,stretchY:pt,content:bt,spriteData:{width:xe,height:Pe,x:Le,y:rt,context:ae}}}}return J})}(R,j)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const U in S){this._spritesImagesIds[U]=[];const H=this._spritesImagesIds[U]?this._spritesImagesIds[U].filter(q=>!(q in S)):[];for(const q of H)this.imageManager.removeImage(q),this._changedImages[q]=!0;for(const q in S[U]){const w=U==="default"?q:`${U}:${q}`;this._spritesImagesIds[U].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,S[U][q],!1):this.imageManager.addImage(w,S[U][q]),d&&(this._changedImages[w]=!0)}}}).catch(S=>{this._spriteRequest=null,B=S,this.fire(new s.j(B))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),_&&_(B)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const _=a.sourceLayer;if(!_)return;const B=d.getSource();(B.type==="geojson"||B.vectorLayerIds&&B.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.j(new Error(`Source layer "${_}" does not exist on source "${B.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const _=[];for(const B of a)d[B]&&_.push(d[B]);return _}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const B=this._layers[_];B.type!=="custom"&&(a[_]=B.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const B=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(B.length||S.length)&&this._updateWorkerLayers(B,S);for(const U in this._updatedSources){const H=this._updatedSources[U];if(H==="reload")this._reloadSource(U);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(U)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const U in this._updatedPaintProps)this._layers[U].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const _={};for(const B in this.sourceCaches){const S=this.sourceCaches[B];_[B]=S.used,S.used=!1}for(const B of this._order){const S=this._layers[B];S.recalculate(a,this._availableImages),!S.isHidden(a.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const B in _){const S=this.sourceCaches[B];_[B]!==S.used&&S.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:B}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var _;this._checkLoaded();const B=this.serialize();if(a=d.transformStyle?d.transformStyle(B,a):a,((_=d.validate)===null||_===void 0||_)&&dr(this,s.x(a)))return!1;(a=s.aA(a)).layers=s.ay(a.layers);const S=s.aB(B,a),U=this._getOperationsToPerform(S);if(U.unimplemented.length>0)throw new Error(`Unimplemented: ${U.unimplemented.join(", ")}.`);if(U.operations.length===0)return!1;for(const H of U.operations)H();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],_=[];for(const B of a)switch(B.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,B.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,B.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,B.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,B.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,B.args));break;case"addSource":d.push(()=>this.addSource.apply(this,B.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,B.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,B.args));break;case"setLight":d.push(()=>this.setLight.apply(this,B.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,B.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,B.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,B.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,B.args));break;case"setTransition":d.push(()=>{});break;default:_.push(B.command)}return{operations:d,unimplemented:_}}addImage(a,d){if(this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.x.source,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const B=this.sourceCaches[a]=new Zi(a,d,this.dispatcher);B.style=this,B.setEventedParent(this,()=>({isSourceLoaded:B.loaded(),source:B.serialize(),sourceId:a})),B.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===a)return this.fire(new s.j(new Error(`Source "${a}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const _=this.sourceCaches[a].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=a.id;if(this.getLayer(B))return void this.fire(new s.j(new Error(`Layer "${B}" already exists on this map.`)));let S;if(a.type==="custom"){if(dr(this,s.aC(a)))return;S=s.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(B,a.source),a=s.aA(a),a=s.e(a,{source:B})),this._validate(s.x.layer,`layers.${B}`,a,{arrayIndex:-1},_))return;S=s.az(a),this._validateLayer(S),S.setEventedParent(this,{layer:{id:B}})}const U=d?this._order.indexOf(d):this._order.length;if(d&&U===-1)this.fire(new s.j(new Error(`Cannot add layer "${B}" before non-existing layer "${d}".`)));else{if(this._order.splice(U,0,B),this._layerOrderChanged=!0,this._layers[B]=S,this._removedLayers[B]&&S.source&&S.type!=="custom"){const H=this._removedLayers[B];delete this._removedLayers[B],H.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const _=this._order.indexOf(a);this._order.splice(_,1);const B=d?this._order.indexOf(d):this._order.length;d&&B===-1?this.fire(new s.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(B,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,_){this._checkLoaded();const B=this.getLayer(a);B?B.minzoom===d&&B.maxzoom===_||(d!=null&&(B.minzoom=d),_!=null&&(B.maxzoom=_),this._updateLayer(B)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=this.getLayer(a);if(B){if(!s.aD(B.filter,d))return d==null?(B.filter=void 0,void this._updateLayer(B)):void(this._validate(s.x.filter,`layers.${B.id}.filter`,d,null,_)||(B.filter=s.aA(d),this._updateLayer(B)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return s.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(a);S?s.aD(S.getLayoutProperty(d),_)||(S.setLayoutProperty(d,_,B),this._updateLayer(S)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const _=this.getLayer(a);if(_)return _.getLayoutProperty(d);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(a);S?s.aD(S.getPaintProperty(d),_)||(S.setPaintProperty(d,_,B)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const _=a.source,B=a.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const U=S.getSource().type;U==="geojson"&&B?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||B?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(B,a.id,d)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const _=a.source,B=this.sourceCaches[_];if(B===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const S=B.getSource().type,U=S==="vector"?a.sourceLayer:void 0;S!=="vector"||U?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):B.removeFeatureState(U,a.id,d):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,_=a.sourceLayer,B=this.sourceCaches[d];if(B!==void 0)return B.getSource().type!=="vector"||_?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),B.getFeatureState(_,a.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=s.aE(this.sourceCaches,S=>S.serialize()),d=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,B=this.stylesheet;return s.aF({version:B.version,name:B.name,metadata:B.metadata,light:B.light,center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch,sprite:B.sprite,glyphs:B.glyphs,transition:B.transition,sources:a,layers:d,terrain:_},S=>S!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=U=>this._layers[U].type==="fill-extrusion",_={},B=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H)){_[H]=U;for(const q of a){const w=q[H];if(w)for(const T of w)B.push(T)}}}B.sort((U,H)=>H.intersectionZ-U.intersectionZ);const S=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H))for(let q=B.length-1;q>=0;q--){const w=B[q].feature;if(_[w.layer.id]<U)break;S.push(w),B.pop()}else for(const q of a){const w=q[H];if(w)for(const T of w)S.push(T.feature)}}return S}queryRenderedFeatures(a,d,_){d&&d.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const B={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const H of d.layers){const q=this._layers[H];if(!q)return this.fire(new s.j(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];B[q.source]=!0}}const S=[];d.availableImages=this._availableImages;const U=this._serializedAllLayers();for(const H in this.sourceCaches)d.layers&&!B[H]||S.push(gi(this.sourceCaches[H],this._layers,U,a,d,_));return this.placement&&S.push(function(H,q,w,T,R,j,Z){const W={},J=j.queryRenderedSymbols(T),ee=[];for(const ae of Object.keys(J).map(Number))ee.push(Z[ae]);ee.sort(mi);for(const ae of ee){const fe=ae.featureIndex.lookupSymbolFeatures(J[ae.bucketInstanceId],q,ae.bucketIndex,ae.sourceLayerIndex,R.filter,R.layers,R.availableImages,H);for(const pe in fe){const xe=W[pe]=W[pe]||[],Pe=fe[pe];Pe.sort((Le,rt)=>{const Ke=ae.featureSortOrder;if(Ke){const Re=Ke.indexOf(Le.featureIndex);return Ke.indexOf(rt.featureIndex)-Re}return rt.featureIndex-Le.featureIndex});for(const Le of Pe)xe.push(Le)}}for(const ae in W)W[ae].forEach(fe=>{const pe=fe.feature,xe=w[H[ae].source].getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=xe});return W}(this._layers,U,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(a,d){d&&d.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[a];return _?function(B,S){const U=B.getRenderableIds().map(w=>B.getTileByID(w)),H=[],q={};for(let w=0;w<U.length;w++){const T=U[w],R=T.tileID.canonical.key;q[R]||(q[R]=!0,T.querySourceFeatures(H,S))}return H}(_,d):[]}getLight(){return this.light.getLight()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const _=this.light.getLight();let B=!1;for(const U in a)if(!s.aD(a[U],_[U])){B=!0;break}if(!B)return;const S={now:F.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(S)}_validate(a,d,_,B){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!S||S.validate!==!1)&&dr(this,a.call(s.x,s.e({key:d,style:this.serialize(),value:_,styleSpec:s.v},B)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Nt().off("pluginStateChange",this._rtlTextPluginStateChange);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const _=this.sourceCaches[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,_,B){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,U=!1,H=!1;const q={};for(const w of this._order){const T=this._layers[w];if(T.type!=="symbol")continue;if(!q[T.source]){const j=this.sourceCaches[T.source];q[T.source]=j.getRenderableIds(!0).map(Z=>j.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(T,q[T.source],a.center.lng);U=U||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),a.zoom))&&(this.pauseablePlacement=new xn(a,this.map.terrain,this._order,S,d,_,B,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),H=!0),U&&this.pauseablePlacement.placement.setStale()),H||U)for(const w of this._order){const T=this._layers[w];T.type==="symbol"&&this.placement.updateLayerOpacities(T,q[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,d.icons),_})}getGlyphs(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(s.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const S=[{id:a,url:d}],U=[...De(this.stylesheet.sprite),...S];this._validate(s.x.sprite,"sprite",U,null,_)||(this.stylesheet.sprite=U,this._loadSprite(S,!0,B))}removeSprite(a){this._checkLoaded();const d=De(this.stylesheet.sprite);if(d.find(_=>_.id===a)){if(this._spritesImagesIds[a])for(const _ of this._spritesImagesIds[a])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex(_=>_.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return De(this.stylesheet.sprite)}setSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(s.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,_):(this._unloadSprite(),_&&_(null)))}}var Or=s.X([{name:"a_pos",type:"Int16",components:2}]),Cn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const An={prelude:Hr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Hr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Hr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Hr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Hr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Hr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Hr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Hr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Hr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Hr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Hr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Hr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Hr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Hr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Hr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Hr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Hr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Hr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Hr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Hr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Hr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cn),terrainDepth:Hr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cn),terrainCoords:Hr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cn)};function Hr(y,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute ([\w]+) ([\w]+)/g),B=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),U=S?S.concat(B):B,H={};return{fragmentSource:y=y.replace(d,(q,w,T,R,j)=>(H[j]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${T} ${R} ${j};
#else
uniform ${T} ${R} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${T} ${R} ${j} = u_${j};
#endif
`)),vertexSource:a=a.replace(d,(q,w,T,R,j)=>{const Z=R==="float"?"vec2":"vec4",W=j.match(/color/)?"color":Z;return H[j]?w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${T} ${Z} a_${j};
varying ${T} ${R} ${j};
#else
uniform ${T} ${R} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${T} ${R} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${T} ${R} ${j} = u_${j};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${T} ${Z} a_${j};
#else
uniform ${T} ${R} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${T} ${R} ${j} = a_${j};
#else
    ${T} ${R} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${T} ${R} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${T} ${R} ${j} = u_${j};
#endif
`}),staticAttributes:_,staticUniforms:U}}class Hs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,_,B,S,U,H,q,w){this.context=a;let T=this.boundPaintVertexBuffers.length!==B.length;for(let R=0;!T&&R<B.length;R++)this.boundPaintVertexBuffers[R]!==B[R]&&(T=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||T||this.boundIndexBuffer!==S||this.boundVertexOffset!==U||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==q||this.boundDynamicVertexBuffer3!==w?this.freshBind(d,_,B,S,U,H,q,w):(a.bindVertexArray.set(this.vao),H&&H.bind(),S&&S.dynamicDraw&&S.bind(),q&&q.bind(),w&&w.bind())}freshBind(a,d,_,B,S,U,H,q){const w=a.numAttributes,T=this.context,R=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=B,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=U,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=q,d.enableAttributes(R,a);for(const j of _)j.enableAttributes(R,a);U&&U.enableAttributes(R,a),H&&H.enableAttributes(R,a),q&&q.enableAttributes(R,a),d.bind(),d.setVertexAttribPointers(R,a,S);for(const j of _)j.bind(),j.setVertexAttribPointers(R,a,S);U&&(U.bind(),U.setVertexAttribPointers(R,a,S)),B&&B.bind(),H&&(H.bind(),H.setVertexAttribPointers(R,a,S)),q&&(q.bind(),q.setVertexAttribPointers(R,a,S)),T.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ca(y){const a=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const _=y[d].split(" ");a.push(_.pop())}return a}class uo{constructor(a,d,_,B,S,U){const H=a.gl;this.program=H.createProgram();const q=ca(d.staticAttributes),w=_?_.getBinderAttributes():[],T=q.concat(w),R=An.prelude.staticUniforms?ca(An.prelude.staticUniforms):[],j=d.staticUniforms?ca(d.staticUniforms):[],Z=_?_.getBinderUniforms():[],W=R.concat(j).concat(Z),J=[];for(const Le of W)J.indexOf(Le)<0&&J.push(Le);const ee=_?_.defines():[];S&&ee.push("#define OVERDRAW_INSPECTOR;"),U&&ee.push("#define TERRAIN3D;");const ae=ee.concat(An.prelude.fragmentSource,d.fragmentSource).join(`
`),fe=ee.concat(An.prelude.vertexSource,d.vertexSource).join(`
`),pe=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(pe,ae),H.compileShader(pe),!H.getShaderParameter(pe,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(pe)}`);H.attachShader(this.program,pe);const xe=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(xe,fe),H.compileShader(xe),!H.getShaderParameter(xe,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(xe)}`);H.attachShader(this.program,xe),this.attributes={};const Pe={};this.numAttributes=T.length;for(let Le=0;Le<this.numAttributes;Le++)T[Le]&&(H.bindAttribLocation(this.program,Le,T[Le]),this.attributes[T[Le]]=Le);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(xe),H.deleteShader(pe);for(let Le=0;Le<J.length;Le++){const rt=J[Le];if(rt&&!Pe[rt]){const Ke=H.getUniformLocation(this.program,rt);Ke&&(Pe[rt]=Ke)}}this.fixedUniforms=B(a,Pe),this.terrainUniforms=((Le,rt)=>({u_depth:new s.aG(Le,rt.u_depth),u_terrain:new s.aG(Le,rt.u_terrain),u_terrain_dim:new s.aH(Le,rt.u_terrain_dim),u_terrain_matrix:new s.aI(Le,rt.u_terrain_matrix),u_terrain_unpack:new s.aJ(Le,rt.u_terrain_unpack),u_terrain_exaggeration:new s.aH(Le,rt.u_terrain_exaggeration)}))(a,Pe),this.binderUniforms=_?_.getUniforms(a,Pe):[]}draw(a,d,_,B,S,U,H,q,w,T,R,j,Z,W,J,ee,ae,fe){const pe=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(B),a.setColorMode(S),a.setCullFace(U),q){a.activeTexture.set(pe.TEXTURE2),pe.bindTexture(pe.TEXTURE_2D,q.depthTexture),a.activeTexture.set(pe.TEXTURE3),pe.bindTexture(pe.TEXTURE_2D,q.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(q[Pe])}for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(H[Pe]);J&&J.setUniforms(a,this.binderUniforms,Z,{zoom:W});let xe=0;switch(d){case pe.LINES:xe=2;break;case pe.TRIANGLES:xe=3;break;case pe.LINE_STRIP:xe=1}for(const Pe of j.get()){const Le=Pe.vaos||(Pe.vaos={});(Le[w]||(Le[w]=new Hs)).bind(a,this,T,J?J.getPaintVertexBuffers():[],R,Pe.vertexOffset,ee,ae,fe),pe.drawElements(d,Pe.primitiveLength*xe,pe.UNSIGNED_SHORT,Pe.primitiveOffset*xe*2)}}}function Ea(y,a,d){const _=1/qt(d,1,a.transform.tileZoom),B=Math.pow(2,d.tileID.overscaledZ),S=d.tileSize*Math.pow(2,a.transform.tileZoom)/B,U=S*(d.tileID.canonical.x+d.tileID.wrap*B),H=S*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[U>>16,H>>16],u_pixel_coord_lower:[65535&U,65535&H]}}const Ne=(y,a,d,_)=>{const B=a.style.light,S=B.properties.get("position"),U=[S.x,S.y,S.z],H=function(){var w=new s.A(9);return s.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}();B.properties.get("anchor")==="viewport"&&function(w,T){var R=Math.sin(T),j=Math.cos(T);w[0]=j,w[1]=R,w[2]=0,w[3]=-R,w[4]=j,w[5]=0,w[6]=0,w[7]=0,w[8]=1}(H,-a.transform.angle),function(w,T,R){var j=T[0],Z=T[1],W=T[2];w[0]=j*R[0]+Z*R[3]+W*R[6],w[1]=j*R[1]+Z*R[4]+W*R[7],w[2]=j*R[2]+Z*R[5]+W*R[8]}(U,U,H);const q=B.properties.get("color");return{u_matrix:y,u_lightpos:U,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+d,u_opacity:_}},Ze=(y,a,d,_,B,S,U)=>s.e(Ne(y,a,d,_),Ea(S,a,U),{u_height_factor:-Math.pow(2,B.overscaledZ)/U.tileSize/8}),dt=y=>({u_matrix:y}),Ot=(y,a,d,_)=>s.e(dt(y),Ea(d,a,_)),ui=(y,a)=>({u_matrix:y,u_world:a}),Gi=(y,a,d,_,B)=>s.e(Ot(y,a,d,_),{u_world:B}),br=(y,a,d,_)=>{const B=y.transform;let S,U;if(_.paint.get("circle-pitch-alignment")==="map"){const H=qt(d,1,B.zoom);S=!0,U=[H,H]}else S=!1,U=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(a.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:U}},En=(y,a,d)=>{const _=qt(d,1,a.zoom),B=Math.pow(2,a.zoom-d.tileID.overscaledZ),S=d.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[a.pixelsToGLUnits[0]/(_*B),a.pixelsToGLUnits[1]/(_*B)],u_overscale_factor:S}},kn=function(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:d}},is=y=>({u_matrix:y}),wn=(y,a,d,_)=>({u_matrix:y,u_extrude_scale:qt(a,1,d),u_intensity:_});function iu(y,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new s.Y(0,_/d).toLngLat().lat,new s.Y(0,(_+1)/d).toLngLat().lat]}const Va=(y,a,d,_)=>{const B=y.transform;return{u_matrix:To(y,a,d,_),u_ratio:1/qt(a,1,B.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Tr=(y,a,d,_,B)=>s.e(Va(y,a,d,B),{u_image:0,u_image_height:_}),Ha=(y,a,d,_,B)=>{const S=y.transform,U=Jn(a,S);return{u_matrix:To(y,a,d,B),u_texsize:a.imageAtlasTexture.size,u_ratio:1/qt(a,1,S.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[U,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Dl=(y,a,d,_,B,S)=>{const U=y.lineAtlas,H=Jn(a,y.transform),q=d.layout.get("line-cap")==="round",w=U.getDash(_.from,q),T=U.getDash(_.to,q),R=w.width*B.fromScale,j=T.width*B.toScale;return s.e(Va(y,a,d,S),{u_patternscale_a:[H/R,-w.height/2],u_patternscale_b:[H/j,-T.height/2],u_sdfgamma:U.width/(256*Math.min(R,j)*y.pixelRatio)/2,u_image:0,u_tex_y_a:w.y,u_tex_y_b:T.y,u_mix:B.t})};function Jn(y,a){return 1/qt(y,1,a.tileZoom)}function To(y,a,d,_){return y.translatePosMatrix(_?_.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Ga=(y,a,d,_,B)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(U=B.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(S=B.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:gs(B.paint.get("raster-hue-rotate"))};var S,U};function gs(y){y*=Math.PI/180;const a=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const ua=(y,a,d,_,B,S,U,H,q,w)=>{const T=B.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:T.width/T.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:U,u_coord_matrix:H,u_is_text:+q,u_pitch_with_map:+_,u_texsize:w,u_texture:0}},ja=(y,a,d,_,B,S,U,H,q,w,T)=>{const R=B.transform;return s.e(ua(y,a,d,_,B,S,U,H,q,w),{u_gamma_scale:_?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:B.pixelRatio,u_is_halo:+T})},Sa=(y,a,d,_,B,S,U,H,q,w)=>s.e(ja(y,a,d,_,B,S,U,H,!0,q,!0),{u_texsize_icon:w,u_texture_icon:1}),Ic=(y,a,d)=>({u_matrix:y,u_opacity:a,u_color:d}),qa=(y,a,d,_,B,S)=>s.e(function(U,H,q,w){const T=q.imageManager.getPattern(U.from.toString()),R=q.imageManager.getPattern(U.to.toString()),{width:j,height:Z}=q.imageManager.getPixelSize(),W=Math.pow(2,w.tileID.overscaledZ),J=w.tileSize*Math.pow(2,q.transform.tileZoom)/W,ee=J*(w.tileID.canonical.x+w.tileID.wrap*W),ae=J*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,Z],u_mix:H.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/qt(w,1,q.transform.tileZoom),u_pixel_coord_upper:[ee>>16,ae>>16],u_pixel_coord_lower:[65535&ee,65535&ae]}}(_,S,d,B),{u_matrix:y,u_opacity:a}),ho={fillExtrusion:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_opacity:new s.aH(y,a.u_opacity)}),fillExtrusionPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_height_factor:new s.aH(y,a.u_height_factor),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade),u_opacity:new s.aH(y,a.u_opacity)}),fill:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),fillPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),fillOutline:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world)}),fillOutlinePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),circle:(y,a)=>({u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_scale_with_map:new s.aG(y,a.u_scale_with_map),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_matrix:new s.aI(y,a.u_matrix)}),collisionBox:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(y,a.u_pixels_to_tile_units),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_overscale_factor:new s.aH(y,a.u_overscale_factor)}),collisionCircle:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_inv_matrix:new s.aI(y,a.u_inv_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_viewport_size:new s.aL(y,a.u_viewport_size)}),debug:(y,a)=>({u_color:new s.aM(y,a.u_color),u_matrix:new s.aI(y,a.u_matrix),u_overlay:new s.aG(y,a.u_overlay),u_overlay_scale:new s.aH(y,a.u_overlay_scale)}),clippingMask:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),heatmap:(y,a)=>({u_extrude_scale:new s.aH(y,a.u_extrude_scale),u_intensity:new s.aH(y,a.u_intensity),u_matrix:new s.aI(y,a.u_matrix)}),heatmapTexture:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_color_ramp:new s.aG(y,a.u_color_ramp),u_opacity:new s.aH(y,a.u_opacity)}),hillshade:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_latrange:new s.aL(y,a.u_latrange),u_light:new s.aL(y,a.u_light),u_shadow:new s.aM(y,a.u_shadow),u_highlight:new s.aM(y,a.u_highlight),u_accent:new s.aM(y,a.u_accent)}),hillshadePrepare:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_dimension:new s.aL(y,a.u_dimension),u_zoom:new s.aH(y,a.u_zoom),u_unpack:new s.aJ(y,a.u_unpack)}),line:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels)}),lineGradient:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_image:new s.aG(y,a.u_image),u_image_height:new s.aH(y,a.u_image_height)}),linePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texsize:new s.aL(y,a.u_texsize),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_image:new s.aG(y,a.u_image),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),lineSDF:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_patternscale_a:new s.aL(y,a.u_patternscale_a),u_patternscale_b:new s.aL(y,a.u_patternscale_b),u_sdfgamma:new s.aH(y,a.u_sdfgamma),u_image:new s.aG(y,a.u_image),u_tex_y_a:new s.aH(y,a.u_tex_y_a),u_tex_y_b:new s.aH(y,a.u_tex_y_b),u_mix:new s.aH(y,a.u_mix)}),raster:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_tl_parent:new s.aL(y,a.u_tl_parent),u_scale_parent:new s.aH(y,a.u_scale_parent),u_buffer_scale:new s.aH(y,a.u_buffer_scale),u_fade_t:new s.aH(y,a.u_fade_t),u_opacity:new s.aH(y,a.u_opacity),u_image0:new s.aG(y,a.u_image0),u_image1:new s.aG(y,a.u_image1),u_brightness_low:new s.aH(y,a.u_brightness_low),u_brightness_high:new s.aH(y,a.u_brightness_high),u_saturation_factor:new s.aH(y,a.u_saturation_factor),u_contrast_factor:new s.aH(y,a.u_contrast_factor),u_spin_weights:new s.aK(y,a.u_spin_weights)}),symbolIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture)}),symbolSDF:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),symbolTextAndIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texsize_icon:new s.aL(y,a.u_texsize_icon),u_texture:new s.aG(y,a.u_texture),u_texture_icon:new s.aG(y,a.u_texture_icon),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),background:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_color:new s.aM(y,a.u_color)}),backgroundPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_image:new s.aG(y,a.u_image),u_pattern_tl_a:new s.aL(y,a.u_pattern_tl_a),u_pattern_br_a:new s.aL(y,a.u_pattern_br_a),u_pattern_tl_b:new s.aL(y,a.u_pattern_tl_b),u_pattern_br_b:new s.aL(y,a.u_pattern_br_b),u_texsize:new s.aL(y,a.u_texsize),u_mix:new s.aH(y,a.u_mix),u_pattern_size_a:new s.aL(y,a.u_pattern_size_a),u_pattern_size_b:new s.aL(y,a.u_pattern_size_b),u_scale_a:new s.aH(y,a.u_scale_a),u_scale_b:new s.aH(y,a.u_scale_b),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(y,a.u_tile_units_to_pixels)}),terrain:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainDepth:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainCoords:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_terrain_coords_id:new s.aH(y,a.u_terrain_coords_id),u_ele_delta:new s.aH(y,a.u_ele_delta)})};class Pr{constructor(a,d,_){this.context=a;const B=a.gl;this.buffer=B.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ha={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class us{constructor(a,d,_,B){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=B,this.context=a;const S=a.gl;this.buffer=S.createBuffer(),a.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const B=d.attributes[this.attributes[_].name];B!==void 0&&a.enableVertexAttribArray(B)}}setVertexAttribPointers(a,d,_){for(let B=0;B<this.attributes.length;B++){const S=this.attributes[B],U=d.attributes[S.name];U!==void 0&&a.vertexAttribPointer(U,S.components,a[ha[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dn=new WeakMap;function rs(y){var a;if(dn.has(y))return dn.get(y);{const d=(a=y.getParameter(y.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return dn.set(y,d),d}}class Vr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $a extends Vr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class nl extends Vr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Rl extends Vr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Io extends Vr{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ko extends Vr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class cc extends Vr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Wo extends Vr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Ao extends Vr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class uc extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Xo extends Vr{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class kl extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class Lc extends Vr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ah extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class ru extends Vr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class nu extends Vr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Iu extends Vr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ol extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class Ka extends Vr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Wa extends Vr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Ul extends Vr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class Xa extends Vr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Aa extends Vr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class sl extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Nl extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ys extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class da extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class re extends Vr{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ie extends Vr{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const _=this.gl;rs(_)?_.bindVertexArray(a):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class at extends Vr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class mt extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class vt extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Tt extends Vr{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class pi extends Tt{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ri extends Tt{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class rr extends Tt{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class qi{constructor(a,d,_,B,S){this.context=a,this.width=d,this.height=_;const U=a.gl,H=this.framebuffer=U.createFramebuffer();if(this.colorAttachment=new pi(a,H),B)this.depthAttachment=S?new rr(a,H):new ri(a,H);else if(S)throw new Error("Stencil cannot be set without depth");if(U.checkFramebufferStatus(U.FRAMEBUFFER)!==U.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class ki{constructor(a,d,_){this.blendFunction=a,this.blendColor=d,this.mask=_}}ki.Replace=[1,0],ki.disabled=new ki(ki.Replace,s.aO.transparent,[!1,!1,!1,!1]),ki.unblended=new ki(ki.Replace,s.aO.transparent,[!0,!0,!0,!0]),ki.alphaBlended=new ki([1,771],s.aO.transparent,[!0,!0,!0,!0]);class jr{constructor(a){var d,_;if(this.gl=a,this.clearColor=new $a(this),this.clearDepth=new nl(this),this.clearStencil=new Rl(this),this.colorMask=new Io(this),this.depthMask=new Ko(this),this.stencilMask=new cc(this),this.stencilFunc=new Wo(this),this.stencilOp=new Ao(this),this.stencilTest=new uc(this),this.depthRange=new Xo(this),this.depthTest=new kl(this),this.depthFunc=new Lc(this),this.blend=new Ah(this),this.blendFunc=new ru(this),this.blendColor=new nu(this),this.blendEquation=new Iu(this),this.cullFace=new Ol(this),this.cullFaceSide=new Ka(this),this.frontFace=new Wa(this),this.program=new Ul(this),this.activeTexture=new Xa(this),this.viewport=new Aa(this),this.bindFramebuffer=new sl(this),this.bindRenderbuffer=new Nl(this),this.bindTexture=new Ys(this),this.bindVertexBuffer=new da(this),this.bindElementBuffer=new re(this),this.bindVertexArray=new Ie(this),this.pixelStoreUnpack=new at(this),this.pixelStoreUnpackPremultiplyAlpha=new mt(this),this.pixelStoreUnpackFlipY=new vt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),rs(a)){this.HALF_FLOAT=a.HALF_FLOAT;const B=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:B==null?void 0:B.RGBA16F_EXT,this.RGB16F=(_=a.RGB16F)!==null&&_!==void 0?_:B==null?void 0:B.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const B=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=B==null?void 0:B.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Pr(this,a,d)}createVertexBuffer(a,d,_){return new us(this,a,d,_)}createRenderbuffer(a,d,_){const B=this.gl,S=B.createRenderbuffer();return this.bindRenderbuffer.set(S),B.renderbufferStorage(B.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),S}createFramebuffer(a,d,_,B){return new qi(this,a,d,_,B)}clear(a){let{color:d,depth:_,stencil:B}=a;const S=this.gl;let U=0;d&&(U|=S.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(U|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),B!==void 0&&(U|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),S.clear(U)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.aD(a.blendFunction,ki.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return rs(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return rs(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class nr{constructor(a,d,_){this.func=a,this.mask=d,this.range=_}}nr.ReadOnly=!1,nr.ReadWrite=!0,nr.disabled=new nr(519,nr.ReadOnly,[0,1]);const Hn=7680;class Br{constructor(a,d,_,B,S,U){this.test=a,this.ref=d,this.mask=_,this.fail=B,this.depthFail=S,this.pass=U}}Br.disabled=new Br({func:519,mask:0},0,0,Hn,Hn,Hn);class Lr{constructor(a,d,_){this.enable=a,this.mode=d,this.frontFace=_}}let On;function qs(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w=y.useProgram("collisionBox"),T=[];let R=0,j=0;for(let pe=0;pe<_.length;pe++){const xe=_[pe],Pe=a.getTile(xe),Le=Pe.getBucket(d);if(!Le)continue;let rt=xe.posMatrix;B[0]===0&&B[1]===0||(rt=y.translatePosMatrix(xe.posMatrix,Pe,B,S));const Ke=U?Le.textCollisionBox:Le.iconCollisionBox,Re=Le.collisionCircleArray;if(Re.length>0){const Qe=s.F(),pt=rt;s.aP(Qe,Le.placementInvProjMatrix,y.transform.glCoordMatrix),s.aP(Qe,Qe,Le.placementViewportMatrix),T.push({circleArray:Re,circleOffset:j,transform:pt,invTransform:Qe,coord:xe}),R+=Re.length/4,j=R}Ke&&w.draw(H,q.LINES,nr.disabled,Br.disabled,y.colorModeForRenderPass(),Lr.disabled,En(rt,y.transform,Pe),y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe),d.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,y.transform.zoom,null,null,Ke.collisionVertexBuffer)}if(!U||!T.length)return;const Z=y.useProgram("collisionCircle"),W=new s.aQ;W.resize(4*R),W._trim();let J=0;for(const pe of T)for(let xe=0;xe<pe.circleArray.length/4;xe++){const Pe=4*xe,Le=pe.circleArray[Pe+0],rt=pe.circleArray[Pe+1],Ke=pe.circleArray[Pe+2],Re=pe.circleArray[Pe+3];W.emplace(J++,Le,rt,Ke,Re,0),W.emplace(J++,Le,rt,Ke,Re,1),W.emplace(J++,Le,rt,Ke,Re,2),W.emplace(J++,Le,rt,Ke,Re,3)}(!On||On.length<2*R)&&(On=function(pe){const xe=2*pe,Pe=new s.aS;Pe.resize(xe),Pe._trim();for(let Le=0;Le<xe;Le++){const rt=6*Le;Pe.uint16[rt+0]=4*Le+0,Pe.uint16[rt+1]=4*Le+1,Pe.uint16[rt+2]=4*Le+2,Pe.uint16[rt+3]=4*Le+2,Pe.uint16[rt+4]=4*Le+3,Pe.uint16[rt+5]=4*Le+0}return Pe}(R));const ee=H.createIndexBuffer(On,!0),ae=H.createVertexBuffer(W,s.aR.members,!0);for(const pe of T){const xe={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(fe=y.transform).cameraToCenterDistance,u_viewport_size:[fe.width,fe.height]};Z.draw(H,q.TRIANGLES,nr.disabled,Br.disabled,y.colorModeForRenderPass(),Lr.disabled,xe,y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe.coord),d.id,ae,ee,s.$.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,y.transform.zoom,null,null,null)}var fe;ae.destroy(),ee.destroy()}Lr.disabled=new Lr(!1,1029,2305),Lr.backCCW=new Lr(!0,1029,2305);const eo=s.an(new Float32Array(16));function Lo(y,a,d,_,B,S){const{horizontalAlign:U,verticalAlign:H}=s.at(y);return new s.P((-(U-.5)*a/B+_[0])*S,(-(H-.5)*d/B+_[1])*S)}function Ta(y,a,d,_,B,S,U,H,q,w,T){const R=y.text.placedSymbolArray,j=y.text.dynamicLayoutVertexArray,Z=y.icon.dynamicLayoutVertexArray,W={};j.clear();for(let J=0;J<R.length;J++){const ee=R.get(J),ae=ee.hidden||!ee.crossTileID||y.allowVerticalPlacement&&!ee.placedOrientation?null:_[ee.crossTileID];if(ae){const fe=new s.P(ee.anchorX,ee.anchorY),pe=Sr(fe,d?U:S,T),xe=ze(B.cameraToCenterDistance,pe.signedDistanceFromCamera);let Pe=s.ai(y.textSizeData,q,ee)*xe/s.ao;d&&(Pe*=y.tilePixelRatio/H);const{width:Le,height:rt,anchor:Ke,textOffset:Re,textBoxScale:Qe}=ae,pt=Lo(Ke,Le,rt,Re,Qe,Pe),bt=d?Sr(fe.add(pt),S,T).point:pe.point.add(a?pt.rotate(-B.angle):pt),ht=y.allowVerticalPlacement&&ee.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let Rt=0;Rt<ee.numGlyphs;Rt++)s.aj(j,bt,ht);w&&ee.associatedIconIndex>=0&&(W[ee.associatedIconIndex]={shiftedAnchor:bt,angle:ht})}else it(ee.numGlyphs,j)}if(w){Z.clear();const J=y.icon.placedSymbolArray;for(let ee=0;ee<J.length;ee++){const ae=J.get(ee);if(ae.hidden)it(ae.numGlyphs,Z);else{const fe=W[ee];if(fe)for(let pe=0;pe<ae.numGlyphs;pe++)s.aj(Z,fe.shiftedAnchor,fe.angle);else it(ae.numGlyphs,Z)}}y.icon.dynamicLayoutVertexBuffer.updateData(Z)}y.text.dynamicLayoutVertexBuffer.updateData(j)}function fa(y,a,d){return d.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function zl(y,a,d,_,B,S,U,H,q,w,T,R){const j=y.context,Z=j.gl,W=y.transform,J=H==="map",ee=q==="map",ae=H!=="viewport"&&d.layout.get("symbol-placement")!=="point",fe=J&&!ee&&!ae,pe=!d.layout.get("symbol-sort-key").isConstant();let xe=!1;const Pe=y.depthModeForSublayer(0,nr.ReadOnly),Le=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),rt=[];for(const Ke of _){const Re=a.getTile(Ke),Qe=Re.getBucket(d);if(!Qe)continue;const pt=B?Qe.text:Qe.icon;if(!pt||!pt.segments.get().length||!pt.hasVisibleVertices)continue;const bt=pt.programConfigurations.get(d.id),ht=B||Qe.sdfIcons,Rt=B?Qe.textSizeData:Qe.iconSizeData,Dt=ee||W.pitch!==0,hi=y.useProgram(fa(ht,B,Qe),bt),Vt=s.ag(Rt,W.zoom),_i=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ke);let Si,Yi,Ti,yr,fr=[0,0],ji=null;if(B)Yi=Re.glyphAtlasTexture,Ti=Z.LINEAR,Si=Re.glyphAtlasTexture.size,Qe.iconsInText&&(fr=Re.imageAtlasTexture.size,ji=Re.imageAtlasTexture,yr=Dt||y.options.rotating||y.options.zooming||Rt.kind==="composite"||Rt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const qr=d.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;Yi=Re.imageAtlasTexture,Ti=ht||y.options.rotating||y.options.zooming||qr||Dt?Z.LINEAR:Z.NEAREST,Si=Re.imageAtlasTexture.size}const Ur=qt(Re,1,y.transform.zoom),rn=Jt(Ke.posMatrix,ee,J,y.transform,Ur),Mr=mr(Ke.posMatrix,ee,J,y.transform,Ur),Kr=Le&&Qe.hasTextData(),Cr=d.layout.get("icon-text-fit")!=="none"&&Kr&&Qe.hasIconData();if(ae){const qr=y.style.map.terrain?(Mn,$n)=>y.style.map.terrain.getElevation(Ke,Mn,$n):null,Wr=d.layout.get("text-rotation-alignment")==="map";oe(Qe,Ke.posMatrix,y,B,rn,Mr,ee,w,Wr,qr)}const es=y.translatePosMatrix(Ke.posMatrix,Re,S,U),Nr=ae||B&&Le||Cr?eo:rn,pr=y.translatePosMatrix(Mr,Re,S,U,!0),_r=ht&&d.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=ht?Qe.iconsInText?Sa(Rt.kind,Vt,fe,ee,y,es,Nr,pr,Si,fr):ja(Rt.kind,Vt,fe,ee,y,es,Nr,pr,B,Si,!0):ua(Rt.kind,Vt,fe,ee,y,es,Nr,pr,B,Si);const ln={program:hi,buffers:pt,uniformValues:or,atlasTexture:Yi,atlasTextureIcon:ji,atlasInterpolation:Ti,atlasInterpolationIcon:yr,isSDF:ht,hasHalo:_r};if(pe&&Qe.canOverlap){xe=!0;const qr=pt.segments.get();for(const Wr of qr)rt.push({segments:new s.$([Wr]),sortKey:Wr.sortKey,state:ln,terrainData:_i})}else rt.push({segments:pt.segments,sortKey:0,state:ln,terrainData:_i})}xe&&rt.sort((Ke,Re)=>Ke.sortKey-Re.sortKey);for(const Ke of rt){const Re=Ke.state;if(j.activeTexture.set(Z.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,Z.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Re.isSDF){const Qe=Re.uniformValues;Re.hasHalo&&(Qe.u_is_halo=1,ol(Re.buffers,Ke.segments,d,y,Re.program,Pe,T,R,Qe,Ke.terrainData)),Qe.u_is_halo=0}ol(Re.buffers,Ke.segments,d,y,Re.program,Pe,T,R,Re.uniformValues,Ke.terrainData)}}function ol(y,a,d,_,B,S,U,H,q,w){const T=_.context;B.draw(T,T.gl.TRIANGLES,S,U,H,Lr.disabled,q,w,d.id,y.layoutVertexBuffer,y.indexBuffer,a,d.paint,_.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Ql(y,a,d,_,B){if(!d||!_||!_.imageAtlas)return;const S=_.imageAtlas.patternPositions;let U=S[d.to.toString()],H=S[d.from.toString()];if(!U&&H&&(U=H),!H&&U&&(H=U),!U||!H){const q=B.getPaintProperty(a);U=S[q],H=S[q]}U&&H&&y.setConstantPatternPositions(U,H)}function hc(y,a,d,_,B,S,U){const H=y.context.gl,q="fill-pattern",w=d.paint.get(q),T=w&&w.constantOr(1),R=d.getCrossfadeParameters();let j,Z,W,J,ee;U?(Z=T&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=H.LINES):(Z=T?"fillPattern":"fill",j=H.TRIANGLES);const ae=w.constantOr(null);for(const fe of _){const pe=a.getTile(fe);if(T&&!pe.patternsLoaded())continue;const xe=pe.getBucket(d);if(!xe)continue;const Pe=xe.programConfigurations.get(d.id),Le=y.useProgram(Z,Pe),rt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(fe);T&&(y.context.activeTexture.set(H.TEXTURE0),pe.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Pe.updatePaintBuffers(R)),Ql(Pe,q,ae,pe,d);const Ke=rt?fe:null,Re=y.translatePosMatrix(Ke?Ke.posMatrix:fe.posMatrix,pe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(U){J=xe.indexBuffer2,ee=xe.segments2;const Qe=[H.drawingBufferWidth,H.drawingBufferHeight];W=Z==="fillOutlinePattern"&&T?Gi(Re,y,R,pe,Qe):ui(Re,Qe)}else J=xe.indexBuffer,ee=xe.segments,W=T?Ot(Re,y,R,pe):dt(Re);Le.draw(y.context,j,B,y.stencilModeForClipping(fe),S,Lr.disabled,W,rt,d.id,xe.layoutVertexBuffer,J,ee,d.paint,y.transform.zoom,Pe)}}function pa(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w="fill-extrusion-pattern",T=d.paint.get(w),R=T.constantOr(1),j=d.getCrossfadeParameters(),Z=d.paint.get("fill-extrusion-opacity"),W=T.constantOr(null);for(const J of _){const ee=a.getTile(J),ae=ee.getBucket(d);if(!ae)continue;const fe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(J),pe=ae.programConfigurations.get(d.id),xe=y.useProgram(R?"fillExtrusionPattern":"fillExtrusion",pe);R&&(y.context.activeTexture.set(q.TEXTURE0),ee.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),pe.updatePaintBuffers(j)),Ql(pe,w,W,ee,d);const Pe=y.translatePosMatrix(J.posMatrix,ee,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Le=d.paint.get("fill-extrusion-vertical-gradient"),rt=R?Ze(Pe,y,Le,Z,J,j,ee):Ne(Pe,y,Le,Z);xe.draw(H,H.gl.TRIANGLES,B,S,U,Lr.backCCW,rt,fe,d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,y.transform.zoom,pe,y.style.map.terrain&&ae.centroidVertexBuffer)}}function Ps(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w=d.fbo;if(!w)return;const T=y.useProgram("hillshade"),R=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,w.colorAttachment.get()),T.draw(H,q.TRIANGLES,B,S,U,Lr.disabled,((j,Z,W,J)=>{const ee=W.paint.get("hillshade-shadow-color"),ae=W.paint.get("hillshade-highlight-color"),fe=W.paint.get("hillshade-accent-color");let pe=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(pe-=j.transform.angle);const xe=!j.options.moving;return{u_matrix:J?J.posMatrix:j.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),xe),u_image:0,u_latrange:iu(0,Z.tileID),u_light:[W.paint.get("hillshade-exaggeration"),pe],u_shadow:ee,u_highlight:ae,u_accent:fe}})(y,d,_,R?a:null),R,_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function al(y,a,d,_,B,S){const U=y.context,H=U.gl,q=a.dem;if(q&&q.data){const w=q.dim,T=q.stride,R=q.getPixels();if(U.activeTexture.set(H.TEXTURE1),U.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(T),a.demTexture){const Z=a.demTexture;Z.update(R,{premultiply:!1}),Z.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else a.demTexture=new Fe(U,R,H.RGBA,{premultiply:!1}),a.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);U.activeTexture.set(H.TEXTURE0);let j=a.fbo;if(!j){const Z=new Fe(U,{width:w,height:w,data:null},H.RGBA);Z.bind(H.LINEAR,H.CLAMP_TO_EDGE),j=a.fbo=U.createFramebuffer(w,w,!0,!1),j.colorAttachment.set(Z.texture)}U.bindFramebuffer.set(j.framebuffer),U.viewport.set([0,0,w,w]),y.useProgram("hillshadePrepare").draw(U,H.TRIANGLES,_,B,S,Lr.disabled,((Z,W)=>{const J=W.stride,ee=s.F();return s.aN(ee,0,s.W,-s.W,0,0,1),s.H(ee,ee,[0,-s.W,0]),{u_matrix:ee,u_image:1,u_dimension:[J,J],u_zoom:Z.overscaledZ,u_unpack:W.getUnpackVector()}})(a.tileID,q),null,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function Vl(y,a,d,_,B,S){const U=_.paint.get("raster-fade-duration");if(!S&&U>0){const H=F.now(),q=(H-y.timeAdded)/U,w=a?(H-a.timeAdded)/U:-1,T=d.getSource(),R=B.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),j=!a||Math.abs(a.tileID.overscaledZ-R)>Math.abs(y.tileID.overscaledZ-R),Z=j&&y.refreshedUponExpiration?1:s.ac(j?q:1-w,0,1);return y.refreshedUponExpiration&&q>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const Ia=new s.aO(1,0,0,1),La=new s.aO(0,1,0,1),Fs=new s.aO(0,0,1,1),Lu=new s.aO(1,0,1,1),Sn=new s.aO(0,1,1,1);function on(y,a,d,_){Yn(y,0,a+d/2,y.transform.width,d,_)}function fn(y,a,d,_){Yn(y,a-d/2,0,d,y.transform.height,_)}function Yn(y,a,d,_,B,S){const U=y.context,H=U.gl;H.enable(H.SCISSOR_TEST),H.scissor(a*y.pixelRatio,d*y.pixelRatio,_*y.pixelRatio,B*y.pixelRatio),U.clear({color:S}),H.disable(H.SCISSOR_TEST)}function ll(y,a,d){const _=y.context,B=_.gl,S=d.posMatrix,U=y.useProgram("debug"),H=nr.disabled,q=Br.disabled,w=y.colorModeForRenderPass(),T="$debug",R=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);_.activeTexture.set(B.TEXTURE0);const j=a.getTileByID(d.key).latestRawTileData,Z=Math.floor((j&&j.byteLength||0)/1024),W=a.getTile(d).tileSize,J=512/Math.min(W,512)*(d.overscaledZ/y.transform.zoom)*.5;let ee=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ee+=` => ${d.overscaledZ}`),function(ae,fe){ae.initDebugOverlayCanvas();const pe=ae.debugOverlayCanvas,xe=ae.context.gl,Pe=ae.debugOverlayCanvas.getContext("2d");Pe.clearRect(0,0,pe.width,pe.height),Pe.shadowColor="white",Pe.shadowBlur=2,Pe.lineWidth=1.5,Pe.strokeStyle="white",Pe.textBaseline="top",Pe.font="bold 36px Open Sans, sans-serif",Pe.fillText(fe,5,5),Pe.strokeText(fe,5,5),ae.debugOverlayTexture.update(pe),ae.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(y,`${ee} ${Z}kB`),U.draw(_,B.TRIANGLES,H,q,ki.alphaBlended,Lr.disabled,kn(S,s.aO.transparent,J),null,T,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),U.draw(_,B.LINE_STRIP,H,q,w,Lr.disabled,kn(S,s.aO.red),R,T,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function cl(y,a,d){const _=y.context,B=_.gl,S=y.colorModeForRenderPass(),U=new nr(B.LEQUAL,nr.ReadWrite,y.depthRangeFor3D),H=y.useProgram("terrain"),q=a.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,y.width,y.height]);for(const w of d){const T=y.renderToTexture.getTexture(w),R=a.getTerrainData(w.tileID);_.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,T.texture);const j={u_matrix:y.transform.calculatePosMatrix(w.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(y.transform.zoom)};H.draw(_,B.TRIANGLES,U,Br.disabled,S,Lr.backCCW,j,R,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}}class fo{constructor(a,d){this.context=new jr(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.F(),renderTime:0},this.setup(),this.numSublayers=Zi.maxUnderzooming+Zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ws}resize(a,d,_){if(this.width=Math.floor(a*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style._order)this.style._layers[B].resize()}setup(){const a=this.context,d=new s.aV;d.emplaceBack(0,0),d.emplaceBack(s.W,0),d.emplaceBack(0,s.W),d.emplaceBack(s.W,s.W),this.tileExtentBuffer=a.createVertexBuffer(d,Or.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const _=new s.aV;_.emplaceBack(0,0),_.emplaceBack(s.W,0),_.emplaceBack(0,s.W),_.emplaceBack(s.W,s.W),this.debugBuffer=a.createVertexBuffer(_,Or.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const B=new s.Z;B.emplaceBack(0,0,0,0),B.emplaceBack(s.W,0,s.W,0),B.emplaceBack(0,s.W,0,s.W),B.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=a.createVertexBuffer(B,jt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const S=new s.aV;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,Or.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const U=new s.aW;U.emplaceBack(0),U.emplaceBack(1),U.emplaceBack(3),U.emplaceBack(2),U.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(U);const H=new s.aX;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(H);const q=this.context.gl;this.stencilClearMode=new Br({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.F();s.aN(_,0,this.width,this.height,0,0,1),s.J(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,nr.disabled,this.stencilClearMode,ki.disabled,Lr.disabled,is(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const _=this.context,B=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(ki.disabled),_.setDepthMode(nr.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of d){const H=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U);S.draw(_,B.TRIANGLES,nr.disabled,new Br({func:B.ALWAYS,mask:0},H,255,B.KEEP,B.KEEP,B.REPLACE),ki.disabled,Lr.disabled,is(U.posMatrix),q,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Br({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new Br({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((U,H)=>H.overscaledZ-U.overscaledZ),B=_[_.length-1].overscaledZ,S=_[0].overscaledZ-B+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const U={};for(let H=0;H<S;H++)U[H+B]=new Br({func:d.GEQUAL,mask:255},H+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=S,[U,_]}return[{[B]:Br.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new ki([a.CONSTANT_COLOR,a.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ki.unblended:ki.alphaBlended}depthModeForSublayer(a,d,_){if(!this.opaquePassEnabledForLayer())return nr.disabled;const B=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new nr(_||this.context.gl.LEQUAL,d,[B,B])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const _=this.style._order,B=this.style.sourceCaches,S={},U={},H={};for(const q in B){const w=B[q];w.used&&w.prepare(this.context),S[q]=w.getVisibleCoordinates(),U[q]=S[q].slice().reverse(),H[q]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<_.length;q++)if(this.style._layers[_[q]].is3D()){this.opaquePassCutoff=q;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const q=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||q.length)&&(s.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,T){const R=w.context,j=R.gl,Z=ki.unblended,W=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),J=T.getTerrainMesh(),ee=T.sourceCache.getRenderableTiles(),ae=w.useProgram("terrainDepth");R.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1});for(const fe of ee){const pe=T.getTerrainData(fe.tileID),xe={u_matrix:w.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(w.transform.zoom)};ae.draw(R,j.TRIANGLES,W,Br.disabled,Z,Lr.backCCW,xe,pe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,T){const R=w.context,j=R.gl,Z=ki.unblended,W=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),J=T.getTerrainMesh(),ee=T.getCoordsTexture(),ae=T.sourceCache.getRenderableTiles(),fe=w.useProgram("terrainCoords");R.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1}),T.coordsIndex=[];for(const pe of ae){const xe=T.getTerrainData(pe.tileID);R.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,ee.texture);const Pe={u_matrix:w.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(w.transform.zoom)};fe.draw(R,j.TRIANGLES,W,Br.disabled,Z,Lr.backCCW,Pe,xe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),T.coordsIndex.push(pe.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const q of _){const w=this.style._layers[q];if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const T=U[w.source];(w.type==="custom"||T.length)&&this.renderLayer(this,B[w.source],w,T)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[_[this.currentLayer]],w=B[q.source],T=S[q.source];this._renderTileClippingMasks(q,T),this.renderLayer(this,w,q,T)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const q=this.style._layers[_[this.currentLayer]],w=B[q.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(q))continue;const T=(q.type==="symbol"?H:U)[q.source];this._renderTileClippingMasks(q,S[q.source]),this.renderLayer(this,w,q,T)}if(this.options.showTileBoundaries){const q=function(w,T){let R=null;const j=Object.values(w._layers).flatMap(ee=>ee.source&&!ee.isHidden(T)?[w.sourceCaches[ee.source]]:[]),Z=j.filter(ee=>ee.getSource().type==="vector"),W=j.filter(ee=>ee.getSource().type!=="vector"),J=ee=>{(!R||R.getSource().maxzoom<ee.getSource().maxzoom)&&(R=ee)};return Z.forEach(ee=>J(ee)),R||W.forEach(ee=>J(ee)),R}(this.style,this.transform.zoom);q&&function(w,T,R){for(let j=0;j<R.length;j++)ll(w,T,R[j])}(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const w=q.transform.padding;on(q,q.transform.height-(w.top||0),3,Ia),on(q,w.bottom||0,3,La),fn(q,w.left||0,3,Fs),fn(q,q.transform.width-(w.right||0),3,Lu);const T=q.transform.centerPoint;(function(R,j,Z,W){Yn(R,j-1,Z-10,2,20,W),Yn(R,j-10,Z-1,20,2,W)})(q,T.x,q.transform.height-T.y,Sn)}(this),this.context.setDefault()}renderLayer(a,d,_,B){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(B||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(S,U,H,q,w){if(S.renderPass!=="translucent")return;const T=Br.disabled,R=S.colorModeForRenderPass();(H._unevaluatedLayout.hasValue("text-variable-anchor")||H._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,Z,W,J,ee,ae,fe){const pe=Z.transform,xe=ee==="map",Pe=ae==="map";for(const Le of j){const rt=J.getTile(Le),Ke=rt.getBucket(W);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const Re=s.ag(Ke.textSizeData,pe.zoom),Qe=qt(rt,1,Z.transform.zoom),pt=Jt(Le.posMatrix,Pe,xe,Z.transform,Qe),bt=W.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(Re){const ht=Math.pow(2,pe.zoom-rt.tileID.overscaledZ);Ta(Ke,xe,Pe,fe,pe,pt,Le.posMatrix,ht,Re,bt,Z.style.map.terrain?(Rt,Dt)=>Z.style.map.terrain.getElevation(Le,Rt,Dt):null)}}}(q,S,H,U,H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),w),H.paint.get("icon-opacity").constantOr(1)!==0&&zl(S,U,H,q,!1,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),H.layout.get("icon-rotation-alignment"),H.layout.get("icon-pitch-alignment"),H.layout.get("icon-keep-upright"),T,R),H.paint.get("text-opacity").constantOr(1)!==0&&zl(S,U,H,q,!0,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),H.layout.get("text-keep-upright"),T,R),U.map.showCollisionBoxes&&(qs(S,U,H,q,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),!0),qs(S,U,H,q,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),!1))})(a,d,_,B,this.style.placement.variableOffsets);break;case"circle":(function(S,U,H,q){if(S.renderPass!=="translucent")return;const w=H.paint.get("circle-opacity"),T=H.paint.get("circle-stroke-width"),R=H.paint.get("circle-stroke-opacity"),j=!H.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(T.constantOr(1)===0||R.constantOr(1)===0))return;const Z=S.context,W=Z.gl,J=S.depthModeForSublayer(0,nr.ReadOnly),ee=Br.disabled,ae=S.colorModeForRenderPass(),fe=[];for(let pe=0;pe<q.length;pe++){const xe=q[pe],Pe=U.getTile(xe),Le=Pe.getBucket(H);if(!Le)continue;const rt=Le.programConfigurations.get(H.id),Ke=S.useProgram("circle",rt),Re=Le.layoutVertexBuffer,Qe=Le.indexBuffer,pt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(xe),bt={programConfiguration:rt,program:Ke,layoutVertexBuffer:Re,indexBuffer:Qe,uniformValues:br(S,xe,Pe,H),terrainData:pt};if(j){const ht=Le.segments.get();for(const Rt of ht)fe.push({segments:new s.$([Rt]),sortKey:Rt.sortKey,state:bt})}else fe.push({segments:Le.segments,sortKey:0,state:bt})}j&&fe.sort((pe,xe)=>pe.sortKey-xe.sortKey);for(const pe of fe){const{programConfiguration:xe,program:Pe,layoutVertexBuffer:Le,indexBuffer:rt,uniformValues:Ke,terrainData:Re}=pe.state;Pe.draw(Z,W.TRIANGLES,J,ee,ae,Lr.disabled,Ke,Re,H.id,Le,rt,pe.segments,H.paint,S.transform.zoom,xe)}})(a,d,_,B);break;case"heatmap":(function(S,U,H,q){if(H.paint.get("heatmap-opacity")!==0)if(S.renderPass==="offscreen"){const w=S.context,T=w.gl,R=Br.disabled,j=new ki([T.ONE,T.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(Z,W,J){const ee=Z.gl;Z.activeTexture.set(ee.TEXTURE1),Z.viewport.set([0,0,W.width/4,W.height/4]);let ae=J.heatmapFbo;if(ae)ee.bindTexture(ee.TEXTURE_2D,ae.colorAttachment.get()),Z.bindFramebuffer.set(ae.framebuffer);else{const fe=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,fe),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),ae=J.heatmapFbo=Z.createFramebuffer(W.width/4,W.height/4,!1,!1),function(pe,xe,Pe,Le){var rt,Ke;const Re=pe.gl,Qe=(rt=pe.HALF_FLOAT)!==null&&rt!==void 0?rt:Re.UNSIGNED_BYTE,pt=(Ke=pe.RGBA16F)!==null&&Ke!==void 0?Ke:Re.RGBA;Re.texImage2D(Re.TEXTURE_2D,0,pt,xe.width/4,xe.height/4,0,Re.RGBA,Qe,null),Le.colorAttachment.set(Pe)}(Z,W,fe,ae)}})(w,S,H),w.clear({color:s.aO.transparent});for(let Z=0;Z<q.length;Z++){const W=q[Z];if(U.hasRenderableParent(W))continue;const J=U.getTile(W),ee=J.getBucket(H);if(!ee)continue;const ae=ee.programConfigurations.get(H.id),fe=S.useProgram("heatmap",ae),{zoom:pe}=S.transform;fe.draw(w,T.TRIANGLES,nr.disabled,R,j,Lr.disabled,wn(W.posMatrix,J,pe,H.paint.get("heatmap-intensity")),null,H.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,H.paint,S.transform.zoom,ae)}w.viewport.set([0,0,S.width,S.height])}else S.renderPass==="translucent"&&(S.context.setColorMode(S.colorModeForRenderPass()),function(w,T){const R=w.context,j=R.gl,Z=T.heatmapFbo;if(!Z)return;R.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,Z.colorAttachment.get()),R.activeTexture.set(j.TEXTURE1);let W=T.colorRampTexture;W||(W=T.colorRampTexture=new Fe(R,T.colorRamp,j.RGBA)),W.bind(j.LINEAR,j.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(R,j.TRIANGLES,nr.disabled,Br.disabled,w.colorModeForRenderPass(),Lr.disabled,((J,ee,ae,fe)=>{const pe=s.F();s.aN(pe,0,J.width,J.height,0,0,1);const xe=J.context.gl;return{u_matrix:pe,u_world:[xe.drawingBufferWidth,xe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}})(w,T),null,T.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,T.paint,w.transform.zoom)}(S,H))})(a,d,_,B);break;case"line":(function(S,U,H,q){if(S.renderPass!=="translucent")return;const w=H.paint.get("line-opacity"),T=H.paint.get("line-width");if(w.constantOr(1)===0||T.constantOr(1)===0)return;const R=S.depthModeForSublayer(0,nr.ReadOnly),j=S.colorModeForRenderPass(),Z=H.paint.get("line-dasharray"),W=H.paint.get("line-pattern"),J=W.constantOr(1),ee=H.paint.get("line-gradient"),ae=H.getCrossfadeParameters(),fe=J?"linePattern":Z?"lineSDF":ee?"lineGradient":"line",pe=S.context,xe=pe.gl;let Pe=!0;for(const Le of q){const rt=U.getTile(Le);if(J&&!rt.patternsLoaded())continue;const Ke=rt.getBucket(H);if(!Ke)continue;const Re=Ke.programConfigurations.get(H.id),Qe=S.context.program.get(),pt=S.useProgram(fe,Re),bt=Pe||pt.program!==Qe,ht=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Le),Rt=W.constantOr(null);if(Rt&&rt.imageAtlas){const Vt=rt.imageAtlas,_i=Vt.patternPositions[Rt.to.toString()],Si=Vt.patternPositions[Rt.from.toString()];_i&&Si&&Re.setConstantPatternPositions(_i,Si)}const Dt=ht?Le:null,hi=J?Ha(S,rt,H,ae,Dt):Z?Dl(S,rt,H,Z,ae,Dt):ee?Tr(S,rt,H,Ke.lineClipsArray.length,Dt):Va(S,rt,H,Dt);if(J)pe.activeTexture.set(xe.TEXTURE0),rt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Re.updatePaintBuffers(ae);else if(Z&&(bt||S.lineAtlas.dirty))pe.activeTexture.set(xe.TEXTURE0),S.lineAtlas.bind(pe);else if(ee){const Vt=Ke.gradients[H.id];let _i=Vt.texture;if(H.gradientVersion!==Vt.version){let Si=256;if(H.stepInterpolant){const Yi=U.getSource().maxzoom,Ti=Le.canonical.z===Yi?Math.ceil(1<<S.transform.maxZoom-Le.canonical.z):1;Si=s.ac(s.aT(Ke.maxLineLength/s.W*1024*Ti),256,pe.maxTextureSize)}Vt.gradient=s.aU({expression:H.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:Vt.gradient||void 0,clips:Ke.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new Fe(pe,Vt.gradient,xe.RGBA),Vt.version=H.gradientVersion,_i=Vt.texture}pe.activeTexture.set(xe.TEXTURE0),_i.bind(H.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}pt.draw(pe,xe.TRIANGLES,R,S.stencilModeForClipping(Le),j,Lr.disabled,hi,ht,H.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,H.paint,S.transform.zoom,Re,Ke.layoutVertexBuffer2),Pe=!1}})(a,d,_,B);break;case"fill":(function(S,U,H,q){const w=H.paint.get("fill-color"),T=H.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const R=S.colorModeForRenderPass(),j=H.paint.get("fill-pattern"),Z=S.opaquePassEnabledForLayer()&&!j.constantOr(1)&&w.constantOr(s.aO.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===Z){const W=S.depthModeForSublayer(1,S.renderPass==="opaque"?nr.ReadWrite:nr.ReadOnly);hc(S,U,H,q,W,R,!1)}if(S.renderPass==="translucent"&&H.paint.get("fill-antialias")){const W=S.depthModeForSublayer(H.getPaintProperty("fill-outline-color")?2:0,nr.ReadOnly);hc(S,U,H,q,W,R,!0)}})(a,d,_,B);break;case"fill-extrusion":(function(S,U,H,q){const w=H.paint.get("fill-extrusion-opacity");if(w!==0&&S.renderPass==="translucent"){const T=new nr(S.context.gl.LEQUAL,nr.ReadWrite,S.depthRangeFor3D);if(w!==1||H.paint.get("fill-extrusion-pattern").constantOr(1))pa(S,U,H,q,T,Br.disabled,ki.disabled),pa(S,U,H,q,T,S.stencilModeFor3D(),S.colorModeForRenderPass());else{const R=S.colorModeForRenderPass();pa(S,U,H,q,T,Br.disabled,R)}}})(a,d,_,B);break;case"hillshade":(function(S,U,H,q){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const w=S.context,T=S.depthModeForSublayer(0,nr.ReadOnly),R=S.colorModeForRenderPass(),[j,Z]=S.renderPass==="translucent"?S.stencilConfigForOverlap(q):[{},q];for(const W of Z){const J=U.getTile(W);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&S.renderPass==="offscreen"?al(S,J,H,T,Br.disabled,R):S.renderPass==="translucent"&&Ps(S,W,J,H,T,j[W.overscaledZ],R)}w.viewport.set([0,0,S.width,S.height])})(a,d,_,B);break;case"raster":(function(S,U,H,q){if(S.renderPass!=="translucent"||H.paint.get("raster-opacity")===0||!q.length)return;const w=S.context,T=w.gl,R=U.getSource(),j=S.useProgram("raster"),Z=S.colorModeForRenderPass(),[W,J]=R instanceof ni?[{},q]:S.stencilConfigForOverlap(q),ee=J[J.length-1].overscaledZ,ae=!S.options.moving;for(const fe of J){const pe=S.depthModeForSublayer(fe.overscaledZ-ee,H.paint.get("raster-opacity")===1?nr.ReadWrite:nr.ReadOnly,T.LESS),xe=U.getTile(fe);xe.registerFadeDuration(H.paint.get("raster-fade-duration"));const Pe=U.findLoadedParent(fe,0),Le=Vl(xe,Pe,U,H,S.transform,S.style.map.terrain);let rt,Ke;const Re=H.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;w.activeTexture.set(T.TEXTURE0),xe.texture.bind(Re,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(T.TEXTURE1),Pe?(Pe.texture.bind(Re,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),rt=Math.pow(2,Pe.tileID.overscaledZ-xe.tileID.overscaledZ),Ke=[xe.tileID.canonical.x*rt%1,xe.tileID.canonical.y*rt%1]):xe.texture.bind(Re,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);const Qe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(fe),pt=Qe?fe:null,bt=pt?pt.posMatrix:S.transform.calculatePosMatrix(fe.toUnwrapped(),ae),ht=Ga(bt,Ke||[0,0],rt||1,Le,H);R instanceof ni?j.draw(w,T.TRIANGLES,pe,Br.disabled,Z,Lr.disabled,ht,Qe,H.id,R.boundsBuffer,S.quadTriangleIndexBuffer,R.boundsSegments):j.draw(w,T.TRIANGLES,pe,W[fe.overscaledZ],Z,Lr.disabled,ht,Qe,H.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}})(a,d,_,B);break;case"background":(function(S,U,H,q){const w=H.paint.get("background-color"),T=H.paint.get("background-opacity");if(T===0)return;const R=S.context,j=R.gl,Z=S.transform,W=Z.tileSize,J=H.paint.get("background-pattern");if(S.isPatternMissing(J))return;const ee=!J&&w.a===1&&T===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==ee)return;const ae=Br.disabled,fe=S.depthModeForSublayer(0,ee==="opaque"?nr.ReadWrite:nr.ReadOnly),pe=S.colorModeForRenderPass(),xe=S.useProgram(J?"backgroundPattern":"background"),Pe=q||Z.coveringTiles({tileSize:W,terrain:S.style.map.terrain});J&&(R.activeTexture.set(j.TEXTURE0),S.imageManager.bind(S.context));const Le=H.getCrossfadeParameters();for(const rt of Pe){const Ke=q?rt.posMatrix:S.transform.calculatePosMatrix(rt.toUnwrapped()),Re=J?qa(Ke,T,S,J,{tileID:rt,tileSize:W},Le):Ic(Ke,T,w),Qe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(rt);xe.draw(R,j.TRIANGLES,fe,ae,pe,Lr.disabled,Re,Qe,H.id,S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}})(a,0,_,B);break;case"custom":(function(S,U,H){const q=S.context,w=H.implementation;if(S.renderPass==="offscreen"){const T=w.prerender;T&&(S.setCustomLayerDefaults(),q.setColorMode(S.colorModeForRenderPass()),T.call(w,q.gl,S.transform.customLayerMatrix()),q.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),q.setColorMode(S.colorModeForRenderPass()),q.setStencilMode(Br.disabled);const T=w.renderingMode==="3d"?new nr(S.context.gl.LEQUAL,nr.ReadWrite,S.depthRangeFor3D):S.depthModeForSublayer(0,nr.ReadOnly);q.setDepthMode(T),w.render(q.gl,S.transform.customLayerMatrix()),q.setDirty(),S.setBaseState(),q.bindFramebuffer.set(null)}})(a,0,_)}}translatePosMatrix(a,d,_,B,S){if(!_[0]&&!_[1])return a;const U=S?B==="map"?this.transform.angle:0:B==="viewport"?-this.transform.angle:0;if(U){const w=Math.sin(U),T=Math.cos(U);_=[_[0]*T-_[1]*w,_[0]*w+_[1]*T]}const H=[S?_[0]:qt(d,_[0],this.transform.zoom),S?_[1]:qt(d,_[1],this.transform.zoom),0],q=new Float32Array(16);return s.H(q,a,H),q}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!d||!_}useProgram(a,d){this.cache=this.cache||{};const _=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new uo(this.context,An[a],d,ho[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class ns{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,_){const B=Math.pow(2,_),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{const q=1/(H=s.af([],H,a))[3]/d*B;return s.a_(H,H,[q,q,1/H[3],q])}),U=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{const q=function(j,Z){var W=Z[0],J=Z[1],ee=Z[2],ae=W*W+J*J+ee*ee;return ae>0&&(ae=1/Math.sqrt(ae)),j[0]=Z[0]*ae,j[1]=Z[1]*ae,j[2]=Z[2]*ae,j}([],function(j,Z,W){var J=Z[0],ee=Z[1],ae=Z[2],fe=W[0],pe=W[1],xe=W[2];return j[0]=ee*xe-ae*pe,j[1]=ae*fe-J*xe,j[2]=J*pe-ee*fe,j}([],lt([],S[H[0]],S[H[1]]),lt([],S[H[2]],S[H[1]]))),w=-((T=q)[0]*(R=S[H[1]])[0]+T[1]*R[1]+T[2]*R[2]);var T,R;return q.concat(w)});return new ns(S,U)}}class ss{constructor(a,d){this.min=a,this.max=d,this.center=function(_,B,S){return _[0]=.5*B[0],_[1]=.5*B[1],_[2]=.5*B[2],_}([],function(_,B,S){return _[0]=B[0]+S[0],_[1]=B[1]+S[1],_[2]=B[2]+S[2],_}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],_=$e(this.min),B=$e(this.max);for(let S=0;S<d.length;S++)_[S]=d[S]?this.min[S]:this.center[S],B[S]=d[S]?this.center[S]:this.max[S];return B[2]=this.max[2],new ss(_,B)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let B=0;B<a.planes.length;B++){const S=a.planes[B];let U=0;for(let H=0;H<d.length;H++)s.a$(S,d[H])>=0&&U++;if(U===0)return 0;U!==d.length&&(_=!1)}if(_)return 2;for(let B=0;B<3;B++){let S=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let H=0;H<a.points.length;H++){const q=a.points[H][B]-this.min[B];S=Math.min(S,q),U=Math.max(U,q)}if(U<0||S>this.max[B]-this.min[B])return 0}return 1}}class Mo{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(B)||B<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=B}interpolate(a,d,_){return d.top!=null&&a.top!=null&&(this.top=s.z.number(a.top,d.top,_)),d.bottom!=null&&a.bottom!=null&&(this.bottom=s.z.number(a.bottom,d.bottom,_)),d.left!=null&&a.left!=null&&(this.left=s.z.number(a.left,d.left,_)),d.right!=null&&a.right!=null&&(this.right=s.z.number(a.right,d.right,_)),this}getCenter(a,d){const _=s.ac((this.left+a-this.right)/2,0,a),B=s.ac((this.top+d-this.bottom)/2,0,d);return new s.P(_,B)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Mo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Po{constructor(a,d,_,B,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||!!S,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=B??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Mo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new Po(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-s.b0(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var _=new s.A(4);return s.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,B,S){var U=B[0],H=B[1],q=B[2],w=B[3],T=Math.sin(S),R=Math.cos(S);_[0]=U*R+q*T,_[1]=H*R+w*T,_[2]=U*-T+q*R,_[3]=H*-T+w*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=s.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new s.b1(0,a)];if(this._renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),B=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),U=this.pointCoordinate(new s.P(0,this.height)),H=Math.floor(Math.min(_.x,B.x,S.x,U.x)),q=Math.floor(Math.max(_.x,B.x,S.x,U.x)),w=1;for(let T=H-w;T<=q+w;T++)T!==0&&d.push(new s.b1(T,a))}return d}coveringTiles(a){var d,_;let B=this.coveringZoomLevel(a);const S=B;if(a.minzoom!==void 0&&B<a.minzoom)return[];a.maxzoom!==void 0&&B>a.maxzoom&&(B=a.maxzoom);const U=this.pointCoordinate(this.getCameraPoint()),H=s.Y.fromLngLat(this.center),q=Math.pow(2,B),w=[q*U.x,q*U.y,0],T=[q*H.x,q*H.y,0],R=ns.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,B);let j=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=B);const Z=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,W=pe=>({aabb:new ss([pe*q,0,0],[(pe+1)*q,q,0]),zoom:0,x:0,y:0,wrap:pe,fullyVisible:!1}),J=[],ee=[],ae=B,fe=a.reparseOverscaled?S:B;if(this._renderWorldCopies)for(let pe=1;pe<=3;pe++)J.push(W(-pe)),J.push(W(pe));for(J.push(W(0));J.length>0;){const pe=J.pop(),xe=pe.x,Pe=pe.y;let Le=pe.fullyVisible;if(!Le){const pt=pe.aabb.intersects(R);if(pt===0)continue;Le=pt===2}const rt=a.terrain?w:T,Ke=pe.aabb.distanceX(rt),Re=pe.aabb.distanceY(rt),Qe=Math.max(Math.abs(Ke),Math.abs(Re));if(pe.zoom===ae||Qe>Z+(1<<ae-pe.zoom)-2&&pe.zoom>=j){const pt=ae-pe.zoom,bt=w[0]-.5-(xe<<pt),ht=w[1]-.5-(Pe<<pt);ee.push({tileID:new s.Q(pe.zoom===ae?fe:pe.zoom,pe.wrap,pe.zoom,xe,Pe),distanceSq:nt([T[0]-.5-xe,T[1]-.5-Pe]),tileDistanceToCamera:Math.sqrt(bt*bt+ht*ht)})}else for(let pt=0;pt<4;pt++){const bt=(xe<<1)+pt%2,ht=(Pe<<1)+(pt>>1),Rt=pe.zoom+1;let Dt=pe.aabb.quadrant(pt);if(a.terrain){const hi=new s.Q(Rt,pe.wrap,Rt,bt,ht),Vt=a.terrain.getMinMaxElevation(hi),_i=(d=Vt.minElevation)!==null&&d!==void 0?d:this.elevation,Si=(_=Vt.maxElevation)!==null&&_!==void 0?_:this.elevation;Dt=new ss([Dt.min[0],Dt.min[1],_i],[Dt.max[0],Dt.max[1],Si])}J.push({aabb:Dt,zoom:Rt,x:bt,y:ht,wrap:pe.wrap,fullyVisible:Le})}}return ee.sort((pe,xe)=>pe.distanceSq-xe.distanceSq).map(pe=>pe.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=s.ac(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.N(a.lng)*this.worldSize,s.O(d)*this.worldSize)}unproject(a){return new s.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.pointLocation(this.centerPoint,a),_=a.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-_))return;const B=this.getCameraPosition(),S=s.Y.fromLngLat(B.lngLat,B.altitude),U=s.Y.fromLngLat(d,_),H=S.x-U.x,q=S.y-U.y,w=S.z-U.z,T=Math.sqrt(H*H+q*q+w*w),R=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=_,this._center=d,this.zoom=R}setLocationAtPoint(a,d){const _=this.pointCoordinate(d),B=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(a),U=new s.Y(S.x-(_.x-B.x),S.y-(_.y-B.y));this.center=this.coordinateLocation(U),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return s.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const j=d.pointCoordinate(a);if(j!=null)return j}const _=[a.x,a.y,0,1],B=[a.x,a.y,1,1];s.af(_,_,this.pixelMatrixInverse),s.af(B,B,this.pixelMatrixInverse);const S=_[3],U=B[3],H=_[1]/S,q=B[1]/U,w=_[2]/S,T=B[2]/U,R=w===T?0:(0-w)/(T-w);return new s.Y(s.z.number(_[0]/S,B[0]/U,R)/this.worldSize,s.z.number(H,q,R)/this.worldSize)}coordinatePoint(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const B=[a.x*this.worldSize,a.y*this.worldSize,d,1];return s.af(B,B,_),new s.P(B[0]/B[3],B[1]/B[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new s.P(0,a))).extend(this.pointLocation(new s.P(this.width,a))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=a.key,B=d?this._alignedPosMatrixCache:this._posMatrixCache;if(B[_])return B[_];const S=a.canonical,U=this.worldSize/this.zoomScale(S.z),H=S.x+Math.pow(2,S.z)*a.wrap,q=s.an(new Float64Array(16));return s.H(q,q,[H*U,S.y*U,0]),s.J(q,q,[U/s.W,U/s.W,1]),s.K(q,d?this.alignedProjMatrix:this.projMatrix,q),B[_]=new Float32Array(q),B[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a,d,_,B,S=-90,U=90,H=-180,q=180;const w=this.size,T=this._unmodified;if(this.latRange){const Z=this.latRange;S=s.O(Z[1])*this.worldSize,U=s.O(Z[0])*this.worldSize,a=U-S<w.y?w.y/(U-S):0}if(this.lngRange){const Z=this.lngRange;H=s.b0(s.N(Z[0])*this.worldSize,0,this.worldSize),q=s.b0(s.N(Z[1])*this.worldSize,0,this.worldSize),q<H&&(q+=this.worldSize),d=q-H<w.x?w.x/(q-H):0}const R=this.point,j=Math.max(d||0,a||0);if(j)return this.center=this.unproject(new s.P(d?(q+H)/2:R.x,a?(U+S)/2:R.y)),this.zoom+=this.scaleZoom(j),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const Z=R.y,W=w.y/2;Z-W<S&&(B=S+W),Z+W>U&&(B=U-W)}if(this.lngRange){const Z=(H+q)/2,W=s.b0(R.x,Z-this.worldSize/2,Z+this.worldSize/2),J=w.x/2;W-J<H&&(_=H+J),W+J>q&&(_=q-J)}_===void 0&&B===void 0||(this.center=this.unproject(new s.P(_!==void 0?_:R.x,B!==void 0?B:R.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b2(1,this.center.lat)*this.worldSize;let B=s.an(new Float64Array(16));s.J(B,B,[this.width/2,-this.height/2,1]),s.H(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.an(new Float64Array(16)),s.J(B,B,[1,-1,1]),s.H(B,B,[-1,-1,0]),s.J(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B;const S=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),U=Math.min(this.elevation,this.minElevationForCurrentTile),H=S-U*this._pixelPerMeter/Math.cos(this._pitch),q=U<0?H:S,w=Math.PI/2+this._pitch,T=this._fov*(.5+a.y/this.height),R=Math.sin(T)*q/Math.sin(s.ac(Math.PI-w-T,.01,Math.PI-.01)),j=this.getHorizon(),Z=2*Math.atan(j/this.cameraToCenterDistance)*(.5+a.y/(2*j)),W=Math.sin(Z)*q/Math.sin(s.ac(Math.PI-w-Z,.01,Math.PI-.01)),J=Math.min(R,W),ee=1.01*(Math.cos(Math.PI/2-this._pitch)*J+q),ae=this.height/50;B=new Float64Array(16),s.b3(B,this._fov,this.width/this.height,ae,ee),B[8]=2*-a.x/this.width,B[9]=2*a.y/this.height,s.J(B,B,[1,-1,1]),s.H(B,B,[0,0,-this.cameraToCenterDistance]),s.b4(B,B,this._pitch),s.ad(B,B,this.angle),s.H(B,B,[-d,-_,0]),this.mercatorMatrix=s.J([],B,[this.worldSize,this.worldSize,this.worldSize]),s.J(B,B,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,B),s.H(B,B,[0,0,-this.elevation]),this.projMatrix=B,this.invProjMatrix=s.ar([],B),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,B);const fe=this.width%2/2,pe=this.height%2/2,xe=Math.cos(this.angle),Pe=Math.sin(this.angle),Le=d-Math.round(d)+xe*fe+Pe*pe,rt=_-Math.round(_)+xe*pe+Pe*fe,Ke=new Float64Array(B);if(s.H(Ke,Ke,[Le>.5?Le-1:Le,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=Ke,B=s.ar(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");this.pixelMatrixInverse=B,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new s.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return s.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let _=d.x,B=d.y,S=d.x,U=d.y;for(const H of a)_=Math.min(_,H.x),B=Math.min(B,H.y),S=Math.max(S,H.x),U=Math.max(U,H.y);return[new s.P(_,B),new s.P(S,B),new s.P(S,U),new s.P(_,U),new s.P(_,B)]}}lngLatToCameraDepth(a,d){const _=this.locationCoordinate(a),B=[_.x*this.worldSize,_.y*this.worldSize,d,1];return s.af(B,B,this.projMatrix),B[2]/B[3]}}function ga(y,a){var d=this;let _,B=!1,S=null,U=null;const H=()=>{S=null,B&&(y.apply(U,_),S=setTimeout(H,a),B=!1)};return function(){for(var q=arguments.length,w=new Array(q),T=0;T<q;T++)w[T]=arguments[T];return B=!0,U=d,_=w,S||H(),S}}class ul{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(_=B)}),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=ga(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,B=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,B),U=Math.round(d.lng*S)/S,H=Math.round(d.lat*S)/S,q=this._map.getBearing(),w=this._map.getPitch();let T="";if(T+=a?`/${U}/${H}/${_}`:`${_}/${H}/${U}`,(q||w)&&(T+="/"+Math.round(10*q)/10),w&&(T+=`/${Math.round(w)}`),this._hashName){const R=this._hashName;let j=!1;const Z=window.location.hash.slice(1).split("&").map(W=>{const J=W.split("=")[0];return J===R?(j=!0,`${J}=${T}`):W}).filter(W=>W);return j||Z.push(`${R}=${T}`),`#${Z.join("&")}`}return`#${T}`}}const to={linearity:.3,easing:s.b5(0,0,.3,1)},io=s.e({deceleration:2500,maxSpeed:1400},to),po=s.e({deceleration:20,maxSpeed:1400},to),ms=s.e({deceleration:1e3,maxSpeed:360},to),ro=s.e({deceleration:1e3,maxSpeed:90},to);class Ma{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=F.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(d.pan.mag()){const S=Pa(d.pan.mag(),_,s.e({},io,a||{}));B.offset=d.pan.mult(S.amount/d.pan.mag()),B.center=this._map.transform.center,ma(B,S)}if(d.zoom){const S=Pa(d.zoom,_,po);B.zoom=this._map.transform.zoom+S.amount,ma(B,S)}if(d.bearing){const S=Pa(d.bearing,_,ms);B.bearing=this._map.transform.bearing+s.ac(S.amount,-179,179),ma(B,S)}if(d.pitch){const S=Pa(d.pitch,_,ro);B.pitch=this._map.transform.pitch+S.amount,ma(B,S)}if(B.zoom||B.bearing){const S=d.pinchAround===void 0?d.around:d.pinchAround;B.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),s.e(B,{noMoveStart:!0})}}function ma(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Pa(y,a,d){const{maxSpeed:_,linearity:B,deceleration:S}=d,U=s.ac(y*B/(a/1e3),-_,_),H=Math.abs(U)/(S*B);return{easing:d.easing,duration:1e3*H,amount:U*(H/2)}}class Tn extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const S=O.mousePos(d.getCanvas(),_),U=d.unproject(S);super(a,s.e({point:S,lngLat:U,originalEvent:_},B)),this._defaultPrevented=!1,this.target=d}}class Fo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const B=a==="touchend"?_.changedTouches:_.touches,S=O.touchPos(d.getCanvasContainer(),B),U=S.map(q=>d.unproject(q)),H=S.reduce((q,w,T,R)=>q.add(w.div(R.length)),new s.P(0,0));super(a,{points:S,point:H,lngLats:U,lngLat:d.unproject(H),originalEvent:_}),this._defaultPrevented=!1}}class hs extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class ys{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new hs(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new Tn(a.type,this._map,a))}mouseup(a){this._map.fire(new Tn(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Tn(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Tn(a.type,this._map,a))}mouseover(a){this._map.fire(new Tn(a.type,this._map,a))}mouseout(a){this._map.fire(new Tn(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Fo(a.type,this._map,a))}touchmove(a){this._map.fire(new Fo(a.type,this._map,a))}touchend(a){this._map.fire(new Fo(a.type,this._map,a))}touchcancel(a){this._map.fire(new Fo(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class As{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Tn(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Tn(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ir{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(s.P.convert(a),this._map.terrain)}}class Zr{constructor(a,d){this._map=a,this._tr=new Ir(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(O.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const B=this._startPos;this._lastPos=_,this._box||(this._box=O.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const S=Math.min(B.x,_.x),U=Math.max(B.x,_.x),H=Math.min(B.y,_.y),q=Math.max(B.y,_.y);O.setTransform(this._box,`translate(${S}px,${H}px)`),this._box.style.width=U-S+"px",this._box.style.height=q-H+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const _=this._startPos,B=d;if(this.reset(),O.suppressClick(),_.x!==B.x||_.y!==B.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:a})),{cameraAnimation:S=>S.fitScreenCoordinates(_,B,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(O.remove(this._box),this._box=null),O.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new s.k(a,{originalEvent:d}))}}function an(y,a){if(y.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${a.length}`);const d={};for(let _=0;_<y.length;_++)d[y[_].identifier]=a[_];return d}class Gn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(B){const S=new s.P(0,0);for(const U of B)S._add(U);return S.div(B.length)}(d),this.touches=an(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const B=an(_,d);for(const S in this.touches){const U=B[S];(!U||U.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const B=!this.aborted&&this.centroid;if(this.reset(),B)return B}}}class ya{constructor(a){this.singleTap=new Gn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const B=this.singleTap.touchend(a,d,_);if(B){const S=a.timeStamp-this.lastTime<500,U=!this.lastTap||this.lastTap.dist(B)<30;if(S&&U||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=B,this.count===this.numTaps)return this.reset(),B}}}class Fa{constructor(a){this._tr=new Ir(a),this._zoomIn=new ya({numTouches:1,numTaps:2}),this._zoomOut=new ya({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const B=this._zoomIn.touchend(a,d,_),S=this._zoomOut.touchend(a,d,_),U=this._tr;return B?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom+1,around:U.unproject(B)},{originalEvent:a})}):S?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom-1,around:U.unproject(S)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const B=d.length?d[0]:d;return!this._moved&&B.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=B,this._move(_,B))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&O.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zo={0:1,2:2};class Oi{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=O.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,_){const B=Zo[_];return d.buttons===void 0||(d.buttons&B)!==B}(a,this._eventButton)}isValidEndEvent(a){return O.mouseButton(a)===this._eventButton}}class Jo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const Pi=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(a){a.preventDefault()}},hl=y=>{let{enable:a,clickTolerance:d,bearingDegreesPerPixelMoved:_=.8}=y;const B=new Oi({checkCorrectEvent:S=>O.mouseButton(S)===0&&S.ctrlKey||O.mouseButton(S)===2});return new go({clickTolerance:d,move:(S,U)=>({bearingDelta:(U.x-S.x)*_}),moveStateManager:B,enable:a,assignEvents:Pi})},Hl=y=>{let{enable:a,clickTolerance:d,pitchDegreesPerPixelMoved:_=-.5}=y;const B=new Oi({checkCorrectEvent:S=>O.mouseButton(S)===0&&S.ctrlKey||O.mouseButton(S)===2});return new go({clickTolerance:d,move:(S,U)=>({pitchDelta:(U.y-S.y)*_}),moveStateManager:B,enable:a,assignEvents:Pi})};class Li{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,_)}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const B=an(_,d),S=new s.P(0,0),U=new s.P(0,0);let H=0;for(const w in B){const T=B[w],R=this._touches[w];R&&(S._add(T),U._add(T.sub(R)),H++,B[w]=T)}if(this._touches=B,H<this.minTouchs()||!U.mag())return;const q=U.div(H);return this._sum._add(q),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(H),panDelta:q}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){if(!this._firstTwoTouches)return;a.preventDefault();const[B,S]=this._firstTwoTouches,U=Ei(_,d,B),H=Ei(_,d,S);if(!U||!H)return;const q=this._aroundCenter?null:U.add(H).div(2);return this._move([U,H],q,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[B,S]=this._firstTwoTouches,U=Ei(_,d,B),H=Ei(_,d,S);U&&H||(this._active&&O.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ei(y,a,d){for(let _=0;_<y.length;_++)if(y[_].identifier===d)return a[_]}function no(y,a){return Math.log(y/a)/Math.LN2}class mo extends Gl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(no(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:no(this._distance,_),pinchAround:d}}}function Mc(y,a){return 180*y.angleWith(a)/Math.PI}class jl extends Gl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,_){const B=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mc(this._vector,B),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=Mc(a,this._startVector);return Math.abs(_)<d}}function Pc(y){return Math.abs(y.y)>Math.abs(y.x)}class Fc extends Gl{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,_){super.touchstart(a,d,_),this._currentTouchCount=_.length}_start(a){this._lastPoints=a,Pc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const B=a[0].sub(this._lastPoints[0]),S=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(B,S,_.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(B.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,_){if(this._valid!==void 0)return this._valid;const B=a.mag()>=2,S=d.mag()>=2;if(!B&&!S)return;if(!B||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const U=a.y>0==d.y>0;return Pc(a)&&Pc(d)&&U}}const Dc={panStep:100,bearingStep:15,pitchStep:10};class Rc{constructor(a){this._tr=new Ir(a);const d=Dc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,B=0,S=0,U=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),S=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),S=1);break;case 38:a.shiftKey?B=1:(a.preventDefault(),U=-1);break;case 40:a.shiftKey?B=-1:(a.preventDefault(),U=1);break;default:return}return this._rotationDisabled&&(_=0,B=0),{cameraAnimation:H=>{const q=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:Za,zoom:d?Math.round(q.zoom)+d*(a.shiftKey?2:1):q.zoom,bearing:q.bearing+_*this._bearingStep,pitch:q.pitch+B*this._pitchStep,offset:[-S*this._panStep,-U*this._panStep],center:q.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Za(y){return y*(2-y)}const yn=4.000244140625;class Bs{constructor(a,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=a,this._tr=new Ir(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=F.now(),B=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%yn==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":B>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(B*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=O.mousePos(this._map.getCanvas(),a),_=this._tr;this._around=d.y>_.transform.height/2-_.transform.getHorizon()?s.M.convert(this._aroundCenter?_.center:_.unproject(d)):s.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>yn?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&q!==0&&(q=1/q);const w=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(w*q))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,_=this._startZoom,B=this._easing;let S,U=!1;if(this._type==="wheel"&&_&&B){const H=Math.min((F.now()-this._lastWheelEventTime)/200,1),q=B(H);S=s.z.number(_,d,q),H<1?this._frameId||(this._frameId=!0):U=!0}else S=d,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:S-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=s.b6;if(this._prevEase){const _=this._prevEase,B=(F.now()-_.start)/_.duration,S=_.easing(B+.01)-_.easing(B),U=.27/Math.sqrt(S*S+1e-4)*.01,H=Math.sqrt(.0729-U*U);d=s.b5(U,H,.25,1)}return this._prevEase={start:F.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Do{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ql{constructor(a){this._tr=new Ir(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu{constructor(){this._tap=new ya({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,_){if(!this._swipePoint)if(this._tapTime){const B=d[0],S=a.timeStamp-this._tapTime<500,U=this._tapPoint.dist(B)<30;S&&U?_.length>0&&(this._swipePoint=B,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(a,d,_)}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const B=d[0],S=B.y-this._swipePoint.y;return this._swipePoint=B,a.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const B=this._tap.touchend(a,d,_);B&&(this._tapTime=a.timeStamp,this._tapPoint=B)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ac{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class su{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _a{constructor(a,d,_,B){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=B,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $s{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=O.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),B=document.createElement("div");B.className="maplibregl-desktop-message",B.textContent=d,this._container.appendChild(B);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(O.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const bi=y=>y.zoom||y.drag||y.pitch||y.rotate;class sr extends s.k{}function $l(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class kc{constructor(a,d){this.handleWindowEvent=B=>{this.handleEvent(B,`${B.type}Window`)},this.handleEvent=(B,S)=>{if(B.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const U=B.type==="renderFrame"?void 0:B,H={needsRenderFrame:!1},q={},w={},T=B.touches,R=T?this._getMapTouches(T):void 0,j=R?O.touchPos(this._map.getCanvas(),R):O.mousePos(this._map.getCanvas(),B);for(const{handlerName:J,handler:ee,allowed:ae}of this._handlers){if(!ee.isEnabled())continue;let fe;this._blockedByActive(w,ae,J)?ee.reset():ee[S||B.type]&&(fe=ee[S||B.type](B,j,R),this.mergeHandlerResult(H,q,fe,J,U),fe&&fe.needsRenderFrame&&this._triggerRenderFrame()),(fe||ee.isActive())&&(w[J]=ee)}const Z={};for(const J in this._previousActiveHandlers)w[J]||(Z[J]=U);this._previousActiveHandlers=w,(Object.keys(Z).length||$l(H))&&(this._changes.push([H,q,Z]),this._triggerRenderFrame()),(Object.keys(w).length||$l(H))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=H;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ma(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[B,S,U]of this._listeners)O.addEventListener(B,S,B===document?this.handleWindowEvent:this.handleEvent,U)}destroy(){for(const[a,d,_]of this._listeners)O.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new ys(d,a));const B=d.boxZoom=new Zr(d,a);this._add("boxZoom",B),a.interactive&&a.boxZoom&&B.enable();const S=d.cooperativeGestures=new $s(d,a.cooperativeGestures);this._add("cooperativeGestures",S),a.cooperativeGestures&&S.enable();const U=new Fa(d),H=new ql(d);d.doubleClickZoom=new Do(H,U),this._add("tapZoom",U),this._add("clickZoom",H),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const q=new Mu;this._add("tapDragZoom",q);const w=d.touchPitch=new Fc(d);this._add("touchPitch",w),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const T=hl(a),R=Hl(a);d.dragRotate=new su(a,T,R),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const j=(fe=>{let{enable:pe,clickTolerance:xe}=fe;const Pe=new Oi({checkCorrectEvent:Le=>O.mouseButton(Le)===0&&!Le.ctrlKey});return new go({clickTolerance:xe,move:(Le,rt)=>({around:rt,panDelta:rt.sub(Le)}),activateOnStart:!0,moveStateManager:Pe,enable:pe,assignEvents:Pi})})(a),Z=new Li(a,d);d.dragPan=new Ac(_,j,Z),this._add("mousePan",j),this._add("touchPan",Z,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const W=new jl,J=new mo;d.touchZoomRotate=new _a(_,J,W,q),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const ee=d.scrollZoom=new Bs(d,()=>this._triggerRenderFrame());this._add("scrollZoom",ee,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const ae=d.keyboard=new Rc(d);this._add("keyboard",ae),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new As(d))}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!bi(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,_){for(const B in a)if(B!==_&&(!d||d.indexOf(B)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(a,d,_,B,S){if(!_)return;s.e(a,_);const U={handlerName:B,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(d.zoom=U),_.panDelta!==void 0&&(d.drag=U),_.pitchDelta!==void 0&&(d.pitch=U),_.bearingDelta!==void 0&&(d.rotate=U)}_applyChanges(){const a={},d={},_={};for(const[B,S,U]of this._changes)B.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(B.panDelta)),B.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(a.around=B.around),B.pinchAround!==void 0&&(a.pinchAround=B.pinchAround),B.noInertia&&(a.noInertia=B.noInertia),s.e(d,S),s.e(_,U);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const B=this._map,S=B._getTransformForUpdate(),U=B.terrain;if(!($l(a)||U&&this._terrainMovement))return this._fireEvents(d,_,!0);let{panDelta:H,zoomDelta:q,bearingDelta:w,pitchDelta:T,around:R,pinchAround:j}=a;j!==void 0&&(R=j),B._stop(!0),R=R||B.transform.centerPoint;const Z=S.pointLocation(H?R.sub(H):R);w&&(S.bearing+=w),T&&(S.pitch+=T),q&&(S.zoom+=q),U?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(H)):S.setLocationAtPoint(Z,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(Z,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,S.recalculateZoom(B.terrain)})):S.setLocationAtPoint(Z,R),B._applyUpdatedTransform(S),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const B=bi(this._eventsInProgress),S=bi(a),U={};for(const T in a){const{originalEvent:R}=a[T];this._eventsInProgress[T]||(U[`${T}start`]=R),this._eventsInProgress[T]=a[T]}!B&&S&&this._fireEvent("movestart",S.originalEvent);for(const T in U)this._fireEvent(T,U[T]);S&&this._fireEvent("move",S.originalEvent);for(const T in a){const{originalEvent:R}=a[T];this._fireEvent(T,R)}const H={};let q;for(const T in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[T];this._handlersById[R].isActive()||(delete this._eventsInProgress[T],q=d[R]||j,H[`${T}end`]=q)}for(const T in H)this._fireEvent(T,H[T]);const w=bi(this._eventsInProgress);if(_&&(B||S)&&!w){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!T||!T.essential&&F.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:q})),R(this._map.getBearing())&&this._map.resetNorth()):(R(T.bearing||this._map.getBearing())&&(T.bearing=0),T.freezeElevation=!0,this._map.easeTo(T,{originalEvent:q})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new s.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new sr("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Oc extends s.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const _=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.e({offset:a},d),_)}panTo(a,d,_){return this.easeTo(s.e({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(s.e({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(s.e({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,s.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=kt.convert(a);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,d)}_cameraForBoxAndBearing(a,d,_,B){const S={top:0,bottom:0,right:0,left:0};if(typeof(B=s.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},B)).padding=="number"){const pt=B.padding;B.padding={top:pt,bottom:pt,right:pt,left:pt}}B.padding=s.e(S,B.padding);const U=this.transform,H=U.padding,q=new kt(a,d),w=U.project(q.getNorthWest()),T=U.project(q.getNorthEast()),R=U.project(q.getSouthEast()),j=U.project(q.getSouthWest()),Z=s.b7(-_),W=w.rotate(Z),J=T.rotate(Z),ee=R.rotate(Z),ae=j.rotate(Z),fe=new s.P(Math.max(W.x,J.x,ae.x,ee.x),Math.max(W.y,J.y,ae.y,ee.y)),pe=new s.P(Math.min(W.x,J.x,ae.x,ee.x),Math.min(W.y,J.y,ae.y,ee.y)),xe=fe.sub(pe),Pe=(U.width-(H.left+H.right+B.padding.left+B.padding.right))/xe.x,Le=(U.height-(H.top+H.bottom+B.padding.top+B.padding.bottom))/xe.y;if(Le<0||Pe<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const rt=Math.min(U.scaleZoom(U.scale*Math.min(Pe,Le)),B.maxZoom),Ke=s.P.convert(B.offset),Re=new s.P((B.padding.left-B.padding.right)/2,(B.padding.top-B.padding.bottom)/2).rotate(s.b7(_)),Qe=Ke.add(Re).mult(U.scale/U.zoomScale(rt));return{center:U.unproject(w.add(R).div(2).sub(Qe)),zoom:rt,bearing:_}}fitBounds(a,d,_){return this._fitInternal(this.cameraForBounds(a,d),d,_)}fitScreenCoordinates(a,d,_,B,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(a)),this.transform.pointLocation(s.P.convert(d)),_,B),B,S)}_fitInternal(a,d,_){return a?(delete(d=s.e(a,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(a,d){this.stop();const _=this._getTransformForUpdate();let B=!1,S=!1,U=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(B=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=s.M.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(S=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(U=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),this._applyUpdatedTransform(_),this.fire(new s.k("movestart",d)).fire(new s.k("move",d)),B&&this.fire(new s.k("zoomstart",d)).fire(new s.k("zoom",d)).fire(new s.k("zoomend",d)),S&&this.fire(new s.k("rotatestart",d)).fire(new s.k("rotate",d)).fire(new s.k("rotateend",d)),U&&this.fire(new s.k("pitchstart",d)).fire(new s.k("pitch",d)).fire(new s.k("pitchend",d)),this.fire(new s.k("moveend",d))}calculateCameraOptionsFromTo(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const S=s.Y.fromLngLat(a,d),U=s.Y.fromLngLat(_,B),H=U.x-S.x,q=U.y-S.y,w=U.z-S.z,T=Math.hypot(H,q,w);if(T===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(H,q),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),Z=180*Math.atan2(H,-q)/Math.PI;let W=180*Math.acos(R/T)/Math.PI;return W=w<0?90-W:90+W,{center:U.toLngLat(),zoom:j,pitch:W,bearing:Z}}easeTo(a,d){this._stop(!1,a.easeId),((a=s.e({offset:[0,0],duration:500,easing:s.b6},a)).animate===!1||!a.essential&&F.prefersReducedMotion)&&(a.duration=0);const _=this._getTransformForUpdate(),B=this.getZoom(),S=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?+a.zoom:B,w="bearing"in a?this._normalizeBearing(a.bearing,S):S,T="pitch"in a?+a.pitch:U,R="padding"in a?a.padding:_.padding,j=s.P.convert(a.offset);let Z=_.centerPoint.add(j);const W=_.pointLocation(Z),J=s.M.convert(a.center||W);this._normalizeCenter(J);const ee=_.project(W),ae=_.project(J).sub(ee),fe=_.zoomScale(q-B);let pe,xe;a.around&&(pe=s.M.convert(a.around),xe=_.locationPoint(pe));const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==B,this._rotating=this._rotating||S!==w,this._pitching=this._pitching||T!==U,this._padding=!_.isPaddingEqual(R),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,Pe),this.terrain&&this._prepareElevation(J),this._ease(Le=>{if(this._zooming&&(_.zoom=s.z.number(B,q,Le)),this._rotating&&(_.bearing=s.z.number(S,w,Le)),this._pitching&&(_.pitch=s.z.number(U,T,Le)),this._padding&&(_.interpolatePadding(H,R,Le),Z=_.centerPoint.add(j)),this.terrain&&!a.freezeElevation&&this._updateElevation(Le),pe)_.setLocationAtPoint(pe,xe);else{const rt=_.zoomScale(_.zoom-B),Ke=q>B?Math.min(2,fe):Math.max(.5,fe),Re=Math.pow(Ke,1-Le),Qe=_.unproject(ee.add(ae.mult(Le*Re)).mult(rt));_.setLocationAtPoint(_.renderWorldCopies?Qe.wrap():Qe,Z)}this._applyUpdatedTransform(_),this._fireMoveEvents(d)},Le=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Le)},a),this}_prepareEase(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||_.moving||this.fire(new s.k("movestart",a)),this._zooming&&!_.zooming&&this.fire(new s.k("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new s.k("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new s.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(_-(d-(_*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:_,zoom:B,pitch:S,bearing:U,elevation:H}=this.transformCameraUpdate(d);_&&(d.center=_),B!==void 0&&(d.zoom=B),S!==void 0&&(d.pitch=S),U!==void 0&&(d.bearing=U),H!==void 0&&(d.elevation=H),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new s.k("move",a)),this._zooming&&this.fire(new s.k("zoom",a)),this._rotating&&this.fire(new s.k("rotate",a)),this._pitching&&this.fire(new s.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,B=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.k("zoomend",a)),B&&this.fire(new s.k("rotateend",a)),S&&this.fire(new s.k("pitchend",a)),this.fire(new s.k("moveend",a))}flyTo(a,d){if(!a.essential&&F.prefersReducedMotion){const Dt=s.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Dt,d)}this.stop(),a=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b6},a);const _=this._getTransformForUpdate(),B=this.getZoom(),S=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?s.ac(+a.zoom,_.minZoom,_.maxZoom):B,w="bearing"in a?this._normalizeBearing(a.bearing,S):S,T="pitch"in a?+a.pitch:U,R="padding"in a?a.padding:_.padding,j=_.zoomScale(q-B),Z=s.P.convert(a.offset);let W=_.centerPoint.add(Z);const J=_.pointLocation(W),ee=s.M.convert(a.center||J);this._normalizeCenter(ee);const ae=_.project(J),fe=_.project(ee).sub(ae);let pe=a.curve;const xe=Math.max(_.width,_.height),Pe=xe/j,Le=fe.mag();if("minZoom"in a){const Dt=s.ac(Math.min(a.minZoom,B,q),_.minZoom,_.maxZoom),hi=xe/_.zoomScale(Dt-B);pe=Math.sqrt(hi/Le*2)}const rt=pe*pe;function Ke(Dt){const hi=(Pe*Pe-xe*xe+(Dt?-1:1)*rt*rt*Le*Le)/(2*(Dt?Pe:xe)*rt*Le);return Math.log(Math.sqrt(hi*hi+1)-hi)}function Re(Dt){return(Math.exp(Dt)-Math.exp(-Dt))/2}function Qe(Dt){return(Math.exp(Dt)+Math.exp(-Dt))/2}const pt=Ke(!1);let bt=function(Dt){return Qe(pt)/Qe(pt+pe*Dt)},ht=function(Dt){return xe*((Qe(pt)*(Re(hi=pt+pe*Dt)/Qe(hi))-Re(pt))/rt)/Le;var hi},Rt=(Ke(!0)-pt)/pe;if(Math.abs(Le)<1e-6||!isFinite(Rt)){if(Math.abs(xe-Pe)<1e-6)return this.easeTo(a,d);const Dt=Pe<xe?-1:1;Rt=Math.abs(Math.log(Pe/xe))/pe,ht=function(){return 0},bt=function(hi){return Math.exp(Dt*pe*hi)}}return a.duration="duration"in a?+a.duration:1e3*Rt/("screenSpeed"in a?+a.screenSpeed/pe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=S!==w,this._pitching=T!==U,this._padding=!_.isPaddingEqual(R),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(ee),this._ease(Dt=>{const hi=Dt*Rt,Vt=1/bt(hi);_.zoom=Dt===1?q:B+_.scaleZoom(Vt),this._rotating&&(_.bearing=s.z.number(S,w,Dt)),this._pitching&&(_.pitch=s.z.number(U,T,Dt)),this._padding&&(_.interpolatePadding(H,R,Dt),W=_.centerPoint.add(Z)),this.terrain&&!a.freezeElevation&&this._updateElevation(Dt);const _i=Dt===1?ee:_.unproject(ae.add(fe.mult(ht(hi))).mult(Vt));_.setLocationAtPoint(_.renderWorldCopies?_i.wrap():_i,W),this._applyUpdatedTransform(_),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){_.animate===!1||_.duration===0?(a(1),d()):(this._easeStart=F.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=s.b0(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Cs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class dh{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cs;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=O.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=O.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const _=this._map._getUIString(`AttributionControl.${d}`);a.title=_,a.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(B=>typeof B!="string"?"":B)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const B=this._map.style.stylesheet;this.styleOwner=B.owner,this.styleId=B.id}const d=this._map.style.sourceCaches;for(const B in d){const S=d[B];if(S.used||S.usedForTerrain){const U=S.getSource();U.attribution&&a.indexOf(U.attribution)<0&&a.push(U.attribution)}}a=a.filter(B=>String(B).trim()),a.sort((B,S)=>B.length-S.length),a=a.filter((B,S)=>{for(let U=S+1;U<a.length;U++)if(a[U].indexOf(B)>=0)return!1;return!0});const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class jn{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=O.create("div","maplibregl-ctrl");const d=O.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){O.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ou{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const B of _)if(B.id===a)return void(B.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $i=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ni extends s.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const _={};for(const B of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))_[B.key]=!0,this._renderableTilesKeys.push(B.key),this._tiles[B.key]||(B.posMatrix=new Float64Array(16),s.aN(B.posMatrix,0,s.W,0,s.W,0,1),this._tiles[B.key]=new Ji(B,this.tileSize));for(const B in this._tiles)_[B]||delete this._tiles[B]}freeRtt(a){for(const d in this._tiles){const _=this._tiles[d];(!a||_.tileID.equals(a)||_.tileID.isChildOf(a)||a.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const _ of this._renderableTilesKeys){const B=this._tiles[_].tileID;if(B.canonical.equals(a.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16),s.aN(S.posMatrix,0,s.W,0,s.W,0,1),d[_]=S}else if(B.canonical.isChildOf(a.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16);const U=B.canonical.z-a.canonical.z,H=B.canonical.x-(B.canonical.x>>U<<U),q=B.canonical.y-(B.canonical.y>>U<<U),w=s.W>>U;s.aN(S.posMatrix,0,w,0,w,0,1),s.H(S.posMatrix,S.posMatrix,[-H*w,-q*w,0]),d[_]=S}else if(a.canonical.isChildOf(B.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16);const U=a.canonical.z-B.canonical.z,H=a.canonical.x-(a.canonical.x>>U<<U),q=a.canonical.y-(a.canonical.y>>U<<U),w=s.W>>U;s.aN(S.posMatrix,0,s.W,0,s.W,0,1),s.H(S.posMatrix,S.posMatrix,[H*w,q*w,0]),s.J(S.posMatrix,S.posMatrix,[1/2**U,1/2**U,0]),d[_]=S}}return d}getSourceTile(a,d){const _=this.sourceCache._source;let B=a.overscaledZ-this.deltaZoom;if(B>_.maxzoom&&(B=_.maxzoom),B<_.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(B).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!S||!S.dem)&&d)for(;B>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(a.scaledTo(B--).key);return S}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class qn{constructor(a,d,_){this.painter=a,this.sourceCache=new Ni(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;var S;if(!(d>=0&&d<B&&_>=0&&_<B))return 0;const U=this.getTerrainData(a),H=(S=U.tile)===null||S===void 0?void 0:S.dem;if(!H)return 0;const q=function(W,J,ee){var ae=J[0],fe=J[1];return W[0]=ee[0]*ae+ee[4]*fe+ee[12],W[1]=ee[1]*ae+ee[5]*fe+ee[13],W}([],[d/B*s.W,_/B*s.W],U.u_terrain_matrix),w=[q[0]*H.dim,q[1]*H.dim],T=Math.floor(w[0]),R=Math.floor(w[1]),j=w[0]-T,Z=w[1]-R;return H.get(T,R)*(1-j)*(1-Z)+H.get(T+1,R)*j*(1-Z)+H.get(T,R+1)*(1-j)*Z+H.get(T+1,R+1)*j*Z}getElevationForLngLatZoom(a,d){const{tileID:_,mercatorX:B,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(_,B%s.W,S%s.W,s.W)}getElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;return this.getDEMElevation(a,d,_,B)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const B=this.painter.context,S=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(B,S,B.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(B,new s.R({width:1,height:1}),B.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const B=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Fe(B,d.dem.getPixels(),B.gl.RGBA,{premultiply:!1}),d.demTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+a.key;if(_&&!this._demMatrixCache[_]){const B=this.sourceCache.sourceCache._source.maxzoom;let S=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=B?S=a.canonical.z-B:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const U=a.canonical.x-(a.canonical.x>>S<<S),H=a.canonical.y-(a.canonical.y>>S<<S),q=s.b8(new Float64Array(16),[1/(s.W<<S),1/(s.W<<S),0]);s.H(q,q,[U*s.W,H*s.W,0]),this._demMatrixCache[a.key]={matrix:q,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,_=d.width/devicePixelRatio,B=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===B||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,B,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,B))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,U=0;S<this._coordsTextureSize;S++)for(let H=0;H<this._coordsTextureSize;H++,U+=4)d[U+0]=255&H,d[U+1]=255&S,d[U+2]=H>>8<<4|S>>8,d[U+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),B=new Fe(a,_,a.gl.RGBA,{premultiply:!1});return B.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=B,B}pointCoordinate(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const S=d[0]+(d[2]>>4<<8),U=d[1]+((15&d[2])<<8),H=this.coordsIndex[255-d[3]],q=H&&this.sourceCache.getTileByID(H);if(!q)return null;const w=this._coordsTextureSize,T=(1<<q.tileID.canonical.z)*w;return new s.Y((q.tileID.canonical.x*w+S)/T+q.tileID.wrap,(q.tileID.canonical.y*w+U)/T,this.getElevation(q.tileID,S,U,w))}depthAtPoint(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new s.b9,_=new s.aX,B=this.meshSize,S=s.W/B,U=B*B;for(let R=0;R<=B;R++)for(let j=0;j<=B;j++)d.emplaceBack(j*S,R*S,0);for(let R=0;R<U;R+=B+1)for(let j=0;j<B;j++)_.emplaceBack(j+R,B+j+R+1,B+j+R+2),_.emplaceBack(j+R,B+j+R+2,j+R+1);const H=d.length,q=H+2*(B+1);for(const R of[0,1])for(let j=0;j<=B;j++)for(const Z of[0,1])d.emplaceBack(j*S,R*s.W,Z);for(let R=0;R<2*B;R+=2)_.emplaceBack(q+R,q+R+1,q+R+3),_.emplaceBack(q+R,q+R+3,q+R+2),_.emplaceBack(H+R,H+R+3,H+R+1),_.emplaceBack(H+R,H+R+2,H+R+3);const w=d.length,T=w+2*(B+1);for(const R of[0,1])for(let j=0;j<=B;j++)for(const Z of[0,1])d.emplaceBack(R*s.W,j*S,Z);for(let R=0;R<2*B;R+=2)_.emplaceBack(w+R,w+R+1,w+R+3),_.emplaceBack(w+R,w+R+3,w+R+2),_.emplaceBack(T+R,T+R+3,T+R+1),_.emplaceBack(T+R,T+R+2,T+R+3);return this._mesh={indexBuffer:a.createIndexBuffer(_),vertexBuffer:a.createVertexBuffer(d,$i.members),segments:s.$.simpleSegment(0,0,d.length,_.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*s.ba/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var _;const{tileID:B}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(_=this.getMinMaxElevation(B).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(a,d){const _=s.Y.fromLngLat(a.wrap()),B=(1<<d)*s.W,S=_.x*B,U=_.y*B,H=Math.floor(S/s.W),q=Math.floor(U/s.W);return{tileID:new s.Q(d,0,d,H,q),mercatorX:S,mercatorY:U}}}class Pu{constructor(a,d,_){this._context=a,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new Fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:a,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const Ds={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class tn{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new Pu(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(_=>!a._layers[_].isHidden(d)),this._coordsDescendingInv={};for(const _ in a.sourceCaches){this._coordsDescendingInv[_]={};const B=a.sourceCaches[_].getVisibleCoordinates();for(const S of B){const U=this.terrain.sourceCache.getTerrainCoords(S);for(const H in U)this._coordsDescendingInv[_][H]||(this._coordsDescendingInv[_][H]=[]),this._coordsDescendingInv[_][H].push(U[H])}}this._coordsDescendingInvStr={};for(const _ of a._order){const B=a._layers[_],S=B.source;if(Ds[B.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(const U in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][U]=this._coordsDescendingInv[S][U].map(H=>H.key).sort().join()}}for(const _ of this._renderableTiles)for(const B in this._coordsDescendingInvStr){const S=this._coordsDescendingInvStr[B][_.tileID.key];S&&S!==_.rttCoords[B]&&(_.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,_=this.painter,B=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(Ds[d]&&(this._prevType&&Ds[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!B))return!0;if(Ds[this._prevType]||Ds[d]&&B){this._prevType=d;const S=this._stacks.length-1,U=this._stacks[S]||[];for(const H of this._renderableTiles){if(this.pool.isFull()&&(cl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[S]){const w=this.pool.getObjectForId(H.rtt[S].id);if(w.stamp===H.rtt[S].stamp){this.pool.useObject(w);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),H.rtt[S]={id:q.id,stamp:q.stamp},_.context.bindFramebuffer.set(q.fbo.framebuffer),_.context.clear({color:s.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let w=0;w<U.length;w++){const T=_.style._layers[U[w]],R=T.source?this._coordsDescendingInv[T.source][H.tileID.key]:[H.tileID];_.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),_._renderTileClippingMasks(T,R),_.renderLayer(_,_.style.sourceCaches[T.source],T,R),T.source&&(H.rttCoords[T.source]=this._coordsDescendingInvStr[T.source][H.tileID.key])}}return cl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ds[d]}return!1}}const Yo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ro=m,au={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Cs,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Rs=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Jr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Un{constructor(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=U=>{this.startMouse(s.e({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),O.mousePos(this.element,U)),O.addEventListener(window,"mousemove",this.mousemove),O.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=U=>{this.moveMouse(U,O.mousePos(this.element,U))},this.mouseup=U=>{this.mouseRotate.dragEnd(U),this.mousePitch&&this.mousePitch.dragEnd(U),this.offTemp()},this.touchstart=U=>{U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=O.touchPos(this.element,U.targetTouches)[0],this.startTouch(U,this._startPos),O.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.addEventListener(window,"touchend",this.touchend))},this.touchmove=U=>{U.targetTouches.length!==1?this.reset():(this._lastPos=O.touchPos(this.element,U.targetTouches)[0],this.moveTouch(U,this._lastPos))},this.touchend=U=>{U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const B=a.dragRotate._mouseRotate.getClickTolerance(),S=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=hl({clickTolerance:B,enable:!0}),this.touchRotate=(U=>{let{enable:H,clickTolerance:q,bearingDegreesPerPixelMoved:w=.8}=U;const T=new Jo;return new go({clickTolerance:q,move:(R,j)=>({bearingDelta:(j.x-R.x)*w}),moveStateManager:T,enable:H,assignEvents:Rs})})({clickTolerance:B,enable:!0}),this.map=a,_&&(this.mousePitch=Hl({clickTolerance:S,enable:!0}),this.touchPitch=(U=>{let{enable:H,clickTolerance:q,pitchDegreesPerPixelMoved:w=-.5}=U;const T=new Jo;return new go({clickTolerance:q,move:(R,j)=>({pitchDelta:(j.y-R.y)*w}),moveStateManager:T,enable:H,assignEvents:Rs})})({clickTolerance:S,enable:!0})),O.addEventListener(d,"mousedown",this.mousedown),O.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),O.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),O.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),O.disableDrag()}moveMouse(a,d){const _=this.map,{bearingDelta:B}=this.mouseRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.mousePitch){const{pitchDelta:S}=this.mousePitch.dragMove(a,d)||{};S&&_.setPitch(_.getPitch()+S)}}moveTouch(a,d){const _=this.map,{bearingDelta:B}=this.touchRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.touchPitch){const{pitchDelta:S}=this.touchPitch.dragMove(a,d)||{};S&&_.setPitch(_.getPitch()+S)}}off(){const a=this.element;O.removeEventListener(a,"mousedown",this.mousedown),O.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend),O.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){O.enableDrag(),O.removeEventListener(window,"mousemove",this.mousemove),O.removeEventListener(window,"mouseup",this.mouseup),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend)}}let ko;function Al(y,a,d){const _=new s.M(y.lng,y.lat);if(y=new s.M(y.lng,y.lat),a){const B=new s.M(y.lng-360,y.lat),S=new s.M(y.lng+360,y.lat),U=d.locationPoint(y).distSqr(a);d.locationPoint(B).distSqr(a)<U?y=B:d.locationPoint(S).distSqr(a)<U&&(y=S)}for(;Math.abs(y.lng-d.center.lng)>180;){const B=d.locationPoint(y);if(B.x>=0&&B.y>=0&&B.x<=d.width&&B.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y.lng!==_.lng&&d.locationPoint(y).y>d.height/2-d.getHorizon()?y:_}const Ja={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Da(y,a,d){const _=y.classList;for(const B in Ja)_.remove(`maplibregl-${d}-anchor-${B}`);_.add(`maplibregl-${d}-anchor-${a}`)}class Kl extends s.E{constructor(a){if(super(),this._onKeyPress=d=>{const _=d.code,B=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&B!==32&&B!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,B=this._element;this._popup&&(_===B||B.contains(_))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!_)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Al(this._lngLat,this._flatPos,this._map.transform)),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let B="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?B=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(B=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),O.setTransform(this._element,`${Ja[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${B}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=O.create("div"),this._element.setAttribute("aria-label","Map marker");const d=O.createNS("http://www.w3.org/2000/svg","svg"),_=41,B=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${B}px`),d.setAttributeNS(null,"viewBox",`0 0 ${B} ${_}`);const S=O.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const U=O.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const H=O.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");const q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of q){const fe=O.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",ae.rx),fe.setAttributeNS(null,"ry",ae.ry),H.appendChild(fe)}const w=O.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const T=O.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(T);const R=O.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const j=O.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(j);const Z=O.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=O.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=O.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const ee=O.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),W.appendChild(J),W.appendChild(ee),U.appendChild(H),U.appendChild(w),U.appendChild(R),U.appendChild(Z),U.appendChild(W),d.appendChild(U),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Da(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),O.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const B=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[B,-1*(38.1-13.5+B)],"bottom-right":[-B,-1*(38.1-13.5+B)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,B=_.terrain.depthAtPoint(this._pos),S=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,S)-B<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/_.transform._pixelPerMeter,H=Math.sin(_.getPitch()*Math.PI/180)*U,q=_.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),w=_.transform.lngLatToCameraDepth(this._lngLat,S+H);this._element.style.opacity=w-q>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const lu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let yo=0,va=!1;const dl={maxWidth:100,unit:"metric"};function Gr(y,a,d){const _=d&&d.maxWidth||100,B=y._container.clientHeight/2,S=y.unproject([0,B]),U=y.unproject([_,B]),H=S.distanceTo(U);if(d&&d.unit==="imperial"){const q=3.2808*H;q>5280?N(a,_,q/5280,y._getUIString("ScaleControl.Miles")):N(a,_,q,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?N(a,_,H/1852,y._getUIString("ScaleControl.NauticalMiles")):H>=1e3?N(a,_,H/1e3,y._getUIString("ScaleControl.Kilometers")):N(a,_,H,y._getUIString("ScaleControl.Meters"))}function N(y,a,d,_){const B=function(S){const U=Math.pow(10,`${Math.floor(S)}`.length-1);let H=S/U;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(q){const w=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*w)/w}(H),U*H}(d);y.style.width=a*(B/d)+"px",y.innerHTML=`${B}&nbsp;${_}`}const A={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},b=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function L(y){if(y){if(typeof y=="number"){const a=Math.round(Math.abs(y)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,y),"top-left":new s.P(a,a),"top-right":new s.P(-a,a),bottom:new s.P(0,-y),"bottom-left":new s.P(a,-a),"bottom-right":new s.P(-a,-a),left:new s.P(y,0),right:new s.P(-y,0)}}if(y instanceof s.P||Array.isArray(y)){const a=s.P.convert(y);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:s.P.convert(y.center||[0,0]),top:s.P.convert(y.top||[0,0]),"top-left":s.P.convert(y["top-left"]||[0,0]),"top-right":s.P.convert(y["top-right"]||[0,0]),bottom:s.P.convert(y.bottom||[0,0]),"bottom-left":s.P.convert(y["bottom-left"]||[0,0]),"bottom-right":s.P.convert(y["bottom-right"]||[0,0]),left:s.P.convert(y.left||[0,0]),right:s.P.convert(y.right||[0,0])}}return L(new s.P(0,0))}const k=m;c.AJAXError=s.bd,c.Evented=s.E,c.LngLat=s.M,c.MercatorCoordinate=s.Y,c.Point=s.P,c.addProtocol=s.be,c.config=s.a,c.removeProtocol=s.bf,c.AttributionControl=dh,c.BoxZoomHandler=Zr,c.CanvasSource=li,c.CooperativeGesturesHandler=$s,c.DoubleClickZoomHandler=Do,c.DragPanHandler=Ac,c.DragRotateHandler=su,c.EdgeInsets=Mo,c.FullscreenControl=class extends s.E{constructor(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){O.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=O.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);O.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=ut,c.GeolocateControl=class extends s.E{constructor(y){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new s.M(a.coords.longitude,a.coords.latitude),_=a.coords.accuracy,B=this._map.getBearing(),S=s.e({bearing:B},this.options.fitBoundsOptions),U=kt.fromLngLat(d,_);this._map.fitBounds(U,S,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new s.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&va)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=O.create("button","maplibregl-ctrl-geolocate",this._container),O.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Kl({element:this._dotElement}),this._circleElement=O.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},lu,y)}onAdd(y){return this._map=y,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return s._(this,void 0,void 0,function*(){if(ko!==void 0&&!a)return ko;if(window.navigator.permissions===void 0)return ko=!!window.navigator.geolocation,ko;try{ko=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ko=!!window.navigator.geolocation}return ko})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),O.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yo=0,va=!1}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),d=y.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),a=y.getSouthEast(),d=y.getNorthEast(),_=a.distanceTo(d),B=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${B}px`,this._circleElement.style.height=`${B}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yo--,va=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yo++,yo>1?(y={maximumAge:6e5,timeout:0},va=!0):(y=this.options.positionOptions,va=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=ul,c.ImageSource=ni,c.KeyboardHandler=Rc,c.LngLatBounds=kt,c.LogoControl=jn,c.Map=class extends Oc{constructor(y){if(s.bb.mark(s.bc.create),(y=s.e({},au,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Po(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new ou,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Yo,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=be.addThrottleControl(()=>this.isMoving()),this._requestManager=new je(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=ga(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{a?d(_):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new kc(this,y),this._hash=y.hash&&new ul(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new dh(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new jn,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new s.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,a,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,a,d,_)}resize(y){var a;const d=this._containerDimensions(),_=d[0],B=d[1],S=this._getClampedPixelRatio(_,B);if(this._resizeCanvas(_,B,S),this.painter.resize(_,B,S),this.painter.overLimit()){const H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];const q=this._getClampedPixelRatio(_,B);this._resizeCanvas(_,B,q),this.painter.resize(_,B,q)}this.transform.resize(_,B),(a=this._requestedCameraState)===null||a===void 0||a.resize(_,B);const U=!this._moving;return U&&(this.stop(),this.fire(new s.k("movestart",y)).fire(new s.k("move",y))),this.fire(new s.k("resize",y)),U&&this.fire(new s.k("moveend",y)),this}_getClampedPixelRatio(y,a){const{0:d,1:_}=this._maxCanvasSize,B=this.getPixelRatio(),S=y*B,U=a*B;return Math.min(S>d?d/S:1,U>_?_/U:1)*B}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(kt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(s.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(s.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,a,d){if(y==="mouseenter"||y==="mouseover"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:S=>{const U=this.getLayer(a)?this.queryRenderedFeatures(S.point,{layers:[a]}):[];U.length?_||(_=!0,d.call(this,new Tn(y,this,S.originalEvent,{features:U}))):_=!1},mouseout:()=>{_=!1}}}}if(y==="mouseleave"||y==="mouseout"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:U=>{(this.getLayer(a)?this.queryRenderedFeatures(U.point,{layers:[a]}):[]).length?_=!0:_&&(_=!1,d.call(this,new Tn(y,this,U.originalEvent)))},mouseout:U=>{_&&(_=!1,d.call(this,new Tn(y,this,U.originalEvent)))}}}}{const _=B=>{const S=this.getLayer(a)?this.queryRenderedFeatures(B.point,{layers:[a]}):[];S.length&&(B.features=S,d.call(this,B),delete B.features)};return{layer:a,listener:d,delegates:{[y]:_}}}}on(y,a,d){if(d===void 0)return super.on(y,a);const _=this._createDelegatedListener(y,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(_);for(const B in _.delegates)this.on(B,_.delegates[B]);return this}once(y,a,d){if(d===void 0)return super.once(y,a);const _=this._createDelegatedListener(y,a,d);for(const B in _.delegates)this.once(B,_.delegates[B]);return this}off(y,a,d){return d===void 0?super.off(y,a):(this._delegatedListeners&&this._delegatedListeners[y]&&(_=>{const B=this._delegatedListeners[y];for(let S=0;S<B.length;S++){const U=B[S];if(U.layer===a&&U.listener===d){for(const H in U.delegates)this.off(H,U.delegates[H]);return B.splice(S,1),this}}})(),this)}queryRenderedFeatures(y,a){if(!this.style)return[];let d;const _=y instanceof s.P||Array.isArray(y),B=_?y:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(_?{}:y)||{},B instanceof s.P||typeof B[0]=="number")d=[s.P.convert(B)];else{const S=s.P.convert(B[0]),U=s.P.convert(B[1]);d=[S,new s.P(U.x,S.y),U,new s.P(S.x,U.y),S]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}setStyle(y,a){return(a=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(y,a))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Vn(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,a,d):this.style.loadJSON(y,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Vn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,Te.Style);s.h(d,new AbortController).then(_=>{this._updateDiff(_.data,a)}).catch(_=>{_&&this.fire(new s.j(_))})}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y,a)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){const a=this.style&&this.style.sourceCaches[y];if(a!==void 0)return a.loaded();this.fire(new s.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const a=this.style.sourceCaches[y.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===y.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new qn(this.painter,a,y),this.painter.renderToTexture=new tn(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:y})),this}getTerrain(){var y,a;return(a=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const a in y){const d=y[a]._tiles;for(const _ in d){const B=d[_];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:_=1,sdf:B=!1,stretchX:S,stretchY:U,content:H}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||s.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:w,data:T}=a,R=a;return this.style.addImage(y,{data:new s.R({width:q,height:w},new Uint8Array(T)),pixelRatio:_,stretchX:S,stretchY:U,content:H,sdf:B,version:0,userImage:R}),R.onAdd&&R.onAdd(this,y),this}}{const{width:q,height:w,data:T}=F.getImageData(a);this.style.addImage(y,{data:new s.R({width:q,height:w},T),pixelRatio:_,stretchX:S,stretchY:U,content:H,sdf:B,version:0})}}updateImage(y,a){const d=this.style.getImage(y);if(!d)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof HTMLImageElement||s.b(a)?F.getImageData(a):a,{width:B,height:S,data:U}=_;if(B===void 0||S===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(B!==d.data.width||S!==d.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const H=!(a instanceof HTMLImageElement||s.b(a));return d.data.replace(U,H),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return be.getImage(this._requestManager.transformRequest(y,Te.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,a,d){return this.style.setLayerZoomRange(y,a,d),this._update(!0)}setFilter(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(y,a,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(y,a,d,_),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(y,a,d,_),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setGlyphs(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(y,a,d,_=>{_||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(y,a,d=>{d||this._update(!0)}),this}setLight(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,a=0;return this._container&&(y=this._container.clientWidth||400,a=this._container.clientHeight||300),[y,a]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const a=this._canvasContainer=O.create("div","maplibregl-canvas-container",y);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=O.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const B=this._controlContainer=O.create("div","maplibregl-control-container",y),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(U=>{S[U]=O.create("div",`maplibregl-ctrl-${U} `,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{a={requestedAttributes:y},_&&(a.statusMessage=_.statusMessage,a.type=_.type)},{once:!0});const d=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!d){const _="Failed to initialize WebGL";throw a?(a.message=_,new Error(JSON.stringify(a))):new Error(_)}this.painter=new fo(d,this.transform),z.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,S=F.now();this.style.zoomHistory.update(B,S);const U=new s.a8(B,{now:S,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=U.crossFadingFactor();H===1&&H===this._crossFadingFactor||(d=!0,this._crossFadingFactor=H),this.style.update(U)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bb.mark(s.bc.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,s.bb.mark(s.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),be.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),O.remove(this._canvasContainer),O.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bb.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(y=>{s.bb.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Ro}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Tn,c.MapTouchEvent=Fo,c.MapWheelEvent=hs,c.Marker=Kl,c.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),_=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);a.title=_,a.setAttribute("aria-label",_)},this.options=s.e({},Jr,y),this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),O.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),O.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=O.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Un(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){O.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,a){const d=O.create("button",y,this._container);return d.type="button",d.addEventListener("click",a),d}},c.Popup=class extends s.E{constructor(y){super(),this.remove=()=>(this._content&&O.remove(this._content),this._container&&(O.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=O.create("div","maplibregl-popup",this._map.getContainer()),this._tip=O.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const U of this.options.className.split(" "))this._container.classList.add(U);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Al(this._lngLat,this._flatPos,this._map.transform)),this._trackPointer&&!a)return;const d=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let _=this.options.anchor;const B=L(this.options.offset);if(!_){const U=this._container.offsetWidth,H=this._container.offsetHeight;let q;q=d.y+B.bottom.y<H?["top"]:d.y>this._map.transform.height-H?["bottom"]:[],d.x<U/2?q.push("left"):d.x>this._map.transform.width-U/2&&q.push("right"),_=q.length===0?"bottom":q.join("-")}const S=d.add(B[_]).round();O.setTransform(this._container,`${Ja[_]} translate(${S.x}px,${S.y}px)`),Da(this._container,_,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(A),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=s.M.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const a=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=y;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=O.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=O.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(b);y&&y.focus()}},c.RasterDEMTileSource=ei,c.RasterTileSource=Ri,c.ScaleControl=class{constructor(y){this._onMove=()=>{Gr(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,Gr(this._map,this._container,this.options)},this.options=s.e({},dl,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){O.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Bs,c.Style=Vn,c.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=O.create("button","maplibregl-ctrl-terrain",this._container),O.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){O.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Fc,c.TwoFingersTouchRotateHandler=jl,c.TwoFingersTouchZoomHandler=mo,c.TwoFingersTouchZoomRotateHandler=_a,c.VectorTileSource=xt,c.VideoSource=di,c.addSourceType=(y,a)=>s._(void 0,void 0,void 0,function*(){if(tr(y))throw new Error(`A source type called "${y}" already exists.`);((d,_)=>{Ki[d]=_})(y,a)}),c.clearPrewarmedResources=function(){const y=ft;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Xe),ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return Nt().getRTLTextPluginStatus()},c.getVersion=function(){return k},c.getWorkerCount=function(){return et.workerCount},c.getWorkerUrl=function(){return s.a.WORKER_URL},c.importScriptInWorkers=function(y){return Ht().broadcast("importScript",y)},c.prewarm=function(){Pt().acquire(Xe)},c.setMaxParallelImageRequests=function(y){s.a.MAX_PARALLEL_IMAGE_REQUESTS=y},c.setRTLTextPlugin=function(y,a){return Nt().setRTLTextPlugin(y,a)},c.setWorkerCount=function(y){et.workerCount=y},c.setWorkerUrl=function(y){s.a.WORKER_URL=y}});var o=t;return o})})(GT);var uN=GT.exports;const Jl=e_(uN);class hN{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let x={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(x.zoom=t._minpitchzoom);var r=0,n=38.5,o=6,c=62.33,{longitude:s,latitude:m}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainMapZen",exaggeration:1.5}):s>=r&&s<=o&&m>=n&&m<=c?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainMapZen",exaggeration:1.5}),e.easeTo(x),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function mm(i){"@babel/helpers - typeof";return mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mm(i)}function AN(i,e){if(mm(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(mm(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function dN(i){var e=AN(i,"string");return mm(e)=="symbol"?e:String(e)}function ye(i,e,t){return e=dN(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Is(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const t_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),jT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);jT&&parseFloat(jT[1]);const fN="3.4.14";function Th(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const mx={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},pN=mx.global||mx.self||mx.window||{},lA=typeof process!="object"||String(process)!=="[object process]"||process.browser,yx=typeof importScripts=="function",gN=typeof window<"u"&&typeof window.orientation<"u",qT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qT&&parseFloat(qT[1]);class mN{constructor(e,t){ye(this,"name",void 0),ye(this,"workerThread",void 0),ye(this,"isRunning",!0),ye(this,"result",void 0),ye(this,"_resolve",()=>{}),ye(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Th(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Th(this.isRunning),this.isRunning=!1,this._reject(e)}}let _x=class{terminate(){}};const vx=new Map;function yN(i){Th(i.source&&!i.url||!i.source&&i.url);let e=vx.get(i.source||i.url);return e||(i.url&&(e=_N(i.url),vx.set(i.url,e)),i.source&&(e=$T(i.source),vx.set(i.source,e))),Th(e),e}function _N(i){if(!i.startsWith("http"))return i;const e=vN(i);return $T(e)}function $T(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function vN(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function KT(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(i){if(WT(i))r.add(i);else if(WT(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const n in i)KT(i[n],e,r)}}return t===void 0?Array.from(r):[]}function WT(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const bx=()=>{};class xx{static isSupported(){return typeof Worker<"u"&&lA||typeof _x<"u"&&!lA}constructor(e){ye(this,"name",void 0),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"terminated",!1),ye(this,"worker",void 0),ye(this,"onMessage",void 0),ye(this,"onError",void 0),ye(this,"_loadableURL","");const{name:t,source:r,url:n}=e;Th(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=bx,this.onError=o=>console.log(o),this.worker=lA?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=bx,this.onError=bx,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||KT(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=yN({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new _x(r,{eval:!1})}else if(this.source)e=new _x(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class bN{static isSupported(){return xx.isSupported()}constructor(e){ye(this,"name","unnamed"),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"maxConcurrency",1),ye(this,"maxMobileConcurrency",1),ye(this,"onDebug",()=>{}),ye(this,"reuseWorkers",!0),ye(this,"props",{}),ye(this,"jobQueue",[]),ye(this,"idleQueue",[]),ye(this,"count",0),ye(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,c,s)=>o.done(s),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,c)=>o.error(c);const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new mN(t.name,e);e.onMessage=n=>t.onMessage(r,n.type,n.payload),e.onError=n=>t.onError(r,n),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new xx({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return gN?this.maxMobileConcurrency:this.maxConcurrency}}const xN={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class cA{static isSupported(){return xx.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return cA._workerFarm=cA._workerFarm||new cA({}),cA._workerFarm.setProps(e),cA._workerFarm}constructor(e){ye(this,"props",void 0),ye(this,"workerPools",new Map),this.props={...xN},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new bN({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ye(cA,"_workerFarm",void 0);const wN="latest";function BN(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[i.id]||{},r="".concat(i.id,"-worker.js");let n=t.workerUrl;if(!n&&i.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(n="modules/".concat(i.module,"/dist/").concat(r)),!n){let o=i.version;o==="latest"&&(o=wN);const c=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(i.module).concat(c,"/dist/").concat(r)}return Th(n),n}function CN(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fN;Th(i,"no worker provided");const t=i.version;return!(!e||!t)}const EN=null,SN=null,wx=null,XT=null,TN=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:EN,readFileAsText:SN,requireFromFile:wx,requireFromString:XT},Symbol.toStringTag,{value:"Module"})),IN="3.4.14",Bx={};async function Wd(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(i=LN(i,e,t)),Bx[i]=Bx[i]||MN(i),await Bx[i]}function LN(i,e,t){if(i.startsWith("http"))return i;const r=t.modules||{};return r[i]?r[i]:lA?t.CDN?(Th(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(IN,"/dist/libs/").concat(i)):yx?"../src/libs/".concat(i):"modules/".concat(e,"/src/libs/").concat(i):"modules/".concat(e,"/dist/libs/").concat(i)}async function MN(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!lA)try{return TN&&wx&&await wx(i)}catch{return null}if(yx)return importScripts(i);const t=await(await fetch(i)).text();return PN(t,i)}function PN(i,e){if(!lA)return XT;if(yx)return eval.call(pN,i),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(i))}catch{t.text=i}return document.body.appendChild(t),null}function FN(i,e){return!cA.isSupported()||!lA&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function DN(i,e,t,r,n){const o=i.id,c=BN(i,t),m=cA.getWorkerFarm(t).getWorkerPool({name:o,url:c});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const x=await m.startJob("process-on-worker",RN.bind(null,n));return x.postMessage("process",{input:e,options:t,context:r}),await(await x.result).result}async function RN(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:n,input:o,options:c}=r;try{const s=await i(o,c);e.postMessage("done",{id:n,result:s})}catch(s){const m=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:n,error:m})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function kN(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?ZT(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?ZT(i,0,e):""}function ZT(i,e,t){if(i.byteLength<=e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function ON(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(kN(i),'"'))}}function UN(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function NN(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];const r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=r.reduce((s,m)=>s+m.byteLength,0),o=new Uint8Array(n);let c=0;for(const s of r)o.set(s,c),c+=s.byteLength;return o.buffer}function Cx(i,e,t){const r=t!==void 0?new Uint8Array(i).subarray(e,e+t):new Uint8Array(i).subarray(e);return new Uint8Array(r).buffer}function ym(i,e){return Is(i>=0),Is(e>0),i+(e-1)&~(e-1)}function zN(i,e,t){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const n=i.byteOffset,o=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,n,o)}return e.set(r,t),t+ym(r.byteLength,4)}async function QN(i){const e=[];for await(const t of i)e.push(t);return NN(...e)}function JT(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let YT=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=JT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(JT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},VN=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof YT?n=e:n=new YT(t,r),this.stats[t]=n),n}};const HN="Queued Requests",GN="Active Requests",jN="Cancelled Requests",qN="Queued Requests Ever",$N="Active Requests Ever",KN={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class WN{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"props",void 0),ye(this,"stats",void 0),ye(this,"activeRequestCount",0),ye(this,"requestQueue",[]),ye(this,"requestMap",new Map),ye(this,"deferredUpdate",null),this.props={...KN,...e},this.stats=new VN({id:this.props.id}),this.stats.get(HN),this.stats.get(GN),this.stats.get(jN),this.stats.get(qN),this.stats.get($N)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},n=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let XN="";const e5={};function ZN(i){for(const e in e5)if(i.startsWith(e)){const t=e5[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(XN).concat(i)),i}function a1e(i){return i}function JN(i){return i&&typeof i=="object"&&i.isBuffer}function t5(i){if(JN(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function i5(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function Ex(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const YN=i=>typeof i=="boolean",_m=i=>typeof i=="function",vm=i=>i!==null&&typeof i=="object",r5=i=>vm(i)&&i.constructor==={}.constructor,ez=i=>i&&typeof i[Symbol.iterator]=="function",tz=i=>i&&typeof i[Symbol.asyncIterator]=="function",Xd=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Zd=i=>typeof Blob<"u"&&i instanceof Blob,iz=i=>i&&typeof i=="object"&&i.isBuffer,rz=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||vm(i)&&_m(i.tee)&&_m(i.cancel)&&_m(i.getReader),nz=i=>vm(i)&&_m(i.read)&&_m(i.pipe)&&YN(i.readable),n5=i=>rz(i)||nz(i),sz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,oz=/^([-\w.]+\/[-\w.+]+)/;function az(i){const e=oz.exec(i);return e?e[1]:i}function s5(i){const e=sz.exec(i);return e?e[1]:""}const o5=/\?.*/;function lz(i){const e=i.match(o5);return e&&e[0]}function Sx(i){return i.replace(o5,"")}function i_(i){return Xd(i)?i.url:Zd(i)?i.name||"":typeof i=="string"?i:""}function Tx(i){if(Xd(i)){const e=i,t=e.headers.get("content-type")||"",r=Sx(e.url);return az(t)||s5(r)}return Zd(i)?i.type||"":typeof i=="string"?s5(i):""}function cz(i){return Xd(i)?i.headers["content-length"]||-1:Zd(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function a5(i){if(Xd(i))return i;const e={},t=cz(i);t>=0&&(e["content-length"]=String(t));const r=i_(i),n=Tx(i);n&&(e["content-type"]=n);const o=await Az(i);o&&(e["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const c=new Response(i,{headers:e});return Object.defineProperty(c,"url",{value:r}),c}async function uz(i){if(!i.ok){const e=await hz(i);throw new Error(e)}}async function hz(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const t=i.headers.get("Content-Type");let r=i.statusText;t.includes("application/json")&&(r+=" ".concat(await i.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function Az(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=o=>{var c;return r(o==null||(c=o.target)===null||c===void 0?void 0:c.result)},n.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),r=dz(t);return"data:base64,".concat(r)}return null}function dz(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function l5(i,e){if(typeof i=="string"){i=ZN(i);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(i,t)}return await a5(i)}function fz(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function bm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||fz()}const r_=globalThis.window||globalThis.self||globalThis.global,xm=globalThis.process||{},c5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";bm();function pz(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let gz=class{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=pz(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function mz(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function yz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}function Ix(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,c=i.height*t,s=["font-size:1px;",`padding:${Math.floor(c/2)}px ${Math.floor(o/2)}px;`,`line-height:${c}px;`,`background:url(${n});`,`background-size:${o}px ${c}px;`,"color:transparent;"].join("");return[`${e} %c+`,s]}let n_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(n_||(n_={}));const _z=10;function u5(i){return typeof i!="string"?i:(i=i.toUpperCase(),n_[i]||n_.WHITE)}function vz(i,e,t){return!bm&&typeof i=="string"&&(e&&(i=`\x1B[${u5(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${u5(t)+_z}m${i}\x1B[49m`)),i}function bz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),n=i;for(const o of r){const c=n[o];typeof c=="function"&&(e.find(s=>o===s)||(n[o]=c.bind(i)))}}function s_(i,e){if(!i)throw new Error(e||"Assertion failed")}function wp(){let i;if(bm()&&r_.performance){var e,t;i=r_==null||(e=r_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in xm){var r;const n=xm==null||(r=xm.hrtime)===null||r===void 0?void 0:r.call(xm);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const Bp={debug:bm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},xz={enabled:!0,level:0};function gu(){}const h5={},A5={once:!0};let Lx=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=c5,this._startTs=wp(),this._deltaTs=wp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new gz(`__probe-${this.id}__`,xz),this.timeStamp(`${this.id} started`),bz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wp()-this._startTs).toPrecision(10))}getDelta(){return Number((wp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){s_(e,t)}warn(e){return this._getLogFunction(0,e,Bp.warn,arguments,A5)}error(e){return this._getLogFunction(0,e,Bp.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Bp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Bp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Bp.debug||Bp.info,arguments,A5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||gu,r&&[r],{tag:Ez(t)}):gu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:c=1}=e;return this._shouldLog(t||r)?bm()?Cz({image:n,message:o,scale:c}):Bz():gu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||gu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=f5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||gu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=d5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=f5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,s_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=wp();const c=o.tag||o.message;if(o.once&&c)if(!h5[c])h5[c]=wp();else return gu;return t=wz(this.id,o.message,o),r.bind(console,t,...o.args)}return gu}};Lx.VERSION=c5;function d5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return s_(Number.isFinite(e)&&e>=0),e}function f5(i){const{logLevel:e,message:t}=i;i.logLevel=d5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return s_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function wz(i,e,t){if(typeof e=="string"){const r=t.time?yz(mz(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=vz(e,t.color,t.background)}return e}function Bz(i){return console.warn("removed"),gu}function Cz(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const c=Ix(o,t,r);console.log(...c)},o.src=e,gu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Ix(e,t,r)),gu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Ix(o,t,r)),o.src=e.toDataURL(),gu}return gu}function Ez(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const p5=new Lx({id:"loaders.gl"});class Sz{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Tz{constructor(){ye(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const g5={fetch:null,mimeType:void 0,nothrow:!1,log:new Tz,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:t_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Iz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function m5(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const y5=()=>{const i=m5();return i.globalOptions=i.globalOptions||{...g5},i.globalOptions};function Lz(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],Mz(i,t),Fz(e,i,r)}function Mz(i,e){_5(i,null,g5,Iz,e);for(const t of e){const r=i&&i[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};_5(r,t.id,n,o,e)}}function _5(i,e,t,r,n){const o=e||"Top level",c=e?"".concat(e,"."):"";for(const s in i){const m=!e&&vm(i[s]),x=s==="baseUri"&&!e,I=s==="workerUrl"&&e;if(!(s in t)&&!x&&!I){if(s in r)p5.warn("".concat(o," loader option '").concat(c).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!m){const F=Pz(s,n);p5.warn("".concat(o," loader option '").concat(c).concat(s,"' not recognized. ").concat(F))()}}}}function Pz(i,e){const t=i.toLowerCase();let r="";for(const n of e)for(const o in n.options){if(i===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const c=o.toLowerCase();(t.startsWith(c)||c.startsWith(t))&&(r=r||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return r}function Fz(i,e,t){const n={...i.options||{}};return Dz(n,t),n.log===null&&(n.log=new Sz),v5(n,y5()),v5(n,e),n}function v5(i,e){for(const t in e)if(t in e){const r=e[t];r5(r)&&r5(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function Dz(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function Mx(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function Px(i){var e,t;Is(i,"null loader"),Is(Mx(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(t=i)!==null&&t!==void 0&&t.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const b5=()=>{const i=m5();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function Rz(i){const e=b5();i=Array.isArray(i)?i:[i];for(const t of i){const r=Px(t);e.find(n=>r===n)||e.unshift(r)}}function kz(){return b5()}const Oz=new Lx({id:"loaders.gl"}),Uz=/\.([^.]+)$/;async function Nz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!w5(i))return null;let n=x5(i,e,{...t,nothrow:!0},r);if(n)return n;if(Zd(i)&&(i=await i.slice(0,10).arrayBuffer(),n=x5(i,e,t,r)),!n&&!(t!=null&&t.nothrow))throw new Error(B5(i));return n}function x5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!w5(i))return null;if(e&&!Array.isArray(e))return Px(e);let n=[];e&&(n=n.concat(e)),t!=null&&t.ignoreRegisteredLoaders||n.push(...kz()),Qz(n);const o=zz(i,n,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(B5(i));return o}function zz(i,e,t,r){const n=i_(i),o=Tx(i),c=Sx(n)||(r==null?void 0:r.url);let s=null,m="";if(t!=null&&t.mimeType&&(s=Fx(e,t==null?void 0:t.mimeType),m="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),s=s||Vz(e,c),m=m||(s?"matched url ".concat(c):""),s=s||Fx(e,o),m=m||(s?"matched MIME type ".concat(o):""),s=s||Gz(e,i),m=m||(s?"matched initial data ".concat(E5(i)):""),s=s||Fx(e,t==null?void 0:t.fallbackMimeType),m=m||(s?"matched fallback MIME type ".concat(o):""),m){var x;Oz.log(1,"selectLoader selected ".concat((x=s)===null||x===void 0?void 0:x.name,": ").concat(m,"."))}return s}function w5(i){return!(i instanceof Response&&i.status===204)}function B5(i){const e=i_(i),t=Tx(i);let r="No valid loader found (";r+=e?"".concat(i5(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const n=i?E5(i):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")",r}function Qz(i){for(const e of i)Px(e)}function Vz(i,e){const t=e&&Uz.exec(e),r=t&&t[1];return r?Hz(i,r):null}function Hz(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Fx(i,e){for(const t of i)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function Gz(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(jz(e,t))return t}else if(ArrayBuffer.isView(e)){if(C5(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&C5(e,0,t))return t;return null}function jz(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function C5(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>qz(i,e,t,n))}function qz(i,e,t,r){if(r instanceof ArrayBuffer)return UN(r,i,r.byteLength);switch(typeof r){case"function":return r(i,t);case"string":const n=Dx(i,e,r.length);return r===n;default:return!1}}function E5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Dx(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Dx(i,0,e):""}function Dx(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}const $z=256*1024;function*Kz(i,e){const t=(e==null?void 0:e.chunkSize)||$z;let r=0;const n=new TextEncoder;for(;r<i.length;){const o=Math.min(i.length-r,t),c=i.slice(r,r+o);r+=o,yield n.encode(c)}}const Wz=256*1024;function Xz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=Wz}=e;let r=0;for(;r<i.byteLength;){const n=Math.min(i.byteLength-r,t),o=new ArrayBuffer(n),c=new Uint8Array(i,r,n);new Uint8Array(o).set(c),r+=n,yield o}}()}const Zz=1024*1024;async function*Jz(i,e){const t=(e==null?void 0:e.chunkSize)||Zz;let r=0;for(;r<i.size;){const n=r+t,o=await i.slice(r,n).arrayBuffer();r=n,yield o}}function S5(i,e){return t_?Yz(i,e):e8(i)}async function*Yz(i,e){const t=i.getReader();let r;try{for(;;){const n=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:c}=await n;if(o)return;yield t5(c)}}catch{t.releaseLock()}}async function*e8(i,e){for await(const t of i)yield t5(t)}function t8(i,e){if(typeof i=="string")return Kz(i,e);if(i instanceof ArrayBuffer)return Xz(i,e);if(Zd(i))return Jz(i,e);if(n5(i))return S5(i,e);if(Xd(i))return S5(i.body,e);throw new Error("makeIterator")}const T5="Cannot convert supplied data type";function i8(i,e,t){if(e.text&&typeof i=="string")return i;if(iz(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const n=i.byteLength||i.length;return(i.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+n)),r}throw new Error(T5)}async function r8(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return i8(i,e);if(Zd(i)&&(i=await a5(i)),Xd(i)){const n=i;return await uz(n),e.binary?await n.arrayBuffer():await n.text()}if(n5(i)&&(i=t8(i,t)),ez(i)||tz(i))return QN(i);throw new Error(T5)}function I5(i,e){const t=y5(),r=i||t;return typeof r.fetch=="function"?r.fetch:vm(r.fetch)?n=>l5(n,r):e!=null&&e.fetch?e==null?void 0:e.fetch:l5}function n8(i,e,t){if(t)return t;const r={fetch:I5(e,i),...i};if(r.url){const n=Sx(r.url);r.baseUrl=n,r.queryString=lz(r.url),r.filename=i5(n),r.baseUrl=Ex(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function s8(i,e){if(!e&&i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Rx(i,e,t,r){Th(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Mx(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const n=i_(i),c=s8(e,r),s=await Nz(i,c,t);return s?(t=Lz(t,s,c,n),r=n8({url:n,parse:Rx,loaders:c},t,r||null),await o8(s,i,t,r)):null}async function o8(i,e,t,r){if(CN(i),Xd(e)){const n=e,{ok:o,redirected:c,status:s,statusText:m,type:x,url:I}=n,F=Object.fromEntries(n.headers.entries());r.response={headers:F,ok:o,redirected:c,status:s,statusText:m,type:x,url:I}}if(e=await r8(e,i,t),i.parseTextSync&&typeof e=="string")return t.dataType="text",i.parseTextSync(e,t,r,i);if(FN(i,t))return await DN(i,e,t,r,Rx);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r,i);if(i.parse)return await i.parse(e,t,r,i);throw Th(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function HA(i,e,t,r){!Array.isArray(e)&&!Mx(e)&&(t=e,e=void 0);const n=I5(t);let o=i;return typeof i=="string"&&(o=await n(i)),Zd(i)&&(o=await n(i)),await Rx(o,e,t)}const a8="3.4.14",{_parseImageNode:l8}=globalThis,kx=typeof Image<"u",Ox=typeof ImageBitmap<"u",Ux=t_?!0:!!l8;function c8(i){switch(i){case"auto":return Ox||kx||Ux;case"imagebitmap":return Ox;case"image":return kx;case"data":return Ux;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function u8(){if(Ox)return"imagebitmap";if(kx)return"image";if(Ux)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function h8(i){const e=d8(i);if(!e)throw new Error("Not an image");return e}function A8(i){switch(h8(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function d8(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const f8=/^data:image\/svg\+xml/,p8=/\.svg((\?|#).*)?$/;function Nx(i){return i&&(f8.test(i)||p8.test(i))}function g8(i,e){if(Nx(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return L5(i,e)}function L5(i,e){if(Nx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function M5(i,e,t){const r=g8(i,t),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await m8(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function m8(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,n)=>{try{t.onload=()=>r(t),t.onerror=o=>n(new Error("Could not load image ".concat(i,": ").concat(o)))}catch(o){n(o)}})}const y8={};let P5=!0;async function _8(i,e,t){let r;Nx(t)?r=await M5(i,e,t):r=L5(i,t);const n=e&&e.imagebitmap;return await v8(r,n)}async function v8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((b8(e)||!P5)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),P5=!1}return await createImageBitmap(i)}function b8(i){for(const e in i||y8)return!1;return!0}function x8(i){return!E8(i,"ftyp",4)||!(i[8]&96)?null:w8(i)}function w8(i){switch(B8(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function B8(i,e,t){return String.fromCharCode(...i.slice(e,t))}function C8(i){return[...i].map(e=>e.charCodeAt(0))}function E8(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=C8(e);for(let n=0;n<r.length;++n)if(r[n]!==i[n+t])return!1;return!0}const Ih=!1,wm=!0;function zx(i){const e=Bm(i);return T8(e)||M8(e)||I8(e)||L8(e)||S8(e)}function S8(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=x8(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function T8(i){const e=Bm(i);return e.byteLength>=24&&e.getUint32(0,Ih)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ih),height:e.getUint32(20,Ih)}:null}function I8(i){const e=Bm(i);return e.byteLength>=10&&e.getUint32(0,Ih)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,wm),height:e.getUint16(8,wm)}:null}function L8(i){const e=Bm(i);return e.byteLength>=14&&e.getUint16(0,Ih)===16973&&e.getUint32(2,wm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,wm),height:e.getUint32(22,wm)}:null}function M8(i){const e=Bm(i);if(!(e.byteLength>=3&&e.getUint16(0,Ih)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=P8();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,Ih);if(n.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Ih),width:e.getUint16(o+7,Ih)};if(!r.has(c))return null;o+=2,o+=e.getUint16(o,Ih)}return null}function P8(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bm(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function F8(i,e){const{mimeType:t}=zx(i)||{},r=globalThis._parseImageNode;return Is(r),await r(i,t)}async function D8(i,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=t||{},c=R8(n);let s;switch(c){case"imagebitmap":s=await _8(i,e,o);break;case"image":s=await M5(i,e,o);break;case"data":s=await F8(i);break;default:Is(!1)}return n==="data"&&(s=A8(s)),s}function R8(i){switch(i){case"auto":case"data":return u8();default:return c8(i),i}}const F5={id:"image",module:"images",name:"Images",version:a8,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:D8,tests:[i=>!!zx(new DataView(i))],options:{image:{type:"auto",decode:!0}}},Qx={};function k8(i){if(Qx[i]===void 0){const e=t_?U8(i):O8(i);Qx[i]=e}return Qx[i]}function O8(i){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:r=e}=globalThis;return!!t&&r.includes(i)}function U8(i){switch(i){case"image/avif":case"image/webp":return N8(i);default:return!0}}function N8(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}function D5(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function uA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||D5()}const o_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},a_=o_.window||o_.self||o_.global,Cm=o_.process||{},R5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";uA();const Vx=globalThis;function k5(i){if(!i&&!uA())return"Node";if(D5(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n?"IE":Vx.chrome?"Chrome":Vx.safari?"Safari":Vx.mozInnerScreenX?"Firefox":"Unknown"}function z8(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class Q8{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ye(this,"storage",void 0),ye(this,"id",void 0),ye(this,"config",void 0),this.storage=z8(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function V8(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function H8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return"".concat(" ".repeat(t)).concat(i)}function Hx(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,c=i.height*t,s=["font-size:1px;","padding:".concat(Math.floor(c/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(c,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(c,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let l_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(l_||(l_={}));function O5(i){return typeof i=="string"?l_[i.toUpperCase()]||l_.WHITE:i}function G8(i,e,t){return!uA&&typeof i=="string"&&(e&&(e=O5(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),t&&(e=O5(t),i="\x1B[".concat(t+10,"m").concat(i,"\x1B[49m"))),i}function j8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t);for(const n of r)typeof i[n]=="function"&&(e.find(o=>n===o)||(i[n]=i[n].bind(i)))}function c_(i,e){if(!i)throw new Error(e||"Assertion failed")}function Cp(){let i;if(uA&&"performance"in a_){var e,t;i=a_==null||(e=a_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Cm){var r;const n=Cm==null||(r=Cm.hrtime)===null||r===void 0?void 0:r.call(Cm);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const Ep={debug:uA&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},q8={enabled:!0,level:0};function mu(){}const U5={},N5={once:!0};class Gx{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ye(this,"id",void 0),ye(this,"VERSION",R5),ye(this,"_startTs",Cp()),ye(this,"_deltaTs",Cp()),ye(this,"_storage",void 0),ye(this,"userData",{}),ye(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Q8("__probe-".concat(this.id,"__"),q8),this.timeStamp("".concat(this.id," started")),j8(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Cp()-this._startTs).toPrecision(10))}getDelta(){return Number((Cp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){c_(e,t)}warn(e){return this._getLogFunction(0,e,Ep.warn,arguments,N5)}error(e){return this._getLogFunction(0,e,Ep.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Ep.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Ep.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,Ep.debug||Ep.info,arguments,N5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||mu,r&&[r],{tag:X8(t)}):mu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:c=1}=e;return this._shouldLog(t||r)?uA?W8({image:n,message:o,scale:c}):K8():mu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||mu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=Q5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||mu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=z5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=Q5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,c_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Cp();const c=o.tag||o.message;if(o.once)if(!U5[c])U5[c]=Cp();else return mu;return t=$8(this.id,o.message,o),r.bind(console,t,...o.args)}return mu}}ye(Gx,"VERSION",R5);function z5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return c_(Number.isFinite(e)&&e>=0),e}function Q5(i){const{logLevel:e,message:t}=i;i.logLevel=z5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return c_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function $8(i,e,t){if(typeof e=="string"){const r=t.time?H8(V8(t.total)):"";e=t.time?"".concat(i,": ").concat(r,"  ").concat(e):"".concat(i,": ").concat(e),e=G8(e,t.color,t.background)}return e}function K8(i){return console.warn("removed"),mu}function W8(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const c=Hx(o,t,r);console.log(...c)},o.src=e,mu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Hx(e,t,r)),mu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Hx(o,t,r)),o.src=e.toDataURL(),mu}return mu}function X8(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const Dn=new Gx({id:"deck"}),GA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},jx=1,Em=2,qx=3,$x=4,Z8=2,J8=i=>({"layer.changeFlag":(e,t,r)=>{i.log(qx,"".concat(e.id," ").concat(t,": "),r[t])()},"layer.initialize":e=>{i.log(jx,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const r=e.getChangeFlags();i.log(Em,"Updating ".concat(e," because: ").concat(Object.keys(r).filter(n=>r[n]).join(", ")))()}else i.log($x,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&i.log($x,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{i.log(jx,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,r)=>{t?i.log(Em,"Composite layer rendered new subLayers ".concat(e),r)():i.log($x,"Composite layer reused subLayers ".concat(e),r)()},"layerManager.setLayers":(e,t,r)=>{t&&i.log(Em,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{i.log(qx,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,r)=>{i.log(jx,r?"invalidated attributes ".concat(r," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{GA.attributeUpdateMessages.length=0,GA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const r=Math.round(Date.now()-GA.attributeManagerUpdateStart);i.groupCollapsed(Em,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(r,"ms"))();for(const n of GA.attributeUpdateMessages)i.log(qx,n)();i.groupEnd(Em)()},"attribute.updateStart":e=>{GA.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const r="".concat(e.id," allocated ").concat(t);GA.attributeUpdateMessages.push(r)},"attribute.updateEnd":(e,t)=>{const r=Math.round(Date.now()-GA.attributeUpdateStart),n="".concat(e.id," updated ").concat(t," in ").concat(r,"ms");GA.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(e,t,r)=>{const{pass:n,redrawReason:o,stats:c}=r;for(const s of t){const{totalCount:m,visibleCount:x,compositeCount:I,pickableCount:F}=s,z=m-I-x;i.log(Z8,"RENDER #".concat(e.renderCount,"   ").concat(x," (of ").concat(m," layers) to ").concat(n," because ").concat(o,"   (").concat(z," hidden, ").concat(I," composite ").concat(F," pickable)"))(),c&&c.get("Redraw Layers").add(x)}}});var Y8={};let u_={};Y8.NODE_ENV!=="production"&&(u_=J8(Dn));function eQ(i){u_=i}function bl(i,e,t,r){Dn.level>0&&u_[i]&&u_[i].call(null,e,t,r)}function tQ(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const iQ={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:tQ,parseTextSync:JSON.parse};function rQ(){const i="8.9.34",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(i));return e||(Dn.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:Dn,_registerLoggers:eQ},Rz([iQ,[F5,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const nQ=rQ(),Ln={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ln,"IDENTITY",{get:()=>(Dn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Lh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Kx={common:0,meters:1,pixels:2},V5={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ar=new Gx({id:"luma.gl"});function Yl(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const sQ="Invalid WebGLRenderingContext",oQ="Requires WebGL2";function h_(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function hn(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function aQ(i){return hn(i)?i:null}function A_(i){return Yl(h_(i),sQ),i}function ec(i){return Yl(hn(i),oQ),i}const Sm={};function lQ(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function cQ(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function uQ(i,e){Sm[i]=!0,e!==void 0&&lQ(e)}function hQ(i){const e=i.getError;i.getError=function(){let r;do r=e.apply(i),r!==0&&(Sm[r]=!0);while(r!==0);for(r in Sm)if(Sm[r])return delete Sm[r],parseInt(r,10);return 0}}const Tm=function i(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const n=new i.VertexAttrib(t);this.attribs[r]=n}this.maxAttrib=0};Tm.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},Tm.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Jd=function(e){const t=this;this.gl=e,hQ(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const c=t.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,o);const s=c.attribs[o];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const c=t.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,o);const s=c.attribs[o];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,c){switch(o){case 34962:t.currentArrayBuffer=c;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=c;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,c){const m=t.currentVertexArrayObject.attribs[o];switch(c){case 34975:return m.buffer;case 34338:return m.enabled;case 34339:return m.size;case 34340:return m.stride;case 34341:return m.type;case 34922:return m.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,c,s,m,x,I){const F=t.currentVertexArrayObject;F.maxAttrib=Math.max(F.maxAttrib,o);const O=F.attribs[o];return O.buffer=t.currentArrayBuffer,O.size=c,O.type=s,O.normalized=m,O.stride=x,O.offset=I,O.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{cQ("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Jd.prototype.VERTEX_ARRAY_BINDING_OES=34229,Jd.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new Tm(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Jd.prototype.createVertexArrayOES=function(){const e=new Tm(this);return this.vertexArrayObjects.push(e),e},Jd.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},Jd.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Tm&&e.hasBeenBound&&e.ext===this)},Jd.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){uQ(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(n===o)return;(!n||o.elementArrayBuffer!==n.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let c=this.currentArrayBuffer;const s=Math.max(n?n.maxAttrib:0,o.maxAttrib);for(let m=0;m<=s;m++){const x=o.attribs[m],I=n?n.attribs[m]:null;if((!n||x.enabled!==I.enabled)&&(x.enabled?r.enableVertexAttribArray.call(t,m):r.disableVertexAttribArray.call(t,m)),x.enabled){let F=!1;(!n||x.buffer!==I.buffer)&&(c!==x.buffer&&(r.bindBuffer.call(t,34962,x.buffer),c=x.buffer),F=!0),(F||x.cached!==I.cached)&&r.vertexAttribPointer.call(t,m,x.size,x.type,x.normalized,x.stride,x.offset)}}this.currentArrayBuffer!==c&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function AQ(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const n=e.call(this)||[];return n.indexOf("OES_vertex_array_object")<0&&n.push("OES_vertex_array_object"),n};const t=i.getExtension;i.getExtension=function(n){const o=t.call(this,n);return o||(n!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Jd(this)),this.__OESVertexArrayObject))}}const H5="OES_element_index",G5="WEBGL_draw_buffers",dQ="EXT_disjoint_timer_query",fQ="EXT_disjoint_timer_query_webgl2",pQ="EXT_texture_filter_anisotropic",j5="WEBGL_debug_renderer_info",gQ=35723,mQ=4352,yQ=36795,_Q=34047,vQ=37445,bQ=37446,Ns=i=>hn(i)?void 0:0,xQ={3074:i=>hn(i)?void 0:36064,[gQ]:i=>hn(i)?void 0:mQ,35977:Ns,32937:Ns,[yQ]:(i,e)=>{const t=hn(i)?i.getExtension(fQ):i.getExtension(dQ);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[vQ]:(i,e)=>{const t=i.getExtension(j5);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[bQ]:(i,e)=>{const t=i.getExtension(j5);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[_Q]:(i,e)=>{const t=i.luma.extensions[pQ];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Ns,35071:Ns,37447:Ns,36063:(i,e)=>{if(!hn(i)){const t=i.getExtension(G5);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Ns,35374:Ns,35377:Ns,34852:i=>{if(!hn(i)){const e=i.getExtension(G5);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(H5)?2147483647:65535,33001:i=>i.getExtension(H5)?16777216:65535,33e3:i=>16777216,37157:Ns,35373:Ns,35657:Ns,36183:Ns,37137:Ns,34045:Ns,35978:Ns,35979:Ns,35968:Ns,35376:Ns,35375:Ns,35659:Ns,37154:Ns,35371:Ns,35658:Ns,35076:Ns,35077:Ns,35380:Ns};function wQ(i,e,t){const r=xQ[t],n=typeof r=="function"?r(i,e,t):r;return n!==void 0?n:e(t)}const BQ="OES_vertex_array_object",q5="ANGLE_instanced_arrays",CQ="WEBGL_draw_buffers",EQ="EXT_disjoint_timer_query",SQ="EXT_texture_filter_anisotropic",TQ="VertexArray requires WebGL2 or OES_vertex_array_object extension";function IQ(i,e){return{webgl2:hn(i),ext:i.getExtension(e)}}const $5={[BQ]:{meta:{suffix:"OES"},createVertexArray:()=>{Yl(!1,TQ)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[q5]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){Yl(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[CQ]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Yl(!1)}},[EQ]:{meta:{suffix:"EXT"},createQuery:()=>{Yl(!1)},deleteQuery:()=>{Yl(!1)},beginQuery:()=>{Yl(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},Wx={readBuffer:(i,e,t)=>{hn(i)&&e(t)},getVertexAttrib:(i,e,t,r)=>{const{webgl2:n,ext:o}=IQ(i,q5);let c;switch(r){case 35069:c=n?void 0:!1;break;case 35070:c=!n&&!o?0:void 0;break}return c!==void 0?c:e(t,r)},getProgramParameter:(i,e,t,r)=>{if(!hn(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(i,e,t,r,n)=>{if(!hn(i))switch(n){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(t,r,n)},getTexParameter(i,e,t,r){switch(r){case 34046:const{extensions:n}=i.luma,o=n[SQ];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:wQ,hint(i,e,t,r){return e(t,r)}};function LQ(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||(AQ(i),MQ(i),FQ(i,$5),PQ(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=LQ;function MQ(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const t of e)i.luma[t]=i.getExtension(t)}function PQ(i,e){let{target:t,target2:r}=e;Object.keys(Wx).forEach(n=>{if(typeof Wx[n]=="function"){const o=i[n]?i[n].bind(i):()=>{},c=Wx[n].bind(null,i,o);t[n]=c,r[n]=c}})}function FQ(i,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&DQ(i,{extension:t,target:i.luma,target2:i})}function DQ(i,e){let{extension:t,target:r,target2:n}=e;const o=$5[t];Yl(o);const{meta:c={}}=o,{suffix:s=""}=c,m=i.getExtension(t);for(const x of Object.keys(o)){const I="".concat(x).concat(s);let F=null;x==="meta"||typeof i[x]=="function"||(m&&typeof m[I]=="function"?F=function(){return m[I](...arguments)}:typeof o[x]=="function"&&(F=o[x].bind(r))),F&&(r[x]=F,n[x]=F)}}const Xx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},jA=(i,e,t)=>e?i.enable(t):i.disable(t),K5=(i,e,t)=>i.hint(t,e),Gc=(i,e,t)=>i.pixelStorei(t,e),RQ=(i,e)=>{const t=hn(i)?36009:36160;return i.bindFramebuffer(t,e)},kQ=(i,e)=>i.bindFramebuffer(36008,e);function Im(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const OQ={3042:jA,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:jA,2885:(i,e)=>i.cullFace(e),2929:jA,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:jA,35723:K5,36006:RQ,2886:(i,e)=>i.frontFace(e),33170:K5,2849:(i,e)=>i.lineWidth(e),32823:jA,32824:"polygonOffset",10752:"polygonOffset",35977:jA,32938:"sampleCoverage",32939:"sampleCoverage",3089:jA,3088:(i,e)=>i.scissor(...e),2960:jA,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),3333:Gc,3317:Gc,37440:Gc,37441:Gc,37443:Gc,3330:Gc,3332:Gc,3331:Gc,36010:kQ,3314:Gc,32878:Gc,3316:Gc,3315:Gc,32877:Gc,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=Im(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=Im(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=Im(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=Im(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,c,s]=e;i.stencilFuncSeparate(1028,t,r,n),i.stencilFuncSeparate(1029,o,c,s)},stencilOp:(i,e)=>{e=Im(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,c,s]=e;i.stencilOpSeparate(1028,t,r,n),i.stencilOpSeparate(1029,o,c,s)},viewport:(i,e)=>i.viewport(...e)};function bo(i,e,t){return e[i]!==void 0?e[i]:t[i]}const UQ={blendEquation:(i,e,t)=>i.blendEquationSeparate(bo(32777,e,t),bo(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(bo(32969,e,t),bo(32968,e,t),bo(32971,e,t),bo(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(bo(32824,e,t),bo(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(bo(32938,e,t),bo(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,bo(2962,e,t),bo(2967,e,t),bo(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,bo(34816,e,t),bo(36003,e,t),bo(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,bo(2964,e,t),bo(2965,e,t),bo(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,bo(34817,e,t),bo(34818,e,t),bo(34819,e,t))},W5={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},blendColor:(i,e,t,r,n)=>i({32773:new Float32Array([e,t,r,n])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,n)=>i({32969:e,32968:t,32971:r,32970:n}),clearColor:(i,e,t,r,n)=>i({3106:new Float32Array([e,t,r,n])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,n)=>i({3107:[e,t,r,n]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,n)=>i({3088:new Int32Array([e,t,r,n])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,n)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:n}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,n)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:n}),viewport:(i,e,t,r,n)=>i({2978:[e,t,r,n]})},Mh=(i,e)=>i.isEnabled(e),X5={3042:Mh,2884:Mh,2929:Mh,3024:Mh,32823:Mh,32926:Mh,32928:Mh,3089:Mh,2960:Mh,35977:Mh};function Z5(i){for(const e in i)return!1;return!0}function NQ(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let n=0;n<i.length;++n)if(i[n]!==e[n])return!1;return!0}return!1}function J5(i,e){const t=i[e].bind(i);i[e]=function(){const n=arguments.length<=0?void 0:arguments[0];return n in i.state.cache?i.state.enable?i.state.cache[n]:t(...arguments):t(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function zQ(i,e,t){const r=i[e].bind(i);i[e]=function(){for(var o=arguments.length,c=new Array(o),s=0;s<o;s++)c[s]=arguments[s];const{valueChanged:m,oldValue:x}=t(i.state._updateCache,...c);return m&&r(...c),x},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function QQ(i){const e=i.useProgram.bind(i);i.useProgram=function(r){i.state.program!==r&&(e(r),i.state.program=r)}}class VQ{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?GQ(e):Object.assign({},Xx),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Yl(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];hA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){Yl(o!==void 0);const c=e[o],s=this.cache[o];NQ(c,s)||(t=!0,r=s,n&&!(o in n)&&(n[o]=s),this.cache[o]=c)}return{valueChanged:t,oldValue:r}}}function Y5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(Yl(r!==void 0),!i.state){const{polyfillContext:n}=globalThis;n&&n(i),i.state=new VQ(i,{copyState:r}),QQ(i);for(const o in W5){const c=W5[o];zQ(i,o,c)}J5(i,"getParameter"),J5(i,"isEnabled")}return i.state.enable=t,i}function HQ(i){i.state||Y5(i,{copyState:!1}),i.state.push()}function eI(i){Yl(i.state),i.state.pop()}function hA(i,e){if(Yl(h_(i),"setParameters requires a WebGL context"),Z5(e))return;const t={};for(const n in e){const o=Number(n),c=OQ[n];c&&(typeof c=="string"?t[c]=!0:c(i,e[n],o))}const r=i.state&&i.state.cache;if(r)for(const n in t){const o=UQ[n];o(i,e,r)}}function GQ(i,e){if(e=e||Xx,typeof e=="number"){const n=e,o=X5[n];return o?o(i,n):i.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const n of t){const o=X5[n];r[n]=o?o(i,Number(n)):i.getParameter(Number(n))}return r}function jQ(i){hA(i,Xx)}function Gu(i,e,t){if(Z5(e))return t(i);const{nocatch:r=!0}=e;HQ(i),hA(i,e);let n;if(r)n=t(i),eI(i);else try{n=t(i)}finally{eI(i)}return n}function Sp(i){const{luma:e}=i;if(i.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function Zx(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Sp(i),n=i.drawingBufferWidth,o=i.drawingBufferHeight;return $Q(e,r,n,o,t)}function qQ(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function $Q(i,e,t,r,n){const o=tI(i[0],e,t);let c=iI(i[1],e,r,n),s=tI(i[0]+1,e,t);const m=s===t-1?s:s-1;s=iI(i[1]+1,e,r,n);let x;return n?(s=s===0?s:s+1,x=c,c=s):x=s===r-1?s:s-1,{x:o,y:c,width:Math.max(m-o+1,1),height:Math.max(x-c+1,1)}}function tI(i,e,t){return Math.min(Math.round(i*e),t-1)}function iI(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const Jx=uA(),KQ=Jx&&typeof document<"u",rI={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function nI(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yl(Jx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},rI,i);const{width:e,height:t}=i;function r(s){if(i.throwOnError)throw new Error(s);return console.error(s),null}i.onError=r;let n;const{canvas:o}=i,c=JQ({canvas:o,width:e,height:t,onError:r});return n=ZQ(c,i),n?(n=Yx(n,i),YQ(n),n):null}function Yx(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||eV(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},rI,e);const{manageState:t,debug:r}=e;return t&&Y5(i,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return ar.log(1,...o)()}}),Jx&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),ar.level=Math.max(ar.level,1)):ar.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function WQ(i){const e=i.getParameter(7936),t=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),n=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function XQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=qQ(e.useDevicePixels);tV(i,r,e);return}const t=i.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function ZQ(i,e){const{onError:t}=e;let r=null;const n=m=>r=m.statusMessage||r;i.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:c=!0}=e;let s=null;return c&&(s=s||i.getContext("webgl2",e),s=s||i.getContext("experimental-webgl2",e)),o&&(s=s||i.getContext("webgl",e),s=s||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):t("Failed to create ".concat(c&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function JQ(i){let{canvas:e,width:t=800,height:r=600,onError:n}=i,o;return typeof e=="string"?(KQ&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function YQ(i){const e=hn(i)?"WebGL2":"WebGL1",t=WQ(i),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",n=i.debug?" debug":"";ar.info(1,"".concat(e).concat(n," context ").concat(r))()}function eV(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function tV(i,e,t){let r="width"in t?t.width:i.canvas.clientWidth,n="height"in t?t.height:i.canvas.clientHeight;(!r||!n)&&(ar.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=i.canvas.width||1,n=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const o=i.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==e){let c=e;const s=Math.floor(r*c),m=Math.floor(n*c);i.canvas.width=s,i.canvas.height=m,(i.drawingBufferWidth!==s||i.drawingBufferHeight!==m)&&(ar.warn("Device pixel ratio clamped")(),c=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/n),i.canvas.width=Math.floor(r*c),i.canvas.height=Math.floor(n*c)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:e})}}function sI(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let oI=class{constructor(e,t){ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"sampleSize",1),ye(this,"time",void 0),ye(this,"count",void 0),ye(this,"samples",void 0),ye(this,"lastTiming",void 0),ye(this,"lastSampleTime",void 0),ye(this,"lastSampleCount",void 0),ye(this,"_count",0),ye(this,"_time",0),ye(this,"_samples",0),ye(this,"_startTime",0),ye(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=sI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(sI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},ew=class{constructor(e){ye(this,"id",void 0),ye(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof oI?this.stats[t]=e:this.stats[t]=new oI(t,r)),this.stats[t]}};const Lm="8.5.21",iV="set luma.log.level=1 (or higher) to trace rendering";class rV{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new ew({id:e})),this.stats.get(e)}}const Yd=new rV;if(globalThis.luma&&globalThis.luma.VERSION!==Lm)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Lm));globalThis.luma||(uA()&&ar.log(1,"luma.gl ".concat(Lm," - ").concat(iV))(),globalThis.luma=globalThis.luma||{VERSION:Lm,version:Lm,log:ar,stats:Yd,globals:{modules:{},nodeIO:{}}});function nV(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function sV(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function Xi(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function tw(i,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=i[e];return Xi(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function qA(i,e){e=Number(e);for(const t in i)if(i[t]===e)return"GL.".concat(t);return String(e)}const iw={};function AA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";iw[i]=iw[i]||1;const e=iw[i]++;return"".concat(i,"-").concat(e)}function aI(i){return Xi(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Tp(i){let e=!0;for(const t in i){e=!1;break}return e}function lI(i,e,t,r){const n="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(i);r.forEach(c=>{o.methodName||(o[c]=()=>{throw ar.removed("Calling removed method ".concat(e,".").concat(c,": "),n)(),new Error(c)})})}const Ip="Resource subclass must define virtual methods";let dA=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};A_(e);const{id:r,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=r||AA(this[Symbol.toStringTag]),this.userData=n,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=tw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=hn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const s=n.webgl1,m="webgl2"in n?n.webgl2:n.webgl1;return o?m:s}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,n=this.constructor.PARAMETERS||{},o=hn(this.gl),c={},s=t||Object.keys(n);for(const m of s){const x=n[m];if(x&&(!("webgl2"in x)||o)&&(!("extension"in x)||this.gl.getExtension(x.extension))){const F=r?qA(this.gl,m):m;c[F]=this.getParameter(m,e),r&&x.type==="GLenum"&&(c[F]=qA(this.gl,c[F]))}}return c}setParameter(e,t){e=tw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=hn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");n.type==="GLenum"&&(t=tw(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return lI(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(Ip)}_deleteHandle(){throw new Error(Ip)}_bindHandle(e){throw new Error(Ip)}_getOptsFromHandle(){throw new Error(Ip)}_getParameter(e,t){throw new Error(Ip)}_setParameter(e,t){throw new Error(Ip)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=Yd.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Yd.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const n=Yd.get("Memory Usage".concat(r));n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Yd.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const oV="Failed to deduce GL constant from typed array";function rw(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(oV)}}function Mm(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function aV(i){let{data:e,width:t,height:r,bytesPerPixel:n=4,temp:o}=i;const c=t*n;o=o||new Uint8Array(c);for(let s=0;s<r/2;++s){const m=s*c,x=(r-s-1)*c;o.set(e.subarray(m,m+c)),e.copyWithin(m,x,x+c),e.set(o,x)}}function lV(i){let{data:e,width:t,height:r}=i;const n=Math.round(t/2),o=Math.round(r/2),c=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let m=0;m<n;m++)for(let x=0;x<4;x++)c[(s*n+m)*4+x]=e[(s*2*t+m*2)*4+x];return{data:c,width:n,height:o}}function nw(i,e,t){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=t;for(const s in r)if(s in e){const x=r[s]?"".concat(i,".").concat(r[s]):"N/A";ar.removed("".concat(i,".").concat(s),x)()}for(const s in n)if(s in e){const m=n[s];ar.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(m))()}let c=null;for(const s in o)if(s in e){const m=o[s];ar.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(m))(),c=c||Object.assign({},e),c[m]=e[s],delete c[s]}return c||e}const cV={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},uV={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class bc{static getBytesPerElement(e){return Mm(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Xi(e.size),Mm(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new bc(cV,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return bc.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return bc.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=nw("Accessor",e,uV),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const cI=10,uI={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},hV={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:uI},AV={removedProps:uI};class vs extends dA{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/bc.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/bc.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=nw("Buffer",e,hV),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=nw("Buffer",e,AV),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new bc(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,o=e.byteLength||e.length;Xi(t);const c=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(c,this.handle),n!==0||o!==void 0?(ec(this.gl),this.gl.bufferSubData(this.target,r,t,n,o)):this.gl.bufferSubData(c,r,t),this.gl.bindBuffer(c,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:n=0,size:o}=e;const{gl:c}=this;return ec(c),c.bindBuffer(36662,t.handle),c.bindBuffer(36663,this.handle),c.copyBufferSubData(36662,36663,r,n,o),c.bindBuffer(36662,null),c.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ec(this.gl);const o=Mm(this.accessor.type||5126,{clamped:!1}),c=this._getAvailableElementCount(t),s=r;let m,x;e?(x=e.length,m=x-s):(m=Math.min(c,n||c),x=s+m);const I=Math.min(c,m);return n=n||I,Xi(n<=I),e=e||new o(x),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,n),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?n!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,n):(Xi(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(cI,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Xi(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,cI),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=rw(e);return Xi(o),this.setAccessor(new bc(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Xi(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=Mm(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new bc(this.accessor,{type:rw(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return ar.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return ar.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return ar.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return ar.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new bc(this.accessor,e),this}}const sw={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},hI={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},AI={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function dV(i,e){const t=sw[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=hn(i)&&t.gl2||t.gl1;return typeof r=="string"?i.getExtension(r):r}function fV(i,e){const t=sw[e];switch(t&&t.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const pV=[9729,9728],dI=globalThis.WebGLBuffer||function(){};class Lp extends dA{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:n}=t;let o=!0;return r&&(o=o&&dV(e,r),o=o&&(!n||fV(e,r))),o}constructor(e,t){const{id:r=AA("texture"),handle:n,target:o}=t;super(e,{id:r,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(de=>this.initialize(Object.assign({},e,{pixels:de,data:de}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:o=6408,border:c=0,recreate:s=!1,parameters:m={},pixelStore:x={},textureUnit:I=void 0}=e;t||(t=n);let{width:F,height:O,dataFormat:z,type:ie,compressed:ne=!1,mipmaps:ue=!0}=e;const{depth:ce=0}=e;return{width:F,height:O,compressed:ne,dataFormat:z,type:ie}=this._deduceParameters({format:o,type:ie,dataFormat:z,compressed:ne,data:t,width:F,height:O}),this.width=F,this.height=O,this.depth=ce,this.format=o,this.type=ie,this.dataFormat=z,this.border=c,this.textureUnit=I,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ue&&this._isNPOT()&&(ar.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ue=!1,this._updateForNPOT(m)),this.mipmaps=ue,this.setImageData({data:t,width:F,height:O,depth:ce,format:o,type:ie,dataFormat:z,border:c,mipmaps:ue,parameters:x,compressed:ne}),ue&&this.generateMipmap(),this.setParameters(m),s&&(this.data=t),r&&(this._video={video:t,parameters:m,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:n=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ar.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Gu(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:n=0,format:o=this.format,border:c=this.border,offset:s=0,parameters:m={}}=e;let{data:x=null,type:I=this.type,width:F=this.width,height:O=this.height,dataFormat:z=this.dataFormat,compressed:ie=!1}=e;x||(x=r),{type:I,dataFormat:z,compressed:ie,width:F,height:O}=this._deduceParameters({format:o,type:I,dataFormat:z,compressed:ie,data:x,width:F,height:O});const{gl:ne}=this;ne.bindTexture(this.target,this.handle);let ue=null;({data:x,dataType:ue}=this._getDataType({data:x,compressed:ie}));let ce,de=0;if(Gu(this.gl,m,()=>{switch(ue){case"null":ne.texImage2D(t,n,o,F,O,c,z,I,x);break;case"typed-array":ne.texImage2D(t,n,o,F,O,c,z,I,x,s);break;case"buffer":ce=ec(ne),ce.bindBuffer(35052,x.handle||x),ce.texImage2D(t,n,o,F,O,c,z,I,s),ce.bindBuffer(35052,null);break;case"browser-object":hn(ne)?ne.texImage2D(t,n,o,F,O,c,z,I,x):ne.texImage2D(t,n,o,z,I,x);break;case"compressed":for(const[be,Te]of x.entries())ne.compressedTexImage2D(t,be,Te.format,Te.width,Te.height,c,Te.data),de+=Te.levelSize;break;default:Xi(!1,"Unknown image data type")}}),ue==="compressed")this._trackAllocatedMemory(de,"Texture");else if(x&&x.byteLength)this._trackAllocatedMemory(x.byteLength,"Texture");else{const be=hI[this.dataFormat]||4,Te=AI[this.type]||1;this._trackAllocatedMemory(this.width*this.height*be*Te,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:n=null,x:o=0,y:c=0,width:s=this.width,height:m=this.height,level:x=0,format:I=this.format,type:F=this.type,dataFormat:O=this.dataFormat,compressed:z=!1,offset:ie=0,border:ne=this.border,parameters:ue={}}=e;if({type:F,dataFormat:O,compressed:z,width:s,height:m}=this._deduceParameters({format:I,type:F,dataFormat:O,compressed:z,data:n,width:s,height:m}),Xi(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const ce=n;n=ce.data,s=ce.shape[0],m=ce.shape[1]}n instanceof vs&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Gu(this.gl,ue,()=>{if(z)this.gl.compressedTexSubImage2D(t,x,o,c,s,m,I,n);else if(n===null)this.gl.texSubImage2D(t,x,o,c,s,m,O,F,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,x,o,c,s,m,O,F,n,ie);else if(n instanceof dI){const ce=ec(this.gl);ce.bindBuffer(35052,n),ce.texSubImage2D(t,x,o,c,s,m,O,F,ie),ce.bindBuffer(35052,null)}else hn(this.gl)?ec(this.gl).texSubImage2D(t,x,o,c,s,m,O,F,n):this.gl.texSubImage2D(t,x,o,c,O,F,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return ar.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof vs?{data:t.handle,dataType:"buffer"}:t instanceof dI?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:o,dataFormat:c,type:s,compressed:m}=e;const x=sw[t];return c=c||x&&x.dataFormat,s=s||x&&x.types[0],m=m||x&&x.compressed,{width:n,height:o}=this._deduceImageSize(r,n,o),{dataFormat:c,type:s,compressed:m,width:n,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:t,height:r}:n={width:t>=0?t:1,height:r>=0?r:1},Xi(n,"Could not deduced texture size"),Xi(t===void 0||n.width===t,"Deduced texture width does not match supplied width"),Xi(r===void 0||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Xi(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return hn(this.gl)||!this.width||!this.height?!1:!aI(this.width)||!aI(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:pV.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let gV="";function mV(i,e){return Xi(typeof i=="string"),i=gV+i,new Promise((t,r)=>{try{const n=new Image;n.onload=()=>t(n),n.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=i}catch(n){r(n)}})}class jc extends Lp{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Lp.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};A_(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:mV(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const ow=[34069,34070,34071,34072,34073,34074];class fI extends Lp{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};A_(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:n=0,y:o=0,mipmapLevel:c=0}=e;return this._subImage({target:t,data:r,x:n,y:o,mipmapLevel:c})}async setCubeMapImageData(e){let{width:t,height:r,pixels:n,data:o,border:c=0,format:s=6408,type:m=5121}=e;const{gl:x}=this,I=n||o,F=await Promise.all(ow.map(O=>{const z=I[O];return Promise.all(Array.isArray(z)?z:[z])}));this.bind(),ow.forEach((O,z)=>{F[z].length>1&&this.opts.mipmaps!==!1&&ar.warn("".concat(this.id," has mipmap and multiple LODs."))(),F[z].forEach((ie,ne)=>{t&&r?x.texImage2D(O,ne,s,t,r,c,s,m,ie):x.texImage2D(O,ne,s,s,m,ie)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:o,data:c,border:s=0,format:m=6408,type:x=5121}=e,{gl:I}=this,F=o||c;return this.bind(),F instanceof Promise?F.then(O=>this.setImageDataForFace(Object.assign({},e,{face:t,data:O,pixels:O}))):this.width||this.height?I.texImage2D(t,0,m,r,n,s,m,x,F):I.texImage2D(t,0,m,m,x,F),this}}fI.FACES=ow;class yV extends Lp{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ec(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:n,height:o,depth:c=1,border:s=0,format:m,type:x=5121,offset:I=0,data:F,parameters:O={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Gu(this.gl,O,()=>{ArrayBuffer.isView(F)&&this.gl.texImage3D(this.target,t,r,n,o,c,s,m,x,F),F instanceof vs&&(this.gl.bindBuffer(35052,F.handle),this.gl.texImage3D(this.target,t,r,n,o,c,s,m,x,I))}),F&&F.byteLength)this._trackAllocatedMemory(F.byteLength,"Texture");else{const z=hI[this.dataFormat]||4,ie=AI[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*z*ie,"Texture")}return this.loaded=!0,this}}const ef="EXT_color_buffer_float",pI={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:ef,bpp:2},33327:{gl2:ef,bpp:4},34842:{gl2:ef,bpp:8},33326:{gl2:ef,bpp:4},33328:{gl2:ef,bpp:8},34836:{gl2:ef,bpp:16},35898:{gl2:ef,bpp:4}};function _V(i,e,t){const r=t[e];if(!r)return!1;const n=hn(i)&&r.gl2||r.gl1;return typeof n=="string"?i.getExtension(n):n}class Mp extends dA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||_V(e,t,pI)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:n=1,samples:o=0}=e;return Xi(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&hn(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,n):this.gl.renderbufferStorage(36161,t,r,n),this.format=t,this.width=r,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*pI[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const vV=256,bV=1024,xV=16384,gI=6144,mI=6145,yI=6146,_I=34041,vI="clear: bad arguments";function aw(i){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let c=0;t&&(c|=xV,t!==!0&&(o.clearColor=t)),r&&(c|=vV,r!==!0&&(o.clearDepth=r)),n&&(c|=bV,r!==!0&&(o.clearStencil=r)),Xi(c!==0,vI),Gu(i,o,()=>{i.clear(c)})}function wV(i){let{framebuffer:e=null,buffer:t=gI,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ec(i),Gu(i,{framebuffer:e},()=>{switch(t){case gI:switch(n.constructor){case Int32Array:i.clearBufferiv(t,r,n);break;case Uint32Array:i.clearBufferuiv(t,r,n);break;case Float32Array:default:i.clearBufferfv(t,r,n)}break;case mI:i.clearBufferfv(mI,0,[n]);break;case yI:i.clearBufferiv(yI,0,[n]);break;case _I:const[o,c]=n;i.clearBufferfi(_I,0,o,c);break;default:Xi(!1,vI)}})}function BV(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xi(!1),0}}function d_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:c=null,sourceWidth:s,sourceHeight:m,sourceType:x}=e;const{framebuffer:I,deleteFramebuffer:F}=CV(i);Xi(I);const{gl:O,handle:z,attachments:ie}=I;s=s||I.width,m=m||I.height,o===36064&&z===null&&(o=1028),Xi(ie[o]),x=x||ie[o].type,c=EV(c,x,n,s,m),x=x||rw(c);const ne=O.bindFramebuffer(36160,z);return O.readPixels(t,r,s,m,n,x,c),O.bindFramebuffer(36160,ne||null),F&&I.delete(),c}function bI(i){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=d_(i,{sourceAttachment:e}),{width:n,height:o}=i;for(;o>t;)({data:r,width:n,height:o}=lV({data:r,width:n,height:o}));aV({data:r,width:n,height:o});const c=document.createElement("canvas");c.width=n,c.height=o;const s=c.getContext("2d"),m=s.createImageData(n,o);return m.data.set(r),s.putImageData(m,0,0),c.toDataURL()}function CV(i){return i instanceof ba?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:RV(i),deleteFramebuffer:!0}}function EV(i,e,t,r,n){if(i)return i;e=e||5121;const o=Mm(e,{clamped:!1}),c=BV(t);return new o(r*n*c)}const zs={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function SV(i){const e=new jc(i,{format:6408,type:5126,dataFormat:6408}),t=new ba(i,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const xI={[zs.WEBGL2]:[!1,!0],[zs.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[zs.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[zs.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[zs.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[zs.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[zs.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[zs.FLOAT_BLEND]:["EXT_float_blend"],[zs.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[zs.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[zs.TEXTURE_FLOAT]:["OES_texture_float",!0],[zs.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[zs.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[zs.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[zs.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[zs.COLOR_ATTACHMENT_RGBA32F]:[SV,"EXT_color_buffer_float"],[zs.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[zs.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[zs.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[zs.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[zs.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[zs.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},TV=2;function lw(i,e){return wI(i,e)}function wI(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>BI(i,t))}function IV(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in xI)i.luma.caps[e]===void 0&&(i.luma.caps[e]=BI(i,e));return i.luma.caps}function BI(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=LV(i,e)),i.luma.caps[e]||ar.log(TV,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function LV(i,e){const t=xI[e];Xi(t,e);let r;const n=hn(i)&&t[1]||t[0];if(typeof n=="function")r=n(i);else if(Array.isArray(n)){r=!0;for(const o of n)r=r&&!!i.getExtension(o)}else typeof n=="string"?r=!!i.getExtension(n):typeof n=="boolean"?r=n:Xi(!1);return r}const CI="Multiple render targets not supported";class ba extends dA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:n}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new ba(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=ec(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=ec(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:n=null,color:o=!0,depth:c=!0,stencil:s=!1,check:m=!0,readBuffer:x=void 0,drawBuffers:I=void 0}=e;if(Xi(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,n)for(const F in n){const O=n[F];(Array.isArray(O)?O[0]:O).resize({width:t,height:r})}else n=this._createDefaultAttachments(o,c,s,t,r);this.update({clearAttachments:!0,attachments:n,readBuffer:x,drawBuffers:I}),n&&m&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:c=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:c});const{gl:s}=this,m=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,m||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Xi(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&ar.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const n in this.attachments)this.attachments[n].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&Object.keys(this.attachments).forEach(c=>{n[c]=null}),Object.assign(n,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const c in n){Xi(c!==void 0,"Misspelled framebuffer binding point?");const s=Number(c),m=n[s];let x=m;if(!x)this._unattach(s);else if(x instanceof Mp)this._attachRenderbuffer({attachment:s,renderbuffer:x});else if(Array.isArray(m)){const[I,F=0,O=0]=m;x=I,this._attachTexture({attachment:s,texture:I,layer:F,level:O})}else this._attachTexture({attachment:s,texture:x,layer:0,level:0});r&&x&&x.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(c=>!this.attachments[c]).forEach(c=>{delete this.attachments[c]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(PV(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:n,drawBuffers:o=[]}=e,c=this.gl.bindFramebuffer(36160,this.handle);return(t||r||n)&&aw(this.gl,{color:t,depth:r,stencil:n}),o.forEach((s,m)=>{wV(this.gl,{drawBuffer:m,value:s})}),this.gl.bindFramebuffer(36160,c||null),this}readPixels(){return ar.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return ar.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return ar.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return ar.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return ar.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return ar.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:n=0,width:o,height:c}=e;const s=ec(this.gl),m=s.bindFramebuffer(36008,this.handle);return r===0&&n===0&&o===void 0&&c===void 0?s.invalidateFramebuffer(36008,t):s.invalidateFramebuffer(36008,t,r,n,o,c),s.bindFramebuffer(36008,m),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=qA(this.gl,n)),n}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of r){const c=t?qA(this.gl,o):o;n[c]=this.getAttachmentParameter(e,o,t)}return n}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const n of t){const o=Number(n),c=e?qA(this.gl,o):o;r[c]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(bI(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>ar.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=bI(this,{targetMaxHeight:100});return ar.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,o){let c=null;return e&&(c=c||{},c[36064]=new jc(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(c[36064])),t&&r?(c=c||{},c[33306]=new Mp(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(c[33306])):t?(c=c||{},c[36096]=new Mp(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(c[36096])):r&&Xi(!1),c}_unattach(e){const t=this.attachments[e];t&&(t instanceof Mp?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:n,level:o}=e;const{gl:c}=this;switch(c.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:ec(c).framebufferTextureLayer(36160,t,r.target,o,n);break;case 34067:const m=MV(n);c.framebufferTexture2D(36160,t,m,r.handle,o);break;case 3553:c.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Xi(!1,"Illegal texture type")}c.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=aQ(this.gl);t?t.readBuffer(e):Xi(e===36064||e===1029,CI),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=ec(t);if(r)r.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Xi(e.length===1&&(e[0]===36064||e[0]===1029),CI)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=IV(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function MV(i){return i<34069?i+34069:i}function PV(i){return(ba.STATUS||{})[i]||"Framebuffer error ".concat(i)}const FV=[36049,36048,33296,33298,33299,33300,33301,33302,33303];ba.ATTACHMENT_PARAMETERS=FV;function DV(i,e){Xi(i instanceof jc||i instanceof fI||i instanceof yV);const t=i.constructor,{gl:r,width:n,height:o,format:c,type:s,dataFormat:m,border:x,mipmaps:I}=i,F=Object.assign({width:n,height:o,format:c,type:s,dataFormat:m,border:x,mipmaps:I},e);return new t(r,F)}function RV(i,e){const{gl:t,width:r,height:n,id:o}=i;return new ba(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{36064:i}}))}function f_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(t);return r?r[1]:e}const kV=35632,OV=35633;function UV(i){switch(i){case kV:return"fragment";case OV:return"vertex";default:return"unknown type"}}function NV(i,e,t,r){const n=i.split(/\r?\n/),o={},c={},s=r||f_(e)||"(unnamed)",m="".concat(UV(t)," shader ").concat(s);for(let I=0;I<n.length;I++){const F=n[I];if(F.length<=1)continue;const O=F.split(":"),z=O[0],ie=parseInt(O[2],10);if(isNaN(ie))throw new Error("GLSL compilation error in ".concat(m,": ").concat(i));z!=="WARNING"?o[ie]=F:c[ie]=F}const x=zV(e);return{shaderName:m,errors:EI(o,x),warnings:EI(c,x)}}function EI(i,e){let t="";for(let r=0;r<e.length;r++){const n=e[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(t+="".concat(n,`
`),i[r+1])){const o=i[r+1],c=o.split(":",3),s=c[0],m=parseInt(c[1],10)||0,x=o.substring(c.join(":").length+1).trim();t+=SI("^^^ ".concat(s,": ").concat(x,`

`),m)}}return t}function zV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),n=String(r.length+e-1).length;return r.map((o,c)=>{const s=String(c+e),m=s.length;return SI(s,n-m)+t+o})}function SI(i,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(i)}function TI(i){let e=100;const t=i.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const QV="Shader: GLSL source code must be a JavaScript string";class Pm extends dA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Xi(!1),"unknown"}}constructor(e,t){A_(e),Xi(typeof t.source=="string",QV);const r=f_(t.source,null)||t.id||AA("unnamed ".concat(Pm.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=f_(t,null);r&&(this.id=AA(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Pm.getTypeName(this.shaderType),":").concat(this.id)}getName(){return f_(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:n,errors:o,warnings:c}=NV(r,this.source,this.shaderType,this.id);throw ar.error("GLSL compilation errors in ".concat(n,`
`).concat(o))(),ar.warn("GLSL compilation warnings in ".concat(n,`
`).concat(c))(),new Error("GLSL compilation errors in ".concat(n))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class cw extends Pm{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class uw extends Pm{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const VV={5126:Gs.bind(null,"uniform1fv",qc,1,xl),35664:Gs.bind(null,"uniform2fv",qc,2,xl),35665:Gs.bind(null,"uniform3fv",qc,3,xl),35666:Gs.bind(null,"uniform4fv",qc,4,xl),5124:Gs.bind(null,"uniform1iv",$A,1,xl),35667:Gs.bind(null,"uniform2iv",$A,2,xl),35668:Gs.bind(null,"uniform3iv",$A,3,xl),35669:Gs.bind(null,"uniform4iv",$A,4,xl),35670:Gs.bind(null,"uniform1iv",$A,1,xl),35671:Gs.bind(null,"uniform2iv",$A,2,xl),35672:Gs.bind(null,"uniform3iv",$A,3,xl),35673:Gs.bind(null,"uniform4iv",$A,4,xl),35674:Gs.bind(null,"uniformMatrix2fv",qc,4,fA),35675:Gs.bind(null,"uniformMatrix3fv",qc,9,fA),35676:Gs.bind(null,"uniformMatrix4fv",qc,16,fA),35678:Ya,35680:Ya,5125:Gs.bind(null,"uniform1uiv",p_,1,xl),36294:Gs.bind(null,"uniform2uiv",p_,2,xl),36295:Gs.bind(null,"uniform3uiv",p_,3,xl),36296:Gs.bind(null,"uniform4uiv",p_,4,xl),35685:Gs.bind(null,"uniformMatrix2x3fv",qc,6,fA),35686:Gs.bind(null,"uniformMatrix2x4fv",qc,8,fA),35687:Gs.bind(null,"uniformMatrix3x2fv",qc,6,fA),35688:Gs.bind(null,"uniformMatrix3x4fv",qc,12,fA),35689:Gs.bind(null,"uniformMatrix4x2fv",qc,8,fA),35690:Gs.bind(null,"uniformMatrix4x3fv",qc,12,fA),35678:Ya,35680:Ya,35679:Ya,35682:Ya,36289:Ya,36292:Ya,36293:Ya,36298:Ya,36299:Ya,36300:Ya,36303:Ya,36306:Ya,36307:Ya,36308:Ya,36311:Ya},HV={},GV={},jV={},II=[0];function hw(i,e,t,r){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(II[0]=i,i=II);const n=i.length;if(n%e&&ar.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof t)return i;let o=r[n];o||(o=new t(n),r[n]=o);for(let c=0;c<n;c++)o[c]=i[c];return o}function qc(i,e){return hw(i,e,Float32Array,HV)}function $A(i,e){return hw(i,e,Int32Array,GV)}function p_(i,e){return hw(i,e,Uint32Array,jV)}function LI(i,e,t){const r=VV[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,i,e)}function qV(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=i.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function $V(i,e,t){for(const r in i){const n=i[r];if((!t||!!t[r])&&!KV(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),n),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function KV(i){return Array.isArray(i)||ArrayBuffer.isView(i)?XV(i):isFinite(i)||i===!0||i===!1||i instanceof Lp||i instanceof Mp?!0:i instanceof ba?!!i.texture:!1}function WV(i,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(i[e]){const r=i[e];for(let n=0,o=t.length;n<o;++n)r[n]=t[n]}else i[e]=t.slice();else i[e]=t}function XV(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(i[t]))return!1;return!0}function Ya(){let i=null;return(e,t,r)=>{const n=i!==r;return n&&(e.uniform1i(t,r),i=r),n}}function Gs(i,e,t,r){let n=null,o=null;return(c,s,m)=>{const x=e(m,t),I=x.length;let F=!1;if(n===null)n=new Float32Array(I),o=I,F=!0;else{Xi(o===I,"Uniform length cannot change.");for(let O=0;O<I;++O)if(x[O]!==n[O]){F=!0;break}}return F&&(r(c,i,s,x),n.set(x)),F}}function xl(i,e,t,r){i[e](t,r)}function fA(i,e,t,r){i[e](t,!1,r)}const ZV=5120,JV=5121,YV=5122,e9=5123,MI=0,g_=1,t9=2,i9=3,m_=4,r9=5,n9=6,xa=5126,s9=35664,o9=35665,a9=35666,Fm=5124,l9=35667,c9=35668,u9=35669,Dm=5125,h9=36294,A9=36295,d9=36296,f9=35670,p9=35671,g9=35672,m9=35673,y9=35674,_9=35675,v9=35676,b9=35685,x9=35686,w9=35687,B9=35688,C9=35689,E9=35690,Aw={[xa]:[xa,1,"float"],[s9]:[xa,2,"vec2"],[o9]:[xa,3,"vec3"],[a9]:[xa,4,"vec4"],[Fm]:[Fm,1,"int"],[l9]:[Fm,2,"ivec2"],[c9]:[Fm,3,"ivec3"],[u9]:[Fm,4,"ivec4"],[Dm]:[Dm,1,"uint"],[h9]:[Dm,2,"uvec2"],[A9]:[Dm,3,"uvec3"],[d9]:[Dm,4,"uvec4"],[f9]:[xa,1,"bool"],[p9]:[xa,2,"bvec2"],[g9]:[xa,3,"bvec3"],[m9]:[xa,4,"bvec4"],[y9]:[xa,8,"mat2"],[b9]:[xa,8,"mat2x3"],[x9]:[xa,8,"mat2x4"],[_9]:[xa,12,"mat3"],[w9]:[xa,12,"mat3x2"],[B9]:[xa,12,"mat3x4"],[v9]:[xa,16,"mat4"],[C9]:[xa,16,"mat4x2"],[E9]:[xa,16,"mat4x3"]};function S9(i){switch(i){case MI:return MI;case g_:return g_;case i9:return g_;case t9:return g_;case m_:return m_;case r9:return m_;case n9:return m_;default:return Xi(!1),0}}function PI(i){const e=Aw[i];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function FI(i,e){switch(i){case ZV:case JV:case YV:case e9:i=xa;break}for(const t in Aw){const[r,n,o]=Aw[t];if(r===i&&n===e)return{glType:t,name:o}}return null}class T9{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let n=0;n<r;n++){const{name:o,type:c,size:s}=t.getActiveAttrib(e.handle,n),m=t.getAttribLocation(e.handle,o);m>=0&&this._addAttribute(m,o,c,s)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!hn(t))return;const r=t.getProgramParameter(e.handle,35971);for(let n=0;n<r;n++){const{name:o,type:c,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,o,c,s)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(e,t,r,n){const{type:o,components:c}=PI(r),s={type:o,size:n*c};this._inferProperties(e,t,s);const m={location:e,name:t,accessor:new bc(s)};this.attributeInfos.push(m),this.attributeInfosByLocation[e]=m,this.attributeInfosByName[m.name]=m}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:o,components:c}=PI(r),s=new bc({type:o,size:n*c}),m={location:e,name:t,accessor:s};this.varyingInfos.push(m),this.varyingInfosByName[m.name]=m}}const DI=4,I9=35981,L9=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class RI extends dA{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",L9),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:n,varyings:o,bufferMode:c=I9}=e;return this.hash=t||"",this.vs=typeof r=="string"?new cw(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof n=="string"?new uw(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Xi(this.vs instanceof cw),Xi(this.fs instanceof uw),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(ec(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new T9(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:n,offset:o=0,start:c,end:s,isIndexed:m=!1,indexType:x=5123,instanceCount:I=0,isInstanced:F=I>0,vertexArray:O=null,transformFeedback:z,framebuffer:ie,parameters:ne={},uniforms:ue,samplers:ce}=e;if((ue||ce)&&(ar.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ue||{})),ar.priority>=t){const de=ie?ie.id:"default",be="mode=".concat(qA(this.gl,r)," verts=").concat(n," ")+"instances=".concat(I," indexType=").concat(qA(this.gl,x)," ")+"isInstanced=".concat(F," isIndexed=").concat(m," ")+"Framebuffer=".concat(de);ar.log(t,be)()}return Xi(O),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||F&&I===0?!1:(O.bindForDraw(n,I,()=>{if(ie!==void 0&&(ne=Object.assign({},ne,{framebuffer:ie})),z){const de=S9(r);z.begin(de)}this._bindTextures(),Gu(this.gl,ne,()=>{m&&F?this.gl2.drawElementsInstanced(r,n,x,o,I):m&&hn(this.gl)&&!isNaN(c)&&!isNaN(s)?this.gl2.drawRangeElements(r,c,s,n,x,o):m?this.gl.drawElements(r,n,x,o):F?this.gl2.drawArraysInstanced(r,o,n,I):this.gl.drawArrays(r,o,n)}),z&&z.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ar.priority>=2&&$V(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let o=r,c=!1;if(o instanceof ba&&(o=o.texture),o instanceof Lp)if(c=this.uniforms[t]!==r,c){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:m}=n;s.bind(m),o=m,this._textureUniforms[t]=s}else o=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(o)||c)&&WV(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const n of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new cw({handle:n});break;case 35632:r.fs=new uw({handle:n});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=AA(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),ar.time(DI,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),ar.timeEnd(DI,"linkProgram for ".concat(this._getName()))(),e.debug||ar.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n}=qV(r.name);let o=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=LI(e,o,r),r.size>1)for(let c=0;c<r.size;c++)o=e.getUniformLocation(this.handle,"".concat(n,"[").concat(c,"]")),this._uniformSetters["".concat(n,"[").concat(c,"]")]=LI(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const M9=34918,P9=34919,F9=35007,D9=36795,R9=35976,k9=35887,O9=36202;class y_ extends dA{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=hn(e),n=wI(e,zs.TIMER_QUERY);let o=r||n;for(const c of t)switch(c){case"queries":o=o&&r;break;case"timers":o=o&&n;break;default:Xi(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(F9)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?O9:k9)}beginTransformFeedbackQuery(){return this.begin(R9)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,P9);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(D9)}getResult(){return this.gl2.getQueryParameter(this.handle,M9)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return y_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class kI extends dA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ec(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Tp(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:o,byteOffset:c}=this._getBufferParams(t);return r<0?(this.unused[e]=n,ar.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,c,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,n;return e instanceof vs?n=e:(n=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let __=null;function U9(i){return(!__||__.byteLength<i)&&(__=new ArrayBuffer(i)),__}function N9(i,e){const t=U9(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function z9(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,c=n*o;let s=0;for(let m=r;s<o;s++)e[m++]=t[s];for(;s<c;)s<c-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+c-s),s=c);return e}const Q9="elements must be GL.ELEMENT_ARRAY_BUFFER";class $c extends dA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?hn(e)||k5()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new $c(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return $c.MAX_ATTRIBUTES=$c.MAX_ATTRIBUTES||e.getParameter(34921),$c.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:$c._setConstantFloatArray(e,t,r);break;case Int32Array:$c._setConstantIntArray(e,t,r);break;case Uint32Array:$c._setConstantUintArray(e,t,r);break;default:Xi(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return $c.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Xi(!e||e.target===34963,Q9),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:n,type:o,stride:c,offset:s,normalized:m,integer:x,divisor:I}=r,{gl:F,gl2:O}=this;return e=Number(e),this.bind(()=>{F.bindBuffer(34962,t.handle),x?(Xi(hn(F)),O.vertexAttribIPointer(e,n,o,c,s)):F.vertexAttribPointer(e,n,o,m,c,s),F.enableVertexAttribArray(e),O.vertexAttribDivisor(e,I||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!$c.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,o=r.length*e;let c=!this.buffer;if(this.buffer=this.buffer||new vs(this.gl,n),c=c||this.buffer.reallocate(n),c=c||!this._compareConstantArrayValues(r,this.bufferValue),c){const s=N9(t.constructor,o);z9({target:s,source:r,start:0,count:o}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Xi(!1)}}static _setConstantIntArray(e,t,r){switch(Xi(hn(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Xi(!1)}}static _setConstantUintArray(e,t,r){switch(Xi(hn(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Xi(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Xi(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const V9="VertexArray: attributes must be Buffers or constants (i.e. typed array)",H9=/^(.+)__LOCATION_([0-9]+)$/,G9=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class j9{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new $c(e),lI(this,"VertexArray","v6.0",G9),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new vs(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof vs&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof vs&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const o={location:-1,accessor:null},{location:c,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(c)||c<0)return this.unused[e]=t,ar.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const m=this._getAttributeInfo(s||c);if(!m)return o;const x=this.accessors[c]||{},I=bc.resolve(m.accessor,x,r,n),{size:F,type:O}=I;return Xi(Number.isFinite(F)&&Number.isFinite(O)),{location:c,accessor:I}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=H9.exec(e),n=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof vs)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof vs){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof vs){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(V9)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(e,t){if($c.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){$c.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:o}=n,c=o>0;if(e.isInstanced=e.isInstanced||c,r instanceof vs){const s=r;if(c){const m=s.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,m)}else{const m=s.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,m)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ar.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function q9(i,e){const{maxElts:t=16,size:r=1}=e;let n="[";for(let c=0;c<i.length&&c<t;++c)c>0&&(n+=",".concat(c%r===0?" ":"")),n+=Rm(i[c],e);const o=i.length>t?"...":"]";return"".concat(n).concat(o)}function Rm(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return q9(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<t)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const n=i.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function OI(i){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}=i;Xi(t);const o=".*_.*",c=".*Matrix",s=t._uniformSetters,m={},x=Object.keys(s).sort();let I=0;for(const z of x)!z.match(o)&&!z.match(c)&&dw({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&I++;for(const z of x)z.match(c)&&dw({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&I++;for(const z of x)m[z]||dw({table:m,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&I++;let F=0;const O={};if(!n)for(const z in r){const ie=r[z];m[z]||(F++,O[z]={Type:"NOT USED: ".concat(ie),[e]:Rm(ie)})}return{table:m,count:I,unusedTable:O,unusedCount:F}}function dw(i){let{table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:o}=i;const c=r[n],s=$9(c);return!o||!s?(e[n]={[t]:s?Rm(c):"N/A","Uniform Type":s?c:"NOT PROVIDED"},!0):!1}function $9(i){return i!=null}function K9(i){let{vertexArray:e,header:t="Attributes"}=i;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=UI(e,e.elements,null,t));const n=e.values;for(const o in n){const c=e._getAttributeInfo(o);if(c){let s="".concat(o,": ").concat(c.name);const m=e.accessors[c.location];m&&(s="".concat(o,": ").concat(W9(c.name,m))),r[s]=UI(e,n[o],m,t)}}return r}function UI(i,e,t,r){const{gl:n}=i;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",c=1,s=0,m=0,x,I,F;if(t&&(o=t.type,c=t.size,o=String(o).replace("Array",""),x=o.indexOf("nt")!==-1),e instanceof vs){const O=e,{data:z,changed:ie}=O.getDebugData();I=ie?"*":"",F=z,m=O.byteLength,s=m/z.BYTES_PER_ELEMENT/c;let ne;if(t){const ue=t.divisor>0;ne="".concat(ue?"I ":"P "," ").concat(s," (x").concat(c,"=").concat(m," bytes ").concat(qA(n,o),")")}else x=!0,ne="".concat(m," bytes");return{[r]:"".concat(I).concat(Rm(F,{size:c,isInteger:x})),"Format ":ne}}return F=e,c=e.length,o=String(e.constructor.name).replace("Array",""),x=o.indexOf("nt")!==-1,{[r]:"".concat(Rm(F,{size:c,isInteger:x})," (constant)"),"Format ":"".concat(c,"x").concat(o," (constant)")}}function W9(i,e){const{type:t,size:r}=e,n=FI(t,r);return n?"".concat(i," (").concat(n.name,")"):i}function X9(i){const e={},t="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const n=NI(r);e["in ".concat(n)]={[t]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const n=NI(r);e["out ".concat(n)]={[t]:JSON.stringify(r.accessor)}}return e}function NI(i){const{type:e,size:t}=i.accessor,r=FI(e,t);return r?"".concat(r.name," ").concat(i.name):i.name}const zI=uA()&&typeof document<"u";let Z9=0;class J9{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=ue=>nI(ue),onAddHTML:r=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:c=()=>{},onError:s,gl:m=null,glOptions:x={},debug:I=!1,createFramebuffer:F=!1,autoResizeViewport:O=!0,autoResizeDrawingBuffer:z=!0,stats:ie=Yd.get("animation-loop-".concat(Z9++))}=e;let{useDevicePixels:ne=!0}=e;"useDevicePixelRatio"in e&&(ar.deprecated("useDevicePixelRatio","useDevicePixels")(),ne=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:o,onFinalize:c,onError:s,gl:m,glOptions:x,debug:I,createFramebuffer:F},this.gl=m,this.needsRedraw=null,this.timeline=null,this.stats=ie,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:O,autoResizeDrawingBuffer:z,useDevicePixels:ne}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Xi(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=y_.isSupported(this.gl,["timers"])?new y_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return ar.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=zI?new Promise((e,t)=>{if(zI&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):sV(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):nV(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Yx(this.props.gl,e):this.onCreateContext(e),!h_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");jQ(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&XQ(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ba(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const km="vs",fw="fs";function Kc(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const pw={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function Y9(i){const e={};for(const t in i){const r=i[t],n=eH(r);e[t]=n}return e}function eH(i){let e=QI(i);return e==="object"?i?"type"in i?Object.assign({},i,pw[i.type]):"value"in i?(e=QI(i.value),Object.assign({type:e},i,pw[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},pw[e])}function QI(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const tH="vs",iH="fs";class VI{constructor(e){let{name:t,vs:r,fs:n,dependencies:o=[],uniforms:c,getUniforms:s,deprecations:m=[],defines:x={},inject:I={},vertexShader:F,fragmentShader:O}=e;Kc(typeof t=="string"),this.name=t,this.vs=r||F,this.fs=n||O,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(m),this.defines=x,this.injections=rH(I),c&&(this.uniforms=Y9(c))}getModuleSource(e){let t;switch(e){case tH:t=this.vs||"";break;case iH:t=this.fs||"";break;default:Kc(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const n in r){const o=r[n];n in e&&!o.private?(o.validate&&Kc(o.validate(e[n],o),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=o.value}return t}}function rH(i){const e={vs:{},fs:{}};for(const t in i){let r=i[t];const n=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[n][t]=r}return e}function nH(i){return sH(GI(i))}function sH(i){const e={},t={};return HI({modules:i,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,n)=>t[n]-t[r]).map(r=>e[r])}function HI(i){let{modules:e,level:t,moduleMap:r,moduleDepth:n}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(n[o.name]===void 0||n[o.name]<t)&&(n[o.name]=t);for(const o of e)o.dependencies&&HI({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}function GI(i,e){return i.map(t=>(t instanceof VI||(Kc(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Kc(t.name,"shader module has no name"),t=new VI(t),t.dependencies=GI(t.dependencies)),t))}function oH(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=i.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n}const aH=7936,lH=7937,cH=7938,uH=35724,gw={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},tf={};Object.keys(gw).forEach(i=>{tf[i]=i});function hH(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function AH(i){const e=i.getExtension("WEBGL_debug_renderer_info"),t=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||aH),r=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||lH);return{gpuVendor:dH(t,r),vendor:t,renderer:r,version:i.getParameter(cH),shadingLanguageVersion:i.getParameter(uH)}}function dH(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const mw={};function jI(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=gw[e];if(Kc(r,e),!oH(t))return!0;if(e in mw)return mw[e];const n=r[0],o=t.behavior||"enable",c="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),s=i.createShader(35633);i.shaderSource(s,c),i.compileShader(s);const m=i.getShaderParameter(s,35713);return i.deleteShader(s),mw[e]=m,m}function fH(i,e){const t=gw[e];Kc(t,e);const r=hH(i)&&t[1]||t[0],n=typeof r=="string"?!!i.getExtension(r):r;return Kc(n===!1||n===!0),n}function v_(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>fH(i,t))}function pH(i){switch(AH(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function gH(i,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return v_(i,tf.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),v_(i,tf.GLSL_DERIVATIVES)&&jI(i,tf.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),v_(i,tf.GLSL_FRAG_DATA)&&jI(i,tf.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),v_(i,tf.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const mH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,yH=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,_H={[km]:mH,[fw]:yH},b_="__LUMA_INJECT_DECLARATIONS__",qI=/void\s+main\s*\([^)]*\)\s*\{\n?/,$I=/}\n?[^{}]*$/,yw=[];function KI(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=e===km;for(const o in t){const c=t[o];c.sort((m,x)=>m.order-x.order),yw.length=c.length;for(let m=0,x=c.length;m<x;++m)yw[m]=c[m].injection;const s="".concat(yw.join(`
`),`
`);switch(o){case"vs:#decl":n&&(i=i.replace(b_,s));break;case"vs:#main-start":n&&(i=i.replace(qI,m=>m+s));break;case"vs:#main-end":n&&(i=i.replace($I,m=>s+m));break;case"fs:#decl":n||(i=i.replace(b_,s));break;case"fs:#main-start":n||(i=i.replace(qI,m=>m+s));break;case"fs:#main-end":n||(i=i.replace($I,m=>s+m));break;default:i=i.replace(o,m=>m+s)}}return i=i.replace(b_,""),r&&(i=i.replace(/\}\s*$/,o=>o+_H[e])),i}function _w(i){const e={};return Kc(Array.isArray(i)&&i.length>1),i.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Pp(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const WI=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],vH=[...WI,[Pp("attribute"),"in $1"],[Pp("varying"),"out $1"]],bH=[...WI,[Pp("varying"),"in $1"]],XI=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],xH=[...XI,[Pp("in"),"attribute $1"],[Pp("out"),"varying $1"]],wH=[...XI,[Pp("in"),"varying $1"]],vw="gl_FragColor",bw=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,BH=/void\s+main\s*\([^)]*\)\s*\{\n?/;function CH(i,e,t){switch(e){case 300:return t?x_(i,vH):EH(i);case 100:return t?x_(i,xH):SH(i);default:throw new Error("unknown GLSL version ".concat(e))}}function x_(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function EH(i){i=x_(i,bH);const e=i.match(bw);if(e){const t=e[1];i=i.replace(new RegExp("\\b".concat(vw,"\\b"),"g"),t)}else{const t="fragmentColor";i=i.replace(BH,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(vw,"\\b"),"g"),t)}return i}function SH(i){i=x_(i,wH);const e=i.match(bw);if(e){const t=e[1];i=i.replace(bw,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),vw)}return i}const TH=`

`.concat(b_,`

`),ZI={[km]:"vertex",[fw]:"fragment"},IH=`precision highp float;

`;function LH(i,e){const{vs:t,fs:r}=e,n=nH(e.modules||[]);return{gl:i,vs:JI(i,Object.assign({},e,{source:t,type:km,modules:n})),fs:JI(i,Object.assign({},e,{source:r,type:fw,modules:n})),getUniforms:MH(n)}}function JI(i,e){let{id:t,source:r,type:n,modules:o,defines:c={},hookFunctions:s=[],inject:m={},transpileToGLSL100:x=!1,prologue:I=!0,log:F}=e;Kc(typeof r=="string","shader source must be a string");const O=n===km,z=r.split(`
`);let ie=100,ne="",ue=r;z[0].indexOf("#version ")===0?(ie=300,ne=z[0],ue=z.slice(1).join(`
`)):ne="#version ".concat(ie);const ce={};o.forEach($e=>{Object.assign(ce,$e.getDefines())}),Object.assign(ce,c);let de=I?"".concat(ne,`
`).concat(FH({id:t,source:r,type:n}),`
`).concat(PH({type:n}),`
`).concat(pH(i),`
`).concat(gH(i),`
`).concat(DH(ce),`
`).concat(O?"":IH,`
`):"".concat(ne,`
`);const be=kH(s),Te={},je={},Ge={};for(const $e in m){const Ue=typeof m[$e]=="string"?{injection:m[$e],order:0}:m[$e],lt=$e.match(/^(v|f)s:(#)?([\w-]+)$/);if(lt){const nt=lt[2],De=lt[3];nt?De==="decl"?je[$e]=[Ue]:Ge[$e]=[Ue]:Te[$e]=[Ue]}else Ge[$e]=[Ue]}for(const $e of o){F&&$e.checkDeprecations(ue,F);const Ue=$e.getModuleSource(n,ie);de+=Ue;const lt=$e.injections[n];for(const nt in lt){const De=nt.match(/^(v|f)s:#([\w-]+)$/);if(De){const Je=De[2]==="decl"?je:Ge;Je[nt]=Je[nt]||[],Je[nt].push(lt[nt])}else Te[nt]=Te[nt]||[],Te[nt].push(lt[nt])}}return de+=TH,de=KI(de,n,je),de+=RH(be[n],Te),de+=ue,de=KI(de,n,Ge),de=CH(de,x?100:ie,O),de}function MH(i){return function(t){const r={};for(const n of i){const o=n.getUniforms(t,r);Object.assign(r,o)}return r}}function PH(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(ZI[e].toUpperCase(),`
`)}function FH(i){let{id:e,source:t,type:r}=i;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(ZI[r],`

`):""}function DH(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in i){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const n=i[r];(n||Number.isFinite(n))&&(t+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return e===0&&(t+=`
`),t}function RH(i,e){let t="";for(const r in i){const n=i[r];if(t+="void ".concat(n.signature,` {
`),n.header&&(t+="  ".concat(n.header)),e[r]){const o=e[r];o.sort((c,s)=>c.order-s.order);for(const c of o)t+="  ".concat(c.injection,`
`)}n.footer&&(t+="  ".concat(n.footer)),t+=`}
`}return t}function kH(i){const e={vs:{},fs:{}};return i.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[n,o]=t.split(":"),c=t.replace(/\(.+/,"");e[n][c]=Object.assign(r,{signature:o})}),e}const OH="void main() {gl_FragColor = vec4(0);}",YI=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,UH=`#version 300 es
`.concat(YI);function e3(i,e){e=Array.isArray(e)?e:[e];const t=i.replace(/^\s+/,"").split(/\s+/),[r,n,o]=t;if(!e.includes(r)||!n||!o)return null;const c=o.split(";")[0];return{qualifier:r,type:n,name:c}}function t3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:n}=i;if(!t)return e===300?UH:e>300?"#version ".concat(e,`
`).concat(YI):OH;const o=QH(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function NH(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Kc(!1),null}}function zH(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Kc(!1),null}}function QH(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return Kc(!1),null}}const VH={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function ju(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const HH=1/Math.PI*180,GH=1/180*Math.PI,wa={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function jH(i){let{precision:e=wa.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=WH(i),"".concat(parseFloat(i.toPrecision(e)))}function KA(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function qH(i){return KH(i)}function $H(i){return pA(i)}function KH(i,e){return xw(i,t=>t*GH,e)}function pA(i,e){return xw(i,t=>t*HH,e)}function gA(i,e,t){return xw(i,r=>Math.max(e,Math.min(t,r)))}function w_(i,e,t){return KA(i)?i.map((r,n)=>w_(r,e[n],t)):t*e+(1-t)*i}function qu(i,e,t){const r=wa.EPSILON;t&&(wa.EPSILON=t);try{if(i===e)return!0;if(KA(i)&&KA(e)){if(i.length!==e.length)return!1;for(let n=0;n<i.length;++n)if(!qu(i[n],e[n]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=wa.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{wa.EPSILON=r}}function WH(i){return Math.round(i/wa.EPSILON)*wa.EPSILON}function XH(i){return i.clone?i.clone():new Array(i.length)}function xw(i,e,t){if(KA(i)){const r=i;t=t||XH(r);for(let n=0;n<t.length&&n<r.length;++n)t[n]=e(i[n],n,t);return t}return e(i)}function ZH(i){function e(){var t=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class ww extends ZH(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:KA(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(wa)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+jH(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!qu(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const o=e[n];this[n]=o+r*(t[n]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(wa.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function JH(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function ts(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function Om(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(wa.debug&&!JH(i,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return i}let Bw=class extends ww{get x(){return this[0]}set x(e){this[0]=ts(e)}get y(){return this[1]}set y(e){this[1]=ts(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-e[r];t+=n*n}return ts(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return ts(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ju(e>=0&&e<this.ELEMENTS,"index is out of range"),ts(this[e])}setComponent(e,t){return ju(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var Um=1e-6,$u=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function YH(){var i=new $u(2);return $u!=Float32Array&&(i[0]=0,i[1]=0),i}function i3(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function e7(i,e){return i[0]=-e[0],i[1]=-e[1],i}function r3(i,e,t,r){var n=e[0],o=e[1];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i}function t7(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i}function i7(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n+t[4],i[1]=t[1]*r+t[3]*n+t[5],i}function n3(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[3]*n+t[6],i[1]=t[1]*r+t[4]*n+t[7],i}function s3(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[4]*n+t[12],i[1]=t[1]*r+t[5]*n+t[13],i}(function(){var i=YH();return function(e,t,r,n,o,c){var s,m;for(t||(t=2),r||(r=0),n?m=Math.min(n*t+r,e.length):m=e.length,s=r;s<m;s+=t)i[0]=e[s],i[1]=e[s+1],o(i,i,c),e[s]=i[0],e[s+1]=i[1];return e}})();function o3(i,e,t){const r=e[0],n=e[1],o=t[3]*r+t[7]*n||1;return i[0]=(t[0]*r+t[4]*n)/o,i[1]=(t[1]*r+t[5]*n)/o,i}function a3(i,e,t){const r=e[0],n=e[1],o=e[2],c=t[3]*r+t[7]*n+t[11]*o||1;return i[0]=(t[0]*r+t[4]*n+t[8]*o)/c,i[1]=(t[1]*r+t[5]*n+t[9]*o)/c,i[2]=(t[2]*r+t[6]*n+t[10]*o)/c,i}function r7(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i}function n7(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i[3]=e[3],i}function l3(i,e,t){const r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[3]*n+t[6]*o,i[1]=t[1]*r+t[4]*n+t[7]*o,i[2]=t[2]*r+t[5]*n+t[8]*o,i[3]=e[3],i}class Cw extends Bw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),KA(e)&&arguments.length===1?this.copy(e):(wa.debug&&(ts(e),ts(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return wa.debug&&(ts(e.x),ts(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return s3(this,this,e),this.check()}transformAsVector(e){return o3(this,this,e),this.check()}transformByMatrix3(e){return n3(this,this,e),this.check()}transformByMatrix2x3(e){return i7(this,this,e),this.check()}transformByMatrix2(e){return t7(this,this,e),this.check()}}function c3(){var i=new $u(3);return $u!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function u3(i){var e=i[0],t=i[1],r=i[2];return Math.hypot(e,t,r)}function h3(i,e,t){var r=new $u(3);return r[0]=i,r[1]=e,r[2]=t,r}function s7(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function o7(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function a7(i,e){var t=e[0],r=e[1],n=e[2],o=t*t+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i}function Ew(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function B_(i,e,t){var r=e[0],n=e[1],o=e[2],c=t[0],s=t[1],m=t[2];return i[0]=n*m-o*s,i[1]=o*c-r*m,i[2]=r*s-n*c,i}function Sw(i,e,t){var r=e[0],n=e[1],o=e[2],c=t[3]*r+t[7]*n+t[11]*o+t[15];return c=c||1,i[0]=(t[0]*r+t[4]*n+t[8]*o+t[12])/c,i[1]=(t[1]*r+t[5]*n+t[9]*o+t[13])/c,i[2]=(t[2]*r+t[6]*n+t[10]*o+t[14])/c,i}function A3(i,e,t){var r=e[0],n=e[1],o=e[2];return i[0]=r*t[0]+n*t[3]+o*t[6],i[1]=r*t[1]+n*t[4]+o*t[7],i[2]=r*t[2]+n*t[5]+o*t[8],i}function d3(i,e,t){var r=t[0],n=t[1],o=t[2],c=t[3],s=e[0],m=e[1],x=e[2],I=n*x-o*m,F=o*s-r*x,O=r*m-n*s,z=n*O-o*F,ie=o*I-r*O,ne=r*F-n*I,ue=c*2;return I*=ue,F*=ue,O*=ue,z*=2,ie*=2,ne*=2,i[0]=s+I+z,i[1]=m+F+ie,i[2]=x+O+ne,i}function l7(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function c7(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function u7(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function h7(i,e){var t=i[0],r=i[1],n=i[2],o=e[0],c=e[1],s=e[2],m=Math.sqrt(t*t+r*r+n*n),x=Math.sqrt(o*o+c*c+s*s),I=m*x,F=I&&Ew(i,e)/I;return Math.acos(Math.min(Math.max(F,-1),1))}var A7=s7,d7=u3;(function(){var i=c3();return function(e,t,r,n,o,c){var s,m;for(t||(t=3),r||(r=0),n?m=Math.min(n*t+r,e.length):m=e.length,s=r;s<m;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],o(i,i,c),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];return e}})();const Tw=[0,0,0];let C_;class Ut extends Bw{static get ZERO(){return C_||(C_=new Ut(0,0,0),Object.freeze(C_)),C_}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&KA(e)?this.copy(e):(wa.debug&&(ts(e),ts(t),ts(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return wa.debug&&(ts(e.x),ts(e.y),ts(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ts(e)}angle(e){return h7(this,e)}cross(e){return B_(this,this,e),this.check()}rotateX(e){let{radians:t,origin:r=Tw}=e;return l7(this,this,r,t),this.check()}rotateY(e){let{radians:t,origin:r=Tw}=e;return c7(this,this,r,t),this.check()}rotateZ(e){let{radians:t,origin:r=Tw}=e;return u7(this,this,r,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Sw(this,this,e),this.check()}transformAsVector(e){return a3(this,this,e),this.check()}transformByMatrix3(e){return A3(this,this,e),this.check()}transformByMatrix2(e){return r7(this,this,e),this.check()}transformByQuaternion(e){return d3(this,this,e),this.check()}}let E_;class Iw extends Bw{static get ZERO(){return E_||(E_=new Iw(0,0,0,0),Object.freeze(E_)),E_}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),KA(e)&&arguments.length===1?this.copy(e):(wa.debug&&(ts(e),ts(t),ts(r),ts(n)),this[0]=e,this[1]=t,this[2]=r,this[3]=n)}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return wa.debug&&(ts(e.x),ts(e.y),ts(e.z),ts(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ts(e)}get w(){return this[3]}set w(e){this[3]=ts(e)}transform(e){return Sw(this,this,e),this.check()}transformByMatrix3(e){return l3(this,this,e),this.check()}transformByMatrix2(e){return n7(this,this,e),this.check()}transformByQuaternion(e){return d3(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class f3 extends ww{toString(){let e="[";if(wa.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=ts(r),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[r+n];return t}setColumn(e,t){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=t[n];return this}}function f7(){var i=new $u(9);return $u!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function p7(i,e){if(i===e){var t=e[1],r=e[2],n=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=n}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function g7(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=e[4],s=e[5],m=e[6],x=e[7],I=e[8],F=I*c-s*x,O=-I*o+s*m,z=x*o-c*m,ie=t*F+r*O+n*z;return ie?(ie=1/ie,i[0]=F*ie,i[1]=(-I*r+n*x)*ie,i[2]=(s*r-n*c)*ie,i[3]=O*ie,i[4]=(I*t-n*m)*ie,i[5]=(-s*t+n*o)*ie,i[6]=z*ie,i[7]=(-x*t+r*m)*ie,i[8]=(c*t-r*o)*ie,i):null}function m7(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],c=i[5],s=i[6],m=i[7],x=i[8];return e*(x*o-c*m)+t*(-x*n+c*s)+r*(m*n-o*s)}function p3(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3],s=e[4],m=e[5],x=e[6],I=e[7],F=e[8],O=t[0],z=t[1],ie=t[2],ne=t[3],ue=t[4],ce=t[5],de=t[6],be=t[7],Te=t[8];return i[0]=O*r+z*c+ie*x,i[1]=O*n+z*s+ie*I,i[2]=O*o+z*m+ie*F,i[3]=ne*r+ue*c+ce*x,i[4]=ne*n+ue*s+ce*I,i[5]=ne*o+ue*m+ce*F,i[6]=de*r+be*c+Te*x,i[7]=de*n+be*s+Te*I,i[8]=de*o+be*m+Te*F,i}function y7(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3],s=e[4],m=e[5],x=e[6],I=e[7],F=e[8],O=t[0],z=t[1];return i[0]=r,i[1]=n,i[2]=o,i[3]=c,i[4]=s,i[5]=m,i[6]=O*r+z*c+x,i[7]=O*n+z*s+I,i[8]=O*o+z*m+F,i}function _7(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3],s=e[4],m=e[5],x=e[6],I=e[7],F=e[8],O=Math.sin(t),z=Math.cos(t);return i[0]=z*r+O*c,i[1]=z*n+O*s,i[2]=z*o+O*m,i[3]=z*c-O*r,i[4]=z*s-O*n,i[5]=z*m-O*o,i[6]=x,i[7]=I,i[8]=F,i}function g3(i,e,t){var r=t[0],n=t[1];return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function v7(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=t+t,s=r+r,m=n+n,x=t*c,I=r*c,F=r*s,O=n*c,z=n*s,ie=n*m,ne=o*c,ue=o*s,ce=o*m;return i[0]=1-F-ie,i[3]=I-ce,i[6]=O+ue,i[1]=I+ce,i[4]=1-x-ie,i[7]=z-ne,i[2]=O-ue,i[5]=z+ne,i[8]=1-x-F,i}var Lw;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(Lw||(Lw={}));const b7=Object.freeze([1,0,0,0,1,0,0,0,1]);class xo extends f3{static get IDENTITY(){return w7()}static get ZERO(){return x7()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Lw}constructor(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(b7)}fromObject(e){return this.check()}fromQuaternion(e){return v7(this,e),this.check()}set(e,t,r,n,o,c,s,m,x){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=c,this[6]=s,this[7]=m,this[8]=x,this.check()}setRowMajor(e,t,r,n,o,c,s,m,x){return this[0]=e,this[1]=n,this[2]=s,this[3]=t,this[4]=o,this[5]=m,this[6]=r,this[7]=c,this[8]=x,this.check()}determinant(){return m7(this)}transpose(){return p7(this,this),this.check()}invert(){return g7(this,this),this.check()}multiplyLeft(e){return p3(this,e,this),this.check()}multiplyRight(e){return p3(this,this,e),this.check()}rotate(e){return _7(this,this,e),this.check()}scale(e){return Array.isArray(e)?g3(this,this,e):g3(this,this,[e,e]),this.check()}translate(e){return y7(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=n3(t||[-0,-0],e,this);break;case 3:r=A3(t||[-0,-0,-0],e,this);break;case 4:r=l3(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Om(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let S_,T_;function x7(){return S_||(S_=new xo([0,0,0,0,0,0,0,0,0]),Object.freeze(S_)),S_}function w7(){return T_||(T_=new xo,Object.freeze(T_)),T_}function B7(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function C7(i,e){if(i===e){var t=e[1],r=e[2],n=e[3],o=e[6],c=e[7],s=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=o,i[11]=e[14],i[12]=n,i[13]=c,i[14]=s}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Mw(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=e[4],s=e[5],m=e[6],x=e[7],I=e[8],F=e[9],O=e[10],z=e[11],ie=e[12],ne=e[13],ue=e[14],ce=e[15],de=t*s-r*c,be=t*m-n*c,Te=t*x-o*c,je=r*m-n*s,Ge=r*x-o*s,$e=n*x-o*m,Ue=I*ne-F*ie,lt=I*ue-O*ie,nt=I*ce-z*ie,De=F*ue-O*ne,Fe=F*ce-z*ne,Je=O*ce-z*ue,We=de*Je-be*Fe+Te*De+je*nt-Ge*lt+$e*Ue;return We?(We=1/We,i[0]=(s*Je-m*Fe+x*De)*We,i[1]=(n*Fe-r*Je-o*De)*We,i[2]=(ne*$e-ue*Ge+ce*je)*We,i[3]=(O*Ge-F*$e-z*je)*We,i[4]=(m*nt-c*Je-x*lt)*We,i[5]=(t*Je-n*nt+o*lt)*We,i[6]=(ue*Te-ie*$e-ce*be)*We,i[7]=(I*$e-O*Te+z*be)*We,i[8]=(c*Fe-s*nt+x*Ue)*We,i[9]=(r*nt-t*Fe-o*Ue)*We,i[10]=(ie*Ge-ne*Te+ce*de)*We,i[11]=(F*Te-I*Ge-z*de)*We,i[12]=(s*lt-c*De-m*Ue)*We,i[13]=(t*De-r*lt+n*Ue)*We,i[14]=(ne*be-ie*je-ue*de)*We,i[15]=(I*je-F*be+O*de)*We,i):null}function E7(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],c=i[5],s=i[6],m=i[7],x=i[8],I=i[9],F=i[10],O=i[11],z=i[12],ie=i[13],ne=i[14],ue=i[15],ce=e*c-t*o,de=e*s-r*o,be=e*m-n*o,Te=t*s-r*c,je=t*m-n*c,Ge=r*m-n*s,$e=x*ie-I*z,Ue=x*ne-F*z,lt=x*ue-O*z,nt=I*ne-F*ie,De=I*ue-O*ie,Fe=F*ue-O*ne;return ce*Fe-de*De+be*nt+Te*lt-je*Ue+Ge*$e}function rf(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3],s=e[4],m=e[5],x=e[6],I=e[7],F=e[8],O=e[9],z=e[10],ie=e[11],ne=e[12],ue=e[13],ce=e[14],de=e[15],be=t[0],Te=t[1],je=t[2],Ge=t[3];return i[0]=be*r+Te*s+je*F+Ge*ne,i[1]=be*n+Te*m+je*O+Ge*ue,i[2]=be*o+Te*x+je*z+Ge*ce,i[3]=be*c+Te*I+je*ie+Ge*de,be=t[4],Te=t[5],je=t[6],Ge=t[7],i[4]=be*r+Te*s+je*F+Ge*ne,i[5]=be*n+Te*m+je*O+Ge*ue,i[6]=be*o+Te*x+je*z+Ge*ce,i[7]=be*c+Te*I+je*ie+Ge*de,be=t[8],Te=t[9],je=t[10],Ge=t[11],i[8]=be*r+Te*s+je*F+Ge*ne,i[9]=be*n+Te*m+je*O+Ge*ue,i[10]=be*o+Te*x+je*z+Ge*ce,i[11]=be*c+Te*I+je*ie+Ge*de,be=t[12],Te=t[13],je=t[14],Ge=t[15],i[12]=be*r+Te*s+je*F+Ge*ne,i[13]=be*n+Te*m+je*O+Ge*ue,i[14]=be*o+Te*x+je*z+Ge*ce,i[15]=be*c+Te*I+je*ie+Ge*de,i}function I_(i,e,t){var r=t[0],n=t[1],o=t[2],c,s,m,x,I,F,O,z,ie,ne,ue,ce;return e===i?(i[12]=e[0]*r+e[4]*n+e[8]*o+e[12],i[13]=e[1]*r+e[5]*n+e[9]*o+e[13],i[14]=e[2]*r+e[6]*n+e[10]*o+e[14],i[15]=e[3]*r+e[7]*n+e[11]*o+e[15]):(c=e[0],s=e[1],m=e[2],x=e[3],I=e[4],F=e[5],O=e[6],z=e[7],ie=e[8],ne=e[9],ue=e[10],ce=e[11],i[0]=c,i[1]=s,i[2]=m,i[3]=x,i[4]=I,i[5]=F,i[6]=O,i[7]=z,i[8]=ie,i[9]=ne,i[10]=ue,i[11]=ce,i[12]=c*r+I*n+ie*o+e[12],i[13]=s*r+F*n+ne*o+e[13],i[14]=m*r+O*n+ue*o+e[14],i[15]=x*r+z*n+ce*o+e[15]),i}function Pw(i,e,t){var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function S7(i,e,t,r){var n=r[0],o=r[1],c=r[2],s=Math.hypot(n,o,c),m,x,I,F,O,z,ie,ne,ue,ce,de,be,Te,je,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et;return s<Um?null:(s=1/s,n*=s,o*=s,c*=s,m=Math.sin(t),x=Math.cos(t),I=1-x,F=e[0],O=e[1],z=e[2],ie=e[3],ne=e[4],ue=e[5],ce=e[6],de=e[7],be=e[8],Te=e[9],je=e[10],Ge=e[11],$e=n*n*I+x,Ue=o*n*I+c*m,lt=c*n*I-o*m,nt=n*o*I-c*m,De=o*o*I+x,Fe=c*o*I+n*m,Je=n*c*I+o*m,We=o*c*I-n*m,Et=c*c*I+x,i[0]=F*$e+ne*Ue+be*lt,i[1]=O*$e+ue*Ue+Te*lt,i[2]=z*$e+ce*Ue+je*lt,i[3]=ie*$e+de*Ue+Ge*lt,i[4]=F*nt+ne*De+be*Fe,i[5]=O*nt+ue*De+Te*Fe,i[6]=z*nt+ce*De+je*Fe,i[7]=ie*nt+de*De+Ge*Fe,i[8]=F*Je+ne*We+be*Et,i[9]=O*Je+ue*We+Te*Et,i[10]=z*Je+ce*We+je*Et,i[11]=ie*Je+de*We+Ge*Et,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function m3(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[4],c=e[5],s=e[6],m=e[7],x=e[8],I=e[9],F=e[10],O=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=o*n+x*r,i[5]=c*n+I*r,i[6]=s*n+F*r,i[7]=m*n+O*r,i[8]=x*n-o*r,i[9]=I*n-c*r,i[10]=F*n-s*r,i[11]=O*n-m*r,i}function T7(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],c=e[1],s=e[2],m=e[3],x=e[8],I=e[9],F=e[10],O=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n-x*r,i[1]=c*n-I*r,i[2]=s*n-F*r,i[3]=m*n-O*r,i[8]=o*r+x*n,i[9]=c*r+I*n,i[10]=s*r+F*n,i[11]=m*r+O*n,i}function y3(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],c=e[1],s=e[2],m=e[3],x=e[4],I=e[5],F=e[6],O=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n+x*r,i[1]=c*n+I*r,i[2]=s*n+F*r,i[3]=m*n+O*r,i[4]=x*n-o*r,i[5]=I*n-c*r,i[6]=F*n-s*r,i[7]=O*n-m*r,i}function I7(i,e){var t=e[0],r=e[1],n=e[2],o=e[4],c=e[5],s=e[6],m=e[8],x=e[9],I=e[10];return i[0]=Math.hypot(t,r,n),i[1]=Math.hypot(o,c,s),i[2]=Math.hypot(m,x,I),i}function L7(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=t+t,s=r+r,m=n+n,x=t*c,I=r*c,F=r*s,O=n*c,z=n*s,ie=n*m,ne=o*c,ue=o*s,ce=o*m;return i[0]=1-F-ie,i[1]=I+ce,i[2]=O-ue,i[3]=0,i[4]=I-ce,i[5]=1-x-ie,i[6]=z+ne,i[7]=0,i[8]=O+ue,i[9]=z-ne,i[10]=1-x-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function M7(i,e,t,r,n,o,c){var s=1/(t-e),m=1/(n-r),x=1/(o-c);return i[0]=o*2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*m,i[6]=0,i[7]=0,i[8]=(t+e)*s,i[9]=(n+r)*m,i[10]=(c+o)*x,i[11]=-1,i[12]=0,i[13]=0,i[14]=c*o*2*x,i[15]=0,i}function P7(i,e,t,r,n){var o=1/Math.tan(e/2),c;return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(c=1/(r-n),i[10]=(n+r)*c,i[14]=2*n*r*c):(i[10]=-1,i[14]=-2*r),i}var F7=P7;function D7(i,e,t,r,n,o,c){var s=1/(e-t),m=1/(r-n),x=1/(o-c);return i[0]=-2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+t)*s,i[13]=(n+r)*m,i[14]=(c+o)*x,i[15]=1,i}var R7=D7;function k7(i,e,t,r){var n,o,c,s,m,x,I,F,O,z,ie=e[0],ne=e[1],ue=e[2],ce=r[0],de=r[1],be=r[2],Te=t[0],je=t[1],Ge=t[2];return Math.abs(ie-Te)<Um&&Math.abs(ne-je)<Um&&Math.abs(ue-Ge)<Um?B7(i):(I=ie-Te,F=ne-je,O=ue-Ge,z=1/Math.hypot(I,F,O),I*=z,F*=z,O*=z,n=de*O-be*F,o=be*I-ce*O,c=ce*F-de*I,z=Math.hypot(n,o,c),z?(z=1/z,n*=z,o*=z,c*=z):(n=0,o=0,c=0),s=F*c-O*o,m=O*n-I*c,x=I*o-F*n,z=Math.hypot(s,m,x),z?(z=1/z,s*=z,m*=z,x*=z):(s=0,m=0,x=0),i[0]=n,i[1]=s,i[2]=I,i[3]=0,i[4]=o,i[5]=m,i[6]=F,i[7]=0,i[8]=c,i[9]=x,i[10]=O,i[11]=0,i[12]=-(n*ie+o*ne+c*ue),i[13]=-(s*ie+m*ne+x*ue),i[14]=-(I*ie+F*ne+O*ue),i[15]=1,i)}function O7(){var i=new $u(4);return $u!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function U7(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function _3(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function N7(i){var e=i[0],t=i[1],r=i[2],n=i[3];return Math.hypot(e,t,r,n)}function z7(i){var e=i[0],t=i[1],r=i[2],n=i[3];return e*e+t*t+r*r+n*n}function Q7(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=t*t+r*r+n*n+o*o;return c>0&&(c=1/Math.sqrt(c)),i[0]=t*c,i[1]=r*c,i[2]=n*c,i[3]=o*c,i}function V7(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function H7(i,e,t,r){var n=e[0],o=e[1],c=e[2],s=e[3];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i[2]=c+r*(t[2]-c),i[3]=s+r*(t[3]-s),i}function Nm(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*c,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*c,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*c,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*c,i}function G7(i,e,t){var r=e[0],n=e[1],o=e[2],c=t[0],s=t[1],m=t[2],x=t[3],I=x*r+s*o-m*n,F=x*n+m*r-c*o,O=x*o+c*n-s*r,z=-c*r-s*n-m*o;return i[0]=I*x+z*-c+F*-m-O*-s,i[1]=F*x+z*-s+O*-c-I*-m,i[2]=O*x+z*-m+I*-s-F*-c,i[3]=e[3],i}(function(){var i=O7();return function(e,t,r,n,o,c){var s,m;for(t||(t=4),r||(r=0),n?m=Math.min(n*t+r,e.length):m=e.length,s=r;s<m;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],o(i,i,c),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3];return e}})();var Fw;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(Fw||(Fw={}));const j7=45*Math.PI/180,q7=1,Dw=.1,Rw=500,$7=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Bn extends f3{static get IDENTITY(){return W7()}static get ZERO(){return K7()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Fw}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=c,this[6]=s,this[7]=m,this[8]=x,this[9]=I,this[10]=F,this[11]=O,this[12]=z,this[13]=ie,this[14]=ne,this[15]=ue,this.check()}setRowMajor(e,t,r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue){return this[0]=e,this[1]=o,this[2]=x,this[3]=z,this[4]=t,this[5]=c,this[6]=I,this[7]=ie,this[8]=r,this[9]=s,this[10]=F,this[11]=ne,this[12]=n,this[13]=m,this[14]=O,this[15]=ue,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy($7)}fromObject(e){return this.check()}fromQuaternion(e){return L7(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:n,top:o,near:c=Dw,far:s=Rw}=e;return s===1/0?X7(this,t,r,n,o,c):M7(this,t,r,n,o,c,s),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:n=[0,1,0]}=e;return k7(this,t,r,n),this.check()}ortho(e){const{left:t,right:r,bottom:n,top:o,near:c=Dw,far:s=Rw}=e;return R7(this,t,r,n,o,c,s),this.check()}orthographic(e){const{fovy:t=j7,aspect:r=q7,focalDistance:n=1,near:o=Dw,far:c=Rw}=e;v3(t);const s=t/2,m=n*Math.tan(s),x=m*r;return this.ortho({left:-x,right:x,bottom:-m,top:m,near:o,far:c})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:n=.1,far:o=500}=e;return v3(t),F7(this,t,r,n,o),this.check()}determinant(){return E7(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],c=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],c=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*c,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*c,e}transpose(){return C7(this,this),this.check()}invert(){return Mw(this,this),this.check()}multiplyLeft(e){return rf(this,e,this),this.check()}multiplyRight(e){return rf(this,this,e),this.check()}rotateX(e){return m3(this,this,e),this.check()}rotateY(e){return T7(this,this,e),this.check()}rotateZ(e){return y3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return S7(this,this,e,t),this.check()}scale(e){return Pw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return I_(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Nm(t||[-0,-0,-0,-0],e,this),Om(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let n;switch(r){case 2:n=s3(t||[-0,-0],e,this);break;case 3:n=Sw(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Om(n,e.length),n}transformAsVector(e,t){let r;switch(e.length){case 2:r=o3(t||[-0,-0],e,this);break;case 3:r=a3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Om(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let L_,M_;function K7(){return L_||(L_=new Bn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(L_)),L_}function W7(){return M_||(M_=new Bn,Object.freeze(M_)),M_}function v3(i){if(i>Math.PI*2)throw Error("expected radians")}function X7(i,e,t,r,n,o){const c=2*o/(t-e),s=2*o/(n-r),m=(t+e)/(t-e),x=(n+r)/(n-r),I=-1,F=-1,O=-2*o;return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=m,i[9]=x,i[10]=I,i[11]=F,i[12]=0,i[13]=0,i[14]=O,i[15]=0,i}function b3(){var i=new $u(4);return $u!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Z7(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function x3(i,e,t){t=t*.5;var r=Math.sin(t);return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=Math.cos(t),i}function w3(i,e,t){var r=e[0],n=e[1],o=e[2],c=e[3],s=t[0],m=t[1],x=t[2],I=t[3];return i[0]=r*I+c*s+n*x-o*m,i[1]=n*I+c*m+o*s-r*x,i[2]=o*I+c*x+r*m-n*s,i[3]=c*I-r*s-n*m-o*x,i}function J7(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],c=e[3],s=Math.sin(t),m=Math.cos(t);return i[0]=r*m+c*s,i[1]=n*m+o*s,i[2]=o*m-n*s,i[3]=c*m-r*s,i}function Y7(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],c=e[3],s=Math.sin(t),m=Math.cos(t);return i[0]=r*m-o*s,i[1]=n*m+c*s,i[2]=o*m+r*s,i[3]=c*m-n*s,i}function eG(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],c=e[3],s=Math.sin(t),m=Math.cos(t);return i[0]=r*m+n*s,i[1]=n*m-r*s,i[2]=o*m+c*s,i[3]=c*m-o*s,i}function tG(i,e){var t=e[0],r=e[1],n=e[2];return i[0]=t,i[1]=r,i[2]=n,i[3]=Math.sqrt(Math.abs(1-t*t-r*r-n*n)),i}function P_(i,e,t,r){var n=e[0],o=e[1],c=e[2],s=e[3],m=t[0],x=t[1],I=t[2],F=t[3],O,z,ie,ne,ue;return z=n*m+o*x+c*I+s*F,z<0&&(z=-z,m=-m,x=-x,I=-I,F=-F),1-z>Um?(O=Math.acos(z),ie=Math.sin(O),ne=Math.sin((1-r)*O)/ie,ue=Math.sin(r*O)/ie):(ne=1-r,ue=r),i[0]=ne*n+ue*m,i[1]=ne*o+ue*x,i[2]=ne*c+ue*I,i[3]=ne*s+ue*F,i}function iG(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],c=t*t+r*r+n*n+o*o,s=c?1/c:0;return i[0]=-t*s,i[1]=-r*s,i[2]=-n*s,i[3]=o*s,i}function rG(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function B3(i,e){var t=e[0]+e[4]+e[8],r;if(t>0)r=Math.sqrt(t+1),i[3]=.5*r,r=.5/r,i[0]=(e[5]-e[7])*r,i[1]=(e[6]-e[2])*r,i[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var o=(n+1)%3,c=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[o*3+o]-e[c*3+c]+1),i[n]=.5*r,r=.5/r,i[3]=(e[o*3+c]-e[c*3+o])*r,i[o]=(e[o*3+n]+e[n*3+o])*r,i[c]=(e[c*3+n]+e[n*3+c])*r}return i}var nG=U7,sG=_3,oG=V7,aG=H7,lG=N7,cG=z7,C3=Q7,uG=function(){var i=c3(),e=h3(1,0,0),t=h3(0,1,0);return function(r,n,o){var c=Ew(n,o);return c<-.999999?(B_(i,e,n),d7(i)<1e-6&&B_(i,t,n),a7(i,i),x3(r,i,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(B_(i,n,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+c,C3(r,r))}}();(function(){var i=b3(),e=b3();return function(t,r,n,o,c,s){return P_(i,r,c,s),P_(e,n,o,s),P_(t,i,e,2*s*(1-s)),t}})(),function(){var i=f7();return function(e,t,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],C3(e,B3(e,i))}}();const hG=[0,0,0,1];class zm extends ww{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return B3(this,e),this.check()}fromAxisRotation(e,t){return x3(this,e,t),this.check()}identity(){return Z7(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ts(e)}get y(){return this[1]}set y(e){this[1]=ts(e)}get z(){return this[2]}set z(e){this[2]=ts(e)}get w(){return this[3]}set w(e){this[3]=ts(e)}len(){return lG(this)}lengthSquared(){return cG(this)}dot(e){return oG(this,e)}rotationTo(e,t){return uG(this,e,t),this.check()}add(e){return nG(this,this,e),this.check()}calculateW(){return tG(this,this),this.check()}conjugate(){return rG(this,this),this.check()}invert(){return iG(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(aG(this,e,t,r),this.check())}multiplyRight(e){return w3(this,this,e),this.check()}multiplyLeft(e){return w3(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return J7(this,this,e),this.check()}rotateY(e){return Y7(this,this,e),this.check()}rotateZ(e){return eG(this,this,e),this.check()}scale(e){return sG(this,this,e),this.check()}slerp(e,t,r){let n,o,c;switch(arguments.length){case 1:({start:n=hG,target:o,ratio:c}=e);break;case 2:n=this,o=e,c=t;break;default:n=e,o=t,c=r}return P_(this,n,o,c),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Iw;return G7(t,e,this),Om(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Qm={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},E3=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,AG={lightSources:{}};function kw(){let{color:i=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(t=>t*e/255)}function dG(i){let{ambientLight:e,pointLights:t=[],directionalLights:r=[]}=i;const n={};return e?n["lighting_uAmbientLight.color"]=kw(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,c)=>{n["lighting_uPointLight[".concat(c,"].color")]=kw(o),n["lighting_uPointLight[".concat(c,"].position")]=o.position,n["lighting_uPointLight[".concat(c,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((o,c)=>{n["lighting_uDirectionalLight[".concat(c,"].color")]=kw(o),n["lighting_uDirectionalLight[".concat(c,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function S3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:AG;if("lightSources"in i){const{ambientLight:e,pointLights:t,directionalLights:r}=i.lightSources||{};return e||t&&t.length>0||r&&r.length>0?Object.assign({},dG({ambientLight:e,pointLights:t,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const e={pointLights:[],directionalLights:[]};for(const t of i.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return S3({lightSources:e})}return{}}const Ow={name:"lights",vs:E3,fs:E3,getUniforms:S3,defines:{MAX_LIGHTS:3}},fG={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function pG(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fG;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(i.pickingHighlightColor){const t=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return i.pickingActive!==void 0&&(e.picking_uActive=!!i.pickingActive,e.picking_uAttribute=!!i.pickingAttribute),e}const gG={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:pG},T3=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,mG={};function yG(i){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:n=[30,30,30]}=i;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:n.map(o=>o/255)}}function I3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mG;if(!("material"in i))return{};const{material:e}=i;return e?yG(e):{lighting_uEnabled:!1}}const _G={name:"gouraud-lighting",dependencies:[Ow],vs:T3,defines:{LIGHTING_VERTEX:1},getUniforms:I3},vG={name:"phong-lighting",dependencies:[Ow],fs:T3,defines:{LIGHTING_FRAGMENT:1},getUniforms:I3},Uw={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[Ow]},bG={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class Vm{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Vm(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:n={},inject:o={},varyings:c=[],bufferMode:s=35981,transpileToGLSL100:m=!1}=e,x=this._getModuleList(e.modules),I=this._getHash(t),F=this._getHash(r),O=x.map(be=>this._getHash(be.name)).sort(),z=c.map(be=>this._getHash(be)),ie=Object.keys(n).sort(),ne=Object.keys(o).sort(),ue=[],ce=[];for(const be of ie)ue.push(this._getHash(be)),ue.push(this._getHash(n[be]));for(const be of ne)ce.push(this._getHash(be)),ce.push(this._getHash(o[be]));const de="".concat(I,"/").concat(F,"D").concat(ue.join("/"),"M").concat(O.join("/"),"I").concat(ce.join("/"),"V").concat(z.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(m?"T":"");if(!this._programCache[de]){const be=LH(this.gl,{vs:t,fs:r,modules:x,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:m});this._programCache[de]=new RI(this.gl,{hash:de,vs:be.vs,fs:be.fs,varyings:c,bufferMode:s}),this._getUniforms[de]=be.getUniforms||(Te=>{}),this._useCounts[de]=0}return this._useCounts[de]++,this._programCache[de]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let o=0,c=this._defaultModules.length;o<c;++o){const s=this._defaultModules[o],m=s.name;t[n++]=s,r[m]=!0}for(let o=0,c=e.length;o<c;++o){const s=e[o],m=s.name;r[m]||(t[n++]=s,r[m]=!0)}return t.length=n,t}}const xG={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function wG(i,e,t){const r={};let n=e.indices;for(const o in e.attributes){const c=e.attributes[o],s=BG(o,t);if(o==="indices")n=c;else if(c.constant)r[s]=c.value;else{const m=c.value,x={...c};delete x.value,r[s]=[new vs(i,m),x],CG(o,x)}}if(n){const o=n.value||n;Xi(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const c={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};r.indices=[new vs(i,{data:o,target:34963}),c]}return r}function BG(i,e){const{attributeMap:t=xG}=e||{};return t&&t[i]||i}function CG(i,e){let t;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Xi(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const Fp=2,EG=1e4,SG="Model needs drawMode and vertexCount",L3=()=>{},TG={};class Dp{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=AA("model")}=t;Xi(h_(e)),this.id=r,this.gl=e,this.id=t.id||AA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Vm.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:o,defines:c,inject:s,varyings:m,bufferMode:x,transpileToGLSL100:I}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:c,inject:s,varyings:m,bufferMode:x,transpileToGLSL100:I},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Xi(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),SG)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:o,defines:c,inject:s,varyings:m,bufferMode:x,transpileToGLSL100:I}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:c,inject:s,varyings:m,bufferMode:x,transpileToGLSL100:I},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Xi(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Xi(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=wG(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Tp(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return aw(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:o={},transformFeedback:c=this.transformFeedback,parameters:s={},vertexArray:m=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(n);let x;ar.priority>=Fp&&(x=this._logDrawCallStart(Fp));const I=this.vertexArray.getDrawParams(),{isIndexed:F=I.isIndexed,indexType:O=I.indexType,indexOffset:z=I.indexOffset,vertexArrayInstanced:ie=I.isInstanced}=this.props;ie&&!this.isInstanced&&ar.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:ne,instanceCount:ue}=this,{onBeforeRender:ce=L3,onAfterRender:de=L3}=this.props;ce(),this.program.setUniforms(this.uniforms);const be=this.program.draw(Object.assign(TG,e,{logPriority:x,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:c,isIndexed:F,indexType:O,isInstanced:ne,instanceCount:ue,offset:F?z:0}));return de(),ar.priority>=Fp&&this._logDrawCallEnd(x,m,r),be}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),n.forEach(c=>c.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{n.forEach(c=>c.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ar.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:n,modules:o,inject:c,defines:s,varyings:m,bufferMode:x,transpileToGLSL100:I}=this.programProps;t=this.programManager.get({vs:r,fs:n,modules:o,inject:c,defines:s,varyings:m,bufferMode:x,transpileToGLSL100:I}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Xi(t instanceof RI,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new j9(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof vs&&t.delete()}}_setAnimationProps(e){this.animated&&Xi(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Tp(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new kI(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:EG;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),ar.group(Fp,">>> DRAWING MODEL ".concat(this.id),{collapsed:ar.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(e===void 0)return;const o=K9({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:c,unusedTable:s,unusedCount:m}=OI({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:x,count:I}=OI({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});I>0&&ar.log("MISSING UNIFORMS",Object.keys(x))(),m>0&&ar.log("UNUSED UNIFORMS",Object.keys(s))();const F=X9(this.vertexArray.configuration);ar.table(e,o)(),ar.table(e,c)(),ar.table(e+1,F)(),n&&n.log({logLevel:Fp,message:"Rendered to ".concat(n.id)}),ar.groupEnd(Fp)()}}class IG{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof vs?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Xi(hn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in t&&(r[o]=n)}Object.assign(r,e.feedbackBuffers);for(const n in r){const o=r[n];if(typeof o=="string"){const c=t[o],{byteLength:s,usage:m,accessor:x}=c;r[n]=this._createNewBuffer(n,{byteLength:s,usage:m,accessor:x})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:n}=r;e.transformFeedback=new kI(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];t[n]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[n],Xi(r[o]instanceof vs)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new vs(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const LG="transform_uSampler_",F_="transform_uSize_",M3="transform_position";function MG(i){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}=i,c=Object.keys(t).length,s=null;const m={};let x=e,I={};if(c>0||r){const F=x.split(`
`),O=F.slice();if(F.forEach((z,ie,ne)=>{if(c>0){const ue=kG(z,t);if(ue){const{updatedLine:ce,inject:de}=ue;O[ie]=ce,I=_w([I,de]),Object.assign(m,ue.samplerTextureMap),c--}}r&&!s&&(s=RG(z,r))}),r){Xi(n);const z="".concat(F_).concat(r),ie="uniform vec2 ".concat(z,`;
`),ne="     vec2 ".concat(M3," = transform_getPos(").concat(z,`);
     gl_Position = vec4(`).concat(M3,`, 0, 1.);
`);I=_w([I,{"vs:#decl":ie,"vs:#main-start":ne}])}x=O.join(`
`)}return{vs:x,targetTextureType:s,inject:I,samplerTextureMap:m}}function PG(i){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=i;const n={};let o,c;t&&({width:o,height:c}=r,n["".concat(F_).concat(t)]=[o,c]);for(const s in e)({width:o,height:c}=e[s]),n["".concat(F_).concat(s)]=[o,c];return n}function FG(i){return e3(i,["attribute","in"])}function DG(i){const e="".concat(LG).concat(i),t="".concat(F_).concat(i),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function RG(i,e){const t=e3(i,["varying","out"]);return t&&t.name===e?t.type:null}function kG(i,e){const t={},r=FG(i);if(!r)return null;const{type:n,name:o}=r;if(o&&e[o]){const c="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:m,uniformDeclerations:x}=DG(o),I=NH(n),F="  ".concat(n," ").concat(o," = transform_getInput(").concat(s,", ").concat(m,").").concat(I,`;
`);return t[s]=o,{updatedLine:c,inject:{"vs:#decl":x,"vs:#main-start":F},samplerTextureMap:t}}return null}const OG={10241:9728,10240:9728,10242:33071,10243:33071},UG="transform_output";class NG{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],c=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),m=Object.assign({},e.parameters);let x=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){c.transform_elementID=this.elementIDBuffer;for(const F in this.samplerTextureMap){const O=this.samplerTextureMap[F];s[F]=r[O]}this._setSourceTextureParameters();const I=PG({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,I)}return this.hasTargetTexture&&(x=!1,m.viewport=[0,0,n.width,n.height]),{attributes:c,framebuffer:n,uniforms:s,discard:x,parameters:m}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=d_(t);if(!e)return r;const n=r.constructor,o=zH(this.targetTextureType),c=new n(r.length*o/4);let s=0;for(let m=0;m<r.length;m+=4)for(let x=0;x<o;x++)c[s++]=r[m+x];return c}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof jc)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new vs(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:c,height:s}=o,{framebuffer:m}=e;m?(m.update({attachments:{36064:o},resizeAttachments:!1}),m.resize({width:c,height:s})):e.framebuffer=new ba(this.gl,{id:"transform-framebuffer",width:c,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(OG)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=DV(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:c,inject:s,samplerTextureMap:m}=MG({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),x=_w([e.inject||{},s]);this.targetTextureType=c,this.samplerTextureMap=m;const I=e._fs||t3({version:TI(n),input:this.targetTextureVarying,inputType:c,output:UG}),F=this.hasSourceTextures||this.targetTextureVarying?[bG].concat(e.modules||[]):e.modules;return{vs:n,fs:I,modules:F,uniforms:o,inject:x}}}class Nw{static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Xi(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const n=r.getData(e);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Dp(t,Object.assign({},e,{fs:e.fs||t3({version:TI(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=n.updateModelProps(t);return t}_buildResourceTransforms(e,t){zG(t)&&(this.bufferTransform=new IG(e,t)),QG(t)&&(this.textureTransform=new NG(e,t)),Xi(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=Object.assign(t,n.getDrawOptions(t));return t}}function zG(i){return!!(!Tp(i.feedbackBuffers)||!Tp(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function QG(i){return!!(!Tp(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const P3={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Hm{static get DRAW_MODE(){return P3}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=AA("geometry"),drawMode:r=P3.TRIANGLES,attributes:n={},indices:o=null,vertexCount:c=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let n=e[r];n=ArrayBuffer.isView(n)?{value:n}:n,Xi(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!n.size&&(n.size=3),r==="indices"?(Xi(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const n in e){const o=e[n],{value:c,size:s,constant:m}=o;!m&&c&&s>=1&&(r=Math.min(r,c.length/s))}return Xi(Number.isFinite(r)),r}}let VG=1,HG=1;class F3{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,c=VG++,s={time:0,delay:t,duration:r,rate:n,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(c,s),c}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:o,channel:c}=n;o.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=HG++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,n=e.duration*e.repeat;r>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const GG=[255,255,255],jG=1;let qG=0;class D3{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","ambient");const{color:t=GG}=e,{intensity:r=jG}=e;this.id=e.id||"ambient-".concat(qG++),this.color=t,this.intensity=r}}const $G=[255,255,255],KG=1,WG=[0,0,-1];let XG=0;class R3{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","directional"),ye(this,"direction",void 0),ye(this,"shadow",void 0);const{color:t=$G}=e,{intensity:r=KG}=e,{direction:n=WG}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(XG++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Ut(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class ZG{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class zw extends ZG{constructor(){super(...arguments),ye(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return hA(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:n,views:o,onViewportActive:c,clearStack:s=!0,clearCanvas:m=!0}=e;e.pass=e.pass||"unknown";const x=this.gl;m&&YG(x,t),s&&(this._lastRenderIndex=-1);const I=[];for(const F of n){const O=o&&o[F.id];c==null||c(F);const z=this._getDrawLayerParams(F,e),ie=F.subViewports||[F];for(const ne of ie){const ue=this._drawLayersInViewport(x,{target:t,moduleParameters:r,viewport:ne,view:O,pass:e.pass,layers:e.layers},z);I.push(ue)}}return I}_getDrawLayerParams(e,t){let{layers:r,pass:n,isPicking:o=!1,layerFilter:c,cullRect:s,effects:m,moduleParameters:x}=t,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const F=[],O=k3(this._lastRenderIndex+1),z={layer:r[0],viewport:e,isPicking:o,renderPass:n,cullRect:s},ie={};for(let ne=0;ne<r.length;ne++){const ue=r[ne],ce=this._shouldDrawLayer(ue,z,c,ie),de={shouldDrawLayer:ce};ce&&!I&&(de.layerRenderIndex=O(ue,ce),de.moduleParameters=this._getModuleParameters(ue,m,n,x),de.layerParameters=this.getLayerParameters(ue,ne,e)),F[ne]=de}return F}_drawLayersInViewport(e,t,r){let{layers:n,moduleParameters:o,pass:c,target:s,viewport:m,view:x}=t;const I=JG(e,{moduleParameters:o,target:s,viewport:m});if(x&&x.props.clear){const O=x.props.clear===!0?{color:!0,depth:!0}:x.props.clear;Gu(e,{scissorTest:!0,scissor:I},()=>aw(e,O))}const F={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};hA(e,{viewport:I});for(let O=0;O<n.length;O++){const z=n[O],{shouldDrawLayer:ie,layerRenderIndex:ne,moduleParameters:ue,layerParameters:ce}=r[O];if(ie&&z.props.pickable&&F.pickableCount++,z.isComposite)F.compositeCount++;else if(ie){F.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,ne),ue.viewport=m;try{z._drawLayer({moduleParameters:ue,uniforms:{layerIndex:ne},parameters:ce})}catch(de){z.raiseError(de,"drawing ".concat(z," to ").concat(c))}}}return F}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(t))return!1;t.layer=c,c=c.parent}if(r){const s=t.layer.id;if(s in n||(n[s]=r(t)),!n[s])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,n){var o;const c=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Sp(this.gl)});if(t)for(const m of t){var s;Object.assign(c,(s=m.getModuleParameters)===null||s===void 0?void 0:s.call(m,e))}return Object.assign(c,this.getModuleParameters(e,t),n)}}function k3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},r=(n,o)=>{const c=n.props._offset,s=n.id,m=n.parent&&n.parent.id;let x;if(m&&!(m in e)&&r(n.parent,!1),m in t){const I=t[m]=t[m]||k3(e[m],e);x=I(n,o),t[s]=I}else Number.isFinite(c)?(x=c+(e[m]||0),t[s]=null):x=i;return o&&x>=i&&(i=x+1),e[s]=x,x};return r}function JG(i,e){let{moduleParameters:t,target:r,viewport:n}=e;const o=r&&r.id!=="default-framebuffer",c=t&&t.devicePixelRatio||Sp(i),s=o?r.height:i.drawingBufferHeight,m=n;return[m.x*c,s-(m.y+m.height)*c,m.width*c,m.height*c]}function YG(i,e){const t=e?e.width:i.drawingBufferWidth,r=e?e.height:i.drawingBufferHeight;hA(i,{viewport:[0,0,t,r]}),i.clear(16640)}class ej extends zw{constructor(e,t){super(e,t),ye(this,"shadowMap",void 0),ye(this,"depthBuffer",void 0),ye(this,"fbo",void 0),this.shadowMap=new jc(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Mp(e,{format:33189,width:1,height:1}),this.fbo=new ba(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Gu(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],n=Sp(this.gl),o=r.width*n,c=r.height*n;(o!==t.width||c!==t.height)&&t.resize({width:o,height:c}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const O3="#define SMOOTH_EDGE_RADIUS 0.5",tj=`
`.concat(O3,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),ij=`
`.concat(O3,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),rj={name:"geometry",vs:tj,fs:ij},nj=Object.keys(Ln).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(Ln[i],";")).join(""),sj=Object.keys(Lh).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(Lh[i],";")).join(""),oj=Object.keys(Kx).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(Kx[i],";")).join(""),aj="".concat(nj,`
`).concat(sj,`
`).concat(oj,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function lj(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function Gm(i){let e={},t;return r=>{for(const n in r)if(!lj(r[n],e[n])){t=i(r),e=r;break}return t}}const U3=[0,0,0,0],cj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],N3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],uj=[0,0,0],z3=[0,0,0],hj=Gm(fj);function Q3(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:z3;t.length<3&&(t=[t[0],t[1],0]);let r=t,n,o=!0;switch(e===Ln.LNGLAT_OFFSETS||e===Ln.METER_OFFSETS?n=t:n=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Lh.WEB_MERCATOR:(e===Ln.LNGLAT||e===Ln.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Lh.WEB_MERCATOR_AUTO_OFFSET:e===Ln.LNGLAT?r=n:e===Ln.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],n=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Lh.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Lh.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:o}}function Aj(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:n}=i;let{viewMatrix:o,viewProjectionMatrix:c}=i,s=U3,m=U3,x=i.cameraPosition;const{geospatialOrigin:I,shaderCoordinateOrigin:F,offsetMode:O}=Q3(i,e,t);return O&&(m=i.projectPosition(I||F),x=[x[0]-m[0],x[1]-m[1],x[2]-m[2]],m[3]=1,s=Nm([],m,c),o=r||o,c=rf([],n,o),c=rf([],c,cj)),{viewMatrix:o,viewProjectionMatrix:c,projectionCenter:s,originCommon:m,cameraPosCommon:x,shaderCoordinateOrigin:F,geospatialOrigin:I}}function dj(i){let{viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Ln.DEFAULT,coordinateOrigin:o=z3,autoWrapLongitude:c=!1}=i;n===Ln.DEFAULT&&(n=e.isGeospatial?Ln.LNGLAT:Ln.CARTESIAN);const s=hj({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=c,s.project_uModelMatrix=r||N3,s}function fj(i){let{viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}=i;const{projectionCenter:o,viewProjectionMatrix:c,originCommon:s,cameraPosCommon:m,shaderCoordinateOrigin:x,geospatialOrigin:I}=Aj(e,r,n),F=e.getDistanceScales(),O=[e.width*t,e.height*t],z=Nm([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,ie={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:x,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:O,project_uDevicePixelRatio:t,project_uFocalDistance:z,project_uCommonUnitsPerMeter:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:uj,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:N3,project_uCameraPosition:m};if(I){const ne=e.getDistanceScales(I);switch(r){case Ln.METER_OFFSETS:ie.project_uCommonUnitsPerWorldUnit=ne.unitsPerMeter,ie.project_uCommonUnitsPerWorldUnit2=ne.unitsPerMeter2;break;case Ln.LNGLAT:case Ln.LNGLAT_OFFSETS:e._pseudoMeters||(ie.project_uCommonUnitsPerMeter=ne.unitsPerMeter),ie.project_uCommonUnitsPerWorldUnit=ne.unitsPerDegree,ie.project_uCommonUnitsPerWorldUnit2=ne.unitsPerDegree2;break;case Ln.CARTESIAN:ie.project_uCommonUnitsPerWorldUnit=[1,1,ne.unitsPerMeter[2]],ie.project_uCommonUnitsPerWorldUnit2=[0,0,ne.unitsPerMeter2[2]];break}}return ie}const pj={};function gj(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pj;return"viewport"in i?dj(i):{}}const Qw={name:"project",dependencies:[VH,rj],vs:aj,getUniforms:gj};function mj(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Rp(i,e){const t=Nm([],e,i);return _3(t,t,1/t[3]),t}function V3(i,e){const t=i%e;return t<0?e+t:t}function Vw(i,e,t){return i<e?e:i>t?t:i}function yj(i){return Math.log(i)*Math.LOG2E}const Hw=Math.log2||yj;function mA(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ku=Math.PI,H3=Ku/4,yu=Ku/180,Gw=180/Ku,kp=512,D_=4003e4,R_=85.051129,_j=1.5;function vj(i){return Hw(i)}function jm(i){const[e,t]=i;mA(Number.isFinite(e)),mA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*yu,n=t*yu,o=kp*(r+Ku)/(2*Ku),c=kp*(Ku+Math.log(Math.tan(H3+n*.5)))/(2*Ku);return[o,c]}function Op(i){const[e,t]=i,r=e/kp*(2*Ku)-Ku,n=2*(Math.atan(Math.exp(t/kp*(2*Ku)-Ku))-H3);return[r*Gw,n*Gw]}function bj(i){const{latitude:e}=i;mA(Number.isFinite(e));const t=Math.cos(e*yu);return vj(D_*t)-9}function k_(i){const e=Math.cos(i*yu);return kp/D_/e}function jw(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;mA(Number.isFinite(e)&&Number.isFinite(t));const n=kp,o=Math.cos(e*yu),c=n/360,s=c/o,m=n/D_/o,x={unitsPerMeter:[m,m,m],metersPerUnit:[1/m,1/m,1/m],unitsPerDegree:[c,s,m],degreesPerUnit:[1/c,1/s,1/m]};if(r){const I=yu*Math.tan(e*yu)/o,F=c*I/2,O=n/D_*I,z=O/s*m;x.unitsPerDegree2=[0,F,O],x.unitsPerMeter2=[z,0,z]}return x}function G3(i,e){const[t,r,n]=i,[o,c,s]=e,{unitsPerMeter:m,unitsPerMeter2:x}=jw({longitude:t,latitude:r,highPrecision:!0}),I=jm(i);I[0]+=o*(m[0]+x[0]*c),I[1]+=c*(m[1]+x[1]*c);const F=Op(I),O=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[F[0],F[1],O]:F}function xj(i){const{height:e,pitch:t,bearing:r,altitude:n,scale:o,center:c}=i,s=mj();I_(s,s,[0,0,-n]),m3(s,s,-t*yu),y3(s,s,r*yu);const m=o/e;return Pw(s,s,[m,m,m]),c&&I_(s,s,o7([],c)),s}function wj(i){const{width:e,height:t,altitude:r,pitch:n=0,offset:o,center:c,scale:s,nearZMultiplier:m=1,farZMultiplier:x=1}=i;let{fovy:I=O_(_j)}=i;r!==void 0&&(I=O_(r));const F=I*yu,O=n*yu,z=j3(I);let ie=z;c&&(ie+=c[2]*s/Math.cos(O)/t);const ne=F*(.5+(o?o[1]:0)/t),ue=Math.sin(ne)*ie/Math.sin(Vw(Math.PI/2-O-ne,.01,Math.PI-.01)),ce=Math.sin(O)*ue+ie,de=ie*10,be=Math.min(ce*x,de);return{fov:F,aspect:e/t,focalDistance:z,near:m,far:be}}function O_(i){return 2*Math.atan(.5/i)*Gw}function j3(i){return .5/Math.tan(.5*i*yu)}function q3(i,e){const[t,r,n=0]=i;return mA(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(n)),Rp(e,[t,r,n,1])}function qw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,n,o]=i;if(mA(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return Rp(e,[r,n,o,1]);const c=Rp(e,[r,n,0,1]),s=Rp(e,[r,n,1,1]),m=c[2],x=s[2],I=m===x?0:((t||0)-m)/(x-m);return r3([],c,s,I)}function Bj(i){const{width:e,height:t,bounds:r,minExtent:n=0,maxZoom:o=24,offset:c=[0,0]}=i,[[s,m],[x,I]]=r,F=Cj(i.padding),O=jm([s,Vw(I,-R_,R_)]),z=jm([x,Vw(m,-R_,R_)]),ie=[Math.max(Math.abs(z[0]-O[0]),n),Math.max(Math.abs(z[1]-O[1]),n)],ne=[e-F.left-F.right-Math.abs(c[0])*2,t-F.top-F.bottom-Math.abs(c[1])*2];mA(ne[0]>0&&ne[1]>0);const ue=ne[0]/ie[0],ce=ne[1]/ie[1],de=(F.right-F.left)/2/ue,be=(F.top-F.bottom)/2/ce,Te=[(z[0]+O[0])/2+de,(z[1]+O[1])/2+be],je=Op(Te),Ge=Math.min(o,Hw(Math.abs(Math.min(ue,ce))));return mA(Number.isFinite(Ge)),{longitude:je[0],latitude:je[1],zoom:Ge}}function Cj(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(mA(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const $3=Math.PI/180;function Ej(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:r,unproject:n}=i,o={targetZ:e},c=n([0,r],o),s=n([t,r],o);let m,x;const I=i.fovy?.5*i.fovy*$3:Math.atan(.5/i.altitude),F=(90-i.pitch)*$3;return I>F-.01?(m=K3(i,0,e),x=K3(i,t,e)):(m=n([0,0],o),x=n([t,0],o)),[c,s,x,m]}function K3(i,e,t){const{pixelUnprojectionMatrix:r}=i,n=Rp(r,[e,0,1,1]),o=Rp(r,[e,i.height,1,1]),s=(t*i.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),m=r3([],n,o,s),x=Op(m);return x.push(t),x}const W3=512;function Sj(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:n,latitude:o,zoom:c,bearing:s=0}=i;(n<-180||n>180)&&(n=V3(n+180,360)-180),(s<-180||s>180)&&(s=V3(s+180,360)-180);const m=Hw(t/W3);if(c<=m)c=m,o=0;else{const x=t/2/Math.pow(2,c),I=Op([0,x])[1];if(o<I)o=I;else{const F=Op([0,W3-x])[1];o>F&&(o=F)}}return{width:e,height:t,longitude:n,latitude:o,zoom:c,pitch:r,bearing:s}}const Tj=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Ij=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Lj=Gm(Rj),Mj=Gm(kj),Pj=[0,0,0,1],Fj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Dj(i,e){const[t,r,n]=i,o=qw([t,r,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function Rj(i){let{viewport:e,center:t}=i;return new Bn(e.viewProjectionMatrix).invert().transform(t)}function kj(i){let{viewport:e,shadowMatrices:t}=i;const r=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,c=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>Dj(s,n));for(const s of t){const m=s.clone().translate(new Ut(e.center).negate()),x=c.map(F=>m.transform(F)),I=new Bn().ortho({left:Math.min(...x.map(F=>F[0])),right:Math.max(...x.map(F=>F[0])),bottom:Math.min(...x.map(F=>F[1])),top:Math.max(...x.map(F=>F[1])),near:Math.min(...x.map(F=>-F[2])),far:Math.max(...x.map(F=>-F[2]))});r.push(I.multiplyRight(s))}return r}function Oj(i,e){const{shadowEnabled:t=!0}=i;if(!t||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||Pj,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},n=Lj({viewport:i.viewport,center:e.project_uCenter}),o=[],c=Mj({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let s=0;s<i.shadowMatrices.length;s++){const m=c[s],x=m.clone().translate(new Ut(i.viewport.center).negate());e.project_uCoordinateSystem===Ln.LNGLAT&&e.project_uProjectionMode===Lh.WEB_MERCATOR?(c[s]=x,o[s]=n):(c[s]=m.clone().multiplyRight(Fj),o[s]=x.transform(n))}for(let s=0;s<c.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=c[s],r["shadow_uProjectCenters[".concat(s,"]")]=o[s],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=i.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=i.dummyShadowMap;return r}const $w={name:"shadow",dependencies:[Qw],vs:Tj,fs:Ij,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?Oj(i,e):{}}},Uj={color:[255,255,255],intensity:1},X3=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Nj=[0,0,0,200/255];class Kw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id","lighting-effect"),ye(this,"props",void 0),ye(this,"shadowColor",Nj),ye(this,"shadow",void 0),ye(this,"ambientLight",void 0),ye(this,"directionalLights",void 0),ye(this,"pointLights",void 0),ye(this,"shadowPasses",[]),ye(this,"shadowMaps",[]),ye(this,"dummyShadowMap",null),ye(this,"programManager",void 0),ye(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,t){let{layers:r,layerFilter:n,viewports:o,onViewportActive:c,views:s}=t;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Vm.getDefaultProgramManager(e),$w&&this.programManager.addDefaultModule($w)),this.dummyShadowMap||(this.dummyShadowMap=new jc(e,{width:1,height:1}));for(let m=0;m<this.shadowPasses.length;m++)this.shadowPasses[m].render({layers:r,layerFilter:n,viewports:o,onViewportActive:c,views:s,moduleParameters:{shadowLightId:m,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule($w),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Bn().lookAt({eye:new Ut(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new ej(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new D3(Uj),this.directionalLights.push(new R3(X3[0]),new R3(X3[1])))}}class zj{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"_pool",[]),ye(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,r){let{size:n=1,type:o,padding:c=0,copy:s=!1,initialize:m=!1,maxCount:x}=r;const I=o||e&&e.constructor||Float32Array,F=t*n+c;if(ArrayBuffer.isView(e)){if(F<=e.length)return e;if(F*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new I(e.buffer,0,F)}let O=1/0;x&&(O=x*n+c);const z=this._allocate(I,F,m,O);return e&&s?z.set(e):m||z.fill(0,0,4),this._release(e),z}release(e){this._release(e)}_allocate(e,t,r,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const c=this._pool,s=e.BYTES_PER_ELEMENT*o,m=c.findIndex(x=>x.byteLength>=s);if(m>=0){const x=new e(c.splice(m,1)[0],0,o);return r&&x.fill(0),x}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:n}=r,o=t.findIndex(c=>c.byteLength>=n);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const qm=new zj;function $m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Qj(i){return[i[12],i[13],i[14]]}function Vj(i){return{left:Up(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:Up(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:Up(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:Up(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:Up(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:Up(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Z3=new Ut;function Up(i,e,t,r){Z3.set(i,e,t);const n=Z3.len();return{distance:r/n,normal:new Ut(-i/n,-e/n,-t/n)}}function Hj(i){return i-Math.fround(i)}let Km;function Ww(i,e){const{size:t=1,startIndex:r=0}=e,n=e.endIndex!==void 0?e.endIndex:i.length,o=(n-r)/t;Km=qm.allocate(Km,o,{type:Float32Array,size:t*2});let c=r,s=0;for(;c<n;){for(let m=0;m<t;m++){const x=i[c++];Km[s+m]=x,Km[s+m+t]=Hj(x)}s+=t*2}return Km.subarray(0,o*t*2)}function Gj(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const jj=Math.PI/180,qj=$m(),J3=[0,0,0],$j={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Kj(i){let{width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:o,padding:c,near:s,far:m}=i;const x=e/t,I=r?new Bn().orthographic({fovy:n,aspect:x,focalDistance:o,near:s,far:m}):new Bn().perspective({fovy:n,aspect:x,near:s,far:m});if(c){const{left:F=0,right:O=0,top:z=0,bottom:ie=0}=c,ne=gA((F+e-O)/2,0,e)-e/2,ue=gA((z+t-ie)/2,0,t)-t/2;I[8]-=ne*2/e,I[9]+=ue*2/t}return I}class Np{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"x",void 0),ye(this,"y",void 0),ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"padding",void 0),ye(this,"isGeospatial",void 0),ye(this,"zoom",void 0),ye(this,"focalDistance",void 0),ye(this,"position",void 0),ye(this,"modelMatrix",void 0),ye(this,"distanceScales",void 0),ye(this,"scale",void 0),ye(this,"center",void 0),ye(this,"cameraPosition",void 0),ye(this,"projectionMatrix",void 0),ye(this,"viewMatrix",void 0),ye(this,"viewMatrixUncentered",void 0),ye(this,"viewMatrixInverse",void 0),ye(this,"viewProjectionMatrix",void 0),ye(this,"pixelProjectionMatrix",void 0),ye(this,"pixelUnprojectionMatrix",void 0),ye(this,"resolution",void 0),ye(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||$j,this.focalDistance=e.focalDistance||1,this.position=e.position||J3,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Lh.WEB_MERCATOR:Lh.WEB_MERCATOR_AUTO_OFFSET:Lh.IDENTITY}equals(e){return e instanceof Np?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&qu(e.projectionMatrix,this.projectionMatrix)&&qu(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(e),n=q3(r,this.pixelProjectionMatrix),[o,c]=n,s=t?c:this.height-c;return e.length===2?[o,s]:[o,s,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,c]=e,s=t?o:this.height-o,m=r&&r*this.distanceScales.unitsPerMeter[2],x=qw([n,s,c],this.pixelUnprojectionMatrix,m),[I,F,O]=this.unprojectPosition(x);return Number.isFinite(c)?[I,F,O]:Number.isFinite(r)?[I,F,r]:[I,F]}projectPosition(e){const[t,r]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,n]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,n]}projectFlat(e){if(this.isGeospatial){const t=jm(e);return t[1]=gA(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Op(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),c=this.unproject([this.width,this.height],t);return[Math.min(r[0],n[0],o[0],c[0]),Math.min(r[1],n[1],o[1],c[1]),Math.max(r[0],n[0],o[0],c[0]),Math.max(r[1],n[1],o[1],c[1])]}getDistanceScales(e){return e?jw({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:r,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Vj(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=bj({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||jw({latitude:r,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:c}=e;let s=J3;if(o&&(s=c?new Bn(c).transformAsVector(o,[]):o),this.isGeospatial){const m=this.projectPosition([t,r,0]);this.center=new Ut(s).scale(this.distanceScales.unitsPerMeter).add(m)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=qj,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:o,fovy:c=75,near:s=.1,far:m=1e3,padding:x=null,focalDistance:I=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Bn().multiplyRight(t).translate(new Ut(this.center).negate()),this.projectionMatrix=r||Kj({width:this.width,height:this.height,orthographic:n,fovyRadians:o||c*jj,focalDistance:I,padding:x,near:s,far:m});const F=$m();rf(F,F,this.projectionMatrix),rf(F,F,this.viewMatrix),this.viewProjectionMatrix=F,this.viewMatrixInverse=Mw([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Qj(this.viewMatrixInverse);const O=$m(),z=$m();Pw(O,O,[this.width/2,-this.height/2,1]),I_(O,O,[1,-1,0]),rf(z,O,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=Mw($m(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Dn.warn("Pixel project matrix not invertible")()}}ye(Np,"displayName","Viewport");class nf extends Np{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:r=0,zoom:n=0,pitch:o=0,bearing:c=0,nearZMultiplier:s=.1,farZMultiplier:m=1.01,nearZ:x,farZ:I,orthographic:F=!1,projectionMatrix:O,repeat:z=!1,worldOffset:ie=0,position:ne,padding:ue,legacyMeterSizes:ce=!1}=e;let{width:de,height:be,altitude:Te=1.5}=e;const je=Math.pow(2,n);de=de||1,be=be||1;let Ge,$e=null;if(O)Te=O[5]/2,Ge=O_(Te);else{e.fovy?(Ge=e.fovy,Te=j3(Ge)):Ge=O_(Te);let lt;if(ue){const{top:nt=0,bottom:De=0}=ue;lt=[0,gA((nt+be-De)/2,0,be)-be/2]}$e=wj({width:de,height:be,scale:je,center:ne&&[0,0,ne[2]*k_(t)],offset:lt,pitch:o,fovy:Ge,nearZMultiplier:s,farZMultiplier:m}),Number.isFinite(x)&&($e.near=x),Number.isFinite(I)&&($e.far=I)}let Ue=xj({height:be,pitch:o,bearing:c,scale:je,altitude:Te});ie&&(Ue=new Bn().translate([512*ie,0,0]).multiplyLeft(Ue)),super({...e,width:de,height:be,viewMatrix:Ue,longitude:r,latitude:t,zoom:n,...$e,fovy:Ge,focalDistance:Te}),ye(this,"longitude",void 0),ye(this,"latitude",void 0),ye(this,"pitch",void 0),ye(this,"bearing",void 0),ye(this,"altitude",void 0),ye(this,"fovy",void 0),ye(this,"orthographic",void 0),ye(this,"_subViewports",void 0),ye(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=n,this.pitch=o,this.bearing=c,this.altitude=Te,this.fovy=Ge,this.orthographic=F,this._subViewports=z?[]:null,this._pseudoMeters=ce,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let n=t;n<=r;n++){const o=n?new nf({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),n=(e[2]||0)*k_(e[1]);return[t,r,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),n=(e[2]||0)/k_(r);return[t,r,n]}addMetersToLngLat(e,t){return G3(e,t)}panByPosition(e,t){const r=qw(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=i3([],n,e7([],r)),c=i3([],this.center,o),[s,m]=this.unprojectFlat(c);return{longitude:s,latitude:m}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Ej(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:n}=this,{longitude:o,latitude:c,zoom:s}=Bj({width:r,height:n,bounds:e,...t});return new nf({width:r,height:n,longitude:o,latitude:c,zoom:s})}}ye(nf,"displayName","WebMercatorViewport");const Y3=[0,0,0];function Xw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=e.projectPosition(i);if(t&&e instanceof nf){const[n,o,c=0]=i,s=e.getDistanceScales([n,o]);r[2]=c*s.unitsPerMeter[2]}return r}function Wj(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:c}=i;return n===Ln.DEFAULT&&(n=e.isGeospatial?Ln.LNGLAT:Ln.CARTESIAN),o===void 0&&(o=n),c===void 0&&(c=r),{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:c}}function eL(i,e){let{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:c}=e,[s,m,x=0]=i;switch(r&&([s,m,x]=Nm([],[s,m,x,1],r)),n){case Ln.LNGLAT:return Xw([s,m,x],t,c);case Ln.LNGLAT_OFFSETS:return Xw([s+o[0],m+o[1],x+(o[2]||0)],t,c);case Ln.METER_OFFSETS:return Xw(G3(o,[s,m,x]),t,c);case Ln.CARTESIAN:default:return t.isGeospatial?[s+o[0],m+o[1],x+o[2]]:t.projectPosition([s,m,x])}}function Xj(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:c,fromCoordinateOrigin:s}=Wj(e),{autoOffset:m=!0}=e,{geospatialOrigin:x=Y3,shaderCoordinateOrigin:I=Y3,offsetMode:F=!1}=m?Q3(t,r,n):{},O=eL(i,{viewport:t,modelMatrix:o,coordinateSystem:c,coordinateOrigin:s,offsetMode:F});if(F){const z=t.projectPosition(x||I);A7(O,O,z)}return O}const tL={blendFunc:[1,0,32771,0],blendEquation:32774};class iL extends zw{constructor(){super(...arguments),ye(this,"pickZ",void 0),ye(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:c,pickingFBO:s,deviceRect:{x:m,y:x,width:I,height:F},cullRect:O,effects:z,pass:ie="picking",pickZ:ne,moduleParameters:ue}=e;const ce=this.gl;this.pickZ=ne;const de=this._resetColorEncoder(ne),be=Gu(ce,{scissorTest:!0,scissor:[m,x,I,F],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...tL,blend:!ne},()=>super.render({target:s,layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:c,cullRect:O,effects:z==null?void 0:z.filter(je=>je.useInPicking),pass:ie,isPicking:!0,moduleParameters:ue}));return this._colorEncoderState=null,{decodePickingColor:de&&Jj.bind(null,de),stats:be}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const n={...e.props.parameters},{pickable:o,operation:c}=e.props;return this._colorEncoderState?o&&c.includes("draw")&&(Object.assign(n,tL),n.blend=!0,n.blendColor=Zj(this._colorEncoderState,e,r)):n.blend=!1,c.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Zj(i,e,t){const{byLayer:r,byAlpha:n}=i;let o,c=r.get(e);return c?(c.viewports.push(t),o=c.a):(o=r.size+1,o<=255?(c={a:o,layer:e,viewports:[t]},r.set(e,c),n[o]=c):(Dn.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function Jj(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const zp={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},U_=Symbol.for("component"),WA=Symbol.for("propTypes"),Zw=Symbol.for("deprecatedProps"),Qp=Symbol.for("asyncPropDefaults"),sf=Symbol.for("asyncPropOriginal"),XA=Symbol.for("asyncPropResolved");function N_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?rL(i,e,[]):e(i)?[i]:[]}function rL(i,e,t){let r=-1;for(;++r<i.length;){const n=i[r];Array.isArray(n)?rL(n,e,t):e(n)&&t.push(n)}return t}function Yj(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,c=n*o;let s=0;for(let m=r;s<o;s++)e[m++]=t[s];for(;s<c;)s<c-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+c-s),s=c);return e}class eq{constructor(e,t,r){ye(this,"id",void 0),ye(this,"context",void 0),ye(this,"isLoaded",void 0),ye(this,"persistent",void 0),ye(this,"_loadCount",0),ye(this,"_subscribers",new Set),ye(this,"_data",void 0),ye(this,"_loader",void 0),ye(this,"_error",void 0),ye(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let n=e;typeof e=="string"&&(n=HA(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class tq{constructor(e){let{gl:t,protocol:r}=e;ye(this,"protocol",void 0),ye(this,"_context",void 0),ye(this,"_resources",void 0),ye(this,"_consumers",void 0),ye(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:r,forceUpdate:n=!1,persistent:o=!0}=e,c=this._resources[t];c?c.setData(r,n):(c=new eq(t,r,this._context),this._resources[t]=c),c.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const r=this._consumers[t];if(r){for(const n in r){const o=r[n],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:r,consumerId:n,requestId:o="default"}=e;const{_resources:c,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),c[t]||this.add({resourceId:t,data:null,persistent:!1}));const m=c[t];if(this._track(n,o,m,r),m)return m.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,n){const o=this._consumers,c=o[e]=o[e]||{},s=c[t]||{},m=s.resourceId&&this._resources[s.resourceId];m&&(m.unsubscribe(s),this.prune()),r&&(c[t]=s,s.onChange=n,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const Jw={name:"project32",dependencies:[Qw],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},Yw={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...gG},iq=[Qw],rq=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function nq(i){const e=Vm.getDefaultProgramManager(i);for(const t of iq)e.addDefaultModule(t);for(const t of rq)e.addShaderHook(t);return e}const sq="layerManager.setLayers",oq="layerManager.activateViewport";class aq{constructor(e){let{deck:t,stats:r,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"layers",void 0),ye(this,"context",void 0),ye(this,"resourceManager",void 0),ye(this,"_lastRenderedLayers",[]),ye(this,"_needsRedraw",!1),ye(this,"_needsUpdate",!1),ye(this,"_nextLayers",null),ye(this,"_debug",!1),ye(this,"activateViewport",c=>{bl(oq,this,c),c&&(this.context.viewport=c)}),this.layers=[],this.resourceManager=new tq({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&nq(e),stats:r||new ew({id:"deck.gl"}),viewport:n||new Np({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new F3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){bl(sq,this,t,e),this._lastRenderedLayers=e;const r=N_(e,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const c of e)r[c.id]?Dn.warn("Multiple old layers with same id ".concat(c.id))():r[c.id]=c;const n=[];this._updateSublayersRecursively(t,r,n),this._finalizeOldLayers(r);let o=!1;for(const c of n)if(c.hasUniformTransition()){o="Uniform transition in ".concat(c);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,r){for(const n of e){n.context=this.context;const o=t[n.id];o===null&&Dn.warn("Multiple new layers with same id ".concat(n.id))(),t[n.id]=null;let c=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),c=n.isComposite?n.getSubLayers():null}catch(s){this._handleError("matching",s,n)}c&&this._updateSublayersRecursively(c,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=zp.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=zp.MATCHED,t!==e&&(e.lifecycle=zp.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=zp.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=zp.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ph(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ph(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),n=Object.keys(e);if(r.length!==n.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!Ph(i[o],e[o],t-1))return!1;return!0}return!1}class lq{constructor(e){ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"views",void 0),ye(this,"viewState",void 0),ye(this,"controllers",void 0),ye(this,"timeline",void 0),ye(this,"_viewports",void 0),ye(this,"_viewportMap",void 0),ye(this,"_isUpdating",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_needsUpdate",void 0),ye(this,"_eventManager",void 0),ye(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),n={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const c=r[o];if(c.containsPixel(n)){const s=e.slice();return s[0]-=c.x,s[1]-=c.y,c.unproject(s,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=N_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ph(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Dn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var c;return(c=this.getView(e.id))===null||c===void 0?void 0:c.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,n){const o=e.controller;if(o&&r){const c={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,c)),n&&n.setProps(c),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=e.length;n--;){const o=e[n],c=this.getViewState(o),s=o.makeViewport({viewState:c,width:this.width,height:this.height});let m=t[o.id];const x=!!o.controller;x&&!m&&(r=!0),(r||!x)&&m&&(m.finalize(),m=null),this.controllers[o.id]=this._updateController(o,c,s,m),s&&this._viewports.unshift(s)}for(const n in t){const o=t[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,n)=>!e[n].equals(t[n]))}}const cq=/([0-9]+\.?[0-9]*)(%|px)/;function ZA(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=cq.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(i))}}function JA(i,e){return i.relative?Math.round(i.position*e):i.position}function el(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class uq{constructor(e){ye(this,"id",void 0),ye(this,"viewportInstance",void 0),ye(this,"_x",void 0),ye(this,"_y",void 0),ye(this,"_width",void 0),ye(this,"_height",void 0),ye(this,"_padding",void 0),ye(this,"props",void 0);const{id:t,x:r=0,y:n=0,width:o="100%",height:c="100%",padding:s=null,viewportInstance:m}=e||{};el(!m||m instanceof Np),this.viewportInstance=m,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ZA(r),this._y=ZA(n),this._width=ZA(o),this._height=ZA(c),this._padding=s&&{left:ZA(s.left||0),right:ZA(s.right||0),top:ZA(s.top||0),bottom:ZA(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Ph(this.props,e.props,2)}makeViewport(e){let{width:t,height:r,viewState:n}=e;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions(e){let{width:t,height:r}=e;const n={x:JA(this._x,t),y:JA(this._y,r),width:JA(this._width,t),height:JA(this._height,r)};return this._padding&&(n.padding={left:JA(this._padding.left,t),top:JA(this._padding.top,r),right:JA(this._padding.right,t),bottom:JA(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Wm{constructor(e){ye(this,"_inProgress",void 0),ye(this,"_handle",void 0),ye(this,"_timeline",void 0),ye(this,"time",void 0),ye(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const nL=()=>{},e2={BREAK:1,SNAP_TO_END:2,IGNORE:3},hq=i=>i,Aq=e2.BREAK;class dq{constructor(e){ye(this,"getControllerState",void 0),ye(this,"props",void 0),ye(this,"propsInTransition",void 0),ye(this,"transition",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:n,startProps:o,endProps:c,duration:s,easing:m}}=t,x=m(r/s),I=n.interpolateProps(o,c,x);this.propsInTransition=this.getControllerState({...this.props,...I}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Wm(e.timeline),this.onViewStateChange=e.onViewStateChange||nL,this.onStateChange=e.onStateChange||nL}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let n=r;if(this.transition.inProgress){const{interruption:o,endProps:c}=this.transition.settings;n={...r,...o===e2.SNAP_TO_END?c:this.propsInTransition||r}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===e2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,c=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(c===0)return;const s=o.initializeProps(e,n);this.propsInTransition={};const m={duration:c,easing:t.transitionEasing||hq,interpolator:o,interruption:t.transitionInterruption||Aq,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(m),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class fq{constructor(e){ye(this,"_propsToCompare",void 0),ye(this,"_propsToExtract",void 0),ye(this,"_requiredProps",void 0);const{compare:t,extract:r,required:n}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=n}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!qu(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];el(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const pq=["longitude","latitude","zoom","bearing","pitch"],gq=["longitude","latitude","zoom"];class sL extends fq{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:pq,required:gq},super(r.transitionProps),ye(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const c=n(e),s=n(t),m=c.unproject(o);r.start.around=o,Object.assign(r.end,{around:s.project(m),aroundPosition:m,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const n={};for(const o of this._propsToExtract)n[o]=w_(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...n});Object.assign(n,o.panByPosition(t.aroundPosition,w_(e.around,t.around,r)))}return n}}const YA={transitionDuration:0},mq=300,z_=i=>1-(1-i)*(1-i),Vp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},of={};class yq{constructor(e){ye(this,"props",void 0),ye(this,"state",{}),ye(this,"transitionManager",void 0),ye(this,"eventManager",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"makeViewport",void 0),ye(this,"_controllerState",void 0),ye(this,"_events",{}),ye(this,"_interactionState",{isDragging:!1}),ye(this,"_customEvents",[]),ye(this,"_eventStartBlocked",null),ye(this,"_panMove",!1),ye(this,"invertPan",!1),ye(this,"dragMode","rotate"),ye(this,"inertia",0),ye(this,"scrollZoom",!0),ye(this,"dragPan",!0),ye(this,"dragRotate",!0),ye(this,"doubleClickZoom",!0),ye(this,"touchZoom",!0),ye(this,"touchRotate",!1),ye(this,"keyboard",!0),this.transitionManager=new dq({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-r]}isPointInBounds(e,t){const{width:r,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?mq:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:c=!0,touchZoom:s=!0,touchRotate:m=!1,keyboard:x=!0}=e,I=!!this.onViewStateChange;this.toggleEvents(Vp.WHEEL,I&&r),this.toggleEvents(Vp.PAN,I),this.toggleEvents(Vp.PINCH,I&&(s||m)),this.toggleEvents(Vp.TRIPLE_PAN,I&&m),this.toggleEvents(Vp.DOUBLE_TAP,I&&c),this.toggleEvents(Vp.KEYBOARD,I&&x),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=s,this.touchRotate=m,this.keyboard=x}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:c})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(n,YA,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,YA,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:z_},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,YA,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:z_},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let c=2/(1+Math.exp(-Math.abs(o*r)));o<0&&c!==0&&(c=1/c);const s=this.controllerState.zoom({pos:t,scale:c});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,YA,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,YA,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:z_},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return of._startPinchRotation=e.rotation,of._lastPinchEvent=e,this.updateViewport(r,YA,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:of._startPinchRotation-r})}return this.updateViewport(t,YA,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),of._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=of;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const c=Math.log2(e.scale),s=(c-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),m=Math.pow(2,c+s*t/2);o=o.zoom({pos:n,scale:m}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:z_},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return of._startPinchRotation=null,of._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let m;const x={};switch(e.srcEvent.code){case"Minus":m=t?s.zoomOut(r).zoomOut(r):s.zoomOut(r),x.isZooming=!0;break;case"Equal":m=t?s.zoomIn(r).zoomIn(r):s.zoomIn(r),x.isZooming=!0;break;case"ArrowLeft":t?(m=s.rotateLeft(o),x.isRotating=!0):(m=s.moveLeft(n),x.isPanning=!0);break;case"ArrowRight":t?(m=s.rotateRight(o),x.isRotating=!0):(m=s.moveRight(n),x.isPanning=!0);break;case"ArrowUp":t?(m=s.rotateUp(c),x.isRotating=!0):(m=s.moveUp(n),x.isPanning=!0);break;case"ArrowDown":t?(m=s.rotateDown(c),x.isRotating=!0):(m=s.moveDown(n),x.isPanning=!0);break;default:return!1}return this.updateViewport(m,this._getTransitionProps(),x),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?YA:e?{...t,transitionInterpolator:new sL({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class _q{constructor(e,t){ye(this,"_viewportProps",void 0),ye(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const oL=5,vq=1.2;class bq extends _q{constructor(e){const{width:t,height:r,latitude:n,longitude:o,zoom:c,bearing:s=0,pitch:m=0,altitude:x=1.5,position:I=[0,0,0],maxZoom:F=20,minZoom:O=0,maxPitch:z=60,minPitch:ie=0,startPanLngLat:ne,startZoomLngLat:ue,startRotatePos:ce,startBearing:de,startPitch:be,startZoom:Te,normalize:je=!0}=e;el(Number.isFinite(o)),el(Number.isFinite(n)),el(Number.isFinite(c)),super({width:t,height:r,latitude:n,longitude:o,zoom:c,bearing:s,pitch:m,altitude:x,maxZoom:F,minZoom:O,maxPitch:z,minPitch:ie,normalize:je,position:I},{startPanLngLat:ne,startZoomLngLat:ue,startRotatePos:ce,startBearing:de,startPitch:be,startZoom:Te}),ye(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:r}=e;const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:r=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:c,startPitch:s}=this.getState();if(!o||c===void 0||s===void 0)return this;let m;return t?m=this._getNewRotation(t,o,s,c):m={bearing:c+r,pitch:s+n},this._getUpdatedState(m)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:r,scale:n}=e,{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(r)||this._unproject(t)),!c)return this;const{maxZoom:s,minZoom:m}=this.getViewportProps();let x=o+Math.log2(n);x=gA(x,m,s);const I=this.makeViewport({...this.getViewportProps(),zoom:x});return this._getUpdatedState({zoom:x,...I.panByPosition(c,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:o}=r;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:n}=e;e.zoom=gA(n,r,t);const{maxPitch:o,minPitch:c,pitch:s}=e;e.pitch=gA(s,c,o);const{normalize:m=!0}=e;return m&&Object.assign(e,Sj(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,n){const o=e[0]-t[0],c=e[1]-t[1],s=e[1],m=t[1],{width:x,height:I}=this.getViewportProps(),F=o/x;let O=0;c>0?Math.abs(I-m)>oL&&(O=c/(m-I)*vq):c<0&&m>oL&&(O=1-s/m),O=gA(O,-1,1);const{minPitch:z,maxPitch:ie}=this.getViewportProps(),ne=n+180*F;let ue=r;return O>0?ue=r+O*(ie-r):O<0&&(ue=r-O*(z-r)),{pitch:ue,bearing:ne}}}class xq extends yq{constructor(){super(...arguments),ye(this,"ControllerState",bq),ye(this,"transition",{transitionDuration:300,transitionInterpolator:new sL({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),ye(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class t2 extends uq{get ViewportType(){return nf}get ControllerType(){return xq}}ye(t2,"displayName","MapView");const wq=new Kw;function Bq(i,e){var t,r;const n=(t=i.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return n-o}class Cq{constructor(){ye(this,"effects",void 0),ye(this,"_resolvedEffects",[]),ye(this,"_defaultEffects",[]),ye(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(n=>Bq(n,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ph(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const r=[];for(const n of e){const o=t[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),r.push(o)):(o.cleanup(),r.push(n)):r.push(n),delete t[n.id]}for(const n in t)t[n].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(n=>n instanceof Kw)||this._resolvedEffects.push(wq),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Eq extends zw{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Sq="deckRenderer.renderLayers";class Tq{constructor(e){ye(this,"gl",void 0),ye(this,"layerFilter",void 0),ye(this,"drawPickingColors",void 0),ye(this,"drawLayersPass",void 0),ye(this,"pickLayersPass",void 0),ye(this,"renderCount",void 0),ye(this,"_needsRedraw",void 0),ye(this,"renderBuffers",void 0),ye(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Eq(e),this.pickLayersPass=new iL(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||ba.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,bl(Sq,this,o,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new ba(this.gl),new ba(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,n={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=t.target,o.postRender(this.gl,n);break}const c=o.postRender(this.gl,n);n.inputBuffer=c,n.swapBuffer=c===r[0]?r[1]:r[0]}}}const Iq={pickedColor:null,pickedObjectIndex:-1};function Lq(i){let{pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:c}=i;const{x:s,y:m,width:x,height:I}=c;let F=o*o,O=-1,z=0;for(let ie=0;ie<I;ie++){const ne=ie+m-n,ue=ne*ne;if(ue>F)z+=4*x;else for(let ce=0;ce<x;ce++){if(e[z+3]-1>=0){const be=ce+s-r,Te=be*be+ue;Te<=F&&(F=Te,O=z)}z+=4}}if(O>=0){const ie=e.slice(O,O+4),ne=t(ie);if(ne){const ue=Math.floor(O/4/x),ce=O/4-ue*x;return{...ne,pickedColor:ie,pickedX:s+ce,pickedY:m+ue}}Dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Iq}function Mq(i){let{pickedColors:e,decodePickingColor:t}=i;const r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const c=e.slice(n,n+4),s=c.join(",");if(!r.has(s)){const m=t(c);m?r.set(s,{...m,color:c}):Dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function aL(i){let{pickInfo:e,viewports:t,pixelRatio:r,x:n,y:o,z:c}=i,s=t[0];t.length>1&&(s=Fq((e==null?void 0:e.pickedViewports)||t,{x:n,y:o}));let m;if(s){const x=[n-s.x,o-s.y];c!==void 0&&(x[2]=c),m=s.unproject(x)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:m,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function Pq(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:n}=i,{pickedColor:o,pickedLayer:c,pickedObjectIndex:s}=e,m=c?[c]:[];if(r==="hover"){const F=t.index,O=t.layerId,z=c?c.props.id:null;if(z!==O||s!==F){if(z!==O){const ie=n.find(ne=>ne.props.id===O);ie&&m.unshift(ie)}t.layerId=z,t.index=s,t.info=null}}const x=aL(i),I=new Map;return I.set(null,x),m.forEach(F=>{let O={...x};F===c&&(O.color=o,O.index=s,O.picked=!0),O=lL({layer:F,info:O,mode:r});const z=O.layer;F===c&&r==="hover"&&(t.info=O),I.set(z.id,O),r==="hover"&&z.updateAutoHighlight(O)}),I}function lL(i){let{layer:e,info:t,mode:r}=i;for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function Fq(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class Dq{constructor(e){ye(this,"gl",void 0),ye(this,"pickingFBO",void 0),ye(this,"depthFBO",void 0),ye(this,"pickLayersPass",void 0),ye(this,"layerFilter",void 0),ye(this,"lastPickedInfo",void 0),ye(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new iL(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:r,layers:n,viewports:o}=e,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const s=c&&c.layer&&c.layer.id,m=c&&c.viewport&&c.viewport.id,x=s?n.find(z=>z.id===s):null,I=m&&o.find(z=>z.id===m)||o[0],F=I&&I.unproject([t-I.x,r-I.y]);return{...c,...{x:t,y:r,viewport:I,coordinate:F,layer:x}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new ba(r),ba.isSupported(r,{colorBufferFloat:!0}))){const n=new ba(r);n.attach({36064:new jc(r,{format:hn(r)?34836:6408,type:5126})}),this.depthFBO=n}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:r,viewports:n,x:o,y:c,radius:s=0,depth:m=1,mode:x="query",unproject3D:I,onViewportActive:F,effects:O}=e;const z=this._getPickable(t),ie=Sp(this.gl);if(!z)return{result:[],emptyInfo:aL({viewports:n,x:o,y:c,pixelRatio:ie})};this._resizeBuffer();const ne=Zx(this.gl,[o,c],!0),ue=[ne.x+Math.floor(ne.width/2),ne.y+Math.floor(ne.height/2)],ce=Math.round(s*ie),{width:de,height:be}=this.pickingFBO,Te=this._getPickingRect({deviceX:ue[0],deviceY:ue[1],deviceRadius:ce,deviceWidth:de,deviceHeight:be}),je={x:o-s,y:c-s,width:s*2+1,height:s*2+1};let Ge;const $e=[],Ue=new Set;for(let lt=0;lt<m;lt++){let nt;if(Te){const Fe=this._drawAndSample({layers:z,views:r,viewports:n,onViewportActive:F,deviceRect:Te,cullRect:je,effects:O,pass:"picking:".concat(x)});nt=Lq({...Fe,deviceX:ue[0],deviceY:ue[1],deviceRadius:ce,deviceRect:Te})}else nt={pickedColor:null,pickedObjectIndex:-1};let De;if(nt.pickedLayer&&I&&this.depthFBO){const{pickedColors:Fe}=this._drawAndSample({layers:[nt.pickedLayer],views:r,viewports:n,onViewportActive:F,deviceRect:{x:nt.pickedX,y:nt.pickedY,width:1,height:1},cullRect:je,effects:O,pass:"picking:".concat(x,":z")},!0);Fe[3]&&(De=Fe[0])}nt.pickedLayer&&lt+1<m&&(Ue.add(nt.pickedLayer),nt.pickedLayer.disablePickingIndex(nt.pickedObjectIndex)),Ge=Pq({pickInfo:nt,lastPickedInfo:this.lastPickedInfo,mode:x,layers:z,viewports:n,x:o,y:c,z:De,pixelRatio:ie});for(const Fe of Ge.values())Fe.layer&&$e.push(Fe);if(!nt.pickedColor)break}for(const lt of Ue)lt.restorePickingColors();return{result:$e,emptyInfo:Ge.get(null)}}_pickVisibleObjects(e){let{layers:t,views:r,viewports:n,x:o,y:c,width:s=1,height:m=1,mode:x="query",maxObjects:I=null,onViewportActive:F,effects:O}=e;const z=this._getPickable(t);if(!z)return[];this._resizeBuffer();const ie=Sp(this.gl),ne=Zx(this.gl,[o,c],!0),ue=ne.x,ce=ne.y+ne.height,de=Zx(this.gl,[o+s,c+m],!0),be=de.x+de.width,Te=de.y,je={x:ue,y:Te,width:be-ue,height:ce-Te},Ge=this._drawAndSample({layers:z,views:r,viewports:n,onViewportActive:F,deviceRect:je,cullRect:{x:o,y:c,width:s,height:m},effects:O,pass:"picking:".concat(x)}),$e=Mq(Ge),Ue=new Map,lt=Number.isFinite(I);for(let De=0;De<$e.length;De++){var nt;if(lt&&I&&Ue.size>=I)break;const Fe=$e[De];let Je={color:Fe.pickedColor,layer:null,index:Fe.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:ie};Je=lL({layer:Fe.pickedLayer,info:Je,mode:x});const We=(nt=Je.object)!==null&&nt!==void 0?nt:"".concat(Je.layer.id,"[").concat(Je.index,"]");Ue.has(We)||Ue.set(We,Je)}return Array.from(Ue.values())}_drawAndSample(e){let{layers:t,views:r,viewports:n,onViewportActive:o,deviceRect:c,cullRect:s,effects:m,pass:x}=e,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const F=I?this.depthFBO:this.pickingFBO,O={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:F,deviceRect:c,cullRect:s,effects:m,pass:x,pickZ:I,preRenderStats:{}};for(const be of m)be.useInPicking&&(O.preRenderStats[be.id]=be.preRender(this.gl,O));const{decodePickingColor:z}=this.pickLayersPass.render(O),{x:ie,y:ne,width:ue,height:ce}=c,de=new(I?Float32Array:Uint8Array)(ue*ce*4);return d_(F,{sourceX:ie,sourceY:ne,sourceWidth:ue,sourceHeight:ce,target:de}),{pickedColors:de,decodePickingColor:z}}_getPickingRect(e){let{deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:c}=e;const s=Math.max(0,t-n),m=Math.max(0,r-n),x=Math.min(o,t+n+1)-s,I=Math.min(c,r+n+1)-m;return x<=0||I<=0?null:{x:s,y:m,width:x,height:I}}}const Rq={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class kq{constructor(e){ye(this,"el",null),ye(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Rq),t.appendChild(this.el))}setTooltip(e,t,r){const n=this.el;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var cL={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,t,r,n){var o=["","webkit","Moz","MS","ms","o"],c=t.createElement("div"),s="function",m=Math.round,x=Math.abs,I=Date.now;function F(Ne,Ze,dt){return setTimeout(be(Ne,dt),Ze)}function O(Ne,Ze,dt){return Array.isArray(Ne)?(z(Ne,dt[Ze],dt),!0):!1}function z(Ne,Ze,dt){var Ot;if(Ne)if(Ne.forEach)Ne.forEach(Ze,dt);else if(Ne.length!==n)for(Ot=0;Ot<Ne.length;)Ze.call(dt,Ne[Ot],Ot,Ne),Ot++;else for(Ot in Ne)Ne.hasOwnProperty(Ot)&&Ze.call(dt,Ne[Ot],Ot,Ne)}function ie(Ne,Ze,dt){var Ot="DEPRECATED METHOD: "+Ze+`
`+dt+` AT 
`;return function(){var ui=new Error("get-stack-trace"),Gi=ui&&ui.stack?ui.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",br=e.console&&(e.console.warn||e.console.log);return br&&br.call(e.console,Ot,Gi),Ne.apply(this,arguments)}}var ne;typeof Object.assign!="function"?ne=function(Ze){if(Ze===n||Ze===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Ze),Ot=1;Ot<arguments.length;Ot++){var ui=arguments[Ot];if(ui!==n&&ui!==null)for(var Gi in ui)ui.hasOwnProperty(Gi)&&(dt[Gi]=ui[Gi])}return dt}:ne=Object.assign;var ue=ie(function(Ze,dt,Ot){for(var ui=Object.keys(dt),Gi=0;Gi<ui.length;)(!Ot||Ot&&Ze[ui[Gi]]===n)&&(Ze[ui[Gi]]=dt[ui[Gi]]),Gi++;return Ze},"extend","Use `assign`."),ce=ie(function(Ze,dt){return ue(Ze,dt,!0)},"merge","Use `assign`.");function de(Ne,Ze,dt){var Ot=Ze.prototype,ui;ui=Ne.prototype=Object.create(Ot),ui.constructor=Ne,ui._super=Ot,dt&&ne(ui,dt)}function be(Ne,Ze){return function(){return Ne.apply(Ze,arguments)}}function Te(Ne,Ze){return typeof Ne==s?Ne.apply(Ze&&Ze[0]||n,Ze):Ne}function je(Ne,Ze){return Ne===n?Ze:Ne}function Ge(Ne,Ze,dt){z(nt(Ze),function(Ot){Ne.addEventListener(Ot,dt,!1)})}function $e(Ne,Ze,dt){z(nt(Ze),function(Ot){Ne.removeEventListener(Ot,dt,!1)})}function Ue(Ne,Ze){for(;Ne;){if(Ne==Ze)return!0;Ne=Ne.parentNode}return!1}function lt(Ne,Ze){return Ne.indexOf(Ze)>-1}function nt(Ne){return Ne.trim().split(/\s+/g)}function De(Ne,Ze,dt){if(Ne.indexOf&&!dt)return Ne.indexOf(Ze);for(var Ot=0;Ot<Ne.length;){if(dt&&Ne[Ot][dt]==Ze||!dt&&Ne[Ot]===Ze)return Ot;Ot++}return-1}function Fe(Ne){return Array.prototype.slice.call(Ne,0)}function Je(Ne,Ze,dt){for(var Ot=[],ui=[],Gi=0;Gi<Ne.length;){var br=Ze?Ne[Gi][Ze]:Ne[Gi];De(ui,br)<0&&Ot.push(Ne[Gi]),ui[Gi]=br,Gi++}return dt&&(Ze?Ot=Ot.sort(function(kn,is){return kn[Ze]>is[Ze]}):Ot=Ot.sort()),Ot}function We(Ne,Ze){for(var dt,Ot,ui=Ze[0].toUpperCase()+Ze.slice(1),Gi=0;Gi<o.length;){if(dt=o[Gi],Ot=dt?dt+ui:Ze,Ot in Ne)return Ot;Gi++}return n}var Et=1;function Ct(){return Et++}function Lt(Ne){var Ze=Ne.ownerDocument||Ne;return Ze.defaultView||Ze.parentWindow||e}var _t=/mobile|tablet|ip(ad|hone|od)|android/i,Ft="ontouchstart"in e,Mt=We(e,"PointerEvent")!==n,Wt=Ft&&_t.test(navigator.userAgent),Ee="touch",Xe="pen",et="mouse",At="kinect",ft=25,wt=1,Pt=2,It=4,Ht=8,ii=1,gi=2,mi=4,Mi=8,kt=16,ot=gi|mi,xt=Mi|kt,Ri=ot|xt,ei=["x","y"],ut=["clientX","clientY"];function jt(Ne,Ze){var dt=this;this.manager=Ne,this.callback=Ze,this.element=Ne.element,this.target=Ne.options.inputTarget,this.domHandler=function(Ot){Te(Ne.options.enable,[Ne])&&dt.handler(Ot)},this.init()}jt.prototype={handler:function(){},init:function(){this.evEl&&Ge(this.element,this.evEl,this.domHandler),this.evTarget&&Ge(this.target,this.evTarget,this.domHandler),this.evWin&&Ge(Lt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Lt(this.element),this.evWin,this.domHandler)}};function ni(Ne){var Ze,dt=Ne.options.inputClass;return dt?Ze=dt:Mt?Ze=we:Wt?Ze=Me:Ft?Ze=yt:Ze=vi,new Ze(Ne,di)}function di(Ne,Ze,dt){var Ot=dt.pointers.length,ui=dt.changedPointers.length,Gi=Ze&wt&&Ot-ui===0,br=Ze&(It|Ht)&&Ot-ui===0;dt.isFirst=!!Gi,dt.isFinal=!!br,Gi&&(Ne.session={}),dt.eventType=Ze,li(Ne,dt),Ne.emit("hammer.input",dt),Ne.recognize(dt),Ne.session.prevInput=dt}function li(Ne,Ze){var dt=Ne.session,Ot=Ze.pointers,ui=Ot.length;dt.firstInput||(dt.firstInput=Ar(Ze)),ui>1&&!dt.firstMultiple?dt.firstMultiple=Ar(Ze):ui===1&&(dt.firstMultiple=!1);var Gi=dt.firstInput,br=dt.firstMultiple,En=br?br.center:Gi.center,kn=Ze.center=Er(Ot);Ze.timeStamp=I(),Ze.deltaTime=Ze.timeStamp-Gi.timeStamp,Ze.angle=$t(En,kn),Ze.distance=ci(En,kn),Ki(dt,Ze),Ze.offsetDirection=Ji(Ze.deltaX,Ze.deltaY);var is=Nt(Ze.deltaTime,Ze.deltaX,Ze.deltaY);Ze.overallVelocityX=is.x,Ze.overallVelocityY=is.y,Ze.overallVelocity=x(is.x)>x(is.y)?is.x:is.y,Ze.scale=br?Qt(br.pointers,Ot):1,Ze.rotation=br?Zi(br.pointers,Ot):0,Ze.maxPointers=dt.prevInput?Ze.pointers.length>dt.prevInput.maxPointers?Ze.pointers.length:dt.prevInput.maxPointers:Ze.pointers.length,tr(dt,Ze);var wn=Ne.element;Ue(Ze.srcEvent.target,wn)&&(wn=Ze.srcEvent.target),Ze.target=wn}function Ki(Ne,Ze){var dt=Ze.center,Ot=Ne.offsetDelta||{},ui=Ne.prevDelta||{},Gi=Ne.prevInput||{};(Ze.eventType===wt||Gi.eventType===It)&&(ui=Ne.prevDelta={x:Gi.deltaX||0,y:Gi.deltaY||0},Ot=Ne.offsetDelta={x:dt.x,y:dt.y}),Ze.deltaX=ui.x+(dt.x-Ot.x),Ze.deltaY=ui.y+(dt.y-Ot.y)}function tr(Ne,Ze){var dt=Ne.lastInterval||Ze,Ot=Ze.timeStamp-dt.timeStamp,ui,Gi,br,En;if(Ze.eventType!=Ht&&(Ot>ft||dt.velocity===n)){var kn=Ze.deltaX-dt.deltaX,is=Ze.deltaY-dt.deltaY,wn=Nt(Ot,kn,is);Gi=wn.x,br=wn.y,ui=x(wn.x)>x(wn.y)?wn.x:wn.y,En=Ji(kn,is),Ne.lastInterval=Ze}else ui=dt.velocity,Gi=dt.velocityX,br=dt.velocityY,En=dt.direction;Ze.velocity=ui,Ze.velocityX=Gi,Ze.velocityY=br,Ze.direction=En}function Ar(Ne){for(var Ze=[],dt=0;dt<Ne.pointers.length;)Ze[dt]={clientX:m(Ne.pointers[dt].clientX),clientY:m(Ne.pointers[dt].clientY)},dt++;return{timeStamp:I(),pointers:Ze,center:Er(Ze),deltaX:Ne.deltaX,deltaY:Ne.deltaY}}function Er(Ne){var Ze=Ne.length;if(Ze===1)return{x:m(Ne[0].clientX),y:m(Ne[0].clientY)};for(var dt=0,Ot=0,ui=0;ui<Ze;)dt+=Ne[ui].clientX,Ot+=Ne[ui].clientY,ui++;return{x:m(dt/Ze),y:m(Ot/Ze)}}function Nt(Ne,Ze,dt){return{x:Ze/Ne||0,y:dt/Ne||0}}function Ji(Ne,Ze){return Ne===Ze?ii:x(Ne)>=x(Ze)?Ne<0?gi:mi:Ze<0?Mi:kt}function ci(Ne,Ze,dt){dt||(dt=ei);var Ot=Ze[dt[0]]-Ne[dt[0]],ui=Ze[dt[1]]-Ne[dt[1]];return Math.sqrt(Ot*Ot+ui*ui)}function $t(Ne,Ze,dt){dt||(dt=ei);var Ot=Ze[dt[0]]-Ne[dt[0]],ui=Ze[dt[1]]-Ne[dt[1]];return Math.atan2(ui,Ot)*180/Math.PI}function Zi(Ne,Ze){return $t(Ze[1],Ze[0],ut)+$t(Ne[1],Ne[0],ut)}function Qt(Ne,Ze){return ci(Ze[0],Ze[1],ut)/ci(Ne[0],Ne[1],ut)}var Bi={mousedown:wt,mousemove:Pt,mouseup:It},Ii="mousedown",Gt="mousemove mouseup";function vi(){this.evEl=Ii,this.evWin=Gt,this.pressed=!1,jt.apply(this,arguments)}de(vi,jt,{handler:function(Ze){var dt=Bi[Ze.type];dt&wt&&Ze.button===0&&(this.pressed=!0),dt&Pt&&Ze.which!==1&&(dt=It),this.pressed&&(dt&It&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Ze],changedPointers:[Ze],pointerType:et,srcEvent:Ze}))}});var Jt={pointerdown:wt,pointermove:Pt,pointerup:It,pointercancel:Ht,pointerout:Ht},mr={2:Ee,3:Xe,4:et,5:At},Sr="pointerdown",ze="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Sr="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel");function we(){this.evEl=Sr,this.evWin=ze,jt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}de(we,jt,{handler:function(Ze){var dt=this.store,Ot=!1,ui=Ze.type.toLowerCase().replace("ms",""),Gi=Jt[ui],br=mr[Ze.pointerType]||Ze.pointerType,En=br==Ee,kn=De(dt,Ze.pointerId,"pointerId");Gi&wt&&(Ze.button===0||En)?kn<0&&(dt.push(Ze),kn=dt.length-1):Gi&(It|Ht)&&(Ot=!0),!(kn<0)&&(dt[kn]=Ze,this.callback(this.manager,Gi,{pointers:dt,changedPointers:[Ze],pointerType:br,srcEvent:Ze}),Ot&&dt.splice(kn,1))}});var oe={touchstart:wt,touchmove:Pt,touchend:It,touchcancel:Ht},Y="touchstart",le="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=Y,this.evWin=le,this.started=!1,jt.apply(this,arguments)}de(ge,jt,{handler:function(Ze){var dt=oe[Ze.type];if(dt===wt&&(this.started=!0),!!this.started){var Ot=_e.call(this,Ze,dt);dt&(It|Ht)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,dt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Ee,srcEvent:Ze})}}});function _e(Ne,Ze){var dt=Fe(Ne.touches),Ot=Fe(Ne.changedTouches);return Ze&(It|Ht)&&(dt=Je(dt.concat(Ot),"identifier",!0)),[dt,Ot]}var Ce={touchstart:wt,touchmove:Pt,touchend:It,touchcancel:Ht},ve="touchstart touchmove touchend touchcancel";function Me(){this.evTarget=ve,this.targetIds={},jt.apply(this,arguments)}de(Me,jt,{handler:function(Ze){var dt=Ce[Ze.type],Ot=Oe.call(this,Ze,dt);Ot&&this.callback(this.manager,dt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Ee,srcEvent:Ze})}});function Oe(Ne,Ze){var dt=Fe(Ne.touches),Ot=this.targetIds;if(Ze&(wt|Pt)&&dt.length===1)return Ot[dt[0].identifier]=!0,[dt,dt];var ui,Gi,br=Fe(Ne.changedTouches),En=[],kn=this.target;if(Gi=dt.filter(function(is){return Ue(is.target,kn)}),Ze===wt)for(ui=0;ui<Gi.length;)Ot[Gi[ui].identifier]=!0,ui++;for(ui=0;ui<br.length;)Ot[br[ui].identifier]&&En.push(br[ui]),Ze&(It|Ht)&&delete Ot[br[ui].identifier],ui++;if(En.length)return[Je(Gi.concat(En),"identifier",!0),En]}var Ve=2500,it=25;function yt(){jt.apply(this,arguments);var Ne=be(this.handler,this);this.touch=new Me(this.manager,Ne),this.mouse=new vi(this.manager,Ne),this.primaryTouch=null,this.lastTouches=[]}de(yt,jt,{handler:function(Ze,dt,Ot){var ui=Ot.pointerType==Ee,Gi=Ot.pointerType==et;if(!(Gi&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(ui)Bt.call(this,dt,Ot);else if(Gi&&qt.call(this,Ot))return;this.callback(Ze,dt,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Bt(Ne,Ze){Ne&wt?(this.primaryTouch=Ze.changedPointers[0].identifier,Yt.call(this,Ze)):Ne&(It|Ht)&&Yt.call(this,Ze)}function Yt(Ne){var Ze=Ne.changedPointers[0];if(Ze.identifier===this.primaryTouch){var dt={x:Ze.clientX,y:Ze.clientY};this.lastTouches.push(dt);var Ot=this.lastTouches,ui=function(){var Gi=Ot.indexOf(dt);Gi>-1&&Ot.splice(Gi,1)};setTimeout(ui,Ve)}}function qt(Ne){for(var Ze=Ne.srcEvent.clientX,dt=Ne.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var ui=this.lastTouches[Ot],Gi=Math.abs(Ze-ui.x),br=Math.abs(dt-ui.y);if(Gi<=it&&br<=it)return!0}return!1}var Kt=We(c.style,"touchAction"),si=Kt!==n,Ci="compute",Hi="auto",wi="manipulation",Ui="none",st="pan-x",ti="pan-y",zt=sn();function zi(Ne,Ze){this.manager=Ne,this.set(Ze)}zi.prototype={set:function(Ne){Ne==Ci&&(Ne=this.compute()),si&&this.manager.element.style&&zt[Ne]&&(this.manager.element.style[Kt]=Ne),this.actions=Ne.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ne=[];return z(this.manager.recognizers,function(Ze){Te(Ze.options.enable,[Ze])&&(Ne=Ne.concat(Ze.getTouchAction()))}),hr(Ne.join(" "))},preventDefaults:function(Ne){var Ze=Ne.srcEvent,dt=Ne.offsetDirection;if(this.manager.session.prevented){Ze.preventDefault();return}var Ot=this.actions,ui=lt(Ot,Ui)&&!zt[Ui],Gi=lt(Ot,ti)&&!zt[ti],br=lt(Ot,st)&&!zt[st];if(ui){var En=Ne.pointers.length===1,kn=Ne.distance<2,is=Ne.deltaTime<250;if(En&&kn&&is)return}if(!(br&&Gi)&&(ui||Gi&&dt&ot||br&&dt&xt))return this.preventSrc(Ze)},preventSrc:function(Ne){this.manager.session.prevented=!0,Ne.preventDefault()}};function hr(Ne){if(lt(Ne,Ui))return Ui;var Ze=lt(Ne,st),dt=lt(Ne,ti);return Ze&&dt?Ui:Ze||dt?Ze?st:ti:lt(Ne,wi)?wi:Hi}function sn(){if(!si)return!1;var Ne={},Ze=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){Ne[dt]=Ze?e.CSS.supports("touch-action",dt):!0}),Ne}var bn=1,ur=2,gn=4,mn=8,lr=mn,Rn=16,ps=32;function Qr(Ne){this.options=ne({},this.defaults,Ne||{}),this.id=Ct(),this.manager=null,this.options.enable=je(this.options.enable,!0),this.state=bn,this.simultaneous={},this.requireFail=[]}Qr.prototype={defaults:{},set:function(Ne){return ne(this.options,Ne),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ne){if(O(Ne,"recognizeWith",this))return this;var Ze=this.simultaneous;return Ne=cs(Ne,this),Ze[Ne.id]||(Ze[Ne.id]=Ne,Ne.recognizeWith(this)),this},dropRecognizeWith:function(Ne){return O(Ne,"dropRecognizeWith",this)?this:(Ne=cs(Ne,this),delete this.simultaneous[Ne.id],this)},requireFailure:function(Ne){if(O(Ne,"requireFailure",this))return this;var Ze=this.requireFail;return Ne=cs(Ne,this),De(Ze,Ne)===-1&&(Ze.push(Ne),Ne.requireFailure(this)),this},dropRequireFailure:function(Ne){if(O(Ne,"dropRequireFailure",this))return this;Ne=cs(Ne,this);var Ze=De(this.requireFail,Ne);return Ze>-1&&this.requireFail.splice(Ze,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ne){return!!this.simultaneous[Ne.id]},emit:function(Ne){var Ze=this,dt=this.state;function Ot(ui){Ze.manager.emit(ui,Ne)}dt<mn&&Ot(Ze.options.event+xn(dt)),Ot(Ze.options.event),Ne.additionalEvent&&Ot(Ne.additionalEvent),dt>=mn&&Ot(Ze.options.event+xn(dt))},tryEmit:function(Ne){if(this.canEmit())return this.emit(Ne);this.state=ps},canEmit:function(){for(var Ne=0;Ne<this.requireFail.length;){if(!(this.requireFail[Ne].state&(ps|bn)))return!1;Ne++}return!0},recognize:function(Ne){var Ze=ne({},Ne);if(!Te(this.options.enable,[this,Ze])){this.reset(),this.state=ps;return}this.state&(lr|Rn|ps)&&(this.state=bn),this.state=this.process(Ze),this.state&(ur|gn|mn|Rn)&&this.tryEmit(Ze)},process:function(Ne){},getTouchAction:function(){},reset:function(){}};function xn(Ne){return Ne&Rn?"cancel":Ne&mn?"end":Ne&gn?"move":Ne&ur?"start":""}function So(Ne){return Ne==kt?"down":Ne==Mi?"up":Ne==gi?"left":Ne==mi?"right":""}function cs(Ne,Ze){var dt=Ze.manager;return dt?dt.get(Ne):Ne}function Wi(){Qr.apply(this,arguments)}de(Wi,Qr,{defaults:{pointers:1},attrTest:function(Ne){var Ze=this.options.pointers;return Ze===0||Ne.pointers.length===Ze},process:function(Ne){var Ze=this.state,dt=Ne.eventType,Ot=Ze&(ur|gn),ui=this.attrTest(Ne);return Ot&&(dt&Ht||!ui)?Ze|Rn:Ot||ui?dt&It?Ze|mn:Ze&ur?Ze|gn:ur:ps}});function Js(){Wi.apply(this,arguments),this.pX=null,this.pY=null}de(Js,Wi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ri},getTouchAction:function(){var Ne=this.options.direction,Ze=[];return Ne&ot&&Ze.push(ti),Ne&xt&&Ze.push(st),Ze},directionTest:function(Ne){var Ze=this.options,dt=!0,Ot=Ne.distance,ui=Ne.direction,Gi=Ne.deltaX,br=Ne.deltaY;return ui&Ze.direction||(Ze.direction&ot?(ui=Gi===0?ii:Gi<0?gi:mi,dt=Gi!=this.pX,Ot=Math.abs(Ne.deltaX)):(ui=br===0?ii:br<0?Mi:kt,dt=br!=this.pY,Ot=Math.abs(Ne.deltaY))),Ne.direction=ui,dt&&Ot>Ze.threshold&&ui&Ze.direction},attrTest:function(Ne){return Wi.prototype.attrTest.call(this,Ne)&&(this.state&ur||!(this.state&ur)&&this.directionTest(Ne))},emit:function(Ne){this.pX=Ne.deltaX,this.pY=Ne.deltaY;var Ze=So(Ne.direction);Ze&&(Ne.additionalEvent=this.options.event+Ze),this._super.emit.call(this,Ne)}});function ws(){Wi.apply(this,arguments)}de(ws,Wi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ui]},attrTest:function(Ne){return this._super.attrTest.call(this,Ne)&&(Math.abs(Ne.scale-1)>this.options.threshold||this.state&ur)},emit:function(Ne){if(Ne.scale!==1){var Ze=Ne.scale<1?"in":"out";Ne.additionalEvent=this.options.event+Ze}this._super.emit.call(this,Ne)}});function dr(){Qr.apply(this,arguments),this._timer=null,this._input=null}de(dr,Qr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function(Ne){var Ze=this.options,dt=Ne.pointers.length===Ze.pointers,Ot=Ne.distance<Ze.threshold,ui=Ne.deltaTime>Ze.time;if(this._input=Ne,!Ot||!dt||Ne.eventType&(It|Ht)&&!ui)this.reset();else if(Ne.eventType&wt)this.reset(),this._timer=F(function(){this.state=lr,this.tryEmit()},Ze.time,this);else if(Ne.eventType&It)return lr;return ps},reset:function(){clearTimeout(this._timer)},emit:function(Ne){this.state===lr&&(Ne&&Ne.eventType&It?this.manager.emit(this.options.event+"up",Ne):(this._input.timeStamp=I(),this.manager.emit(this.options.event,this._input)))}});function Fr(){Wi.apply(this,arguments)}de(Fr,Wi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ui]},attrTest:function(Ne){return this._super.attrTest.call(this,Ne)&&(Math.abs(Ne.rotation)>this.options.threshold||this.state&ur)}});function Vn(){Wi.apply(this,arguments)}de(Vn,Wi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ot|xt,pointers:1},getTouchAction:function(){return Js.prototype.getTouchAction.call(this)},attrTest:function(Ne){var Ze=this.options.direction,dt;return Ze&(ot|xt)?dt=Ne.overallVelocity:Ze&ot?dt=Ne.overallVelocityX:Ze&xt&&(dt=Ne.overallVelocityY),this._super.attrTest.call(this,Ne)&&Ze&Ne.offsetDirection&&Ne.distance>this.options.threshold&&Ne.maxPointers==this.options.pointers&&x(dt)>this.options.velocity&&Ne.eventType&It},emit:function(Ne){var Ze=So(Ne.offsetDirection);Ze&&this.manager.emit(this.options.event+Ze,Ne),this.manager.emit(this.options.event,Ne)}});function Or(){Qr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}de(Or,Qr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[wi]},process:function(Ne){var Ze=this.options,dt=Ne.pointers.length===Ze.pointers,Ot=Ne.distance<Ze.threshold,ui=Ne.deltaTime<Ze.time;if(this.reset(),Ne.eventType&wt&&this.count===0)return this.failTimeout();if(Ot&&ui&&dt){if(Ne.eventType!=It)return this.failTimeout();var Gi=this.pTime?Ne.timeStamp-this.pTime<Ze.interval:!0,br=!this.pCenter||ci(this.pCenter,Ne.center)<Ze.posThreshold;this.pTime=Ne.timeStamp,this.pCenter=Ne.center,!br||!Gi?this.count=1:this.count+=1,this._input=Ne;var En=this.count%Ze.taps;if(En===0)return this.hasRequireFailures()?(this._timer=F(function(){this.state=lr,this.tryEmit()},Ze.interval,this),ur):lr}return ps},failTimeout:function(){return this._timer=F(function(){this.state=ps},this.options.interval,this),ps},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==lr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Cn(Ne,Ze){return Ze=Ze||{},Ze.recognizers=je(Ze.recognizers,Cn.defaults.preset),new Hs(Ne,Ze)}Cn.VERSION="2.0.7",Cn.defaults={domEvents:!1,touchAction:Ci,enable:!0,inputTarget:null,inputClass:null,preset:[[Fr,{enable:!1}],[ws,{enable:!1},["rotate"]],[Vn,{direction:ot}],[Js,{direction:ot},["swipe"]],[Or],[Or,{event:"doubletap",taps:2},["tap"]],[dr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var An=1,Hr=2;function Hs(Ne,Ze){this.options=ne({},Cn.defaults,Ze||{}),this.options.inputTarget=this.options.inputTarget||Ne,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ne,this.input=ni(this),this.touchAction=new zi(this,this.options.touchAction),ca(this,!0),z(this.options.recognizers,function(dt){var Ot=this.add(new dt[0](dt[1]));dt[2]&&Ot.recognizeWith(dt[2]),dt[3]&&Ot.requireFailure(dt[3])},this)}Hs.prototype={set:function(Ne){return ne(this.options,Ne),Ne.touchAction&&this.touchAction.update(),Ne.inputTarget&&(this.input.destroy(),this.input.target=Ne.inputTarget,this.input.init()),this},stop:function(Ne){this.session.stopped=Ne?Hr:An},recognize:function(Ne){var Ze=this.session;if(!Ze.stopped){this.touchAction.preventDefaults(Ne);var dt,Ot=this.recognizers,ui=Ze.curRecognizer;(!ui||ui&&ui.state&lr)&&(ui=Ze.curRecognizer=null);for(var Gi=0;Gi<Ot.length;)dt=Ot[Gi],Ze.stopped!==Hr&&(!ui||dt==ui||dt.canRecognizeWith(ui))?dt.recognize(Ne):dt.reset(),!ui&&dt.state&(ur|gn|mn)&&(ui=Ze.curRecognizer=dt),Gi++}},get:function(Ne){if(Ne instanceof Qr)return Ne;for(var Ze=this.recognizers,dt=0;dt<Ze.length;dt++)if(Ze[dt].options.event==Ne)return Ze[dt];return null},add:function(Ne){if(O(Ne,"add",this))return this;var Ze=this.get(Ne.options.event);return Ze&&this.remove(Ze),this.recognizers.push(Ne),Ne.manager=this,this.touchAction.update(),Ne},remove:function(Ne){if(O(Ne,"remove",this))return this;if(Ne=this.get(Ne),Ne){var Ze=this.recognizers,dt=De(Ze,Ne);dt!==-1&&(Ze.splice(dt,1),this.touchAction.update())}return this},on:function(Ne,Ze){if(Ne!==n&&Ze!==n){var dt=this.handlers;return z(nt(Ne),function(Ot){dt[Ot]=dt[Ot]||[],dt[Ot].push(Ze)}),this}},off:function(Ne,Ze){if(Ne!==n){var dt=this.handlers;return z(nt(Ne),function(Ot){Ze?dt[Ot]&&dt[Ot].splice(De(dt[Ot],Ze),1):delete dt[Ot]}),this}},emit:function(Ne,Ze){this.options.domEvents&&uo(Ne,Ze);var dt=this.handlers[Ne]&&this.handlers[Ne].slice();if(!(!dt||!dt.length)){Ze.type=Ne,Ze.preventDefault=function(){Ze.srcEvent.preventDefault()};for(var Ot=0;Ot<dt.length;)dt[Ot](Ze),Ot++}},destroy:function(){this.element&&ca(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ca(Ne,Ze){var dt=Ne.element;if(dt.style){var Ot;z(Ne.options.cssProps,function(ui,Gi){Ot=We(dt.style,Gi),Ze?(Ne.oldCssProps[Ot]=dt.style[Ot],dt.style[Ot]=ui):dt.style[Ot]=Ne.oldCssProps[Ot]||""}),Ze||(Ne.oldCssProps={})}}function uo(Ne,Ze){var dt=t.createEvent("Event");dt.initEvent(Ne,!0,!0),dt.gesture=Ze,Ze.target.dispatchEvent(dt)}ne(Cn,{INPUT_START:wt,INPUT_MOVE:Pt,INPUT_END:It,INPUT_CANCEL:Ht,STATE_POSSIBLE:bn,STATE_BEGAN:ur,STATE_CHANGED:gn,STATE_ENDED:mn,STATE_RECOGNIZED:lr,STATE_CANCELLED:Rn,STATE_FAILED:ps,DIRECTION_NONE:ii,DIRECTION_LEFT:gi,DIRECTION_RIGHT:mi,DIRECTION_UP:Mi,DIRECTION_DOWN:kt,DIRECTION_HORIZONTAL:ot,DIRECTION_VERTICAL:xt,DIRECTION_ALL:Ri,Manager:Hs,Input:jt,TouchAction:zi,TouchInput:Me,MouseInput:vi,PointerEventInput:we,TouchMouseInput:yt,SingleTouchInput:ge,Recognizer:Qr,AttrRecognizer:Wi,Tap:Or,Pan:Js,Swipe:Vn,Pinch:ws,Rotate:Fr,Press:dr,on:Ge,off:$e,each:z,merge:ce,extend:ue,assign:ne,inherit:de,bindFn:be,prefixed:We});var Ea=typeof e<"u"?e:typeof self<"u"?self:{};Ea.Hammer=Cn,typeof n=="function"&&n.amd?n(function(){return Cn}):i.exports?i.exports=Cn:e[r]=Cn})(window,document,"Hammer")})(cL);var Xm=cL.exports;const Fh=gm({__proto__:null,default:e_(Xm)},[Xm]),uL=1,hL=2,i2=4,Oq={mousedown:uL,mousemove:hL,mouseup:i2};function Uq(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function Nq(i){const e=i.prototype.handler;i.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(Uq(n,o=>o.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function zq(i){i.prototype.handler=function(t){let r=Oq[t.type];r&uL&&t.button>=0&&(this.pressed=!0),r&hL&&t.which===0&&(r=i2),this.pressed&&(r&i2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}Nq(Xm.PointerEventInput),zq(Xm.MouseInput);const Qq=Xm.Manager;class Q_{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const Vq=Fh?[[Fh.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Fh.Rotate,{enable:!1}],[Fh.Pinch,{enable:!1}],[Fh.Swipe,{enable:!1}],[Fh.Pan,{threshold:0,enable:!1}],[Fh.Press,{enable:!1}],[Fh.Tap,{event:"doubletap",taps:2,enable:!1}],[Fh.Tap,{event:"anytap",enable:!1}],[Fh.Tap,{enable:!1}]]:null,AL={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Hq={doubletap:["tap"]},Gq={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},r2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},jq={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},dL={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},qq=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Hp=typeof window<"u"?window:global;let n2=!1;try{const i={get passive(){return n2=!0,!0}};Hp.addEventListener("test",null,i),Hp.removeEventListener("test",null)}catch{n2=!1}const $q=qq.indexOf("firefox")!==-1,{WHEEL_EVENTS:Kq}=r2,fL="wheel",pL=4.000244140625,Wq=40,Xq=.25;class Zq extends Q_{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;Hp.WheelEvent&&($q&&n.deltaMode===Hp.WheelEvent.DOM_DELTA_PIXEL&&(o/=Hp.devicePixelRatio),n.deltaMode===Hp.WheelEvent.DOM_DELTA_LINE&&(o*=Wq)),o!==0&&o%pL===0&&(o=Math.floor(o/pL)),n.shiftKey&&o&&(o=o*Xq),this.callback({type:fL,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(Kq),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,n2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===fL&&(this.options.enable=t)}}const{MOUSE_EVENTS:Jq}=r2,gL="pointermove",mL="pointerover",yL="pointerout",_L="pointerenter",vL="pointerleave";class Yq extends Q_{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(Jq),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===gL&&(this.enableMoveEvent=t),e===mL&&(this.enableOverEvent=t),e===yL&&(this.enableOutEvent=t),e===_L&&(this.enableEnterEvent=t),e===vL&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(mL,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(yL,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(_L,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(vL,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(gL,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:e$}=r2,bL="keydown",xL="keyup";class t$ extends Q_{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:bL,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:xL,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(e$),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===bL&&(this.enableDownEvent=t),e===xL&&(this.enableUpEvent=t)}}const wL="contextmenu";class i$ extends Q_{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:wL,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===wL&&(this.options.enable=t)}}const s2=1,V_=2,o2=4,r$={pointerdown:s2,pointermove:V_,pointerup:o2,mousedown:s2,mousemove:V_,mouseup:o2},n$=1,s$=2,o$=3,a$=0,l$=1,c$=2,u$=1,h$=2,A$=4;function d$(i){const e=r$[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:n}=i.srcEvent;let o=!1,c=!1,s=!1;return e===o2||e===V_&&!Number.isFinite(t)?(o=n===n$,c=n===s$,s=n===o$):e===V_?(o=!!(t&u$),c=!!(t&A$),s=!!(t&h$)):e===s2&&(o=r===a$,c=r===l$,s=r===c$),{leftButton:o,middleButton:c,rightButton:s}}function f$(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,c={x:(t.x-r.left-e.clientLeft)/n,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:c}}const a2={srcElement:"root",priority:0};class p${constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:c,handlersByElement:s}=this;let m=a2;typeof r=="string"||r&&r.addEventListener?m={...a2,srcElement:r}:r&&(m={...a2,...r});let x=s.get(m.srcElement);x||(x=[],s.set(m.srcElement,x));const I={type:e,handler:t,srcElement:m.srcElement,priority:m.priority};n&&(I.once=!0),o&&(I.passive=!0),c.push(I),this._active=this._active||!I.passive;let F=x.length-1;for(;F>=0&&!(x[F].priority>=I.priority);)F--;x.splice(F+1,0,I)}remove(e,t){const{handlers:r,handlersByElement:n}=this;for(let o=r.length-1;o>=0;o--){const c=r[o];if(c.type===e&&c.handler===t){r.splice(o,1);const s=n.get(c.srcElement);s.splice(s.indexOf(c),1),s.length===0&&n.delete(c.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let n=!1;const o=()=>{e.handled=!0},c=()=>{e.handled=!0,n=!0},s=[];for(let m=0;m<r.length;m++){const{type:x,handler:I,once:F}=r[m];if(I({...e,type:x,stopPropagation:o,stopImmediatePropagation:c}),F&&s.push(r[m]),n)break}for(let m=0;m<s.length;m++){const{type:x,handler:I}=s[m];this.remove(x,I)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...d$(e),...f$(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const g$={events:null,recognizers:null,recognizerOptions:{},Manager:Qq,touchAction:"none",tabIndex:0};class m${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,c=Gq[o.type];c&&this.manager.emit(c,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...g$,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||Vq}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(AL).forEach(n=>{const o=this.manager.get(n);o&&AL[n].forEach(c=>{o.recognizeWith(c)})});for(const n in t.recognizerOptions){const o=this.manager.get(n);if(o){const c=t.recognizerOptions[n];delete c.enable,o.set(c)}}this.wheelInput=new Zq(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Yq(e,this._onOtherEvent,{enable:!1}),this.keyInput=new t$(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new i$(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const n=r.get(e);if(n&&n.options.enable!==t){n.set({enable:t});const o=Hq[e];o&&!this.options.recognizers&&o.forEach(c=>{const s=r.get(c);t?(s.requireFailure(e),n.dropRequireFailure(c)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,n,o){if(typeof e!="string"){r=t;for(const I in e)this._addEventHandler(I,e[I],r,n,o);return}const{manager:c,events:s}=this,m=dL[e]||e;let x=s.get(m);x||(x=new p$(this),s.set(m,x),x.recognizerName=jq[m]||m,c&&c.on(m,x.handleEvent)),x.add(e,t,r,n,o),x.isEmpty()||this._toggleRecognizer(x.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const c in e)this._removeEventHandler(c,e[c]);return}const{events:r}=this,n=dL[e]||e,o=r.get(n);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:c}=o;let s=!1;for(const m of r.values())if(m.recognizerName===c&&!m.isEmpty()){s=!0;break}s||this._toggleRecognizer(c,!1)}}}function af(){}const BL={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:af,onResize:af,onViewStateChange:af,onInteractionStateChange:af,onBeforeRender:af,onAfterRender:af,onLoad:af,onError:i=>Dn.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i=>{let{isDragging:e}=i;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class l2{constructor(e){ye(this,"props",void 0),ye(this,"width",0),ye(this,"height",0),ye(this,"userData",{}),ye(this,"canvas",null),ye(this,"viewManager",null),ye(this,"layerManager",null),ye(this,"effectManager",null),ye(this,"deckRenderer",null),ye(this,"deckPicker",null),ye(this,"eventManager",null),ye(this,"tooltip",null),ye(this,"metrics",void 0),ye(this,"animationLoop",void 0),ye(this,"stats",void 0),ye(this,"viewState",void 0),ye(this,"cursorState",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_pickRequest",void 0),ye(this,"_lastPointerDownInfo",null),ye(this,"_metricsCounter",void 0),ye(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;r.x=n.x,r.y=n.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),ye(this,"_onEvent",t=>{const r=V5[t.type],n=t.offsetCenter;if(!r||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=c,m=s&&(s[r.handler]||s.props[r.handler]),x=this.props[r.handler];let I=!1;m&&(I=m.call(s,c,t)),!I&&x&&x(c,t)}),ye(this,"_onPointerDown",t=>{const r=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...BL,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Dn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),k5()==="IE"&&Dn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new ew({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&qm.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,n,o,c,s,m;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(c=this.deckPicker)===null||c===void 0||c.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(m=this.tooltip)===null||m===void 0||m.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var x;(x=this.canvas.parentElement)===null||x===void 0||x.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Dn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Dn.removed("onLayerClick","onClick")(),e.initialViewState&&!Ph(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return t=t||r||n||o||c,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return el(this.viewManager),this.viewManager.views}getViewports(e){return el(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){el(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),el(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var n;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((n=e.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const n=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(n!==this.width||o!==this.height){var c,s;this.width=n,this.height=o,(c=this.viewManager)===null||c===void 0||c.setProps({width:n,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:n,glOptions:o,debug:c,onError:s,onBeforeRender:m,onAfterRender:x,useDevicePixels:I}=e;return new J9({width:t,height:r,useDevicePixels:I,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:F=>nI({...o,...F,canvas:this.canvas,debug:c,onContextLost:()=>this._onContextLost()}),onInitialize:F=>this._setGLContext(F.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:m,onAfterRender:x,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new t2({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=n,c=!1;for(const s of r){var t;o=s,c=((t=s.layer)===null||t===void 0?void 0:t.onHover(s,e.event))||c}if(!c&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Yx(e,{enable:!0,copyState:!0})),this.tooltip=new kq(this.canvas),hA(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new F3;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new m$(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in V5)this.eventManager.on(n,this._onEvent);this.viewManager=new lq({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new aq(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new Cq,this.deckRenderer=new Tq(e),this.deckPicker=new Dq(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;hA(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Dn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=Yd.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}ye(l2,"defaultProps",BL),ye(l2,"VERSION",nQ);class c2{constructor(e,t){ye(this,"opts",void 0),ye(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:n}=t;let o=r;if(r&&r.length!==n){o=new Float32Array(n);const c=t.elementOffset||0;for(let s=0;s<n;++s)o[s]=r[c+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function y$(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function H_(i){return i.stride||i.size*i.bytesPerElement}function CL(i,e){e.offset&&Dn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=H_(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,n=e.elementOffset||0,o=r*t+n*i.bytesPerElement+(i.offset||0);return{...e,offset:o,stride:t}}function _$(i,e){const t=CL(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class v${constructor(e,t,r){ye(this,"gl",void 0),ye(this,"id",void 0),ye(this,"size",void 0),ye(this,"settings",void 0),ye(this,"value",void 0),ye(this,"doublePrecision",void 0),ye(this,"_buffer",void 0),ye(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,o=n===5130;let{defaultValue:c}=t;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let s;o?s=5126:!n&&t.isIndexed?s=e&&lw(e,zs.ELEMENT_INDEX_UINT32)?5125:5123:s=n||5126;let m=y$(n||s||5126);this.doublePrecision=o,o&&t.fp64===!1&&(m=Float32Array),this.value=null,this.settings={...t,defaultType:m,defaultValue:c,logicalType:n,type:s,size:this.size,bytesPerElement:m.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new vs(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*H_(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),qm.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},n=this.value instanceof Float64Array,o=_$(this.getAccessor(),t||{});return r[e]=new c2(this,o.high),r["".concat(e,"64Low")]=n?new c2(this,o.low):new Float32Array(this.size),r}if(t){const r=CL(this.getAccessor(),t);return{[e]:new c2(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:n}=this,o=r*n;if(t&&o&&t.length>=o){const c=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let m=0;m<o;)for(let x=0;x<n;x++){const I=t[m++];I<c[x]&&(c[x]=I),I>s[x]&&(s[x]=I)}e=[c,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof vs?r={buffer:e}:r=e;const n={...this.settings,...r};if(t.bufferAccessor=n,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const c=r.value instanceof Float64Array;n.type=r.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(c?2:1),n.stride=H_(n)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=H_(n);const{buffer:c,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=Ww(o,n));const m=o.byteLength+s+n.stride*2;c.byteLength<m&&c.reallocate(m),c.setAccessor(null),c.subData({data:o,offset:s}),n.type=r.type||c.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:n}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?Ww(t,{size:this.size,startIndex:r,endIndex:n}):t.subarray(r,n),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,n=r.allocatedValue,o=qm.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:c,byteOffset:s}=this;return c.byteLength<o.byteLength+s&&(c.reallocate(o.byteLength+s),t&&n&&c.subData({data:n instanceof Float64Array?Ww(n,this):n,offset:s})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Dn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let c=o;for(;--c>=0;)t[r+c]=n[c];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let c=o;for(;--c>=0;)t[r+c]=Number.isFinite(e[c])?e[c]:n[c]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}const EL=[],SL=[];function TL(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=EL;const n={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(SL.length=i.length,r=SL):r=EL,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),n.index=e-1),{iterable:r,objectInfo:n}}function IL(i){return i&&i[Symbol.asyncIterator]}function b$(i,e){const{size:t,stride:r,offset:n,startIndices:o,nested:c}=e,s=i.BYTES_PER_ELEMENT,m=r?r/s:t,x=n?n/s:0,I=Math.floor((i.length-x)/m);return(F,O)=>{let{index:z,target:ie}=O;if(!o){const de=z*m+x;for(let be=0;be<t;be++)ie[be]=i[de+be];return ie}const ne=o[z],ue=o[z+1]||I;let ce;if(c){ce=new Array(ue-ne);for(let de=ne;de<ue;de++){const be=de*m+x;ie=new Array(t);for(let Te=0;Te<t;Te++)ie[Te]=i[be+Te];ce[de-ne]=ie}}else if(m===t)ce=i.subarray(ne*t+x,ue*t+x);else{ce=new i.constructor((ue-ne)*t);let de=0;for(let be=ne;be<ue;be++){const Te=be*m+x;for(let je=0;je<t;je++)ce[de++]=i[Te+je]}}return ce}}const x$=[],G_=[[0,1/0]];function w$(i,e){if(i===G_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let n=0;for(let o=0;o<r;o++){const c=i[o];c[1]<e[0]?(t.push(c),n=o+1):c[0]>e[1]?t.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return t.splice(n,0,e),t}function u2(i){const{source:e,target:t,start:r=0,size:n,getData:o}=i,c=i.end||t.length,s=e.length,m=c-r;if(s>m){t.set(e.subarray(0,m),r);return}if(t.set(e,r),!o)return;let x=s;for(;x<m;){const I=o(x,e);for(let F=0;F<n;F++)t[r+x]=I[F]||0,x++}}function B$(i){let{source:e,target:t,size:r,getData:n,sourceStartIndices:o,targetStartIndices:c}=i;if(!Array.isArray(c))return u2({source:e,target:t,size:r,getData:n}),t;let s=0,m=0;const x=n&&((F,O)=>n(F+m,O)),I=Math.min(o.length,c.length);for(let F=1;F<I;F++){const O=o[F]*r,z=c[F]*r;u2({source:e.subarray(s,O),target:t,start:m,end:z,size:r,getData:x}),s=O,m=z}return m<t.length&&u2({source:[],target:t,start:m,size:r,getData:x}),t}const C$={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function LL(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...C$[t],...e,...i,type:t}}function ML(i,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function PL(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function FL(i){i.push(i.shift())}function h2(i,e){const{doublePrecision:t,settings:r,value:n,size:o}=i,c=t&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:e*o)*c}function DL(i){let{buffer:e,numInstances:t,attribute:r,fromLength:n,fromStartIndices:o,getData:c=de=>de}=i;const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,m=r.size*s,x=r.byteOffset,I=r.startIndices,F=o&&I,O=h2(r,t),z=r.isConstant;if(!F&&n>=O)return;const ie=z?r.value:r.getBuffer().getData({srcByteOffset:x});if(r.settings.normalized&&!z){const de=c;c=(be,Te)=>r.normalizeConstant(de(be,Te))}const ne=z?(de,be)=>c(ie,be):(de,be)=>c(ie.subarray(de,de+m),be),ue=e.getData({length:n}),ce=new Float32Array(O);B$({source:ue,target:ce,sourceStartIndices:o,targetStartIndices:I,size:m,getData:ne}),e.byteLength<ce.byteLength+x&&e.reallocate(ce.byteLength+x),e.subData({data:ce,offset:x})}class A2 extends v${constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:G_}),ye(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,n=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return LL(n,r)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:n=1/0}=t;this.state.updateRanges=w$(this.state.updateRanges,[r,n])}else this.state.updateRanges=G_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=x$}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==G_),!0):!1}updateBuffer(e){let{numInstances:t,data:r,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:s,noAlloc:m}}=this;let x=!0;if(s){for(const[I,F]of c)s.call(o,this,{data:r,startRow:I,endRow:F,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[I,F]of c){const O=Number.isFinite(I)?this.getVertexOffset(I):0,z=Number.isFinite(F)?this.getVertexOffset(F):m||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:O,endOffset:z})}this._checkAttributeArray()}else x=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),x}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:n}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;el(ArrayBuffer.isView(c.value),"invalid ".concat(n.accessor));const s=!!c.size&&c.size!==this.size;return r.binaryAccessor=b$(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,t){let{data:r,startRow:n,endRow:o,props:c,numInstances:s}=t;if(e.constant)return;const{settings:m,state:x,value:I,size:F,startIndices:O}=e,{accessor:z,transform:ie}=m,ne=x.binaryAccessor||(typeof z=="function"?z:c[z]);el(typeof ne=="function",'accessor "'.concat(z,'" is not a function'));let ue=e.getVertexOffset(n);const{iterable:ce,objectInfo:de}=TL(r,n,o);for(const be of ce){de.index++;let Te=ne(be,de);if(ie&&(Te=ie.call(this,Te)),O){const je=(de.index<O.length-1?O[de.index+1]:s)-O[de.index];if(Te&&Array.isArray(Te[0])){let Ge=ue;for(const $e of Te)e._normalizeValue($e,I,Ge),Ge+=F}else Te&&Te.length>F?I.set(Te,ue):(e._normalizeValue(Te,de.target,0),Yj({target:I,source:de.target,start:ue,count:je}));ue+=je*F}else e._normalizeValue(Te,I,ue),ue+=F}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class E${constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","interpolation"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.transition=new Wm(n),this.attribute=r,this.attributeInTransition=new A2(t,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=T$(t,r);const o={byteLength:0,usage:35050};this.buffers=[new vs(t,o),new vs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:n,attribute:o}=this;FL(n);const c={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)DL({buffer:s,...c});this.currentStartIndices=o.startIndices,this.currentLength=h2(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:ML(r,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:n}=this.transition;let o=n/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const S$=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function T$(i,e){const t=PL(e.size);return new Nw(i,{vs:S$,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class I${constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","spring"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"texture",void 0),ye(this,"framebuffer",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new Wm(n),this.attribute=r,this.attributeInTransition=new A2(t,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=M$(t),this.framebuffer=P$(t,this.texture),this.transform=L$(t,r,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new vs(t,o),new vs(t,o),new vs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:n,attribute:o}=this,c={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)DL({buffer:s,...c});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=h2(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:ML(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:n}=this;if(!n.update())return!1;const c=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:c.stiffness,damping:c.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),FL(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),d_(r)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function L$(i,e,t){const r=PL(e.size);return new Nw(i,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function M$(i){return new jc(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function P$(i,e){return new ba(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const F$={interpolation:E$,spring:I$};class D${constructor(e,t){let{id:r,timeline:n}=t;ye(this,"id",void 0),ye(this,"isSupported",void 0),ye(this,"gl",void 0),ye(this,"timeline",void 0),ye(this,"transitions",void 0),ye(this,"needsRedraw",void 0),ye(this,"numInstances",void 0),this.id=r,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Nw.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:r,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const c=t[o],s=c.getTransitionSetting(r);s&&this._updateAttribute(o,c,s)}for(const o in this.transitions){const c=t[o];(!c||!c.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const n=this.transitions[e];let o=!n||n.type!==r.type;if(o){if(!this.isSupported){Dn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}n&&this._removeTransition(e);const c=F$[r.type];c?this.transitions[e]=new c({attribute:t,timeline:this.timeline,gl:this.gl}):(Dn.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const RL="attributeManager.invalidate",R$="attributeManager.updateStart",k$="attributeManager.updateEnd",O$="attribute.updateStart",U$="attribute.allocate",N$="attribute.updateEnd";class z${constructor(e){let{id:t="attribute-manager",stats:r,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"attributes",void 0),ye(this,"updateTriggers",void 0),ye(this,"needsRedraw",void 0),ye(this,"userData",void 0),ye(this,"stats",void 0),ye(this,"attributeTransitionManager",void 0),ye(this,"mergeBoundsMemoized",Gm(Gj)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new D$(e,{id:"".concat(t,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);bl(RL,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);bl(RL,this,"all")}update(e){let{data:t,numInstances:r,startIndices:n=null,transitions:o,props:c={},buffers:s={},context:m={}}=e,x=!1;bl(R$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const I in this.attributes){const F=this.attributes[I],O=F.settings.accessor;F.startIndices=n,F.numInstances=r,c[I]&&Dn.removed("props.".concat(I),"data.attributes.".concat(I))(),F.setExternalBuffer(s[I])||F.setBinaryValue(typeof O=="string"?s[O]:void 0,t.startIndices)||typeof O=="string"&&!s[O]&&F.setConstantValue(c[O])||F.needsUpdate()&&(x=!0,this._updateAttribute({attribute:F,numInstances:r,data:t,props:c,context:m})),this.needsRedraw=this.needsRedraw||F.needsRedraw()}x&&bl(k$,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var n;return(n=this.attributes[r])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const o in t){const c=t[o];c.needsRedraw(e)&&!r.hasAttribute(o)&&(n[o]=c)}return n}getShaderAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const r={};for(const n in e)t[n]||Object.assign(r,e[n].getShaderAttributes());return r}_add(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in e){const n=e[r];this.attributes[r]=this._createAttribute(r,n,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const n={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new A2(this.gl,n)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:n}=this,o=n[e];return o&&o.forEach(c=>{const s=r[c];s&&s.setNeedsUpdate(s.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(bl(O$,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&bl(U$,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,bl(N$,t,r))}}class Q$ extends Wm{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:n,easing:o}}=this,c=o(e/n);this._value=w_(t,r,c)}}const kL=1e-5;function OL(i,e,t,r,n){const o=e-i,s=(t-e)*n,m=-o*r;return s+m+o+e}function V$(i,e,t,r,n){if(Array.isArray(t)){const o=[];for(let c=0;c<t.length;c++)o[c]=OL(i[c],e[c],t[c],r,n);return o}return OL(i,e,t,r,n)}function UL(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const n=i[r]-e[r];t+=n*n}return Math.sqrt(t)}return Math.abs(i-e)}class H$ extends Wm{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:c=e}=this;let s=V$(o,c,t,r,n);const m=UL(s,t),x=UL(s,c);m<kL&&x<kL&&(s=t,this.end()),this._prevValue=c,this._currValue=s}}const G$={interpolation:Q$,spring:H$};class j${constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,n){const{transitions:o}=this;if(o.has(e)){const m=o.get(e),{value:x=m.settings.fromValue}=m;t=x,this.remove(e)}if(n=LL(n),!n)return;const c=G$[n.type];if(!c){Dn.error("unsupported transition type '".concat(n.type,"'"))();return}const s=new c(this.timeline);s.start({...n,fromValue:t,toValue:r}),o.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function q$(i){const e=i[WA];for(const t in e){const r=e[t],{validate:n}=r;if(n&&!n(i[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(i[t]))}}function $$(i,e){const t=NL({newProps:i,oldProps:e,propTypes:i[WA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=W$(i,e);let n=!1;return r||(n=X$(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:n,extensionsChanged:Z$(i,e),transitionsChanged:K$(i,e)}}function K$(i,e){if(!i.transitions)return!1;const t={},r=i[WA];let n=!1;for(const o in i.transitions){const c=r[o],s=c&&c.type;(s==="number"||s==="color"||s==="array")&&d2(i[o],e[o],c)&&(t[o]=!0,n=!0)}return n?t:!1}function NL(i){let{newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:o="props"}=i;if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const c of Object.keys(e))if(!(c in r)){if(!(c in t))return"".concat(o,".").concat(c," added");const s=d2(e[c],t[c],n[c]);if(s)return"".concat(o,".").concat(c," ").concat(s)}for(const c of Object.keys(t))if(!(c in r)){if(!(c in e))return"".concat(o,".").concat(c," dropped");if(!Object.hasOwnProperty.call(e,c)){const s=d2(e[c],t[c],n[c]);if(s)return"".concat(o,".").concat(c," ").concat(s)}}return!1}function d2(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function W$(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:n}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(i.data,e.data)||t),t}function X$(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&zL(i,e,"all"))return{all:!0};const t={};let r=!1;for(const n in i.updateTriggers)n!=="all"&&zL(i,e,n)&&(t[n]=!0,r=!0);return r?t:!1}function Z$(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(t[n]))return!0;return!1}function zL(i,e,t){let r=i.updateTriggers[t];r=r??{};let n=e.updateTriggers[t];return n=n??{},NL({oldProps:n,newProps:r,triggerName:t})}const J$="count(): argument not an object",Y$="count(): argument not a container";function eK(i){if(!iK(i))throw new Error(J$);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(tK(i))return Object.keys(i).length;throw new Error(Y$)}function tK(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function iK(i){return i!==null&&typeof i=="object"}function rK(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(n=>n.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const n in e.inject)r[n]=(r[n]||"")+e.inject[n];t.inject=r}return t}const nK={10241:9987,10240:9729,10242:33071,10243:33071},f2={};function sK(i,e,t,r){if(t instanceof jc)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={10241:t.data.length>1?9985:9729});const o=new jc(e,{...t,parameters:{...nK,...n,...r}});return f2[o.id]=i,o}function oK(i,e){!e||!(e instanceof jc)||f2[e.id]===i&&(e.delete(),delete f2[e.id])}const aK={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||p2(i)&&(i.length===3||i.length===4)},equal(i,e,t){return Ph(i,e,1)}},accessor:{validate(i,e){const t=j_(i);return t==="function"||t===j_(e.value)},equal(i,e,t){return typeof e=="function"?!0:Ph(i,e,1)}},array:{validate(i,e){return e.optional&&!i||p2(i)},equal(i,e,t){const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?Ph(i,e,n):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?Ph(i,e,n):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{const{dataTransform:r}=t.props;return r&&i?r(i):i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.gl?null:sK(t.id,r.gl,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{oK(t.id,i)}}};function lK(i){const e={},t={},r={};for(const[n,o]of Object.entries(i)){const c=o==null?void 0:o.deprecatedFor;if(c)r[n]=Array.isArray(c)?c:[c];else{const s=cK(n,o);e[n]=s,t[n]=s.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function cK(i,e){switch(j_(e)){case"object":return Zm(i,e);case"array":return Zm(i,{type:"array",value:e,compare:!1});case"boolean":return Zm(i,{type:"boolean",value:e});case"number":return Zm(i,{type:"number",value:e});case"function":return Zm(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function Zm(i,e){return"type"in e?{name:i,...aK[e.type],...e}:"value"in e?{name:i,type:j_(e.value),...e}:{name:i,type:"object",value:e}}function p2(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function j_(i){return p2(i)?"array":i===null?"null":typeof i}function uK(i,e){let t;for(let o=e.length-1;o>=0;o--){const c=e[o];"extensions"in c&&(t=c.extensions)}const r=g2(i.constructor,t),n=Object.create(r);n[U_]=i,n[sf]={},n[XA]={};for(let o=0;o<e.length;++o){const c=e[o];for(const s in c)n[s]=c[s]}return Object.freeze(n),n}const hK="_mergedDefaultProps";function g2(i,e){let t=hK;if(e)for(const n of e){const o=n.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=QL(i,t);return r||(i[t]=AK(i,e||[]))}function AK(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),n=g2(r),o=QL(i,"defaultProps")||{},c=lK(o),s=Object.assign(Object.create(null),n,c.defaultProps),m=Object.assign(Object.create(null),n==null?void 0:n[WA],c.propTypes),x=Object.assign(Object.create(null),n==null?void 0:n[Zw],c.deprecatedProps);for(const I of e){const F=g2(I.constructor);F&&(Object.assign(s,F),Object.assign(m,F[WA]),Object.assign(x,F[Zw]))}return dK(s,i),pK(s,m),fK(s,x),s[WA]=m,s[Zw]=x,e.length===0&&!m2(i,"_propTypes")&&(i._propTypes=m),s}function dK(i,e){const t=mK(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function fK(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const n="".concat(this.id,": ").concat(t);for(const o of e[t])m2(this,o)||(this[o]=r);Dn.deprecated(n,e[t].join("/"))()}})}function pK(i,e){const t={},r={};for(const n in e){const o=e[n],{name:c,value:s}=o;o.async&&(t[c]=s,r[c]=gK(c))}i[Qp]=t,i[sf]={},Object.defineProperties(i,r)}function gK(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||IL(e)?this[sf][i]=e:this[XA][i]=e},get(){if(this[XA]){if(i in this[XA])return this[XA][i]||this[Qp][i];if(i in this[sf]){const e=this[U_]&&this[U_].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[Qp][i]}}return this[Qp][i]}}}function m2(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function QL(i,e){return m2(i,e)&&i[e]}function mK(i){const e=i.componentName;return e||Dn.warn("".concat(i.name,".componentName not specified"))(),e||i.name}let yK=0;class y2{constructor(){ye(this,"id",void 0),ye(this,"props",void 0),ye(this,"count",void 0);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.props=uK(this,t),this.id=this.props.id,this.count=yK++}clone(e){const{props:t}=this,r={};for(const n in t[Qp])n in t[XA]?r[n]=t[XA][n]:n in t[sf]&&(r[n]=t[sf][n]);return new this.constructor({...t,...r,...e})}}ye(y2,"componentName","Component"),ye(y2,"defaultProps",{});const _K=Object.freeze({});class vK{constructor(e){ye(this,"component",void 0),ye(this,"onAsyncPropUpdated",void 0),ye(this,"asyncProps",void 0),ye(this,"oldProps",void 0),ye(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_K}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[U_]||this.component;const t=e[XA]||{},r=e[sf]||e,n=e[Qp]||{};for(const o in t){const c=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,c),t[o]=this.getAsyncProp(o)}for(const o in r){const c=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,c)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(IL(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],c=0;for await(const s of t){if(!this.component)return;const{dataTransform:m}=this.component.props;m?o=m(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:c,endRow:o.length}]}),c=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[WA];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class bK extends vK{constructor(e){let{attributeManager:t,layer:r}=e;super(r),ye(this,"attributeManager",void 0),ye(this,"needsRedraw",void 0),ye(this,"needsUpdate",void 0),ye(this,"subLayers",void 0),ye(this,"usesPickingColorCache",void 0),ye(this,"hasPickingBuffer",void 0),ye(this,"changeFlags",void 0),ye(this,"viewport",void 0),ye(this,"uniformTransitions",void 0),ye(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const n=r.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const xK="layer.changeFlag",wK="layer.initialize",BK="layer.update",CK="layer.finalize",EK="layer.matched",VL=2**24-1,SK=Object.freeze([]),TK=Gm(i=>{let{oldViewport:e,viewport:t}=i;return e.equals(t)});let Dh=new Uint8ClampedArray(0);const IK={data:{type:"data",value:SK,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,e)=>{let{propName:t,layer:r,loaders:n,loadOptions:o,signal:c}=e;const{resourceManager:s}=r.context;if(o=o||r.getLoadOptions(),n=n||r.props.loaders,c){var m;o={...o,fetch:{...(m=o)===null||m===void 0?void 0:m.fetch,signal:c}}}let x=s.contains(i);return!x&&!o&&(s.add({resourceId:i,data:HA(i,n),persistent:!1}),x=!0),x?s.subscribe({resourceId:i,onChange:I=>{var F;return(F=r.internalState)===null||F===void 0?void 0:F.reloadAsyncProp(t,I)},consumerId:r.id,requestId:t}):HA(i,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ln.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:e}=i;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Gp extends y2{constructor(){super(...arguments),ye(this,"internalState",null),ye(this,"lifecycle",zp.NO_STATE),ye(this,"context",void 0),ye(this,"state",void 0),ye(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){el(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=eL(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,c]=q3(r,t.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,c]}unproject(e){return el(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){el(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Xj(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ln.DEFAULT||e===Ln.LNGLAT||e===Ln.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){el(e instanceof Uint8Array);const[t,r,n]=e;return t+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:eK(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=rK(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const n of r)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,o=this.internalState.hasPickingBuffer,c=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:s,instancePickingColors:m}=t.attributes,x=s||m;x&&(c&&x.constant&&(x.constant=!1,t.invalidate(x.id)),!x.value&&!c&&(x.constant=!0,x.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:r,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var r,n;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(n=this.props).onError)!==null&&r!==void 0&&r.call(n,e))){var o,c;(o=this.context)===null||o===void 0||(c=o.onError)===null||c===void 0||c.call(o,e,this)}}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!TK({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const n in t)Object.defineProperty(r,n,{value:t[n]});return r}return this.props}calculateInstancePickingColors(e,t){let{numInstances:r}=t;if(e.constant)return;const n=Math.floor(Dh.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>VL&&Dn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Dh=qm.allocate(Dh,r,{size:3,copy:!0,maxCount:Math.max(r,VL)});const o=Math.floor(Dh.length/3),c=[];for(let s=n;s<o;s++)this.encodePickingColor(s,c),Dh[s*3+0]=c[0],Dh[s*3+1]=c[1],Dh[s*3+2]=c[2]}e.value=Dh.subarray(0,r*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),n=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,n);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n,c=o&&t.attributes&&t.attributes[o.id];if(c&&c.value){const s=c.value,m=this.encodePickingColor(e);for(let x=0;x<t.length;x++){const I=o.getVertexOffset(x);s[I]===m[0]&&s[I+1]===m[1]&&s[I+2]===m[2]&&this._disablePickingIndex(x)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;if(!n)return;const o=n.getVertexOffset(e),c=n.getVertexOffset(e+1);n.buffer.subData({data:new Uint8Array(c-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Dh.buffer&&(r.value=Dh.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){el(!this.internalState),el(Number.isFinite(this.props.coordinateSystem)),bl(wK,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new bK({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Dn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new j$(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){bl(EK,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(bl(BK,this,e),!e)return;const t=this.props,r=this.context,n=this.internalState,o=r.viewport,c=this._updateUniformTransition();n.propsInTransition=c,r.viewport=n.viewport||o,this.props=c;try{const s=this._getUpdateParams(),m=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const I of this.props.extensions)I.updateState.call(this,s,I);const x=this.getModels()[0]!==m[0];this._postUpdate(s,x)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){bl(CK,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{moduleParameters:t=null,uniforms:r={},parameters:n={}}=e;this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;r.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:m}=this.props,x=m&&m(r)||[0,0];hA(c.gl,{polygonOffset:x}),Gu(c.gl,n,()=>{const I={moduleParameters:t,uniforms:r,parameters:n,context:c};for(const F of this.props.extensions)F.draw.call(this,I,F);this.draw(I)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const c=e[n],s=t[n];c&&Array.isArray(s)&&(t.dataChanged=Array.isArray(c)?s.concat(c):c,o=!0);default:t[n]||(t[n]=e[n],o=!0)}o&&bl(xK,this,n,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=$$(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],(n=e.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(r)}validateProps(){q$(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new z$(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:s,highlightColor:m}=r;if(t||n.autoHighlight!==c||n.highlightedObjectIndex!==s||n.highlightColor!==m){const x={};c||(x.pickingSelectedColor=null),Array.isArray(m)&&(x.pickingHighlightColor=m),(t||s!==n.highlightedObjectIndex)&&(x.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(x)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(e):!1;if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ye(Gp,"defaultProps",IK),ye(Gp,"layerName","Layer");const LK="compositeLayer.renderLayers";class HL extends Gp{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,n)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;const{opacity:r,pickable:n,visible:o,parameters:c,getPolygonOffset:s,highlightedObjectIndex:m,autoHighlight:x,highlightColor:I,coordinateSystem:F,coordinateOrigin:O,wrapLongitude:z,positionFormat:ie,modelMatrix:ne,extensions:ue,fetch:ce,operation:de,_subLayerProps:be}=this.props,Te={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:c,getPolygonOffset:s,highlightedObjectIndex:m,autoHighlight:x,highlightColor:I,coordinateSystem:F,coordinateOrigin:O,wrapLongitude:z,positionFormat:ie,modelMatrix:ne,extensions:ue,fetch:ce,operation:de},je=be&&e.id&&be[e.id],Ge=je&&je.updateTriggers,$e=e.id||"sublayer";if(je){const Ue=this.props[WA],lt=e.type?e.type._propTypes:{};for(const nt in je){const De=lt[nt]||Ue[nt];De&&De.type==="accessor"&&(je[nt]=this.getSubLayerAccessor(je[nt]))}}Object.assign(Te,e,je),Te.id="".concat(this.props.id,"-").concat($e),Te.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...Ge};for(const Ue of ue){const lt=Ue.getSubLayerProps.call(this,Ue);lt&&Object.assign(Te,lt,{updateTriggers:Object.assign(Te.updateTriggers,lt.updateTriggers)})}return Te}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const o=this.renderLayers();r=N_(o,Boolean),this.internalState.subLayers=r}bl(LK,this,n,r);for(const o of r)o.parent=this}}ye(HL,"layerName","CompositeLayer");const _2=512,MK=Math.PI/180;function PK(i){let{map:e,gl:t,deck:r}=i;if(e.__deck)return e.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,c=DK({...r==null?void 0:r.props,_customRender:()=>{e.triggerRepaint(),n==null||n("")}});let s;return(!r||r.props.gl===t)&&(Object.assign(c,{gl:t,width:null,height:null,touchAction:"unset",viewState:v2(e)}),r!=null&&r.isInitialized?jL(r,e):c.onLoad=()=>{o==null||o(),jL(s,e)}),r?(s=r,r.setProps(c),r.userData.isExternal=!0):(s=new l2(c),e.on("remove",()=>{FK(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&zK(s,e)}),s}function jL(i,e){const t=()=>{i.isInitialized?QK(i,e):e.off("move",t)};e.on("move",t)}function FK(i){var e;(e=i.__deck)===null||e===void 0||e.finalize(),i.__deck=null}function DK(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new t2({id:"mapbox"})]}}function RK(i,e){i.userData.mapboxLayers.add(e),b2(i)}function kK(i,e){i.userData.mapboxLayers.delete(e),b2(i)}function OK(i,e){b2(i)}function UK(i,e,t){let{currentViewport:r}=i.userData,n=!1;r||(r=qL(i,e,!0),i.userData.currentViewport=r,n=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:o=>{let{layer:c}=o;return t.id===c.id||c.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function v2(i){var e;const{lng:t,lat:r}=i.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(e=i.getTerrain)!==null&&e!==void 0&&e.call(i)&&NK(i,n),n}function NK(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:n,latitude:o,pitch:c}=e,s=t.x*_2,m=(1-t.y)*_2,x=t.z*_2,I=jm([n,o]),F=s-I[0],O=m-I[1],z=Math.sqrt(F*F+O*O),ie=c*MK,ne=1.5*r,ue=ie<.001?ne*Math.cos(ie)/x:ne*Math.sin(ie)/z;e.zoom=Math.log2(ue);const ce=ne*Math.cos(ie)/ue,de=x-ce;e.position=[0,0,de/k_(o)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function qL(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new nf({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...v2(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function zK(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const n=Array.from(t,I=>I.id),c=N_(i.props.layers,Boolean).some(I=>I&&!n.includes(I.id));let s=i.getViewports();const m=s.findIndex(I=>I.id==="mapbox"),x=s.length>1||m<0;(c||x)&&(m>=0&&(s=s.slice(),s[m]=qL(i,e,!1)),i._drawLayers("mapbox-repaint",{viewports:s,layerFilter:I=>(!i.props.layerFilter||i.props.layerFilter(I))&&(I.viewport.id!=="mapbox"||!n.includes(I.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function QK(i,e){i.setProps({viewState:v2(e)}),i.needsRedraw({clearRedrawFlags:!0})}function b2(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,n=new r(t.props);e.push(n)}),i.setProps({layers:e})}class VK{constructor(e){if(ye(this,"id",void 0),ye(this,"type",void 0),ye(this,"renderingMode",void 0),ye(this,"map",void 0),ye(this,"deck",void 0),ye(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=PK({map:e,gl:t,deck:this.props.deck}),RK(this.deck,this)}onRemove(){this.deck&&kK(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&OK(this.deck)}render(){UK(this.deck,this.map,this)}}const HK=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,GK=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,$L=[0,0,0,255],KL=[0,0,1],jK={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:KL},getColor:{type:"accessor",value:$L},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function qK(i){const{header:e,attributes:t}=i;!e||!t||(i.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class x2 extends Gp{getShaders(){return super.getShaders({vs:HK,fs:GK,modules:[Jw,_G,Yw]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:KL},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:$L}})}updateState(e){const{changeFlags:t,props:r}=e;if(super.updateState(e),t.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}t.dataChanged&&qK(r.data)}draw(e){let{uniforms:t}=e;const{pointSize:r,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:Kx[n],radiusPixels:r}).draw()}_getModel(e){const t=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Dp(e,{...this.getShaders(),id:this.props.id,geometry:new Hm({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}ye(x2,"layerName","PointCloudLayer"),ye(x2,"defaultProps",jK);const Wc={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ut,new Ut;const Jm=new Ut,WL=new Ut;class Ym{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"center",void 0),ye(this,"radius",void 0),this.radius=-0,this.center=new Ut,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Jm.from(t),this.center=new Ut().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ym(this.center,this.radius)}union(e){const t=this.center,r=this.radius,n=e.center,o=e.radius,c=Jm.copy(n).subtract(t),s=c.magnitude();if(r>=s+o)return this.clone();if(o>=s+r)return e.clone();const m=(r+s+o)*.5;return WL.copy(c).scale((-r+m)/s).add(t),this.center.copy(WL),this.radius=m,this}expand(e){const r=Jm.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=I7(Jm,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=Jm.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,o=e.normal.dot(t)+e.distance;return o<-r?Wc.OUTSIDE:o<r?Wc.INTERSECTING:Wc.INSIDE}}const $K=new Ut,KK=new Ut,q_=new Ut,$_=new Ut,K_=new Ut,WK=new Ut,XK=new Ut,yA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ey{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];ye(this,"center",void 0),ye(this,"halfAxes",void 0),this.center=new Ut().from(e),this.halfAxes=new xo(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Ut(e).len(),new Ut(t).len(),new Ut(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Ut(e).normalize(),o=new Ut(t).normalize(),c=new Ut(r).normalize();return new zm().fromMatrix3(new xo([...n,...o,...c]))}fromCenterHalfSizeQuaternion(e,t,r){const n=new zm(r),o=new xo().fromQuaternion(n);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new Ut().from(e),this.halfAxes=o,this}clone(){return new ey(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Ym;const t=this.halfAxes,r=t.getColumn(0,q_),n=t.getColumn(1,$_),o=t.getColumn(2,K_),c=$K.copy(r).add(n).add(o);return e.center.copy(this.center),e.radius=c.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,n=this.halfAxes,o=r.x,c=r.y,s=r.z,m=Math.abs(o*n[yA.COLUMN0ROW0]+c*n[yA.COLUMN0ROW1]+s*n[yA.COLUMN0ROW2])+Math.abs(o*n[yA.COLUMN1ROW0]+c*n[yA.COLUMN1ROW1]+s*n[yA.COLUMN1ROW2])+Math.abs(o*n[yA.COLUMN2ROW0]+c*n[yA.COLUMN2ROW1]+s*n[yA.COLUMN2ROW2]),x=r.dot(t)+e.distance;return x<=-m?Wc.OUTSIDE:x>=m?Wc.INSIDE:Wc.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=KK.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,q_),o=r.getColumn(1,$_),c=r.getColumn(2,K_),s=n.magnitude(),m=o.magnitude(),x=c.magnitude();n.normalize(),o.normalize(),c.normalize();let I=0,F;return F=Math.abs(t.dot(n))-s,F>0&&(I+=F*F),F=Math.abs(t.dot(o))-m,F>0&&(I+=F*F),F=Math.abs(t.dot(c))-x,F>0&&(I+=F*F),I}computePlaneDistances(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const c=this.center,s=this.halfAxes,m=s.getColumn(0,q_),x=s.getColumn(1,$_),I=s.getColumn(2,K_),F=WK.copy(m).add(x).add(I).add(c),O=XK.copy(F).subtract(e);let z=t.dot(O);return n=Math.min(z,n),o=Math.max(z,o),F.copy(c).add(m).add(x).subtract(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),F.copy(c).add(m).subtract(x).add(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),F.copy(c).add(m).subtract(x).subtract(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),c.copy(F).subtract(m).add(x).add(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),c.copy(F).subtract(m).add(x).subtract(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),c.copy(F).subtract(m).subtract(x).add(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),c.copy(F).subtract(m).subtract(x).subtract(I),O.copy(F).subtract(e),z=t.dot(O),n=Math.min(z,n),o=Math.max(z,o),r[0]=n,r[1]=o,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,q_);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,$_);r.transformAsPoint(e);const n=this.halfAxes.getColumn(2,K_);return n.transformAsPoint(e),this.halfAxes=new xo([...t,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const XL=new Ut,ZL=new Ut;class Wu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"normal",void 0),ye(this,"distance",void 0),this.normal=new Ut,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return ju(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=XL.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,n){return this.normal.set(e,t,r),ju(qu(this.normal.len(),1)),this.distance=n,this}clone(){return new Wu(this.normal,this.distance)}equals(e){return qu(this.distance,e.distance)&&qu(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=ZL.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=XL.from(e);const r=this.getPointDistance(e),n=ZL.copy(this.normal).scale(r);return e.subtract(n).to(t)}}const JL=[new Ut([1,0,0]),new Ut([0,1,0]),new Ut([0,0,1])],YL=new Ut,ZK=new Ut;new Wu(new Ut(1,0,0),0);class _u{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];ye(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*JL.length;const t=e.center,r=e.radius;let n=0;for(const o of JL){let c=this.planes[n],s=this.planes[n+1];c||(c=this.planes[n]=new Wu),s||(s=this.planes[n+1]=new Wu);const m=YL.copy(o).scale(-r).add(t);-o.dot(m),c.fromPointNormal(m,o);const x=YL.copy(o).scale(r).add(t),I=ZK.copy(o).negate();-I.dot(x),s.fromPointNormal(x,I),n+=2}return this}computeVisibility(e){let t=Wc.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Wc.OUTSIDE:return Wc.OUTSIDE;case Wc.INTERSECTING:t=Wc.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(ju(Number.isFinite(t),"parentPlaneMask is required."),t===_u.MASK_OUTSIDE||t===_u.MASK_INSIDE)return t;let r=_u.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const c=o<31?1<<o:0;if(o<31&&!(t&c))continue;const s=n[o],m=e.intersectPlane(s);if(m===Wc.OUTSIDE)return _u.MASK_OUTSIDE;m===Wc.INTERSECTING&&(r|=c)}return r}}ye(_u,"MASK_OUTSIDE",4294967295),ye(_u,"MASK_INSIDE",0),ye(_u,"MASK_INDETERMINATE",2147483647),new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut;const Rh=new xo,JK=new xo,YK=new xo,W_=new xo,eM=new xo;function eW(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=Qm.EPSILON20,r=10;let n=0,o=0;const c=JK,s=YK;c.identity(),s.copy(i);const m=t*tW(s);for(;o<r&&iW(s)>m;)rW(s,W_),eM.copy(W_).transpose(),s.multiplyRight(W_),s.multiplyLeft(eM),c.multiplyRight(W_),++n>2&&(++o,n=0);return e.unitary=c.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function tW(i){let e=0;for(let t=0;t<9;++t){const r=i[t];e+=r*r}return Math.sqrt(e)}const w2=[1,0,0],B2=[2,2,1];function iW(i){let e=0;for(let t=0;t<3;++t){const r=i[Rh.getElementIndex(B2[t],w2[t])];e+=2*r*r}return Math.sqrt(e)}function rW(i,e){const t=Qm.EPSILON15;let r=0,n=1;for(let x=0;x<3;++x){const I=Math.abs(i[Rh.getElementIndex(B2[x],w2[x])]);I>r&&(n=x,r=I)}const o=w2[n],c=B2[n];let s=1,m=0;if(Math.abs(i[Rh.getElementIndex(c,o)])>t){const x=i[Rh.getElementIndex(c,c)],I=i[Rh.getElementIndex(o,o)],F=i[Rh.getElementIndex(c,o)],O=(x-I)/2/F;let z;O<0?z=-1/(-O+Math.sqrt(1+O*O)):z=1/(O+Math.sqrt(1+O*O)),s=1/Math.sqrt(1+z*z),m=z*s}return xo.IDENTITY.to(e),e[Rh.getElementIndex(o,o)]=e[Rh.getElementIndex(c,c)]=s,e[Rh.getElementIndex(c,o)]=m,e[Rh.getElementIndex(o,c)]=-m,e}const ed=new Ut,nW=new Ut,sW=new Ut,oW=new Ut,aW=new Ut,lW=new xo,cW={diagonal:new xo,unitary:new xo};function uW(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ey;if(!i||i.length===0)return e.halfAxes=new xo([0,0,0,0,0,0,0,0,0]),e.center=new Ut,e;const t=i.length,r=new Ut(0,0,0);for(const lt of i)r.add(lt);const n=1/t;r.multiplyByScalar(n);let o=0,c=0,s=0,m=0,x=0,I=0;for(const lt of i){const nt=ed.copy(lt).subtract(r);o+=nt.x*nt.x,c+=nt.x*nt.y,s+=nt.x*nt.z,m+=nt.y*nt.y,x+=nt.y*nt.z,I+=nt.z*nt.z}o*=n,c*=n,s*=n,m*=n,x*=n,I*=n;const F=lW;F[0]=o,F[1]=c,F[2]=s,F[3]=c,F[4]=m,F[5]=x,F[6]=s,F[7]=x,F[8]=I;const{unitary:O}=eW(F,cW),z=e.halfAxes.copy(O);let ie=z.getColumn(0,sW),ne=z.getColumn(1,oW),ue=z.getColumn(2,aW),ce=-Number.MAX_VALUE,de=-Number.MAX_VALUE,be=-Number.MAX_VALUE,Te=Number.MAX_VALUE,je=Number.MAX_VALUE,Ge=Number.MAX_VALUE;for(const lt of i)ed.copy(lt),ce=Math.max(ed.dot(ie),ce),de=Math.max(ed.dot(ne),de),be=Math.max(ed.dot(ue),be),Te=Math.min(ed.dot(ie),Te),je=Math.min(ed.dot(ne),je),Ge=Math.min(ed.dot(ue),Ge);ie=ie.multiplyByScalar(.5*(Te+ce)),ne=ne.multiplyByScalar(.5*(je+de)),ue=ue.multiplyByScalar(.5*(Ge+be)),e.center.copy(ie).add(ne).add(ue);const $e=nW.set(ce-Te,de-je,be-Ge).multiplyByScalar(.5),Ue=new xo([$e[0],0,0,0,$e[1],0,0,0,$e[2]]);return e.halfAxes.multiplyRight(Ue),e}const C2=Math.PI/180,X_=new Float32Array(16),tM=new Float32Array(12);function iM(i,e,t){const r=e[0]*C2,n=e[1]*C2,o=e[2]*C2,c=Math.sin(o),s=Math.sin(r),m=Math.sin(n),x=Math.cos(o),I=Math.cos(r),F=Math.cos(n),O=t[0],z=t[1],ie=t[2];i[0]=O*F*I,i[1]=O*m*I,i[2]=O*-s,i[3]=z*(-m*x+F*s*c),i[4]=z*(F*x+m*s*c),i[5]=z*I*c,i[6]=ie*(m*c+F*s*x),i[7]=ie*(-F*c+m*s*x),i[8]=ie*I*x}function rM(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const nM={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,e){let{startRow:t,endRow:r}=e;const{data:n,getOrientation:o,getScale:c,getTranslation:s,getTransformMatrix:m}=this.props,x=Array.isArray(m),I=x&&m.length===16,F=Array.isArray(c),O=Array.isArray(o),z=Array.isArray(s),ie=I||!x&&!!m(n[0]);ie?i.constant=I:i.constant=O&&F&&z;const ne=i.value;if(i.constant){let ue;ie?(X_.set(m),ue=rM(X_)):(ue=tM,iM(ue,o,c),ue.set(s,9)),i.value=new Float32Array(ue)}else{let ue=t*i.size;const{iterable:ce,objectInfo:de}=TL(n,t,r);for(const be of ce){de.index++;let Te;if(ie)X_.set(I?m:m(be,de)),Te=rM(X_);else{Te=tM;const je=O?o:o(be,de),Ge=F?c:c(be,de);iM(Te,je,Ge),Te.set(z?s:s(be,de),9)}ne[ue++]=Te[0],ne[ue++]=Te[1],ne[ue++]=Te[2],ne[ue++]=Te[3],ne[ue++]=Te[4],ne[ue++]=Te[5],ne[ue++]=Te[6],ne[ue++]=Te[7],ne[ue++]=Te[8],ne[ue++]=Te[9],ne[ue++]=Te[10],ne[ue++]=Te[11]}}}};function sM(i,e){return e===Ln.CARTESIAN||e===Ln.METER_OFFSETS||e===Ln.DEFAULT&&!i.isGeospatial}const hW=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,AW=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function oM(i){let e=1/0,t=1/0,r=1/0,n=-1/0,o=-1/0,c=-1/0;const s=i.POSITION?i.POSITION.value:[],m=s&&s.length;for(let x=0;x<m;x+=3){const I=s[x],F=s[x+1],O=s[x+2];e=I<e?I:e,t=F<t?F:t,r=O<r?O:r,n=I>n?I:n,o=F>o?F:o,c=O>c?O:c}return[[e,t,r],[n,o,c]]}function dW(i,e){if(!i)throw new Error(e||"loader assertion failed.")}class jp{constructor(e,t){ye(this,"fields",void 0),ye(this,"metadata",void 0),dW(Array.isArray(e)),fW(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const c of r)e[c]=!0;const o=this.fields.filter(c=>e[c.name]);return new jp(o,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(o=>this.fields[o]).filter(Boolean);return new jp(n,this.metadata)}assign(e){let t,r=this.metadata;if(e instanceof jp){const c=e;t=c.fields,r=aM(aM(new Map,this.metadata),c.metadata)}else t=e;const n=Object.create(null);for(const c of this.fields)n[c.name]=c;for(const c of t)n[c.name]=c;const o=Object.values(n);return new jp(o,r)}}function fW(i){const e={};for(const t of i)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function aM(i,e){return new Map([...i||new Map,...e||new Map])}class Z_{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"nullable",void 0),ye(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new Z_(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let wo=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),lM,cM,uM;class E2{static isNull(e){return e&&e.typeId===wo.Null}static isInt(e){return e&&e.typeId===wo.Int}static isFloat(e){return e&&e.typeId===wo.Float}static isBinary(e){return e&&e.typeId===wo.Binary}static isUtf8(e){return e&&e.typeId===wo.Utf8}static isBool(e){return e&&e.typeId===wo.Bool}static isDecimal(e){return e&&e.typeId===wo.Decimal}static isDate(e){return e&&e.typeId===wo.Date}static isTime(e){return e&&e.typeId===wo.Time}static isTimestamp(e){return e&&e.typeId===wo.Timestamp}static isInterval(e){return e&&e.typeId===wo.Interval}static isList(e){return e&&e.typeId===wo.List}static isStruct(e){return e&&e.typeId===wo.Struct}static isUnion(e){return e&&e.typeId===wo.Union}static isFixedSizeBinary(e){return e&&e.typeId===wo.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===wo.FixedSizeList}static isMap(e){return e&&e.typeId===wo.Map}static isDictionary(e){return e&&e.typeId===wo.Dictionary}get typeId(){return wo.NONE}compareTo(e){return this===e}}lM=Symbol.toStringTag;class qp extends E2{constructor(e,t){super(),ye(this,"isSigned",void 0),ye(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return wo.Int}get[lM](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class pW extends qp{constructor(){super(!0,8)}}class gW extends qp{constructor(){super(!0,16)}}class mW extends qp{constructor(){super(!0,32)}}class yW extends qp{constructor(){super(!1,8)}}class _W extends qp{constructor(){super(!1,16)}}class vW extends qp{constructor(){super(!1,32)}}const hM={HALF:16,SINGLE:32,DOUBLE:64};cM=Symbol.toStringTag;class AM extends E2{constructor(e){super(),ye(this,"precision",void 0),this.precision=e}get typeId(){return wo.Float}get[cM](){return"Float"}toString(){return"Float".concat(this.precision)}}class bW extends AM{constructor(){super(hM.SINGLE)}}class xW extends AM{constructor(){super(hM.DOUBLE)}}uM=Symbol.toStringTag;class wW extends E2{constructor(e,t){super(),ye(this,"listSize",void 0),ye(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return wo.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[uM](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function BW(i){switch(i.constructor){case Int8Array:return new pW;case Uint8Array:return new yW;case Int16Array:return new gW;case Uint16Array:return new _W;case Int32Array:return new mW;case Uint32Array:return new vW;case Float32Array:return new bW;case Float64Array:return new xW;default:throw new Error("array type not supported")}}function CW(i,e,t){const r=BW(e.value),n=t||EW(e);return new Z_(i,new wW(e.size,new Z_("value",r)),!1,n)}function EW(i){const e=new Map;return"byteOffset"in i&&e.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&e.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&e.set("normalized",i.normalized.toString()),e}function dM(i,e){(i.COLOR_0||i.colors)&&e||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),Dn.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function fM(i,e){if(i.attributes)return dM(i.attributes,e),i instanceof Hm?i:new Hm(i);if(i.positions||i.POSITION)return dM(i,e),new Hm({attributes:i});throw Error("Invalid mesh")}const SW={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class S2 extends Gp{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=!hn(this.context.gl),t={};return lw(this.context.gl,zs.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:hW,fs:AW,modules:[Jw,vG,Yw],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:r}=this.props;if(!r)return null;if(t=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:n}=fM(r,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,t=oM(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:nM}),this.setState({emptyTexture:new jc(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:n}=e;if(t.mesh!==r.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const c=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:c}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!c||sM(r,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new Dp(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:fM(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return t.setUniforms({sampler:r||n,hasTexture:!!r}),t}setTexture(e){const{emptyTexture:t,model:r}=this.state;r&&r.setUniforms({sampler:e||t,hasTexture:!!e})}}ye(S2,"defaultProps",SW),ye(S2,"layerName","SimpleMeshLayer");class $p{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||AA(this.constructor.name),this.display=!0,this.position=new Ut,this.rotation=new Ut,this.scale=new Ut(1,1,1),this.matrix=new Bn,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Xi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Xi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Xi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:r,scale:n,update:o=!0}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:r,scale:n}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){Xi(e),t=t||this.matrix;const r=new Bn(e).multiplyRight(t),n=r.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class ty extends $p{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;ar.assert(t.every(r=>r instanceof $p),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(e){const t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,r)=>{let{worldMatrix:n}=r;const o=t.getBounds();if(!o)return;const[c,s]=o,m=new Ut(c).add(s).divide([2,2,2]);n.transformAsPoint(m,m);const x=new Ut(s).subtract(c).divide([2,2,2]);n.transformAsVector(x,x);for(let I=0;I<8;I++){const F=new Ut(I&1?-1:1,I&2?-1:1,I&4?-1:1).multiply(x).add(m);for(let O=0;O<3;O++)e[0][O]=Math.min(e[0][O],F[O]),e[1][O]=Math.max(e[1][O],F[O])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new Bn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Bn(t).multiplyRight(this.matrix);for(const n of this.children)n instanceof ty?n.traverse(e,{worldMatrix:r}):e(n,{worldMatrix:r})}}const TW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function pM(i){if(!i._animation){const e=IW[i.componentType],t=TW[i.type],r=t*i.count,{buffer:n,byteOffset:o}=i.bufferView.data,c=new e(n,o+(i.byteOffset||0),r);if(t===1)i._animation=Array.from(c);else{const s=[];for(let m=0;m<c.length;m+=t)s.push(Array.from(c.slice(m,m+t)));i._animation=s}}return i._animation}const LW=new Bn;function MW(i,e){if(e.matrix.identity(),i.translation&&e.matrix.translate(i.translation),i.rotation){const t=LW.fromQuaternion(i.rotation);e.matrix.multiplyRight(t)}i.scale&&e.matrix.scale(i.scale)}const T2=new zm;function PW(i,e,t,r,n){if(e==="rotation"){T2.slerp({start:t,target:r,ratio:n});for(let o=0;o<T2.length;o++)i[e][o]=T2[o]}else for(let o=0;o<t.length;o++)i[e][o]=n*r[o]+(1-n)*t[o]}function FW(i,e,t){let{p0:r,outTangent0:n,inTangent1:o,p1:c,tDiff:s,ratio:m}=t;for(let x=0;x<i[e].length;x++){const I=n[x]*s,F=o[x]*s;i[e][x]=(2*Math.pow(m,3)-3*Math.pow(m,2)+1)*r[x]+(Math.pow(m,3)-2*Math.pow(m,2)+m)*I+(-2*Math.pow(m,3)+3*Math.pow(m,2))*c[x]+(Math.pow(m,3)-Math.pow(m,2))*F}}function DW(i,e,t){for(let r=0;r<t.length;r++)i[e][r]=t[r]}function RW(i,e,t,r){let{input:n,interpolation:o,output:c}=e;const s=n[n.length-1],m=i%s,x=n.findIndex(z=>z>=m),I=Math.max(0,x-1);if(!Array.isArray(t[r]))switch(r){case"translation":t[r]=[0,0,0];break;case"rotation":t[r]=[0,0,0,1];break;case"scale":t[r]=[1,1,1];break;default:ar.warn("Bad animation path ".concat(r))()}Xi(t[r].length===c[I].length);const F=n[I],O=n[x];switch(o){case"STEP":DW(t,r,c[I]);break;case"LINEAR":if(O>F){const z=(m-F)/(O-F);PW(t,r,c[I],c[x],z)}break;case"CUBICSPLINE":if(O>F){const z=(m-F)/(O-F),ie=O-F,ne=c[3*I+1],ue=c[3*I+2],ce=c[3*x+0],de=c[3*x+1];FW(t,r,{p0:ne,outTangent0:ue,inTangent1:ce,p1:de,tDiff:ie,ratio:z})}break;default:ar.warn("Interpolation ".concat(o," not supported"))();break}}class kW{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(n=>{let{sampler:o,target:c,path:s}=n;RW(r,o,c,s),MW(c,c._node)})}}class OW{constructor(e){this.animations=e.animations.map((t,r)=>{const n=t.name||"Animation-".concat(r),o=t.samplers.map(s=>{let{input:m,interpolation:x="LINEAR",output:I}=s;return{input:pM(e.accessors[m]),interpolation:x,output:pM(e.accessors[I])}}),c=t.channels.map(s=>{let{sampler:m,target:x}=s;return{sampler:o[m],target:e.nodes[x.node],path:x.path}});return new kW({name:n,channels:c})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class UW extends $p{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof Dp?(this.model=e,this._setModelNodeProps(t)):this.model=new Dp(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class gM{constructor(e,t){let{attributes:r,material:n,pbrDebug:o,imageBasedLightingEnvironment:c,lights:s,useTangents:m}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},lw(e,zs.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],c&&(this.uniforms.u_DiffuseEnvSampler=c.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=c.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=c.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&m,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(c,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let c,s={};o.compressed?(c=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):c={data:o};const m=new jc(this.gl,{id:e.name||e.id,parameters:{...n,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...c});this.uniforms[t]=m,this.defineIfPresent(r,r),this.generatedTextures.push(m)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(ar.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const NW=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,zW=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function mM(i,e){return hn(i)?`#version 300 es
`.concat(e):e}function QW(i,e){const{id:t,drawMode:r,vertexCount:n,attributes:o,modelOptions:c}=e,s=new gM(i,e);ar.info(4,"createGLTFModel defines: ",s.defines)();const m=[];m.push(...s.generatedTextures),m.push(...Object.values(o).map(I=>I.buffer));const x=new UW(i,{id:t,drawMode:r,vertexCount:n,modules:[Uw],parameters:s.parameters,vs:mM(i,NW),fs:mM(i,zW),managedResources:m,...c,defines:{...s.defines,...c.defines}});return x.setProps({attributes:o}),x.setUniforms(s.uniforms),x}const VW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HW={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class GW{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},HW,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new OW(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(o=>this.createNode(o));return new ty({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const n=new ty({id:e.name||e.id,children:r});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Bn().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((o,c)=>this.createPrimitive(o,c,e)),n=new ty({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}getVertexCount(e){ar.warn("getVertexCount() not found")()}createPrimitive(e,t,r){const n=QW(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}createAttributes(e,t){const r={};return Object.keys(e).forEach(n=>{r[n]=this.createAccessor(e[n],this.createBuffer(e[n],this.gl.ARRAY_BUFFER))}),t&&(r.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),ar.info(4,"glTF Attributes",{attributes:e,indices:t,generated:r})(),r}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=new vs(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:t})),r.lumaBuffers[t]}createAccessor(e,t){return new bc({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:VW[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function jW(i,e,t){const r=new GW(i,t),n=r.instantiate(e),o=r.createAnimator();return{scenes:n,animator:o}}const qW="3.4.14",$W="3.4.14",yM="3.4.14",KW="https://unpkg.com/@loaders.gl/textures@".concat(yM,"/dist/libs/basis_encoder.wasm"),WW="https://unpkg.com/@loaders.gl/textures@".concat(yM,"/dist/libs/basis_encoder.js");let I2;async function _M(i){const e=i.modules||{};return e.basis?e.basis:(I2=I2||XW(i),await I2)}async function XW(i){let e=null,t=null;return[e,t]=await Promise.all([await Wd("basis_transcoder.js","textures",i),await Wd("basis_transcoder.wasm","textures",i)]),e=e||globalThis.BASIS,await ZW(e,t)}function ZW(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,initializeBasis:c}=n;c(),r({BasisFile:o})})})}let L2;async function vM(i){const e=i.modules||{};return e.basisEncoder?e.basisEncoder:(L2=L2||JW(i),await L2)}async function JW(i){let e=null,t=null;return[e,t]=await Promise.all([await Wd(WW,"textures",i),await Wd(KW,"textures",i)]),e=e||globalThis.BASIS,await YW(e,t)}function YW(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,KTX2File:c,initializeBasis:s,BasisEncoder:m}=n;s(),r({BasisFile:o,KTX2File:c,BasisEncoder:m})})})}const Kp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},eX=["","WEBKIT_","MOZ_"],bM={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let J_=null;function tX(i){if(!J_){i=i||iX()||void 0,J_=new Set;for(const e of eX)for(const t in bM)if(i&&i.getExtension("".concat(e).concat(t))){const r=bM[t];J_.add(r)}}return J_}function iX(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var xM,wM,BM,CM,EM,SM,TM,IM;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(xM||(xM={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(wM||(wM={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(BM||(BM={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(CM||(CM={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(EM||(EM={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(SM||(SM={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(TM||(TM={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(IM||(IM={}));const Xc=[171,75,84,88,32,50,48,187,13,10,26,10];function rX(i){const e=new Uint8Array(i);return!(e.byteLength<Xc.length||e[0]!==Xc[0]||e[1]!==Xc[1]||e[2]!==Xc[2]||e[3]!==Xc[3]||e[4]!==Xc[4]||e[5]!==Xc[5]||e[6]!==Xc[6]||e[7]!==Xc[7]||e[8]!==Xc[8]||e[9]!==Xc[9]||e[10]!==Xc[10]||e[11]!==Xc[11])}const nX={etc1:{basisFormat:0,compressed:!0,format:Kp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Kp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Kp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Kp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Kp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Kp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function sX(i,e){if(e.basis.containerFormat==="auto"){if(rX(i)){const r=await vM(e);return LM(r.KTX2File,i,e)}const{BasisFile:t}=await _M(e);return M2(t,i,e)}switch(e.basis.module){case"encoder":const t=await vM(e);switch(e.basis.containerFormat){case"ktx2":return LM(t.KTX2File,i,e);case"basis":default:return M2(t.BasisFile,i,e)}case"transcoder":default:const{BasisFile:r}=await _M(e);return M2(r,i,e)}}function M2(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),o=[];for(let c=0;c<n;c++){const s=r.getNumLevels(c),m=[];for(let x=0;x<s;x++)m.push(oX(r,c,x,t));o.push(m)}return o}finally{r.close(),r.delete()}}function oX(i,e,t,r){const n=i.getImageWidth(e,t),o=i.getImageHeight(e,t),c=i.getHasAlpha(),{compressed:s,format:m,basisFormat:x}=MM(r,c),I=i.getImageTranscodedSizeInBytes(e,t,x),F=new Uint8Array(I);if(!i.transcodeImage(F,e,t,x,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:F,compressed:s,format:m,hasAlpha:c}}function LM(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),o=[];for(let c=0;c<n;c++){o.push(aX(r,c,t));break}return[o]}finally{r.close(),r.delete()}}function aX(i,e,t){const{alphaFlag:r,height:n,width:o}=i.getImageLevelInfo(e,0,0),{compressed:c,format:s,basisFormat:m}=MM(t,r),x=i.getImageTranscodedSizeInBytes(e,0,0,m),I=new Uint8Array(x);if(!i.transcodeImage(I,e,0,0,m,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:I,compressed:c,levelSize:x,hasAlpha:r,format:s}}function MM(i,e){let t=i&&i.basis&&i.basis.format;return t==="auto"&&(t=PM()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),nX[t]}function PM(){const i=tX();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const lX={...{name:"Basis",id:lA?"basis":"basis-nodejs",module:"textures",version:$W,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:sX};function Zc(i,e){if(!i)throw new Error(e||"assert failed: gltf")}function FM(i,e){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return r.substr(0,r.lastIndexOf("/")+1)+i}function cX(i,e,t){const r=i.bufferViews[t];Zc(r);const n=r.buffer,o=e[n];Zc(o);const c=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,c,r.byteLength)}const DM=["SCALAR","VEC2","VEC3","VEC4"],uX=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],hX=new Map(uX),AX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function RM(i){return DM[i-1]||DM[0]}function kM(i){const e=hX.get(i.constructor);if(!e)throw new Error("Illegal typed array");return e}function P2(i,e){const t=fX[i.componentType],r=AX[i.type],n=dX[i.componentType],o=i.count*r,c=i.count*r*n;return Zc(c>=0&&c<=e.byteLength),{ArrayType:t,length:o,byteLength:c}}function OM(i){let{images:e,bufferViews:t}=i;e=e||[],t=t||[];const r=e.map(c=>c.bufferView);t=t.filter(c=>!r.includes(c));const n=t.reduce((c,s)=>c+s.byteLength,0),o=e.reduce((c,s)=>{const{width:m,height:x}=s.image;return c+m*x},0);return n+Math.ceil(4*o*1.33)}const pX={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class xc{constructor(e){ye(this,"gltf",void 0),ye(this,"sourceBuffers",void 0),ye(this,"byteLength",void 0),this.gltf=e||{json:{...pX},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,r=this.gltf.buffers[t];Zc(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:o,length:c}=P2(e,t),s=t.byteOffset+e.byteOffset;return new o(n,s,c)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{},n=r[t];return delete r[t],n}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Zc(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Zc(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:r,material:n,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(r){const m=this._addIndices(r);s.primitives[0].indices=m}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,t){const r=zx(e),n=t||(r==null?void 0:r.mimeType),c={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(c),this.json.images.length-1}addBufferView(e){const t=e.byteLength;Zc(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=ym(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:RM(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:kM(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),o=new Uint8Array(n);let c=0;for(const s of this.sourceBuffers||[])c=zN(s,o,c);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const r in e){const n=e[r],o=this._getGltfAttributeName(r),c=this.addBinaryBuffer(n.value,n);t[o]=c}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];const n=e.subarray(0,t);for(const o of n)r.min.push(o),r.max.push(o);for(let o=t;o<e.length;o+=t)for(let c=0;c<t;c++)r.min[0+c]=Math.min(r.min[0+c],e[o+c]),r.max[0+c]=Math.max(r.max[0+c],e[o+c]);return r}}const gX="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",mX="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",yX=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),_X=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),vX={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},bX={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function xX(i,e,t,r,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const c=await wX();EX(c,c.exports[bX[n]],i,e,t,r,c.exports[vX[o||"NONE"]])}let F2;async function wX(){return F2||(F2=BX()),F2}async function BX(){let i=gX;WebAssembly.validate(yX)&&(i=mX,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(CX(i),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function CX(i){const e=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const n=i.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let r=0;r<i.length;++r)e[t++]=e[r]<60?_X[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,t)}function EX(i,e,t,r,n,o,c){const s=i.exports.sbrk,m=r+3&-4,x=s(m*n),I=s(o.length),F=new Uint8Array(i.exports.memory.buffer);F.set(o,I);const O=e(x,r,n,I,o.length);if(O===0&&c&&c(x,m,n),t.set(F.subarray(x,x+r*n)),s(x-s(0)),O!==0)throw new Error("Malformed buffer data: ".concat(O))}const D2="EXT_meshopt_compression",SX=D2;async function TX(i,e){var t;const r=new xc(i);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const n=[];for(const o of i.json.bufferViews||[])n.push(IX(r,o));await Promise.all(n),r.removeExtension(D2)}async function IX(i,e){const t=i.getObjectExtension(e,D2);if(t){const{byteOffset:r=0,byteLength:n=0,byteStride:o,count:c,mode:s,filter:m="NONE",buffer:x}=t,I=i.gltf.buffers[x],F=new Uint8Array(I.arrayBuffer,I.byteOffset+r,n),O=new Uint8Array(i.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await xX(O,c,o,F,s,m),O}return null}const LX=Object.freeze(Object.defineProperty({__proto__:null,decode:TX,name:SX},Symbol.toStringTag,{value:"Module"})),Wp="EXT_texture_webp",MX=Wp;function PX(i,e){const t=new xc(i);if(!k8("image/webp")){if(t.getRequiredExtensions().includes(Wp))throw new Error("gltf: Required extension ".concat(Wp," not supported by browser"));return}const{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,Wp);o&&(n.source=o.source),t.removeObjectExtension(n,Wp)}t.removeExtension(Wp)}const FX=Object.freeze(Object.defineProperty({__proto__:null,name:MX,preprocess:PX},Symbol.toStringTag,{value:"Module"})),Y_="KHR_texture_basisu",DX=Y_;function RX(i,e){const t=new xc(i),{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,Y_);o&&(n.source=o.source),t.removeObjectExtension(n,Y_)}t.removeExtension(Y_)}const kX=Object.freeze(Object.defineProperty({__proto__:null,name:DX,preprocess:RX},Symbol.toStringTag,{value:"Module"})),OX={name:"Draco",id:lA?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function UX(i,e,t){const r=NM(e.metadata),n=[],o=NX(e.attributes);for(const c in i){const s=i[c],m=UM(c,s,o[c]);n.push(m)}if(t){const c=UM("indices",t);n.push(c)}return new jp(n,r)}function NX(i){const e={};for(const t in i){const r=i[t];e[r.name||"undefined"]=r}return e}function UM(i,e,t){const r=t?NM(t.metadata):void 0;return CW(i,e,r)}function NM(i){const e=new Map;for(const t in i)e.set("".concat(t,".string"),JSON.stringify(i[t]));return e}const zM={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},zX={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},QX=4;class VX{constructor(e){ye(this,"draco",void 0),ye(this,"decoder",void 0),ye(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(n){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!o.ptr){const O="DRACO decompression failed: ".concat(c.error_msg());throw new Error(O)}const s=this._getDracoLoaderData(o,n,t),m=this._getMeshData(o,s,t),x=oM(m.attributes),I=UX(m.attributes,s,m.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:x},...m,schema:I}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,r){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){const r={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),c=this._getAttributeMetadata(e,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:c};const s=this._getQuantizationTransform(o,t);s&&(r[o.unique_id()].quantization_transform=s);const m=this._getOctahedronTransform(o,t);m&&(r[o.unique_id()].octahedron_transform=m)}return r}_getMeshData(e,t,r){const n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const o of Object.values(e.attributes)){const c=this._deduceAttributeName(o,r);o.name=c;const{value:s,size:m}=this._getAttributeValues(t,o);n[c]={value:s,size:m,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(e){const r=e.num_faces()*3,n=r*QX,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),jX(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=zX[t.data_type],n=t.num_components,c=e.num_points()*n,s=c*r.BYTES_PER_ELEMENT,m=HX(this.draco,r);let x;const I=this.draco._malloc(s);try{const F=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,F,m,s,I),x=new r(this.draco.HEAPF32.buffer,I,c).slice()}finally{this.draco._free(I)}return{value:x,size:n}}_deduceAttributeName(e,t){const r=e.unique_id;for(const[c,s]of Object.entries(t.extraAttributes||{}))if(s===r)return c;const n=e.attribute_type;for(const c in zM)if(this.draco[c]===n)return zM[c];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);const n=GX(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(n)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits(),range:c.range(),min_values:new Float32Array([1,2,3]).map(s=>c.min_value(s))}}finally{this.draco.destroy(c)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(n)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits()}}finally{this.draco.destroy(c)}}return null}}function HX(i,e){switch(e){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function GX(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}function jX(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}const R2="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),qX="".concat(R2,"/draco_decoder.js"),$X="".concat(R2,"/draco_wasm_wrapper.js"),KX="".concat(R2,"/draco_decoder.wasm");let iy;async function WX(i){const e=i.modules||{};return e.draco3d?iy=iy||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):iy=iy||XX(i),await iy}async function XX(i){let e,t;switch(i.draco&&i.draco.decoderType){case"js":e=await Wd(qX,"draco",i);break;case"wasm":default:[e,t]=await Promise.all([await Wd($X,"draco",i),await Wd(KX,"draco",i)])}return e=e||globalThis.DracoDecoderModule,await ZX(e,t)}function ZX(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i({...t,onModuleLoaded:n=>r({draco:n})})})}const QM={...OX,parse:JX};async function JX(i,e){const{draco:t}=await WX(e),r=new VX(t);try{return r.parseSync(i,e==null?void 0:e.draco)}finally{r.destroy()}}function YX(i){const e={};for(const t in i){const r=i[t];if(t!=="indices"){const n=VM(r);e[t]=n}}return e}function VM(i){const{buffer:e,size:t,count:r}=eZ(i);return{value:e,size:t,byteOffset:0,count:r,type:RM(t),componentType:kM(e)}}function eZ(i){let e=i,t=1,r=0;return i&&i.value&&(e=i.value,t=i.size||1),e&&(ArrayBuffer.isView(e)||(e=tZ(e,Float32Array)),r=e.length/t),{buffer:e,size:t,count:r}}function tZ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new e(i):t&&!(i instanceof e)?new e(i):i:null}const lf="KHR_draco_mesh_compression",iZ=lf;function rZ(i,e,t){const r=new xc(i);for(const n of HM(r))r.getObjectExtension(n,lf)}async function nZ(i,e,t){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=new xc(i),o=[];for(const c of HM(n))n.getObjectExtension(c,lf)&&o.push(oZ(n,c,e,t));await Promise.all(o),n.removeExtension(lf)}function sZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new xc(i);for(const r of t.json.meshes||[])aZ(r,e),t.addRequiredExtension(lf)}async function oZ(i,e,t,r){const n=i.getObjectExtension(e,lf);if(!n)return;const o=i.getTypedArrayForBufferView(n.bufferView),c=Cx(o.buffer,o.byteOffset),{parse:s}=r,m={...t};delete m["3d-tiles"];const x=await s(c,QM,m,r),I=YX(x.attributes);for(const[F,O]of Object.entries(I))if(F in e.attributes){const z=e.attributes[F],ie=i.getAccessor(z);ie!=null&&ie.min&&ie!==null&&ie!==void 0&&ie.max&&(O.min=ie.min,O.max=ie.max)}e.attributes=I,x.indices&&(e.indices=VM(x.indices)),lZ(e)}function aZ(i,e){var t;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=n.DracoWriter.encodeSync({attributes:i}),s=o==null||(t=o.parseSync)===null||t===void 0?void 0:t.call(o,{attributes:i}),m=n._addFauxAttributes(s.attributes),x=n.addBufferView(c);return{primitives:[{attributes:m,mode:r,extensions:{[lf]:{bufferView:x,attributes:m}}}]}}function lZ(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*HM(i){for(const e of i.json.meshes||[])for(const t of e.primitives)yield t}const cZ=Object.freeze(Object.defineProperty({__proto__:null,decode:nZ,encode:sZ,name:iZ,preprocess:rZ},Symbol.toStringTag,{value:"Module"})),uZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hZ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},k2="KHR_texture_transform",AZ=k2,e1=new Ut,dZ=new xo,fZ=new xo;async function pZ(i,e){if(!new xc(i).getExtension(k2))return;const n=i.json.materials||[];for(let o=0;o<n.length;o++)gZ(o,i)}function gZ(i,e){var t,r,n;const o=[],c=(t=e.json.materials)===null||t===void 0?void 0:t[i],s=c==null||(r=c.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;s&&ry(e,i,s,o);const m=c==null?void 0:c.emissiveTexture;m&&ry(e,i,m,o);const x=c==null?void 0:c.normalTexture;x&&ry(e,i,x,o);const I=c==null?void 0:c.occlusionTexture;I&&ry(e,i,I,o);const F=c==null||(n=c.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;F&&ry(e,i,F,o)}function ry(i,e,t,r){const n=mZ(t,r);if(!n)return;const o=i.json.meshes||[];for(const c of o)for(const s of c.primitives){const m=s.material;Number.isFinite(m)&&e===m&&yZ(i,s,n)}}function mZ(i,e){var t;const r=(t=i.extensions)===null||t===void 0?void 0:t[k2],{texCoord:n=0}=i,{texCoord:o=n}=r;if(!(e.findIndex(s=>{let[m,x]=s;return m===n&&x===o})!==-1)){const s=bZ(r);return n!==o&&(i.texCoord=o),e.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:s}}return null}function yZ(i,e,t){const{originalTexCoord:r,texCoord:n,matrix:o}=t,c=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(c)){var s;const x=(s=i.json.accessors)===null||s===void 0?void 0:s[c];if(x&&x.bufferView){var m;const I=(m=i.json.bufferViews)===null||m===void 0?void 0:m[x.bufferView];if(I){const{arrayBuffer:F,byteOffset:O}=i.buffers[I.buffer],z=(O||0)+(x.byteOffset||0)+(I.byteOffset||0),{ArrayType:ie,length:ne}=P2(x,I),ue=hZ[x.componentType],ce=uZ[x.type],de=I.byteStride||ue*ce,be=new Float32Array(ne);for(let Te=0;Te<x.count;Te++){const je=new ie(F,z+Te*de,2);e1.set(je[0],je[1],1),e1.transformByMatrix3(o),be.set([e1[0],e1[1]],Te*ce)}r===n?_Z(x,I,i.buffers,be):vZ(n,x,e,i,be)}}}}function _Z(i,e,t,r){i.componentType=5126,t.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function vZ(i,e,t,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(i)]=c.length-1)}function bZ(i){const{offset:e=[0,0],rotation:t=0,scale:r=[1,1]}=i,n=new xo().set(1,0,0,0,1,0,e[0],e[1],1),o=dZ.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),c=fZ.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(c)}const xZ=Object.freeze(Object.defineProperty({__proto__:null,decode:pZ,name:AZ},Symbol.toStringTag,{value:"Module"})),cf="KHR_lights_punctual",wZ=cf;async function BZ(i){const e=new xc(i),{json:t}=e,r=e.getExtension(cf);r&&(e.json.lights=r.lights,e.removeExtension(cf));for(const n of t.nodes||[]){const o=e.getObjectExtension(n,cf);o&&(n.light=o.light),e.removeObjectExtension(n,cf)}}async function CZ(i){const e=new xc(i),{json:t}=e;if(t.lights){const r=e.addExtension(cf);Zc(!r.lights),r.lights=t.lights,delete t.lights}if(e.json.lights){for(const r of e.json.lights){const n=r.node;e.addObjectExtension(n,cf,r)}delete e.json.lights}}const EZ=Object.freeze(Object.defineProperty({__proto__:null,decode:BZ,encode:CZ,name:wZ},Symbol.toStringTag,{value:"Module"})),ny="KHR_materials_unlit",SZ=ny;async function TZ(i){const e=new xc(i),{json:t}=e;for(const r of t.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,ny);e.removeExtension(ny)}function IZ(i){const e=new xc(i),{json:t}=e;if(e.materials)for(const r of t.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,ny,{}),e.addExtension(ny))}const LZ=Object.freeze(Object.defineProperty({__proto__:null,decode:TZ,encode:IZ,name:SZ},Symbol.toStringTag,{value:"Module"})),sy="KHR_techniques_webgl",MZ=sy;async function PZ(i){const e=new xc(i),{json:t}=e,r=e.getExtension(sy);if(r){const n=DZ(r,e);for(const o of t.materials||[]){const c=e.getObjectExtension(o,sy);c&&(o.technique=Object.assign({},c,n[c.technique]),o.technique.values=RZ(o.technique,e)),e.removeObjectExtension(o,sy)}e.removeExtension(sy)}}async function FZ(i,e){}function DZ(i,e){const{programs:t=[],shaders:r=[],techniques:n=[]}=i,o=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=o.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),n.forEach(c=>{c.program=t[c.program]}),n}function RZ(i,e){const t=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in t)&&(t[r]=i.uniforms[r].value)}),Object.keys(t).forEach(r=>{typeof t[r]=="object"&&t[r].index!==void 0&&(t[r].texture=e.getTexture(t[r].index))}),t}const kZ=Object.freeze(Object.defineProperty({__proto__:null,decode:PZ,encode:FZ,name:MZ},Symbol.toStringTag,{value:"Module"})),GM="EXT_feature_metadata",OZ=GM;async function UZ(i){const e=new xc(i);NZ(e)}function NZ(i){var e;const t=i.getExtension(GM),r=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,n=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&n)for(const c in r){const s=r[c],m=VZ(n,c);m&&zZ(i,m,s)}}function zZ(i,e,t){for(const n in t.properties){var r;const o=t.properties[n],c=e==null||(r=e.properties)===null||r===void 0?void 0:r[n],s=e.count;if(c){const m=QZ(i,o,s,c);c.data=m}}}function QZ(i,e,t,r){const n=r.bufferView;let o=i.getTypedArrayForBufferView(n);switch(e.type){case"STRING":{const c=r.stringOffsetBufferView,s=i.getTypedArrayForBufferView(c);o=HZ(o,s,t);break}}return o}function VZ(i,e){for(const t in i){const r=i[t];if(r.class===e)return r}return null}function HZ(i,e,t){const r=[],n=new TextDecoder("utf8");let o=0;const c=4;for(let s=0;s<t;s++){const m=e[(s+1)*c]-e[s*c],x=i.subarray(o,m+o),I=n.decode(x);r.push(I),o+=m}return r}const jM=[LX,FX,kX,cZ,EZ,LZ,kZ,xZ,Object.freeze(Object.defineProperty({__proto__:null,decode:UZ,name:OZ},Symbol.toStringTag,{value:"Module"}))];function GZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=jM.filter(o=>qM(o.name,e));for(const o of r){var n;(n=o.preprocess)===null||n===void 0||n.call(o,i,e,t)}}async function jZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=jM.filter(o=>qM(o.name,e));for(const o of r){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,i,e,t))}}function qM(i,e){var t;const r=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(i in r&&!r[i])}const O2="KHR_binary_glTF";function qZ(i){const e=new xc(i),{json:t}=e;for(const r of t.images||[]){const n=e.getObjectExtension(r,O2);n&&Object.assign(r,n),e.removeObjectExtension(r,O2)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(O2)}const $M={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},$Z={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class KZ{constructor(){ye(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),ye(this,"json",void 0)}normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),qZ(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in $M)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(!(!r||Array.isArray(r))){e[t]=[];for(const n in r){const o=r[n];o.id=o.id||n;const c=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=c}}}_convertObjectIdsToArrayIndices(e){for(const t in $M)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:o}=t;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const r of e[t])for(const n in r){const o=r[n],c=this._convertIdToIndex(o,n);r[n]=c}}_convertIdToIndex(e,t){const r=$Z[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const o of e.materials){var t,r,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((t=o.values)===null||t===void 0?void 0:t.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),s=e.textures.findIndex(m=>m.id===c);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function WZ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new KZ().normalize(i,e)}const XZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ZZ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},vu={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},JZ={magFilter:vu.TEXTURE_MAG_FILTER,minFilter:vu.TEXTURE_MIN_FILTER,wrapS:vu.TEXTURE_WRAP_S,wrapT:vu.TEXTURE_WRAP_T},YZ={[vu.TEXTURE_MAG_FILTER]:vu.LINEAR,[vu.TEXTURE_MIN_FILTER]:vu.NEAREST_MIPMAP_LINEAR,[vu.TEXTURE_WRAP_S]:vu.REPEAT,[vu.TEXTURE_WRAP_T]:vu.REPEAT};function eJ(i){return ZZ[i]}function tJ(i){return XZ[i]}class iJ{constructor(){ye(this,"baseUri",""),ye(this,"json",{}),ye(this,"buffers",[]),ye(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:n=[],images:o=[],baseUri:c=""}=e;return Zc(r),this.baseUri=c,this.json=r,this.buffers=n,this.images=o,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,r)=>this._resolveBufferView(t,r))),e.images&&(e.images=e.images.map((t,r)=>this._resolveImage(t,r))),e.samplers&&(e.samplers=e.samplers.map((t,r)=>this._resolveSampler(t,r))),e.textures&&(e.textures=e.textures.map((t,r)=>this._resolveTexture(t,r))),e.accessors&&(e.accessors=e.accessors.map((t,r)=>this._resolveAccessor(t,r))),e.materials&&(e.materials=e.materials.map((t,r)=>this._resolveMaterial(t,r))),e.meshes&&(e.meshes=e.meshes.map((t,r)=>this._resolveMesh(t,r))),e.nodes&&(e.nodes=e.nodes.map((t,r)=>this._resolveNode(t,r))),e.skins&&(e.skins=e.skins.map((t,r)=>this._resolveSkin(t,r))),e.scenes&&(e.scenes=e.scenes.map((t,r)=>this._resolveScene(t,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,n)=>{const o=this.getMesh(n);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const n=r.attributes;r.attributes={};for(const o in n)r.attributes[o]=this.getAccessor(n[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=eJ(e.componentType),e.components=tJ(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:o}=P2(e,e.bufferView),c=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let s=r.arrayBuffer.slice(c,c+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(r,c,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,r,n,o){const c=new Uint8Array(o*n);for(let s=0;s<o;s++){const m=t+s*r;c.set(new Uint8Array(e.arrayBuffer.slice(m,m+n)),s*n)}return c.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):YZ,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const r in e){const n=this._enumSamplerParameter(r);n!==void 0&&(e.parameters[n]=e[r])}return e}_enumSamplerParameter(e){return JZ[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){const r=e.buffer,n={id:"bufferView-".concat(t),...e,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let c=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(c+=e.byteOffset),n.data=new Uint8Array(o,c,e.byteLength),n}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function rJ(i,e){return new iJ().postProcess(i,e)}const KM=1735152710,U2=12,t1=8,nJ=1313821514,sJ=5130562,oJ=0,aJ=1,lJ=0,Xp=!0;function cJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(e+0))).concat(String.fromCharCode(i.getUint8(e+1))).concat(String.fromCharCode(i.getUint8(e+2))).concat(String.fromCharCode(i.getUint8(e+3)))}function uJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:n=KM}=t,o=r.getUint32(e,!1);return o===n||o===KM}function hJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),n=cJ(r,t+0),o=r.getUint32(t+4,Xp),c=r.getUint32(t+8,Xp);switch(Object.assign(i,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),t+=U2,i.version){case 1:return AJ(i,r,t);case 2:return dJ(i,r,t,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function AJ(i,e,t){Is(i.header.byteLength>U2+t1);const r=e.getUint32(t+0,Xp),n=e.getUint32(t+4,Xp);return t+=t1,Is(n===lJ),N2(i,e,t,r),t+=r,t+=z2(i,e,t,i.header.byteLength),t}function dJ(i,e,t,r){return Is(i.header.byteLength>U2+t1),fJ(i,e,t,r),t+i.header.byteLength}function fJ(i,e,t,r){for(;t+8<=i.header.byteLength;){const n=e.getUint32(t+0,Xp),o=e.getUint32(t+4,Xp);switch(t+=t1,o){case nJ:N2(i,e,t,n);break;case sJ:z2(i,e,t,n);break;case oJ:r.strict||N2(i,e,t,n);break;case aJ:r.strict||z2(i,e,t,n);break}t+=ym(n,4)}return t}function N2(i,e,t,r){const n=new Uint8Array(e.buffer,t,r),c=new TextDecoder("utf8").decode(n);return i.json=JSON.parse(c),ym(r,4)}function z2(i,e,t,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:t,byteLength:r,arrayBuffer:e.buffer}),ym(r,4)}async function pJ(i,e){var t,r,n,o;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0;gJ(i,e,c,s),WZ(i,{normalize:s==null||(t=s.gltf)===null||t===void 0?void 0:t.normalize}),GZ(i,s,m);const x=[];if(s!=null&&(r=s.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await mJ(i,s,m),s!=null&&(n=s.gltf)!==null&&n!==void 0&&n.loadImages){const F=yJ(i,s,m);x.push(F)}const I=jZ(i,s,m);return x.push(I),await Promise.all(x),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?rJ(i,s):i}function gJ(i,e,t,r){if(r.uri&&(i.baseUri=r.uri),e instanceof ArrayBuffer&&!uJ(e,t,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")i.json=ON(e);else if(e instanceof ArrayBuffer){const c={};t=hJ(c,e,t,r.glb),Zc(c.type==="glTF","Invalid GLB magic string ".concat(c.type)),i._glb=c,i.json=c.json}else Zc(!1,"GLTF: must be ArrayBuffer or string");const n=i.json.buffers||[];if(i.buffers=new Array(n.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:c}=i._glb;i.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function mJ(i,e,t){const r=i.json.buffers||[];for(let c=0;c<r.length;++c){const s=r[c];if(s.uri){var n,o;const{fetch:m}=t;Zc(m);const x=FM(s.uri,e),I=await(t==null||(n=t.fetch)===null||n===void 0?void 0:n.call(t,x)),F=await(I==null||(o=I.arrayBuffer)===null||o===void 0?void 0:o.call(I));i.buffers[c]={arrayBuffer:F,byteOffset:0,byteLength:F.byteLength},delete s.uri}else i.buffers[c]===null&&(i.buffers[c]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function yJ(i,e,t){const r=_J(i),n=i.json.images||[],o=[];for(const c of r)o.push(vJ(i,n[c],c,e,t));return await Promise.all(o)}function _J(i){const e=new Set,t=i.json.textures||[];for(const r of t)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function vJ(i,e,t,r,n){const{fetch:o,parse:c}=n;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const x=FM(e.uri,r);s=await(await o(x)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const x=cX(i.json,i.buffers,e.bufferView);s=Cx(x.buffer,x.byteOffset,x.byteLength)}Zc(s,"glTF image has no data");let m=await c(s,[F5,lX],{mimeType:e.mimeType,basis:r.basis||{format:PM()}},n);m&&m[0]&&(m={compressed:!0,mipmaps:!1,width:m[0].width,height:m[0].height,data:m[0]}),i.images=i.images||[],i.images[t]=m}const oy={name:"glTF",id:"gltf",module:"gltf",version:qW,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:bJ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function bJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...oy.options,...e},e.gltf={...oy.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await pJ({},i,r,e,t)}async function xJ(i){const e=[];return i.scenes.forEach(t=>{t.traverse(r=>{Object.values(r.model.getUniforms()).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await wJ(()=>e.some(t=>!t.loaded))}async function wJ(i){for(;i();)await new Promise(e=>requestAnimationFrame(e))}const BJ=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,CJ=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,WM=[255,255,255,255],EJ={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:WM},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[oy]};class Q2 extends Gp{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=[Jw,Yw];return this.props._lighting==="pbr"&&e.push(Uw),super.getShaders({vs:BJ,fs:CJ,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:WM,transition:!0},instanceModelMatrix:nM})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let r=null;if(e.scenegraph instanceof $p)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,m=jW(t,s,this._getModelOptions());r={gltf:s,...m},xJ(m).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(Dn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const n={layer:this,gl:t},o=e.getScene(r,n),c=e.getAnimator(r,n);o instanceof $p?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,c,e._animations),this.setState({scenegraph:o,animator:c})):o!==null&&Dn.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,t)})}}_applyAnimationsProp(e,t,r){if(!e||!t||!r)return;const n=t.getAnimations();Object.keys(r).sort().forEach(o=>{const c=r[o];if(o==="*")n.forEach(s=>{Object.assign(s,c)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<n.length?Object.assign(n[s],c):Dn.warn("animation ".concat(o," not found"))()}else{const s=n.find(m=>{let{name:x}=m;return x===o});s?Object.assign(s,c):Dn.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof $p&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!hn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw(e){let{moduleParameters:t=null,parameters:r={},context:n}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:c,sizeMinPixels:s,sizeMaxPixels:m,opacity:x,coordinateSystem:I}=this.props,F=this.getNumInstances();this.state.scenegraph.traverse((O,z)=>{let{worldMatrix:ie}=z;O.model.setInstanceCount(F),O.updateModuleSettings(t),O.draw({parameters:r,uniforms:{sizeScale:c,opacity:x,sizeMinPixels:s,sizeMaxPixels:m,composeModelMatrix:sM(o,I),sceneModelMatrix:ie,u_Camera:O.model.getUniforms().project_uCameraPosition}})})}}ye(Q2,"defaultProps",EJ),ye(Q2,"layerName","ScenegraphLayer");const SJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,TJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function IJ(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const LJ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class V2 extends S2{getShaders(){const e=super.getShaders();return e.modules.push(Uw),{...e,vs:SJ,fs:TJ}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:r}=this.props,n=this.parseMaterial(r,e);this.setState({materialParser:n});const o=this.getShaders();return IJ(e.attributes),new Dp(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:r}=this.props,n=this.parseMaterial(e,r);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var r;const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new gM(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],n),r[o*3]=n[0],r[o*3+1]=n[1],r[o*3+2]=n[2];e.value=r}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}ye(V2,"layerName","MeshLayer"),ye(V2,"defaultProps",LJ);const MJ=6378137,PJ=6378137,FJ=6356752314245179e-9;function i1(i){return i}new Ut;function DJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i1;return"longitude"in i?(e[0]=t(i.longitude),e[1]=t(i.latitude),e[2]=i.height):"x"in i?(e[0]=t(i.x),e[1]=t(i.y),e[2]=i.z):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function RJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return DJ(i,e,wa._cartographicRadians?i1:qH)}function kJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i1;return"longitude"in e?(e.longitude=t(i[0]),e.latitude=t(i[1]),e.height=i[2]):"x"in e?(e.x=t(i[0]),e.y=t(i[1]),e.z=i[2]):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function OJ(i,e){return kJ(i,e,wa._cartographicRadians?i1:$H)}const Zp=new Ut,UJ=new Ut,NJ=new Ut;function zJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;Zp.from(i);const c=Zp.x,s=Zp.y,m=Zp.z,x=r.x,I=r.y,F=r.z,O=c*c*x*x,z=s*s*I*I,ie=m*m*F*F,ne=O+z+ie,ue=Math.sqrt(1/ne);if(!Number.isFinite(ue))return;const ce=UJ;if(ce.copy(i).scale(ue),ne<o)return ce.to(t);const de=n.x,be=n.y,Te=n.z,je=NJ;je.set(ce.x*de*2,ce.y*be*2,ce.z*Te*2);let Ge=(1-ue)*Zp.len()/(.5*je.len()),$e=0,Ue,lt,nt,De;do{Ge-=$e,Ue=1/(1+Ge*de),lt=1/(1+Ge*be),nt=1/(1+Ge*Te);const Fe=Ue*Ue,Je=lt*lt,We=nt*nt,Et=Fe*Ue,Ct=Je*lt,Lt=We*nt;De=O*Fe+z*Je+ie*We-1;const Ft=-2*(O*Et*de+z*Ct*be+ie*Lt*Te);$e=De/Ft}while(Math.abs(De)>Qm.EPSILON12);return Zp.scale([Ue,lt,nt]).to(t)}const XM=1e-14,QJ=new Ut,ZM={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},H2={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},ay={east:new Ut,north:new Ut,up:new Ut,west:new Ut,south:new Ut,down:new Ut},VJ=new Ut,HJ=new Ut,GJ=new Ut;function JM(i,e,t,r,n,o){const c=ZM[e]&&ZM[e][t];ju(c&&(!r||r===c));let s,m,x;const I=QJ.copy(n);if(qu(I.x,0,XM)&&qu(I.y,0,XM)){const O=Math.sign(I.z);s=VJ.fromArray(H2[e]),e!=="east"&&e!=="west"&&s.scale(O),m=HJ.fromArray(H2[t]),t!=="east"&&t!=="west"&&m.scale(O),x=GJ.fromArray(H2[r]),r!=="east"&&r!=="west"&&x.scale(O)}else{const{up:O,east:z,north:ie}=ay;z.set(-I.y,I.x,0).normalize(),i.geodeticSurfaceNormal(I,O),ie.copy(O).cross(z);const{down:ne,west:ue,south:ce}=ay;ne.copy(O).scale(-1),ue.copy(z).scale(-1),ce.copy(ie).scale(-1),s=ay[e],m=ay[t],x=ay[r]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=m.x,o[5]=m.y,o[6]=m.z,o[7]=0,o[8]=x.x,o[9]=x.y,o[10]=x.z,o[11]=0,o[12]=I.x,o[13]=I.y,o[14]=I.z,o[15]=1,o}const r1=new Ut,YM=new Ut,jJ=new Ut,Xu=new Ut,qJ=new Ut,n1=new Ut;class lo{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;ye(this,"radii",void 0),ye(this,"radiiSquared",void 0),ye(this,"radiiToTheFourth",void 0),ye(this,"oneOverRadii",void 0),ye(this,"oneOverRadiiSquared",void 0),ye(this,"minimumRadius",void 0),ye(this,"maximumRadius",void 0),ye(this,"centerToleranceSquared",Qm.EPSILON1),ye(this,"squaredXOverSquaredZ",void 0),ju(e>=0),ju(t>=0),ju(r>=0),this.radii=new Ut(e,t,r),this.radiiSquared=new Ut(e*e,t*t,r*r),this.radiiToTheFourth=new Ut(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new Ut(e===0?0:1/e,t===0?0:1/t,r===0?0:1/r),this.oneOverRadiiSquared=new Ut(e===0?0:1/(e*e),t===0?0:1/(t*t),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=YM,n=jJ,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,r),n.copy(this.radiiSquared).scale(r);const c=Math.sqrt(r.dot(n));return n.scale(1/c),r.scale(o),n.add(r),n.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];n1.from(e);const r=this.scaleToGeodeticSurface(n1,Xu);if(!r)return;const n=this.geodeticSurfaceNormal(r,YM),o=qJ;o.copy(n1).subtract(r);const c=Math.atan2(n.y,n.x),s=Math.asin(n.z),m=Math.sign(Ew(o,n1))*u3(o);return OJ([c,s,m],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Bn;return JM(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Bn;return JM(this,e,t,r,n,o)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return r1.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=RJ(e),n=r[0],o=r[1],c=Math.cos(o);return r1.set(c*Math.cos(n),c*Math.sin(n),Math.sin(o)).normalize(),r1.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return r1.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return zJ(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Xu.from(e);const r=Xu.x,n=Xu.y,o=Xu.z,c=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*c.x+n*n*c.y+o*o*c.z);return Xu.multiplyScalar(s).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Xu.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Xu.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];ju(qu(this.radii.x,this.radii.y,Qm.EPSILON15)),ju(this.radii.z>0),Xu.from(e);const n=Xu.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return Xu.set(0,0,n).to(r)}}ye(lo,"WGS84",new lo(MJ,PJ,FJ));function eP(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class tP{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eP(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eP()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class $J{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof tP?n=e:n=new tP(t,r),this.stats[t]=n),n}}class KJ{constructor(e,t,r){ye(this,"item",void 0),ye(this,"previous",void 0),ye(this,"next",void 0),this.item=e,this.previous=t,this.next=r}}class WJ{constructor(){ye(this,"head",null),ye(this,"tail",null),ye(this,"_length",0)}get length(){return this._length}add(e){const t=new KJ(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class XJ{constructor(){ye(this,"_list",void 0),ye(this,"_sentinel",void 0),ye(this,"_trimTiles",void 0),this._list=new WJ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,c=this._sentinel;let s=n.head;for(;s!==c&&(e.gpuMemoryUsageInBytes>o||r);){const m=s.item;s=s.next,this.unloadTile(e,m,t)}}trim(){this._trimTiles=!0}}function ZJ(i,e){Is(i),Is(e);const{rtcCenter:t,gltfUpAxis:r}=e,{computedTransform:n,boundingVolume:{center:o}}=i;let c=new Bn(n);switch(t&&c.translate(t),r){case"Z":break;case"Y":const F=new Bn().rotateX(Math.PI/2);c=c.multiplyRight(F);break;case"X":const O=new Bn().rotateY(-Math.PI/2);c=c.multiplyRight(O);break}e.isQuantized&&c.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new Ut(o);e.cartesianModelMatrix=c,e.cartesianOrigin=s;const m=lo.WGS84.cartesianToCartographic(s,new Ut),I=lo.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=I.multiplyRight(c),e.cartographicOrigin=m,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const iP=new Ut,G2=new Ut,j2=new _u([new Wu,new Wu,new Wu,new Wu,new Wu,new Wu]);function JJ(i,e){const{cameraDirection:t,cameraUp:r,height:n}=i,{metersPerUnit:o}=i.distanceScales,c=s1(i,i.center),s=lo.WGS84.eastNorthUpToFixedFrame(c),m=i.unprojectPosition(i.cameraPosition),x=lo.WGS84.cartographicToCartesian(m,new Ut),I=new Ut(s.transformAsVector(new Ut(t).scale(o))).normalize(),F=new Ut(s.transformAsVector(new Ut(r).scale(o))).normalize();eY(i);const O=i.constructor,{longitude:z,latitude:ie,width:ne,bearing:ue,zoom:ce}=i,de=new O({longitude:z,latitude:ie,height:n,width:ne,bearing:ue,zoom:ce,pitch:0});return{camera:{position:x,direction:I,up:F},viewport:i,topDownViewport:de,height:n,cullingVolume:j2,frameNumber:e,sseDenominator:1.15}}function YJ(i,e,t){if(t===0||i.length<=t)return[i,[]];const r=[],{longitude:n,latitude:o}=e.viewport;for(const[x,I]of i.entries()){const[F,O]=I.header.mbs,z=Math.abs(n-F),ie=Math.abs(o-O),ne=Math.sqrt(ie*ie+z*z);r.push([x,ne])}const c=r.sort((x,I)=>x[1]-I[1]),s=[];for(let x=0;x<t;x++)s.push(i[c[x][0]]);const m=[];for(let x=t;x<c.length;x++)m.push(i[c[x][0]]);return[s,m]}function eY(i){const e=i.getFrustumPlanes(),t=rP(e.near,i.cameraPosition),r=s1(i,t),n=s1(i,i.cameraPosition,G2);let o=0;j2.planes[o++].fromPointNormal(r,iP.copy(r).subtract(n));for(const c in e){if(c==="near")continue;const s=e[c],m=rP(s,t,G2),x=s1(i,m,G2);j2.planes[o++].fromPointNormal(x,iP.copy(r).subtract(x))}}function rP(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.normal.dot(e);return t.copy(i.normal).scale(i.distance-r).add(e),t}function s1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.unprojectPosition(e);return lo.WGS84.cartographicToCartesian(r,t)}const tY=6378137,iY=6378137,q2=6356752314245179e-9,nP=new Ut;function rY(i,e){if(i instanceof ey){const{halfAxes:t}=i,r=sY(t);return Math.log2(q2/(r+e[2]))}else if(i instanceof Ym){const{radius:t}=i;return Math.log2(q2/(t+e[2]))}else if(i.width&&i.height){const{width:t,height:r}=i,n=Math.log2(tY/t),o=Math.log2(iY/r);return(n+o)/2}return 1}function sP(i,e,t){const r=lo.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new Ut),n=Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2));return Math.log2(q2/(n+e[2]))}function nY(i,e,t){const[r,n,o,c]=i;return sP({xmin:r,xmax:o,ymin:n,ymax:c,zmin:0,zmax:0},e,t)}function sY(i){i.getColumn(0,nP);const e=i.getColumn(1),t=i.getColumn(2);return nP.add(e).add(t).len()}const Jc={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},_A={ADD:1,REPLACE:2},Jp={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},bu={I3S:"I3S",TILES3D:"TILES3D"},o1={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},oY={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function oP(i){return i!=null}const wl=new Ut,a1=new Ut,aY=new Ut,lY=new Ut;function $2(i,e,t){if(Is(i,"3D Tile: boundingVolume must be defined"),i.box)return uY(i.box,e,t);if(i.region){const[r,n,o,c,s,m]=i.region,x=lo.WGS84.cartographicToCartesian([pA(r),pA(c),s],aY),I=lo.WGS84.cartographicToCartesian([pA(o),pA(n),m],lY),F=new Ut().addVectors(x,I).multiplyScalar(.5),O=new Ut().subVectors(x,I).len()/2;return aP([F[0],F[1],F[2],O],new Bn)}if(i.sphere)return aP(i.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function cY(i,e){if(i.box)return hY(e);if(i.region){const[t,r,n,o,c,s]=i.region;return[[pA(t),pA(r),c],[pA(n),pA(o),s]]}if(i.sphere)return AY(e);throw new Error("Unkown boundingVolume type")}function uY(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);let n=[];if(i.length===10){const x=i.slice(3,6),I=new zm;I.fromArray(i,6);const F=new Ut([1,0,0]),O=new Ut([0,1,0]),z=new Ut([0,0,1]);F.transformByQuaternion(I),F.scale(x[0]),O.transformByQuaternion(I),O.scale(x[1]),z.transformByQuaternion(I),z.scale(x[2]),n=[...F.toArray(),...O.toArray(),...z.toArray()]}else n=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),c=e.transformAsVector(n.slice(3,6)),s=e.transformAsVector(n.slice(6,9)),m=new xo([o[0],o[1],o[2],c[0],c[1],c[2],s[0],s[1],s[2]]);return oP(t)?(t.center=r,t.halfAxes=m,t):new ey(r,m)}function aP(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);const n=e.getScale(a1),o=Math.max(Math.max(n[0],n[1]),n[2]),c=i[3]*o;return oP(t)?(t.center=r,t.radius=c,t):new Ym(r,c)}function hY(i){const e=lP(),{halfAxes:t}=i,r=new Ut(t.getColumn(0)),n=new Ut(t.getColumn(1)),o=new Ut(t.getColumn(2));for(let c=0;c<2;c++){for(let s=0;s<2;s++){for(let m=0;m<2;m++)wl.copy(i.center),wl.add(r),wl.add(n),wl.add(o),cP(e,wl),o.negate();n.negate()}r.negate()}return e}function AY(i){const e=lP(),{center:t,radius:r}=i,n=lo.WGS84.scaleToGeodeticSurface(t,wl);let o;n?o=lo.WGS84.geodeticSurfaceNormal(n):o=new Ut(0,0,1);let c=new Ut(o[2],-o[1],0);c.len()>0?c.normalize():c=new Ut(0,1,0);const s=c.clone().cross(o);for(const m of[c,s,o]){a1.copy(m).scale(r);for(let x=0;x<2;x++)wl.copy(t),wl.add(a1),cP(e,wl),a1.negate()}return e}function lP(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function cP(i,e){lo.WGS84.cartesianToCartographic(e,wl),i[0][0]=Math.min(i[0][0],wl[0]),i[0][1]=Math.min(i[0][1],wl[1]),i[0][2]=Math.min(i[0][2],wl[2]),i[1][0]=Math.max(i[1][0],wl[0]),i[1][1]=Math.max(i[1][1],wl[1]),i[1][2]=Math.max(i[1][2],wl[2])}new Ut,new Ut,new Bn,new Ut,new Ut,new Ut;function dY(i,e){const t=i*e;return 1-Math.exp(-(t*t))}function fY(i,e){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const t=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return dY(e,t)*r}return 0}function pY(i,e,t){const r=i.tileset,n=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=t?n:i.lodMetricValue;if(o===0)return 0;const c=Math.max(i._distanceToCamera,1e-7),{height:s,sseDenominator:m}=e,{viewDistanceScale:x}=r.options;let I=o*s*(x||1)/(c*m);return I-=fY(r,c),I}const K2=new Ut,uP=new Ut,td=new Ut,hP=new Ut,gY=new Ut,W2=new Bn,AP=new Bn;function mY(i,e){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const t=2*dP(i,e);return t<2?"OUT":!i.header.children||t<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function dP(i,e){const{topDownViewport:t}=e,r=i.header.mbs[1],n=i.header.mbs[0],o=i.header.mbs[2],c=i.header.mbs[3],s=[...i.boundingVolume.center],m=t.unprojectPosition(t.cameraPosition);lo.WGS84.cartographicToCartesian(m,K2),uP.copy(K2).subtract(s).normalize(),lo.WGS84.eastNorthUpToFixedFrame(s,W2),AP.copy(W2).invert(),td.copy(K2).transform(AP);const x=Math.sqrt(td[0]*td[0]+td[1]*td[1]),I=x*x/td[2];hP.copy([td[0],td[1],I]);const O=hP.transform(W2).subtract(s).normalize(),ie=uP.cross(O).normalize().scale(c).add(s),ne=lo.WGS84.cartesianToCartographic(ie),ue=t.project([n,r,o]),ce=t.project(ne);return gY.copy(ue).subtract(ce).magnitude()}function yY(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class fP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;ye(this,"_map",new Map),ye(this,"_array",void 0),ye(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Is(e<this._array.length),this._array[e]}set(e,t){Is(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Is(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Is(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const _Y={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class l1{traversalFinished(e){return!0}constructor(e){ye(this,"options",void 0),ye(this,"root",null),ye(this,"selectedTiles",{}),ye(this,"requestedTiles",{}),ye(this,"emptyTiles",{}),ye(this,"lastUpdate",new Date().getTime()),ye(this,"updateDebounceTime",1e3),ye(this,"_traversalStack",new fP),ye(this,"_emptyTraversalStack",new fP),ye(this,"_frameNumber",null),this.options={..._Y,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const o=r.pop();let c=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),c=this.updateAndPushChildren(o,t,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,m=!!(!s||s._shouldRefine),x=!c;o.hasRenderContent?o.refine===_A.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===_A.REPLACE&&(this.loadTile(o,t),x&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),x&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=c&&m}const n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const n of r)this.updateTile(n,t)}updateAndPushChildren(e,t,r,n){const{loadSiblings:o,skipLevelOfDetail:c}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const m=e.refine===_A.REPLACE&&e.hasRenderContent&&!c;let x=!1,I=!0;for(const F of s)if(F._selectionDepth=n,F.isVisibleAndInRequestVolume?(r.find(F)&&r.delete(F),r.push(F),x=!0):(m||o)&&(this.loadTile(F,t),this.touchTile(F,t)),m){let O;if(F._inRequestVolume?F.hasRenderContent?O=F.contentAvailable:O=this.executeEmptyTraversal(F,t):O=!1,I=I&&O,!I)return!1}return x||(I=!1),I}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n);else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){const o=n.pop();if(this.updateTile(o,t),o.isVisibleAndInRequestVolume||this.loadTile(o,t),this.touchTile(o,t),!o.hasRenderContent&&this.canTraverse(o,t,!1,!0)){const s=o.children;for(const m of s)n.find(m)&&n.delete(m),n.push(m)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const pP=new Ut;function vY(i){return i!=null}class X2{constructor(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";ye(this,"tileset",void 0),ye(this,"header",void 0),ye(this,"id",void 0),ye(this,"url",void 0),ye(this,"parent",void 0),ye(this,"refine",void 0),ye(this,"type",void 0),ye(this,"contentUrl",void 0),ye(this,"lodMetricType","geometricError"),ye(this,"lodMetricValue",0),ye(this,"boundingVolume",null),ye(this,"content",null),ye(this,"contentState",Jc.UNLOADED),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"children",[]),ye(this,"depth",0),ye(this,"viewportIds",[]),ye(this,"transform",new Bn),ye(this,"extensions",null),ye(this,"implicitTiling",null),ye(this,"userData",{}),ye(this,"computedTransform",void 0),ye(this,"hasEmptyContent",!1),ye(this,"hasTilesetContent",!1),ye(this,"traverser",new l1({})),ye(this,"_cacheNode",null),ye(this,"_frameNumber",null),ye(this,"_expireDate",null),ye(this,"_expiredContent",null),ye(this,"_boundingBox",void 0),ye(this,"_distanceToCamera",0),ye(this,"_screenSpaceError",0),ye(this,"_visibilityPlaneMask",void 0),ye(this,"_visible",void 0),ye(this,"_contentBoundingVolume",void 0),ye(this,"_viewerRequestVolume",void 0),ye(this,"_initialTransform",new Bn),ye(this,"_priority",0),ye(this,"_selectedFrame",0),ye(this,"_requestedFrame",0),ye(this,"_selectionDepth",0),ye(this,"_touchedFrame",0),ye(this,"_centerZDepth",0),ye(this,"_shouldRefine",!1),ye(this,"_stackLength",0),ye(this,"_visitedFrame",0),ye(this,"_inRequestVolume",!1),ye(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Jc.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Jc.UNLOADED}get contentExpired(){return this.contentState===Jc.EXPIRED}get contentFailed(){return this.contentState===Jc.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=cY(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case bu.I3S:return dP(this,e);case bu.TILES3D:return pY(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===_A.ADD||t;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Jc.UNLOADED)return-1;const n=this.parent,c=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-c,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Jc.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Jc.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await HA(r,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Jc.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Jc.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Jc.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:_u.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==_u.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const r=this.boundingVolume;return pP.subVectors(r.center,t.position),t.direction.dot(pP)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(vY(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Jc.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Bn(e.transform):new Bn;const t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Bn(n).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new Bn;this._initialTransform=new Bn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Jc.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=_u.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||_A.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=$2(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=$2(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=$2(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Bn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return yY(this.tileset.tileset)}}}class bY extends l1{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const c=e.children[0];this.updateTileVisibility(c,t),e._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const n=e.refine===_A.REPLACE,o=e._optimChildrenWithinParent===oY.USE_OPTIMIZATION;if(n&&o&&r&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==_A.ADD?!1:!this.shouldRefine(e,t,!0)}}class xY{constructor(){ye(this,"frameNumberMap",new Map)}register(e,t){const r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const n=r.get(t)||1;r.set(t,n-1)}isZero(e,t){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(t))||0)===0}}const Z2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class wY{constructor(){ye(this,"_statusMap",void 0),ye(this,"pendingTilesRegister",new xY),this._statusMap={}}add(e,t,r,n){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:c}}=n;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:Z2.REQUESTED},this.pendingTilesRegister.register(c,o),e().then(s=>{this._statusMap[t].status=Z2.COMPLETED;const{frameNumber:m,viewport:{id:x}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(x,m),this._statusMap[t].callback(s,n)}).catch(s=>{this._statusMap[t].status=Z2.ERROR;const{frameNumber:m,viewport:{id:x}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(x,m),r(s)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:o,viewport:{id:c}}=t;this.pendingTilesRegister.register(c,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class BY extends l1{constructor(e){super(e),ye(this,"_tileManager",void 0),this._tileManager=new wY}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=mY(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,o=e.tileset;for(const c of r){const s="".concat(c.id,"-").concat(t.viewport.id),m=n&&n.find(x=>x.id===s);if(m)m&&this.updateTile(m,t);else{let x=()=>this._loadTile(c.id,o);this._tileManager.find(s)?this._tileManager.update(s,t):(o.tileset.nodePages&&(x=()=>o.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(x,s,F=>this._onTileLoad(F,e,s),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),o={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await HA(n,r,o)}_onTileLoad(e,t,r){const n=new X2(t.tileset,e,t,r);t.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const CY={description:"",ellipsoid:lo.WGS84,modelMatrix:new Bn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},c1="Tiles In Tileset(s)",J2="Tiles In Memory",gP="Tiles In View",mP="Tiles To Render",yP="Tiles Loaded",Y2="Tiles Loading",_P="Tiles Unloaded",vP="Failed Tile Loads",bP="Points/Vertices",eB="Tile Memory Use";class EY{constructor(e,t){ye(this,"options",void 0),ye(this,"loadOptions",void 0),ye(this,"type",void 0),ye(this,"tileset",void 0),ye(this,"loader",void 0),ye(this,"url",void 0),ye(this,"basePath",void 0),ye(this,"modelMatrix",void 0),ye(this,"ellipsoid",void 0),ye(this,"lodMetricType",void 0),ye(this,"lodMetricValue",void 0),ye(this,"refine",void 0),ye(this,"root",null),ye(this,"roots",{}),ye(this,"asset",{}),ye(this,"description",""),ye(this,"properties",void 0),ye(this,"extras",null),ye(this,"attributions",{}),ye(this,"credits",{}),ye(this,"stats",void 0),ye(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),ye(this,"cartographicCenter",null),ye(this,"cartesianCenter",null),ye(this,"zoom",1),ye(this,"boundingVolume",null),ye(this,"dynamicScreenSpaceErrorComputedDensity",0),ye(this,"maximumMemoryUsage",32),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"_frameNumber",0),ye(this,"_queryParams",{}),ye(this,"_extensionsUsed",[]),ye(this,"_tiles",{}),ye(this,"_pendingCount",0),ye(this,"selectedTiles",[]),ye(this,"traverseCounter",0),ye(this,"geometricError",0),ye(this,"lastUpdatedVieports",null),ye(this,"_requestedTiles",[]),ye(this,"_emptyTiles",[]),ye(this,"frameStateData",{}),ye(this,"_traverser",void 0),ye(this,"_cache",new XJ),ye(this,"_requestScheduler",void 0),ye(this,"updatePromise",null),ye(this,"tilesetInitializationPromise",void 0),this.options={...CY,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Ex(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new WN({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new $J({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const n of t){const o=n.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const n of t){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const c=JJ(n,this._frameNumber);this._traverser.traverse(this.roots[o],c,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[o,c]=YJ(n,e,this.options.maximumTilesSelected);r.selectedTiles=o;for(const s of c)s.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map(c=>c.id)),n=new Set(t.map(c=>c.id));let o=e.filter(c=>!n.has(c.id)).length>0;return o=o||t.filter(c=>!r.has(c.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(gP).count=this.selectedTiles.length,this.stats.get(mP).count=e,this.stats.get(bP).count=t}async _initializeTileSet(e){this.type===bu.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===bu.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===bu.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:o,ymin:c,ymax:s,zmin:m,zmax:x}=t;this.cartographicCenter=new Ut(n+(o-n)/2,c+(s-c)/2,m+(x-m)/2),this.cartesianCenter=lo.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=sP(t,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[n,o,c,s]=r;this.cartographicCenter=new Ut(n+(c-n)/2,o+(s-o)/2,0),this.cartesianCenter=lo.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=nY(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ut,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ut,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=lo.WGS84.cartesianToCartographic(t,new Ut):this.cartographicCenter=new Ut(0,0,-lo.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=rY(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(c1),this.stats.get(Y2),this.stats.get(J2),this.stats.get(gP),this.stats.get(mP),this.stats.get(yP),this.stats.get(_P),this.stats.get(vP),this.stats.get(bP),this.stats.get(eB,"memory")}_initializeTileHeaders(e,t){const r=new X2(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===bu.TILES3D){const o=[];for(o.push(r);o.length>0;){const c=o.pop();this.stats.get(c1).incrementCount();const s=c.header.children||[];for(const m of s){var n;const x=new X2(this,m,c);if((n=x.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const F=new URL(x.contentUrl).searchParams.get("session");F&&(this._queryParams.session=F)}c.children.push(x),x.depth=c.depth+1,o.push(x)}}}return r}_initializeTraverser(){let e;switch(this.type){case bu.TILES3D:e=bY;break;case bu.I3S:e=BY;break;default:e=l1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(vP).incrementCount();const r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}_onTileLoad(e,t){if(t){if(this.type===bu.I3S){var r,n;const o=((r=this.tileset)===null||r===void 0||(n=r.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(c1).reset(),this.stats.get(c1).addCount(o)}e&&e.content&&ZJ(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===bu.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===bu.TILES3D){var t;const{extensionsRemoved:r=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Y2).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Y2).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(yP).incrementCount(),this.stats.get(J2).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(eB).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(J2).decrementCount(),this.stats.get(_P).incrementCount(),this.stats.get(eB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const n of e.children)r.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const xP="3.4.14",ly={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function wP(i,e,t){Is(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(i,e,t);return r.decode(n)}function SY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(i);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const TY={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},sa={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Qn={...TY,...sa},tB={[sa.DOUBLE]:Float64Array,[sa.FLOAT]:Float32Array,[sa.UNSIGNED_SHORT]:Uint16Array,[sa.UNSIGNED_INT]:Uint32Array,[sa.UNSIGNED_BYTE]:Uint8Array,[sa.BYTE]:Int8Array,[sa.SHORT]:Int16Array,[sa.INT]:Int32Array},IY={DOUBLE:sa.DOUBLE,FLOAT:sa.FLOAT,UNSIGNED_SHORT:sa.UNSIGNED_SHORT,UNSIGNED_INT:sa.UNSIGNED_INT,UNSIGNED_BYTE:sa.UNSIGNED_BYTE,BYTE:sa.BYTE,SHORT:sa.SHORT,INT:sa.INT},iB="Failed to convert GL type";class kh{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in tB)if(tB[t]===e)return t;throw new Error(iB)}static fromName(e){const t=IY[e];if(!t)throw new Error(iB);return t}static getArrayType(e){switch(e){case sa.UNSIGNED_SHORT_5_6_5:case sa.UNSIGNED_SHORT_4_4_4_4:case sa.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=tB[e];if(!t)throw new Error(iB);return t}}static getByteSize(e){return kh.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!kh.getArrayType(e)}static createTypedArray(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(t.byteLength-r)/kh.getByteSize(e));const o=kh.getArrayType(e);return new o(t,r,n)}}function LY(i,e){if(!i)throw new Error("math.gl assertion failed. ".concat(e))}function MY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=i>>11&31,r=i>>5&63,n=i&31;return e[0]=t<<3,e[1]=r<<2,e[2]=n<<3,e}new Cw,new Ut,new Cw,new Cw;function BP(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return gA(i,0,e)/e*2-1}function CP(i){return i<0?-1:1}function PY(i,e,t,r){if(LY(r),i<0||i>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(r.x=BP(i,t),r.y=BP(e,t),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*CP(n),r.y=(1-Math.abs(n))*CP(r.y)}return r.normalize()}function FY(i,e,t){return PY(i,e,255,t)}class rB{constructor(e,t){ye(this,"json",void 0),ye(this,"buffer",void 0),ye(this,"featuresLength",0),ye(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qn.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=kh.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,o){const c=this.json[e];if(!c)return c;const s=this.getPropertyArray(e,t,r);if(r===1)return s[n];for(let m=0;m<r;++m)o[m]=s[r*n+m];return o}_getTypedArrayFromBinary(e,t,r,n,o){const c=this._cachedTypedArrays;let s=c[e];return s||(s=kh.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,n*r),c[e]=s),s}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=kh.createTypedArray(t,r),n[e]=o),o}}const DY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RY={SCALAR:(i,e)=>i[e],VEC2:(i,e)=>[i[2*e+0],i[2*e+1]],VEC3:(i,e)=>[i[3*e+0],i[3*e+1],i[3*e+2]],VEC4:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT2:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT3:(i,e)=>[i[9*e+0],i[9*e+1],i[9*e+2],i[9*e+3],i[9*e+4],i[9*e+5],i[9*e+6],i[9*e+7],i[9*e+8]],MAT4:(i,e)=>[i[16*e+0],i[16*e+1],i[16*e+2],i[16*e+3],i[16*e+4],i[16*e+5],i[16*e+6],i[16*e+7],i[16*e+8],i[16*e+9],i[16*e+10],i[16*e+11],i[16*e+12],i[16*e+13],i[16*e+14],i[16*e+15]]},kY={SCALAR:(i,e,t)=>{e[t]=i},VEC2:(i,e,t)=>{e[2*t+0]=i[0],e[2*t+1]=i[1]},VEC3:(i,e,t)=>{e[3*t+0]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]},VEC4:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT2:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT3:(i,e,t)=>{e[9*t+0]=i[0],e[9*t+1]=i[1],e[9*t+2]=i[2],e[9*t+3]=i[3],e[9*t+4]=i[4],e[9*t+5]=i[5],e[9*t+6]=i[6],e[9*t+7]=i[7],e[9*t+8]=i[8],e[9*t+9]=i[9]},MAT4:(i,e,t)=>{e[16*t+0]=i[0],e[16*t+1]=i[1],e[16*t+2]=i[2],e[16*t+3]=i[3],e[16*t+4]=i[4],e[16*t+5]=i[5],e[16*t+6]=i[6],e[16*t+7]=i[7],e[16*t+8]=i[8],e[16*t+9]=i[9],e[16*t+10]=i[10],e[16*t+11]=i[11],e[16*t+12]=i[12],e[16*t+13]=i[13],e[16*t+14]=i[14],e[16*t+15]=i[15]}};function OY(i,e,t,r){const{componentType:n}=i;Is(i.componentType);const o=typeof n=="string"?kh.fromName(n):n,c=DY[i.type],s=RY[i.type],m=kY[i.type];return t+=i.byteOffset,{values:kh.createTypedArray(o,e,t,c*r),type:o,size:c,unpacker:s,packer:m}}const Oh=i=>i!==void 0;function UY(i,e,t){if(!e)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?NY(r,t):null}function NY(i,e){let t,r,n;const o=i.instancesLength,c=i.classes;let s=i.classIds,m=i.parentCounts,x=i.parentIds,I=o;Oh(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,n=getBinaryAccessor(s),s=n.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let F;if(Oh(m))for(Oh(m.byteOffset)&&(m.componentType=defaultValue(m.componentType,GL.UNSIGNED_SHORT),m.type=AttributeType.SCALAR,n=getBinaryAccessor(m),m=n.createArrayBufferView(e.buffer,e.byteOffset+m.byteOffset,o)),F=new Uint16Array(o),I=0,t=0;t<o;++t)F[t]=I,I+=m[t];Oh(x)&&Oh(x.byteOffset)&&(x.componentType=defaultValue(x.componentType,GL.UNSIGNED_SHORT),x.type=AttributeType.SCALAR,n=getBinaryAccessor(x),x=n.createArrayBufferView(e.buffer,e.byteOffset+x.byteOffset,I));const O=c.length;for(t=0;t<O;++t){const ue=c[t].length,ce=c[t].instances,de=getBinaryProperties(ue,ce,e);c[t].instances=combine(de,ce)}const z=new Array(O).fill(0),ie=new Uint16Array(o);for(t=0;t<o;++t)r=s[t],ie[t]=z[r],++z[r];const ne={classes:c,classIds:s,classIndexes:ie,parentCounts:m,parentIndexes:F,parentIds:x};return VY(ne),ne}function cy(i,e,t){if(!i)return;const r=i.parentCounts;return i.parentIds?t(i,e):r>0?zY(i,e,t):QY(i,e,t)}function zY(i,e,t){const r=i.classIds,n=i.parentCounts,o=i.parentIds,c=i.parentIndexes,s=r.length,m=scratchVisited;m.length=Math.max(m.length,s);const x=++marker,I=scratchStack;for(I.length=0,I.push(e);I.length>0;){if(e=I.pop(),m[e]===x)continue;m[e]=x;const F=t(i,e);if(Oh(F))return F;const O=n[e],z=c[e];for(let ie=0;ie<O;++ie){const ne=o[z+ie];ne!==e&&I.push(ne)}}return null}function QY(i,e,t){let r=!0;for(;r;){const n=t(i,e);if(Oh(n))return n;const o=i.parentIds[e];r=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function VY(i){const t=i.classIds.length;for(let r=0;r<t;++r)EP(i,r,stack)}function EP(i,e,t){const r=i.parentCounts,n=i.parentIds,o=i.parentIndexes,s=i.classIds.length;if(!Oh(n))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const m=Oh(r)?r[e]:1,x=Oh(r)?o[e]:e;for(let I=0;I<m;++I){const F=n[x+I];F!==e&&EP(i,F,t)}t.pop(e)}function wc(i){return i!=null}const u1=(i,e)=>i,HY={HIERARCHY:!0,extensions:!0,extras:!0};class SP{constructor(e,t,r){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ye(this,"json",void 0),ye(this,"binary",void 0),ye(this,"featureCount",void 0),ye(this,"_extensions",void 0),ye(this,"_properties",void 0),ye(this,"_binaryProperties",void 0),ye(this,"_hierarchy",void 0),Is(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const c in this.json)HY[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=UY(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Is(typeof t=="string",t),this._hierarchy){const r=cy(this._hierarchy,e,(n,o)=>{const c=n.classIds[o];return n.classes[c].name===t});return wc(r)}return!1}isExactClass(e,t){return Is(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Is(typeof t=="string",t),wc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=wc(t)?t:[],t.length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Is(typeof t=="string",t),this._binaryProperties){const n=this._binaryProperties[t];if(wc(n))return this._getBinaryProperty(n,e)}const r=this._properties[t];if(wc(r))return u1(r[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(wc(n))return n}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),Is(typeof t=="string",t),this._binaryProperties){const c=this._binaryProperties[t];if(c){this._setBinaryProperty(c,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let o=this._properties[t];wc(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=u1(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;Is(this.binary,"Property ".concat(e," requires a batch table binary.")),Is(r.type,"Property ".concat(e," requires a type."));const n=OY(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=cy(this._hierarchy,e,(n,o)=>{const c=n.classIds[o],s=n.classes[c].instances;return wc(s[t])});return wc(r)}_getPropertyNamesInHierarchy(e,t){cy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],c=r.classes[o].instances;for(const s in c)c.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)})}_getHierarchyProperty(e,t){return cy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],c=r.classes[o],s=r.classIndexes[n],m=c.instances[t];return wc(m)?wc(m.typedArray)?this._getBinaryProperty(m,s):u1(m[s]):null})}_setHierarchyProperty(e,t,r,n){const o=cy(this._hierarchy,t,(c,s)=>{const m=c.classIds[s],x=c.classes[m],I=c.classIndexes[s],F=x.instances[r];return wc(F)?(Is(s===t,'Inherited property "'.concat(r,'" is read-only.')),wc(F.typedArray)?this._setBinaryProperty(F,I,n):F[I]=u1(n),!0):!1});return wc(o)}}const nB=4;function h1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(i.magic=r.getUint32(t,!0),t+=nB,i.version=r.getUint32(t,!0),t+=nB,i.byteLength=r.getUint32(t,!0),t+=nB,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return t}const Yp=4,TP="b3dm tile in legacy format.";function sB(i,e,t){const r=new DataView(e);let n;i.header=i.header||{};let o=r.getUint32(t,!0);t+=Yp;let c=r.getUint32(t,!0);t+=Yp;let s=r.getUint32(t,!0);t+=Yp;let m=r.getUint32(t,!0);return t+=Yp,s>=570425344?(t-=Yp*2,n=o,s=c,m=0,o=0,c=0,console.warn(TP)):m>=570425344&&(t-=Yp,n=s,s=o,m=c,o=0,c=0,console.warn(TP)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=c,i.header.batchTableJsonByteLength=s,i.header.batchTableBinaryByteLength=m,i.header.batchLength=n,t}function oB(i,e,t,r){return t=GY(i,e,t),t=jY(i,e,t),t}function GY(i,e,t,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:c}=i.header;if(i.featureTableJson={BATCH_LENGTH:c||0},n>0){const s=wP(e,t,n);i.featureTableJson=JSON.parse(s)}return t+=n,i.featureTableBinary=new Uint8Array(e,t,o),t+=o,t}function jY(i,e,t,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=i.header;if(n>0){const c=wP(e,t,n);i.batchTableJson=JSON.parse(c),t+=n,o>0&&(i.batchTableBinary=new Uint8Array(e,t,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),t+=o)}return t}function IP(i,e,t){if(!e&&(!i||!i.batchIds||!t))return null;const{batchIds:r,isRGB565:n,pointCount:o}=i;if(r&&t){const c=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const m=r[s],I=t.getProperty(m,"dimensions").map(F=>F*255);c[s*3]=I[0],c[s*3+1]=I[1],c[s*3+2]=I[2]}return{type:Qn.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(n){const c=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const m=MY(e[s]);c[s*3]=m[0],c[s*3+1]=m[1],c[s*3+2]=m[2]}return{type:Qn.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return e&&e.length===o*3?{type:Qn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Qn.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const LP=new Ut;function qY(i,e){if(!e)return null;if(i.isOctEncoded16P){const t=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)FY(e[r*2],e[r*2+1],LP),LP.toArray(t,r*3);return{type:Qn.FLOAT,size:2,value:t}}return{type:Qn.FLOAT,size:2,value:e}}function $Y(i,e,t){return i.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,KY(i,e)):{type:Qn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function KY(i,e){const t=new Ut,r=new Float32Array(i.pointCount*3);for(let n=0;n<i.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,n*3);return r}async function WY(i,e,t,r,n){t=h1(i,e,t),t=sB(i,e,t),t=oB(i,e,t),XY(i);const{featureTable:o,batchTable:c}=ZY(i);return await iee(i,o,c,r,n),JY(i,o,r),YY(i,o,c),eee(i,o),t}function XY(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function ZY(i){const e=new rB(i.featureTableJson,i.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,i.featuresLength=t,i.pointsLength=t,i.pointCount=t,i.rtcCenter=e.getGlobalProperty("RTC_CENTER",Qn.FLOAT,3);const r=tee(i,e);return{featureTable:e,batchTable:r}}function JY(i,e,t){if(!i.attributes.positions){if(e.hasProperty("POSITION"))i.attributes.positions=e.getPropertyArray("POSITION",Qn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Qn.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Qn.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Qn.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=$Y(i,r,t)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function YY(i,e,t){if(!i.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Qn.UNSIGNED_BYTE,4),i.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Qn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Qn.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=IP(i,r,t)}e.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Qn.UNSIGNED_BYTE,4))}function eee(i,e){if(!i.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Qn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Qn.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=qY(i,t)}}function tee(i,e){let t=null;if(!i.batchIds&&e.hasProperty("BATCH_ID")&&(i.batchIds=e.getPropertyArray("BATCH_ID",Qn.UNSIGNED_SHORT,1),i.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=i;t=new SP(n,o,r)}return t}async function iee(i,e,t,r,n){let o,c,s;const m=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];m&&(s=m.properties);const x=e.getExtension("3DTILES_draco_point_compression");if(x){c=x.properties;const F=x.byteOffset,O=x.byteLength;if(!c||!Number.isFinite(F)||!O)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=i.featureTableBinary.slice(F,F+O),i.hasPositions=Number.isFinite(c.POSITION),i.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),i.hasNormals=Number.isFinite(c.NORMAL),i.hasBatchIds=Number.isFinite(c.BATCH_ID),i.isTranslucent=Number.isFinite(c.RGBA)}if(!o)return!0;const I={buffer:o,properties:{...c,...s},featureTableProperties:c,batchTableProperties:s,dequantizeInShader:!1};return await ree(i,I,r,n)}async function ree(i,e,t,r){const{parse:n}=r,o={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const c=await n(e.buffer,QM,o),s=c.attributes.POSITION&&c.attributes.POSITION.value,m=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,x=c.attributes.NORMAL&&c.attributes.NORMAL.value,I=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,F=s&&c.attributes.POSITION.value.quantization,O=x&&c.attributes.NORMAL.value.quantization;if(F){const ie=c.POSITION.data.quantization,ne=ie.range;i.quantizedVolumeScale=new Ut(ne,ne,ne),i.quantizedVolumeOffset=new Ut(ie.minValues),i.quantizedRange=(1<<ie.quantizationBits)-1,i.isQuantizedDraco=!0}O&&(i.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const z={};if(e.batchTableProperties)for(const ie of Object.keys(e.batchTableProperties))c.attributes[ie]&&c.attributes[ie].value&&(z[ie.toLowerCase()]=c.attributes[ie].value);i.attributes={positions:s,colors:IP(i,m,void 0),normals:x,batchIds:I,...z}}const aB={URI:0,EMBEDDED:1};function MP(i,e,t,r){i.rotateYtoZ=!0;const n=i.byteOffset+i.byteLength-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=Cx(e,t,n),i.gltfByteOffset=0,i.gltfByteLength=n,t%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function PP(i,e,t,r){const n=t["3d-tiles"]||{};if(nee(i,e),n.loadGLTF){const{parse:o,fetch:c}=r;i.gltfUrl&&(i.gltfArrayBuffer=await c(i.gltfUrl,t),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await o(i.gltfArrayBuffer,oy,t,r),i.gpuMemoryUsageInBytes=OM(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function nee(i,e,t){switch(e){case aB.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),o=new TextDecoder().decode(r);i.gltfUrl=o.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case aB.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function see(i,e,t,r,n){var o;t=oee(i,e,t,r),await PP(i,aB.EMBEDDED,r,n);const c=i==null||(o=i.gltf)===null||o===void 0?void 0:o.extensions;return c&&c.CESIUM_RTC&&(i.rtcCenter=c.CESIUM_RTC.center),t}function oee(i,e,t,r,n){t=h1(i,e,t),t=sB(i,e,t),t=oB(i,e,t),t=MP(i,e,t,r);const o=new rB(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",Qn.FLOAT,3),t}async function aee(i,e,t,r,n){return t=lee(i,e,t,r),await PP(i,i.gltfFormat,r,n),t}function lee(i,e,t,r,n){if(t=h1(i,e,t),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));t=sB(i,e,t);const o=new DataView(e);if(i.gltfFormat=o.getUint32(t,!0),t+=4,t=oB(i,e,t),t=MP(i,e,t,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new rB(i.featureTableJson,i.featureTableBinary),s=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=c.getGlobalProperty("RTC_CENTER",Qn.FLOAT,3);const m=new SP(i.batchTableJson,i.batchTableBinary,s);return cee(i,c,m,s),t}function cee(i,e,t,r){const o={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,c=new Ut;new Ut,new Ut,new Ut;const s=new xo,m=new zm,x=new Ut,I={},F=new Bn,O=[],z=[],ie=new Ut,ne=new Ut;for(let ue=0;ue<r;ue++){let ce;if(e.hasProperty("POSITION"))ce=e.getProperty("POSITION",Qn.FLOAT,3,ue,c);else if(e.hasProperty("POSITION_QUANTIZED")){ce=e.getProperty("POSITION_QUANTIZED",Qn.UNSIGNED_SHORT,3,ue,c);const $e=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Qn.FLOAT,3,ie);if(!$e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ue=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Qn.FLOAT,3,ne);if(!Ue)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const lt=65535;for(let nt=0;nt<3;nt++)ce[nt]=ce[nt]/lt*Ue[nt]+$e[nt]}if(!ce)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(c.copy(ce),I.translation=c,i.normalUp=e.getProperty("NORMAL_UP",Qn.FLOAT,3,ue,O),i.normalRight=e.getProperty("NORMAL_RIGHT",Qn.FLOAT,3,ue,z),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Qn.UNSIGNED_SHORT,2,O),i.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Qn.UNSIGNED_SHORT,2,z),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(lo.WGS84.eastNorthUpToFixedFrame(c,F),F.getRotationMatrix3(s)):s.identity()}m.fromMatrix3(s),I.rotation=m,x.set(1,1,1);const de=e.getProperty("SCALE",Qn.FLOAT,1,ue);Number.isFinite(de)&&x.multiplyByScalar(de);const be=e.getProperty("SCALE_NON_UNIFORM",Qn.FLOAT,3,ue,O);be&&x.scale(be),I.scale=x;let Te=e.getProperty("BATCH_ID",Qn.UNSIGNED_SHORT,1,ue);Te===void 0&&(Te=ue);const je=new Bn().fromQuaternion(I.rotation);F.identity(),F.translate(I.translation),F.multiplyRight(je),F.scale(I.scale);const Ge=F.clone();o[ue]={modelMatrix:Ge,batchId:Te}}i.instances=o}async function uee(i,e,t,r,n,o){t=h1(i,e,t);const c=new DataView(e);for(i.tilesLength=c.getUint32(t,!0),t+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-t>12;){const s={};i.tiles.push(s),t=await o(e,t,r,n,s)}return t}async function hee(i,e,t,r){i.rotateYtoZ=!0,i.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=r;i.gltf=await n(e,oy,t,r),i.gpuMemoryUsageInBytes=OM(i.gltf)}async function FP(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=e,n.type=SY(i,e),n.type){case ly.COMPOSITE:return await uee(n,i,e,t,r,FP);case ly.BATCHED_3D_MODEL:return await see(n,i,e,t,r);case ly.GLTF:return await hee(n,i,t,r);case ly.INSTANCED_3D_MODEL:return await aee(n,i,e,t,r);case ly.POINT_CLOUD:return await WY(n,i,e,t,r);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const Aee=1952609651,dee=1;async function fee(i,e,t){if(new Uint32Array(i.slice(0,4))[0]!==Aee)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==dee)throw new Error("Wrong subtree file verson, must be 1");const o=DP(i.slice(8,16)),c=new Uint8Array(i,24,o),m=new TextDecoder("utf8").decode(c),x=JSON.parse(m),I=DP(i.slice(16,24));let F=new ArrayBuffer(0);return I&&(F=i.slice(24+o)),"bufferView"in x.tileAvailability&&(x.tileAvailability.explicitBitstream=await lB(x,"tileAvailability",F,t)),"bufferView"in x.contentAvailability&&(x.contentAvailability.explicitBitstream=await lB(x,"contentAvailability",F,t)),"bufferView"in x.childSubtreeAvailability&&(x.childSubtreeAvailability.explicitBitstream=await lB(x,"childSubtreeAvailability",F,t)),x}function pee(i,e){if(e.startsWith("http")){const o=new URL(i,e);return decodeURI(o.toString())}const r="http://".concat(e),n=new URL(i,r);return"/".concat(n.host).concat(n.pathname)}async function lB(i,e,t,r){const n=i[e].bufferView,o=i.bufferViews[n],c=i.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(c.uri){const s=pee(c.uri,r==null?void 0:r.url),x=await(await r.fetch(s)).arrayBuffer();return new Uint8Array(x,o.byteOffset,o.byteLength)}return new Uint8Array(t,o.byteOffset,o.byteLength)}function DP(i){const e=new DataView(i),t=e.getUint32(0,!0),r=e.getUint32(4,!0);return t+2**32*r}const RP={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:xP,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:fee,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var xu=null;try{xu=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function fs(i,e,t){this.low=i|0,this.high=e|0,this.unsigned=!!t}fs.prototype.__isLong__,Object.defineProperty(fs.prototype,"__isLong__",{value:!0});function Bl(i){return(i&&i.__isLong__)===!0}function kP(i){var e=Math.clz32(i&-i);return i?31-e:e}fs.isLong=Bl;var OP={},UP={};function uf(i,e){var t,r,n;return e?(i>>>=0,(n=0<=i&&i<256)&&(r=UP[i],r)?r:(t=Xn(i,0,!0),n&&(UP[i]=t),t)):(i|=0,(n=-128<=i&&i<128)&&(r=OP[i],r)?r:(t=Xn(i,i<0?-1:0,!1),n&&(OP[i]=t),t))}fs.fromInt=uf;function wu(i,e){if(isNaN(i))return e?vA:Ju;if(e){if(i<0)return vA;if(i>=zP)return jP}else{if(i<=-QP)return Bc;if(i+1>=QP)return GP}return i<0?wu(-i,e).neg():Xn(i%eg|0,i/eg|0,e)}fs.fromNumber=wu;function Xn(i,e,t){return new fs(i,e,t)}fs.fromBits=Xn;var A1=Math.pow;function cB(i,e,t){if(i.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return e?vA:Ju;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return cB(i.substring(1),e,t).neg();for(var n=wu(A1(t,8)),o=Ju,c=0;c<i.length;c+=8){var s=Math.min(8,i.length-c),m=parseInt(i.substring(c,c+s),t);if(s<8){var x=wu(A1(t,s));o=o.mul(x).add(wu(m))}else o=o.mul(n),o=o.add(wu(m))}return o.unsigned=e,o}fs.fromString=cB;function Zu(i,e){return typeof i=="number"?wu(i,e):typeof i=="string"?cB(i,e):Xn(i.low,i.high,typeof e=="boolean"?e:i.unsigned)}fs.fromValue=Zu;var NP=65536,gee=1<<24,eg=NP*NP,zP=eg*eg,QP=zP/2,VP=uf(gee),Ju=uf(0);fs.ZERO=Ju;var vA=uf(0,!0);fs.UZERO=vA;var tg=uf(1);fs.ONE=tg;var HP=uf(1,!0);fs.UONE=HP;var uB=uf(-1);fs.NEG_ONE=uB;var GP=Xn(-1,2147483647,!1);fs.MAX_VALUE=GP;var jP=Xn(-1,-1,!0);fs.MAX_UNSIGNED_VALUE=jP;var Bc=Xn(0,-2147483648,!1);fs.MIN_VALUE=Bc;var Di=fs.prototype;Di.toInt=function(){return this.unsigned?this.low>>>0:this.low},Di.toNumber=function(){return this.unsigned?(this.high>>>0)*eg+(this.low>>>0):this.high*eg+(this.low>>>0)},Di.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Bc)){var t=wu(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=wu(A1(e,6),this.unsigned),c=this,s="";;){var m=c.div(o),x=c.sub(m.mul(o)).toInt()>>>0,I=x.toString(e);if(c=m,c.isZero())return I+s;for(;I.length<6;)I="0"+I;s=""+I+s}},Di.getHighBits=function(){return this.high},Di.getHighBitsUnsigned=function(){return this.high>>>0},Di.getLowBits=function(){return this.low},Di.getLowBitsUnsigned=function(){return this.low>>>0},Di.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Bc)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},Di.isZero=function(){return this.high===0&&this.low===0},Di.eqz=Di.isZero,Di.isNegative=function(){return!this.unsigned&&this.high<0},Di.isPositive=function(){return this.unsigned||this.high>=0},Di.isOdd=function(){return(this.low&1)===1},Di.isEven=function(){return(this.low&1)===0},Di.equals=function(e){return Bl(e)||(e=Zu(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Di.eq=Di.equals,Di.notEquals=function(e){return!this.eq(e)},Di.neq=Di.notEquals,Di.ne=Di.notEquals,Di.lessThan=function(e){return this.comp(e)<0},Di.lt=Di.lessThan,Di.lessThanOrEqual=function(e){return this.comp(e)<=0},Di.lte=Di.lessThanOrEqual,Di.le=Di.lessThanOrEqual,Di.greaterThan=function(e){return this.comp(e)>0},Di.gt=Di.greaterThan,Di.greaterThanOrEqual=function(e){return this.comp(e)>=0},Di.gte=Di.greaterThanOrEqual,Di.ge=Di.greaterThanOrEqual,Di.compare=function(e){if(Bl(e)||(e=Zu(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Di.comp=Di.compare,Di.negate=function(){return!this.unsigned&&this.eq(Bc)?Bc:this.not().add(tg)},Di.neg=Di.negate,Di.add=function(e){Bl(e)||(e=Zu(e));var t=this.high>>>16,r=this.high&65535,n=this.low>>>16,o=this.low&65535,c=e.high>>>16,s=e.high&65535,m=e.low>>>16,x=e.low&65535,I=0,F=0,O=0,z=0;return z+=o+x,O+=z>>>16,z&=65535,O+=n+m,F+=O>>>16,O&=65535,F+=r+s,I+=F>>>16,F&=65535,I+=t+c,I&=65535,Xn(O<<16|z,I<<16|F,this.unsigned)},Di.subtract=function(e){return Bl(e)||(e=Zu(e)),this.add(e.neg())},Di.sub=Di.subtract,Di.multiply=function(e){if(this.isZero())return this;if(Bl(e)||(e=Zu(e)),xu){var t=xu.mul(this.low,this.high,e.low,e.high);return Xn(t,xu.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?vA:Ju;if(this.eq(Bc))return e.isOdd()?Bc:Ju;if(e.eq(Bc))return this.isOdd()?Bc:Ju;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(VP)&&e.lt(VP))return wu(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,c=this.low&65535,s=e.high>>>16,m=e.high&65535,x=e.low>>>16,I=e.low&65535,F=0,O=0,z=0,ie=0;return ie+=c*I,z+=ie>>>16,ie&=65535,z+=o*I,O+=z>>>16,z&=65535,z+=c*x,O+=z>>>16,z&=65535,O+=n*I,F+=O>>>16,O&=65535,O+=o*x,F+=O>>>16,O&=65535,O+=c*m,F+=O>>>16,O&=65535,F+=r*I+n*x+o*m+c*s,F&=65535,Xn(z<<16|ie,F<<16|O,this.unsigned)},Di.mul=Di.multiply,Di.divide=function(e){if(Bl(e)||(e=Zu(e)),e.isZero())throw Error("division by zero");if(xu){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?xu.div_u:xu.div_s)(this.low,this.high,e.low,e.high);return Xn(t,xu.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?vA:Ju;var r,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return vA;if(e.gt(this.shru(1)))return HP;o=vA}else{if(this.eq(Bc)){if(e.eq(tg)||e.eq(uB))return Bc;if(e.eq(Bc))return tg;var c=this.shr(1);return r=c.div(e).shl(1),r.eq(Ju)?e.isNegative()?tg:uB:(n=this.sub(e.mul(r)),o=r.add(n.div(e)),o)}else if(e.eq(Bc))return this.unsigned?vA:Ju;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Ju}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),m=s<=48?1:A1(2,s-48),x=wu(r),I=x.mul(e);I.isNegative()||I.gt(n);)r-=m,x=wu(r,this.unsigned),I=x.mul(e);x.isZero()&&(x=tg),o=o.add(x),n=n.sub(I)}return o},Di.div=Di.divide,Di.modulo=function(e){if(Bl(e)||(e=Zu(e)),xu){var t=(this.unsigned?xu.rem_u:xu.rem_s)(this.low,this.high,e.low,e.high);return Xn(t,xu.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Di.mod=Di.modulo,Di.rem=Di.modulo,Di.not=function(){return Xn(~this.low,~this.high,this.unsigned)},Di.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Di.clz=Di.countLeadingZeros,Di.countTrailingZeros=function(){return this.low?kP(this.low):kP(this.high)+32},Di.ctz=Di.countTrailingZeros,Di.and=function(e){return Bl(e)||(e=Zu(e)),Xn(this.low&e.low,this.high&e.high,this.unsigned)},Di.or=function(e){return Bl(e)||(e=Zu(e)),Xn(this.low|e.low,this.high|e.high,this.unsigned)},Di.xor=function(e){return Bl(e)||(e=Zu(e)),Xn(this.low^e.low,this.high^e.high,this.unsigned)},Di.shiftLeft=function(e){return Bl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Xn(0,this.low<<e-32,this.unsigned)},Di.shl=Di.shiftLeft,Di.shiftRight=function(e){return Bl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Xn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Di.shr=Di.shiftRight,Di.shiftRightUnsigned=function(e){return Bl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Xn(this.high,0,this.unsigned):Xn(this.high>>>e-32,0,this.unsigned)},Di.shru=Di.shiftRightUnsigned,Di.shr_u=Di.shiftRightUnsigned,Di.rotateLeft=function(e){var t;return Bl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Xn(this.high,this.low,this.unsigned):e<32?(t=32-e,Xn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Xn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Di.rotl=Di.rotateLeft,Di.rotateRight=function(e){var t;return Bl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Xn(this.high,this.low,this.unsigned):e<32?(t=32-e,Xn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Xn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Di.rotr=Di.rotateRight,Di.toSigned=function(){return this.unsigned?Xn(this.low,this.high,!1):this},Di.toUnsigned=function(){return this.unsigned?this:Xn(this.low,this.high,!0)},Di.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Di.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Di.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},fs.fromBytes=function(e,t,r){return r?fs.fromBytesLE(e,t):fs.fromBytesBE(e,t)},fs.fromBytesLE=function(e,t){return new fs(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},fs.fromBytesBE=function(e,t){return new fs(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const mee=16;function qP(i){i==="X"&&(i="");const e=i.padEnd(mee,"0");return fs.fromString(e,!0,16)}function yee(i){if(i.isZero())return"X";let e=i.countTrailingZeros();const t=e%4;e=(e-t)/4;const r=e;e*=4;const o=i.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-o.length).join("0")+o}function _ee(i,e){const t=vee(i).shiftRightUnsigned(2);return i.add(fs.fromNumber(2*e+1-4).multiply(t))}function vee(i){return i.and(i.not().add(1))}const bee=3,xee=2*30+1,$P=180/Math.PI;function wee(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const e=i.split("/"),t=parseInt(e[0],10),r=e[1],n=r.length;let o=0;const c=[0,0];for(let s=n-1;s>=0;s--){o=n-s;const m=r[s];let x=0,I=0;m==="1"?I=1:m==="2"?(x=1,I=1):m==="3"&&(x=1);const F=Math.pow(2,o-1);Cee(F,c,x,I),c[0]+=F*x,c[1]+=F*I}if(t%2===1){const s=c[0];c[0]=c[1],c[1]=s}return{face:t,ij:c,level:o}}function Bee(i){if(i.isZero())return"";let e=i.toString(2);for(;e.length<bee+xee;)e="0"+e;const t=e.lastIndexOf("1"),r=e.substring(0,3),n=e.substring(3,t),o=n.length/2,c=fs.fromString(r,!0,2).toString(10);let s="";if(o!==0)for(s=fs.fromString(n,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(c,"/").concat(s)}function KP(i,e,t){const r=1<<e;return[(i[0]+t[0])/r,(i[1]+t[1])/r]}function WP(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function XP(i){return[WP(i[0]),WP(i[1])]}function ZP(i,e){let[t,r]=e;switch(i){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function JP(i){let[e,t,r]=i;const n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*$P,n*$P]}function Cee(i,e,t,r){if(r===0){t===1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function Eee(i){const e=KP(i.ij,i.level,[.5,.5]),t=XP(e),r=ZP(i.face,t);return JP(r)}const See=100;function YP(i){const{face:e,ij:t,level:r}=i,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(See*Math.pow(2,-r))),c=new Float64Array(4*o*2+2);let s=0,m=0;for(let x=0;x<4;x++){const I=n[x].slice(0),F=n[x+1],O=(F[0]-I[0])/o,z=(F[1]-I[1])/o;for(let ie=0;ie<o;ie++){I[0]+=O,I[1]+=z;const ne=KP(t,r,I),ue=XP(ne),ce=ZP(e,ue),de=JP(ce);Math.abs(de[1])>89.999&&(de[0]=m);const be=de[0]-m;de[0]+=be>180?-360:be<-180?360:0,c[s++]=de[0],c[s++]=de[1],m=de[0]}}return c[s++]=c[0],c[s++]=c[1],c}function hB(i){const e=Tee(i);return wee(e)}function Tee(i){if(i.indexOf("/")>0)return i;const e=qP(i);return Bee(e)}function Iee(i){const e=hB(i);return Eee(e)}function Lee(i){let e;if(i.face===2||i.face===5){let t=null,r=0;for(let n=0;n<4;n++){const o="".concat(i.face,"/").concat(n),c=hB(o),s=YP(c);(typeof t>"u"||t===null)&&(t=new Float64Array(4*s.length)),t.set(s,r),r+=s.length}e=eF(t)}else{const t=YP(i);e=eF(t)}return e}function eF(i){if(i.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let r=0;r<i.length;r+=2)e.push(i[r]),t.push(i[r+1]);return e.sort((r,n)=>r-n),t.sort((r,n)=>r-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function Mee(i,e){const t=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,n=hB(i),o=Lee(n),c=o.west,s=o.south,m=o.east,x=o.north,I=[];return I.push(new Ut(c,x,t)),I.push(new Ut(m,x,t)),I.push(new Ut(m,s,t)),I.push(new Ut(c,s,t)),I.push(new Ut(c,x,r)),I.push(new Ut(m,x,r)),I.push(new Ut(m,s,r)),I.push(new Ut(c,s,r)),I}function tF(i){const e=i.token,t={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=Mee(e,t),n=Iee(e),o=n[0],c=n[1],s=lo.WGS84.cartographicToCartesian([o,c,t.maximumHeight]),m=new Ut(s[0],s[1],s[2]);r.push(m);const x=uW(r);return[...x.center,...x.halfAxes]}const Pee={QUADTREE:4,OCTREE:8};function Fee(i,e,t){if(i!=null&&i.box){const r=qP(i.s2VolumeInfo.token),n=_ee(r,e),o=yee(n),c={...i.s2VolumeInfo};switch(c.token=o,t){case"OCTREE":const x=i.s2VolumeInfo,I=x.maximumHeight-x.minimumHeight,F=I/2,O=x.minimumHeight+I/2;x.minimumHeight=O-F,x.maximumHeight=O+F;break}return{box:tF(c),s2VolumeInfo:c}}}async function iF(i){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=i;let{subtree:c,level:s=0}=i;const{subdivisionScheme:m,subtreeLevels:x,maximumLevel:I,contentUrlTemplate:F,subtreesUriTemplate:O,basePath:z}=e,ie={children:[],lodMetricValue:0,contentUrl:""},ne=Pee[m],ue=r&1,ce=r>>1&1,de=r>>2&1,be=(ne**s-1)/(ne-1);let Te=hf(t.mortonIndex,r),je=be+Te,Ge=hf(t.x,ue),$e=hf(t.y,ce),Ue=hf(t.z,de),lt=!1;s+1>x&&(lt=AB(c.childSubtreeAvailability,Te));const nt=hf(n.x,Ge),De=hf(n.y,$e),Fe=hf(n.z,Ue),Je=s+n.level;if(lt){const _t="".concat(z,"/").concat(O),Ft=dB(_t,Je,nt,De,Fe);c=await HA(Ft,RP),n.mortonIndex=Te,n.x=Ge,n.y=$e,n.z=Ue,n.level=s,Te=0,je=0,Ge=0,$e=0,Ue=0,s=0}if(!AB(c.tileAvailability,je)||s>I)return ie;AB(c.contentAvailability,je)&&(ie.contentUrl=dB(F,Je,nt,De,Fe));const Ct=s+1,Lt={mortonIndex:Te,x:Ge,y:$e,z:Ue};for(let _t=0;_t<ne;_t++){const Ft=Fee(o,_t,m),Mt=await iF({subtree:c,options:e,parentData:Lt,childIndex:_t,level:Ct,globalData:n,s2VolumeBox:Ft});if(Mt.contentUrl||Mt.children.length){const Wt=Je+1,Xe=Dee(Mt,Wt,{childTileX:Ge,childTileY:$e,childTileZ:Ue},e,o);ie.children.push(Xe)}}return ie}function AB(i,e){return"constant"in i?!!i.constant:i.explicitBitstream?Oee(e,i.explicitBitstream):!1}function Dee(i,e,t,r,n){const{basePath:o,refine:c,getRefine:s,lodMetricType:m,getTileType:x,rootLodMetricValue:I,rootBoundingVolume:F}=r,O=i.contentUrl&&i.contentUrl.replace("".concat(o,"/"),""),z=I/2**e,ie=n!=null&&n.box?{box:n.box}:F,ne=Ree(e,ie,t);return{children:i.children,contentUrl:i.contentUrl,content:{uri:O},id:i.contentUrl,refine:s(c),type:x(i),lodMetricType:m,lodMetricValue:z,geometricError:z,transform:i.transform,boundingVolume:ne}}function Ree(i,e,t){if(e.region){const{childTileX:r,childTileY:n,childTileZ:o}=t,[c,s,m,x,I,F]=e.region,O=2**i,z=(m-c)/O,ie=(x-s)/O,ne=(F-I)/O,[ue,ce]=[c+z*r,c+z*(r+1)],[de,be]=[s+ie*n,s+ie*(n+1)],[Te,je]=[I+ne*o,I+ne*(o+1)];return{region:[ue,de,ce,be,Te,je]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function hf(i,e){return parseInt(i.toString(2)+e.toString(2),2)}function dB(i,e,t,r,n){const o=kee({level:e,x:t,y:r,z:n});return i.replace(/{level}|{x}|{y}|{z}/gi,c=>o[c])}function kee(i){const e={};for(const t in i)e["{".concat(t,"}")]=i[t];return e}function Oee(i,e){const t=Math.floor(i/8),r=i%8;return(e[t]>>r&1)===1}function fB(i){if(!i.contentUrl)return Jp.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Jp.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Jp.SCENEGRAPH;default:return t}}function pB(i){switch(i){case"REPLACE":case"replace":return _A.REPLACE;case"ADD":case"add":return _A.ADD;default:return i}}function gB(i,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(i,"".concat(e,"/"));return decodeURI(r.toString())}else if(i.startsWith("/"))return i;return"".concat(e,"/").concat(i)}function rF(i,e){if(!i)return null;if(i.content){const t=i.content.uri||i.content.url;i.contentUrl=gB(t,e.basePath)}return i.id=i.contentUrl,i.lodMetricType=o1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=fB(i),i.refine=pB(i.refine),i}async function Uee(i,e){const t=i.basePath;let r;const n=sF(i==null?void 0:i.root);n&&i.root?r=await nF(i.root,i,n,e):r=rF(i.root,i);const o=[];for(o.push(r);o.length>0;){const s=(o.pop()||{}).children||[];for(let m of s){const x=sF(m);x?m=await nF(m,i,x,e):rF(m,{basePath:t}),o.push(m)}}return r}async function nF(i,e,t,r){var n,o;const c=e.basePath,{subdivisionScheme:s,maximumLevel:m,subtreeLevels:x,subtrees:{uri:I}}=t,F=dB(I,0,0,0,0),O=gB(F,c),z=await HA(O,RP,r),ie=gB(i.content.uri,c),ne=e==null||(n=e.root)===null||n===void 0?void 0:n.refine,ue=i.geometricError,ce=(o=i.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(ce){const je={box:tF(ce),s2VolumeInfo:ce};i.boundingVolume=je}const de=i.boundingVolume,be={contentUrlTemplate:ie,subtreesUriTemplate:I,subdivisionScheme:s,subtreeLevels:x,maximumLevel:m,refine:ne,basePath:c,lodMetricType:o1.GEOMETRIC_ERROR,rootLodMetricValue:ue,rootBoundingVolume:de,getTileType:fB,getRefine:pB};return await Nee(i,z,be)}async function Nee(i,e,t){if(!i)return null;i.lodMetricType=o1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:n}=await iF({subtree:e,options:t,s2VolumeBox:i});return n&&(i.contentUrl=n,i.content={uri:n.replace("".concat(t.basePath,"/"),"")}),i.refine=pB(i.refine),i.type=fB(i),i.children=r,i.id=i.contentUrl,i}function sF(i){var e;return(i==null||(e=i.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const mB={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:xP,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Hee,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function zee(i){return Ex(i.url)}async function Qee(i,e,t){const r={content:{featureIds:null}};return await FP(i,0,e,t,r.content),r.content}async function Vee(i,e,t){var r;const n=JSON.parse(new TextDecoder().decode(i));return n.loader=e.loader||mB,n.url=t.url,n.queryString=t.queryString,n.basePath=zee(n),n.root=await Uee(n,e),n.type=bu.TILES3D,n.lodMetricType=o1.GEOMETRIC_ERROR,n.lodMetricValue=((r=n.root)===null||r===void 0?void 0:r.lodMetricValue)||0,n}async function Hee(i,e,t){const r=e["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=t.url&&t.url.indexOf(".json")!==-1:n=r.isTileset,n?i=await Vee(i,e,t):i=await Qee(i,e,t),i}const oF=[0],Gee={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:mB,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,e,t)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class yB extends HL{constructor(){super(...arguments),ye(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Dn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:r,changeFlags:n}=e;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const c in o)o[c].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=r==null?void 0:r[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:r}=e;const n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer(e){let{layer:t,viewport:r}=e;const{tile:n}=t.props,{id:o}=r;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(e){const t=e.sourceTile,r=this.state.layerMap[t==null?void 0:t.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};let o=e;if(r.preload){const m=await r.preload(e,t);m.url&&(o=m.url),m.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:m.headers}),Object.assign(n,m)}const c=await HA(o,r,n.loadOptions),s=new EY(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:r}=this.context,n=Object.keys(e).length;!r||!n||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Jp.POINTCLOUD:return this._makePointCloudLayer(e,t);case Jp.SCENEGRAPH:return this._make3DModelLayer(e);case Jp.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:r,pointCount:n,constantRGBA:o,cartographicOrigin:c,modelMatrix:s}=e.content,{positions:m,normals:x,colors:I}=r;if(!m)return null;const F=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:m,NORMAL:x,COLOR_0:I}},{pointSize:O,getPointColor:z}=this.props,ie=this.getSubLayerClass("pointcloud",x2);return new ie({pointSize:O},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:F,coordinateSystem:Ln.METER_OFFSETS,coordinateOrigin:c,modelMatrix:s,getColor:o||z,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:r,cartographicOrigin:n,modelMatrix:o}=e.content,c=this.getSubLayerClass("scenegraph",Q2);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||oF,scenegraph:t,coordinateSystem:Ln.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const r=e.content,{attributes:n,indices:o,modelMatrix:c,cartographicOrigin:s,coordinateSystem:m=Ln.METER_OFFSETS,material:x,featureIds:I}=r,{_getMeshColor:F}=this.props,O=t&&t.props.mesh||new Hm({drawMode:4,attributes:jee(n),indices:o}),z=this.getSubLayerClass("mesh",V2);return new z(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:O,data:oF,getColor:F(e),pbrMaterial:x,modelMatrix:c,coordinateOrigin:s,coordinateSystem:m,featureIds:I,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(r=>{const n=t[r.id]=t[r.id]||{tile:r};let{layer:o}=n;return r.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(r,o),n.needsUpdate=!1):o=this._getSubLayer(r)),n.layer=o,o}).filter(Boolean):null}}ye(yB,"defaultProps",Gee),ye(yB,"layerName","Tile3DLayer");function jee(i){const e={};return e.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(e.normals=i.normals),i.texCoords&&(e.texCoords=i.texCoords),i.colors&&(e.colors=i.colors),i.uvRegions&&(e.uvRegions=i.uvRegions),e}var aF={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(Kd,function(){var t,r,n;function o(s,m){if(!t)t=m;else if(!r)r=m;else{var x="var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk);",I={};t(I),n=m(I),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}o(["exports"],function(s){function m(h,l,f,v){return new(f||(f=Promise))(function(E,M){function D(X){try{$(v.next(X))}catch(se){M(se)}}function G(X){try{$(v.throw(X))}catch(se){M(se)}}function $(X){var se;X.done?E(X.value):(se=X.value,se instanceof f?se:new f(function(Ae){Ae(se)})).then(D,G)}$((v=v.apply(h,l||[])).next())})}function x(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var I=F;function F(h,l){this.x=h,this.y=l}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,l){return this.clone()._rotateAround(h,l)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var l=h.x-this.x,f=h.y-this.y;return l*l+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,l){return Math.atan2(this.x*l-this.y*h,this.x*h+this.y*l)},_matMult:function(h){var l=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=l,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var l=Math.cos(h),f=Math.sin(h),v=f*this.x+l*this.y;return this.x=l*this.x-f*this.y,this.y=v,this},_rotateAround:function(h,l){var f=Math.cos(h),v=Math.sin(h),E=l.y+v*(this.x-l.x)+f*(this.y-l.y);return this.x=l.x+f*(this.x-l.x)-v*(this.y-l.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(h){return h instanceof F?h:Array.isArray(h)?new F(h[0],h[1]):h};var O=x(I),z=ie;function ie(h,l,f,v){this.cx=3*h,this.bx=3*(f-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(v-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=l,this.p2x=f,this.p2y=v}ie.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,l){if(l===void 0&&(l=1e-6),h<0)return 0;if(h>1)return 1;for(var f=h,v=0;v<8;v++){var E=this.sampleCurveX(f)-h;if(Math.abs(E)<l)return f;var M=this.sampleCurveDerivativeX(f);if(Math.abs(M)<1e-6)break;f-=E/M}var D=0,G=1;for(f=h,v=0;v<20&&(E=this.sampleCurveX(f),!(Math.abs(E-h)<l));v++)h>E?D=f:G=f,f=.5*(G-D)+D;return f},solve:function(h,l){return this.sampleCurveY(this.solveCurveX(h,l))}};var ne=x(z);let ue,ce;function de(){return ue==null&&(ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ue}function be(){if(ce==null&&(ce=!1,de())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let v=0;v<5*5;v++){const E=4*v;l.fillStyle=`rgb(${E},${E+1},${E+2})`,l.fillRect(v%5,Math.floor(v/5),1,1)}const f=l.getImageData(0,0,5,5).data;for(let v=0;v<5*5*4;v++)if(v%4!=3&&f[v]!==v){ce=!0;break}}}return ce||!1}function Te(h,l,f,v){const E=new ne(h,l,f,v);return function(M){return E.solve(M)}}const je=Te(.25,.1,.25,1);function Ge(h,l,f){return Math.min(f,Math.max(l,h))}function $e(h,l,f){const v=f-l,E=((h-l)%v+v)%v+l;return E===l?f:E}function Ue(h){for(var l=arguments.length,f=new Array(l>1?l-1:0),v=1;v<l;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}let lt=1;function nt(h,l,f){const v={};for(const E in h)v[E]=l.call(f||this,h[E],E,h);return v}function De(h,l,f){const v={};for(const E in h)l.call(f||this,h[E],E,h)&&(v[E]=h[E]);return v}function Fe(h){return Array.isArray(h)?h.map(Fe):typeof h=="object"&&h?nt(h,Fe):h}const Je={};function We(h){Je[h]||(typeof console<"u"&&console.warn(h),Je[h]=!0)}function Et(h,l,f){return(f.y-h.y)*(l.x-h.x)>(l.y-h.y)*(f.x-h.x)}function Ct(h){let l=0;for(let f,v,E=0,M=h.length,D=M-1;E<M;D=E++)f=h[E],v=h[D],l+=(v.x-f.x)*(f.y+v.y);return l}function Lt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let _t=null;function Ft(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Mt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Wt(h,l,f,v,E){return m(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const M=new VideoFrame(h,{timestamp:0});try{const D=M==null?void 0:M.format;if(!D||!D.startsWith("BGR")&&!D.startsWith("RGB"))throw new Error(`Unrecognized format ${D}`);const G=D.startsWith("BGR"),$=new Uint8ClampedArray(v*E*4);if(yield M.copyTo($,function(X,se,Ae,me,Be){const Se=4*Math.max(-se,0),ke=(Math.max(0,Ae)-Ae)*me*4+Se,He=4*me,qe=Math.max(0,se),ct=Math.max(0,Ae);return{rect:{x:qe,y:ct,width:Math.min(X.width,se+me)-qe,height:Math.min(X.height,Ae+Be)-ct},layout:[{offset:ke,stride:He}]}}(h,l,f,v,E)),G)for(let X=0;X<$.length;X+=4){const se=$[X];$[X]=$[X+2],$[X+2]=se}return $}finally{M.close()}})}let Ee,Xe,et,At;const ft={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h){const l=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(l)}},getImageData(h){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(h).getImageData(-l,-l,h.width+2*l,h.height+2*l)},getImageCanvasContext(h){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=h.width,l.height=h.height,f.drawImage(h,0,0,h.width,h.height),f},resolveURL:h=>(et||(et=document.createElement("a")),et.href=h,et.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(At==null&&(At=matchMedia("(prefers-reduced-motion: reduce)")),At.matches)}},wt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Pt extends Error{constructor(l,f,v,E){super(`AJAXError: ${f} (${l}): ${v}`),this.status=l,this.statusText=f,this.url=v,this.body=E}}const It=Lt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ht=h=>wt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))];function ii(h,l){const f=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:It(),signal:f.signal});let E=!1,M=!1;return h.type==="json"&&v.headers.set("Accept","application/json"),M||fetch(v).then(D=>D.ok?(G=>{(h.type==="arrayBuffer"||h.type==="image"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then($=>{M||(E=!0,l(null,$,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch($=>{M||l(new Error($.message))})})(D):D.blob().then(G=>l(new Pt(D.status,D.statusText,h.url,G)))).catch(D=>{D.code!==20&&l(new Error(D.message))}),{cancel:()=>{M=!0,E||f.abort()}}}const gi=function(h,l){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,l);if(!Lt())return(Ht(h.url)||ii)(h,l)}if(!(/^file:/.test(f=h.url)||/^file:/.test(It())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ii(h,l);if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,l,void 0,!0)}var f;return function(v,E){const M=new XMLHttpRequest;M.open(v.method||"GET",v.url,!0),v.type!=="arrayBuffer"&&v.type!=="image"||(M.responseType="arraybuffer");for(const D in v.headers)M.setRequestHeader(D,v.headers[D]);return v.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=v.credentials==="include",M.onerror=()=>{E(new Error(M.statusText))},M.onload=()=>{if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let D=M.response;if(v.type==="json")try{D=JSON.parse(M.response)}catch(G){return E(G)}E(null,D,M.getResponseHeader("Cache-Control"),M.getResponseHeader("Expires"))}else{const D=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});E(new Pt(M.status,M.statusText,v.url,D))}},M.send(v.body),{cancel:()=>M.abort()}}(h,l)},mi=function(h,l){return gi(Ue(h,{type:"arrayBuffer"}),l)};function Mi(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const l=new URL(h),f=window.location;return l.protocol===f.protocol&&l.host===f.host}function kt(h,l,f){f[h]&&f[h].indexOf(l)!==-1||(f[h]=f[h]||[],f[h].push(l))}function ot(h,l,f){if(f&&f[h]){const v=f[h].indexOf(l);v!==-1&&f[h].splice(v,1)}}class xt{constructor(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ue(this,f),this.type=l}}class Ri extends xt{constructor(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Ue({error:l},f))}}class ei{on(l,f){return this._listeners=this._listeners||{},kt(l,f,this._listeners),this}off(l,f){return ot(l,f,this._listeners),ot(l,f,this._oneTimeListeners),this}once(l,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},kt(l,f,this._oneTimeListeners),this):new Promise(v=>this.once(l,v))}fire(l,f){typeof l=="string"&&(l=new xt(l,f||{}));const v=l.type;if(this.listens(v)){l.target=this;const E=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const G of E)G.call(this,l);const M=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const G of M)ot(v,G,this._oneTimeListeners),G.call(this,l);const D=this._eventedParent;D&&(Ue(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(l))}else l instanceof Ri&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,f){return this._eventedParent=l,this._eventedParentData=f,this}}var ut={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const jt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ni(h,l){const f={};for(const v in h)v!=="ref"&&(f[v]=h[v]);return jt.forEach(v=>{v in l&&(f[v]=l[v])}),f}function di(h,l){if(Array.isArray(h)){if(!Array.isArray(l)||h.length!==l.length)return!1;for(let f=0;f<h.length;f++)if(!di(h[f],l[f]))return!1;return!0}if(typeof h=="object"&&h!==null&&l!==null){if(typeof l!="object"||Object.keys(h).length!==Object.keys(l).length)return!1;for(const f in h)if(!di(h[f],l[f]))return!1;return!0}return h===l}const li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ki(h,l,f){f.push({command:li.addSource,args:[h,l[h]]})}function tr(h,l,f){l.push({command:li.removeSource,args:[h]}),f[h]=!0}function Ar(h,l,f,v){tr(h,f,v),Ki(h,l,f)}function Er(h,l,f){let v;for(v in h[f])if(Object.prototype.hasOwnProperty.call(h[f],v)&&v!=="data"&&!di(h[f][v],l[f][v]))return!1;for(v in l[f])if(Object.prototype.hasOwnProperty.call(l[f],v)&&v!=="data"&&!di(h[f][v],l[f][v]))return!1;return!0}function Nt(h,l,f,v,E,M){let D;for(D in l=l||{},h=h||{})Object.prototype.hasOwnProperty.call(h,D)&&(di(h[D],l[D])||f.push({command:M,args:[v,D,l[D],E]}));for(D in l)Object.prototype.hasOwnProperty.call(l,D)&&!Object.prototype.hasOwnProperty.call(h,D)&&(di(h[D],l[D])||f.push({command:M,args:[v,D,l[D],E]}))}function Ji(h){return h.id}function ci(h,l){return h[l.id]=l,h}class $t{constructor(l,f,v,E){this.message=(l?`${l}: `:"")+v,E&&(this.identifier=E),f!=null&&f.__line__&&(this.line=f.__line__)}}function Zi(h){for(var l=arguments.length,f=new Array(l>1?l-1:0),v=1;v<l;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}class Qt extends Error{constructor(l,f){super(f),this.message=f,this.key=l}}class Bi{constructor(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=l,this.bindings={};for(const[v,E]of f)this.bindings[v]=E}concat(l){return new Bi(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Ii={kind:"null"},Gt={kind:"number"},vi={kind:"string"},Jt={kind:"boolean"},mr={kind:"color"},Sr={kind:"object"},ze={kind:"value"},we={kind:"collator"},oe={kind:"formatted"},Y={kind:"padding"},le={kind:"resolvedImage"},ge={kind:"variableAnchorOffsetCollection"};function _e(h,l){return{kind:"array",itemType:h,N:l}}function Ce(h){if(h.kind==="array"){const l=Ce(h.itemType);return typeof h.N=="number"?`array<${l}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${l}>`}return h.kind}const ve=[Ii,Gt,vi,Jt,mr,oe,Sr,_e(ze),Y,le,ge];function Me(h,l){if(l.kind==="error")return null;if(h.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Me(h.itemType,l.itemType))&&(typeof h.N!="number"||h.N===l.N))return null}else{if(h.kind===l.kind)return null;if(h.kind==="value"){for(const f of ve)if(!Me(f,l))return null}}return`Expected ${Ce(h)} but found ${Ce(l)} instead.`}function Oe(h,l){return l.some(f=>f.kind===h.kind)}function Ve(h,l){return l.some(f=>f==="null"?h===null:f==="array"?Array.isArray(h):f==="object"?h&&!Array.isArray(h)&&typeof h=="object":f===typeof h)}function it(h,l){return h.kind==="array"&&l.kind==="array"?h.itemType.kind===l.itemType.kind&&typeof h.N=="number":h.kind===l.kind}const yt=.96422,Bt=.82521,Yt=4/29,qt=6/29,Kt=3*qt*qt,si=qt*qt*qt,Ci=Math.PI/180,Hi=180/Math.PI;function wi(h){return(h%=360)<0&&(h+=360),h}function Ui(h){let[l,f,v,E]=h,M,D;const G=ti((.2225045*(l=st(l))+.7168786*(f=st(f))+.0606169*(v=st(v)))/1);l===f&&f===v?M=D=G:(M=ti((.4360747*l+.3850649*f+.1430804*v)/yt),D=ti((.0139322*l+.0971045*f+.7141733*v)/Bt));const $=116*G-16;return[$<0?0:$,500*(M-G),200*(G-D),E]}function st(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ti(h){return h>si?Math.pow(h,1/3):h/Kt+Yt}function zt(h){let[l,f,v,E]=h,M=(l+16)/116,D=isNaN(f)?M:M+f/500,G=isNaN(v)?M:M-v/200;return M=1*hr(M),D=yt*hr(D),G=Bt*hr(G),[zi(3.1338561*D-1.6168667*M-.4906146*G),zi(-.9787684*D+1.9161415*M+.033454*G),zi(.0719453*D-.2289914*M+1.4052427*G),E]}function zi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function hr(h){return h>qt?h*h*h:Kt*(h-Yt)}function sn(h){return parseInt(h.padEnd(2,h),16)/255}function bn(h,l){return ur(l?h/100:h,0,1)}function ur(h,l,f){return Math.min(Math.max(l,h),f)}function gn(h){return!h.some(Number.isNaN)}const mn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class lr{constructor(l,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=l,this.g=f,this.b=v,this.a=E,M||(this.r*=E,this.g*=E,this.b*=E,E||this.overwriteGetter("rgb",[l,f,v,E]))}static parse(l){if(l instanceof lr)return l;if(typeof l!="string")return;const f=function(v){if((v=v.toLowerCase().trim())==="transparent")return[0,0,0,0];const E=mn[v];if(E){const[D,G,$]=E;return[D/255,G/255,$/255,1]}if(v.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(v)){const D=v.length<6?1:2;let G=1;return[sn(v.slice(G,G+=D)),sn(v.slice(G,G+=D)),sn(v.slice(G,G+=D)),sn(v.slice(G,G+D)||"ff")]}if(v.startsWith("rgb")){const D=v.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(D){const[G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct]=D,Ye=[se||" ",Be||" ",He].join("");if(Ye==="  "||Ye==="  /"||Ye===",,"||Ye===",,,"){const tt=[X,me,ke].join(""),gt=tt==="%%%"?100:tt===""?255:0;if(gt){const St=[ur(+$/gt,0,1),ur(+Ae/gt,0,1),ur(+Se/gt,0,1),qe?bn(+qe,ct):1];if(gn(St))return St}}return}}const M=v.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[D,G,$,X,se,Ae,me,Be,Se]=M,ke=[$||" ",se||" ",me].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const He=[+G,ur(+X,0,100),ur(+Ae,0,100),Be?bn(+Be,Se):1];if(gn(He))return function(qe){let[ct,Ye,tt,gt]=qe;function St(Xt){const xi=(Xt+ct/30)%12,oi=Ye*Math.min(tt,1-tt);return tt-oi*Math.max(-1,Math.min(xi-3,9-xi,1))}return ct=wi(ct),Ye/=100,tt/=100,[St(0),St(8),St(4),gt]}(He)}}}(l);return f?new lr(...f,!1):void 0}get rgb(){const{r:l,g:f,b:v,a:E}=this,M=E||1/0;return this.overwriteGetter("rgb",[l/M,f/M,v/M,E])}get hcl(){return this.overwriteGetter("hcl",function(l){const[f,v,E,M]=Ui(l),D=Math.sqrt(v*v+E*E);return[Math.round(1e4*D)?wi(Math.atan2(E,v)*Hi):NaN,D,f,M]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ui(this.rgb))}overwriteGetter(l,f){return Object.defineProperty(this,l,{value:f}),f}toString(){const[l,f,v,E]=this.rgb;return`rgba(${[l,f,v].map(M=>Math.round(255*M)).join(",")},${E})`}}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1);class Rn{constructor(l,f,v){this.sensitivity=l?f?"variant":"case":f?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,f){return this.collator.compare(l,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ps{constructor(l,f,v,E,M){this.text=l,this.image=f,this.scale=v,this.fontStack=E,this.textColor=M}}class Qr{constructor(l){this.sections=l}static fromString(l){return new Qr([new ps(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Qr?l:Qr.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class xn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof xn)return l;if(typeof l=="number")return new xn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const f of l)if(typeof f!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new xn(l)}}toString(){return JSON.stringify(this.values)}}const So=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class cs{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof cs)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let f=0;f<l.length;f+=2){const v=l[f],E=l[f+1];if(typeof v!="string"||!So.has(v)||!Array.isArray(E)||E.length!==2||typeof E[0]!="number"||typeof E[1]!="number")return}return new cs(l)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Wi({name:l,available:!1}):null}}function Js(h,l,f,v){return typeof h=="number"&&h>=0&&h<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[h,l,f,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[h,l,f,v]:[h,l,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ws(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof lr||h instanceof Rn||h instanceof Qr||h instanceof xn||h instanceof cs||h instanceof Wi)return!0;if(Array.isArray(h)){for(const l of h)if(!ws(l))return!1;return!0}if(typeof h=="object"){for(const l in h)if(!ws(h[l]))return!1;return!0}return!1}function dr(h){if(h===null)return Ii;if(typeof h=="string")return vi;if(typeof h=="boolean")return Jt;if(typeof h=="number")return Gt;if(h instanceof lr)return mr;if(h instanceof Rn)return we;if(h instanceof Qr)return oe;if(h instanceof xn)return Y;if(h instanceof cs)return ge;if(h instanceof Wi)return le;if(Array.isArray(h)){const l=h.length;let f;for(const v of h){const E=dr(v);if(f){if(f===E)continue;f=ze;break}f=E}return _e(f||ze,l)}return Sr}function Fr(h){const l=typeof h;return h===null?"":l==="string"||l==="number"||l==="boolean"?String(h):h instanceof lr||h instanceof Qr||h instanceof xn||h instanceof cs||h instanceof Wi?h.toString():JSON.stringify(h)}class Vn{constructor(l,f){this.type=l,this.value=f}static parse(l,f){if(l.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!ws(l[1]))return f.error("invalid value");const v=l[1];let E=dr(v);const M=f.expectedType;return E.kind!=="array"||E.N!==0||!M||M.kind!=="array"||typeof M.N=="number"&&M.N!==0||(E=M),new Vn(E,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Or{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Cn={string:vi,number:Gt,boolean:Jt,object:Sr};class An{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let v,E=1;const M=l[0];if(M==="array"){let G,$;if(l.length>2){const X=l[1];if(typeof X!="string"||!(X in Cn)||X==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);G=Cn[X],E++}else G=ze;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return f.error('The length argument to "array" must be a positive integer literal',2);$=l[2],E++}v=_e(G,$)}else{if(!Cn[M])throw new Error(`Types doesn't contain name = ${M}`);v=Cn[M]}const D=[];for(;E<l.length;E++){const G=f.parse(l[E],E,ze);if(!G)return null;D.push(G)}return new An(v,D)}evaluate(l){for(let f=0;f<this.args.length;f++){const v=this.args[f].evaluate(l);if(!Me(this.type,dr(v)))return v;if(f===this.args.length-1)throw new Or(`Expected value to be of type ${Ce(this.type)}, but found ${Ce(dr(v))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const Hr={"to-boolean":Jt,"to-color":mr,"to-number":Gt,"to-string":vi};class Hs{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const v=l[0];if(!Hr[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&l.length!==2)return f.error("Expected one argument.");const E=Hr[v],M=[];for(let D=1;D<l.length;D++){const G=f.parse(l[D],D,ze);if(!G)return null;M.push(G)}return new Hs(E,M)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let f,v;for(const E of this.args){if(f=E.evaluate(l),v=null,f instanceof lr)return f;if(typeof f=="string"){const M=l.parseColor(f);if(M)return M}else if(Array.isArray(f)&&(v=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:Js(f[0],f[1],f[2],f[3]),!v))return new lr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Or(v||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const v of this.args){f=v.evaluate(l);const E=xn.parse(f);if(E)return E}throw new Or(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const v of this.args){f=v.evaluate(l);const E=cs.parse(f);if(E)return E}throw new Or(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const v of this.args){if(f=v.evaluate(l),f===null)return 0;const E=Number(f);if(!isNaN(E))return E}throw new Or(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Qr.fromString(Fr(this.args[0].evaluate(l)));case"resolvedImage":return Wi.fromString(Fr(this.args[0].evaluate(l)));default:return Fr(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let f=this._parseColorCache[l];return f||(f=this._parseColorCache[l]=lr.parse(l)),f}}class Ea{constructor(l,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],E=arguments.length>3?arguments[3]:void 0,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Bi,D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=l,this.path=v,this.key=v.map(G=>`[${G}]`).join(""),this.scope=M,this.errors=D,this.expectedType=E,this._isConstant=f}parse(l,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return f?this.concat(f,v,E)._parse(l,M):this._parse(l,M)}_parse(l,f){function v(E,M,D){return D==="assert"?new An(M,[E]):D==="coerce"?new Hs(M,[E]):E}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const E=l[0];if(typeof E!="string")return this.error(`Expression name must be a string, but found ${typeof E} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const M=this.registry[E];if(M){let D=M.parse(l,this);if(!D)return null;if(this.expectedType){const G=this.expectedType,$=D.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||$.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||$.kind!=="value"&&$.kind!=="string")if(G.kind!=="padding"||$.kind!=="value"&&$.kind!=="number"&&$.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||$.kind!=="value"&&$.kind!=="array"){if(this.checkSubtype(G,$))return null}else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"assert")}if(!(D instanceof Vn)&&D.type.kind!=="resolvedImage"&&this._isConstant(D)){const G=new uo;try{D=new Vn(D.type,D.evaluate(G))}catch($){return this.error($.message),null}}return D}return this.error(`Unknown expression "${E}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,f,v){const E=typeof l=="number"?this.path.concat(l):this.path,M=v?this.scope.concat(v):this.scope;return new Ea(this.registry,this._isConstant,E,f||null,M,this.errors)}error(l){for(var f=arguments.length,v=new Array(f>1?f-1:0),E=1;E<f;E++)v[E-1]=arguments[E];const M=`${this.key}${v.map(D=>`[${D}]`).join("")}`;this.errors.push(new Qt(M,l))}checkSubtype(l,f){const v=Me(l,f);return v&&this.error(v),v}}class Ne{constructor(l,f,v){this.type=we,this.locale=v,this.caseSensitive=l,this.diacriticSensitive=f}static parse(l,f){if(l.length!==2)return f.error("Expected one argument.");const v=l[1];if(typeof v!="object"||Array.isArray(v))return f.error("Collator options argument must be an object.");const E=f.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,Jt);if(!E)return null;const M=f.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,Jt);if(!M)return null;let D=null;return v.locale&&(D=f.parse(v.locale,1,vi),!D)?null:new Ne(E,M,D)}evaluate(l){return new Rn(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}const Ze=8192;function dt(h,l){h[0]=Math.min(h[0],l[0]),h[1]=Math.min(h[1],l[1]),h[2]=Math.max(h[2],l[0]),h[3]=Math.max(h[3],l[1])}function Ot(h,l){return!(h[0]<=l[0]||h[2]>=l[2]||h[1]<=l[1]||h[3]>=l[3])}function ui(h,l){const f=(180+h[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,E=Math.pow(2,l.z);return[Math.round(f*E*Ze),Math.round(v*E*Ze)]}function Gi(h,l,f){const v=h[0]-l[0],E=h[1]-l[1],M=h[0]-f[0],D=h[1]-f[1];return v*D-M*E==0&&v*M<=0&&E*D<=0}function br(h,l){let f=!1;for(let D=0,G=l.length;D<G;D++){const $=l[D];for(let X=0,se=$.length;X<se-1;X++){if(Gi(h,$[X],$[X+1]))return!1;(E=$[X])[1]>(v=h)[1]!=(M=$[X+1])[1]>v[1]&&v[0]<(M[0]-E[0])*(v[1]-E[1])/(M[1]-E[1])+E[0]&&(f=!f)}}var v,E,M;return f}function En(h,l){for(let f=0;f<l.length;f++)if(br(h,l[f]))return!0;return!1}function kn(h,l,f,v){const E=v[0]-f[0],M=v[1]-f[1],D=(h[0]-f[0])*M-E*(h[1]-f[1]),G=(l[0]-f[0])*M-E*(l[1]-f[1]);return D>0&&G<0||D<0&&G>0}function is(h,l,f){for(const X of f)for(let se=0;se<X.length-1;++se)if((G=[(D=X[se+1])[0]-(M=X[se])[0],D[1]-M[1]])[0]*($=[(E=l)[0]-(v=h)[0],E[1]-v[1]])[1]-G[1]*$[0]!=0&&kn(v,E,M,D)&&kn(M,D,v,E))return!0;var v,E,M,D,G,$;return!1}function wn(h,l){for(let f=0;f<h.length;++f)if(!br(h[f],l))return!1;for(let f=0;f<h.length-1;++f)if(is(h[f],h[f+1],l))return!1;return!0}function iu(h,l){for(let f=0;f<l.length;f++)if(wn(h,l[f]))return!0;return!1}function Va(h,l,f){const v=[];for(let E=0;E<h.length;E++){const M=[];for(let D=0;D<h[E].length;D++){const G=ui(h[E][D],f);dt(l,G),M.push(G)}v.push(M)}return v}function Tr(h,l,f){const v=[];for(let E=0;E<h.length;E++){const M=Va(h[E],l,f);v.push(M)}return v}function Ha(h,l,f,v){if(h[0]<f[0]||h[0]>f[2]){const E=.5*v;let M=h[0]-f[0]>E?-v:f[0]-h[0]>E?v:0;M===0&&(M=h[0]-f[2]>E?-v:f[2]-h[0]>E?v:0),h[0]+=M}dt(l,h)}function Dl(h,l,f,v){const E=Math.pow(2,v.z)*Ze,M=[v.x*Ze,v.y*Ze],D=[];for(const G of h)for(const $ of G){const X=[$.x+M[0],$.y+M[1]];Ha(X,l,f,E),D.push(X)}return D}function Jn(h,l,f,v){const E=Math.pow(2,v.z)*Ze,M=[v.x*Ze,v.y*Ze],D=[];for(const $ of h){const X=[];for(const se of $){const Ae=[se.x+M[0],se.y+M[1]];dt(l,Ae),X.push(Ae)}D.push(X)}if(l[2]-l[0]<=E/2){(G=l)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(const $ of D)for(const X of $)Ha(X,l,f,E)}var G;return D}class To{constructor(l,f){this.type=Jt,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(ws(l[1])){const v=l[1];if(v.type==="FeatureCollection")for(let E=0;E<v.features.length;++E){const M=v.features[E].geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new To(v,v.features[E].geometry)}else if(v.type==="Feature"){const E=v.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new To(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new To(v,v)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],D=f.canonicalID();if(v.type==="Polygon"){const G=Va(v.coordinates,M,D),$=Dl(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!br(X,G))return!1}if(v.type==="MultiPolygon"){const G=Tr(v.coordinates,M,D),$=Dl(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!En(X,G))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],D=f.canonicalID();if(v.type==="Polygon"){const G=Va(v.coordinates,M,D),$=Jn(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!wn(X,G))return!1}if(v.type==="MultiPolygon"){const G=Tr(v.coordinates,M,D),$=Jn(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!iu(X,G))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ga{constructor(l,f){this.type=f.type,this.name=l,this.boundExpression=f}static parse(l,f){if(l.length!==2||typeof l[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const v=l[1];return f.scope.has(v)?new Ga(v,f.scope.get(v)):f.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class gs{constructor(l,f,v,E){this.name=l,this.type=f,this._evaluate=v,this.args=E}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,f){const v=l[0],E=gs.definitions[v];if(!E)return f.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const M=Array.isArray(E)?E[0]:E.type,D=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,G=D.filter(X=>{let[se]=X;return!Array.isArray(se)||se.length===l.length-1});let $=null;for(const[X,se]of G){$=new Ea(f.registry,ua,f.path,null,f.scope);const Ae=[];let me=!1;for(let Be=1;Be<l.length;Be++){const Se=l[Be],ke=Array.isArray(X)?X[Be-1]:X.type,He=$.parse(Se,1+Ae.length,ke);if(!He){me=!0;break}Ae.push(He)}if(!me)if(Array.isArray(X)&&X.length!==Ae.length)$.error(`Expected ${X.length} arguments, but found ${Ae.length} instead.`);else{for(let Be=0;Be<Ae.length;Be++){const Se=Array.isArray(X)?X[Be]:X.type,ke=Ae[Be];$.concat(Be+1).checkSubtype(Se,ke.type)}if($.errors.length===0)return new gs(v,M,se,Ae)}}if(G.length===1)f.errors.push(...$.errors);else{const X=(G.length?G:D).map(Ae=>{let[me]=Ae;return Be=me,Array.isArray(Be)?`(${Be.map(Ce).join(", ")})`:`(${Ce(Be.type)}...)`;var Be}).join(" | "),se=[];for(let Ae=1;Ae<l.length;Ae++){const me=f.parse(l[Ae],1+se.length);if(!me)return null;se.push(Ce(me.type))}f.error(`Expected arguments of type ${X}, but found (${se.join(", ")}) instead.`)}return null}static register(l,f){gs.definitions=f;for(const v in f)l[v]=gs}}function ua(h){if(h instanceof Ga)return ua(h.boundExpression);if(h instanceof gs&&h.name==="error"||h instanceof Ne||h instanceof To)return!1;const l=h instanceof Hs||h instanceof An;let f=!0;return h.eachChild(v=>{f=l?f&&ua(v):f&&v instanceof Vn}),!!f&&ja(h)&&Ic(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ja(h){if(h instanceof gs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof To)return!1;let l=!0;return h.eachChild(f=>{l&&!ja(f)&&(l=!1)}),l}function Sa(h){if(h instanceof gs&&h.name==="feature-state")return!1;let l=!0;return h.eachChild(f=>{l&&!Sa(f)&&(l=!1)}),l}function Ic(h,l){if(h instanceof gs&&l.indexOf(h.name)>=0)return!1;let f=!0;return h.eachChild(v=>{f&&!Ic(v,l)&&(f=!1)}),f}function qa(h,l){const f=h.length-1;let v,E,M=0,D=f,G=0;for(;M<=D;)if(G=Math.floor((M+D)/2),v=h[G],E=h[G+1],v<=l){if(G===f||l<E)return G;M=G+1}else{if(!(v>l))throw new Or("Input is not a number.");D=G-1}return 0}class ho{constructor(l,f,v){this.type=l,this.input=f,this.labels=[],this.outputs=[];for(const[E,M]of v)this.labels.push(E),this.outputs.push(M)}static parse(l,f){if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");const v=f.parse(l[1],1,Gt);if(!v)return null;const E=[];let M=null;f.expectedType&&f.expectedType.kind!=="value"&&(M=f.expectedType);for(let D=1;D<l.length;D+=2){const G=D===1?-1/0:l[D],$=l[D+1],X=D,se=D+1;if(typeof G!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(E.length&&E[E.length-1][0]>=G)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',X);const Ae=f.parse($,se,M);if(!Ae)return null;M=M||Ae.type,E.push([G,Ae])}return new ho(M,v,E)}evaluate(l){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(l);const E=this.input.evaluate(l);if(E<=f[0])return v[0].evaluate(l);const M=f.length;return E>=f[M-1]?v[M-1].evaluate(l):v[qa(f,E)].evaluate(l)}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Pr(h,l,f){return h+f*(l-h)}function ha(h,l,f){return h.map((v,E)=>Pr(v,l[E],f))}const us={number:Pr,color:function(h,l,f){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[E,M,D,G]=ha(h.rgb,l.rgb,f);return new lr(E,M,D,G,!1)}case"hcl":{const[E,M,D,G]=h.hcl,[$,X,se,Ae]=l.hcl;let me,Be;if(isNaN(E)||isNaN($))isNaN(E)?isNaN($)?me=NaN:(me=$,D!==1&&D!==0||(Be=X)):(me=E,se!==1&&se!==0||(Be=M));else{let ct=$-E;$>E&&ct>180?ct-=360:$<E&&E-$>180&&(ct+=360),me=E+f*ct}const[Se,ke,He,qe]=function(ct){let[Ye,tt,gt,St]=ct;return Ye=isNaN(Ye)?0:Ye*Ci,zt([gt,Math.cos(Ye)*tt,Math.sin(Ye)*tt,St])}([me,Be??Pr(M,X,f),Pr(D,se,f),Pr(G,Ae,f)]);return new lr(Se,ke,He,qe,!1)}case"lab":{const[E,M,D,G]=zt(ha(h.lab,l.lab,f));return new lr(E,M,D,G,!1)}}},array:ha,padding:function(h,l,f){return new xn(ha(h.values,l.values,f))},variableAnchorOffsetCollection:function(h,l,f){const v=h.values,E=l.values;if(v.length!==E.length)throw new Or(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${l.toString()}`);const M=[];for(let D=0;D<v.length;D+=2){if(v[D]!==E[D])throw new Or(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${v[D]}, to[${D}]: ${E[D]}`);M.push(v[D]);const[G,$]=v[D+1],[X,se]=E[D+1];M.push([Pr(G,X,f),Pr($,se,f)])}return new cs(M)}};class dn{constructor(l,f,v,E,M){this.type=l,this.operator=f,this.interpolation=v,this.input=E,this.labels=[],this.outputs=[];for(const[D,G]of M)this.labels.push(D),this.outputs.push(G)}static interpolationFactor(l,f,v,E){let M=0;if(l.name==="exponential")M=rs(f,l.base,v,E);else if(l.name==="linear")M=rs(f,1,v,E);else if(l.name==="cubic-bezier"){const D=l.controlPoints;M=new ne(D[0],D[1],D[2],D[3]).solve(rs(f,1,v,E))}return M}static parse(l,f){let[v,E,M,...D]=l;if(!Array.isArray(E)||E.length===0)return f.error("Expected an interpolation type expression.",1);if(E[0]==="linear")E={name:"linear"};else if(E[0]==="exponential"){const X=E[1];if(typeof X!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);E={name:"exponential",base:X}}else{if(E[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(E[0])}`,1,0);{const X=E.slice(1);if(X.length!==4||X.some(se=>typeof se!="number"||se<0||se>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);E={name:"cubic-bezier",controlPoints:X}}}if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(M=f.parse(M,2,Gt),!M)return null;const G=[];let $=null;v==="interpolate-hcl"||v==="interpolate-lab"?$=mr:f.expectedType&&f.expectedType.kind!=="value"&&($=f.expectedType);for(let X=0;X<D.length;X+=2){const se=D[X],Ae=D[X+1],me=X+3,Be=X+4;if(typeof se!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(G.length&&G[G.length-1][0]>=se)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);const Se=f.parse(Ae,Be,$);if(!Se)return null;$=$||Se.type,G.push([se,Se])}return it($,Gt)||it($,mr)||it($,Y)||it($,ge)||it($,_e(Gt))?new dn($,v,E,M,G):f.error(`Type ${Ce($)} is not interpolatable.`)}evaluate(l){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(l);const E=this.input.evaluate(l);if(E<=f[0])return v[0].evaluate(l);const M=f.length;if(E>=f[M-1])return v[M-1].evaluate(l);const D=qa(f,E),G=dn.interpolationFactor(this.interpolation,E,f[D],f[D+1]),$=v[D].evaluate(l),X=v[D+1].evaluate(l);switch(this.operator){case"interpolate":return us[this.type.kind]($,X,G);case"interpolate-hcl":return us.color($,X,G,"hcl");case"interpolate-lab":return us.color($,X,G,"lab")}}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function rs(h,l,f,v){const E=v-f,M=h-f;return E===0?0:l===1?M/E:(Math.pow(l,M)-1)/(Math.pow(l,E)-1)}class Vr{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expectected at least one argument.");let v=null;const E=f.expectedType;E&&E.kind!=="value"&&(v=E);const M=[];for(const G of l.slice(1)){const $=f.parse(G,1+M.length,v,void 0,{typeAnnotation:"omit"});if(!$)return null;v=v||$.type,M.push($)}if(!v)throw new Error("No output type");const D=E&&M.some(G=>Me(E,G.type));return new Vr(D?ze:v,M)}evaluate(l){let f,v=null,E=0;for(const M of this.args)if(E++,v=M.evaluate(l),v&&v instanceof Wi&&!v.available&&(f||(f=v.name),v=null,E===this.args.length&&(v=f)),v!==null)break;return v}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}class $a{constructor(l,f){this.type=f.type,this.bindings=[].concat(l),this.result=f}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const f of this.bindings)l(f[1]);l(this.result)}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const v=[];for(let M=1;M<l.length-1;M+=2){const D=l[M];if(typeof D!="string")return f.error(`Expected string, but found ${typeof D} instead.`,M);if(/[^a-zA-Z0-9_]/.test(D))return f.error("Variable names must contain only alphanumeric characters or '_'.",M);const G=f.parse(l[M+1],M+1);if(!G)return null;v.push([D,G])}const E=f.parse(l[l.length-1],l.length-1,f.expectedType,v);return E?new $a(v,E):null}outputDefined(){return this.result.outputDefined()}}class nl{constructor(l,f,v){this.type=l,this.index=f,this.input=v}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const v=f.parse(l[1],1,Gt),E=f.parse(l[2],2,_e(f.expectedType||ze));return v&&E?new nl(E.type.itemType,v,E):null}evaluate(l){const f=this.index.evaluate(l),v=this.input.evaluate(l);if(f<0)throw new Or(`Array index out of bounds: ${f} < 0.`);if(f>=v.length)throw new Or(`Array index out of bounds: ${f} > ${v.length-1}.`);if(f!==Math.floor(f))throw new Or(`Array index must be an integer, but found ${f} instead.`);return v[f]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Rl{constructor(l,f){this.type=Jt,this.needle=l,this.haystack=f}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const v=f.parse(l[1],1,ze),E=f.parse(l[2],2,ze);return v&&E?Oe(v.type,[Jt,vi,Gt,Ii,ze])?new Rl(v,E):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(v.type)} instead`):null}evaluate(l){const f=this.needle.evaluate(l),v=this.haystack.evaluate(l);if(!v)return!1;if(!Ve(f,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(dr(f))} instead.`);if(!Ve(v,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Ce(dr(v))} instead.`);return v.indexOf(f)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Io{constructor(l,f,v){this.type=Gt,this.needle=l,this.haystack=f,this.fromIndex=v}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const v=f.parse(l[1],1,ze),E=f.parse(l[2],2,ze);if(!v||!E)return null;if(!Oe(v.type,[Jt,vi,Gt,Ii,ze]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(v.type)} instead`);if(l.length===4){const M=f.parse(l[3],3,Gt);return M?new Io(v,E,M):null}return new Io(v,E)}evaluate(l){const f=this.needle.evaluate(l),v=this.haystack.evaluate(l);if(!Ve(f,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(dr(f))} instead.`);if(!Ve(v,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Ce(dr(v))} instead.`);if(this.fromIndex){const E=this.fromIndex.evaluate(l);return v.indexOf(f,E)}return v.indexOf(f)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Ko{constructor(l,f,v,E,M,D){this.inputType=l,this.type=f,this.input=v,this.cases=E,this.outputs=M,this.otherwise=D}static parse(l,f){if(l.length<5)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return f.error("Expected an even number of arguments.");let v,E;f.expectedType&&f.expectedType.kind!=="value"&&(E=f.expectedType);const M={},D=[];for(let X=2;X<l.length-1;X+=2){let se=l[X];const Ae=l[X+1];Array.isArray(se)||(se=[se]);const me=f.concat(X);if(se.length===0)return me.error("Expected at least one branch label.");for(const Se of se){if(typeof Se!="number"&&typeof Se!="string")return me.error("Branch labels must be numbers or strings.");if(typeof Se=="number"&&Math.abs(Se)>Number.MAX_SAFE_INTEGER)return me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Se=="number"&&Math.floor(Se)!==Se)return me.error("Numeric branch labels must be integer values.");if(v){if(me.checkSubtype(v,dr(Se)))return null}else v=dr(Se);if(M[String(Se)]!==void 0)return me.error("Branch labels must be unique.");M[String(Se)]=D.length}const Be=f.parse(Ae,X,E);if(!Be)return null;E=E||Be.type,D.push(Be)}const G=f.parse(l[1],1,ze);if(!G)return null;const $=f.parse(l[l.length-1],l.length-1,E);return $?G.type.kind!=="value"&&f.concat(1).checkSubtype(v,G.type)?null:new Ko(v,E,G,M,D,$):null}evaluate(l){const f=this.input.evaluate(l);return(dr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class cc{constructor(l,f,v){this.type=l,this.branches=f,this.otherwise=v}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return f.error("Expected an odd number of arguments.");let v;f.expectedType&&f.expectedType.kind!=="value"&&(v=f.expectedType);const E=[];for(let D=1;D<l.length-1;D+=2){const G=f.parse(l[D],D,Jt);if(!G)return null;const $=f.parse(l[D+1],D+1,v);if(!$)return null;E.push([G,$]),v=v||$.type}const M=f.parse(l[l.length-1],l.length-1,v);if(!M)return null;if(!v)throw new Error("Can't infer output type");return new cc(v,E,M)}evaluate(l){for(const[f,v]of this.branches)if(f.evaluate(l))return v.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[f,v]of this.branches)l(f),l(v);l(this.otherwise)}outputDefined(){return this.branches.every(l=>{let[f,v]=l;return v.outputDefined()})&&this.otherwise.outputDefined()}}class Wo{constructor(l,f,v,E){this.type=l,this.input=f,this.beginIndex=v,this.endIndex=E}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const v=f.parse(l[1],1,ze),E=f.parse(l[2],2,Gt);if(!v||!E)return null;if(!Oe(v.type,[_e(ze),vi,ze]))return f.error(`Expected first argument to be of type array or string, but found ${Ce(v.type)} instead`);if(l.length===4){const M=f.parse(l[3],3,Gt);return M?new Wo(v.type,v,E,M):null}return new Wo(v.type,v,E)}evaluate(l){const f=this.input.evaluate(l),v=this.beginIndex.evaluate(l);if(!Ve(f,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${Ce(dr(f))} instead.`);if(this.endIndex){const E=this.endIndex.evaluate(l);return f.slice(v,E)}return f.slice(v)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Ao(h,l){return h==="=="||h==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function uc(h,l,f,v){return v.compare(l,f)===0}function Xo(h,l,f){const v=h!=="=="&&h!=="!=";return class cN{constructor(M,D,G){this.type=Jt,this.lhs=M,this.rhs=D,this.collator=G,this.hasUntypedArgument=M.type.kind==="value"||D.type.kind==="value"}static parse(M,D){if(M.length!==3&&M.length!==4)return D.error("Expected two or three arguments.");const G=M[0];let $=D.parse(M[1],1,ze);if(!$)return null;if(!Ao(G,$.type))return D.concat(1).error(`"${G}" comparisons are not supported for type '${Ce($.type)}'.`);let X=D.parse(M[2],2,ze);if(!X)return null;if(!Ao(G,X.type))return D.concat(2).error(`"${G}" comparisons are not supported for type '${Ce(X.type)}'.`);if($.type.kind!==X.type.kind&&$.type.kind!=="value"&&X.type.kind!=="value")return D.error(`Cannot compare types '${Ce($.type)}' and '${Ce(X.type)}'.`);v&&($.type.kind==="value"&&X.type.kind!=="value"?$=new An(X.type,[$]):$.type.kind!=="value"&&X.type.kind==="value"&&(X=new An($.type,[X])));let se=null;if(M.length===4){if($.type.kind!=="string"&&X.type.kind!=="string"&&$.type.kind!=="value"&&X.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(se=D.parse(M[3],3,we),!se)return null}return new cN($,X,se)}evaluate(M){const D=this.lhs.evaluate(M),G=this.rhs.evaluate(M);if(v&&this.hasUntypedArgument){const $=dr(D),X=dr(G);if($.kind!==X.kind||$.kind!=="string"&&$.kind!=="number")throw new Or(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${$.kind}, ${X.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const $=dr(D),X=dr(G);if($.kind!=="string"||X.kind!=="string")return l(M,D,G)}return this.collator?f(M,D,G,this.collator.evaluate(M)):l(M,D,G)}eachChild(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)}outputDefined(){return!0}}}const kl=Xo("==",function(h,l,f){return l===f},uc),Lc=Xo("!=",function(h,l,f){return l!==f},function(h,l,f,v){return!uc(0,l,f,v)}),Ah=Xo("<",function(h,l,f){return l<f},function(h,l,f,v){return v.compare(l,f)<0}),ru=Xo(">",function(h,l,f){return l>f},function(h,l,f,v){return v.compare(l,f)>0}),nu=Xo("<=",function(h,l,f){return l<=f},function(h,l,f,v){return v.compare(l,f)<=0}),Iu=Xo(">=",function(h,l,f){return l>=f},function(h,l,f,v){return v.compare(l,f)>=0});class Ol{constructor(l,f,v,E,M){this.type=vi,this.number=l,this.locale=f,this.currency=v,this.minFractionDigits=E,this.maxFractionDigits=M}static parse(l,f){if(l.length!==3)return f.error("Expected two arguments.");const v=f.parse(l[1],1,Gt);if(!v)return null;const E=l[2];if(typeof E!="object"||Array.isArray(E))return f.error("NumberFormat options argument must be an object.");let M=null;if(E.locale&&(M=f.parse(E.locale,1,vi),!M))return null;let D=null;if(E.currency&&(D=f.parse(E.currency,1,vi),!D))return null;let G=null;if(E["min-fraction-digits"]&&(G=f.parse(E["min-fraction-digits"],1,Gt),!G))return null;let $=null;return E["max-fraction-digits"]&&($=f.parse(E["max-fraction-digits"],1,Gt),!$)?null:new Ol(v,M,D,G,$)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Ka{constructor(l){this.type=oe,this.sections=l}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const v=l[1];if(!Array.isArray(v)&&typeof v=="object")return f.error("First argument must be an image or text section.");const E=[];let M=!1;for(let D=1;D<=l.length-1;++D){const G=l[D];if(M&&typeof G=="object"&&!Array.isArray(G)){M=!1;let $=null;if(G["font-scale"]&&($=f.parse(G["font-scale"],1,Gt),!$))return null;let X=null;if(G["text-font"]&&(X=f.parse(G["text-font"],1,_e(vi)),!X))return null;let se=null;if(G["text-color"]&&(se=f.parse(G["text-color"],1,mr),!se))return null;const Ae=E[E.length-1];Ae.scale=$,Ae.font=X,Ae.textColor=se}else{const $=f.parse(l[D],1,ze);if(!$)return null;const X=$.type.kind;if(X!=="string"&&X!=="value"&&X!=="null"&&X!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");M=!0,E.push({content:$,scale:null,font:null,textColor:null})}}return new Ka(E)}evaluate(l){return new Qr(this.sections.map(f=>{const v=f.content.evaluate(l);return dr(v)===le?new ps("",v,null,null,null):new ps(Fr(v),null,f.scale?f.scale.evaluate(l):null,f.font?f.font.evaluate(l).join(","):null,f.textColor?f.textColor.evaluate(l):null)}))}eachChild(l){for(const f of this.sections)l(f.content),f.scale&&l(f.scale),f.font&&l(f.font),f.textColor&&l(f.textColor)}outputDefined(){return!1}}class Wa{constructor(l){this.type=le,this.input=l}static parse(l,f){if(l.length!==2)return f.error("Expected two arguments.");const v=f.parse(l[1],1,vi);return v?new Wa(v):f.error("No image name provided.")}evaluate(l){const f=this.input.evaluate(l),v=Wi.fromString(f);return v&&l.availableImages&&(v.available=l.availableImages.indexOf(f)>-1),v}eachChild(l){l(this.input)}outputDefined(){return!1}}class Ul{constructor(l){this.type=Gt,this.input=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);const v=f.parse(l[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${Ce(v.type)} instead.`):new Ul(v):null}evaluate(l){const f=this.input.evaluate(l);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Or(`Expected value to be of type string or array, but found ${Ce(dr(f))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Xa={"==":kl,"!=":Lc,">":ru,"<":Ah,">=":Iu,"<=":nu,array:An,at:nl,boolean:An,case:cc,coalesce:Vr,collator:Ne,format:Ka,image:Wa,in:Rl,"index-of":Io,interpolate:dn,"interpolate-hcl":dn,"interpolate-lab":dn,length:Ul,let:$a,literal:Vn,match:Ko,number:An,"number-format":Ol,object:An,slice:Wo,step:ho,string:An,"to-boolean":Hs,"to-color":Hs,"to-number":Hs,"to-string":Hs,var:Ga,within:To};function Aa(h,l){let[f,v,E,M]=l;f=f.evaluate(h),v=v.evaluate(h),E=E.evaluate(h);const D=M?M.evaluate(h):1,G=Js(f,v,E,D);if(G)throw new Or(G);return new lr(f/255,v/255,E/255,D,!1)}function sl(h,l){return h in l}function Nl(h,l){const f=l[h];return f===void 0?null:f}function Ys(h){return{type:h}}function da(h){return{result:"success",value:h}}function re(h){return{result:"error",value:h}}function Ie(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function at(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function mt(h){return!!h.expression&&h.expression.interpolated}function vt(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Tt(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function pi(h){return h}function ri(h,l){const f=l.type==="color",v=h.stops&&typeof h.stops[0][0]=="object",E=v||!(v||h.property!==void 0),M=h.type||(mt(l)?"exponential":"interval");if(f||l.type==="padding"){const se=f?lr.parse:xn.parse;(h=Zi({},h)).stops&&(h.stops=h.stops.map(Ae=>[Ae[0],se(Ae[1])])),h.default=se(h.default?h.default:l.default)}if(h.colorSpace&&(D=h.colorSpace)!=="rgb"&&D!=="hcl"&&D!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var D;let G,$,X;if(M==="exponential")G=jr;else if(M==="interval")G=ki;else if(M==="categorical"){G=qi,$=Object.create(null);for(const se of h.stops)$[se[0]]=se[1];X=typeof h.stops[0][0]}else{if(M!=="identity")throw new Error(`Unknown function type "${M}"`);G=nr}if(v){const se={},Ae=[];for(let Se=0;Se<h.stops.length;Se++){const ke=h.stops[Se],He=ke[0].zoom;se[He]===void 0&&(se[He]={zoom:He,type:h.type,property:h.property,default:h.default,stops:[]},Ae.push(He)),se[He].stops.push([ke[0].value,ke[1]])}const me=[];for(const Se of Ae)me.push([se[Se].zoom,ri(se[Se],l)]);const Be={name:"linear"};return{kind:"composite",interpolationType:Be,interpolationFactor:dn.interpolationFactor.bind(void 0,Be),zoomStops:me.map(Se=>Se[0]),evaluate:(Se,ke)=>{let{zoom:He}=Se;return jr({stops:me,base:h.base},l,He).evaluate(He,ke)}}}if(E){const se=M==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:se,interpolationFactor:dn.interpolationFactor.bind(void 0,se),zoomStops:h.stops.map(Ae=>Ae[0]),evaluate:Ae=>{let{zoom:me}=Ae;return G(h,l,me,$,X)}}}return{kind:"source",evaluate(se,Ae){const me=Ae&&Ae.properties?Ae.properties[h.property]:void 0;return me===void 0?rr(h.default,l.default):G(h,l,me,$,X)}}}function rr(h,l,f){return h!==void 0?h:l!==void 0?l:f!==void 0?f:void 0}function qi(h,l,f,v,E){return rr(typeof f===E?v[f]:void 0,h.default,l.default)}function ki(h,l,f){if(vt(f)!=="number")return rr(h.default,l.default);const v=h.stops.length;if(v===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[v-1][0])return h.stops[v-1][1];const E=qa(h.stops.map(M=>M[0]),f);return h.stops[E][1]}function jr(h,l,f){const v=h.base!==void 0?h.base:1;if(vt(f)!=="number")return rr(h.default,l.default);const E=h.stops.length;if(E===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[E-1][0])return h.stops[E-1][1];const M=qa(h.stops.map(se=>se[0]),f),D=function(se,Ae,me,Be){const Se=Be-me,ke=se-me;return Se===0?0:Ae===1?ke/Se:(Math.pow(Ae,ke)-1)/(Math.pow(Ae,Se)-1)}(f,v,h.stops[M][0],h.stops[M+1][0]),G=h.stops[M][1],$=h.stops[M+1][1],X=us[l.type]||pi;return typeof G.evaluate=="function"?{evaluate(){for(var se=arguments.length,Ae=new Array(se),me=0;me<se;me++)Ae[me]=arguments[me];const Be=G.evaluate.apply(void 0,Ae),Se=$.evaluate.apply(void 0,Ae);if(Be!==void 0&&Se!==void 0)return X(Be,Se,D,h.colorSpace)}}:X(G,$,D,h.colorSpace)}function nr(h,l,f){switch(l.type){case"color":f=lr.parse(f);break;case"formatted":f=Qr.fromString(f.toString());break;case"resolvedImage":f=Wi.fromString(f.toString());break;case"padding":f=xn.parse(f);break;default:vt(f)===l.type||l.type==="enum"&&l.values[f]||(f=void 0)}return rr(f,h.default,l.default)}gs.register(Xa,{error:[{kind:"error"},[vi],(h,l)=>{let[f]=l;throw new Or(f.evaluate(h))}],typeof:[vi,[ze],(h,l)=>{let[f]=l;return Ce(dr(f.evaluate(h)))}],"to-rgba":[_e(Gt,4),[mr],(h,l)=>{let[f]=l;const[v,E,M,D]=f.evaluate(h).rgb;return[255*v,255*E,255*M,D]}],rgb:[mr,[Gt,Gt,Gt],Aa],rgba:[mr,[Gt,Gt,Gt,Gt],Aa],has:{type:Jt,overloads:[[[vi],(h,l)=>{let[f]=l;return sl(f.evaluate(h),h.properties())}],[[vi,Sr],(h,l)=>{let[f,v]=l;return sl(f.evaluate(h),v.evaluate(h))}]]},get:{type:ze,overloads:[[[vi],(h,l)=>{let[f]=l;return Nl(f.evaluate(h),h.properties())}],[[vi,Sr],(h,l)=>{let[f,v]=l;return Nl(f.evaluate(h),v.evaluate(h))}]]},"feature-state":[ze,[vi],(h,l)=>{let[f]=l;return Nl(f.evaluate(h),h.featureState||{})}],properties:[Sr,[],h=>h.properties()],"geometry-type":[vi,[],h=>h.geometryType()],id:[ze,[],h=>h.id()],zoom:[Gt,[],h=>h.globals.zoom],"heatmap-density":[Gt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Gt,[],h=>h.globals.lineProgress||0],accumulated:[ze,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Gt,Ys(Gt),(h,l)=>{let f=0;for(const v of l)f+=v.evaluate(h);return f}],"*":[Gt,Ys(Gt),(h,l)=>{let f=1;for(const v of l)f*=v.evaluate(h);return f}],"-":{type:Gt,overloads:[[[Gt,Gt],(h,l)=>{let[f,v]=l;return f.evaluate(h)-v.evaluate(h)}],[[Gt],(h,l)=>{let[f]=l;return-f.evaluate(h)}]]},"/":[Gt,[Gt,Gt],(h,l)=>{let[f,v]=l;return f.evaluate(h)/v.evaluate(h)}],"%":[Gt,[Gt,Gt],(h,l)=>{let[f,v]=l;return f.evaluate(h)%v.evaluate(h)}],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(h,l)=>{let[f,v]=l;return Math.pow(f.evaluate(h),v.evaluate(h))}],sqrt:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.sqrt(f.evaluate(h))}],log10:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.log(f.evaluate(h))/Math.LN10}],ln:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.log(f.evaluate(h))}],log2:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.log(f.evaluate(h))/Math.LN2}],sin:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.sin(f.evaluate(h))}],cos:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.cos(f.evaluate(h))}],tan:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.tan(f.evaluate(h))}],asin:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.asin(f.evaluate(h))}],acos:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.acos(f.evaluate(h))}],atan:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.atan(f.evaluate(h))}],min:[Gt,Ys(Gt),(h,l)=>Math.min(...l.map(f=>f.evaluate(h)))],max:[Gt,Ys(Gt),(h,l)=>Math.max(...l.map(f=>f.evaluate(h)))],abs:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.abs(f.evaluate(h))}],round:[Gt,[Gt],(h,l)=>{let[f]=l;const v=f.evaluate(h);return v<0?-Math.round(-v):Math.round(v)}],floor:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.floor(f.evaluate(h))}],ceil:[Gt,[Gt],(h,l)=>{let[f]=l;return Math.ceil(f.evaluate(h))}],"filter-==":[Jt,[vi,ze],(h,l)=>{let[f,v]=l;return h.properties()[f.value]===v.value}],"filter-id-==":[Jt,[ze],(h,l)=>{let[f]=l;return h.id()===f.value}],"filter-type-==":[Jt,[vi],(h,l)=>{let[f]=l;return h.geometryType()===f.value}],"filter-<":[Jt,[vi,ze],(h,l)=>{let[f,v]=l;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<M}],"filter-id-<":[Jt,[ze],(h,l)=>{let[f]=l;const v=h.id(),E=f.value;return typeof v==typeof E&&v<E}],"filter->":[Jt,[vi,ze],(h,l)=>{let[f,v]=l;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>M}],"filter-id->":[Jt,[ze],(h,l)=>{let[f]=l;const v=h.id(),E=f.value;return typeof v==typeof E&&v>E}],"filter-<=":[Jt,[vi,ze],(h,l)=>{let[f,v]=l;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<=M}],"filter-id-<=":[Jt,[ze],(h,l)=>{let[f]=l;const v=h.id(),E=f.value;return typeof v==typeof E&&v<=E}],"filter->=":[Jt,[vi,ze],(h,l)=>{let[f,v]=l;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>=M}],"filter-id->=":[Jt,[ze],(h,l)=>{let[f]=l;const v=h.id(),E=f.value;return typeof v==typeof E&&v>=E}],"filter-has":[Jt,[ze],(h,l)=>{let[f]=l;return f.value in h.properties()}],"filter-has-id":[Jt,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Jt,[_e(vi)],(h,l)=>{let[f]=l;return f.value.indexOf(h.geometryType())>=0}],"filter-id-in":[Jt,[_e(ze)],(h,l)=>{let[f]=l;return f.value.indexOf(h.id())>=0}],"filter-in-small":[Jt,[vi,_e(ze)],(h,l)=>{let[f,v]=l;return v.value.indexOf(h.properties()[f.value])>=0}],"filter-in-large":[Jt,[vi,_e(ze)],(h,l)=>{let[f,v]=l;return function(E,M,D,G){for(;D<=G;){const $=D+G>>1;if(M[$]===E)return!0;M[$]>E?G=$-1:D=$+1}return!1}(h.properties()[f.value],v.value,0,v.value.length-1)}],all:{type:Jt,overloads:[[[Jt,Jt],(h,l)=>{let[f,v]=l;return f.evaluate(h)&&v.evaluate(h)}],[Ys(Jt),(h,l)=>{for(const f of l)if(!f.evaluate(h))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(h,l)=>{let[f,v]=l;return f.evaluate(h)||v.evaluate(h)}],[Ys(Jt),(h,l)=>{for(const f of l)if(f.evaluate(h))return!0;return!1}]]},"!":[Jt,[Jt],(h,l)=>{let[f]=l;return!f.evaluate(h)}],"is-supported-script":[Jt,[vi],(h,l)=>{let[f]=l;const v=h.globals&&h.globals.isSupportedScript;return!v||v(f.evaluate(h))}],upcase:[vi,[vi],(h,l)=>{let[f]=l;return f.evaluate(h).toUpperCase()}],downcase:[vi,[vi],(h,l)=>{let[f]=l;return f.evaluate(h).toLowerCase()}],concat:[vi,Ys(ze),(h,l)=>l.map(f=>Fr(f.evaluate(h))).join("")],"resolved-locale":[vi,[we],(h,l)=>{let[f]=l;return f.evaluate(h).resolvedLocale()}]});class Hn{constructor(l,f){var v;this.expression=l,this._warningHistory={},this._evaluator=new uo,this._defaultValue=f?(v=f).type==="color"&&Tt(v.default)?new lr(0,0,0,0):v.type==="color"?lr.parse(v.default)||null:v.type==="padding"?xn.parse(v.default)||null:v.type==="variableAnchorOffsetCollection"?cs.parse(v.default)||null:v.default===void 0?null:v.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(l,f,v,E,M,D){return this._evaluator.globals=l,this._evaluator.feature=f,this._evaluator.featureState=v,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=D,this.expression.evaluate(this._evaluator)}evaluate(l,f,v,E,M,D){this._evaluator.globals=l,this._evaluator.feature=f||null,this._evaluator.featureState=v||null,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=D||null;try{const G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console<"u"&&console.warn(G.message)),this._defaultValue}}}function Br(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Xa}function Lr(h,l){const f=new Ea(Xa,ua,[],l?function(E){const M={color:mr,string:vi,number:Gt,enum:vi,boolean:Jt,formatted:oe,padding:Y,resolvedImage:le,variableAnchorOffsetCollection:ge};return E.type==="array"?_e(M[E.value]||ze,E.length):M[E.type]}(l):void 0),v=f.parse(h,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?da(new Hn(v,l)):re(f.errors)}class On{constructor(l,f){this.kind=l,this._styleExpression=f,this.isStateDependent=l!=="constant"&&!Sa(f.expression)}evaluateWithoutErrorHandling(l,f,v,E,M,D){return this._styleExpression.evaluateWithoutErrorHandling(l,f,v,E,M,D)}evaluate(l,f,v,E,M,D){return this._styleExpression.evaluate(l,f,v,E,M,D)}}class qs{constructor(l,f,v,E){this.kind=l,this.zoomStops=v,this._styleExpression=f,this.isStateDependent=l!=="camera"&&!Sa(f.expression),this.interpolationType=E}evaluateWithoutErrorHandling(l,f,v,E,M,D){return this._styleExpression.evaluateWithoutErrorHandling(l,f,v,E,M,D)}evaluate(l,f,v,E,M,D){return this._styleExpression.evaluate(l,f,v,E,M,D)}interpolationFactor(l,f,v){return this.interpolationType?dn.interpolationFactor(this.interpolationType,l,f,v):0}}function eo(h,l){const f=Lr(h,l);if(f.result==="error")return f;const v=f.value.expression,E=ja(v);if(!E&&!Ie(l))return re([new Qt("","data expressions not supported")]);const M=Ic(v,["zoom"]);if(!M&&!at(l))return re([new Qt("","zoom expressions not supported")]);const D=Ta(v);return D||M?D instanceof Qt?re([D]):D instanceof dn&&!mt(l)?re([new Qt("",'"interpolate" expressions cannot be used with this property')]):da(D?new qs(E?"camera":"composite",f.value,D.labels,D instanceof dn?D.interpolation:void 0):new On(E?"constant":"source",f.value)):re([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lo{constructor(l,f){this._parameters=l,this._specification=f,Zi(this,ri(this._parameters,this._specification))}static deserialize(l){return new Lo(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Ta(h){let l=null;if(h instanceof $a)l=Ta(h.result);else if(h instanceof Vr){for(const f of h.args)if(l=Ta(f),l)break}else(h instanceof ho||h instanceof dn)&&h.input instanceof gs&&h.input.name==="zoom"&&(l=h);return l instanceof Qt||h.eachChild(f=>{const v=Ta(f);v instanceof Qt?l=v:!l&&v?l=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&v&&l!==v&&(l=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function fa(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const l of h.slice(1))if(!fa(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const zl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ol(h){if(h==null)return{filter:()=>!0,needGeometry:!1};fa(h)||(h=pa(h));const l=Lr(h,zl);if(l.result==="error")throw new Error(l.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,v,E)=>l.value.evaluate(f,v,{},E),needGeometry:hc(h)}}function Ql(h,l){return h<l?-1:h>l?1:0}function hc(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let l=1;l<h.length;l++)if(hc(h[l]))return!0;return!1}function pa(h){if(!h)return!0;const l=h[0];return h.length<=1?l!=="any":l==="=="?Ps(h[1],h[2],"=="):l==="!="?Ia(Ps(h[1],h[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Ps(h[1],h[2],l):l==="any"?(f=h.slice(1),["any"].concat(f.map(pa))):l==="all"?["all"].concat(h.slice(1).map(pa)):l==="none"?["all"].concat(h.slice(1).map(pa).map(Ia)):l==="in"?al(h[1],h.slice(2)):l==="!in"?Ia(al(h[1],h.slice(2))):l==="has"?Vl(h[1]):l==="!has"?Ia(Vl(h[1])):l!=="within"||h;var f}function Ps(h,l,f){switch(h){case"$type":return[`filter-type-${f}`,l];case"$id":return[`filter-id-${f}`,l];default:return[`filter-${f}`,h,l]}}function al(h,l){if(l.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(f=>typeof f!=typeof l[0])?["filter-in-large",h,["literal",l.sort(Ql)]]:["filter-in-small",h,["literal",l]]}}function Vl(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ia(h){return["!",h]}function La(h){const l=typeof h;if(l==="number"||l==="boolean"||l==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let E="[";for(const M of h)E+=`${La(M)},`;return`${E}]`}const f=Object.keys(h).sort();let v="{";for(let E=0;E<f.length;E++)v+=`${JSON.stringify(f[E])}:${La(h[f[E]])},`;return`${v}}`}function Fs(h){let l="";for(const f of jt)l+=`/${La(h[f])}`;return l}function Lu(h){const l=h.value;return l?[new $t(h.key,l,"constants have been deprecated as of v8")]:[]}function Sn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function on(h){if(Array.isArray(h))return h.map(on);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const l={};for(const f in h)l[f]=on(h[f]);return l}return Sn(h)}function fn(h){const l=h.key,f=h.value,v=h.valueSpec||{},E=h.objectElementValidators||{},M=h.style,D=h.styleSpec,G=h.validateSpec;let $=[];const X=vt(f);if(X!=="object")return[new $t(l,f,`object expected, ${X} found`)];for(const se in f){const Ae=se.split(".")[0],me=v[Ae]||v["*"];let Be;if(E[Ae])Be=E[Ae];else if(v[Ae])Be=G;else if(E["*"])Be=E["*"];else{if(!v["*"]){$.push(new $t(l,f[se],`unknown property "${se}"`));continue}Be=G}$=$.concat(Be({key:(l&&`${l}.`)+se,value:f[se],valueSpec:me,style:M,styleSpec:D,object:f,objectKey:se,validateSpec:G},f))}for(const se in v)E[se]||v[se].required&&v[se].default===void 0&&f[se]===void 0&&$.push(new $t(l,f,`missing required property "${se}"`));return $}function Yn(h){const l=h.value,f=h.valueSpec,v=h.style,E=h.styleSpec,M=h.key,D=h.arrayElementValidator||h.validateSpec;if(vt(l)!=="array")return[new $t(M,l,`array expected, ${vt(l)} found`)];if(f.length&&l.length!==f.length)return[new $t(M,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new $t(M,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let G={type:f.value,values:f.values};E.$version<7&&(G.function=f.function),vt(f.value)==="object"&&(G=f.value);let $=[];for(let X=0;X<l.length;X++)$=$.concat(D({array:l,arrayIndex:X,value:l[X],valueSpec:G,validateSpec:h.validateSpec,style:v,styleSpec:E,key:`${M}[${X}]`}));return $}function ll(h){const l=h.key,f=h.value,v=h.valueSpec;let E=vt(f);return E==="number"&&f!=f&&(E="NaN"),E!=="number"?[new $t(l,f,`number expected, ${E} found`)]:"minimum"in v&&f<v.minimum?[new $t(l,f,`${f} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&f>v.maximum?[new $t(l,f,`${f} is greater than the maximum value ${v.maximum}`)]:[]}function cl(h){const l=h.valueSpec,f=Sn(h.value.type);let v,E,M,D={};const G=f!=="categorical"&&h.value.property===void 0,$=!G,X=vt(h.value.stops)==="array"&&vt(h.value.stops[0])==="array"&&vt(h.value.stops[0][0])==="object",se=fn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Be){if(f==="identity")return[new $t(Be.key,Be.value,'identity function may not have a "stops" property')];let Se=[];const ke=Be.value;return Se=Se.concat(Yn({key:Be.key,value:ke,valueSpec:Be.valueSpec,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec,arrayElementValidator:Ae})),vt(ke)==="array"&&ke.length===0&&Se.push(new $t(Be.key,ke,"array must have at least one stop")),Se},default:function(Be){return Be.validateSpec({key:Be.key,value:Be.value,valueSpec:l,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec})}}});return f==="identity"&&G&&se.push(new $t(h.key,h.value,'missing required property "property"')),f==="identity"||h.value.stops||se.push(new $t(h.key,h.value,'missing required property "stops"')),f==="exponential"&&h.valueSpec.expression&&!mt(h.valueSpec)&&se.push(new $t(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&($&&!Ie(h.valueSpec)?se.push(new $t(h.key,h.value,"property functions not supported")):G&&!at(h.valueSpec)&&se.push(new $t(h.key,h.value,"zoom functions not supported"))),f!=="categorical"&&!X||h.value.property!==void 0||se.push(new $t(h.key,h.value,'"property" property is required')),se;function Ae(Be){let Se=[];const ke=Be.value,He=Be.key;if(vt(ke)!=="array")return[new $t(He,ke,`array expected, ${vt(ke)} found`)];if(ke.length!==2)return[new $t(He,ke,`array length 2 expected, length ${ke.length} found`)];if(X){if(vt(ke[0])!=="object")return[new $t(He,ke,`object expected, ${vt(ke[0])} found`)];if(ke[0].zoom===void 0)return[new $t(He,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new $t(He,ke,"object stop key must have value")];if(M&&M>Sn(ke[0].zoom))return[new $t(He,ke[0].zoom,"stop zoom values must appear in ascending order")];Sn(ke[0].zoom)!==M&&(M=Sn(ke[0].zoom),E=void 0,D={}),Se=Se.concat(fn({key:`${He}[0]`,value:ke[0],valueSpec:{zoom:{}},validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec,objectElementValidators:{zoom:ll,value:me}}))}else Se=Se.concat(me({key:`${He}[0]`,value:ke[0],valueSpec:{},validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec},ke));return Br(on(ke[1]))?Se.concat([new $t(`${He}[1]`,ke[1],"expressions are not allowed in function stops.")]):Se.concat(Be.validateSpec({key:`${He}[1]`,value:ke[1],valueSpec:l,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec}))}function me(Be,Se){const ke=vt(Be.value),He=Sn(Be.value),qe=Be.value!==null?Be.value:Se;if(v){if(ke!==v)return[new $t(Be.key,qe,`${ke} stop domain type must match previous stop domain type ${v}`)]}else v=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new $t(Be.key,qe,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&f!=="categorical"){let ct=`number expected, ${ke} found`;return Ie(l)&&f===void 0&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $t(Be.key,qe,ct)]}return f!=="categorical"||ke!=="number"||isFinite(He)&&Math.floor(He)===He?f!=="categorical"&&ke==="number"&&E!==void 0&&He<E?[new $t(Be.key,qe,"stop domain values must appear in ascending order")]:(E=He,f==="categorical"&&He in D?[new $t(Be.key,qe,"stop domain values must be unique")]:(D[He]=!0,[])):[new $t(Be.key,qe,`integer expected, found ${He}`)]}}function fo(h){const l=(h.expressionContext==="property"?eo:Lr)(on(h.value),h.valueSpec);if(l.result==="error")return l.value.map(v=>new $t(`${h.key}${v.key}`,h.value,v.message));const f=l.value.expression||l.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!f.outputDefined())return[new $t(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Sa(f))return[new $t(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Sa(f))return[new $t(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Ic(f,["zoom","feature-state"]))return[new $t(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!ja(f))return[new $t(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ns(h){const l=h.key,f=h.value,v=h.valueSpec,E=[];return Array.isArray(v.values)?v.values.indexOf(Sn(f))===-1&&E.push(new $t(l,f,`expected one of [${v.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(v.values).indexOf(Sn(f))===-1&&E.push(new $t(l,f,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(f)} found`)),E}function ss(h){return fa(on(h.value))?fo(Zi({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mo(h)}function Mo(h){const l=h.value,f=h.key;if(vt(l)!=="array")return[new $t(f,l,`array expected, ${vt(l)} found`)];const v=h.styleSpec;let E,M=[];if(l.length<1)return[new $t(f,l,"filter array must have at least 1 element")];switch(M=M.concat(ns({key:`${f}[0]`,value:l[0],valueSpec:v.filter_operator,style:h.style,styleSpec:h.styleSpec})),Sn(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Sn(l[1])==="$type"&&M.push(new $t(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&M.push(new $t(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(E=vt(l[1]),E!=="string"&&M.push(new $t(`${f}[1]`,l[1],`string expected, ${E} found`)));for(let D=2;D<l.length;D++)E=vt(l[D]),Sn(l[1])==="$type"?M=M.concat(ns({key:`${f}[${D}]`,value:l[D],valueSpec:v.geometry_type,style:h.style,styleSpec:h.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new $t(`${f}[${D}]`,l[D],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let D=1;D<l.length;D++)M=M.concat(Mo({key:`${f}[${D}]`,value:l[D],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":E=vt(l[1]),l.length!==2?M.push(new $t(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):E!=="string"&&M.push(new $t(`${f}[1]`,l[1],`string expected, ${E} found`));break;case"within":E=vt(l[1]),l.length!==2?M.push(new $t(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):E!=="object"&&M.push(new $t(`${f}[1]`,l[1],`object expected, ${E} found`))}return M}function Po(h,l){const f=h.key,v=h.validateSpec,E=h.style,M=h.styleSpec,D=h.value,G=h.objectKey,$=M[`${l}_${h.layerType}`];if(!$)return[];const X=G.match(/^(.*)-transition$/);if(l==="paint"&&X&&$[X[1]]&&$[X[1]].transition)return v({key:f,value:D,valueSpec:M.transition,style:E,styleSpec:M});const se=h.valueSpec||$[G];if(!se)return[new $t(f,D,`unknown property "${G}"`)];let Ae;if(vt(D)==="string"&&Ie(se)&&!se.tokens&&(Ae=/^{([^}]+)}$/.exec(D)))return[new $t(f,D,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Ae[1])} }\`.`)];const me=[];return h.layerType==="symbol"&&(G==="text-field"&&E&&!E.glyphs&&me.push(new $t(f,D,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&Tt(on(D))&&Sn(D.type)==="identity"&&me.push(new $t(f,D,'"text-font" does not support identity functions'))),me.concat(v({key:h.key,value:D,valueSpec:se,style:E,styleSpec:M,expressionContext:"property",propertyType:l,propertyKey:G}))}function ga(h){return Po(h,"paint")}function ul(h){return Po(h,"layout")}function to(h){let l=[];const f=h.value,v=h.key,E=h.style,M=h.styleSpec;f.type||f.ref||l.push(new $t(v,f,'either "type" or "ref" is required'));let D=Sn(f.type);const G=Sn(f.ref);if(f.id){const $=Sn(f.id);for(let X=0;X<h.arrayIndex;X++){const se=E.layers[X];Sn(se.id)===$&&l.push(new $t(v,f.id,`duplicate layer id "${f.id}", previously used at line ${se.id.__line__}`))}}if("ref"in f){let $;["type","source","source-layer","filter","layout"].forEach(X=>{X in f&&l.push(new $t(v,f[X],`"${X}" is prohibited for ref layers`))}),E.layers.forEach(X=>{Sn(X.id)===G&&($=X)}),$?$.ref?l.push(new $t(v,f.ref,"ref cannot reference another ref layer")):D=Sn($.type):l.push(new $t(v,f.ref,`ref layer "${G}" not found`))}else if(D!=="background")if(f.source){const $=E.sources&&E.sources[f.source],X=$&&Sn($.type);$?X==="vector"&&D==="raster"?l.push(new $t(v,f.source,`layer "${f.id}" requires a raster source`)):X!=="raster-dem"&&D==="hillshade"?l.push(new $t(v,f.source,`layer "${f.id}" requires a raster-dem source`)):X==="raster"&&D!=="raster"?l.push(new $t(v,f.source,`layer "${f.id}" requires a vector source`)):X!=="vector"||f["source-layer"]?X==="raster-dem"&&D!=="hillshade"?l.push(new $t(v,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="line"||!f.paint||!f.paint["line-gradient"]||X==="geojson"&&$.lineMetrics||l.push(new $t(v,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new $t(v,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new $t(v,f.source,`source "${f.source}" not found`))}else l.push(new $t(v,f,'missing required property "source"'));return l=l.concat(fn({key:v,value:f,valueSpec:M.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${v}.type`,value:f.type,valueSpec:M.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:f,objectKey:"type"}),filter:ss,layout:$=>fn({layer:f,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":X=>ul(Zi({layerType:D},X))}}),paint:$=>fn({layer:f,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":X=>ga(Zi({layerType:D},X))}})}})),l}function io(h){const l=h.value,f=h.key,v=vt(l);return v!=="string"?[new $t(f,l,`string expected, ${v} found`)]:[]}const po={promoteId:function(h){let{key:l,value:f}=h;if(vt(f)==="string")return io({key:l,value:f});{const v=[];for(const E in f)v.push(...io({key:`${l}.${E}`,value:f[E]}));return v}}};function ms(h){const l=h.value,f=h.key,v=h.styleSpec,E=h.style,M=h.validateSpec;if(!l.type)return[new $t(f,l,'"type" is required')];const D=Sn(l.type);let G;switch(D){case"vector":case"raster":return G=fn({key:f,value:l,valueSpec:v[`source_${D.replace("-","_")}`],style:h.style,styleSpec:v,objectElementValidators:po,validateSpec:M}),G;case"raster-dem":return G=function($){var X;const se=(X=$.sourceName)!==null&&X!==void 0?X:"",Ae=$.value,me=$.styleSpec,Be=me.source_raster_dem,Se=$.style;let ke=[];const He=vt(Ae);if(Ae===void 0)return ke;if(He!=="object")return ke.push(new $t("source_raster_dem",Ae,`object expected, ${He} found`)),ke;const qe=Sn(Ae.encoding)==="custom",ct=["redFactor","greenFactor","blueFactor","baseShift"],Ye=$.value.encoding?`"${$.value.encoding}"`:"Default";for(const tt in Ae)!qe&&ct.includes(tt)?ke.push(new $t(tt,Ae[tt],`In "${se}": "${tt}" is only valid when "encoding" is set to "custom". ${Ye} encoding found`)):Be[tt]?ke=ke.concat($.validateSpec({key:tt,value:Ae[tt],valueSpec:Be[tt],validateSpec:$.validateSpec,style:Se,styleSpec:me})):ke.push(new $t(tt,Ae[tt],`unknown property "${tt}"`));return ke}({sourceName:f,value:l,style:h.style,styleSpec:v,validateSpec:M}),G;case"geojson":if(G=fn({key:f,value:l,valueSpec:v.source_geojson,style:E,styleSpec:v,validateSpec:M,objectElementValidators:po}),l.cluster)for(const $ in l.clusterProperties){const[X,se]=l.clusterProperties[$],Ae=typeof X=="string"?[X,["accumulated"],["get",$]]:X;G.push(...fo({key:`${f}.${$}.map`,value:se,validateSpec:M,expressionContext:"cluster-map"})),G.push(...fo({key:`${f}.${$}.reduce`,value:Ae,validateSpec:M,expressionContext:"cluster-reduce"}))}return G;case"video":return fn({key:f,value:l,valueSpec:v.source_video,style:E,validateSpec:M,styleSpec:v});case"image":return fn({key:f,value:l,valueSpec:v.source_image,style:E,validateSpec:M,styleSpec:v});case"canvas":return[new $t(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ns({key:`${f}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,validateSpec:M,styleSpec:v})}}function ro(h){const l=h.value,f=h.styleSpec,v=f.light,E=h.style;let M=[];const D=vt(l);if(l===void 0)return M;if(D!=="object")return M=M.concat([new $t("light",l,`object expected, ${D} found`)]),M;for(const G in l){const $=G.match(/^(.*)-transition$/);M=M.concat($&&v[$[1]]&&v[$[1]].transition?h.validateSpec({key:G,value:l[G],valueSpec:f.transition,validateSpec:h.validateSpec,style:E,styleSpec:f}):v[G]?h.validateSpec({key:G,value:l[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new $t(G,l[G],`unknown property "${G}"`)])}return M}function Ma(h){const l=h.value,f=h.styleSpec,v=f.terrain,E=h.style;let M=[];const D=vt(l);if(l===void 0)return M;if(D!=="object")return M=M.concat([new $t("terrain",l,`object expected, ${D} found`)]),M;for(const G in l)M=M.concat(v[G]?h.validateSpec({key:G,value:l[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new $t(G,l[G],`unknown property "${G}"`)]);return M}function ma(h){let l=[];const f=h.value,v=h.key;if(Array.isArray(f)){const E=[],M=[];for(const D in f)f[D].id&&E.includes(f[D].id)&&l.push(new $t(v,f,`all the sprites' ids must be unique, but ${f[D].id} is duplicated`)),E.push(f[D].id),f[D].url&&M.includes(f[D].url)&&l.push(new $t(v,f,`all the sprites' URLs must be unique, but ${f[D].url} is duplicated`)),M.push(f[D].url),l=l.concat(fn({key:`${v}[${D}]`,value:f[D],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return l}return io({key:v,value:f})}const Pa={"*":()=>[],array:Yn,boolean:function(h){const l=h.value,f=h.key,v=vt(l);return v!=="boolean"?[new $t(f,l,`boolean expected, ${v} found`)]:[]},number:ll,color:function(h){const l=h.key,f=h.value,v=vt(f);return v!=="string"?[new $t(l,f,`color expected, ${v} found`)]:lr.parse(String(f))?[]:[new $t(l,f,`color expected, "${f}" found`)]},constants:Lu,enum:ns,filter:ss,function:cl,layer:to,object:fn,source:ms,light:ro,terrain:Ma,string:io,formatted:function(h){return io(h).length===0?[]:fo(h)},resolvedImage:function(h){return io(h).length===0?[]:fo(h)},padding:function(h){const l=h.key,f=h.value;if(vt(f)==="array"){if(f.length<1||f.length>4)return[new $t(l,f,`padding requires 1 to 4 values; ${f.length} values found`)];const v={type:"number"};let E=[];for(let M=0;M<f.length;M++)E=E.concat(h.validateSpec({key:`${l}[${M}]`,value:f[M],validateSpec:h.validateSpec,valueSpec:v}));return E}return ll({key:l,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const l=h.key,f=h.value,v=vt(f),E=h.styleSpec;if(v!=="array"||f.length<1||f.length%2!=0)return[new $t(l,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let M=[];for(let D=0;D<f.length;D+=2)M=M.concat(ns({key:`${l}[${D}]`,value:f[D],valueSpec:E.layout_symbol["text-anchor"]})),M=M.concat(Yn({key:`${l}[${D+1}]`,value:f[D+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:E}));return M},sprite:ma};function Tn(h){const l=h.value,f=h.valueSpec,v=h.styleSpec;return h.validateSpec=Tn,f.expression&&Tt(Sn(l))?cl(h):f.expression&&Br(on(l))?fo(h):f.type&&Pa[f.type]?Pa[f.type](h):fn(Zi({},h,{valueSpec:f.type?v[f.type]:f}))}function Fo(h){const l=h.value,f=h.key,v=io(h);return v.length||(l.indexOf("{fontstack}")===-1&&v.push(new $t(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&v.push(new $t(f,l,'"glyphs" url must include a "{range}" token'))),v}function hs(h){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ut,f=[];return f=f.concat(Tn({key:"",value:h,valueSpec:l.$root,styleSpec:l,style:h,validateSpec:Tn,objectElementValidators:{glyphs:Fo,"*":()=>[]}})),h.constants&&(f=f.concat(Lu({key:"constants",value:h.constants,style:h,styleSpec:l,validateSpec:Tn}))),As(f)}function ys(h){return function(l){return h({...l,validateSpec:Tn})}}function As(h){return[].concat(h).sort((l,f)=>l.line-f.line)}function Ir(h){return function(){for(var l=arguments.length,f=new Array(l),v=0;v<l;v++)f[v]=arguments[v];return As(h.apply(this,f))}}hs.source=Ir(ys(ms)),hs.sprite=Ir(ys(ma)),hs.glyphs=Ir(ys(Fo)),hs.light=Ir(ys(ro)),hs.terrain=Ir(ys(Ma)),hs.layer=Ir(ys(to)),hs.filter=Ir(ys(ss)),hs.paintProperty=Ir(ys(ga)),hs.layoutProperty=Ir(ys(ul));const Zr=hs,an=Zr.light,Gn=Zr.paintProperty,ya=Zr.layoutProperty;function Fa(h,l){let f=!1;if(l&&l.length)for(const v of l)h.fire(new Ri(new Error(v.message))),f=!0;return f}class go{constructor(l,f,v){const E=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const D=new Int32Array(this.arrayBuffer);l=D[0],this.d=(f=D[1])+2*(v=D[2]);for(let $=0;$<this.d*this.d;$++){const X=D[3+$],se=D[3+$+1];E.push(X===se?null:D.subarray(X,se))}const G=D[3+E.length+1];this.keys=D.subarray(D[3+E.length],G),this.bboxes=D.subarray(G),this.insert=this._insertReadonly}else{this.d=f+2*v;for(let D=0;D<this.d*this.d;D++)E.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=l,this.padding=v,this.scale=f/l,this.uid=0;const M=v/f*l;this.min=-M,this.max=l+M}insert(l,f,v,E,M){this._forEachCell(f,v,E,M,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(M)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,f,v,E,M,D){this.cells[M].push(D)}query(l,f,v,E,M){const D=this.min,G=this.max;if(l<=D&&f<=D&&G<=v&&G<=E&&!M)return Array.prototype.slice.call(this.keys);{const $=[];return this._forEachCell(l,f,v,E,this._queryCell,$,{},M),$}}_queryCell(l,f,v,E,M,D,G,$){const X=this.cells[M];if(X!==null){const se=this.keys,Ae=this.bboxes;for(let me=0;me<X.length;me++){const Be=X[me];if(G[Be]===void 0){const Se=4*Be;($?$(Ae[Se+0],Ae[Se+1],Ae[Se+2],Ae[Se+3]):l<=Ae[Se+2]&&f<=Ae[Se+3]&&v>=Ae[Se+0]&&E>=Ae[Se+1])?(G[Be]=!0,D.push(se[Be])):G[Be]=!1}}}}_forEachCell(l,f,v,E,M,D,G,$){const X=this._convertToCellCoord(l),se=this._convertToCellCoord(f),Ae=this._convertToCellCoord(v),me=this._convertToCellCoord(E);for(let Be=X;Be<=Ae;Be++)for(let Se=se;Se<=me;Se++){const ke=this.d*Se+Be;if((!$||$(this._convertFromCellCoord(Be),this._convertFromCellCoord(Se),this._convertFromCellCoord(Be+1),this._convertFromCellCoord(Se+1)))&&M.call(this,l,f,v,E,ke,D,G,$))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,f=3+this.cells.length+1+1;let v=0;for(let D=0;D<this.cells.length;D++)v+=this.cells[D].length;const E=new Int32Array(f+v+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;let M=f;for(let D=0;D<l.length;D++){const G=l[D];E[3+D]=M,E.set(G,M),M+=G.length}return E[3+l.length]=M,E.set(this.keys,M),M+=this.keys.length,E[3+l.length+1]=M,E.set(this.bboxes,M),M+=this.bboxes.length,E.buffer}static serialize(l,f){const v=l.toArrayBuffer();return f&&f.push(v),{buffer:v}}static deserialize(l){return new go(l.buffer)}}const Zo={};function Oi(h,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Zo[h])throw new Error(`${h} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:h,writeable:!1}),Zo[h]={klass:l,omit:f.omit||[],shallow:f.shallow||[]}}Oi("Object",Object),Oi("TransferableGridIndex",go),Oi("Color",lr),Oi("Error",Error),Oi("AJAXError",Pt),Oi("ResolvedImage",Wi),Oi("StylePropertyFunction",Lo),Oi("StyleExpression",Hn,{omit:["_evaluator"]}),Oi("ZoomDependentExpression",qs),Oi("ZoomConstantExpression",On),Oi("CompoundExpression",gs,{omit:["_evaluate"]});for(const h in Xa)Xa[h]._classRegistryKey||Oi(`Expression_${h}`,Xa[h]);function Jo(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Pi(h,l){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob)return h;if(Jo(h)||Ft(h))return l&&l.push(h),h;if(ArrayBuffer.isView(h)){const f=h;return l&&l.push(f.buffer),f}if(h instanceof ImageData)return l&&l.push(h.data.buffer),h;if(Array.isArray(h)){const f=[];for(const v of h)f.push(Pi(v,l));return f}if(typeof h=="object"){const f=h.constructor,v=f._classRegistryKey;if(!v)throw new Error("can't serialize object of unregistered class");if(!Zo[v])throw new Error(`${v} is not registered.`);const E=f.serialize?f.serialize(h,l):{};if(f.serialize){if(l&&E===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const M in h){if(!h.hasOwnProperty(M)||Zo[v].omit.indexOf(M)>=0)continue;const D=h[M];E[M]=Zo[v].shallow.indexOf(M)>=0?D:Pi(D,l)}h instanceof Error&&(E.message=h.message)}if(E.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(E.$name=v),E}throw new Error("can't serialize object of type "+typeof h)}function hl(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||Jo(h)||Ft(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(hl);if(typeof h=="object"){const l=h.$name||"Object";if(!Zo[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:f}=Zo[l];if(!f)throw new Error(`can't deserialize unregistered class ${l}`);if(f.deserialize)return f.deserialize(h);const v=Object.create(f.prototype);for(const E of Object.keys(h)){if(E==="$name")continue;const M=h[E];v[E]=Zo[l].shallow.indexOf(E)>=0?M:hl(M)}return v}throw new Error("can't deserialize object of type "+typeof h)}class Hl{constructor(){this.first=!0}update(l,f){const v=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=f),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=v,!0))}}const Li={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Gl(h){for(const l of h)if(mo(l.charCodeAt(0)))return!0;return!1}function Ei(h){for(const l of h)if(!no(l.charCodeAt(0)))return!1;return!0}function no(h){return!(Li.Arabic(h)||Li["Arabic Supplement"](h)||Li["Arabic Extended-A"](h)||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h))}function mo(h){return!(h!==746&&h!==747&&(h<4352||!(Li["Bopomofo Extended"](h)||Li.Bopomofo(h)||Li["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Li["CJK Compatibility Ideographs"](h)||Li["CJK Compatibility"](h)||Li["CJK Radicals Supplement"](h)||Li["CJK Strokes"](h)||!(!Li["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Li["CJK Unified Ideographs Extension A"](h)||Li["CJK Unified Ideographs"](h)||Li["Enclosed CJK Letters and Months"](h)||Li["Hangul Compatibility Jamo"](h)||Li["Hangul Jamo Extended-A"](h)||Li["Hangul Jamo Extended-B"](h)||Li["Hangul Jamo"](h)||Li["Hangul Syllables"](h)||Li.Hiragana(h)||Li["Ideographic Description Characters"](h)||Li.Kanbun(h)||Li["Kangxi Radicals"](h)||Li["Katakana Phonetic Extensions"](h)||Li.Katakana(h)&&h!==12540||!(!Li["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Li["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Li["Unified Canadian Aboriginal Syllabics"](h)||Li["Unified Canadian Aboriginal Syllabics Extended"](h)||Li["Vertical Forms"](h)||Li["Yijing Hexagram Symbols"](h)||Li["Yi Syllables"](h)||Li["Yi Radicals"](h))))}function Mc(h){return!(mo(h)||function(l){return!!(Li["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Li["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Li["Letterlike Symbols"](l)||Li["Number Forms"](l)||Li["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Li["Control Pictures"](l)&&l!==9251||Li["Optical Character Recognition"](l)||Li["Enclosed Alphanumerics"](l)||Li["Geometric Shapes"](l)||Li["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Li["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Li["CJK Symbols and Punctuation"](l)||Li.Katakana(l)||Li["Private Use Area"](l)||Li["CJK Compatibility Forms"](l)||Li["Small Form Variants"](l)||Li["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(h))}function jl(h){return h>=1424&&h<=2303||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h)}function Pc(h,l){return!(!l&&jl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Li.Khmer(h))}function Fc(h){for(const l of h)if(jl(l.charCodeAt(0)))return!0;return!1}const Dc="deferred",Rc="loading",Za="loaded";let yn=null,Bs="unavailable",Do=null;const ql=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Bs="error"),yn&&yn(h)};function Mu(){Ac.fire(new xt("pluginStateChange",{pluginStatus:Bs,pluginURL:Do}))}const Ac=new ei,su=function(){return Bs},_a=function(){if(Bs!==Dc||!Do)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bs=Rc,Mu(),Do&&mi({url:Do},h=>{h?ql(h):(Bs=Za,Mu())})},$s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bs===Za||$s.applyArabicShaping!=null,isLoading:()=>Bs===Rc,setState(h){if(!Lt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Bs=h.pluginStatus,Do=h.pluginURL},isParsed(){if(!Lt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return $s.applyArabicShaping!=null&&$s.processBidirectionalText!=null&&$s.processStyledBidirectionalText!=null},getPluginURL(){if(!Lt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Do}};class bi{constructor(l,f){this.zoom=l,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hl,this.transition={})}isSupportedScript(l){return function(f,v){for(const E of f)if(!Pc(E.charCodeAt(0),v))return!1;return!0}(l,$s.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,f=l-Math.floor(l),v=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*f}}}class sr{constructor(l,f){this.property=l,this.value=f,this.expression=function(v,E){if(Tt(v))return new Lo(v,E);if(Br(v)){const M=eo(v,E);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));return M.value}{let M=v;return E.type==="color"&&typeof v=="string"?M=lr.parse(v):E.type!=="padding"||typeof v!="number"&&!Array.isArray(v)?E.type==="variableAnchorOffsetCollection"&&Array.isArray(v)&&(M=cs.parse(v)):M=xn.parse(v),{kind:"constant",evaluate:()=>M}}}(f===void 0?l.specification.default:f,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,f,v){return this.property.possiblyEvaluate(this,l,f,v)}}class $l{constructor(l){this.property=l,this.value=new sr(l,void 0)}transitioned(l,f){return new Oc(this.property,this.value,f,Ue({},l.transition,this.transition),l.now)}untransitioned(){return new Oc(this.property,this.value,null,{},0)}}class kc{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Fe(this._values[l].value.value)}setValue(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new $l(this._values[l].property)),this._values[l].value=new sr(this._values[l].property,f===null?void 0:Fe(f))}getTransition(l){return Fe(this._values[l].transition)}setTransition(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new $l(this._values[l].property)),this._values[l].transition=Fe(f)||void 0}serialize(){const l={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(l[f]=v);const E=this.getTransition(f);E!==void 0&&(l[`${f}-transition`]=E)}return l}transitioned(l,f){const v=new Cs(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].transitioned(l,f._values[E]);return v}untransitioned(){const l=new Cs(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].untransitioned();return l}}class Oc{constructor(l,f,v,E,M){this.property=l,this.value=f,this.begin=M+E.delay||0,this.end=this.begin+E.duration||0,l.specification.transition&&(E.delay||E.duration)&&(this.prior=v)}possiblyEvaluate(l,f,v){const E=l.now||0,M=this.value.possiblyEvaluate(l,f,v),D=this.prior;if(D){if(E>this.end)return this.prior=null,M;if(this.value.isDataDriven())return this.prior=null,M;if(E<this.begin)return D.possiblyEvaluate(l,f,v);{const G=(E-this.begin)/(this.end-this.begin);return this.property.interpolate(D.possiblyEvaluate(l,f,v),M,function($){if($<=0)return 0;if($>=1)return 1;const X=$*$,se=X*$;return 4*($<.5?se:3*($-X)+se-.75)}(G))}}return M}}class Cs{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,f,v){const E=new ou(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(l,f,v);return E}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class dh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Fe(this._values[l].value)}setValue(l,f){this._values[l]=new sr(this._values[l].property,f===null?void 0:Fe(f))}serialize(){const l={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(l[f]=v)}return l}possiblyEvaluate(l,f,v){const E=new ou(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(l,f,v);return E}}class jn{constructor(l,f,v){this.property=l,this.value=f,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,f,v,E){return this.property.evaluate(this.value,this.parameters,l,f,v,E)}}class ou{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class $i{constructor(l){this.specification=l}possiblyEvaluate(l,f){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(f)}interpolate(l,f,v){const E=us[this.specification.type];return E?E(l,f,v):l}}class Ni{constructor(l,f){this.specification=l,this.overrides=f}possiblyEvaluate(l,f,v,E){return new jn(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(f,null,{},v,E)}:l.expression,f)}interpolate(l,f,v){if(l.value.kind!=="constant"||f.value.kind!=="constant")return l;if(l.value.value===void 0||f.value.value===void 0)return new jn(this,{kind:"constant",value:void 0},l.parameters);const E=us[this.specification.type];if(E){const M=E(l.value.value,f.value.value,v);return new jn(this,{kind:"constant",value:M},l.parameters)}return l}evaluate(l,f,v,E,M,D){return l.kind==="constant"?l.value:l.evaluate(f,v,E,M,D)}}class qn extends Ni{possiblyEvaluate(l,f,v,E){if(l.value===void 0)return new jn(this,{kind:"constant",value:void 0},f);if(l.expression.kind==="constant"){const M=l.expression.evaluate(f,null,{},v,E),D=l.property.specification.type==="resolvedImage"&&typeof M!="string"?M.name:M,G=this._calculate(D,D,D,f);return new jn(this,{kind:"constant",value:G},f)}if(l.expression.kind==="camera"){const M=this._calculate(l.expression.evaluate({zoom:f.zoom-1}),l.expression.evaluate({zoom:f.zoom}),l.expression.evaluate({zoom:f.zoom+1}),f);return new jn(this,{kind:"constant",value:M},f)}return new jn(this,l.expression,f)}evaluate(l,f,v,E,M,D){if(l.kind==="source"){const G=l.evaluate(f,v,E,M,D);return this._calculate(G,G,G,f)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(f.zoom)-1},v,E),l.evaluate({zoom:Math.floor(f.zoom)},v,E),l.evaluate({zoom:Math.floor(f.zoom)+1},v,E),f):l.value}_calculate(l,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:v,to:f}}interpolate(l){return l}}class Pu{constructor(l){this.specification=l}possiblyEvaluate(l,f,v,E){if(l.value!==void 0){if(l.expression.kind==="constant"){const M=l.expression.evaluate(f,null,{},v,E);return this._calculate(M,M,M,f)}return this._calculate(l.expression.evaluate(new bi(Math.floor(f.zoom-1),f)),l.expression.evaluate(new bi(Math.floor(f.zoom),f)),l.expression.evaluate(new bi(Math.floor(f.zoom+1),f)),f)}}_calculate(l,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:v,to:f}}interpolate(l){return l}}class Ds{constructor(l){this.specification=l}possiblyEvaluate(l,f,v,E){return!!l.expression.evaluate(f,null,{},v,E)}interpolate(){return!1}}class tn{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in l){const v=l[f];v.specification.overridable&&this.overridableProperties.push(f);const E=this.defaultPropertyValues[f]=new sr(v,void 0),M=this.defaultTransitionablePropertyValues[f]=new $l(v);this.defaultTransitioningPropertyValues[f]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=E.possiblyEvaluate({})}}}Oi("DataDrivenProperty",Ni),Oi("DataConstantProperty",$i),Oi("CrossFadedDataDrivenProperty",qn),Oi("CrossFadedProperty",Pu),Oi("ColorRampProperty",Ds);const Yo="-transition";class Ro extends ei{constructor(l,f){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),f.layout&&(this._unevaluatedLayout=new dh(f.layout)),f.paint)){this._transitionablePaint=new kc(f.paint);for(const v in l.paint)this.setPaintProperty(v,l.paint[v],{validate:!1});for(const v in l.layout)this.setLayoutProperty(v,l.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ou(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};f!=null&&this._validate(ya,`layers.${this.id}.layout.${l}`,l,f,v)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,f):this.visibility=f)}getPaintProperty(l){return l.endsWith(Yo)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(f!=null&&this._validate(Gn,`layers.${this.id}.paint.${l}`,l,f,v))return!1;if(l.endsWith(Yo))return this._transitionablePaint.setTransition(l.slice(0,-11),f||void 0),!1;{const E=this._transitionablePaint._values[l],M=E.property.specification["property-type"]==="cross-faded-data-driven",D=E.value.isDataDriven(),G=E.value;this._transitionablePaint.setValue(l,f),this._handleSpecialPaintPropertyUpdate(l);const $=this._transitionablePaint._values[l].value;return $.isDataDriven()||D||M||this._handleOverridablePaintPropertyUpdate(l,G,$)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,f,v){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,f){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,f)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),De(l,(f,v)=>!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length))}_validate(l,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!M||M.validate!==!1)&&Fa(this,l.call(Zr,{key:f,layerType:this.type,objectKey:v,value:E,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const f=this.paint.get(l);if(f instanceof jn&&Ie(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const au={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rs{constructor(l,f){this._structArray=l,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,f){return l._trim(),f&&(l.isTransferred=!0,f.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const f=Object.create(this.prototype);return f.arrayBuffer=l.arrayBuffer,f.length=l.length,f.capacity=l.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Un(h){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=0,v=0;return{members:h.map(E=>{const M=au[E.type].BYTES_PER_ELEMENT,D=f=ko(f,Math.max(l,M)),G=E.components||1;return v=Math.max(v,M),f+=M*G,{name:E.name,type:E.type,components:G,offset:D}}),size:ko(f,Math.max(v,l)),alignment:l}}function ko(h,l){return Math.ceil(h/l)*l}class Al extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f){const v=this.length;return this.resize(v+1),this.emplace(v,l,f)}emplace(l,f,v){const E=2*l;return this.int16[E+0]=f,this.int16[E+1]=v,l}}Al.prototype.bytesPerElement=4,Oi("StructArrayLayout2i4",Al);class Ja extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,f,v)}emplace(l,f,v,E){const M=3*l;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=E,l}}Ja.prototype.bytesPerElement=6,Oi("StructArrayLayout3i6",Ja);class Da extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,v,E)}emplace(l,f,v,E,M){const D=4*l;return this.int16[D+0]=f,this.int16[D+1]=v,this.int16[D+2]=E,this.int16[D+3]=M,l}}Da.prototype.bytesPerElement=8,Oi("StructArrayLayout4i8",Da);class Kl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,l,f,v,E,M,D)}emplace(l,f,v,E,M,D,G){const $=6*l;return this.int16[$+0]=f,this.int16[$+1]=v,this.int16[$+2]=E,this.int16[$+3]=M,this.int16[$+4]=D,this.int16[$+5]=G,l}}Kl.prototype.bytesPerElement=12,Oi("StructArrayLayout2i4i12",Kl);class lu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,l,f,v,E,M,D)}emplace(l,f,v,E,M,D,G){const $=4*l,X=8*l;return this.int16[$+0]=f,this.int16[$+1]=v,this.uint8[X+4]=E,this.uint8[X+5]=M,this.uint8[X+6]=D,this.uint8[X+7]=G,l}}lu.prototype.bytesPerElement=8,Oi("StructArrayLayout2i4ub8",lu);class yo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f){const v=this.length;return this.resize(v+1),this.emplace(v,l,f)}emplace(l,f,v){const E=2*l;return this.float32[E+0]=f,this.float32[E+1]=v,l}}yo.prototype.bytesPerElement=8,Oi("StructArrayLayout2f8",yo);class va extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D,G,$,X,se){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,l,f,v,E,M,D,G,$,X,se)}emplace(l,f,v,E,M,D,G,$,X,se,Ae){const me=10*l;return this.uint16[me+0]=f,this.uint16[me+1]=v,this.uint16[me+2]=E,this.uint16[me+3]=M,this.uint16[me+4]=D,this.uint16[me+5]=G,this.uint16[me+6]=$,this.uint16[me+7]=X,this.uint16[me+8]=se,this.uint16[me+9]=Ae,l}}va.prototype.bytesPerElement=20,Oi("StructArrayLayout10ui20",va);class dl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D,G,$,X,se,Ae,me){const Be=this.length;return this.resize(Be+1),this.emplace(Be,l,f,v,E,M,D,G,$,X,se,Ae,me)}emplace(l,f,v,E,M,D,G,$,X,se,Ae,me,Be){const Se=12*l;return this.int16[Se+0]=f,this.int16[Se+1]=v,this.int16[Se+2]=E,this.int16[Se+3]=M,this.uint16[Se+4]=D,this.uint16[Se+5]=G,this.uint16[Se+6]=$,this.uint16[Se+7]=X,this.int16[Se+8]=se,this.int16[Se+9]=Ae,this.int16[Se+10]=me,this.int16[Se+11]=Be,l}}dl.prototype.bytesPerElement=24,Oi("StructArrayLayout4i4ui4i24",dl);class Gr extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,f,v)}emplace(l,f,v,E){const M=3*l;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,l}}Gr.prototype.bytesPerElement=12,Oi("StructArrayLayout3f12",Gr);class N extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint32[1*l+0]=f,l}}N.prototype.bytesPerElement=4,Oi("StructArrayLayout1ul4",N);class A extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D,G,$,X){const se=this.length;return this.resize(se+1),this.emplace(se,l,f,v,E,M,D,G,$,X)}emplace(l,f,v,E,M,D,G,$,X,se){const Ae=10*l,me=5*l;return this.int16[Ae+0]=f,this.int16[Ae+1]=v,this.int16[Ae+2]=E,this.int16[Ae+3]=M,this.int16[Ae+4]=D,this.int16[Ae+5]=G,this.uint32[me+3]=$,this.uint16[Ae+8]=X,this.uint16[Ae+9]=se,l}}A.prototype.bytesPerElement=20,Oi("StructArrayLayout6i1ul2ui20",A);class b extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,l,f,v,E,M,D)}emplace(l,f,v,E,M,D,G){const $=6*l;return this.int16[$+0]=f,this.int16[$+1]=v,this.int16[$+2]=E,this.int16[$+3]=M,this.int16[$+4]=D,this.int16[$+5]=G,l}}b.prototype.bytesPerElement=12,Oi("StructArrayLayout2i2i2i12",b);class L extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M){const D=this.length;return this.resize(D+1),this.emplace(D,l,f,v,E,M)}emplace(l,f,v,E,M,D){const G=4*l,$=8*l;return this.float32[G+0]=f,this.float32[G+1]=v,this.float32[G+2]=E,this.int16[$+6]=M,this.int16[$+7]=D,l}}L.prototype.bytesPerElement=16,Oi("StructArrayLayout2f1f2i16",L);class k extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,v,E)}emplace(l,f,v,E,M){const D=12*l,G=3*l;return this.uint8[D+0]=f,this.uint8[D+1]=v,this.float32[G+1]=E,this.float32[G+2]=M,l}}k.prototype.bytesPerElement=12,Oi("StructArrayLayout2ub2f12",k);class y extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,f,v)}emplace(l,f,v,E){const M=3*l;return this.uint16[M+0]=f,this.uint16[M+1]=v,this.uint16[M+2]=E,l}}y.prototype.bytesPerElement=6,Oi("StructArrayLayout3ui6",y);class a extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe){const ct=this.length;return this.resize(ct+1),this.emplace(ct,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe)}emplace(l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct){const Ye=24*l,tt=12*l,gt=48*l;return this.int16[Ye+0]=f,this.int16[Ye+1]=v,this.uint16[Ye+2]=E,this.uint16[Ye+3]=M,this.uint32[tt+2]=D,this.uint32[tt+3]=G,this.uint32[tt+4]=$,this.uint16[Ye+10]=X,this.uint16[Ye+11]=se,this.uint16[Ye+12]=Ae,this.float32[tt+7]=me,this.float32[tt+8]=Be,this.uint8[gt+36]=Se,this.uint8[gt+37]=ke,this.uint8[gt+38]=He,this.uint32[tt+10]=qe,this.int16[Ye+22]=ct,l}}a.prototype.bytesPerElement=48,Oi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",a);class d extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi)}emplace(l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke,He,qe,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi,ai){const Zt=32*l,Vi=16*l;return this.int16[Zt+0]=f,this.int16[Zt+1]=v,this.int16[Zt+2]=E,this.int16[Zt+3]=M,this.int16[Zt+4]=D,this.int16[Zt+5]=G,this.int16[Zt+6]=$,this.int16[Zt+7]=X,this.uint16[Zt+8]=se,this.uint16[Zt+9]=Ae,this.uint16[Zt+10]=me,this.uint16[Zt+11]=Be,this.uint16[Zt+12]=Se,this.uint16[Zt+13]=ke,this.uint16[Zt+14]=He,this.uint16[Zt+15]=qe,this.uint16[Zt+16]=ct,this.uint16[Zt+17]=Ye,this.uint16[Zt+18]=tt,this.uint16[Zt+19]=gt,this.uint16[Zt+20]=St,this.uint16[Zt+21]=Xt,this.uint16[Zt+22]=xi,this.uint32[Vi+12]=oi,this.float32[Vi+13]=Ai,this.float32[Vi+14]=fi,this.uint16[Zt+30]=Fi,this.uint16[Zt+31]=ai,l}}d.prototype.bytesPerElement=64,Oi("StructArrayLayout8i15ui1ul2f2ui64",d);class _ extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.float32[1*l+0]=f,l}}_.prototype.bytesPerElement=4,Oi("StructArrayLayout1f4",_);class B extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,f,v)}emplace(l,f,v,E){const M=3*l;return this.uint16[6*l+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,l}}B.prototype.bytesPerElement=12,Oi("StructArrayLayout1ui2f12",B);class S extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,f,v)}emplace(l,f,v,E){const M=4*l;return this.uint32[2*l+0]=f,this.uint16[M+2]=v,this.uint16[M+3]=E,l}}S.prototype.bytesPerElement=8,Oi("StructArrayLayout1ul2ui8",S);class U extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f){const v=this.length;return this.resize(v+1),this.emplace(v,l,f)}emplace(l,f,v){const E=2*l;return this.uint16[E+0]=f,this.uint16[E+1]=v,l}}U.prototype.bytesPerElement=4,Oi("StructArrayLayout2ui4",U);class H extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint16[1*l+0]=f,l}}H.prototype.bytesPerElement=2,Oi("StructArrayLayout1ui2",H);class q extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,v,E)}emplace(l,f,v,E,M){const D=4*l;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=E,this.float32[D+3]=M,l}}q.prototype.bytesPerElement=16,Oi("StructArrayLayout4f16",q);class w extends Rs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new O(this.anchorPointX,this.anchorPointY)}}w.prototype.size=20;class T extends A{get(l){return new w(this,l)}}Oi("CollisionBoxArray",T);class R extends Rs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}R.prototype.size=48;class j extends a{get(l){return new R(this,l)}}Oi("PlacedSymbolArray",j);class Z extends Rs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Z.prototype.size=64;class W extends d{get(l){return new Z(this,l)}}Oi("SymbolInstanceArray",W);class J extends _{getoffsetX(l){return this.float32[1*l+0]}}Oi("GlyphOffsetArray",J);class ee extends Ja{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Oi("SymbolLineVertexArray",ee);class ae extends Rs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ae.prototype.size=12;class fe extends B{get(l){return new ae(this,l)}}Oi("TextAnchorOffsetArray",fe);class pe extends Rs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pe.prototype.size=8;class xe extends S{get(l){return new pe(this,l)}}Oi("FeatureIndexArray",xe);class Pe extends Al{}class Le extends Al{}class rt extends Al{}class Ke extends Kl{}class Re extends lu{}class Qe extends yo{}class pt extends va{}class bt extends dl{}class ht extends Gr{}class Rt extends N{}class Dt extends b{}class hi extends k{}class Vt extends y{}class _i extends U{}const Si=Un([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yi}=Si;class Ti{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=l}prepareSegment(l,f,v,E){let M=this.segments[this.segments.length-1];return l>Ti.MAX_VERTEX_ARRAY_LENGTH&&We(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!M||M.vertexLength+l>Ti.MAX_VERTEX_ARRAY_LENGTH||M.sortKey!==E)&&(M={vertexOffset:f.length,primitiveOffset:v.length,vertexLength:0,primitiveLength:0},E!==void 0&&(M.sortKey=E),this.segments.push(M)),M}get(){return this.segments}destroy(){for(const l of this.segments)for(const f in l.vaos)l.vaos[f].destroy()}static simpleSegment(l,f,v,E){return new Ti([{vertexOffset:l,primitiveOffset:f,vertexLength:v,primitiveLength:E,vaos:{},sortKey:0}])}}function yr(h,l){return 256*(h=Ge(Math.floor(h),0,255))+Ge(Math.floor(l),0,255)}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Oi("SegmentVector",Ti);const fr=Un([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ji={exports:{}},Ur={exports:{}};Ur.exports=function(h,l){var f,v,E,M,D,G,$,X;for(v=h.length-(f=3&h.length),E=l,D=3432918353,G=461845907,X=0;X<v;)$=255&h.charCodeAt(X)|(255&h.charCodeAt(++X))<<8|(255&h.charCodeAt(++X))<<16|(255&h.charCodeAt(++X))<<24,++X,E=27492+(65535&(M=5*(65535&(E=(E^=$=(65535&($=($=(65535&$)*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch($=0,f){case 3:$^=(255&h.charCodeAt(X+2))<<16;case 2:$^=(255&h.charCodeAt(X+1))<<8;case 1:E^=$=(65535&($=($=(65535&($^=255&h.charCodeAt(X)))*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295}return E^=h.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0};var rn=Ur.exports,Mr={exports:{}};Mr.exports=function(h,l){for(var f,v=h.length,E=l^v,M=0;v>=4;)f=1540483477*(65535&(f=255&h.charCodeAt(M)|(255&h.charCodeAt(++M))<<8|(255&h.charCodeAt(++M))<<16|(255&h.charCodeAt(++M))<<24))+((1540483477*(f>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++M;switch(v){case 3:E^=(255&h.charCodeAt(M+2))<<16;case 2:E^=(255&h.charCodeAt(M+1))<<8;case 1:E=1540483477*(65535&(E^=255&h.charCodeAt(M)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0};var Kr=rn,Cr=Mr.exports;ji.exports=Kr,ji.exports.murmur3=Kr,ji.exports.murmur2=Cr;var es=x(ji.exports);class Nr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,f,v,E){this.ids.push(pr(l)),this.positions.push(f,v,E)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=pr(l);let v=0,E=this.ids.length-1;for(;v<E;){const D=v+E>>1;this.ids[D]>=f?E=D:v=D+1}const M=[];for(;this.ids[v]===f;)M.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return M}static serialize(l,f){const v=new Float64Array(l.ids),E=new Uint32Array(l.positions);return _r(v,E,0,v.length-1),f&&f.push(v.buffer,E.buffer),{ids:v,positions:E}}static deserialize(l){const f=new Nr;return f.ids=l.ids,f.positions=l.positions,f.indexed=!0,f}}function pr(h){const l=+h;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:es(String(h))}function _r(h,l,f,v){for(;f<v;){const E=h[f+v>>1];let M=f-1,D=v+1;for(;;){do M++;while(h[M]<E);do D--;while(h[D]>E);if(M>=D)break;or(h,M,D),or(l,3*M,3*D),or(l,3*M+1,3*D+1),or(l,3*M+2,3*D+2)}D-f<v-D?(_r(h,l,f,D),f=D+1):(_r(h,l,D+1,v),v=D)}}function or(h,l,f){const v=h[l];h[l]=h[f],h[f]=v}Oi("FeaturePositionMap",Nr);class ln{constructor(l,f){this.gl=l.gl,this.location=f}}class qr extends ln{constructor(l,f){super(l,f),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Wr extends ln{constructor(l,f){super(l,f),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class Mn extends ln{constructor(l,f){super(l,f),this.current=lr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const $n=new Float32Array(16);function fl(h){return[yr(255*h.r,255*h.g),yr(255*h.b,255*h.a)]}class $r{constructor(l,f,v){this.value=l,this.uniformNames=f.map(E=>`u_${E}`),this.type=v}setUniform(l,f,v){l.set(v.constantOr(this.value))}getBinding(l,f,v){return this.type==="color"?new Mn(l,f):new qr(l,f)}}class _n{constructor(l,f){this.uniformNames=f.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=l.tlbr}setUniform(l,f,v,E){const M=E==="u_pattern_to"?this.patternTo:E==="u_pattern_from"?this.patternFrom:E==="u_pixel_ratio_to"?this.pixelRatioTo:E==="u_pixel_ratio_from"?this.pixelRatioFrom:null;M&&l.set(M)}getBinding(l,f,v){return v.substr(0,9)==="u_pattern"?new Wr(l,f):new qr(l,f)}}class ea{constructor(l,f,v,E){this.expression=l,this.type=v,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new E}populatePaintArray(l,f,v,E,M){const D=this.paintVertexArray.length,G=this.expression.evaluate(new bi(0),f,{},E,[],M);this.paintVertexArray.resize(l),this._setPaintValue(D,l,G)}updatePaintArray(l,f,v,E){const M=this.expression.evaluate({zoom:0},v,E);this._setPaintValue(l,f,M)}_setPaintValue(l,f,v){if(this.type==="color"){const E=fl(v);for(let M=l;M<f;M++)this.paintVertexArray.emplace(M,E[0],E[1])}else{for(let E=l;E<f;E++)this.paintVertexArray.emplace(E,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(l,f,v,E,M,D){this.expression=l,this.uniformNames=f.map(G=>`u_${G}_t`),this.type=v,this.useIntegerZoom=E,this.zoom=M,this.maxValue=0,this.paintVertexAttributes=f.map(G=>({name:`a_${G}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new D}populatePaintArray(l,f,v,E,M){const D=this.expression.evaluate(new bi(this.zoom),f,{},E,[],M),G=this.expression.evaluate(new bi(this.zoom+1),f,{},E,[],M),$=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue($,l,D,G)}updatePaintArray(l,f,v,E){const M=this.expression.evaluate({zoom:this.zoom},v,E),D=this.expression.evaluate({zoom:this.zoom+1},v,E);this._setPaintValue(l,f,M,D)}_setPaintValue(l,f,v,E){if(this.type==="color"){const M=fl(v),D=fl(E);for(let G=l;G<f;G++)this.paintVertexArray.emplace(G,M[0],M[1],D[0],D[1])}else{for(let M=l;M<f;M++)this.paintVertexArray.emplace(M,v,E);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(E))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,f){const v=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,E=Ge(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(E)}getBinding(l,f,v){return new qr(l,f)}}class Ks{constructor(l,f,v,E,M,D){this.expression=l,this.type=f,this.useIntegerZoom=v,this.zoom=E,this.layerId=D,this.zoomInPaintVertexArray=new M,this.zoomOutPaintVertexArray=new M}populatePaintArray(l,f,v){const E=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(E,l,f.patterns&&f.patterns[this.layerId],v)}updatePaintArray(l,f,v,E,M){this._setPaintValues(l,f,v.patterns&&v.patterns[this.layerId],M)}_setPaintValues(l,f,v,E){if(!E||!v)return;const{min:M,mid:D,max:G}=v,$=E[M],X=E[D],se=E[G];if($&&X&&se)for(let Ae=l;Ae<f;Ae++)this.zoomInPaintVertexArray.emplace(Ae,X.tl[0],X.tl[1],X.br[0],X.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],X.pixelRatio,$.pixelRatio),this.zoomOutPaintVertexArray.emplace(Ae,X.tl[0],X.tl[1],X.br[0],X.br[1],se.tl[0],se.tl[1],se.br[0],se.br[1],X.pixelRatio,se.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,fr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,fr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Oo{constructor(l,f,v){this.binders={},this._buffers=[];const E=[];for(const M in l.paint._values){if(!v(M))continue;const D=l.paint.get(M);if(!(D instanceof jn&&Ie(D.property.specification)))continue;const G=Fu(M,l.type),$=D.value,X=D.property.specification.type,se=D.property.useIntegerZoom,Ae=D.property.specification["property-type"],me=Ae==="cross-faded"||Ae==="cross-faded-data-driven";if($.kind==="constant")this.binders[M]=me?new _n($.value,G):new $r($.value,G,X),E.push(`/u_${M}`);else if($.kind==="source"||me){const Be=Ra(M,X,"source");this.binders[M]=me?new Ks($,X,se,f,Be,l.id):new ea($,G,X,Be),E.push(`/a_${M}`)}else{const Be=Ra(M,X,"composite");this.binders[M]=new ks($,G,X,se,f,Be),E.push(`/z_${M}`)}}this.cacheKey=E.sort().join("")}getMaxValue(l){const f=this.binders[l];return f instanceof ea||f instanceof ks?f.maxValue:0}populatePaintArrays(l,f,v,E,M){for(const D in this.binders){const G=this.binders[D];(G instanceof ea||G instanceof ks||G instanceof Ks)&&G.populatePaintArray(l,f,v,E,M)}}setConstantPatternPositions(l,f){for(const v in this.binders){const E=this.binders[v];E instanceof _n&&E.setConstantPatternPositions(l,f)}}updatePaintArrays(l,f,v,E,M){let D=!1;for(const G in l){const $=f.getPositions(G);for(const X of $){const se=v.feature(X.index);for(const Ae in this.binders){const me=this.binders[Ae];if((me instanceof ea||me instanceof ks||me instanceof Ks)&&me.expression.isStateDependent===!0){const Be=E.paint.get(Ae);me.expression=Be.value,me.updatePaintArray(X.start,X.end,se,l[G],M),D=!0}}}}return D}defines(){const l=[];for(const f in this.binders){const v=this.binders[f];(v instanceof $r||v instanceof _n)&&l.push(...v.uniformNames.map(E=>`#define HAS_UNIFORM_${E}`))}return l}getBinderAttributes(){const l=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof ea||v instanceof ks)for(let E=0;E<v.paintVertexAttributes.length;E++)l.push(v.paintVertexAttributes[E].name);else if(v instanceof Ks)for(let E=0;E<fr.members.length;E++)l.push(fr.members[E].name)}return l}getBinderUniforms(){const l=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof $r||v instanceof _n||v instanceof ks)for(const E of v.uniformNames)l.push(E)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,f){const v=[];for(const E in this.binders){const M=this.binders[E];if(M instanceof $r||M instanceof _n||M instanceof ks){for(const D of M.uniformNames)if(f[D]){const G=M.getBinding(l,f[D],D);v.push({name:D,property:E,binding:G})}}}return v}setUniforms(l,f,v,E){for(const{name:M,property:D,binding:G}of f)this.binders[D].setUniform(G,E,v.get(D),M)}updatePaintBuffers(l){this._buffers=[];for(const f in this.binders){const v=this.binders[f];if(l&&v instanceof Ks){const E=l.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;E&&this._buffers.push(E)}else(v instanceof ea||v instanceof ks)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(l){for(const f in this.binders){const v=this.binders[f];(v instanceof ea||v instanceof ks||v instanceof Ks)&&v.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const f=this.binders[l];(f instanceof ea||f instanceof ks||f instanceof Ks)&&f.destroy()}}}class so{constructor(l,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const E of l)this.programConfigurations[E.id]=new Oo(E,f,v);this.needsUpload=!1,this._featureMap=new Nr,this._bufferOffset=0}populatePaintArrays(l,f,v,E,M,D){for(const G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(l,f,E,M,D);f.id!==void 0&&this._featureMap.add(f.id,v,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,f,v,E){for(const M of v)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(l,this._featureMap,f,M,E)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function Fu(h,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${l}-`,"").replace(/-/g,"_")]}function Ra(h,l,f){const v={color:{source:yo,composite:q},number:{source:_,composite:yo}},E=function(M){return{"line-pattern":{source:pt,composite:pt},"fill-pattern":{source:pt,composite:pt},"fill-extrusion-pattern":{source:pt,composite:pt}}[M]}(h);return E&&E[f]||v[l][f]}Oi("ConstantBinder",$r),Oi("CrossFadedConstantBinder",_n),Oi("SourceExpressionBinder",ea),Oi("CrossFadedCompositeBinder",Ks),Oi("CompositeExpressionBinder",ks),Oi("ProgramConfiguration",Oo,{omit:["_buffers"]}),Oi("ProgramConfigurationSet",so);const In=8192,dc=Math.pow(2,14)-1,cu=-dc-1;function Uc(h){const l=In/h.extent,f=h.loadGeometry();for(let v=0;v<f.length;v++){const E=f[v];for(let M=0;M<E.length;M++){const D=E[M],G=Math.round(D.x*l),$=Math.round(D.y*l);D.x=Ge(G,cu,dc),D.y=Ge($,cu,dc),(G<D.x||G>D.x+1||$<D.y||$>D.y+1)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Nc(h,l){return{type:h.type,id:h.id,properties:h.properties,geometry:l?Uc(h):[]}}function Du(h,l,f,v,E){h.emplaceBack(2*l+(v+1)/2,2*f+(E+1)/2)}class Xh{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.indexArray=new Vt,this.segments=new Ti,this.programConfigurations=new so(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,v){const E=this.layers[0],M=[];let D=null,G=!1;E.type==="circle"&&(D=E.layout.get("circle-sort-key"),G=!D.isConstant());for(const{feature:$,id:X,index:se,sourceLayerIndex:Ae}of l){const me=this.layers[0]._featureFilter.needGeometry,Be=Nc($,me);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),Be,v))continue;const Se=G?D.evaluate(Be,{},v):void 0,ke={id:X,properties:$.properties,type:$.type,sourceLayerIndex:Ae,index:se,geometry:me?Be.geometry:Uc($),patterns:{},sortKey:Se};M.push(ke)}G&&M.sort(($,X)=>$.sortKey-X.sortKey);for(const $ of M){const{geometry:X,index:se,sourceLayerIndex:Ae}=$,me=l[se].feature;this.addFeature($,X,se,v),f.featureIndex.insert(me,X,se,Ae,this.index)}}update(l,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Yi),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,f,v,E){for(const M of f)for(const D of M){const G=D.x,$=D.y;if(G<0||G>=In||$<0||$>=In)continue;const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),se=X.vertexLength;Du(this.layoutVertexArray,G,$,-1,-1),Du(this.layoutVertexArray,G,$,1,-1),Du(this.layoutVertexArray,G,$,1,1),Du(this.layoutVertexArray,G,$,-1,1),this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+3,se+2),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,v,{},E)}}function zc(h,l){for(let f=0;f<h.length;f++)if(Wl(l,h[f]))return!0;for(let f=0;f<l.length;f++)if(Wl(h,l[f]))return!0;return!!Ru(h,l)}function DA(h,l,f){return!!Wl(h,l)||!!wd(l,h,f)}function Zh(h,l){if(h.length===1)return ta(l,h[0]);for(let f=0;f<l.length;f++){const v=l[f];for(let E=0;E<v.length;E++)if(Wl(h,v[E]))return!0}for(let f=0;f<h.length;f++)if(ta(l,h[f]))return!0;for(let f=0;f<l.length;f++)if(Ru(h,l[f]))return!0;return!1}function xd(h,l,f){if(h.length>1){if(Ru(h,l))return!0;for(let v=0;v<l.length;v++)if(wd(l[v],h,f))return!0}for(let v=0;v<h.length;v++)if(wd(h[v],l,f))return!0;return!1}function Ru(h,l){if(h.length===0||l.length===0)return!1;for(let f=0;f<h.length-1;f++){const v=h[f],E=h[f+1];for(let M=0;M<l.length-1;M++)if(uu(v,E,l[M],l[M+1]))return!0}return!1}function uu(h,l,f,v){return Et(h,f,v)!==Et(l,f,v)&&Et(h,l,f)!==Et(h,l,v)}function wd(h,l,f){const v=f*f;if(l.length===1)return h.distSqr(l[0])<v;for(let E=1;E<l.length;E++)if(jg(h,l[E-1],l[E])<v)return!0;return!1}function jg(h,l,f){const v=l.distSqr(f);if(v===0)return h.distSqr(l);const E=((h.x-l.x)*(f.x-l.x)+(h.y-l.y)*(f.y-l.y))/v;return h.distSqr(E<0?l:E>1?f:f.sub(l)._mult(E)._add(l))}function ta(h,l){let f,v,E,M=!1;for(let D=0;D<h.length;D++){f=h[D];for(let G=0,$=f.length-1;G<f.length;$=G++)v=f[G],E=f[$],v.y>l.y!=E.y>l.y&&l.x<(E.x-v.x)*(l.y-v.y)/(E.y-v.y)+v.x&&(M=!M)}return M}function Wl(h,l){let f=!1;for(let v=0,E=h.length-1;v<h.length;E=v++){const M=h[v],D=h[E];M.y>l.y!=D.y>l.y&&l.x<(D.x-M.x)*(l.y-M.y)/(D.y-M.y)+M.x&&(f=!f)}return f}function Jh(h,l,f){const v=f[0],E=f[2];if(h.x<v.x&&l.x<v.x||h.x>E.x&&l.x>E.x||h.y<v.y&&l.y<v.y||h.y>E.y&&l.y>E.y)return!1;const M=Et(h,l,f[0]);return M!==Et(h,l,f[1])||M!==Et(h,l,f[2])||M!==Et(h,l,f[3])}function fh(h,l,f){const v=l.paint.get(h).value;return v.kind==="constant"?v.value:f.programConfigurations.get(l.id).getMaxValue(h)}function hu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function ph(h,l,f,v,E){if(!l[0]&&!l[1])return h;const M=O.convert(l)._mult(E);f==="viewport"&&M._rotate(-v);const D=[];for(let G=0;G<h.length;G++)D.push(h[G].sub(M));return D}let gh,Yh;Oi("CircleBucket",Xh,{omit:["layers"]});var kf={get paint(){return Yh=Yh||new tn({"circle-radius":new Ni(ut.paint_circle["circle-radius"]),"circle-color":new Ni(ut.paint_circle["circle-color"]),"circle-blur":new Ni(ut.paint_circle["circle-blur"]),"circle-opacity":new Ni(ut.paint_circle["circle-opacity"]),"circle-translate":new $i(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new $i(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $i(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $i(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ni(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ni(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ni(ut.paint_circle["circle-stroke-opacity"])})},get layout(){return gh=gh||new tn({"circle-sort-key":new Ni(ut.layout_circle["circle-sort-key"])})}},ia=1e-6,Qc=typeof Float32Array<"u"?Float32Array:Array;function Bd(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function eA(h,l,f){var v=l[0],E=l[1],M=l[2],D=l[3],G=l[4],$=l[5],X=l[6],se=l[7],Ae=l[8],me=l[9],Be=l[10],Se=l[11],ke=l[12],He=l[13],qe=l[14],ct=l[15],Ye=f[0],tt=f[1],gt=f[2],St=f[3];return h[0]=Ye*v+tt*G+gt*Ae+St*ke,h[1]=Ye*E+tt*$+gt*me+St*He,h[2]=Ye*M+tt*X+gt*Be+St*qe,h[3]=Ye*D+tt*se+gt*Se+St*ct,h[4]=(Ye=f[4])*v+(tt=f[5])*G+(gt=f[6])*Ae+(St=f[7])*ke,h[5]=Ye*E+tt*$+gt*me+St*He,h[6]=Ye*M+tt*X+gt*Be+St*qe,h[7]=Ye*D+tt*se+gt*Se+St*ct,h[8]=(Ye=f[8])*v+(tt=f[9])*G+(gt=f[10])*Ae+(St=f[11])*ke,h[9]=Ye*E+tt*$+gt*me+St*He,h[10]=Ye*M+tt*X+gt*Be+St*qe,h[11]=Ye*D+tt*se+gt*Se+St*ct,h[12]=(Ye=f[12])*v+(tt=f[13])*G+(gt=f[14])*Ae+(St=f[15])*ke,h[13]=Ye*E+tt*$+gt*me+St*He,h[14]=Ye*M+tt*X+gt*Be+St*qe,h[15]=Ye*D+tt*se+gt*Se+St*ct,h}Math.hypot||(Math.hypot=function(){for(var h=0,l=arguments.length;l--;)h+=arguments[l]*arguments[l];return Math.sqrt(h)});var pl,Cd=eA;function Au(h,l,f){var v=l[0],E=l[1],M=l[2],D=l[3];return h[0]=f[0]*v+f[4]*E+f[8]*M+f[12]*D,h[1]=f[1]*v+f[5]*E+f[9]*M+f[13]*D,h[2]=f[2]*v+f[6]*E+f[10]*M+f[14]*D,h[3]=f[3]*v+f[7]*E+f[11]*M+f[15]*D,h}pl=new Qc(4),Qc!=Float32Array&&(pl[0]=0,pl[1]=0,pl[2]=0,pl[3]=0);class gl extends Ro{constructor(l){super(l,kf)}createBucket(l){return new Xh(l)}queryRadius(l){const f=l;return fh("circle-radius",this,f)+fh("circle-stroke-width",this,f)+hu(this.paint.get("circle-translate"))}queryIntersectsFeature(l,f,v,E,M,D,G,$){const X=ph(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),D.angle,G),se=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),Ae=this.paint.get("circle-pitch-alignment")==="map",me=Ae?X:function(Se,ke){return Se.map(He=>Ed(He,ke))}(X,$),Be=Ae?se*G:se;for(const Se of E)for(const ke of Se){const He=Ae?ke:Ed(ke,$);let qe=Be;const ct=Au([],[ke.x,ke.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?qe*=ct[3]/D.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(qe*=D.cameraToCenterDistance/ct[3]),DA(me,He,qe))return!0}return!1}}function Ed(h,l){const f=Au([],[h.x,h.y,0,1],l);return new O(f[0]/f[3],f[1]/f[3])}class mh extends Xh{}let Of;Oi("HeatmapBucket",mh,{omit:["layers"]});var qg={get paint(){return Of=Of||new tn({"heatmap-radius":new Ni(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ni(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $i(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ds(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $i(ut.paint_heatmap["heatmap-opacity"])})}};function Uf(h,l,f,v){let{width:E,height:M}=l;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==E*M*f)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${E*M*f}`)}else v=new Uint8Array(E*M*f);return h.width=E,h.height=M,h.data=v,h}function Nf(h,l,f){let{width:v,height:E}=l;if(v===h.width&&E===h.height)return;const M=Uf({},{width:v,height:E},f);zf(h,M,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,v),height:Math.min(h.height,E)},f),h.width=v,h.height=E,h.data=M.data}function zf(h,l,f,v,E,M){if(E.width===0||E.height===0)return l;if(E.width>h.width||E.height>h.height||f.x>h.width-E.width||f.y>h.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>l.width||E.height>l.height||v.x>l.width-E.width||v.y>l.height-E.height)throw new RangeError("out of range destination coordinates for image copy");const D=h.data,G=l.data;if(D===G)throw new Error("srcData equals dstData, so image is already copied");for(let $=0;$<E.height;$++){const X=((f.y+$)*h.width+f.x)*M,se=((v.y+$)*l.width+v.x)*M;for(let Ae=0;Ae<E.width*M;Ae++)G[se+Ae]=D[X+Ae]}return l}class fc{constructor(l,f){Uf(this,l,1,f)}resize(l){Nf(this,l,1)}clone(){return new fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,v,E,M){zf(l,f,v,E,M,1)}}class Uo{constructor(l,f){Uf(this,l,4,f)}resize(l){Nf(this,l,4)}replace(l,f){f?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,v,E,M){zf(l,f,v,E,M,4)}}function tA(h){const l={},f=h.resolution||256,v=h.clips?h.clips.length:1,E=h.image||new Uo({width:f,height:v});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const M=(D,G,$)=>{l[h.evaluationKey]=$;const X=h.expression.evaluate(l);E.data[D+G+0]=Math.floor(255*X.r/X.a),E.data[D+G+1]=Math.floor(255*X.g/X.a),E.data[D+G+2]=Math.floor(255*X.b/X.a),E.data[D+G+3]=Math.floor(255*X.a)};if(h.clips)for(let D=0,G=0;D<v;++D,G+=4*f)for(let $=0,X=0;$<f;$++,X+=4){const se=$/(f-1),{start:Ae,end:me}=h.clips[D];M(G,X,Ae*(1-se)+me*se)}else for(let D=0,G=0;D<f;D++,G+=4)M(0,G,D/(f-1));return E}Oi("AlphaImage",fc),Oi("RGBAImage",Uo);class ka extends Ro{createBucket(l){return new mh(l)}constructor(l){super(l,qg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ml;var ku={get paint(){return ml=ml||new tn({"hillshade-illumination-direction":new $i(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $i(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $i(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $i(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $i(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $i(ut.paint_hillshade["hillshade-accent-color"])})}};class Sd extends Ro{constructor(l){super(l,ku)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qf=Un([{name:"a_pos",components:2,type:"Int16"}],4),{members:$g}=Qf;var Vf={exports:{}};function iA(h,l,f){f=f||2;var v,E,M,D,G,$,X,se=l&&l.length,Ae=se?l[0]*f:h.length,me=Td(h,0,Ae,f,!0),Be=[];if(!me||me.next===me.prev)return Be;if(se&&(me=function(ke,He,qe,ct){var Ye,tt,gt,St=[];for(Ye=0,tt=He.length;Ye<tt;Ye++)(gt=Td(ke,He[Ye]*ct,Ye<tt-1?He[Ye+1]*ct:ke.length,ct,!1))===gt.next&&(gt.steiner=!0),St.push(Cb(gt));for(St.sort(Bb),Ye=0;Ye<St.length;Ye++)qe=Wg(St[Ye],qe);return qe}(h,l,me,f)),h.length>80*f){v=M=h[0],E=D=h[1];for(var Se=f;Se<Ae;Se+=f)(G=h[Se])<v&&(v=G),($=h[Se+1])<E&&(E=$),G>M&&(M=G),$>D&&(D=$);X=(X=Math.max(M-v,D-E))!==0?32767/X:0}return Hf(me,Be,f,v,E,X,0),Be}function Td(h,l,f,v,E){var M,D;if(E===Kf(h,l,f,v)>0)for(M=l;M<f;M+=v)D=Jg(M,h[M],h[M+1],D);else for(M=f-v;M>=l;M-=v)D=Jg(M,h[M],h[M+1],D);return D&&Ld(D,D.next)&&(qf(D),D=D.next),D}function yh(h,l){if(!h)return h;l||(l=h);var f,v=h;do if(f=!1,v.steiner||!Ld(v,v.next)&&Os(v.prev,v,v.next)!==0)v=v.next;else{if(qf(v),(v=l=v.prev)===v.next)break;f=!0}while(f||v!==l);return l}function Hf(h,l,f,v,E,M,D){if(h){!D&&M&&function(se,Ae,me,Be){var Se=se;do Se.z===0&&(Se.z=RA(Se.x,Se.y,Ae,me,Be)),Se.prevZ=Se.prev,Se.nextZ=Se.next,Se=Se.next;while(Se!==se);Se.prevZ.nextZ=null,Se.prevZ=null,function(ke){var He,qe,ct,Ye,tt,gt,St,Xt,xi=1;do{for(qe=ke,ke=null,tt=null,gt=0;qe;){for(gt++,ct=qe,St=0,He=0;He<xi&&(St++,ct=ct.nextZ);He++);for(Xt=xi;St>0||Xt>0&&ct;)St!==0&&(Xt===0||!ct||qe.z<=ct.z)?(Ye=qe,qe=qe.nextZ,St--):(Ye=ct,ct=ct.nextZ,Xt--),tt?tt.nextZ=Ye:ke=Ye,Ye.prevZ=tt,tt=Ye;qe=ct}tt.nextZ=null,xi*=2}while(gt>1)}(Se)}(h,v,E,M);for(var G,$,X=h;h.prev!==h.next;)if(G=h.prev,$=h.next,M?yT(h,v,E,M):Id(h))l.push(G.i/f|0),l.push(h.i/f|0),l.push($.i/f|0),qf(h),h=$.next,X=$.next;else if((h=$)===X){D?D===1?Hf(h=Ws(yh(h),l,f),l,f,v,E,M,2):D===2&&Kg(h,l,f,v,E,M):Hf(yh(h),l,f,v,E,M,1);break}}}function Id(h){var l=h.prev,f=h,v=h.next;if(Os(l,f,v)>=0)return!1;for(var E=l.x,M=f.x,D=v.x,G=l.y,$=f.y,X=v.y,se=E<M?E<D?E:D:M<D?M:D,Ae=G<$?G<X?G:X:$<X?$:X,me=E>M?E>D?E:D:M>D?M:D,Be=G>$?G>X?G:X:$>X?$:X,Se=v.next;Se!==l;){if(Se.x>=se&&Se.x<=me&&Se.y>=Ae&&Se.y<=Be&&kA(E,G,M,$,D,X,Se.x,Se.y)&&Os(Se.prev,Se,Se.next)>=0)return!1;Se=Se.next}return!0}function yT(h,l,f,v){var E=h.prev,M=h,D=h.next;if(Os(E,M,D)>=0)return!1;for(var G=E.x,$=M.x,X=D.x,se=E.y,Ae=M.y,me=D.y,Be=G<$?G<X?G:X:$<X?$:X,Se=se<Ae?se<me?se:me:Ae<me?Ae:me,ke=G>$?G>X?G:X:$>X?$:X,He=se>Ae?se>me?se:me:Ae>me?Ae:me,qe=RA(Be,Se,l,f,v),ct=RA(ke,He,l,f,v),Ye=h.prevZ,tt=h.nextZ;Ye&&Ye.z>=qe&&tt&&tt.z<=ct;){if(Ye.x>=Be&&Ye.x<=ke&&Ye.y>=Se&&Ye.y<=He&&Ye!==E&&Ye!==D&&kA(G,se,$,Ae,X,me,Ye.x,Ye.y)&&Os(Ye.prev,Ye,Ye.next)>=0||(Ye=Ye.prevZ,tt.x>=Be&&tt.x<=ke&&tt.y>=Se&&tt.y<=He&&tt!==E&&tt!==D&&kA(G,se,$,Ae,X,me,tt.x,tt.y)&&Os(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;Ye&&Ye.z>=qe;){if(Ye.x>=Be&&Ye.x<=ke&&Ye.y>=Se&&Ye.y<=He&&Ye!==E&&Ye!==D&&kA(G,se,$,Ae,X,me,Ye.x,Ye.y)&&Os(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.prevZ}for(;tt&&tt.z<=ct;){if(tt.x>=Be&&tt.x<=ke&&tt.y>=Se&&tt.y<=He&&tt!==E&&tt!==D&&kA(G,se,$,Ae,X,me,tt.x,tt.y)&&Os(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function Ws(h,l,f){var v=h;do{var E=v.prev,M=v.next.next;!Ld(E,M)&&u0(E,v,v.next,M)&&_h(E,M)&&_h(M,E)&&(l.push(E.i/f|0),l.push(v.i/f|0),l.push(M.i/f|0),qf(v),qf(v.next),v=h=M),v=v.next}while(v!==h);return yh(v)}function Kg(h,l,f,v,E,M){var D=h;do{for(var G=D.next.next;G!==D.prev;){if(D.i!==G.i&&Gf(D,G)){var $=Eb(D,G);return D=yh(D,D.next),$=yh($,$.next),Hf(D,l,f,v,E,M,0),void Hf($,l,f,v,E,M,0)}G=G.next}D=D.next}while(D!==h)}function Bb(h,l){return h.x-l.x}function Wg(h,l){var f=function(E,M){var D,G=M,$=E.x,X=E.y,se=-1/0;do{if(X<=G.y&&X>=G.next.y&&G.next.y!==G.y){var Ae=G.x+(X-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(Ae<=$&&Ae>se&&(se=Ae,D=G.x<G.next.x?G:G.next,Ae===$))return D}G=G.next}while(G!==M);if(!D)return null;var me,Be=D,Se=D.x,ke=D.y,He=1/0;G=D;do $>=G.x&&G.x>=Se&&$!==G.x&&kA(X<ke?$:se,X,Se,ke,X<ke?se:$,X,G.x,G.y)&&(me=Math.abs(X-G.y)/($-G.x),_h(G,E)&&(me<He||me===He&&(G.x>D.x||G.x===D.x&&Xg(D,G)))&&(D=G,He=me)),G=G.next;while(G!==Be);return D}(h,l);if(!f)return l;var v=Eb(f,h);return yh(v,v.next),yh(f,f.next)}function Xg(h,l){return Os(h.prev,h,l.prev)<0&&Os(l.next,h,h.next)<0}function RA(h,l,f,v,E){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-f)*E|0)|h<<8))|h<<4))|h<<2))|h<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-v)*E|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Cb(h){var l=h,f=h;do(l.x<f.x||l.x===f.x&&l.y<f.y)&&(f=l),l=l.next;while(l!==h);return f}function kA(h,l,f,v,E,M,D,G){return(E-D)*(l-G)>=(h-D)*(M-G)&&(h-D)*(v-G)>=(f-D)*(l-G)&&(f-D)*(M-G)>=(E-D)*(v-G)}function Gf(h,l){return h.next.i!==l.i&&h.prev.i!==l.i&&!function(f,v){var E=f;do{if(E.i!==f.i&&E.next.i!==f.i&&E.i!==v.i&&E.next.i!==v.i&&u0(E,E.next,f,v))return!0;E=E.next}while(E!==f);return!1}(h,l)&&(_h(h,l)&&_h(l,h)&&function(f,v){var E=f,M=!1,D=(f.x+v.x)/2,G=(f.y+v.y)/2;do E.y>G!=E.next.y>G&&E.next.y!==E.y&&D<(E.next.x-E.x)*(G-E.y)/(E.next.y-E.y)+E.x&&(M=!M),E=E.next;while(E!==f);return M}(h,l)&&(Os(h.prev,h,l.prev)||Os(h,l.prev,l))||Ld(h,l)&&Os(h.prev,h,h.next)>0&&Os(l.prev,l,l.next)>0)}function Os(h,l,f){return(l.y-h.y)*(f.x-l.x)-(l.x-h.x)*(f.y-l.y)}function Ld(h,l){return h.x===l.x&&h.y===l.y}function u0(h,l,f,v){var E=jf(Os(h,l,f)),M=jf(Os(h,l,v)),D=jf(Os(f,v,h)),G=jf(Os(f,v,l));return E!==M&&D!==G||!(E!==0||!Zg(h,f,l))||!(M!==0||!Zg(h,v,l))||!(D!==0||!Zg(f,h,v))||!(G!==0||!Zg(f,l,v))}function Zg(h,l,f){return l.x<=Math.max(h.x,f.x)&&l.x>=Math.min(h.x,f.x)&&l.y<=Math.max(h.y,f.y)&&l.y>=Math.min(h.y,f.y)}function jf(h){return h>0?1:h<0?-1:0}function _h(h,l){return Os(h.prev,h,h.next)<0?Os(h,l,h.next)>=0&&Os(h,h.prev,l)>=0:Os(h,l,h.prev)<0||Os(h,h.next,l)<0}function Eb(h,l){var f=new $f(h.i,h.x,h.y),v=new $f(l.i,l.x,l.y),E=h.next,M=l.prev;return h.next=l,l.prev=h,f.next=E,E.prev=f,v.next=f,f.prev=v,M.next=v,v.prev=M,v}function Jg(h,l,f,v){var E=new $f(h,l,f);return v?(E.next=v.next,E.prev=v,v.next.prev=E,v.next=E):(E.prev=E,E.next=E),E}function qf(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function $f(h,l,f){this.i=h,this.x=l,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kf(h,l,f,v){for(var E=0,M=l,D=f-v;M<f;M+=v)E+=(h[D]-h[M])*(h[M+1]+h[D+1]),D=M;return E}Vf.exports=iA,Vf.exports.default=iA,iA.deviation=function(h,l,f,v){var E=l&&l.length,M=Math.abs(Kf(h,0,E?l[0]*f:h.length,f));if(E)for(var D=0,G=l.length;D<G;D++)M-=Math.abs(Kf(h,l[D]*f,D<G-1?l[D+1]*f:h.length,f));var $=0;for(D=0;D<v.length;D+=3){var X=v[D]*f,se=v[D+1]*f,Ae=v[D+2]*f;$+=Math.abs((h[X]-h[Ae])*(h[se+1]-h[X+1])-(h[X]-h[se])*(h[Ae+1]-h[X+1]))}return M===0&&$===0?0:Math.abs(($-M)/M)},iA.flatten=function(h){for(var l=h[0][0].length,f={vertices:[],holes:[],dimensions:l},v=0,E=0;E<h.length;E++){for(var M=0;M<h[E].length;M++)for(var D=0;D<l;D++)f.vertices.push(h[E][M][D]);E>0&&f.holes.push(v+=h[E-1].length)}return f};var Yg=x(Vf.exports);function Sb(h,l,f,v,E){h0(h,l,f||0,v||h.length-1,E||_T)}function h0(h,l,f,v,E){for(;v>f;){if(v-f>600){var M=v-f+1,D=l-f+1,G=Math.log(M),$=.5*Math.exp(2*G/3),X=.5*Math.sqrt(G*$*(M-$)/M)*(D-M/2<0?-1:1);h0(h,l,Math.max(f,Math.floor(l-D*$/M+X)),Math.min(v,Math.floor(l+(M-D)*$/M+X)),E)}var se=h[l],Ae=f,me=v;for(Wf(h,f,l),E(h[v],se)>0&&Wf(h,f,v);Ae<me;){for(Wf(h,Ae,me),Ae++,me--;E(h[Ae],se)<0;)Ae++;for(;E(h[me],se)>0;)me--}E(h[f],se)===0?Wf(h,f,me):Wf(h,++me,v),me<=l&&(f=me+1),l<=me&&(v=me-1)}}function Wf(h,l,f){var v=h[l];h[l]=h[f],h[f]=v}function _T(h,l){return h<l?-1:h>l?1:0}function A0(h,l){const f=h.length;if(f<=1)return[h];const v=[];let E,M;for(let D=0;D<f;D++){const G=Ct(h[D]);G!==0&&(h[D].area=Math.abs(G),M===void 0&&(M=G<0),M===G<0?(E&&v.push(E),E=[h[D]]):E.push(h[D]))}if(E&&v.push(E),l>1)for(let D=0;D<v.length;D++)v[D].length<=l||(Sb(v[D],l,1,v[D].length-1,vT),v[D]=v[D].slice(0,l));return v}function vT(h,l){return l.area-h.area}function d0(h,l,f){const v=f.patternDependencies;let E=!1;for(const M of l){const D=M.paint.get(`${h}-pattern`);D.isConstant()||(E=!0);const G=D.constantOr(null);G&&(E=!0,v[G.to]=!0,v[G.from]=!0)}return E}function Ou(h,l,f,v,E){const M=E.patternDependencies;for(const D of l){const G=D.paint.get(`${h}-pattern`).value;if(G.kind!=="constant"){let $=G.evaluate({zoom:v-1},f,{},E.availableImages),X=G.evaluate({zoom:v},f,{},E.availableImages),se=G.evaluate({zoom:v+1},f,{},E.availableImages);$=$&&$.name?$.name:$,X=X&&X.name?X.name:X,se=se&&se.name?se.name:se,M[$]=!0,M[X]=!0,M[se]=!0,f.patterns[D.id]={min:$,mid:X,max:se}}}return f}class f0{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rt,this.indexArray=new Vt,this.indexArray2=new _i,this.programConfigurations=new so(l.layers,l.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,v){this.hasPattern=d0("fill",this.layers,f);const E=this.layers[0].layout.get("fill-sort-key"),M=!E.isConstant(),D=[];for(const{feature:G,id:$,index:X,sourceLayerIndex:se}of l){const Ae=this.layers[0]._featureFilter.needGeometry,me=Nc(G,Ae);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),me,v))continue;const Be=M?E.evaluate(me,{},v,f.availableImages):void 0,Se={id:$,properties:G.properties,type:G.type,sourceLayerIndex:se,index:X,geometry:Ae?me.geometry:Uc(G),patterns:{},sortKey:Be};D.push(Se)}M&&D.sort((G,$)=>G.sortKey-$.sortKey);for(const G of D){const{geometry:$,index:X,sourceLayerIndex:se}=G;if(this.hasPattern){const Ae=Ou("fill",this.layers,G,this.zoom,f);this.patternFeatures.push(Ae)}else this.addFeature(G,$,X,v,{});f.featureIndex.insert(l[X].feature,$,X,se,this.index)}}update(l,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,v)}addFeatures(l,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,$g),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,f,v,E,M){for(const D of A0(f,500)){let G=0;for(const Be of D)G+=Be.length;const $=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),X=$.vertexLength,se=[],Ae=[];for(const Be of D){if(Be.length===0)continue;Be!==D[0]&&Ae.push(se.length/2);const Se=this.segments2.prepareSegment(Be.length,this.layoutVertexArray,this.indexArray2),ke=Se.vertexLength;this.layoutVertexArray.emplaceBack(Be[0].x,Be[0].y),this.indexArray2.emplaceBack(ke+Be.length-1,ke),se.push(Be[0].x),se.push(Be[0].y);for(let He=1;He<Be.length;He++)this.layoutVertexArray.emplaceBack(Be[He].x,Be[He].y),this.indexArray2.emplaceBack(ke+He-1,ke+He),se.push(Be[He].x),se.push(Be[He].y);Se.vertexLength+=Be.length,Se.primitiveLength+=Be.length}const me=Yg(se,Ae);for(let Be=0;Be<me.length;Be+=3)this.indexArray.emplaceBack(X+me[Be],X+me[Be+1],X+me[Be+2]);$.vertexLength+=G,$.primitiveLength+=me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,v,M,E)}}let p0,OA;Oi("FillBucket",f0,{omit:["layers","patternFeatures"]});var bT={get paint(){return OA=OA||new tn({"fill-antialias":new $i(ut.paint_fill["fill-antialias"]),"fill-opacity":new Ni(ut.paint_fill["fill-opacity"]),"fill-color":new Ni(ut.paint_fill["fill-color"]),"fill-outline-color":new Ni(ut.paint_fill["fill-outline-color"]),"fill-translate":new $i(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new $i(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new qn(ut.paint_fill["fill-pattern"])})},get layout(){return p0=p0||new tn({"fill-sort-key":new Ni(ut.layout_fill["fill-sort-key"])})}};class xT extends Ro{constructor(l){super(l,bT)}recalculate(l,f){super.recalculate(l,f);const v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new f0(l)}queryRadius(){return hu(this.paint.get("fill-translate"))}queryIntersectsFeature(l,f,v,E,M,D,G){return Zh(ph(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),D.angle,G),E)}isTileClipped(){return!0}}const wT=Un([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Tb=Un([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ib}=wT;var rA={},BT=I,Lb=Md;function Md(h,l,f,v,E){this.properties={},this.extent=f,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=E,h.readFields(g0,this,l)}function g0(h,l,f){h==1?l.id=f.readVarint():h==2?function(v,E){for(var M=v.readVarint()+v.pos;v.pos<M;){var D=E._keys[v.readVarint()],G=E._values[v.readVarint()];E.properties[D]=G}}(f,l):h==3?l.type=f.readVarint():h==4&&(l._geometry=f.pos)}function Xf(h){for(var l,f,v=0,E=0,M=h.length,D=M-1;E<M;D=E++)v+=((f=h[D]).x-(l=h[E]).x)*(l.y+f.y);return v}Md.types=["Unknown","Point","LineString","Polygon"],Md.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var l,f=h.readVarint()+h.pos,v=1,E=0,M=0,D=0,G=[];h.pos<f;){if(E<=0){var $=h.readVarint();v=7&$,E=$>>3}if(E--,v===1||v===2)M+=h.readSVarint(),D+=h.readSVarint(),v===1&&(l&&G.push(l),l=[]),l.push(new BT(M,D));else{if(v!==7)throw new Error("unknown command "+v);l&&l.push(l[0].clone())}}return l&&G.push(l),G},Md.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var l=h.readVarint()+h.pos,f=1,v=0,E=0,M=0,D=1/0,G=-1/0,$=1/0,X=-1/0;h.pos<l;){if(v<=0){var se=h.readVarint();f=7&se,v=se>>3}if(v--,f===1||f===2)(E+=h.readSVarint())<D&&(D=E),E>G&&(G=E),(M+=h.readSVarint())<$&&($=M),M>X&&(X=M);else if(f!==7)throw new Error("unknown command "+f)}return[D,$,G,X]},Md.prototype.toGeoJSON=function(h,l,f){var v,E,M=this.extent*Math.pow(2,f),D=this.extent*h,G=this.extent*l,$=this.loadGeometry(),X=Md.types[this.type];function se(Be){for(var Se=0;Se<Be.length;Se++){var ke=Be[Se];Be[Se]=[360*(ke.x+D)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+G)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var Ae=[];for(v=0;v<$.length;v++)Ae[v]=$[v][0];se($=Ae);break;case 2:for(v=0;v<$.length;v++)se($[v]);break;case 3:for($=function(Be){var Se=Be.length;if(Se<=1)return[Be];for(var ke,He,qe=[],ct=0;ct<Se;ct++){var Ye=Xf(Be[ct]);Ye!==0&&(He===void 0&&(He=Ye<0),He===Ye<0?(ke&&qe.push(ke),ke=[Be[ct]]):ke.push(Be[ct]))}return ke&&qe.push(ke),qe}($),v=0;v<$.length;v++)for(E=0;E<$[v].length;E++)se($[v][E])}$.length===1?$=$[0]:X="Multi"+X;var me={type:"Feature",geometry:{type:X,coordinates:$},properties:this.properties};return"id"in this&&(me.id=this.id),me};var m0=Lb,Mb=Pb;function Pb(h,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(Fb,this,l),this.length=this._features.length}function Fb(h,l,f){h===15?l.version=f.readVarint():h===1?l.name=f.readString():h===5?l.extent=f.readVarint():h===2?l._features.push(f.pos):h===3?l._keys.push(f.readString()):h===4&&l._values.push(function(v){for(var E=null,M=v.readVarint()+v.pos;v.pos<M;){var D=v.readVarint()>>3;E=D===1?v.readString():D===2?v.readFloat():D===3?v.readDouble():D===4?v.readVarint64():D===5?v.readVarint():D===6?v.readSVarint():D===7?v.readBoolean():null}return E}(f))}Pb.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var l=this._pbf.readVarint()+this._pbf.pos;return new m0(this._pbf,l,this.extent,this._keys,this._values)};var CT=Mb;function ET(h,l,f){if(h===3){var v=new CT(f,f.readVarint()+f.pos);v.length&&(l[v.name]=v)}}rA.VectorTile=function(h,l){this.layers=h.readFields(ET,{},l)},rA.VectorTileFeature=Lb,rA.VectorTileLayer=Mb;const Zf=rA.VectorTileFeature.types,em=Math.pow(2,13);function Jf(h,l,f,v,E,M,D,G){h.emplaceBack(l,f,2*Math.floor(v*em)+D,E*em*2,M*em*2,Math.round(G))}class y0{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.centroidVertexArray=new Pe,this.indexArray=new Vt,this.programConfigurations=new so(l.layers,l.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,v){this.features=[],this.hasPattern=d0("fill-extrusion",this.layers,f);for(const{feature:E,id:M,index:D,sourceLayerIndex:G}of l){const $=this.layers[0]._featureFilter.needGeometry,X=Nc(E,$);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),X,v))continue;const se={id:M,sourceLayerIndex:G,index:D,geometry:$?X.geometry:Uc(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(Ou("fill-extrusion",this.layers,se,this.zoom,f)):this.addFeature(se,se.geometry,D,v,{}),f.featureIndex.insert(E,se.geometry,D,G,this.index,!0)}}addFeatures(l,f,v){for(const E of this.features){const{geometry:M}=E;this.addFeature(E,M,E.index,f,v)}}update(l,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ib),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Tb.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,f,v,E,M){const D={x:0,y:0,vertexCount:0};for(const G of A0(f,500)){let $=0;for(const Se of G)$+=Se.length;let X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Se of G){if(Se.length===0||TT(Se))continue;let ke=0;for(let He=0;He<Se.length;He++){const qe=Se[He];if(He>=1){const ct=Se[He-1];if(!ST(qe,ct)){X.vertexLength+4>Ti.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ye=qe.sub(ct)._perp()._unit(),tt=ct.dist(qe);ke+tt>32768&&(ke=0),Jf(this.layoutVertexArray,qe.x,qe.y,Ye.x,Ye.y,0,0,ke),Jf(this.layoutVertexArray,qe.x,qe.y,Ye.x,Ye.y,0,1,ke),D.x+=2*qe.x,D.y+=2*qe.y,D.vertexCount+=2,ke+=tt,Jf(this.layoutVertexArray,ct.x,ct.y,Ye.x,Ye.y,0,0,ke),Jf(this.layoutVertexArray,ct.x,ct.y,Ye.x,Ye.y,0,1,ke),D.x+=2*ct.x,D.y+=2*ct.y,D.vertexCount+=2;const gt=X.vertexLength;this.indexArray.emplaceBack(gt,gt+2,gt+1),this.indexArray.emplaceBack(gt+1,gt+2,gt+3),X.vertexLength+=4,X.primitiveLength+=2}}}}if(X.vertexLength+$>Ti.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment($,this.layoutVertexArray,this.indexArray)),Zf[l.type]!=="Polygon")continue;const se=[],Ae=[],me=X.vertexLength;for(const Se of G)if(Se.length!==0){Se!==G[0]&&Ae.push(se.length/2);for(let ke=0;ke<Se.length;ke++){const He=Se[ke];Jf(this.layoutVertexArray,He.x,He.y,0,0,1,1,0),D.x+=He.x,D.y+=He.y,D.vertexCount+=1,se.push(He.x),se.push(He.y)}}const Be=Yg(se,Ae);for(let Se=0;Se<Be.length;Se+=3)this.indexArray.emplaceBack(me+Be[Se],me+Be[Se+2],me+Be[Se+1]);X.primitiveLength+=Be.length/3,X.vertexLength+=$}for(let G=0;G<D.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(D.x/D.vertexCount),Math.floor(D.y/D.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,v,M,E)}}function ST(h,l){return h.x===l.x&&(h.x<0||h.x>In)||h.y===l.y&&(h.y<0||h.y>In)}function TT(h){return h.every(l=>l.x<0)||h.every(l=>l.x>In)||h.every(l=>l.y<0)||h.every(l=>l.y>In)}let Db;Oi("FillExtrusionBucket",y0,{omit:["layers","features"]});var IT={get paint(){return Db=Db||new tn({"fill-extrusion-opacity":new $i(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $i(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $i(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qn(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $i(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Rb extends Ro{constructor(l){super(l,IT)}createBucket(l){return new y0(l)}queryRadius(){return hu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,f,v,E,M,D,G,$){const X=ph(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),D.angle,G),se=this.paint.get("fill-extrusion-height").evaluate(f,v),Ae=this.paint.get("fill-extrusion-base").evaluate(f,v),me=function(Se,ke,He,qe){const ct=[];for(const Ye of Se){const tt=[Ye.x,Ye.y,0,1];Au(tt,tt,ke),ct.push(new O(tt[0]/tt[3],tt[1]/tt[3]))}return ct}(X,$),Be=function(Se,ke,He,qe){const ct=[],Ye=[],tt=qe[8]*ke,gt=qe[9]*ke,St=qe[10]*ke,Xt=qe[11]*ke,xi=qe[8]*He,oi=qe[9]*He,Ai=qe[10]*He,fi=qe[11]*He;for(const Fi of Se){const ai=[],Zt=[];for(const Vi of Fi){const Qi=Vi.x,gr=Vi.y,Dr=qe[0]*Qi+qe[4]*gr+qe[12],zr=qe[1]*Qi+qe[5]*gr+qe[13],pn=qe[2]*Qi+qe[6]*gr+qe[14],os=qe[3]*Qi+qe[7]*gr+qe[15],Nn=pn+St,vn=os+Xt,Pn=Dr+xi,cn=zr+oi,vr=pn+Ai,zn=os+fi,un=new O((Dr+tt)/vn,(zr+gt)/vn);un.z=Nn/vn,ai.push(un);const en=new O(Pn/zn,cn/zn);en.z=vr/zn,Zt.push(en)}ct.push(ai),Ye.push(Zt)}return[ct,Ye]}(E,Ae,se,$);return function(Se,ke,He){let qe=1/0;Zh(He,ke)&&(qe=_0(He,ke[0]));for(let ct=0;ct<ke.length;ct++){const Ye=ke[ct],tt=Se[ct];for(let gt=0;gt<Ye.length-1;gt++){const St=Ye[gt],Xt=[St,Ye[gt+1],tt[gt+1],tt[gt],St];zc(He,Xt)&&(qe=Math.min(qe,_0(He,Xt)))}}return qe!==1/0&&qe}(Be[0],Be[1],me)}}function UA(h,l){return h.x*l.x+h.y*l.y}function _0(h,l){if(h.length===1){let f=0;const v=l[f++];let E;for(;!E||v.equals(E);)if(E=l[f++],!E)return 1/0;for(;f<l.length;f++){const M=l[f],D=h[0],G=E.sub(v),$=M.sub(v),X=D.sub(v),se=UA(G,G),Ae=UA(G,$),me=UA($,$),Be=UA(X,G),Se=UA(X,$),ke=se*me-Ae*Ae,He=(me*Be-Ae*Se)/ke,qe=(se*Se-Ae*Be)/ke,ct=v.z*(1-He-qe)+E.z*He+M.z*qe;if(isFinite(ct))return ct}return 1/0}{let f=1/0;for(const v of l)f=Math.min(f,v.z);return f}}const kb=Un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ob}=kb,LT=Un([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tm}=LT,MT=rA.VectorTileFeature.types,Ub=Math.cos(Math.PI/180*37.5),Nb=Math.pow(2,14)/.5;class v0{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new Qe,this.indexArray=new Vt,this.programConfigurations=new so(l.layers,l.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,v){this.hasPattern=d0("line",this.layers,f);const E=this.layers[0].layout.get("line-sort-key"),M=!E.isConstant(),D=[];for(const{feature:G,id:$,index:X,sourceLayerIndex:se}of l){const Ae=this.layers[0]._featureFilter.needGeometry,me=Nc(G,Ae);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),me,v))continue;const Be=M?E.evaluate(me,{},v):void 0,Se={id:$,properties:G.properties,type:G.type,sourceLayerIndex:se,index:X,geometry:Ae?me.geometry:Uc(G),patterns:{},sortKey:Be};D.push(Se)}M&&D.sort((G,$)=>G.sortKey-$.sortKey);for(const G of D){const{geometry:$,index:X,sourceLayerIndex:se}=G;if(this.hasPattern){const Ae=Ou("line",this.layers,G,this.zoom,f);this.patternFeatures.push(Ae)}else this.addFeature(G,$,X,v,{});f.featureIndex.insert(l[X].feature,$,X,se,this.index)}}update(l,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,v)}addFeatures(l,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,tm)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ob),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,f,v,E,M){const D=this.layers[0].layout,G=D.get("line-join").evaluate(l,{}),$=D.get("line-cap"),X=D.get("line-miter-limit"),se=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const Ae of f)this.addLine(Ae,l,G,$,X,se);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,v,M,E)}addLine(l,f,v,E,M,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let qe=0;qe<l.length-1;qe++)this.totalDistance+=l[qe].dist(l[qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const G=MT[f.type]==="Polygon";let $=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let X=0;for(;X<$-1&&l[X].equals(l[X+1]);)X++;if($<(G?3:2))return;v==="bevel"&&(M=1.05);const se=this.overscaling<=16?15*In/(512*this.overscaling):0,Ae=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let me,Be,Se,ke,He;this.e1=this.e2=-1,G&&(me=l[$-2],He=l[X].sub(me)._unit()._perp());for(let qe=X;qe<$;qe++){if(Se=qe===$-1?G?l[X+1]:void 0:l[qe+1],Se&&l[qe].equals(Se))continue;He&&(ke=He),me&&(Be=me),me=l[qe],He=Se?Se.sub(me)._unit()._perp():ke,ke=ke||He;let ct=ke.add(He);ct.x===0&&ct.y===0||ct._unit();const Ye=ke.x*He.x+ke.y*He.y,tt=ct.x*He.x+ct.y*He.y,gt=tt!==0?1/tt:1/0,St=2*Math.sqrt(2-2*tt),Xt=tt<Ub&&Be&&Se,xi=ke.x*He.y-ke.y*He.x>0;if(Xt&&qe>X){const fi=me.dist(Be);if(fi>2*se){const Fi=me.sub(me.sub(Be)._mult(se/fi)._round());this.updateDistance(Be,Fi),this.addCurrentVertex(Fi,ke,0,0,Ae),Be=Fi}}const oi=Be&&Se;let Ai=oi?v:G?"butt":E;if(oi&&Ai==="round"&&(gt<D?Ai="miter":gt<=2&&(Ai="fakeround")),Ai==="miter"&&gt>M&&(Ai="bevel"),Ai==="bevel"&&(gt>2&&(Ai="flipbevel"),gt<M&&(Ai="miter")),Be&&this.updateDistance(Be,me),Ai==="miter")ct._mult(gt),this.addCurrentVertex(me,ct,0,0,Ae);else if(Ai==="flipbevel"){if(gt>100)ct=He.mult(-1);else{const fi=gt*ke.add(He).mag()/ke.sub(He).mag();ct._perp()._mult(fi*(xi?-1:1))}this.addCurrentVertex(me,ct,0,0,Ae),this.addCurrentVertex(me,ct.mult(-1),0,0,Ae)}else if(Ai==="bevel"||Ai==="fakeround"){const fi=-Math.sqrt(gt*gt-1),Fi=xi?fi:0,ai=xi?0:fi;if(Be&&this.addCurrentVertex(me,ke,Fi,ai,Ae),Ai==="fakeround"){const Zt=Math.round(180*St/Math.PI/20);for(let Vi=1;Vi<Zt;Vi++){let Qi=Vi/Zt;if(Qi!==.5){const Dr=Qi-.5;Qi+=Qi*Dr*(Qi-1)*((1.0904+Ye*(Ye*(3.55645-1.43519*Ye)-3.2452))*Dr*Dr+(.848013+Ye*(.215638*Ye-1.06021)))}const gr=He.sub(ke)._mult(Qi)._add(ke)._unit()._mult(xi?-1:1);this.addHalfVertex(me,gr.x,gr.y,!1,xi,0,Ae)}}Se&&this.addCurrentVertex(me,He,-Fi,-ai,Ae)}else if(Ai==="butt")this.addCurrentVertex(me,ct,0,0,Ae);else if(Ai==="square"){const fi=Be?1:-1;this.addCurrentVertex(me,ct,fi,fi,Ae)}else Ai==="round"&&(Be&&(this.addCurrentVertex(me,ke,0,0,Ae),this.addCurrentVertex(me,ke,1,1,Ae,!0)),Se&&(this.addCurrentVertex(me,He,-1,-1,Ae,!0),this.addCurrentVertex(me,He,0,0,Ae)));if(Xt&&qe<$-1){const fi=me.dist(Se);if(fi>2*se){const Fi=me.add(Se.sub(me)._mult(se/fi)._round());this.updateDistance(me,Fi),this.addCurrentVertex(Fi,He,0,0,Ae),me=Fi}}}}addCurrentVertex(l,f,v,E,M){let D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const G=f.y*E-f.x,$=-f.y-f.x*E;this.addHalfVertex(l,f.x+f.y*v,f.y-f.x*v,D,!1,v,M),this.addHalfVertex(l,G,$,D,!0,-E,M),this.distance>Nb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,f,v,E,M,D))}addHalfVertex(l,f,v,E,M,D,G){let{x:$,y:X}=l;const se=.5*(this.lineClips?this.scaledDistance*(Nb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack(($<<1)+(E?1:0),(X<<1)+(M?1:0),Math.round(63*f)+128,Math.round(63*v)+128,1+(D===0?0:D<0?-1:1)|(63&se)<<2,se>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ae=G.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ae),G.primitiveLength++),M?this.e2=Ae:this.e1=Ae}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,f){this.distance+=l.dist(f),this.updateScaledDistance()}}let zb,b0;Oi("LineBucket",v0,{omit:["layers","patternFeatures"]});var Qb={get paint(){return b0=b0||new tn({"line-opacity":new Ni(ut.paint_line["line-opacity"]),"line-color":new Ni(ut.paint_line["line-color"]),"line-translate":new $i(ut.paint_line["line-translate"]),"line-translate-anchor":new $i(ut.paint_line["line-translate-anchor"]),"line-width":new Ni(ut.paint_line["line-width"]),"line-gap-width":new Ni(ut.paint_line["line-gap-width"]),"line-offset":new Ni(ut.paint_line["line-offset"]),"line-blur":new Ni(ut.paint_line["line-blur"]),"line-dasharray":new Pu(ut.paint_line["line-dasharray"]),"line-pattern":new qn(ut.paint_line["line-pattern"]),"line-gradient":new Ds(ut.paint_line["line-gradient"])})},get layout(){return zb=zb||new tn({"line-cap":new $i(ut.layout_line["line-cap"]),"line-join":new Ni(ut.layout_line["line-join"]),"line-miter-limit":new $i(ut.layout_line["line-miter-limit"]),"line-round-limit":new $i(ut.layout_line["line-round-limit"]),"line-sort-key":new Ni(ut.layout_line["line-sort-key"])})}};class PT extends Ni{possiblyEvaluate(l,f){return f=new bi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(l,f)}evaluate(l,f,v,E){return f=Ue({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(l,f,v,E)}}let nA;class _o extends Ro{constructor(l){super(l,Qb),this.gradientVersion=0,nA||(nA=new PT(Qb.paint.properties["line-width"].specification),nA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(v){return v._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ho,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,f){super.recalculate(l,f),this.paint._values["line-floorwidth"]=nA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new v0(l)}queryRadius(l){const f=l,v=x0(fh("line-width",this,f),fh("line-gap-width",this,f)),E=fh("line-offset",this,f);return v/2+Math.abs(E)+hu(this.paint.get("line-translate"))}queryIntersectsFeature(l,f,v,E,M,D,G){const $=ph(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),D.angle,G),X=G/2*x0(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),se=this.paint.get("line-offset").evaluate(f,v);return se&&(E=function(Ae,me){const Be=[];for(let Se=0;Se<Ae.length;Se++){const ke=Ae[Se],He=[];for(let qe=0;qe<ke.length;qe++){const ct=ke[qe-1],Ye=ke[qe],tt=ke[qe+1],gt=qe===0?new O(0,0):Ye.sub(ct)._unit()._perp(),St=qe===ke.length-1?new O(0,0):tt.sub(Ye)._unit()._perp(),Xt=gt._add(St)._unit(),xi=Xt.x*St.x+Xt.y*St.y;xi!==0&&Xt._mult(1/xi),He.push(Xt._mult(me)._add(Ye))}Be.push(He)}return Be}(E,se*G)),function(Ae,me,Be){for(let Se=0;Se<me.length;Se++){const ke=me[Se];if(Ae.length>=3){for(let He=0;He<ke.length;He++)if(Wl(Ae,ke[He]))return!0}if(xd(Ae,ke,Be))return!0}return!1}($,E,X)}isTileClipped(){return!0}}function x0(h,l){return l>0?l+2*h:h}const Vb=Un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hb=Un([{name:"a_projected_pos",components:3,type:"Float32"}],4);Un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kn=Un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Un([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const im=Un([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gb=Un([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function jb(h,l,f){return h.sections.forEach(v=>{v.text=function(E,M,D){const G=M.layout.get("text-transform").evaluate(D,{});return G==="uppercase"?E=E.toLocaleUpperCase():G==="lowercase"&&(E=E.toLocaleLowerCase()),$s.applyArabicShaping&&(E=$s.applyArabicShaping(E)),E}(v.text,l,f)}),h}Un([{name:"triangle",components:3,type:"Uint16"}]),Un([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Un([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Un([{type:"Float32",name:"offsetX"}]),Un([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Un([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Es=24,w0=Wn,qb=function(h,l,f,v,E){var M,D,G=8*E-v-1,$=(1<<G)-1,X=$>>1,se=-7,Ae=f?E-1:0,me=f?-1:1,Be=h[l+Ae];for(Ae+=me,M=Be&(1<<-se)-1,Be>>=-se,se+=G;se>0;M=256*M+h[l+Ae],Ae+=me,se-=8);for(D=M&(1<<-se)-1,M>>=-se,se+=v;se>0;D=256*D+h[l+Ae],Ae+=me,se-=8);if(M===0)M=1-X;else{if(M===$)return D?NaN:1/0*(Be?-1:1);D+=Math.pow(2,v),M-=X}return(Be?-1:1)*D*Math.pow(2,M-v)},$b=function(h,l,f,v,E,M){var D,G,$,X=8*M-E-1,se=(1<<X)-1,Ae=se>>1,me=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,Be=v?0:M-1,Se=v?1:-1,ke=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(G=isNaN(l)?1:0,D=se):(D=Math.floor(Math.log(l)/Math.LN2),l*($=Math.pow(2,-D))<1&&(D--,$*=2),(l+=D+Ae>=1?me/$:me*Math.pow(2,1-Ae))*$>=2&&(D++,$/=2),D+Ae>=se?(G=0,D=se):D+Ae>=1?(G=(l*$-1)*Math.pow(2,E),D+=Ae):(G=l*Math.pow(2,Ae-1)*Math.pow(2,E),D=0));E>=8;h[f+Be]=255&G,Be+=Se,G/=256,E-=8);for(D=D<<E|G,X+=E;X>0;h[f+Be]=255&D,Be+=Se,D/=256,X-=8);h[f+Be-Se]|=128*ke};function Wn(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Wn.Varint=0,Wn.Fixed64=1,Wn.Bytes=2,Wn.Fixed32=5;var B0=4294967296,Kb=1/B0,Wb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function vh(h){return h.type===Wn.Bytes?h.readVarint()+h.pos:h.pos+1}function Pd(h,l,f){return f?4294967296*l+(h>>>0):4294967296*(l>>>0)+(h>>>0)}function Xb(h,l,f){var v=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));f.realloc(v);for(var E=f.pos-1;E>=h;E--)f.buf[E+v]=f.buf[E]}function rm(h,l){for(var f=0;f<h.length;f++)l.writeVarint(h[f])}function Fd(h,l){for(var f=0;f<h.length;f++)l.writeSVarint(h[f])}function Zb(h,l){for(var f=0;f<h.length;f++)l.writeFloat(h[f])}function C0(h,l){for(var f=0;f<h.length;f++)l.writeDouble(h[f])}function E0(h,l){for(var f=0;f<h.length;f++)l.writeBoolean(h[f])}function FT(h,l){for(var f=0;f<h.length;f++)l.writeFixed32(h[f])}function DT(h,l){for(var f=0;f<h.length;f++)l.writeSFixed32(h[f])}function RT(h,l){for(var f=0;f<h.length;f++)l.writeFixed64(h[f])}function Jb(h,l){for(var f=0;f<h.length;f++)l.writeSFixed64(h[f])}function Yf(h,l){return(h[l]|h[l+1]<<8|h[l+2]<<16)+16777216*h[l+3]}function No(h,l,f){h[f]=l,h[f+1]=l>>>8,h[f+2]=l>>>16,h[f+3]=l>>>24}function nm(h,l){return(h[l]|h[l+1]<<8|h[l+2]<<16)+(h[l+3]<<24)}Wn.prototype={destroy:function(){this.buf=null},readFields:function(h,l,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),E=v>>3,M=this.pos;this.type=7&v,h(E,l,this),this.pos===M&&this.skip(v)}return l},readMessage:function(h,l){return this.readFields(h,l,this.readVarint()+this.pos)},readFixed32:function(){var h=Yf(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=nm(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Yf(this.buf,this.pos)+Yf(this.buf,this.pos+4)*B0;return this.pos+=8,h},readSFixed64:function(){var h=Yf(this.buf,this.pos)+nm(this.buf,this.pos+4)*B0;return this.pos+=8,h},readFloat:function(){var h=qb(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=qb(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var l,f,v=this.buf;return l=127&(f=v[this.pos++]),f<128?l:(l|=(127&(f=v[this.pos++]))<<7,f<128?l:(l|=(127&(f=v[this.pos++]))<<14,f<128?l:(l|=(127&(f=v[this.pos++]))<<21,f<128?l:function(E,M,D){var G,$,X=D.buf;if(G=(112&($=X[D.pos++]))>>4,$<128||(G|=(127&($=X[D.pos++]))<<3,$<128)||(G|=(127&($=X[D.pos++]))<<10,$<128)||(G|=(127&($=X[D.pos++]))<<17,$<128)||(G|=(127&($=X[D.pos++]))<<24,$<128)||(G|=(1&($=X[D.pos++]))<<31,$<128))return Pd(E,G,M);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(f=v[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,l=this.pos;return this.pos=h,h-l>=12&&Wb?function(f,v,E){return Wb.decode(f.subarray(v,E))}(this.buf,l,h):function(f,v,E){for(var M="",D=v;D<E;){var G,$,X,se=f[D],Ae=null,me=se>239?4:se>223?3:se>191?2:1;if(D+me>E)break;me===1?se<128&&(Ae=se):me===2?(192&(G=f[D+1]))==128&&(Ae=(31&se)<<6|63&G)<=127&&(Ae=null):me===3?($=f[D+2],(192&(G=f[D+1]))==128&&(192&$)==128&&((Ae=(15&se)<<12|(63&G)<<6|63&$)<=2047||Ae>=55296&&Ae<=57343)&&(Ae=null)):me===4&&($=f[D+2],X=f[D+3],(192&(G=f[D+1]))==128&&(192&$)==128&&(192&X)==128&&((Ae=(15&se)<<18|(63&G)<<12|(63&$)<<6|63&X)<=65535||Ae>=1114112)&&(Ae=null)),Ae===null?(Ae=65533,me=1):Ae>65535&&(Ae-=65536,M+=String.fromCharCode(Ae>>>10&1023|55296),Ae=56320|1023&Ae),M+=String.fromCharCode(Ae),D+=me}return M}(this.buf,l,h)},readBytes:function(){var h=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,h);return this.pos=h,l},readPackedVarint:function(h,l){if(this.type!==Wn.Bytes)return h.push(this.readVarint(l));var f=vh(this);for(h=h||[];this.pos<f;)h.push(this.readVarint(l));return h},readPackedSVarint:function(h){if(this.type!==Wn.Bytes)return h.push(this.readSVarint());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Wn.Bytes)return h.push(this.readBoolean());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Wn.Bytes)return h.push(this.readFloat());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Wn.Bytes)return h.push(this.readDouble());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Wn.Bytes)return h.push(this.readFixed32());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Wn.Bytes)return h.push(this.readSFixed32());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Wn.Bytes)return h.push(this.readFixed64());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Wn.Bytes)return h.push(this.readSFixed64());var l=vh(this);for(h=h||[];this.pos<l;)h.push(this.readSFixed64());return h},skip:function(h){var l=7&h;if(l===Wn.Varint)for(;this.buf[this.pos++]>127;);else if(l===Wn.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Wn.Fixed32)this.pos+=4;else{if(l!==Wn.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(h,l){this.writeVarint(h<<3|l)},realloc:function(h){for(var l=this.length||16;l<this.pos+h;)l*=2;if(l!==this.length){var f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Kb),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Kb),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(l,f){var v,E;if(l>=0?(v=l%4294967296|0,E=l/4294967296|0):(E=~(-l/4294967296),4294967295^(v=~(-l%4294967296))?v=v+1|0:(v=0,E=E+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(M,D,G){G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,G.buf[G.pos]=127&(M>>>=7)}(v,0,f),function(M,D){var G=(7&M)<<4;D.buf[D.pos++]|=G|((M>>>=3)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M)))))}(E,f)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var l=this.pos;this.pos=function(v,E,M){for(var D,G,$=0;$<E.length;$++){if((D=E.charCodeAt($))>55295&&D<57344){if(!G){D>56319||$+1===E.length?(v[M++]=239,v[M++]=191,v[M++]=189):G=D;continue}if(D<56320){v[M++]=239,v[M++]=191,v[M++]=189,G=D;continue}D=G-55296<<10|D-56320|65536,G=null}else G&&(v[M++]=239,v[M++]=191,v[M++]=189,G=null);D<128?v[M++]=D:(D<2048?v[M++]=D>>6|192:(D<65536?v[M++]=D>>12|224:(v[M++]=D>>18|240,v[M++]=D>>12&63|128),v[M++]=D>>6&63|128),v[M++]=63&D|128)}return M}(this.buf,h,this.pos);var f=this.pos-l;f>=128&&Xb(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeFloat:function(h){this.realloc(4),$b(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),$b(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var l=h.length;this.writeVarint(l),this.realloc(l);for(var f=0;f<l;f++)this.buf[this.pos++]=h[f]},writeRawMessage:function(h,l){this.pos++;var f=this.pos;h(l,this);var v=this.pos-f;v>=128&&Xb(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(h,l,f){this.writeTag(h,Wn.Bytes),this.writeRawMessage(l,f)},writePackedVarint:function(h,l){l.length&&this.writeMessage(h,rm,l)},writePackedSVarint:function(h,l){l.length&&this.writeMessage(h,Fd,l)},writePackedBoolean:function(h,l){l.length&&this.writeMessage(h,E0,l)},writePackedFloat:function(h,l){l.length&&this.writeMessage(h,Zb,l)},writePackedDouble:function(h,l){l.length&&this.writeMessage(h,C0,l)},writePackedFixed32:function(h,l){l.length&&this.writeMessage(h,FT,l)},writePackedSFixed32:function(h,l){l.length&&this.writeMessage(h,DT,l)},writePackedFixed64:function(h,l){l.length&&this.writeMessage(h,RT,l)},writePackedSFixed64:function(h,l){l.length&&this.writeMessage(h,Jb,l)},writeBytesField:function(h,l){this.writeTag(h,Wn.Bytes),this.writeBytes(l)},writeFixed32Field:function(h,l){this.writeTag(h,Wn.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(h,l){this.writeTag(h,Wn.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(h,l){this.writeTag(h,Wn.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(h,l){this.writeTag(h,Wn.Fixed64),this.writeSFixed64(l)},writeVarintField:function(h,l){this.writeTag(h,Wn.Varint),this.writeVarint(l)},writeSVarintField:function(h,l){this.writeTag(h,Wn.Varint),this.writeSVarint(l)},writeStringField:function(h,l){this.writeTag(h,Wn.Bytes),this.writeString(l)},writeFloatField:function(h,l){this.writeTag(h,Wn.Fixed32),this.writeFloat(l)},writeDoubleField:function(h,l){this.writeTag(h,Wn.Fixed64),this.writeDouble(l)},writeBooleanField:function(h,l){this.writeVarintField(h,!!l)}};var sm=x(w0);const Uu=3;function ep(h,l,f){h===1&&f.readMessage(tp,l)}function tp(h,l,f){if(h===3){const{id:v,bitmap:E,width:M,height:D,left:G,top:$,advance:X}=f.readMessage(Dd,{});l.push({id:v,bitmap:new fc({width:M+2*Uu,height:D+2*Uu},E),metrics:{width:M,height:D,left:G,top:$,advance:X}})}}function Dd(h,l,f){h===1?l.id=f.readVarint():h===2?l.bitmap=f.readBytes():h===3?l.width=f.readVarint():h===4?l.height=f.readVarint():h===5?l.left=f.readSVarint():h===6?l.top=f.readSVarint():h===7&&(l.advance=f.readVarint())}const ip=Uu;function rp(h){let l=0,f=0;for(const D of h)l+=D.w*D.h,f=Math.max(f,D.w);h.sort((D,G)=>G.h-D.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),f),h:1/0}];let E=0,M=0;for(const D of h)for(let G=v.length-1;G>=0;G--){const $=v[G];if(!(D.w>$.w||D.h>$.h)){if(D.x=$.x,D.y=$.y,M=Math.max(M,D.y+D.h),E=Math.max(E,D.x+D.w),D.w===$.w&&D.h===$.h){const X=v.pop();G<v.length&&(v[G]=X)}else D.h===$.h?($.x+=D.w,$.w-=D.w):D.w===$.w?($.y+=D.h,$.h-=D.h):(v.push({x:$.x+D.w,y:$.y,w:$.w-D.w,h:D.h}),$.y+=D.h,$.h-=D.h);break}}return{w:E,h:M,fill:l/(E*M)||0}}const yl=1;class om{constructor(l,f){let{pixelRatio:v,version:E,stretchX:M,stretchY:D,content:G}=f;this.paddedRect=l,this.pixelRatio=v,this.stretchX=M,this.stretchY=D,this.content=G,this.version=E}get tl(){return[this.paddedRect.x+yl,this.paddedRect.y+yl]}get br(){return[this.paddedRect.x+this.paddedRect.w-yl,this.paddedRect.y+this.paddedRect.h-yl]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*yl)/this.pixelRatio,(this.paddedRect.h-2*yl)/this.pixelRatio]}}class S0{constructor(l,f){const v={},E={};this.haveRenderCallbacks=[];const M=[];this.addImages(l,v,M),this.addImages(f,E,M);const{w:D,h:G}=rp(M),$=new Uo({width:D||1,height:G||1});for(const X in l){const se=l[X],Ae=v[X].paddedRect;Uo.copy(se.data,$,{x:0,y:0},{x:Ae.x+yl,y:Ae.y+yl},se.data)}for(const X in f){const se=f[X],Ae=E[X].paddedRect,me=Ae.x+yl,Be=Ae.y+yl,Se=se.data.width,ke=se.data.height;Uo.copy(se.data,$,{x:0,y:0},{x:me,y:Be},se.data),Uo.copy(se.data,$,{x:0,y:ke-1},{x:me,y:Be-1},{width:Se,height:1}),Uo.copy(se.data,$,{x:0,y:0},{x:me,y:Be+ke},{width:Se,height:1}),Uo.copy(se.data,$,{x:Se-1,y:0},{x:me-1,y:Be},{width:1,height:ke}),Uo.copy(se.data,$,{x:0,y:0},{x:me+Se,y:Be},{width:1,height:ke})}this.image=$,this.iconPositions=v,this.patternPositions=E}addImages(l,f,v){for(const E in l){const M=l[E],D={x:0,y:0,w:M.data.width+2*yl,h:M.data.height+2*yl};v.push(D),f[E]=new om(D,M),M.hasRenderCallback&&this.haveRenderCallbacks.push(E)}}patchUpdatedImages(l,f){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in l.updatedImages)this.patchUpdatedImage(this.iconPositions[v],l.getImage(v),f),this.patchUpdatedImage(this.patternPositions[v],l.getImage(v),f)}patchUpdatedImage(l,f,v){if(!l||!f||l.version===f.version)return;l.version=f.version;const[E,M]=l.tl;v.update(f.data,void 0,{x:E,y:M})}}var sA;Oi("ImagePosition",om),Oi("ImageAtlas",S0),s.ai=void 0,(sA=s.ai||(s.ai={}))[sA.none=0]="none",sA[sA.horizontal=1]="horizontal",sA[sA.vertical=2]="vertical",sA[sA.horizontalOnly=3]="horizontalOnly";const Rd=-17;class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,f){const v=new kd;return v.scale=l||1,v.fontStack=f,v}static forImage(l){const f=new kd;return f.imageName=l,f}}class oA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,f){const v=new oA;for(let E=0;E<l.sections.length;E++){const M=l.sections[E];M.image?v.addImageSection(M):v.addTextSection(M,f)}return v}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let f="";for(let v=0;v<l.length;v++){const E=l.charCodeAt(v+1)||null,M=l.charCodeAt(v-1)||null;f+=E&&Mc(E)&&!pc[l[v+1]]||M&&Mc(M)&&!pc[l[v-1]]||!pc[l[v]]?l[v]:pc[l[v]]}return f}(this.text)}trim(){let l=0;for(let v=0;v<this.text.length&&am[this.text.charCodeAt(v)];v++)l++;let f=this.text.length;for(let v=this.text.length-1;v>=0&&v>=l&&am[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(l,f),this.sectionIndex=this.sectionIndex.slice(l,f)}substring(l,f){const v=new oA;return v.text=this.text.substring(l,f),v.sectionIndex=this.sectionIndex.slice(l,f),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,f)=>Math.max(l,this.sections[f].scale),0)}addTextSection(l,f){this.text+=l.text,this.sections.push(kd.forText(l.scale,l.fontStack||f));const v=this.sections.length-1;for(let E=0;E<l.text.length;++E)this.sectionIndex.push(v)}addImageSection(l){const f=l.image?l.image.name:"";if(f.length===0)return void We("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(kd.forImage(f)),this.sectionIndex.push(this.sections.length-1)):We("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Od(h,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke){const He=oA.fromFeature(h,E);let qe;Ae===s.ai.vertical&&He.verticalizePunctuation();const{processBidirectionalText:ct,processStyledBidirectionalText:Ye}=$s;if(ct&&He.sections.length===1){qe=[];const St=ct(He.toString(),np(He,X,M,l,v,Be,Se));for(const Xt of St){const xi=new oA;xi.text=Xt,xi.sections=He.sections;for(let oi=0;oi<Xt.length;oi++)xi.sectionIndex.push(0);qe.push(xi)}}else if(Ye){qe=[];const St=Ye(He.text,He.sectionIndex,np(He,X,M,l,v,Be,Se));for(const Xt of St){const xi=new oA;xi.text=Xt[0],xi.sectionIndex=Xt[1],xi.sections=He.sections,qe.push(xi)}}else qe=function(St,Xt){const xi=[],oi=St.text;let Ai=0;for(const fi of Xt)xi.push(St.substring(Ai,fi)),Ai=fi;return Ai<oi.length&&xi.push(St.substring(Ai,oi.length)),xi}(He,np(He,X,M,l,v,Be,Se));const tt=[],gt={positionedLines:tt,text:He.toString(),top:se[1],bottom:se[1],left:se[0],right:se[0],writingMode:Ae,iconsInText:!1,verticalizable:!1};return function(St,Xt,xi,oi,Ai,fi,Fi,ai,Zt,Vi,Qi,gr){let Dr=0,zr=Rd,pn=0,os=0;const Nn=ai==="right"?1:ai==="left"?0:.5;let vn=0;for(const un of Ai){un.trim();const en=un.getMaxScale(),ds=(en-1)*Es,Ss={positionedGlyphs:[],lineOffset:0};St.positionedLines[vn]=Ss;const _s=Ss.positionedGlyphs;let Xs=0;if(!un.length()){zr+=fi,++vn;continue}for(let Fn=0;Fn<un.length();Fn++){const xr=un.getSection(Fn),Us=un.getSectionIndex(Fn),oo=un.getCharCode(Fn);let ao=0,Zl=null,gc=null,na=null,Hu=Es;const mc=!(Zt===s.ai.horizontal||!Qi&&!mo(oo)||Qi&&(am[oo]||(Pn=oo,Li.Arabic(Pn)||Li["Arabic Supplement"](Pn)||Li["Arabic Extended-A"](Pn)||Li["Arabic Presentation Forms-A"](Pn)||Li["Arabic Presentation Forms-B"](Pn))));if(xr.imageName){const yc=oi[xr.imageName];if(!yc)continue;na=xr.imageName,St.iconsInText=St.iconsInText||!0,gc=yc.paddedRect;const _l=yc.displaySize;xr.scale=xr.scale*Es/gr,Zl={width:_l[0],height:_l[1],left:yl,top:-ip,advance:mc?_l[1]:_l[0]},ao=ds+(Es-_l[1]*xr.scale),Hu=Zl.advance;const Bh=mc?_l[0]*xr.scale-Es*en:_l[1]*xr.scale-Es*en;Bh>0&&Bh>Xs&&(Xs=Bh)}else{const yc=xi[xr.fontStack],_l=yc&&yc[oo];if(_l&&_l.rect)gc=_l.rect,Zl=_l.metrics;else{const Bh=Xt[xr.fontStack],_p=Bh&&Bh[oo];if(!_p)continue;Zl=_p.metrics}ao=(en-xr.scale)*Es}mc?(St.verticalizable=!0,_s.push({glyph:oo,imageName:na,x:Dr,y:zr+ao,vertical:mc,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Us,metrics:Zl,rect:gc}),Dr+=Hu*xr.scale+Vi):(_s.push({glyph:oo,imageName:na,x:Dr,y:zr+ao,vertical:mc,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Us,metrics:Zl,rect:gc}),Dr+=Zl.advance*xr.scale+Vi)}_s.length!==0&&(pn=Math.max(Dr-Vi,pn),OT(_s,0,_s.length-1,Nn,Xs)),Dr=0;const Ts=fi*en+Xs;Ss.lineOffset=Math.max(Xs,ds),zr+=Ts,os=Math.max(Ts,os),++vn}var Pn;const cn=zr-Rd,{horizontalAlign:vr,verticalAlign:zn}=L0(Fi);(function(un,en,ds,Ss,_s,Xs,Ts,Fn,xr){const Us=(en-ds)*_s;let oo=0;oo=Xs!==Ts?-Fn*Ss-Rd:(-Ss*xr+.5)*Ts;for(const ao of un)for(const Zl of ao.positionedGlyphs)Zl.x+=Us,Zl.y+=oo})(St.positionedLines,Nn,vr,zn,pn,os,fi,cn,Ai.length),St.top+=-zn*cn,St.bottom=St.top+cn,St.left+=-vr*pn,St.right=St.left+pn}(gt,l,f,v,qe,D,G,$,Ae,X,me,ke),!function(St){for(const Xt of St)if(Xt.positionedGlyphs.length!==0)return!1;return!0}(tt)&&gt}const am={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function T0(h,l,f,v,E,M){if(l.imageName){const D=v[l.imageName];return D?D.displaySize[0]*l.scale*Es/M+E:0}{const D=f[l.fontStack],G=D&&D[h];return G?G.metrics.advance*l.scale+E:0}}function Ud(h,l,f,v){const E=Math.pow(h-l,2);return v?h<l?E/2:2*E:E+Math.abs(f)*f}function Nu(h,l,f){let v=0;return h===10&&(v-=1e4),f&&(v+=150),h!==40&&h!==65288||(v+=50),l!==41&&l!==65289||(v+=50),v}function bh(h,l,f,v,E,M){let D=null,G=Ud(l,f,E,M);for(const $ of v){const X=Ud(l-$.x,f,E,M)+$.badness;X<=G&&(D=$,G=X)}return{index:h,x:l,priorBreak:D,badness:G}}function I0(h){return h?I0(h.priorBreak).concat(h.index):[]}function np(h,l,f,v,E,M,D){if(M!=="point")return[];if(!h)return[];const G=[],$=function(me,Be,Se,ke,He,qe){let ct=0;for(let Ye=0;Ye<me.length();Ye++){const tt=me.getSection(Ye);ct+=T0(me.getCharCode(Ye),tt,ke,He,Be,qe)}return ct/Math.max(1,Math.ceil(ct/Se))}(h,l,f,v,E,D),X=h.text.indexOf("​")>=0;let se=0;for(let me=0;me<h.length();me++){const Be=h.getSection(me),Se=h.getCharCode(me);if(am[Se]||(se+=T0(Se,Be,v,E,l,D)),me<h.length()-1){const ke=!((Ae=Se)<11904||!(Li["Bopomofo Extended"](Ae)||Li.Bopomofo(Ae)||Li["CJK Compatibility Forms"](Ae)||Li["CJK Compatibility Ideographs"](Ae)||Li["CJK Compatibility"](Ae)||Li["CJK Radicals Supplement"](Ae)||Li["CJK Strokes"](Ae)||Li["CJK Symbols and Punctuation"](Ae)||Li["CJK Unified Ideographs Extension A"](Ae)||Li["CJK Unified Ideographs"](Ae)||Li["Enclosed CJK Letters and Months"](Ae)||Li["Halfwidth and Fullwidth Forms"](Ae)||Li.Hiragana(Ae)||Li["Ideographic Description Characters"](Ae)||Li["Kangxi Radicals"](Ae)||Li["Katakana Phonetic Extensions"](Ae)||Li.Katakana(Ae)||Li["Vertical Forms"](Ae)||Li["Yi Radicals"](Ae)||Li["Yi Syllables"](Ae)));(kT[Se]||ke||Be.imageName)&&G.push(bh(me+1,se,$,G,Nu(Se,h.getCharCode(me+1),ke&&X),!1))}}var Ae;return I0(bh(h.length(),se,$,G,0,!0))}function L0(h){let l=.5,f=.5;switch(h){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:l,verticalAlign:f}}function OT(h,l,f,v,E){if(!v&&!E)return;const M=h[f],D=(h[f].x+M.metrics.advance*M.scale)*v;for(let G=l;G<=f;G++)h[G].x-=D,h[G].y+=E}function lm(h,l,f){const{horizontalAlign:v,verticalAlign:E}=L0(f),M=l[0]-h.displaySize[0]*v,D=l[1]-h.displaySize[1]*E;return{image:h,top:D,bottom:D+h.displaySize[1],left:M,right:M+h.displaySize[0]}}function cm(h,l,f,v,E,M){const D=h.image;let G;if(D.content){const He=D.content,qe=D.pixelRatio||1;G=[He[0]/qe,He[1]/qe,D.displaySize[0]-He[2]/qe,D.displaySize[1]-He[3]/qe]}const $=l.left*M,X=l.right*M;let se,Ae,me,Be;f==="width"||f==="both"?(Be=E[0]+$-v[3],Ae=E[0]+X+v[1]):(Be=E[0]+($+X-D.displaySize[0])/2,Ae=Be+D.displaySize[0]);const Se=l.top*M,ke=l.bottom*M;return f==="height"||f==="both"?(se=E[1]+Se-v[0],me=E[1]+ke+v[2]):(se=E[1]+(Se+ke-D.displaySize[1])/2,me=se+D.displaySize[1]),{image:D,top:se,right:Ae,bottom:me,left:Be,collisionPadding:G}}const sp=255,Vc=128,zu=sp*Vc;function NA(h,l){const{expression:f}=l;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new bi(h+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:E}=f;let M=0;for(;M<v.length&&v[M]<=h;)M++;M=Math.max(0,M-1);let D=M;for(;D<v.length&&v[D]<h+1;)D++;D=Math.min(v.length-1,D);const G=v[M],$=v[D];return f.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:$,interpolationType:E}:{kind:"camera",minZoom:G,maxZoom:$,minSize:f.evaluate(new bi(G)),maxSize:f.evaluate(new bi($)),interpolationType:E}}}function um(h,l,f){let v="never";const E=h.get(l);return E?v=E:h.get(f)&&(v="always"),v}const Yb=rA.VectorTileFeature.types,M0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function op(h,l,f,v,E,M,D,G,$,X,se,Ae,me){const Be=G?Math.min(zu,Math.round(G[0])):0,Se=G?Math.min(zu,Math.round(G[1])):0;h.emplaceBack(l,f,Math.round(32*v),Math.round(32*E),M,D,(Be<<1)+($?1:0),Se,16*X,16*se,256*Ae,256*me)}function Nd(h,l,f){h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f)}function ex(h){for(const l of h.sections)if(Fc(l.text))return!0;return!1}class P0{constructor(l){this.layoutVertexArray=new bt,this.indexArray=new Vt,this.programConfigurations=l,this.segments=new Ti,this.dynamicLayoutVertexArray=new ht,this.opacityVertexArray=new Rt,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,f,v,E){this.isEmpty()||(v&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Vb.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Hb.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,M0,!0),this.opacityVertexBuffer.itemSize=1),(v||E)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Oi("SymbolBuffers",P0);class F0{constructor(l,f,v){this.layoutVertexArray=new l,this.layoutAttributes=f,this.indexArray=new v,this.segments=new Ti,this.collisionVertexArray=new hi}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Kn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Oi("CollisionBuffers",F0);class zA{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(D=>D.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bd([]),this.placementViewportMatrix=Bd([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=NA(this.zoom,f["text-size"]),this.iconSizeData=NA(this.zoom,f["icon-size"]);const v=this.layers[0].layout,E=v.get("symbol-sort-key"),M=v.get("symbol-z-order");this.canOverlap=um(v,"text-overlap","text-allow-overlap")!=="never"||um(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=M!=="viewport-y"&&!E.isConstant(),this.sortFeaturesByY=(M==="viewport-y"||M==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(D=>s.ai[D])),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.sourceID=l.sourceID}createArrays(){this.text=new P0(new so(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new P0(new so(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new J,this.lineVertexArray=new ee,this.symbolInstances=new W,this.textAnchorOffsets=new fe}calculateGlyphDependencies(l,f,v,E,M){for(let D=0;D<l.length;D++)if(f[l.charCodeAt(D)]=!0,(v||E)&&M){const G=pc[l.charAt(D)];G&&(f[G.charCodeAt(0)]=!0)}}populate(l,f,v){const E=this.layers[0],M=E.layout,D=M.get("text-font"),G=M.get("text-field"),$=M.get("icon-image"),X=(G.value.kind!=="constant"||G.value.value instanceof Qr&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),se=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,Ae=M.get("symbol-sort-key");if(this.features=[],!X&&!se)return;const me=f.iconDependencies,Be=f.glyphDependencies,Se=f.availableImages,ke=new bi(this.zoom);for(const{feature:He,id:qe,index:ct,sourceLayerIndex:Ye}of l){const tt=E._featureFilter.needGeometry,gt=Nc(He,tt);if(!E._featureFilter.filter(ke,gt,v))continue;let St,Xt;if(tt||(gt.geometry=Uc(He)),X){const oi=E.getValueAndResolveTokens("text-field",gt,v,Se),Ai=Qr.factory(oi);ex(Ai)&&(this.hasRTLText=!0),(!this.hasRTLText||su()==="unavailable"||this.hasRTLText&&$s.isParsed())&&(St=jb(Ai,E,gt))}if(se){const oi=E.getValueAndResolveTokens("icon-image",gt,v,Se);Xt=oi instanceof Wi?oi:Wi.fromString(oi)}if(!St&&!Xt)continue;const xi=this.sortFeaturesByKey?Ae.evaluate(gt,{},v):void 0;if(this.features.push({id:qe,text:St,icon:Xt,index:ct,sourceLayerIndex:Ye,geometry:gt.geometry,properties:He.properties,type:Yb[He.type],sortKey:xi}),Xt&&(me[Xt.name]=!0),St){const oi=D.evaluate(gt,{},v).join(","),Ai=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const fi of St.sections)if(fi.image)me[fi.image.name]=!0;else{const Fi=Gl(St.toString()),ai=fi.fontStack||oi,Zt=Be[ai]=Be[ai]||{};this.calculateGlyphDependencies(fi.text,Zt,Ai,this.allowVerticalPlacement,Fi)}}}M.get("symbol-placement")==="line"&&(this.features=function(He){const qe={},ct={},Ye=[];let tt=0;function gt(oi){Ye.push(He[oi]),tt++}function St(oi,Ai,fi){const Fi=ct[oi];return delete ct[oi],ct[Ai]=Fi,Ye[Fi].geometry[0].pop(),Ye[Fi].geometry[0]=Ye[Fi].geometry[0].concat(fi[0]),Fi}function Xt(oi,Ai,fi){const Fi=qe[Ai];return delete qe[Ai],qe[oi]=Fi,Ye[Fi].geometry[0].shift(),Ye[Fi].geometry[0]=fi[0].concat(Ye[Fi].geometry[0]),Fi}function xi(oi,Ai,fi){const Fi=fi?Ai[0][Ai[0].length-1]:Ai[0][0];return`${oi}:${Fi.x}:${Fi.y}`}for(let oi=0;oi<He.length;oi++){const Ai=He[oi],fi=Ai.geometry,Fi=Ai.text?Ai.text.toString():null;if(!Fi){gt(oi);continue}const ai=xi(Fi,fi),Zt=xi(Fi,fi,!0);if(ai in ct&&Zt in qe&&ct[ai]!==qe[Zt]){const Vi=Xt(ai,Zt,fi),Qi=St(ai,Zt,Ye[Vi].geometry);delete qe[ai],delete ct[Zt],ct[xi(Fi,Ye[Qi].geometry,!0)]=Qi,Ye[Vi].geometry=null}else ai in ct?St(ai,Zt,fi):Zt in qe?Xt(ai,Zt,fi):(gt(oi),qe[ai]=tt-1,ct[Zt]=tt-1)}return Ye.filter(oi=>oi.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((He,qe)=>He.sortKey-qe.sortKey)}update(l,f,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,f,this.layers,v),this.icon.programConfigurations.updatePaintArrays(l,f,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,f){const v=this.lineVertexArray.length;if(l.segment!==void 0){let E=l.dist(f[l.segment+1]),M=l.dist(f[l.segment]);const D={};for(let G=l.segment+1;G<f.length;G++)D[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:E},G<f.length-1&&(E+=f[G+1].dist(f[G]));for(let G=l.segment||0;G>=0;G--)D[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:M},G>0&&(M+=f[G-1].dist(f[G]));for(let G=0;G<f.length;G++){const $=D[G];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(l,f,v,E,M,D,G,$,X,se,Ae,me){const Be=l.indexArray,Se=l.layoutVertexArray,ke=l.segments.prepareSegment(4*f.length,Se,Be,this.canOverlap?D.sortKey:void 0),He=this.glyphOffsetArray.length,qe=ke.vertexLength,ct=this.allowVerticalPlacement&&G===s.ai.vertical?Math.PI/2:0,Ye=D.text&&D.text.sections;for(let tt=0;tt<f.length;tt++){const{tl:gt,tr:St,bl:Xt,br:xi,tex:oi,pixelOffsetTL:Ai,pixelOffsetBR:fi,minFontScaleX:Fi,minFontScaleY:ai,glyphOffset:Zt,isSDF:Vi,sectionIndex:Qi}=f[tt],gr=ke.vertexLength,Dr=Zt[1];op(Se,$.x,$.y,gt.x,Dr+gt.y,oi.x,oi.y,v,Vi,Ai.x,Ai.y,Fi,ai),op(Se,$.x,$.y,St.x,Dr+St.y,oi.x+oi.w,oi.y,v,Vi,fi.x,Ai.y,Fi,ai),op(Se,$.x,$.y,Xt.x,Dr+Xt.y,oi.x,oi.y+oi.h,v,Vi,Ai.x,fi.y,Fi,ai),op(Se,$.x,$.y,xi.x,Dr+xi.y,oi.x+oi.w,oi.y+oi.h,v,Vi,fi.x,fi.y,Fi,ai),Nd(l.dynamicLayoutVertexArray,$,ct),Be.emplaceBack(gr,gr+1,gr+2),Be.emplaceBack(gr+1,gr+2,gr+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zt[0]),tt!==f.length-1&&Qi===f[tt+1].sectionIndex||l.programConfigurations.populatePaintArrays(Se.length,D,D.index,{},me,Ye&&Ye[Qi])}l.placedSymbolArray.emplaceBack($.x,$.y,He,this.glyphOffsetArray.length-He,qe,X,se,$.segment,v?v[0]:0,v?v[1]:0,E[0],E[1],G,0,!1,0,Ae)}_addCollisionDebugVertex(l,f,v,E,M,D){return f.emplaceBack(0,0),l.emplaceBack(v.x,v.y,E,M,Math.round(D.x),Math.round(D.y))}addCollisionDebugVertices(l,f,v,E,M,D,G){const $=M.segments.prepareSegment(4,M.layoutVertexArray,M.indexArray),X=$.vertexLength,se=M.layoutVertexArray,Ae=M.collisionVertexArray,me=G.anchorX,Be=G.anchorY;this._addCollisionDebugVertex(se,Ae,D,me,Be,new O(l,f)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new O(v,f)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new O(v,E)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new O(l,E)),$.vertexLength+=4;const Se=M.indexArray;Se.emplaceBack(X,X+1),Se.emplaceBack(X+1,X+2),Se.emplaceBack(X+2,X+3),Se.emplaceBack(X+3,X),$.primitiveLength+=4}addDebugCollisionBoxes(l,f,v,E){for(let M=l;M<f;M++){const D=this.collisionBoxArray.get(M);this.addCollisionDebugVertices(D.x1,D.y1,D.x2,D.y2,E?this.textCollisionBox:this.iconCollisionBox,D.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new F0(Dt,im.members,_i),this.iconCollisionBox=new F0(Dt,im.members,_i);for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(l,f,v,E,M,D,G,$,X){const se={};for(let Ae=f;Ae<v;Ae++){const me=l.get(Ae);se.textBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.textFeatureIndex=me.featureIndex;break}for(let Ae=E;Ae<M;Ae++){const me=l.get(Ae);se.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.verticalTextFeatureIndex=me.featureIndex;break}for(let Ae=D;Ae<G;Ae++){const me=l.get(Ae);se.iconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.iconFeatureIndex=me.featureIndex;break}for(let Ae=$;Ae<X;Ae++){const me=l.get(Ae);se.verticalIconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.verticalIconFeatureIndex=me.featureIndex;break}return se}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const v=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,f){const v=l.placedSymbolArray.get(f),E=v.vertexStartIndex+4*v.numGlyphs;for(let M=v.vertexStartIndex;M<E;M+=4)l.indexArray.emplaceBack(M,M+1,M+2),l.indexArray.emplaceBack(M+1,M+2,M+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(l),v=Math.cos(l),E=[],M=[],D=[];for(let G=0;G<this.symbolInstances.length;++G){D.push(G);const $=this.symbolInstances.get(G);E.push(0|Math.round(f*$.anchorX+v*$.anchorY)),M.push($.featureIndex)}return D.sort((G,$)=>E[G]-E[$]||M[$]-M[G]),D}addToSortKeyRanges(l,f){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===f?v.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const v=this.symbolInstances.get(f);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((E,M,D)=>{E>=0&&D.indexOf(E)===M&&this.addIndicesForPlacedSymbol(this.text,E)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let tx,ix;Oi("SymbolBucket",zA,{omit:["layers","collisionBoxArray","features","compareText"]}),zA.MAX_GLYPHS=65535,zA.addDynamicAttributes=Nd;var D0={get paint(){return ix=ix||new tn({"icon-opacity":new Ni(ut.paint_symbol["icon-opacity"]),"icon-color":new Ni(ut.paint_symbol["icon-color"]),"icon-halo-color":new Ni(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ni(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ni(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new $i(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new $i(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ni(ut.paint_symbol["text-opacity"]),"text-color":new Ni(ut.paint_symbol["text-color"],{runtimeType:mr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Ni(ut.paint_symbol["text-halo-color"]),"text-halo-width":new Ni(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new Ni(ut.paint_symbol["text-halo-blur"]),"text-translate":new $i(ut.paint_symbol["text-translate"]),"text-translate-anchor":new $i(ut.paint_symbol["text-translate-anchor"])})},get layout(){return tx=tx||new tn({"symbol-placement":new $i(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new $i(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $i(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ni(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $i(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $i(ut.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $i(ut.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $i(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new $i(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $i(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ni(ut.layout_symbol["icon-size"]),"icon-text-fit":new $i(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $i(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ni(ut.layout_symbol["icon-image"]),"icon-rotate":new Ni(ut.layout_symbol["icon-rotate"]),"icon-padding":new Ni(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new $i(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new Ni(ut.layout_symbol["icon-offset"]),"icon-anchor":new Ni(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $i(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $i(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $i(ut.layout_symbol["text-rotation-alignment"]),"text-field":new Ni(ut.layout_symbol["text-field"]),"text-font":new Ni(ut.layout_symbol["text-font"]),"text-size":new Ni(ut.layout_symbol["text-size"]),"text-max-width":new Ni(ut.layout_symbol["text-max-width"]),"text-line-height":new $i(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new Ni(ut.layout_symbol["text-letter-spacing"]),"text-justify":new Ni(ut.layout_symbol["text-justify"]),"text-radial-offset":new Ni(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $i(ut.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ni(ut.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ni(ut.layout_symbol["text-anchor"]),"text-max-angle":new $i(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new $i(ut.layout_symbol["text-writing-mode"]),"text-rotate":new Ni(ut.layout_symbol["text-rotate"]),"text-padding":new $i(ut.layout_symbol["text-padding"]),"text-keep-upright":new $i(ut.layout_symbol["text-keep-upright"]),"text-transform":new Ni(ut.layout_symbol["text-transform"]),"text-offset":new Ni(ut.layout_symbol["text-offset"]),"text-allow-overlap":new $i(ut.layout_symbol["text-allow-overlap"]),"text-overlap":new $i(ut.layout_symbol["text-overlap"]),"text-ignore-placement":new $i(ut.layout_symbol["text-ignore-placement"]),"text-optional":new $i(ut.layout_symbol["text-optional"])})}};class rx{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:Ii,this.defaultValue=l}evaluate(l){if(l.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(l.formattedSection))return f.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Oi("FormatSectionOverride",rx,{omit:["defaultValue"]});class zd extends Ro{constructor(l){super(l,D0)}recalculate(l,f){if(super.recalculate(l,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const E=[];for(const M of v)E.indexOf(M)<0&&E.push(M);this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,f,v,E){const M=this.layout.get(l).evaluate(f,{},v,E),D=this._unevaluatedLayout._values[l];return D.isDataDriven()||Br(D.value)||!M?M:function(G,$){return $.replace(/{([^{}]+)}/g,(X,se)=>G&&se in G?String(G[se]):"")}(f.properties,M)}createBucket(l){return new zA(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of D0.paint.overridableProperties){if(!zd.hasPaintOverride(this.layout,l))continue;const f=this.paint.get(l),v=new rx(f),E=new Hn(v,f.property.specification);let M=null;M=f.value.kind==="constant"||f.value.kind==="source"?new On("source",E):new qs("composite",E,f.value.zoomStops),this.paint._values[l]=new jn(f.property,M,f.parameters)}}_handleOverridablePaintPropertyUpdate(l,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&zd.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,f){const v=l.get("text-field"),E=D0.paint.properties[f];let M=!1;const D=G=>{for(const $ of G)if(E.overrides&&E.overrides.hasOverride($))return void(M=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Qr)D(v.value.value.sections);else if(v.value.kind==="source"){const G=X=>{M||(X instanceof Vn&&dr(X.value)===oe?D(X.value.sections):X instanceof Ka?D(X.sections):X.eachChild(G))},$=v.value;$._styleExpression&&G($._styleExpression.expression)}return M}}let xh;var nx={get paint(){return xh=xh||new tn({"background-color":new $i(ut.paint_background["background-color"]),"background-pattern":new Pu(ut.paint_background["background-pattern"]),"background-opacity":new $i(ut.paint_background["background-opacity"])})}};class sx extends Ro{constructor(l){super(l,nx)}}let R0;var ox={get paint(){return R0=R0||new tn({"raster-opacity":new $i(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new $i(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $i(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $i(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new $i(ut.paint_raster["raster-saturation"]),"raster-contrast":new $i(ut.paint_raster["raster-contrast"]),"raster-resampling":new $i(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new $i(ut.paint_raster["raster-fade-duration"])})}};class ax extends Ro{constructor(l){super(l,ox)}}class k0 extends Ro{constructor(l){super(l,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class hm{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Am=63710088e-1;class Qu{constructor(l,f){if(isNaN(l)||isNaN(f))throw new Error(`Invalid LngLat object: (${l}, ${f})`);if(this.lng=+l,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qu($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const f=Math.PI/180,v=this.lat*f,E=l.lat*f,M=Math.sin(v)*Math.sin(E)+Math.cos(v)*Math.cos(E)*Math.cos((l.lng-this.lng)*f);return Am*Math.acos(Math.min(M,1))}static convert(l){if(l instanceof Qu)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Qu(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Qu(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const O0=2*Math.PI*Am;function Xl(h){return O0*Math.cos(h*Math.PI/180)}function Qd(h){return(180+h)/360}function U0(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function N0(h,l){return h/Xl(l)}function z0(h){return 360*h-180}function dm(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class ap{constructor(l,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+l,this.y=+f,this.z=+v}static fromLngLat(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const v=Qu.convert(l);return new ap(Qd(v.lng),U0(v.lat),N0(f,v.lat))}toLngLat(){return new Qu(z0(this.x),dm(this.y))}toAltitude(){return this.z*Xl(dm(this.y))}meterInMercatorCoordinateUnits(){return 1/O0*(l=dm(this.y),1/Math.cos(l*Math.PI/180));var l}}function Q0(h,l,f){var v=2*Math.PI*6378137/256/Math.pow(2,f);return[h*v-2*Math.PI*6378137/2,l*v-2*Math.PI*6378137/2]}class V0{constructor(l,f,v){if(l<0||l>25||v<0||v>=Math.pow(2,l)||f<0||f>=Math.pow(2,l))throw new Error(`x=${f}, y=${v}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=f,this.y=v,this.key=Vd(0,l,l,f,v)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,f,v){const E=(D=this.y,G=this.z,$=Q0(256*(M=this.x),256*(D=Math.pow(2,G)-D-1),G),X=Q0(256*(M+1),256*(D+1),G),$[0]+","+$[1]+","+X[0]+","+X[1]);var M,D,G,$,X;const se=function(Ae,me,Be){let Se,ke="";for(let He=Ae;He>0;He--)Se=1<<He-1,ke+=(me&Se?1:0)+(Be&Se?2:0);return ke}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,se).replace(/{bbox-epsg-3857}/g,E)}isChildOf(l){const f=this.z-l.z;return f>0&&l.x===this.x>>f&&l.y===this.y>>f}getTilePoint(l){const f=Math.pow(2,this.z);return new O((l.x*f-this.x)*In,(l.y*f-this.y)*In)}toString(){return`${this.z}/${this.x}/${this.y}`}}class H0{constructor(l,f){this.wrap=l,this.canonical=f,this.key=Vd(l,f.z,f.z,f.x,f.y)}}class zo{constructor(l,f,v,E,M){if(l<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${v}`);this.overscaledZ=l,this.wrap=f,this.canonical=new V0(v,+E,+M),this.key=Vd(f,l,v,E,M)}clone(){return new zo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-l;return l>this.canonical.z?new zo(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(l,this.wrap,l,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(l,f){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-l;return l>this.canonical.z?Vd(this.wrap*+f,l,this.canonical.z,this.canonical.x,this.canonical.y):Vd(this.wrap*+f,l,l,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const f=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>f&&l.canonical.y===this.canonical.y>>f}children(l){if(this.overscaledZ>=l)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,v=2*this.canonical.x,E=2*this.canonical.y;return[new zo(f,this.wrap,f,v,E),new zo(f,this.wrap,f,v+1,E),new zo(f,this.wrap,f,v,E+1),new zo(f,this.wrap,f,v+1,E+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new zo(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new H0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new ap(l.x-this.wrap,l.y))}}function Vd(h,l,f,v,E){(h*=2)<0&&(h=-1*h-1);const M=1<<f;return(M*M*h+M*E+v).toString(36)+f.toString(36)+l.toString(36)}Oi("CanonicalTileID",V0),Oi("OverscaledTileID",zo,{omit:["posMatrix"]});class G0{constructor(l,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,G=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=l,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(v&&!["mapbox","terrarium","custom"].includes(v))return void We(`"${v}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const $=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),v){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=E,this.greenFactor=M,this.blueFactor=D,this.baseShift=G;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let X=0;X<$;X++)this.data[this._idx(-1,X)]=this.data[this._idx(0,X)],this.data[this._idx($,X)]=this.data[this._idx($-1,X)],this.data[this._idx(X,-1)]=this.data[this._idx(X,0)],this.data[this._idx(X,$)]=this.data[this._idx(X,$-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx($,-1)]=this.data[this._idx($-1,0)],this.data[this._idx(-1,$)]=this.data[this._idx(0,$-1)],this.data[this._idx($,$)]=this.data[this._idx($-1,$-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let X=0;X<$;X++)for(let se=0;se<$;se++){const Ae=this.get(X,se);Ae>this.max&&(this.max=Ae),Ae<this.min&&(this.min=Ae)}}get(l,f){const v=new Uint8Array(this.data.buffer),E=4*this._idx(l,f);return this.unpack(v[E],v[E+1],v[E+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,f){if(l<-1||l>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(l+1)}unpack(l,f,v){return l*this.redFactor+f*this.greenFactor+v*this.blueFactor-this.baseShift}getPixels(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,f,v){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let E=f*this.dim,M=f*this.dim+this.dim,D=v*this.dim,G=v*this.dim+this.dim;switch(f){case-1:E=M-1;break;case 1:M=E+1}switch(v){case-1:D=G-1;break;case 1:G=D+1}const $=-f*this.dim,X=-v*this.dim;for(let se=D;se<G;se++)for(let Ae=E;Ae<M;Ae++)this.data[this._idx(Ae,se)]=l.data[this._idx(Ae+$,se+X)]}}Oi("DEMData",G0);class j0{constructor(l){this._stringToNumber={},this._numberToString=[];for(let f=0;f<l.length;f++){const v=l[f];this._stringToNumber[v]=f,this._numberToString[f]=v}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class q0{constructor(l,f,v,E,M){this.type="Feature",this._vectorTileFeature=l,l._z=f,l._x=v,l._y=E,this.properties=l.properties,this.id=M}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(l[f]=this[f]);return l}}class lx{constructor(l,f){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new go(In,16,0),this.grid3D=new go(In,16,0),this.featureIndexArray=new xe,this.promoteId=f}insert(l,f,v,E,M,D){const G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,E,M);const $=D?this.grid3D:this.grid;for(let X=0;X<f.length;X++){const se=f[X],Ae=[1/0,1/0,-1/0,-1/0];for(let me=0;me<se.length;me++){const Be=se[me];Ae[0]=Math.min(Ae[0],Be.x),Ae[1]=Math.min(Ae[1],Be.y),Ae[2]=Math.max(Ae[2],Be.x),Ae[3]=Math.max(Ae[3],Be.y)}Ae[0]<In&&Ae[1]<In&&Ae[2]>=0&&Ae[3]>=0&&$.insert(G,Ae[0],Ae[1],Ae[2],Ae[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new rA.VectorTile(new sm(this.rawTileData)).layers,this.sourceLayerCoder=new j0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,f,v,E){this.loadVTLayers();const M=l.params||{},D=In/l.tileSize/l.scale,G=ol(M.filter),$=l.queryGeometry,X=l.queryPadding*D,se=$0($),Ae=this.grid.query(se.minX-X,se.minY-X,se.maxX+X,se.maxY+X),me=$0(l.cameraQueryGeometry),Be=this.grid3D.query(me.minX-X,me.minY-X,me.maxX+X,me.maxY+X,(He,qe,ct,Ye)=>function(tt,gt,St,Xt,xi){for(const Ai of tt)if(gt<=Ai.x&&St<=Ai.y&&Xt>=Ai.x&&xi>=Ai.y)return!0;const oi=[new O(gt,St),new O(gt,xi),new O(Xt,xi),new O(Xt,St)];if(tt.length>2){for(const Ai of oi)if(Wl(tt,Ai))return!0}for(let Ai=0;Ai<tt.length-1;Ai++)if(Jh(tt[Ai],tt[Ai+1],oi))return!0;return!1}(l.cameraQueryGeometry,He-X,qe-X,ct+X,Ye+X));for(const He of Be)Ae.push(He);Ae.sort(Hd);const Se={};let ke;for(let He=0;He<Ae.length;He++){const qe=Ae[He];if(qe===ke)continue;ke=qe;const ct=this.featureIndexArray.get(qe);let Ye=null;this.loadMatchingFeature(Se,ct.bucketIndex,ct.sourceLayerIndex,ct.featureIndex,G,M.layers,M.availableImages,f,v,E,(tt,gt,St)=>(Ye||(Ye=Uc(tt)),gt.queryIntersectsFeature($,tt,St,Ye,this.z,l.transform,D,l.pixelPosMatrix)))}return Se}loadMatchingFeature(l,f,v,E,M,D,G,$,X,se,Ae){const me=this.bucketLayerIDs[f];if(D&&!function(He,qe){for(let ct=0;ct<He.length;ct++)if(qe.indexOf(He[ct])>=0)return!0;return!1}(D,me))return;const Be=this.sourceLayerCoder.decode(v),Se=this.vtLayers[Be].feature(E);if(M.needGeometry){const He=Nc(Se,!0);if(!M.filter(new bi(this.tileID.overscaledZ),He,this.tileID.canonical))return}else if(!M.filter(new bi(this.tileID.overscaledZ),Se))return;const ke=this.getId(Se,Be);for(let He=0;He<me.length;He++){const qe=me[He];if(D&&D.indexOf(qe)<0)continue;const ct=$[qe];if(!ct)continue;let Ye={};ke&&se&&(Ye=se.getState(ct.sourceLayer||"_geojsonTileLayer",ke));const tt=Ue({},X[qe]);tt.paint=cx(tt.paint,ct.paint,Se,Ye,G),tt.layout=cx(tt.layout,ct.layout,Se,Ye,G);const gt=!Ae||Ae(Se,ct,Ye);if(!gt)continue;const St=new q0(Se,this.z,this.x,this.y,ke);St.layer=tt;let Xt=l[qe];Xt===void 0&&(Xt=l[qe]=[]),Xt.push({featureIndex:E,feature:St,intersectionZ:gt})}}lookupSymbolFeatures(l,f,v,E,M,D,G,$){const X={};this.loadVTLayers();const se=ol(M);for(const Ae of l)this.loadMatchingFeature(X,v,E,Ae,se,D,G,$,f);return X}hasLayer(l){for(const f of this.bucketLayerIDs)for(const v of f)if(l===v)return!0;return!1}getId(l,f){let v=l.id;return this.promoteId&&(v=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof v=="boolean"&&(v=Number(v))),v}}function cx(h,l,f,v,E){return nt(h,(M,D)=>{const G=l instanceof ou?l.get(D):null;return G&&G.evaluate?G.evaluate(f,v,E):G})}function $0(h){let l=1/0,f=1/0,v=-1/0,E=-1/0;for(const M of h)l=Math.min(l,M.x),f=Math.min(f,M.y),v=Math.max(v,M.x),E=Math.max(E,M.y);return{minX:l,minY:f,maxX:v,maxY:E}}function Hd(h,l){return l-h}function K0(h,l,f,v,E){const M=[];for(let D=0;D<h.length;D++){const G=h[D];let $;for(let X=0;X<G.length-1;X++){let se=G[X],Ae=G[X+1];se.x<l&&Ae.x<l||(se.x<l?se=new O(l,se.y+(l-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round():Ae.x<l&&(Ae=new O(l,se.y+(l-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round()),se.y<f&&Ae.y<f||(se.y<f?se=new O(se.x+(f-se.y)/(Ae.y-se.y)*(Ae.x-se.x),f)._round():Ae.y<f&&(Ae=new O(se.x+(f-se.y)/(Ae.y-se.y)*(Ae.x-se.x),f)._round()),se.x>=v&&Ae.x>=v||(se.x>=v?se=new O(v,se.y+(v-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round():Ae.x>=v&&(Ae=new O(v,se.y+(v-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round()),se.y>=E&&Ae.y>=E||(se.y>=E?se=new O(se.x+(E-se.y)/(Ae.y-se.y)*(Ae.x-se.x),E)._round():Ae.y>=E&&(Ae=new O(se.x+(E-se.y)/(Ae.y-se.y)*(Ae.x-se.x),E)._round()),$&&se.equals($[$.length-1])||($=[se],M.push($)),$.push(Ae)))))}}return M}Oi("FeatureIndex",lx,{omit:["rawTileData","sourceLayerCoder"]});class du extends O{constructor(l,f,v,E){super(l,f),this.angle=v,E!==void 0&&(this.segment=E)}clone(){return new du(this.x,this.y,this.angle,this.segment)}}function W0(h,l,f,v,E){if(l.segment===void 0||f===0)return!0;let M=l,D=l.segment+1,G=0;for(;G>-f/2;){if(D--,D<0)return!1;G-=h[D].dist(M),M=h[D]}G+=h[D].dist(h[D+1]),D++;const $=[];let X=0;for(;G<f/2;){const se=h[D],Ae=h[D+1];if(!Ae)return!1;let me=h[D-1].angleTo(se)-se.angleTo(Ae);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),$.push({distance:G,angleDelta:me}),X+=me;G-$[0].distance>v;)X-=$.shift().angleDelta;if(X>E)return!1;D++,G+=se.dist(Ae)}return!0}function lp(h){let l=0;for(let f=0;f<h.length-1;f++)l+=h[f].dist(h[f+1]);return l}function cp(h,l,f){return h?.6*l*f:0}function up(h,l){return Math.max(h?h.right-h.left:0,l?l.right-l.left:0)}function UT(h,l,f,v,E,M){const D=cp(f,E,M),G=up(f,v)*M;let $=0;const X=lp(h)/2;for(let se=0;se<h.length-1;se++){const Ae=h[se],me=h[se+1],Be=Ae.dist(me);if($+Be>X){const Se=(X-$)/Be,ke=us.number(Ae.x,me.x,Se),He=us.number(Ae.y,me.y,Se),qe=new du(ke,He,me.angleTo(Ae),se);return qe._round(),!D||W0(h,qe,G,D,l)?qe:void 0}$+=Be}}function NT(h,l,f,v,E,M,D,G,$){const X=cp(v,M,D),se=up(v,E),Ae=se*D,me=h[0].x===0||h[0].x===$||h[0].y===0||h[0].y===$;return l-Ae<l/4&&(l=Ae+l/4),ux(h,me?l/2*G%l:(se/2+2*M)*D*G%l,l,X,f,Ae,me,!1,$)}function ux(h,l,f,v,E,M,D,G,$){const X=M/2,se=lp(h);let Ae=0,me=l-f,Be=[];for(let Se=0;Se<h.length-1;Se++){const ke=h[Se],He=h[Se+1],qe=ke.dist(He),ct=He.angleTo(ke);for(;me+f<Ae+qe;){me+=f;const Ye=(me-Ae)/qe,tt=us.number(ke.x,He.x,Ye),gt=us.number(ke.y,He.y,Ye);if(tt>=0&&tt<$&&gt>=0&&gt<$&&me-X>=0&&me+X<=se){const St=new du(tt,gt,ct,Se);St._round(),v&&!W0(h,St,M,v,E)||Be.push(St)}}Ae+=qe}return G||Be.length||D||(Be=ux(h,Ae/2,f,v,E,M,D,!0,$)),Be}Oi("Anchor",du);const Gd=yl;function QA(h,l,f,v){const E=[],M=h.image,D=M.pixelRatio,G=M.paddedRect.w-2*Gd,$=M.paddedRect.h-2*Gd,X=h.right-h.left,se=h.bottom-h.top,Ae=M.stretchX||[[0,G]],me=M.stretchY||[[0,$]],Be=(fi,Fi)=>fi+Fi[1]-Fi[0],Se=Ae.reduce(Be,0),ke=me.reduce(Be,0),He=G-Se,qe=$-ke;let ct=0,Ye=Se,tt=0,gt=ke,St=0,Xt=He,xi=0,oi=qe;if(M.content&&v){const fi=M.content;ct=vo(Ae,0,fi[0]),tt=vo(me,0,fi[1]),Ye=vo(Ae,fi[0],fi[2]),gt=vo(me,fi[1],fi[3]),St=fi[0]-ct,xi=fi[1]-tt,Xt=fi[2]-fi[0]-Ye,oi=fi[3]-fi[1]-gt}const Ai=(fi,Fi,ai,Zt)=>{const Vi=jd(fi.stretch-ct,Ye,X,h.left),Qi=hp(fi.fixed-St,Xt,fi.stretch,Se),gr=jd(Fi.stretch-tt,gt,se,h.top),Dr=hp(Fi.fixed-xi,oi,Fi.stretch,ke),zr=jd(ai.stretch-ct,Ye,X,h.left),pn=hp(ai.fixed-St,Xt,ai.stretch,Se),os=jd(Zt.stretch-tt,gt,se,h.top),Nn=hp(Zt.fixed-xi,oi,Zt.stretch,ke),vn=new O(Vi,gr),Pn=new O(zr,gr),cn=new O(zr,os),vr=new O(Vi,os),zn=new O(Qi/D,Dr/D),un=new O(pn/D,Nn/D),en=l*Math.PI/180;if(en){const _s=Math.sin(en),Xs=Math.cos(en),Ts=[Xs,-_s,_s,Xs];vn._matMult(Ts),Pn._matMult(Ts),vr._matMult(Ts),cn._matMult(Ts)}const ds=fi.stretch+fi.fixed,Ss=Fi.stretch+Fi.fixed;return{tl:vn,tr:Pn,bl:vr,br:cn,tex:{x:M.paddedRect.x+Gd+ds,y:M.paddedRect.y+Gd+Ss,w:ai.stretch+ai.fixed-ds,h:Zt.stretch+Zt.fixed-Ss},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zn,pixelOffsetBR:un,minFontScaleX:Xt/D/X,minFontScaleY:oi/D/se,isSDF:f}};if(v&&(M.stretchX||M.stretchY)){const fi=wh(Ae,He,Se),Fi=wh(me,qe,ke);for(let ai=0;ai<fi.length-1;ai++){const Zt=fi[ai],Vi=fi[ai+1];for(let Qi=0;Qi<Fi.length-1;Qi++)E.push(Ai(Zt,Fi[Qi],Vi,Fi[Qi+1]))}}else E.push(Ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:$+1}));return E}function vo(h,l,f){let v=0;for(const E of h)v+=Math.max(l,Math.min(f,E[1]))-Math.max(l,Math.min(f,E[0]));return v}function wh(h,l,f){const v=[{fixed:-Gd,stretch:0}];for(const[E,M]of h){const D=v[v.length-1];v.push({fixed:E-D.stretch,stretch:D.stretch}),v.push({fixed:E-D.stretch,stretch:D.stretch+(M-E)})}return v.push({fixed:l+Gd,stretch:f}),v}function jd(h,l,f,v){return h/l*f+v}function hp(h,l,f,v){return h-l*f/v}class Ap{constructor(l,f,v,E,M,D,G,$,X,se){if(this.boxStartIndex=l.length,X){let Ae=D.top,me=D.bottom;const Be=D.collisionPadding;Be&&(Ae-=Be[1],me+=Be[3]);let Se=me-Ae;Se>0&&(Se=Math.max(10,Se),this.circleDiameter=Se)}else{let Ae=D.top*G-$[0],me=D.bottom*G+$[2],Be=D.left*G-$[3],Se=D.right*G+$[1];const ke=D.collisionPadding;if(ke&&(Be-=ke[0]*G,Ae-=ke[1]*G,Se+=ke[2]*G,me+=ke[3]*G),se){const He=new O(Be,Ae),qe=new O(Se,Ae),ct=new O(Be,me),Ye=new O(Se,me),tt=se*Math.PI/180;He._rotate(tt),qe._rotate(tt),ct._rotate(tt),Ye._rotate(tt),Be=Math.min(He.x,qe.x,ct.x,Ye.x),Se=Math.max(He.x,qe.x,ct.x,Ye.x),Ae=Math.min(He.y,qe.y,ct.y,Ye.y),me=Math.max(He.y,qe.y,ct.y,Ye.y)}l.emplaceBack(f.x,f.y,Be,Ae,Se,me,v,E,M)}this.boxEndIndex=l.length}}class X0{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zT;if(this.data=l,this.length=this.data.length,this.compare=f,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:f,compare:v}=this,E=f[l];for(;l>0;){const M=l-1>>1,D=f[M];if(v(E,D)>=0)break;f[l]=D,l=M}f[l]=E}_down(l){const{data:f,compare:v}=this,E=this.length>>1,M=f[l];for(;l<E;){let D=1+(l<<1),G=f[D];const $=D+1;if($<this.length&&v(f[$],G)<0&&(D=$,G=f[$]),v(G,M)>=0)break;f[l]=G,l=D}f[l]=M}}function zT(h,l){return h<l?-1:h>l?1:0}function hx(h){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=1/0,E=1/0,M=-1/0,D=-1/0;const G=h[0];for(let Be=0;Be<G.length;Be++){const Se=G[Be];(!Be||Se.x<v)&&(v=Se.x),(!Be||Se.y<E)&&(E=Se.y),(!Be||Se.x>M)&&(M=Se.x),(!Be||Se.y>D)&&(D=Se.y)}const $=Math.min(M-v,D-E);let X=$/2;const se=new X0([],Ax);if($===0)return new O(v,E);for(let Be=v;Be<M;Be+=$)for(let Se=E;Se<D;Se+=$)se.push(new qd(Be+X,Se+X,X,h));let Ae=function(Be){let Se=0,ke=0,He=0;const qe=Be[0];for(let ct=0,Ye=qe.length,tt=Ye-1;ct<Ye;tt=ct++){const gt=qe[ct],St=qe[tt],Xt=gt.x*St.y-St.x*gt.y;ke+=(gt.x+St.x)*Xt,He+=(gt.y+St.y)*Xt,Se+=3*Xt}return new qd(ke/Se,He/Se,0,Be)}(h),me=se.length;for(;se.length;){const Be=se.pop();(Be.d>Ae.d||!Ae.d)&&(Ae=Be,f&&console.log("found best %d after %d probes",Math.round(1e4*Be.d)/1e4,me)),Be.max-Ae.d<=l||(X=Be.h/2,se.push(new qd(Be.p.x-X,Be.p.y-X,X,h)),se.push(new qd(Be.p.x+X,Be.p.y-X,X,h)),se.push(new qd(Be.p.x-X,Be.p.y+X,X,h)),se.push(new qd(Be.p.x+X,Be.p.y+X,X,h)),me+=4)}return f&&(console.log(`num probes: ${me}`),console.log(`best distance: ${Ae.d}`)),Ae.p}function Ax(h,l){return l.max-h.max}function qd(h,l,f,v){this.p=new O(h,l),this.h=f,this.d=function(E,M){let D=!1,G=1/0;for(let $=0;$<M.length;$++){const X=M[$];for(let se=0,Ae=X.length,me=Ae-1;se<Ae;me=se++){const Be=X[se],Se=X[me];Be.y>E.y!=Se.y>E.y&&E.x<(Se.x-Be.x)*(E.y-Be.y)/(Se.y-Be.y)+Be.x&&(D=!D),G=Math.min(G,jg(E,Be,Se))}}return(D?1:-1)*Math.sqrt(G)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}var ra;s.aq=void 0,(ra=s.aq||(s.aq={}))[ra.center=1]="center",ra[ra.left=2]="left",ra[ra.right=3]="right",ra[ra.top=4]="top",ra[ra.bottom=5]="bottom",ra[ra["top-left"]=6]="top-left",ra[ra["top-right"]=7]="top-right",ra[ra["bottom-left"]=8]="bottom-left",ra[ra["bottom-right"]=9]="bottom-right";const Vu=7,dp=Number.POSITIVE_INFINITY;function Z0(h,l){return l[1]!==dp?function(f,v,E){let M=0,D=0;switch(v=Math.abs(v),E=Math.abs(E),f){case"top-right":case"top-left":case"top":D=E-Vu;break;case"bottom-right":case"bottom-left":case"bottom":D=-E+Vu}switch(f){case"top-right":case"bottom-right":case"right":M=-v;break;case"top-left":case"bottom-left":case"left":M=v}return[M,D]}(h,l[0],l[1]):function(f,v){let E=0,M=0;v<0&&(v=0);const D=v/Math.SQRT2;switch(f){case"top-right":case"top-left":M=D-Vu;break;case"bottom-right":case"bottom-left":M=-D+Vu;break;case"bottom":M=-v+Vu;break;case"top":M=v-Vu}switch(f){case"top-right":case"bottom-right":E=-D;break;case"top-left":case"bottom-left":E=D;break;case"left":E=v;break;case"right":E=-v}return[E,M]}(h,l[0])}function $d(h,l,f){var v;const E=h.layout,M=(v=E.get("text-variable-anchor-offset"))===null||v===void 0?void 0:v.evaluate(l,{},f);if(M){const G=M.values,$=[];for(let X=0;X<G.length;X+=2){const se=$[X]=G[X],Ae=G[X+1].map(me=>me*Es);se.startsWith("top")?Ae[1]-=Vu:se.startsWith("bottom")&&(Ae[1]+=Vu),$[X+1]=Ae}return new cs($)}const D=E.get("text-variable-anchor");if(D){let G;G=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[E.get("text-radial-offset").evaluate(l,{},f)*Es,dp]:E.get("text-offset").evaluate(l,{},f).map(X=>X*Es);const $=[];for(const X of D)$.push(X,Z0(X,G));return new cs($)}return null}function fp(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dx(h,l,f,v,E,M,D,G,$,X,se){let Ae=M.textMaxSize.evaluate(l,{});Ae===void 0&&(Ae=D);const me=h.layers[0].layout,Be=me.get("icon-offset").evaluate(l,{},se),Se=pp(f.horizontal),ke=D/24,He=h.tilePixelRatio*ke,qe=h.tilePixelRatio*Ae/24,ct=h.tilePixelRatio*G,Ye=h.tilePixelRatio*me.get("symbol-spacing"),tt=me.get("text-padding")*h.tilePixelRatio,gt=function(Zt,Vi,Qi){let gr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Dr=Zt.get("icon-padding").evaluate(Vi,{},Qi),zr=Dr&&Dr.values;return[zr[0]*gr,zr[1]*gr,zr[2]*gr,zr[3]*gr]}(me,l,se,h.tilePixelRatio),St=me.get("text-max-angle")/180*Math.PI,Xt=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",xi=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",oi=me.get("symbol-placement"),Ai=Ye/2,fi=me.get("icon-text-fit");let Fi;v&&fi!=="none"&&(h.allowVerticalPlacement&&f.vertical&&(Fi=cm(v,f.vertical,fi,me.get("icon-text-fit-padding"),Be,ke)),Se&&(v=cm(v,Se,fi,me.get("icon-text-fit-padding"),Be,ke)));const ai=(Zt,Vi)=>{Vi.x<0||Vi.x>=In||Vi.y<0||Vi.y>=In||function(Qi,gr,Dr,zr,pn,os,Nn,vn,Pn,cn,vr,zn,un,en,ds,Ss,_s,Xs,Ts,Fn,xr,Us,oo,ao,Zl){const gc=Qi.addToLineVertexArray(gr,Dr);let na,Hu,mc,yc,_l=0,Bh=0,_p=0,px=0,J0=-1,Y0=-1;const Ch={};let Hc=es("");if(Qi.allowVerticalPlacement&&zr.vertical){const vl=vn.layout.get("text-rotate").evaluate(xr,{},ao)+90;mc=new Ap(Pn,gr,cn,vr,zn,zr.vertical,un,en,ds,vl),Nn&&(yc=new Ap(Pn,gr,cn,vr,zn,Nn,_s,Xs,ds,vl))}if(pn){const vl=vn.layout.get("icon-rotate").evaluate(xr,{}),pu=vn.layout.get("icon-text-fit")!=="none",bp=QA(pn,vl,oo,pu),Eh=Nn?QA(Nn,vl,oo,pu):void 0;Hu=new Ap(Pn,gr,cn,vr,zn,pn,_s,Xs,!1,vl),_l=4*bp.length;const xp=Qi.iconSizeData;let aA=null;xp.kind==="source"?(aA=[Vc*vn.layout.get("icon-size").evaluate(xr,{})],aA[0]>zu&&We(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${sp}. Reduce your "icon-size".`)):xp.kind==="composite"&&(aA=[Vc*Us.compositeIconSizes[0].evaluate(xr,{},ao),Vc*Us.compositeIconSizes[1].evaluate(xr,{},ao)],(aA[0]>zu||aA[1]>zu)&&We(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${sp}. Reduce your "icon-size".`)),Qi.addSymbols(Qi.icon,bp,aA,Fn,Ts,xr,s.ai.none,gr,gc.lineStartIndex,gc.lineLength,-1,ao),J0=Qi.icon.placedSymbolArray.length-1,Eh&&(Bh=4*Eh.length,Qi.addSymbols(Qi.icon,Eh,aA,Fn,Ts,xr,s.ai.vertical,gr,gc.lineStartIndex,gc.lineLength,-1,ao),Y0=Qi.icon.placedSymbolArray.length-1)}const vp=Object.keys(zr.horizontal);for(const vl of vp){const pu=zr.horizontal[vl];if(!na){Hc=es(pu.text);const Eh=vn.layout.get("text-rotate").evaluate(xr,{},ao);na=new Ap(Pn,gr,cn,vr,zn,pu,un,en,ds,Eh)}const bp=pu.positionedLines.length===1;if(_p+=fm(Qi,gr,pu,os,vn,ds,xr,Ss,gc,zr.vertical?s.ai.horizontal:s.ai.horizontalOnly,bp?vp:[vl],Ch,J0,Us,ao),bp)break}zr.vertical&&(px+=fm(Qi,gr,zr.vertical,os,vn,ds,xr,Ss,gc,s.ai.vertical,["vertical"],Ch,Y0,Us,ao));const gx=na?na.boxStartIndex:Qi.collisionBoxArray.length,QT=na?na.boxEndIndex:Qi.collisionBoxArray.length,VT=mc?mc.boxStartIndex:Qi.collisionBoxArray.length,HT=mc?mc.boxEndIndex:Qi.collisionBoxArray.length,Oa=Hu?Hu.boxStartIndex:Qi.collisionBoxArray.length,_c=Hu?Hu.boxEndIndex:Qi.collisionBoxArray.length,VA=yc?yc.boxStartIndex:Qi.collisionBoxArray.length,fu=yc?yc.boxEndIndex:Qi.collisionBoxArray.length;let Ua=-1;const vc=(vl,pu)=>vl&&vl.circleDiameter?Math.max(vl.circleDiameter,pu):pu;Ua=vc(na,Ua),Ua=vc(mc,Ua),Ua=vc(Hu,Ua),Ua=vc(yc,Ua);const aN=Ua>-1?1:0;aN&&(Ua*=Zl/Es),Qi.glyphOffsetArray.length>=zA.MAX_GLYPHS&&We("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&Qi.addToSortKeyRanges(Qi.symbolInstances.length,xr.sortKey);const n1e=$d(vn,xr,ao),[s1e,o1e]=function(vl,pu){const bp=vl.length,Eh=pu==null?void 0:pu.values;if((Eh==null?void 0:Eh.length)>0)for(let xp=0;xp<Eh.length;xp+=2){const aA=Eh[xp+1];vl.emplaceBack(s.aq[Eh[xp]],aA[0],aA[1])}return[bp,vl.length]}(Qi.textAnchorOffsets,n1e);Qi.symbolInstances.emplaceBack(gr.x,gr.y,Ch.right>=0?Ch.right:-1,Ch.center>=0?Ch.center:-1,Ch.left>=0?Ch.left:-1,Ch.vertical||-1,J0,Y0,Hc,gx,QT,VT,HT,Oa,_c,VA,fu,cn,_p,px,_l,Bh,aN,0,un,Ua,s1e,o1e)}(h,Vi,Zt,f,v,E,Fi,h.layers[0],h.collisionBoxArray,l.index,l.sourceLayerIndex,h.index,He,[tt,tt,tt,tt],Xt,$,ct,gt,xi,Be,l,M,X,se,D)};if(oi==="line")for(const Zt of K0(l.geometry,0,0,In,In)){const Vi=NT(Zt,Ye,St,f.vertical||Se,v,24,qe,h.overscaling,In);for(const Qi of Vi)Se&&gp(h,Se.text,Ai,Qi)||ai(Zt,Qi)}else if(oi==="line-center"){for(const Zt of l.geometry)if(Zt.length>1){const Vi=UT(Zt,St,f.vertical||Se,v,24,qe);Vi&&ai(Zt,Vi)}}else if(l.type==="Polygon")for(const Zt of A0(l.geometry,0)){const Vi=hx(Zt,16);ai(Zt[0],new du(Vi.x,Vi.y,0))}else if(l.type==="LineString")for(const Zt of l.geometry)ai(Zt,new du(Zt[0].x,Zt[0].y,0));else if(l.type==="Point")for(const Zt of l.geometry)for(const Vi of Zt)ai([Vi],new du(Vi.x,Vi.y,0))}function fm(h,l,f,v,E,M,D,G,$,X,se,Ae,me,Be,Se){const ke=function(ct,Ye,tt,gt,St,Xt,xi,oi){const Ai=gt.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,fi=[];for(const Fi of Ye.positionedLines)for(const ai of Fi.positionedGlyphs){if(!ai.rect)continue;const Zt=ai.rect||{};let Vi=ip+1,Qi=!0,gr=1,Dr=0;const zr=(St||oi)&&ai.vertical,pn=ai.metrics.advance*ai.scale/2;if(oi&&Ye.verticalizable&&(Dr=Fi.lineOffset/2-(ai.imageName?-(Es-ai.metrics.width*ai.scale)/2:(ai.scale-1)*Es)),ai.imageName){const Fn=xi[ai.imageName];Qi=Fn.sdf,gr=Fn.pixelRatio,Vi=yl/gr}const os=St?[ai.x+pn,ai.y]:[0,0];let Nn=St?[0,0]:[ai.x+pn+tt[0],ai.y+tt[1]-Dr],vn=[0,0];zr&&(vn=Nn,Nn=[0,0]);const Pn=ai.metrics.isDoubleResolution?2:1,cn=(ai.metrics.left-Vi)*ai.scale-pn+Nn[0],vr=(-ai.metrics.top-Vi)*ai.scale+Nn[1],zn=cn+Zt.w/Pn*ai.scale/gr,un=vr+Zt.h/Pn*ai.scale/gr,en=new O(cn,vr),ds=new O(zn,vr),Ss=new O(cn,un),_s=new O(zn,un);if(zr){const Fn=new O(-pn,pn-Rd),xr=-Math.PI/2,Us=Es/2-pn,oo=new O(5-Rd-Us,-(ai.imageName?Us:0)),ao=new O(...vn);en._rotateAround(xr,Fn)._add(oo)._add(ao),ds._rotateAround(xr,Fn)._add(oo)._add(ao),Ss._rotateAround(xr,Fn)._add(oo)._add(ao),_s._rotateAround(xr,Fn)._add(oo)._add(ao)}if(Ai){const Fn=Math.sin(Ai),xr=Math.cos(Ai),Us=[xr,-Fn,Fn,xr];en._matMult(Us),ds._matMult(Us),Ss._matMult(Us),_s._matMult(Us)}const Xs=new O(0,0),Ts=new O(0,0);fi.push({tl:en,tr:ds,bl:Ss,br:_s,tex:Zt,writingMode:Ye.writingMode,glyphOffset:os,sectionIndex:ai.sectionIndex,isSDF:Qi,pixelOffsetTL:Xs,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return fi}(0,f,G,E,M,D,v,h.allowVerticalPlacement),He=h.textSizeData;let qe=null;He.kind==="source"?(qe=[Vc*E.layout.get("text-size").evaluate(D,{})],qe[0]>zu&&We(`${h.layerIds[0]}: Value for "text-size" is >= ${sp}. Reduce your "text-size".`)):He.kind==="composite"&&(qe=[Vc*Be.compositeTextSizes[0].evaluate(D,{},Se),Vc*Be.compositeTextSizes[1].evaluate(D,{},Se)],(qe[0]>zu||qe[1]>zu)&&We(`${h.layerIds[0]}: Value for "text-size" is >= ${sp}. Reduce your "text-size".`)),h.addSymbols(h.text,ke,qe,G,M,D,X,l,$.lineStartIndex,$.lineLength,me,Se);for(const ct of se)Ae[ct]=h.text.placedSymbolArray.length-1;return 4*ke.length}function pp(h){for(const l in h)return h[l];return null}function gp(h,l,f,v){const E=h.compareText;if(l in E){const M=E[l];for(let D=M.length-1;D>=0;D--)if(v.dist(M[D])<f)return!0}else E[l]=[];return E[l].push(v),!1}const pm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mp{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,v]=new Uint8Array(l,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const E=v>>4;if(E!==1)throw new Error(`Got v${E} data when expected v1.`);const M=pm[15&v];if(!M)throw new Error("Unrecognized array type.");const[D]=new Uint16Array(l,2,1),[G]=new Uint32Array(l,4,1);return new mp(G,D,M,l)}constructor(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,E=arguments.length>3?arguments[3]:void 0;if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=v,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const M=pm.indexOf(this.ArrayType),D=2*l*this.ArrayType.BYTES_PER_ELEMENT,G=l*this.IndexArrayType.BYTES_PER_ELEMENT,$=(8-G%8)%8;if(M<0)throw new Error(`Unexpected typed array class: ${v}.`);E&&E instanceof ArrayBuffer?(this.data=E,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+G+$,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+D+G+$),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+G+$,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+M]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=l)}add(l,f){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=l,this.coords[this._pos++]=f,v}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return yp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,f,v,E){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:D,nodeSize:G}=this,$=[0,M.length-1,0],X=[];for(;$.length;){const se=$.pop()||0,Ae=$.pop()||0,me=$.pop()||0;if(Ae-me<=G){for(let He=me;He<=Ae;He++){const qe=D[2*He],ct=D[2*He+1];qe>=l&&qe<=v&&ct>=f&&ct<=E&&X.push(M[He])}continue}const Be=me+Ae>>1,Se=D[2*Be],ke=D[2*Be+1];Se>=l&&Se<=v&&ke>=f&&ke<=E&&X.push(M[Be]),(se===0?l<=Se:f<=ke)&&($.push(me),$.push(Be-1),$.push(1-se)),(se===0?v>=Se:E>=ke)&&($.push(Be+1),$.push(Ae),$.push(1-se))}return X}within(l,f,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:M,nodeSize:D}=this,G=[0,E.length-1,0],$=[],X=v*v;for(;G.length;){const se=G.pop()||0,Ae=G.pop()||0,me=G.pop()||0;if(Ae-me<=D){for(let He=me;He<=Ae;He++)g(M[2*He],M[2*He+1],l,f)<=X&&$.push(E[He]);continue}const Be=me+Ae>>1,Se=M[2*Be],ke=M[2*Be+1];g(Se,ke,l,f)<=X&&$.push(E[Be]),(se===0?l-v<=Se:f-v<=ke)&&(G.push(me),G.push(Be-1),G.push(1-se)),(se===0?l+v>=Se:f+v>=ke)&&(G.push(Be+1),G.push(Ae),G.push(1-se))}return $}}function yp(h,l,f,v,E,M){if(E-v<=f)return;const D=v+E>>1;fx(h,l,D,v,E,M),yp(h,l,f,v,D-1,1-M),yp(h,l,f,D+1,E,1-M)}function fx(h,l,f,v,E,M){for(;E>v;){if(E-v>600){const X=E-v+1,se=f-v+1,Ae=Math.log(X),me=.5*Math.exp(2*Ae/3),Be=.5*Math.sqrt(Ae*me*(X-me)/X)*(se-X/2<0?-1:1);fx(h,l,f,Math.max(v,Math.floor(f-se*me/X+Be)),Math.min(E,Math.floor(f+(X-se)*me/X+Be)),M)}const D=l[2*f+M];let G=v,$=E;for(p(h,l,v,f),l[2*E+M]>D&&p(h,l,v,E);G<$;){for(p(h,l,G,$),G++,$--;l[2*G+M]<D;)G++;for(;l[2*$+M]>D;)$--}l[2*v+M]===D?p(h,l,v,$):($++,p(h,l,$,E)),$<=f&&(v=$+1),f<=$&&(E=$-1)}}function p(h,l,f,v){u(h,f,v),u(l,2*f,2*v),u(l,2*f+1,2*v+1)}function u(h,l,f){const v=h[l];h[l]=h[f],h[f]=v}function g(h,l,f,v){const E=h-f,M=l-v;return E*E+M*M}var C;s.bh=void 0,(C=s.bh||(s.bh={})).create="create",C.load="load",C.fullLoad="fullLoad";let P=null,Q=[];const V=1e3/60,K="loadTime",te="fullLoadTime",he={mark(h){performance.mark(h)},frame(h){const l=h;P!=null&&Q.push(l-P),P=l},clearMetrics(){P=null,Q=[],performance.clearMeasures(K),performance.clearMeasures(te);for(const h in s.bh)performance.clearMarks(s.bh[h])},getPerformanceMetrics(){performance.measure(K,s.bh.create,s.bh.load),performance.measure(te,s.bh.create,s.bh.fullLoad);const h=performance.getEntriesByName(K)[0].duration,l=performance.getEntriesByName(te)[0].duration,f=Q.length,v=1/(Q.reduce((M,D)=>M+D,0)/f/1e3),E=Q.filter(M=>M>V).reduce((M,D)=>M+(D-V)/V,0);return{loadTime:h,fullLoadTime:l,fps:v,percentDroppedFrames:E/(f+E)*100,totalFrames:f}}};s.$=function(h,l,f){var v,E,M,D,G,$,X,se,Ae,me,Be,Se,ke=f[0],He=f[1],qe=f[2];return l===h?(h[12]=l[0]*ke+l[4]*He+l[8]*qe+l[12],h[13]=l[1]*ke+l[5]*He+l[9]*qe+l[13],h[14]=l[2]*ke+l[6]*He+l[10]*qe+l[14],h[15]=l[3]*ke+l[7]*He+l[11]*qe+l[15]):(E=l[1],M=l[2],D=l[3],G=l[4],$=l[5],X=l[6],se=l[7],Ae=l[8],me=l[9],Be=l[10],Se=l[11],h[0]=v=l[0],h[1]=E,h[2]=M,h[3]=D,h[4]=G,h[5]=$,h[6]=X,h[7]=se,h[8]=Ae,h[9]=me,h[10]=Be,h[11]=Se,h[12]=v*ke+G*He+Ae*qe+l[12],h[13]=E*ke+$*He+me*qe+l[13],h[14]=M*ke+X*He+Be*qe+l[14],h[15]=D*ke+se*He+Se*qe+l[15]),h},s.A=Qc,s.B=us,s.C=class{constructor(h,l,f){this.receive=v=>{const E=v.data,M=E.id;if(M&&(!E.targetMapId||this.mapId===E.targetMapId))if(E.type==="<cancel>"){delete this.tasks[M];const D=this.cancelCallbacks[M];delete this.cancelCallbacks[M],D&&D()}else Lt()||E.mustQueue?(this.tasks[M]=E,this.taskQueue.push(M),this.invoker.trigger()):this.processTask(M,E)},this.process=()=>{if(!this.taskQueue.length)return;const v=this.taskQueue.shift(),E=this.tasks[v];delete this.tasks[v],this.taskQueue.length&&this.invoker.trigger(),E&&this.processTask(v,E)},this.target=h,this.parent=l,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new hm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Lt()?h:window}send(h,l,f,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[M]=f);const D=[],G={id:M,type:h,hasCallback:!!f,targetMapId:v,mustQueue:E,sourceMapId:this.mapId,data:Pi(l,D)};return this.target.postMessage(G,{transfer:D}),{cancel:()=>{f&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}processTask(h,l){if(l.type==="<response>"){const f=this.callbacks[h];delete this.callbacks[h],f&&(l.error?f(hl(l.error)):f(null,hl(l.data)))}else{let f=!1;const v=[],E=l.hasCallback?(G,$)=>{f=!0,delete this.cancelCallbacks[h];const X={id:h,type:"<response>",sourceMapId:this.mapId,error:G?Pi(G):null,data:Pi($,v)};this.target.postMessage(X,{transfer:v})}:G=>{f=!0};let M=null;const D=hl(l.data);if(this.parent[l.type])M=this.parent[l.type](l.sourceMapId,D,E);else if("getWorkerSource"in this.parent){const G=l.type.split(".");M=this.parent.getWorkerSource(l.sourceMapId,G[0],D.source)[G[1]](D,E)}else E(new Error(`Could not find function ${l.type}`));!f&&M&&M.cancel&&(this.cancelCallbacks[h]=M.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=$i,s.E=ei,s.F=function(h,l){const f={};for(let v=0;v<l.length;v++){const E=l[v];E in h&&(f[E]=h[E])}return f},s.G=Qd,s.H=U0,s.I=om,s.J=de,s.K=be,s.L=Qu,s.M=Wt,s.N=In,s.O=zo,s.P=O,s.Q=Un,s.R=Uo,s.S=Ti,s.T=kc,s.U=ap,s.V=class extends Da{},s.W=V0,s.X=function(h,l){const f=window.document.createElement("video");f.muted=!0,f.onloadstart=function(){l(null,f)};for(let v=0;v<h.length;v++){const E=window.document.createElement("source");Mi(h[v])||(f.crossOrigin="Anonymous"),E.src=h[v],f.appendChild(E)}return{cancel:()=>{}}},s.Y=$t,s.Z=function(){var h=new Qc(16);return Qc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},s._=m,s.a=Ft,s.a$=class extends H{},s.a0=function(h,l,f){var v=f[0],E=f[1],M=f[2];return h[0]=l[0]*v,h[1]=l[1]*v,h[2]=l[2]*v,h[3]=l[3]*v,h[4]=l[4]*E,h[5]=l[5]*E,h[6]=l[6]*E,h[7]=l[7]*E,h[8]=l[8]*M,h[9]=l[9]*M,h[10]=l[10]*M,h[11]=l[11]*M,h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15],h},s.a1=eA,s.a2=function(){return lt++},s.a3=T,s.a4=zA,s.a5=function(){$s.isLoading()||$s.isLoaded()||su()!=="deferred"||_a()},s.a6=ol,s.a7=Nc,s.a8=bi,s.a9=q0,s.aA=ql,s.aB=function(h){h=h.slice();const l=Object.create(null);for(let f=0;f<h.length;f++)l[h[f].id]=h[f];for(let f=0;f<h.length;f++)"ref"in h[f]&&(h[f]=ni(h[f],l[h[f].ref]));return h},s.aC=function(h){if(h.type==="custom")return new k0(h);switch(h.type){case"background":return new sx(h);case"circle":return new gl(h);case"fill":return new xT(h);case"fill-extrusion":return new Rb(h);case"heatmap":return new ka(h);case"hillshade":return new Sd(h);case"line":return new _o(h);case"raster":return new ax(h);case"symbol":return new zd(h)}},s.aD=Fe,s.aE=function(h,l){if(!h)return[{command:li.setStyle,args:[l]}];let f=[];try{if(!di(h.version,l.version))return[{command:li.setStyle,args:[l]}];di(h.center,l.center)||f.push({command:li.setCenter,args:[l.center]}),di(h.zoom,l.zoom)||f.push({command:li.setZoom,args:[l.zoom]}),di(h.bearing,l.bearing)||f.push({command:li.setBearing,args:[l.bearing]}),di(h.pitch,l.pitch)||f.push({command:li.setPitch,args:[l.pitch]}),di(h.sprite,l.sprite)||f.push({command:li.setSprite,args:[l.sprite]}),di(h.glyphs,l.glyphs)||f.push({command:li.setGlyphs,args:[l.glyphs]}),di(h.transition,l.transition)||f.push({command:li.setTransition,args:[l.transition]}),di(h.light,l.light)||f.push({command:li.setLight,args:[l.light]});const v={},E=[];(function(D,G,$,X){let se;for(se in G=G||{},D=D||{})Object.prototype.hasOwnProperty.call(D,se)&&(Object.prototype.hasOwnProperty.call(G,se)||tr(se,$,X));for(se in G)Object.prototype.hasOwnProperty.call(G,se)&&(Object.prototype.hasOwnProperty.call(D,se)?di(D[se],G[se])||(D[se].type==="geojson"&&G[se].type==="geojson"&&Er(D,G,se)?$.push({command:li.setGeoJSONSourceData,args:[se,G[se].data]}):Ar(se,G,$,X)):Ki(se,G,$))})(h.sources,l.sources,E,v);const M=[];h.layers&&h.layers.forEach(D=>{v[D.source]?f.push({command:li.removeLayer,args:[D.id]}):M.push(D)}),f=f.concat(E),function(D,G,$){G=G||[];const X=(D=D||[]).map(Ji),se=G.map(Ji),Ae=D.reduce(ci,{}),me=G.reduce(ci,{}),Be=X.slice(),Se=Object.create(null);let ke,He,qe,ct,Ye,tt,gt;for(ke=0,He=0;ke<X.length;ke++)qe=X[ke],Object.prototype.hasOwnProperty.call(me,qe)?He++:($.push({command:li.removeLayer,args:[qe]}),Be.splice(Be.indexOf(qe,He),1));for(ke=0,He=0;ke<se.length;ke++)qe=se[se.length-1-ke],Be[Be.length-1-ke]!==qe&&(Object.prototype.hasOwnProperty.call(Ae,qe)?($.push({command:li.removeLayer,args:[qe]}),Be.splice(Be.lastIndexOf(qe,Be.length-He),1)):He++,tt=Be[Be.length-ke],$.push({command:li.addLayer,args:[me[qe],tt]}),Be.splice(Be.length-ke,0,qe),Se[qe]=!0);for(ke=0;ke<se.length;ke++)if(qe=se[ke],ct=Ae[qe],Ye=me[qe],!Se[qe]&&!di(ct,Ye))if(di(ct.source,Ye.source)&&di(ct["source-layer"],Ye["source-layer"])&&di(ct.type,Ye.type)){for(gt in Nt(ct.layout,Ye.layout,$,qe,null,li.setLayoutProperty),Nt(ct.paint,Ye.paint,$,qe,null,li.setPaintProperty),di(ct.filter,Ye.filter)||$.push({command:li.setFilter,args:[qe,Ye.filter]}),di(ct.minzoom,Ye.minzoom)&&di(ct.maxzoom,Ye.maxzoom)||$.push({command:li.setLayerZoomRange,args:[qe,Ye.minzoom,Ye.maxzoom]}),ct)Object.prototype.hasOwnProperty.call(ct,gt)&&gt!=="layout"&&gt!=="paint"&&gt!=="filter"&&gt!=="metadata"&&gt!=="minzoom"&&gt!=="maxzoom"&&(gt.indexOf("paint.")===0?Nt(ct[gt],Ye[gt],$,qe,gt.slice(6),li.setPaintProperty):di(ct[gt],Ye[gt])||$.push({command:li.setLayerProperty,args:[qe,gt,Ye[gt]]}));for(gt in Ye)Object.prototype.hasOwnProperty.call(Ye,gt)&&!Object.prototype.hasOwnProperty.call(ct,gt)&&gt!=="layout"&&gt!=="paint"&&gt!=="filter"&&gt!=="metadata"&&gt!=="minzoom"&&gt!=="maxzoom"&&(gt.indexOf("paint.")===0?Nt(ct[gt],Ye[gt],$,qe,gt.slice(6),li.setPaintProperty):di(ct[gt],Ye[gt])||$.push({command:li.setLayerProperty,args:[qe,gt,Ye[gt]]}))}else $.push({command:li.removeLayer,args:[qe]}),tt=Be[Be.lastIndexOf(qe)+1],$.push({command:li.addLayer,args:[Ye,tt]})}(M,l.layers,f)}catch(v){console.warn("Unable to compute style diff:",v),f=[{command:li.setStyle,args:[l]}]}return f},s.aF=function(h){const l=[],f=h.id;return f===void 0&&l.push({message:`layers.${f}: missing required property "id"`}),h.render===void 0&&l.push({message:`layers.${f}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&l.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),l},s.aG=function h(l,f){if(Array.isArray(l)){if(!Array.isArray(f)||l.length!==f.length)return!1;for(let v=0;v<l.length;v++)if(!h(l[v],f[v]))return!1;return!0}if(typeof l=="object"&&l!==null&&f!==null){if(typeof f!="object"||Object.keys(l).length!==Object.keys(f).length)return!1;for(const v in l)if(!h(l[v],f[v]))return!1;return!0}return l===f},s.aH=nt,s.aI=De,s.aJ=Ac,s.aK=function(h){return h({pluginStatus:Bs,pluginURL:Do}),Ac.on("pluginStateChange",h),h},s.aL=class extends ln{constructor(h,l){super(h,l),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.aM=qr,s.aN=class extends ln{constructor(h,l){super(h,l),this.current=$n}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let l=1;l<16;l++)if(h[l]!==this.current[l]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},s.aO=Wr,s.aP=class extends ln{constructor(h,l){super(h,l),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},s.aQ=class extends ln{constructor(h,l){super(h,l),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},s.aR=Mn,s.aS=function(h,l,f,v,E,M,D){var G=1/(l-f),$=1/(v-E),X=1/(M-D);return h[0]=-2*G,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*$,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*X,h[11]=0,h[12]=(l+f)*G,h[13]=(E+v)*$,h[14]=(D+M)*X,h[15]=1,h},s.aT=lr,s.aU=Cd,s.aV=class extends L{},s.aW=Gb,s.aX=class extends y{},s.aY=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},s.aZ=tA,s.a_=Pe,s.aa=function(h){const l={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,v,E,M)=>{const D=E||M;return l[v]=!D||D.toLowerCase(),""}),l["max-age"]){const f=parseInt(l["max-age"],10);isNaN(f)?delete l["max-age"]:l["max-age"]=f}return l},s.ab=function(h,l){const f=[];for(const v in h)v in l||f.push(v);return f},s.ac=function(h){if(_t==null){const l=h.navigator?h.navigator.userAgent:null;_t=!!h.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return _t},s.ad=Ge,s.ae=function(h,l,f){var v=Math.sin(f),E=Math.cos(f),M=l[0],D=l[1],G=l[2],$=l[3],X=l[4],se=l[5],Ae=l[6],me=l[7];return l!==h&&(h[8]=l[8],h[9]=l[9],h[10]=l[10],h[11]=l[11],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[0]=M*E+X*v,h[1]=D*E+se*v,h[2]=G*E+Ae*v,h[3]=$*E+me*v,h[4]=X*E-M*v,h[5]=se*E-D*v,h[6]=Ae*E-G*v,h[7]=me*E-$*v,h},s.af=function(h){var l=new Qc(16);return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],l[9]=h[9],l[10]=h[10],l[11]=h[11],l[12]=h[12],l[13]=h[13],l[14]=h[14],l[15]=h[15],l},s.ag=Au,s.ah=function(h,l){let f=0,v=0;if(h.kind==="constant")v=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:E,minZoom:M,maxZoom:D}=h,G=E?Ge(dn.interpolationFactor(E,l,M,D),0,1):0;h.kind==="camera"?v=us.number(h.minSize,h.maxSize,G):f=G}return{uSizeT:f,uSize:v}},s.aj=function(h,l,f){let{uSize:v,uSizeT:E}=l,{lowerSize:M,upperSize:D}=f;return h.kind==="source"?M/Vc:h.kind==="composite"?us.number(M/Vc,D/Vc,E):v},s.ak=Nd,s.al=function(h,l,f,v){const E=l.y-h.y,M=l.x-h.x,D=v.y-f.y,G=v.x-f.x,$=D*M-G*E;if($===0)return null;const X=(G*(h.y-f.y)-D*(h.x-f.x))/$;return new O(h.x+X*M,h.y+X*E)},s.am=K0,s.an=zc,s.ao=Bd,s.ap=Es,s.ar=um,s.as=function(h,l){var f=l[0],v=l[1],E=l[2],M=l[3],D=l[4],G=l[5],$=l[6],X=l[7],se=l[8],Ae=l[9],me=l[10],Be=l[11],Se=l[12],ke=l[13],He=l[14],qe=l[15],ct=f*G-v*D,Ye=f*$-E*D,tt=f*X-M*D,gt=v*$-E*G,St=v*X-M*G,Xt=E*X-M*$,xi=se*ke-Ae*Se,oi=se*He-me*Se,Ai=se*qe-Be*Se,fi=Ae*He-me*ke,Fi=Ae*qe-Be*ke,ai=me*qe-Be*He,Zt=ct*ai-Ye*Fi+tt*fi+gt*Ai-St*oi+Xt*xi;return Zt?(h[0]=(G*ai-$*Fi+X*fi)*(Zt=1/Zt),h[1]=(E*Fi-v*ai-M*fi)*Zt,h[2]=(ke*Xt-He*St+qe*gt)*Zt,h[3]=(me*St-Ae*Xt-Be*gt)*Zt,h[4]=($*Ai-D*ai-X*oi)*Zt,h[5]=(f*ai-E*Ai+M*oi)*Zt,h[6]=(He*tt-Se*Xt-qe*Ye)*Zt,h[7]=(se*Xt-me*tt+Be*Ye)*Zt,h[8]=(D*Fi-G*Ai+X*xi)*Zt,h[9]=(v*Ai-f*Fi-M*xi)*Zt,h[10]=(Se*St-ke*tt+qe*ct)*Zt,h[11]=(Ae*tt-se*St-Be*ct)*Zt,h[12]=(G*oi-D*fi-$*xi)*Zt,h[13]=(f*fi-v*oi+E*xi)*Zt,h[14]=(ke*Ye-Se*gt-He*ct)*Zt,h[15]=(se*gt-Ae*Ye+me*ct)*Zt,h):null},s.at=fp,s.au=L0,s.av=mp,s.aw=function(){const h={},l=ut.$version;for(const f in ut.$root){const v=ut.$root[f];if(v.required){let E=null;E=f==="version"?l:v.type==="array"?[]:{},E!=null&&(h[f]=E)}}return h},s.ax=li,s.ay=Hl,s.az=It,s.b=function(h,l){const f=new Blob([new Uint8Array(h)],{type:"image/png"});createImageBitmap(f).then(v=>{l(null,v)}).catch(v=>{l(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Vt,s.b1=function(h,l){var f=h[0],v=h[1],E=h[2],M=h[3],D=h[4],G=h[5],$=h[6],X=h[7],se=h[8],Ae=h[9],me=h[10],Be=h[11],Se=h[12],ke=h[13],He=h[14],qe=h[15],ct=l[0],Ye=l[1],tt=l[2],gt=l[3],St=l[4],Xt=l[5],xi=l[6],oi=l[7],Ai=l[8],fi=l[9],Fi=l[10],ai=l[11],Zt=l[12],Vi=l[13],Qi=l[14],gr=l[15];return Math.abs(f-ct)<=ia*Math.max(1,Math.abs(f),Math.abs(ct))&&Math.abs(v-Ye)<=ia*Math.max(1,Math.abs(v),Math.abs(Ye))&&Math.abs(E-tt)<=ia*Math.max(1,Math.abs(E),Math.abs(tt))&&Math.abs(M-gt)<=ia*Math.max(1,Math.abs(M),Math.abs(gt))&&Math.abs(D-St)<=ia*Math.max(1,Math.abs(D),Math.abs(St))&&Math.abs(G-Xt)<=ia*Math.max(1,Math.abs(G),Math.abs(Xt))&&Math.abs($-xi)<=ia*Math.max(1,Math.abs($),Math.abs(xi))&&Math.abs(X-oi)<=ia*Math.max(1,Math.abs(X),Math.abs(oi))&&Math.abs(se-Ai)<=ia*Math.max(1,Math.abs(se),Math.abs(Ai))&&Math.abs(Ae-fi)<=ia*Math.max(1,Math.abs(Ae),Math.abs(fi))&&Math.abs(me-Fi)<=ia*Math.max(1,Math.abs(me),Math.abs(Fi))&&Math.abs(Be-ai)<=ia*Math.max(1,Math.abs(Be),Math.abs(ai))&&Math.abs(Se-Zt)<=ia*Math.max(1,Math.abs(Se),Math.abs(Zt))&&Math.abs(ke-Vi)<=ia*Math.max(1,Math.abs(ke),Math.abs(Vi))&&Math.abs(He-Qi)<=ia*Math.max(1,Math.abs(He),Math.abs(Qi))&&Math.abs(qe-gr)<=ia*Math.max(1,Math.abs(qe),Math.abs(gr))},s.b2=function(h,l){return h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h[4]=l[4],h[5]=l[5],h[6]=l[6],h[7]=l[7],h[8]=l[8],h[9]=l[9],h[10]=l[10],h[11]=l[11],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15],h},s.b3=function(h,l,f){return h[0]=l[0]*f[0],h[1]=l[1]*f[1],h[2]=l[2]*f[2],h[3]=l[3]*f[3],h},s.b4=function(h,l){return h[0]*l[0]+h[1]*l[1]+h[2]*l[2]+h[3]*l[3]},s.b5=$e,s.b6=H0,s.b7=N0,s.b8=function(h,l,f,v,E){var M,D=1/Math.tan(l/2);return h[0]=D/f,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=D,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,E!=null&&E!==1/0?(h[10]=(E+v)*(M=1/(v-E)),h[14]=2*E*v*M):(h[10]=-1,h[14]=-2*v),h},s.b9=function(h,l,f){var v=Math.sin(f),E=Math.cos(f),M=l[4],D=l[5],G=l[6],$=l[7],X=l[8],se=l[9],Ae=l[10],me=l[11];return l!==h&&(h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[4]=M*E+X*v,h[5]=D*E+se*v,h[6]=G*E+Ae*v,h[7]=$*E+me*v,h[8]=X*E-M*v,h[9]=se*E-D*v,h[10]=Ae*E-G*v,h[11]=me*E-$*v,h},s.bA=I,s.bB=w0,s.bC=Lr,s.bD=$s,s.ba=Te,s.bb=je,s.bc=function(h,l){return h[0]=l[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=l[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=l[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},s.bd=class extends Ja{},s.be=Am,s.bf=z0,s.bg=he,s.bi=Pt,s.bj=function(h,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(Bs===Dc||Bs===Rc||Bs===Za)throw new Error("setRTLTextPlugin cannot be called multiple times.");Do=ft.resolveURL(h),Bs=Dc,yn=l,Mu(),f||_a()},s.bk=su,s.bl=function(h,l){const f={};for(let E=0;E<h.length;E++){const M=l&&l[h[E].id]||Fs(h[E]);l&&(l[h[E].id]=M);let D=f[M];D||(D=f[M]=[]),D.push(h[E])}const v=[];for(const E in f)v.push(f[E]);return v},s.bm=Oi,s.bn=j0,s.bo=lx,s.bp=S0,s.bq=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=In/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const l=h.bucket.layers[0],f=l.layout,v=l._unevaluatedLayout._values,E={layoutIconSize:v["icon-size"].possiblyEvaluate(new bi(h.bucket.zoom+1),h.canonical),layoutTextSize:v["text-size"].possiblyEvaluate(new bi(h.bucket.zoom+1),h.canonical),textMaxSize:v["text-size"].possiblyEvaluate(new bi(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=h.bucket.textSizeData;E.compositeTextSizes=[v["text-size"].possiblyEvaluate(new bi(X),h.canonical),v["text-size"].possiblyEvaluate(new bi(se),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=h.bucket.iconSizeData;E.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new bi(X),h.canonical),v["icon-size"].possiblyEvaluate(new bi(se),h.canonical)]}const M=f.get("text-line-height")*Es,D=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",G=f.get("text-keep-upright"),$=f.get("text-size");for(const X of h.bucket.features){const se=f.get("text-font").evaluate(X,{},h.canonical).join(","),Ae=$.evaluate(X,{},h.canonical),me=E.layoutTextSize.evaluate(X,{},h.canonical),Be=E.layoutIconSize.evaluate(X,{},h.canonical),Se={horizontal:{},vertical:void 0},ke=X.text;let He,qe=[0,0];if(ke){const tt=ke.toString(),gt=f.get("text-letter-spacing").evaluate(X,{},h.canonical)*Es,St=Ei(tt)?gt:0,Xt=f.get("text-anchor").evaluate(X,{},h.canonical),xi=$d(l,X,h.canonical);if(!xi){const ai=f.get("text-radial-offset").evaluate(X,{},h.canonical);qe=ai?Z0(Xt,[ai*Es,dp]):f.get("text-offset").evaluate(X,{},h.canonical).map(Zt=>Zt*Es)}let oi=D?"center":f.get("text-justify").evaluate(X,{},h.canonical);const Ai=f.get("symbol-placement"),fi=Ai==="point"?f.get("text-max-width").evaluate(X,{},h.canonical)*Es:0,Fi=()=>{h.bucket.allowVerticalPlacement&&Gl(tt)&&(Se.vertical=Od(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,"left",St,qe,s.ai.vertical,!0,Ai,me,Ae))};if(!D&&xi){const ai=new Set;if(oi==="auto")for(let Vi=0;Vi<xi.values.length;Vi+=2)ai.add(fp(xi.values[Vi]));else ai.add(oi);let Zt=!1;for(const Vi of ai)if(!Se.horizontal[Vi])if(Zt)Se.horizontal[Vi]=Se.horizontal[0];else{const Qi=Od(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,"center",Vi,St,qe,s.ai.horizontal,!1,Ai,me,Ae);Qi&&(Se.horizontal[Vi]=Qi,Zt=Qi.positionedLines.length===1)}Fi()}else{oi==="auto"&&(oi=fp(Xt));const ai=Od(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,oi,St,qe,s.ai.horizontal,!1,Ai,me,Ae);ai&&(Se.horizontal[oi]=ai),Fi(),Gl(tt)&&D&&G&&(Se.vertical=Od(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,oi,St,qe,s.ai.vertical,!1,Ai,me,Ae))}}let ct=!1;if(X.icon&&X.icon.name){const tt=h.imageMap[X.icon.name];tt&&(He=lm(h.imagePositions[X.icon.name],f.get("icon-offset").evaluate(X,{},h.canonical),f.get("icon-anchor").evaluate(X,{},h.canonical)),ct=!!tt.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=ct:h.bucket.sdfIcons!==ct&&We("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==h.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ye=pp(Se.horizontal)||Se.vertical;h.bucket.iconsInText=!!Ye&&Ye.iconsInText,(Ye||He)&&dx(h.bucket,X,Se,He,h.imageMap,E,me,Be,qe,ct,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},s.br=v0,s.bs=f0,s.bt=y0,s.bu=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},s.bv=sm,s.bw=rA,s.bx=function(h,l,f,v,E){return m(this,void 0,void 0,function*(){if(be())try{return yield Wt(h,l,f,v,E)}catch{}return function(M,D,G,$,X){const se=M.width,Ae=M.height;Ee&&Xe||(Ee=new OffscreenCanvas(se,Ae),Xe=Ee.getContext("2d",{willReadFrequently:!0})),Ee.width=se,Ee.height=Ae,Xe.drawImage(M,0,0,se,Ae);const me=Xe.getImageData(D,G,$,X);return Xe.clearRect(0,0,se,Ae),me.data}(h,l,f,v,E)})},s.by=G0,s.bz=x,s.c=wt,s.d=function(h,l){const f=new Image;f.onload=()=>{l(null,f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Mt})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(h)],{type:"image/png"});f.src=h.byteLength?URL.createObjectURL(v):Mt},s.e=Ue,s.f=function(h,l){return gi(Ue(h,{type:"json"}),l)},s.g=Ht,s.h=ft,s.i=Lt,s.j=Ri,s.k=xt,s.l=mi,s.m=gi,s.n=function(h){return new sm(h).readFields(ep,[])},s.o=function(h,l,f){if(!h.length)return f(null,[]);let v=h.length;const E=new Array(h.length);let M=null;h.forEach((D,G)=>{l(D,($,X)=>{$&&(M=$),E[G]=X,--v==0&&f(M,E)})})},s.p=rp,s.q=fc,s.r=tn,s.s=Mi,s.t=an,s.u=Li,s.v=ut,s.w=We,s.x=Fa,s.y=Zr,s.z=function(h){let[l,f,v]=h;return f+=90,f*=Math.PI/180,v*=Math.PI/180,{x:l*Math.cos(f)*Math.sin(v),y:l*Math.sin(f)*Math.sin(v),z:l*Math.cos(v)}}}),o(["./shared"],function(s){class m{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,le){for(const _e of Y){this._layerConfigs[_e.id]=_e;const Ce=this._layers[_e.id]=s.aC(_e);Ce._featureFilter=s.a6(Ce.filter),this.keyCache[_e.id]&&delete this.keyCache[_e.id]}for(const _e of le)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ge=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const _e of ge){const Ce=_e.map(yt=>this._layers[yt.id]),ve=Ce[0];if(ve.visibility==="none")continue;const Me=ve.source||"";let Oe=this.familiesBySource[Me];Oe||(Oe=this.familiesBySource[Me]={});const Ve=ve.sourceLayer||"_geojsonTileLayer";let it=Oe[Ve];it||(it=Oe[Ve]=[]),it.push(Ce)}}}class x{constructor(Y){const le={},ge=[];for(const Me in Y){const Oe=Y[Me],Ve=le[Me]={};for(const it in Oe){const yt=Oe[+it];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Bt={x:0,y:0,w:yt.bitmap.width+2,h:yt.bitmap.height+2};ge.push(Bt),Ve[it]={rect:Bt,metrics:yt.metrics}}}const{w:_e,h:Ce}=s.p(ge),ve=new s.q({width:_e||1,height:Ce||1});for(const Me in Y){const Oe=Y[Me];for(const Ve in Oe){const it=Oe[+Ve];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const yt=le[Me][Ve].rect;s.q.copy(it.bitmap,ve,{x:0,y:0},{x:yt.x+1,y:yt.y+1},it.bitmap)}}this.image=ve,this.positions=le}}s.bm("GlyphAtlas",x);class I{constructor(Y){this.tileID=new s.O(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(Y,le,ge,_e,Ce){this.status="parsing",this.data=Y,this.collisionBoxArray=new s.a3;const ve=new s.bn(Object.keys(Y.layers).sort()),Me=new s.bo(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Oe={},Ve={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},it=le.familiesBySource[this.source];for(const Ui in it){const st=Y.layers[Ui];if(!st)continue;st.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ui}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ti=ve.encode(Ui),zt=[];for(let zi=0;zi<st.length;zi++){const hr=st.feature(zi),sn=Me.getId(hr,Ui);zt.push({feature:hr,id:sn,index:zi,sourceLayerIndex:ti})}for(const zi of it[Ui]){const hr=zi[0];hr.source!==this.source&&s.w(`layer.source = ${hr.source} does not equal this.source = ${this.source}`),hr.minzoom&&this.zoom<Math.floor(hr.minzoom)||hr.maxzoom&&this.zoom>=hr.maxzoom||hr.visibility!=="none"&&(F(zi,this.zoom,ge),(Oe[hr.id]=hr.createBucket({index:Me.bucketLayerIDs.length,layers:zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source})).populate(zt,Ve,this.tileID.canonical),Me.bucketLayerIDs.push(zi.map(sn=>sn.id)))}}let yt,Bt,Yt,qt;const Kt=s.aH(Ve.glyphDependencies,Ui=>Object.keys(Ui).map(Number));this.inFlightDependencies.forEach(Ui=>Ui==null?void 0:Ui.cancel()),this.inFlightDependencies=[];const si=++this.dependencySentinel;Object.keys(Kt).length?this.inFlightDependencies.push(_e.send("getGlyphs",{uid:this.uid,stacks:Kt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,Bt=st,wi.call(this)))})):Bt={};const Ci=Object.keys(Ve.iconDependencies);Ci.length?this.inFlightDependencies.push(_e.send("getImages",{icons:Ci,source:this.source,tileID:this.tileID,type:"icons"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,Yt=st,wi.call(this)))})):Yt={};const Hi=Object.keys(Ve.patternDependencies);function wi(){if(yt)return Ce(yt);if(Bt&&Yt&&qt){const Ui=new x(Bt),st=new s.bp(Yt,qt);for(const ti in Oe){const zt=Oe[ti];zt instanceof s.a4?(F(zt.layers,this.zoom,ge),s.bq({bucket:zt,glyphMap:Bt,glyphPositions:Ui.positions,imageMap:Yt,imagePositions:st.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):zt.hasPattern&&(zt instanceof s.br||zt instanceof s.bs||zt instanceof s.bt)&&(F(zt.layers,this.zoom,ge),zt.addFeatures(Ve,this.tileID.canonical,st.patternPositions))}this.status="done",Ce(null,{buckets:Object.values(Oe).filter(ti=>!ti.isEmpty()),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ui.image,imageAtlas:st,glyphMap:this.returnDependencies?Bt:null,iconMap:this.returnDependencies?Yt:null,glyphPositions:this.returnDependencies?Ui.positions:null})}}Hi.length?this.inFlightDependencies.push(_e.send("getImages",{icons:Hi,source:this.source,tileID:this.tileID,type:"patterns"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,qt=st,wi.call(this)))})):qt={},wi.call(this)}}function F(oe,Y,le){const ge=new s.a8(Y);for(const _e of oe)_e.recalculate(ge,le)}function O(oe,Y){const le=s.l(oe.request,(ge,_e,Ce,ve)=>{if(ge)Y(ge);else if(_e)try{const Me=new s.bw.VectorTile(new s.bv(_e));Y(null,{vectorTile:Me,rawData:_e,cacheControl:Ce,expires:ve})}catch(Me){const Oe=new Uint8Array(_e);let Ve=`Unable to parse the tile at ${oe.request.url}, `;Ve+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Me.messge}`,Y(new Error(Ve))}});return()=>{le.cancel(),Y()}}class z{constructor(Y,le,ge,_e){this.actor=Y,this.layerIndex=le,this.availableImages=ge,this.loadVectorData=_e||O,this.fetching={},this.loading={},this.loaded={}}loadTile(Y,le){const ge=Y.uid;this.loading||(this.loading={});const _e=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new s.bu(Y.request),Ce=this.loading[ge]=new I(Y);Ce.abort=this.loadVectorData(Y,(ve,Me)=>{if(delete this.loading[ge],ve||!Me)return Ce.status="done",this.loaded[ge]=Ce,le(ve);const Oe=Me.rawData,Ve={};Me.expires&&(Ve.expires=Me.expires),Me.cacheControl&&(Ve.cacheControl=Me.cacheControl);const it={};if(_e){const yt=_e.finish();yt&&(it.resourceTiming=JSON.parse(JSON.stringify(yt)))}Ce.vectorTile=Me.vectorTile,Ce.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,(yt,Bt)=>{if(delete this.fetching[ge],yt||!Bt)return le(yt);le(null,s.e({rawTileData:Oe.slice(0)},Bt,Ve,it))}),this.loaded=this.loaded||{},this.loaded[ge]=Ce,this.fetching[ge]={rawTileData:Oe,cacheControl:Ve,resourceTiming:it}})}reloadTile(Y,le){const ge=this.loaded,_e=Y.uid;if(ge&&ge[_e]){const Ce=ge[_e];Ce.showCollisionBoxes=Y.showCollisionBoxes,Ce.status==="parsing"?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(ve,Me)=>{if(ve||!Me)return le(ve,Me);let Oe;if(this.fetching[_e]){const{rawTileData:Ve,cacheControl:it,resourceTiming:yt}=this.fetching[_e];delete this.fetching[_e],Oe=s.e({rawTileData:Ve.slice(0)},Me,it,yt)}else Oe=Me;le(null,Oe)}):Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}}abortTile(Y,le){const ge=this.loading,_e=Y.uid;ge&&ge[_e]&&ge[_e].abort&&(ge[_e].abort(),delete ge[_e]),le()}removeTile(Y,le){const ge=this.loaded,_e=Y.uid;ge&&ge[_e]&&delete ge[_e],le()}}class ie{constructor(){this.loaded={}}loadTile(Y,le){return s._(this,void 0,void 0,function*(){const{uid:ge,encoding:_e,rawImageData:Ce,redFactor:ve,greenFactor:Me,blueFactor:Oe,baseShift:Ve}=Y,it=Ce.width+2,yt=Ce.height+2,Bt=s.a(Ce)?new s.R({width:it,height:yt},yield s.bx(Ce,-1,-1,it,yt)):Ce,Yt=new s.by(ge,Bt,_e,ve,Me,Oe,Ve);this.loaded=this.loaded||{},this.loaded[ge]=Yt,le(null,Yt)})}removeTile(Y){const le=this.loaded,ge=Y.uid;le&&le[ge]&&delete le[ge]}}function ne(oe,Y){if(oe.length!==0){ue(oe[0],Y);for(var le=1;le<oe.length;le++)ue(oe[le],!Y)}}function ue(oe,Y){for(var le=0,ge=0,_e=0,Ce=oe.length,ve=Ce-1;_e<Ce;ve=_e++){var Me=(oe[_e][0]-oe[ve][0])*(oe[ve][1]+oe[_e][1]),Oe=le+Me;ge+=Math.abs(le)>=Math.abs(Me)?le-Oe+Me:Me-Oe+le,le=Oe}le+ge>=0!=!!Y&&oe.reverse()}var ce=s.bz(function oe(Y,le){var ge,_e=Y&&Y.type;if(_e==="FeatureCollection")for(ge=0;ge<Y.features.length;ge++)oe(Y.features[ge],le);else if(_e==="GeometryCollection")for(ge=0;ge<Y.geometries.length;ge++)oe(Y.geometries[ge],le);else if(_e==="Feature")oe(Y.geometry,le);else if(_e==="Polygon")ne(Y.coordinates,le);else if(_e==="MultiPolygon")for(ge=0;ge<Y.coordinates.length;ge++)ne(Y.coordinates[ge],le);return Y});const de=s.bw.VectorTileFeature.prototype.toGeoJSON;var be={exports:{}},Te=s.bA,je=s.bw.VectorTileFeature,Ge=$e;function $e(oe,Y){this.options=Y||{},this.features=oe,this.length=oe.length}function Ue(oe,Y){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=Y||4096}$e.prototype.feature=function(oe){return new Ue(this.features[oe],this.options.extent)},Ue.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var Y=0;Y<oe.length;Y++){for(var le=oe[Y],ge=[],_e=0;_e<le.length;_e++)ge.push(new Te(le[_e][0],le[_e][1]));this.geometry.push(ge)}return this.geometry},Ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,Y=1/0,le=-1/0,ge=1/0,_e=-1/0,Ce=0;Ce<oe.length;Ce++)for(var ve=oe[Ce],Me=0;Me<ve.length;Me++){var Oe=ve[Me];Y=Math.min(Y,Oe.x),le=Math.max(le,Oe.x),ge=Math.min(ge,Oe.y),_e=Math.max(_e,Oe.y)}return[Y,ge,le,_e]},Ue.prototype.toGeoJSON=je.prototype.toGeoJSON;var lt=s.bB,nt=Ge;function De(oe){var Y=new lt;return function(le,ge){for(var _e in le.layers)ge.writeMessage(3,Fe,le.layers[_e])}(oe,Y),Y.finish()}function Fe(oe,Y){var le;Y.writeVarintField(15,oe.version||1),Y.writeStringField(1,oe.name||""),Y.writeVarintField(5,oe.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<oe.length;le++)ge.feature=oe.feature(le),Y.writeMessage(2,Je,ge);var _e=ge.keys;for(le=0;le<_e.length;le++)Y.writeStringField(3,_e[le]);var Ce=ge.values;for(le=0;le<Ce.length;le++)Y.writeMessage(4,_t,Ce[le])}function Je(oe,Y){var le=oe.feature;le.id!==void 0&&Y.writeVarintField(1,le.id),Y.writeMessage(2,We,oe),Y.writeVarintField(3,le.type),Y.writeMessage(4,Lt,le)}function We(oe,Y){var le=oe.feature,ge=oe.keys,_e=oe.values,Ce=oe.keycache,ve=oe.valuecache;for(var Me in le.properties){var Oe=le.properties[Me],Ve=Ce[Me];if(Oe!==null){Ve===void 0&&(ge.push(Me),Ce[Me]=Ve=ge.length-1),Y.writeVarint(Ve);var it=typeof Oe;it!=="string"&&it!=="boolean"&&it!=="number"&&(Oe=JSON.stringify(Oe));var yt=it+":"+Oe,Bt=ve[yt];Bt===void 0&&(_e.push(Oe),ve[yt]=Bt=_e.length-1),Y.writeVarint(Bt)}}}function Et(oe,Y){return(Y<<3)+(7&oe)}function Ct(oe){return oe<<1^oe>>31}function Lt(oe,Y){for(var le=oe.loadGeometry(),ge=oe.type,_e=0,Ce=0,ve=le.length,Me=0;Me<ve;Me++){var Oe=le[Me],Ve=1;ge===1&&(Ve=Oe.length),Y.writeVarint(Et(1,Ve));for(var it=ge===3?Oe.length-1:Oe.length,yt=0;yt<it;yt++){yt===1&&ge!==1&&Y.writeVarint(Et(2,it-1));var Bt=Oe[yt].x-_e,Yt=Oe[yt].y-Ce;Y.writeVarint(Ct(Bt)),Y.writeVarint(Ct(Yt)),_e+=Bt,Ce+=Yt}ge===3&&Y.writeVarint(Et(7,1))}}function _t(oe,Y){var le=typeof oe;le==="string"?Y.writeStringField(1,oe):le==="boolean"?Y.writeBooleanField(7,oe):le==="number"&&(oe%1!=0?Y.writeDoubleField(3,oe):oe<0?Y.writeSVarintField(6,oe):Y.writeVarintField(5,oe))}be.exports=De,be.exports.fromVectorTileJs=De,be.exports.fromGeojsonVt=function(oe,Y){Y=Y||{};var le={};for(var ge in oe)le[ge]=new nt(oe[ge].features,Y),le[ge].name=ge,le[ge].version=Y.version,le[ge].extent=Y.extent;return De({layers:le})},be.exports.GeoJSONWrapper=nt;var Ft=s.bz(be.exports);const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Wt=Math.fround||(Ee=new Float32Array(1),oe=>(Ee[0]=+oe,Ee[0]));var Ee;const Xe=3,et=5,At=6;class ft{constructor(Y){this.options=Object.assign(Object.create(Mt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:le,minZoom:ge,maxZoom:_e}=this.options;le&&console.time("total time");const Ce=`prepare ${Y.length} points`;le&&console.time(Ce),this.points=Y;const ve=[];for(let Oe=0;Oe<Y.length;Oe++){const Ve=Y[Oe];if(!Ve.geometry)continue;const[it,yt]=Ve.geometry.coordinates,Bt=Wt(It(it)),Yt=Wt(Ht(yt));ve.push(Bt,Yt,1/0,Oe,-1,1),this.options.reduce&&ve.push(0)}let Me=this.trees[_e+1]=this._createTree(ve);le&&console.timeEnd(Ce);for(let Oe=_e;Oe>=ge;Oe--){const Ve=+Date.now();Me=this.trees[Oe]=this._createTree(this._cluster(Me,Oe)),le&&console.log("z%d: %d clusters in %dms",Oe,Me.numItems,+Date.now()-Ve)}return le&&console.timeEnd("total time"),this}getClusters(Y,le){let ge=((Y[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,Y[1]));let Ce=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ge=-180,Ce=180;else if(ge>Ce){const yt=this.getClusters([ge,_e,180,ve],le),Bt=this.getClusters([-180,_e,Ce,ve],le);return yt.concat(Bt)}const Me=this.trees[this._limitZoom(le)],Oe=Me.range(It(ge),Ht(ve),It(Ce),Ht(_e)),Ve=Me.data,it=[];for(const yt of Oe){const Bt=this.stride*yt;it.push(Ve[Bt+et]>1?wt(Ve,Bt,this.clusterProps):this.points[Ve[Bt+Xe]])}return it}getChildren(Y){const le=this._getOriginId(Y),ge=this._getOriginZoom(Y),_e="No cluster with the specified id.",Ce=this.trees[ge];if(!Ce)throw new Error(_e);const ve=Ce.data;if(le*this.stride>=ve.length)throw new Error(_e);const Me=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Oe=Ce.within(ve[le*this.stride],ve[le*this.stride+1],Me),Ve=[];for(const it of Oe){const yt=it*this.stride;ve[yt+4]===Y&&Ve.push(ve[yt+et]>1?wt(ve,yt,this.clusterProps):this.points[ve[yt+Xe]])}if(Ve.length===0)throw new Error(_e);return Ve}getLeaves(Y,le,ge){const _e=[];return this._appendLeaves(_e,Y,le=le||10,ge=ge||0,0),_e}getTile(Y,le,ge){const _e=this.trees[this._limitZoom(Y)],Ce=Math.pow(2,Y),{extent:ve,radius:Me}=this.options,Oe=Me/ve,Ve=(ge-Oe)/Ce,it=(ge+1+Oe)/Ce,yt={features:[]};return this._addTileFeatures(_e.range((le-Oe)/Ce,Ve,(le+1+Oe)/Ce,it),_e.data,le,ge,Ce,yt),le===0&&this._addTileFeatures(_e.range(1-Oe/Ce,Ve,1,it),_e.data,Ce,ge,Ce,yt),le===Ce-1&&this._addTileFeatures(_e.range(0,Ve,Oe/Ce,it),_e.data,-1,ge,Ce,yt),yt.features.length?yt:null}getClusterExpansionZoom(Y){let le=this._getOriginZoom(Y)-1;for(;le<=this.options.maxZoom;){const ge=this.getChildren(Y);if(le++,ge.length!==1)break;Y=ge[0].properties.cluster_id}return le}_appendLeaves(Y,le,ge,_e,Ce){const ve=this.getChildren(le);for(const Me of ve){const Oe=Me.properties;if(Oe&&Oe.cluster?Ce+Oe.point_count<=_e?Ce+=Oe.point_count:Ce=this._appendLeaves(Y,Oe.cluster_id,ge,_e,Ce):Ce<_e?Ce++:Y.push(Me),Y.length===ge)break}return Ce}_createTree(Y){const le=new s.av(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<Y.length;ge+=this.stride)le.add(Y[ge],Y[ge+1]);return le.finish(),le.data=Y,le}_addTileFeatures(Y,le,ge,_e,Ce,ve){for(const Me of Y){const Oe=Me*this.stride,Ve=le[Oe+et]>1;let it,yt,Bt;if(Ve)it=Pt(le,Oe,this.clusterProps),yt=le[Oe],Bt=le[Oe+1];else{const Kt=this.points[le[Oe+Xe]];it=Kt.properties;const[si,Ci]=Kt.geometry.coordinates;yt=It(si),Bt=Ht(Ci)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(yt*Ce-ge)),Math.round(this.options.extent*(Bt*Ce-_e))]],tags:it};let qt;qt=Ve||this.options.generateId?le[Oe+Xe]:this.points[le[Oe+Xe]].id,qt!==void 0&&(Yt.id=qt),ve.features.push(Yt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,le){const{radius:ge,extent:_e,reduce:Ce,minPoints:ve}=this.options,Me=ge/(_e*Math.pow(2,le)),Oe=Y.data,Ve=[],it=this.stride;for(let yt=0;yt<Oe.length;yt+=it){if(Oe[yt+2]<=le)continue;Oe[yt+2]=le;const Bt=Oe[yt],Yt=Oe[yt+1],qt=Y.within(Oe[yt],Oe[yt+1],Me),Kt=Oe[yt+et];let si=Kt;for(const Ci of qt){const Hi=Ci*it;Oe[Hi+2]>le&&(si+=Oe[Hi+et])}if(si>Kt&&si>=ve){let Ci,Hi=Bt*Kt,wi=Yt*Kt,Ui=-1;const st=((yt/it|0)<<5)+(le+1)+this.points.length;for(const ti of qt){const zt=ti*it;if(Oe[zt+2]<=le)continue;Oe[zt+2]=le;const zi=Oe[zt+et];Hi+=Oe[zt]*zi,wi+=Oe[zt+1]*zi,Oe[zt+4]=st,Ce&&(Ci||(Ci=this._map(Oe,yt,!0),Ui=this.clusterProps.length,this.clusterProps.push(Ci)),Ce(Ci,this._map(Oe,zt)))}Oe[yt+4]=st,Ve.push(Hi/si,wi/si,1/0,st,-1,si),Ce&&Ve.push(Ui)}else{for(let Ci=0;Ci<it;Ci++)Ve.push(Oe[yt+Ci]);if(si>1)for(const Ci of qt){const Hi=Ci*it;if(!(Oe[Hi+2]<=le)){Oe[Hi+2]=le;for(let wi=0;wi<it;wi++)Ve.push(Oe[Hi+wi])}}}}return Ve}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,le,ge){if(Y[le+et]>1){const ve=this.clusterProps[Y[le+At]];return ge?Object.assign({},ve):ve}const _e=this.points[Y[le+Xe]].properties,Ce=this.options.map(_e);return ge&&Ce===_e?Object.assign({},Ce):Ce}}function wt(oe,Y,le){return{type:"Feature",id:oe[Y+Xe],properties:Pt(oe,Y,le),geometry:{type:"Point",coordinates:[(ge=oe[Y],360*(ge-.5)),ii(oe[Y+1])]}};var ge}function Pt(oe,Y,le){const ge=oe[Y+et],_e=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ce=oe[Y+At],ve=Ce===-1?{}:Object.assign({},le[Ce]);return Object.assign(ve,{cluster:!0,cluster_id:oe[Y+Xe],point_count:ge,point_count_abbreviated:_e})}function It(oe){return oe/360+.5}function Ht(oe){const Y=Math.sin(oe*Math.PI/180),le=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return le<0?0:le>1?1:le}function ii(oe){const Y=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function gi(oe,Y,le,ge){for(var _e,Ce=ge,ve=le-Y>>1,Me=le-Y,Oe=oe[Y],Ve=oe[Y+1],it=oe[le],yt=oe[le+1],Bt=Y+3;Bt<le;Bt+=3){var Yt=mi(oe[Bt],oe[Bt+1],Oe,Ve,it,yt);if(Yt>Ce)_e=Bt,Ce=Yt;else if(Yt===Ce){var qt=Math.abs(Bt-ve);qt<Me&&(_e=Bt,Me=qt)}}Ce>ge&&(_e-Y>3&&gi(oe,Y,_e,ge),oe[_e+2]=Ce,le-_e>3&&gi(oe,_e,le,ge))}function mi(oe,Y,le,ge,_e,Ce){var ve=_e-le,Me=Ce-ge;if(ve!==0||Me!==0){var Oe=((oe-le)*ve+(Y-ge)*Me)/(ve*ve+Me*Me);Oe>1?(le=_e,ge=Ce):Oe>0&&(le+=ve*Oe,ge+=Me*Oe)}return(ve=oe-le)*ve+(Me=Y-ge)*Me}function Mi(oe,Y,le,ge){var _e={id:oe===void 0?null:oe,type:Y,geometry:le,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var ve=Ce.geometry,Me=Ce.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")kt(Ce,ve);else if(Me==="Polygon"||Me==="MultiLineString")for(var Oe=0;Oe<ve.length;Oe++)kt(Ce,ve[Oe]);else if(Me==="MultiPolygon")for(Oe=0;Oe<ve.length;Oe++)for(var Ve=0;Ve<ve[Oe].length;Ve++)kt(Ce,ve[Oe][Ve])}(_e),_e}function kt(oe,Y){for(var le=0;le<Y.length;le+=3)oe.minX=Math.min(oe.minX,Y[le]),oe.minY=Math.min(oe.minY,Y[le+1]),oe.maxX=Math.max(oe.maxX,Y[le]),oe.maxY=Math.max(oe.maxY,Y[le+1])}function ot(oe,Y,le,ge){if(Y.geometry){var _e=Y.geometry.coordinates,Ce=Y.geometry.type,ve=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),Me=[],Oe=Y.id;if(le.promoteId?Oe=Y.properties[le.promoteId]:le.generateId&&(Oe=ge||0),Ce==="Point")xt(_e,Me);else if(Ce==="MultiPoint")for(var Ve=0;Ve<_e.length;Ve++)xt(_e[Ve],Me);else if(Ce==="LineString")Ri(_e,Me,ve,!1);else if(Ce==="MultiLineString"){if(le.lineMetrics){for(Ve=0;Ve<_e.length;Ve++)Ri(_e[Ve],Me=[],ve,!1),oe.push(Mi(Oe,"LineString",Me,Y.properties));return}ei(_e,Me,ve,!1)}else if(Ce==="Polygon")ei(_e,Me,ve,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(Ve=0;Ve<Y.geometry.geometries.length;Ve++)ot(oe,{id:Oe,geometry:Y.geometry.geometries[Ve],properties:Y.properties},le,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ve=0;Ve<_e.length;Ve++){var it=[];ei(_e[Ve],it,ve,!0),Me.push(it)}}oe.push(Mi(Oe,Ce,Me,Y.properties))}}function xt(oe,Y){Y.push(ut(oe[0])),Y.push(jt(oe[1])),Y.push(0)}function Ri(oe,Y,le,ge){for(var _e,Ce,ve=0,Me=0;Me<oe.length;Me++){var Oe=ut(oe[Me][0]),Ve=jt(oe[Me][1]);Y.push(Oe),Y.push(Ve),Y.push(0),Me>0&&(ve+=ge?(_e*Ve-Oe*Ce)/2:Math.sqrt(Math.pow(Oe-_e,2)+Math.pow(Ve-Ce,2))),_e=Oe,Ce=Ve}var it=Y.length-3;Y[2]=1,gi(Y,0,it,le),Y[it+2]=1,Y.size=Math.abs(ve),Y.start=0,Y.end=Y.size}function ei(oe,Y,le,ge){for(var _e=0;_e<oe.length;_e++){var Ce=[];Ri(oe[_e],Ce,le,ge),Y.push(Ce)}}function ut(oe){return oe/360+.5}function jt(oe){var Y=Math.sin(oe*Math.PI/180),le=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return le<0?0:le>1?1:le}function ni(oe,Y,le,ge,_e,Ce,ve,Me){if(ge/=Y,Ce>=(le/=Y)&&ve<ge)return oe;if(ve<le||Ce>=ge)return null;for(var Oe=[],Ve=0;Ve<oe.length;Ve++){var it=oe[Ve],yt=it.geometry,Bt=it.type,Yt=_e===0?it.minX:it.minY,qt=_e===0?it.maxX:it.maxY;if(Yt>=le&&qt<ge)Oe.push(it);else if(!(qt<le||Yt>=ge)){var Kt=[];if(Bt==="Point"||Bt==="MultiPoint")di(yt,Kt,le,ge,_e);else if(Bt==="LineString")li(yt,Kt,le,ge,_e,!1,Me.lineMetrics);else if(Bt==="MultiLineString")tr(yt,Kt,le,ge,_e,!1);else if(Bt==="Polygon")tr(yt,Kt,le,ge,_e,!0);else if(Bt==="MultiPolygon")for(var si=0;si<yt.length;si++){var Ci=[];tr(yt[si],Ci,le,ge,_e,!0),Ci.length&&Kt.push(Ci)}if(Kt.length){if(Me.lineMetrics&&Bt==="LineString"){for(si=0;si<Kt.length;si++)Oe.push(Mi(it.id,Bt,Kt[si],it.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(Kt.length===1?(Bt="LineString",Kt=Kt[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=Kt.length===3?"Point":"MultiPoint"),Oe.push(Mi(it.id,Bt,Kt,it.tags))}}}return Oe.length?Oe:null}function di(oe,Y,le,ge,_e){for(var Ce=0;Ce<oe.length;Ce+=3){var ve=oe[Ce+_e];ve>=le&&ve<=ge&&(Y.push(oe[Ce]),Y.push(oe[Ce+1]),Y.push(oe[Ce+2]))}}function li(oe,Y,le,ge,_e,Ce,ve){for(var Me,Oe,Ve=Ki(oe),it=_e===0?Er:Nt,yt=oe.start,Bt=0;Bt<oe.length-3;Bt+=3){var Yt=oe[Bt],qt=oe[Bt+1],Kt=oe[Bt+2],si=oe[Bt+3],Ci=oe[Bt+4],Hi=_e===0?Yt:qt,wi=_e===0?si:Ci,Ui=!1;ve&&(Me=Math.sqrt(Math.pow(Yt-si,2)+Math.pow(qt-Ci,2))),Hi<le?wi>le&&(Oe=it(Ve,Yt,qt,si,Ci,le),ve&&(Ve.start=yt+Me*Oe)):Hi>ge?wi<ge&&(Oe=it(Ve,Yt,qt,si,Ci,ge),ve&&(Ve.start=yt+Me*Oe)):Ar(Ve,Yt,qt,Kt),wi<le&&Hi>=le&&(Oe=it(Ve,Yt,qt,si,Ci,le),Ui=!0),wi>ge&&Hi<=ge&&(Oe=it(Ve,Yt,qt,si,Ci,ge),Ui=!0),!Ce&&Ui&&(ve&&(Ve.end=yt+Me*Oe),Y.push(Ve),Ve=Ki(oe)),ve&&(yt+=Me)}var st=oe.length-3;Yt=oe[st],qt=oe[st+1],Kt=oe[st+2],(Hi=_e===0?Yt:qt)>=le&&Hi<=ge&&Ar(Ve,Yt,qt,Kt),st=Ve.length-3,Ce&&st>=3&&(Ve[st]!==Ve[0]||Ve[st+1]!==Ve[1])&&Ar(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&Y.push(Ve)}function Ki(oe){var Y=[];return Y.size=oe.size,Y.start=oe.start,Y.end=oe.end,Y}function tr(oe,Y,le,ge,_e,Ce){for(var ve=0;ve<oe.length;ve++)li(oe[ve],Y,le,ge,_e,Ce,!1)}function Ar(oe,Y,le,ge){oe.push(Y),oe.push(le),oe.push(ge)}function Er(oe,Y,le,ge,_e,Ce){var ve=(Ce-Y)/(ge-Y);return oe.push(Ce),oe.push(le+(_e-le)*ve),oe.push(1),ve}function Nt(oe,Y,le,ge,_e,Ce){var ve=(Ce-le)/(_e-le);return oe.push(Y+(ge-Y)*ve),oe.push(Ce),oe.push(1),ve}function Ji(oe,Y){for(var le=[],ge=0;ge<oe.length;ge++){var _e,Ce=oe[ge],ve=Ce.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")_e=ci(Ce.geometry,Y);else if(ve==="MultiLineString"||ve==="Polygon"){_e=[];for(var Me=0;Me<Ce.geometry.length;Me++)_e.push(ci(Ce.geometry[Me],Y))}else if(ve==="MultiPolygon")for(_e=[],Me=0;Me<Ce.geometry.length;Me++){for(var Oe=[],Ve=0;Ve<Ce.geometry[Me].length;Ve++)Oe.push(ci(Ce.geometry[Me][Ve],Y));_e.push(Oe)}le.push(Mi(Ce.id,ve,_e,Ce.tags))}return le}function ci(oe,Y){var le=[];le.size=oe.size,oe.start!==void 0&&(le.start=oe.start,le.end=oe.end);for(var ge=0;ge<oe.length;ge+=3)le.push(oe[ge]+Y,oe[ge+1],oe[ge+2]);return le}function $t(oe,Y){if(oe.transformed)return oe;var le,ge,_e,Ce=1<<oe.z,ve=oe.x,Me=oe.y;for(le=0;le<oe.features.length;le++){var Oe=oe.features[le],Ve=Oe.geometry,it=Oe.type;if(Oe.geometry=[],it===1)for(ge=0;ge<Ve.length;ge+=2)Oe.geometry.push(Zi(Ve[ge],Ve[ge+1],Y,Ce,ve,Me));else for(ge=0;ge<Ve.length;ge++){var yt=[];for(_e=0;_e<Ve[ge].length;_e+=2)yt.push(Zi(Ve[ge][_e],Ve[ge][_e+1],Y,Ce,ve,Me));Oe.geometry.push(yt)}}return oe.transformed=!0,oe}function Zi(oe,Y,le,ge,_e,Ce){return[Math.round(le*(oe*ge-_e)),Math.round(le*(Y*ge-Ce))]}function Qt(oe,Y,le,ge,_e){for(var Ce=Y===_e.maxZoom?0:_e.tolerance/((1<<Y)*_e.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:ge,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<oe.length;Me++){ve.numFeatures++,Bi(ve,oe[Me],Ce,_e);var Oe=oe[Me].minX,Ve=oe[Me].minY,it=oe[Me].maxX,yt=oe[Me].maxY;Oe<ve.minX&&(ve.minX=Oe),Ve<ve.minY&&(ve.minY=Ve),it>ve.maxX&&(ve.maxX=it),yt>ve.maxY&&(ve.maxY=yt)}return ve}function Bi(oe,Y,le,ge){var _e=Y.geometry,Ce=Y.type,ve=[];if(Ce==="Point"||Ce==="MultiPoint")for(var Me=0;Me<_e.length;Me+=3)ve.push(_e[Me]),ve.push(_e[Me+1]),oe.numPoints++,oe.numSimplified++;else if(Ce==="LineString")Ii(ve,_e,oe,le,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(Me=0;Me<_e.length;Me++)Ii(ve,_e[Me],oe,le,Ce==="Polygon",Me===0);else if(Ce==="MultiPolygon")for(var Oe=0;Oe<_e.length;Oe++){var Ve=_e[Oe];for(Me=0;Me<Ve.length;Me++)Ii(ve,Ve[Me],oe,le,!0,Me===0)}if(ve.length){var it=Y.tags||null;if(Ce==="LineString"&&ge.lineMetrics){for(var yt in it={},Y.tags)it[yt]=Y.tags[yt];it.mapbox_clip_start=_e.start/_e.size,it.mapbox_clip_end=_e.end/_e.size}var Bt={geometry:ve,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:it};Y.id!==null&&(Bt.id=Y.id),oe.features.push(Bt)}}function Ii(oe,Y,le,ge,_e,Ce){var ve=ge*ge;if(ge>0&&Y.size<(_e?ve:ge))le.numPoints+=Y.length/3;else{for(var Me=[],Oe=0;Oe<Y.length;Oe+=3)(ge===0||Y[Oe+2]>ve)&&(le.numSimplified++,Me.push(Y[Oe]),Me.push(Y[Oe+1])),le.numPoints++;_e&&function(Ve,it){for(var yt=0,Bt=0,Yt=Ve.length,qt=Yt-2;Bt<Yt;qt=Bt,Bt+=2)yt+=(Ve[Bt]-Ve[qt])*(Ve[Bt+1]+Ve[qt+1]);if(yt>0===it)for(Bt=0,Yt=Ve.length;Bt<Yt/2;Bt+=2){var Kt=Ve[Bt],si=Ve[Bt+1];Ve[Bt]=Ve[Yt-2-Bt],Ve[Bt+1]=Ve[Yt-1-Bt],Ve[Yt-2-Bt]=Kt,Ve[Yt-1-Bt]=si}}(Me,Ce),oe.push(Me)}}function Gt(oe,Y){var le=(Y=this.options=function(_e,Ce){for(var ve in Ce)_e[ve]=Ce[ve];return _e}(Object.create(this.options),Y)).debug;if(le&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(_e,Ce){var ve=[];if(_e.type==="FeatureCollection")for(var Me=0;Me<_e.features.length;Me++)ot(ve,_e.features[Me],Ce,Me);else ot(ve,_e.type==="Feature"?_e:{geometry:_e},Ce);return ve}(oe,Y);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(_e,Ce){var ve=Ce.buffer/Ce.extent,Me=_e,Oe=ni(_e,1,-1-ve,ve,0,-1,2,Ce),Ve=ni(_e,1,1-ve,2+ve,0,-1,2,Ce);return(Oe||Ve)&&(Me=ni(_e,1,-ve,1+ve,0,-1,2,Ce)||[],Oe&&(Me=Ji(Oe,1).concat(Me)),Ve&&(Me=Me.concat(Ji(Ve,-1)))),Me}(ge,Y),ge.length&&this.splitTile(ge,0,0,0),le&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vi(oe,Y,le){return 32*((1<<oe)*le+Y)+oe}function Jt(oe,Y){return Y?oe.properties[Y]:oe.id}function mr(oe,Y){if(oe==null)return!0;if(oe.type==="Feature")return Jt(oe,Y)!=null;if(oe.type==="FeatureCollection"){const le=new Set;for(const ge of oe.features){const _e=Jt(ge,Y);if(_e==null||le.has(_e))return!1;le.add(_e)}return!0}return!1}function Sr(oe,Y){const le=new Map;if(oe!=null)if(oe.type==="Feature")le.set(Jt(oe,Y),oe);else for(const ge of oe.features)le.set(Jt(ge,Y),ge);return le}Gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gt.prototype.splitTile=function(oe,Y,le,ge,_e,Ce,ve){for(var Me=[oe,Y,le,ge],Oe=this.options,Ve=Oe.debug;Me.length;){ge=Me.pop(),le=Me.pop(),Y=Me.pop(),oe=Me.pop();var it=1<<Y,yt=vi(Y,le,ge),Bt=this.tiles[yt];if(!Bt&&(Ve>1&&console.time("creation"),Bt=this.tiles[yt]=Qt(oe,Y,le,ge,Oe),this.tileCoords.push({z:Y,x:le,y:ge}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,le,ge,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var Yt="z"+Y;this.stats[Yt]=(this.stats[Yt]||0)+1,this.total++}if(Bt.source=oe,_e){if(Y===Oe.maxZoom||Y===_e)continue;var qt=1<<_e-Y;if(le!==Math.floor(Ce/qt)||ge!==Math.floor(ve/qt))continue}else if(Y===Oe.indexMaxZoom||Bt.numPoints<=Oe.indexMaxPoints)continue;if(Bt.source=null,oe.length!==0){Ve>1&&console.time("clipping");var Kt,si,Ci,Hi,wi,Ui,st=.5*Oe.buffer/Oe.extent,ti=.5-st,zt=.5+st,zi=1+st;Kt=si=Ci=Hi=null,wi=ni(oe,it,le-st,le+zt,0,Bt.minX,Bt.maxX,Oe),Ui=ni(oe,it,le+ti,le+zi,0,Bt.minX,Bt.maxX,Oe),oe=null,wi&&(Kt=ni(wi,it,ge-st,ge+zt,1,Bt.minY,Bt.maxY,Oe),si=ni(wi,it,ge+ti,ge+zi,1,Bt.minY,Bt.maxY,Oe),wi=null),Ui&&(Ci=ni(Ui,it,ge-st,ge+zt,1,Bt.minY,Bt.maxY,Oe),Hi=ni(Ui,it,ge+ti,ge+zi,1,Bt.minY,Bt.maxY,Oe),Ui=null),Ve>1&&console.timeEnd("clipping"),Me.push(Kt||[],Y+1,2*le,2*ge),Me.push(si||[],Y+1,2*le,2*ge+1),Me.push(Ci||[],Y+1,2*le+1,2*ge),Me.push(Hi||[],Y+1,2*le+1,2*ge+1)}}},Gt.prototype.getTile=function(oe,Y,le){var ge=this.options,_e=ge.extent,Ce=ge.debug;if(oe<0||oe>24)return null;var ve=1<<oe,Me=vi(oe,Y=(Y%ve+ve)%ve,le);if(this.tiles[Me])return $t(this.tiles[Me],_e);Ce>1&&console.log("drilling down to z%d-%d-%d",oe,Y,le);for(var Oe,Ve=oe,it=Y,yt=le;!Oe&&Ve>0;)Ve--,it=Math.floor(it/2),yt=Math.floor(yt/2),Oe=this.tiles[vi(Ve,it,yt)];return Oe&&Oe.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",Ve,it,yt),Ce>1&&console.time("drilling down"),this.splitTile(Oe.source,Ve,it,yt,oe,Y,le),Ce>1&&console.timeEnd("drilling down"),this.tiles[Me]?$t(this.tiles[Me],_e):null):null};class ze extends z{constructor(Y,le,ge,_e){super(Y,le,ge),this._dataUpdateable=new Map,this.loadGeoJSON=(Ce,ve)=>{const{promoteId:Me}=Ce;if(Ce.request)return s.f(Ce.request,(Oe,Ve,it,yt)=>{this._dataUpdateable=mr(Ve,Me)?Sr(Ve,Me):void 0,ve(Oe,Ve,it,yt)});if(typeof Ce.data=="string")try{const Oe=JSON.parse(Ce.data);this._dataUpdateable=mr(Oe,Me)?Sr(Oe,Me):void 0,ve(null,Oe)}catch{ve(new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`))}else Ce.dataDiff?this._dataUpdateable?(function(Oe,Ve,it){var yt,Bt,Yt,qt;if(Ve.removeAll&&Oe.clear(),Ve.remove)for(const Kt of Ve.remove)Oe.delete(Kt);if(Ve.add)for(const Kt of Ve.add){const si=Jt(Kt,it);si!=null&&Oe.set(si,Kt)}if(Ve.update)for(const Kt of Ve.update){let si=Oe.get(Kt.id);if(si==null)continue;const Ci=!Kt.removeAllProperties&&(((yt=Kt.removeProperties)===null||yt===void 0?void 0:yt.length)>0||((Bt=Kt.addOrUpdateProperties)===null||Bt===void 0?void 0:Bt.length)>0);if((Kt.newGeometry||Kt.removeAllProperties||Ci)&&(si=Object.assign({},si),Oe.set(Kt.id,si),Ci&&(si.properties=Object.assign({},si.properties))),Kt.newGeometry&&(si.geometry=Kt.newGeometry),Kt.removeAllProperties)si.properties={};else if(((Yt=Kt.removeProperties)===null||Yt===void 0?void 0:Yt.length)>0)for(const Hi of Kt.removeProperties)Object.prototype.hasOwnProperty.call(si.properties,Hi)&&delete si.properties[Hi];if(((qt=Kt.addOrUpdateProperties)===null||qt===void 0?void 0:qt.length)>0)for(const{key:Hi,value:wi}of Kt.addOrUpdateProperties)si.properties[Hi]=wi}}(this._dataUpdateable,Ce.dataDiff,Me),ve(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ve(new Error(`Cannot update existing geojson data in ${Ce.source}`)):ve(new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,_e&&(this.loadGeoJSON=_e)}loadGeoJSONTile(Y,le){const ge=Y.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const _e=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!_e)return le(null,null);const Ce=new class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=Me.length,this._features=Me}feature(Me){return new class{constructor(Oe){this._feature=Oe,this.extent=s.N,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const Ve of this._feature.geometry)Oe.push([new s.P(Ve[0],Ve[1])]);return Oe}{const Oe=[];for(const Ve of this._feature.geometry){const it=[];for(const yt of Ve)it.push(new s.P(yt[0],yt[1]));Oe.push(it)}return Oe}}toGeoJSON(Oe,Ve,it){return de.call(this,Oe,Ve,it)}}(this._features[Me])}}(_e.features);let ve=Ft(Ce);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),le(null,{vectorTile:Ce,rawData:ve.buffer})}loadData(Y,le){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const _e=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new s.bu(Y.request);this._pendingCallback=le,this._pendingRequest=this.loadGeoJSON(Y,(Ce,ve)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ce||!ve)return le(Ce);if(typeof ve!="object")return le(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{ce(ve,!0);try{if(Y.filter){const Oe=s.bC(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(it=>`${it.key}: ${it.message}`).join(", "));ve={type:"FeatureCollection",features:ve.features.filter(it=>Oe.value.evaluate({zoom:0},it))}}this._geoJSONIndex=Y.cluster?new ft(function(Oe){let{superclusterOptions:Ve,clusterProperties:it}=Oe;if(!it||!Ve)return Ve;const yt={},Bt={},Yt={accumulated:null,zoom:0},qt={properties:null},Kt=Object.keys(it);for(const si of Kt){const[Ci,Hi]=it[si],wi=s.bC(Hi),Ui=s.bC(typeof Ci=="string"?[Ci,["accumulated"],["get",si]]:Ci);yt[si]=wi.value,Bt[si]=Ui.value}return Ve.map=si=>{qt.properties=si;const Ci={};for(const Hi of Kt)Ci[Hi]=yt[Hi].evaluate(Yt,qt);return Ci},Ve.reduce=(si,Ci)=>{qt.properties=Ci;for(const Hi of Kt)Yt.accumulated=si[Hi],si[Hi]=Bt[Hi].evaluate(Yt,qt)},Ve}(Y)).load(ve.features):function(Oe,Ve){return new Gt(Oe,Ve)}(ve,Y.geojsonVtOptions)}catch(Oe){return le(Oe)}this.loaded={};const Me={};if(_e){const Oe=_e.finish();Oe&&(Me.resourceTiming={},Me.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Oe)))}le(null,Me)}})}reloadTile(Y,le){const ge=this.loaded;return ge&&ge[Y.uid]?super.reloadTile(Y,le):this.loadTile(Y,le)}removeSource(Y,le){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),le()}getClusterExpansionZoom(Y,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ge){le(ge)}}getClusterChildren(Y,le){try{le(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ge){le(ge)}}getClusterLeaves(Y,le){try{le(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ge){le(ge)}}}class we{constructor(Y){this.self=Y,this.actor=new s.C(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:z,geojson:ze},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,ge)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=ge},this.self.registerRTLTextPlugin=le=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=le.applyArabicShaping,s.bD.processBidirectionalText=le.processBidirectionalText,s.bD.processStyledBidirectionalText=le.processStyledBidirectionalText}}setReferrer(Y,le){this.referrer=le}setImages(Y,le,ge){this.availableImages[Y]=le;for(const _e in this.workerSources[Y]){const Ce=this.workerSources[Y][_e];for(const ve in Ce)Ce[ve].availableImages=le}ge()}setLayers(Y,le,ge){this.getLayerIndex(Y).replace(le),ge()}updateLayers(Y,le,ge){this.getLayerIndex(Y).update(le.layers,le.removedIds),ge()}loadTile(Y,le,ge){this.getWorkerSource(Y,le.type,le.source).loadTile(le,ge)}loadDEMTile(Y,le,ge){this.getDEMWorkerSource(Y,le.source).loadTile(le,ge)}reloadTile(Y,le,ge){this.getWorkerSource(Y,le.type,le.source).reloadTile(le,ge)}abortTile(Y,le,ge){this.getWorkerSource(Y,le.type,le.source).abortTile(le,ge)}removeTile(Y,le,ge){this.getWorkerSource(Y,le.type,le.source).removeTile(le,ge)}removeDEMTile(Y,le){this.getDEMWorkerSource(Y,le.source).removeTile(le)}removeSource(Y,le,ge){if(!this.workerSources[Y]||!this.workerSources[Y][le.type]||!this.workerSources[Y][le.type][le.source])return;const _e=this.workerSources[Y][le.type][le.source];delete this.workerSources[Y][le.type][le.source],_e.removeSource!==void 0?_e.removeSource(le,ge):ge()}loadWorkerSource(Y,le,ge){try{this.self.importScripts(le.url),ge()}catch(_e){ge(_e.toString())}}syncRTLPluginState(Y,le,ge){try{s.bD.setState(le);const _e=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&_e!=null){this.self.importScripts(_e);const Ce=s.bD.isParsed();ge(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Ce)}}catch(_e){ge(_e.toString())}}getAvailableImages(Y){let le=this.availableImages[Y];return le||(le=[]),le}getLayerIndex(Y){let le=this.layerIndexes[Y];return le||(le=this.layerIndexes[Y]=new m),le}getWorkerSource(Y,le,ge){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][le]||(this.workerSources[Y][le]={}),this.workerSources[Y][le][ge]||(this.workerSources[Y][le][ge]=new this.workerSourceTypes[le]({send:(_e,Ce,ve)=>{this.actor.send(_e,Ce,ve,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][le][ge]}getDEMWorkerSource(Y,le){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][le]||(this.demWorkerSources[Y][le]=new ie),this.demWorkerSources[Y][le]}}return s.i()&&(self.worker=new we(self)),we}),o(["./shared"],function(s){var m="3.6.2";class x{static testProp(A){if(!x.docStyle)return A[0];for(let b=0;b<A.length;b++)if(A[b]in x.docStyle)return A[b];return A[0]}static create(A,b,L){const k=window.document.createElement(A);return b!==void 0&&(k.className=b),L&&L.appendChild(k),k}static createNS(A,b){return window.document.createElementNS(A,b)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(A,b){A.style[x.transformProp]=b}static addEventListener(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.addEventListener(b,L,"passive"in k?k:k.capture)}static removeEventListener(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.removeEventListener(b,L,"passive"in k?k:k.capture)}static suppressClickInternal(A){A.preventDefault(),A.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static mousePos(A,b){const L=A.getBoundingClientRect();return new s.P(b.clientX-L.left-A.clientLeft,b.clientY-L.top-A.clientTop)}static touchPos(A,b){const L=A.getBoundingClientRect(),k=[];for(let y=0;y<b.length;y++)k.push(new s.P(b[y].clientX-L.left-A.clientLeft,b[y].clientY-L.top-A.clientTop));return k}static mouseButton(A){return A.button}static remove(A){A.parentNode&&A.parentNode.removeChild(A)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(N){!z&&O&&(ie?ne(N):F=N)}};let F,O,z=!1,ie=!1;function ne(N){const A=N.createTexture();N.bindTexture(N.TEXTURE_2D,A);try{if(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,O),N.isContextLost())return;I.supported=!0}catch{}N.deleteTexture(A),z=!0}var ue,ce;typeof document<"u"&&(O=document.createElement("img"),O.onload=function(){F&&ne(F),F=null,ie=!0},O.onerror=function(){z=!0,F=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(N){let A,b,L,k;N.resetRequestQueue=()=>{A=[],b=0,L=0,k={}},N.addThrottleControl=B=>{const S=L++;return k[S]=B,S},N.removeThrottleControl=B=>{delete k[B],d()},N.getImage=function(B,S){let U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;I.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*");const H={requestParameters:B,supportImageRefresh:U,callback:S,cancelled:!1,completed:!1,cancel:()=>{H.completed||H.cancelled||(H.cancelled=!0,H.innerRequest&&(H.innerRequest.cancel(),b--),d())}};return A.push(H),d(),H};const y=B=>{const{requestParameters:S,supportImageRefresh:U,callback:H}=B;return s.e(S,{type:"image"}),(U!==!1||s.i()||s.g(S.url)||S.headers&&!Object.keys(S.headers).reduce((q,w)=>q&&w==="accept",!0)?s.m:_)(S,(q,w,T,R)=>{a(B,H,q,w,T,R)})},a=(B,S,U,H,q,w)=>{U?S(U):H instanceof HTMLImageElement||s.a(H)?S(null,H):H&&((T,R)=>{typeof createImageBitmap=="function"?s.b(T,R):s.d(T,R)})(H,(T,R)=>{T!=null?S(T):R!=null&&S(null,R,{cacheControl:q,expires:w})}),B.cancelled||(B.completed=!0,b--,d())},d=()=>{const B=(()=>{const S=Object.keys(k);let U=!1;if(S.length>0){for(const H of S)if(U=k[H](),U)break}return U})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let S=b;S<B&&A.length>0;S++){const U=A.shift();if(U.cancelled){S--;continue}const H=y(U);b++,U.innerRequest=H}},_=(B,S)=>{const U=new Image,H=B.url;let q=!1;const w=B.credentials;return w&&w==="include"?U.crossOrigin="use-credentials":(w&&w==="same-origin"||!s.s(H))&&(U.crossOrigin="anonymous"),U.fetchPriority="high",U.onload=()=>{S(null,U),U.onerror=U.onload=null},U.onerror=()=>{q||S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),U.onerror=U.onload=null},U.src=H,{cancel:()=>{q=!0,U.src=""}}}}(ue||(ue={})),ue.resetRequestQueue(),function(N){N.Glyphs="Glyphs",N.Image="Image",N.Source="Source",N.SpriteImage="SpriteImage",N.SpriteJSON="SpriteJSON",N.Style="Style",N.Tile="Tile",N.Unknown="Unknown"}(ce||(ce={}));class de{constructor(A){this._transformRequestFn=A}transformRequest(A,b){return this._transformRequestFn&&this._transformRequestFn(A,b)||{url:A}}normalizeSpriteURL(A,b,L){const k=function(y){const a=y.match(be);if(!a)throw new Error(`Unable to parse URL "${y}"`);return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}(A);return k.path+=`${b}${L}`,function(y){const a=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${a}`}(k)}setTransformRequest(A){this._transformRequestFn=A}}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Te(N){var A=new s.A(3);return A[0]=N[0],A[1]=N[1],A[2]=N[2],A}var je,Ge=function(N,A,b){return N[0]=A[0]-b[0],N[1]=A[1]-b[1],N[2]=A[2]-b[2],N};je=new s.A(3),s.A!=Float32Array&&(je[0]=0,je[1]=0,je[2]=0);var $e=function(N){var A=N[0],b=N[1];return A*A+b*b};function Ue(N){const A=[];if(typeof N=="string")A.push({id:"default",url:N});else if(N&&N.length>0){const b=[];for(const{id:L,url:k}of N){const y=`${L}${k}`;b.indexOf(y)===-1&&(b.push(y),A.push({id:L,url:k}))}}return A}function lt(N,A,b,L,k){if(L)return void N(L);if(k!==Object.values(A).length||k!==Object.values(b).length)return;const y={};for(const a in A){y[a]={};const d=s.h.getImageCanvasContext(b[a]),_=A[a];for(const B in _){const{width:S,height:U,x:H,y:q,sdf:w,pixelRatio:T,stretchX:R,stretchY:j,content:Z}=_[B];y[a][B]={data:null,pixelRatio:T,sdf:w,stretchX:R,stretchY:j,content:Z,spriteData:{width:S,height:U,x:H,y:q,context:d}}}}N(null,y)}(function(){var N=new s.A(2);s.A!=Float32Array&&(N[0]=0,N[1]=0)})();class nt{constructor(A,b,L,k){this.context=A,this.format=L,this.texture=A.gl.createTexture(),this.update(b,k)}update(A,b,L){const{width:k,height:y}=A,a=!(this.size&&this.size[0]===k&&this.size[1]===y||L),{context:d}=this,{gl:_}=d;if(this.useMipmap=!!(b&&b.useMipmap),_.bindTexture(_.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!b||b.premultiply!==!1)),a)this.size=[k,y],A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,A):_.texImage2D(_.TEXTURE_2D,0,this.format,k,y,0,this.format,_.UNSIGNED_BYTE,A.data);else{const{x:B,y:S}=L||{x:0,y:0};A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texSubImage2D(_.TEXTURE_2D,0,B,S,_.RGBA,_.UNSIGNED_BYTE,A):_.texSubImage2D(_.TEXTURE_2D,0,B,S,k,y,_.RGBA,_.UNSIGNED_BYTE,A.data)}this.useMipmap&&this.isSizePowerOfTwo()&&_.generateMipmap(_.TEXTURE_2D)}bind(A,b,L){const{context:k}=this,{gl:y}=k;y.bindTexture(y.TEXTURE_2D,this.texture),L!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(L=y.LINEAR),A!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,A),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,L||A),this.filter=A),b!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,b),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,b),this.wrap=b)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:A}=this.context;A.deleteTexture(this.texture),this.texture=null}}function De(N){const{userImage:A}=N;return!!(A&&A.render&&A.render())&&(N.data.replace(new Uint8Array(A.data.buffer)),!0)}class Fe extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(A){if(this.loaded!==A&&(this.loaded=A,A)){for(const{ids:b,callback:L}of this.requestors)this._notify(b,L);this.requestors=[]}}getImage(A){const b=this.images[A];if(b&&!b.data&&b.spriteData){const L=b.spriteData;b.data=new s.R({width:L.width,height:L.height},L.context.getImageData(L.x,L.y,L.width,L.height).data),b.spriteData=null}return b}addImage(A,b){if(this.images[A])throw new Error(`Image id ${A} already exist, use updateImage instead`);this._validate(A,b)&&(this.images[A]=b)}_validate(A,b){let L=!0;const k=b.data||b.spriteData;return this._validateStretch(b.stretchX,k&&k.width)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchX" value`))),L=!1),this._validateStretch(b.stretchY,k&&k.height)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchY" value`))),L=!1),this._validateContent(b.content,b)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "content" value`))),L=!1),L}_validateStretch(A,b){if(!A)return!0;let L=0;for(const k of A){if(k[0]<L||k[1]<k[0]||b<k[1])return!1;L=k[1]}return!0}_validateContent(A,b){if(!A)return!0;if(A.length!==4)return!1;const L=b.spriteData,k=L&&L.width||b.data.width,y=L&&L.height||b.data.height;return!(A[0]<0||k<A[0]||A[1]<0||y<A[1]||A[2]<0||k<A[2]||A[3]<0||y<A[3]||A[2]<A[0]||A[3]<A[1])}updateImage(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const k=this.getImage(A);if(L&&(k.data.width!==b.data.width||k.data.height!==b.data.height))throw new Error(`size mismatch between old image (${k.data.width}x${k.data.height}) and new image (${b.data.width}x${b.data.height}).`);b.version=k.version+1,this.images[A]=b,this.updatedImages[A]=!0}removeImage(A){const b=this.images[A];delete this.images[A],delete this.patterns[A],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(A,b){let L=!0;if(!this.isLoaded())for(const k of A)this.images[k]||(L=!1);this.isLoaded()||L?this._notify(A,b):this.requestors.push({ids:A,callback:b})}_notify(A,b){const L={};for(const k of A){let y=this.getImage(k);y||(this.fire(new s.k("styleimagemissing",{id:k})),y=this.getImage(k)),y?L[k]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:s.w(`Image "${k}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}b(null,L)}getPixelSize(){const{width:A,height:b}=this.atlasImage;return{width:A,height:b}}getPattern(A){const b=this.patterns[A],L=this.getImage(A);if(!L)return null;if(b&&b.position.version===L.version)return b.position;if(b)b.position.version=L.version;else{const k={w:L.data.width+2,h:L.data.height+2,x:0,y:0},y=new s.I(k,L);this.patterns[A]={bin:k,position:y}}return this._updatePatternAtlas(),this.patterns[A].position}bind(A){const b=A.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new nt(A,this.atlasImage,b.RGBA),this.atlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(){const A=[];for(const y in this.patterns)A.push(this.patterns[y].bin);const{w:b,h:L}=s.p(A),k=this.atlasImage;k.resize({width:b||1,height:L||1});for(const y in this.patterns){const{bin:a}=this.patterns[y],d=a.x+1,_=a.y+1,B=this.getImage(y).data,S=B.width,U=B.height;s.R.copy(B,k,{x:0,y:0},{x:d,y:_},{width:S,height:U}),s.R.copy(B,k,{x:0,y:U-1},{x:d,y:_-1},{width:S,height:1}),s.R.copy(B,k,{x:0,y:0},{x:d,y:_+U},{width:S,height:1}),s.R.copy(B,k,{x:S-1,y:0},{x:d-1,y:_},{width:1,height:U}),s.R.copy(B,k,{x:0,y:0},{x:d+S,y:_},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(A){for(const b of A){if(this.callbackDispatchedThisFrame[b])continue;this.callbackDispatchedThisFrame[b]=!0;const L=this.getImage(b);L||s.w(`Image with ID: "${b}" was not found`),De(L)&&this.updateImage(b,L)}}}const Je=1e20;function We(N,A,b,L,k,y,a,d,_){for(let B=A;B<A+L;B++)Et(N,b*y+B,y,k,a,d,_);for(let B=b;B<b+k;B++)Et(N,B*y+A,1,L,a,d,_)}function Et(N,A,b,L,k,y,a){y[0]=0,a[0]=-Je,a[1]=Je,k[0]=N[A];for(let d=1,_=0,B=0;d<L;d++){k[d]=N[A+d*b];const S=d*d;do{const U=y[_];B=(k[d]-k[U]+S-U*U)/(d-U)/2}while(B<=a[_]&&--_>-1);_++,y[_]=d,a[_]=B,a[_+1]=Je}for(let d=0,_=0;d<L;d++){for(;a[_+1]<d;)_++;const B=y[_],S=d-B;N[A+d*b]=k[B]+S*S}}class Ct{constructor(A,b){this.requestManager=A,this.localIdeographFontFamily=b,this.entries={}}setURL(A){this.url=A}getGlyphs(A,b){const L=[];for(const k in A)for(const y of A[k])L.push({stack:k,id:y});s.o(L,(k,y)=>{let{stack:a,id:d}=k,_=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return void y(null,{stack:a,id:d,glyph:B});if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,void y(null,{stack:a,id:d,glyph:B});const S=Math.floor(d/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(_.ranges[S])return void y(null,{stack:a,id:d,glyph:B});if(!this.url)return void y(new Error("glyphsUrl is not set"));let U=_.requests[S];U||(U=_.requests[S]=[],Ct.loadGlyphRange(a,S,this.url,this.requestManager,(H,q)=>{if(q){for(const w in q)this._doesCharSupportLocalGlyph(+w)||(_.glyphs[+w]=q[+w]);_.ranges[S]=!0}for(const w of U)w(H,q);delete _.requests[S]})),U.push((H,q)=>{H?y(H):q&&y(null,{stack:a,id:d,glyph:q[d]||null})})},(k,y)=>{if(k)b(k);else if(y){const a={};for(const{stack:d,id:_,glyph:B}of y)(a[d]||(a[d]={}))[_]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};b(null,a)}})}_doesCharSupportLocalGlyph(A){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](A)||s.u["Hangul Syllables"](A)||s.u.Hiragana(A)||s.u.Katakana(A))}_tinySDF(A,b,L){const k=this.localIdeographFontFamily;if(!k||!this._doesCharSupportLocalGlyph(L))return;let y=A.tinySDF;if(!y){let d="400";/bold/i.test(b)?d="900":/medium/i.test(b)?d="500":/light/i.test(b)&&(d="200"),y=A.tinySDF=new Ct.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:k,fontWeight:d})}const a=y.draw(String.fromCharCode(L));return{id:L,bitmap:new s.q({width:a.width||60,height:a.height||60},a.data),metrics:{width:a.glyphWidth/2||24,height:a.glyphHeight/2||24,left:a.glyphLeft/2+.5||0,top:a.glyphTop/2-27.5||-8,advance:a.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ct.loadGlyphRange=function(N,A,b,L,k){const y=256*A,a=y+255,d=L.transformRequest(b.replace("{fontstack}",N).replace("{range}",`${y}-${a}`),ce.Glyphs);s.l(d,(_,B)=>{if(_)k(_);else if(B){const S={};for(const U of s.n(B))S[U.id]=U;k(null,S)}})},Ct.TinySDF=class{constructor(){let{fontSize:N=24,buffer:A=3,radius:b=8,cutoff:L=.25,fontFamily:k="sans-serif",fontWeight:y="normal",fontStyle:a="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=A,this.cutoff=L,this.radius=b;const d=this.size=N+4*A,_=this._createCanvas(d),B=this.ctx=_.getContext("2d",{willReadFrequently:!0});B.font=`${a} ${y} ${N}px ${k}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(N){const A=document.createElement("canvas");return A.width=A.height=N,A}draw(N){const{width:A,actualBoundingBoxAscent:b,actualBoundingBoxDescent:L,actualBoundingBoxLeft:k,actualBoundingBoxRight:y}=this.ctx.measureText(N),a=Math.ceil(b),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-k))),_=Math.min(this.size-this.buffer,a+Math.ceil(L)),B=d+2*this.buffer,S=_+2*this.buffer,U=Math.max(B*S,0),H=new Uint8ClampedArray(U),q={data:H,width:B,height:S,glyphWidth:d,glyphHeight:_,glyphTop:a,glyphLeft:0,glyphAdvance:A};if(d===0||_===0)return q;const{ctx:w,buffer:T,gridInner:R,gridOuter:j}=this;w.clearRect(T,T,d,_),w.fillText(N,T,T+a);const Z=w.getImageData(T,T,d,_);j.fill(Je,0,U),R.fill(0,0,U);for(let W=0;W<_;W++)for(let J=0;J<d;J++){const ee=Z.data[4*(W*d+J)+3]/255;if(ee===0)continue;const ae=(W+T)*B+J+T;if(ee===1)j[ae]=0,R[ae]=Je;else{const fe=.5-ee;j[ae]=fe>0?fe*fe:0,R[ae]=fe<0?fe*fe:0}}We(j,0,0,B,S,B,this.f,this.v,this.z),We(R,T,T,d,_,B,this.f,this.v,this.z);for(let W=0;W<U;W++){const J=Math.sqrt(j[W])-Math.sqrt(R[W]);H[W]=Math.round(255-255*(J/this.radius+this.cutoff))}return q}};class Lt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(A,b){return s.z(A.expression.evaluate(b))}interpolate(A,b,L){return{x:s.B.number(A.x,b.x,L),y:s.B.number(A.y,b.y,L),z:s.B.number(A.z,b.z,L)}}}let _t;class Ft extends s.E{constructor(A){super(),_t=_t||new s.r({anchor:new s.D(s.v.light.anchor),position:new Lt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(_t),this.setLight(A),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.t,A,b))for(const L in A){const k=A[L];L.endsWith("-transition")?this._transitionable.setTransition(L.slice(0,-11),k):this._transitionable.setValue(L,k)}}updateTransitions(A){this._transitioning=this._transitionable.transitioned(A,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(A){this.properties=this._transitioning.possiblyEvaluate(A)}_validate(A,b,L){return(!L||L.validate!==!1)&&s.x(this,A.call(s.y,s.e({value:b,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Mt{constructor(A,b){this.width=A,this.height=b,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(A,b){const L=A.join(",")+String(b);return this.dashEntry[L]||(this.dashEntry[L]=this.addDash(A,b)),this.dashEntry[L]}getDashRanges(A,b,L){const k=[];let y=A.length%2==1?-A[A.length-1]*L:0,a=A[0]*L,d=!0;k.push({left:y,right:a,isDash:d,zeroLength:A[0]===0});let _=A[0];for(let B=1;B<A.length;B++){d=!d;const S=A[B];y=_*L,_+=S,a=_*L,k.push({left:y,right:a,isDash:d,zeroLength:S===0})}return k}addRoundDash(A,b,L){const k=b/2;for(let y=-L;y<=L;y++){const a=this.width*(this.nextRow+L+y);let d=0,_=A[d];for(let B=0;B<this.width;B++){B/_.right>1&&(_=A[++d]);const S=Math.abs(B-_.left),U=Math.abs(B-_.right),H=Math.min(S,U);let q;const w=y/L*(k+1);if(_.isDash){const T=k-Math.abs(w);q=Math.sqrt(H*H+T*T)}else q=k-Math.sqrt(H*H+w*w);this.data[a+B]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(A){for(let d=A.length-1;d>=0;--d){const _=A[d],B=A[d+1];_.zeroLength?A.splice(d,1):B&&B.isDash===_.isDash&&(B.left=_.left,A.splice(d,1))}const b=A[0],L=A[A.length-1];b.isDash===L.isDash&&(b.left=L.left-this.width,L.right=b.right+this.width);const k=this.width*this.nextRow;let y=0,a=A[y];for(let d=0;d<this.width;d++){d/a.right>1&&(a=A[++y]);const _=Math.abs(d-a.left),B=Math.abs(d-a.right),S=Math.min(_,B);this.data[k+d]=Math.max(0,Math.min(255,(a.isDash?S:-S)+128))}}addDash(A,b){const L=b?7:0,k=2*L+1;if(this.nextRow+k>this.height)return s.w("LineAtlas out of space"),null;let y=0;for(let d=0;d<A.length;d++)y+=A[d];if(y!==0){const d=this.width/y,_=this.getDashRanges(A,this.width,d);b?this.addRoundDash(_,d,L):this.addRegularDash(_)}const a={y:(this.nextRow+L+.5)/this.height,height:2*L/this.height,width:y};return this.nextRow+=k,this.dirty=!0,a}bind(A){const b=A.gl;this.texture?(b.bindTexture(b.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.width,this.height,b.ALPHA,b.UNSIGNED_BYTE,this.data))):(this.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.ALPHA,this.width,this.height,0,b.ALPHA,b.UNSIGNED_BYTE,this.data))}}class Wt{constructor(A,b,L){this.workerPool=A,this.actors=[],this.currentActor=0,this.id=L;const k=this.workerPool.acquire(L);for(let y=0;y<k.length;y++){const a=new s.C(k[y],b,L);a.name=`Worker ${y}`,this.actors.push(a)}if(!this.actors.length)throw new Error("No actors found")}broadcast(A,b,L){s.o(this.actors,(k,y)=>{k.send(A,b,y)},L=L||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(b=>{b.remove()}),this.actors=[],A&&this.workerPool.release(this.id)}}function Ee(N,A,b){const L=function(k,y){if(k)return b(k);if(y){const a=s.F(s.e(y,N),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(a.vectorLayers=y.vector_layers,a.vectorLayerIds=a.vectorLayers.map(d=>d.id)),b(null,a)}};return N.url?s.f(A.transformRequest(N.url,ce.Source),L):s.h.frame(()=>L(null,N))}class Xe{constructor(A,b){A&&(b?this.setSouthWest(A).setNorthEast(b):Array.isArray(A)&&(A.length===4?this.setSouthWest([A[0],A[1]]).setNorthEast([A[2],A[3]]):this.setSouthWest(A[0]).setNorthEast(A[1])))}setNorthEast(A){return this._ne=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}setSouthWest(A){return this._sw=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}extend(A){const b=this._sw,L=this._ne;let k,y;if(A instanceof s.L)k=A,y=A;else{if(!(A instanceof Xe))return Array.isArray(A)?A.length===4||A.every(Array.isArray)?this.extend(Xe.convert(A)):this.extend(s.L.convert(A)):A&&("lng"in A||"lon"in A)&&"lat"in A?this.extend(s.L.convert(A)):this;if(k=A._sw,y=A._ne,!k||!y)return this}return b||L?(b.lng=Math.min(k.lng,b.lng),b.lat=Math.min(k.lat,b.lat),L.lng=Math.max(y.lng,L.lng),L.lat=Math.max(y.lat,L.lat)):(this._sw=new s.L(k.lng,k.lat),this._ne=new s.L(y.lng,y.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(A){const{lng:b,lat:L}=s.L.convert(A);let k=this._sw.lng<=b&&b<=this._ne.lng;return this._sw.lng>this._ne.lng&&(k=this._sw.lng>=b&&b>=this._ne.lng),this._sw.lat<=L&&L<=this._ne.lat&&k}static convert(A){return A instanceof Xe?A:A&&new Xe(A)}static fromLngLat(A){const L=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,k=L/Math.cos(Math.PI/180*A.lat);return new Xe(new s.L(A.lng-k,A.lat-L),new s.L(A.lng+k,A.lat+L))}}class et{constructor(A,b,L){this.bounds=Xe.convert(this.validateBounds(A)),this.minzoom=b||0,this.maxzoom=L||24}validateBounds(A){return Array.isArray(A)&&A.length===4?[Math.max(-180,A[0]),Math.max(-90,A[1]),Math.min(180,A[2]),Math.min(90,A[3])]:[-180,-90,180,90]}contains(A){const b=Math.pow(2,A.z),L=Math.floor(s.G(this.bounds.getWest())*b),k=Math.floor(s.H(this.bounds.getNorth())*b),y=Math.ceil(s.G(this.bounds.getEast())*b),a=Math.ceil(s.H(this.bounds.getSouth())*b);return A.x>=L&&A.x<y&&A.y>=k&&A.y<a}}class At extends s.E{constructor(A,b,L,k){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(y,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new s.j(y)):a&&(s.e(this,a),a.bounds&&(this.tileBounds=new et(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=A,this.dispatcher=L,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(b,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(k)}loaded(){return this._loaded}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}onAdd(A){this.map=A,this.load()}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}setUrl(A){return this.setSourceProperty(()=>{this.url=A,this._options.url=A}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k={request:this.map._requestManager.transformRequest(L,ce.Tile),uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,tileSize:this.tileSize*A.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(a,d){return delete A.request,A.aborted?b(null):a&&a.status!==404?b(a):(d&&d.resourceTiming&&(A.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&A.setExpiryData(d),A.loadVectorData(d,this.map.painter),b(null),void(A.reloadCallback&&(this.loadTile(A,A.reloadCallback),A.reloadCallback=null)))}k.request.collectResourceTiming=this._collectResourceTiming,A.actor&&A.state!=="expired"?A.state==="loading"?A.reloadCallback=b:A.request=A.actor.send("reloadTile",k,y.bind(this)):(A.actor=this.dispatcher.getActor(),A.request=A.actor.send("loadTile",k,y.bind(this)))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.actor&&A.actor.send("abortTile",{uid:A.uid,type:this.type,source:this.id},void 0)}unloadTile(A){A.unloadVectorData(),A.actor&&A.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class ft extends s.E{constructor(A,b,L,k){super(),this.id=A,this.dispatcher=L,this.setEventedParent(k),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},b),s.e(this,s.F(b,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(A,b)=>{this._tileJSONRequest=null,this._loaded=!0,A?this.fire(new s.j(A)):b&&(s.e(this,b),b.bounds&&(this.tileBounds=new et(b.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(A){this.map=A,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}serialize(){return s.e({},this._options)}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);A.request=ue.getImage(this.map._requestManager.transformRequest(L,ce.Tile),(k,y,a)=>{if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(k)A.state="errored",b(k);else if(y){this.map._refreshExpiredTiles&&a&&A.setExpiryData(a);const d=this.map.painter.context,_=d.gl;A.texture=this.map.painter.getTileTexture(y.width),A.texture?A.texture.update(y,{useMipmap:!0}):(A.texture=new nt(d,y,_.RGBA,{useMipmap:!0}),A.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),d.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax)),A.state="loaded",b(null)}},this.map._refreshExpiredTiles)}abortTile(A,b){A.request&&(A.request.cancel(),delete A.request),b()}unloadTile(A,b){A.texture&&this.map.painter.saveTileTexture(A.texture),b()}hasTransition(){return!1}}class wt extends ft{constructor(A,b,L,k){super(A,b,L,k),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox",this.redFactor=b.redFactor,this.greenFactor=b.greenFactor,this.blueFactor=b.blueFactor,this.baseShift=b.baseShift}loadTile(A,b){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),k=this.map._requestManager.transformRequest(L,ce.Tile);function y(a,d){a&&(A.state="errored",b(a)),d&&(A.dem=d,A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0,A.state="loaded",b(null))}A.neighboringTiles=this._getNeighboringTiles(A.tileID),A.request=ue.getImage(k,(a,d,_)=>s._(this,void 0,void 0,function*(){if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(a)A.state="errored",b(a);else if(d){this.map._refreshExpiredTiles&&A.setExpiryData(_);const B=s.a(d)&&s.J()?d:yield function(U){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const H=U.width+2,q=U.height+2;try{return new s.R({width:H,height:q},yield s.M(U,-1,-1,H,q))}catch{}}return s.h.getImageData(U,1)})}(d),S={uid:A.uid,coord:A.tileID,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};A.actor&&A.state!=="expired"||(A.actor=this.dispatcher.getActor(),A.actor.send("loadDEMTile",S,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(A){const b=A.canonical,L=Math.pow(2,b.z),k=(b.x-1+L)%L,y=b.x===0?A.wrap-1:A.wrap,a=(b.x+1+L)%L,d=b.x+1===L?A.wrap+1:A.wrap,_={};return _[new s.O(A.overscaledZ,y,b.z,k,b.y).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,b.z,a,b.y).key]={backfilled:!1},b.y>0&&(_[new s.O(A.overscaledZ,y,b.z,k,b.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,b.z,a,b.y-1).key]={backfilled:!1}),b.y+1<L&&(_[new s.O(A.overscaledZ,y,b.z,k,b.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,b.z,a,b.y+1).key]={backfilled:!1}),_}unloadTile(A){A.demTexture&&this.map.painter.saveTileTexture(A.demTexture),A.fbo&&(A.fbo.destroy(),delete A.fbo),A.dem&&delete A.dem,delete A.neighboringTiles,A.state="unloaded",A.actor&&A.actor.send("removeDEMTile",{uid:A.uid,source:this.id})}}class Pt extends s.E{constructor(A,b,L,k){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=A,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=L.getActor(),this.setEventedParent(k),this._data=b.data,this._options=s.e({},b),this._collectResourceTiming=b.collectResourceTiming,b.maxzoom!==void 0&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;const y=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(b.buffer!==void 0?b.buffer:128)*y,tolerance:(b.tolerance!==void 0?b.tolerance:.375)*y,extent:s.N,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:b.clusterMaxZoom!==void 0?b.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:s.N,radius:(b.clusterRadius||50)*y,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(A){this.map=A,this.load()}setData(A){return this._data=A,this._updateWorkerData(),this}updateData(A){return this._updateWorkerData(A),this}setClusterOptions(A){return this.workerOptions.cluster=A.cluster,A&&(A.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=A.clusterRadius),A.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=A.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(A,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:A,source:this.id},b),this}getClusterChildren(A,b){return this.actor.send("geojson.getClusterChildren",{clusterId:A,source:this.id},b),this}getClusterLeaves(A,b,L,k){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:A,limit:b,offset:L},k),this}_updateWorkerData(A){const b=s.e({},this.workerOptions);A?b.dataDiff=A:typeof this._data=="string"?(b.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ce.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,b,(L,k)=>{if(this._pendingLoads--,this._removed||k&&k.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let y=null;if(k&&k.resourceTiming&&k.resourceTiming[this.id]&&(y=k.resourceTiming[this.id].slice(0)),L)return void this.fire(new s.j(L));const a={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&s.e(a,{resourceTiming:y}),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(A,b){const L=A.actor?"reloadTile":"loadTile";A.actor=this.actor;const k={type:this.type,uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request=this.actor.send(L,k,(y,a)=>(delete A.request,A.unloadVectorData(),A.aborted?b(null):y?b(y):(A.loadVectorData(a,this.map.painter,L==="reloadTile"),b(null))))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.aborted=!0}unloadTile(A){A.unloadVectorData(),this.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var It=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ht extends s.E{constructor(A,b,L,k){super(),this.load=(y,a)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ue.getImage(this.map._requestManager.transformRequest(this.url,ce.Image),(d,_)=>{this._request=null,this._loaded=!0,d?this.fire(new s.j(d)):_&&(this.image=_,y&&(this.coordinates=y),a&&a(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new nt(y,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=A,this.dispatcher=L,this.coordinates=b.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(k),this.options=b}loaded(){return this._loaded}updateImage(A){return A.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=A.url,this.load(A.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(A){this.map=A,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(A){this.coordinates=A;const b=A.map(s.U.fromLngLat);this.tileID=function(k){let y=1/0,a=1/0,d=-1/0,_=-1/0;for(const H of k)y=Math.min(y,H.x),a=Math.min(a,H.y),d=Math.max(d,H.x),_=Math.max(_,H.y);const B=Math.max(d-y,_-a),S=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),U=Math.pow(2,S);return new s.W(S,Math.floor((y+d)/2*U),Math.floor((a+_)/2*U))}(b),this.minzoom=this.maxzoom=this.tileID.z;const L=b.map(k=>this.tileID.getTilePoint(k)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.N,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.N),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(A,b){this.tileID&&this.tileID.equals(A.tileID.canonical)?(this.tiles[String(A.tileID.wrap)]=A,A.buckets={},b(null)):(A.state="errored",b(null))}hasTransition(){return!1}}class ii extends Ht{constructor(A,b,L,k){super(A,b,L,k),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,ce.Source).url);s.X(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new s.j(a)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new nt(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=b}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(A){if(this.video){const b=this.video.seekable;A<b.start(0)||A>b.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${b.start(0)} and ${b.end(0)}-second mark.`))):this.video.currentTime=A}}getVideo(){return this.video}onAdd(A){this.map||(this.map=A,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class gi extends Ht{constructor(A,b,L,k){super(A,b,L,k),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new nt(a,this.canvas,d.RGBA,{premultiply:!0});let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),b.coordinates?Array.isArray(b.coordinates)&&b.coordinates.length===4&&!b.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(a=>typeof a!="number"))||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "coordinates"'))),b.animate&&typeof b.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${A}`,null,'optional "animate" property must be a boolean value'))),b.canvas?typeof b.canvas=="string"||b.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "canvas"'))),this.options=b,this.animate=b.animate===void 0||b.animate}getCanvas(){return this.canvas}onAdd(A){this.map=A,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const A of[this.canvas.width,this.canvas.height])if(isNaN(A)||A<=0)return!0;return!1}}const mi={},Mi=N=>{switch(N){case"geojson":return Pt;case"image":return Ht;case"raster":return ft;case"raster-dem":return wt;case"vector":return At;case"video":return ii;case"canvas":return gi}return mi[N]};function kt(N,A){const b=s.Z();return s.$(b,b,[1,1,0]),s.a0(b,b,[.5*N.width,.5*N.height,1]),s.a1(b,b,N.calculatePosMatrix(A.toUnwrapped()))}function ot(N,A,b,L,k,y){const a=function(U,H,q){if(U)for(const w of U){const T=H[w];if(T&&T.source===q&&T.type==="fill-extrusion")return!0}else for(const w in H){const T=H[w];if(T.source===q&&T.type==="fill-extrusion")return!0}return!1}(k&&k.layers,A,N.id),d=y.maxPitchScaleFactor(),_=N.tilesIn(L,d,a);_.sort(xt);const B=[];for(const U of _)B.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(A,b,N._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,k,y,d,kt(N.transform,U.tileID))});const S=function(U){const H={},q={};for(const w of U){const T=w.queryResults,R=w.wrappedTileID,j=q[R]=q[R]||{};for(const Z in T){const W=T[Z],J=j[Z]=j[Z]||{},ee=H[Z]=H[Z]||[];for(const ae of W)J[ae.featureIndex]||(J[ae.featureIndex]=!0,ee.push(ae))}}return H}(B);for(const U in S)S[U].forEach(H=>{const q=H.feature,w=N.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=w});return S}function xt(N,A){const b=N.tileID,L=A.tileID;return b.overscaledZ-L.overscaledZ||b.canonical.y-L.canonical.y||b.wrap-L.wrap||b.canonical.x-L.canonical.x}class Ri{constructor(A,b){this.timeAdded=0,this.fadeEndTime=0,this.tileID=A,this.uid=s.a2(),this.uses=0,this.tileSize=b,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(A){const b=A+this.timeAdded;b<this.fadeEndTime||(this.fadeEndTime=b)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(A){this.demTexture&&A.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(A,b,L){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",A){A.featureIndex&&(this.latestFeatureIndex=A.featureIndex,A.rawTileData?(this.latestRawTileData=A.rawTileData,this.latestFeatureIndex.rawTileData=A.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=A.collisionBoxArray,this.buckets=function(k,y){const a={};if(!y)return a;for(const d of k){const _=d.layerIds.map(B=>y.getLayer(B)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(B=>_.filter(S=>S.id===B)[0]));for(const B of _)a[B.id]=d}}return a}(A.buckets,b.style),this.hasSymbolBuckets=!1;for(const k in this.buckets){const y=this.buckets[k];if(y instanceof s.a4){if(this.hasSymbolBuckets=!0,!L)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const k in this.buckets){const y=this.buckets[k];if(y instanceof s.a4&&y.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const k in this.buckets){const y=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,b.style.getLayer(k).queryRadius(y))}A.imageAtlas&&(this.imageAtlas=A.imageAtlas),A.glyphAtlasImage&&(this.glyphAtlasImage=A.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const A in this.buckets)this.buckets[A].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(A){return this.buckets[A.id]}upload(A){for(const L in this.buckets){const k=this.buckets[L];k.uploadPending()&&k.upload(A)}const b=A.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nt(A,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nt(A,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null)}prepare(A){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(A,this.imageAtlasTexture)}queryRenderedFeatures(A,b,L,k,y,a,d,_,B,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:k,cameraQueryGeometry:y,scale:a,tileSize:this.tileSize,pixelPosMatrix:S,transform:_,params:d,queryPadding:this.queryPadding*B},A,b,L):{}}querySourceFeatures(A,b){const L=this.latestFeatureIndex;if(!L||!L.rawTileData)return;const k=L.loadVTLayers(),y=b&&b.sourceLayer?b.sourceLayer:"",a=k._geojsonTileLayer||k[y];if(!a)return;const d=s.a6(b&&b.filter),{z:_,x:B,y:S}=this.tileID.canonical,U={z:_,x:B,y:S};for(let H=0;H<a.length;H++){const q=a.feature(H);if(d.needGeometry){const R=s.a7(q,!0);if(!d.filter(new s.a8(this.tileID.overscaledZ),R,this.tileID.canonical))continue}else if(!d.filter(new s.a8(this.tileID.overscaledZ),q))continue;const w=L.getId(q,y),T=new s.a9(q,_,B,S,w);T.tile=U,A.push(T)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(A){const b=this.expirationTime;if(A.cacheControl){const L=s.aa(A.cacheControl);L["max-age"]&&(this.expirationTime=Date.now()+1e3*L["max-age"])}else A.expires&&(this.expirationTime=new Date(A.expires).getTime());if(this.expirationTime){const L=Date.now();let k=!1;if(this.expirationTime>L)k=!1;else if(b)if(this.expirationTime<b)k=!0;else{const y=this.expirationTime-b;y?this.expirationTime=L+Math.max(y,3e4):k=!0}else k=!0;k?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(A,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(A).length===0)return;const L=this.latestFeatureIndex.loadVTLayers();for(const k in this.buckets){if(!b.style.hasLayer(k))continue;const y=this.buckets[k],a=y.layers[0].sourceLayer||"_geojsonTileLayer",d=L[a],_=A[a];if(!d||!_||Object.keys(_).length===0)continue;y.update(_,d,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=b&&b.style&&b.style.getLayer(k);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(A){this.symbolFadeHoldUntil=s.h.now()+A}setDependencies(A,b){const L={};for(const k of b)L[k]=!0;this.dependencies[A]=L}hasDependency(A,b){for(const L of A){const k=this.dependencies[L];if(k){for(const y of b)if(k[y])return!0}}return!1}}class ei{constructor(A,b){this.max=A,this.onRemove=b,this.reset()}reset(){for(const A in this.data)for(const b of this.data[A])b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value);return this.data={},this.order=[],this}add(A,b,L){const k=A.wrapped().key;this.data[k]===void 0&&(this.data[k]=[]);const y={value:b,timeout:void 0};if(L!==void 0&&(y.timeout=setTimeout(()=>{this.remove(A,y)},L)),this.data[k].push(y),this.order.push(k),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(A){return A.wrapped().key in this.data}getAndRemove(A){return this.has(A)?this._getAndRemoveByKey(A.wrapped().key):null}_getAndRemoveByKey(A){const b=this.data[A].shift();return b.timeout&&clearTimeout(b.timeout),this.data[A].length===0&&delete this.data[A],this.order.splice(this.order.indexOf(A),1),b.value}getByKey(A){const b=this.data[A];return b?b[0].value:null}get(A){return this.has(A)?this.data[A.wrapped().key][0].value:null}remove(A,b){if(!this.has(A))return this;const L=A.wrapped().key,k=b===void 0?0:this.data[L].indexOf(b),y=this.data[L][k];return this.data[L].splice(k,1),y.timeout&&clearTimeout(y.timeout),this.data[L].length===0&&delete this.data[L],this.onRemove(y.value),this.order.splice(this.order.indexOf(L),1),this}setMaxSize(A){for(this.max=A;this.order.length>this.max;){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}filter(A){const b=[];for(const L in this.data)for(const k of this.data[L])A(k.value)||b.push(k);for(const L of b)this.remove(L.value.tileID,L)}}class ut{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(A,b,L){const k=String(b);if(this.stateChanges[A]=this.stateChanges[A]||{},this.stateChanges[A][k]=this.stateChanges[A][k]||{},s.e(this.stateChanges[A][k],L),this.deletedStates[A]===null){this.deletedStates[A]={};for(const y in this.state[A])y!==k&&(this.deletedStates[A][y]=null)}else if(this.deletedStates[A]&&this.deletedStates[A][k]===null){this.deletedStates[A][k]={};for(const y in this.state[A][k])L[y]||(this.deletedStates[A][k][y]=null)}else for(const y in L)this.deletedStates[A]&&this.deletedStates[A][k]&&this.deletedStates[A][k][y]===null&&delete this.deletedStates[A][k][y]}removeFeatureState(A,b,L){if(this.deletedStates[A]===null)return;const k=String(b);if(this.deletedStates[A]=this.deletedStates[A]||{},L&&b!==void 0)this.deletedStates[A][k]!==null&&(this.deletedStates[A][k]=this.deletedStates[A][k]||{},this.deletedStates[A][k][L]=null);else if(b!==void 0)if(this.stateChanges[A]&&this.stateChanges[A][k])for(L in this.deletedStates[A][k]={},this.stateChanges[A][k])this.deletedStates[A][k][L]=null;else this.deletedStates[A][k]=null;else this.deletedStates[A]=null}getState(A,b){const L=String(b),k=s.e({},(this.state[A]||{})[L],(this.stateChanges[A]||{})[L]);if(this.deletedStates[A]===null)return{};if(this.deletedStates[A]){const y=this.deletedStates[A][b];if(y===null)return{};for(const a in y)delete k[a]}return k}initializeTileState(A,b){A.setFeatureState(this.state,b)}coalesceChanges(A,b){const L={};for(const k in this.stateChanges){this.state[k]=this.state[k]||{};const y={};for(const a in this.stateChanges[k])this.state[k][a]||(this.state[k][a]={}),s.e(this.state[k][a],this.stateChanges[k][a]),y[a]=this.state[k][a];L[k]=y}for(const k in this.deletedStates){this.state[k]=this.state[k]||{};const y={};if(this.deletedStates[k]===null)for(const a in this.state[k])y[a]={},this.state[k][a]={};else for(const a in this.deletedStates[k]){if(this.deletedStates[k][a]===null)this.state[k][a]={};else for(const d of Object.keys(this.deletedStates[k][a]))delete this.state[k][a][d];y[a]=this.state[k][a]}L[k]=L[k]||{},s.e(L[k],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(L).length!==0)for(const k in A)A[k].setFeatureState(L,b)}}class jt extends s.E{constructor(A,b,L){super(),this.id=A,this.dispatcher=L,this.on("data",k=>{k.dataType==="source"&&k.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&k.dataType==="source"&&k.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((k,y,a,d)=>{const _=new(Mi(y.type))(k,y,a,d);if(_.id!==k)throw new Error(`Expected Source id to be ${k} instead of ${_.id}`);return _})(A,b,L,this),this._tiles={},this._cache=new ei(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ut,this._didEmitContent=!1,this._updated=!1}onAdd(A){this.map=A,this._maxTileCacheSize=A?A._maxTileCacheSize:null,this._maxTileCacheZoomLevels=A?A._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(A)}onRemove(A){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(A)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const A in this._tiles){const b=this._tiles[A];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const A=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,A&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(A,b){return this._source.loadTile(A,b)}_unloadTile(A){if(this._source.unloadTile)return this._source.unloadTile(A,()=>{})}_abortTile(A){this._source.abortTile&&this._source.abortTile(A,()=>{}),this._source.fire(new s.k("dataabort",{tile:A,coord:A.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(A){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const b in this._tiles){const L=this._tiles[b];L.upload(A),L.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(A=>A.tileID).sort(ni).map(A=>A.key)}getRenderableIds(A){const b=[];for(const L in this._tiles)this._isIdRenderable(L,A)&&b.push(this._tiles[L]);return A?b.sort((L,k)=>{const y=L.tileID,a=k.tileID,d=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),_=new s.P(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-a.overscaledZ||_.y-d.y||_.x-d.x}).map(L=>L.tileID.key):b.map(L=>L.tileID).sort(ni).map(L=>L.key)}hasRenderableParent(A){const b=this.findLoadedParent(A,0);return!!b&&this._isIdRenderable(b.tileID.key)}_isIdRenderable(A,b){return this._tiles[A]&&this._tiles[A].hasData()&&!this._coveredTiles[A]&&(b||!this._tiles[A].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const A in this._tiles)this._tiles[A].state!=="errored"&&this._reloadTile(A,"reloading")}}_reloadTile(A,b){const L=this._tiles[A];L&&(L.state!=="loading"&&(L.state=b),this._loadTile(L,this._tileLoaded.bind(this,L,A,b)))}_tileLoaded(A,b,L,k){if(k)return A.state="errored",void(k.status!==404?this._source.fire(new s.j(k,{tile:A})):this.update(this.transform,this.terrain));A.timeAdded=s.h.now(),L==="expired"&&(A.refreshedUponExpiration=!0),this._setTileReloadTimer(b,A),this.getSource().type==="raster-dem"&&A.dem&&this._backfillDEM(A),this._state.initializeTileState(A,this.map?this.map.painter:null),A.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:A,coord:A.tileID}))}_backfillDEM(A){const b=this.getRenderableIds();for(let k=0;k<b.length;k++){const y=b[k];if(A.neighboringTiles&&A.neighboringTiles[y]){const a=this.getTileByID(y);L(A,a),L(a,A)}}function L(k,y){k.needsHillshadePrepare=!0,k.needsTerrainPrepare=!0;let a=y.tileID.canonical.x-k.tileID.canonical.x;const d=y.tileID.canonical.y-k.tileID.canonical.y,_=Math.pow(2,k.tileID.canonical.z),B=y.tileID.key;a===0&&d===0||Math.abs(d)>1||(Math.abs(a)>1&&(Math.abs(a+_)===1?a+=_:Math.abs(a-_)===1&&(a-=_)),y.dem&&k.dem&&(k.dem.backfillBorder(y.dem,a,d),k.neighboringTiles&&k.neighboringTiles[B]&&(k.neighboringTiles[B].backfilled=!0)))}}getTile(A){return this.getTileByID(A.key)}getTileByID(A){return this._tiles[A]}_retainLoadedChildren(A,b,L,k){for(const y in this._tiles){let a=this._tiles[y];if(k[y]||!a.hasData()||a.tileID.overscaledZ<=b||a.tileID.overscaledZ>L)continue;let d=a.tileID;for(;a&&a.tileID.overscaledZ>b+1;){const B=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[B.key],a&&a.hasData()&&(d=B)}let _=d;for(;_.overscaledZ>b;)if(_=_.scaledTo(_.overscaledZ-1),A[_.key]){k[d.key]=d;break}}}findLoadedParent(A,b){if(A.key in this._loadedParentTiles){const L=this._loadedParentTiles[A.key];return L&&L.tileID.overscaledZ>=b?L:null}for(let L=A.overscaledZ-1;L>=b;L--){const k=A.scaledTo(L),y=this._getLoadedTile(k);if(y)return y}}_getLoadedTile(A){const b=this._tiles[A.key];return b&&b.hasData()?b:this._cache.getByKey(A.wrapped().key)}updateCacheSize(A){const b=Math.ceil(A.width/this._source.tileSize)+1,L=Math.ceil(A.height/this._source.tileSize)+1,k=Math.floor(b*L*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(y)}handleWrapJump(A){const b=Math.round((A-(this._prevLng===void 0?A:this._prevLng))/360);if(this._prevLng=A,b){const L={};for(const k in this._tiles){const y=this._tiles[k];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+b),L[y.tileID.key]=y}this._tiles=L;for(const k in this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(const k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}}update(A,b){if(this.transform=A,this.terrain=b,!this._sourceLoaded||this._paused)return;let L;this.updateCacheSize(A),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?L=A.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new s.O(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(L=A.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:b}),this._source.hasTile&&(L=L.filter(S=>this._source.hasTile(S)))):L=[];const k=A.coveringZoomLevel(this._source),y=Math.max(k-jt.maxOverzooming,this._source.minzoom),a=Math.max(k+jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const S={};for(const U of L)if(U.canonical.z>this._source.minzoom){const H=U.scaledTo(U.canonical.z-1);S[H.key]=H;const q=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));S[q.key]=q}L=L.concat(Object.values(S))}const d=L.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=this._updateRetainedTiles(L,k);if(di(this._source.type)){const S={},U={},H=Object.keys(_),q=s.h.now();for(const w of H){const T=_[w],R=this._tiles[w];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=q)continue;const j=this.findLoadedParent(T,y);j&&(this._addTile(j.tileID),S[j.tileID.key]=j.tileID),U[w]=T}this._retainLoadedChildren(U,k,a,_);for(const w in S)_[w]||(this._coveredTiles[w]=!0,_[w]=S[w]);if(b){const w={},T={};for(const R of L)this._tiles[R.key].hasData()?w[R.key]=R:T[R.key]=R;for(const R in T){const j=T[R].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(w[j[0].key]=_[j[0].key]=j[0],w[j[1].key]=_[j[1].key]=j[1],w[j[2].key]=_[j[2].key]=j[2],w[j[3].key]=_[j[3].key]=j[3],delete T[R])}for(const R in T){const j=this.findLoadedParent(T[R],this._source.minzoom);if(j){w[j.tileID.key]=_[j.tileID.key]=j.tileID;for(const Z in w)w[Z].isChildOf(j.tileID)&&delete w[Z]}}for(const R in this._tiles)w[R]||(this._coveredTiles[R]=!0)}}for(const S in _)this._tiles[S].clearFadeHold();const B=s.ab(this._tiles,_);for(const S of B){const U=this._tiles[S];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(S)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const A in this._tiles)this._tiles[A].holdingForFade()&&this._removeTile(A)}_updateRetainedTiles(A,b){const L={},k={},y=Math.max(b-jt.maxOverzooming,this._source.minzoom),a=Math.max(b+jt.maxUnderzooming,this._source.minzoom),d={};for(const _ of A){const B=this._addTile(_);L[_.key]=_,B.hasData()||b<this._source.maxzoom&&(d[_.key]=_)}this._retainLoadedChildren(d,b,a,L);for(const _ of A){let B=this._tiles[_.key];if(B.hasData())continue;if(b+1>this._source.maxzoom){const U=_.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){L[U.key]=U;continue}}else{const U=_.children(this._source.maxzoom);if(L[U[0].key]&&L[U[1].key]&&L[U[2].key]&&L[U[3].key])continue}let S=B.wasRequested();for(let U=_.overscaledZ-1;U>=y;--U){const H=_.scaledTo(U);if(k[H.key])break;if(k[H.key]=!0,B=this.getTile(H),!B&&S&&(B=this._addTile(H)),B){const q=B.hasData();if((S||q)&&(L[H.key]=H),S=B.wasRequested(),q)break}}}return L}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const A in this._tiles){const b=[];let L,k=this._tiles[A].tileID;for(;k.overscaledZ>0;){if(k.key in this._loadedParentTiles){L=this._loadedParentTiles[k.key];break}b.push(k.key);const y=k.scaledTo(k.overscaledZ-1);if(L=this._getLoadedTile(y),L)break;k=y}for(const y of b)this._loadedParentTiles[y]=L}}_addTile(A){let b=this._tiles[A.key];if(b)return b;b=this._cache.getAndRemove(A),b&&(this._setTileReloadTimer(A.key,b),b.tileID=A,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[A.key]&&(clearTimeout(this._cacheTimers[A.key]),delete this._cacheTimers[A.key],this._setTileReloadTimer(A.key,b)));const L=b;return b||(b=new Ri(A,this._source.tileSize*A.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,A.key,b.state))),b.uses++,this._tiles[A.key]=b,L||this._source.fire(new s.k("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b}_setTileReloadTimer(A,b){A in this._timers&&(clearTimeout(this._timers[A]),delete this._timers[A]);const L=b.getExpiryTimeout();L&&(this._timers[A]=setTimeout(()=>{this._reloadTile(A,"expired"),delete this._timers[A]},L))}_removeTile(A){const b=this._tiles[A];b&&(b.uses--,delete this._tiles[A],this._timers[A]&&(clearTimeout(this._timers[A]),delete this._timers[A]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const A in this._tiles)this._removeTile(A);this._cache.reset()}tilesIn(A,b,L){const k=[],y=this.transform;if(!y)return k;const a=L?y.getCameraQueryGeometry(A):A,d=A.map(w=>y.pointCoordinate(w,this.terrain)),_=a.map(w=>y.pointCoordinate(w,this.terrain)),B=this.getIds();let S=1/0,U=1/0,H=-1/0,q=-1/0;for(const w of _)S=Math.min(S,w.x),U=Math.min(U,w.y),H=Math.max(H,w.x),q=Math.max(q,w.y);for(let w=0;w<B.length;w++){const T=this._tiles[B[w]];if(T.holdingForFade())continue;const R=T.tileID,j=Math.pow(2,y.zoom-T.tileID.overscaledZ),Z=b*T.queryPadding*s.N/T.tileSize/j,W=[R.getTilePoint(new s.U(S,U)),R.getTilePoint(new s.U(H,q))];if(W[0].x-Z<s.N&&W[0].y-Z<s.N&&W[1].x+Z>=0&&W[1].y+Z>=0){const J=d.map(ae=>R.getTilePoint(ae)),ee=_.map(ae=>R.getTilePoint(ae));k.push({tile:T,tileID:R,queryGeometry:J,cameraQueryGeometry:ee,scale:j})}}return k}getVisibleCoordinates(A){const b=this.getRenderableIds(A).map(L=>this._tiles[L].tileID);for(const L of b)L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped());return b}hasTransition(){if(this._source.hasTransition())return!0;if(di(this._source.type)){const A=s.h.now();for(const b in this._tiles)if(this._tiles[b].fadeEndTime>=A)return!0}return!1}setFeatureState(A,b,L){this._state.updateState(A=A||"_geojsonTileLayer",b,L)}removeFeatureState(A,b,L){this._state.removeFeatureState(A=A||"_geojsonTileLayer",b,L)}getFeatureState(A,b){return this._state.getState(A=A||"_geojsonTileLayer",b)}setDependencies(A,b,L){const k=this._tiles[A];k&&k.setDependencies(b,L)}reloadTilesForDependencies(A,b){for(const L in this._tiles)this._tiles[L].hasDependency(A,b)&&this._reloadTile(L,"reloading");this._cache.filter(L=>!L.hasDependency(A,b))}}function ni(N,A){const b=Math.abs(2*N.wrap)-+(N.wrap<0),L=Math.abs(2*A.wrap)-+(A.wrap<0);return N.overscaledZ-A.overscaledZ||L-b||A.canonical.y-N.canonical.y||A.canonical.x-N.canonical.x}function di(N){return N==="raster"||N==="image"||N==="video"}jt.maxOverzooming=10,jt.maxUnderzooming=3;const li="mapboxgl_preloaded_worker_pool";class Ki{constructor(){this.active={}}acquire(A){if(!this.workers)for(this.workers=[];this.workers.length<Ki.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[A]=!0,this.workers.slice()}release(A){delete this.active[A],this.numActive()===0&&(this.workers.forEach(b=>{b.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[li]}numActive(){return Object.keys(this.active).length}}const tr=Math.floor(s.h.hardwareConcurrency/2);let Ar;function Er(){return Ar||(Ar=new Ki),Ar}Ki.workerCount=s.ac(globalThis)?Math.max(Math.min(tr,3),1):1;class Nt{constructor(A,b){this.reset(A,b)}reset(A,b){this.points=A||[],this._distances=[0];for(let L=1;L<this.points.length;L++)this._distances[L]=this._distances[L-1]+this.points[L].dist(this.points[L-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(b||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(A){if(this.points.length===1)return this.points[0];A=s.ad(A,0,1);let b=1,L=this._distances[b];const k=A*this.paddedLength+this.padding;for(;L<k&&b<this._distances.length;)L=this._distances[++b];const y=b-1,a=this._distances[y],d=L-a,_=d>0?(k-a)/d:0;return this.points[y].mult(1-_).add(this.points[b].mult(_))}}function Ji(N,A){let b=!0;return N==="always"||N!=="never"&&A!=="never"||(b=!1),b}class ci{constructor(A,b,L){const k=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(A/L),this.yCellCount=Math.ceil(b/L);for(let a=0;a<this.xCellCount*this.yCellCount;a++)k.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=A,this.height=b,this.xScale=this.xCellCount/A,this.yScale=this.yCellCount/b,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(A,b,L,k,y){this._forEachCell(b,L,k,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(A),this.bboxes.push(b),this.bboxes.push(L),this.bboxes.push(k),this.bboxes.push(y)}insertCircle(A,b,L,k){this._forEachCell(b-k,L-k,b+k,L+k,this._insertCircleCell,this.circleUid++),this.circleKeys.push(A),this.circles.push(b),this.circles.push(L),this.circles.push(k)}_insertBoxCell(A,b,L,k,y,a){this.boxCells[y].push(a)}_insertCircleCell(A,b,L,k,y,a){this.circleCells[y].push(a)}_query(A,b,L,k,y,a,d){if(L<0||A>this.width||k<0||b>this.height)return[];const _=[];if(A<=0&&b<=0&&this.width<=L&&this.height<=k){if(y)return[{key:null,x1:A,y1:b,x2:L,y2:k}];for(let B=0;B<this.boxKeys.length;B++)_.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const S=this.circles[3*B],U=this.circles[3*B+1],H=this.circles[3*B+2];_.push({key:this.circleKeys[B],x1:S-H,y1:U-H,x2:S+H,y2:U+H})}}else this._forEachCell(A,b,L,k,this._queryCell,_,{hitTest:y,overlapMode:a,seenUids:{box:{},circle:{}}},d);return _}query(A,b,L,k){return this._query(A,b,L,k,!1,null)}hitTest(A,b,L,k,y,a){return this._query(A,b,L,k,!0,y,a).length>0}hitTestCircle(A,b,L,k,y){const a=A-L,d=A+L,_=b-L,B=b+L;if(d<0||a>this.width||B<0||_>this.height)return!1;const S=[];return this._forEachCell(a,_,d,B,this._queryCellCircle,S,{hitTest:!0,overlapMode:k,circle:{x:A,y:b,radius:L},seenUids:{box:{},circle:{}}},y),S.length>0}_queryCell(A,b,L,k,y,a,d,_){const{seenUids:B,hitTest:S,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const T of H)if(!B.box[T]){B.box[T]=!0;const R=4*T,j=this.boxKeys[T];if(A<=w[R+2]&&b<=w[R+3]&&L>=w[R+0]&&k>=w[R+1]&&(!_||_(j))&&(!S||!Ji(U,j.overlapMode))&&(a.push({key:j,x1:w[R],y1:w[R+1],x2:w[R+2],y2:w[R+3]}),S))return!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const T of q)if(!B.circle[T]){B.circle[T]=!0;const R=3*T,j=this.circleKeys[T];if(this._circleAndRectCollide(w[R],w[R+1],w[R+2],A,b,L,k)&&(!_||_(j))&&(!S||!Ji(U,j.overlapMode))){const Z=w[R],W=w[R+1],J=w[R+2];if(a.push({key:j,x1:Z-J,y1:W-J,x2:Z+J,y2:W+J}),S)return!0}}}return!1}_queryCellCircle(A,b,L,k,y,a,d,_){const{circle:B,seenUids:S,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const T of H)if(!S.box[T]){S.box[T]=!0;const R=4*T,j=this.boxKeys[T];if(this._circleAndRectCollide(B.x,B.y,B.radius,w[R+0],w[R+1],w[R+2],w[R+3])&&(!_||_(j))&&!Ji(U,j.overlapMode))return a.push(!0),!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const T of q)if(!S.circle[T]){S.circle[T]=!0;const R=3*T,j=this.circleKeys[T];if(this._circlesCollide(w[R],w[R+1],w[R+2],B.x,B.y,B.radius)&&(!_||_(j))&&!Ji(U,j.overlapMode))return a.push(!0),!0}}}_forEachCell(A,b,L,k,y,a,d,_){const B=this._convertToXCellCoord(A),S=this._convertToYCellCoord(b),U=this._convertToXCellCoord(L),H=this._convertToYCellCoord(k);for(let q=B;q<=U;q++)for(let w=S;w<=H;w++)if(y.call(this,A,b,L,k,this.xCellCount*w+q,a,d,_))return}_convertToXCellCoord(A){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(A*this.xScale)))}_convertToYCellCoord(A){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(A*this.yScale)))}_circlesCollide(A,b,L,k,y,a){const d=k-A,_=y-b,B=L+a;return B*B>d*d+_*_}_circleAndRectCollide(A,b,L,k,y,a,d){const _=(a-k)/2,B=Math.abs(A-(k+_));if(B>_+L)return!1;const S=(d-y)/2,U=Math.abs(b-(y+S));if(U>S+L)return!1;if(B<=_||U<=S)return!0;const H=B-_,q=U-S;return H*H+q*q<=L*L}}function $t(N,A,b,L,k){const y=s.Z();return A?(s.a0(y,y,[1/k,1/k,1]),b||s.ae(y,y,L.angle)):s.a1(y,L.labelPlaneMatrix,N),y}function Zi(N,A,b,L,k){if(A){const y=s.af(N);return s.a0(y,y,[k,k,1]),b||s.ae(y,y,-L.angle),y}return L.glCoordMatrix}function Qt(N,A,b){let L;b?(L=[N.x,N.y,b(N.x,N.y),1],s.ag(L,L,A)):(L=[N.x,N.y,0,1],_e(L,L,A));const k=L[3];return{point:new s.P(L[0]/k,L[1]/k),signedDistanceFromCamera:k}}function Bi(N,A){return .5+N/A*.5}function Ii(N,A){const b=N[0]/N[3],L=N[1]/N[3];return b>=-A[0]&&b<=A[0]&&L>=-A[1]&&L<=A[1]}function Gt(N,A,b,L,k,y,a,d,_,B){const S=L?N.textSizeData:N.iconSizeData,U=s.ah(S,b.transform.zoom),H=[256/b.width*2+1,256/b.height*2+1],q=L?N.text.dynamicLayoutVertexArray:N.icon.dynamicLayoutVertexArray;q.clear();const w=N.lineVertexArray,T=L?N.text.placedSymbolArray:N.icon.placedSymbolArray,R=b.transform.width/b.transform.height;let j=!1;for(let Z=0;Z<T.length;Z++){const W=T.get(Z);if(W.hidden||W.writingMode===s.ai.vertical&&!j){ge(W.numGlyphs,q);continue}let J;if(j=!1,B?(J=[W.anchorX,W.anchorY,B(W.anchorX,W.anchorY),1],s.ag(J,J,A)):(J=[W.anchorX,W.anchorY,0,1],_e(J,J,A)),!Ii(J,H)){ge(W.numGlyphs,q);continue}const ee=Bi(b.transform.cameraToCenterDistance,J[3]),ae=s.aj(S,U,W),fe=a?ae/ee:ae*ee,pe=new s.P(W.anchorX,W.anchorY),xe=Qt(pe,k,B).point,Pe={projections:{},offsets:{}},Le=mr(W,fe,!1,d,A,k,y,N.glyphOffsetArray,w,q,xe,pe,Pe,R,_,B);j=Le.useVertical,(Le.notEnoughRoom||j||Le.needsFlipping&&mr(W,fe,!0,d,A,k,y,N.glyphOffsetArray,w,q,xe,pe,Pe,R,_,B).notEnoughRoom)&&ge(W.numGlyphs,q)}L?N.text.dynamicLayoutVertexBuffer.updateData(q):N.icon.dynamicLayoutVertexBuffer.updateData(q)}function vi(N,A,b,L,k,y,a,d,_,B,S,U,H){const q=d.glyphStartIndex+d.numGlyphs,w=d.lineStartIndex,T=d.lineStartIndex+d.lineLength,R=A.getoffsetX(d.glyphStartIndex),j=A.getoffsetX(q-1),Z=Y(N*R,b,L,k,y,a,d.segment,w,T,_,B,S,U,H);if(!Z)return null;const W=Y(N*j,b,L,k,y,a,d.segment,w,T,_,B,S,U,H);return W?{first:Z,last:W}:null}function Jt(N,A,b,L){return N===s.ai.horizontal&&Math.abs(b.y-A.y)>Math.abs(b.x-A.x)*L?{useVertical:!0}:(N===s.ai.vertical?A.y<b.y:A.x>b.x)?{needsFlipping:!0}:null}function mr(N,A,b,L,k,y,a,d,_,B,S,U,H,q,w,T){const R=A/24,j=N.lineOffsetX*R,Z=N.lineOffsetY*R;let W;if(N.numGlyphs>1){const J=N.glyphStartIndex+N.numGlyphs,ee=N.lineStartIndex,ae=N.lineStartIndex+N.lineLength,fe=vi(R,d,j,Z,b,S,U,N,_,y,H,w,T);if(!fe)return{notEnoughRoom:!0};const pe=Qt(fe.first.point,a,T).point,xe=Qt(fe.last.point,a,T).point;if(L&&!b){const Pe=Jt(N.writingMode,pe,xe,q);if(Pe)return Pe}W=[fe.first];for(let Pe=N.glyphStartIndex+1;Pe<J-1;Pe++)W.push(Y(R*d.getoffsetX(Pe),j,Z,b,S,U,N.segment,ee,ae,_,y,H,w,T));W.push(fe.last)}else{if(L&&!b){const ee=Qt(U,k,T).point,ae=N.lineStartIndex+N.segment+1,fe=new s.P(_.getx(ae),_.gety(ae)),pe=Qt(fe,k,T),xe=pe.signedDistanceFromCamera>0?pe.point:Sr(U,fe,ee,1,k,T),Pe=Jt(N.writingMode,ee,xe,q);if(Pe)return Pe}const J=Y(R*d.getoffsetX(N.glyphStartIndex),j,Z,b,S,U,N.segment,N.lineStartIndex,N.lineStartIndex+N.lineLength,_,y,H,w,T);if(!J)return{notEnoughRoom:!0};W=[J]}for(const J of W)s.ak(B,J.point,J.angle);return{}}function Sr(N,A,b,L,k,y){const a=Qt(N.add(N.sub(A)._unit()),k,y).point,d=b.sub(a);return b.add(d._mult(L/d.mag()))}function ze(N,A){const{projectionCache:b,lineVertexArray:L,labelPlaneMatrix:k,tileAnchorPoint:y,distanceFromAnchor:a,getElevation:d,previousVertex:_,direction:B,absOffsetX:S}=A;if(b.projections[N])return b.projections[N];const U=new s.P(L.getx(N),L.gety(N)),H=Qt(U,k,d);if(H.signedDistanceFromCamera>0)return b.projections[N]=H.point,H.point;const q=N-B;return Sr(a===0?y:new s.P(L.getx(q),L.gety(q)),U,_,S-a+1,k,d)}function we(N,A,b){return N._unit()._perp()._mult(A*b)}function oe(N,A,b,L,k,y,a,d){const{projectionCache:_,direction:B}=d;if(_.offsets[N])return _.offsets[N];const S=b.add(A);if(N+B<L||N+B>=k)return _.offsets[N]=S,S;const U=ze(N+B,d),H=we(U.sub(b),a,B),q=b.add(H),w=U.add(H);return _.offsets[N]=s.al(y,S,q,w)||S,_.offsets[N]}function Y(N,A,b,L,k,y,a,d,_,B,S,U,H,q){const w=L?N-A:N+A;let T=w>0?1:-1,R=0;L&&(T*=-1,R=Math.PI),T<0&&(R+=Math.PI);let j,Z,W=T>0?d+a:d+a+1,J=k,ee=k,ae=0,fe=0;const pe=Math.abs(w),xe=[];let Pe;for(;ae+fe<=pe;){if(W+=T,W<d||W>=_)return null;ae+=fe,ee=J,Z=j;const Ke={projectionCache:U,lineVertexArray:B,labelPlaneMatrix:S,tileAnchorPoint:y,distanceFromAnchor:ae,getElevation:q,previousVertex:ee,direction:T,absOffsetX:pe};if(J=ze(W,Ke),b===0)xe.push(ee),Pe=J.sub(ee);else{let Re;const Qe=J.sub(ee);Re=Qe.mag()===0?we(ze(W+T,Ke).sub(J),b,T):we(Qe,b,T),Z||(Z=ee.add(Re)),j=oe(W,Re,J,d,_,Z,b,Ke),xe.push(Z),Pe=j.sub(Z)}fe=Pe.mag()}const Le=Pe._mult((pe-ae)/fe)._add(Z||ee),rt=R+Math.atan2(J.y-ee.y,J.x-ee.x);return xe.push(Le),{point:Le,angle:H?rt:0,path:xe}}const le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(N,A){for(let b=0;b<N;b++){const L=A.length;A.resize(L+4),A.float32.set(le,3*L)}}function _e(N,A,b){const L=A[0],k=A[1];return N[0]=b[0]*L+b[4]*k+b[12],N[1]=b[1]*L+b[5]*k+b[13],N[3]=b[3]*L+b[7]*k+b[15],N}const Ce=100;class ve{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ci(A.width+200,A.height+200,25),L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ci(A.width+200,A.height+200,25);this.transform=A,this.grid=b,this.ignoredGrid=L,this.pitchfactor=Math.cos(A._pitch)*A.cameraToCenterDistance,this.screenRightBoundary=A.width+Ce,this.screenBottomBoundary=A.height+Ce,this.gridRightBoundary=A.width+200,this.gridBottomBoundary=A.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(A,b,L,k,y,a){const d=this.projectAndGetPerspectiveRatio(k,A.anchorPointX,A.anchorPointY,a),_=L*d.perspectiveRatio,B=A.x1*_+d.point.x,S=A.y1*_+d.point.y,U=A.x2*_+d.point.x,H=A.y2*_+d.point.y;return!this.isInsideGrid(B,S,U,H)||b!=="always"&&this.grid.hitTest(B,S,U,H,b,y)||d.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[B,S,U,H],offscreen:this.isOffscreen(B,S,U,H)}}placeCollisionCircles(A,b,L,k,y,a,d,_,B,S,U,H,q,w){const T=[],R=new s.P(b.anchorX,b.anchorY),j=Qt(R,a,w),Z=Bi(this.transform.cameraToCenterDistance,j.signedDistanceFromCamera),W=(S?y/Z:y*Z)/s.ap,J=Qt(R,d,w).point,ee=vi(W,k,b.lineOffsetX*W,b.lineOffsetY*W,!1,J,R,b,L,d,{projections:{},offsets:{}},!1,w);let ae=!1,fe=!1,pe=!0;if(ee){const xe=.5*H*Z+q,Pe=new s.P(-100,-100),Le=new s.P(this.screenRightBoundary,this.screenBottomBoundary),rt=new Nt,Ke=ee.first,Re=ee.last;let Qe=[];for(let ht=Ke.path.length-1;ht>=1;ht--)Qe.push(Ke.path[ht]);for(let ht=1;ht<Re.path.length;ht++)Qe.push(Re.path[ht]);const pt=2.5*xe;if(_){const ht=Qe.map(Rt=>Qt(Rt,_,w));Qe=ht.some(Rt=>Rt.signedDistanceFromCamera<=0)?[]:ht.map(Rt=>Rt.point)}let bt=[];if(Qe.length>0){const ht=Qe[0].clone(),Rt=Qe[0].clone();for(let Dt=1;Dt<Qe.length;Dt++)ht.x=Math.min(ht.x,Qe[Dt].x),ht.y=Math.min(ht.y,Qe[Dt].y),Rt.x=Math.max(Rt.x,Qe[Dt].x),Rt.y=Math.max(Rt.y,Qe[Dt].y);bt=ht.x>=Pe.x&&Rt.x<=Le.x&&ht.y>=Pe.y&&Rt.y<=Le.y?[Qe]:Rt.x<Pe.x||ht.x>Le.x||Rt.y<Pe.y||ht.y>Le.y?[]:s.am([Qe],Pe.x,Pe.y,Le.x,Le.y)}for(const ht of bt){rt.reset(ht,.25*xe);let Rt=0;Rt=rt.length<=.5*xe?1:Math.ceil(rt.paddedLength/pt)+1;for(let Dt=0;Dt<Rt;Dt++){const hi=Dt/Math.max(Rt-1,1),Vt=rt.lerp(hi),_i=Vt.x+Ce,Si=Vt.y+Ce;T.push(_i,Si,xe,0);const Yi=_i-xe,Ti=Si-xe,yr=_i+xe,fr=Si+xe;if(pe=pe&&this.isOffscreen(Yi,Ti,yr,fr),fe=fe||this.isInsideGrid(Yi,Ti,yr,fr),A!=="always"&&this.grid.hitTestCircle(_i,Si,xe,A,U)&&(ae=!0,!B))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!B&&ae||!fe||Z<this.perspectiveRatioCutoff?[]:T,offscreen:pe,collisionDetected:ae}}queryRenderedSymbols(A){if(A.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const b=[];let L=1/0,k=1/0,y=-1/0,a=-1/0;for(const S of A){const U=new s.P(S.x+Ce,S.y+Ce);L=Math.min(L,U.x),k=Math.min(k,U.y),y=Math.max(y,U.x),a=Math.max(a,U.y),b.push(U)}const d=this.grid.query(L,k,y,a).concat(this.ignoredGrid.query(L,k,y,a)),_={},B={};for(const S of d){const U=S.key;if(_[U.bucketInstanceId]===void 0&&(_[U.bucketInstanceId]={}),_[U.bucketInstanceId][U.featureIndex])continue;const H=[new s.P(S.x1,S.y1),new s.P(S.x2,S.y1),new s.P(S.x2,S.y2),new s.P(S.x1,S.y2)];s.an(b,H)&&(_[U.bucketInstanceId][U.featureIndex]=!0,B[U.bucketInstanceId]===void 0&&(B[U.bucketInstanceId]=[]),B[U.bucketInstanceId].push(U.featureIndex))}return B}insertCollisionBox(A,b,L,k,y,a){(L?this.ignoredGrid:this.grid).insert({bucketInstanceId:k,featureIndex:y,collisionGroupID:a,overlapMode:b},A[0],A[1],A[2],A[3])}insertCollisionCircles(A,b,L,k,y,a){const d=L?this.ignoredGrid:this.grid,_={bucketInstanceId:k,featureIndex:y,collisionGroupID:a,overlapMode:b};for(let B=0;B<A.length;B+=4)d.insertCircle(_,A[B],A[B+1],A[B+2])}projectAndGetPerspectiveRatio(A,b,L,k){let y;return k?(y=[b,L,k(b,L),1],s.ag(y,y,A)):(y=[b,L,0,1],_e(y,y,A)),{point:new s.P((y[0]/y[3]+1)/2*this.transform.width+Ce,(-y[1]/y[3]+1)/2*this.transform.height+Ce),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(A,b,L,k){return L<Ce||A>=this.screenRightBoundary||k<Ce||b>this.screenBottomBoundary}isInsideGrid(A,b,L,k){return L>=0&&A<this.gridRightBoundary&&k>=0&&b<this.gridBottomBoundary}getViewportMatrix(){const A=s.ao([]);return s.$(A,A,[-100,-100,0]),A}}function Me(N,A,b){return A*(s.N/(N.tileSize*Math.pow(2,b-N.tileID.overscaledZ)))}class Oe{constructor(A,b,L,k){this.opacity=A?Math.max(0,Math.min(1,A.opacity+(A.placed?b:-b))):k&&L?1:0,this.placed=L}isHidden(){return this.opacity===0&&!this.placed}}class Ve{constructor(A,b,L,k,y){this.text=new Oe(A?A.text:null,b,L,y),this.icon=new Oe(A?A.icon:null,b,k,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class it{constructor(A,b,L){this.text=A,this.icon=b,this.skipFade=L}}class yt{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Bt{constructor(A,b,L,k,y){this.bucketInstanceId=A,this.featureIndex=b,this.sourceLayerIndex=L,this.bucketIndex=k,this.tileID=y}}class Yt{constructor(A){this.crossSourceCollisions=A,this.maxGroupID=0,this.collisionGroups={}}get(A){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[A]){const b=++this.maxGroupID;this.collisionGroups[A]={ID:b,predicate:L=>L.collisionGroupID===b}}return this.collisionGroups[A]}}function qt(N,A,b,L,k){const{horizontalAlign:y,verticalAlign:a}=s.au(N);return new s.P(-(y-.5)*A+L[0]*k,-(a-.5)*b+L[1]*k)}function Kt(N,A,b,L,k,y){const{x1:a,x2:d,y1:_,y2:B,anchorPointX:S,anchorPointY:U}=N,H=new s.P(A,b);return L&&H._rotate(k?y:-y),{x1:a+H.x,y1:_+H.y,x2:d+H.x,y2:B+H.y,anchorPointX:S,anchorPointY:U}}class si{constructor(A,b,L,k,y){this.transform=A.clone(),this.terrain=b,this.collisionIndex=new ve(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=L,this.retainedQueryData={},this.collisionGroups=new Yt(k),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(A,b,L,k){const y=L.getBucket(b),a=L.latestFeatureIndex;if(!y||!a||b.id!==y.layerIds[0])return;const d=L.collisionBoxArray,_=y.layers[0].layout,B=Math.pow(2,this.transform.zoom-L.tileID.overscaledZ),S=L.tileSize/s.N,U=this.transform.calculatePosMatrix(L.tileID.toUnwrapped()),H=_.get("text-pitch-alignment")==="map",q=_.get("text-rotation-alignment")==="map",w=Me(L,1,this.transform.zoom),T=$t(U,H,q,this.transform,w);let R=null;if(H){const Z=Zi(U,H,q,this.transform,w);R=s.a1([],this.transform.labelPlaneMatrix,Z)}this.retainedQueryData[y.bucketInstanceId]=new Bt(y.bucketInstanceId,a,y.sourceLayerIndex,y.index,L.tileID);const j={bucket:y,layout:_,posMatrix:U,textLabelPlaneMatrix:T,labelToScreenMatrix:R,scale:B,textPixelRatio:S,holdingForFade:L.holdingForFade(),collisionBoxArray:d,partiallyEvaluatedTextSize:s.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(k)for(const Z of y.sortKeyRanges){const{sortKey:W,symbolInstanceStart:J,symbolInstanceEnd:ee}=Z;A.push({sortKey:W,symbolInstanceStart:J,symbolInstanceEnd:ee,parameters:j})}else A.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:j})}attemptAnchorPlacement(A,b,L,k,y,a,d,_,B,S,U,H,q,w,T,R){const j=s.aq[A.textAnchor],Z=[A.textOffset0,A.textOffset1],W=qt(j,L,k,Z,y),J=this.collisionIndex.placeCollisionBox(Kt(b,W.x,W.y,a,d,this.transform.angle),U,_,B,S.predicate,R);if((!T||this.collisionIndex.placeCollisionBox(Kt(T,W.x,W.y,a,d,this.transform.angle),U,_,B,S.predicate,R).box.length!==0)&&J.box.length>0){let ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(ee=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Z,width:L,height:k,anchor:j,textBoxScale:y,prevAnchor:ee},this.markUsedJustification(q,j,H,w),q.allowVerticalPlacement&&(this.markUsedOrientation(q,w,H),this.placedOrientations[H.crossTileID]=w),{shift:W,placedGlyphBoxes:J}}}placeLayerBucketPart(A,b,L){const{bucket:k,layout:y,posMatrix:a,textLabelPlaneMatrix:d,labelToScreenMatrix:_,textPixelRatio:B,holdingForFade:S,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:q}=A.parameters,w=y.get("text-optional"),T=y.get("icon-optional"),R=s.ar(y,"text-overlap","text-allow-overlap"),j=R==="always",Z=s.ar(y,"icon-overlap","icon-allow-overlap"),W=Z==="always",J=y.get("text-rotation-alignment")==="map",ee=y.get("text-pitch-alignment")==="map",ae=y.get("icon-text-fit")!=="none",fe=y.get("symbol-z-order")==="viewport-y",pe=j&&(W||!k.hasIconData()||T),xe=W&&(j||!k.hasTextData()||w);!k.collisionArrays&&U&&k.deserializeCollisionBoxes(U);const Pe=this.retainedQueryData[k.bucketInstanceId].tileID,Le=this.terrain?(Ke,Re)=>this.terrain.getElevation(Pe,Ke,Re):null,rt=(Ke,Re)=>{var Qe,pt;if(b[Ke.crossTileID])return;if(S)return void(this.placements[Ke.crossTileID]=new it(!1,!1,!1));let bt=!1,ht=!1,Rt=!0,Dt=null,hi={box:null,offscreen:null},Vt={box:null,offscreen:null},_i=null,Si=null,Yi=null,Ti=0,yr=0,fr=0;Re.textFeatureIndex?Ti=Re.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(Ti=Ke.featureIndex),Re.verticalTextFeatureIndex&&(yr=Re.verticalTextFeatureIndex);const ji=Re.textBox;if(ji){const Mr=Nr=>{let pr=s.ai.horizontal;if(k.allowVerticalPlacement&&!Nr&&this.prevPlacement){const _r=this.prevPlacement.placedOrientations[Ke.crossTileID];_r&&(this.placedOrientations[Ke.crossTileID]=_r,pr=_r,this.markUsedOrientation(k,pr,Ke))}return pr},Kr=(Nr,pr)=>{if(k.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const _r of k.writingModes)if(_r===s.ai.vertical?(hi=pr(),Vt=hi):hi=Nr(),hi&&hi.box&&hi.box.length)break}else hi=Nr()},Cr=Ke.textAnchorOffsetStartIndex,es=Ke.textAnchorOffsetEndIndex;if(es===Cr){const Nr=(pr,_r)=>{const or=this.collisionIndex.placeCollisionBox(pr,R,B,a,q.predicate,Le);return or&&or.box&&or.box.length&&(this.markUsedOrientation(k,_r,Ke),this.placedOrientations[Ke.crossTileID]=_r),or};Kr(()=>Nr(ji,s.ai.horizontal),()=>{const pr=Re.verticalTextBox;return k.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&pr?Nr(pr,s.ai.vertical):{box:null,offscreen:null}}),Mr(hi&&hi.box&&hi.box.length)}else{let Nr=s.aq[(pt=(Qe=this.prevPlacement)===null||Qe===void 0?void 0:Qe.variableOffsets[Ke.crossTileID])===null||pt===void 0?void 0:pt.anchor];const pr=(or,ln,qr)=>{const Wr=or.x2-or.x1,Mn=or.y2-or.y1,$n=Ke.textBoxScale,fl=ae&&Z==="never"?ln:null;let $r={box:[],offscreen:!1},_n=R==="never"?1:2,ea="never";Nr&&_n++;for(let ks=0;ks<_n;ks++){for(let Ks=Cr;Ks<es;Ks++){const Oo=k.textAnchorOffsets.get(Ks);if(Nr&&Oo.textAnchor!==Nr)continue;const so=this.attemptAnchorPlacement(Oo,or,Wr,Mn,$n,J,ee,B,a,q,ea,Ke,k,qr,fl,Le);if(so&&($r=so.placedGlyphBoxes,$r&&$r.box&&$r.box.length))return bt=!0,Dt=so.shift,$r}Nr?Nr=null:ea=R}return $r};Kr(()=>pr(ji,Re.iconBox,s.ai.horizontal),()=>{const or=Re.verticalTextBox;return k.allowVerticalPlacement&&!(hi&&hi.box&&hi.box.length)&&Ke.numVerticalGlyphVertices>0&&or?pr(or,Re.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),hi&&(bt=hi.box,Rt=hi.offscreen);const _r=Mr(hi&&hi.box);if(!bt&&this.prevPlacement){const or=this.prevPlacement.variableOffsets[Ke.crossTileID];or&&(this.variableOffsets[Ke.crossTileID]=or,this.markUsedJustification(k,or.anchor,Ke,_r))}}}if(_i=hi,bt=_i&&_i.box&&_i.box.length>0,Rt=_i&&_i.offscreen,Ke.useRuntimeCollisionCircles){const Mr=k.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),Kr=s.aj(k.textSizeData,H,Mr),Cr=y.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(R,Mr,k.lineVertexArray,k.glyphOffsetArray,Kr,a,d,_,L,ee,q.predicate,Ke.collisionCircleDiameter,Cr,Le),Si.circles.length&&Si.collisionDetected&&!L&&s.w("Collisions detected, but collision boxes are not shown"),bt=j||Si.circles.length>0&&!Si.collisionDetected,Rt=Rt&&Si.offscreen}if(Re.iconFeatureIndex&&(fr=Re.iconFeatureIndex),Re.iconBox){const Mr=Kr=>{const Cr=ae&&Dt?Kt(Kr,Dt.x,Dt.y,J,ee,this.transform.angle):Kr;return this.collisionIndex.placeCollisionBox(Cr,Z,B,a,q.predicate,Le)};Vt&&Vt.box&&Vt.box.length&&Re.verticalIconBox?(Yi=Mr(Re.verticalIconBox),ht=Yi.box.length>0):(Yi=Mr(Re.iconBox),ht=Yi.box.length>0),Rt=Rt&&Yi.offscreen}const Ur=w||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,rn=T||Ke.numIconVertices===0;if(Ur||rn?rn?Ur||(ht=ht&&bt):bt=ht&&bt:ht=bt=ht&&bt,bt&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,R,y.get("text-ignore-placement"),k.bucketInstanceId,Vt&&Vt.box&&yr?yr:Ti,q.ID),ht&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,Z,y.get("icon-ignore-placement"),k.bucketInstanceId,fr,q.ID),Si&&(bt&&this.collisionIndex.insertCollisionCircles(Si.circles,R,y.get("text-ignore-placement"),k.bucketInstanceId,Ti,q.ID),L)){const Mr=k.bucketInstanceId;let Kr=this.collisionCircleArrays[Mr];Kr===void 0&&(Kr=this.collisionCircleArrays[Mr]=new yt);for(let Cr=0;Cr<Si.circles.length;Cr+=4)Kr.circles.push(Si.circles[Cr+0]),Kr.circles.push(Si.circles[Cr+1]),Kr.circles.push(Si.circles[Cr+2]),Kr.circles.push(Si.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(k.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new it(bt||pe,ht||xe,Rt||k.justReloaded),b[Ke.crossTileID]=!0};if(fe){if(A.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=k.getSortedSymbolIndexes(this.transform.angle);for(let Re=Ke.length-1;Re>=0;--Re){const Qe=Ke[Re];rt(k.symbolInstances.get(Qe),k.collisionArrays[Qe])}}else for(let Ke=A.symbolInstanceStart;Ke<A.symbolInstanceEnd;Ke++)rt(k.symbolInstances.get(Ke),k.collisionArrays[Ke]);if(L&&k.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[k.bucketInstanceId];s.as(Ke.invProjMatrix,a),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(A,b,L,k){let y;y=k===s.ai.vertical?L.verticalPlacedTextSymbolIndex:{left:L.leftJustifiedTextSymbolIndex,center:L.centerJustifiedTextSymbolIndex,right:L.rightJustifiedTextSymbolIndex}[s.at(b)];const a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex,L.verticalPlacedTextSymbolIndex];for(const d of a)d>=0&&(A.text.placedSymbolArray.get(d).crossTileID=y>=0&&d!==y?0:L.crossTileID)}markUsedOrientation(A,b,L){const k=b===s.ai.horizontal||b===s.ai.horizontalOnly?b:0,y=b===s.ai.vertical?b:0,a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex];for(const d of a)A.text.placedSymbolArray.get(d).placedOrientation=k;L.verticalPlacedTextSymbolIndex&&(A.text.placedSymbolArray.get(L.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(A){this.commitTime=A,this.zoomAtLastRecencyCheck=this.transform.zoom;const b=this.prevPlacement;let L=!1;this.prevZoomAdjustment=b?b.zoomAdjustment(this.transform.zoom):0;const k=b?b.symbolFadeChange(A):1,y=b?b.opacities:{},a=b?b.variableOffsets:{},d=b?b.placedOrientations:{};for(const _ in this.placements){const B=this.placements[_],S=y[_];S?(this.opacities[_]=new Ve(S,k,B.text,B.icon),L=L||B.text!==S.text.placed||B.icon!==S.icon.placed):(this.opacities[_]=new Ve(null,k,B.text,B.icon,B.skipFade),L=L||B.text||B.icon)}for(const _ in y){const B=y[_];if(!this.opacities[_]){const S=new Ve(B,k,!1,!1);S.isHidden()||(this.opacities[_]=S,L=L||B.text.placed||B.icon.placed)}}for(const _ in a)this.variableOffsets[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.variableOffsets[_]=a[_]);for(const _ in d)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=d[_]);if(b&&b.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");L?this.lastPlacementChangeTime=A:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=b?b.lastPlacementChangeTime:A)}updateLayerOpacities(A,b){const L={};for(const k of b){const y=k.getBucket(A);y&&k.latestFeatureIndex&&A.id===y.layerIds[0]&&this.updateBucketOpacities(y,L,k.collisionBoxArray)}}updateBucketOpacities(A,b,L){A.hasTextData()&&(A.text.opacityVertexArray.clear(),A.text.hasVisibleVertices=!1),A.hasIconData()&&(A.icon.opacityVertexArray.clear(),A.icon.hasVisibleVertices=!1),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexArray.clear(),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexArray.clear();const k=A.layers[0],y=k.layout,a=new Ve(null,0,!1,!1,!0),d=y.get("text-allow-overlap"),_=y.get("icon-allow-overlap"),B=k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"),S=y.get("text-rotation-alignment")==="map",U=y.get("text-pitch-alignment")==="map",H=y.get("icon-text-fit")!=="none",q=new Ve(null,0,d&&(_||!A.hasIconData()||y.get("icon-optional")),_&&(d||!A.hasTextData()||y.get("text-optional")),!0);!A.collisionArrays&&L&&(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData())&&A.deserializeCollisionBoxes(L);const w=(T,R,j)=>{for(let Z=0;Z<R/4;Z++)T.opacityVertexArray.emplaceBack(j);T.hasVisibleVertices=T.hasVisibleVertices||j!==sn};for(let T=0;T<A.symbolInstances.length;T++){const R=A.symbolInstances.get(T),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:Z,crossTileID:W}=R;let J=this.opacities[W];b[W]?J=a:J||(J=q,this.opacities[W]=J),b[W]=!0;const ee=R.numIconVertices>0,ae=this.placedOrientations[R.crossTileID],fe=ae===s.ai.vertical,pe=ae===s.ai.horizontal||ae===s.ai.horizontalOnly;if(j>0||Z>0){const xe=hr(J.text);w(A.text,j,fe?sn:xe),w(A.text,Z,pe?sn:xe);const Pe=J.text.isHidden();[R.rightJustifiedTextSymbolIndex,R.centerJustifiedTextSymbolIndex,R.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(A.text.placedSymbolArray.get(Ke).hidden=Pe||fe?1:0)}),R.verticalPlacedTextSymbolIndex>=0&&(A.text.placedSymbolArray.get(R.verticalPlacedTextSymbolIndex).hidden=Pe||pe?1:0);const Le=this.variableOffsets[R.crossTileID];Le&&this.markUsedJustification(A,Le.anchor,R,ae);const rt=this.placedOrientations[R.crossTileID];rt&&(this.markUsedJustification(A,"left",R,rt),this.markUsedOrientation(A,rt,R))}if(ee){const xe=hr(J.icon),Pe=!(H&&R.verticalPlacedIconSymbolIndex&&fe);R.placedIconSymbolIndex>=0&&(w(A.icon,R.numIconVertices,Pe?xe:sn),A.icon.placedSymbolArray.get(R.placedIconSymbolIndex).hidden=J.icon.isHidden()),R.verticalPlacedIconSymbolIndex>=0&&(w(A.icon,R.numVerticalIconVertices,Pe?sn:xe),A.icon.placedSymbolArray.get(R.verticalPlacedIconSymbolIndex).hidden=J.icon.isHidden())}if(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData()){const xe=A.collisionArrays[T];if(xe){let Pe=new s.P(0,0);if(xe.textBox||xe.verticalTextBox){let rt=!0;if(B){const Ke=this.variableOffsets[W];Ke?(Pe=qt(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),S&&Pe._rotate(U?this.transform.angle:-this.transform.angle)):rt=!1}xe.textBox&&Ci(A.textCollisionBox.collisionVertexArray,J.text.placed,!rt||fe,Pe.x,Pe.y),xe.verticalTextBox&&Ci(A.textCollisionBox.collisionVertexArray,J.text.placed,!rt||pe,Pe.x,Pe.y)}const Le=!!(!pe&&xe.verticalIconBox);xe.iconBox&&Ci(A.iconCollisionBox.collisionVertexArray,J.icon.placed,Le,H?Pe.x:0,H?Pe.y:0),xe.verticalIconBox&&Ci(A.iconCollisionBox.collisionVertexArray,J.icon.placed,!Le,H?Pe.x:0,H?Pe.y:0)}}}if(A.sortFeatures(this.transform.angle),this.retainedQueryData[A.bucketInstanceId]&&(this.retainedQueryData[A.bucketInstanceId].featureSortOrder=A.featureSortOrder),A.hasTextData()&&A.text.opacityVertexBuffer&&A.text.opacityVertexBuffer.updateData(A.text.opacityVertexArray),A.hasIconData()&&A.icon.opacityVertexBuffer&&A.icon.opacityVertexBuffer.updateData(A.icon.opacityVertexArray),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexBuffer&&A.iconCollisionBox.collisionVertexBuffer.updateData(A.iconCollisionBox.collisionVertexArray),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexBuffer&&A.textCollisionBox.collisionVertexBuffer.updateData(A.textCollisionBox.collisionVertexArray),A.text.opacityVertexArray.length!==A.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${A.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${A.text.layoutVertexArray.length}) / 4`);if(A.icon.opacityVertexArray.length!==A.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${A.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${A.icon.layoutVertexArray.length}) / 4`);if(A.bucketInstanceId in this.collisionCircleArrays){const T=this.collisionCircleArrays[A.bucketInstanceId];A.placementInvProjMatrix=T.invProjMatrix,A.placementViewportMatrix=T.viewportMatrix,A.collisionCircleArray=T.circles,delete this.collisionCircleArrays[A.bucketInstanceId]}}symbolFadeChange(A){return this.fadeDuration===0?1:(A-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(A){return Math.max(0,(this.transform.zoom-A)/1.5)}hasTransitions(A){return this.stale||A-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(A,b){const L=this.zoomAtLastRecencyCheck===b?1-this.zoomAdjustment(b):1;return this.zoomAtLastRecencyCheck=b,this.commitTime+this.fadeDuration*L>A}setStale(){this.stale=!0}}function Ci(N,A,b,L,k){N.emplaceBack(A?1:0,b?1:0,L||0,k||0),N.emplaceBack(A?1:0,b?1:0,L||0,k||0),N.emplaceBack(A?1:0,b?1:0,L||0,k||0),N.emplaceBack(A?1:0,b?1:0,L||0,k||0)}const Hi=Math.pow(2,25),wi=Math.pow(2,24),Ui=Math.pow(2,17),st=Math.pow(2,16),ti=Math.pow(2,9),zt=Math.pow(2,8),zi=Math.pow(2,1);function hr(N){if(N.opacity===0&&!N.placed)return 0;if(N.opacity===1&&N.placed)return 4294967295;const A=N.placed?1:0,b=Math.floor(127*N.opacity);return b*Hi+A*wi+b*Ui+A*st+b*ti+A*zt+b*zi+A}const sn=0;class bn{constructor(A){this._sortAcrossTiles=A.layout.get("symbol-z-order")!=="viewport-y"&&!A.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(A,b,L,k,y){const a=this._bucketParts;for(;this._currentTileIndex<A.length;)if(b.getBucketParts(a,k,A[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((d,_)=>d.sortKey-_.sortKey));this._currentPartIndex<a.length;)if(b.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,L),this._currentPartIndex++,y())return!0;return!1}}class ur{constructor(A,b,L,k,y,a,d,_){this.placement=new si(A,b,a,d,_),this._currentPlacementIndex=L.length-1,this._forceFullPlacement=k,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(A,b,L){const k=s.h.now(),y=()=>!this._forceFullPlacement&&s.h.now()-k>2;for(;this._currentPlacementIndex>=0;){const a=b[A[this._currentPlacementIndex]],d=this.placement.collisionIndex.transform.zoom;if(a.type==="symbol"&&(!a.minzoom||a.minzoom<=d)&&(!a.maxzoom||a.maxzoom>d)){if(this._inProgressLayer||(this._inProgressLayer=new bn(a)),this._inProgressLayer.continuePlacement(L[a.source],this.placement,this._showCollisionBoxes,a,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(A){return this.placement.commit(A),this.placement}}const gn=512/s.N/2;class mn{constructor(A,b,L){this.tileID=A,this.bucketInstanceId=L,this._symbolsByKey={};const k=new Map;for(let y=0;y<b.length;y++){const a=b.get(y),d=a.key,_=k.get(d);_?_.push(a):k.set(d,[a])}for(const[y,a]of k){const d={positions:a.map(_=>({x:Math.floor(_.anchorX*gn),y:Math.floor(_.anchorY*gn)})),crossTileIDs:a.map(_=>_.crossTileID)};if(d.positions.length>128){const _=new s.av(d.positions.length,16,Uint16Array);for(const{x:B,y:S}of d.positions)_.add(B,S);_.finish(),delete d.positions,d.index=_}this._symbolsByKey[y]=d}}getScaledCoordinates(A,b){const{x:L,y:k,z:y}=this.tileID.canonical,{x:a,y:d,z:_}=b.canonical,B=gn/Math.pow(2,_-y),S=(d*s.N+A.anchorY)*B,U=k*s.N*gn;return{x:Math.floor((a*s.N+A.anchorX)*B-L*s.N*gn),y:Math.floor(S-U)}}findMatches(A,b,L){const k=this.tileID.canonical.z<b.canonical.z?1:Math.pow(2,this.tileID.canonical.z-b.canonical.z);for(let y=0;y<A.length;y++){const a=A.get(y);if(a.crossTileID)continue;const d=this._symbolsByKey[a.key];if(!d)continue;const _=this.getScaledCoordinates(a,b);if(d.index){const B=d.index.range(_.x-k,_.y-k,_.x+k,_.y+k).sort();for(const S of B){const U=d.crossTileIDs[S];if(!L[U]){L[U]=!0,a.crossTileID=U;break}}}else if(d.positions)for(let B=0;B<d.positions.length;B++){const S=d.positions[B],U=d.crossTileIDs[B];if(Math.abs(S.x-_.x)<=k&&Math.abs(S.y-_.y)<=k&&!L[U]){L[U]=!0,a.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(A=>{let{crossTileIDs:b}=A;return b})}}class lr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(A){const b=Math.round((A-this.lng)/360);if(b!==0)for(const L in this.indexes){const k=this.indexes[L],y={};for(const a in k){const d=k[a];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+b),y[d.tileID.key]=d}this.indexes[L]=y}this.lng=A}addBucket(A,b,L){if(this.indexes[A.overscaledZ]&&this.indexes[A.overscaledZ][A.key]){if(this.indexes[A.overscaledZ][A.key].bucketInstanceId===b.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(A.overscaledZ,this.indexes[A.overscaledZ][A.key])}for(let y=0;y<b.symbolInstances.length;y++)b.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[A.overscaledZ]||(this.usedCrossTileIDs[A.overscaledZ]={});const k=this.usedCrossTileIDs[A.overscaledZ];for(const y in this.indexes){const a=this.indexes[y];if(Number(y)>A.overscaledZ)for(const d in a){const _=a[d];_.tileID.isChildOf(A)&&_.findMatches(b.symbolInstances,A,k)}else{const d=a[A.scaledTo(Number(y)).key];d&&d.findMatches(b.symbolInstances,A,k)}}for(let y=0;y<b.symbolInstances.length;y++){const a=b.symbolInstances.get(y);a.crossTileID||(a.crossTileID=L.generate(),k[a.crossTileID]=!0)}return this.indexes[A.overscaledZ]===void 0&&(this.indexes[A.overscaledZ]={}),this.indexes[A.overscaledZ][A.key]=new mn(A,b.symbolInstances,b.bucketInstanceId),!0}removeBucketCrossTileIDs(A,b){for(const L of b.getCrossTileIDsLists())for(const k of L)delete this.usedCrossTileIDs[A][k]}removeStaleBuckets(A){let b=!1;for(const L in this.indexes){const k=this.indexes[L];for(const y in k)A[k[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(L,k[y]),delete k[y],b=!0)}return b}}class ps{constructor(){this.layerIndexes={},this.crossTileIDs=new lr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(A,b,L){let k=this.layerIndexes[A.id];k===void 0&&(k=this.layerIndexes[A.id]=new Rn);let y=!1;const a={};k.handleWrapJump(L);for(const d of b){const _=d.getBucket(A);_&&A.id===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(d.tileID,_,this.crossTileIDs)&&(y=!0),a[_.bucketInstanceId]=!0)}return k.removeStaleBuckets(a)&&(y=!0),y}pruneUnusedLayers(A){const b={};A.forEach(L=>{b[L]=!0});for(const L in this.layerIndexes)b[L]||delete this.layerIndexes[L]}}const Qr=(N,A)=>s.x(N,A&&A.filter(b=>b.identifier!=="source.canvas")),xn=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),So=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),cs=s.aw();class Wi extends s.E{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=A,this.dispatcher=new Wt(Er(),this,A._getMapId()),this.imageManager=new Fe,this.imageManager.setEventedParent(this),this.glyphManager=new Ct(A._requestManager,b.localIdeographFontFamily),this.lineAtlas=new Mt(256,512),this.crossTileSymbolIndex=new ps,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const L=this;this._rtlTextPluginCallback=Wi.registerForPluginStateChange(k=>{L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:k.pluginStatus,pluginURL:k.pluginURL},(y,a)=>{if(s.aA(y),a&&a.every(d=>d))for(const d in L.sourceCaches){const _=L.sourceCaches[d].getSource().type;_!=="vector"&&_!=="geojson"||L.sourceCaches[d].reload()}})}),this.on("data",k=>{if(k.dataType!=="source"||k.sourceDataType!=="metadata")return;const y=this.sourceCaches[k.sourceId];if(!y)return;const a=y.getSource();if(a&&a.vectorLayerIds)for(const d in this._layers){const _=this._layers[d];_.source===a.id&&this._validateLayer(_)}})}loadURL(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),b.validate=typeof b.validate!="boolean"||b.validate;const k=this.map._requestManager.transformRequest(A,ce.Style);this._request=s.f(k,(y,a)=>{this._request=null,y?this.fire(new s.j(y)):a&&this._load(a,b,L)})}loadJSON(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,b.validate=b.validate!==!1,this._load(A,b,L)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(cs,{validate:!1})}_load(A,b,L){var k;const y=b.transformStyle?b.transformStyle(L,A):A;if(!b.validate||!Qr(this,s.y(y))){this._loaded=!0,this.stylesheet=y;for(const a in y.sources)this.addSource(a,y.sources[a],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Ft(this.stylesheet.light),this.map.setTerrain((k=this.stylesheet.terrain)!==null&&k!==void 0?k:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const A=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",A),this._order=A.map(b=>b.id),this._layers={},this._serializedLayers=null;for(const b of A){const L=s.aC(b);L.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=L}}_loadSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(k,y,a,d){const _=Ue(k),B=_.length,S=a>1?"@2x":"",U={},H={},q={};for(const{id:w,url:T}of _){const R=y.transformRequest(y.normalizeSpriteURL(T,S,".json"),ce.SpriteJSON),j=`${w}_${R.url}`;U[j]=s.f(R,(J,ee)=>{delete U[j],H[w]=ee,lt(d,H,q,J,B)});const Z=y.transformRequest(y.normalizeSpriteURL(T,S,".png"),ce.SpriteImage),W=`${w}_${Z.url}`;U[W]=ue.getImage(Z,(J,ee)=>{delete U[W],q[w]=ee,lt(d,H,q,J,B)})}return{cancel(){for(const w of Object.values(U))w.cancel()}}}(A,this.map._requestManager,this.map.getPixelRatio(),(k,y)=>{if(this._spriteRequest=null,k)this.fire(new s.j(k));else if(y)for(const a in y){this._spritesImagesIds[a]=[];const d=this._spritesImagesIds[a]?this._spritesImagesIds[a].filter(_=>!(_ in y)):[];for(const _ of d)this.imageManager.removeImage(_),this._changedImages[_]=!0;for(const _ in y[a]){const B=a==="default"?_:`${a}:${_}`;this._spritesImagesIds[a].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,y[a][_],!1):this.imageManager.addImage(B,y[a][_]),b&&(this._changedImages[B]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),b&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),L&&L(k)})}_unloadSprite(){for(const A of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(A),this._changedImages[A]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(A){const b=this.sourceCaches[A.source];if(!b)return;const L=A.sourceLayer;if(!L)return;const k=b.getSource();(k.type==="geojson"||k.vectorLayerIds&&k.vectorLayerIds.indexOf(L)===-1)&&this.fire(new s.j(new Error(`Source layer "${L}" does not exist on source "${k.id}" as specified by style layer "${A.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const A in this.sourceCaches)if(!this.sourceCaches[A].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(A){const b=this._serializedAllLayers();if(!A||A.length===0)return Object.values(b);const L=[];for(const k of A)b[k]&&L.push(b[k]);return L}_serializedAllLayers(){let A=this._serializedLayers;if(A)return A;A=this._serializedLayers={};const b=Object.keys(this._layers);for(const L of b){const k=this._layers[L];k.type!=="custom"&&(A[L]=k.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(A){if(!this._loaded)return;const b=this._changed;if(this._changed){const k=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(k.length||y.length)&&this._updateWorkerLayers(k,y);for(const a in this._updatedSources){const d=this._updatedSources[a];if(d==="reload")this._reloadSource(a);else{if(d!=="clear")throw new Error(`Invalid action ${d}`);this._clearSource(a)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const a in this._updatedPaintProps)this._layers[a].updateTransitions(A);this.light.updateTransitions(A),this._resetUpdates()}const L={};for(const k in this.sourceCaches){const y=this.sourceCaches[k];L[k]=y.used,y.used=!1}for(const k of this._order){const y=this._layers[k];y.recalculate(A,this._availableImages),!y.isHidden(A.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const k in L){const y=this.sourceCaches[k];L[k]!==y.used&&y.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:k}))}this.light.recalculate(A),this.z=A.zoom,b&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const A=Object.keys(this._changedImages);if(A.length){for(const b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],A);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(A,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(A),removedIds:b})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.serialize();if(A=b.transformStyle?b.transformStyle(L,A):A,Qr(this,s.y(A)))return!1;(A=s.aD(A)).layers=s.aB(A.layers);const k=s.aE(L,A).filter(a=>!(a.command in So));if(k.length===0)return!1;const y=k.filter(a=>!(a.command in xn));if(y.length>0)throw new Error(`Unimplemented: ${y.map(a=>a.command).join(", ")}.`);for(const a of k)a.command!=="setTransition"&&this[a.command].apply(this,a.args);return this.stylesheet=A,this._serializedLayers=null,!0}addImage(A,b){if(this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" already exists.`)));this.imageManager.addImage(A,b),this._afterImageUpdated(A)}updateImage(A,b){this.imageManager.updateImage(A,b)}getImage(A){return this.imageManager.getImage(A)}removeImage(A){if(!this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" does not exist.`)));this.imageManager.removeImage(A),this._afterImageUpdated(A)}_afterImageUpdated(A){this._availableImages=this.imageManager.listImages(),this._changedImages[A]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[A]!==void 0)throw new Error(`Source "${A}" already exists.`);if(!b.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(b).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(s.y.source,`sources.${A}`,b,null,L))return;this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);const k=this.sourceCaches[A]=new jt(A,b,this.dispatcher);k.style=this,k.setEventedParent(this,()=>({isSourceLoaded:k.loaded(),source:k.serialize(),sourceId:A})),k.onAdd(this.map),this._changed=!0}removeSource(A){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error("There is no source with this ID");for(const L in this._layers)if(this._layers[L].source===A)return this.fire(new s.j(new Error(`Source "${A}" cannot be removed while layer "${L}" is using it.`)));const b=this.sourceCaches[A];delete this.sourceCaches[A],delete this._updatedSources[A],b.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:A})),b.setEventedParent(null),b.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(A,b){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error(`There is no source with this ID=${A}`);const L=this.sourceCaches[A].getSource();if(L.type!=="geojson")throw new Error(`geojsonSource.type is ${L.type}, which is !== 'geojson`);L.setData(b),this._changed=!0}getSource(A){return this.sourceCaches[A]&&this.sourceCaches[A].getSource()}addLayer(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const k=A.id;if(this.getLayer(k))return void this.fire(new s.j(new Error(`Layer "${k}" already exists on this map.`)));let y;if(A.type==="custom"){if(Qr(this,s.aF(A)))return;y=s.aC(A)}else{if("source"in A&&typeof A.source=="object"&&(this.addSource(k,A.source),A=s.aD(A),A=s.e(A,{source:k})),this._validate(s.y.layer,`layers.${k}`,A,{arrayIndex:-1},L))return;y=s.aC(A),this._validateLayer(y),y.setEventedParent(this,{layer:{id:k}})}const a=b?this._order.indexOf(b):this._order.length;if(b&&a===-1)this.fire(new s.j(new Error(`Cannot add layer "${k}" before non-existing layer "${b}".`)));else{if(this._order.splice(a,0,k),this._layerOrderChanged=!0,this._layers[k]=y,this._removedLayers[k]&&y.source&&y.type!=="custom"){const d=this._removedLayers[k];delete this._removedLayers[k],d.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(A,b){if(this._checkLoaded(),this._changed=!0,!this._layers[A])return void this.fire(new s.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be moved.`)));if(A===b)return;const L=this._order.indexOf(A);this._order.splice(L,1);const k=b?this._order.indexOf(b):this._order.length;b&&k===-1?this.fire(new s.j(new Error(`Cannot move layer "${A}" before non-existing layer "${b}".`))):(this._order.splice(k,0,A),this._layerOrderChanged=!0)}removeLayer(A){this._checkLoaded();const b=this._layers[A];if(!b)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${A}".`)));b.setEventedParent(null);const L=this._order.indexOf(A);this._order.splice(L,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[A]=b,delete this._layers[A],this._serializedLayers&&delete this._serializedLayers[A],delete this._updatedLayers[A],delete this._updatedPaintProps[A],b.onRemove&&b.onRemove(this.map)}getLayer(A){return this._layers[A]}getLayersOrder(){return[...this._order]}hasLayer(A){return A in this._layers}setLayerZoomRange(A,b,L){this._checkLoaded();const k=this.getLayer(A);k?k.minzoom===b&&k.maxzoom===L||(b!=null&&(k.minzoom=b),L!=null&&(k.maxzoom=L),this._updateLayer(k)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${A}".`)))}setFilter(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const k=this.getLayer(A);if(k){if(!s.aG(k.filter,b))return b==null?(k.filter=void 0,void this._updateLayer(k)):void(this._validate(s.y.filter,`layers.${k.id}.filter`,b,null,L)||(k.filter=s.aD(b),this._updateLayer(k)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${A}".`)))}getFilter(A){return s.aD(this.getLayer(A).filter)}setLayoutProperty(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getLayoutProperty(b),L)||(y.setLayoutProperty(b,L,k),this._updateLayer(y)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getLayoutProperty(A,b){const L=this.getLayer(A);if(L)return L.getLayoutProperty(b);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${A}".`)))}setPaintProperty(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getPaintProperty(b),L)||(y.setPaintProperty(b,L,k)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[A]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getPaintProperty(A,b){return this.getLayer(A).getPaintProperty(b)}setFeatureState(A,b){this._checkLoaded();const L=A.source,k=A.sourceLayer,y=this.sourceCaches[L];if(y===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const a=y.getSource().type;a==="geojson"&&k?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):a!=="vector"||k?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(k,A.id,b)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(A,b){this._checkLoaded();const L=A.source,k=this.sourceCaches[L];if(k===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const y=k.getSource().type,a=y==="vector"?A.sourceLayer:void 0;y!=="vector"||a?b&&typeof A.id!="string"&&typeof A.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):k.removeFeatureState(a,A.id,b):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(A){this._checkLoaded();const b=A.source,L=A.sourceLayer,k=this.sourceCaches[b];if(k!==void 0)return k.getSource().type!=="vector"||L?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),k.getFeatureState(L,A.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${b}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const A=s.aH(this.sourceCaches,y=>y.serialize()),b=this._serializeByIds(this._order),L=this.map.getTerrain()||void 0,k=this.stylesheet;return s.aI({version:k.version,name:k.name,metadata:k.metadata,light:k.light,center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch,sprite:k.sprite,glyphs:k.glyphs,transition:k.transition,sources:A,layers:b,terrain:L},y=>y!==void 0)}_updateLayer(A){this._updatedLayers[A.id]=!0,A.source&&!this._updatedSources[A.source]&&this.sourceCaches[A.source].getSource().type!=="raster"&&(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(A){const b=a=>this._layers[a].type==="fill-extrusion",L={},k=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(b(d)){L[d]=a;for(const _ of A){const B=_[d];if(B)for(const S of B)k.push(S)}}}k.sort((a,d)=>d.intersectionZ-a.intersectionZ);const y=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(b(d))for(let _=k.length-1;_>=0;_--){const B=k[_].feature;if(L[B.layer.id]<a)break;y.push(B),k.pop()}else for(const _ of A){const B=_[d];if(B)for(const S of B)y.push(S.feature)}}return y}queryRenderedFeatures(A,b,L){b&&b.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",b.filter,null,b);const k={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const d of b.layers){const _=this._layers[d];if(!_)return this.fire(new s.j(new Error(`The layer '${d}' does not exist in the map's style and cannot be queried for features.`))),[];k[_.source]=!0}}const y=[];b.availableImages=this._availableImages;const a=this._serializedAllLayers();for(const d in this.sourceCaches)b.layers&&!k[d]||y.push(ot(this.sourceCaches[d],this._layers,a,A,b,L));return this.placement&&y.push(function(d,_,B,S,U,H,q){const w={},T=H.queryRenderedSymbols(S),R=[];for(const j of Object.keys(T).map(Number))R.push(q[j]);R.sort(xt);for(const j of R){const Z=j.featureIndex.lookupSymbolFeatures(T[j.bucketInstanceId],_,j.bucketIndex,j.sourceLayerIndex,U.filter,U.layers,U.availableImages,d);for(const W in Z){const J=w[W]=w[W]||[],ee=Z[W];ee.sort((ae,fe)=>{const pe=j.featureSortOrder;if(pe){const xe=pe.indexOf(ae.featureIndex);return pe.indexOf(fe.featureIndex)-xe}return fe.featureIndex-ae.featureIndex});for(const ae of ee)J.push(ae)}}for(const j in w)w[j].forEach(Z=>{const W=Z.feature,J=B[d[j].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=J});return w}(this._layers,a,this.sourceCaches,A,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(A,b){b&&b.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",b.filter,null,b);const L=this.sourceCaches[A];return L?function(k,y){const a=k.getRenderableIds().map(B=>k.getTileByID(B)),d=[],_={};for(let B=0;B<a.length;B++){const S=a[B],U=S.tileID.canonical.key;_[U]||(_[U]=!0,S.querySourceFeatures(d,y))}return d}(L,b):[]}addSourceType(A,b,L){return Mi(A)?L(new Error(`A source type called "${A}" already exists.`)):(((k,y)=>{mi[k]=y})(A,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:A,url:b.workerSourceURL},L):L(null,null))}getLight(){return this.light.getLight()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.light.getLight();let k=!1;for(const a in A)if(!s.aG(A[a],L[a])){k=!0;break}if(!k)return;const y={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(A,b),this.light.updateTransitions(y)}_validate(A,b,L,k){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!y||y.validate!==!1)&&Qr(this,A.call(s.y,s.e({key:b,style:this.serialize(),value:L,styleSpec:s.v},k)))}_remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const b in this._layers)this._layers[b].setEventedParent(null);for(const b in this.sourceCaches){const L=this.sourceCaches[b];L.setEventedParent(null),L.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(A)}_clearSource(A){this.sourceCaches[A].clearTiles()}_reloadSource(A){this.sourceCaches[A].resume(),this.sourceCaches[A].reload()}_updateSources(A){for(const b in this.sourceCaches)this.sourceCaches[b].update(A,this.map.terrain)}_generateCollisionBoxes(){for(const A in this.sourceCaches)this._reloadSource(A)}_updatePlacement(A,b,L,k){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,a=!1,d=!1;const _={};for(const B of this._order){const S=this._layers[B];if(S.type!=="symbol")continue;if(!_[S.source]){const H=this.sourceCaches[S.source];_[S.source]=H.getRenderableIds(!0).map(q=>H.getTileByID(q)).sort((q,w)=>w.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(w.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(S,_[S.source],A.center.lng);a=a||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||L===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),A.zoom))&&(this.pauseablePlacement=new ur(A,this.map.terrain,this._order,y,b,L,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),d=!0),a&&this.pauseablePlacement.placement.setStale()),d||a)for(const B of this._order){const S=this._layers[B];S.type==="symbol"&&this.placement.updateLayerOpacities(S,_[S.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const A in this.sourceCaches)this.sourceCaches[A].releaseSymbolFadeTiles()}getImages(A,b,L){this.imageManager.getImages(b.icons,L),this._updateTilesForChangedImages();const k=this.sourceCaches[b.source];k&&k.setDependencies(b.tileID.key,b.type,b.icons)}getGlyphs(A,b,L){this.glyphManager.getGlyphs(b.stacks,L);const k=this.sourceCaches[b.source];k&&k.setDependencies(b.tileID.key,b.type,[""])}getResource(A,b,L){return s.m(b,L)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),A&&this._validate(s.y.glyphs,"glyphs",A,null,b)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=A,this.glyphManager.entries={},this.glyphManager.setURL(A))}addSprite(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},k=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const y=[{id:A,url:b}],a=[...Ue(this.stylesheet.sprite),...y];this._validate(s.y.sprite,"sprite",a,null,L)||(this.stylesheet.sprite=a,this._loadSprite(y,!0,k))}removeSprite(A){this._checkLoaded();const b=Ue(this.stylesheet.sprite);if(b.find(L=>L.id===A)){if(this._spritesImagesIds[A])for(const L of this._spritesImagesIds[A])this.imageManager.removeImage(L),this._changedImages[L]=!0;b.splice(b.findIndex(L=>L.id===A),1),this.stylesheet.sprite=b.length>0?b:void 0,delete this._spritesImagesIds[A],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${A}" doesn't exists on this map.`)))}getSprite(){return Ue(this.stylesheet.sprite)}setSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),A&&this._validate(s.y.sprite,"sprite",A,null,b)||(this.stylesheet.sprite=A,A?this._loadSprite(A,!0,L):(this._unloadSprite(),L&&L(null)))}}Wi.registerForPluginStateChange=s.aK;var Js=s.Q([{name:"a_pos",type:"Int16",components:2}]),ws="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const dr={prelude:Fr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ws),terrainDepth:Fr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ws),terrainCoords:Fr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ws)};function Fr(N,A){const b=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,L=A.match(/attribute ([\w]+) ([\w]+)/g),k=N.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=y?y.concat(k):k,d={};return{fragmentSource:N=N.replace(b,(_,B,S,U,H)=>(d[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${S} ${U} ${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = u_${H};
#endif
`)),vertexSource:A=A.replace(b,(_,B,S,U,H)=>{const q=U==="float"?"vec2":"vec4",w=H.match(/color/)?"color":q;return d[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${S} ${q} a_${H};
varying ${S} ${U} ${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${S} ${q} a_${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = a_${H};
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${S} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:L,staticUniforms:a}}class Vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(A,b,L,k,y,a,d,_,B){this.context=A;let S=this.boundPaintVertexBuffers.length!==k.length;for(let U=0;!S&&U<k.length;U++)this.boundPaintVertexBuffers[U]!==k[U]&&(S=!0);!this.vao||this.boundProgram!==b||this.boundLayoutVertexBuffer!==L||S||this.boundIndexBuffer!==y||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==d||this.boundDynamicVertexBuffer2!==_||this.boundDynamicVertexBuffer3!==B?this.freshBind(b,L,k,y,a,d,_,B):(A.bindVertexArray.set(this.vao),d&&d.bind(),y&&y.dynamicDraw&&y.bind(),_&&_.bind(),B&&B.bind())}freshBind(A,b,L,k,y,a,d,_){const B=A.numAttributes,S=this.context,U=S.gl;this.vao&&this.destroy(),this.vao=S.createVertexArray(),S.bindVertexArray.set(this.vao),this.boundProgram=A,this.boundLayoutVertexBuffer=b,this.boundPaintVertexBuffers=L,this.boundIndexBuffer=k,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=d,this.boundDynamicVertexBuffer3=_,b.enableAttributes(U,A);for(const H of L)H.enableAttributes(U,A);a&&a.enableAttributes(U,A),d&&d.enableAttributes(U,A),_&&_.enableAttributes(U,A),b.bind(),b.setVertexAttribPointers(U,A,y);for(const H of L)H.bind(),H.setVertexAttribPointers(U,A,y);a&&(a.bind(),a.setVertexAttribPointers(U,A,y)),k&&k.bind(),d&&(d.bind(),d.setVertexAttribPointers(U,A,y)),_&&(_.bind(),_.setVertexAttribPointers(U,A,y)),S.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Or(N){const A=[];for(let b=0;b<N.length;b++){if(N[b]===null)continue;const L=N[b].split(" ");A.push(L.pop())}return A}class Cn{constructor(A,b,L,k,y,a){const d=A.gl;this.program=d.createProgram();const _=Or(b.staticAttributes),B=L?L.getBinderAttributes():[],S=_.concat(B),U=dr.prelude.staticUniforms?Or(dr.prelude.staticUniforms):[],H=b.staticUniforms?Or(b.staticUniforms):[],q=L?L.getBinderUniforms():[],w=U.concat(H).concat(q),T=[];for(const ae of w)T.indexOf(ae)<0&&T.push(ae);const R=L?L.defines():[];y&&R.push("#define OVERDRAW_INSPECTOR;"),a&&R.push("#define TERRAIN3D;");const j=R.concat(dr.prelude.fragmentSource,b.fragmentSource).join(`
`),Z=R.concat(dr.prelude.vertexSource,b.vertexSource).join(`
`),W=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(W,j),d.compileShader(W),!d.getShaderParameter(W,d.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${d.getShaderInfoLog(W)}`);d.attachShader(this.program,W);const J=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(J,Z),d.compileShader(J),!d.getShaderParameter(J,d.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${d.getShaderInfoLog(J)}`);d.attachShader(this.program,J),this.attributes={};const ee={};this.numAttributes=S.length;for(let ae=0;ae<this.numAttributes;ae++)S[ae]&&(d.bindAttribLocation(this.program,ae,S[ae]),this.attributes[S[ae]]=ae);if(d.linkProgram(this.program),!d.getProgramParameter(this.program,d.LINK_STATUS))throw new Error(`Program failed to link: ${d.getProgramInfoLog(this.program)}`);d.deleteShader(J),d.deleteShader(W);for(let ae=0;ae<T.length;ae++){const fe=T[ae];if(fe&&!ee[fe]){const pe=d.getUniformLocation(this.program,fe);pe&&(ee[fe]=pe)}}this.fixedUniforms=k(A,ee),this.terrainUniforms=((ae,fe)=>({u_depth:new s.aL(ae,fe.u_depth),u_terrain:new s.aL(ae,fe.u_terrain),u_terrain_dim:new s.aM(ae,fe.u_terrain_dim),u_terrain_matrix:new s.aN(ae,fe.u_terrain_matrix),u_terrain_unpack:new s.aO(ae,fe.u_terrain_unpack),u_terrain_exaggeration:new s.aM(ae,fe.u_terrain_exaggeration)}))(A,ee),this.binderUniforms=L?L.getUniforms(A,ee):[]}draw(A,b,L,k,y,a,d,_,B,S,U,H,q,w,T,R,j,Z){const W=A.gl;if(this.failedToCreate)return;if(A.program.set(this.program),A.setDepthMode(L),A.setStencilMode(k),A.setColorMode(y),A.setCullFace(a),_){A.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,_.depthTexture),A.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,_.texture);for(const ee in this.terrainUniforms)this.terrainUniforms[ee].set(_[ee])}for(const ee in this.fixedUniforms)this.fixedUniforms[ee].set(d[ee]);T&&T.setUniforms(A,this.binderUniforms,q,{zoom:w});let J=0;switch(b){case W.LINES:J=2;break;case W.TRIANGLES:J=3;break;case W.LINE_STRIP:J=1}for(const ee of H.get()){const ae=ee.vaos||(ee.vaos={});(ae[B]||(ae[B]=new Vn)).bind(A,this,S,T?T.getPaintVertexBuffers():[],U,ee.vertexOffset,R,j,Z),W.drawElements(b,ee.primitiveLength*J,W.UNSIGNED_SHORT,ee.primitiveOffset*J*2)}}}function An(N,A,b){const L=1/Me(b,1,A.transform.tileZoom),k=Math.pow(2,b.tileID.overscaledZ),y=b.tileSize*Math.pow(2,A.transform.tileZoom)/k,a=y*(b.tileID.canonical.x+b.tileID.wrap*k),d=y*b.tileID.canonical.y;return{u_image:0,u_texsize:b.imageAtlasTexture.size,u_scale:[L,N.fromScale,N.toScale],u_fade:N.t,u_pixel_coord_upper:[a>>16,d>>16],u_pixel_coord_lower:[65535&a,65535&d]}}const Hr=(N,A,b,L)=>{const k=A.style.light,y=k.properties.get("position"),a=[y.x,y.y,y.z],d=function(){var B=new s.A(9);return s.A!=Float32Array&&(B[1]=0,B[2]=0,B[3]=0,B[5]=0,B[6]=0,B[7]=0),B[0]=1,B[4]=1,B[8]=1,B}();k.properties.get("anchor")==="viewport"&&function(B,S){var U=Math.sin(S),H=Math.cos(S);B[0]=H,B[1]=U,B[2]=0,B[3]=-U,B[4]=H,B[5]=0,B[6]=0,B[7]=0,B[8]=1}(d,-A.transform.angle),function(B,S,U){var H=S[0],q=S[1],w=S[2];B[0]=H*U[0]+q*U[3]+w*U[6],B[1]=H*U[1]+q*U[4]+w*U[7],B[2]=H*U[2]+q*U[5]+w*U[8]}(a,a,d);const _=k.properties.get("color");return{u_matrix:N,u_lightpos:a,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+b,u_opacity:L}},Hs=(N,A,b,L,k,y,a)=>s.e(Hr(N,A,b,L),An(y,A,a),{u_height_factor:-Math.pow(2,k.overscaledZ)/a.tileSize/8}),ca=N=>({u_matrix:N}),uo=(N,A,b,L)=>s.e(ca(N),An(b,A,L)),Ea=(N,A)=>({u_matrix:N,u_world:A}),Ne=(N,A,b,L,k)=>s.e(uo(N,A,b,L),{u_world:k}),Ze=(N,A,b,L)=>{const k=N.transform;let y,a;if(L.paint.get("circle-pitch-alignment")==="map"){const d=Me(b,1,k.zoom);y=!0,a=[d,d]}else y=!1,a=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(L.paint.get("circle-pitch-scale")==="map"),u_matrix:N.translatePosMatrix(A.posMatrix,b,L.paint.get("circle-translate"),L.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:N.pixelRatio,u_extrude_scale:a}},dt=(N,A,b)=>{const L=Me(b,1,A.zoom),k=Math.pow(2,A.zoom-b.tileID.overscaledZ),y=b.tileID.overscaleFactor();return{u_matrix:N,u_camera_to_center_distance:A.cameraToCenterDistance,u_pixels_to_tile_units:L,u_extrude_scale:[A.pixelsToGLUnits[0]/(L*k),A.pixelsToGLUnits[1]/(L*k)],u_overscale_factor:y}},Ot=function(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:N,u_color:A,u_overlay:0,u_overlay_scale:b}},ui=N=>({u_matrix:N}),Gi=(N,A,b,L)=>({u_matrix:N,u_extrude_scale:Me(A,1,b),u_intensity:L});function br(N,A){const b=Math.pow(2,A.canonical.z),L=A.canonical.y;return[new s.U(0,L/b).toLngLat().lat,new s.U(0,(L+1)/b).toLngLat().lat]}const En=(N,A,b,L)=>{const k=N.transform;return{u_matrix:Va(N,A,b,L),u_ratio:1/Me(A,1,k.zoom),u_device_pixel_ratio:N.pixelRatio,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},kn=(N,A,b,L,k)=>s.e(En(N,A,b,k),{u_image:0,u_image_height:L}),is=(N,A,b,L,k)=>{const y=N.transform,a=iu(A,y);return{u_matrix:Va(N,A,b,k),u_texsize:A.imageAtlasTexture.size,u_ratio:1/Me(A,1,y.zoom),u_device_pixel_ratio:N.pixelRatio,u_image:0,u_scale:[a,L.fromScale,L.toScale],u_fade:L.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},wn=(N,A,b,L,k,y)=>{const a=N.lineAtlas,d=iu(A,N.transform),_=b.layout.get("line-cap")==="round",B=a.getDash(L.from,_),S=a.getDash(L.to,_),U=B.width*k.fromScale,H=S.width*k.toScale;return s.e(En(N,A,b,y),{u_patternscale_a:[d/U,-B.height/2],u_patternscale_b:[d/H,-S.height/2],u_sdfgamma:a.width/(256*Math.min(U,H)*N.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:S.y,u_mix:k.t})};function iu(N,A){return 1/Me(N,1,A.tileZoom)}function Va(N,A,b,L){return N.translatePosMatrix(L?L.posMatrix:A.tileID.posMatrix,A,b.paint.get("line-translate"),b.paint.get("line-translate-anchor"))}const Tr=(N,A,b,L,k)=>{return{u_matrix:N,u_tl_parent:A,u_scale_parent:b,u_buffer_scale:1,u_fade_t:L.mix,u_opacity:L.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:(a=k.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(y=k.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ha(k.paint.get("raster-hue-rotate"))};var y,a};function Ha(N){N*=Math.PI/180;const A=Math.sin(N),b=Math.cos(N);return[(2*b+1)/3,(-Math.sqrt(3)*A-b+1)/3,(Math.sqrt(3)*A-b+1)/3]}const Dl=(N,A,b,L,k,y,a,d,_,B)=>{const S=k.transform;return{u_is_size_zoom_constant:+(N==="constant"||N==="source"),u_is_size_feature_constant:+(N==="constant"||N==="camera"),u_size_t:A?A.uSizeT:0,u_size:A?A.uSize:0,u_camera_to_center_distance:S.cameraToCenterDistance,u_pitch:S.pitch/360*2*Math.PI,u_rotate_symbol:+b,u_aspect_ratio:S.width/S.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:a,u_coord_matrix:d,u_is_text:+_,u_pitch_with_map:+L,u_texsize:B,u_texture:0}},Jn=(N,A,b,L,k,y,a,d,_,B,S)=>{const U=k.transform;return s.e(Dl(N,A,b,L,k,y,a,d,_,B),{u_gamma_scale:L?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:+S})},To=(N,A,b,L,k,y,a,d,_,B)=>s.e(Jn(N,A,b,L,k,y,a,d,!0,_,!0),{u_texsize_icon:B,u_texture_icon:1}),Ga=(N,A,b)=>({u_matrix:N,u_opacity:A,u_color:b}),gs=(N,A,b,L,k,y)=>s.e(function(a,d,_,B){const S=_.imageManager.getPattern(a.from.toString()),U=_.imageManager.getPattern(a.to.toString()),{width:H,height:q}=_.imageManager.getPixelSize(),w=Math.pow(2,B.tileID.overscaledZ),T=B.tileSize*Math.pow(2,_.transform.tileZoom)/w,R=T*(B.tileID.canonical.x+B.tileID.wrap*w),j=T*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:S.tl,u_pattern_br_a:S.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[H,q],u_mix:d.t,u_pattern_size_a:S.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:d.fromScale,u_scale_b:d.toScale,u_tile_units_to_pixels:1/Me(B,1,_.transform.tileZoom),u_pixel_coord_upper:[R>>16,j>>16],u_pixel_coord_lower:[65535&R,65535&j]}}(L,y,b,k),{u_matrix:N,u_opacity:A}),ua={fillExtrusion:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_opacity:new s.aM(N,A.u_opacity)}),fillExtrusionPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_height_factor:new s.aM(N,A.u_height_factor),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade),u_opacity:new s.aM(N,A.u_opacity)}),fill:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),fillPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),fillOutline:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world)}),fillOutlinePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),circle:(N,A)=>({u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_scale_with_map:new s.aL(N,A.u_scale_with_map),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_matrix:new s.aN(N,A.u_matrix)}),collisionBox:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(N,A.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_overscale_factor:new s.aM(N,A.u_overscale_factor)}),collisionCircle:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_inv_matrix:new s.aN(N,A.u_inv_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_viewport_size:new s.aQ(N,A.u_viewport_size)}),debug:(N,A)=>({u_color:new s.aR(N,A.u_color),u_matrix:new s.aN(N,A.u_matrix),u_overlay:new s.aL(N,A.u_overlay),u_overlay_scale:new s.aM(N,A.u_overlay_scale)}),clippingMask:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),heatmap:(N,A)=>({u_extrude_scale:new s.aM(N,A.u_extrude_scale),u_intensity:new s.aM(N,A.u_intensity),u_matrix:new s.aN(N,A.u_matrix)}),heatmapTexture:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_color_ramp:new s.aL(N,A.u_color_ramp),u_opacity:new s.aM(N,A.u_opacity)}),hillshade:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_latrange:new s.aQ(N,A.u_latrange),u_light:new s.aQ(N,A.u_light),u_shadow:new s.aR(N,A.u_shadow),u_highlight:new s.aR(N,A.u_highlight),u_accent:new s.aR(N,A.u_accent)}),hillshadePrepare:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_dimension:new s.aQ(N,A.u_dimension),u_zoom:new s.aM(N,A.u_zoom),u_unpack:new s.aO(N,A.u_unpack)}),line:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels)}),lineGradient:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_image:new s.aL(N,A.u_image),u_image_height:new s.aM(N,A.u_image_height)}),linePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texsize:new s.aQ(N,A.u_texsize),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_image:new s.aL(N,A.u_image),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),lineSDF:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_patternscale_a:new s.aQ(N,A.u_patternscale_a),u_patternscale_b:new s.aQ(N,A.u_patternscale_b),u_sdfgamma:new s.aM(N,A.u_sdfgamma),u_image:new s.aL(N,A.u_image),u_tex_y_a:new s.aM(N,A.u_tex_y_a),u_tex_y_b:new s.aM(N,A.u_tex_y_b),u_mix:new s.aM(N,A.u_mix)}),raster:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_tl_parent:new s.aQ(N,A.u_tl_parent),u_scale_parent:new s.aM(N,A.u_scale_parent),u_buffer_scale:new s.aM(N,A.u_buffer_scale),u_fade_t:new s.aM(N,A.u_fade_t),u_opacity:new s.aM(N,A.u_opacity),u_image0:new s.aL(N,A.u_image0),u_image1:new s.aL(N,A.u_image1),u_brightness_low:new s.aM(N,A.u_brightness_low),u_brightness_high:new s.aM(N,A.u_brightness_high),u_saturation_factor:new s.aM(N,A.u_saturation_factor),u_contrast_factor:new s.aM(N,A.u_contrast_factor),u_spin_weights:new s.aP(N,A.u_spin_weights)}),symbolIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture)}),symbolSDF:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),symbolTextAndIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texsize_icon:new s.aQ(N,A.u_texsize_icon),u_texture:new s.aL(N,A.u_texture),u_texture_icon:new s.aL(N,A.u_texture_icon),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),background:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_color:new s.aR(N,A.u_color)}),backgroundPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_image:new s.aL(N,A.u_image),u_pattern_tl_a:new s.aQ(N,A.u_pattern_tl_a),u_pattern_br_a:new s.aQ(N,A.u_pattern_br_a),u_pattern_tl_b:new s.aQ(N,A.u_pattern_tl_b),u_pattern_br_b:new s.aQ(N,A.u_pattern_br_b),u_texsize:new s.aQ(N,A.u_texsize),u_mix:new s.aM(N,A.u_mix),u_pattern_size_a:new s.aQ(N,A.u_pattern_size_a),u_pattern_size_b:new s.aQ(N,A.u_pattern_size_b),u_scale_a:new s.aM(N,A.u_scale_a),u_scale_b:new s.aM(N,A.u_scale_b),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(N,A.u_tile_units_to_pixels)}),terrain:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainDepth:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainCoords:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_terrain_coords_id:new s.aM(N,A.u_terrain_coords_id),u_ele_delta:new s.aM(N,A.u_ele_delta)})};class ja{constructor(A,b,L){this.context=A;const k=A.gl;this.buffer=k.createBuffer(),this.dynamicDraw=!!L,this.context.unbindVAO(),A.bindElementBuffer.set(this.buffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(A){const b=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),b.bufferSubData(b.ELEMENT_ARRAY_BUFFER,0,A.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ic{constructor(A,b,L,k){this.length=b.length,this.attributes=L,this.itemSize=b.bytesPerElement,this.dynamicDraw=k,this.context=A;const y=A.gl;this.buffer=y.createBuffer(),A.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(A){if(A.length!==this.length)throw new Error(`Length of new data is ${A.length}, which doesn't match current length of ${this.length}`);const b=this.context.gl;this.bind(),b.bufferSubData(b.ARRAY_BUFFER,0,A.arrayBuffer)}enableAttributes(A,b){for(let L=0;L<this.attributes.length;L++){const k=b.attributes[this.attributes[L].name];k!==void 0&&A.enableVertexAttribArray(k)}}setVertexAttribPointers(A,b,L){for(let k=0;k<this.attributes.length;k++){const y=this.attributes[k],a=b.attributes[y.name];a!==void 0&&A.vertexAttribPointer(a,y.components,A[Sa[y.type]],!1,this.itemSize,y.offset+this.itemSize*(L||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qa=new WeakMap;function ho(N){var A;if(qa.has(N))return qa.get(N);{const b=(A=N.getParameter(N.VERSION))===null||A===void 0?void 0:A.startsWith("WebGL 2.0");return qa.set(N,b),b}}class Pr{constructor(A){this.gl=A.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(A){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ha extends Pr{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.clearColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class us extends Pr{getDefault(){return 1}set(A){(A!==this.current||this.dirty)&&(this.gl.clearDepth(A),this.current=A,this.dirty=!1)}}class dn extends Pr{getDefault(){return 0}set(A){(A!==this.current||this.dirty)&&(this.gl.clearStencil(A),this.current=A,this.dirty=!1)}}class rs extends Pr{getDefault(){return[!0,!0,!0,!0]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.colorMask(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Vr extends Pr{getDefault(){return!0}set(A){(A!==this.current||this.dirty)&&(this.gl.depthMask(A),this.current=A,this.dirty=!1)}}class $a extends Pr{getDefault(){return 255}set(A){(A!==this.current||this.dirty)&&(this.gl.stencilMask(A),this.current=A,this.dirty=!1)}}class nl extends Pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(A){const b=this.current;(A.func!==b.func||A.ref!==b.ref||A.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(A.func,A.ref,A.mask),this.current=A,this.dirty=!1)}}class Rl extends Pr{getDefault(){const A=this.gl;return[A.KEEP,A.KEEP,A.KEEP]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(A[0],A[1],A[2]),this.current=A,this.dirty=!1)}}class Io extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.current=A,this.dirty=!1}}class Ko extends Pr{getDefault(){return[0,1]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.depthRange(A[0],A[1]),this.current=A,this.dirty=!1)}}class cc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.current=A,this.dirty=!1}}class Wo extends Pr{getDefault(){return this.gl.LESS}set(A){(A!==this.current||this.dirty)&&(this.gl.depthFunc(A),this.current=A,this.dirty=!1)}}class Ao extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.BLEND):b.disable(b.BLEND),this.current=A,this.dirty=!1}}class uc extends Pr{getDefault(){const A=this.gl;return[A.ONE,A.ZERO]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(A[0],A[1]),this.current=A,this.dirty=!1)}}class Xo extends Pr{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.blendColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class kl extends Pr{getDefault(){return this.gl.FUNC_ADD}set(A){(A!==this.current||this.dirty)&&(this.gl.blendEquation(A),this.current=A,this.dirty=!1)}}class Lc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this.current=A,this.dirty=!1}}class Ah extends Pr{getDefault(){return this.gl.BACK}set(A){(A!==this.current||this.dirty)&&(this.gl.cullFace(A),this.current=A,this.dirty=!1)}}class ru extends Pr{getDefault(){return this.gl.CCW}set(A){(A!==this.current||this.dirty)&&(this.gl.frontFace(A),this.current=A,this.dirty=!1)}}class nu extends Pr{getDefault(){return null}set(A){(A!==this.current||this.dirty)&&(this.gl.useProgram(A),this.current=A,this.dirty=!1)}}class Iu extends Pr{getDefault(){return this.gl.TEXTURE0}set(A){(A!==this.current||this.dirty)&&(this.gl.activeTexture(A),this.current=A,this.dirty=!1)}}class Ol extends Pr{getDefault(){const A=this.gl;return[0,0,A.drawingBufferWidth,A.drawingBufferHeight]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.viewport(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Ka extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,A),this.current=A,this.dirty=!1}}class Wa extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class Ul extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindTexture(b.TEXTURE_2D,A),this.current=A,this.dirty=!1}}class Xa extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class Aa extends Pr{getDefault(){return null}set(A){const b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class sl extends Pr{getDefault(){return null}set(A){var b;if(A===this.current&&!this.dirty)return;const L=this.gl;ho(L)?L.bindVertexArray(A):(b=L.getExtension("OES_vertex_array_object"))===null||b===void 0||b.bindVertexArrayOES(A),this.current=A,this.dirty=!1}}class Nl extends Pr{getDefault(){return 4}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,A),this.current=A,this.dirty=!1}}class Ys extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),this.current=A,this.dirty=!1}}class da extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,A),this.current=A,this.dirty=!1}}class re extends Pr{constructor(A,b){super(A),this.context=A,this.parent=b}getDefault(){return null}}class Ie extends re{setDirty(){this.dirty=!0}set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,A,0),this.current=A,this.dirty=!1}}class at extends re{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class mt extends re{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class vt{constructor(A,b,L,k,y){this.context=A,this.width=b,this.height=L;const a=A.gl,d=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Ie(A,d),k)this.depthAttachment=y?new mt(A,d):new at(A,d);else if(y)throw new Error("Stencil cannot be setted without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const A=this.context.gl,b=this.colorAttachment.get();if(b&&A.deleteTexture(b),this.depthAttachment){const L=this.depthAttachment.get();L&&A.deleteRenderbuffer(L)}A.deleteFramebuffer(this.framebuffer)}}class Tt{constructor(A,b,L){this.blendFunction=A,this.blendColor=b,this.mask=L}}Tt.Replace=[1,0],Tt.disabled=new Tt(Tt.Replace,s.aT.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,s.aT.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],s.aT.transparent,[!0,!0,!0,!0]);class pi{constructor(A){var b,L;if(this.gl=A,this.clearColor=new ha(this),this.clearDepth=new us(this),this.clearStencil=new dn(this),this.colorMask=new rs(this),this.depthMask=new Vr(this),this.stencilMask=new $a(this),this.stencilFunc=new nl(this),this.stencilOp=new Rl(this),this.stencilTest=new Io(this),this.depthRange=new Ko(this),this.depthTest=new cc(this),this.depthFunc=new Wo(this),this.blend=new Ao(this),this.blendFunc=new uc(this),this.blendColor=new Xo(this),this.blendEquation=new kl(this),this.cullFace=new Lc(this),this.cullFaceSide=new Ah(this),this.frontFace=new ru(this),this.program=new nu(this),this.activeTexture=new Iu(this),this.viewport=new Ol(this),this.bindFramebuffer=new Ka(this),this.bindRenderbuffer=new Wa(this),this.bindTexture=new Ul(this),this.bindVertexBuffer=new Xa(this),this.bindElementBuffer=new Aa(this),this.bindVertexArray=new sl(this),this.pixelStoreUnpack=new Nl(this),this.pixelStoreUnpackPremultiplyAlpha=new Ys(this),this.pixelStoreUnpackFlipY=new da(this),this.extTextureFilterAnisotropic=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=A.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),ho(A)){this.HALF_FLOAT=A.HALF_FLOAT;const k=A.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(b=A.RGBA16F)!==null&&b!==void 0?b:k==null?void 0:k.RGBA16F_EXT,this.RGB16F=(L=A.RGB16F)!==null&&L!==void 0?L:k==null?void 0:k.RGB16F_EXT,A.getExtension("EXT_color_buffer_float")}else{A.getExtension("EXT_color_buffer_half_float"),A.getExtension("OES_texture_half_float_linear");const k=A.getExtension("OES_texture_half_float");this.HALF_FLOAT=k==null?void 0:k.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(A,b){return new ja(this,A,b)}createVertexBuffer(A,b,L){return new Ic(this,A,b,L)}createRenderbuffer(A,b,L){const k=this.gl,y=k.createRenderbuffer();return this.bindRenderbuffer.set(y),k.renderbufferStorage(k.RENDERBUFFER,A,b,L),this.bindRenderbuffer.set(null),y}createFramebuffer(A,b,L,k){return new vt(this,A,b,L,k)}clear(A){let{color:b,depth:L,stencil:k}=A;const y=this.gl;let a=0;b&&(a|=y.COLOR_BUFFER_BIT,this.clearColor.set(b),this.colorMask.set([!0,!0,!0,!0])),L!==void 0&&(a|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(L),this.depthMask.set(!0)),k!==void 0&&(a|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(k),this.stencilMask.set(255)),y.clear(a)}setCullFace(A){A.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(A.mode),this.frontFace.set(A.frontFace))}setDepthMode(A){A.func!==this.gl.ALWAYS||A.mask?(this.depthTest.set(!0),this.depthFunc.set(A.func),this.depthMask.set(A.mask),this.depthRange.set(A.range)):this.depthTest.set(!1)}setStencilMode(A){A.test.func!==this.gl.ALWAYS||A.mask?(this.stencilTest.set(!0),this.stencilMask.set(A.mask),this.stencilOp.set([A.fail,A.depthFail,A.pass]),this.stencilFunc.set({func:A.test.func,ref:A.ref,mask:A.test.mask})):this.stencilTest.set(!1)}setColorMode(A){s.aG(A.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(A.blendFunction),this.blendColor.set(A.blendColor)),this.colorMask.set(A.mask)}createVertexArray(){var A;return ho(this.gl)?this.gl.createVertexArray():(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.createVertexArrayOES()}deleteVertexArray(A){var b;return ho(this.gl)?this.gl.deleteVertexArray(A):(b=this.gl.getExtension("OES_vertex_array_object"))===null||b===void 0?void 0:b.deleteVertexArrayOES(A)}unbindVAO(){this.bindVertexArray.set(null)}}class ri{constructor(A,b,L){this.func=A,this.mask=b,this.range=L}}ri.ReadOnly=!1,ri.ReadWrite=!0,ri.disabled=new ri(519,ri.ReadOnly,[0,1]);const rr=7680;class qi{constructor(A,b,L,k,y,a){this.test=A,this.ref=b,this.mask=L,this.fail=k,this.depthFail=y,this.pass=a}}qi.disabled=new qi({func:519,mask:0},0,0,rr,rr,rr);class ki{constructor(A,b,L){this.enable=A,this.mode=b,this.frontFace=L}}let jr;function nr(N,A,b,L,k,y,a){const d=N.context,_=d.gl,B=N.useProgram("collisionBox"),S=[];let U=0,H=0;for(let W=0;W<L.length;W++){const J=L[W],ee=A.getTile(J),ae=ee.getBucket(b);if(!ae)continue;let fe=J.posMatrix;k[0]===0&&k[1]===0||(fe=N.translatePosMatrix(J.posMatrix,ee,k,y));const pe=a?ae.textCollisionBox:ae.iconCollisionBox,xe=ae.collisionCircleArray;if(xe.length>0){const Pe=s.Z(),Le=fe;s.aU(Pe,ae.placementInvProjMatrix,N.transform.glCoordMatrix),s.aU(Pe,Pe,ae.placementViewportMatrix),S.push({circleArray:xe,circleOffset:H,transform:Le,invTransform:Pe,coord:J}),U+=xe.length/4,H=U}pe&&B.draw(d,_.LINES,ri.disabled,qi.disabled,N.colorModeForRenderPass(),ki.disabled,dt(fe,N.transform,ee),N.style.map.terrain&&N.style.map.terrain.getTerrainData(J),b.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,N.transform.zoom,null,null,pe.collisionVertexBuffer)}if(!a||!S.length)return;const q=N.useProgram("collisionCircle"),w=new s.aV;w.resize(4*U),w._trim();let T=0;for(const W of S)for(let J=0;J<W.circleArray.length/4;J++){const ee=4*J,ae=W.circleArray[ee+0],fe=W.circleArray[ee+1],pe=W.circleArray[ee+2],xe=W.circleArray[ee+3];w.emplace(T++,ae,fe,pe,xe,0),w.emplace(T++,ae,fe,pe,xe,1),w.emplace(T++,ae,fe,pe,xe,2),w.emplace(T++,ae,fe,pe,xe,3)}(!jr||jr.length<2*U)&&(jr=function(W){const J=2*W,ee=new s.aX;ee.resize(J),ee._trim();for(let ae=0;ae<J;ae++){const fe=6*ae;ee.uint16[fe+0]=4*ae+0,ee.uint16[fe+1]=4*ae+1,ee.uint16[fe+2]=4*ae+2,ee.uint16[fe+3]=4*ae+2,ee.uint16[fe+4]=4*ae+3,ee.uint16[fe+5]=4*ae+0}return ee}(U));const R=d.createIndexBuffer(jr,!0),j=d.createVertexBuffer(w,s.aW.members,!0);for(const W of S){const J={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(Z=N.transform).cameraToCenterDistance,u_viewport_size:[Z.width,Z.height]};q.draw(d,_.TRIANGLES,ri.disabled,qi.disabled,N.colorModeForRenderPass(),ki.disabled,J,N.style.map.terrain&&N.style.map.terrain.getTerrainData(W.coord),b.id,j,R,s.S.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,N.transform.zoom,null,null,null)}var Z;j.destroy(),R.destroy()}ki.disabled=new ki(!1,1029,2305),ki.backCCW=new ki(!0,1029,2305);const Hn=s.ao(new Float32Array(16));function Br(N,A,b,L,k,y){const{horizontalAlign:a,verticalAlign:d}=s.au(N);return new s.P((-(a-.5)*A/k+L[0])*y,(-(d-.5)*b/k+L[1])*y)}function Lr(N,A,b,L,k,y,a,d,_,B,S){const U=N.text.placedSymbolArray,H=N.text.dynamicLayoutVertexArray,q=N.icon.dynamicLayoutVertexArray,w={};H.clear();for(let T=0;T<U.length;T++){const R=U.get(T),j=R.hidden||!R.crossTileID||N.allowVerticalPlacement&&!R.placedOrientation?null:L[R.crossTileID];if(j){const Z=new s.P(R.anchorX,R.anchorY),W=Qt(Z,b?a:y,S),J=Bi(k.cameraToCenterDistance,W.signedDistanceFromCamera);let ee=s.aj(N.textSizeData,_,R)*J/s.ap;b&&(ee*=N.tilePixelRatio/d);const{width:ae,height:fe,anchor:pe,textOffset:xe,textBoxScale:Pe}=j,Le=Br(pe,ae,fe,xe,Pe,ee),rt=b?Qt(Z.add(Le),y,S).point:W.point.add(A?Le.rotate(-k.angle):Le),Ke=N.allowVerticalPlacement&&R.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Re=0;Re<R.numGlyphs;Re++)s.ak(H,rt,Ke);B&&R.associatedIconIndex>=0&&(w[R.associatedIconIndex]={shiftedAnchor:rt,angle:Ke})}else ge(R.numGlyphs,H)}if(B){q.clear();const T=N.icon.placedSymbolArray;for(let R=0;R<T.length;R++){const j=T.get(R);if(j.hidden)ge(j.numGlyphs,q);else{const Z=w[R];if(Z)for(let W=0;W<j.numGlyphs;W++)s.ak(q,Z.shiftedAnchor,Z.angle);else ge(j.numGlyphs,q)}}N.icon.dynamicLayoutVertexBuffer.updateData(q)}N.text.dynamicLayoutVertexBuffer.updateData(H)}function On(N,A,b){return b.iconsInText&&A?"symbolTextAndIcon":N?"symbolSDF":"symbolIcon"}function qs(N,A,b,L,k,y,a,d,_,B,S,U){const H=N.context,q=H.gl,w=N.transform,T=d==="map",R=_==="map",j=d!=="viewport"&&b.layout.get("symbol-placement")!=="point",Z=T&&!R&&!j,W=!b.layout.get("symbol-sort-key").isConstant();let J=!1;const ee=N.depthModeForSublayer(0,ri.ReadOnly),ae=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=[];for(const pe of L){const xe=A.getTile(pe),Pe=xe.getBucket(b);if(!Pe)continue;const Le=k?Pe.text:Pe.icon;if(!Le||!Le.segments.get().length||!Le.hasVisibleVertices)continue;const rt=Le.programConfigurations.get(b.id),Ke=k||Pe.sdfIcons,Re=k?Pe.textSizeData:Pe.iconSizeData,Qe=R||w.pitch!==0,pt=N.useProgram(On(Ke,k,Pe),rt),bt=s.ah(Re,w.zoom),ht=N.style.map.terrain&&N.style.map.terrain.getTerrainData(pe);let Rt,Dt,hi,Vt,_i=[0,0],Si=null;if(k)Dt=xe.glyphAtlasTexture,hi=q.LINEAR,Rt=xe.glyphAtlasTexture.size,Pe.iconsInText&&(_i=xe.imageAtlasTexture.size,Si=xe.imageAtlasTexture,Vt=Qe||N.options.rotating||N.options.zooming||Re.kind==="composite"||Re.kind==="camera"?q.LINEAR:q.NEAREST);else{const Nr=b.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;Dt=xe.imageAtlasTexture,hi=Ke||N.options.rotating||N.options.zooming||Nr||Qe?q.LINEAR:q.NEAREST,Rt=xe.imageAtlasTexture.size}const Yi=Me(xe,1,N.transform.zoom),Ti=$t(pe.posMatrix,R,T,N.transform,Yi),yr=Zi(pe.posMatrix,R,T,N.transform,Yi),fr=ae&&Pe.hasTextData(),ji=b.layout.get("icon-text-fit")!=="none"&&fr&&Pe.hasIconData();if(j){const Nr=N.style.map.terrain?(_r,or)=>N.style.map.terrain.getElevation(pe,_r,or):null,pr=b.layout.get("text-rotation-alignment")==="map";Gt(Pe,pe.posMatrix,N,k,Ti,yr,R,B,pr,Nr)}const Ur=N.translatePosMatrix(pe.posMatrix,xe,y,a),rn=j||k&&ae||ji?Hn:Ti,Mr=N.translatePosMatrix(yr,xe,y,a,!0),Kr=Ke&&b.paint.get(k?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=Ke?Pe.iconsInText?To(Re.kind,bt,Z,R,N,Ur,rn,Mr,Rt,_i):Jn(Re.kind,bt,Z,R,N,Ur,rn,Mr,k,Rt,!0):Dl(Re.kind,bt,Z,R,N,Ur,rn,Mr,k,Rt);const es={program:pt,buffers:Le,uniformValues:Cr,atlasTexture:Dt,atlasTextureIcon:Si,atlasInterpolation:hi,atlasInterpolationIcon:Vt,isSDF:Ke,hasHalo:Kr};if(W&&Pe.canOverlap){J=!0;const Nr=Le.segments.get();for(const pr of Nr)fe.push({segments:new s.S([pr]),sortKey:pr.sortKey,state:es,terrainData:ht})}else fe.push({segments:Le.segments,sortKey:0,state:es,terrainData:ht})}J&&fe.sort((pe,xe)=>pe.sortKey-xe.sortKey);for(const pe of fe){const xe=pe.state;if(H.activeTexture.set(q.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,q.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(H.activeTexture.set(q.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),xe.isSDF){const Pe=xe.uniformValues;xe.hasHalo&&(Pe.u_is_halo=1,eo(xe.buffers,pe.segments,b,N,xe.program,ee,S,U,Pe,pe.terrainData)),Pe.u_is_halo=0}eo(xe.buffers,pe.segments,b,N,xe.program,ee,S,U,xe.uniformValues,pe.terrainData)}}function eo(N,A,b,L,k,y,a,d,_,B){const S=L.context;k.draw(S,S.gl.TRIANGLES,y,a,d,ki.disabled,_,B,b.id,N.layoutVertexBuffer,N.indexBuffer,A,b.paint,L.transform.zoom,N.programConfigurations.get(b.id),N.dynamicLayoutVertexBuffer,N.opacityVertexBuffer)}function Lo(N,A,b,L,k){if(!b||!L||!L.imageAtlas)return;const y=L.imageAtlas.patternPositions;let a=y[b.to.toString()],d=y[b.from.toString()];if(!a&&d&&(a=d),!d&&a&&(d=a),!a||!d){const _=k.getPaintProperty(A);a=y[_],d=y[_]}a&&d&&N.setConstantPatternPositions(a,d)}function Ta(N,A,b,L,k,y,a){const d=N.context.gl,_="fill-pattern",B=b.paint.get(_),S=B&&B.constantOr(1),U=b.getCrossfadeParameters();let H,q,w,T,R;a?(q=S&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=d.LINES):(q=S?"fillPattern":"fill",H=d.TRIANGLES);const j=B.constantOr(null);for(const Z of L){const W=A.getTile(Z);if(S&&!W.patternsLoaded())continue;const J=W.getBucket(b);if(!J)continue;const ee=J.programConfigurations.get(b.id),ae=N.useProgram(q,ee),fe=N.style.map.terrain&&N.style.map.terrain.getTerrainData(Z);S&&(N.context.activeTexture.set(d.TEXTURE0),W.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),ee.updatePaintBuffers(U)),Lo(ee,_,j,W,b);const pe=fe?Z:null,xe=N.translatePosMatrix(pe?pe.posMatrix:Z.posMatrix,W,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));if(a){T=J.indexBuffer2,R=J.segments2;const Pe=[d.drawingBufferWidth,d.drawingBufferHeight];w=q==="fillOutlinePattern"&&S?Ne(xe,N,U,W,Pe):Ea(xe,Pe)}else T=J.indexBuffer,R=J.segments,w=S?uo(xe,N,U,W):ca(xe);ae.draw(N.context,H,k,N.stencilModeForClipping(Z),y,ki.disabled,w,fe,b.id,J.layoutVertexBuffer,T,R,b.paint,N.transform.zoom,ee)}}function fa(N,A,b,L,k,y,a){const d=N.context,_=d.gl,B="fill-extrusion-pattern",S=b.paint.get(B),U=S.constantOr(1),H=b.getCrossfadeParameters(),q=b.paint.get("fill-extrusion-opacity"),w=S.constantOr(null);for(const T of L){const R=A.getTile(T),j=R.getBucket(b);if(!j)continue;const Z=N.style.map.terrain&&N.style.map.terrain.getTerrainData(T),W=j.programConfigurations.get(b.id),J=N.useProgram(U?"fillExtrusionPattern":"fillExtrusion",W);U&&(N.context.activeTexture.set(_.TEXTURE0),R.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),W.updatePaintBuffers(H)),Lo(W,B,w,R,b);const ee=N.translatePosMatrix(T.posMatrix,R,b.paint.get("fill-extrusion-translate"),b.paint.get("fill-extrusion-translate-anchor")),ae=b.paint.get("fill-extrusion-vertical-gradient"),fe=U?Hs(ee,N,ae,q,T,H,R):Hr(ee,N,ae,q);J.draw(d,d.gl.TRIANGLES,k,y,a,ki.backCCW,fe,Z,b.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,b.paint,N.transform.zoom,W,N.style.map.terrain&&j.centroidVertexBuffer)}}function zl(N,A,b,L,k,y,a){const d=N.context,_=d.gl,B=b.fbo;if(!B)return;const S=N.useProgram("hillshade"),U=N.style.map.terrain&&N.style.map.terrain.getTerrainData(A);d.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,B.colorAttachment.get()),S.draw(d,_.TRIANGLES,k,y,a,ki.disabled,((H,q,w,T)=>{const R=w.paint.get("hillshade-shadow-color"),j=w.paint.get("hillshade-highlight-color"),Z=w.paint.get("hillshade-accent-color");let W=w.paint.get("hillshade-illumination-direction")*(Math.PI/180);w.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=H.transform.angle);const J=!H.options.moving;return{u_matrix:T?T.posMatrix:H.transform.calculatePosMatrix(q.tileID.toUnwrapped(),J),u_image:0,u_latrange:br(0,q.tileID),u_light:[w.paint.get("hillshade-exaggeration"),W],u_shadow:R,u_highlight:j,u_accent:Z}})(N,b,L,U?A:null),U,L.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments)}function ol(N,A,b,L,k,y){const a=N.context,d=a.gl,_=A.dem;if(_&&_.data){const B=_.dim,S=_.stride,U=_.getPixels();if(a.activeTexture.set(d.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),A.demTexture=A.demTexture||N.getTileTexture(S),A.demTexture){const q=A.demTexture;q.update(U,{premultiply:!1}),q.bind(d.NEAREST,d.CLAMP_TO_EDGE)}else A.demTexture=new nt(a,U,d.RGBA,{premultiply:!1}),A.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);a.activeTexture.set(d.TEXTURE0);let H=A.fbo;if(!H){const q=new nt(a,{width:B,height:B,data:null},d.RGBA);q.bind(d.LINEAR,d.CLAMP_TO_EDGE),H=A.fbo=a.createFramebuffer(B,B,!0,!1),H.colorAttachment.set(q.texture)}a.bindFramebuffer.set(H.framebuffer),a.viewport.set([0,0,B,B]),N.useProgram("hillshadePrepare").draw(a,d.TRIANGLES,L,k,y,ki.disabled,((q,w)=>{const T=w.stride,R=s.Z();return s.aS(R,0,s.N,-s.N,0,0,1),s.$(R,R,[0,-s.N,0]),{u_matrix:R,u_image:1,u_dimension:[T,T],u_zoom:q.overscaledZ,u_unpack:w.getUnpackVector()}})(A.tileID,_),null,b.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments),A.needsHillshadePrepare=!1}}function Ql(N,A,b,L,k,y){const a=L.paint.get("raster-fade-duration");if(!y&&a>0){const d=s.h.now(),_=(d-N.timeAdded)/a,B=A?(d-A.timeAdded)/a:-1,S=b.getSource(),U=k.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),H=!A||Math.abs(A.tileID.overscaledZ-U)>Math.abs(N.tileID.overscaledZ-U),q=H&&N.refreshedUponExpiration?1:s.ad(H?_:1-B,0,1);return N.refreshedUponExpiration&&_>=1&&(N.refreshedUponExpiration=!1),A?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const hc=new s.aT(1,0,0,1),pa=new s.aT(0,1,0,1),Ps=new s.aT(0,0,1,1),al=new s.aT(1,0,1,1),Vl=new s.aT(0,1,1,1);function Ia(N,A,b,L){Fs(N,0,A+b/2,N.transform.width,b,L)}function La(N,A,b,L){Fs(N,A-b/2,0,b,N.transform.height,L)}function Fs(N,A,b,L,k,y){const a=N.context,d=a.gl;d.enable(d.SCISSOR_TEST),d.scissor(A*N.pixelRatio,b*N.pixelRatio,L*N.pixelRatio,k*N.pixelRatio),a.clear({color:y}),d.disable(d.SCISSOR_TEST)}function Lu(N,A,b){const L=N.context,k=L.gl,y=b.posMatrix,a=N.useProgram("debug"),d=ri.disabled,_=qi.disabled,B=N.colorModeForRenderPass(),S="$debug",U=N.style.map.terrain&&N.style.map.terrain.getTerrainData(b);L.activeTexture.set(k.TEXTURE0);const H=A.getTileByID(b.key).latestRawTileData,q=Math.floor((H&&H.byteLength||0)/1024),w=A.getTile(b).tileSize,T=512/Math.min(w,512)*(b.overscaledZ/N.transform.zoom)*.5;let R=b.canonical.toString();b.overscaledZ!==b.canonical.z&&(R+=` => ${b.overscaledZ}`),function(j,Z){j.initDebugOverlayCanvas();const W=j.debugOverlayCanvas,J=j.context.gl,ee=j.debugOverlayCanvas.getContext("2d");ee.clearRect(0,0,W.width,W.height),ee.shadowColor="white",ee.shadowBlur=2,ee.lineWidth=1.5,ee.strokeStyle="white",ee.textBaseline="top",ee.font="bold 36px Open Sans, sans-serif",ee.fillText(Z,5,5),ee.strokeText(Z,5,5),j.debugOverlayTexture.update(W),j.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)}(N,`${R} ${q}kB`),a.draw(L,k.TRIANGLES,d,_,Tt.alphaBlended,ki.disabled,Ot(y,s.aT.transparent,T),null,S,N.debugBuffer,N.quadTriangleIndexBuffer,N.debugSegments),a.draw(L,k.LINE_STRIP,d,_,B,ki.disabled,Ot(y,s.aT.red),U,S,N.debugBuffer,N.tileBorderIndexBuffer,N.debugSegments)}function Sn(N,A,b){const L=N.context,k=L.gl,y=N.colorModeForRenderPass(),a=new ri(k.LEQUAL,ri.ReadWrite,N.depthRangeFor3D),d=N.useProgram("terrain"),_=A.getTerrainMesh();L.bindFramebuffer.set(null),L.viewport.set([0,0,N.width,N.height]);for(const B of b){const S=N.renderToTexture.getTexture(B),U=A.getTerrainData(B.tileID);L.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,S.texture);const H={u_matrix:N.transform.calculatePosMatrix(B.tileID.toUnwrapped()),u_texture:0,u_ele_delta:A.getMeshFrameDelta(N.transform.zoom)};d.draw(L,k.TRIANGLES,a,qi.disabled,y,ki.backCCW,H,U,"terrain",_.vertexBuffer,_.indexBuffer,_.segments)}}class on{constructor(A,b){this.context=new pi(A),this.transform=b,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=jt.maxUnderzooming+jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ps}resize(A,b,L){if(this.width=Math.floor(A*L),this.height=Math.floor(b*L),this.pixelRatio=L,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const k of this.style._order)this.style._layers[k].resize()}setup(){const A=this.context,b=new s.a_;b.emplaceBack(0,0),b.emplaceBack(s.N,0),b.emplaceBack(0,s.N),b.emplaceBack(s.N,s.N),this.tileExtentBuffer=A.createVertexBuffer(b,Js.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const L=new s.a_;L.emplaceBack(0,0),L.emplaceBack(s.N,0),L.emplaceBack(0,s.N),L.emplaceBack(s.N,s.N),this.debugBuffer=A.createVertexBuffer(L,Js.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const k=new s.V;k.emplaceBack(0,0,0,0),k.emplaceBack(s.N,0,s.N,0),k.emplaceBack(0,s.N,0,s.N),k.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=A.createVertexBuffer(k,It.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const y=new s.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=A.createVertexBuffer(y,Js.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const a=new s.a$;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=A.createIndexBuffer(a);const d=new s.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=A.createIndexBuffer(d);const _=this.context.gl;this.stencilClearMode=new qi({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)}clearStencil(){const A=this.context,b=A.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const L=s.Z();s.aS(L,0,this.width,this.height,0,0,1),s.a0(L,L,[b.drawingBufferWidth,b.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(A,b.TRIANGLES,ri.disabled,this.stencilClearMode,Tt.disabled,ki.disabled,ui(L),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(A,b){if(this.currentStencilSource===A.source||!A.isTileClipped()||!b||!b.length)return;this.currentStencilSource=A.source;const L=this.context,k=L.gl;this.nextStencilID+b.length>256&&this.clearStencil(),L.setColorMode(Tt.disabled),L.setDepthMode(ri.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of b){const d=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,_=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a);y.draw(L,k.TRIANGLES,ri.disabled,new qi({func:k.ALWAYS,mask:0},d,255,k.KEEP,k.KEEP,k.REPLACE),Tt.disabled,ki.disabled,ui(a.posMatrix),_,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const A=this.nextStencilID++,b=this.context.gl;return new qi({func:b.NOTEQUAL,mask:255},A,255,b.KEEP,b.KEEP,b.REPLACE)}stencilModeForClipping(A){const b=this.context.gl;return new qi({func:b.EQUAL,mask:255},this._tileClippingMaskIDs[A.key],0,b.KEEP,b.KEEP,b.REPLACE)}stencilConfigForOverlap(A){const b=this.context.gl,L=A.sort((a,d)=>d.overscaledZ-a.overscaledZ),k=L[L.length-1].overscaledZ,y=L[0].overscaledZ-k+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const a={};for(let d=0;d<y;d++)a[d+k]=new qi({func:b.GEQUAL,mask:255},d+this.nextStencilID,255,b.KEEP,b.KEEP,b.REPLACE);return this.nextStencilID+=y,[a,L]}return[{[k]:qi.disabled},L]}colorModeForRenderPass(){const A=this.context.gl;return this._showOverdrawInspector?new Tt([A.CONSTANT_COLOR,A.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tt.unblended:Tt.alphaBlended}depthModeForSublayer(A,b,L){if(!this.opaquePassEnabledForLayer())return ri.disabled;const k=1-((1+this.currentLayer)*this.numSublayers+A)*this.depthEpsilon;return new ri(L||this.context.gl.LEQUAL,b,[k,k])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(A,b){this.style=A,this.options=b,this.lineAtlas=A.lineAtlas,this.imageManager=A.imageManager,this.glyphManager=A.glyphManager,this.symbolFadeChange=A.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const L=this.style._order,k=this.style.sourceCaches,y={},a={},d={};for(const _ in k){const B=k[_];B.used&&B.prepare(this.context),y[_]=B.getVisibleCoordinates(),a[_]=y[_].slice().reverse(),d[_]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let _=0;_<L.length;_++)if(this.style._layers[L[_]].is3D()){this.opaquePassCutoff=_;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const _=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||_.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,S){const U=B.context,H=U.gl,q=Tt.unblended,w=new ri(H.LEQUAL,ri.ReadWrite,[0,1]),T=S.getTerrainMesh(),R=S.sourceCache.getRenderableTiles(),j=B.useProgram("terrainDepth");U.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1});for(const Z of R){const W=S.getTerrainData(Z.tileID),J={u_matrix:B.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(B.transform.zoom)};j.draw(U,H.TRIANGLES,w,qi.disabled,q,ki.backCCW,J,W,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain),function(B,S){const U=B.context,H=U.gl,q=Tt.unblended,w=new ri(H.LEQUAL,ri.ReadWrite,[0,1]),T=S.getTerrainMesh(),R=S.getCoordsTexture(),j=S.sourceCache.getRenderableTiles(),Z=B.useProgram("terrainCoords");U.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1}),S.coordsIndex=[];for(const W of j){const J=S.getTerrainData(W.tileID);U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,R.texture);const ee={u_matrix:B.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(B.transform.zoom)};Z.draw(U,H.TRIANGLES,w,qi.disabled,q,ki.backCCW,ee,J,"terrain",T.vertexBuffer,T.indexBuffer,T.segments),S.coordsIndex.push(W.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const _ of L){const B=this.style._layers[_];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const S=a[B.source];(B.type==="custom"||S.length)&&this.renderLayer(this,k[B.source],B,S)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:b.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=b.showOverdrawInspector,this.depthRangeFor3D=[0,1-(A._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const _=this.style._layers[L[this.currentLayer]],B=k[_.source],S=y[_.source];this._renderTileClippingMasks(_,S),this.renderLayer(this,B,_,S)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const _=this.style._layers[L[this.currentLayer]],B=k[_.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(_))continue;const S=(_.type==="symbol"?d:a)[_.source];this._renderTileClippingMasks(_,y[_.source]),this.renderLayer(this,B,_,S)}if(this.options.showTileBoundaries){const _=function(B,S){let U=null;const H=Object.values(B._layers).flatMap(R=>R.source&&!R.isHidden(S)?[B.sourceCaches[R.source]]:[]),q=H.filter(R=>R.getSource().type==="vector"),w=H.filter(R=>R.getSource().type!=="vector"),T=R=>{(!U||U.getSource().maxzoom<R.getSource().maxzoom)&&(U=R)};return q.forEach(R=>T(R)),U||w.forEach(R=>T(R)),U}(this.style,this.transform.zoom);_&&function(B,S,U){for(let H=0;H<U.length;H++)Lu(B,S,U[H])}(this,_,_.getVisibleCoordinates())}this.options.showPadding&&function(_){const B=_.transform.padding;Ia(_,_.transform.height-(B.top||0),3,hc),Ia(_,B.bottom||0,3,pa),La(_,B.left||0,3,Ps),La(_,_.transform.width-(B.right||0),3,al);const S=_.transform.centerPoint;(function(U,H,q,w){Fs(U,H-1,q-10,2,20,w),Fs(U,H-10,q-1,20,2,w)})(_,S.x,_.transform.height-S.y,Vl)}(this),this.context.setDefault()}renderLayer(A,b,L,k){if(!L.isHidden(this.transform.zoom)&&(L.type==="background"||L.type==="custom"||(k||[]).length))switch(this.id=L.id,L.type){case"symbol":(function(y,a,d,_,B){if(y.renderPass!=="translucent")return;const S=qi.disabled,U=y.colorModeForRenderPass();(d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,q,w,T,R,j,Z){const W=q.transform,J=R==="map",ee=j==="map";for(const ae of H){const fe=T.getTile(ae),pe=fe.getBucket(w);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const xe=s.ah(pe.textSizeData,W.zoom),Pe=Me(fe,1,q.transform.zoom),Le=$t(ae.posMatrix,ee,J,q.transform,Pe),rt=w.layout.get("icon-text-fit")!=="none"&&pe.hasIconData();if(xe){const Ke=Math.pow(2,W.zoom-fe.tileID.overscaledZ);Lr(pe,J,ee,Z,W,Le,ae.posMatrix,Ke,xe,rt,q.style.map.terrain?(Re,Qe)=>q.style.map.terrain.getElevation(ae,Re,Qe):null)}}}(_,y,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),B),d.paint.get("icon-opacity").constantOr(1)!==0&&qs(y,a,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),S,U),d.paint.get("text-opacity").constantOr(1)!==0&&qs(y,a,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),S,U),a.map.showCollisionBoxes&&(nr(y,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),nr(y,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))})(A,b,L,k,this.style.placement.variableOffsets);break;case"circle":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("circle-opacity"),S=d.paint.get("circle-stroke-width"),U=d.paint.get("circle-stroke-opacity"),H=!d.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(S.constantOr(1)===0||U.constantOr(1)===0))return;const q=y.context,w=q.gl,T=y.depthModeForSublayer(0,ri.ReadOnly),R=qi.disabled,j=y.colorModeForRenderPass(),Z=[];for(let W=0;W<_.length;W++){const J=_[W],ee=a.getTile(J),ae=ee.getBucket(d);if(!ae)continue;const fe=ae.programConfigurations.get(d.id),pe=y.useProgram("circle",fe),xe=ae.layoutVertexBuffer,Pe=ae.indexBuffer,Le=y.style.map.terrain&&y.style.map.terrain.getTerrainData(J),rt={programConfiguration:fe,program:pe,layoutVertexBuffer:xe,indexBuffer:Pe,uniformValues:Ze(y,J,ee,d),terrainData:Le};if(H){const Ke=ae.segments.get();for(const Re of Ke)Z.push({segments:new s.S([Re]),sortKey:Re.sortKey,state:rt})}else Z.push({segments:ae.segments,sortKey:0,state:rt})}H&&Z.sort((W,J)=>W.sortKey-J.sortKey);for(const W of Z){const{programConfiguration:J,program:ee,layoutVertexBuffer:ae,indexBuffer:fe,uniformValues:pe,terrainData:xe}=W.state;ee.draw(q,w.TRIANGLES,T,R,j,ki.disabled,pe,xe,d.id,ae,fe,W.segments,d.paint,y.transform.zoom,J)}})(A,b,L,k);break;case"heatmap":(function(y,a,d,_){if(d.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const B=y.context,S=B.gl,U=qi.disabled,H=new Tt([S.ONE,S.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(q,w,T){const R=q.gl;q.activeTexture.set(R.TEXTURE1),q.viewport.set([0,0,w.width/4,w.height/4]);let j=T.heatmapFbo;if(j)R.bindTexture(R.TEXTURE_2D,j.colorAttachment.get()),q.bindFramebuffer.set(j.framebuffer);else{const Z=R.createTexture();R.bindTexture(R.TEXTURE_2D,Z),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),j=T.heatmapFbo=q.createFramebuffer(w.width/4,w.height/4,!1,!1),function(W,J,ee,ae){var fe,pe;const xe=W.gl,Pe=(fe=W.HALF_FLOAT)!==null&&fe!==void 0?fe:xe.UNSIGNED_BYTE,Le=(pe=W.RGBA16F)!==null&&pe!==void 0?pe:xe.RGBA;xe.texImage2D(xe.TEXTURE_2D,0,Le,J.width/4,J.height/4,0,xe.RGBA,Pe,null),ae.colorAttachment.set(ee)}(q,w,Z,j)}})(B,y,d),B.clear({color:s.aT.transparent});for(let q=0;q<_.length;q++){const w=_[q];if(a.hasRenderableParent(w))continue;const T=a.getTile(w),R=T.getBucket(d);if(!R)continue;const j=R.programConfigurations.get(d.id),Z=y.useProgram("heatmap",j),{zoom:W}=y.transform;Z.draw(B,S.TRIANGLES,ri.disabled,U,H,ki.disabled,Gi(w.posMatrix,T,W,d.paint.get("heatmap-intensity")),null,d.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,d.paint,y.transform.zoom,j)}B.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(B,S){const U=B.context,H=U.gl,q=S.heatmapFbo;if(!q)return;U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,q.colorAttachment.get()),U.activeTexture.set(H.TEXTURE1);let w=S.colorRampTexture;w||(w=S.colorRampTexture=new nt(U,S.colorRamp,H.RGBA)),w.bind(H.LINEAR,H.CLAMP_TO_EDGE),B.useProgram("heatmapTexture").draw(U,H.TRIANGLES,ri.disabled,qi.disabled,B.colorModeForRenderPass(),ki.disabled,((T,R,j,Z)=>{const W=s.Z();s.aS(W,0,T.width,T.height,0,0,1);const J=T.context.gl;return{u_matrix:W,u_world:[J.drawingBufferWidth,J.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}})(B,S),null,S.id,B.viewportBuffer,B.quadTriangleIndexBuffer,B.viewportSegments,S.paint,B.transform.zoom)}(y,d))})(A,b,L,k);break;case"line":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("line-opacity"),S=d.paint.get("line-width");if(B.constantOr(1)===0||S.constantOr(1)===0)return;const U=y.depthModeForSublayer(0,ri.ReadOnly),H=y.colorModeForRenderPass(),q=d.paint.get("line-dasharray"),w=d.paint.get("line-pattern"),T=w.constantOr(1),R=d.paint.get("line-gradient"),j=d.getCrossfadeParameters(),Z=T?"linePattern":q?"lineSDF":R?"lineGradient":"line",W=y.context,J=W.gl;let ee=!0;for(const ae of _){const fe=a.getTile(ae);if(T&&!fe.patternsLoaded())continue;const pe=fe.getBucket(d);if(!pe)continue;const xe=pe.programConfigurations.get(d.id),Pe=y.context.program.get(),Le=y.useProgram(Z,xe),rt=ee||Le.program!==Pe,Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ae),Re=w.constantOr(null);if(Re&&fe.imageAtlas){const bt=fe.imageAtlas,ht=bt.patternPositions[Re.to.toString()],Rt=bt.patternPositions[Re.from.toString()];ht&&Rt&&xe.setConstantPatternPositions(ht,Rt)}const Qe=Ke?ae:null,pt=T?is(y,fe,d,j,Qe):q?wn(y,fe,d,q,j,Qe):R?kn(y,fe,d,pe.lineClipsArray.length,Qe):En(y,fe,d,Qe);if(T)W.activeTexture.set(J.TEXTURE0),fe.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),xe.updatePaintBuffers(j);else if(q&&(rt||y.lineAtlas.dirty))W.activeTexture.set(J.TEXTURE0),y.lineAtlas.bind(W);else if(R){const bt=pe.gradients[d.id];let ht=bt.texture;if(d.gradientVersion!==bt.version){let Rt=256;if(d.stepInterpolant){const Dt=a.getSource().maxzoom,hi=ae.canonical.z===Dt?Math.ceil(1<<y.transform.maxZoom-ae.canonical.z):1;Rt=s.ad(s.aY(pe.maxLineLength/s.N*1024*hi),256,W.maxTextureSize)}bt.gradient=s.aZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Rt,image:bt.gradient||void 0,clips:pe.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new nt(W,bt.gradient,J.RGBA),bt.version=d.gradientVersion,ht=bt.texture}W.activeTexture.set(J.TEXTURE0),ht.bind(d.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Le.draw(W,J.TRIANGLES,U,y.stencilModeForClipping(ae),H,ki.disabled,pt,Ke,d.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,d.paint,y.transform.zoom,xe,pe.layoutVertexBuffer2),ee=!1}})(A,b,L,k);break;case"fill":(function(y,a,d,_){const B=d.paint.get("fill-color"),S=d.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const U=y.colorModeForRenderPass(),H=d.paint.get("fill-pattern"),q=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&B.constantOr(s.aT.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===q){const w=y.depthModeForSublayer(1,y.renderPass==="opaque"?ri.ReadWrite:ri.ReadOnly);Ta(y,a,d,_,w,U,!1)}if(y.renderPass==="translucent"&&d.paint.get("fill-antialias")){const w=y.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ri.ReadOnly);Ta(y,a,d,_,w,U,!0)}})(A,b,L,k);break;case"fill-extrusion":(function(y,a,d,_){const B=d.paint.get("fill-extrusion-opacity");if(B!==0&&y.renderPass==="translucent"){const S=new ri(y.context.gl.LEQUAL,ri.ReadWrite,y.depthRangeFor3D);if(B!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))fa(y,a,d,_,S,qi.disabled,Tt.disabled),fa(y,a,d,_,S,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const U=y.colorModeForRenderPass();fa(y,a,d,_,S,qi.disabled,U)}}})(A,b,L,k);break;case"hillshade":(function(y,a,d,_){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const B=y.context,S=y.depthModeForSublayer(0,ri.ReadOnly),U=y.colorModeForRenderPass(),[H,q]=y.renderPass==="translucent"?y.stencilConfigForOverlap(_):[{},_];for(const w of q){const T=a.getTile(w);T.needsHillshadePrepare!==void 0&&T.needsHillshadePrepare&&y.renderPass==="offscreen"?ol(y,T,d,S,qi.disabled,U):y.renderPass==="translucent"&&zl(y,w,T,d,S,H[w.overscaledZ],U)}B.viewport.set([0,0,y.width,y.height])})(A,b,L,k);break;case"raster":(function(y,a,d,_){if(y.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;const B=y.context,S=B.gl,U=a.getSource(),H=y.useProgram("raster"),q=y.colorModeForRenderPass(),[w,T]=U instanceof Ht?[{},_]:y.stencilConfigForOverlap(_),R=T[T.length-1].overscaledZ,j=!y.options.moving;for(const Z of T){const W=y.depthModeForSublayer(Z.overscaledZ-R,d.paint.get("raster-opacity")===1?ri.ReadWrite:ri.ReadOnly,S.LESS),J=a.getTile(Z);J.registerFadeDuration(d.paint.get("raster-fade-duration"));const ee=a.findLoadedParent(Z,0),ae=Ql(J,ee,a,d,y.transform,y.style.map.terrain);let fe,pe;const xe=d.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;B.activeTexture.set(S.TEXTURE0),J.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(S.TEXTURE1),ee?(ee.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),fe=Math.pow(2,ee.tileID.overscaledZ-J.tileID.overscaledZ),pe=[J.tileID.canonical.x*fe%1,J.tileID.canonical.y*fe%1]):J.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const Pe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Z),Le=Pe?Z:null,rt=Le?Le.posMatrix:y.transform.calculatePosMatrix(Z.toUnwrapped(),j),Ke=Tr(rt,pe||[0,0],fe||1,ae,d);U instanceof Ht?H.draw(B,S.TRIANGLES,W,qi.disabled,q,ki.disabled,Ke,Pe,d.id,U.boundsBuffer,y.quadTriangleIndexBuffer,U.boundsSegments):H.draw(B,S.TRIANGLES,W,w[Z.overscaledZ],q,ki.disabled,Ke,Pe,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(A,b,L,k);break;case"background":(function(y,a,d,_){const B=d.paint.get("background-color"),S=d.paint.get("background-opacity");if(S===0)return;const U=y.context,H=U.gl,q=y.transform,w=q.tileSize,T=d.paint.get("background-pattern");if(y.isPatternMissing(T))return;const R=!T&&B.a===1&&S===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==R)return;const j=qi.disabled,Z=y.depthModeForSublayer(0,R==="opaque"?ri.ReadWrite:ri.ReadOnly),W=y.colorModeForRenderPass(),J=y.useProgram(T?"backgroundPattern":"background"),ee=_||q.coveringTiles({tileSize:w,terrain:y.style.map.terrain});T&&(U.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context));const ae=d.getCrossfadeParameters();for(const fe of ee){const pe=_?fe.posMatrix:y.transform.calculatePosMatrix(fe.toUnwrapped()),xe=T?gs(pe,S,y,T,{tileID:fe,tileSize:w},ae):Ga(pe,S,B),Pe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(fe);J.draw(U,H.TRIANGLES,Z,j,W,ki.disabled,xe,Pe,d.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(A,0,L,k);break;case"custom":(function(y,a,d){const _=y.context,B=d.implementation;if(y.renderPass==="offscreen"){const S=B.prerender;S&&(y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),S.call(B,_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),_.setStencilMode(qi.disabled);const S=B.renderingMode==="3d"?new ri(y.context.gl.LEQUAL,ri.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,ri.ReadOnly);_.setDepthMode(S),B.render(_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState(),_.bindFramebuffer.set(null)}})(A,0,L)}}translatePosMatrix(A,b,L,k,y){if(!L[0]&&!L[1])return A;const a=y?k==="map"?this.transform.angle:0:k==="viewport"?-this.transform.angle:0;if(a){const B=Math.sin(a),S=Math.cos(a);L=[L[0]*S-L[1]*B,L[0]*B+L[1]*S]}const d=[y?L[0]:Me(b,L[0],this.transform.zoom),y?L[1]:Me(b,L[1],this.transform.zoom),0],_=new Float32Array(16);return s.$(_,A,d),_}saveTileTexture(A){const b=this._tileTextures[A.size[0]];b?b.push(A):this._tileTextures[A.size[0]]=[A]}getTileTexture(A){const b=this._tileTextures[A];return b&&b.length>0?b.pop():null}isPatternMissing(A){if(!A)return!1;if(!A.from||!A.to)return!0;const b=this.imageManager.getPattern(A.from.toString()),L=this.imageManager.getPattern(A.to.toString());return!b||!L}useProgram(A,b){this.cache=this.cache||{};const L=A+(b?b.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[L]||(this.cache[L]=new Cn(this.context,dr[A],b,ua[A],this._showOverdrawInspector,this.style.map.terrain)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const A=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(A.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:A,drawingBufferHeight:b}=this.context.gl;return this.width!==A||this.height!==b}}class fn{constructor(A,b){this.points=A,this.planes=b}static fromInvProjectionMatrix(A,b,L){const k=Math.pow(2,L),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(d=>{const _=1/(d=s.ag([],d,A))[3]/b*k;return s.b3(d,d,[_,_,1/d[3],_])}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(d=>{const _=function(H,q){var w=q[0],T=q[1],R=q[2],j=w*w+T*T+R*R;return j>0&&(j=1/Math.sqrt(j)),H[0]=q[0]*j,H[1]=q[1]*j,H[2]=q[2]*j,H}([],function(H,q,w){var T=q[0],R=q[1],j=q[2],Z=w[0],W=w[1],J=w[2];return H[0]=R*J-j*W,H[1]=j*Z-T*J,H[2]=T*W-R*Z,H}([],Ge([],y[d[0]],y[d[1]]),Ge([],y[d[2]],y[d[1]]))),B=-((S=_)[0]*(U=y[d[1]])[0]+S[1]*U[1]+S[2]*U[2]);var S,U;return _.concat(B)});return new fn(y,a)}}class Yn{constructor(A,b){this.min=A,this.max=b,this.center=function(L,k,y){return L[0]=.5*k[0],L[1]=.5*k[1],L[2]=.5*k[2],L}([],function(L,k,y){return L[0]=k[0]+y[0],L[1]=k[1]+y[1],L[2]=k[2]+y[2],L}([],this.min,this.max))}quadrant(A){const b=[A%2==0,A<2],L=Te(this.min),k=Te(this.max);for(let y=0;y<b.length;y++)L[y]=b[y]?this.min[y]:this.center[y],k[y]=b[y]?this.center[y]:this.max[y];return k[2]=this.max[2],new Yn(L,k)}distanceX(A){return Math.max(Math.min(this.max[0],A[0]),this.min[0])-A[0]}distanceY(A){return Math.max(Math.min(this.max[1],A[1]),this.min[1])-A[1]}intersects(A){const b=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let L=!0;for(let k=0;k<A.planes.length;k++){const y=A.planes[k];let a=0;for(let d=0;d<b.length;d++)s.b4(y,b[d])>=0&&a++;if(a===0)return 0;a!==b.length&&(L=!1)}if(L)return 2;for(let k=0;k<3;k++){let y=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let d=0;d<A.points.length;d++){const _=A.points[d][k]-this.min[k];y=Math.min(y,_),a=Math.max(a,_)}if(a<0||y>this.max[k]-this.min[k])return 0}return 1}}class ll{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(A)||A<0||isNaN(b)||b<0||isNaN(L)||L<0||isNaN(k)||k<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=A,this.bottom=b,this.left=L,this.right=k}interpolate(A,b,L){return b.top!=null&&A.top!=null&&(this.top=s.B.number(A.top,b.top,L)),b.bottom!=null&&A.bottom!=null&&(this.bottom=s.B.number(A.bottom,b.bottom,L)),b.left!=null&&A.left!=null&&(this.left=s.B.number(A.left,b.left,L)),b.right!=null&&A.right!=null&&(this.right=s.B.number(A.right,b.right,L)),this}getCenter(A,b){const L=s.ad((this.left+A-this.right)/2,0,A),k=s.ad((this.top+b-this.bottom)/2,0,b);return new s.P(L,k)}equals(A){return this.top===A.top&&this.bottom===A.bottom&&this.left===A.left&&this.right===A.right}clone(){return new ll(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class cl{constructor(A,b,L,k,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=A||0,this._maxZoom=b||22,this._minPitch=L??0,this._maxPitch=k??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ll,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const A=new cl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return A.apply(this),A}apply(A){this.tileSize=A.tileSize,this.latRange=A.latRange,this.width=A.width,this.height=A.height,this._center=A._center,this._elevation=A._elevation,this._minEleveationForCurrentTile=A._minEleveationForCurrentTile,this.zoom=A.zoom,this.angle=A.angle,this._fov=A._fov,this._pitch=A._pitch,this._unmodified=A._unmodified,this._edgeInsets=A._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(A){this._minZoom!==A&&(this._minZoom=A,this.zoom=Math.max(this.zoom,A))}get maxZoom(){return this._maxZoom}set maxZoom(A){this._maxZoom!==A&&(this._maxZoom=A,this.zoom=Math.min(this.zoom,A))}get minPitch(){return this._minPitch}set minPitch(A){this._minPitch!==A&&(this._minPitch=A,this.pitch=Math.max(this.pitch,A))}get maxPitch(){return this._maxPitch}set maxPitch(A){this._maxPitch!==A&&(this._maxPitch=A,this.pitch=Math.min(this.pitch,A))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(A){A===void 0?A=!0:A===null&&(A=!1),this._renderWorldCopies=A}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(A){const b=-s.b5(A,-180,180)*Math.PI/180;this.angle!==b&&(this._unmodified=!1,this.angle=b,this._calcMatrices(),this.rotationMatrix=function(){var L=new s.A(4);return s.A!=Float32Array&&(L[1]=0,L[2]=0),L[0]=1,L[3]=1,L}(),function(L,k,y){var a=k[0],d=k[1],_=k[2],B=k[3],S=Math.sin(y),U=Math.cos(y);L[0]=a*U+_*S,L[1]=d*U+B*S,L[2]=a*-S+_*U,L[3]=d*-S+B*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(A){const b=s.ad(A,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(A){A=Math.max(.01,Math.min(60,A)),this._fov!==A&&(this._unmodified=!1,this._fov=A/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(A){const b=Math.min(Math.max(A,this.minZoom),this.maxZoom);this._zoom!==b&&(this._unmodified=!1,this._zoom=b,this.tileZoom=Math.max(0,Math.floor(b)),this.scale=this.zoomScale(b),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(A){A.lat===this._center.lat&&A.lng===this._center.lng||(this._unmodified=!1,this._center=A,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(A){A!==this._elevation&&(this._elevation=A,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(A){this._edgeInsets.equals(A)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,A,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(A){return this._edgeInsets.equals(A)}interpolatePadding(A,b,L){this._unmodified=!1,this._edgeInsets.interpolate(A,b,L),this._constrain(),this._calcMatrices()}coveringZoomLevel(A){const b=(A.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/A.tileSize));return Math.max(0,b)}getVisibleUnwrappedCoordinates(A){const b=[new s.b6(0,A)];if(this._renderWorldCopies){const L=this.pointCoordinate(new s.P(0,0)),k=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),a=this.pointCoordinate(new s.P(0,this.height)),d=Math.floor(Math.min(L.x,k.x,y.x,a.x)),_=Math.floor(Math.max(L.x,k.x,y.x,a.x)),B=1;for(let S=d-B;S<=_+B;S++)S!==0&&b.push(new s.b6(S,A))}return b}coveringTiles(A){var b,L;let k=this.coveringZoomLevel(A);const y=k;if(A.minzoom!==void 0&&k<A.minzoom)return[];A.maxzoom!==void 0&&k>A.maxzoom&&(k=A.maxzoom);const a=this.pointCoordinate(this.getCameraPoint()),d=s.U.fromLngLat(this.center),_=Math.pow(2,k),B=[_*a.x,_*a.y,0],S=[_*d.x,_*d.y,0],U=fn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,k);let H=A.minzoom||0;!A.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=k);const q=A.terrain?2/Math.min(this.tileSize,A.tileSize)*this.tileSize:3,w=W=>({aabb:new Yn([W*_,0,0],[(W+1)*_,_,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),T=[],R=[],j=k,Z=A.reparseOverscaled?y:k;if(this._renderWorldCopies)for(let W=1;W<=3;W++)T.push(w(-W)),T.push(w(W));for(T.push(w(0));T.length>0;){const W=T.pop(),J=W.x,ee=W.y;let ae=W.fullyVisible;if(!ae){const Le=W.aabb.intersects(U);if(Le===0)continue;ae=Le===2}const fe=A.terrain?B:S,pe=W.aabb.distanceX(fe),xe=W.aabb.distanceY(fe),Pe=Math.max(Math.abs(pe),Math.abs(xe));if(W.zoom===j||Pe>q+(1<<j-W.zoom)-2&&W.zoom>=H){const Le=j-W.zoom,rt=B[0]-.5-(J<<Le),Ke=B[1]-.5-(ee<<Le);R.push({tileID:new s.O(W.zoom===j?Z:W.zoom,W.wrap,W.zoom,J,ee),distanceSq:$e([S[0]-.5-J,S[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(rt*rt+Ke*Ke)})}else for(let Le=0;Le<4;Le++){const rt=(J<<1)+Le%2,Ke=(ee<<1)+(Le>>1),Re=W.zoom+1;let Qe=W.aabb.quadrant(Le);if(A.terrain){const pt=new s.O(Re,W.wrap,Re,rt,Ke),bt=A.terrain.getMinMaxElevation(pt),ht=(b=bt.minElevation)!==null&&b!==void 0?b:this.elevation,Rt=(L=bt.maxElevation)!==null&&L!==void 0?L:this.elevation;Qe=new Yn([Qe.min[0],Qe.min[1],ht],[Qe.max[0],Qe.max[1],Rt])}T.push({aabb:Qe,zoom:Re,x:rt,y:Ke,wrap:W.wrap,fullyVisible:ae})}}return R.sort((W,J)=>W.distanceSq-J.distanceSq).map(W=>W.tileID)}resize(A,b){this.width=A,this.height=b,this.pixelsToGLUnits=[2/A,-2/b],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(A){return Math.pow(2,A)}scaleZoom(A){return Math.log(A)/Math.LN2}project(A){const b=s.ad(A.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(A.lng)*this.worldSize,s.H(b)*this.worldSize)}unproject(A){return new s.U(A.x/this.worldSize,A.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(A){const b=this.pointLocation(this.centerPoint,A),L=A.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-L))return;const k=this.getCameraPosition(),y=s.U.fromLngLat(k.lngLat,k.altitude),a=s.U.fromLngLat(b,L),d=y.x-a.x,_=y.y-a.y,B=y.z-a.z,S=Math.sqrt(d*d+_*_+B*B),U=this.scaleZoom(this.cameraToCenterDistance/S/this.tileSize);this._elevation=L,this._center=b,this.zoom=U}setLocationAtPoint(A,b){const L=this.pointCoordinate(b),k=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(A),a=new s.U(y.x-(L.x-k.x),y.y-(L.y-k.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(A,b){return b?this.coordinatePoint(this.locationCoordinate(A),b.getElevationForLngLatZoom(A,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(A))}pointLocation(A,b){return this.coordinateLocation(this.pointCoordinate(A,b))}locationCoordinate(A){return s.U.fromLngLat(A)}coordinateLocation(A){return A&&A.toLngLat()}pointCoordinate(A,b){if(b){const H=b.pointCoordinate(A);if(H!=null)return H}const L=[A.x,A.y,0,1],k=[A.x,A.y,1,1];s.ag(L,L,this.pixelMatrixInverse),s.ag(k,k,this.pixelMatrixInverse);const y=L[3],a=k[3],d=L[1]/y,_=k[1]/a,B=L[2]/y,S=k[2]/a,U=B===S?0:(0-B)/(S-B);return new s.U(s.B.number(L[0]/y,k[0]/a,U)/this.worldSize,s.B.number(d,_,U)/this.worldSize)}coordinatePoint(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const k=[A.x*this.worldSize,A.y*this.worldSize,b,1];return s.ag(k,k,L),new s.P(k[0]/k[3],k[1]/k[3])}getBounds(){const A=Math.max(0,this.height/2-this.getHorizon());return new Xe().extend(this.pointLocation(new s.P(0,A))).extend(this.pointLocation(new s.P(this.width,A))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(A){A?(this.lngRange=[A.getWest(),A.getEast()],this.latRange=[A.getSouth(),A.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const L=A.key,k=b?this._alignedPosMatrixCache:this._posMatrixCache;if(k[L])return k[L];const y=A.canonical,a=this.worldSize/this.zoomScale(y.z),d=y.x+Math.pow(2,y.z)*A.wrap,_=s.ao(new Float64Array(16));return s.$(_,_,[d*a,y.y*a,0]),s.a0(_,_,[a/s.N,a/s.N,1]),s.a1(_,b?this.alignedProjMatrix:this.projMatrix,_),k[L]=new Float32Array(_),k[L]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let A,b,L,k,y=-90,a=90,d=-180,_=180;const B=this.size,S=this._unmodified;if(this.latRange){const q=this.latRange;y=s.H(q[1])*this.worldSize,a=s.H(q[0])*this.worldSize,A=a-y<B.y?B.y/(a-y):0}if(this.lngRange){const q=this.lngRange;d=s.b5(s.G(q[0])*this.worldSize,0,this.worldSize),_=s.b5(s.G(q[1])*this.worldSize,0,this.worldSize),_<d&&(_+=this.worldSize),b=_-d<B.x?B.x/(_-d):0}const U=this.point,H=Math.max(b||0,A||0);if(H)return this.center=this.unproject(new s.P(b?(_+d)/2:U.x,A?(a+y)/2:U.y)),this.zoom+=this.scaleZoom(H),this._unmodified=S,void(this._constraining=!1);if(this.latRange){const q=U.y,w=B.y/2;q-w<y&&(k=y+w),q+w>a&&(k=a-w)}if(this.lngRange){const q=(d+_)/2,w=s.b5(U.x,q-this.worldSize/2,q+this.worldSize/2),T=B.x/2;w-T<d&&(L=d+T),w+T>_&&(L=_-T)}L===void 0&&k===void 0||(this.center=this.unproject(new s.P(L!==void 0?L:U.x,k!==void 0?k:U.y)).wrap()),this._unmodified=S,this._constraining=!1}_calcMatrices(){if(!this.height)return;const A=this.centerOffset,b=this.point.x,L=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let k=s.ao(new Float64Array(16));s.a0(k,k,[this.width/2,-this.height/2,1]),s.$(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.ao(new Float64Array(16)),s.a0(k,k,[1,-1,1]),s.$(k,k,[-1,-1,0]),s.a0(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),a=Math.min(this.elevation,this._minEleveationForCurrentTile),d=y-a*this._pixelPerMeter/Math.cos(this._pitch),_=a<0?d:y,B=Math.PI/2+this._pitch,S=this._fov*(.5+A.y/this.height),U=Math.sin(S)*_/Math.sin(s.ad(Math.PI-B-S,.01,Math.PI-.01)),H=this.getHorizon(),q=2*Math.atan(H/this.cameraToCenterDistance)*(.5+A.y/(2*H)),w=Math.sin(q)*_/Math.sin(s.ad(Math.PI-B-q,.01,Math.PI-.01)),T=Math.min(U,w),R=1.01*(Math.cos(Math.PI/2-this._pitch)*T+_),j=this.height/50;k=new Float64Array(16),s.b8(k,this._fov,this.width/this.height,j,R),k[8]=2*-A.x/this.width,k[9]=2*A.y/this.height,s.a0(k,k,[1,-1,1]),s.$(k,k,[0,0,-this.cameraToCenterDistance]),s.b9(k,k,this._pitch),s.ae(k,k,this.angle),s.$(k,k,[-b,-L,0]),this.mercatorMatrix=s.a0([],k,[this.worldSize,this.worldSize,this.worldSize]),s.a0(k,k,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,k),s.$(k,k,[0,0,-this.elevation]),this.projMatrix=k,this.invProjMatrix=s.as([],k),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,k);const Z=this.width%2/2,W=this.height%2/2,J=Math.cos(this.angle),ee=Math.sin(this.angle),ae=b-Math.round(b)+J*Z+ee*W,fe=L-Math.round(L)+J*W+ee*Z,pe=new Float64Array(k);if(s.$(pe,pe,[ae>.5?ae-1:ae,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=pe,k=s.as(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const A=this.pointCoordinate(new s.P(0,0)),b=[A.x*this.worldSize,A.y*this.worldSize,0,1];return s.ag(b,b,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const A=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,A))}getCameraQueryGeometry(A){const b=this.getCameraPoint();if(A.length===1)return[A[0],b];{let L=b.x,k=b.y,y=b.x,a=b.y;for(const d of A)L=Math.min(L,d.x),k=Math.min(k,d.y),y=Math.max(y,d.x),a=Math.max(a,d.y);return[new s.P(L,k),new s.P(y,k),new s.P(y,a),new s.P(L,a),new s.P(L,k)]}}}function fo(N,A){var b=this;let L,k=!1,y=null,a=null;const d=()=>{y=null,k&&(N.apply(a,L),y=setTimeout(d,A),k=!1)};return function(){for(var _=arguments.length,B=new Array(_),S=0;S<_;S++)B[S]=arguments[S];return k=!0,a=b,L=B,y||d(),y}}class ns{constructor(A){this._getCurrentHash=()=>{const b=window.location.hash.replace("#","");if(this._hashName){let L;return b.split("&").map(k=>k.split("=")).forEach(k=>{k[0]===this._hashName&&(L=k)}),(L&&L[1]||"").split("/")}return b.split("/")},this._onHashChange=()=>{const b=this._getCurrentHash();if(b.length>=3&&!b.some(L=>isNaN(L))){const L=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(b[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+b[2],+b[1]],zoom:+b[0],bearing:L,pitch:+(b[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const b=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,b)}catch{}},this._updateHash=fo(this._updateHashUnthrottled,300),this._hashName=A&&encodeURIComponent(A)}addTo(A){return this._map=A,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(A){const b=this._map.getCenter(),L=Math.round(100*this._map.getZoom())/100,k=Math.ceil((L*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,k),a=Math.round(b.lng*y)/y,d=Math.round(b.lat*y)/y,_=this._map.getBearing(),B=this._map.getPitch();let S="";if(S+=A?`/${a}/${d}/${L}`:`${L}/${d}/${a}`,(_||B)&&(S+="/"+Math.round(10*_)/10),B&&(S+=`/${Math.round(B)}`),this._hashName){const U=this._hashName;let H=!1;const q=window.location.hash.slice(1).split("&").map(w=>{const T=w.split("=")[0];return T===U?(H=!0,`${T}=${S}`):w}).filter(w=>w);return H||q.push(`${U}=${S}`),`#${q.join("&")}`}return`#${S}`}}const ss={linearity:.3,easing:s.ba(0,0,.3,1)},Mo=s.e({deceleration:2500,maxSpeed:1400},ss),Po=s.e({deceleration:20,maxSpeed:1400},ss),ga=s.e({deceleration:1e3,maxSpeed:360},ss),ul=s.e({deceleration:1e3,maxSpeed:90},ss);class to{constructor(A){this._map=A,this.clear()}clear(){this._inertiaBuffer=[]}record(A){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:A})}_drainInertiaBuffer(){const A=this._inertiaBuffer,b=s.h.now();for(;A.length>0&&b-A[0].time>160;)A.shift()}_onMoveEnd(A){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const b={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)b.zoom+=y.zoomDelta||0,b.bearing+=y.bearingDelta||0,b.pitch+=y.pitchDelta||0,y.panDelta&&b.pan._add(y.panDelta),y.around&&(b.around=y.around),y.pinchAround&&(b.pinchAround=y.pinchAround);const L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(b.pan.mag()){const y=po(b.pan.mag(),L,s.e({},Mo,A||{}));k.offset=b.pan.mult(y.amount/b.pan.mag()),k.center=this._map.transform.center,io(k,y)}if(b.zoom){const y=po(b.zoom,L,Po);k.zoom=this._map.transform.zoom+y.amount,io(k,y)}if(b.bearing){const y=po(b.bearing,L,ga);k.bearing=this._map.transform.bearing+s.ad(y.amount,-179,179),io(k,y)}if(b.pitch){const y=po(b.pitch,L,ul);k.pitch=this._map.transform.pitch+y.amount,io(k,y)}if(k.zoom||k.bearing){const y=b.pinchAround===void 0?b.around:b.pinchAround;k.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.e(k,{noMoveStart:!0})}}function io(N,A){(!N.duration||N.duration<A.duration)&&(N.duration=A.duration,N.easing=A.easing)}function po(N,A,b){const{maxSpeed:L,linearity:k,deceleration:y}=b,a=s.ad(N*k/(A/1e3),-L,L),d=Math.abs(a)/(y*k);return{easing:b.easing,duration:1e3*d,amount:a*(d/2)}}class ms extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const y=x.mousePos(b.getCanvasContainer(),L),a=b.unproject(y);super(A,s.e({point:y,lngLat:a,originalEvent:L},k)),this._defaultPrevented=!1,this.target=b}}class ro extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){const k=A==="touchend"?L.changedTouches:L.touches,y=x.touchPos(b.getCanvasContainer(),k),a=y.map(_=>b.unproject(_)),d=y.reduce((_,B,S,U)=>_.add(B.div(U.length)),new s.P(0,0));super(A,{points:y,point:d,lngLats:a,lngLat:b.unproject(d),originalEvent:L}),this._defaultPrevented=!1}}class Ma extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,L){super(A,{originalEvent:L}),this._defaultPrevented=!1}}class ma{constructor(A,b){this._map=A,this._clickTolerance=b.clickTolerance}reset(){delete this._mousedownPos}wheel(A){return this._firePreventable(new Ma(A.type,this._map,A))}mousedown(A,b){return this._mousedownPos=b,this._firePreventable(new ms(A.type,this._map,A))}mouseup(A){this._map.fire(new ms(A.type,this._map,A))}click(A,b){this._mousedownPos&&this._mousedownPos.dist(b)>=this._clickTolerance||this._map.fire(new ms(A.type,this._map,A))}dblclick(A){return this._firePreventable(new ms(A.type,this._map,A))}mouseover(A){this._map.fire(new ms(A.type,this._map,A))}mouseout(A){this._map.fire(new ms(A.type,this._map,A))}touchstart(A){return this._firePreventable(new ro(A.type,this._map,A))}touchmove(A){this._map.fire(new ro(A.type,this._map,A))}touchend(A){this._map.fire(new ro(A.type,this._map,A))}touchcancel(A){this._map.fire(new ro(A.type,this._map,A))}_firePreventable(A){if(this._map.fire(A),A.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pa{constructor(A){this._map=A}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(A){this._map.fire(new ms(A.type,this._map,A))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(A){this._delayContextMenu?this._contextMenuEvent=A:this._ignoreContextMenu||this._map.fire(new ms(A.type,this._map,A)),this._map.listens("contextmenu")&&A.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tn{constructor(A){this._map=A}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(A){return this.transform.pointLocation(s.P.convert(A),this._map.terrain)}}class Fo{constructor(A,b){this._map=A,this._tr=new Tn(A),this._el=A.getCanvasContainer(),this._container=A.getContainer(),this._clickTolerance=b.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(A,b){this.isEnabled()&&A.shiftKey&&A.button===0&&(x.disableDrag(),this._startPos=this._lastPos=b,this._active=!0)}mousemoveWindow(A,b){if(!this._active)return;const L=b;if(this._lastPos.equals(L)||!this._box&&L.dist(this._startPos)<this._clickTolerance)return;const k=this._startPos;this._lastPos=L,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",A));const y=Math.min(k.x,L.x),a=Math.max(k.x,L.x),d=Math.min(k.y,L.y),_=Math.max(k.y,L.y);x.setTransform(this._box,`translate(${y}px,${d}px)`),this._box.style.width=a-y+"px",this._box.style.height=_-d+"px"}mouseupWindow(A,b){if(!this._active||A.button!==0)return;const L=this._startPos,k=b;if(this.reset(),x.suppressClick(),L.x!==k.x||L.y!==k.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:A})),{cameraAnimation:y=>y.fitScreenCoordinates(L,k,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",A)}keydown(A){this._active&&A.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",A))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(A,b){return this._map.fire(new s.k(A,{originalEvent:b}))}}function hs(N,A){if(N.length!==A.length)throw new Error(`The number of touches and points are not equal - touches ${N.length}, points ${A.length}`);const b={};for(let L=0;L<N.length;L++)b[N[L].identifier]=A[L];return b}class ys{constructor(A){this.reset(),this.numTouches=A.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(A,b,L){(this.centroid||L.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=A.timeStamp),L.length===this.numTouches&&(this.centroid=function(k){const y=new s.P(0,0);for(const a of k)y._add(a);return y.div(k.length)}(b),this.touches=hs(L,b)))}touchmove(A,b,L){if(this.aborted||!this.centroid)return;const k=hs(L,b);for(const y in this.touches){const a=k[y];(!a||a.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(A,b,L){if((!this.centroid||A.timeStamp-this.startTime>500)&&(this.aborted=!0),L.length===0){const k=!this.aborted&&this.centroid;if(this.reset(),k)return k}}}class As{constructor(A){this.singleTap=new ys(A),this.numTaps=A.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(A,b,L){this.singleTap.touchstart(A,b,L)}touchmove(A,b,L){this.singleTap.touchmove(A,b,L)}touchend(A,b,L){const k=this.singleTap.touchend(A,b,L);if(k){const y=A.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(k)<30;if(y&&a||this.reset(),this.count++,this.lastTime=A.timeStamp,this.lastTap=k,this.count===this.numTaps)return this.reset(),k}}}class Ir{constructor(A){this._tr=new Tn(A),this._zoomIn=new As({numTouches:1,numTaps:2}),this._zoomOut=new As({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(A,b,L){this._zoomIn.touchstart(A,b,L),this._zoomOut.touchstart(A,b,L)}touchmove(A,b,L){this._zoomIn.touchmove(A,b,L),this._zoomOut.touchmove(A,b,L)}touchend(A,b,L){const k=this._zoomIn.touchend(A,b,L),y=this._zoomOut.touchend(A,b,L),a=this._tr;return k?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(k)},{originalEvent:A})}):y?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(y)},{originalEvent:A})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zr{constructor(A){this._enabled=!!A.enable,this._moveStateManager=A.moveStateManager,this._clickTolerance=A.clickTolerance||1,this._moveFunction=A.move,this._activateOnStart=!!A.activateOnStart,A.assignEvents(this),this.reset()}reset(A){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(A)}_move(){const A=this._moveFunction(...arguments);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(A,b){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(A)&&(this._moveStateManager.startMove(A),this._lastPoint=b.length?b[0]:b,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(A,b){if(!this.isEnabled())return;const L=this._lastPoint;if(!L)return;if(A.preventDefault(),!this._moveStateManager.isValidMoveEvent(A))return void this.reset(A);const k=b.length?b[0]:b;return!this._moved&&k.dist(L)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=k,this._move(L,k))}dragEnd(A){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(A)&&(this._moved&&x.suppressClick(),this.reset(A))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const an={0:1,2:2};class Gn{constructor(A){this._correctEvent=A.checkCorrectEvent}startMove(A){const b=x.mouseButton(A);this._eventButton=b}endMove(A){delete this._eventButton}isValidStartEvent(A){return this._correctEvent(A)}isValidMoveEvent(A){return!function(b,L){const k=an[L];return b.buttons===void 0||(b.buttons&k)!==k}(A,this._eventButton)}isValidEndEvent(A){return x.mouseButton(A)===this._eventButton}}class ya{constructor(){this._firstTouch=void 0}_isOneFingerTouch(A){return A.targetTouches.length===1}_isSameTouchEvent(A){return A.targetTouches[0].identifier===this._firstTouch}startMove(A){this._firstTouch=A.targetTouches[0].identifier}endMove(A){delete this._firstTouch}isValidStartEvent(A){return this._isOneFingerTouch(A)}isValidMoveEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}isValidEndEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}}const Fa=N=>{N.mousedown=N.dragStart,N.mousemoveWindow=N.dragMove,N.mouseup=N.dragEnd,N.contextmenu=function(A){A.preventDefault()}},go=N=>{let{enable:A,clickTolerance:b,bearingDegreesPerPixelMoved:L=.8}=N;const k=new Gn({checkCorrectEvent:y=>x.mouseButton(y)===0&&y.ctrlKey||x.mouseButton(y)===2});return new Zr({clickTolerance:b,move:(y,a)=>({bearingDelta:(a.x-y.x)*L}),moveStateManager:k,enable:A,assignEvents:Fa})},Zo=N=>{let{enable:A,clickTolerance:b,pitchDegreesPerPixelMoved:L=-.5}=N;const k=new Gn({checkCorrectEvent:y=>x.mouseButton(y)===0&&y.ctrlKey||x.mouseButton(y)===2});return new Zr({clickTolerance:b,move:(y,a)=>({pitchDelta:(a.y-y.y)*L}),moveStateManager:k,enable:A,assignEvents:Fa})};class Oi{constructor(A,b){this._minTouches=A.cooperativeGestures?2:1,this._clickTolerance=A.clickTolerance||1,this._map=b,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(A,b,L){return this._calculateTransform(A,b,L)}touchmove(A,b,L){if(this._map._cooperativeGestures&&(this._minTouches===2&&L.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(A,!1,L.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(L.length<this._minTouches))return A.preventDefault(),this._calculateTransform(A,b,L)}touchend(A,b,L){this._calculateTransform(A,b,L),this._active&&L.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(A,b,L){L.length>0&&(this._active=!0);const k=hs(L,b),y=new s.P(0,0),a=new s.P(0,0);let d=0;for(const B in k){const S=k[B],U=this._touches[B];U&&(y._add(S),a._add(S.sub(U)),d++,k[B]=S)}if(this._touches=k,d<this._minTouches||!a.mag())return;const _=a.div(d);return this._sum._add(_),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(d),panDelta:_}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(A,b,L){this._firstTwoTouches||L.length<2||(this._firstTwoTouches=[L[0].identifier,L[1].identifier],this._start([b[0],b[1]]))}touchmove(A,b,L){if(!this._firstTwoTouches)return;A.preventDefault();const[k,y]=this._firstTwoTouches,a=Pi(L,b,k),d=Pi(L,b,y);if(!a||!d)return;const _=this._aroundCenter?null:a.add(d).div(2);return this._move([a,d],_,A)}touchend(A,b,L){if(!this._firstTwoTouches)return;const[k,y]=this._firstTwoTouches,a=Pi(L,b,k),d=Pi(L,b,y);a&&d||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(A){this._enabled=!0,this._aroundCenter=!!A&&A.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pi(N,A,b){for(let L=0;L<N.length;L++)if(N[L].identifier===b)return A[L]}function hl(N,A){return Math.log(N/A)/Math.LN2}class Hl extends Jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(A){this._startDistance=this._distance=A[0].dist(A[1])}_move(A,b){const L=this._distance;if(this._distance=A[0].dist(A[1]),this._active||!(Math.abs(hl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hl(this._distance,L),pinchAround:b}}}function Li(N,A){return 180*N.angleWith(A)/Math.PI}class Gl extends Jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(A){this._startVector=this._vector=A[0].sub(A[1]),this._minDiameter=A[0].dist(A[1])}_move(A,b){const L=this._vector;if(this._vector=A[0].sub(A[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Li(this._vector,L),pinchAround:b}}_isBelowThreshold(A){this._minDiameter=Math.min(this._minDiameter,A.mag());const b=25/(Math.PI*this._minDiameter)*360,L=Li(A,this._startVector);return Math.abs(L)<b}}function Ei(N){return Math.abs(N.y)>Math.abs(N.x)}class no extends Jo{constructor(A){super(),this._map=A}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(A,b,L){super.touchstart(A,b,L),this._currentTouchCount=L.length}_start(A){this._lastPoints=A,Ei(A[0].sub(A[1]))&&(this._valid=!1)}_move(A,b,L){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const k=A[0].sub(this._lastPoints[0]),y=A[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(k,y,L.timeStamp),this._valid?(this._lastPoints=A,this._active=!0,{pitchDelta:(k.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(A,b,L){if(this._valid!==void 0)return this._valid;const k=A.mag()>=2,y=b.mag()>=2;if(!k&&!y)return;if(!k||!y)return this._firstMove===void 0&&(this._firstMove=L),L-this._firstMove<100&&void 0;const a=A.y>0==b.y>0;return Ei(A)&&Ei(b)&&a}}const mo={panStep:100,bearingStep:15,pitchStep:10};class Mc{constructor(A){this._tr=new Tn(A);const b=mo;this._panStep=b.panStep,this._bearingStep=b.bearingStep,this._pitchStep=b.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(A){if(A.altKey||A.ctrlKey||A.metaKey)return;let b=0,L=0,k=0,y=0,a=0;switch(A.keyCode){case 61:case 107:case 171:case 187:b=1;break;case 189:case 109:case 173:b=-1;break;case 37:A.shiftKey?L=-1:(A.preventDefault(),y=-1);break;case 39:A.shiftKey?L=1:(A.preventDefault(),y=1);break;case 38:A.shiftKey?k=1:(A.preventDefault(),a=-1);break;case 40:A.shiftKey?k=-1:(A.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(L=0,k=0),{cameraAnimation:d=>{const _=this._tr;d.easeTo({duration:300,easeId:"keyboardHandler",easing:jl,zoom:b?Math.round(_.zoom)+b*(A.shiftKey?2:1):_.zoom,bearing:_.bearing+L*this._bearingStep,pitch:_.pitch+k*this._pitchStep,offset:[-y*this._panStep,-a*this._panStep],center:_.center},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jl(N){return N*(2-N)}const Pc=4.000244140625;class Fc{constructor(A,b){this._onTimeout=L=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(L)},this._map=A,this._tr=new Tn(A),this._el=A.getCanvasContainer(),this._triggerRenderFrame=b,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(A){this._defaultZoomRate=A}setWheelZoomRate(A){this._wheelZoomRate=A}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(A){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!A&&A.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(A){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!A[this._map._metaKey])return;A.preventDefault()}let b=A.deltaMode===WheelEvent.DOM_DELTA_LINE?40*A.deltaY:A.deltaY;const L=s.h.now(),k=L-(this._lastWheelEventTime||0);this._lastWheelEventTime=L,b!==0&&b%Pc==0?this._type="wheel":b!==0&&Math.abs(b)<4?this._type="trackpad":k>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40,A)):this._type||(this._type=Math.abs(k*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),A.shiftKey&&b&&(b/=4),this._type&&(this._lastWheelEvent=A,this._delta-=b,this._active||this._start(A)),A.preventDefault()}_start(A){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const b=x.mousePos(this._el,A),L=this._tr;this._around=s.L.convert(this._aroundCenter?L.center:L.unproject(b)),this._aroundPoint=L.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const A=this._tr.transform;if(this._delta!==0){const d=this._type==="wheel"&&Math.abs(this._delta)>Pc?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&_!==0&&(_=1/_);const B=typeof this._targetZoom=="number"?A.zoomScale(this._targetZoom):A.scale;this._targetZoom=Math.min(A.maxZoom,Math.max(A.minZoom,A.scaleZoom(B*_))),this._type==="wheel"&&(this._startZoom=A.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:A.zoom,L=this._startZoom,k=this._easing;let y,a=!1;if(this._type==="wheel"&&L&&k){const d=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),_=k(d);y=s.B.number(L,b,_),d<1?this._frameId||(this._frameId=!0):a=!0}else y=b,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:y-A.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(A){let b=s.bb;if(this._prevEase){const L=this._prevEase,k=(s.h.now()-L.start)/L.duration,y=L.easing(k+.01)-L.easing(k),a=.27/Math.sqrt(y*y+1e-4)*.01,d=Math.sqrt(.0729-a*a);b=s.ba(a,d,.25,1)}return this._prevEase={start:s.h.now(),duration:A,easing:b},b}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Dc{constructor(A,b){this._clickZoom=A,this._tapZoom=b}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rc{constructor(A){this._tr=new Tn(A),this.reset()}reset(){this._active=!1}dblclick(A,b){return A.preventDefault(),{cameraAnimation:L=>{L.easeTo({duration:300,zoom:this._tr.zoom+(A.shiftKey?-1:1),around:this._tr.unproject(b)},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(){this._tap=new As({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(A,b,L){if(!this._swipePoint)if(this._tapTime){const k=b[0],y=A.timeStamp-this._tapTime<500,a=this._tapPoint.dist(k)<30;y&&a?L.length>0&&(this._swipePoint=k,this._swipeTouch=L[0].identifier):this.reset()}else this._tap.touchstart(A,b,L)}touchmove(A,b,L){if(this._tapTime){if(this._swipePoint){if(L[0].identifier!==this._swipeTouch)return;const k=b[0],y=k.y-this._swipePoint.y;return this._swipePoint=k,A.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(A,b,L)}touchend(A,b,L){if(this._tapTime)this._swipePoint&&L.length===0&&this.reset();else{const k=this._tap.touchend(A,b,L);k&&(this._tapTime=A.timeStamp,this._tapPoint=k)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yn{constructor(A,b,L){this._el=A,this._mousePan=b,this._touchPan=L}enable(A){this._inertiaOptions=A||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bs{constructor(A,b,L){this._pitchWithRotate=A.pitchWithRotate,this._mouseRotate=b,this._mousePitch=L}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Do{constructor(A,b,L,k){this._el=A,this._touchZoom=b,this._touchRotate=L,this._tapDragZoom=k,this._rotationDisabled=!1,this._enabled=!0}enable(A){this._touchZoom.enable(A),this._rotationDisabled||this._touchRotate.enable(A),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ql=N=>N.zoom||N.drag||N.pitch||N.rotate;class Mu extends s.k{}function Ac(N){return N.panDelta&&N.panDelta.mag()||N.zoomDelta||N.bearingDelta||N.pitchDelta}class su{constructor(A,b){this.handleWindowEvent=k=>{this.handleEvent(k,`${k.type}Window`)},this.handleEvent=(k,y)=>{if(k.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=k.type==="renderFrame"?void 0:k,d={needsRenderFrame:!1},_={},B={},S=k.touches,U=S?this._getMapTouches(S):void 0,H=U?x.touchPos(this._el,U):x.mousePos(this._el,k);for(const{handlerName:T,handler:R,allowed:j}of this._handlers){if(!R.isEnabled())continue;let Z;this._blockedByActive(B,j,T)?R.reset():R[y||k.type]&&(Z=R[y||k.type](k,H,U),this.mergeHandlerResult(d,_,Z,T,a),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||R.isActive())&&(B[T]=R)}const q={};for(const T in this._previousActiveHandlers)B[T]||(q[T]=a);this._previousActiveHandlers=B,(Object.keys(q).length||Ac(d))&&(this._changes.push([d,_,q]),this._triggerRenderFrame()),(Object.keys(B).length||Ac(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:w}=d;w&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],w(this._map))},this._map=A,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new to(A),this._bearingSnap=b.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(b);const L=this._el;this._listeners=[[L,"touchstart",{passive:!0}],[L,"touchmove",{passive:!1}],[L,"touchend",void 0],[L,"touchcancel",void 0],[L,"mousedown",void 0],[L,"mousemove",void 0],[L,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[L,"mouseover",void 0],[L,"mouseout",void 0],[L,"dblclick",void 0],[L,"click",void 0],[L,"keydown",{capture:!1}],[L,"keyup",void 0],[L,"wheel",{passive:!1}],[L,"contextmenu",void 0],[window,"blur",void 0]];for(const[k,y,a]of this._listeners)x.addEventListener(k,y,k===document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[A,b,L]of this._listeners)x.removeEventListener(A,b,A===document?this.handleWindowEvent:this.handleEvent,L)}_addDefaultHandlers(A){const b=this._map,L=b.getCanvasContainer();this._add("mapEvent",new ma(b,A));const k=b.boxZoom=new Fo(b,A);this._add("boxZoom",k),A.interactive&&A.boxZoom&&k.enable();const y=new Ir(b),a=new Rc(b);b.doubleClickZoom=new Dc(a,y),this._add("tapZoom",y),this._add("clickZoom",a),A.interactive&&A.doubleClickZoom&&b.doubleClickZoom.enable();const d=new Za;this._add("tapDragZoom",d);const _=b.touchPitch=new no(b);this._add("touchPitch",_),A.interactive&&A.touchPitch&&b.touchPitch.enable(A.touchPitch);const B=go(A),S=Zo(A);b.dragRotate=new Bs(A,B,S),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",S,["mouseRotate"]),A.interactive&&A.dragRotate&&b.dragRotate.enable();const U=(j=>{let{enable:Z,clickTolerance:W}=j;const J=new Gn({checkCorrectEvent:ee=>x.mouseButton(ee)===0&&!ee.ctrlKey});return new Zr({clickTolerance:W,move:(ee,ae)=>({around:ae,panDelta:ae.sub(ee)}),activateOnStart:!0,moveStateManager:J,enable:Z,assignEvents:Fa})})(A),H=new Oi(A,b);b.dragPan=new yn(L,U,H),this._add("mousePan",U),this._add("touchPan",H,["touchZoom","touchRotate"]),A.interactive&&A.dragPan&&b.dragPan.enable(A.dragPan);const q=new Gl,w=new Hl;b.touchZoomRotate=new Do(L,w,q,d),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",w,["touchPan","touchRotate"]),A.interactive&&A.touchZoomRotate&&b.touchZoomRotate.enable(A.touchZoomRotate);const T=b.scrollZoom=new Fc(b,()=>this._triggerRenderFrame());this._add("scrollZoom",T,["mousePan"]),A.interactive&&A.scrollZoom&&b.scrollZoom.enable(A.scrollZoom);const R=b.keyboard=new Mc(b);this._add("keyboard",R),A.interactive&&A.keyboard&&b.keyboard.enable(),this._add("blockableMapEvent",new Pa(b))}_add(A,b,L){this._handlers.push({handlerName:A,handler:b,allowed:L}),this._handlersById[A]=b}stop(A){if(!this._updatingCamera){for(const{handler:b}of this._handlers)b.reset();this._inertia.clear(),this._fireEvents({},{},A),this._changes=[]}}isActive(){for(const{handler:A}of this._handlers)if(A.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ql(this._eventsInProgress)||this.isZooming()}_blockedByActive(A,b,L){for(const k in A)if(k!==L&&(!b||b.indexOf(k)<0))return!0;return!1}_getMapTouches(A){const b=[];for(const L of A)this._el.contains(L.target)&&b.push(L);return b}mergeHandlerResult(A,b,L,k,y){if(!L)return;s.e(A,L);const a={handlerName:k,originalEvent:L.originalEvent||y};L.zoomDelta!==void 0&&(b.zoom=a),L.panDelta!==void 0&&(b.drag=a),L.pitchDelta!==void 0&&(b.pitch=a),L.bearingDelta!==void 0&&(b.rotate=a)}_applyChanges(){const A={},b={},L={};for(const[k,y,a]of this._changes)k.panDelta&&(A.panDelta=(A.panDelta||new s.P(0,0))._add(k.panDelta)),k.zoomDelta&&(A.zoomDelta=(A.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(A.bearingDelta=(A.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(A.pitchDelta=(A.pitchDelta||0)+k.pitchDelta),k.around!==void 0&&(A.around=k.around),k.pinchAround!==void 0&&(A.pinchAround=k.pinchAround),k.noInertia&&(A.noInertia=k.noInertia),s.e(b,y),s.e(L,a);this._updateMapTransform(A,b,L),this._changes=[]}_updateMapTransform(A,b,L){const k=this._map,y=k._getTransformForUpdate(),a=k.terrain;if(!(Ac(A)||a&&this._terrainMovement))return this._fireEvents(b,L,!0);let{panDelta:d,zoomDelta:_,bearingDelta:B,pitchDelta:S,around:U,pinchAround:H}=A;H!==void 0&&(U=H),k._stop(!0),U=U||k.transform.centerPoint;const q=y.pointLocation(d?U.sub(d):U);B&&(y.bearing+=B),S&&(y.pitch+=S),_&&(y.zoom+=_),a?this._terrainMovement||!b.drag&&!b.zoom?b.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(d)):y.setLocationAtPoint(q,U):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(q,U),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(k.terrain)})):y.setLocationAtPoint(q,U),k._applyUpdatedTransform(y),this._map._update(),A.noInertia||this._inertia.record(A),this._fireEvents(b,L,!0)}_fireEvents(A,b,L){const k=ql(this._eventsInProgress),y=ql(A),a={};for(const S in A){const{originalEvent:U}=A[S];this._eventsInProgress[S]||(a[`${S}start`]=U),this._eventsInProgress[S]=A[S]}!k&&y&&this._fireEvent("movestart",y.originalEvent);for(const S in a)this._fireEvent(S,a[S]);y&&this._fireEvent("move",y.originalEvent);for(const S in A){const{originalEvent:U}=A[S];this._fireEvent(S,U)}const d={};let _;for(const S in this._eventsInProgress){const{handlerName:U,originalEvent:H}=this._eventsInProgress[S];this._handlersById[U].isActive()||(delete this._eventsInProgress[S],_=b[U]||H,d[`${S}end`]=_)}for(const S in d)this._fireEvent(S,d[S]);const B=ql(this._eventsInProgress);if(L&&(k||y)&&!B){this._updatingCamera=!0;const S=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!S||!S.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:_})),U(this._map.getBearing())&&this._map.resetNorth()):(U(S.bearing||this._map.getBearing())&&(S.bearing=0),S.freezeElevation=!0,this._map.easeTo(S,{originalEvent:_})),this._updatingCamera=!1}}_fireEvent(A,b){this._map.fire(new s.k(A,b?{originalEvent:b}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(A=>{delete this._frameId,this.handleEvent(new Mu("renderFrame",{timeStamp:A})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _a extends s.E{constructor(A,b){super(),this._renderFrameCallback=()=>{const L=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(L)),L<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=A,this._bearingSnap=b.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(A,b){return this.jumpTo({center:A},b)}panBy(A,b,L){return A=s.P.convert(A).mult(-1),this.panTo(this.transform.center,s.e({offset:A},b),L)}panTo(A,b,L){return this.easeTo(s.e({center:A},b),L)}getZoom(){return this.transform.zoom}setZoom(A,b){return this.jumpTo({zoom:A},b),this}zoomTo(A,b,L){return this.easeTo(s.e({zoom:A},b),L)}zoomIn(A,b){return this.zoomTo(this.getZoom()+1,A,b),this}zoomOut(A,b){return this.zoomTo(this.getZoom()-1,A,b),this}getBearing(){return this.transform.bearing}setBearing(A,b){return this.jumpTo({bearing:A},b),this}getPadding(){return this.transform.padding}setPadding(A,b){return this.jumpTo({padding:A},b),this}rotateTo(A,b,L){return this.easeTo(s.e({bearing:A},b),L)}resetNorth(A,b){return this.rotateTo(0,s.e({duration:1e3},A),b),this}resetNorthPitch(A,b){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},A),b),this}snapToNorth(A,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(A,b):this}getPitch(){return this.transform.pitch}setPitch(A,b){return this.jumpTo({pitch:A},b),this}cameraForBounds(A,b){A=Xe.convert(A);const L=b&&b.bearing||0;return this._cameraForBoxAndBearing(A.getNorthWest(),A.getSouthEast(),L,b)}_cameraForBoxAndBearing(A,b,L,k){const y={top:0,bottom:0,right:0,left:0};if(typeof(k=s.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},k)).padding=="number"){const ee=k.padding;k.padding={top:ee,bottom:ee,right:ee,left:ee}}k.padding=s.e(y,k.padding);const a=this.transform,d=a.padding,_=a.project(s.L.convert(A)),B=a.project(s.L.convert(b)),S=_.rotate(-L*Math.PI/180),U=B.rotate(-L*Math.PI/180),H=new s.P(Math.max(S.x,U.x),Math.max(S.y,U.y)),q=new s.P(Math.min(S.x,U.x),Math.min(S.y,U.y)),w=H.sub(q),T=(a.width-(d.left+d.right+k.padding.left+k.padding.right))/w.x,R=(a.height-(d.top+d.bottom+k.padding.top+k.padding.bottom))/w.y;if(R<0||T<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const j=Math.min(a.scaleZoom(a.scale*Math.min(T,R)),k.maxZoom),Z=s.P.convert(k.offset),W=new s.P((k.padding.left-k.padding.right)/2,(k.padding.top-k.padding.bottom)/2).rotate(L*Math.PI/180),J=Z.add(W).mult(a.scale/a.zoomScale(j));return{center:a.unproject(_.add(B).div(2).sub(J)),zoom:j,bearing:L}}fitBounds(A,b,L){return this._fitInternal(this.cameraForBounds(A,b),b,L)}fitScreenCoordinates(A,b,L,k,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(A)),this.transform.pointLocation(s.P.convert(b)),L,k),k,y)}_fitInternal(A,b,L){return A?(delete(b=s.e(A,b)).padding,b.linear?this.easeTo(b,L):this.flyTo(b,L)):this}jumpTo(A,b){this.stop();const L=this._getTransformForUpdate();let k=!1,y=!1,a=!1;return"zoom"in A&&L.zoom!==+A.zoom&&(k=!0,L.zoom=+A.zoom),A.center!==void 0&&(L.center=s.L.convert(A.center)),"bearing"in A&&L.bearing!==+A.bearing&&(y=!0,L.bearing=+A.bearing),"pitch"in A&&L.pitch!==+A.pitch&&(a=!0,L.pitch=+A.pitch),A.padding==null||L.isPaddingEqual(A.padding)||(L.padding=A.padding),this._applyUpdatedTransform(L),this.fire(new s.k("movestart",b)).fire(new s.k("move",b)),k&&this.fire(new s.k("zoomstart",b)).fire(new s.k("zoom",b)).fire(new s.k("zoomend",b)),y&&this.fire(new s.k("rotatestart",b)).fire(new s.k("rotate",b)).fire(new s.k("rotateend",b)),a&&this.fire(new s.k("pitchstart",b)).fire(new s.k("pitch",b)).fire(new s.k("pitchend",b)),this.fire(new s.k("moveend",b))}calculateCameraOptionsFromTo(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const y=s.U.fromLngLat(A,b),a=s.U.fromLngLat(L,k),d=a.x-y.x,_=a.y-y.y,B=a.z-y.z,S=Math.hypot(d,_,B);if(S===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(d,_),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/S/this.transform.tileSize),q=180*Math.atan2(d,-_)/Math.PI;let w=180*Math.acos(U/S)/Math.PI;return w=B<0?90-w:90+w,{center:a.toLngLat(),zoom:H,pitch:w,bearing:q}}easeTo(A,b){this._stop(!1,A.easeId),((A=s.e({offset:[0,0],duration:500,easing:s.bb},A)).animate===!1||!A.essential&&s.h.prefersReducedMotion)&&(A.duration=0);const L=this._getTransformForUpdate(),k=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?+A.zoom:k,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,S="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=s.P.convert(A.offset);let q=L.centerPoint.add(H);const w=L.pointLocation(q),T=s.L.convert(A.center||w);this._normalizeCenter(T);const R=L.project(w),j=L.project(T).sub(R),Z=L.zoomScale(_-k);let W,J;A.around&&(W=s.L.convert(A.around),J=L.locationPoint(W));const ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_!==k,this._rotating=this._rotating||y!==B,this._pitching=this._pitching||S!==a,this._padding=!L.isPaddingEqual(U),this._easeId=A.easeId,this._prepareEase(b,A.noMoveStart,ee),this.terrain&&this._prepareElevation(T),this._ease(ae=>{if(this._zooming&&(L.zoom=s.B.number(k,_,ae)),this._rotating&&(L.bearing=s.B.number(y,B,ae)),this._pitching&&(L.pitch=s.B.number(a,S,ae)),this._padding&&(L.interpolatePadding(d,U,ae),q=L.centerPoint.add(H)),this.terrain&&!A.freezeElevation&&this._updateElevation(ae),W)L.setLocationAtPoint(W,J);else{const fe=L.zoomScale(L.zoom-k),pe=_>k?Math.min(2,Z):Math.max(.5,Z),xe=Math.pow(pe,1-ae),Pe=L.unproject(R.add(j.mult(ae*xe)).mult(fe));L.setLocationAtPoint(L.renderWorldCopies?Pe.wrap():Pe,q)}this._applyUpdatedTransform(L),this._fireMoveEvents(b)},ae=>{this.terrain&&this._finalizeElevation(),this._afterEase(b,ae)},A),this}_prepareEase(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,b||L.moving||this.fire(new s.k("movestart",A)),this._zooming&&!L.zooming&&this.fire(new s.k("zoomstart",A)),this._rotating&&!L.rotating&&this.fire(new s.k("rotatestart",A)),this._pitching&&!L.pitching&&this.fire(new s.k("pitchstart",A))}_prepareElevation(A){this._elevationCenter=A,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(A,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(A){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const b=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(A<1&&b!==this._elevationTarget){const L=this._elevationTarget-this._elevationStart;this._elevationStart+=A*(L-(b-(L*A+this._elevationStart))/(1-A)),this._elevationTarget=b}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,A)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(A){if(!this.transformCameraUpdate)return;const b=A.clone(),{center:L,zoom:k,pitch:y,bearing:a,elevation:d}=this.transformCameraUpdate(b);L&&(b.center=L),k!==void 0&&(b.zoom=k),y!==void 0&&(b.pitch=y),a!==void 0&&(b.bearing=a),d!==void 0&&(b.elevation=d),this.transform.apply(b)}_fireMoveEvents(A){this.fire(new s.k("move",A)),this._zooming&&this.fire(new s.k("zoom",A)),this._rotating&&this.fire(new s.k("rotate",A)),this._pitching&&this.fire(new s.k("pitch",A))}_afterEase(A,b){if(this._easeId&&b&&this._easeId===b)return;delete this._easeId;const L=this._zooming,k=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,L&&this.fire(new s.k("zoomend",A)),k&&this.fire(new s.k("rotateend",A)),y&&this.fire(new s.k("pitchend",A)),this.fire(new s.k("moveend",A))}flyTo(A,b){if(!A.essential&&s.h.prefersReducedMotion){const Qe=s.F(A,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,b)}this.stop(),A=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},A);const L=this._getTransformForUpdate(),k=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?s.ad(+A.zoom,L.minZoom,L.maxZoom):k,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,S="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=L.zoomScale(_-k),q=s.P.convert(A.offset);let w=L.centerPoint.add(q);const T=L.pointLocation(w),R=s.L.convert(A.center||T);this._normalizeCenter(R);const j=L.project(T),Z=L.project(R).sub(j);let W=A.curve;const J=Math.max(L.width,L.height),ee=J/H,ae=Z.mag();if("minZoom"in A){const Qe=s.ad(Math.min(A.minZoom,k,_),L.minZoom,L.maxZoom),pt=J/L.zoomScale(Qe-k);W=Math.sqrt(pt/ae*2)}const fe=W*W;function pe(Qe){const pt=(ee*ee-J*J+(Qe?-1:1)*fe*fe*ae*ae)/(2*(Qe?ee:J)*fe*ae);return Math.log(Math.sqrt(pt*pt+1)-pt)}function xe(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Pe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Le=pe(!1);let rt=function(Qe){return Pe(Le)/Pe(Le+W*Qe)},Ke=function(Qe){return J*((Pe(Le)*(xe(pt=Le+W*Qe)/Pe(pt))-xe(Le))/fe)/ae;var pt},Re=(pe(!0)-Le)/W;if(Math.abs(ae)<1e-6||!isFinite(Re)){if(Math.abs(J-ee)<1e-6)return this.easeTo(A,b);const Qe=ee<J?-1:1;Re=Math.abs(Math.log(ee/J))/W,Ke=function(){return 0},rt=function(pt){return Math.exp(Qe*W*pt)}}return A.duration="duration"in A?+A.duration:1e3*Re/("screenSpeed"in A?+A.screenSpeed/W:+A.speed),A.maxDuration&&A.duration>A.maxDuration&&(A.duration=0),this._zooming=!0,this._rotating=y!==B,this._pitching=S!==a,this._padding=!L.isPaddingEqual(U),this._prepareEase(b,!1),this.terrain&&this._prepareElevation(R),this._ease(Qe=>{const pt=Qe*Re,bt=1/rt(pt);L.zoom=Qe===1?_:k+L.scaleZoom(bt),this._rotating&&(L.bearing=s.B.number(y,B,Qe)),this._pitching&&(L.pitch=s.B.number(a,S,Qe)),this._padding&&(L.interpolatePadding(d,U,Qe),w=L.centerPoint.add(q)),this.terrain&&!A.freezeElevation&&this._updateElevation(Qe);const ht=Qe===1?R:L.unproject(j.add(Z.mult(Ke(pt))).mult(bt));L.setLocationAtPoint(L.renderWorldCopies?ht.wrap():ht,w),this._applyUpdatedTransform(L),this._fireMoveEvents(b)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(b)},A),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(A,b){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const L=this._onEaseEnd;delete this._onEaseEnd,L.call(this,b)}if(!A){const L=this.handlers;L&&L.stop(!1)}return this}_ease(A,b,L){L.animate===!1||L.duration===0?(A(1),b()):(this._easeStart=s.h.now(),this._easeOptions=L,this._onEaseFrame=A,this._onEaseEnd=b,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(A,b){A=s.b5(A,-180,180);const L=Math.abs(A-b);return Math.abs(A-360-b)<L&&(A-=360),Math.abs(A+360-b)<L&&(A+=360),A}_normalizeCenter(A){const b=this.transform;if(!b.renderWorldCopies||b.lngRange)return;const L=A.lng-b.center.lng;A.lng+=L>180?-360:L<-180?360:0}queryTerrainElevation(A){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(A),this.transform.tileZoom)-this.transform.elevation:null}}class $s{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=b=>{!b||b.sourceDataType!=="metadata"&&b.sourceDataType!=="visibility"&&b.dataType!=="style"&&b.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=A}getDefaultPosition(){return"bottom-right"}onAdd(A){return this._map=A,this._compact=this.options&&this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(A,b){const L=this._map._getUIString(`AttributionControl.${b}`);A.title=L,A.setAttribute("aria-label",L)}_updateAttributions(){if(!this._map.style)return;let A=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?A=A.concat(this.options.customAttribution.map(k=>typeof k!="string"?"":k)):typeof this.options.customAttribution=="string"&&A.push(this.options.customAttribution)),this._map.style.stylesheet){const k=this._map.style.stylesheet;this.styleOwner=k.owner,this.styleId=k.id}const b=this._map.style.sourceCaches;for(const k in b){const y=b[k];if(y.used||y.usedForTerrain){const a=y.getSource();a.attribution&&A.indexOf(a.attribution)<0&&A.push(a.attribution)}}A=A.filter(k=>String(k).trim()),A.sort((k,y)=>k.length-y.length),A=A.filter((k,y)=>{for(let a=y+1;a<A.length;a++)if(A[a].indexOf(k)>=0)return!1;return!0});const L=A.join(" | ");L!==this._attribHTML&&(this._attribHTML=L,A.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class bi{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const b=this._container.children;if(b.length){const L=b[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&L.classList.add("maplibregl-compact"):L.classList.remove("maplibregl-compact")}},this.options=A}getDefaultPosition(){return"bottom-left"}onAdd(A){this._map=A,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const b=x.create("a","maplibregl-ctrl-logo");return b.target="_blank",b.rel="noopener nofollow",b.href="https://maplibre.org/",b.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),b.setAttribute("rel","noopener nofollow"),this._container.appendChild(b),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(A){const b=++this._id;return this._queue.push({callback:A,id:b,cancelled:!1}),b}remove(A){const b=this._currentlyRunning,L=b?this._queue.concat(b):this._queue;for(const k of L)if(k.id===A)return void(k.cancelled=!0)}run(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const b=this._currentlyRunning=this._queue;this._queue=[];for(const L of b)if(!L.cancelled&&(L.callback(A),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const $l={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var kc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Oc extends s.E{constructor(A){super(),this.sourceCache=A,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,A.usedForTerrain=!0,A.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(A,b){this.sourceCache.update(A,b),this._renderableTilesKeys=[];const L={};for(const k of A.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:b}))L[k.key]=!0,this._renderableTilesKeys.push(k.key),this._tiles[k.key]||(k.posMatrix=new Float64Array(16),s.aS(k.posMatrix,0,s.N,0,s.N,0,1),this._tiles[k.key]=new Ri(k,this.tileSize));for(const k in this._tiles)L[k]||delete this._tiles[k]}freeRtt(A){for(const b in this._tiles){const L=this._tiles[b];(!A||L.tileID.equals(A)||L.tileID.isChildOf(A)||A.isChildOf(L.tileID))&&(L.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(A=>this.getTileByID(A))}getTileByID(A){return this._tiles[A]}getTerrainCoords(A){const b={};for(const L of this._renderableTilesKeys){const k=this._tiles[L].tileID;if(k.canonical.equals(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16),s.aS(y.posMatrix,0,s.N,0,s.N,0,1),b[L]=y}else if(k.canonical.isChildOf(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=k.canonical.z-A.canonical.z,d=k.canonical.x-(k.canonical.x>>a<<a),_=k.canonical.y-(k.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,B,0,B,0,1),s.$(y.posMatrix,y.posMatrix,[-d*B,-_*B,0]),b[L]=y}else if(A.canonical.isChildOf(k.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=A.canonical.z-k.canonical.z,d=A.canonical.x-(A.canonical.x>>a<<a),_=A.canonical.y-(A.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,s.N,0,s.N,0,1),s.$(y.posMatrix,y.posMatrix,[d*B,_*B,0]),s.a0(y.posMatrix,y.posMatrix,[1/2**a,1/2**a,0]),b[L]=y}}return b}getSourceTile(A,b){const L=this.sourceCache._source;let k=A.overscaledZ-this.deltaZoom;if(k>L.maxzoom&&(k=L.maxzoom),k<L.minzoom)return null;this._sourceTileCache[A.key]||(this._sourceTileCache[A.key]=A.scaledTo(k).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[A.key]);if((!y||!y.dem)&&b)for(;k>=L.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(A.scaledTo(k--).key);return y}tilesAfterTime(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(b=>b.timeAdded>=A)}}class Cs{constructor(A,b,L){this.painter=A,this.sourceCache=new Oc(b),this.options=L,this.exaggeration=typeof L.exaggeration=="number"?L.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;var y;if(!(b>=0&&b<k&&L>=0&&L<k))return 0;const a=this.getTerrainData(A),d=(y=a.tile)===null||y===void 0?void 0:y.dem;if(!d)return 0;const _=function(w,T,R){var j=T[0],Z=T[1];return w[0]=R[0]*j+R[4]*Z+R[12],w[1]=R[1]*j+R[5]*Z+R[13],w}([],[b/k*s.N,L/k*s.N],a.u_terrain_matrix),B=[_[0]*d.dim,_[1]*d.dim],S=Math.floor(B[0]),U=Math.floor(B[1]),H=B[0]-S,q=B[1]-U;return d.get(S,U)*(1-H)*(1-q)+d.get(S+1,U)*H*(1-q)+d.get(S,U+1)*(1-H)*q+d.get(S+1,U+1)*H*q}getElevationForLngLatZoom(A,b){const{tileID:L,mercatorX:k,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(A,b);return this.getElevation(L,k%s.N,y%s.N,s.N)}getElevation(A,b,L){let k=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;return this.getDEMElevation(A,b,L,k)*this.exaggeration}getTerrainData(A){if(!this._emptyDemTexture){const k=this.painter.context,y=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new nt(k,y,k.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new nt(k,new s.R({width:1,height:1}),k.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const b=this.sourceCache.getSourceTile(A,!0);if(b&&b.dem&&(!b.demTexture||b.needsTerrainPrepare)){const k=this.painter.context;b.demTexture=this.painter.getTileTexture(b.dem.stride),b.demTexture?b.demTexture.update(b.dem.getPixels(),{premultiply:!1}):b.demTexture=new nt(k,b.dem.getPixels(),k.gl.RGBA,{premultiply:!1}),b.demTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),b.needsTerrainPrepare=!1}const L=b&&b+b.tileID.key+A.key;if(L&&!this._demMatrixCache[L]){const k=this.sourceCache.sourceCache._source.maxzoom;let y=A.canonical.z-b.tileID.canonical.z;A.overscaledZ>A.canonical.z&&(A.canonical.z>=k?y=A.canonical.z-k:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=A.canonical.x-(A.canonical.x>>y<<y),d=A.canonical.y-(A.canonical.y>>y<<y),_=s.bc(new Float64Array(16),[1/(s.N<<y),1/(s.N<<y),0]);s.$(_,_,[a*s.N,d*s.N,0]),this._demMatrixCache[A.key]={matrix:_,coord:A}}return{u_depth:2,u_terrain:3,u_terrain_dim:b&&b.dem&&b.dem.dim||1,u_terrain_matrix:L?this._demMatrixCache[A.key].matrix:this._emptyDemMatrix,u_terrain_unpack:b&&b.dem&&b.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(b&&b.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:b}}getFramebuffer(A){const b=this.painter,L=b.width/devicePixelRatio,k=b.height/devicePixelRatio;return!this._fbo||this._fbo.width===L&&this._fbo.height===k||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new nt(b.context,{width:L,height:k,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new nt(b.context,{width:L,height:k,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=b.context.createFramebuffer(L,k,!0,!1),this._fbo.depthAttachment.set(b.context.createRenderbuffer(b.context.gl.DEPTH_COMPONENT16,L,k))),this._fbo.colorAttachment.set(A==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const A=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const b=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,a=0;y<this._coordsTextureSize;y++)for(let d=0;d<this._coordsTextureSize;d++,a+=4)b[a+0]=255&d,b[a+1]=255&y,b[a+2]=d>>8<<4|y>>8,b[a+3]=0;const L=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(b.buffer)),k=new nt(A,L,A.gl.RGBA,{premultiply:!1});return k.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._coordsTexture=k,k}pointCoordinate(A){const b=new Uint8Array(4),L=this.painter.context,k=L.gl;L.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),k.readPixels(A.x,this.painter.height/devicePixelRatio-A.y-1,1,1,k.RGBA,k.UNSIGNED_BYTE,b),L.bindFramebuffer.set(null);const y=b[0]+(b[2]>>4<<8),a=b[1]+((15&b[2])<<8),d=this.coordsIndex[255-b[3]],_=d&&this.sourceCache.getTileByID(d);if(!_)return null;const B=this._coordsTextureSize,S=(1<<_.tileID.canonical.z)*B;return new s.U(this._allowMercatorOverflow(A,(_.tileID.canonical.x*B+y)/S),(_.tileID.canonical.y*B+a)/S,this.getElevation(_.tileID,y,a,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const A=this.painter.context,b=new s.bd,L=new s.b0,k=this.meshSize,y=s.N/k,a=k*k;for(let U=0;U<=k;U++)for(let H=0;H<=k;H++)b.emplaceBack(H*y,U*y,0);for(let U=0;U<a;U+=k+1)for(let H=0;H<k;H++)L.emplaceBack(H+U,k+H+U+1,k+H+U+2),L.emplaceBack(H+U,k+H+U+2,H+U+1);const d=b.length,_=d+2*(k+1);for(const U of[0,1])for(let H=0;H<=k;H++)for(const q of[0,1])b.emplaceBack(H*y,U*s.N,q);for(let U=0;U<2*k;U+=2)L.emplaceBack(_+U,_+U+1,_+U+3),L.emplaceBack(_+U,_+U+3,_+U+2),L.emplaceBack(d+U,d+U+3,d+U+1),L.emplaceBack(d+U,d+U+2,d+U+3);const B=b.length,S=B+2*(k+1);for(const U of[0,1])for(let H=0;H<=k;H++)for(const q of[0,1])b.emplaceBack(U*s.N,H*y,q);for(let U=0;U<2*k;U+=2)L.emplaceBack(B+U,B+U+1,B+U+3),L.emplaceBack(B+U,B+U+3,B+U+2),L.emplaceBack(S+U,S+U+3,S+U+1),L.emplaceBack(S+U,S+U+2,S+U+3);return this._mesh={indexBuffer:A.createIndexBuffer(L),vertexBuffer:A.createVertexBuffer(b,kc.members),segments:s.S.simpleSegment(0,0,b.length,L.length)},this._mesh}getMeshFrameDelta(A){return 2*Math.PI*s.be/Math.pow(2,A)/5}getMinTileElevationForLngLatZoom(A,b){var L;const{tileID:k}=this._getOverscaledTileIDFromLngLatZoom(A,b);return(L=this.getMinMaxElevation(k).minElevation)!==null&&L!==void 0?L:0}getMinMaxElevation(A){const b=this.getTerrainData(A).tile,L={minElevation:null,maxElevation:null};return b&&b.dem&&(L.minElevation=b.dem.min*this.exaggeration,L.maxElevation=b.dem.max*this.exaggeration),L}_getOverscaledTileIDFromLngLatZoom(A,b){const L=s.U.fromLngLat(A.wrap()),k=(1<<b)*s.N,y=L.x*k,a=L.y*k,d=Math.floor(y/s.N),_=Math.floor(a/s.N);return{tileID:new s.O(b,0,b,d,_),mercatorX:y,mercatorY:a}}_allowMercatorOverflow(A,b){const L=A.x<this.painter.width/2;let k=s.bf(b);const y=this.painter.transform.center.lng;return L&&Math.sign(k)>0&&Math.sign(y)<0||!L&&Math.sign(k)<0&&Math.sign(y)>0?(k=360*Math.sign(y)+k,s.G(k)):b}}class dh{constructor(A,b,L){this._context=A,this._size=b,this._tileSize=L,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const A of this._objects)A.texture.destroy(),A.fbo.destroy()}_createObject(A){const b=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),L=new nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return L.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),b.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),b.colorAttachment.set(L.texture),{id:A,fbo:b,texture:L,stamp:-1,inUse:!1}}getObjectForId(A){return this._objects[A]}useObject(A){A.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(b=>A.id!==b),this._recentlyUsed.push(A.id)}stampObject(A){A.stamp=++this._stamp}getOrCreateFreeObject(){for(const b of this._recentlyUsed)if(!this._objects[b].inUse)return this._objects[b];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const A=this._createObject(this._objects.length);return this._objects.push(A),A}freeObject(A){A.inUse=!1}freeAllObjects(){for(const A of this._objects)this.freeObject(A)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(A=>!A.inUse)===!1}}const jn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ou{constructor(A,b){this.painter=A,this.terrain=b,this.pool=new dh(A.context,30,b.sourceCache.tileSize*b.qualityFactor)}destruct(){this.pool.destruct()}getTexture(A){return this.pool.getObjectForId(A.rtt[this._stacks.length-1].id).texture}prepareForRender(A,b){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=A._order.filter(L=>!A._layers[L].isHidden(b)),this._coordsDescendingInv={};for(const L in A.sourceCaches){this._coordsDescendingInv[L]={};const k=A.sourceCaches[L].getVisibleCoordinates();for(const y of k){const a=this.terrain.sourceCache.getTerrainCoords(y);for(const d in a)this._coordsDescendingInv[L][d]||(this._coordsDescendingInv[L][d]=[]),this._coordsDescendingInv[L][d].push(a[d])}}this._coordsDescendingInvStr={};for(const L of A._order){const k=A._layers[L],y=k.source;if(jn[k.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const a in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][a]=this._coordsDescendingInv[y][a].map(d=>d.key).sort().join()}}for(const L of this._renderableTiles)for(const k in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[k][L.tileID.key];y&&y!==L.rttCoords[k]&&(L.rtt=[])}}renderLayer(A){if(A.isHidden(this.painter.transform.zoom))return!1;const b=A.type,L=this.painter,k=this._renderableLayerIds[this._renderableLayerIds.length-1]===A.id;if(jn[b]&&(this._prevType&&jn[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(A.id),!k))return!0;if(jn[this._prevType]||jn[b]&&k){this._prevType=b;const y=this._stacks.length-1,a=this._stacks[y]||[];for(const d of this._renderableTiles){if(this.pool.isFull()&&(Sn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(d),d.rtt[y]){const B=this.pool.getObjectForId(d.rtt[y].id);if(B.stamp===d.rtt[y].stamp){this.pool.useObject(B);continue}}const _=this.pool.getOrCreateFreeObject();this.pool.useObject(_),this.pool.stampObject(_),d.rtt[y]={id:_.id,stamp:_.stamp},L.context.bindFramebuffer.set(_.fbo.framebuffer),L.context.clear({color:s.aT.transparent,stencil:0}),L.currentStencilSource=void 0;for(let B=0;B<a.length;B++){const S=L.style._layers[a[B]],U=S.source?this._coordsDescendingInv[S.source][d.tileID.key]:[d.tileID];L.context.viewport.set([0,0,_.fbo.width,_.fbo.height]),L._renderTileClippingMasks(S,U),L.renderLayer(L,L.style.sourceCaches[S.source],S,U),S.source&&(d.rttCoords[S.source]=this._coordsDescendingInvStr[S.source][d.tileID.key])}}return Sn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),jn[b]}return!1}}const $i=m,Ni={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},qn=N=>{N.touchstart=N.dragStart,N.touchmoveWindow=N.dragMove,N.touchend=N.dragEnd},Pu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ds{constructor(A,b){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=a=>{this.startMouse(s.e({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),x.mousePos(this.element,a)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=a=>{this.moveMouse(a,x.mousePos(this.element,a))},this.mouseup=a=>{this.mouseRotate.dragEnd(a),this.mousePitch&&this.mousePitch.dragEnd(a),this.offTemp()},this.touchstart=a=>{a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,a.targetTouches)[0],this.startTouch(a,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=a=>{a.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,a.targetTouches)[0],this.moveTouch(a,this._lastPos))},this.touchend=a=>{a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const k=A.dragRotate._mouseRotate.getClickTolerance(),y=A.dragRotate._mousePitch.getClickTolerance();this.element=b,this.mouseRotate=go({clickTolerance:k,enable:!0}),this.touchRotate=(a=>{let{enable:d,clickTolerance:_,bearingDegreesPerPixelMoved:B=.8}=a;const S=new ya;return new Zr({clickTolerance:_,move:(U,H)=>({bearingDelta:(H.x-U.x)*B}),moveStateManager:S,enable:d,assignEvents:qn})})({clickTolerance:k,enable:!0}),this.map=A,L&&(this.mousePitch=Zo({clickTolerance:y,enable:!0}),this.touchPitch=(a=>{let{enable:d,clickTolerance:_,pitchDegreesPerPixelMoved:B=-.5}=a;const S=new ya;return new Zr({clickTolerance:_,move:(U,H)=>({pitchDelta:(H.y-U.y)*B}),moveStateManager:S,enable:d,assignEvents:qn})})({clickTolerance:y,enable:!0})),x.addEventListener(b,"mousedown",this.mousedown),x.addEventListener(b,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(b,"touchcancel",this.reset)}startMouse(A,b){this.mouseRotate.dragStart(A,b),this.mousePitch&&this.mousePitch.dragStart(A,b),x.disableDrag()}startTouch(A,b){this.touchRotate.dragStart(A,b),this.touchPitch&&this.touchPitch.dragStart(A,b),x.disableDrag()}moveMouse(A,b){const L=this.map,{bearingDelta:k}=this.mouseRotate.dragMove(A,b)||{};if(k&&L.setBearing(L.getBearing()+k),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(A,b)||{};y&&L.setPitch(L.getPitch()+y)}}moveTouch(A,b){const L=this.map,{bearingDelta:k}=this.touchRotate.dragMove(A,b)||{};if(k&&L.setBearing(L.getBearing()+k),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(A,b)||{};y&&L.setPitch(L.getPitch()+y)}}off(){const A=this.element;x.removeEventListener(A,"mousedown",this.mousedown),x.removeEventListener(A,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(A,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let tn;function Yo(N,A,b){if(N=new s.L(N.lng,N.lat),A){const L=new s.L(N.lng-360,N.lat),k=new s.L(N.lng+360,N.lat),y=b.locationPoint(N).distSqr(A);b.locationPoint(L).distSqr(A)<y?N=L:b.locationPoint(k).distSqr(A)<y&&(N=k)}for(;Math.abs(N.lng-b.center.lng)>180;){const L=b.locationPoint(N);if(L.x>=0&&L.y>=0&&L.x<=b.width&&L.y<=b.height)break;N.lng>b.center.lng?N.lng-=360:N.lng+=360}return N}const Ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function au(N,A,b){const L=N.classList;for(const k in Ro)L.remove(`maplibregl-${b}-anchor-${k}`);L.add(`maplibregl-${b}-anchor-${A}`)}class Rs extends s.E{constructor(A){if(super(),this._onKeyPress=b=>{const L=b.code,k=b.charCode||b.keyCode;L!=="Space"&&L!=="Enter"&&k!==32&&k!==13||this.togglePopup()},this._onMapClick=b=>{const L=b.originalEvent.target,k=this._element;this._popup&&(L===k||k.contains(L))&&this.togglePopup()},this._update=b=>{if(!this._map)return;const L=this._map.loaded()&&!this._map.isMoving();((b==null?void 0:b.type)==="terrain"||(b==null?void 0:b.type)==="render"&&!L)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Yo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),b&&b.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${Ro[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${k}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const a=this._map.unproject(this._pos),d=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=a.distanceTo(this._lngLat)>20*d?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=b=>{if(!this._isDragging){const L=this._clickTolerance||this._map._clickTolerance;this._isDragging=b.point.dist(this._pointerdownPos)>=L}this._isDragging&&(this._pos=b.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=b=>{this._element.contains(b.originalEvent.target)&&(b.preventDefault(),this._positionDelta=b.point.sub(this._pos).add(this._offset),this._pointerdownPos=b.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=A&&A.anchor||"center",this._color=A&&A.color||"#3FB1CE",this._scale=A&&A.scale||1,this._draggable=A&&A.draggable||!1,this._clickTolerance=A&&A.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=A&&A.rotation||0,this._rotationAlignment=A&&A.rotationAlignment||"auto",this._pitchAlignment=A&&A.pitchAlignment&&A.pitchAlignment!=="auto"?A.pitchAlignment:this._rotationAlignment,A&&A.element)this._element=A.element,this._offset=s.P.convert(A&&A.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const b=x.createNS("http://www.w3.org/2000/svg","svg"),L=41,k=27;b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height",`${L}px`),b.setAttributeNS(null,"width",`${k}px`),b.setAttributeNS(null,"viewBox",`0 0 ${k} ${L}`);const y=x.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const a=x.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const d=x.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(3.0, 29.0)"),d.setAttributeNS(null,"fill","#000000");const _=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const j of _){const Z=x.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",j.rx),Z.setAttributeNS(null,"ry",j.ry),d.appendChild(Z)}const B=x.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const S=x.createNS("http://www.w3.org/2000/svg","path");S.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(S);const U=x.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const H=x.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(H);const q=x.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const w=x.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(8.0, 8.0)");const T=x.createNS("http://www.w3.org/2000/svg","circle");T.setAttributeNS(null,"fill","#000000"),T.setAttributeNS(null,"opacity","0.25"),T.setAttributeNS(null,"cx","5.5"),T.setAttributeNS(null,"cy","5.5"),T.setAttributeNS(null,"r","5.4999962");const R=x.createNS("http://www.w3.org/2000/svg","circle");R.setAttributeNS(null,"fill","#FFFFFF"),R.setAttributeNS(null,"cx","5.5"),R.setAttributeNS(null,"cy","5.5"),R.setAttributeNS(null,"r","5.4999962"),w.appendChild(T),w.appendChild(R),a.appendChild(d),a.appendChild(B),a.appendChild(U),a.appendChild(q),a.appendChild(w),b.appendChild(a),b.setAttributeNS(null,"height",L*this._scale+"px"),b.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(b),this._offset=s.P.convert(A&&A.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()}),au(this._element,this._anchor,"marker"),A&&A.className)for(const b of A.className.split(" "))this._element.classList.add(b);this._popup=null}addTo(A){return this.remove(),this._map=A,A.getCanvasContainer().appendChild(this._element),A.on("move",this._update),A.on("moveend",this._update),A.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.L.convert(A),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(A){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),A){if(!("offset"in A.options)){const k=Math.abs(13.5)/Math.SQRT2;A.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[k,-1*(38.1-13.5+k)],"bottom-right":[-k,-1*(38.1-13.5+k)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=A,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const A=this._popup;return A?(A.isOpen()?A.remove():A.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(A){return this._offset=s.P.convert(A),this._update(),this}addClassName(A){this._element.classList.add(A)}removeClassName(A){this._element.classList.remove(A)}toggleClassName(A){return this._element.classList.toggle(A)}setDraggable(A){return this._draggable=!!A,this._map&&(A?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(A){return this._rotation=A||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(A){return this._rotationAlignment=A||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(A){return this._pitchAlignment=A&&A!=="auto"?A:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Jr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Un=0,ko=!1;const Al={maxWidth:100,unit:"metric"};function Ja(N,A,b){const L=b&&b.maxWidth||100,k=N._container.clientHeight/2,y=N.unproject([0,k]),a=N.unproject([L,k]),d=y.distanceTo(a);if(b&&b.unit==="imperial"){const _=3.2808*d;_>5280?Da(A,L,_/5280,N._getUIString("ScaleControl.Miles")):Da(A,L,_,N._getUIString("ScaleControl.Feet"))}else b&&b.unit==="nautical"?Da(A,L,d/1852,N._getUIString("ScaleControl.NauticalMiles")):d>=1e3?Da(A,L,d/1e3,N._getUIString("ScaleControl.Kilometers")):Da(A,L,d,N._getUIString("ScaleControl.Meters"))}function Da(N,A,b,L){const k=function(y){const a=Math.pow(10,`${Math.floor(y)}`.length-1);let d=y/a;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){const B=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*B)/B}(d),a*d}(b);N.style.width=A*(k/b)+"px",N.innerHTML=`${k}&nbsp;${L}`}const Kl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yo(N){if(N){if(typeof N=="number"){const A=Math.round(Math.abs(N)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,N),"top-left":new s.P(A,A),"top-right":new s.P(-A,A),bottom:new s.P(0,-N),"bottom-left":new s.P(A,-A),"bottom-right":new s.P(-A,-A),left:new s.P(N,0),right:new s.P(-N,0)}}if(N instanceof s.P||Array.isArray(N)){const A=s.P.convert(N);return{center:A,top:A,"top-left":A,"top-right":A,bottom:A,"bottom-left":A,"bottom-right":A,left:A,right:A}}return{center:s.P.convert(N.center||[0,0]),top:s.P.convert(N.top||[0,0]),"top-left":s.P.convert(N["top-left"]||[0,0]),"top-right":s.P.convert(N["top-right"]||[0,0]),bottom:s.P.convert(N.bottom||[0,0]),"bottom-left":s.P.convert(N["bottom-left"]||[0,0]),"bottom-right":s.P.convert(N["bottom-right"]||[0,0]),left:s.P.convert(N.left||[0,0]),right:s.P.convert(N.right||[0,0])}}return yo(new s.P(0,0))}const va={extend:function(N){for(var A=arguments.length,b=new Array(A>1?A-1:0),L=1;L<A;L++)b[L-1]=arguments[L];return s.e(N,...b)},run(N){N()},logToElement(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const L=window.document.getElementById(b);L&&(A&&(L.innerHTML=""),L.innerHTML+=`<br>${N}`)}},dl=m;class Gr{static get version(){return dl}static get workerCount(){return Ki.workerCount}static set workerCount(A){Ki.workerCount=A}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(A){s.c.WORKER_URL=A}static addProtocol(A,b){s.c.REGISTERED_PROTOCOLS[A]=b}static removeProtocol(A){delete s.c.REGISTERED_PROTOCOLS[A]}}return Gr.Map=class extends _a{constructor(N){if(s.bg.mark(s.bh.create),(N=s.e({},Ni,N)).minZoom!=null&&N.maxZoom!=null&&N.minZoom>N.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(N.minPitch!=null&&N.maxPitch!=null&&N.minPitch>N.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(N.minPitch!=null&&N.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(N.maxPitch!=null&&N.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new cl(N.minZoom,N.maxZoom,N.minPitch,N.maxPitch,N.renderWorldCopies),{bearingSnap:N.bearingSnap}),this._cooperativeGesturesOnWheel=A=>{this._onCooperativeGesture(A,A[this._metaKey],1)},this._contextLost=A=>{A.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=N.interactive,this._cooperativeGestures=N.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=N.maxTileCacheSize,this._maxTileCacheZoomLevels=N.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=N.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=N.preserveDrawingBuffer,this._antialias=N.antialias,this._trackResize=N.trackResize,this._bearingSnap=N.bearingSnap,this._refreshExpiredTiles=N.refreshExpiredTiles,this._fadeDuration=N.fadeDuration,this._crossSourceCollisions=N.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=N.collectResourceTiming,this._renderTaskQueue=new sr,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},$l,N.locale),this._clickTolerance=N.clickTolerance,this._overridePixelRatio=N.pixelRatio,this._maxCanvasSize=N.maxCanvasSize,this.transformCameraUpdate=N.transformCameraUpdate,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new de(N.transformRequest),typeof N.container=="string"){if(this._container=document.getElementById(N.container),!this._container)throw new Error(`Container '${N.container}' not found.`)}else{if(!(N.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=N.container}if(N.maxBounds&&this.setMaxBounds(N.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const b=fo(L=>{this._trackResize&&!this._removed&&this.resize(L)._update()},50);this._resizeObserver=new ResizeObserver(L=>{A?b(L):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new su(this,N),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=N.hash&&new ns(typeof N.hash=="string"&&N.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:N.center,zoom:N.zoom,bearing:N.bearing,pitch:N.pitch}),N.bounds&&(this.resize(),this.fitBounds(N.bounds,s.e({},N.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=N.localIdeographFontFamily,this._validateStyle=N.validateStyle,N.style&&this.setStyle(N.style,{localIdeographFontFamily:N.localIdeographFontFamily}),N.attributionControl&&this.addControl(new $s({customAttribution:N.customAttribution})),N.maplibreLogo&&this.addControl(new bi,N.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.k(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.k(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.k("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(N,A){if(A===void 0&&(A=N.getDefaultPosition?N.getDefaultPosition():"top-right"),!N||!N.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const b=N.onAdd(this);this._controls.push(N);const L=this._controlPositions[A];return A.indexOf("bottom")!==-1?L.insertBefore(b,L.firstChild):L.appendChild(b),this}removeControl(N){if(!N||!N.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const A=this._controls.indexOf(N);return A>-1&&this._controls.splice(A,1),N.onRemove(this),this}hasControl(N){return this._controls.indexOf(N)>-1}calculateCameraOptionsFromTo(N,A,b,L){return L==null&&this.terrain&&(L=this.terrain.getElevationForLngLatZoom(b,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(N,A,b,L)}resize(N){var A;const b=this._containerDimensions(),L=b[0],k=b[1],y=this._getClampedPixelRatio(L,k);if(this._resizeCanvas(L,k,y),this.painter.resize(L,k,y),this.painter.overLimit()){const d=this.painter.context.gl;this._maxCanvasSize=[d.drawingBufferWidth,d.drawingBufferHeight];const _=this._getClampedPixelRatio(L,k);this._resizeCanvas(L,k,_),this.painter.resize(L,k,_)}this.transform.resize(L,k),(A=this._requestedCameraState)===null||A===void 0||A.resize(L,k);const a=!this._moving;return a&&(this.stop(),this.fire(new s.k("movestart",N)).fire(new s.k("move",N))),this.fire(new s.k("resize",N)),a&&this.fire(new s.k("moveend",N)),this}_getClampedPixelRatio(N,A){const{0:b,1:L}=this._maxCanvasSize,k=this.getPixelRatio(),y=N*k,a=A*k;return Math.min(y>b?b/y:1,a>L?L/a:1)*k}getPixelRatio(){var N;return(N=this._overridePixelRatio)!==null&&N!==void 0?N:devicePixelRatio}setPixelRatio(N){this._overridePixelRatio=N,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(N){return this.transform.setMaxBounds(Xe.convert(N)),this._update()}setMinZoom(N){if((N=N??-2)>=-2&&N<=this.transform.maxZoom)return this.transform.minZoom=N,this._update(),this.getZoom()<N&&this.setZoom(N),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(N){if((N=N??22)>=this.transform.minZoom)return this.transform.maxZoom=N,this._update(),this.getZoom()>N&&this.setZoom(N),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(N){if((N=N??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(N>=0&&N<=this.transform.maxPitch)return this.transform.minPitch=N,this._update(),this.getPitch()<N&&this.setPitch(N),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(N){if((N=N??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(N>=this.transform.minPitch)return this.transform.maxPitch=N,this._update(),this.getPitch()>N&&this.setPitch(N),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(N){return this.transform.renderWorldCopies=N,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(N){return this._cooperativeGestures=N,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(N){return this.transform.locationPoint(s.L.convert(N),this.style&&this.terrain)}unproject(N){return this.transform.pointLocation(s.P.convert(N),this.terrain)}isMoving(){var N;return this._moving||((N=this.handlers)===null||N===void 0?void 0:N.isMoving())}isZooming(){var N;return this._zooming||((N=this.handlers)===null||N===void 0?void 0:N.isZooming())}isRotating(){var N;return this._rotating||((N=this.handlers)===null||N===void 0?void 0:N.isRotating())}_createDelegatedListener(N,A,b){if(N==="mouseenter"||N==="mouseover"){let L=!1;return{layer:A,listener:b,delegates:{mousemove:y=>{const a=this.getLayer(A)?this.queryRenderedFeatures(y.point,{layers:[A]}):[];a.length?L||(L=!0,b.call(this,new ms(N,this,y.originalEvent,{features:a}))):L=!1},mouseout:()=>{L=!1}}}}if(N==="mouseleave"||N==="mouseout"){let L=!1;return{layer:A,listener:b,delegates:{mousemove:a=>{(this.getLayer(A)?this.queryRenderedFeatures(a.point,{layers:[A]}):[]).length?L=!0:L&&(L=!1,b.call(this,new ms(N,this,a.originalEvent)))},mouseout:a=>{L&&(L=!1,b.call(this,new ms(N,this,a.originalEvent)))}}}}{const L=k=>{const y=this.getLayer(A)?this.queryRenderedFeatures(k.point,{layers:[A]}):[];y.length&&(k.features=y,b.call(this,k),delete k.features)};return{layer:A,listener:b,delegates:{[N]:L}}}}on(N,A,b){if(b===void 0)return super.on(N,A);const L=this._createDelegatedListener(N,A,b);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[N]=this._delegatedListeners[N]||[],this._delegatedListeners[N].push(L);for(const k in L.delegates)this.on(k,L.delegates[k]);return this}once(N,A,b){if(b===void 0)return super.once(N,A);const L=this._createDelegatedListener(N,A,b);for(const k in L.delegates)this.once(k,L.delegates[k]);return this}off(N,A,b){return b===void 0?super.off(N,A):(this._delegatedListeners&&this._delegatedListeners[N]&&(L=>{const k=this._delegatedListeners[N];for(let y=0;y<k.length;y++){const a=k[y];if(a.layer===A&&a.listener===b){for(const d in a.delegates)this.off(d,a.delegates[d]);return k.splice(y,1),this}}})(),this)}queryRenderedFeatures(N,A){if(!this.style)return[];let b;const L=N instanceof s.P||Array.isArray(N),k=L?N:[[0,0],[this.transform.width,this.transform.height]];if(A=A||(L?{}:N)||{},k instanceof s.P||typeof k[0]=="number")b=[s.P.convert(k)];else{const y=s.P.convert(k[0]),a=s.P.convert(k[1]);b=[y,new s.P(a.x,y.y),a,new s.P(y.x,a.y),y]}return this.style.queryRenderedFeatures(b,A,this.transform)}querySourceFeatures(N,A){return this.style.querySourceFeatures(N,A)}setStyle(N,A){return(A=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&N?(this._diffStyle(N,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(N,A))}setTransformRequest(N){return this._requestManager.setTransformRequest(N),this}_getUIString(N){const A=this._locale[N];if(A==null)throw new Error(`Missing UI string '${N}'`);return A}_updateStyle(N,A){if(A.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(N,A));const b=this.style&&A.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!N)),N?(this.style=new Wi(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof N=="string"?this.style.loadURL(N,A,b):this.style.loadJSON(N,A,b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(N,A){if(typeof N=="string"){const b=this._requestManager.transformRequest(N,ce.Style);s.f(b,(L,k)=>{L?this.fire(new s.j(L)):k&&this._updateDiff(k,A)})}else typeof N=="object"&&this._updateDiff(N,A)}_updateDiff(N,A){try{this.style.setState(N,A)&&this._update(!0)}catch(b){s.w(`Unable to perform style diff: ${b.message||b.error||b}.  Rebuilding the style from scratch.`),this._updateStyle(N,A)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(N,A){return this._lazyInitEmptyStyle(),this.style.addSource(N,A),this._update(!0)}isSourceLoaded(N){const A=this.style&&this.style.sourceCaches[N];if(A!==void 0)return A.loaded();this.fire(new s.j(new Error(`There is no source with ID '${N}'`)))}setTerrain(N){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),N){const A=this.style.sourceCaches[N.source];if(!A)throw new Error(`cannot load terrain, because there exists no source with ID: ${N.source}`);for(const b in this.style._layers){const L=this.style._layers[b];L.type==="hillshade"&&L.source===N.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cs(this.painter,A,N),this.painter.renderToTexture=new ou(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=b=>{b.dataType==="style"?this.terrain.sourceCache.freeRtt():b.dataType==="source"&&b.tile&&(b.sourceId!==N.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(b.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:N})),this}getTerrain(){var N,A;return(A=(N=this.terrain)===null||N===void 0?void 0:N.options)!==null&&A!==void 0?A:null}areTilesLoaded(){const N=this.style&&this.style.sourceCaches;for(const A in N){const b=N[A]._tiles;for(const L in b){const k=b[L];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0}addSourceType(N,A,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(N,A,b)}removeSource(N){return this.style.removeSource(N),this._update(!0)}getSource(N){return this.style.getSource(N)}addImage(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:L=1,sdf:k=!1,stretchX:y,stretchY:a,content:d}=b;if(this._lazyInitEmptyStyle(),!(A instanceof HTMLImageElement||s.a(A))){if(A.width===void 0||A.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:_,height:B,data:S}=A,U=A;return this.style.addImage(N,{data:new s.R({width:_,height:B},new Uint8Array(S)),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:k,version:0,userImage:U}),U.onAdd&&U.onAdd(this,N),this}}{const{width:_,height:B,data:S}=s.h.getImageData(A);this.style.addImage(N,{data:new s.R({width:_,height:B},S),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:k,version:0})}}updateImage(N,A){const b=this.style.getImage(N);if(!b)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const L=A instanceof HTMLImageElement||s.a(A)?s.h.getImageData(A):A,{width:k,height:y,data:a}=L;if(k===void 0||y===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(k!==b.data.width||y!==b.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const d=!(A instanceof HTMLImageElement||s.a(A));return b.data.replace(a,d),this.style.updateImage(N,b),this}getImage(N){return this.style.getImage(N)}hasImage(N){return N?!!this.style.getImage(N):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(N){this.style.removeImage(N)}loadImage(N,A){ue.getImage(this._requestManager.transformRequest(N,ce.Image),A)}listImages(){return this.style.listImages()}addLayer(N,A){return this._lazyInitEmptyStyle(),this.style.addLayer(N,A),this._update(!0)}moveLayer(N,A){return this.style.moveLayer(N,A),this._update(!0)}removeLayer(N){return this.style.removeLayer(N),this._update(!0)}getLayer(N){return this.style.getLayer(N)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(N,A,b){return this.style.setLayerZoomRange(N,A,b),this._update(!0)}setFilter(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(N,A,b),this._update(!0)}getFilter(N){return this.style.getFilter(N)}setPaintProperty(N,A,b){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(N,A,b,L),this._update(!0)}getPaintProperty(N,A){return this.style.getPaintProperty(N,A)}setLayoutProperty(N,A,b){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(N,A,b,L),this._update(!0)}getLayoutProperty(N,A){return this.style.getLayoutProperty(N,A)}setGlyphs(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(N,A),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(N,A,b,L=>{L||this._update(!0)}),this}removeSprite(N){return this._lazyInitEmptyStyle(),this.style.removeSprite(N),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(N,A,b=>{b||this._update(!0)}),this}setLight(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(N,A),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(N,A){return this.style.setFeatureState(N,A),this._update()}removeFeatureState(N,A){return this.style.removeFeatureState(N,A),this._update()}getFeatureState(N){return this.style.getFeatureState(N)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let N=0,A=0;return this._container&&(N=this._container.clientWidth||400,A=this._container.clientHeight||300),[N,A]}_setupContainer(){const N=this._container;N.classList.add("maplibregl-map");const A=this._canvasContainer=x.create("div","maplibregl-canvas-container",N);this._interactive&&A.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const b=this._containerDimensions(),L=this._getClampedPixelRatio(b[0],b[1]);this._resizeCanvas(b[0],b[1],L);const k=this._controlContainer=x.create("div","maplibregl-control-container",N),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{y[a]=x.create("div",`maplibregl-ctrl-${a} `,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=x.create("div","maplibregl-cooperative-gesture-screen",this._container);let N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${N}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){x.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(N,A,b){this._canvas.width=Math.floor(b*N),this._canvas.height=Math.floor(b*A),this._canvas.style.width=`${N}px`,this._canvas.style.height=`${A}px`}_setupPainter(){const N={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let A=null;this._canvas.addEventListener("webglcontextcreationerror",L=>{A={requestedAttributes:N},L&&(A.statusMessage=L.statusMessage,A.type=L.type)},{once:!0});const b=this._canvas.getContext("webgl2",N)||this._canvas.getContext("webgl",N);if(!b){const L="Failed to initialize WebGL";throw A?(A.message=L,new Error(JSON.stringify(A))):new Error(L)}this.painter=new on(b,this.transform),I.testSupport(b)}_onCooperativeGesture(N,A,b){return!A&&b<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(N){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||N,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(N){return this._update(),this._renderTaskQueue.add(N)}_cancelRenderFrame(N){this._renderTaskQueue.remove(N)}_render(N){const A=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(N),this._removed)return;let b=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,y=s.h.now();this.style.zoomHistory.update(k,y);const a=new s.a8(k,{now:y,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),d=a.crossFadingFactor();d===1&&d===this._crossFadingFactor||(b=!0,this._crossFadingFactor=d),this.style.update(a)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var N;this._hash&&this._hash.remove();for(const b of this._controls)b.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(N=this._resizeObserver)===null||N===void 0||N.disconnect();const A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(N=>{s.bg.frame(N),this._frame=null,this._render(N)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(N){this._showTileBoundaries!==N&&(this._showTileBoundaries=N,this._update())}get showPadding(){return!!this._showPadding}set showPadding(N){this._showPadding!==N&&(this._showPadding=N,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(N){this._showCollisionBoxes!==N&&(this._showCollisionBoxes=N,N?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(N){this._showOverdrawInspector!==N&&(this._showOverdrawInspector=N,this._update())}get repaint(){return!!this._repaint}set repaint(N){this._repaint!==N&&(this._repaint=N,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(N){this._vertices=N,this._update()}get version(){return $i}getCameraTargetElevation(){return this.transform.elevation}},Gr.NavigationControl=class{constructor(N){this._updateZoomButtons=()=>{const A=this._map.getZoom(),b=A===this._map.getMaxZoom(),L=A===this._map.getMinZoom();this._zoomInButton.disabled=b,this._zoomOutButton.disabled=L,this._zoomInButton.setAttribute("aria-disabled",b.toString()),this._zoomOutButton.setAttribute("aria-disabled",L.toString())},this._rotateCompassArrow=()=>{const A=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=A},this._setButtonTitle=(A,b)=>{const L=this._map._getUIString(`NavigationControl.${b}`);A.title=L,A.setAttribute("aria-label",L)},this.options=s.e({},Pu,N),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",A=>A.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",A=>this._map.zoomIn({},{originalEvent:A})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",A=>this._map.zoomOut({},{originalEvent:A})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",A=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:A}):this._map.resetNorth({},{originalEvent:A})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(N){return this._map=N,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ds(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(N,A){const b=x.create("button",N,this._container);return b.type="button",b.addEventListener("click",A),b}},Gr.GeolocateControl=class extends s.E{constructor(N){super(),this._onSuccess=A=>{if(this._map){if(this._isOutOfMapMaxBounds(A))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",A)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=A,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(A),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(A),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",A)),this._finish()}},this._updateCamera=A=>{const b=new s.L(A.coords.longitude,A.coords.latitude),L=A.coords.accuracy,k=this._map.getBearing(),y=s.e({bearing:k},this.options.fitBoundsOptions),a=Xe.fromLngLat(b,L);this._map.fitBounds(a,y,{geolocateSource:!0})},this._updateMarker=A=>{if(A){const b=new s.L(A.coords.longitude,A.coords.latitude);this._accuracyCircleMarker.setLngLat(b).addTo(this._map),this._userLocationDotMarker.setLngLat(b).addTo(this._map),this._accuracy=A.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=A=>{if(this._map){if(this.options.trackUserLocation)if(A.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(A.code===3&&ko)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",A)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=A=>{if(this._map){if(this._container.addEventListener("contextmenu",b=>b.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",A===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{const b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Rs({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",b=>{b.geolocateSource||this._watchState!=="ACTIVE_LOCK"||b.originalEvent&&b.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Jr,N)}onAdd(N){return this._map=N,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;tn===void 0||b?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(L=>{tn=L.state!=="denied",A(tn)}).catch(()=>{tn=!!window.navigator.geolocation,A(tn)}):(tn=!!window.navigator.geolocation,A(tn)):A(tn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Un=0,ko=!1}_isOutOfMapMaxBounds(N){const A=this._map.getMaxBounds(),b=N.coords;return A&&(b.longitude<A.getWest()||b.longitude>A.getEast()||b.latitude<A.getSouth()||b.latitude>A.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const N=this._map.getBounds(),A=N.getSouthEast(),b=N.getNorthEast(),L=A.distanceTo(b),k=Math.ceil(this._accuracy/(L/this._map._container.clientHeight)*2);this._circleElement.style.width=`${k}px`,this._circleElement.style.height=`${k}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Un--,ko=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let N;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Un++,Un>1?(N={maximumAge:6e5,timeout:0},ko=!0):(N=this.options.positionOptions,ko=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,N)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Gr.AttributionControl=$s,Gr.LogoControl=bi,Gr.ScaleControl=class{constructor(N){this._onMove=()=>{Ja(this._map,this._container,this.options)},this.setUnit=A=>{this.options.unit=A,Ja(this._map,this._container,this.options)},this.options=s.e({},Al,N)}getDefaultPosition(){return"bottom-left"}onAdd(N){return this._map=N,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",N.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Gr.FullscreenControl=class extends s.E{constructor(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,N&&N.container&&(N.container instanceof HTMLElement?this._container=N.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(N){return this._map=N,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const N=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",N).setAttribute("aria-hidden","true"),N.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const N=this._getTitle();this._fullscreenButton.setAttribute("aria-label",N),this._fullscreenButton.title=N}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Gr.TerrainControl=class{constructor(N){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=N}onAdd(N){return this._map=N,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Gr.Popup=class extends s.E{constructor(N){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=A=>{this._update(A.point)},this._onMouseMove=A=>{this._update(A.point)},this._onDrag=A=>{this._update(A.point)},this._update=A=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const a of this.options.className.split(" "))this._container.classList.add(a);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!A)return;const b=this._pos=this._trackPointer&&A?A:this._map.project(this._lngLat);let L=this.options.anchor;const k=yo(this.options.offset);if(!L){const a=this._container.offsetWidth,d=this._container.offsetHeight;let _;_=b.y+k.bottom.y<d?["top"]:b.y>this._map.transform.height-d?["bottom"]:[],b.x<a/2?_.push("left"):b.x>this._map.transform.width-a/2&&_.push("right"),L=_.length===0?"bottom":_.join("-")}const y=b.add(k[L]).round();x.setTransform(this._container,`${Ro[L]} translate(${y.x}px,${y.y}px)`),au(this._container,L,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Kl),N)}addTo(N){return this._map&&this.remove(),this._map=N,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(N){return this._lngLat=s.L.convert(N),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(N){return this.setDOMContent(document.createTextNode(N))}setHTML(N){const A=document.createDocumentFragment(),b=document.createElement("body");let L;for(b.innerHTML=N;L=b.firstChild,L;)A.appendChild(L);return this.setDOMContent(A)}getMaxWidth(){var N;return(N=this._container)===null||N===void 0?void 0:N.style.maxWidth}setMaxWidth(N){return this.options.maxWidth=N,this._update(),this}setDOMContent(N){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(N),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(N){this._container&&this._container.classList.add(N)}removeClassName(N){this._container&&this._container.classList.remove(N)}setOffset(N){return this.options.offset=N,this._update(),this}toggleClassName(N){if(this._container)return this._container.classList.toggle(N)}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const N=this._container.querySelector(lu);N&&N.focus()}},Gr.Marker=Rs,Gr.Style=Wi,Gr.LngLat=s.L,Gr.LngLatBounds=Xe,Gr.Point=s.P,Gr.MercatorCoordinate=s.U,Gr.Evented=s.E,Gr.AJAXError=s.bi,Gr.config=s.c,Gr.CanvasSource=gi,Gr.GeoJSONSource=Pt,Gr.ImageSource=Ht,Gr.RasterDEMTileSource=wt,Gr.RasterTileSource=ft,Gr.VectorTileSource=At,Gr.VideoSource=ii,Gr.setRTLTextPlugin=s.bj,Gr.getRTLTextPluginStatus=s.bk,Gr.prewarm=function(){Er().acquire(li)},Gr.clearPrewarmedResources=function(){const N=Ar;N&&(N.isPreloaded()&&N.numActive()===1?(N.release(li),Ar=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},va.extend(Gr,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),Gr});var c=n;return c})})(aF);var qee=aF.exports,$ee=Object.defineProperty,Kee=(i,e,t)=>e in i?$ee(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ls=(i,e,t)=>(Kee(i,typeof e!="symbol"?e+"":e,t),t);let Wee=class{constructor(e){Ls(this,"map"),Ls(this,"width"),Ls(this,"height"),Ls(this,"svgCanvas"),Ls(this,"xLine"),Ls(this,"yLine"),Ls(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const r=this.width/2,n=this.height/2;this.yLine=t.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,r,n,o,c){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",r),s.setAttribute("y2",n),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",o),s.setAttribute("stroke-width",c),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function Zn(i){"@babel/helpers - typeof";return Zn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zn(i)}var tc=Uint8Array,ic=Uint16Array,uy=Uint32Array,d1=new tc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),f1=new tc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_B=new tc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lF=function(i,e){for(var t=new ic(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new uy(t[30]),r=1;r<30;++r)for(var o=t[r];o<t[r+1];++o)n[o]=o-t[r]<<5|r;return[t,n]},cF=lF(d1,2),uF=cF[0],vB=cF[1];uF[28]=258,vB[258]=28;for(var hF=lF(f1,0),Xee=hF[0],AF=hF[1],bB=new ic(32768),js=0;js<32768;++js){var id=(js&43690)>>>1|(js&21845)<<1;id=(id&52428)>>>2|(id&13107)<<2,id=(id&61680)>>>4|(id&3855)<<4,bB[js]=((id&65280)>>>8|(id&255)<<8)>>>1}for(var Uh=function(i,e,t){for(var r=i.length,n=0,o=new ic(e);n<r;++n)++o[i[n]-1];var c=new ic(e);for(n=0;n<e;++n)c[n]=c[n-1]+o[n-1]<<1;var s;if(t){s=new ic(1<<e);var m=15-e;for(n=0;n<r;++n)if(i[n])for(var x=n<<4|i[n],I=e-i[n],F=c[i[n]-1]++<<I,O=F|(1<<I)-1;F<=O;++F)s[bB[F]>>>m]=x}else for(s=new ic(r),n=0;n<r;++n)s[n]=bB[c[i[n]-1]++]>>>15-i[n];return s},rd=new tc(288),js=0;js<144;++js)rd[js]=8;for(var js=144;js<256;++js)rd[js]=9;for(var js=256;js<280;++js)rd[js]=7;for(var js=280;js<288;++js)rd[js]=8;for(var hy=new tc(32),js=0;js<32;++js)hy[js]=5;var Zee=Uh(rd,9,0),Jee=Uh(rd,9,1),Yee=Uh(hy,5,0),ete=Uh(hy,5,1),xB=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Yu=function(i,e,t){var r=e/8>>0;return(i[r]|i[r+1]<<8)>>>(e&7)&t},wB=function(i,e){var t=e/8>>0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>>(e&7)},BB=function(i){return(i/8>>0)+(i&7&&1)},dF=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i instanceof ic?ic:i instanceof uy?uy:tc)(t-e);return r.set(i.subarray(e,t)),r},tte=function(i,e,t){var r=i.length,n=!e||t,o=!t||t.i;t||(t={}),e||(e=new tc(r*3));var c=function(ft){var wt=e.length;if(ft>wt){var Pt=new tc(Math.max(wt*2,ft));Pt.set(e),e=Pt}},s=t.f||0,m=t.p||0,x=t.b||0,I=t.l,F=t.d,O=t.m,z=t.n,ie=r*8;do{if(!I){t.f=s=Yu(i,m,1);var ne=Yu(i,m+1,3);if(m+=3,ne)if(ne==1)I=Jee,F=ete,O=9,z=5;else if(ne==2){var ue=Yu(i,m,31)+257,ce=Yu(i,m+10,15)+4,de=ue+Yu(i,m+5,31)+1;m+=14;for(var be=new tc(de),Te=new tc(19),je=0;je<ce;++je)Te[_B[je]]=Yu(i,m+je*3,7);m+=ce*3;var Ge=xB(Te),$e=(1<<Ge)-1;if(!o&&m+de*(Ge+7)>ie)break;for(var Ue=Uh(Te,Ge,1),je=0;je<de;){var lt=Ue[Yu(i,m,$e)];m+=lt&15;var nt=lt>>>4;if(nt<16)be[je++]=nt;else{var De=0,Fe=0;for(nt==16?(Fe=3+Yu(i,m,3),m+=2,De=be[je-1]):nt==17?(Fe=3+Yu(i,m,7),m+=3):nt==18&&(Fe=11+Yu(i,m,127),m+=7);Fe--;)be[je++]=De}}var Je=be.subarray(0,ue),We=be.subarray(ue);O=xB(Je),z=xB(We),I=Uh(Je,O,1),F=Uh(We,z,1)}else throw"invalid block type";else{var nt=BB(m)+4,Et=i[nt-4]|i[nt-3]<<8,Ct=nt+Et;if(Ct>r){if(o)throw"unexpected EOF";break}n&&c(x+Et),e.set(i.subarray(nt,Ct),x),t.b=x+=Et,t.p=m=Ct*8;continue}if(m>ie)throw"unexpected EOF"}n&&c(x+131072);for(var Lt=(1<<O)-1,_t=(1<<z)-1,Ft=O+z+18;o||m+Ft<ie;){var De=I[wB(i,m)&Lt],Mt=De>>>4;if(m+=De&15,m>ie)throw"unexpected EOF";if(!De)throw"invalid length/literal";if(Mt<256)e[x++]=Mt;else if(Mt==256){I=null;break}else{var Wt=Mt-254;if(Mt>264){var je=Mt-257,Ee=d1[je];Wt=Yu(i,m,(1<<Ee)-1)+uF[je],m+=Ee}var Xe=F[wB(i,m)&_t],et=Xe>>>4;if(!Xe)throw"invalid distance";m+=Xe&15;var We=Xee[et];if(et>3){var Ee=f1[et];We+=wB(i,m)&(1<<Ee)-1,m+=Ee}if(m>ie)throw"unexpected EOF";n&&c(x+131072);for(var At=x+Wt;x<At;x+=4)e[x]=e[x-We],e[x+1]=e[x+1-We],e[x+2]=e[x+2-We],e[x+3]=e[x+3-We];x=At}}t.l=I,t.p=m,t.b=x,I&&(s=1,t.m=O,t.d=F,t.n=z)}while(!s);return x==e.length?e:dF(e,0,x)},bA=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8},Ay=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8,i[r+2]|=t>>>16},CB=function(i,e){for(var t=[],r=0;r<i.length;++r)i[r]&&t.push({s:r,f:i[r]});var n=t.length,o=t.slice();if(!n)return[new tc(0),0];if(n==1){var c=new tc(t[0].s+1);return c[t[0].s]=1,[c,1]}t.sort(function(je,Ge){return je.f-Ge.f}),t.push({s:-1,f:25001});var s=t[0],m=t[1],x=0,I=1,F=2;for(t[0]={s:-1,f:s.f+m.f,l:s,r:m};I!=n-1;)s=t[t[x].f<t[F].f?x++:F++],m=t[x!=I&&t[x].f<t[F].f?x++:F++],t[I++]={s:-1,f:s.f+m.f,l:s,r:m};for(var O=o[0].s,r=1;r<n;++r)o[r].s>O&&(O=o[r].s);var z=new ic(O+1),ie=EB(t[I-1],z,0);if(ie>e){var r=0,ne=0,ue=ie-e,ce=1<<ue;for(o.sort(function(Ge,$e){return z[$e.s]-z[Ge.s]||Ge.f-$e.f});r<n;++r){var de=o[r].s;if(z[de]>e)ne+=ce-(1<<ie-z[de]),z[de]=e;else break}for(ne>>>=ue;ne>0;){var be=o[r].s;z[be]<e?ne-=1<<e-z[be]++-1:++r}for(;r>=0&&ne;--r){var Te=o[r].s;z[Te]==e&&(--z[Te],++ne)}ie=e}return[new tc(z),ie]},EB=function(i,e,t){return i.s==-1?Math.max(EB(i.l,e,t+1),EB(i.r,e,t+1)):e[i.s]=t},fF=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new ic(++e),r=0,n=i[0],o=1,c=function(m){t[r++]=m},s=1;s<=e;++s)if(i[s]==n&&s!=e)++o;else{if(!n&&o>2){for(;o>138;o-=138)c(32754);o>2&&(c(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(c(n),--o;o>6;o-=6)c(8304);o>2&&(c(o-3<<5|8208),o=0)}for(;o--;)c(n);o=1,n=i[s]}return[t.subarray(0,r),e]},dy=function(i,e){for(var t=0,r=0;r<e.length;++r)t+=i[r]*e[r];return t},p1=function(i,e,t){var r=t.length,n=BB(e+2);i[n]=r&255,i[n+1]=r>>>8,i[n+2]=i[n]^255,i[n+3]=i[n+1]^255;for(var o=0;o<r;++o)i[n+o+4]=t[o];return(n+4+r)*8},pF=function(i,e,t,r,n,o,c,s,m,x,I){bA(e,I++,t),++n[256];for(var F=CB(n,15),O=F[0],z=F[1],ie=CB(o,15),ne=ie[0],ue=ie[1],ce=fF(O),de=ce[0],be=ce[1],Te=fF(ne),je=Te[0],Ge=Te[1],$e=new ic(19),Ue=0;Ue<de.length;++Ue)$e[de[Ue]&31]++;for(var Ue=0;Ue<je.length;++Ue)$e[je[Ue]&31]++;for(var lt=CB($e,7),nt=lt[0],De=lt[1],Fe=19;Fe>4&&!nt[_B[Fe-1]];--Fe);var Je=x+5<<3,We=dy(n,rd)+dy(o,hy)+c,Et=dy(n,O)+dy(o,ne)+c+14+3*Fe+dy($e,nt)+(2*$e[16]+3*$e[17]+7*$e[18]);if(Je<=We&&Je<=Et)return p1(e,I,i.subarray(m,m+x));var Ct,Lt,_t,Ft;if(bA(e,I,1+(Et<We)),I+=2,Et<We){Ct=Uh(O,z,0),Lt=O,_t=Uh(ne,ue,0),Ft=ne;var Mt=Uh(nt,De,0);bA(e,I,be-257),bA(e,I+5,Ge-1),bA(e,I+10,Fe-4),I+=14;for(var Ue=0;Ue<Fe;++Ue)bA(e,I+3*Ue,nt[_B[Ue]]);I+=3*Fe;for(var Wt=[de,je],Ee=0;Ee<2;++Ee)for(var Xe=Wt[Ee],Ue=0;Ue<Xe.length;++Ue){var et=Xe[Ue]&31;bA(e,I,Mt[et]),I+=nt[et],et>15&&(bA(e,I,Xe[Ue]>>>5&127),I+=Xe[Ue]>>>12)}}else Ct=Zee,Lt=rd,_t=Yee,Ft=hy;for(var Ue=0;Ue<s;++Ue)if(r[Ue]>255){var et=r[Ue]>>>18&31;Ay(e,I,Ct[et+257]),I+=Lt[et+257],et>7&&(bA(e,I,r[Ue]>>>23&31),I+=d1[et]);var At=r[Ue]&31;Ay(e,I,_t[At]),I+=Ft[At],At>3&&(Ay(e,I,r[Ue]>>>5&8191),I+=f1[At])}else Ay(e,I,Ct[r[Ue]]),I+=Lt[r[Ue]];return Ay(e,I,Ct[256]),I+Lt[256]},ite=new uy([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rte=new tc(0),nte=function(i,e,t,r,n,o){var c=i.length,s=new tc(r+c+5*(1+Math.floor(c/7e3))+n),m=s.subarray(r,s.length-n),x=0;if(!e||c<8)for(var I=0;I<=c;I+=65535){var F=I+65535;F<c?x=p1(m,x,i.subarray(I,F)):(m[I]=o,x=p1(m,x,i.subarray(I,c)))}else{for(var O=ite[e-1],z=O>>>13,ie=O&8191,ne=(1<<t)-1,ue=new ic(32768),ce=new ic(ne+1),de=Math.ceil(t/3),be=2*de,Te=function(Mi){return(i[Mi]^i[Mi+1]<<de^i[Mi+2]<<be)&ne},je=new uy(25e3),Ge=new ic(288),$e=new ic(32),Ue=0,lt=0,I=0,nt=0,De=0,Fe=0;I<c;++I){var Je=Te(I),We=I&32767,Et=ce[Je];if(ue[We]=Et,ce[Je]=We,De<=I){var Ct=c-I;if((Ue>7e3||nt>24576)&&Ct>423){x=pF(i,m,0,je,Ge,$e,lt,nt,Fe,I-Fe,x),nt=Ue=lt=0,Fe=I;for(var Lt=0;Lt<286;++Lt)Ge[Lt]=0;for(var Lt=0;Lt<30;++Lt)$e[Lt]=0}var _t=2,Ft=0,Mt=ie,Wt=We-Et&32767;if(Ct>2&&Je==Te(I-Wt))for(var Ee=Math.min(z,Ct)-1,Xe=Math.min(32767,I),et=Math.min(258,Ct);Wt<=Xe&&--Mt&&We!=Et;){if(i[I+_t]==i[I+_t-Wt]){for(var At=0;At<et&&i[I+At]==i[I+At-Wt];++At);if(At>_t){if(_t=At,Ft=Wt,At>Ee)break;for(var ft=Math.min(Wt,At-2),wt=0,Lt=0;Lt<ft;++Lt){var Pt=I-Wt+Lt+32768&32767,It=ue[Pt],Ht=Pt-It+32768&32767;Ht>wt&&(wt=Ht,Et=Pt)}}}We=Et,Et=ue[We],Wt+=We-Et+32768&32767}if(Ft){je[nt++]=268435456|vB[_t]<<18|AF[Ft];var ii=vB[_t]&31,gi=AF[Ft]&31;lt+=d1[ii]+f1[gi],++Ge[257+ii],++$e[gi],De=I+_t,++Ue}else je[nt++]=i[I],++Ge[i[I]]}}x=pF(i,m,o,je,Ge,$e,lt,nt,Fe,I-Fe,x),o||(x=p1(m,x,rte))}return dF(s,0,r+BB(x)+n)},ste=function(){var i=1,e=0;return{p:function(t){for(var r=i,n=e,o=t.length,c=0;c!=o;){for(var s=Math.min(c+5552,o);c<s;++c)r+=t[c],n+=r;r%=65521,n%=65521}i=r,e=n},d:function(){return(i>>>8<<16|(e&255)<<8|e>>>8)+((i&255)<<23)*2}}},ote=function(i,e,t,r,n){return nte(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,r,!n)},ate=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},lte=function(i,e){var t=e.level,r=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},cte=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function SB(i,e){e===void 0&&(e={});var t=ste();t.p(i);var r=ote(i,e,2,4);return lte(r,e),ate(r,r.length-4,t.d()),r}function ute(i,e){return tte((cte(i),i.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Rr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function TB(){Rr.console&&typeof Rr.console.log=="function"&&Rr.console.log.apply(Rr.console,arguments)}var Ms={log:TB,warn:function(i){Rr.console&&(typeof Rr.console.warn=="function"?Rr.console.warn.apply(Rr.console,arguments):TB.call(null,arguments))},error:function(i){Rr.console&&(typeof Rr.console.error=="function"?Rr.console.error.apply(Rr.console,arguments):TB(i))}};function IB(i,e,t){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){Af(r.response,e,t)},r.onerror=function(){Ms.error("could not download file")},r.send()}function gF(i){var e=new XMLHttpRequest;e.open("HEAD",i,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function g1(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}var fy,LB,Af=Rr.saveAs||((typeof window>"u"?"undefined":Zn(window))!=="object"||window!==Rr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,e,t){var r=Rr.URL||Rr.webkitURL,n=document.createElement("a");e=e||i.name||"download",n.download=e,n.rel="noopener",typeof i=="string"?(n.href=i,n.origin!==location.origin?gF(n.href)?IB(i,e,t):g1(n,n.target="_blank"):g1(n)):(n.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){g1(n)},0))}:"msSaveOrOpenBlob"in navigator?function(i,e,t){if(e=e||i.name||"download",typeof i=="string")if(gF(i))IB(i,e,t);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){g1(r)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:Zn(o)!=="object"&&(Ms.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(i,t),e)}:function(i,e,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return IB(i,e,t);var n=i.type==="application/octet-stream",o=/constructor/i.test(Rr.HTMLElement)||Rr.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||n&&o)&&(typeof FileReader>"u"?"undefined":Zn(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var I=s.result;I=c?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=I:location=I,r=null},s.readAsDataURL(i)}else{var m=Rr.URL||Rr.webkitURL,x=m.createObjectURL(i);r?r.location=x:location.href=x,r=null,setTimeout(function(){m.revokeObjectURL(x)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function mF(i){var e;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,c=n.exec(i);c&&(e=o(c),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),m=this.g.toString(16),x=this.b.toString(16);return s.length==1&&(s="0"+s),m.length==1&&(m="0"+m),x.length==1&&(x="0"+x),"#"+s+m+x}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function MB(i,e){var t=i[0],r=i[1],n=i[2],o=i[3];t=Cl(t,r,n,o,e[0],7,-680876936),o=Cl(o,t,r,n,e[1],12,-389564586),n=Cl(n,o,t,r,e[2],17,606105819),r=Cl(r,n,o,t,e[3],22,-1044525330),t=Cl(t,r,n,o,e[4],7,-176418897),o=Cl(o,t,r,n,e[5],12,1200080426),n=Cl(n,o,t,r,e[6],17,-1473231341),r=Cl(r,n,o,t,e[7],22,-45705983),t=Cl(t,r,n,o,e[8],7,1770035416),o=Cl(o,t,r,n,e[9],12,-1958414417),n=Cl(n,o,t,r,e[10],17,-42063),r=Cl(r,n,o,t,e[11],22,-1990404162),t=Cl(t,r,n,o,e[12],7,1804603682),o=Cl(o,t,r,n,e[13],12,-40341101),n=Cl(n,o,t,r,e[14],17,-1502002290),t=El(t,r=Cl(r,n,o,t,e[15],22,1236535329),n,o,e[1],5,-165796510),o=El(o,t,r,n,e[6],9,-1069501632),n=El(n,o,t,r,e[11],14,643717713),r=El(r,n,o,t,e[0],20,-373897302),t=El(t,r,n,o,e[5],5,-701558691),o=El(o,t,r,n,e[10],9,38016083),n=El(n,o,t,r,e[15],14,-660478335),r=El(r,n,o,t,e[4],20,-405537848),t=El(t,r,n,o,e[9],5,568446438),o=El(o,t,r,n,e[14],9,-1019803690),n=El(n,o,t,r,e[3],14,-187363961),r=El(r,n,o,t,e[8],20,1163531501),t=El(t,r,n,o,e[13],5,-1444681467),o=El(o,t,r,n,e[2],9,-51403784),n=El(n,o,t,r,e[7],14,1735328473),t=Sl(t,r=El(r,n,o,t,e[12],20,-1926607734),n,o,e[5],4,-378558),o=Sl(o,t,r,n,e[8],11,-2022574463),n=Sl(n,o,t,r,e[11],16,1839030562),r=Sl(r,n,o,t,e[14],23,-35309556),t=Sl(t,r,n,o,e[1],4,-1530992060),o=Sl(o,t,r,n,e[4],11,1272893353),n=Sl(n,o,t,r,e[7],16,-155497632),r=Sl(r,n,o,t,e[10],23,-1094730640),t=Sl(t,r,n,o,e[13],4,681279174),o=Sl(o,t,r,n,e[0],11,-358537222),n=Sl(n,o,t,r,e[3],16,-722521979),r=Sl(r,n,o,t,e[6],23,76029189),t=Sl(t,r,n,o,e[9],4,-640364487),o=Sl(o,t,r,n,e[12],11,-421815835),n=Sl(n,o,t,r,e[15],16,530742520),t=Tl(t,r=Sl(r,n,o,t,e[2],23,-995338651),n,o,e[0],6,-198630844),o=Tl(o,t,r,n,e[7],10,1126891415),n=Tl(n,o,t,r,e[14],15,-1416354905),r=Tl(r,n,o,t,e[5],21,-57434055),t=Tl(t,r,n,o,e[12],6,1700485571),o=Tl(o,t,r,n,e[3],10,-1894986606),n=Tl(n,o,t,r,e[10],15,-1051523),r=Tl(r,n,o,t,e[1],21,-2054922799),t=Tl(t,r,n,o,e[8],6,1873313359),o=Tl(o,t,r,n,e[15],10,-30611744),n=Tl(n,o,t,r,e[6],15,-1560198380),r=Tl(r,n,o,t,e[13],21,1309151649),t=Tl(t,r,n,o,e[4],6,-145523070),o=Tl(o,t,r,n,e[11],10,-1120210379),n=Tl(n,o,t,r,e[2],15,718787259),r=Tl(r,n,o,t,e[9],21,-343485551),i[0]=nd(t,i[0]),i[1]=nd(r,i[1]),i[2]=nd(n,i[2]),i[3]=nd(o,i[3])}function m1(i,e,t,r,n,o){return e=nd(nd(e,i),nd(r,o)),nd(e<<n|e>>>32-n,t)}function Cl(i,e,t,r,n,o,c){return m1(e&t|~e&r,i,e,n,o,c)}function El(i,e,t,r,n,o,c){return m1(e&r|t&~r,i,e,n,o,c)}function Sl(i,e,t,r,n,o,c){return m1(e^t^r,i,e,n,o,c)}function Tl(i,e,t,r,n,o,c){return m1(t^(e|~r),i,e,n,o,c)}function yF(i){var e,t=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=i.length;e+=64)MB(r,hte(i.substring(e-64,e)));i=i.substring(e-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i.length;e++)n[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(MB(r,n),e=0;e<16;e++)n[e]=0;return n[14]=8*t,MB(r,n),r}function hte(i){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return t}fy=Rr.atob.bind(Rr),LB=Rr.btoa.bind(Rr);var _F="0123456789abcdef".split("");function Ate(i){for(var e="",t=0;t<4;t++)e+=_F[i>>8*t+4&15]+_F[i>>8*t&15];return e}function dte(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function PB(i){return yF(i).map(dte).join("")}var fte=function(i){for(var e=0;e<i.length;e++)i[e]=Ate(i[e]);return i.join("")}(yF("hello"))!="5d41402abc4b2a76b9719d911017c592";function nd(i,e){if(fte){var t=(65535&i)+(65535&e);return(i>>16)+(e>>16)+(t>>16)<<16|65535&t}return i+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function FB(i,e){var t,r,n,o;if(i!==t){for(var c=(n=i,o=1+(256/i.length>>0),new Array(o+1).join(n)),s=[],m=0;m<256;m++)s[m]=m;var x=0;for(m=0;m<256;m++){var I=s[m];x=(x+I+c.charCodeAt(m))%256,s[m]=s[x],s[x]=I}t=i,r=s}else s=r;var F=e.length,O=0,z=0,ie="";for(m=0;m<F;m++)z=(z+(I=s[O=(O+1)%256]))%256,s[O]=s[z],s[z]=I,c=s[(s[O]+s[z])%256],ie+=String.fromCharCode(e.charCodeAt(m)^c);return ie}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var vF={print:4,modify:8,copy:16,"annot-forms":32};function ig(i,e,t,r){this.v=1,this.r=2;var n=192;i.forEach(function(s){if(vF.perm!==void 0)throw new Error("Invalid permission: "+s);n+=vF[s]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var o=(e+this.padding).substr(0,32),c=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,c),this.P=-(1+(255^n)),this.encryptionKey=PB(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=FB(this.encryptionKey,this.padding)}function rg(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var e="",t=i.length,r=0;r<t;r++){var n=i.charCodeAt(r);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?e+="#"+("0"+n.toString(16)).slice(-2):e+=i[r]}return e}function bF(i){if(Zn(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,r,n){if(n=n||!1,typeof t!="string"||typeof r!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[r,!!n],o},this.unsubscribe=function(t){for(var r in e)if(e[r][t])return delete e[r][t],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var r=Array.prototype.slice.call(arguments,1),n=[];for(var o in e[t]){var c=e[t][o];try{c[0].apply(i,r)}catch(s){Rr.console&&Ms.error("jsPDF PubSub Error",s.message,s)}c[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function y1(i){if(!(this instanceof y1))return new y1(i);var e="opacity,stroke-opacity".split(",");for(var t in i)i.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=i[t]);this.id="",this.objectNumber=-1}function xF(i,e){this.gState=i,this.matrix=e,this.id="",this.objectNumber=-1}function df(i,e,t,r,n){if(!(this instanceof df))return new df(i,e,t,r,n);this.type=i==="axial"?2:3,this.coords=e,this.colors=t,xF.call(this,r,n)}function ng(i,e,t,r,n){if(!(this instanceof ng))return new ng(i,e,t,r,n);this.boundingBox=i,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,xF.call(this,r,n)}function kr(i){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],n=arguments[2],o=arguments[3],c=[],s=1,m=16,x="S",I=null;Zn(i=i||{})==="object"&&(t=i.orientation,r=i.unit||r,n=i.format||n,o=i.compress||i.compressPdf||o,(I=i.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),s=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(e=i.precision),i.floatPrecision!==void 0&&(m=i.floatPrecision),x=i.defaultPathOperation||"S"),c=i.filters||(o===!0?["FlateEncode"]:c),r=r||"mm",t=(""+(t||"P")).toLowerCase();var F=i.putOnlyUsedFonts||!1,O={},z={internal:{},__private__:{}};z.__private__.PubSub=bF;var ie="1.3",ne=z.__private__.getPdfVersion=function(){return ie};z.__private__.setPdfVersion=function(re){ie=re};var ue={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};z.__private__.getPageFormats=function(){return ue};var ce=z.__private__.getPageFormat=function(re){return ue[re]};n=n||"a4";var de={COMPAT:"compat",ADVANCED:"advanced"},be=de.COMPAT;function Te(){this.saveGraphicsState(),ot(new ve(ci,0,0,-ci,0,Ys()*ci).toString()+" cm"),this.setFontSize(this.getFontSize()/ci),x="n",be=de.ADVANCED}function je(){this.restoreGraphicsState(),x="S",be=de.COMPAT}var Ge=z.__private__.combineFontStyleAndFontWeight=function(re,Ie){if(re=="bold"&&Ie=="normal"||re=="bold"&&Ie==400||re=="normal"&&Ie=="italic"||re=="bold"&&Ie=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ie&&(re=Ie==400||Ie==="normal"?re==="italic"?"italic":"normal":Ie!=700&&Ie!=="bold"||re!=="normal"?(Ie==700?"bold":Ie)+""+re:"bold"),re};z.advancedAPI=function(re){var Ie=be===de.COMPAT;return Ie&&Te.call(this),typeof re!="function"||(re(this),Ie&&je.call(this)),this},z.compatAPI=function(re){var Ie=be===de.ADVANCED;return Ie&&je.call(this),typeof re!="function"||(re(this),Ie&&Te.call(this)),this},z.isAdvancedAPI=function(){return be===de.ADVANCED};var $e,Ue=function(re){if(be!==de.ADVANCED)throw new Error(re+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},lt=z.roundToPrecision=z.__private__.roundToPrecision=function(re,Ie){var at=e||Ie;if(isNaN(re)||isNaN(at))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return re.toFixed(at).replace(/0+$/,"")};$e=z.hpf=z.__private__.hpf=typeof m=="number"?function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(re,m)}:m==="smart"?function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(re,re>-1&&re<1?16:5)}:function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(re,16)};var nt=z.f2=z.__private__.f2=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.f2");return lt(re,2)},De=z.__private__.f3=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.f3");return lt(re,3)},Fe=z.scale=z.__private__.scale=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.scale");return be===de.COMPAT?re*ci:be===de.ADVANCED?re:void 0},Je=function(re){return be===de.COMPAT?Ys()-re:be===de.ADVANCED?re:void 0},We=function(re){return Fe(Je(re))};z.__private__.setPrecision=z.setPrecision=function(re){typeof parseInt(re,10)=="number"&&(e=parseInt(re,10))};var Et,Ct="00000000000000000000000000000000",Lt=z.__private__.getFileId=function(){return Ct},_t=z.__private__.setFileId=function(re){return Ct=re!==void 0&&/^[a-fA-F0-9]{32}$/.test(re)?re.toUpperCase():Ct.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(wn=new ig(I.userPermissions,I.userPassword,I.ownerPassword,Ct)),Ct};z.setFileId=function(re){return _t(re),this},z.getFileId=function(){return Lt()};var Ft=z.__private__.convertDateToPDFDate=function(re){var Ie=re.getTimezoneOffset(),at=Ie<0?"+":"-",mt=Math.floor(Math.abs(Ie/60)),vt=Math.abs(Ie%60),Tt=[at,et(mt),"'",et(vt),"'"].join("");return["D:",re.getFullYear(),et(re.getMonth()+1),et(re.getDate()),et(re.getHours()),et(re.getMinutes()),et(re.getSeconds()),Tt].join("")},Mt=z.__private__.convertPDFDateToDate=function(re){var Ie=parseInt(re.substr(2,4),10),at=parseInt(re.substr(6,2),10)-1,mt=parseInt(re.substr(8,2),10),vt=parseInt(re.substr(10,2),10),Tt=parseInt(re.substr(12,2),10),pi=parseInt(re.substr(14,2),10);return new Date(Ie,at,mt,vt,Tt,pi,0)},Wt=z.__private__.setCreationDate=function(re){var Ie;if(re===void 0&&(re=new Date),re instanceof Date)Ie=Ft(re);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(re))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ie=re}return Et=Ie},Ee=z.__private__.getCreationDate=function(re){var Ie=Et;return re==="jsDate"&&(Ie=Mt(Et)),Ie};z.setCreationDate=function(re){return Wt(re),this},z.getCreationDate=function(re){return Ee(re)};var Xe,et=z.__private__.padd2=function(re){return("0"+parseInt(re)).slice(-2)},At=z.__private__.padd2Hex=function(re){return("00"+(re=re.toString())).substr(re.length)},ft=0,wt=[],Pt=[],It=0,Ht=[],ii=[],gi=!1,mi=Pt,Mi=function(){ft=0,It=0,Pt=[],wt=[],Ht=[],qt=yt(),Kt=yt()};z.__private__.setCustomOutputDestination=function(re){gi=!0,mi=re};var kt=function(re){gi||(mi=re)};z.__private__.resetCustomOutputDestination=function(){gi=!1,mi=Pt};var ot=z.__private__.out=function(re){return re=re.toString(),It+=re.length+1,mi.push(re),mi},xt=z.__private__.write=function(re){return ot(arguments.length===1?re.toString():Array.prototype.join.call(arguments," "))},Ri=z.__private__.getArrayBuffer=function(re){for(var Ie=re.length,at=new ArrayBuffer(Ie),mt=new Uint8Array(at);Ie--;)mt[Ie]=re.charCodeAt(Ie);return at},ei=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];z.__private__.getStandardFonts=function(){return ei};var ut=i.fontSize||16;z.__private__.setFontSize=z.setFontSize=function(re){return ut=be===de.ADVANCED?re/ci:re,this};var jt,ni=z.__private__.getFontSize=z.getFontSize=function(){return be===de.COMPAT?ut:ut*ci},di=i.R2L||!1;z.__private__.setR2L=z.setR2L=function(re){return di=re,this},z.__private__.getR2L=z.getR2L=function(){return di};var li,Ki=z.__private__.setZoomMode=function(re){var Ie=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(re))jt=re;else if(isNaN(re)){if(Ie.indexOf(re)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+re+'" is not recognized.');jt=re}else jt=parseInt(re,10)};z.__private__.getZoomMode=function(){return jt};var tr,Ar=z.__private__.setPageMode=function(re){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(re)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+re+'" is not recognized.');li=re};z.__private__.getPageMode=function(){return li};var Er=z.__private__.setLayoutMode=function(re){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(re)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+re+'" is not recognized.');tr=re};z.__private__.getLayoutMode=function(){return tr},z.__private__.setDisplayMode=z.setDisplayMode=function(re,Ie,at){return Ki(re),Er(Ie),Ar(at),this};var Nt={title:"",subject:"",author:"",keywords:"",creator:""};z.__private__.getDocumentProperty=function(re){if(Object.keys(Nt).indexOf(re)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Nt[re]},z.__private__.getDocumentProperties=function(){return Nt},z.__private__.setDocumentProperties=z.setProperties=z.setDocumentProperties=function(re){for(var Ie in Nt)Nt.hasOwnProperty(Ie)&&re[Ie]&&(Nt[Ie]=re[Ie]);return this},z.__private__.setDocumentProperty=function(re,Ie){if(Object.keys(Nt).indexOf(re)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Nt[re]=Ie};var Ji,ci,$t,Zi,Qt,Bi={},Ii={},Gt=[],vi={},Jt={},mr={},Sr={},ze=null,we=0,oe=[],Y=new bF(z),le=i.hotfixes||[],ge={},_e={},Ce=[],ve=function re(Ie,at,mt,vt,Tt,pi){if(!(this instanceof re))return new re(Ie,at,mt,vt,Tt,pi);isNaN(Ie)&&(Ie=1),isNaN(at)&&(at=0),isNaN(mt)&&(mt=0),isNaN(vt)&&(vt=1),isNaN(Tt)&&(Tt=0),isNaN(pi)&&(pi=0),this._matrix=[Ie,at,mt,vt,Tt,pi]};Object.defineProperty(ve.prototype,"sx",{get:function(){return this._matrix[0]},set:function(re){this._matrix[0]=re}}),Object.defineProperty(ve.prototype,"shy",{get:function(){return this._matrix[1]},set:function(re){this._matrix[1]=re}}),Object.defineProperty(ve.prototype,"shx",{get:function(){return this._matrix[2]},set:function(re){this._matrix[2]=re}}),Object.defineProperty(ve.prototype,"sy",{get:function(){return this._matrix[3]},set:function(re){this._matrix[3]=re}}),Object.defineProperty(ve.prototype,"tx",{get:function(){return this._matrix[4]},set:function(re){this._matrix[4]=re}}),Object.defineProperty(ve.prototype,"ty",{get:function(){return this._matrix[5]},set:function(re){this._matrix[5]=re}}),Object.defineProperty(ve.prototype,"a",{get:function(){return this._matrix[0]},set:function(re){this._matrix[0]=re}}),Object.defineProperty(ve.prototype,"b",{get:function(){return this._matrix[1]},set:function(re){this._matrix[1]=re}}),Object.defineProperty(ve.prototype,"c",{get:function(){return this._matrix[2]},set:function(re){this._matrix[2]=re}}),Object.defineProperty(ve.prototype,"d",{get:function(){return this._matrix[3]},set:function(re){this._matrix[3]=re}}),Object.defineProperty(ve.prototype,"e",{get:function(){return this._matrix[4]},set:function(re){this._matrix[4]=re}}),Object.defineProperty(ve.prototype,"f",{get:function(){return this._matrix[5]},set:function(re){this._matrix[5]=re}}),Object.defineProperty(ve.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(ve.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(ve.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(ve.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),ve.prototype.join=function(re){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map($e).join(re)},ve.prototype.multiply=function(re){var Ie=re.sx*this.sx+re.shy*this.shx,at=re.sx*this.shy+re.shy*this.sy,mt=re.shx*this.sx+re.sy*this.shx,vt=re.shx*this.shy+re.sy*this.sy,Tt=re.tx*this.sx+re.ty*this.shx+this.tx,pi=re.tx*this.shy+re.ty*this.sy+this.ty;return new ve(Ie,at,mt,vt,Tt,pi)},ve.prototype.decompose=function(){var re=this.sx,Ie=this.shy,at=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty,pi=Math.sqrt(re*re+Ie*Ie),ri=(re/=pi)*at+(Ie/=pi)*mt;at-=re*ri,mt-=Ie*ri;var rr=Math.sqrt(at*at+mt*mt);return ri/=rr,re*(mt/=rr)<Ie*(at/=rr)&&(re=-re,Ie=-Ie,ri=-ri,pi=-pi),{scale:new ve(pi,0,0,rr,0,0),translate:new ve(1,0,0,1,vt,Tt),rotate:new ve(re,Ie,-Ie,re,0,0),skew:new ve(1,0,ri,1,0,0)}},ve.prototype.toString=function(re){return this.join(" ")},ve.prototype.inversed=function(){var re=this.sx,Ie=this.shy,at=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty,pi=1/(re*mt-Ie*at),ri=mt*pi,rr=-Ie*pi,qi=-at*pi,ki=re*pi;return new ve(ri,rr,qi,ki,-ri*vt-qi*Tt,-rr*vt-ki*Tt)},ve.prototype.applyToPoint=function(re){var Ie=re.x*this.sx+re.y*this.shx+this.tx,at=re.x*this.shy+re.y*this.sy+this.ty;return new Ol(Ie,at)},ve.prototype.applyToRectangle=function(re){var Ie=this.applyToPoint(re),at=this.applyToPoint(new Ol(re.x+re.w,re.y+re.h));return new Ka(Ie.x,Ie.y,at.x-Ie.x,at.y-Ie.y)},ve.prototype.clone=function(){var re=this.sx,Ie=this.shy,at=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty;return new ve(re,Ie,at,mt,vt,Tt)},z.Matrix=ve;var Me=z.matrixMult=function(re,Ie){return Ie.multiply(re)},Oe=new ve(1,0,0,1,0,0);z.unitMatrix=z.identityMatrix=Oe;var Ve=function(re,Ie){if(!Jt[re]){var at=(Ie instanceof df?"Sh":"P")+(Object.keys(vi).length+1).toString(10);Ie.id=at,Jt[re]=at,vi[at]=Ie,Y.publish("addPattern",Ie)}};z.ShadingPattern=df,z.TilingPattern=ng,z.addShadingPattern=function(re,Ie){return Ue("addShadingPattern()"),Ve(re,Ie),this},z.beginTilingPattern=function(re){Ue("beginTilingPattern()"),Ul(re.boundingBox[0],re.boundingBox[1],re.boundingBox[2]-re.boundingBox[0],re.boundingBox[3]-re.boundingBox[1],re.matrix)},z.endTilingPattern=function(re,Ie){Ue("endTilingPattern()"),Ie.stream=ii[Xe].join(`
`),Ve(re,Ie),Y.publish("endTilingPattern",Ie),Ce.pop().restore()};var it=z.__private__.newObject=function(){var re=yt();return Bt(re,!0),re},yt=z.__private__.newObjectDeferred=function(){return ft++,wt[ft]=function(){return It},ft},Bt=function(re,Ie){return Ie=typeof Ie=="boolean"&&Ie,wt[re]=It,Ie&&ot(re+" 0 obj"),re},Yt=z.__private__.newAdditionalObject=function(){var re={objId:yt(),content:""};return Ht.push(re),re},qt=yt(),Kt=yt(),si=z.__private__.decodeColorString=function(re){var Ie=re.split(" ");if(Ie.length!==2||Ie[1]!=="g"&&Ie[1]!=="G")Ie.length===5&&(Ie[4]==="k"||Ie[4]==="K")&&(Ie=[(1-Ie[0])*(1-Ie[3]),(1-Ie[1])*(1-Ie[3]),(1-Ie[2])*(1-Ie[3]),"r"]);else{var at=parseFloat(Ie[0]);Ie=[at,at,at,"r"]}for(var mt="#",vt=0;vt<3;vt++)mt+=("0"+Math.floor(255*parseFloat(Ie[vt])).toString(16)).slice(-2);return mt},Ci=z.__private__.encodeColorString=function(re){var Ie;typeof re=="string"&&(re={ch1:re});var at=re.ch1,mt=re.ch2,vt=re.ch3,Tt=re.ch4,pi=re.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof at=="string"&&at.charAt(0)!=="#"){var ri=new mF(at);if(ri.ok)at=ri.toHex();else if(!/^\d*\.?\d*$/.test(at))throw new Error('Invalid color "'+at+'" passed to jsPDF.encodeColorString.')}if(typeof at=="string"&&/^#[0-9A-Fa-f]{3}$/.test(at)&&(at="#"+at[1]+at[1]+at[2]+at[2]+at[3]+at[3]),typeof at=="string"&&/^#[0-9A-Fa-f]{6}$/.test(at)){var rr=parseInt(at.substr(1),16);at=rr>>16&255,mt=rr>>8&255,vt=255&rr}if(mt===void 0||Tt===void 0&&at===mt&&mt===vt)if(typeof at=="string")Ie=at+" "+pi[0];else switch(re.precision){case 2:Ie=nt(at/255)+" "+pi[0];break;case 3:default:Ie=De(at/255)+" "+pi[0]}else if(Tt===void 0||Zn(Tt)==="object"){if(Tt&&!isNaN(Tt.a)&&Tt.a===0)return Ie=["1.","1.","1.",pi[1]].join(" ");if(typeof at=="string")Ie=[at,mt,vt,pi[1]].join(" ");else switch(re.precision){case 2:Ie=[nt(at/255),nt(mt/255),nt(vt/255),pi[1]].join(" ");break;default:case 3:Ie=[De(at/255),De(mt/255),De(vt/255),pi[1]].join(" ")}}else if(typeof at=="string")Ie=[at,mt,vt,Tt,pi[2]].join(" ");else switch(re.precision){case 2:Ie=[nt(at),nt(mt),nt(vt),nt(Tt),pi[2]].join(" ");break;case 3:default:Ie=[De(at),De(mt),De(vt),De(Tt),pi[2]].join(" ")}return Ie},Hi=z.__private__.getFilters=function(){return c},wi=z.__private__.putStream=function(re){var Ie=(re=re||{}).data||"",at=re.filters||Hi(),mt=re.alreadyAppliedFilters||[],vt=re.addLength1||!1,Tt=Ie.length,pi=re.objectId,ri=function(Lr){return Lr};if(I!==null&&pi===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(ri=wn.encryptor(pi,0));var rr={};at===!0&&(at=["FlateEncode"]);var qi=re.additionalKeyValues||[],ki=(rr=kr.API.processDataByFilters!==void 0?kr.API.processDataByFilters(Ie,at):{data:Ie,reverseChain:[]}).reverseChain+(Array.isArray(mt)?mt.join(" "):mt.toString());if(rr.data.length!==0&&(qi.push({key:"Length",value:rr.data.length}),vt===!0&&qi.push({key:"Length1",value:Tt})),ki.length!=0)if(ki.split("/").length-1==1)qi.push({key:"Filter",value:ki});else{qi.push({key:"Filter",value:"["+ki+"]"});for(var jr=0;jr<qi.length;jr+=1)if(qi[jr].key==="DecodeParms"){for(var nr=[],Hn=0;Hn<rr.reverseChain.split("/").length-1;Hn+=1)nr.push("null");nr.push(qi[jr].value),qi[jr].value="["+nr.join(" ")+"]"}}ot("<<");for(var Br=0;Br<qi.length;Br++)ot("/"+qi[Br].key+" "+qi[Br].value);ot(">>"),rr.data.length!==0&&(ot("stream"),ot(ri(rr.data)),ot("endstream"))},Ui=z.__private__.putPage=function(re){var Ie=re.number,at=re.data,mt=re.objId,vt=re.contentsObjId;Bt(mt,!0),ot("<</Type /Page"),ot("/Parent "+re.rootDictionaryObjId+" 0 R"),ot("/Resources "+re.resourceDictionaryObjId+" 0 R"),ot("/MediaBox ["+parseFloat($e(re.mediaBox.bottomLeftX))+" "+parseFloat($e(re.mediaBox.bottomLeftY))+" "+$e(re.mediaBox.topRightX)+" "+$e(re.mediaBox.topRightY)+"]"),re.cropBox!==null&&ot("/CropBox ["+$e(re.cropBox.bottomLeftX)+" "+$e(re.cropBox.bottomLeftY)+" "+$e(re.cropBox.topRightX)+" "+$e(re.cropBox.topRightY)+"]"),re.bleedBox!==null&&ot("/BleedBox ["+$e(re.bleedBox.bottomLeftX)+" "+$e(re.bleedBox.bottomLeftY)+" "+$e(re.bleedBox.topRightX)+" "+$e(re.bleedBox.topRightY)+"]"),re.trimBox!==null&&ot("/TrimBox ["+$e(re.trimBox.bottomLeftX)+" "+$e(re.trimBox.bottomLeftY)+" "+$e(re.trimBox.topRightX)+" "+$e(re.trimBox.topRightY)+"]"),re.artBox!==null&&ot("/ArtBox ["+$e(re.artBox.bottomLeftX)+" "+$e(re.artBox.bottomLeftY)+" "+$e(re.artBox.topRightX)+" "+$e(re.artBox.topRightY)+"]"),typeof re.userUnit=="number"&&re.userUnit!==1&&ot("/UserUnit "+re.userUnit),Y.publish("putPage",{objId:mt,pageContext:oe[Ie],pageNumber:Ie,page:at}),ot("/Contents "+vt+" 0 R"),ot(">>"),ot("endobj");var Tt=at.join(`
`);return be===de.ADVANCED&&(Tt+=`
Q`),Bt(vt,!0),wi({data:Tt,filters:Hi(),objectId:vt}),ot("endobj"),mt},st=z.__private__.putPages=function(){var re,Ie,at=[];for(re=1;re<=we;re++)oe[re].objId=yt(),oe[re].contentsObjId=yt();for(re=1;re<=we;re++)at.push(Ui({number:re,data:ii[re],objId:oe[re].objId,contentsObjId:oe[re].contentsObjId,mediaBox:oe[re].mediaBox,cropBox:oe[re].cropBox,bleedBox:oe[re].bleedBox,trimBox:oe[re].trimBox,artBox:oe[re].artBox,userUnit:oe[re].userUnit,rootDictionaryObjId:qt,resourceDictionaryObjId:Kt}));Bt(qt,!0),ot("<</Type /Pages");var mt="/Kids [";for(Ie=0;Ie<we;Ie++)mt+=at[Ie]+" 0 R ";ot(mt+"]"),ot("/Count "+we),ot(">>"),ot("endobj"),Y.publish("postPutPages")},ti=function(re){Y.publish("putFont",{font:re,out:ot,newObject:it,putStream:wi}),re.isAlreadyPutted!==!0&&(re.objectNumber=it(),ot("<<"),ot("/Type /Font"),ot("/BaseFont /"+rg(re.postScriptName)),ot("/Subtype /Type1"),typeof re.encoding=="string"&&ot("/Encoding /"+re.encoding),ot("/FirstChar 32"),ot("/LastChar 255"),ot(">>"),ot("endobj"))},zt=function(){for(var re in Bi)Bi.hasOwnProperty(re)&&(F===!1||F===!0&&O.hasOwnProperty(re))&&ti(Bi[re])},zi=function(re){re.objectNumber=it();var Ie=[];Ie.push({key:"Type",value:"/XObject"}),Ie.push({key:"Subtype",value:"/Form"}),Ie.push({key:"BBox",value:"["+[$e(re.x),$e(re.y),$e(re.x+re.width),$e(re.y+re.height)].join(" ")+"]"}),Ie.push({key:"Matrix",value:"["+re.matrix.toString()+"]"});var at=re.pages[1].join(`
`);wi({data:at,additionalKeyValues:Ie,objectId:re.objectNumber}),ot("endobj")},hr=function(){for(var re in ge)ge.hasOwnProperty(re)&&zi(ge[re])},sn=function(re,Ie){var at,mt=[],vt=1/(Ie-1);for(at=0;at<1;at+=vt)mt.push(at);if(mt.push(1),re[0].offset!=0){var Tt={offset:0,color:re[0].color};re.unshift(Tt)}if(re[re.length-1].offset!=1){var pi={offset:1,color:re[re.length-1].color};re.push(pi)}for(var ri="",rr=0,qi=0;qi<mt.length;qi++){for(at=mt[qi];at>re[rr+1].offset;)rr++;var ki=re[rr].offset,jr=(at-ki)/(re[rr+1].offset-ki),nr=re[rr].color,Hn=re[rr+1].color;ri+=At(Math.round((1-jr)*nr[0]+jr*Hn[0]).toString(16))+At(Math.round((1-jr)*nr[1]+jr*Hn[1]).toString(16))+At(Math.round((1-jr)*nr[2]+jr*Hn[2]).toString(16))}return ri.trim()},bn=function(re,Ie){Ie||(Ie=21);var at=it(),mt=sn(re.colors,Ie),vt=[];vt.push({key:"FunctionType",value:"0"}),vt.push({key:"Domain",value:"[0.0 1.0]"}),vt.push({key:"Size",value:"["+Ie+"]"}),vt.push({key:"BitsPerSample",value:"8"}),vt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),vt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),wi({data:mt,additionalKeyValues:vt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:at}),ot("endobj"),re.objectNumber=it(),ot("<< /ShadingType "+re.type),ot("/ColorSpace /DeviceRGB");var Tt="/Coords ["+$e(parseFloat(re.coords[0]))+" "+$e(parseFloat(re.coords[1]))+" ";re.type===2?Tt+=$e(parseFloat(re.coords[2]))+" "+$e(parseFloat(re.coords[3])):Tt+=$e(parseFloat(re.coords[2]))+" "+$e(parseFloat(re.coords[3]))+" "+$e(parseFloat(re.coords[4]))+" "+$e(parseFloat(re.coords[5])),ot(Tt+="]"),re.matrix&&ot("/Matrix ["+re.matrix.toString()+"]"),ot("/Function "+at+" 0 R"),ot("/Extend [true true]"),ot(">>"),ot("endobj")},ur=function(re,Ie){var at=yt(),mt=it();Ie.push({resourcesOid:at,objectOid:mt}),re.objectNumber=mt;var vt=[];vt.push({key:"Type",value:"/Pattern"}),vt.push({key:"PatternType",value:"1"}),vt.push({key:"PaintType",value:"1"}),vt.push({key:"TilingType",value:"1"}),vt.push({key:"BBox",value:"["+re.boundingBox.map($e).join(" ")+"]"}),vt.push({key:"XStep",value:$e(re.xStep)}),vt.push({key:"YStep",value:$e(re.yStep)}),vt.push({key:"Resources",value:at+" 0 R"}),re.matrix&&vt.push({key:"Matrix",value:"["+re.matrix.toString()+"]"}),wi({data:re.stream,additionalKeyValues:vt,objectId:re.objectNumber}),ot("endobj")},gn=function(re){var Ie;for(Ie in vi)vi.hasOwnProperty(Ie)&&(vi[Ie]instanceof df?bn(vi[Ie]):vi[Ie]instanceof ng&&ur(vi[Ie],re))},mn=function(re){for(var Ie in re.objectNumber=it(),ot("<<"),re)switch(Ie){case"opacity":ot("/ca "+nt(re[Ie]));break;case"stroke-opacity":ot("/CA "+nt(re[Ie]))}ot(">>"),ot("endobj")},lr=function(){var re;for(re in mr)mr.hasOwnProperty(re)&&mn(mr[re])},Rn=function(){for(var re in ot("/XObject <<"),ge)ge.hasOwnProperty(re)&&ge[re].objectNumber>=0&&ot("/"+re+" "+ge[re].objectNumber+" 0 R");Y.publish("putXobjectDict"),ot(">>")},ps=function(){wn.oid=it(),ot("<<"),ot("/Filter /Standard"),ot("/V "+wn.v),ot("/R "+wn.r),ot("/U <"+wn.toHexString(wn.U)+">"),ot("/O <"+wn.toHexString(wn.O)+">"),ot("/P "+wn.P),ot(">>"),ot("endobj")},Qr=function(){for(var re in ot("/Font <<"),Bi)Bi.hasOwnProperty(re)&&(F===!1||F===!0&&O.hasOwnProperty(re))&&ot("/"+re+" "+Bi[re].objectNumber+" 0 R");ot(">>")},xn=function(){if(Object.keys(vi).length>0){for(var re in ot("/Shading <<"),vi)vi.hasOwnProperty(re)&&vi[re]instanceof df&&vi[re].objectNumber>=0&&ot("/"+re+" "+vi[re].objectNumber+" 0 R");Y.publish("putShadingPatternDict"),ot(">>")}},So=function(re){if(Object.keys(vi).length>0){for(var Ie in ot("/Pattern <<"),vi)vi.hasOwnProperty(Ie)&&vi[Ie]instanceof z.TilingPattern&&vi[Ie].objectNumber>=0&&vi[Ie].objectNumber<re&&ot("/"+Ie+" "+vi[Ie].objectNumber+" 0 R");Y.publish("putTilingPatternDict"),ot(">>")}},cs=function(){if(Object.keys(mr).length>0){var re;for(re in ot("/ExtGState <<"),mr)mr.hasOwnProperty(re)&&mr[re].objectNumber>=0&&ot("/"+re+" "+mr[re].objectNumber+" 0 R");Y.publish("putGStateDict"),ot(">>")}},Wi=function(re){Bt(re.resourcesOid,!0),ot("<<"),ot("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Qr(),xn(),So(re.objectOid),cs(),Rn(),ot(">>"),ot("endobj")},Js=function(){var re=[];zt(),lr(),hr(),gn(re),Y.publish("putResources"),re.forEach(Wi),Wi({resourcesOid:Kt,objectOid:Number.MAX_SAFE_INTEGER}),Y.publish("postPutResources")},ws=function(){Y.publish("putAdditionalObjects");for(var re=0;re<Ht.length;re++){var Ie=Ht[re];Bt(Ie.objId,!0),ot(Ie.content),ot("endobj")}Y.publish("postPutAdditionalObjects")},dr=function(re){Ii[re.fontName]=Ii[re.fontName]||{},Ii[re.fontName][re.fontStyle]=re.id},Fr=function(re,Ie,at,mt,vt){var Tt={id:"F"+(Object.keys(Bi).length+1).toString(10),postScriptName:re,fontName:Ie,fontStyle:at,encoding:mt,isStandardFont:vt||!1,metadata:{}};return Y.publish("addFont",{font:Tt,instance:this}),Bi[Tt.id]=Tt,dr(Tt),Tt.id},Vn=function(re){for(var Ie=0,at=ei.length;Ie<at;Ie++){var mt=Fr.call(this,re[Ie][0],re[Ie][1],re[Ie][2],ei[Ie][3],!0);F===!1&&(O[mt]=!0);var vt=re[Ie][0].split("-");dr({id:mt,fontName:vt[0],fontStyle:vt[1]||""})}Y.publish("addFonts",{fonts:Bi,dictionary:Ii})},Or=function(re){return re.foo=function(){try{return re.apply(this,arguments)}catch(mt){var Ie=mt.stack||"";~Ie.indexOf(" at ")&&(Ie=Ie.split(" at ")[1]);var at="Error in function "+Ie.split(`
`)[0].split("<")[0]+": "+mt.message;if(!Rr.console)throw new Error(at);Rr.console.error(at,mt),Rr.alert&&alert(at)}},re.foo.bar=re,re.foo},Cn=function(re,Ie){var at,mt,vt,Tt,pi,ri,rr,qi,ki;if(vt=(Ie=Ie||{}).sourceEncoding||"Unicode",pi=Ie.outputEncoding,(Ie.autoencode||pi)&&Bi[Ji].metadata&&Bi[Ji].metadata[vt]&&Bi[Ji].metadata[vt].encoding&&(Tt=Bi[Ji].metadata[vt].encoding,!pi&&Bi[Ji].encoding&&(pi=Bi[Ji].encoding),!pi&&Tt.codePages&&(pi=Tt.codePages[0]),typeof pi=="string"&&(pi=Tt[pi]),pi)){for(rr=!1,ri=[],at=0,mt=re.length;at<mt;at++)(qi=pi[re.charCodeAt(at)])?ri.push(String.fromCharCode(qi)):ri.push(re[at]),ri[at].charCodeAt(0)>>8&&(rr=!0);re=ri.join("")}for(at=re.length;rr===void 0&&at!==0;)re.charCodeAt(at-1)>>8&&(rr=!0),at--;if(!rr)return re;for(ri=Ie.noBOM?[]:[254,255],at=0,mt=re.length;at<mt;at++){if((ki=(qi=re.charCodeAt(at))>>8)>>8)throw new Error("Character at position "+at+" of string '"+re+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");ri.push(ki),ri.push(qi-(ki<<8))}return String.fromCharCode.apply(void 0,ri)},An=z.__private__.pdfEscape=z.pdfEscape=function(re,Ie){return Cn(re,Ie).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Hr=z.__private__.beginPage=function(re){ii[++we]=[],oe[we]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(re[0]),topRightY:Number(re[1])}},uo(we),kt(ii[Xe])},Hs=function(re,Ie){var at,mt,vt;switch(t=Ie||t,typeof re=="string"&&(at=ce(re.toLowerCase()),Array.isArray(at)&&(mt=at[0],vt=at[1])),Array.isArray(re)&&(mt=re[0]*ci,vt=re[1]*ci),isNaN(mt)&&(mt=n[0],vt=n[1]),(mt>14400||vt>14400)&&(Ms.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),mt=Math.min(14400,mt),vt=Math.min(14400,vt)),n=[mt,vt],t.substr(0,1)){case"l":vt>mt&&(n=[vt,mt]);break;case"p":mt>vt&&(n=[vt,mt])}Hr(n),Vr(dn),ot(Ao),ru!==0&&ot(ru+" J"),nu!==0&&ot(nu+" j"),Y.publish("addPage",{pageNumber:we})},ca=function(re){re>0&&re<=we&&(ii.splice(re,1),oe.splice(re,1),we--,Xe>we&&(Xe=we),this.setPage(Xe))},uo=function(re){re>0&&re<=we&&(Xe=re)},Ea=z.__private__.getNumberOfPages=z.getNumberOfPages=function(){return ii.length-1},Ne=function(re,Ie,at){var mt,vt=void 0;return at=at||{},re=re!==void 0?re:Bi[Ji].fontName,Ie=Ie!==void 0?Ie:Bi[Ji].fontStyle,mt=re.toLowerCase(),Ii[mt]!==void 0&&Ii[mt][Ie]!==void 0?vt=Ii[mt][Ie]:Ii[re]!==void 0&&Ii[re][Ie]!==void 0?vt=Ii[re][Ie]:at.disableWarning===!1&&Ms.warn("Unable to look up font label for font '"+re+"', '"+Ie+"'. Refer to getFontList() for available fonts."),vt||at.noFallback||(vt=Ii.times[Ie])==null&&(vt=Ii.times.normal),vt},Ze=z.__private__.putInfo=function(){var re=it(),Ie=function(mt){return mt};for(var at in I!==null&&(Ie=wn.encryptor(re,0)),ot("<<"),ot("/Producer ("+An(Ie("jsPDF "+kr.version))+")"),Nt)Nt.hasOwnProperty(at)&&Nt[at]&&ot("/"+at.substr(0,1).toUpperCase()+at.substr(1)+" ("+An(Ie(Nt[at]))+")");ot("/CreationDate ("+An(Ie(Et))+")"),ot(">>"),ot("endobj")},dt=z.__private__.putCatalog=function(re){var Ie=(re=re||{}).rootDictionaryObjId||qt;switch(it(),ot("<<"),ot("/Type /Catalog"),ot("/Pages "+Ie+" 0 R"),jt||(jt="fullwidth"),jt){case"fullwidth":ot("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ot("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ot("/OpenAction [3 0 R /Fit]");break;case"original":ot("/OpenAction [3 0 R /XYZ null null 1]");break;default:var at=""+jt;at.substr(at.length-1)==="%"&&(jt=parseInt(jt)/100),typeof jt=="number"&&ot("/OpenAction [3 0 R /XYZ null null "+nt(jt)+"]")}switch(tr||(tr="continuous"),tr){case"continuous":ot("/PageLayout /OneColumn");break;case"single":ot("/PageLayout /SinglePage");break;case"two":case"twoleft":ot("/PageLayout /TwoColumnLeft");break;case"tworight":ot("/PageLayout /TwoColumnRight")}li&&ot("/PageMode /"+li),Y.publish("putCatalog"),ot(">>"),ot("endobj")},Ot=z.__private__.putTrailer=function(){ot("trailer"),ot("<<"),ot("/Size "+(ft+1)),ot("/Root "+ft+" 0 R"),ot("/Info "+(ft-1)+" 0 R"),I!==null&&ot("/Encrypt "+wn.oid+" 0 R"),ot("/ID [ <"+Ct+"> <"+Ct+"> ]"),ot(">>")},ui=z.__private__.putHeader=function(){ot("%PDF-"+ie),ot("%ºß¬à")},Gi=z.__private__.putXRef=function(){var re="0000000000";ot("xref"),ot("0 "+(ft+1)),ot("0000000000 65535 f ");for(var Ie=1;Ie<=ft;Ie++)typeof wt[Ie]=="function"?ot((re+wt[Ie]()).slice(-10)+" 00000 n "):wt[Ie]!==void 0?ot((re+wt[Ie]).slice(-10)+" 00000 n "):ot("0000000000 00000 n ")},br=z.__private__.buildDocument=function(){Mi(),kt(Pt),Y.publish("buildDocument"),ui(),st(),ws(),Js(),I!==null&&ps(),Ze(),dt();var re=It;return Gi(),Ot(),ot("startxref"),ot(""+re),ot("%%EOF"),kt(ii[Xe]),Pt.join(`
`)},En=z.__private__.getBlob=function(re){return new Blob([Ri(re)],{type:"application/pdf"})},kn=z.output=z.__private__.output=Or(function(re,Ie){switch(typeof(Ie=Ie||{})=="string"?Ie={filename:Ie}:Ie.filename=Ie.filename||"generated.pdf",re){case void 0:return br();case"save":z.save(Ie.filename);break;case"arraybuffer":return Ri(br());case"blob":return En(br());case"bloburi":case"bloburl":if(Rr.URL!==void 0&&typeof Rr.URL.createObjectURL=="function")return Rr.URL&&Rr.URL.createObjectURL(En(br()))||void 0;Ms.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var at="",mt=br();try{at=LB(mt)}catch{at=LB(unescape(encodeURIComponent(mt)))}return"data:application/pdf;filename="+Ie.filename+";base64,"+at;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var vt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Tt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ie.pdfObjectUrl&&(vt=Ie.pdfObjectUrl,Tt="");var pi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+vt+'"'+Tt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ie)+");<\/script></body></html>",ri=Rr.open();return ri!==null&&ri.document.write(pi),ri}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var rr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ie.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ie.filename+'" width="500px" height="400px" /></body></html>',qi=Rr.open();if(qi!==null){qi.document.write(rr);var ki=this;qi.document.documentElement.querySelector("#pdfViewer").onload=function(){qi.document.title=Ie.filename,qi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(ki.output("bloburl"))}}return qi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Rr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var jr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ie)+'"></iframe></body></html>',nr=Rr.open();if(nr!==null&&(nr.document.write(jr),nr.document.title=Ie.filename),nr||typeof safari>"u")return nr;break;case"datauri":case"dataurl":return Rr.document.location.href=this.output("datauristring",Ie);default:return null}}),is=function(re){return Array.isArray(le)===!0&&le.indexOf(re)>-1};switch(r){case"pt":ci=1;break;case"mm":ci=72/25.4;break;case"cm":ci=72/2.54;break;case"in":ci=72;break;case"px":ci=is("px_scaling")==1?.75:96/72;break;case"pc":case"em":ci=12;break;case"ex":ci=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);ci=r}var wn=null;Wt(),_t();var iu=function(re){return I!==null?wn.encryptor(re,0):function(Ie){return Ie}},Va=z.__private__.getPageInfo=z.getPageInfo=function(re){if(isNaN(re)||re%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:oe[re].objId,pageNumber:re,pageContext:oe[re]}},Tr=z.__private__.getPageInfoByObjId=function(re){if(isNaN(re)||re%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ie in oe)if(oe[Ie].objId===re)break;return Va(Ie)},Ha=z.__private__.getCurrentPageInfo=z.getCurrentPageInfo=function(){return{objId:oe[Xe].objId,pageNumber:Xe,pageContext:oe[Xe]}};z.addPage=function(){return Hs.apply(this,arguments),this},z.setPage=function(){return uo.apply(this,arguments),kt.call(this,ii[Xe]),this},z.insertPage=function(re){return this.addPage(),this.movePage(Xe,re),this},z.movePage=function(re,Ie){var at,mt;if(re>Ie){at=ii[re],mt=oe[re];for(var vt=re;vt>Ie;vt--)ii[vt]=ii[vt-1],oe[vt]=oe[vt-1];ii[Ie]=at,oe[Ie]=mt,this.setPage(Ie)}else if(re<Ie){at=ii[re],mt=oe[re];for(var Tt=re;Tt<Ie;Tt++)ii[Tt]=ii[Tt+1],oe[Tt]=oe[Tt+1];ii[Ie]=at,oe[Ie]=mt,this.setPage(Ie)}return this},z.deletePage=function(){return ca.apply(this,arguments),this},z.__private__.text=z.text=function(re,Ie,at,mt,vt){var Tt,pi,ri,rr,qi,ki,jr,nr,Hn,Br=(mt=mt||{}).scope||this;if(typeof re=="number"&&typeof Ie=="number"&&(typeof at=="string"||Array.isArray(at))){var Lr=at;at=Ie,Ie=re,re=Lr}if(arguments[3]instanceof ve?(Ue("The transform parameter of text() with a Matrix value"),Hn=vt):(ri=arguments[4],rr=arguments[5],Zn(jr=arguments[3])==="object"&&jr!==null||(typeof ri=="string"&&(rr=ri,ri=null),typeof jr=="string"&&(rr=jr,jr=null),typeof jr=="number"&&(ri=jr,jr=null),mt={flags:jr,angle:ri,align:rr})),isNaN(Ie)||isNaN(at)||re==null)throw new Error("Invalid arguments passed to jsPDF.text");if(re.length===0)return Br;var On="",qs=!1,eo=typeof mt.lineHeightFactor=="number"?mt.lineHeightFactor:us,Lo=Br.internal.scaleFactor;function Ta(Ir){return Ir=Ir.split("	").join(Array(mt.TabLen||9).join(" ")),An(Ir,jr)}function fa(Ir){for(var Zr,an=Ir.concat(),Gn=[],ya=an.length;ya--;)typeof(Zr=an.shift())=="string"?Gn.push(Zr):Array.isArray(Ir)&&(Zr.length===1||Zr[1]===void 0&&Zr[2]===void 0)?Gn.push(Zr[0]):Gn.push([Zr[0],Zr[1],Zr[2]]);return Gn}function zl(Ir,Zr){var an;if(typeof Ir=="string")an=Zr(Ir)[0];else if(Array.isArray(Ir)){for(var Gn,ya,Fa=Ir.concat(),go=[],Zo=Fa.length;Zo--;)typeof(Gn=Fa.shift())=="string"?go.push(Zr(Gn)[0]):Array.isArray(Gn)&&typeof Gn[0]=="string"&&(ya=Zr(Gn[0],Gn[1],Gn[2]),go.push([ya[0],ya[1],ya[2]]));an=go}return an}var ol=!1,Ql=!0;if(typeof re=="string")ol=!0;else if(Array.isArray(re)){var hc=re.concat();pi=[];for(var pa,Ps=hc.length;Ps--;)(typeof(pa=hc.shift())!="string"||Array.isArray(pa)&&typeof pa[0]!="string")&&(Ql=!1);ol=Ql}if(ol===!1)throw new Error('Type of text must be string or Array. "'+re+'" is not recognized.');typeof re=="string"&&(re=re.match(/[\r?\n]/)?re.split(/\r\n|\r|\n/g):[re]);var al=ut/Br.internal.scaleFactor,Vl=al*(eo-1);switch(mt.baseline){case"bottom":at-=Vl;break;case"top":at+=al-Vl;break;case"hanging":at+=al-2*Vl;break;case"middle":at+=al/2-Vl}if((ki=mt.maxWidth||0)>0&&(typeof re=="string"?re=Br.splitTextToSize(re,ki):Object.prototype.toString.call(re)==="[object Array]"&&(re=re.reduce(function(Ir,Zr){return Ir.concat(Br.splitTextToSize(Zr,ki))},[]))),Tt={text:re,x:Ie,y:at,options:mt,mutex:{pdfEscape:An,activeFontKey:Ji,fonts:Bi,activeFontSize:ut}},Y.publish("preProcessText",Tt),re=Tt.text,ri=(mt=Tt.options).angle,!(Hn instanceof ve)&&ri&&typeof ri=="number"){ri*=Math.PI/180,mt.rotationDirection===0&&(ri=-ri),be===de.ADVANCED&&(ri=-ri);var Ia=Math.cos(ri),La=Math.sin(ri);Hn=new ve(Ia,La,-La,Ia,0,0)}else ri&&ri instanceof ve&&(Hn=ri);be!==de.ADVANCED||Hn||(Hn=Oe),(qi=mt.charSpace||Lc)!==void 0&&(On+=$e(Fe(qi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(nr=mt.horizontalScale)!==void 0&&(On+=$e(100*nr)+` Tz
`),mt.lang;var Fs=-1,Lu=mt.renderingMode!==void 0?mt.renderingMode:mt.stroke,Sn=Br.internal.getCurrentPageInfo().pageContext;switch(Lu){case 0:case!1:case"fill":Fs=0;break;case 1:case!0:case"stroke":Fs=1;break;case 2:case"fillThenStroke":Fs=2;break;case 3:case"invisible":Fs=3;break;case 4:case"fillAndAddForClipping":Fs=4;break;case 5:case"strokeAndAddPathForClipping":Fs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Fs=6;break;case 7:case"addToPathForClipping":Fs=7}var on=Sn.usedRenderingMode!==void 0?Sn.usedRenderingMode:-1;Fs!==-1?On+=Fs+` Tr
`:on!==-1&&(On+=`0 Tr
`),Fs!==-1&&(Sn.usedRenderingMode=Fs),rr=mt.align||"left";var fn,Yn=ut*eo,ll=Br.internal.pageSize.getWidth(),cl=Bi[Ji];qi=mt.charSpace||Lc,ki=mt.maxWidth||0,jr=Object.assign({autoencode:!0,noBOM:!0},mt.flags);var fo=[];if(Object.prototype.toString.call(re)==="[object Array]"){var ns;pi=fa(re),rr!=="left"&&(fn=pi.map(function(Ir){return Br.getStringUnitWidth(Ir,{font:cl,charSpace:qi,fontSize:ut,doKerning:!1})*ut/Lo}));var ss,Mo=0;if(rr==="right"){Ie-=fn[0],re=[],Ps=pi.length;for(var Po=0;Po<Ps;Po++)Po===0?(ss=Io(Ie),ns=Ko(at)):(ss=Fe(Mo-fn[Po]),ns=-Yn),re.push([pi[Po],ss,ns]),Mo=fn[Po]}else if(rr==="center"){Ie-=fn[0]/2,re=[],Ps=pi.length;for(var ga=0;ga<Ps;ga++)ga===0?(ss=Io(Ie),ns=Ko(at)):(ss=Fe((Mo-fn[ga])/2),ns=-Yn),re.push([pi[ga],ss,ns]),Mo=fn[ga]}else if(rr==="left"){re=[],Ps=pi.length;for(var ul=0;ul<Ps;ul++)re.push(pi[ul])}else{if(rr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');re=[],Ps=pi.length,ki=ki!==0?ki:ll;for(var to=0;to<Ps;to++)ns=to===0?Ko(at):-Yn,ss=to===0?Io(Ie):0,to<Ps-1?fo.push($e(Fe((ki-fn[to])/(pi[to].split(" ").length-1)))):fo.push(0),re.push([pi[to],ss,ns])}}var io=typeof mt.R2L=="boolean"?mt.R2L:di;io===!0&&(re=zl(re,function(Ir,Zr,an){return[Ir.split("").reverse().join(""),Zr,an]})),Tt={text:re,x:Ie,y:at,options:mt,mutex:{pdfEscape:An,activeFontKey:Ji,fonts:Bi,activeFontSize:ut}},Y.publish("postProcessText",Tt),re=Tt.text,qs=Tt.mutex.isHex||!1;var po=Bi[Ji].encoding;po!=="WinAnsiEncoding"&&po!=="StandardEncoding"||(re=zl(re,function(Ir,Zr,an){return[Ta(Ir),Zr,an]})),pi=fa(re),re=[];for(var ms,ro,Ma,ma=0,Pa=1,Tn=Array.isArray(pi[0])?Pa:ma,Fo="",hs=function(Ir,Zr,an){var Gn="";return an instanceof ve?(an=typeof mt.angle=="number"?Me(an,new ve(1,0,0,1,Ir,Zr)):Me(new ve(1,0,0,1,Ir,Zr),an),be===de.ADVANCED&&(an=Me(new ve(1,0,0,-1,0,0),an)),Gn=an.join(" ")+` Tm
`):Gn=$e(Ir)+" "+$e(Zr)+` Td
`,Gn},ys=0;ys<pi.length;ys++){switch(Fo="",Tn){case Pa:Ma=(qs?"<":"(")+pi[ys][0]+(qs?">":")"),ms=parseFloat(pi[ys][1]),ro=parseFloat(pi[ys][2]);break;case ma:Ma=(qs?"<":"(")+pi[ys]+(qs?">":")"),ms=Io(Ie),ro=Ko(at)}fo!==void 0&&fo[ys]!==void 0&&(Fo=fo[ys]+` Tw
`),ys===0?re.push(Fo+hs(ms,ro,Hn)+Ma):Tn===ma?re.push(Fo+Ma):Tn===Pa&&re.push(Fo+hs(ms,ro,Hn)+Ma)}re=Tn===ma?re.join(` Tj
T* `):re.join(` Tj
`),re+=` Tj
`;var As=`BT
/`;return As+=Ji+" "+ut+` Tf
`,As+=$e(ut*eo)+` TL
`,As+=Xo+`
`,As+=On,As+=re,ot(As+="ET"),O[Ji]=!0,Br};var Dl=z.__private__.clip=z.clip=function(re){return ot(re==="evenodd"?"W*":"W"),this};z.clipEvenOdd=function(){return Dl("evenodd")},z.__private__.discardPath=z.discardPath=function(){return ot("n"),this};var Jn=z.__private__.isValidStyle=function(re){var Ie=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(re)!==-1&&(Ie=!0),Ie};z.__private__.setDefaultPathOperation=z.setDefaultPathOperation=function(re){return Jn(re)&&(x=re),this};var To=z.__private__.getStyle=z.getStyle=function(re){var Ie=x;switch(re){case"D":case"S":Ie="S";break;case"F":Ie="f";break;case"FD":case"DF":Ie="B";break;case"f":case"f*":case"B":case"B*":Ie=re}return Ie},Ga=z.close=function(){return ot("h"),this};z.stroke=function(){return ot("S"),this},z.fill=function(re){return gs("f",re),this},z.fillEvenOdd=function(re){return gs("f*",re),this},z.fillStroke=function(re){return gs("B",re),this},z.fillStrokeEvenOdd=function(re){return gs("B*",re),this};var gs=function(re,Ie){Zn(Ie)==="object"?Sa(Ie,re):ot(re)},ua=function(re){re===null||be===de.ADVANCED&&re===void 0||(re=To(re),ot(re))};function ja(re,Ie,at,mt,vt){var Tt=new ng(Ie||this.boundingBox,at||this.xStep,mt||this.yStep,this.gState,vt||this.matrix);Tt.stream=this.stream;var pi=re+"$$"+this.cloneIndex+++"$$";return Ve(pi,Tt),Tt}var Sa=function(re,Ie){var at=Jt[re.key],mt=vi[at];if(mt instanceof df)ot("q"),ot(Ic(Ie)),mt.gState&&z.setGState(mt.gState),ot(re.matrix.toString()+" cm"),ot("/"+at+" sh"),ot("Q");else if(mt instanceof ng){var vt=new ve(1,0,0,-1,0,Ys());re.matrix&&(vt=vt.multiply(re.matrix||Oe),at=ja.call(mt,re.key,re.boundingBox,re.xStep,re.yStep,vt).id),ot("q"),ot("/Pattern cs"),ot("/"+at+" scn"),mt.gState&&z.setGState(mt.gState),ot(Ie),ot("Q")}},Ic=function(re){switch(re){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},qa=z.moveTo=function(re,Ie){return ot($e(Fe(re))+" "+$e(We(Ie))+" m"),this},ho=z.lineTo=function(re,Ie){return ot($e(Fe(re))+" "+$e(We(Ie))+" l"),this},Pr=z.curveTo=function(re,Ie,at,mt,vt,Tt){return ot([$e(Fe(re)),$e(We(Ie)),$e(Fe(at)),$e(We(mt)),$e(Fe(vt)),$e(We(Tt)),"c"].join(" ")),this};z.__private__.line=z.line=function(re,Ie,at,mt,vt){if(isNaN(re)||isNaN(Ie)||isNaN(at)||isNaN(mt)||!Jn(vt))throw new Error("Invalid arguments passed to jsPDF.line");return be===de.COMPAT?this.lines([[at-re,mt-Ie]],re,Ie,[1,1],vt||"S"):this.lines([[at-re,mt-Ie]],re,Ie,[1,1]).stroke()},z.__private__.lines=z.lines=function(re,Ie,at,mt,vt,Tt){var pi,ri,rr,qi,ki,jr,nr,Hn,Br,Lr,On,qs;if(typeof re=="number"&&(qs=at,at=Ie,Ie=re,re=qs),mt=mt||[1,1],Tt=Tt||!1,isNaN(Ie)||isNaN(at)||!Array.isArray(re)||!Array.isArray(mt)||!Jn(vt)||typeof Tt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(qa(Ie,at),pi=mt[0],ri=mt[1],qi=re.length,Lr=Ie,On=at,rr=0;rr<qi;rr++)(ki=re[rr]).length===2?(Lr=ki[0]*pi+Lr,On=ki[1]*ri+On,ho(Lr,On)):(jr=ki[0]*pi+Lr,nr=ki[1]*ri+On,Hn=ki[2]*pi+Lr,Br=ki[3]*ri+On,Lr=ki[4]*pi+Lr,On=ki[5]*ri+On,Pr(jr,nr,Hn,Br,Lr,On));return Tt&&Ga(),ua(vt),this},z.path=function(re){for(var Ie=0;Ie<re.length;Ie++){var at=re[Ie],mt=at.c;switch(at.op){case"m":qa(mt[0],mt[1]);break;case"l":ho(mt[0],mt[1]);break;case"c":Pr.apply(this,mt);break;case"h":Ga()}}return this},z.__private__.rect=z.rect=function(re,Ie,at,mt,vt){if(isNaN(re)||isNaN(Ie)||isNaN(at)||isNaN(mt)||!Jn(vt))throw new Error("Invalid arguments passed to jsPDF.rect");return be===de.COMPAT&&(mt=-mt),ot([$e(Fe(re)),$e(We(Ie)),$e(Fe(at)),$e(Fe(mt)),"re"].join(" ")),ua(vt),this},z.__private__.triangle=z.triangle=function(re,Ie,at,mt,vt,Tt,pi){if(isNaN(re)||isNaN(Ie)||isNaN(at)||isNaN(mt)||isNaN(vt)||isNaN(Tt)||!Jn(pi))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[at-re,mt-Ie],[vt-at,Tt-mt],[re-vt,Ie-Tt]],re,Ie,[1,1],pi,!0),this},z.__private__.roundedRect=z.roundedRect=function(re,Ie,at,mt,vt,Tt,pi){if(isNaN(re)||isNaN(Ie)||isNaN(at)||isNaN(mt)||isNaN(vt)||isNaN(Tt)||!Jn(pi))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ri=4/3*(Math.SQRT2-1);return vt=Math.min(vt,.5*at),Tt=Math.min(Tt,.5*mt),this.lines([[at-2*vt,0],[vt*ri,0,vt,Tt-Tt*ri,vt,Tt],[0,mt-2*Tt],[0,Tt*ri,-vt*ri,Tt,-vt,Tt],[2*vt-at,0],[-vt*ri,0,-vt,-Tt*ri,-vt,-Tt],[0,2*Tt-mt],[0,-Tt*ri,vt*ri,-Tt,vt,-Tt]],re+vt,Ie,[1,1],pi,!0),this},z.__private__.ellipse=z.ellipse=function(re,Ie,at,mt,vt){if(isNaN(re)||isNaN(Ie)||isNaN(at)||isNaN(mt)||!Jn(vt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Tt=4/3*(Math.SQRT2-1)*at,pi=4/3*(Math.SQRT2-1)*mt;return qa(re+at,Ie),Pr(re+at,Ie-pi,re+Tt,Ie-mt,re,Ie-mt),Pr(re-Tt,Ie-mt,re-at,Ie-pi,re-at,Ie),Pr(re-at,Ie+pi,re-Tt,Ie+mt,re,Ie+mt),Pr(re+Tt,Ie+mt,re+at,Ie+pi,re+at,Ie),ua(vt),this},z.__private__.circle=z.circle=function(re,Ie,at,mt){if(isNaN(re)||isNaN(Ie)||isNaN(at)||!Jn(mt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(re,Ie,at,at,mt)},z.setFont=function(re,Ie,at){return at&&(Ie=Ge(Ie,at)),Ji=Ne(re,Ie,{disableWarning:!1}),this};var ha=z.__private__.getFont=z.getFont=function(){return Bi[Ne.apply(z,arguments)]};z.__private__.getFontList=z.getFontList=function(){var re,Ie,at={};for(re in Ii)if(Ii.hasOwnProperty(re))for(Ie in at[re]=[],Ii[re])Ii[re].hasOwnProperty(Ie)&&at[re].push(Ie);return at},z.addFont=function(re,Ie,at,mt,vt){var Tt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Tt.indexOf(arguments[3])!==-1?vt=arguments[3]:arguments[3]&&Tt.indexOf(arguments[3])==-1&&(at=Ge(at,mt)),vt=vt||"Identity-H",Fr.call(this,re,Ie,at,vt)};var us,dn=i.lineWidth||.200025,rs=z.__private__.getLineWidth=z.getLineWidth=function(){return dn},Vr=z.__private__.setLineWidth=z.setLineWidth=function(re){return dn=re,ot($e(Fe(re))+" w"),this};z.__private__.setLineDash=kr.API.setLineDash=kr.API.setLineDashPattern=function(re,Ie){if(re=re||[],Ie=Ie||0,isNaN(Ie)||!Array.isArray(re))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return re=re.map(function(at){return $e(Fe(at))}).join(" "),Ie=$e(Fe(Ie)),ot("["+re+"] "+Ie+" d"),this};var $a=z.__private__.getLineHeight=z.getLineHeight=function(){return ut*us};z.__private__.getLineHeight=z.getLineHeight=function(){return ut*us};var nl=z.__private__.setLineHeightFactor=z.setLineHeightFactor=function(re){return typeof(re=re||1.15)=="number"&&(us=re),this},Rl=z.__private__.getLineHeightFactor=z.getLineHeightFactor=function(){return us};nl(i.lineHeight);var Io=z.__private__.getHorizontalCoordinate=function(re){return Fe(re)},Ko=z.__private__.getVerticalCoordinate=function(re){return be===de.ADVANCED?re:oe[Xe].mediaBox.topRightY-oe[Xe].mediaBox.bottomLeftY-Fe(re)},cc=z.__private__.getHorizontalCoordinateString=z.getHorizontalCoordinateString=function(re){return $e(Io(re))},Wo=z.__private__.getVerticalCoordinateString=z.getVerticalCoordinateString=function(re){return $e(Ko(re))},Ao=i.strokeColor||"0 G";z.__private__.getStrokeColor=z.getDrawColor=function(){return si(Ao)},z.__private__.setStrokeColor=z.setDrawColor=function(re,Ie,at,mt){return Ao=Ci({ch1:re,ch2:Ie,ch3:at,ch4:mt,pdfColorType:"draw",precision:2}),ot(Ao),this};var uc=i.fillColor||"0 g";z.__private__.getFillColor=z.getFillColor=function(){return si(uc)},z.__private__.setFillColor=z.setFillColor=function(re,Ie,at,mt){return uc=Ci({ch1:re,ch2:Ie,ch3:at,ch4:mt,pdfColorType:"fill",precision:2}),ot(uc),this};var Xo=i.textColor||"0 g",kl=z.__private__.getTextColor=z.getTextColor=function(){return si(Xo)};z.__private__.setTextColor=z.setTextColor=function(re,Ie,at,mt){return Xo=Ci({ch1:re,ch2:Ie,ch3:at,ch4:mt,pdfColorType:"text",precision:3}),this};var Lc=i.charSpace,Ah=z.__private__.getCharSpace=z.getCharSpace=function(){return parseFloat(Lc||0)};z.__private__.setCharSpace=z.setCharSpace=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Lc=re,this};var ru=0;z.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},z.__private__.setLineCap=z.setLineCap=function(re){var Ie=z.CapJoinStyles[re];if(Ie===void 0)throw new Error("Line cap style of '"+re+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ru=Ie,ot(Ie+" J"),this};var nu=0;z.__private__.setLineJoin=z.setLineJoin=function(re){var Ie=z.CapJoinStyles[re];if(Ie===void 0)throw new Error("Line join style of '"+re+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return nu=Ie,ot(Ie+" j"),this},z.__private__.setLineMiterLimit=z.__private__.setMiterLimit=z.setLineMiterLimit=z.setMiterLimit=function(re){if(re=re||0,isNaN(re))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ot($e(Fe(re))+" M"),this},z.GState=y1,z.setGState=function(re){(re=typeof re=="string"?mr[Sr[re]]:Iu(null,re)).equals(ze)||(ot("/"+re.id+" gs"),ze=re)};var Iu=function(re,Ie){if(!re||!Sr[re]){var at=!1;for(var mt in mr)if(mr.hasOwnProperty(mt)&&mr[mt].equals(Ie)){at=!0;break}if(at)Ie=mr[mt];else{var vt="GS"+(Object.keys(mr).length+1).toString(10);mr[vt]=Ie,Ie.id=vt}return re&&(Sr[re]=Ie.id),Y.publish("addGState",Ie),Ie}};z.addGState=function(re,Ie){return Iu(re,Ie),this},z.saveGraphicsState=function(){return ot("q"),Gt.push({key:Ji,size:ut,color:Xo}),this},z.restoreGraphicsState=function(){ot("Q");var re=Gt.pop();return Ji=re.key,ut=re.size,Xo=re.color,ze=null,this},z.setCurrentTransformationMatrix=function(re){return ot(re.toString()+" cm"),this},z.comment=function(re){return ot("#"+re),this};var Ol=function(re,Ie){var at=re||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return at},set:function(Tt){isNaN(Tt)||(at=parseFloat(Tt))}});var mt=Ie||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return mt},set:function(Tt){isNaN(Tt)||(mt=parseFloat(Tt))}});var vt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return vt},set:function(Tt){vt=Tt.toString()}}),this},Ka=function(re,Ie,at,mt){Ol.call(this,re,Ie),this.type="rect";var vt=at||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return vt},set:function(pi){isNaN(pi)||(vt=parseFloat(pi))}});var Tt=mt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Tt},set:function(pi){isNaN(pi)||(Tt=parseFloat(pi))}}),this},Wa=function(){this.page=we,this.currentPage=Xe,this.pages=ii.slice(0),this.pagesContext=oe.slice(0),this.x=$t,this.y=Zi,this.matrix=Qt,this.width=sl(Xe),this.height=Ys(Xe),this.outputDestination=mi,this.id="",this.objectNumber=-1};Wa.prototype.restore=function(){we=this.page,Xe=this.currentPage,oe=this.pagesContext,ii=this.pages,$t=this.x,Zi=this.y,Qt=this.matrix,Nl(Xe,this.width),da(Xe,this.height),mi=this.outputDestination};var Ul=function(re,Ie,at,mt,vt){Ce.push(new Wa),we=Xe=0,ii=[],$t=re,Zi=Ie,Qt=vt,Hr([at,mt])},Xa=function(re){if(_e[re])Ce.pop().restore();else{var Ie=new Wa,at="Xo"+(Object.keys(ge).length+1).toString(10);Ie.id=at,_e[re]=at,ge[at]=Ie,Y.publish("addFormObject",Ie),Ce.pop().restore()}};for(var Aa in z.beginFormObject=function(re,Ie,at,mt,vt){return Ul(re,Ie,at,mt,vt),this},z.endFormObject=function(re){return Xa(re),this},z.doFormObject=function(re,Ie){var at=ge[_e[re]];return ot("q"),ot(Ie.toString()+" cm"),ot("/"+at.id+" Do"),ot("Q"),this},z.getFormObject=function(re){var Ie=ge[_e[re]];return{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,matrix:Ie.matrix}},z.save=function(re,Ie){return re=re||"generated.pdf",(Ie=Ie||{}).returnPromise=Ie.returnPromise||!1,Ie.returnPromise===!1?(Af(En(br()),re),typeof Af.unload=="function"&&Rr.setTimeout&&setTimeout(Af.unload,911),this):new Promise(function(at,mt){try{var vt=Af(En(br()),re);typeof Af.unload=="function"&&Rr.setTimeout&&setTimeout(Af.unload,911),at(vt)}catch(Tt){mt(Tt.message)}})},kr.API)kr.API.hasOwnProperty(Aa)&&(Aa==="events"&&kr.API.events.length?function(re,Ie){var at,mt,vt;for(vt=Ie.length-1;vt!==-1;vt--)at=Ie[vt][0],mt=Ie[vt][1],re.subscribe.apply(re,[at].concat(typeof mt=="function"?[mt]:mt))}(Y,kr.API.events):z[Aa]=kr.API[Aa]);var sl=z.getPageWidth=function(re){return(oe[re=re||Xe].mediaBox.topRightX-oe[re].mediaBox.bottomLeftX)/ci},Nl=z.setPageWidth=function(re,Ie){oe[re].mediaBox.topRightX=Ie*ci+oe[re].mediaBox.bottomLeftX},Ys=z.getPageHeight=function(re){return(oe[re=re||Xe].mediaBox.topRightY-oe[re].mediaBox.bottomLeftY)/ci},da=z.setPageHeight=function(re,Ie){oe[re].mediaBox.topRightY=Ie*ci+oe[re].mediaBox.bottomLeftY};return z.internal={pdfEscape:An,getStyle:To,getFont:ha,getFontSize:ni,getCharSpace:Ah,getTextColor:kl,getLineHeight:$a,getLineHeightFactor:Rl,getLineWidth:rs,write:xt,getHorizontalCoordinate:Io,getVerticalCoordinate:Ko,getCoordinateString:cc,getVerticalCoordinateString:Wo,collections:{},newObject:it,newAdditionalObject:Yt,newObjectDeferred:yt,newObjectDeferredBegin:Bt,getFilters:Hi,putStream:wi,events:Y,scaleFactor:ci,pageSize:{getWidth:function(){return sl(Xe)},setWidth:function(re){Nl(Xe,re)},getHeight:function(){return Ys(Xe)},setHeight:function(re){da(Xe,re)}},encryptionOptions:I,encryption:wn,getEncryptor:iu,output:kn,getNumberOfPages:Ea,pages:ii,out:ot,f2:nt,f3:De,getPageInfo:Va,getPageInfoByObjId:Tr,getCurrentPageInfo:Ha,getPDFVersion:ne,Point:Ol,Rectangle:Ka,Matrix:ve,hasHotfix:is},Object.defineProperty(z.internal.pageSize,"width",{get:function(){return sl(Xe)},set:function(re){Nl(Xe,re)},enumerable:!0,configurable:!0}),Object.defineProperty(z.internal.pageSize,"height",{get:function(){return Ys(Xe)},set:function(re){da(Xe,re)},enumerable:!0,configurable:!0}),Vn.call(z,ei),Ji="F1",Hs(n,t),Y.publish("initialized"),z}ig.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},ig.prototype.toHexString=function(i){return i.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ig.prototype.hexToBytes=function(i){for(var e=[],t=0;t<i.length;t+=2)e.push(String.fromCharCode(parseInt(i.substr(t,2),16)));return e.join("")},ig.prototype.processOwnerPassword=function(i,e){return FB(PB(e).substr(0,5),i)},ig.prototype.encryptor=function(i,e){var t=PB(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return FB(t,r)}},y1.prototype.equals=function(i){var e,t="id,objectNumber,equals";if(!i||Zn(i)!==Zn(this))return!1;var r=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!i.hasOwnProperty(e)||this[e]!==i[e])return!1;r++}for(e in i)i.hasOwnProperty(e)&&t.indexOf(e)<0&&r--;return r===0},kr.API={events:[]},kr.version="2.5.1";var Bo=kr.API,DB=1,ff=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},sg=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Xr=function(i){return i.toFixed(2)},sd=function(i){return i.toFixed(5)};Bo.__acroform__={};var Cc=function(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i},wF=function(i){return i*DB},Nh=function(i){var e=new CF,t=cr.internal.getHeight(i)||0,r=cr.internal.getWidth(i)||0;return e.BBox=[0,0,Number(Xr(r)),Number(Xr(t))],e},pte=Bo.__acroform__.setBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<e},gte=Bo.__acroform__.clearBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<e)},mte=Bo.__acroform__.getBit=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<e?1:0},Qo=Bo.__acroform__.getBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return mte(i,e-1)},Vo=Bo.__acroform__.setBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return pte(i,e-1)},Ho=Bo.__acroform__.clearBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return gte(i,e-1)},yte=Bo.__acroform__.calculateCoordinates=function(i,e){var t=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,n=i[0],o=i[1],c=i[2],s=i[3],m={};return m.lowerLeft_X=t(n)||0,m.lowerLeft_Y=r(o+s)||0,m.upperRight_X=t(n+c)||0,m.upperRight_Y=r(o)||0,[Number(Xr(m.lowerLeft_X)),Number(Xr(m.lowerLeft_Y)),Number(Xr(m.upperRight_X)),Number(Xr(m.upperRight_Y))]},_te=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var e=[],t=i._V||i.DV,r=RB(i,t),n=i.scope.internal.getFont(i.fontName,i.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(i.scope.__private__.encodeColorString(i.color)),e.push("/"+n+" "+Xr(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=Nh(i);return o.scope=i.scope,o.stream=e.join(`
`),o}},RB=function(i,e){var t=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},n=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");n=i.multiline?n.map(function(De){return De.split(`
`)}):n.map(function(De){return[De]});var o=t,c=cr.internal.getHeight(i)||0;c=c<0?-c:c;var s=cr.internal.getWidth(i)||0;s=s<0?-s:s;var m=function(De,Fe,Je){if(De+1<n.length){var We=Fe+" "+n[De+1][0];return _1(We,i,Je).width<=s-4}return!1};o++;e:for(;o>0;){e="",o--;var x,I,F=_1("3",i,o).height,O=i.multiline?c-o:(c-F)/2,z=O+=2,ie=0,ne=0,ue=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+_1(e,i,o=12).width+", FieldWidth:"+s+`
`;break}for(var ce="",de=0,be=0;be<n.length;be++)if(n.hasOwnProperty(be)){var Te=!1;if(n[be].length!==1&&ue!==n[be].length-1){if((F+2)*(de+2)+2>c)continue e;ce+=n[be][ue],Te=!0,ne=be,be--}else{ce=(ce+=n[be][ue]+" ").substr(ce.length-1)==" "?ce.substr(0,ce.length-1):ce;var je=parseInt(be),Ge=m(je,ce,o),$e=be>=n.length-1;if(Ge&&!$e){ce+=" ",ue=0;continue}if(Ge||$e){if($e)ne=je;else if(i.multiline&&(F+2)*(de+2)+2>c)continue e}else{if(!i.multiline||(F+2)*(de+2)+2>c)continue e;ne=je}}for(var Ue="",lt=ie;lt<=ne;lt++){var nt=n[lt];if(i.multiline){if(lt===ne){Ue+=nt[ue]+" ",ue=(ue+1)%nt.length;continue}if(lt===ie){Ue+=nt[nt.length-1]+" ";continue}}Ue+=nt[0]+" "}switch(Ue=Ue.substr(Ue.length-1)==" "?Ue.substr(0,Ue.length-1):Ue,I=_1(Ue,i,o).width,i.textAlign){case"right":x=s-I-2;break;case"center":x=(s-I)/2;break;case"left":default:x=2}e+=Xr(x)+" "+Xr(z)+` Td
`,e+="("+ff(Ue)+`) Tj
`,e+=-Xr(x)+` 0 Td
`,z=-(o+2),I=0,ie=Te?ne:ne+1,de++,ce=""}break}return r.text=e,r.fontSize=o,r},_1=function(i,e,t){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),n=e.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:n}},vte={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},bte=function(i,e){var t={type:"reference",object:i};e.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===t.type&&r.object===t.object})===void 0&&e.internal.getPageInfo(i.page).pageContext.annotations.push(t)},xte=function(i,e){for(var t in i)if(i.hasOwnProperty(t)){var r=t,n=i[t];e.internal.newObjectDeferredBegin(n.objId,!0),Zn(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete i[r]}},wte=function(i,e){if(e.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(eh.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(vte)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");DB=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new EF,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o.objId=void 0,o.hasAnnotation&&bte(o,t)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(t){(function(r,n){var o=!r;for(var c in r||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(c)){var s=r[c],m=[],x=s.Rect;if(s.Rect&&(s.Rect=yte(s.Rect,n)),n.internal.newObjectDeferredBegin(s.objId,!0),s.DA=cr.createDefaultAppearanceStream(s),Zn(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(m=s.getKeyValueListForStream()),s.Rect=x,s.hasAppearanceStream&&!s.appearanceStreamContent){var I=_te(s);m.push({key:"AP",value:"<</N "+I+">>"}),n.internal.acroformPlugin.xForms.push(I)}if(s.appearanceStreamContent){var F="";for(var O in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(O)){var z=s.appearanceStreamContent[O];if(F+="/"+O+" ",F+="<<",Object.keys(z).length>=1||Array.isArray(z)){for(var c in z)if(z.hasOwnProperty(c)){var ie=z[c];typeof ie=="function"&&(ie=ie.call(n,s)),F+="/"+c+" "+ie+" ",n.internal.acroformPlugin.xForms.indexOf(ie)>=0||n.internal.acroformPlugin.xForms.push(ie)}}else typeof(ie=z)=="function"&&(ie=ie.call(n,s)),F+="/"+c+" "+ie,n.internal.acroformPlugin.xForms.indexOf(ie)>=0||n.internal.acroformPlugin.xForms.push(ie);F+=">>"}m.push({key:"AP",value:`<<
`+F+">>"})}n.internal.putStream({additionalKeyValues:m,objectId:s.objId}),n.internal.out("endobj")}o&&xte(n.internal.acroformPlugin.xForms,n)})(t,i)}),i.internal.acroformPlugin.isInitialized=!0}},BF=Bo.__acroform__.arrayToPdfArray=function(i,e,t){var r=function(c){return c};if(Array.isArray(i)){for(var n="[",o=0;o<i.length;o++)switch(o!==0&&(n+=" "),Zn(i[o])){case"boolean":case"number":case"object":n+=i[o].toString();break;case"string":i[o].substr(0,1)!=="/"?(e!==void 0&&t&&(r=t.internal.getEncryptor(e)),n+="("+ff(r(i[o].toString()))+")"):n+=i[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},kB=function(i,e,t){var r=function(n){return n};return e!==void 0&&t&&(r=t.internal.getEncryptor(e)),(i=i||"").toString(),i="("+ff(r(i))+")"},zh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};zh.prototype.toString=function(){return this.objId+" 0 R"},zh.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},zh.prototype.getKeyValueListForStream=function(){var i=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var r=e[t],n=this[r];n&&(Array.isArray(n)?i.push({key:r,value:BF(n,this.objId,this.scope)}):n instanceof zh?(n.scope=this.scope,i.push({key:r,value:n.objId+" 0 R"})):typeof n!="function"&&i.push({key:r,value:n}))}return i};var CF=function(){zh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){i=t.trim()},get:function(){return i||null}})};Cc(CF,zh);var EF=function(){zh.call(this);var i,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var t=function(r){return r};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+ff(t(i))+")"}},set:function(t){i=t}})};Cc(EF,zh);var eh=function i(){zh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute F supplied.');e=ce}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Qo(e,3)},set:function(ce){ce?this.F=Vo(e,3):this.F=Ho(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute Ff supplied.');t=ce}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(ce){r=ce!==void 0?ce:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(ce){r[0]=ce}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(ce){r[1]=ce}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(ce){r[2]=ce}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(ce){r[3]=ce}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(ce){switch(ce){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=ce;break;default:throw new Error('Invalid value "'+ce+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof x1)return;o="FieldObject"+i.FieldNum++}var ce=function(de){return de};return this.scope&&(ce=this.scope.internal.getEncryptor(this.objId)),"("+ff(ce(o))+")"},set:function(ce){o=ce.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(ce){o=ce}});var c="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return c},set:function(ce){c=ce}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ce){s=ce}});var m=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return m},set:function(ce){m=ce}});var x=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return x===void 0?50/DB:x},set:function(ce){x=ce}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(ce){I=ce}});var F="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!F||this instanceof x1||this instanceof pf))return kB(F,this.objId,this.scope)},set:function(ce){ce=ce.toString(),F=ce}});var O=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(O)return this instanceof Na?O:kB(O,this.objId,this.scope)},set:function(ce){ce=ce.toString(),O=this instanceof Na?ce:ce.substr(0,1)==="("?sg(ce.substr(1,ce.length-2)):sg(ce)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Na?sg(O.substr(1,O.length-1)):O},set:function(ce){ce=ce.toString(),O=this instanceof Na?"/"+ce:ce}});var z=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(z)return z},set:function(ce){this.V=ce}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(z)return this instanceof Na?z:kB(z,this.objId,this.scope)},set:function(ce){ce=ce.toString(),z=this instanceof Na?ce:ce.substr(0,1)==="("?sg(ce.substr(1,ce.length-2)):sg(ce)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Na?sg(z.substr(1,z.length-1)):z},set:function(ce){ce=ce.toString(),z=this instanceof Na?"/"+ce:ce}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ie,ne=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return ne},set:function(ce){ce=!!ce,ne=ce}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ie)return ie},set:function(ce){ie=ce}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,1)},set:function(ce){ce?this.Ff=Vo(this.Ff,1):this.Ff=Ho(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,2)},set:function(ce){ce?this.Ff=Vo(this.Ff,2):this.Ff=Ho(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,3)},set:function(ce){ce?this.Ff=Vo(this.Ff,3):this.Ff=Ho(this.Ff,3)}});var ue=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(ue!==null)return ue},set:function(ce){if([0,1,2].indexOf(ce)===-1)throw new Error('Invalid value "'+ce+'" for attribute Q supplied.');ue=ce}}),Object.defineProperty(this,"textAlign",{get:function(){var ce;switch(ue){case 0:default:ce="left";break;case 1:ce="center";break;case 2:ce="right"}return ce},configurable:!0,enumerable:!0,set:function(ce){switch(ce){case"right":case 2:ue=2;break;case"center":case 1:ue=1;break;case"left":case 0:default:ue=0}}})};Cc(eh,zh);var og=function(){eh.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return BF(e,this.objId,this.scope)},set:function(t){var r,n;n=[],typeof(r=t)=="string"&&(n=function(o,c,s){s||(s=1);for(var m,x=[];m=c.exec(o);)x.push(m[s]);return x}(r,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,18)},set:function(t){t?this.Ff=Vo(this.Ff,18):this.Ff=Ho(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Vo(this.Ff,19):this.Ff=Ho(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,20)},set:function(t){t?(this.Ff=Vo(this.Ff,20),e.sort()):this.Ff=Ho(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,22)},set:function(t){t?this.Ff=Vo(this.Ff,22):this.Ff=Ho(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(t){t?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,27)},set:function(t){t?this.Ff=Vo(this.Ff,27):this.Ff=Ho(this.Ff,27)}}),this.hasAppearanceStream=!1};Cc(og,eh);var ag=function(){og.call(this),this.fontName="helvetica",this.combo=!1};Cc(ag,og);var lg=function(){ag.call(this),this.combo=!0};Cc(lg,ag);var v1=function(){lg.call(this),this.edit=!0};Cc(v1,lg);var Na=function(){eh.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,15)},set:function(t){t?this.Ff=Vo(this.Ff,15):this.Ff=Ho(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,16)},set:function(t){t?this.Ff=Vo(this.Ff,16):this.Ff=Ho(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,17)},set:function(t){t?this.Ff=Vo(this.Ff,17):this.Ff=Ho(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(t){t?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,n=[];for(r in n.push("<<"),e)n.push("/"+r+" ("+ff(t(e[r]))+")");return n.push(">>"),n.join(`
`)}},set:function(t){Zn(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}})};Cc(Na,eh);var b1=function(){Na.call(this),this.pushButton=!0};Cc(b1,Na);var cg=function(){Na.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e!==void 0?e:[]}})};Cc(cg,Na);var x1=function(){var i,e;eh.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){i=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(n){e=n}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(s){return s};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,c=[];for(o in c.push("<<"),r)c.push("/"+o+" ("+ff(n(r[o]))+")");return c.push(">>"),c.join(`
`)},set:function(n){Zn(n)==="object"&&(r=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(n){typeof n=="string"&&(r.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=cr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Cc(x1,eh),cg.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=i.createAppearanceStream(t.optionName),t.caption=i.getCA()}},cg.prototype.createOption=function(i){var e=new x1;return e.Parent=this,e.optionName=i,this.Kids.push(e),Bte.call(this.scope,e),e};var w1=function(){Na.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=cr.CheckBox.createAppearanceStream()};Cc(w1,Na);var pf=function(){eh.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,13)},set:function(e){e?this.Ff=Vo(this.Ff,13):this.Ff=Ho(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,21)},set:function(e){e?this.Ff=Vo(this.Ff,21):this.Ff=Ho(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(e){e?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,24)},set:function(e){e?this.Ff=Vo(this.Ff,24):this.Ff=Ho(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,25)},set:function(e){e?this.Ff=Vo(this.Ff,25):this.Ff=Ho(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(e){e?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){Number.isInteger(e)&&(i=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Cc(pf,eh);var B1=function(){pf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,14)},set:function(i){i?this.Ff=Vo(this.Ff,14):this.Ff=Ho(this.Ff,14)}}),this.password=!0};Cc(B1,pf);var cr={CheckBox:{createAppearanceStream:function(){return{N:{On:cr.CheckBox.YesNormal},D:{On:cr.CheckBox.YesPushDown,Off:cr.CheckBox.OffPushDown}}},YesPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),o=RB(i,i.caption);return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+r+" "+Xr(o.fontSize)+" Tf "+n),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(i){var e=Nh(i);e.scope=i.scope;var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),n=[],o=cr.internal.getHeight(i),c=cr.internal.getWidth(i),s=RB(i,i.caption);return n.push("1 g"),n.push("0 0 "+Xr(c)+" "+Xr(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Xr(c-1)+" "+Xr(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+t+" "+Xr(s.fontSize)+" Tf "+r),n.push(s.text),n.push("ET"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(i){var e={D:{Off:cr.RadioButton.Circle.OffPushDown},N:{}};return e.N[i]=cr.RadioButton.Circle.YesNormal,e.D[i]=cr.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(i){var e=Nh(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=cr.internal.Bezier_C,o=Number((r*n).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+sd(cr.internal.getWidth(i)/2)+" "+sd(cr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*cr.internal.Bezier_C).toFixed(5)),c=Number((r*cr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+sd(cr.internal.getWidth(i)/2)+" "+sd(cr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+sd(cr.internal.getWidth(i)/2)+" "+sd(cr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+c+" "+c+" "+r+" 0 "+r+" c"),t.push("-"+c+" "+r+" -"+r+" "+c+" -"+r+" 0 c"),t.push("-"+r+" -"+c+" -"+c+" -"+r+" 0 -"+r+" c"),t.push(c+" -"+r+" "+r+" -"+c+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*cr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+sd(cr.internal.getWidth(i)/2)+" "+sd(cr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(i){var e={D:{Off:cr.RadioButton.Cross.OffPushDown},N:{}};return e.N[i]=cr.RadioButton.Cross.YesNormal,e.D[i]=cr.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(i){var e=Nh(i);e.scope=i.scope;var t=[],r=cr.internal.calculateCross(i);return t.push("q"),t.push("1 1 "+Xr(cr.internal.getWidth(i)-2)+" "+Xr(cr.internal.getHeight(i)-2)+" re"),t.push("W"),t.push("n"),t.push(Xr(r.x1.x)+" "+Xr(r.x1.y)+" m"),t.push(Xr(r.x2.x)+" "+Xr(r.x2.y)+" l"),t.push(Xr(r.x4.x)+" "+Xr(r.x4.y)+" m"),t.push(Xr(r.x3.x)+" "+Xr(r.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=cr.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Xr(cr.internal.getWidth(i)-2)+" "+Xr(cr.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Xr(t.x1.x)+" "+Xr(t.x1.y)+" m"),r.push(Xr(t.x2.x)+" "+Xr(t.x2.y)+" l"),r.push(Xr(t.x4.x)+" "+Xr(t.x4.y)+" m"),r.push(Xr(t.x3.x)+" "+Xr(t.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(i){var e=Nh(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(i){var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,t=i.scope.__private__.encodeColorString(i.color);return"/"+e+" "+i.fontSize+" Tf "+t}};cr.internal={Bezier_C:.551915024494,calculateCross:function(i){var e=cr.internal.getWidth(i),t=cr.internal.getHeight(i),r=Math.min(e,t);return{x1:{x:(e-r)/2,y:(t-r)/2+r},x2:{x:(e-r)/2+r,y:(t-r)/2},x3:{x:(e-r)/2,y:(t-r)/2},x4:{x:(e-r)/2+r,y:(t-r)/2+r}}}},cr.internal.getWidth=function(i){var e=0;return Zn(i)==="object"&&(e=wF(i.Rect[2])),e},cr.internal.getHeight=function(i){var e=0;return Zn(i)==="object"&&(e=wF(i.Rect[3])),e};var Bte=Bo.addField=function(i){if(wte(this,i),!(i instanceof eh))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=i).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Bo.AcroFormChoiceField=og,Bo.AcroFormListBox=ag,Bo.AcroFormComboBox=lg,Bo.AcroFormEditBox=v1,Bo.AcroFormButton=Na,Bo.AcroFormPushButton=b1,Bo.AcroFormRadioButton=cg,Bo.AcroFormCheckBox=w1,Bo.AcroFormTextField=pf,Bo.AcroFormPasswordField=B1,Bo.AcroFormAppearance=cr,Bo.AcroForm={ChoiceField:og,ListBox:ag,ComboBox:lg,EditBox:v1,Button:Na,PushButton:b1,RadioButton:cg,CheckBox:w1,TextField:pf,PasswordField:B1,Appearance:cr},kr.AcroForm={ChoiceField:og,ListBox:ag,ComboBox:lg,EditBox:v1,Button:Na,PushButton:b1,RadioButton:cg,CheckBox:w1,TextField:pf,PasswordField:B1,Appearance:cr};function SF(i){return i.reduce(function(e,t,r){return e[t]=r,e},{})}(function(i){i.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(De,Fe){var Je,We,Et,Ct,Lt,_t=e;if((Fe=Fe||e)==="RGBA"||De.data!==void 0&&De.data instanceof Uint8ClampedArray&&"height"in De&&"width"in De)return"RGBA";if(Ge(De))for(Lt in t)for(Et=t[Lt],Je=0;Je<Et.length;Je+=1){for(Ct=!0,We=0;We<Et[Je].length;We+=1)if(Et[Je][We]!==void 0&&Et[Je][We]!==De[We]){Ct=!1;break}if(Ct===!0){_t=Lt;break}}else for(Lt in t)for(Et=t[Lt],Je=0;Je<Et.length;Je+=1){for(Ct=!0,We=0;We<Et[Je].length;We+=1)if(Et[Je][We]!==void 0&&Et[Je][We]!==De.charCodeAt(We)){Ct=!1;break}if(Ct===!0){_t=Lt;break}}return _t===e&&Fe!==e&&(_t=Fe),_t},n=function De(Fe){for(var Je=this.internal.write,We=this.internal.putStream,Et=(0,this.internal.getFilters)();Et.indexOf("FlateEncode")!==-1;)Et.splice(Et.indexOf("FlateEncode"),1);Fe.objectId=this.internal.newObject();var Ct=[];if(Ct.push({key:"Type",value:"/XObject"}),Ct.push({key:"Subtype",value:"/Image"}),Ct.push({key:"Width",value:Fe.width}),Ct.push({key:"Height",value:Fe.height}),Fe.colorSpace===ue.INDEXED?Ct.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(Fe.palette.length/3-1)+" "+("sMask"in Fe&&Fe.sMask!==void 0?Fe.objectId+2:Fe.objectId+1)+" 0 R]"}):(Ct.push({key:"ColorSpace",value:"/"+Fe.colorSpace}),Fe.colorSpace===ue.DEVICE_CMYK&&Ct.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Ct.push({key:"BitsPerComponent",value:Fe.bitsPerComponent}),"decodeParameters"in Fe&&Fe.decodeParameters!==void 0&&Ct.push({key:"DecodeParms",value:"<<"+Fe.decodeParameters+">>"}),"transparency"in Fe&&Array.isArray(Fe.transparency)){for(var Lt="",_t=0,Ft=Fe.transparency.length;_t<Ft;_t++)Lt+=Fe.transparency[_t]+" "+Fe.transparency[_t]+" ";Ct.push({key:"Mask",value:"["+Lt+"]"})}Fe.sMask!==void 0&&Ct.push({key:"SMask",value:Fe.objectId+1+" 0 R"});var Mt=Fe.filter!==void 0?["/"+Fe.filter]:void 0;if(We({data:Fe.data,additionalKeyValues:Ct,alreadyAppliedFilters:Mt,objectId:Fe.objectId}),Je("endobj"),"sMask"in Fe&&Fe.sMask!==void 0){var Wt="/Predictor "+Fe.predictor+" /Colors 1 /BitsPerComponent "+Fe.bitsPerComponent+" /Columns "+Fe.width,Ee={width:Fe.width,height:Fe.height,colorSpace:"DeviceGray",bitsPerComponent:Fe.bitsPerComponent,decodeParameters:Wt,data:Fe.sMask};"filter"in Fe&&(Ee.filter=Fe.filter),De.call(this,Ee)}if(Fe.colorSpace===ue.INDEXED){var Xe=this.internal.newObject();We({data:Ue(new Uint8Array(Fe.palette)),objectId:Xe}),Je("endobj")}},o=function(){var De=this.internal.collections.addImage_images;for(var Fe in De)n.call(this,De[Fe])},c=function(){var De,Fe=this.internal.collections.addImage_images,Je=this.internal.write;for(var We in Fe)Je("/I"+(De=Fe[We]).index,De.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",c))},m=function(){var De=this.internal.collections.addImage_images;return s.call(this),De},x=function(){return Object.keys(this.internal.collections.addImage_images).length},I=function(De){return typeof i["process"+De.toUpperCase()]=="function"},F=function(De){return Zn(De)==="object"&&De.nodeType===1},O=function(De,Fe){if(De.nodeName==="IMG"&&De.hasAttribute("src")){var Je=""+De.getAttribute("src");if(Je.indexOf("data:image/")===0)return fy(unescape(Je).split("base64,").pop());var We=i.loadFile(Je,!0);if(We!==void 0)return We}if(De.nodeName==="CANVAS"){if(De.width===0||De.height===0)throw new Error("Given canvas must have data. Canvas width: "+De.width+", height: "+De.height);var Et;switch(Fe){case"PNG":Et="image/png";break;case"WEBP":Et="image/webp";break;case"JPEG":case"JPG":default:Et="image/jpeg"}return fy(De.toDataURL(Et,1).split("base64,").pop())}},z=function(De){var Fe=this.internal.collections.addImage_images;if(Fe){for(var Je in Fe)if(De===Fe[Je].alias)return Fe[Je]}},ie=function(De,Fe,Je){return De||Fe||(De=-96,Fe=-96),De<0&&(De=-1*Je.width*72/De/this.internal.scaleFactor),Fe<0&&(Fe=-1*Je.height*72/Fe/this.internal.scaleFactor),De===0&&(De=Fe*Je.width/Je.height),Fe===0&&(Fe=De*Je.height/Je.width),[De,Fe]},ne=function(De,Fe,Je,We,Et,Ct){var Lt=ie.call(this,Je,We,Et),_t=this.internal.getCoordinateString,Ft=this.internal.getVerticalCoordinateString,Mt=m.call(this);if(Je=Lt[0],We=Lt[1],Mt[Et.index]=Et,Ct){Ct*=Math.PI/180;var Wt=Math.cos(Ct),Ee=Math.sin(Ct),Xe=function(At){return At.toFixed(4)},et=[Xe(Wt),Xe(Ee),Xe(-1*Ee),Xe(Wt),0,0,"cm"]}this.internal.write("q"),Ct?(this.internal.write([1,"0","0",1,_t(De),Ft(Fe+We),"cm"].join(" ")),this.internal.write(et.join(" ")),this.internal.write([_t(Je),"0","0",_t(We),"0","0","cm"].join(" "))):this.internal.write([_t(Je),"0","0",_t(We),_t(De),Ft(Fe+We),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Et.index+" Do"),this.internal.write("Q")},ue=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ce=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},de=i.__addimage__.sHashCode=function(De){var Fe,Je,We=0;if(typeof De=="string")for(Je=De.length,Fe=0;Fe<Je;Fe++)We=(We<<5)-We+De.charCodeAt(Fe),We|=0;else if(Ge(De))for(Je=De.byteLength/2,Fe=0;Fe<Je;Fe++)We=(We<<5)-We+De[Fe],We|=0;return We},be=i.__addimage__.validateStringAsBase64=function(De){(De=De||"").toString().trim();var Fe=!0;return De.length===0&&(Fe=!1),De.length%4!=0&&(Fe=!1),/^[A-Za-z0-9+/]+$/.test(De.substr(0,De.length-2))===!1&&(Fe=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(De.substr(-2))===!1&&(Fe=!1),Fe},Te=i.__addimage__.extractImageFromDataUrl=function(De){var Fe=(De=De||"").split("base64,"),Je=null;if(Fe.length===2){var We=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(Fe[0]);Array.isArray(We)&&(Je={mimeType:We[1],charset:We[2],data:Fe[1]})}return Je},je=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(De){return je()&&De instanceof ArrayBuffer};var Ge=i.__addimage__.isArrayBufferView=function(De){return je()&&typeof Uint32Array<"u"&&(De instanceof Int8Array||De instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&De instanceof Uint8ClampedArray||De instanceof Int16Array||De instanceof Uint16Array||De instanceof Int32Array||De instanceof Uint32Array||De instanceof Float32Array||De instanceof Float64Array)},$e=i.__addimage__.binaryStringToUint8Array=function(De){for(var Fe=De.length,Je=new Uint8Array(Fe),We=0;We<Fe;We++)Je[We]=De.charCodeAt(We);return Je},Ue=i.__addimage__.arrayBufferToBinaryString=function(De){for(var Fe="",Je=Ge(De)?De:new Uint8Array(De),We=0;We<Je.length;We+=8192)Fe+=String.fromCharCode.apply(null,Je.subarray(We,We+8192));return Fe};i.addImage=function(){var De,Fe,Je,We,Et,Ct,Lt,_t,Ft;if(typeof arguments[1]=="number"?(Fe=e,Je=arguments[1],We=arguments[2],Et=arguments[3],Ct=arguments[4],Lt=arguments[5],_t=arguments[6],Ft=arguments[7]):(Fe=arguments[1],Je=arguments[2],We=arguments[3],Et=arguments[4],Ct=arguments[5],Lt=arguments[6],_t=arguments[7],Ft=arguments[8]),Zn(De=arguments[0])==="object"&&!F(De)&&"imageData"in De){var Mt=De;De=Mt.imageData,Fe=Mt.format||Fe||e,Je=Mt.x||Je||0,We=Mt.y||We||0,Et=Mt.w||Mt.width||Et,Ct=Mt.h||Mt.height||Ct,Lt=Mt.alias||Lt,_t=Mt.compression||_t,Ft=Mt.rotation||Mt.angle||Ft}var Wt=this.internal.getFilters();if(_t===void 0&&Wt.indexOf("FlateEncode")!==-1&&(_t="SLOW"),isNaN(Je)||isNaN(We))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var Ee=lt.call(this,De,Fe,Lt,_t);return ne.call(this,Je,We,Et,Ct,Ee,Ft),this};var lt=function(De,Fe,Je,We){var Et,Ct,Lt;if(typeof De=="string"&&r(De)===e){De=unescape(De);var _t=nt(De,!1);(_t!==""||(_t=i.loadFile(De,!0))!==void 0)&&(De=_t)}if(F(De)&&(De=O(De,Fe)),Fe=r(De,Fe),!I(Fe))throw new Error("addImage does not support files of type '"+Fe+"', please ensure that a plugin for '"+Fe+"' support is added.");if(((Lt=Je)==null||Lt.length===0)&&(Je=function(Ft){return typeof Ft=="string"||Ge(Ft)?de(Ft):Ge(Ft.data)?de(Ft.data):null}(De)),(Et=z.call(this,Je))||(je()&&(De instanceof Uint8Array||Fe==="RGBA"||(Ct=De,De=$e(De))),Et=this["process"+Fe.toUpperCase()](De,x.call(this),Je,function(Ft){return Ft&&typeof Ft=="string"&&(Ft=Ft.toUpperCase()),Ft in i.image_compression?Ft:ce.NONE}(We),Ct)),!Et)throw new Error("An unknown error occurred whilst processing the image.");return Et},nt=i.__addimage__.convertBase64ToBinaryString=function(De,Fe){var Je;Fe=typeof Fe!="boolean"||Fe;var We,Et="";if(typeof De=="string"){We=(Je=Te(De))!==null?Je.data:De;try{Et=fy(We)}catch(Ct){if(Fe)throw be(We)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Ct.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Et};i.getImageProperties=function(De){var Fe,Je,We="";if(F(De)&&(De=O(De)),typeof De=="string"&&r(De)===e&&((We=nt(De,!1))===""&&(We=i.loadFile(De)||""),De=We),Je=r(De),!I(Je))throw new Error("addImage does not support files of type '"+Je+"', please ensure that a plugin for '"+Je+"' support is added.");if(!je()||De instanceof Uint8Array||(De=$e(De)),!(Fe=this["process"+Je.toUpperCase()](De)))throw new Error("An unknown error occurred whilst processing the image");return Fe.fileType=Je,Fe}})(kr.API),function(i){var e=function(t){if(t!==void 0&&t!="")return!0};kr.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(t){for(var r,n,o,c=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,m=this.internal.getPageInfoByObjId(t.objId),x=t.pageContext.annotations,I=!1,F=0;F<x.length&&!I;F++)switch((r=x[F]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var O=0;O<x.length;O++){r=x[O];var z=this.internal.pdfEscape,ie=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var ne=this.internal.newAdditionalObject(),ue=this.internal.newAdditionalObject(),ce=this.internal.getEncryptor(ne.objId),de=r.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+c(r.bounds.x)+" "+s(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y)+"] ")+"/Contents ("+z(ce(r.contents))+")",o+=" /Popup "+ue.objId+" 0 R",o+=" /P "+m.objId+" 0 R",o+=" /T ("+z(ce(de))+") >>",ne.content=o;var be=ne.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+c(r.bounds.x+30)+" "+s(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w+30)+" "+s(r.bounds.y)+"] ")+" /Parent "+be,r.open&&(o+=" /Open true"),o+=" >>",ue.content=o,this.internal.write(ne.objId,"0 R",ue.objId,"0 R");break;case"freetext":n="/Rect ["+c(r.bounds.x)+" "+s(r.bounds.y)+" "+c(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y+r.bounds.h)+"] ";var Te=r.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+z(ie(r.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Te+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(r.options.name){var je=this.annotations._nameMap[r.options.name];r.options.pageNumber=je.page,r.options.top=je.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",o="",r.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+z(ie(r.options.url))+") >>";else if(r.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,o+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var Ge=s(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),o+=" /XYZ "+r.options.left+" "+Ge+" "+r.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),i.createAnnotation=function(t){var r=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":r.pageContext.annotations.push(t)}},i.link=function(t,r,n,o,c){var s=this.internal.getCurrentPageInfo(),m=this.internal.getCoordinateString,x=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:m(t),y:x(r),w:m(t+n),h:x(r+o)},options:c,type:"link"})},i.textWithLink=function(t,r,n,o){var c,s,m=this.getTextWidth(t),x=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){s=o.maxWidth;var I=this.splitTextToSize(t,s).length;c=Math.ceil(x*I)}else s=m,c=x;return this.text(t,r,n,o),n+=.2*x,o.align==="center"&&(r-=m/2),o.align==="right"&&(r-=m),this.link(r,n-x,s,c,o),m},i.getTextWidth=function(t){var r=this.internal.getFontSize();return this.getStringUnitWidth(t)*r/this.internal.scaleFactor}}(kr.API),function(i){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];i.__arabicParser__={};var o=i.__arabicParser__.isInArabicSubstitutionA=function(ne){return e[ne.charCodeAt(0)]!==void 0},c=i.__arabicParser__.isArabicLetter=function(ne){return typeof ne=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(ne)},s=i.__arabicParser__.isArabicEndLetter=function(ne){return c(ne)&&o(ne)&&e[ne.charCodeAt(0)].length<=2},m=i.__arabicParser__.isArabicAlfLetter=function(ne){return c(ne)&&n.indexOf(ne.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(ne){return c(ne)&&o(ne)&&e[ne.charCodeAt(0)].length>=1};var x=i.__arabicParser__.arabicLetterHasFinalForm=function(ne){return c(ne)&&o(ne)&&e[ne.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(ne){return c(ne)&&o(ne)&&e[ne.charCodeAt(0)].length>=3};var I=i.__arabicParser__.arabicLetterHasMedialForm=function(ne){return c(ne)&&o(ne)&&e[ne.charCodeAt(0)].length==4},F=i.__arabicParser__.resolveLigatures=function(ne){var ue=0,ce=t,de="",be=0;for(ue=0;ue<ne.length;ue+=1)ce[ne.charCodeAt(ue)]!==void 0?(be++,typeof(ce=ce[ne.charCodeAt(ue)])=="number"&&(de+=String.fromCharCode(ce),ce=t,be=0),ue===ne.length-1&&(ce=t,de+=ne.charAt(ue-(be-1)),ue-=be-1,be=0)):(ce=t,de+=ne.charAt(ue-be),ue-=be,be=0);return de};i.__arabicParser__.isArabicDiacritic=function(ne){return ne!==void 0&&r[ne.charCodeAt(0)]!==void 0};var O=i.__arabicParser__.getCorrectForm=function(ne,ue,ce){return c(ne)?o(ne)===!1?-1:!x(ne)||!c(ue)&&!c(ce)||!c(ce)&&s(ue)||s(ne)&&!c(ue)||s(ne)&&m(ue)||s(ne)&&s(ue)?0:I(ne)&&c(ue)&&!s(ue)&&c(ce)&&x(ce)?3:s(ne)||!c(ce)?1:2:-1},z=function(ne){var ue=0,ce=0,de=0,be="",Te="",je="",Ge=(ne=ne||"").split("\\s+"),$e=[];for(ue=0;ue<Ge.length;ue+=1){for($e.push(""),ce=0;ce<Ge[ue].length;ce+=1)be=Ge[ue][ce],Te=Ge[ue][ce-1],je=Ge[ue][ce+1],c(be)?(de=O(be,Te,je),$e[ue]+=de!==-1?String.fromCharCode(e[be.charCodeAt(0)][de]):be):$e[ue]+=be;$e[ue]=F($e[ue])}return $e.join(" ")},ie=i.__arabicParser__.processArabic=i.processArabic=function(){var ne,ue=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ce=[];if(Array.isArray(ue)){var de=0;for(ce=[],de=0;de<ue.length;de+=1)Array.isArray(ue[de])?ce.push([z(ue[de][0]),ue[de][1],ue[de][2]]):ce.push([z(ue[de])]);ne=ce}else ne=z(ue);return typeof arguments[0]=="string"?ne:(arguments[0].text=ne,arguments[0])};i.events.push(["preProcessText",ie])}(kr.API),kr.API.autoPrint=function(i){var e;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(i){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(s){t=s}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(s){r=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(s){n=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(s){o=s}});var c={};Object.defineProperty(this,"style",{get:function(){return c},set:function(s){c=s}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,r){var n;if((t=t||"2d")!=="2d")return null;for(n in r)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=r[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(kr.API),function(i){var e={left:0,top:0,bottom:0,right:0},t=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var m=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return m},set:function(ne){m=ne}});var x=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return x},set:function(ne){x=ne}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(ne){I=ne}});var F=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return F},set:function(ne){F=ne}});var O=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return O},set:function(ne){O=ne}});var z=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return z},set:function(ne){z=ne}});var ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ie},set:function(ne){ie=ne}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(m){return r.call(this),this.internal.__cell__.headerFunction=typeof m=="function"?m:void 0,this},i.getTextDimensions=function(m,x){r.call(this);var I=(x=x||{}).fontSize||this.getFontSize(),F=x.font||this.getFont(),O=x.scaleFactor||this.internal.scaleFactor,z=0,ie=0,ne=0,ue=this;if(!Array.isArray(m)&&typeof m!="string"){if(typeof m!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");m=String(m)}var ce=x.maxWidth;ce>0?typeof m=="string"?m=this.splitTextToSize(m,ce):Object.prototype.toString.call(m)==="[object Array]"&&(m=m.reduce(function(be,Te){return be.concat(ue.splitTextToSize(Te,ce))},[])):m=Array.isArray(m)?m:[m];for(var de=0;de<m.length;de++)z<(ne=this.getStringUnitWidth(m[de],{font:F})*I)&&(z=ne);return z!==0&&(ie=m.length),{w:z/=O,h:Math.max((ie*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/O,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var m=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(m.left,m.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var c=i.cell=function(){var m;m=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var x=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,F=this.internal.__cell__.margins||e,O=this.internal.__cell__.tableHeaderRow,z=this.internal.__cell__.printHeaders;return x.lineNumber!==void 0&&(x.lineNumber===m.lineNumber?(m.x=(x.x||0)+(x.width||0),m.y=x.y||0):x.y+x.height+m.height+F.bottom>this.getPageHeight()?(this.cellAddPage(),m.y=F.top,z&&O&&(this.printHeaderRow(m.lineNumber,!0),m.y+=O[0].height)):m.y=x.y+x.height||m.y),m.text[0]!==void 0&&(this.rect(m.x,m.y,m.width,m.height,t===!0?"FD":void 0),m.align==="right"?this.text(m.text,m.x+m.width-I,m.y+I,{align:"right",baseline:"top"}):m.align==="center"?this.text(m.text,m.x+m.width/2,m.y+I,{align:"center",baseline:"top",maxWidth:m.width-I-I}):this.text(m.text,m.x+I,m.y+I,{align:"left",baseline:"top",maxWidth:m.width-I-I})),this.internal.__cell__.lastCell=m,this};i.table=function(m,x,I,F,O){if(r.call(this),!I)throw new Error("No data for PDF table.");var z,ie,ne,ue,ce=[],de=[],be=[],Te={},je={},Ge=[],$e=[],Ue=(O=O||{}).autoSize||!1,lt=O.printHeaders!==!1,nt=O.css&&O.css["font-size"]!==void 0?16*O.css["font-size"]:O.fontSize||12,De=O.margins||Object.assign({width:this.getPageWidth()},e),Fe=typeof O.padding=="number"?O.padding:3,Je=O.headerBackgroundColor||"#c8c8c8",We=O.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=lt,this.internal.__cell__.margins=De,this.internal.__cell__.table_font_size=nt,this.internal.__cell__.padding=Fe,this.internal.__cell__.headerBackgroundColor=Je,this.internal.__cell__.headerTextColor=We,this.setFontSize(nt),F==null)de=ce=Object.keys(I[0]),be=ce.map(function(){return"left"});else if(Array.isArray(F)&&Zn(F[0])==="object")for(ce=F.map(function(Mt){return Mt.name}),de=F.map(function(Mt){return Mt.prompt||Mt.name||""}),be=F.map(function(Mt){return Mt.align||"left"}),z=0;z<F.length;z+=1)je[F[z].name]=F[z].width*(19.049976/25.4);else Array.isArray(F)&&typeof F[0]=="string"&&(de=ce=F,be=ce.map(function(){return"left"}));if(Ue||Array.isArray(F)&&typeof F[0]=="string")for(z=0;z<ce.length;z+=1){for(Te[ue=ce[z]]=I.map(function(Mt){return Mt[ue]}),this.setFont(void 0,"bold"),Ge.push(this.getTextDimensions(de[z],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ie=Te[ue],this.setFont(void 0,"normal"),ne=0;ne<ie.length;ne+=1)Ge.push(this.getTextDimensions(ie[ne],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);je[ue]=Math.max.apply(null,Ge)+Fe+Fe,Ge=[]}if(lt){var Et={};for(z=0;z<ce.length;z+=1)Et[ce[z]]={},Et[ce[z]].text=de[z],Et[ce[z]].align=be[z];var Ct=s.call(this,Et,je);$e=ce.map(function(Mt){return new o(m,x,je[Mt],Ct,Et[Mt].text,void 0,Et[Mt].align)}),this.setTableHeaderRow($e),this.printHeaderRow(1,!1)}var Lt=F.reduce(function(Mt,Wt){return Mt[Wt.name]=Wt.align,Mt},{});for(z=0;z<I.length;z+=1){"rowStart"in O&&O.rowStart instanceof Function&&O.rowStart({row:z,data:I[z]},this);var _t=s.call(this,I[z],je);for(ne=0;ne<ce.length;ne+=1){var Ft=I[z][ce[ne]];"cellStart"in O&&O.cellStart instanceof Function&&O.cellStart({row:z,col:ne,data:Ft},this),c.call(this,new o(m,x,je[ce[ne]],_t,Ft,z+2,Lt[ce[ne]]))}}return this.internal.__cell__.table_x=m,this.internal.__cell__.table_y=x,this};var s=function(m,x){var I=this.internal.__cell__.padding,F=this.internal.__cell__.table_font_size,O=this.internal.scaleFactor;return Object.keys(m).map(function(z){var ie=m[z];return this.splitTextToSize(ie.hasOwnProperty("text")?ie.text:ie,x[z]-I-I)},this).map(function(z){return this.getLineHeightFactor()*z.length*F/O+I+I},this).reduce(function(z,ie){return Math.max(z,ie)},0)};i.setTableHeaderRow=function(m){r.call(this),this.internal.__cell__.tableHeaderRow=m},i.printHeaderRow=function(m,x){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var F=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(F[0],F[1],F[2],F[3],void 0,-1)}this.setFont(void 0,"bold");for(var O=[],z=0;z<this.internal.__cell__.tableHeaderRow.length;z+=1){I=this.internal.__cell__.tableHeaderRow[z].clone(),x&&(I.y=this.internal.__cell__.margins.top||0,O.push(I)),I.lineNumber=m;var ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),c.call(this,I),this.setTextColor(ie)}O.length>0&&this.setTableHeaderRow(O),this.setFont(void 0,"normal"),t=!1}}(kr.API);var TF={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},IF=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],OB=SF(IF),LF=[100,200,300,400,500,600,700,800,900],Cte=SF(LF);function UB(i){var e=i.family.replace(/"|'/g,"").toLowerCase(),t=function(o){return TF[o=o||"normal"]?o:"normal"}(i.style),r=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(i.weight),n=function(o){return typeof OB[o=o||"normal"]=="number"?o:"normal"}(i.stretch);return{family:e,style:t,weight:r,stretch:n,src:i.src||[],ref:i.ref||{name:e,style:[n,t,r].join(" ")}}}function MF(i,e,t,r){var n;for(n=t;n>=0&&n<e.length;n+=r)if(i[e[n]])return i[e[n]];for(n=t;n>=0&&n<e.length;n-=r)if(i[e[n]])return i[e[n]]}var Ete={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},PF={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function FF(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function Ste(i,e,t){for(var r=(t=t||{}).defaultFontFamily||"times",n=Object.assign({},Ete,t.genericFontFamilies||{}),o=null,c=null,s=0;s<e.length;++s)if(n[(o=UB(e[s])).family]&&(o.family=n[o.family]),i.hasOwnProperty(o.family)){c=i[o.family];break}if(!(c=c||i[r]))throw new Error("Could not find a font-family for the rule '"+FF(o)+"' and default family '"+r+"'.");if(c=function(m,x){if(x[m])return x[m];var I=OB[m],F=I<=OB.normal?-1:1,O=MF(x,IF,I,F);if(!O)throw new Error("Could not find a matching font-stretch value for "+m);return O}(o.stretch,c),c=function(m,x){if(x[m])return x[m];for(var I=TF[m],F=0;F<I.length;++F)if(x[I[F]])return x[I[F]];throw new Error("Could not find a matching font-style for "+m)}(o.style,c),!(c=function(m,x){if(x[m])return x[m];if(m===400&&x[500])return x[500];if(m===500&&x[400])return x[400];var I=Cte[m],F=MF(x,LF,I,m<400?-1:1);if(!F)throw new Error("Could not find a matching font-weight for value "+m);return F}(o.weight,c)))throw new Error("Failed to resolve a font for the rule '"+FF(o)+"'.");return c}function DF(i){return i.trimLeft()}function Tte(i,e){for(var t=0;t<i.length;){if(i.charAt(t)===e)return[i.substring(0,t),i.substring(t+1)];t+=1}return null}function Ite(i){var e=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],i.substring(e[0].length)]}var C1,RF,kF,OF=["times"];(function(i){var e,t,r,n,o,c,s,m,x,I=function(Ee){return Ee=Ee||{},this.isStrokeTransparent=Ee.isStrokeTransparent||!1,this.strokeOpacity=Ee.strokeOpacity||1,this.strokeStyle=Ee.strokeStyle||"#000000",this.fillStyle=Ee.fillStyle||"#000000",this.isFillTransparent=Ee.isFillTransparent||!1,this.fillOpacity=Ee.fillOpacity||1,this.font=Ee.font||"10px sans-serif",this.textBaseline=Ee.textBaseline||"alphabetic",this.textAlign=Ee.textAlign||"left",this.lineWidth=Ee.lineWidth||1,this.lineJoin=Ee.lineJoin||"miter",this.lineCap=Ee.lineCap||"butt",this.path=Ee.path||[],this.transform=Ee.transform!==void 0?Ee.transform.clone():new m,this.globalCompositeOperation=Ee.globalCompositeOperation||"normal",this.globalAlpha=Ee.globalAlpha||1,this.clip_path=Ee.clip_path||[],this.currentPoint=Ee.currentPoint||new c,this.miterLimit=Ee.miterLimit||10,this.lastPoint=Ee.lastPoint||new c,this.lineDashOffset=Ee.lineDashOffset||0,this.lineDash=Ee.lineDash||[],this.margin=Ee.margin||[0,0,0,0],this.prevPageLastElemOffset=Ee.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Ee.ignoreClearRect!="boolean"||Ee.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new F(this),e=this.internal.f2,t=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,c=this.internal.Point,s=this.internal.Rectangle,m=this.internal.Matrix,x=new I}]);var F=function(Ee){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Xe=Ee;Object.defineProperty(this,"pdf",{get:function(){return Xe}});var et=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return et},set:function(kt){et=!!kt}});var At=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return At},set:function(kt){At=!!kt}});var ft=0;Object.defineProperty(this,"posX",{get:function(){return ft},set:function(kt){isNaN(kt)||(ft=kt)}});var wt=0;Object.defineProperty(this,"posY",{get:function(){return wt},set:function(kt){isNaN(kt)||(wt=kt)}}),Object.defineProperty(this,"margin",{get:function(){return x.margin},set:function(kt){var ot;typeof kt=="number"?ot=[kt,kt,kt,kt]:((ot=new Array(4))[0]=kt[0],ot[1]=kt.length>=2?kt[1]:ot[0],ot[2]=kt.length>=3?kt[2]:ot[0],ot[3]=kt.length>=4?kt[3]:ot[1]),x.margin=ot}});var Pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Pt},set:function(kt){Pt=kt}});var It=0;Object.defineProperty(this,"lastBreak",{get:function(){return It},set:function(kt){It=kt}});var Ht=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ht},set:function(kt){Ht=kt}}),Object.defineProperty(this,"ctx",{get:function(){return x},set:function(kt){kt instanceof I&&(x=kt)}}),Object.defineProperty(this,"path",{get:function(){return x.path},set:function(kt){x.path=kt}});var ii=[];Object.defineProperty(this,"ctxStack",{get:function(){return ii},set:function(kt){ii=kt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(kt){var ot;ot=O(kt),this.ctx.fillStyle=ot.style,this.ctx.isFillTransparent=ot.a===0,this.ctx.fillOpacity=ot.a,this.pdf.setFillColor(ot.r,ot.g,ot.b,{a:ot.a}),this.pdf.setTextColor(ot.r,ot.g,ot.b,{a:ot.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(kt){var ot=O(kt);this.ctx.strokeStyle=ot.style,this.ctx.isStrokeTransparent=ot.a===0,this.ctx.strokeOpacity=ot.a,ot.a===0?this.pdf.setDrawColor(255,255,255):(ot.a,this.pdf.setDrawColor(ot.r,ot.g,ot.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(kt){["butt","round","square"].indexOf(kt)!==-1&&(this.ctx.lineCap=kt,this.pdf.setLineCap(kt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(kt){isNaN(kt)||(this.ctx.lineWidth=kt,this.pdf.setLineWidth(kt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(kt){["bevel","round","miter"].indexOf(kt)!==-1&&(this.ctx.lineJoin=kt,this.pdf.setLineJoin(kt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(kt){isNaN(kt)||(this.ctx.miterLimit=kt,this.pdf.setMiterLimit(kt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(kt){this.ctx.textBaseline=kt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(kt){["right","end","center","left","start"].indexOf(kt)!==-1&&(this.ctx.textAlign=kt)}});var gi=null;function mi(kt,ot){if(gi===null){var xt=function(Ri){var ei=[];return Object.keys(Ri).forEach(function(ut){Ri[ut].forEach(function(jt){var ni=null;switch(jt){case"bold":ni={family:ut,weight:"bold"};break;case"italic":ni={family:ut,style:"italic"};break;case"bolditalic":ni={family:ut,weight:"bold",style:"italic"};break;case"":case"normal":ni={family:ut}}ni!==null&&(ni.ref={name:ut,style:jt},ei.push(ni))})}),ei}(kt.getFontList());gi=function(Ri){for(var ei={},ut=0;ut<Ri.length;++ut){var jt=UB(Ri[ut]),ni=jt.family,di=jt.stretch,li=jt.style,Ki=jt.weight;ei[ni]=ei[ni]||{},ei[ni][di]=ei[ni][di]||{},ei[ni][di][li]=ei[ni][di][li]||{},ei[ni][di][li][Ki]=jt}return ei}(xt.concat(ot))}return gi}var Mi=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mi},set:function(kt){gi=null,Mi=kt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(kt){var ot;if(this.ctx.font=kt,(ot=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(kt))!==null){var xt=ot[1],Ri=(ot[2],ot[3]),ei=ot[4],ut=(ot[5],ot[6]),jt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ei)[2];ei=Math.floor(jt==="px"?parseFloat(ei)*this.pdf.internal.scaleFactor:jt==="em"?parseFloat(ei)*this.pdf.getFontSize():parseFloat(ei)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ei);var ni=function(Nt){var Ji,ci,$t=[],Zi=Nt.trim();if(Zi==="")return OF;if(Zi in PF)return[PF[Zi]];for(;Zi!=="";){switch(ci=null,Ji=(Zi=DF(Zi)).charAt(0)){case'"':case"'":ci=Tte(Zi.substring(1),Ji);break;default:ci=Ite(Zi)}if(ci===null||($t.push(ci[0]),(Zi=DF(ci[1]))!==""&&Zi.charAt(0)!==","))return OF;Zi=Zi.replace(/^,/,"")}return $t}(ut);if(this.fontFaces){var di=Ste(mi(this.pdf,this.fontFaces),ni.map(function(Nt){return{family:Nt,stretch:"normal",weight:Ri,style:xt}}));this.pdf.setFont(di.ref.name,di.ref.style)}else{var li="";(Ri==="bold"||parseInt(Ri,10)>=700||xt==="bold")&&(li="bold"),xt==="italic"&&(li+="italic"),li.length===0&&(li="normal");for(var Ki="",tr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ar=0;Ar<ni.length;Ar++){if(this.pdf.internal.getFont(ni[Ar],li,{noFallback:!0,disableWarning:!0})!==void 0){Ki=ni[Ar];break}if(li==="bolditalic"&&this.pdf.internal.getFont(ni[Ar],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ki=ni[Ar],li="bold";else if(this.pdf.internal.getFont(ni[Ar],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ki=ni[Ar],li="normal";break}}if(Ki===""){for(var Er=0;Er<ni.length;Er++)if(tr[ni[Er]]){Ki=tr[ni[Er]];break}}Ki=Ki===""?"Times":Ki,this.pdf.setFont(Ki,li)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(kt){this.ctx.globalCompositeOperation=kt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(kt){this.ctx.globalAlpha=kt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(kt){this.ctx.lineDashOffset=kt,Wt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(kt){this.ctx.lineDash=kt,Wt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(kt){this.ctx.ignoreClearRect=!!kt}})};F.prototype.setLineDash=function(Ee){this.lineDash=Ee},F.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},F.prototype.fill=function(){Te.call(this,"fill",!1)},F.prototype.stroke=function(){Te.call(this,"stroke",!1)},F.prototype.beginPath=function(){this.path=[{type:"begin"}]},F.prototype.moveTo=function(Ee,Xe){if(isNaN(Ee)||isNaN(Xe))throw Ms.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var et=this.ctx.transform.applyToPoint(new c(Ee,Xe));this.path.push({type:"mt",x:et.x,y:et.y}),this.ctx.lastPoint=new c(Ee,Xe)},F.prototype.closePath=function(){var Ee=new c(0,0),Xe=0;for(Xe=this.path.length-1;Xe!==-1;Xe--)if(this.path[Xe].type==="begin"&&Zn(this.path[Xe+1])==="object"&&typeof this.path[Xe+1].x=="number"){Ee=new c(this.path[Xe+1].x,this.path[Xe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new c(Ee.x,Ee.y)},F.prototype.lineTo=function(Ee,Xe){if(isNaN(Ee)||isNaN(Xe))throw Ms.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var et=this.ctx.transform.applyToPoint(new c(Ee,Xe));this.path.push({type:"lt",x:et.x,y:et.y}),this.ctx.lastPoint=new c(et.x,et.y)},F.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Te.call(this,null,!0)},F.prototype.quadraticCurveTo=function(Ee,Xe,et,At){if(isNaN(et)||isNaN(At)||isNaN(Ee)||isNaN(Xe))throw Ms.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ft=this.ctx.transform.applyToPoint(new c(et,At)),wt=this.ctx.transform.applyToPoint(new c(Ee,Xe));this.path.push({type:"qct",x1:wt.x,y1:wt.y,x:ft.x,y:ft.y}),this.ctx.lastPoint=new c(ft.x,ft.y)},F.prototype.bezierCurveTo=function(Ee,Xe,et,At,ft,wt){if(isNaN(ft)||isNaN(wt)||isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ms.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Pt=this.ctx.transform.applyToPoint(new c(ft,wt)),It=this.ctx.transform.applyToPoint(new c(Ee,Xe)),Ht=this.ctx.transform.applyToPoint(new c(et,At));this.path.push({type:"bct",x1:It.x,y1:It.y,x2:Ht.x,y2:Ht.y,x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new c(Pt.x,Pt.y)},F.prototype.arc=function(Ee,Xe,et,At,ft,wt){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At)||isNaN(ft))throw Ms.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(wt=!!wt,!this.ctx.transform.isIdentity){var Pt=this.ctx.transform.applyToPoint(new c(Ee,Xe));Ee=Pt.x,Xe=Pt.y;var It=this.ctx.transform.applyToPoint(new c(0,et)),Ht=this.ctx.transform.applyToPoint(new c(0,0));et=Math.sqrt(Math.pow(It.x-Ht.x,2)+Math.pow(It.y-Ht.y,2))}Math.abs(ft-At)>=2*Math.PI&&(At=0,ft=2*Math.PI),this.path.push({type:"arc",x:Ee,y:Xe,radius:et,startAngle:At,endAngle:ft,counterclockwise:wt})},F.prototype.arcTo=function(Ee,Xe,et,At,ft){throw new Error("arcTo not implemented.")},F.prototype.rect=function(Ee,Xe,et,At){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ms.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Ee,Xe),this.lineTo(Ee+et,Xe),this.lineTo(Ee+et,Xe+At),this.lineTo(Ee,Xe+At),this.lineTo(Ee,Xe),this.lineTo(Ee+et,Xe),this.lineTo(Ee,Xe)},F.prototype.fillRect=function(Ee,Xe,et,At){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ms.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!z.call(this)){var ft={};this.lineCap!=="butt"&&(ft.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ft.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Ee,Xe,et,At),this.fill(),ft.hasOwnProperty("lineCap")&&(this.lineCap=ft.lineCap),ft.hasOwnProperty("lineJoin")&&(this.lineJoin=ft.lineJoin)}},F.prototype.strokeRect=function(Ee,Xe,et,At){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ms.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ie.call(this)||(this.beginPath(),this.rect(Ee,Xe,et,At),this.stroke())},F.prototype.clearRect=function(Ee,Xe,et,At){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ms.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Ee,Xe,et,At))},F.prototype.save=function(Ee){Ee=typeof Ee!="boolean"||Ee;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,et=0;et<this.pdf.internal.getNumberOfPages();et++)this.pdf.setPage(et+1),this.pdf.internal.out("q");if(this.pdf.setPage(Xe),Ee){this.ctx.fontSize=this.pdf.internal.getFontSize();var At=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=At}},F.prototype.restore=function(Ee){Ee=typeof Ee!="boolean"||Ee;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,et=0;et<this.pdf.internal.getNumberOfPages();et++)this.pdf.setPage(et+1),this.pdf.internal.out("Q");this.pdf.setPage(Xe),Ee&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},F.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var O=function(Ee){var Xe,et,At,ft;if(Ee.isCanvasGradient===!0&&(Ee=Ee.getColor()),!Ee)return{r:0,g:0,b:0,a:0,style:Ee};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Ee))Xe=0,et=0,At=0,ft=0;else{var wt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Ee);if(wt!==null)Xe=parseInt(wt[1]),et=parseInt(wt[2]),At=parseInt(wt[3]),ft=1;else if((wt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Ee))!==null)Xe=parseInt(wt[1]),et=parseInt(wt[2]),At=parseInt(wt[3]),ft=parseFloat(wt[4]);else{if(ft=1,typeof Ee=="string"&&Ee.charAt(0)!=="#"){var Pt=new mF(Ee);Ee=Pt.ok?Pt.toHex():"#000000"}Ee.length===4?(Xe=Ee.substring(1,2),Xe+=Xe,et=Ee.substring(2,3),et+=et,At=Ee.substring(3,4),At+=At):(Xe=Ee.substring(1,3),et=Ee.substring(3,5),At=Ee.substring(5,7)),Xe=parseInt(Xe,16),et=parseInt(et,16),At=parseInt(At,16)}}return{r:Xe,g:et,b:At,a:ft,style:Ee}},z=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};F.prototype.fillText=function(Ee,Xe,et,At){if(isNaN(Xe)||isNaN(et)||typeof Ee!="string")throw Ms.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(At=isNaN(At)?void 0:At,!z.call(this)){var ft=_t(this.ctx.transform.rotation),wt=this.ctx.transform.scaleX;Fe.call(this,{text:Ee,x:Xe,y:et,scale:wt,angle:ft,align:this.textAlign,maxWidth:At})}},F.prototype.strokeText=function(Ee,Xe,et,At){if(isNaN(Xe)||isNaN(et)||typeof Ee!="string")throw Ms.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ie.call(this)){At=isNaN(At)?void 0:At;var ft=_t(this.ctx.transform.rotation),wt=this.ctx.transform.scaleX;Fe.call(this,{text:Ee,x:Xe,y:et,scale:wt,renderingMode:"stroke",angle:ft,align:this.textAlign,maxWidth:At})}},F.prototype.measureText=function(Ee){if(typeof Ee!="string")throw Ms.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Xe=this.pdf,et=this.pdf.internal.scaleFactor,At=Xe.internal.getFontSize(),ft=Xe.getStringUnitWidth(Ee)*At/Xe.internal.scaleFactor,wt=function(Pt){var It=(Pt=Pt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return It}}),this};return new wt({width:ft*=Math.round(96*et/72*1e4)/1e4})},F.prototype.scale=function(Ee,Xe){if(isNaN(Ee)||isNaN(Xe))throw Ms.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var et=new m(Ee,0,0,Xe,0,0);this.ctx.transform=this.ctx.transform.multiply(et)},F.prototype.rotate=function(Ee){if(isNaN(Ee))throw Ms.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Xe=new m(Math.cos(Ee),Math.sin(Ee),-Math.sin(Ee),Math.cos(Ee),0,0);this.ctx.transform=this.ctx.transform.multiply(Xe)},F.prototype.translate=function(Ee,Xe){if(isNaN(Ee)||isNaN(Xe))throw Ms.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var et=new m(1,0,0,1,Ee,Xe);this.ctx.transform=this.ctx.transform.multiply(et)},F.prototype.transform=function(Ee,Xe,et,At,ft,wt){if(isNaN(Ee)||isNaN(Xe)||isNaN(et)||isNaN(At)||isNaN(ft)||isNaN(wt))throw Ms.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Pt=new m(Ee,Xe,et,At,ft,wt);this.ctx.transform=this.ctx.transform.multiply(Pt)},F.prototype.setTransform=function(Ee,Xe,et,At,ft,wt){Ee=isNaN(Ee)?1:Ee,Xe=isNaN(Xe)?0:Xe,et=isNaN(et)?0:et,At=isNaN(At)?1:At,ft=isNaN(ft)?0:ft,wt=isNaN(wt)?0:wt,this.ctx.transform=new m(Ee,Xe,et,At,ft,wt)};var ne=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};F.prototype.drawImage=function(Ee,Xe,et,At,ft,wt,Pt,It,Ht){var ii=this.pdf.getImageProperties(Ee),gi=1,mi=1,Mi=1,kt=1;At!==void 0&&It!==void 0&&(Mi=It/At,kt=Ht/ft,gi=ii.width/At*It/At,mi=ii.height/ft*Ht/ft),wt===void 0&&(wt=Xe,Pt=et,Xe=0,et=0),At!==void 0&&It===void 0&&(It=At,Ht=ft),At===void 0&&It===void 0&&(It=ii.width,Ht=ii.height);for(var ot,xt=this.ctx.transform.decompose(),Ri=_t(xt.rotate.shx),ei=new m,ut=(ei=(ei=(ei=ei.multiply(xt.translate)).multiply(xt.skew)).multiply(xt.scale)).applyToRectangle(new s(wt-Xe*Mi,Pt-et*kt,At*gi,ft*mi)),jt=ue.call(this,ut),ni=[],di=0;di<jt.length;di+=1)ni.indexOf(jt[di])===-1&&ni.push(jt[di]);if(be(ni),this.autoPaging)for(var li=ni[0],Ki=ni[ni.length-1],tr=li;tr<Ki+1;tr++){this.pdf.setPage(tr);var Ar=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Er=tr===1?this.posY+this.margin[0]:this.margin[0],Nt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ji=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ci=tr===1?0:Nt+(tr-2)*Ji;if(this.ctx.clip_path.length!==0){var $t=this.path;ot=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(ot,this.posX+this.margin[3],-ci+Er+this.ctx.prevPageLastElemOffset),je.call(this,"fill",!0),this.path=$t}var Zi=JSON.parse(JSON.stringify(ut));Zi=de([Zi],this.posX+this.margin[3],-ci+Er+this.ctx.prevPageLastElemOffset)[0];var Qt=(tr>li||tr<Ki)&&ne.call(this);Qt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ar,Ji,null).clip().discardPath()),this.pdf.addImage(Ee,"JPEG",Zi.x,Zi.y,Zi.w,Zi.h,null,null,Ri),Qt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Ee,"JPEG",ut.x,ut.y,ut.w,ut.h,null,null,Ri)};var ue=function(Ee,Xe,et){var At=[];Xe=Xe||this.pdf.internal.pageSize.width,et=et||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ft=this.posY+this.ctx.prevPageLastElemOffset;switch(Ee.type){default:case"mt":case"lt":At.push(Math.floor((Ee.y+ft)/et)+1);break;case"arc":At.push(Math.floor((Ee.y+ft-Ee.radius)/et)+1),At.push(Math.floor((Ee.y+ft+Ee.radius)/et)+1);break;case"qct":var wt=Ft(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Ee.x1,Ee.y1,Ee.x,Ee.y);At.push(Math.floor((wt.y+ft)/et)+1),At.push(Math.floor((wt.y+wt.h+ft)/et)+1);break;case"bct":var Pt=Mt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Ee.x1,Ee.y1,Ee.x2,Ee.y2,Ee.x,Ee.y);At.push(Math.floor((Pt.y+ft)/et)+1),At.push(Math.floor((Pt.y+Pt.h+ft)/et)+1);break;case"rect":At.push(Math.floor((Ee.y+ft)/et)+1),At.push(Math.floor((Ee.y+Ee.h+ft)/et)+1)}for(var It=0;It<At.length;It+=1)for(;this.pdf.internal.getNumberOfPages()<At[It];)ce.call(this);return At},ce=function(){var Ee=this.fillStyle,Xe=this.strokeStyle,et=this.font,At=this.lineCap,ft=this.lineWidth,wt=this.lineJoin;this.pdf.addPage(),this.fillStyle=Ee,this.strokeStyle=Xe,this.font=et,this.lineCap=At,this.lineWidth=ft,this.lineJoin=wt},de=function(Ee,Xe,et){for(var At=0;At<Ee.length;At++)switch(Ee[At].type){case"bct":Ee[At].x2+=Xe,Ee[At].y2+=et;case"qct":Ee[At].x1+=Xe,Ee[At].y1+=et;case"mt":case"lt":case"arc":default:Ee[At].x+=Xe,Ee[At].y+=et}return Ee},be=function(Ee){return Ee.sort(function(Xe,et){return Xe-et})},Te=function(Ee,Xe){for(var et,At,ft=this.fillStyle,wt=this.strokeStyle,Pt=this.lineCap,It=this.lineWidth,Ht=Math.abs(It*this.ctx.transform.scaleX),ii=this.lineJoin,gi=JSON.parse(JSON.stringify(this.path)),mi=JSON.parse(JSON.stringify(this.path)),Mi=[],kt=0;kt<mi.length;kt++)if(mi[kt].x!==void 0)for(var ot=ue.call(this,mi[kt]),xt=0;xt<ot.length;xt+=1)Mi.indexOf(ot[xt])===-1&&Mi.push(ot[xt]);for(var Ri=0;Ri<Mi.length;Ri++)for(;this.pdf.internal.getNumberOfPages()<Mi[Ri];)ce.call(this);if(be(Mi),this.autoPaging)for(var ei=Mi[0],ut=Mi[Mi.length-1],jt=ei;jt<ut+1;jt++){this.pdf.setPage(jt),this.fillStyle=ft,this.strokeStyle=wt,this.lineCap=Pt,this.lineWidth=Ht,this.lineJoin=ii;var ni=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],di=jt===1?this.posY+this.margin[0]:this.margin[0],li=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ki=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],tr=jt===1?0:li+(jt-2)*Ki;if(this.ctx.clip_path.length!==0){var Ar=this.path;et=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(et,this.posX+this.margin[3],-tr+di+this.ctx.prevPageLastElemOffset),je.call(this,Ee,!0),this.path=Ar}if(At=JSON.parse(JSON.stringify(gi)),this.path=de(At,this.posX+this.margin[3],-tr+di+this.ctx.prevPageLastElemOffset),Xe===!1||jt===0){var Er=(jt>ei||jt<ut)&&ne.call(this);Er&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ni,Ki,null).clip().discardPath()),je.call(this,Ee,Xe),Er&&this.pdf.restoreGraphicsState()}this.lineWidth=It}else this.lineWidth=Ht,je.call(this,Ee,Xe),this.lineWidth=It;this.path=gi},je=function(Ee,Xe){if((Ee!=="stroke"||Xe||!ie.call(this))&&(Ee==="stroke"||Xe||!z.call(this))){for(var et,At,ft=[],wt=this.path,Pt=0;Pt<wt.length;Pt++){var It=wt[Pt];switch(It.type){case"begin":ft.push({begin:!0});break;case"close":ft.push({close:!0});break;case"mt":ft.push({start:It,deltas:[],abs:[]});break;case"lt":var Ht=ft.length;if(wt[Pt-1]&&!isNaN(wt[Pt-1].x)&&(et=[It.x-wt[Pt-1].x,It.y-wt[Pt-1].y],Ht>0)){for(;Ht>=0;Ht--)if(ft[Ht-1].close!==!0&&ft[Ht-1].begin!==!0){ft[Ht-1].deltas.push(et),ft[Ht-1].abs.push(It);break}}break;case"bct":et=[It.x1-wt[Pt-1].x,It.y1-wt[Pt-1].y,It.x2-wt[Pt-1].x,It.y2-wt[Pt-1].y,It.x-wt[Pt-1].x,It.y-wt[Pt-1].y],ft[ft.length-1].deltas.push(et);break;case"qct":var ii=wt[Pt-1].x+2/3*(It.x1-wt[Pt-1].x),gi=wt[Pt-1].y+2/3*(It.y1-wt[Pt-1].y),mi=It.x+2/3*(It.x1-It.x),Mi=It.y+2/3*(It.y1-It.y),kt=It.x,ot=It.y;et=[ii-wt[Pt-1].x,gi-wt[Pt-1].y,mi-wt[Pt-1].x,Mi-wt[Pt-1].y,kt-wt[Pt-1].x,ot-wt[Pt-1].y],ft[ft.length-1].deltas.push(et);break;case"arc":ft.push({deltas:[],abs:[],arc:!0}),Array.isArray(ft[ft.length-1].abs)&&ft[ft.length-1].abs.push(It)}}At=Xe?null:Ee==="stroke"?"stroke":"fill";for(var xt=!1,Ri=0;Ri<ft.length;Ri++)if(ft[Ri].arc)for(var ei=ft[Ri].abs,ut=0;ut<ei.length;ut++){var jt=ei[ut];jt.type==="arc"?Ue.call(this,jt.x,jt.y,jt.radius,jt.startAngle,jt.endAngle,jt.counterclockwise,void 0,Xe,!xt):Je.call(this,jt.x,jt.y),xt=!0}else if(ft[Ri].close===!0)this.pdf.internal.out("h"),xt=!1;else if(ft[Ri].begin!==!0){var ni=ft[Ri].start.x,di=ft[Ri].start.y;We.call(this,ft[Ri].deltas,ni,di),xt=!0}At&&lt.call(this,At),Xe&&nt.call(this)}},Ge=function(Ee){var Xe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,et=Xe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Ee-et;case"top":return Ee+Xe-et;case"hanging":return Ee+Xe-2*et;case"middle":return Ee+Xe/2-et;case"ideographic":return Ee;case"alphabetic":default:return Ee}},$e=function(Ee){return Ee+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};F.prototype.createLinearGradient=function(){var Ee=function(){};return Ee.colorStops=[],Ee.addColorStop=function(Xe,et){this.colorStops.push([Xe,et])},Ee.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Ee.isCanvasGradient=!0,Ee},F.prototype.createPattern=function(){return this.createLinearGradient()},F.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ue=function(Ee,Xe,et,At,ft,wt,Pt,It,Ht){for(var ii=Ct.call(this,et,At,ft,wt),gi=0;gi<ii.length;gi++){var mi=ii[gi];gi===0&&(Ht?De.call(this,mi.x1+Ee,mi.y1+Xe):Je.call(this,mi.x1+Ee,mi.y1+Xe)),Et.call(this,Ee,Xe,mi.x2,mi.y2,mi.x3,mi.y3,mi.x4,mi.y4)}It?nt.call(this):lt.call(this,Pt)},lt=function(Ee){switch(Ee){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},nt=function(){this.pdf.clip(),this.pdf.discardPath()},De=function(Ee,Xe){this.pdf.internal.out(t(Ee)+" "+r(Xe)+" m")},Fe=function(Ee){var Xe;switch(Ee.align){case"right":case"end":Xe="right";break;case"center":Xe="center";break;case"left":case"start":default:Xe="left"}var et=this.pdf.getTextDimensions(Ee.text),At=Ge.call(this,Ee.y),ft=$e.call(this,At)-et.h,wt=this.ctx.transform.applyToPoint(new c(Ee.x,At)),Pt=this.ctx.transform.decompose(),It=new m;It=(It=(It=It.multiply(Pt.translate)).multiply(Pt.skew)).multiply(Pt.scale);for(var Ht,ii,gi,mi=this.ctx.transform.applyToRectangle(new s(Ee.x,At,et.w,et.h)),Mi=It.applyToRectangle(new s(Ee.x,ft,et.w,et.h)),kt=ue.call(this,Mi),ot=[],xt=0;xt<kt.length;xt+=1)ot.indexOf(kt[xt])===-1&&ot.push(kt[xt]);if(be(ot),this.autoPaging)for(var Ri=ot[0],ei=ot[ot.length-1],ut=Ri;ut<ei+1;ut++){this.pdf.setPage(ut);var jt=ut===1?this.posY+this.margin[0]:this.margin[0],ni=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],di=this.pdf.internal.pageSize.height-this.margin[2],li=di-this.margin[0],Ki=this.pdf.internal.pageSize.width-this.margin[1],tr=Ki-this.margin[3],Ar=ut===1?0:ni+(ut-2)*li;if(this.ctx.clip_path.length!==0){var Er=this.path;Ht=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(Ht,this.posX+this.margin[3],-1*Ar+jt),je.call(this,"fill",!0),this.path=Er}var Nt=de([JSON.parse(JSON.stringify(Mi))],this.posX+this.margin[3],-Ar+jt+this.ctx.prevPageLastElemOffset)[0];Ee.scale>=.01&&(ii=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ii*Ee.scale),gi=this.lineWidth,this.lineWidth=gi*Ee.scale);var Ji=this.autoPaging!=="text";if(Ji||Nt.y+Nt.h<=di){if(Ji||Nt.y>=jt&&Nt.x<=Ki){var ci=Ji?Ee.text:this.pdf.splitTextToSize(Ee.text,Ee.maxWidth||Ki-Nt.x)[0],$t=de([JSON.parse(JSON.stringify(mi))],this.posX+this.margin[3],-Ar+jt+this.ctx.prevPageLastElemOffset)[0],Zi=Ji&&(ut>Ri||ut<ei)&&ne.call(this);Zi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],tr,li,null).clip().discardPath()),this.pdf.text(ci,$t.x,$t.y,{angle:Ee.angle,align:Xe,renderingMode:Ee.renderingMode}),Zi&&this.pdf.restoreGraphicsState()}}else Nt.y<di&&(this.ctx.prevPageLastElemOffset+=di-Nt.y);Ee.scale>=.01&&(this.pdf.setFontSize(ii),this.lineWidth=gi)}else Ee.scale>=.01&&(ii=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ii*Ee.scale),gi=this.lineWidth,this.lineWidth=gi*Ee.scale),this.pdf.text(Ee.text,wt.x+this.posX,wt.y+this.posY,{angle:Ee.angle,align:Xe,renderingMode:Ee.renderingMode,maxWidth:Ee.maxWidth}),Ee.scale>=.01&&(this.pdf.setFontSize(ii),this.lineWidth=gi)},Je=function(Ee,Xe,et,At){et=et||0,At=At||0,this.pdf.internal.out(t(Ee+et)+" "+r(Xe+At)+" l")},We=function(Ee,Xe,et){return this.pdf.lines(Ee,Xe,et,null,null)},Et=function(Ee,Xe,et,At,ft,wt,Pt,It){this.pdf.internal.out([e(n(et+Ee)),e(o(At+Xe)),e(n(ft+Ee)),e(o(wt+Xe)),e(n(Pt+Ee)),e(o(It+Xe)),"c"].join(" "))},Ct=function(Ee,Xe,et,At){for(var ft=2*Math.PI,wt=Math.PI/2;Xe>et;)Xe-=ft;var Pt=Math.abs(et-Xe);Pt<ft&&At&&(Pt=ft-Pt);for(var It=[],Ht=At?-1:1,ii=Xe;Pt>1e-5;){var gi=ii+Ht*Math.min(Pt,wt);It.push(Lt.call(this,Ee,ii,gi)),Pt-=Math.abs(gi-ii),ii=gi}return It},Lt=function(Ee,Xe,et){var At=(et-Xe)/2,ft=Ee*Math.cos(At),wt=Ee*Math.sin(At),Pt=ft,It=-wt,Ht=Pt*Pt+It*It,ii=Ht+Pt*ft+It*wt,gi=4/3*(Math.sqrt(2*Ht*ii)-ii)/(Pt*wt-It*ft),mi=Pt-gi*It,Mi=It+gi*Pt,kt=mi,ot=-Mi,xt=At+Xe,Ri=Math.cos(xt),ei=Math.sin(xt);return{x1:Ee*Math.cos(Xe),y1:Ee*Math.sin(Xe),x2:mi*Ri-Mi*ei,y2:mi*ei+Mi*Ri,x3:kt*Ri-ot*ei,y3:kt*ei+ot*Ri,x4:Ee*Math.cos(et),y4:Ee*Math.sin(et)}},_t=function(Ee){return 180*Ee/Math.PI},Ft=function(Ee,Xe,et,At,ft,wt){var Pt=Ee+.5*(et-Ee),It=Xe+.5*(At-Xe),Ht=ft+.5*(et-ft),ii=wt+.5*(At-wt),gi=Math.min(Ee,ft,Pt,Ht),mi=Math.max(Ee,ft,Pt,Ht),Mi=Math.min(Xe,wt,It,ii),kt=Math.max(Xe,wt,It,ii);return new s(gi,Mi,mi-gi,kt-Mi)},Mt=function(Ee,Xe,et,At,ft,wt,Pt,It){var Ht,ii,gi,mi,Mi,kt,ot,xt,Ri,ei,ut,jt,ni,di,li=et-Ee,Ki=At-Xe,tr=ft-et,Ar=wt-At,Er=Pt-ft,Nt=It-wt;for(ii=0;ii<41;ii++)Ri=(ot=(gi=Ee+(Ht=ii/40)*li)+Ht*((Mi=et+Ht*tr)-gi))+Ht*(Mi+Ht*(ft+Ht*Er-Mi)-ot),ei=(xt=(mi=Xe+Ht*Ki)+Ht*((kt=At+Ht*Ar)-mi))+Ht*(kt+Ht*(wt+Ht*Nt-kt)-xt),ii==0?(ut=Ri,jt=ei,ni=Ri,di=ei):(ut=Math.min(ut,Ri),jt=Math.min(jt,ei),ni=Math.max(ni,Ri),di=Math.max(di,ei));return new s(Math.round(ut),Math.round(jt),Math.round(ni-ut),Math.round(di-jt))},Wt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Ee,Xe,et=(Ee=this.ctx.lineDash,Xe=this.ctx.lineDashOffset,JSON.stringify({lineDash:Ee,lineDashOffset:Xe}));this.prevLineDash!==et&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=et)}}})(kr.API),function(i){var e=function(o){var c,s,m,x,I,F,O,z,ie,ne;for(s=[],m=0,x=(o+=c="\0\0\0\0".slice(o.length%4||4)).length;x>m;m+=4)(I=(o.charCodeAt(m)<<24)+(o.charCodeAt(m+1)<<16)+(o.charCodeAt(m+2)<<8)+o.charCodeAt(m+3))!==0?(F=(I=((I=((I=((I=(I-(ne=I%85))/85)-(ie=I%85))/85)-(z=I%85))/85)-(O=I%85))/85)%85,s.push(F+33,O+33,z+33,ie+33,ne+33)):s.push(122);return function(ue,ce){for(var de=ce;de>0;de--)ue.pop()}(s,c.length),String.fromCharCode.apply(String,s)+"~>"},t=function(o){var c,s,m,x,I,F=String,O="length",z=255,ie="charCodeAt",ne="slice",ue="replace";for(o[ne](-2),o=o[ne](0,-2)[ue](/\s/g,"")[ue]("z","!!!!!"),m=[],x=0,I=(o+=c="uuuuu"[ne](o[O]%5||5))[O];I>x;x+=5)s=52200625*(o[ie](x)-33)+614125*(o[ie](x+1)-33)+7225*(o[ie](x+2)-33)+85*(o[ie](x+3)-33)+(o[ie](x+4)-33),m.push(z&s>>24,z&s>>16,z&s>>8,z&s);return function(ce,de){for(var be=de;be>0;be--)ce.pop()}(m,c[O]),F.fromCharCode.apply(F,m)},r=function(o){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),c.test(o)===!1)return"";for(var s="",m=0;m<o.length;m+=2)s+=String.fromCharCode("0x"+(o[m]+o[m+1]));return s},n=function(o){for(var c=new Uint8Array(o.length),s=o.length;s--;)c[s]=o.charCodeAt(s);return o=(c=SB(c)).reduce(function(m,x){return m+String.fromCharCode(x)},"")};i.processDataByFilters=function(o,c){var s=0,m=o||"",x=[];for(typeof(c=c||[])=="string"&&(c=[c]),s=0;s<c.length;s+=1)switch(c[s]){case"ASCII85Decode":case"/ASCII85Decode":m=t(m),x.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":m=e(m),x.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":m=r(m),x.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":m=m.split("").map(function(I){return("0"+I.charCodeAt().toString(16)).slice(-2)}).join("")+">",x.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":m=n(m),x.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[s]+'" is not implemented')}return{data:m,reverseChain:x.reverse().join(" ")}}}(kr.API),function(i){i.loadFile=function(e,t,r){return function(n,o,c){o=o!==!1,c=typeof c=="function"?c:function(){};var s=void 0;try{s=function(m,x,I){var F=new XMLHttpRequest,O=0,z=function(ie){var ne=ie.length,ue=[],ce=String.fromCharCode;for(O=0;O<ne;O+=1)ue.push(ce(255&ie.charCodeAt(O)));return ue.join("")};if(F.open("GET",m,!x),F.overrideMimeType("text/plain; charset=x-user-defined"),x===!1&&(F.onload=function(){F.status===200?I(z(this.responseText)):I(void 0)}),F.send(null),x&&F.status===200)return z(F.responseText)}(n,o,c)}catch{}return s}(e,t,r)},i.loadImageFile=i.loadFile}(kr.API),function(i){function e(){return(Rr.html2canvas?Promise.resolve(Rr.html2canvas):Promise.resolve().then(()=>Tle)).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function t(){return(Rr.DOMPurify?Promise.resolve(Rr.DOMPurify):Promise.resolve().then(()=>nce)).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var r=function(c){var s=Zn(c);return s==="undefined"?"undefined":s==="string"||c instanceof String?"string":s==="number"||c instanceof Number?"number":s==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":s==="object"?"object":"unknown"},n=function(c,s){var m=document.createElement(c);for(var x in s.className&&(m.className=s.className),s.innerHTML&&s.dompurify&&(m.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)m.style[x]=s.style[x];return m},o=function c(s){var m=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),x=c.convert(Promise.resolve(),m);return x=(x=x.setProgress(1,c,1,[c])).set(s)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(c,s){return c.__proto__=s||o.prototype,c},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(c,s){return this.then(function(){switch(s=s||function(m){switch(r(m)){case"string":return"string";case"element":return m.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(c)){case"string":return this.then(t).then(function(m){return this.set({src:n("div",{innerHTML:c,dompurify:m})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},o.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function m(x,I){for(var F=x.nodeType===3?document.createTextNode(x.nodeValue):x.cloneNode(!1),O=x.firstChild;O;O=O.nextSibling)I!==!0&&O.nodeType===1&&O.nodeName==="SCRIPT"||F.appendChild(m(O,I));return x.nodeType===1&&(x.nodeName==="CANVAS"?(F.width=x.width,F.height=x.height,F.getContext("2d").drawImage(x,0,0)):x.nodeName!=="TEXTAREA"&&x.nodeName!=="SELECT"||(F.value=x.value),F.addEventListener("load",function(){F.scrollTop=x.scrollTop,F.scrollLeft=x.scrollLeft},!0)),F}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(e).then(function(s){var m=Object.assign({},this.opt.html2canvas);return delete m.onrendered,s(this.prop.container,m)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(e).then(function(s){var m=this.opt.jsPDF,x=this.opt.fontFaces,I=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,F=Object.assign({async:!0,allowTaint:!0,scale:I,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete F.onrendered,m.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,m.context2d.posX=this.opt.x,m.context2d.posY=this.opt.y,m.context2d.margin=this.opt.margin,m.context2d.fontFaces=x,x)for(var O=0;O<x.length;++O){var z=x[O],ie=z.src.find(function(ne){return ne.format==="truetype"});ie&&m.addFont(ie.url,z.ref.name,z.ref.style)}return F.windowHeight=F.windowHeight||0,F.windowHeight=F.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):F.windowHeight,m.context2d.save(!0),s(this.prop.container,F)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(c,s,m){return(m=m||"pdf").toLowerCase()==="img"||m.toLowerCase()==="image"?this.outputImg(c,s):this.outputPdf(c,s)},o.prototype.outputPdf=function(c,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,s)})},o.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},o.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(c){if(r(c)!=="object")return this;var s=Object.keys(c||{}).map(function(m){if(m in o.template.prop)return function(){this.prop[m]=c[m]};switch(m){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[m]=c[m]}}},this);return this.then(function(){return this.thenList(s)})},o.prototype.get=function(c,s){return this.then(function(){var m=c in o.template.prop?this.prop[c]:this.opt[c];return s?s(m):m})},o.prototype.setMargin=function(c){return this.then(function(){switch(r(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},o.prototype.setPageSize=function(c){function s(m,x){return Math.floor(m*x/72*96)}return this.then(function(){(c=c||kr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:s(c.inner.width,c.k),height:s(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},o.prototype.setProgress=function(c,s,m,x){return c!=null&&(this.progress.val=c),s!=null&&(this.progress.state=s),m!=null&&(this.progress.n=m),x!=null&&(this.progress.stack=x),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(c,s,m,x){return this.setProgress(c?this.progress.val+c:null,s||null,m?this.progress.n+m:null,x?this.progress.stack.concat(x):null)},o.prototype.then=function(c,s){var m=this;return this.thenCore(c,s,function(x,I){return m.updateProgress(null,null,1,[x]),Promise.prototype.then.call(this,function(F){return m.updateProgress(null,x),F}).then(x,I).then(function(F){return m.updateProgress(1),F})})},o.prototype.thenCore=function(c,s,m){m=m||Promise.prototype.then,c&&(c=c.bind(this)),s&&(s=s.bind(this));var x=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),I=m.call(x,c,s);return o.convert(I,this.__proto__)},o.prototype.thenExternal=function(c,s){return Promise.prototype.then.call(this,c,s)},o.prototype.thenList=function(c){var s=this;return c.forEach(function(m){s=s.thenCore(m)}),s},o.prototype.catch=function(c){c&&(c=c.bind(this));var s=Promise.prototype.catch.call(this,c);return o.convert(s,this)},o.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},o.prototype.error=function(c){return this.then(function(){throw new Error(c)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,kr.getPageSize=function(c,s,m){if(Zn(c)==="object"){var x=c;c=x.orientation,s=x.unit||s,m=x.format||m}s=s||"mm",m=m||"a4",c=(""+(c||"P")).toLowerCase();var I,F=(""+m).toLowerCase(),O={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":I=1;break;case"mm":I=72/25.4;break;case"cm":I=72/2.54;break;case"in":I=72;break;case"px":I=.75;break;case"pc":case"em":I=12;break;case"ex":I=6;break;default:throw"Invalid unit: "+s}var z,ie=0,ne=0;if(O.hasOwnProperty(F))ie=O[F][1]/I,ne=O[F][0]/I;else try{ie=m[1],ne=m[0]}catch{throw new Error("Invalid format: "+m)}if(c==="p"||c==="portrait")c="p",ne>ie&&(z=ne,ne=ie,ie=z);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",ie>ne&&(z=ne,ne=ie,ie=z)}return{width:ne,height:ie,unit:s,k:I,orientation:c}},i.html=function(c,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(UB):null;var m=new o(s);return s.worker?m:m.from(c).doCallback()}}(kr.API),kr.API.addJS=function(i){return kF=i,this.internal.events.subscribe("postPutResources",function(){C1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(C1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),RF=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+kF+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){C1!==void 0&&RF!==void 0&&this.internal.out("/Names <</JavaScript "+C1+" 0 R>>")}),this},function(i){var e;i.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),o=0;o<n.length;o++){var c=n[o],s=r.exec(c);if(s!=null){var m=s[1];t.internal.newObjectDeferredBegin(m,!1)}t.internal.write(c)}if(this.outline.createNamedDestinations){var x=this.internal.pages.length,I=[];for(o=0;o<x;o++){var F=t.internal.newObject();I.push(F);var O=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+O.objId+" 0 R /XYZ null null null]>> endobj")}var z=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<I.length;o++)t.internal.write("(page_"+(o+1)+")"+I[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+z+" 0 R"),t.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),i.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(r,n,o){var c={title:n,options:o,children:[]};return r==null&&(r=this.root),r.children.push(c),c},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(r){r.id=t.internal.newObjectDeferred();for(var n=0;n<r.children.length;n++)this.genIds_r(r.children[n])},t.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},t.outline.renderItems=function(r){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<r.children.length;o++){var c=r.children[o];this.objStart(c),this.line("/Title "+this.makeString(c.title)),this.line("/Parent "+this.makeRef(r)),o>0&&this.line("/Prev "+this.makeRef(r.children[o-1])),o<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[o+1])),c.children.length>0&&(this.line("/First "+this.makeRef(c.children[0])),this.line("/Last "+this.makeRef(c.children[c.children.length-1])));var s=this.count=this.count_r({count:0},c);if(s>0&&this.line("/Count "+s),c.options&&c.options.pageNumber){var m=t.internal.getPageInfo(c.options.pageNumber);this.line("/Dest ["+m.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var x=0;x<r.children.length;x++)this.renderItems(r.children[x])},t.outline.line=function(r){this.ctx.val+=r+`\r
`},t.outline.makeRef=function(r){return r.id+" 0 R"},t.outline.makeString=function(r){return"("+t.internal.pdfEscape(r)+")"},t.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(r,n){for(var o=0;o<n.children.length;o++)r.count++,this.count_r(r,n.children[o]);return r.count}}])}(kr.API),function(i){var e=[192,193,194,195,196,197,198,199];i.processJPEG=function(t,r,n,o,c,s){var m,x=this.decode.DCT_DECODE,I=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=c||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(m=function(F){for(var O,z=256*F.charCodeAt(4)+F.charCodeAt(5),ie=F.length,ne={width:0,height:0,numcomponents:1},ue=4;ue<ie;ue+=2){if(ue+=z,e.indexOf(F.charCodeAt(ue+1))!==-1){O=256*F.charCodeAt(ue+5)+F.charCodeAt(ue+6),ne={width:256*F.charCodeAt(ue+7)+F.charCodeAt(ue+8),height:O,numcomponents:F.charCodeAt(ue+9)};break}z=256*F.charCodeAt(ue+2)+F.charCodeAt(ue+3)}return ne}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}I={data:t,width:m.width,height:m.height,colorSpace:s,bitsPerComponent:8,filter:x,index:r,alias:n}}return I}}(kr.API);var ug,E1,UF,NF,zF,Lte=function(){var i,e,t;function r(o){var c,s,m,x,I,F,O,z,ie,ne,ue,ce,de,be;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},F=null;;){switch(c=this.readUInt32(),ie=(function(){var Te,je;for(je=[],Te=0;Te<4;++Te)je.push(String.fromCharCode(this.data[this.pos++]));return je}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(c);break;case"fcTL":F&&this.animation.frames.push(F),this.pos+=4,F={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},I=this.readUInt16(),x=this.readUInt16()||100,F.delay=1e3*I/x,F.disposeOp=this.data[this.pos++],F.blendOp=this.data[this.pos++],F.data=[];break;case"IDAT":case"fdAT":for(ie==="fdAT"&&(this.pos+=4,c-=4),o=(F!=null?F.data:void 0)||this.imgData,ce=0;0<=c?ce<c:ce>c;0<=c?++ce:--ce)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(m=this.palette.length/3,this.transparency.indexed=this.read(c),this.transparency.indexed.length>m)throw new Error("More transparent colors than palette size");if((ne=m-this.transparency.indexed.length)>0)for(de=0;0<=ne?de<ne:de>ne;0<=ne?++de:--de)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case"tEXt":O=(ue=this.read(c)).indexOf(0),z=String.fromCharCode.apply(String,ue.slice(0,O)),this.text[z]=String.fromCharCode.apply(String,ue.slice(O+1));break;case"IEND":return F&&this.animation.frames.push(F),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(be=this.colorType)===4||be===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=c}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(o){var c,s;for(s=[],c=0;0<=o?c<o:c>o;0<=o?++c:--c)s.push(this.data[this.pos++]);return s},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(o){var c=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*c),m=0,x=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function I(F,O,z,ie){var ne,ue,ce,de,be,Te,je,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et,Ct,Lt,_t,Ft,Mt=Math.ceil((x.width-F)/z),Wt=Math.ceil((x.height-O)/ie),Ee=x.width==Mt&&x.height==Wt;for(Fe=c*Mt,nt=Ee?s:new Uint8Array(Fe*Wt),Te=o.length,De=0,ue=0;De<Wt&&m<Te;){switch(o[m++]){case 0:for(de=Et=0;Et<Fe;de=Et+=1)nt[ue++]=o[m++];break;case 1:for(de=Ct=0;Ct<Fe;de=Ct+=1)ne=o[m++],be=de<c?0:nt[ue-c],nt[ue++]=(ne+be)%256;break;case 2:for(de=Lt=0;Lt<Fe;de=Lt+=1)ne=o[m++],ce=(de-de%c)/c,Je=De&&nt[(De-1)*Fe+ce*c+de%c],nt[ue++]=(Je+ne)%256;break;case 3:for(de=_t=0;_t<Fe;de=_t+=1)ne=o[m++],ce=(de-de%c)/c,be=de<c?0:nt[ue-c],Je=De&&nt[(De-1)*Fe+ce*c+de%c],nt[ue++]=(ne+Math.floor((be+Je)/2))%256;break;case 4:for(de=Ft=0;Ft<Fe;de=Ft+=1)ne=o[m++],ce=(de-de%c)/c,be=de<c?0:nt[ue-c],De===0?Je=We=0:(Je=nt[(De-1)*Fe+ce*c+de%c],We=ce&&nt[(De-1)*Fe+(ce-1)*c+de%c]),je=be+Je-We,Ge=Math.abs(je-be),Ue=Math.abs(je-Je),lt=Math.abs(je-We),$e=Ge<=Ue&&Ge<=lt?be:Ue<=lt?Je:We,nt[ue++]=(ne+$e)%256;break;default:throw new Error("Invalid filter algorithm: "+o[m-1])}if(!Ee){var Xe=((O+De*ie)*x.width+F)*c,et=De*Fe;for(de=0;de<Mt;de+=1){for(var At=0;At<c;At+=1)s[Xe++]=nt[et++];Xe+=(z-1)*c}}De++}}return o=ute(o),x.interlaceMethod==1?(I(0,0,8,8),I(4,0,8,8),I(0,4,4,8),I(2,0,4,4),I(0,2,2,4),I(1,0,2,2),I(0,1,1,2)):I(0,0,1,1),s},r.prototype.decodePalette=function(){var o,c,s,m,x,I,F,O,z;for(s=this.palette,I=this.transparency.indexed||[],x=new Uint8Array((I.length||0)+s.length),m=0,o=0,c=F=0,O=s.length;F<O;c=F+=3)x[m++]=s[c],x[m++]=s[c+1],x[m++]=s[c+2],x[m++]=(z=I[o++])!=null?z:255;return x},r.prototype.copyToImageData=function(o,c){var s,m,x,I,F,O,z,ie,ne,ue,ce;if(m=this.colors,ne=null,s=this.hasAlphaChannel,this.palette.length&&(ne=(ce=this._decodedPalette)!=null?ce:this._decodedPalette=this.decodePalette(),m=4,s=!0),ie=(x=o.data||o).length,F=ne||c,I=O=0,m===1)for(;I<ie;)z=ne?4*c[I/4]:O,ue=F[z++],x[I++]=ue,x[I++]=ue,x[I++]=ue,x[I++]=s?F[z++]:255,O=z;else for(;I<ie;)z=ne?4*c[I/4]:O,x[I++]=F[z++],x[I++]=F[z++],x[I++]=F[z++],x[I++]=s?F[z++]:255,O=z},r.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(Rr)==="[object Window]"){try{e=Rr.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return n(),i=function(o){var c;if(n()===!0)return t.width=o.width,t.height=o.height,t.clearRect(0,0,o.width,o.height),t.putImageData(o,0,0),(c=new Image).src=e.toDataURL(),c;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(o){var c,s,m,x,I,F,O,z;if(this.animation){for(z=[],s=I=0,F=(O=this.animation.frames).length;I<F;s=++I)c=O[s],m=o.createImageData(c.width,c.height),x=this.decodePixels(new Uint8Array(c.data)),this.copyToImageData(m,x),c.imageData=m,z.push(c.image=i(m));return z}},r.prototype.renderFrame=function(o,c){var s,m,x;return s=(m=this.animation.frames)[c],x=m[c-1],c===0&&o.clearRect(0,0,this.width,this.height),(x!=null?x.disposeOp:void 0)===1?o.clearRect(x.xOffset,x.yOffset,x.width,x.height):(x!=null?x.disposeOp:void 0)===2&&o.putImageData(x.imageData,x.xOffset,x.yOffset),s.blendOp===0&&o.clearRect(s.xOffset,s.yOffset,s.width,s.height),o.drawImage(s.image,s.xOffset,s.yOffset)},r.prototype.animate=function(o){var c,s,m,x,I,F,O=this;return s=0,F=this.animation,x=F.numFrames,m=F.frames,I=F.numPlays,(c=function(){var z,ie;if(z=s++%x,ie=m[z],O.renderFrame(o,z),x>1&&s/x<I)return O.animation._timeout=setTimeout(c,ie.delay)})()},r.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},r.prototype.render=function(o){var c,s;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,c=o.getContext("2d"),this.animation?(this.decodeFrames(c),this.animate(c)):(s=c.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),c.putImageData(s,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Mte(i){var e=0;if(i[e++]!==71||i[e++]!==73||i[e++]!==70||i[e++]!==56||(i[e++]+1&253)!=56||i[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=i[e++]|i[e++]<<8,r=i[e++]|i[e++]<<8,n=i[e++],o=n>>7,c=1<<(7&n)+1;i[e++],i[e++];var s=null,m=null;o&&(s=e,m=c,e+=3*c);var x=!0,I=[],F=0,O=null,z=0,ie=null;for(this.width=t,this.height=r;x&&e<i.length;)switch(i[e++]){case 33:switch(i[e++]){case 255:if(i[e]!==11||i[e+1]==78&&i[e+2]==69&&i[e+3]==84&&i[e+4]==83&&i[e+5]==67&&i[e+6]==65&&i[e+7]==80&&i[e+8]==69&&i[e+9]==50&&i[e+10]==46&&i[e+11]==48&&i[e+12]==3&&i[e+13]==1&&i[e+16]==0)e+=14,ie=i[e++]|i[e++]<<8,e++;else for(e+=12;;){if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}break;case 249:if(i[e++]!==4||i[e+4]!==0)throw new Error("Invalid graphics extension block.");var ne=i[e++];F=i[e++]|i[e++]<<8,O=i[e++],!(1&ne)&&(O=null),z=ne>>2&7,e++;break;case 254:for(;;){if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}break;default:throw new Error("Unknown graphic control label: 0x"+i[e-1].toString(16))}break;case 44:var ue=i[e++]|i[e++]<<8,ce=i[e++]|i[e++]<<8,de=i[e++]|i[e++]<<8,be=i[e++]|i[e++]<<8,Te=i[e++],je=Te>>6&1,Ge=1<<(7&Te)+1,$e=s,Ue=m,lt=!1;Te>>7&&(lt=!0,$e=e,Ue=Ge,e+=3*Ge);var nt=e;for(e++;;){var De;if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}I.push({x:ue,y:ce,width:de,height:be,has_local_palette:lt,palette_offset:$e,palette_size:Ue,data_offset:nt,data_length:e-nt,transparent_index:O,interlaced:!!je,delay:F,disposal:z});break;case 59:x=!1;break;default:throw new Error("Unknown gif block: 0x"+i[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return ie},this.frameInfo=function(Fe){if(Fe<0||Fe>=I.length)throw new Error("Frame index out of range.");return I[Fe]},this.decodeAndBlitFrameBGRA=function(Fe,Je){var We=this.frameInfo(Fe),Et=We.width*We.height,Ct=new Uint8Array(Et);QF(i,We.data_offset,Ct,Et);var Lt=We.palette_offset,_t=We.transparent_index;_t===null&&(_t=256);var Ft=We.width,Mt=t-Ft,Wt=Ft,Ee=4*(We.y*t+We.x),Xe=4*((We.y+We.height)*t+We.x),et=Ee,At=4*Mt;We.interlaced===!0&&(At+=4*t*7);for(var ft=8,wt=0,Pt=Ct.length;wt<Pt;++wt){var It=Ct[wt];if(Wt===0&&(Wt=Ft,(et+=At)>=Xe&&(At=4*Mt+4*t*(ft-1),et=Ee+(Ft+Mt)*(ft<<1),ft>>=1)),It===_t)et+=4;else{var Ht=i[Lt+3*It],ii=i[Lt+3*It+1],gi=i[Lt+3*It+2];Je[et++]=gi,Je[et++]=ii,Je[et++]=Ht,Je[et++]=255}--Wt}},this.decodeAndBlitFrameRGBA=function(Fe,Je){var We=this.frameInfo(Fe),Et=We.width*We.height,Ct=new Uint8Array(Et);QF(i,We.data_offset,Ct,Et);var Lt=We.palette_offset,_t=We.transparent_index;_t===null&&(_t=256);var Ft=We.width,Mt=t-Ft,Wt=Ft,Ee=4*(We.y*t+We.x),Xe=4*((We.y+We.height)*t+We.x),et=Ee,At=4*Mt;We.interlaced===!0&&(At+=4*t*7);for(var ft=8,wt=0,Pt=Ct.length;wt<Pt;++wt){var It=Ct[wt];if(Wt===0&&(Wt=Ft,(et+=At)>=Xe&&(At=4*Mt+4*t*(ft-1),et=Ee+(Ft+Mt)*(ft<<1),ft>>=1)),It===_t)et+=4;else{var Ht=i[Lt+3*It],ii=i[Lt+3*It+1],gi=i[Lt+3*It+2];Je[et++]=Ht,Je[et++]=ii,Je[et++]=gi,Je[et++]=255}--Wt}}}function QF(i,e,t,r){for(var n=i[e++],o=1<<n,c=o+1,s=c+1,m=n+1,x=(1<<m)-1,I=0,F=0,O=0,z=i[e++],ie=new Int32Array(4096),ne=null;;){for(;I<16&&z!==0;)F|=i[e++]<<I,I+=8,z===1?z=i[e++]:--z;if(I<m)break;var ue=F&x;if(F>>=m,I-=m,ue!==o){if(ue===c)break;for(var ce=ue<s?ue:ne,de=0,be=ce;be>o;)be=ie[be]>>8,++de;var Te=be;if(O+de+(ce!==ue?1:0)>r)return void Ms.log("Warning, gif stream longer than expected.");t[O++]=Te;var je=O+=de;for(ce!==ue&&(t[O++]=Te),be=ce;de--;)be=ie[be],t[--je]=255&be,be>>=8;ne!==null&&s<4096&&(ie[s++]=ne<<8|Te,s>=x+1&&m<12&&(++m,x=x<<1|1)),ne=ue}else s=c+1,x=(1<<(m=n+1))-1,ne=null}return O!==r&&Ms.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function NB(i){var e,t,r,n,o,c=Math.floor,s=new Array(64),m=new Array(64),x=new Array(64),I=new Array(64),F=new Array(65535),O=new Array(65535),z=new Array(64),ie=new Array(64),ne=[],ue=0,ce=7,de=new Array(64),be=new Array(64),Te=new Array(64),je=new Array(256),Ge=new Array(2048),$e=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ue=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],lt=[0,1,2,3,4,5,6,7,8,9,10,11],nt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],De=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Fe=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Je=[0,1,2,3,4,5,6,7,8,9,10,11],We=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Et=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Ct(Ee,Xe){for(var et=0,At=0,ft=new Array,wt=1;wt<=16;wt++){for(var Pt=1;Pt<=Ee[wt];Pt++)ft[Xe[At]]=[],ft[Xe[At]][0]=et,ft[Xe[At]][1]=wt,At++,et++;et*=2}return ft}function Lt(Ee){for(var Xe=Ee[0],et=Ee[1]-1;et>=0;)Xe&1<<et&&(ue|=1<<ce),et--,--ce<0&&(ue==255?(_t(255),_t(0)):_t(ue),ce=7,ue=0)}function _t(Ee){ne.push(Ee)}function Ft(Ee){_t(Ee>>8&255),_t(255&Ee)}function Mt(Ee,Xe,et,At,ft){for(var wt,Pt=ft[0],It=ft[240],Ht=function(ei,ut){var jt,ni,di,li,Ki,tr,Ar,Er,Nt,Ji,ci=0;for(Nt=0;Nt<8;++Nt){jt=ei[ci],ni=ei[ci+1],di=ei[ci+2],li=ei[ci+3],Ki=ei[ci+4],tr=ei[ci+5],Ar=ei[ci+6];var $t=jt+(Er=ei[ci+7]),Zi=jt-Er,Qt=ni+Ar,Bi=ni-Ar,Ii=di+tr,Gt=di-tr,vi=li+Ki,Jt=li-Ki,mr=$t+vi,Sr=$t-vi,ze=Qt+Ii,we=Qt-Ii;ei[ci]=mr+ze,ei[ci+4]=mr-ze;var oe=.707106781*(we+Sr);ei[ci+2]=Sr+oe,ei[ci+6]=Sr-oe;var Y=.382683433*((mr=Jt+Gt)-(we=Bi+Zi)),le=.5411961*mr+Y,ge=1.306562965*we+Y,_e=.707106781*(ze=Gt+Bi),Ce=Zi+_e,ve=Zi-_e;ei[ci+5]=ve+le,ei[ci+3]=ve-le,ei[ci+1]=Ce+ge,ei[ci+7]=Ce-ge,ci+=8}for(ci=0,Nt=0;Nt<8;++Nt){jt=ei[ci],ni=ei[ci+8],di=ei[ci+16],li=ei[ci+24],Ki=ei[ci+32],tr=ei[ci+40],Ar=ei[ci+48];var Me=jt+(Er=ei[ci+56]),Oe=jt-Er,Ve=ni+Ar,it=ni-Ar,yt=di+tr,Bt=di-tr,Yt=li+Ki,qt=li-Ki,Kt=Me+Yt,si=Me-Yt,Ci=Ve+yt,Hi=Ve-yt;ei[ci]=Kt+Ci,ei[ci+32]=Kt-Ci;var wi=.707106781*(Hi+si);ei[ci+16]=si+wi,ei[ci+48]=si-wi;var Ui=.382683433*((Kt=qt+Bt)-(Hi=it+Oe)),st=.5411961*Kt+Ui,ti=1.306562965*Hi+Ui,zt=.707106781*(Ci=Bt+it),zi=Oe+zt,hr=Oe-zt;ei[ci+40]=hr+st,ei[ci+24]=hr-st,ei[ci+8]=zi+ti,ei[ci+56]=zi-ti,ci++}for(Nt=0;Nt<64;++Nt)Ji=ei[Nt]*ut[Nt],z[Nt]=Ji>0?Ji+.5|0:Ji-.5|0;return z}(Ee,Xe),ii=0;ii<64;++ii)ie[$e[ii]]=Ht[ii];var gi=ie[0]-et;et=ie[0],gi==0?Lt(At[0]):(Lt(At[O[wt=32767+gi]]),Lt(F[wt]));for(var mi=63;mi>0&&ie[mi]==0;)mi--;if(mi==0)return Lt(Pt),et;for(var Mi,kt=1;kt<=mi;){for(var ot=kt;ie[kt]==0&&kt<=mi;)++kt;var xt=kt-ot;if(xt>=16){Mi=xt>>4;for(var Ri=1;Ri<=Mi;++Ri)Lt(It);xt&=15}wt=32767+ie[kt],Lt(ft[(xt<<4)+O[wt]]),Lt(F[wt]),kt++}return mi!=63&&Lt(Pt),et}function Wt(Ee){Ee=Math.min(Math.max(Ee,1),100),o!=Ee&&(function(Xe){for(var et=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],At=0;At<64;At++){var ft=c((et[At]*Xe+50)/100);ft=Math.min(Math.max(ft,1),255),s[$e[At]]=ft}for(var wt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Pt=0;Pt<64;Pt++){var It=c((wt[Pt]*Xe+50)/100);It=Math.min(Math.max(It,1),255),m[$e[Pt]]=It}for(var Ht=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ii=0,gi=0;gi<8;gi++)for(var mi=0;mi<8;mi++)x[ii]=1/(s[$e[ii]]*Ht[gi]*Ht[mi]*8),I[ii]=1/(m[$e[ii]]*Ht[gi]*Ht[mi]*8),ii++}(Ee<50?Math.floor(5e3/Ee):Math.floor(200-2*Ee)),o=Ee)}this.encode=function(Ee,Xe){Xe&&Wt(Xe),ne=new Array,ue=0,ce=7,Ft(65496),Ft(65504),Ft(16),_t(74),_t(70),_t(73),_t(70),_t(0),_t(1),_t(1),_t(0),Ft(1),Ft(1),_t(0),_t(0),function(){Ft(65499),Ft(132),_t(0);for(var ni=0;ni<64;ni++)_t(s[ni]);_t(1);for(var di=0;di<64;di++)_t(m[di])}(),function(ni,di){Ft(65472),Ft(17),_t(8),Ft(di),Ft(ni),_t(3),_t(1),_t(17),_t(0),_t(2),_t(17),_t(1),_t(3),_t(17),_t(1)}(Ee.width,Ee.height),function(){Ft(65476),Ft(418),_t(0);for(var ni=0;ni<16;ni++)_t(Ue[ni+1]);for(var di=0;di<=11;di++)_t(lt[di]);_t(16);for(var li=0;li<16;li++)_t(nt[li+1]);for(var Ki=0;Ki<=161;Ki++)_t(De[Ki]);_t(1);for(var tr=0;tr<16;tr++)_t(Fe[tr+1]);for(var Ar=0;Ar<=11;Ar++)_t(Je[Ar]);_t(17);for(var Er=0;Er<16;Er++)_t(We[Er+1]);for(var Nt=0;Nt<=161;Nt++)_t(Et[Nt])}(),Ft(65498),Ft(12),_t(3),_t(1),_t(0),_t(2),_t(17),_t(3),_t(17),_t(0),_t(63),_t(0);var et=0,At=0,ft=0;ue=0,ce=7,this.encode.displayName="_encode_";for(var wt,Pt,It,Ht,ii,gi,mi,Mi,kt,ot=Ee.data,xt=Ee.width,Ri=Ee.height,ei=4*xt,ut=0;ut<Ri;){for(wt=0;wt<ei;){for(ii=ei*ut+wt,mi=-1,Mi=0,kt=0;kt<64;kt++)gi=ii+(Mi=kt>>3)*ei+(mi=4*(7&kt)),ut+Mi>=Ri&&(gi-=ei*(ut+1+Mi-Ri)),wt+mi>=ei&&(gi-=wt+mi-ei+4),Pt=ot[gi++],It=ot[gi++],Ht=ot[gi++],de[kt]=(Ge[Pt]+Ge[It+256>>0]+Ge[Ht+512>>0]>>16)-128,be[kt]=(Ge[Pt+768>>0]+Ge[It+1024>>0]+Ge[Ht+1280>>0]>>16)-128,Te[kt]=(Ge[Pt+1280>>0]+Ge[It+1536>>0]+Ge[Ht+1792>>0]>>16)-128;et=Mt(de,x,et,e,r),At=Mt(be,I,At,t,n),ft=Mt(Te,I,ft,t,n),wt+=32}ut+=8}if(ce>=0){var jt=[];jt[1]=ce+1,jt[0]=(1<<ce+1)-1,Lt(jt)}return Ft(65497),new Uint8Array(ne)},i=i||50,function(){for(var Ee=String.fromCharCode,Xe=0;Xe<256;Xe++)je[Xe]=Ee(Xe)}(),e=Ct(Ue,lt),t=Ct(Fe,Je),r=Ct(nt,De),n=Ct(We,Et),function(){for(var Ee=1,Xe=2,et=1;et<=15;et++){for(var At=Ee;At<Xe;At++)O[32767+At]=et,F[32767+At]=[],F[32767+At][1]=et,F[32767+At][0]=At;for(var ft=-(Xe-1);ft<=-Ee;ft++)O[32767+ft]=et,F[32767+ft]=[],F[32767+ft][1]=et,F[32767+ft][0]=Xe-1+ft;Ee<<=1,Xe<<=1}}(),function(){for(var Ee=0;Ee<256;Ee++)Ge[Ee]=19595*Ee,Ge[Ee+256>>0]=38470*Ee,Ge[Ee+512>>0]=7471*Ee+32768,Ge[Ee+768>>0]=-11059*Ee,Ge[Ee+1024>>0]=-21709*Ee,Ge[Ee+1280>>0]=32768*Ee+8421375,Ge[Ee+1536>>0]=-27439*Ee,Ge[Ee+1792>>0]=-5329*Ee}(),Wt(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function th(i,e){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function VF(i){function e(Ue){if(!Ue)throw Error("assert :P")}function t(Ue,lt,nt){for(var De=0;4>De;De++)if(Ue[lt+De]!=nt.charCodeAt(De))return!0;return!1}function r(Ue,lt,nt,De,Fe){for(var Je=0;Je<Fe;Je++)Ue[lt+Je]=nt[De+Je]}function n(Ue,lt,nt,De){for(var Fe=0;Fe<De;Fe++)Ue[lt+Fe]=nt}function o(Ue){return new Int32Array(Ue)}function c(Ue,lt){for(var nt=[],De=0;De<Ue;De++)nt.push(new lt);return nt}function s(Ue,lt){var nt=[];return function De(Fe,Je,We){for(var Et=We[Je],Ct=0;Ct<Et&&(Fe.push(We.length>Je+1?[]:new lt),!(We.length<Je+1));Ct++)De(Fe[Ct],Je+1,We)}(nt,0,Ue),nt}var m=function(){var Ue=this;function lt(w,T){for(var R=1<<T-1>>>0;w&R;)R>>>=1;return R?(w&R-1)+R:w}function nt(w,T,R,j,Z){e(!(j%R));do w[T+(j-=R)]=Z;while(0<j)}function De(w,T,R,j,Z){if(e(2328>=Z),512>=Z)var W=o(512);else if((W=o(Z))==null)return 0;return function(J,ee,ae,fe,pe,xe){var Pe,Le,rt=ee,Ke=1<<ae,Re=o(16),Qe=o(16);for(e(pe!=0),e(fe!=null),e(J!=null),e(0<ae),Le=0;Le<pe;++Le){if(15<fe[Le])return 0;++Re[fe[Le]]}if(Re[0]==pe)return 0;for(Qe[1]=0,Pe=1;15>Pe;++Pe){if(Re[Pe]>1<<Pe)return 0;Qe[Pe+1]=Qe[Pe]+Re[Pe]}for(Le=0;Le<pe;++Le)Pe=fe[Le],0<fe[Le]&&(xe[Qe[Pe]++]=Le);if(Qe[15]==1)return(fe=new Fe).g=0,fe.value=xe[0],nt(J,rt,1,Ke,fe),Ke;var pt,bt=-1,ht=Ke-1,Rt=0,Dt=1,hi=1,Vt=1<<ae;for(Le=0,Pe=1,pe=2;Pe<=ae;++Pe,pe<<=1){if(Dt+=hi<<=1,0>(hi-=Re[Pe]))return 0;for(;0<Re[Pe];--Re[Pe])(fe=new Fe).g=Pe,fe.value=xe[Le++],nt(J,rt+Rt,pe,Vt,fe),Rt=lt(Rt,Pe)}for(Pe=ae+1,pe=2;15>=Pe;++Pe,pe<<=1){if(Dt+=hi<<=1,0>(hi-=Re[Pe]))return 0;for(;0<Re[Pe];--Re[Pe]){if(fe=new Fe,(Rt&ht)!=bt){for(rt+=Vt,pt=1<<(bt=Pe)-ae;15>bt&&!(0>=(pt-=Re[bt]));)++bt,pt<<=1;Ke+=Vt=1<<(pt=bt-ae),J[ee+(bt=Rt&ht)].g=pt+ae,J[ee+bt].value=rt-ee-bt}fe.g=Pe-ae,fe.value=xe[Le++],nt(J,rt+(Rt>>ae),pe,Vt,fe),Rt=lt(Rt,Pe)}}return Dt!=2*Qe[15]-1?0:Ke}(w,T,R,j,Z,W)}function Fe(){this.value=this.g=0}function Je(){this.value=this.g=0}function We(){this.G=c(5,Fe),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=c(Ps,Je)}function Et(w,T,R,j){e(w!=null),e(T!=null),e(2147483648>j),w.Ca=254,w.I=0,w.b=-8,w.Ka=0,w.oa=T,w.pa=R,w.Jd=T,w.Yc=R+j,w.Zc=4<=j?R+j-4+1:R,wt(w)}function Ct(w,T){for(var R=0;0<T--;)R|=It(w,128)<<T;return R}function Lt(w,T){var R=Ct(w,T);return Pt(w)?-R:R}function _t(w,T,R,j){var Z,W=0;for(e(w!=null),e(T!=null),e(4294967288>j),w.Sb=j,w.Ra=0,w.u=0,w.h=0,4<j&&(j=4),Z=0;Z<j;++Z)W+=T[R+Z]<<8*Z;w.Ra=W,w.bb=j,w.oa=T,w.pa=R}function Ft(w){for(;8<=w.u&&w.bb<w.Sb;)w.Ra>>>=8,w.Ra+=w.oa[w.pa+w.bb]<<Ia-8>>>0,++w.bb,w.u-=8;et(w)&&(w.h=1,w.u=0)}function Mt(w,T){if(e(0<=T),!w.h&&T<=Vl){var R=Xe(w)&al[T];return w.u+=T,Ft(w),R}return w.h=1,w.u=0}function Wt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Ee(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Xe(w){return w.Ra>>>(w.u&Ia-1)>>>0}function et(w){return e(w.bb<=w.Sb),w.h||w.bb==w.Sb&&w.u>Ia}function At(w,T){w.u=T,w.h=et(w)}function ft(w){w.u>=La&&(e(w.u>=La),Ft(w))}function wt(w){e(w!=null&&w.oa!=null),w.pa<w.Zc?(w.I=(w.oa[w.pa++]|w.I<<8)>>>0,w.b+=8):(e(w!=null&&w.oa!=null),w.pa<w.Yc?(w.b+=8,w.I=w.oa[w.pa++]|w.I<<8):w.Ka?w.b=0:(w.I<<=8,w.b+=8,w.Ka=1))}function Pt(w){return Ct(w,1)}function It(w,T){var R=w.Ca;0>w.b&&wt(w);var j=w.b,Z=R*T>>>8,W=(w.I>>>j>Z)+0;for(W?(R-=Z,w.I-=Z+1<<j>>>0):R=Z+1,j=R,Z=0;256<=j;)Z+=8,j>>=8;return j=7^Z+Fs[j],w.b-=j,w.Ca=(R<<j)-1,W}function Ht(w,T,R){w[T+0]=R>>24&255,w[T+1]=R>>16&255,w[T+2]=R>>8&255,w[T+3]=R>>0&255}function ii(w,T){return w[T+0]<<0|w[T+1]<<8}function gi(w,T){return ii(w,T)|w[T+2]<<16}function mi(w,T){return ii(w,T)|ii(w,T+2)<<16}function Mi(w,T){var R=1<<T;return e(w!=null),e(0<T),w.X=o(R),w.X==null?0:(w.Mb=32-T,w.Xa=T,1)}function kt(w,T){e(w!=null),e(T!=null),e(w.Xa==T.Xa),r(T.X,0,w.X,0,1<<T.Xa)}function ot(){this.X=[],this.Xa=this.Mb=0}function xt(w,T,R,j){e(R!=null),e(j!=null);var Z=R[0],W=j[0];return Z==0&&(Z=(w*W+T/2)/T),W==0&&(W=(T*Z+w/2)/w),0>=Z||0>=W?0:(R[0]=Z,j[0]=W,1)}function Ri(w,T){return w+(1<<T)-1>>>T}function ei(w,T){return((4278255360&w)+(4278255360&T)>>>0&4278255360)+((16711935&w)+(16711935&T)>>>0&16711935)>>>0}function ut(w,T){Ue[T]=function(R,j,Z,W,J,ee,ae){var fe;for(fe=0;fe<J;++fe){var pe=Ue[w](ee[ae+fe-1],Z,W+fe);ee[ae+fe]=ei(R[j+fe],pe)}}}function jt(){this.ud=this.hd=this.jd=0}function ni(w,T){return((4278124286&(w^T))>>>1)+(w&T)>>>0}function di(w){return 0<=w&&256>w?w:0>w?0:255<w?255:void 0}function li(w,T){return di(w+(w-T+.5>>1))}function Ki(w,T,R){return Math.abs(T-R)-Math.abs(w-R)}function tr(w,T,R,j,Z,W,J){for(j=W[J-1],R=0;R<Z;++R)W[J+R]=j=ei(w[T+R],j)}function Ar(w,T,R,j,Z){var W;for(W=0;W<R;++W){var J=w[T+W],ee=J>>8&255,ae=16711935&(ae=(ae=16711935&J)+((ee<<16)+ee));j[Z+W]=(4278255360&J)+ae>>>0}}function Er(w,T){T.jd=w>>0&255,T.hd=w>>8&255,T.ud=w>>16&255}function Nt(w,T,R,j,Z,W){var J;for(J=0;J<j;++J){var ee=T[R+J],ae=ee>>>8,fe=ee,pe=255&(pe=(pe=ee>>>16)+((w.jd<<24>>24)*(ae<<24>>24)>>>5));fe=255&(fe=(fe=fe+((w.hd<<24>>24)*(ae<<24>>24)>>>5))+((w.ud<<24>>24)*(pe<<24>>24)>>>5)),Z[W+J]=(4278255360&ee)+(pe<<16)+fe}}function Ji(w,T,R,j,Z){Ue[T]=function(W,J,ee,ae,fe,pe,xe,Pe,Le){for(ae=xe;ae<Pe;++ae)for(xe=0;xe<Le;++xe)fe[pe++]=Z(ee[j(W[J++])])},Ue[w]=function(W,J,ee,ae,fe,pe,xe){var Pe=8>>W.b,Le=W.Ea,rt=W.K[0],Ke=W.w;if(8>Pe)for(W=(1<<W.b)-1,Ke=(1<<Pe)-1;J<ee;++J){var Re,Qe=0;for(Re=0;Re<Le;++Re)Re&W||(Qe=j(ae[fe++])),pe[xe++]=Z(rt[Qe&Ke]),Qe>>=Pe}else Ue["VP8LMapColor"+R](ae,fe,rt,Ke,pe,xe,J,ee,Le)}}function ci(w,T,R,j,Z){for(R=T+R;T<R;){var W=w[T++];j[Z++]=W>>16&255,j[Z++]=W>>8&255,j[Z++]=W>>0&255}}function $t(w,T,R,j,Z){for(R=T+R;T<R;){var W=w[T++];j[Z++]=W>>16&255,j[Z++]=W>>8&255,j[Z++]=W>>0&255,j[Z++]=W>>24&255}}function Zi(w,T,R,j,Z){for(R=T+R;T<R;){var W=(J=w[T++])>>16&240|J>>12&15,J=J>>0&240|J>>28&15;j[Z++]=W,j[Z++]=J}}function Qt(w,T,R,j,Z){for(R=T+R;T<R;){var W=(J=w[T++])>>16&248|J>>13&7,J=J>>5&224|J>>3&31;j[Z++]=W,j[Z++]=J}}function Bi(w,T,R,j,Z){for(R=T+R;T<R;){var W=w[T++];j[Z++]=W>>0&255,j[Z++]=W>>8&255,j[Z++]=W>>16&255}}function Ii(w,T,R,j,Z,W){if(W==0)for(R=T+R;T<R;)Ht(j,((W=w[T++])[0]>>24|W[1]>>8&65280|W[2]<<8&16711680|W[3]<<24)>>>0),Z+=32;else r(j,Z,w,T,R)}function Gt(w,T){Ue[T][0]=Ue[w+"0"],Ue[T][1]=Ue[w+"1"],Ue[T][2]=Ue[w+"2"],Ue[T][3]=Ue[w+"3"],Ue[T][4]=Ue[w+"4"],Ue[T][5]=Ue[w+"5"],Ue[T][6]=Ue[w+"6"],Ue[T][7]=Ue[w+"7"],Ue[T][8]=Ue[w+"8"],Ue[T][9]=Ue[w+"9"],Ue[T][10]=Ue[w+"10"],Ue[T][11]=Ue[w+"11"],Ue[T][12]=Ue[w+"12"],Ue[T][13]=Ue[w+"13"],Ue[T][14]=Ue[w+"0"],Ue[T][15]=Ue[w+"0"]}function vi(w){return w==yn||w==Bs||w==Do||w==ql}function Jt(){this.eb=[],this.size=this.A=this.fb=0}function mr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Sr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Jt,this.f.kb=new mr,this.sd=null}function ze(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function we(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function oe(w){return alert("todo:WebPSamplerProcessPlane"),w.T}function Y(w,T){var R=w.T,j=T.ba.f.RGBA,Z=j.eb,W=j.fb+w.ka*j.A,J=Jr[T.ba.S],ee=w.y,ae=w.O,fe=w.f,pe=w.N,xe=w.ea,Pe=w.W,Le=T.cc,rt=T.dc,Ke=T.Mc,Re=T.Nc,Qe=w.ka,pt=w.ka+w.T,bt=w.U,ht=bt+1>>1;for(Qe==0?J(ee,ae,null,null,fe,pe,xe,Pe,fe,pe,xe,Pe,Z,W,null,null,bt):(J(T.ec,T.fc,ee,ae,Le,rt,Ke,Re,fe,pe,xe,Pe,Z,W-j.A,Z,W,bt),++R);Qe+2<pt;Qe+=2)Le=fe,rt=pe,Ke=xe,Re=Pe,pe+=w.Rc,Pe+=w.Rc,W+=2*j.A,J(ee,(ae+=2*w.fa)-w.fa,ee,ae,Le,rt,Ke,Re,fe,pe,xe,Pe,Z,W-j.A,Z,W,bt);return ae+=w.fa,w.j+pt<w.o?(r(T.ec,T.fc,ee,ae,bt),r(T.cc,T.dc,fe,pe,ht),r(T.Mc,T.Nc,xe,Pe,ht),R--):1&pt||J(ee,ae,null,null,fe,pe,xe,Pe,fe,pe,xe,Pe,Z,W+j.A,null,null,bt),R}function le(w,T,R){var j=w.F,Z=[w.J];if(j!=null){var W=w.U,J=T.ba.S,ee=J==Dc||J==Do;T=T.ba.f.RGBA;var ae=[0],fe=w.ka;ae[0]=w.T,w.Kb&&(fe==0?--ae[0]:(--fe,Z[0]-=w.width),w.j+w.ka+w.T==w.o&&(ae[0]=w.o-w.j-fe));var pe=T.eb;fe=T.fb+fe*T.A,w=Zo(j,Z[0],w.width,W,ae,pe,fe+(ee?0:3),T.A),e(R==ae),w&&vi(J)&&Fa(pe,fe,ee,W,ae,T.A)}return 0}function ge(w){var T=w.ma,R=T.ba.S,j=11>R,Z=R==jl||R==Fc||R==Dc||R==Rc||R==12||vi(R);if(T.memory=null,T.Ib=null,T.Jb=null,T.Nd=null,!Ql(T.Oa,w,Z?11:12))return 0;if(Z&&vi(R)&&pi(),w.da)alert("todo:use_scaling");else{if(j){if(T.Ib=oe,w.Kb){if(R=w.U+1>>1,T.memory=o(w.U+2*R),T.memory==null)return 0;T.ec=T.memory,T.fc=0,T.cc=T.ec,T.dc=T.fc+w.U,T.Mc=T.cc,T.Nc=T.dc+R,T.Ib=Y,pi()}}else alert("todo:EmitYUV");Z&&(T.Jb=le,j&&vt())}if(j&&!b){for(w=0;256>w;++w)L[w]=89858*(w-128)+va>>yo,a[w]=-22014*(w-128)+va,y[w]=-45773*(w-128),k[w]=113618*(w-128)+va>>yo;for(w=dl;w<Gr;++w)T=76283*(w-16)+va>>yo,d[w-dl]=eo(T,255),_[w-dl]=eo(T+8>>4,15);b=1}return 1}function _e(w){var T=w.ma,R=w.U,j=w.T;return e(!(1&w.ka)),0>=R||0>=j?0:(R=T.Ib(w,T),T.Jb!=null&&T.Jb(w,T,R),T.Dc+=R,1)}function Ce(w){w.ma.memory=null}function ve(w,T,R,j){return Mt(w,8)!=47?0:(T[0]=Mt(w,14)+1,R[0]=Mt(w,14)+1,j[0]=Mt(w,1),Mt(w,3)!=0?0:!w.h)}function Me(w,T){if(4>w)return w+1;var R=w-2>>1;return(2+(1&w)<<R)+Mt(T,R)+1}function Oe(w,T){return 120<T?T-120:1<=(R=((R=bi[T-1])>>4)*w+(8-(15&R)))?R:1;var R}function Ve(w,T,R){var j=Xe(R),Z=w[T+=255&j].g-8;return 0<Z&&(At(R,R.u+8),j=Xe(R),T+=w[T].value,T+=j&(1<<Z)-1),At(R,R.u+w[T].g),w[T].value}function it(w,T,R){return R.g+=w.g,R.value+=w.value<<T>>>0,e(8>=R.g),w.g}function yt(w,T,R){var j=w.xc;return e((T=j==0?0:w.vc[w.md*(R>>j)+(T>>j)])<w.Wb),w.Ya[T]}function Bt(w,T,R,j){var Z=w.ab,W=w.c*T,J=w.C;T=J+T;var ee=R,ae=j;for(j=w.Ta,R=w.Ua;0<Z--;){var fe=w.gc[Z],pe=J,xe=T,Pe=ee,Le=ae,rt=(ae=j,ee=R,fe.Ea);switch(e(pe<xe),e(xe<=fe.nc),fe.hc){case 2:on(Pe,Le,(xe-pe)*rt,ae,ee);break;case 0:var Ke=pe,Re=xe,Qe=ae,pt=ee,bt=(Vt=fe).Ea;Ke==0&&(Lu(Pe,Le,null,null,1,Qe,pt),tr(Pe,Le+1,0,0,bt-1,Qe,pt+1),Le+=bt,pt+=bt,++Ke);for(var ht=1<<Vt.b,Rt=ht-1,Dt=Ri(bt,Vt.b),hi=Vt.K,Vt=Vt.w+(Ke>>Vt.b)*Dt;Ke<Re;){var _i=hi,Si=Vt,Yi=1;for(Sn(Pe,Le,Qe,pt-bt,1,Qe,pt);Yi<bt;){var Ti=(Yi&~Rt)+ht;Ti>bt&&(Ti=bt),(0,fo[_i[Si++]>>8&15])(Pe,Le+ +Yi,Qe,pt+Yi-bt,Ti-Yi,Qe,pt+Yi),Yi=Ti}Le+=bt,pt+=bt,++Ke&Rt||(Vt+=Dt)}xe!=fe.nc&&r(ae,ee-rt,ae,ee+(xe-pe-1)*rt,rt);break;case 1:for(rt=Pe,Re=Le,bt=(Pe=fe.Ea)-(pt=Pe&~(Qe=(Le=1<<fe.b)-1)),Ke=Ri(Pe,fe.b),ht=fe.K,fe=fe.w+(pe>>fe.b)*Ke;pe<xe;){for(Rt=ht,Dt=fe,hi=new jt,Vt=Re+pt,_i=Re+Pe;Re<Vt;)Er(Rt[Dt++],hi),ns(hi,rt,Re,Le,ae,ee),Re+=Le,ee+=Le;Re<_i&&(Er(Rt[Dt++],hi),ns(hi,rt,Re,bt,ae,ee),Re+=bt,ee+=bt),++pe&Qe||(fe+=Ke)}break;case 3:if(Pe==ae&&Le==ee&&0<fe.b){for(Re=ae,Pe=rt=ee+(xe-pe)*rt-(pt=(xe-pe)*Ri(fe.Ea,fe.b)),Le=ae,Qe=ee,Ke=[],pt=(bt=pt)-1;0<=pt;--pt)Ke[pt]=Le[Qe+pt];for(pt=bt-1;0<=pt;--pt)Re[Pe+pt]=Ke[pt];fn(fe,pe,xe,ae,rt,ae,ee)}else fn(fe,pe,xe,Pe,Le,ae,ee)}ee=j,ae=R}ae!=R&&r(j,R,ee,ae,W)}function Yt(w,T){var R=w.V,j=w.Ba+w.c*w.C,Z=T-w.C;if(e(T<=w.l.o),e(16>=Z),0<Z){var W=w.l,J=w.Ta,ee=w.Ua,ae=W.width;if(Bt(w,Z,R,j),Z=ee=[ee],e((R=w.C)<(j=T)),e(W.v<W.va),j>W.o&&(j=W.o),R<W.j){var fe=W.j-R;R=W.j,Z[0]+=fe*ae}if(R>=j?R=0:(Z[0]+=4*W.v,W.ka=R-W.j,W.U=W.va-W.v,W.T=j-R,R=1),R){if(ee=ee[0],11>(R=w.ca).S){var pe=R.f.RGBA,xe=(j=R.S,Z=W.U,W=W.T,fe=pe.eb,pe.A),Pe=W;for(pe=pe.fb+w.Ma*pe.A;0<Pe--;){var Le=J,rt=ee,Ke=Z,Re=fe,Qe=pe;switch(j){case Mc:ss(Le,rt,Ke,Re,Qe);break;case jl:Mo(Le,rt,Ke,Re,Qe);break;case yn:Mo(Le,rt,Ke,Re,Qe),Fa(Re,Qe,0,Ke,1,0);break;case Pc:ul(Le,rt,Ke,Re,Qe);break;case Fc:Ii(Le,rt,Ke,Re,Qe,1);break;case Bs:Ii(Le,rt,Ke,Re,Qe,1),Fa(Re,Qe,0,Ke,1,0);break;case Dc:Ii(Le,rt,Ke,Re,Qe,0);break;case Do:Ii(Le,rt,Ke,Re,Qe,0),Fa(Re,Qe,1,Ke,1,0);break;case Rc:Po(Le,rt,Ke,Re,Qe);break;case ql:Po(Le,rt,Ke,Re,Qe),go(Re,Qe,Ke,1,0);break;case Za:ga(Le,rt,Ke,Re,Qe);break;default:e(0)}ee+=ae,pe+=xe}w.Ma+=W}else alert("todo:EmitRescaledRowsYUVA");e(w.Ma<=R.height)}}w.C=T,e(w.C<=w.i)}function qt(w){var T;if(0<w.ua)return 0;for(T=0;T<w.Wb;++T){var R=w.Ya[T].G,j=w.Ya[T].H;if(0<R[1][j[1]+0].g||0<R[2][j[2]+0].g||0<R[3][j[3]+0].g)return 0}return 1}function Kt(w,T,R,j,Z,W){if(w.Z!=0){var J=w.qd,ee=w.rd;for(e(Rs[w.Z]!=null);T<R;++T)Rs[w.Z](J,ee,j,Z,j,Z,W),J=j,ee=Z,Z+=W;w.qd=J,w.rd=ee}}function si(w,T){var R=w.l.ma,j=R.Z==0||R.Z==1?w.l.j:w.C;if(j=w.C<j?j:w.C,e(T<=w.l.o),T>j){var Z=w.l.width,W=R.ca,J=R.tb+Z*j,ee=w.V,ae=w.Ba+w.c*j,fe=w.gc;e(w.ab==1),e(fe[0].hc==3),ll(fe[0],j,T,ee,ae,W,J),Kt(R,j,T,W,J,Z)}w.C=w.Ma=T}function Ci(w,T,R,j,Z,W,J){var ee=w.$/j,ae=w.$%j,fe=w.m,pe=w.s,xe=R+w.$,Pe=xe;Z=R+j*Z;var Le=R+j*W,rt=280+pe.ua,Ke=w.Pb?ee:16777216,Re=0<pe.ua?pe.Wa:null,Qe=pe.wc,pt=xe<Le?yt(pe,ae,ee):null;e(w.C<W),e(Le<=Z);var bt=!1;e:for(;;){for(;bt||xe<Le;){var ht=0;if(ee>=Ke){var Rt=xe-R;e((Ke=w).Pb),Ke.wd=Ke.m,Ke.xd=Rt,0<Ke.s.ua&&kt(Ke.s.Wa,Ke.s.vb),Ke=ee+$l}if(ae&Qe||(pt=yt(pe,ae,ee)),e(pt!=null),pt.Qb&&(T[xe]=pt.qb,bt=!0),!bt)if(ft(fe),pt.jc){ht=fe,Rt=T;var Dt=xe,hi=pt.pd[Xe(ht)&Ps-1];e(pt.jc),256>hi.g?(At(ht,ht.u+hi.g),Rt[Dt]=hi.value,ht=0):(At(ht,ht.u+hi.g-256),e(256<=hi.value),ht=hi.value),ht==0&&(bt=!0)}else ht=Ve(pt.G[0],pt.H[0],fe);if(fe.h)break;if(bt||256>ht){if(!bt)if(pt.nd)T[xe]=(pt.qb|ht<<8)>>>0;else{if(ft(fe),bt=Ve(pt.G[1],pt.H[1],fe),ft(fe),Rt=Ve(pt.G[2],pt.H[2],fe),Dt=Ve(pt.G[3],pt.H[3],fe),fe.h)break;T[xe]=(Dt<<24|bt<<16|ht<<8|Rt)>>>0}if(bt=!1,++xe,++ae>=j&&(ae=0,++ee,J!=null&&ee<=W&&!(ee%16)&&J(w,ee),Re!=null))for(;Pe<xe;)ht=T[Pe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht}else if(280>ht){if(ht=Me(ht-256,fe),Rt=Ve(pt.G[4],pt.H[4],fe),ft(fe),Rt=Oe(j,Rt=Me(Rt,fe)),fe.h)break;if(xe-R<Rt||Z-xe<ht)break e;for(Dt=0;Dt<ht;++Dt)T[xe+Dt]=T[xe+Dt-Rt];for(xe+=ht,ae+=ht;ae>=j;)ae-=j,++ee,J!=null&&ee<=W&&!(ee%16)&&J(w,ee);if(e(xe<=Z),ae&Qe&&(pt=yt(pe,ae,ee)),Re!=null)for(;Pe<xe;)ht=T[Pe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht}else{if(!(ht<rt))break e;for(bt=ht-280,e(Re!=null);Pe<xe;)ht=T[Pe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht;ht=xe,e(!(bt>>>(Rt=Re).Xa)),T[ht]=Rt.X[bt],bt=!0}bt||e(fe.h==et(fe))}if(w.Pb&&fe.h&&xe<Z)e(w.m.h),w.a=5,w.m=w.wd,w.$=w.xd,0<w.s.ua&&kt(w.s.vb,w.s.Wa);else{if(fe.h)break e;J!=null&&J(w,ee>W?W:ee),w.a=0,w.$=xe-R}return 1}return w.a=3,0}function Hi(w){e(w!=null),w.vc=null,w.yc=null,w.Ya=null;var T=w.Wa;T!=null&&(T.X=null),w.vb=null,e(w!=null)}function wi(){var w=new Xa;return w==null?null:(w.a=0,w.xb=au,Gt("Predictor","VP8LPredictors"),Gt("Predictor","VP8LPredictors_C"),Gt("PredictorAdd","VP8LPredictorsAdd"),Gt("PredictorAdd","VP8LPredictorsAdd_C"),on=Ar,ns=Nt,ss=ci,Mo=$t,Po=Zi,ga=Qt,ul=Bi,Ue.VP8LMapColor32b=Yn,Ue.VP8LMapColor8b=cl,w)}function Ui(w,T,R,j,Z){var W=1,J=[w],ee=[T],ae=j.m,fe=j.s,pe=null,xe=0;e:for(;;){if(R)for(;W&&Mt(ae,1);){var Pe=J,Le=ee,rt=j,Ke=1,Re=rt.m,Qe=rt.gc[rt.ab],pt=Mt(Re,2);if(rt.Oc&1<<pt)W=0;else{switch(rt.Oc|=1<<pt,Qe.hc=pt,Qe.Ea=Pe[0],Qe.nc=Le[0],Qe.K=[null],++rt.ab,e(4>=rt.ab),pt){case 0:case 1:Qe.b=Mt(Re,3)+2,Ke=Ui(Ri(Qe.Ea,Qe.b),Ri(Qe.nc,Qe.b),0,rt,Qe.K),Qe.K=Qe.K[0];break;case 3:var bt,ht=Mt(Re,8)+1,Rt=16<ht?0:4<ht?1:2<ht?2:3;if(Pe[0]=Ri(Qe.Ea,Rt),Qe.b=Rt,bt=Ke=Ui(ht,1,0,rt,Qe.K)){var Dt,hi=ht,Vt=Qe,_i=1<<(8>>Vt.b),Si=o(_i);if(Si==null)bt=0;else{var Yi=Vt.K[0],Ti=Vt.w;for(Si[0]=Vt.K[0][0],Dt=1;Dt<1*hi;++Dt)Si[Dt]=ei(Yi[Ti+Dt],Si[Dt-1]);for(;Dt<4*_i;++Dt)Si[Dt]=0;Vt.K[0]=null,Vt.K[0]=Si,bt=1}}Ke=bt;break;case 2:break;default:e(0)}W=Ke}}if(J=J[0],ee=ee[0],W&&Mt(ae,1)&&!(W=1<=(xe=Mt(ae,4))&&11>=xe)){j.a=3;break e}var yr;if(yr=W)t:{var fr,ji,Ur,rn=j,Mr=J,Kr=ee,Cr=xe,es=R,Nr=rn.m,pr=rn.s,_r=[null],or=1,ln=0,qr=sr[Cr];i:for(;;){if(es&&Mt(Nr,1)){var Wr=Mt(Nr,3)+2,Mn=Ri(Mr,Wr),$n=Ri(Kr,Wr),fl=Mn*$n;if(!Ui(Mn,$n,0,rn,_r))break i;for(_r=_r[0],pr.xc=Wr,fr=0;fr<fl;++fr){var $r=_r[fr]>>8&65535;_r[fr]=$r,$r>=or&&(or=$r+1)}}if(Nr.h)break i;for(ji=0;5>ji;++ji){var _n=su[ji];!ji&&0<Cr&&(_n+=1<<Cr),ln<_n&&(ln=_n)}var ea=c(or*qr,Fe),ks=or,Ks=c(ks,We);if(Ks==null)var Oo=null;else e(65536>=ks),Oo=Ks;var so=o(ln);if(Oo==null||so==null||ea==null){rn.a=1;break i}var Fu=ea;for(fr=Ur=0;fr<or;++fr){var Ra=Oo[fr],In=Ra.G,dc=Ra.H,cu=0,Uc=1,Nc=0;for(ji=0;5>ji;++ji){_n=su[ji],In[ji]=Fu,dc[ji]=Ur,!ji&&0<Cr&&(_n+=1<<Cr);n:{var Du,Xh=_n,zc=rn,DA=so,Zh=Fu,xd=Ur,Ru=0,uu=zc.m,wd=Mt(uu,1);if(n(DA,0,0,Xh),wd){var jg=Mt(uu,1)+1,ta=Mt(uu,1),Wl=Mt(uu,ta==0?1:8);DA[Wl]=1,jg==2&&(DA[Wl=Mt(uu,8)]=1);var Jh=1}else{var fh=o(19),hu=Mt(uu,4)+4;if(19<hu){zc.a=3;var ph=0;break n}for(Du=0;Du<hu;++Du)fh[$s[Du]]=Mt(uu,3);var gh=void 0,Yh=void 0,kf=zc,ia=fh,Qc=Xh,Bd=DA,eA=0,pl=kf.m,Cd=8,Au=c(128,Fe);r:for(;De(Au,0,7,ia,19);){if(Mt(pl,1)){var gl=2+2*Mt(pl,3);if((gh=2+Mt(pl,gl))>Qc)break r}else gh=Qc;for(Yh=0;Yh<Qc&&gh--;){ft(pl);var Ed=Au[0+(127&Xe(pl))];At(pl,pl.u+Ed.g);var mh=Ed.value;if(16>mh)Bd[Yh++]=mh,mh!=0&&(Cd=mh);else{var Of=mh==16,qg=mh-16,Uf=Ac[qg],Nf=Mt(pl,Mu[qg])+Uf;if(Yh+Nf>Qc)break r;for(var zf=Of?Cd:0;0<Nf--;)Bd[Yh++]=zf}}eA=1;break r}eA||(kf.a=3),Jh=eA}(Jh=Jh&&!uu.h)&&(Ru=De(Zh,xd,8,DA,Xh)),Jh&&Ru!=0?ph=Ru:(zc.a=3,ph=0)}if(ph==0)break i;if(Uc&&_a[ji]==1&&(Uc=Fu[Ur].g==0),cu+=Fu[Ur].g,Ur+=ph,3>=ji){var fc,Uo=so[0];for(fc=1;fc<_n;++fc)so[fc]>Uo&&(Uo=so[fc]);Nc+=Uo}}if(Ra.nd=Uc,Ra.Qb=0,Uc&&(Ra.qb=(In[3][dc[3]+0].value<<24|In[1][dc[1]+0].value<<16|In[2][dc[2]+0].value)>>>0,cu==0&&256>In[0][dc[0]+0].value&&(Ra.Qb=1,Ra.qb+=In[0][dc[0]+0].value<<8)),Ra.jc=!Ra.Qb&&6>Nc,Ra.jc){var tA,ka=Ra;for(tA=0;tA<Ps;++tA){var ml=tA,ku=ka.pd[ml],Sd=ka.G[0][ka.H[0]+ml];256<=Sd.value?(ku.g=Sd.g+256,ku.value=Sd.value):(ku.g=0,ku.value=0,ml>>=it(Sd,8,ku),ml>>=it(ka.G[1][ka.H[1]+ml],16,ku),ml>>=it(ka.G[2][ka.H[2]+ml],0,ku),it(ka.G[3][ka.H[3]+ml],24,ku))}}}pr.vc=_r,pr.Wb=or,pr.Ya=Oo,pr.yc=ea,yr=1;break t}yr=0}if(!(W=yr)){j.a=3;break e}if(0<xe){if(fe.ua=1<<xe,!Mi(fe.Wa,xe)){j.a=1,W=0;break e}}else fe.ua=0;var Qf=j,$g=J,Vf=ee,iA=Qf.s,Td=iA.xc;if(Qf.c=$g,Qf.i=Vf,iA.md=Ri($g,Td),iA.wc=Td==0?-1:(1<<Td)-1,R){j.xb=Ro;break e}if((pe=o(J*ee))==null){j.a=1,W=0;break e}W=(W=Ci(j,pe,0,J,ee,ee,null))&&!ae.h;break e}return W?(Z!=null?Z[0]=pe:(e(pe==null),e(R)),j.$=0,R||Hi(fe)):Hi(fe),W}function st(w,T){var R=w.c*w.i,j=R+T+16*T;return e(w.c<=T),w.V=o(j),w.V==null?(w.Ta=null,w.Ua=0,w.a=1,0):(w.Ta=w.V,w.Ua=w.Ba+R+T,1)}function ti(w,T){var R=w.C,j=T-R,Z=w.V,W=w.Ba+w.c*R;for(e(T<=w.l.o);0<j;){var J=16<j?16:j,ee=w.l.ma,ae=w.l.width,fe=ae*J,pe=ee.ca,xe=ee.tb+ae*R,Pe=w.Ta,Le=w.Ua;Bt(w,J,Z,W),Oi(Pe,Le,pe,xe,fe),Kt(ee,R,R+J,pe,xe,ae),j-=J,Z+=J*w.c,R+=J}e(R==T),w.C=w.Ma=T}function zt(){this.ub=this.yd=this.td=this.Rb=0}function zi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function hr(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function sn(){this.Yb=function(){var w=[];return function T(R,j,Z){for(var W=Z[j],J=0;J<W&&(R.push(Z.length>j+1?[]:0),!(Z.length<j+1));J++)T(R[J],j+1,Z)}(w,0,[3,11]),w}()}function bn(){this.jb=o(3),this.Wc=s([4,8],sn),this.Xc=s([4,17],sn)}function ur(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function gn(){this.ld=this.La=this.dd=this.tc=0}function mn(){this.Na=this.la=0}function lr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Rn(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ps(){this.uc=this.M=this.Nb=0,this.wa=Array(new gn),this.Y=0,this.ya=Array(new Rn),this.aa=0,this.l=new So}function Qr(){this.y=o(16),this.f=o(8),this.ea=o(8)}function xn(){this.cb=this.a=0,this.sc="",this.m=new Wt,this.Od=new zt,this.Kc=new zi,this.ed=new ur,this.Qa=new hr,this.Ic=this.$c=this.Aa=0,this.D=new ps,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=c(8,Wt),this.ia=0,this.pb=c(4,lr),this.Pa=new bn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Qr),this.Hd=0,this.rb=Array(new mn),this.sb=0,this.wa=Array(new gn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Rn),this.L=this.aa=0,this.gd=s([4,2],gn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function So(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function cs(){var w=new xn;return w!=null&&(w.a=0,w.sc="OK",w.cb=0,w.Xb=0,Cs||(Cs=dr)),w}function Wi(w,T,R){return w.a==0&&(w.a=T,w.sc=R,w.cb=0),0}function Js(w,T,R){return 3<=R&&w[T+0]==157&&w[T+1]==1&&w[T+2]==42}function ws(w,T){if(w==null)return 0;if(w.a=0,w.sc="OK",T==null)return Wi(w,2,"null VP8Io passed to VP8GetHeaders()");var R=T.data,j=T.w,Z=T.ha;if(4>Z)return Wi(w,7,"Truncated header.");var W=R[j+0]|R[j+1]<<8|R[j+2]<<16,J=w.Od;if(J.Rb=!(1&W),J.td=W>>1&7,J.yd=W>>4&1,J.ub=W>>5,3<J.td)return Wi(w,3,"Incorrect keyframe parameters.");if(!J.yd)return Wi(w,4,"Frame not displayable.");j+=3,Z-=3;var ee=w.Kc;if(J.Rb){if(7>Z)return Wi(w,7,"cannot parse picture header");if(!Js(R,j,Z))return Wi(w,3,"Bad code word");ee.c=16383&(R[j+4]<<8|R[j+3]),ee.Td=R[j+4]>>6,ee.i=16383&(R[j+6]<<8|R[j+5]),ee.Ud=R[j+6]>>6,j+=7,Z-=7,w.za=ee.c+15>>4,w.Ub=ee.i+15>>4,T.width=ee.c,T.height=ee.i,T.Da=0,T.j=0,T.v=0,T.va=T.width,T.o=T.height,T.da=0,T.ib=T.width,T.hb=T.height,T.U=T.width,T.T=T.height,n((W=w.Pa).jb,0,255,W.jb.length),e((W=w.Qa)!=null),W.Cb=0,W.Bb=0,W.Fb=1,n(W.Zb,0,0,W.Zb.length),n(W.Lb,0,0,W.Lb)}if(J.ub>Z)return Wi(w,7,"bad partition length");Et(W=w.m,R,j,J.ub),j+=J.ub,Z-=J.ub,J.Rb&&(ee.Ld=Pt(W),ee.Kd=Pt(W)),ee=w.Qa;var ae,fe=w.Pa;if(e(W!=null),e(ee!=null),ee.Cb=Pt(W),ee.Cb){if(ee.Bb=Pt(W),Pt(W)){for(ee.Fb=Pt(W),ae=0;4>ae;++ae)ee.Zb[ae]=Pt(W)?Lt(W,7):0;for(ae=0;4>ae;++ae)ee.Lb[ae]=Pt(W)?Lt(W,6):0}if(ee.Bb)for(ae=0;3>ae;++ae)fe.jb[ae]=Pt(W)?Ct(W,8):255}else ee.Bb=0;if(W.Ka)return Wi(w,3,"cannot parse segment header");if((ee=w.ed).zd=Pt(W),ee.Tb=Ct(W,6),ee.wb=Ct(W,3),ee.Pc=Pt(W),ee.Pc&&Pt(W)){for(fe=0;4>fe;++fe)Pt(W)&&(ee.vd[fe]=Lt(W,6));for(fe=0;4>fe;++fe)Pt(W)&&(ee.od[fe]=Lt(W,6))}if(w.L=ee.Tb==0?0:ee.zd?1:2,W.Ka)return Wi(w,3,"cannot parse filter header");var pe=Z;if(Z=ae=j,j=ae+pe,ee=pe,w.Xb=(1<<Ct(w.m,2))-1,pe<3*(fe=w.Xb))R=7;else{for(ae+=3*fe,ee-=3*fe,pe=0;pe<fe;++pe){var xe=R[Z+0]|R[Z+1]<<8|R[Z+2]<<16;xe>ee&&(xe=ee),Et(w.Jc[+pe],R,ae,xe),ae+=xe,ee-=xe,Z+=3}Et(w.Jc[+fe],R,ae,ee),R=ae<j?0:5}if(R!=0)return Wi(w,R,"cannot parse partitions");for(R=Ct(ae=w.m,7),Z=Pt(ae)?Lt(ae,4):0,j=Pt(ae)?Lt(ae,4):0,ee=Pt(ae)?Lt(ae,4):0,fe=Pt(ae)?Lt(ae,4):0,ae=Pt(ae)?Lt(ae,4):0,pe=w.Qa,xe=0;4>xe;++xe){if(pe.Cb){var Pe=pe.Zb[xe];pe.Fb||(Pe+=R)}else{if(0<xe){w.pb[xe]=w.pb[0];continue}Pe=R}var Le=w.pb[xe];Le.Sc[0]=kc[eo(Pe+Z,127)],Le.Sc[1]=Oc[eo(Pe+0,127)],Le.Eb[0]=2*kc[eo(Pe+j,127)],Le.Eb[1]=101581*Oc[eo(Pe+ee,127)]>>16,8>Le.Eb[1]&&(Le.Eb[1]=8),Le.Qc[0]=kc[eo(Pe+fe,117)],Le.Qc[1]=Oc[eo(Pe+ae,127)],Le.lc=Pe+ae}if(!J.Rb)return Wi(w,4,"Not a key frame.");for(Pt(W),J=w.Pa,R=0;4>R;++R){for(Z=0;8>Z;++Z)for(j=0;3>j;++j)for(ee=0;11>ee;++ee)fe=It(W,qn[R][Z][j][ee])?Ct(W,8):$i[R][Z][j][ee],J.Wc[R][Z].Yb[j][ee]=fe;for(Z=0;17>Z;++Z)J.Xc[R][Z]=J.Wc[R][Pu[Z]]}return w.kc=Pt(W),w.kc&&(w.Bd=Ct(W,8)),w.cb=1}function dr(w,T,R,j,Z,W,J){var ee=T[Z].Yb[R];for(R=0;16>Z;++Z){if(!It(w,ee[R+0]))return Z;for(;!It(w,ee[R+1]);)if(ee=T[++Z].Yb[0],R=0,Z==16)return 16;var ae=T[Z+1].Yb;if(It(w,ee[R+2])){var fe=w,pe=0;if(It(fe,(Pe=ee)[(xe=R)+3]))if(It(fe,Pe[xe+6])){for(ee=0,xe=2*(pe=It(fe,Pe[xe+8]))+(Pe=It(fe,Pe[xe+9+pe])),pe=0,Pe=dh[xe];Pe[ee];++ee)pe+=pe+It(fe,Pe[ee]);pe+=3+(8<<xe)}else It(fe,Pe[xe+7])?(pe=7+2*It(fe,165),pe+=It(fe,145)):pe=5+It(fe,159);else pe=It(fe,Pe[xe+4])?3+It(fe,Pe[xe+5]):2;ee=ae[2]}else pe=1,ee=ae[1];ae=J+jn[Z],0>(fe=w).b&&wt(fe);var xe,Pe=fe.b,Le=(xe=fe.Ca>>1)-(fe.I>>Pe)>>31;--fe.b,fe.Ca+=Le,fe.Ca|=1,fe.I-=(xe+1&Le)<<Pe,W[ae]=((pe^Le)-Le)*j[(0<Z)+0]}return 16}function Fr(w){var T=w.rb[w.sb-1];T.la=0,T.Na=0,n(w.zc,0,0,w.zc.length),w.ja=0}function Vn(w,T){if(w==null)return 0;if(T==null)return Wi(w,2,"NULL VP8Io parameter in VP8Decode().");if(!w.cb&&!ws(w,T))return 0;if(e(w.cb),T.ac==null||T.ac(T)){T.ob&&(w.L=0);var R=S[w.L];if(w.L==2?(w.yb=0,w.zb=0):(w.yb=T.v-R>>4,w.zb=T.j-R>>4,0>w.yb&&(w.yb=0),0>w.zb&&(w.zb=0)),w.Va=T.o+15+R>>4,w.Hb=T.va+15+R>>4,w.Hb>w.za&&(w.Hb=w.za),w.Va>w.Ub&&(w.Va=w.Ub),0<w.L){var j=w.ed;for(R=0;4>R;++R){var Z;if(w.Qa.Cb){var W=w.Qa.Lb[R];w.Qa.Fb||(W+=j.Tb)}else W=j.Tb;for(Z=0;1>=Z;++Z){var J=w.gd[R][Z],ee=W;if(j.Pc&&(ee+=j.vd[0],Z&&(ee+=j.od[0])),0<(ee=0>ee?0:63<ee?63:ee)){var ae=ee;0<j.wb&&(ae=4<j.wb?ae>>2:ae>>1)>9-j.wb&&(ae=9-j.wb),1>ae&&(ae=1),J.dd=ae,J.tc=2*ee+ae,J.ld=40<=ee?2:15<=ee?1:0}else J.tc=0;J.La=Z}}}R=0}else Wi(w,6,"Frame setup failed"),R=w.a;if(R=R==0){if(R){w.$c=0,0<w.Aa||(w.Ic=H);e:{R=w.Ic,j=4*(ae=w.za);var fe=32*ae,pe=ae+1,xe=0<w.L?ae*(0<w.Aa?2:1):0,Pe=(w.Aa==2?2:1)*ae;if((J=j+832+(Z=3*(16*R+S[w.L])/2*fe)+(W=w.Fa!=null&&0<w.Fa.length?w.Kc.c*w.Kc.i:0))!=J)R=0;else{if(J>w.Vb){if(w.Vb=0,w.Ec=o(J),w.Fc=0,w.Ec==null){R=Wi(w,1,"no memory during frame initialization.");break e}w.Vb=J}J=w.Ec,ee=w.Fc,w.Ac=J,w.Bc=ee,ee+=j,w.Gd=c(fe,Qr),w.Hd=0,w.rb=c(pe+1,mn),w.sb=1,w.wa=xe?c(xe,gn):null,w.Y=0,w.D.Nb=0,w.D.wa=w.wa,w.D.Y=w.Y,0<w.Aa&&(w.D.Y+=ae),e(!0),w.oc=J,w.pc=ee,ee+=832,w.ya=c(Pe,Rn),w.aa=0,w.D.ya=w.ya,w.D.aa=w.aa,w.Aa==2&&(w.D.aa+=ae),w.R=16*ae,w.B=8*ae,ae=(fe=S[w.L])*w.R,fe=fe/2*w.B,w.sa=J,w.ta=ee+ae,w.qa=w.sa,w.ra=w.ta+16*R*w.R+fe,w.Ha=w.qa,w.Ia=w.ra+8*R*w.B+fe,w.$c=0,ee+=Z,w.mb=W?J:null,w.nb=W?ee:null,e(ee+W<=w.Fc+w.Vb),Fr(w),n(w.Ac,w.Bc,0,j),R=1}}if(R){if(T.ka=0,T.y=w.sa,T.O=w.ta,T.f=w.qa,T.N=w.ra,T.ea=w.Ha,T.Vd=w.Ia,T.fa=w.R,T.Rc=w.B,T.F=null,T.J=0,!Li){for(R=-255;255>=R;++R)Jo[255+R]=0>R?-R:R;for(R=-1020;1020>=R;++R)Pi[1020+R]=-128>R?-128:127<R?127:R;for(R=-112;112>=R;++R)hl[112+R]=-16>R?-16:15<R?15:R;for(R=-255;510>=R;++R)Hl[255+R]=0>R?0:255<R?255:R;Li=1}to=Ze,io=ca,ms=uo,ro=Ea,Ma=Ne,po=Hs,ma=uc,Pa=Xo,Tn=Ah,Fo=ru,hs=kl,ys=Lc,As=nu,Ir=Iu,Zr=Rl,an=Io,Gn=Ko,ya=cc,tn[0]=Jn,tn[1]=Ot,tn[2]=Ha,tn[3]=Dl,tn[4]=To,tn[5]=gs,tn[6]=Ga,tn[7]=ua,tn[8]=Sa,tn[9]=ja,Ds[0]=is,Ds[1]=Gi,Ds[2]=br,Ds[3]=En,Ds[4]=wn,Ds[5]=iu,Ds[6]=Va,Yo[0]=Pr,Yo[1]=ui,Yo[2]=Ic,Yo[3]=qa,Yo[4]=us,Yo[5]=ha,Yo[6]=dn,R=1}else R=0}R&&(R=function(Le,rt){for(Le.M=0;Le.M<Le.Va;++Le.M){var Ke,Re=Le.Jc[Le.M&Le.Xb],Qe=Le.m,pt=Le;for(Ke=0;Ke<pt.za;++Ke){var bt=Qe,ht=pt,Rt=ht.Ac,Dt=ht.Bc+4*Ke,hi=ht.zc,Vt=ht.ya[ht.aa+Ke];if(ht.Qa.Bb?Vt.$b=It(bt,ht.Pa.jb[0])?2+It(bt,ht.Pa.jb[2]):It(bt,ht.Pa.jb[1]):Vt.$b=0,ht.kc&&(Vt.Ad=It(bt,ht.Bd)),Vt.Za=!It(bt,145)+0,Vt.Za){var _i=Vt.Ob,Si=0;for(ht=0;4>ht;++ht){var Yi,Ti=hi[0+ht];for(Yi=0;4>Yi;++Yi){Ti=Ni[Rt[Dt+Yi]][Ti];for(var yr=ou[It(bt,Ti[0])];0<yr;)yr=ou[2*yr+It(bt,Ti[yr])];Ti=-yr,Rt[Dt+Yi]=Ti}r(_i,Si,Rt,Dt,4),Si+=4,hi[0+ht]=Ti}}else Ti=It(bt,156)?It(bt,128)?1:3:It(bt,163)?2:0,Vt.Ob[0]=Ti,n(Rt,Dt,Ti,4),n(hi,0,Ti,4);Vt.Dd=It(bt,142)?It(bt,114)?It(bt,183)?1:3:2:0}if(pt.m.Ka)return Wi(Le,7,"Premature end-of-partition0 encountered.");for(;Le.ja<Le.za;++Le.ja){if(pt=Re,bt=(Qe=Le).rb[Qe.sb-1],Rt=Qe.rb[Qe.sb+Qe.ja],Ke=Qe.ya[Qe.aa+Qe.ja],Dt=Qe.kc?Ke.Ad:0)bt.la=Rt.la=0,Ke.Za||(bt.Na=Rt.Na=0),Ke.Hc=0,Ke.Gc=0,Ke.ia=0;else{var fr,ji;if(bt=Rt,Rt=pt,Dt=Qe.Pa.Xc,hi=Qe.ya[Qe.aa+Qe.ja],Vt=Qe.pb[hi.$b],ht=hi.ad,_i=0,Si=Qe.rb[Qe.sb-1],Ti=Yi=0,n(ht,_i,0,384),hi.Za)var Ur=0,rn=Dt[3];else{yr=o(16);var Mr=bt.Na+Si.Na;if(Mr=Cs(Rt,Dt[1],Mr,Vt.Eb,0,yr,0),bt.Na=Si.Na=(0<Mr)+0,1<Mr)to(yr,0,ht,_i);else{var Kr=yr[0]+3>>3;for(yr=0;256>yr;yr+=16)ht[_i+yr]=Kr}Ur=1,rn=Dt[0]}var Cr=15&bt.la,es=15&Si.la;for(yr=0;4>yr;++yr){var Nr=1&es;for(Kr=ji=0;4>Kr;++Kr)Cr=Cr>>1|(Nr=(Mr=Cs(Rt,rn,Mr=Nr+(1&Cr),Vt.Sc,Ur,ht,_i))>Ur)<<7,ji=ji<<2|(3<Mr?3:1<Mr?2:ht[_i+0]!=0),_i+=16;Cr>>=4,es=es>>1|Nr<<7,Yi=(Yi<<8|ji)>>>0}for(rn=Cr,Ur=es>>4,fr=0;4>fr;fr+=2){for(ji=0,Cr=bt.la>>4+fr,es=Si.la>>4+fr,yr=0;2>yr;++yr){for(Nr=1&es,Kr=0;2>Kr;++Kr)Mr=Nr+(1&Cr),Cr=Cr>>1|(Nr=0<(Mr=Cs(Rt,Dt[2],Mr,Vt.Qc,0,ht,_i)))<<3,ji=ji<<2|(3<Mr?3:1<Mr?2:ht[_i+0]!=0),_i+=16;Cr>>=2,es=es>>1|Nr<<5}Ti|=ji<<4*fr,rn|=Cr<<4<<fr,Ur|=(240&es)<<fr}bt.la=rn,Si.la=Ur,hi.Hc=Yi,hi.Gc=Ti,hi.ia=43690&Ti?0:Vt.ia,Dt=!(Yi|Ti)}if(0<Qe.L&&(Qe.wa[Qe.Y+Qe.ja]=Qe.gd[Ke.$b][Ke.Za],Qe.wa[Qe.Y+Qe.ja].La|=!Dt),pt.Ka)return Wi(Le,7,"Premature end-of-file encountered.")}if(Fr(Le),Qe=rt,pt=1,Ke=(Re=Le).D,bt=0<Re.L&&Re.M>=Re.zb&&Re.M<=Re.Va,Re.Aa==0)e:{if(Ke.M=Re.M,Ke.uc=bt,zl(Re,Ke),pt=1,Ke=(ji=Re.D).Nb,bt=(Ti=S[Re.L])*Re.R,Rt=Ti/2*Re.B,yr=16*Ke*Re.R,Kr=8*Ke*Re.B,Dt=Re.sa,hi=Re.ta-bt+yr,Vt=Re.qa,ht=Re.ra-Rt+Kr,_i=Re.Ha,Si=Re.Ia-Rt+Kr,es=(Cr=ji.M)==0,Yi=Cr>=Re.Va-1,Re.Aa==2&&zl(Re,ji),ji.uc)for(Nr=(Mr=Re).D.M,e(Mr.D.uc),ji=Mr.yb;ji<Mr.Hb;++ji){Ur=ji,rn=Nr;var pr=(_r=(_n=Mr).D).Nb;fr=_n.R;var _r=_r.wa[_r.Y+Ur],or=_n.sa,ln=_n.ta+16*pr*fr+16*Ur,qr=_r.dd,Wr=_r.tc;if(Wr!=0)if(e(3<=Wr),_n.L==1)0<Ur&&an(or,ln,fr,Wr+4),_r.La&&ya(or,ln,fr,Wr),0<rn&&Zr(or,ln,fr,Wr+4),_r.La&&Gn(or,ln,fr,Wr);else{var Mn=_n.B,$n=_n.qa,fl=_n.ra+8*pr*Mn+8*Ur,$r=_n.Ha,_n=_n.Ia+8*pr*Mn+8*Ur;pr=_r.ld,0<Ur&&(Pa(or,ln,fr,Wr+4,qr,pr),Fo($n,fl,$r,_n,Mn,Wr+4,qr,pr)),_r.La&&(ys(or,ln,fr,Wr,qr,pr),Ir($n,fl,$r,_n,Mn,Wr,qr,pr)),0<rn&&(ma(or,ln,fr,Wr+4,qr,pr),Tn($n,fl,$r,_n,Mn,Wr+4,qr,pr)),_r.La&&(hs(or,ln,fr,Wr,qr,pr),As($n,fl,$r,_n,Mn,Wr,qr,pr))}}if(Re.ia&&alert("todo:DitherRow"),Qe.put!=null){if(ji=16*Cr,Cr=16*(Cr+1),es?(Qe.y=Re.sa,Qe.O=Re.ta+yr,Qe.f=Re.qa,Qe.N=Re.ra+Kr,Qe.ea=Re.Ha,Qe.W=Re.Ia+Kr):(ji-=Ti,Qe.y=Dt,Qe.O=hi,Qe.f=Vt,Qe.N=ht,Qe.ea=_i,Qe.W=Si),Yi||(Cr-=Ti),Cr>Qe.o&&(Cr=Qe.o),Qe.F=null,Qe.J=null,Re.Fa!=null&&0<Re.Fa.length&&ji<Cr&&(Qe.J=da(Re,Qe,ji,Cr-ji),Qe.F=Re.mb,Qe.F==null&&Qe.F.length==0)){pt=Wi(Re,3,"Could not decode alpha data.");break e}ji<Qe.j&&(Ti=Qe.j-ji,ji=Qe.j,e(!(1&Ti)),Qe.O+=Re.R*Ti,Qe.N+=Re.B*(Ti>>1),Qe.W+=Re.B*(Ti>>1),Qe.F!=null&&(Qe.J+=Qe.width*Ti)),ji<Cr&&(Qe.O+=Qe.v,Qe.N+=Qe.v>>1,Qe.W+=Qe.v>>1,Qe.F!=null&&(Qe.J+=Qe.v),Qe.ka=ji-Qe.j,Qe.U=Qe.va-Qe.v,Qe.T=Cr-ji,pt=Qe.put(Qe))}Ke+1!=Re.Ic||Yi||(r(Re.sa,Re.ta-bt,Dt,hi+16*Re.R,bt),r(Re.qa,Re.ra-Rt,Vt,ht+8*Re.B,Rt),r(Re.Ha,Re.Ia-Rt,_i,Si+8*Re.B,Rt))}if(!pt)return Wi(Le,6,"Output aborted.")}return 1}(w,T)),T.bc!=null&&T.bc(T),R&=1}return R?(w.cb=0,R):0}function Or(w,T,R,j,Z){Z=w[T+R+32*j]+(Z>>3),w[T+R+32*j]=-256&Z?0>Z?0:255:Z}function Cn(w,T,R,j,Z,W){Or(w,T,0,R,j+Z),Or(w,T,1,R,j+W),Or(w,T,2,R,j-W),Or(w,T,3,R,j-Z)}function An(w){return(20091*w>>16)+w}function Hr(w,T,R,j){var Z,W=0,J=o(16);for(Z=0;4>Z;++Z){var ee=w[T+0]+w[T+8],ae=w[T+0]-w[T+8],fe=(35468*w[T+4]>>16)-An(w[T+12]),pe=An(w[T+4])+(35468*w[T+12]>>16);J[W+0]=ee+pe,J[W+1]=ae+fe,J[W+2]=ae-fe,J[W+3]=ee-pe,W+=4,T++}for(Z=W=0;4>Z;++Z)ee=(w=J[W+0]+4)+J[W+8],ae=w-J[W+8],fe=(35468*J[W+4]>>16)-An(J[W+12]),Or(R,j,0,0,ee+(pe=An(J[W+4])+(35468*J[W+12]>>16))),Or(R,j,1,0,ae+fe),Or(R,j,2,0,ae-fe),Or(R,j,3,0,ee-pe),W++,j+=32}function Hs(w,T,R,j){var Z=w[T+0]+4,W=35468*w[T+4]>>16,J=An(w[T+4]),ee=35468*w[T+1]>>16;Cn(R,j,0,Z+J,w=An(w[T+1]),ee),Cn(R,j,1,Z+W,w,ee),Cn(R,j,2,Z-W,w,ee),Cn(R,j,3,Z-J,w,ee)}function ca(w,T,R,j,Z){Hr(w,T,R,j),Z&&Hr(w,T+16,R,j+4)}function uo(w,T,R,j){io(w,T+0,R,j,1),io(w,T+32,R,j+128,1)}function Ea(w,T,R,j){var Z;for(w=w[T+0]+4,Z=0;4>Z;++Z)for(T=0;4>T;++T)Or(R,j,T,Z,w)}function Ne(w,T,R,j){w[T+0]&&ro(w,T+0,R,j),w[T+16]&&ro(w,T+16,R,j+4),w[T+32]&&ro(w,T+32,R,j+128),w[T+48]&&ro(w,T+48,R,j+128+4)}function Ze(w,T,R,j){var Z,W=o(16);for(Z=0;4>Z;++Z){var J=w[T+0+Z]+w[T+12+Z],ee=w[T+4+Z]+w[T+8+Z],ae=w[T+4+Z]-w[T+8+Z],fe=w[T+0+Z]-w[T+12+Z];W[0+Z]=J+ee,W[8+Z]=J-ee,W[4+Z]=fe+ae,W[12+Z]=fe-ae}for(Z=0;4>Z;++Z)J=(w=W[0+4*Z]+3)+W[3+4*Z],ee=W[1+4*Z]+W[2+4*Z],ae=W[1+4*Z]-W[2+4*Z],fe=w-W[3+4*Z],R[j+0]=J+ee>>3,R[j+16]=fe+ae>>3,R[j+32]=J-ee>>3,R[j+48]=fe-ae>>3,j+=64}function dt(w,T,R){var j,Z=T-32,W=no,J=255-w[Z-1];for(j=0;j<R;++j){var ee,ae=W,fe=J+w[T-1];for(ee=0;ee<R;++ee)w[T+ee]=ae[fe+w[Z+ee]];T+=32}}function Ot(w,T){dt(w,T,4)}function ui(w,T){dt(w,T,8)}function Gi(w,T){dt(w,T,16)}function br(w,T){var R;for(R=0;16>R;++R)r(w,T+32*R,w,T-32,16)}function En(w,T){var R;for(R=16;0<R;--R)n(w,T,w[T-1],16),T+=32}function kn(w,T,R){var j;for(j=0;16>j;++j)n(T,R+32*j,w,16)}function is(w,T){var R,j=16;for(R=0;16>R;++R)j+=w[T-1+32*R]+w[T+R-32];kn(j>>5,w,T)}function wn(w,T){var R,j=8;for(R=0;16>R;++R)j+=w[T-1+32*R];kn(j>>4,w,T)}function iu(w,T){var R,j=8;for(R=0;16>R;++R)j+=w[T+R-32];kn(j>>4,w,T)}function Va(w,T){kn(128,w,T)}function Tr(w,T,R){return w+2*T+R+2>>2}function Ha(w,T){var R,j=T-32;for(j=new Uint8Array([Tr(w[j-1],w[j+0],w[j+1]),Tr(w[j+0],w[j+1],w[j+2]),Tr(w[j+1],w[j+2],w[j+3]),Tr(w[j+2],w[j+3],w[j+4])]),R=0;4>R;++R)r(w,T+32*R,j,0,j.length)}function Dl(w,T){var R=w[T-1],j=w[T-1+32],Z=w[T-1+64],W=w[T-1+96];Ht(w,T+0,16843009*Tr(w[T-1-32],R,j)),Ht(w,T+32,16843009*Tr(R,j,Z)),Ht(w,T+64,16843009*Tr(j,Z,W)),Ht(w,T+96,16843009*Tr(Z,W,W))}function Jn(w,T){var R,j=4;for(R=0;4>R;++R)j+=w[T+R-32]+w[T-1+32*R];for(j>>=3,R=0;4>R;++R)n(w,T+32*R,j,4)}function To(w,T){var R=w[T-1+0],j=w[T-1+32],Z=w[T-1+64],W=w[T-1-32],J=w[T+0-32],ee=w[T+1-32],ae=w[T+2-32],fe=w[T+3-32];w[T+0+96]=Tr(j,Z,w[T-1+96]),w[T+1+96]=w[T+0+64]=Tr(R,j,Z),w[T+2+96]=w[T+1+64]=w[T+0+32]=Tr(W,R,j),w[T+3+96]=w[T+2+64]=w[T+1+32]=w[T+0+0]=Tr(J,W,R),w[T+3+64]=w[T+2+32]=w[T+1+0]=Tr(ee,J,W),w[T+3+32]=w[T+2+0]=Tr(ae,ee,J),w[T+3+0]=Tr(fe,ae,ee)}function Ga(w,T){var R=w[T+1-32],j=w[T+2-32],Z=w[T+3-32],W=w[T+4-32],J=w[T+5-32],ee=w[T+6-32],ae=w[T+7-32];w[T+0+0]=Tr(w[T+0-32],R,j),w[T+1+0]=w[T+0+32]=Tr(R,j,Z),w[T+2+0]=w[T+1+32]=w[T+0+64]=Tr(j,Z,W),w[T+3+0]=w[T+2+32]=w[T+1+64]=w[T+0+96]=Tr(Z,W,J),w[T+3+32]=w[T+2+64]=w[T+1+96]=Tr(W,J,ee),w[T+3+64]=w[T+2+96]=Tr(J,ee,ae),w[T+3+96]=Tr(ee,ae,ae)}function gs(w,T){var R=w[T-1+0],j=w[T-1+32],Z=w[T-1+64],W=w[T-1-32],J=w[T+0-32],ee=w[T+1-32],ae=w[T+2-32],fe=w[T+3-32];w[T+0+0]=w[T+1+64]=W+J+1>>1,w[T+1+0]=w[T+2+64]=J+ee+1>>1,w[T+2+0]=w[T+3+64]=ee+ae+1>>1,w[T+3+0]=ae+fe+1>>1,w[T+0+96]=Tr(Z,j,R),w[T+0+64]=Tr(j,R,W),w[T+0+32]=w[T+1+96]=Tr(R,W,J),w[T+1+32]=w[T+2+96]=Tr(W,J,ee),w[T+2+32]=w[T+3+96]=Tr(J,ee,ae),w[T+3+32]=Tr(ee,ae,fe)}function ua(w,T){var R=w[T+0-32],j=w[T+1-32],Z=w[T+2-32],W=w[T+3-32],J=w[T+4-32],ee=w[T+5-32],ae=w[T+6-32],fe=w[T+7-32];w[T+0+0]=R+j+1>>1,w[T+1+0]=w[T+0+64]=j+Z+1>>1,w[T+2+0]=w[T+1+64]=Z+W+1>>1,w[T+3+0]=w[T+2+64]=W+J+1>>1,w[T+0+32]=Tr(R,j,Z),w[T+1+32]=w[T+0+96]=Tr(j,Z,W),w[T+2+32]=w[T+1+96]=Tr(Z,W,J),w[T+3+32]=w[T+2+96]=Tr(W,J,ee),w[T+3+64]=Tr(J,ee,ae),w[T+3+96]=Tr(ee,ae,fe)}function ja(w,T){var R=w[T-1+0],j=w[T-1+32],Z=w[T-1+64],W=w[T-1+96];w[T+0+0]=R+j+1>>1,w[T+2+0]=w[T+0+32]=j+Z+1>>1,w[T+2+32]=w[T+0+64]=Z+W+1>>1,w[T+1+0]=Tr(R,j,Z),w[T+3+0]=w[T+1+32]=Tr(j,Z,W),w[T+3+32]=w[T+1+64]=Tr(Z,W,W),w[T+3+64]=w[T+2+64]=w[T+0+96]=w[T+1+96]=w[T+2+96]=w[T+3+96]=W}function Sa(w,T){var R=w[T-1+0],j=w[T-1+32],Z=w[T-1+64],W=w[T-1+96],J=w[T-1-32],ee=w[T+0-32],ae=w[T+1-32],fe=w[T+2-32];w[T+0+0]=w[T+2+32]=R+J+1>>1,w[T+0+32]=w[T+2+64]=j+R+1>>1,w[T+0+64]=w[T+2+96]=Z+j+1>>1,w[T+0+96]=W+Z+1>>1,w[T+3+0]=Tr(ee,ae,fe),w[T+2+0]=Tr(J,ee,ae),w[T+1+0]=w[T+3+32]=Tr(R,J,ee),w[T+1+32]=w[T+3+64]=Tr(j,R,J),w[T+1+64]=w[T+3+96]=Tr(Z,j,R),w[T+1+96]=Tr(W,Z,j)}function Ic(w,T){var R;for(R=0;8>R;++R)r(w,T+32*R,w,T-32,8)}function qa(w,T){var R;for(R=0;8>R;++R)n(w,T,w[T-1],8),T+=32}function ho(w,T,R){var j;for(j=0;8>j;++j)n(T,R+32*j,w,8)}function Pr(w,T){var R,j=8;for(R=0;8>R;++R)j+=w[T+R-32]+w[T-1+32*R];ho(j>>4,w,T)}function ha(w,T){var R,j=4;for(R=0;8>R;++R)j+=w[T+R-32];ho(j>>3,w,T)}function us(w,T){var R,j=4;for(R=0;8>R;++R)j+=w[T-1+32*R];ho(j>>3,w,T)}function dn(w,T){ho(128,w,T)}function rs(w,T,R){var j=w[T-R],Z=w[T+0],W=3*(Z-j)+Gl[1020+w[T-2*R]-w[T+R]],J=Ei[112+(W+4>>3)];w[T-R]=no[255+j+Ei[112+(W+3>>3)]],w[T+0]=no[255+Z-J]}function Vr(w,T,R,j){var Z=w[T+0],W=w[T+R];return mo[255+w[T-2*R]-w[T-R]]>j||mo[255+W-Z]>j}function $a(w,T,R,j){return 4*mo[255+w[T-R]-w[T+0]]+mo[255+w[T-2*R]-w[T+R]]<=j}function nl(w,T,R,j,Z){var W=w[T-3*R],J=w[T-2*R],ee=w[T-R],ae=w[T+0],fe=w[T+R],pe=w[T+2*R],xe=w[T+3*R];return 4*mo[255+ee-ae]+mo[255+J-fe]>j?0:mo[255+w[T-4*R]-W]<=Z&&mo[255+W-J]<=Z&&mo[255+J-ee]<=Z&&mo[255+xe-pe]<=Z&&mo[255+pe-fe]<=Z&&mo[255+fe-ae]<=Z}function Rl(w,T,R,j){var Z=2*j+1;for(j=0;16>j;++j)$a(w,T+j,R,Z)&&rs(w,T+j,R)}function Io(w,T,R,j){var Z=2*j+1;for(j=0;16>j;++j)$a(w,T+j*R,1,Z)&&rs(w,T+j*R,1)}function Ko(w,T,R,j){var Z;for(Z=3;0<Z;--Z)Rl(w,T+=4*R,R,j)}function cc(w,T,R,j){var Z;for(Z=3;0<Z;--Z)Io(w,T+=4,R,j)}function Wo(w,T,R,j,Z,W,J,ee){for(W=2*W+1;0<Z--;){if(nl(w,T,R,W,J))if(Vr(w,T,R,ee))rs(w,T,R);else{var ae=w,fe=T,pe=R,xe=ae[fe-2*pe],Pe=ae[fe-pe],Le=ae[fe+0],rt=ae[fe+pe],Ke=ae[fe+2*pe],Re=27*(pt=Gl[1020+3*(Le-Pe)+Gl[1020+xe-rt]])+63>>7,Qe=18*pt+63>>7,pt=9*pt+63>>7;ae[fe-3*pe]=no[255+ae[fe-3*pe]+pt],ae[fe-2*pe]=no[255+xe+Qe],ae[fe-pe]=no[255+Pe+Re],ae[fe+0]=no[255+Le-Re],ae[fe+pe]=no[255+rt-Qe],ae[fe+2*pe]=no[255+Ke-pt]}T+=j}}function Ao(w,T,R,j,Z,W,J,ee){for(W=2*W+1;0<Z--;){if(nl(w,T,R,W,J))if(Vr(w,T,R,ee))rs(w,T,R);else{var ae=w,fe=T,pe=R,xe=ae[fe-pe],Pe=ae[fe+0],Le=ae[fe+pe],rt=Ei[112+((Ke=3*(Pe-xe))+4>>3)],Ke=Ei[112+(Ke+3>>3)],Re=rt+1>>1;ae[fe-2*pe]=no[255+ae[fe-2*pe]+Re],ae[fe-pe]=no[255+xe+Ke],ae[fe+0]=no[255+Pe-rt],ae[fe+pe]=no[255+Le-Re]}T+=j}}function uc(w,T,R,j,Z,W){Wo(w,T,R,1,16,j,Z,W)}function Xo(w,T,R,j,Z,W){Wo(w,T,1,R,16,j,Z,W)}function kl(w,T,R,j,Z,W){var J;for(J=3;0<J;--J)Ao(w,T+=4*R,R,1,16,j,Z,W)}function Lc(w,T,R,j,Z,W){var J;for(J=3;0<J;--J)Ao(w,T+=4,1,R,16,j,Z,W)}function Ah(w,T,R,j,Z,W,J,ee){Wo(w,T,Z,1,8,W,J,ee),Wo(R,j,Z,1,8,W,J,ee)}function ru(w,T,R,j,Z,W,J,ee){Wo(w,T,1,Z,8,W,J,ee),Wo(R,j,1,Z,8,W,J,ee)}function nu(w,T,R,j,Z,W,J,ee){Ao(w,T+4*Z,Z,1,8,W,J,ee),Ao(R,j+4*Z,Z,1,8,W,J,ee)}function Iu(w,T,R,j,Z,W,J,ee){Ao(w,T+4,1,Z,8,W,J,ee),Ao(R,j+4,1,Z,8,W,J,ee)}function Ol(){this.ba=new Sr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new we,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ka(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Wa(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Ul(){this.ua=0,this.Wa=new ot,this.vb=new ot,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new We,this.yc=new Fe}function Xa(){this.xb=this.a=0,this.l=new So,this.ca=new Sr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Ee,this.Pb=0,this.wd=new Ee,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Ul,this.ab=0,this.gc=c(4,Wa),this.Oc=0}function Aa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new So,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function sl(w,T,R,j,Z,W,J){for(w=w==null?0:w[T+0],T=0;T<J;++T)Z[W+T]=w+R[j+T]&255,w=Z[W+T]}function Nl(w,T,R,j,Z,W,J){var ee;if(w==null)sl(null,null,R,j,Z,W,J);else for(ee=0;ee<J;++ee)Z[W+ee]=w[T+ee]+R[j+ee]&255}function Ys(w,T,R,j,Z,W,J){if(w==null)sl(null,null,R,j,Z,W,J);else{var ee,ae=w[T+0],fe=ae,pe=ae;for(ee=0;ee<J;++ee)fe=pe+(ae=w[T+ee])-fe,pe=R[j+ee]+(-256&fe?0>fe?0:255:fe)&255,fe=ae,Z[W+ee]=pe}}function da(w,T,R,j){var Z=T.width,W=T.o;if(e(w!=null&&T!=null),0>R||0>=j||R+j>W)return null;if(!w.Cc){if(w.ga==null){var J;if(w.ga=new Aa,(J=w.ga==null)||(J=T.width*T.o,e(w.Gb.length==0),w.Gb=o(J),w.Uc=0,w.Gb==null?J=0:(w.mb=w.Gb,w.nb=w.Uc,w.rc=null,J=1),J=!J),!J){J=w.ga;var ee=w.Fa,ae=w.P,fe=w.qc,pe=w.mb,xe=w.nb,Pe=ae+1,Le=fe-1,rt=J.l;if(e(ee!=null&&pe!=null&&T!=null),Rs[0]=null,Rs[1]=sl,Rs[2]=Nl,Rs[3]=Ys,J.ca=pe,J.tb=xe,J.c=T.width,J.i=T.height,e(0<J.c&&0<J.i),1>=fe)T=0;else if(J.$a=ee[ae+0]>>0&3,J.Z=ee[ae+0]>>2&3,J.Lc=ee[ae+0]>>4&3,ae=ee[ae+0]>>6&3,0>J.$a||1<J.$a||4<=J.Z||1<J.Lc||ae)T=0;else if(rt.put=_e,rt.ac=ge,rt.bc=Ce,rt.ma=J,rt.width=T.width,rt.height=T.height,rt.Da=T.Da,rt.v=T.v,rt.va=T.va,rt.j=T.j,rt.o=T.o,J.$a)e:{e(J.$a==1),T=wi();t:for(;;){if(T==null){T=0;break e}if(e(J!=null),J.mc=T,T.c=J.c,T.i=J.i,T.l=J.l,T.l.ma=J,T.l.width=J.c,T.l.height=J.i,T.a=0,_t(T.m,ee,Pe,Le),!Ui(J.c,J.i,1,T,null)||(T.ab==1&&T.gc[0].hc==3&&qt(T.s)?(J.ic=1,ee=T.c*T.i,T.Ta=null,T.Ua=0,T.V=o(ee),T.Ba=0,T.V==null?(T.a=1,T=0):T=1):(J.ic=0,T=st(T,J.c)),!T))break t;T=1;break e}J.mc=null,T=0}else T=Le>=J.c*J.i;J=!T}if(J)return null;w.ga.Lc!=1?w.Ga=0:j=W-R}e(w.ga!=null),e(R+j<=W);e:{if(T=(ee=w.ga).c,W=ee.l.o,ee.$a==0){if(Pe=w.rc,Le=w.Vc,rt=w.Fa,ae=w.P+1+R*T,fe=w.mb,pe=w.nb+R*T,e(ae<=w.P+w.qc),ee.Z!=0)for(e(Rs[ee.Z]!=null),J=0;J<j;++J)Rs[ee.Z](Pe,Le,rt,ae,fe,pe,T),Pe=fe,Le=pe,pe+=T,ae+=T;else for(J=0;J<j;++J)r(fe,pe,rt,ae,T),Pe=fe,Le=pe,pe+=T,ae+=T;w.rc=Pe,w.Vc=Le}else{if(e(ee.mc!=null),T=R+j,e((J=ee.mc)!=null),e(T<=J.i),J.C>=T)T=1;else if(ee.ic||vt(),ee.ic){ee=J.V,Pe=J.Ba,Le=J.c;var Ke=J.i,Re=(rt=1,ae=J.$/Le,fe=J.$%Le,pe=J.m,xe=J.s,J.$),Qe=Le*Ke,pt=Le*T,bt=xe.wc,ht=Re<pt?yt(xe,fe,ae):null;e(Re<=Qe),e(T<=Ke),e(qt(xe));t:for(;;){for(;!pe.h&&Re<pt;){if(fe&bt||(ht=yt(xe,fe,ae)),e(ht!=null),ft(pe),256>(Ke=Ve(ht.G[0],ht.H[0],pe)))ee[Pe+Re]=Ke,++Re,++fe>=Le&&(fe=0,++ae<=T&&!(ae%16)&&si(J,ae));else{if(!(280>Ke)){rt=0;break t}Ke=Me(Ke-256,pe);var Rt,Dt=Ve(ht.G[4],ht.H[4],pe);if(ft(pe),!(Re>=(Dt=Oe(Le,Dt=Me(Dt,pe)))&&Qe-Re>=Ke)){rt=0;break t}for(Rt=0;Rt<Ke;++Rt)ee[Pe+Re+Rt]=ee[Pe+Re+Rt-Dt];for(Re+=Ke,fe+=Ke;fe>=Le;)fe-=Le,++ae<=T&&!(ae%16)&&si(J,ae);Re<pt&&fe&bt&&(ht=yt(xe,fe,ae))}e(pe.h==et(pe))}si(J,ae>T?T:ae);break t}!rt||pe.h&&Re<Qe?(rt=0,J.a=pe.h?5:3):J.$=Re,T=rt}else T=Ci(J,J.V,J.Ba,J.c,J.i,T,ti);if(!T){j=0;break e}}R+j>=W&&(w.Cc=1),j=1}if(!j)return null;if(w.Cc&&((j=w.ga)!=null&&(j.mc=null),w.ga=null,0<w.Ga))return alert("todo:WebPDequantizeLevels"),null}return w.nb+R*Z}function re(w,T,R,j,Z,W){for(;0<Z--;){var J,ee=w,ae=T+(R?1:0),fe=w,pe=T+(R?0:3);for(J=0;J<j;++J){var xe=fe[pe+4*J];xe!=255&&(xe*=32897,ee[ae+4*J+0]=ee[ae+4*J+0]*xe>>23,ee[ae+4*J+1]=ee[ae+4*J+1]*xe>>23,ee[ae+4*J+2]=ee[ae+4*J+2]*xe>>23)}T+=W}}function Ie(w,T,R,j,Z){for(;0<j--;){var W;for(W=0;W<R;++W){var J=w[T+2*W+0],ee=15&(fe=w[T+2*W+1]),ae=4369*ee,fe=(240&fe|fe>>4)*ae>>16;w[T+2*W+0]=(240&J|J>>4)*ae>>16&240|(15&J|J<<4)*ae>>16>>4&15,w[T+2*W+1]=240&fe|ee}T+=Z}}function at(w,T,R,j,Z,W,J,ee){var ae,fe,pe=255;for(fe=0;fe<Z;++fe){for(ae=0;ae<j;++ae){var xe=w[T+ae];W[J+4*ae]=xe,pe&=xe}T+=R,J+=ee}return pe!=255}function mt(w,T,R,j,Z){var W;for(W=0;W<Z;++W)R[j+W]=w[T+W]>>8}function vt(){Fa=re,go=Ie,Zo=at,Oi=mt}function Tt(w,T,R){Ue[w]=function(j,Z,W,J,ee,ae,fe,pe,xe,Pe,Le,rt,Ke,Re,Qe,pt,bt){var ht,Rt=bt-1>>1,Dt=ee[ae+0]|fe[pe+0]<<16,hi=xe[Pe+0]|Le[rt+0]<<16;e(j!=null);var Vt=3*Dt+hi+131074>>2;for(T(j[Z+0],255&Vt,Vt>>16,Ke,Re),W!=null&&(Vt=3*hi+Dt+131074>>2,T(W[J+0],255&Vt,Vt>>16,Qe,pt)),ht=1;ht<=Rt;++ht){var _i=ee[ae+ht]|fe[pe+ht]<<16,Si=xe[Pe+ht]|Le[rt+ht]<<16,Yi=Dt+_i+hi+Si+524296,Ti=Yi+2*(_i+hi)>>3;Vt=Ti+Dt>>1,Dt=(Yi=Yi+2*(Dt+Si)>>3)+_i>>1,T(j[Z+2*ht-1],255&Vt,Vt>>16,Ke,Re+(2*ht-1)*R),T(j[Z+2*ht-0],255&Dt,Dt>>16,Ke,Re+(2*ht-0)*R),W!=null&&(Vt=Yi+hi>>1,Dt=Ti+Si>>1,T(W[J+2*ht-1],255&Vt,Vt>>16,Qe,pt+(2*ht-1)*R),T(W[J+2*ht+0],255&Dt,Dt>>16,Qe,pt+(2*ht+0)*R)),Dt=_i,hi=Si}1&bt||(Vt=3*Dt+hi+131074>>2,T(j[Z+bt-1],255&Vt,Vt>>16,Ke,Re+(bt-1)*R),W!=null&&(Vt=3*hi+Dt+131074>>2,T(W[J+bt-1],255&Vt,Vt>>16,Qe,pt+(bt-1)*R)))}}function pi(){Jr[Mc]=Un,Jr[jl]=Al,Jr[Pc]=ko,Jr[Fc]=Ja,Jr[Dc]=Da,Jr[Rc]=Kl,Jr[Za]=lu,Jr[yn]=Al,Jr[Bs]=Ja,Jr[Do]=Da,Jr[ql]=Kl}function ri(w){return w&~A?0>w?0:255:w>>N}function rr(w,T){return ri((19077*w>>8)+(26149*T>>8)-14234)}function qi(w,T,R){return ri((19077*w>>8)-(6419*T>>8)-(13320*R>>8)+8708)}function ki(w,T){return ri((19077*w>>8)+(33050*T>>8)-17685)}function jr(w,T,R,j,Z){j[Z+0]=rr(w,R),j[Z+1]=qi(w,T,R),j[Z+2]=ki(w,T)}function nr(w,T,R,j,Z){j[Z+0]=ki(w,T),j[Z+1]=qi(w,T,R),j[Z+2]=rr(w,R)}function Hn(w,T,R,j,Z){var W=qi(w,T,R);T=W<<3&224|ki(w,T)>>3,j[Z+0]=248&rr(w,R)|W>>5,j[Z+1]=T}function Br(w,T,R,j,Z){var W=240&ki(w,T)|15;j[Z+0]=240&rr(w,R)|qi(w,T,R)>>4,j[Z+1]=W}function Lr(w,T,R,j,Z){j[Z+0]=255,jr(w,T,R,j,Z+1)}function On(w,T,R,j,Z){nr(w,T,R,j,Z),j[Z+3]=255}function qs(w,T,R,j,Z){jr(w,T,R,j,Z),j[Z+3]=255}function eo(w,T){return 0>w?0:w>T?T:w}function Lo(w,T,R){Ue[w]=function(j,Z,W,J,ee,ae,fe,pe,xe){for(var Pe=pe+(-2&xe)*R;pe!=Pe;)T(j[Z+0],W[J+0],ee[ae+0],fe,pe),T(j[Z+1],W[J+0],ee[ae+0],fe,pe+R),Z+=2,++J,++ae,pe+=2*R;1&xe&&T(j[Z+0],W[J+0],ee[ae+0],fe,pe)}}function Ta(w,T,R){return R==0?w==0?T==0?6:5:T==0?4:0:R}function fa(w,T,R,j,Z){switch(w>>>30){case 3:io(T,R,j,Z,0);break;case 2:po(T,R,j,Z);break;case 1:ro(T,R,j,Z)}}function zl(w,T){var R,j,Z=T.M,W=T.Nb,J=w.oc,ee=w.pc+40,ae=w.oc,fe=w.pc+584,pe=w.oc,xe=w.pc+600;for(R=0;16>R;++R)J[ee+32*R-1]=129;for(R=0;8>R;++R)ae[fe+32*R-1]=129,pe[xe+32*R-1]=129;for(0<Z?J[ee-1-32]=ae[fe-1-32]=pe[xe-1-32]=129:(n(J,ee-32-1,127,21),n(ae,fe-32-1,127,9),n(pe,xe-32-1,127,9)),j=0;j<w.za;++j){var Pe=T.ya[T.aa+j];if(0<j){for(R=-1;16>R;++R)r(J,ee+32*R-4,J,ee+32*R+12,4);for(R=-1;8>R;++R)r(ae,fe+32*R-4,ae,fe+32*R+4,4),r(pe,xe+32*R-4,pe,xe+32*R+4,4)}var Le=w.Gd,rt=w.Hd+j,Ke=Pe.ad,Re=Pe.Hc;if(0<Z&&(r(J,ee-32,Le[rt].y,0,16),r(ae,fe-32,Le[rt].f,0,8),r(pe,xe-32,Le[rt].ea,0,8)),Pe.Za){var Qe=J,pt=ee-32+16;for(0<Z&&(j>=w.za-1?n(Qe,pt,Le[rt].y[15],4):r(Qe,pt,Le[rt+1].y,0,4)),R=0;4>R;R++)Qe[pt+128+R]=Qe[pt+256+R]=Qe[pt+384+R]=Qe[pt+0+R];for(R=0;16>R;++R,Re<<=2)Qe=J,pt=ee+B[R],tn[Pe.Ob[R]](Qe,pt),fa(Re,Ke,16*+R,Qe,pt)}else if(Qe=Ta(j,Z,Pe.Ob[0]),Ds[Qe](J,ee),Re!=0)for(R=0;16>R;++R,Re<<=2)fa(Re,Ke,16*+R,J,ee+B[R]);for(R=Pe.Gc,Qe=Ta(j,Z,Pe.Dd),Yo[Qe](ae,fe),Yo[Qe](pe,xe),Re=Ke,Qe=ae,pt=fe,255&(Pe=R>>0)&&(170&Pe?ms(Re,256,Qe,pt):Ma(Re,256,Qe,pt)),Pe=pe,Re=xe,255&(R>>=8)&&(170&R?ms(Ke,320,Pe,Re):Ma(Ke,320,Pe,Re)),Z<w.Ub-1&&(r(Le[rt].y,0,J,ee+480,16),r(Le[rt].f,0,ae,fe+224,8),r(Le[rt].ea,0,pe,xe+224,8)),R=8*W*w.B,Le=w.sa,rt=w.ta+16*j+16*W*w.R,Ke=w.qa,Pe=w.ra+8*j+R,Re=w.Ha,Qe=w.Ia+8*j+R,R=0;16>R;++R)r(Le,rt+R*w.R,J,ee+32*R,16);for(R=0;8>R;++R)r(Ke,Pe+R*w.B,ae,fe+32*R,8),r(Re,Qe+R*w.B,pe,xe+32*R,8)}}function ol(w,T,R,j,Z,W,J,ee,ae){var fe=[0],pe=[0],xe=0,Pe=ae!=null?ae.kd:0,Le=ae??new Ka;if(w==null||12>R)return 7;Le.data=w,Le.w=T,Le.ha=R,T=[T],R=[R],Le.gb=[Le.gb];e:{var rt=T,Ke=R,Re=Le.gb;if(e(w!=null),e(Ke!=null),e(Re!=null),Re[0]=0,12<=Ke[0]&&!t(w,rt[0],"RIFF")){if(t(w,rt[0]+8,"WEBP")){Re=3;break e}var Qe=mi(w,rt[0]+4);if(12>Qe||4294967286<Qe){Re=3;break e}if(Pe&&Qe>Ke[0]-8){Re=7;break e}Re[0]=Qe,rt[0]+=12,Ke[0]-=12}Re=0}if(Re!=0)return Re;for(Qe=0<Le.gb[0],R=R[0];;){e:{var pt=w;Ke=T,Re=R;var bt=fe,ht=pe,Rt=rt=[0];if((Vt=xe=[xe])[0]=0,8>Re[0])Re=7;else{if(!t(pt,Ke[0],"VP8X")){if(mi(pt,Ke[0]+4)!=10){Re=3;break e}if(18>Re[0]){Re=7;break e}var Dt=mi(pt,Ke[0]+8),hi=1+gi(pt,Ke[0]+12);if(2147483648<=hi*(pt=1+gi(pt,Ke[0]+15))){Re=3;break e}Rt!=null&&(Rt[0]=Dt),bt!=null&&(bt[0]=hi),ht!=null&&(ht[0]=pt),Ke[0]+=18,Re[0]-=18,Vt[0]=1}Re=0}}if(xe=xe[0],rt=rt[0],Re!=0)return Re;if(Ke=!!(2&rt),!Qe&&xe)return 3;if(W!=null&&(W[0]=!!(16&rt)),J!=null&&(J[0]=Ke),ee!=null&&(ee[0]=0),J=fe[0],rt=pe[0],xe&&Ke&&ae==null){Re=0;break}if(4>R){Re=7;break}if(Qe&&xe||!Qe&&!xe&&!t(w,T[0],"ALPH")){R=[R],Le.na=[Le.na],Le.P=[Le.P],Le.Sa=[Le.Sa];e:{Dt=w,Re=T,Qe=R;var Vt=Le.gb;bt=Le.na,ht=Le.P,Rt=Le.Sa,hi=22,e(Dt!=null),e(Qe!=null),pt=Re[0];var _i=Qe[0];for(e(bt!=null),e(Rt!=null),bt[0]=null,ht[0]=null,Rt[0]=0;;){if(Re[0]=pt,Qe[0]=_i,8>_i){Re=7;break e}var Si=mi(Dt,pt+4);if(4294967286<Si){Re=3;break e}var Yi=8+Si+1&-2;if(hi+=Yi,0<Vt&&hi>Vt){Re=3;break e}if(!t(Dt,pt,"VP8 ")||!t(Dt,pt,"VP8L")){Re=0;break e}if(_i[0]<Yi){Re=7;break e}t(Dt,pt,"ALPH")||(bt[0]=Dt,ht[0]=pt+8,Rt[0]=Si),pt+=Yi,_i-=Yi}}if(R=R[0],Le.na=Le.na[0],Le.P=Le.P[0],Le.Sa=Le.Sa[0],Re!=0)break}R=[R],Le.Ja=[Le.Ja],Le.xa=[Le.xa];e:if(Vt=w,Re=T,Qe=R,bt=Le.gb[0],ht=Le.Ja,Rt=Le.xa,Dt=Re[0],pt=!t(Vt,Dt,"VP8 "),hi=!t(Vt,Dt,"VP8L"),e(Vt!=null),e(Qe!=null),e(ht!=null),e(Rt!=null),8>Qe[0])Re=7;else{if(pt||hi){if(Vt=mi(Vt,Dt+4),12<=bt&&Vt>bt-12){Re=3;break e}if(Pe&&Vt>Qe[0]-8){Re=7;break e}ht[0]=Vt,Re[0]+=8,Qe[0]-=8,Rt[0]=hi}else Rt[0]=5<=Qe[0]&&Vt[Dt+0]==47&&!(Vt[Dt+4]>>5),ht[0]=Qe[0];Re=0}if(R=R[0],Le.Ja=Le.Ja[0],Le.xa=Le.xa[0],T=T[0],Re!=0)break;if(4294967286<Le.Ja)return 3;if(ee==null||Ke||(ee[0]=Le.xa?2:1),J=[J],rt=[rt],Le.xa){if(5>R){Re=7;break}ee=J,Pe=rt,Ke=W,w==null||5>R?w=0:5<=R&&w[T+0]==47&&!(w[T+4]>>5)?(Qe=[0],Vt=[0],bt=[0],_t(ht=new Ee,w,T,R),ve(ht,Qe,Vt,bt)?(ee!=null&&(ee[0]=Qe[0]),Pe!=null&&(Pe[0]=Vt[0]),Ke!=null&&(Ke[0]=bt[0]),w=1):w=0):w=0}else{if(10>R){Re=7;break}ee=rt,w==null||10>R||!Js(w,T+3,R-3)?w=0:(Pe=w[T+0]|w[T+1]<<8|w[T+2]<<16,Ke=16383&(w[T+7]<<8|w[T+6]),w=16383&(w[T+9]<<8|w[T+8]),1&Pe||3<(Pe>>1&7)||!(Pe>>4&1)||Pe>>5>=Le.Ja||!Ke||!w?w=0:(J&&(J[0]=Ke),ee&&(ee[0]=w),w=1))}if(!w||(J=J[0],rt=rt[0],xe&&(fe[0]!=J||pe[0]!=rt)))return 3;ae!=null&&(ae[0]=Le,ae.offset=T-ae.w,e(4294967286>T-ae.w),e(ae.offset==ae.ha-R));break}return Re==0||Re==7&&xe&&ae==null?(W!=null&&(W[0]|=Le.na!=null&&0<Le.na.length),j!=null&&(j[0]=J),Z!=null&&(Z[0]=rt),0):Re}function Ql(w,T,R){var j=T.width,Z=T.height,W=0,J=0,ee=j,ae=Z;if(T.Da=w!=null&&0<w.Da,T.Da&&(ee=w.cd,ae=w.bd,W=w.v,J=w.j,11>R||(W&=-2,J&=-2),0>W||0>J||0>=ee||0>=ae||W+ee>j||J+ae>Z))return 0;if(T.v=W,T.j=J,T.va=W+ee,T.o=J+ae,T.U=ee,T.T=ae,T.da=w!=null&&0<w.da,T.da){if(!xt(ee,ae,R=[w.ib],W=[w.hb]))return 0;T.ib=R[0],T.hb=W[0]}return T.ob=w!=null&&w.ob,T.Kb=w==null||!w.Sd,T.da&&(T.ob=T.ib<3*j/4&&T.hb<3*Z/4,T.Kb=0),1}function hc(w){if(w==null)return 2;if(11>w.S){var T=w.f.RGBA;T.fb+=(w.height-1)*T.A,T.A=-T.A}else T=w.f.kb,w=w.height,T.O+=(w-1)*T.fa,T.fa=-T.fa,T.N+=(w-1>>1)*T.Ab,T.Ab=-T.Ab,T.W+=(w-1>>1)*T.Db,T.Db=-T.Db,T.F!=null&&(T.J+=(w-1)*T.lb,T.lb=-T.lb);return 0}function pa(w,T,R,j){if(j==null||0>=w||0>=T)return 2;if(R!=null){if(R.Da){var Z=R.cd,W=R.bd,J=-2&R.v,ee=-2&R.j;if(0>J||0>ee||0>=Z||0>=W||J+Z>w||ee+W>T)return 2;w=Z,T=W}if(R.da){if(!xt(w,T,Z=[R.ib],W=[R.hb]))return 2;w=Z[0],T=W[0]}}j.width=w,j.height=T;e:{var ae=j.width,fe=j.height;if(w=j.S,0>=ae||0>=fe||!(w>=Mc&&13>w))w=2;else{if(0>=j.Rd&&j.sd==null){J=W=Z=T=0;var pe=(ee=ae*q[w])*fe;if(11>w||(W=(fe+1)/2*(T=(ae+1)/2),w==12&&(J=(Z=ae)*fe)),(fe=o(pe+2*W+J))==null){w=1;break e}j.sd=fe,11>w?((ae=j.f.RGBA).eb=fe,ae.fb=0,ae.A=ee,ae.size=pe):((ae=j.f.kb).y=fe,ae.O=0,ae.fa=ee,ae.Fd=pe,ae.f=fe,ae.N=0+pe,ae.Ab=T,ae.Cd=W,ae.ea=fe,ae.W=0+pe+W,ae.Db=T,ae.Ed=W,w==12&&(ae.F=fe,ae.J=0+pe+2*W),ae.Tc=J,ae.lb=Z)}if(T=1,Z=j.S,W=j.width,J=j.height,Z>=Mc&&13>Z)if(11>Z)w=j.f.RGBA,T&=(ee=Math.abs(w.A))*(J-1)+W<=w.size,T&=ee>=W*q[Z],T&=w.eb!=null;else{w=j.f.kb,ee=(W+1)/2,pe=(J+1)/2,ae=Math.abs(w.fa),fe=Math.abs(w.Ab);var xe=Math.abs(w.Db),Pe=Math.abs(w.lb),Le=Pe*(J-1)+W;T&=ae*(J-1)+W<=w.Fd,T&=fe*(pe-1)+ee<=w.Cd,T=(T&=xe*(pe-1)+ee<=w.Ed)&ae>=W&fe>=ee&xe>=ee,T&=w.y!=null,T&=w.f!=null,T&=w.ea!=null,Z==12&&(T&=Pe>=W,T&=Le<=w.Tc,T&=w.F!=null)}else T=0;w=T?0:2}}return w!=0||R!=null&&R.fd&&(w=hc(j)),w}var Ps=64,al=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Vl=24,Ia=32,La=8,Fs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ut("Predictor0","PredictorAdd0"),Ue.Predictor0=function(){return 4278190080},Ue.Predictor1=function(w){return w},Ue.Predictor2=function(w,T,R){return T[R+0]},Ue.Predictor3=function(w,T,R){return T[R+1]},Ue.Predictor4=function(w,T,R){return T[R-1]},Ue.Predictor5=function(w,T,R){return ni(ni(w,T[R+1]),T[R+0])},Ue.Predictor6=function(w,T,R){return ni(w,T[R-1])},Ue.Predictor7=function(w,T,R){return ni(w,T[R+0])},Ue.Predictor8=function(w,T,R){return ni(T[R-1],T[R+0])},Ue.Predictor9=function(w,T,R){return ni(T[R+0],T[R+1])},Ue.Predictor10=function(w,T,R){return ni(ni(w,T[R-1]),ni(T[R+0],T[R+1]))},Ue.Predictor11=function(w,T,R){var j=T[R+0];return 0>=Ki(j>>24&255,w>>24&255,(T=T[R-1])>>24&255)+Ki(j>>16&255,w>>16&255,T>>16&255)+Ki(j>>8&255,w>>8&255,T>>8&255)+Ki(255&j,255&w,255&T)?j:w},Ue.Predictor12=function(w,T,R){var j=T[R+0];return(di((w>>24&255)+(j>>24&255)-((T=T[R-1])>>24&255))<<24|di((w>>16&255)+(j>>16&255)-(T>>16&255))<<16|di((w>>8&255)+(j>>8&255)-(T>>8&255))<<8|di((255&w)+(255&j)-(255&T)))>>>0},Ue.Predictor13=function(w,T,R){var j=T[R-1];return(li((w=ni(w,T[R+0]))>>24&255,j>>24&255)<<24|li(w>>16&255,j>>16&255)<<16|li(w>>8&255,j>>8&255)<<8|li(w>>0&255,j>>0&255))>>>0};var Lu=Ue.PredictorAdd0;Ue.PredictorAdd1=tr,ut("Predictor2","PredictorAdd2"),ut("Predictor3","PredictorAdd3"),ut("Predictor4","PredictorAdd4"),ut("Predictor5","PredictorAdd5"),ut("Predictor6","PredictorAdd6"),ut("Predictor7","PredictorAdd7"),ut("Predictor8","PredictorAdd8"),ut("Predictor9","PredictorAdd9"),ut("Predictor10","PredictorAdd10"),ut("Predictor11","PredictorAdd11"),ut("Predictor12","PredictorAdd12"),ut("Predictor13","PredictorAdd13");var Sn=Ue.PredictorAdd2;Ji("ColorIndexInverseTransform","MapARGB","32b",function(w){return w>>8&255},function(w){return w}),Ji("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(w){return w},function(w){return w>>8&255});var on,fn=Ue.ColorIndexInverseTransform,Yn=Ue.MapARGB,ll=Ue.VP8LColorIndexInverseTransformAlpha,cl=Ue.MapAlpha,fo=Ue.VP8LPredictorsAdd=[];fo.length=16,(Ue.VP8LPredictors=[]).length=16,(Ue.VP8LPredictorsAdd_C=[]).length=16,(Ue.VP8LPredictors_C=[]).length=16;var ns,ss,Mo,Po,ga,ul,to,io,po,ms,ro,Ma,ma,Pa,Tn,Fo,hs,ys,As,Ir,Zr,an,Gn,ya,Fa,go,Zo,Oi,Jo=o(511),Pi=o(2041),hl=o(225),Hl=o(767),Li=0,Gl=Pi,Ei=hl,no=Hl,mo=Jo,Mc=0,jl=1,Pc=2,Fc=3,Dc=4,Rc=5,Za=6,yn=7,Bs=8,Do=9,ql=10,Mu=[2,3,7],Ac=[3,3,11],su=[280,256,256,256,40],_a=[0,1,1,1,0],$s=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],bi=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],sr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$l=8,kc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Oc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Cs=null,dh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],jn=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ou=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],$i=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Ni=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],qn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Pu=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ds=[],tn=[],Yo=[],Ro=1,au=2,Rs=[],Jr=[];Tt("UpsampleRgbLinePair",jr,3),Tt("UpsampleBgrLinePair",nr,3),Tt("UpsampleRgbaLinePair",qs,4),Tt("UpsampleBgraLinePair",On,4),Tt("UpsampleArgbLinePair",Lr,4),Tt("UpsampleRgba4444LinePair",Br,2),Tt("UpsampleRgb565LinePair",Hn,2);var Un=Ue.UpsampleRgbLinePair,ko=Ue.UpsampleBgrLinePair,Al=Ue.UpsampleRgbaLinePair,Ja=Ue.UpsampleBgraLinePair,Da=Ue.UpsampleArgbLinePair,Kl=Ue.UpsampleRgba4444LinePair,lu=Ue.UpsampleRgb565LinePair,yo=16,va=1<<yo-1,dl=-227,Gr=482,N=6,A=(256<<N)-1,b=0,L=o(256),k=o(256),y=o(256),a=o(256),d=o(Gr-dl),_=o(Gr-dl);Lo("YuvToRgbRow",jr,3),Lo("YuvToBgrRow",nr,3),Lo("YuvToRgbaRow",qs,4),Lo("YuvToBgraRow",On,4),Lo("YuvToArgbRow",Lr,4),Lo("YuvToRgba4444Row",Br,2),Lo("YuvToRgb565Row",Hn,2);var B=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],S=[0,2,8],U=[8,7,6,4,4,2,2,2,1,1,1,1],H=1;this.WebPDecodeRGBA=function(w,T,R,j,Z){var W=jl,J=new Ol,ee=new Sr;J.ba=ee,ee.S=W,ee.width=[ee.width],ee.height=[ee.height];var ae=ee.width,fe=ee.height,pe=new ze;if(pe==null||w==null)var xe=2;else e(pe!=null),xe=ol(w,T,R,pe.width,pe.height,pe.Pd,pe.Qd,pe.format,null);if(xe!=0?ae=0:(ae!=null&&(ae[0]=pe.width[0]),fe!=null&&(fe[0]=pe.height[0]),ae=1),ae){ee.width=ee.width[0],ee.height=ee.height[0],j!=null&&(j[0]=ee.width),Z!=null&&(Z[0]=ee.height);e:{if(j=new So,(Z=new Ka).data=w,Z.w=T,Z.ha=R,Z.kd=1,T=[0],e(Z!=null),((w=ol(Z.data,Z.w,Z.ha,null,null,null,T,null,Z))==0||w==7)&&T[0]&&(w=4),(T=w)==0){if(e(J!=null),j.data=Z.data,j.w=Z.w+Z.offset,j.ha=Z.ha-Z.offset,j.put=_e,j.ac=ge,j.bc=Ce,j.ma=J,Z.xa){if((w=wi())==null){J=1;break e}if(function(Pe,Le){var rt=[0],Ke=[0],Re=[0];t:for(;;){if(Pe==null)return 0;if(Le==null)return Pe.a=2,0;if(Pe.l=Le,Pe.a=0,_t(Pe.m,Le.data,Le.w,Le.ha),!ve(Pe.m,rt,Ke,Re)){Pe.a=3;break t}if(Pe.xb=au,Le.width=rt[0],Le.height=Ke[0],!Ui(rt[0],Ke[0],1,Pe,null))break t;return 1}return e(Pe.a!=0),0}(w,j)){if(j=(T=pa(j.width,j.height,J.Oa,J.ba))==0){t:{j=w;i:for(;;){if(j==null){j=0;break t}if(e(j.s.yc!=null),e(j.s.Ya!=null),e(0<j.s.Wb),e((R=j.l)!=null),e((Z=R.ma)!=null),j.xb!=0){if(j.ca=Z.ba,j.tb=Z.tb,e(j.ca!=null),!Ql(Z.Oa,R,Fc)){j.a=2;break i}if(!st(j,R.width)||R.da)break i;if((R.da||vi(j.ca.S))&&vt(),11>j.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),j.ca.f.kb.F!=null&&vt()),j.Pb&&0<j.s.ua&&j.s.vb.X==null&&!Mi(j.s.vb,j.s.Wa.Xa)){j.a=1;break i}j.xb=0}if(!Ci(j,j.V,j.Ba,j.c,j.i,R.o,Yt))break i;Z.Dc=j.Ma,j=1;break t}e(j.a!=0),j=0}j=!j}j&&(T=w.a)}else T=w.a}else{if((w=new cs)==null){J=1;break e}if(w.Fa=Z.na,w.P=Z.P,w.qc=Z.Sa,ws(w,j)){if((T=pa(j.width,j.height,J.Oa,J.ba))==0){if(w.Aa=0,R=J.Oa,e((Z=w)!=null),R!=null){if(0<(ae=0>(ae=R.Md)?0:100<ae?255:255*ae/100)){for(fe=pe=0;4>fe;++fe)12>(xe=Z.pb[fe]).lc&&(xe.ia=ae*U[0>xe.lc?0:xe.lc]>>3),pe|=xe.ia;pe&&(alert("todo:VP8InitRandom"),Z.ia=1)}Z.Ga=R.Id,100<Z.Ga?Z.Ga=100:0>Z.Ga&&(Z.Ga=0)}Vn(w,j)||(T=w.a)}}else T=w.a}T==0&&J.Oa!=null&&J.Oa.fd&&(T=hc(J.ba))}J=T}W=J!=0?null:11>W?ee.f.RGBA.eb:ee.f.kb.y}else W=null;return W};var q=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function x(Ue,lt){for(var nt="",De=0;De<4;De++)nt+=String.fromCharCode(Ue[lt++]);return nt}function I(Ue,lt){return(Ue[lt+0]<<0|Ue[lt+1]<<8|Ue[lt+2]<<16)>>>0}function F(Ue,lt){return(Ue[lt+0]<<0|Ue[lt+1]<<8|Ue[lt+2]<<16|Ue[lt+3]<<24)>>>0}new m;var O=[0],z=[0],ie=[],ne=new m,ue=i,ce=function(Ue,lt){var nt={},De=0,Fe=!1,Je=0,We=0;if(nt.frames=[],!function(Xe,et,At,ft){for(var wt=0;wt<ft;wt++)if(Xe[et+wt]!=At.charCodeAt(wt))return!0;return!1}(Ue,lt,"RIFF",4)){var Et,Ct;for(F(Ue,lt+=4),lt+=8;lt<Ue.length;){var Lt=x(Ue,lt),_t=F(Ue,lt+=4);lt+=4;var Ft=_t+(1&_t);switch(Lt){case"VP8 ":case"VP8L":nt.frames[De]===void 0&&(nt.frames[De]={}),(Ee=nt.frames[De]).src_off=Fe?We:lt-8,Ee.src_size=Je+_t+8,De++,Fe&&(Fe=!1,Je=0,We=0);break;case"VP8X":(Ee=nt.header={}).feature_flags=Ue[lt];var Mt=lt+4;Ee.canvas_width=1+I(Ue,Mt),Mt+=3,Ee.canvas_height=1+I(Ue,Mt),Mt+=3;break;case"ALPH":Fe=!0,Je=Ft+8,We=lt-8;break;case"ANIM":(Ee=nt.header).bgcolor=F(Ue,lt),Mt=lt+4,Ee.loop_count=(Et=Ue)[(Ct=Mt)+0]<<0|Et[Ct+1]<<8,Mt+=2;break;case"ANMF":var Wt,Ee;(Ee=nt.frames[De]={}).offset_x=2*I(Ue,lt),lt+=3,Ee.offset_y=2*I(Ue,lt),lt+=3,Ee.width=1+I(Ue,lt),lt+=3,Ee.height=1+I(Ue,lt),lt+=3,Ee.duration=I(Ue,lt),lt+=3,Wt=Ue[lt++],Ee.dispose=1&Wt,Ee.blend=Wt>>1&1}Lt!="ANMF"&&(lt+=Ft)}return nt}}(ue,0);ce.response=ue,ce.rgbaoutput=!0,ce.dataurl=!1;var de=ce.header?ce.header:null,be=ce.frames?ce.frames:null;if(de){de.loop_counter=de.loop_count,O=[de.canvas_height],z=[de.canvas_width];for(var Te=0;Te<be.length&&be[Te].blend!=0;Te++);}var je=be[0],Ge=ne.WebPDecodeRGBA(ue,je.src_off,je.src_size,z,O);je.rgba=Ge,je.imgwidth=z[0],je.imgheight=O[0];for(var $e=0;$e<z[0]*O[0]*4;$e++)ie[$e]=Ge[$e];return this.width=z,this.height=O,this.data=ie,this}(function(i){var e=function(){return typeof SB=="function"},t=function(O,z,ie,ne){var ue=4,ce=c;switch(ne){case i.image_compression.FAST:ue=1,ce=o;break;case i.image_compression.MEDIUM:ue=6,ce=s;break;case i.image_compression.SLOW:ue=9,ce=m}O=r(O,z,ie,ce);var de=SB(O,{level:ue});return i.__addimage__.arrayBufferToBinaryString(de)},r=function(O,z,ie,ne){for(var ue,ce,de,be=O.length/z,Te=new Uint8Array(O.length+be),je=I(),Ge=0;Ge<be;Ge+=1){if(de=Ge*z,ue=O.subarray(de,de+z),ne)Te.set(ne(ue,ie,ce),de+Ge);else{for(var $e,Ue=je.length,lt=[];$e<Ue;$e+=1)lt[$e]=je[$e](ue,ie,ce);var nt=F(lt.concat());Te.set(lt[nt],de+Ge)}ce=ue}return Te},n=function(O){var z=Array.apply([],O);return z.unshift(0),z},o=function(O,z){var ie,ne=[],ue=O.length;ne[0]=1;for(var ce=0;ce<ue;ce+=1)ie=O[ce-z]||0,ne[ce+1]=O[ce]-ie+256&255;return ne},c=function(O,z,ie){var ne,ue=[],ce=O.length;ue[0]=2;for(var de=0;de<ce;de+=1)ne=ie&&ie[de]||0,ue[de+1]=O[de]-ne+256&255;return ue},s=function(O,z,ie){var ne,ue,ce=[],de=O.length;ce[0]=3;for(var be=0;be<de;be+=1)ne=O[be-z]||0,ue=ie&&ie[be]||0,ce[be+1]=O[be]+256-(ne+ue>>>1)&255;return ce},m=function(O,z,ie){var ne,ue,ce,de,be=[],Te=O.length;be[0]=4;for(var je=0;je<Te;je+=1)ne=O[je-z]||0,ue=ie&&ie[je]||0,ce=ie&&ie[je-z]||0,de=x(ne,ue,ce),be[je+1]=O[je]-de+256&255;return be},x=function(O,z,ie){if(O===z&&z===ie)return O;var ne=Math.abs(z-ie),ue=Math.abs(O-ie),ce=Math.abs(O+z-ie-ie);return ne<=ue&&ne<=ce?O:ue<=ce?z:ie},I=function(){return[n,o,c,s,m]},F=function(O){var z=O.map(function(ie){return ie.reduce(function(ne,ue){return ne+Math.abs(ue)},0)});return z.indexOf(Math.min.apply(null,z))};i.processPNG=function(O,z,ie,ne){var ue,ce,de,be,Te,je,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et=this.decode.FLATE_DECODE,Ct="";if(this.__addimage__.isArrayBuffer(O)&&(O=new Uint8Array(O)),this.__addimage__.isArrayBufferView(O)){if(O=(de=new Lte(O)).imgData,ce=de.bits,ue=de.colorSpace,Te=de.colors,[4,6].indexOf(de.colorType)!==-1){if(de.bits===8){Ue=($e=de.pixelBitlength==32?new Uint32Array(de.decodePixels().buffer):de.pixelBitlength==16?new Uint16Array(de.decodePixels().buffer):new Uint8Array(de.decodePixels().buffer)).length,nt=new Uint8Array(Ue*de.colors),lt=new Uint8Array(Ue);var Lt,_t=de.pixelBitlength-de.bits;for(Je=0,We=0;Je<Ue;Je++){for(Fe=$e[Je],Lt=0;Lt<_t;)nt[We++]=Fe>>>Lt&255,Lt+=de.bits;lt[Je]=Fe>>>Lt&255}}if(de.bits===16){Ue=($e=new Uint32Array(de.decodePixels().buffer)).length,nt=new Uint8Array(Ue*(32/de.pixelBitlength)*de.colors),lt=new Uint8Array(Ue*(32/de.pixelBitlength)),De=de.colors>1,Je=0,We=0;for(var Ft=0;Je<Ue;)Fe=$e[Je++],nt[We++]=Fe>>>0&255,De&&(nt[We++]=Fe>>>16&255,Fe=$e[Je++],nt[We++]=Fe>>>0&255),lt[Ft++]=Fe>>>16&255;ce=8}ne!==i.image_compression.NONE&&e()?(O=t(nt,de.width*de.colors,de.colors,ne),Ge=t(lt,de.width,1,ne)):(O=nt,Ge=lt,Et=void 0)}if(de.colorType===3&&(ue=this.color_spaces.INDEXED,je=de.palette,de.transparency.indexed)){var Mt=de.transparency.indexed,Wt=0;for(Je=0,Ue=Mt.length;Je<Ue;++Je)Wt+=Mt[Je];if((Wt/=255)===Ue-1&&Mt.indexOf(0)!==-1)be=[Mt.indexOf(0)];else if(Wt!==Ue){for($e=de.decodePixels(),lt=new Uint8Array($e.length),Je=0,Ue=$e.length;Je<Ue;Je++)lt[Je]=Mt[$e[Je]];Ge=t(lt,de.width,1)}}var Ee=function(Xe){var et;switch(Xe){case i.image_compression.FAST:et=11;break;case i.image_compression.MEDIUM:et=13;break;case i.image_compression.SLOW:et=14;break;default:et=12}return et}(ne);return Et===this.decode.FLATE_DECODE&&(Ct="/Predictor "+Ee+" "),Ct+="/Colors "+Te+" /BitsPerComponent "+ce+" /Columns "+de.width,(this.__addimage__.isArrayBuffer(O)||this.__addimage__.isArrayBufferView(O))&&(O=this.__addimage__.arrayBufferToBinaryString(O)),(Ge&&this.__addimage__.isArrayBuffer(Ge)||this.__addimage__.isArrayBufferView(Ge))&&(Ge=this.__addimage__.arrayBufferToBinaryString(Ge)),{alias:ie,data:O,index:z,filter:Et,decodeParameters:Ct,transparency:be,palette:je,sMask:Ge,predictor:Ee,width:de.width,height:de.height,bitsPerComponent:ce,colorSpace:ue}}}})(kr.API),function(i){i.processGIF89A=function(e,t,r,n){var o=new Mte(e),c=o.width,s=o.height,m=[];o.decodeAndBlitFrameRGBA(0,m);var x={data:m,width:c,height:s},I=new NB(100).encode(x,100);return i.processJPEG.call(this,I,t,r,n)},i.processGIF87A=i.processGIF89A}(kr.API),th.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var e=0;e<i;e++){var t=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:n,green:r,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},th.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[i]()}catch(t){Ms.log("bit decode error:"+t)}},th.prototype.bit1=function(){var i,e=Math.ceil(this.width/8),t=e%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,n=0;n<e;n++)for(var o=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+8*n*4,s=0;s<8&&8*n+s<this.width;s++){var m=this.palette[o>>7-s&1];this.data[c+4*s]=m.blue,this.data[c+4*s+1]=m.green,this.data[c+4*s+2]=m.red,this.data[c+4*s+3]=255}t!==0&&(this.pos+=4-t)}},th.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),e=i%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<i;n++){var o=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+2*n*4,s=o>>4,m=15&o,x=this.palette[s];if(this.data[c]=x.blue,this.data[c+1]=x.green,this.data[c+2]=x.red,this.data[c+3]=255,2*n+1>=this.width)break;x=this.palette[m],this.data[c+4]=x.blue,this.data[c+4+1]=x.green,this.data[c+4+2]=x.red,this.data[c+4+3]=255}e!==0&&(this.pos+=4-e)}},th.prototype.bit8=function(){for(var i=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;if(n<this.palette.length){var c=this.palette[n];this.data[o]=c.red,this.data[o+1]=c.green,this.data[o+2]=c.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}i!==0&&(this.pos+=4-i)}},th.prototype.bit15=function(){for(var i=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,m=(o>>10&e)/e*255|0,x=o>>15?255:0,I=r*this.width*4+4*n;this.data[I]=m,this.data[I+1]=s,this.data[I+2]=c,this.data[I+3]=x}this.pos+=i}},th.prototype.bit16=function(){for(var i=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(c&e)/e*255|0,m=(c>>5&t)/t*255|0,x=(c>>11)/e*255|0,I=n*this.width*4+4*o;this.data[I]=x,this.data[I+1]=m,this.data[I+2]=s,this.data[I+3]=255}this.pos+=i}},th.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),c=e*this.width*4+4*t;this.data[c]=o,this.data[c+1]=n,this.data[c+2]=r,this.data[c+3]=255}this.pos+=this.width%4}},th.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*t;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=r,this.data[s+3]=c}},th.prototype.getData=function(){return this.data},function(i){i.processBMP=function(e,t,r,n){var o=new th(e,!1),c=o.width,s=o.height,m={data:o.getData(),width:c,height:s},x=new NB(100).encode(m,100);return i.processJPEG.call(this,x,t,r,n)}}(kr.API),VF.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(e,t,r,n){var o=new VF(e),c=o.width,s=o.height,m={data:o.getData(),width:c,height:s},x=new NB(100).encode(m,100);return i.processJPEG.call(this,x,t,r,n)}}(kr.API),kr.API.processRGBA=function(i,e,t){for(var r=i.data,n=r.length,o=new Uint8Array(n/4*3),c=new Uint8Array(n/4),s=0,m=0,x=0;x<n;x+=4){var I=r[x],F=r[x+1],O=r[x+2],z=r[x+3];o[s++]=I,o[s++]=F,o[s++]=O,c[m++]=z}var ie=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(c),data:ie,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},kr.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},ug=kr.API,E1=ug.getCharWidthsArray=function(i,e){var t,r,n=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),c=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:n.metadata.Unicode.widths,m=s.fof?s.fof:1,x=e.kerning?e.kerning:n.metadata.Unicode.kerning,I=x.fof?x.fof:1,F=e.doKerning!==!1,O=0,z=i.length,ie=0,ne=s[0]||m,ue=[];for(t=0;t<z;t++)r=i.charCodeAt(t),typeof n.metadata.widthOfString=="function"?ue.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(r))+c*(1e3/o)||0)/1e3):(O=F&&Zn(x[r])==="object"&&!isNaN(parseInt(x[r][ie],10))?x[r][ie]/I:0,ue.push((s[r]||ne)/m+O)),ie=r;return ue},UF=ug.getStringUnitWidth=function(i,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),n=e.charSpace||this.internal.getCharSpace();return ug.processArabic&&(i=ug.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,t,n)/t:E1.apply(this,arguments).reduce(function(o,c){return o+c},0)},NF=function(i,e,t,r){for(var n=[],o=0,c=i.length,s=0;o!==c&&s+e[o]<t;)s+=e[o],o++;n.push(i.slice(0,o));var m=o;for(s=0;o!==c;)s+e[o]>r&&(n.push(i.slice(m,o)),s=0,m=o),s+=e[o],o++;return m!==o&&n.push(i.slice(m,o)),n},zF=function(i,e,t){t||(t={});var r,n,o,c,s,m,x,I=[],F=[I],O=t.textIndent||0,z=0,ie=0,ne=i.split(" "),ue=E1.apply(this,[" ",t])[0];if(m=t.lineIndent===-1?ne[0].length+2:t.lineIndent||0){var ce=Array(m).join(" "),de=[];ne.map(function(Te){(Te=Te.split(/\s*\n/)).length>1?de=de.concat(Te.map(function(je,Ge){return(Ge&&je.length?`
`:"")+je})):de.push(Te[0])}),ne=de,m=UF.apply(this,[ce,t])}for(o=0,c=ne.length;o<c;o++){var be=0;if(r=ne[o],m&&r[0]==`
`&&(r=r.substr(1),be=1),O+z+(ie=(n=E1.apply(this,[r,t])).reduce(function(Te,je){return Te+je},0))>e||be){if(ie>e){for(s=NF.apply(this,[r,n,e-(O+z),e]),I.push(s.shift()),I=[s.pop()];s.length;)F.push([s.shift()]);ie=n.slice(r.length-(I[0]?I[0].length:0)).reduce(function(Te,je){return Te+je},0)}else I=[r];F.push(I),O=ie+m,z=ue}else I.push(r),O+=z+ie,z=ue}return x=m?function(Te,je){return(je?ce:"")+Te.join(" ")}:function(Te){return Te.join(" ")},F.map(x)},ug.splitTextToSize=function(i,e,t){var r,n=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var F=this.internal.getFont(I.fontName,I.fontStyle);return F.metadata.Unicode?{widths:F.metadata.Unicode.widths||{0:1},kerning:F.metadata.Unicode.kerning||{}}:{font:F.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var c=1*this.internal.scaleFactor*e/n;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=t.lineIndent;var s,m,x=[];for(s=0,m=r.length;s<m;s++)x=x.concat(zF.apply(this,[r[s],c,o]));return x},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},r={},n=0;n<e.length;n++)t[e[n]]="0123456789abcdef"[n],r["0123456789abcdef"[n]]=e[n];var o=function(F){return"0x"+parseInt(F,10).toString(16)},c=i.__fontmetrics__.compress=function(F){var O,z,ie,ne,ue=["{"];for(var ce in F){if(O=F[ce],isNaN(parseInt(ce,10))?z="'"+ce+"'":(ce=parseInt(ce,10),z=(z=o(ce).slice(2)).slice(0,-1)+r[z.slice(-1)]),typeof O=="number")O<0?(ie=o(O).slice(3),ne="-"):(ie=o(O).slice(2),ne=""),ie=ne+ie.slice(0,-1)+r[ie.slice(-1)];else{if(Zn(O)!=="object")throw new Error("Don't know what to do with value type "+Zn(O)+".");ie=c(O)}ue.push(z+ie)}return ue.push("}"),ue.join("")},s=i.__fontmetrics__.uncompress=function(F){if(typeof F!="string")throw new Error("Invalid argument passed to uncompress.");for(var O,z,ie,ne,ue={},ce=1,de=ue,be=[],Te="",je="",Ge=F.length-1,$e=1;$e<Ge;$e+=1)(ne=F[$e])=="'"?O?(ie=O.join(""),O=void 0):O=[]:O?O.push(ne):ne=="{"?(be.push([de,ie]),de={},ie=void 0):ne=="}"?((z=be.pop())[0][z[1]]=de,ie=void 0,de=z[0]):ne=="-"?ce=-1:ie===void 0?t.hasOwnProperty(ne)?(Te+=t[ne],ie=parseInt(Te,16)*ce,ce=1,Te=""):Te+=ne:t.hasOwnProperty(ne)?(je+=t[ne],de[ie]=parseInt(je,16)*ce,ce=1,ie=void 0,je=""):je+=ne;return ue},m={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},x={Unicode:{Courier:m,"Courier-Bold":m,"Courier-BoldOblique":m,"Courier-Oblique":m,Helvetica:m,"Helvetica-Bold":m,"Helvetica-BoldOblique":m,"Helvetica-Oblique":m,"Times-Roman":m,"Times-Bold":m,"Times-BoldItalic":m,"Times-Italic":m}},I={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(F){var O=F.font,z=I.Unicode[O.postScriptName];z&&(O.metadata.Unicode={},O.metadata.Unicode.widths=z.widths,O.metadata.Unicode.kerning=z.kerning);var ie=x.Unicode[O.postScriptName];ie&&(O.metadata.Unicode.encoding=ie,O.encoding=ie.codePages[0])}])}(kr.API),function(i){var e=function(t){for(var r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return n};i.API.events.push(["addFont",function(t){var r=void 0,n=t.font,o=t.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(r=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(c,s){s=/^\x00\x01\x00\x00/.test(s)?e(s):e(fy(s)),c.metadata=i.API.TTFFont.open(s),c.metadata.Unicode=c.metadata.Unicode||{encoding:{},kerning:{},widths:[]},c.metadata.glyIdsUsed=[0]})(n,r)}}])}(kr),function(i){function e(){return(Rr.canvg?Promise.resolve(Rr.canvg):Promise.resolve().then(()=>r1e)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}kr.API.addSvgAsImage=function(t,r,n,o,c,s,m,x){if(isNaN(r)||isNaN(n))throw Ms.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(c))throw Ms.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var I=document.createElement("canvas");I.width=o,I.height=c;var F=I.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,I.width,I.height);var O={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},z=this;return e().then(function(ie){return ie.fromString(F,t,O)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(ie){return ie.render(O)}).then(function(){z.addImage(I.toDataURL("image/jpeg",1),r,n,o,c,m,x)})}}(),kr.API.putTotalPages=function(i){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(i,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(e,t);return this},kr.API.viewerPreferences=function(i,e){var t;i=i||{},e=e||!1;var r,n,o,c={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(c),m=[],x=0,I=0,F=0;function O(ie,ne){var ue,ce=!1;for(ue=0;ue<ie.length;ue+=1)ie[ue]===ne&&(ce=!0);return ce}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(c)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,i==="reset"||e===!0){var z=s.length;for(F=0;F<z;F+=1)t[s[F]].value=t[s[F]].defaultValue,t[s[F]].explicitSet=!1}if(Zn(i)==="object"){for(n in i)if(o=i[n],O(s,n)&&o!==void 0){if(t[n].type==="boolean"&&typeof o=="boolean")t[n].value=o;else if(t[n].type==="name"&&O(t[n].valueSet,o))t[n].value=o;else if(t[n].type==="integer"&&Number.isInteger(o))t[n].value=o;else if(t[n].type==="array"){for(x=0;x<o.length;x+=1)if(r=!0,o[x].length===1&&typeof o[x][0]=="number")m.push(String(o[x]-1));else if(o[x].length>1){for(I=0;I<o[x].length;I+=1)typeof o[x][I]!="number"&&(r=!1);r===!0&&m.push([o[x][0]-1,o[x][1]-1].join(" "))}t[n].value="["+m.join(" ")+"]"}else t[n].value=t[n].defaultValue;t[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ie,ne=[];for(ie in t)t[ie].explicitSet===!0&&(t[ie].type==="name"?ne.push("/"+ie+" /"+t[ie].value):ne.push("/"+ie+" "+t[ie].value));ne.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+ne.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(i){var e=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(r)),c=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),m=unescape(encodeURIComponent("</x:xmpmeta>")),x=o.length+c.length+s.length+n.length+m.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+x+" >>"),this.internal.write("stream"),this.internal.write(n+o+c+s+m),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(kr.API),function(i){var e=i.API,t=e.pdfEscape16=function(o,c){for(var s,m=c.metadata.Unicode.widths,x=["","0","00","000","0000"],I=[""],F=0,O=o.length;F<O;++F){if(s=c.metadata.characterToGlyph(o.charCodeAt(F)),c.metadata.glyIdsUsed.push(s),c.metadata.toUnicode[s]=o.charCodeAt(F),m.indexOf(s)==-1&&(m.push(s),m.push([parseInt(c.metadata.widthOfGlyph(s),10)])),s=="0")return I.join("");s=s.toString(16),I.push(x[4-s.length],s)}return I.join("")},r=function(o){var c,s,m,x,I,F,O;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,m=[],F=0,O=(s=Object.keys(o).sort(function(z,ie){return z-ie})).length;F<O;F++)c=s[F],m.length>=100&&(I+=`
`+m.length+` beginbfchar
`+m.join(`
`)+`
endbfchar`,m=[]),o[c]!==void 0&&o[c]!==null&&typeof o[c].toString=="function"&&(x=("0000"+o[c].toString(16)).slice(-4),c=("0000"+(+c).toString(16)).slice(-4),m.push("<"+c+"><"+x+">"));return m.length&&(I+=`
`+m.length+` beginbfchar
`+m.join(`
`)+`
endbfchar
`),I+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(c){var s=c.font,m=c.out,x=c.newObject,I=c.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="Identity-H"){for(var F=s.metadata.Unicode.widths,O=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),z="",ie=0;ie<O.length;ie++)z+=String.fromCharCode(O[ie]);var ne=x();I({data:z,addLength1:!0,objectId:ne}),m("endobj");var ue=x();I({data:r(s.metadata.toUnicode),addLength1:!0,objectId:ue}),m("endobj");var ce=x();m("<<"),m("/Type /FontDescriptor"),m("/FontName /"+rg(s.fontName)),m("/FontFile2 "+ne+" 0 R"),m("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),m("/Flags "+s.metadata.flags),m("/StemV "+s.metadata.stemV),m("/ItalicAngle "+s.metadata.italicAngle),m("/Ascent "+s.metadata.ascender),m("/Descent "+s.metadata.decender),m("/CapHeight "+s.metadata.capHeight),m(">>"),m("endobj");var de=x();m("<<"),m("/Type /Font"),m("/BaseFont /"+rg(s.fontName)),m("/FontDescriptor "+ce+" 0 R"),m("/W "+i.API.PDFObject.convert(F)),m("/CIDToGIDMap /Identity"),m("/DW 1000"),m("/Subtype /CIDFontType2"),m("/CIDSystemInfo"),m("<<"),m("/Supplement 0"),m("/Registry (Adobe)"),m("/Ordering ("+s.encoding+")"),m(">>"),m(">>"),m("endobj"),s.objectNumber=x(),m("<<"),m("/Type /Font"),m("/Subtype /Type0"),m("/ToUnicode "+ue+" 0 R"),m("/BaseFont /"+rg(s.fontName)),m("/Encoding /"+s.encoding),m("/DescendantFonts ["+de+" 0 R]"),m(">>"),m("endobj"),s.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(c){var s=c.font,m=c.out,x=c.newObject,I=c.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var F=s.metadata.rawData,O="",z=0;z<F.length;z++)O+=String.fromCharCode(F[z]);var ie=x();I({data:O,addLength1:!0,objectId:ie}),m("endobj");var ne=x();I({data:r(s.metadata.toUnicode),addLength1:!0,objectId:ne}),m("endobj");var ue=x();m("<<"),m("/Descent "+s.metadata.decender),m("/CapHeight "+s.metadata.capHeight),m("/StemV "+s.metadata.stemV),m("/Type /FontDescriptor"),m("/FontFile2 "+ie+" 0 R"),m("/Flags 96"),m("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),m("/FontName /"+rg(s.fontName)),m("/ItalicAngle "+s.metadata.italicAngle),m("/Ascent "+s.metadata.ascender),m(">>"),m("endobj"),s.objectNumber=x();for(var ce=0;ce<s.metadata.hmtx.widths.length;ce++)s.metadata.hmtx.widths[ce]=parseInt(s.metadata.hmtx.widths[ce]*(1e3/s.metadata.head.unitsPerEm));m("<</Subtype/TrueType/Type/Font/ToUnicode "+ne+" 0 R/BaseFont/"+rg(s.fontName)+"/FontDescriptor "+ue+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),m("endobj"),s.isAlreadyPutted=!0}})(o)}]);var n=function(o){var c,s=o.text||"",m=o.x,x=o.y,I=o.options||{},F=o.mutex||{},O=F.pdfEscape,z=F.activeFontKey,ie=F.fonts,ne=z,ue="",ce=0,de="",be=ie[ne].encoding;if(ie[ne].encoding!=="Identity-H")return{text:s,x:m,y:x,options:I,mutex:F};for(de=s,ne=z,Array.isArray(s)&&(de=s[0]),ce=0;ce<de.length;ce+=1)ie[ne].metadata.hasOwnProperty("cmap")&&(c=ie[ne].metadata.cmap.unicode.codeMap[de[ce].charCodeAt(0)]),c||de[ce].charCodeAt(0)<256&&ie[ne].metadata.hasOwnProperty("Unicode")?ue+=de[ce]:ue+="";var Te="";return parseInt(ne.slice(1))<14||be==="WinAnsiEncoding"?Te=O(ue,ne).split("").map(function(je){return je.charCodeAt(0).toString(16)}).join(""):be==="Identity-H"&&(Te=t(ue,ie[ne])),F.isHex=!0,{text:Te,x:m,y:x,options:I,mutex:F}};e.events.push(["postProcessText",function(o){var c=o.text||"",s=[],m={text:c,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(c)){var x=0;for(x=0;x<c.length;x+=1)Array.isArray(c[x])&&c[x].length===3?s.push([n(Object.assign({},m,{text:c[x][0]})).text,c[x][1],c[x][2]]):s.push(n(Object.assign({},m,{text:c[x]})).text);o.text=s}else o.text=n(Object.assign({},m,{text:c})).text}])}(kr),function(i){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},i.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},i.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(kr.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var n,o,c,s,m,x,I,F=e,O=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],z=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},ne={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},ue=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],ce=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),de=!1,be=0;this.__bidiEngine__={};var Te=function(De){var Fe=De.charCodeAt(),Je=Fe>>8,We=ne[Je];return We!==void 0?F[256*We+(255&Fe)]:Je===252||Je===253?"AL":ce.test(Je)?"L":Je===8?"R":"N"},je=function(De){for(var Fe,Je=0;Je<De.length;Je++){if((Fe=Te(De.charAt(Je)))==="L")return!1;if(Fe==="R")return!0}return!1},Ge=function(De,Fe,Je,We){var Et,Ct,Lt,_t,Ft=Fe[We];switch(Ft){case"L":case"R":de=!1;break;case"N":case"AN":break;case"EN":de&&(Ft="AN");break;case"AL":de=!0,Ft="R";break;case"WS":Ft="N";break;case"CS":We<1||We+1>=Fe.length||(Et=Je[We-1])!=="EN"&&Et!=="AN"||(Ct=Fe[We+1])!=="EN"&&Ct!=="AN"?Ft="N":de&&(Ct="AN"),Ft=Ct===Et?Ct:"N";break;case"ES":Ft=(Et=We>0?Je[We-1]:"B")==="EN"&&We+1<Fe.length&&Fe[We+1]==="EN"?"EN":"N";break;case"ET":if(We>0&&Je[We-1]==="EN"){Ft="EN";break}if(de){Ft="N";break}for(Lt=We+1,_t=Fe.length;Lt<_t&&Fe[Lt]==="ET";)Lt++;Ft=Lt<_t&&Fe[Lt]==="EN"?"EN":"N";break;case"NSM":if(c&&!s){for(_t=Fe.length,Lt=We+1;Lt<_t&&Fe[Lt]==="NSM";)Lt++;if(Lt<_t){var Mt=De[We],Wt=Mt>=1425&&Mt<=2303||Mt===64286;if(Et=Fe[Lt],Wt&&(Et==="R"||Et==="AL")){Ft="R";break}}}Ft=We<1||(Et=Fe[We-1])==="B"?"N":Je[We-1];break;case"B":de=!1,n=!0,Ft=be;break;case"S":o=!0,Ft="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":de=!1;break;case"BN":Ft="N"}return Ft},$e=function(De,Fe,Je){var We=De.split("");return Je&&Ue(We,Je,{hiLevel:be}),We.reverse(),Fe&&Fe.reverse(),We.join("")},Ue=function(De,Fe,Je){var We,Et,Ct,Lt,_t,Ft=-1,Mt=De.length,Wt=0,Ee=[],Xe=be?z:O,et=[];for(de=!1,n=!1,o=!1,Et=0;Et<Mt;Et++)et[Et]=Te(De[Et]);for(Ct=0;Ct<Mt;Ct++){if(_t=Wt,Ee[Ct]=Ge(De,et,Ee,Ct),We=240&(Wt=Xe[_t][ie[Ee[Ct]]]),Wt&=15,Fe[Ct]=Lt=Xe[Wt][5],We>0)if(We===16){for(Et=Ft;Et<Ct;Et++)Fe[Et]=1;Ft=-1}else Ft=-1;if(Xe[Wt][6])Ft===-1&&(Ft=Ct);else if(Ft>-1){for(Et=Ft;Et<Ct;Et++)Fe[Et]=Lt;Ft=-1}et[Ct]==="B"&&(Fe[Ct]=0),Je.hiLevel|=Lt}o&&function(At,ft,wt){for(var Pt=0;Pt<wt;Pt++)if(At[Pt]==="S"){ft[Pt]=be;for(var It=Pt-1;It>=0&&At[It]==="WS";It--)ft[It]=be}}(et,Fe,Mt)},lt=function(De,Fe,Je,We,Et){if(!(Et.hiLevel<De)){if(De===1&&be===1&&!n)return Fe.reverse(),void(Je&&Je.reverse());for(var Ct,Lt,_t,Ft,Mt=Fe.length,Wt=0;Wt<Mt;){if(We[Wt]>=De){for(_t=Wt+1;_t<Mt&&We[_t]>=De;)_t++;for(Ft=Wt,Lt=_t-1;Ft<Lt;Ft++,Lt--)Ct=Fe[Ft],Fe[Ft]=Fe[Lt],Fe[Lt]=Ct,Je&&(Ct=Je[Ft],Je[Ft]=Je[Lt],Je[Lt]=Ct);Wt=_t}Wt++}}},nt=function(De,Fe,Je){var We=De.split(""),Et={hiLevel:be};return Je||(Je=[]),Ue(We,Je,Et),function(Ct,Lt,_t){if(_t.hiLevel!==0&&I)for(var Ft,Mt=0;Mt<Ct.length;Mt++)Lt[Mt]===1&&(Ft=ue.indexOf(Ct[Mt]))>=0&&(Ct[Mt]=ue[Ft+1])}(We,Je,Et),lt(2,We,Fe,Je,Et),lt(1,We,Fe,Je,Et),We.join("")};return this.__bidiEngine__.doBidiReorder=function(De,Fe,Je){if(function(Et,Ct){if(Ct)for(var Lt=0;Lt<Et.length;Lt++)Ct[Lt]=Lt;s===void 0&&(s=je(Et)),x===void 0&&(x=je(Et))}(De,Fe),c||!m||x)if(c&&m&&s^x)be=s?1:0,De=$e(De,Fe,Je);else if(!c&&m&&x)be=s?1:0,De=nt(De,Fe,Je),De=$e(De,Fe);else if(!c||s||m||x){if(c&&!m&&s^x)De=$e(De,Fe),s?(be=0,De=nt(De,Fe,Je)):(be=1,De=nt(De,Fe,Je),De=$e(De,Fe));else if(c&&s&&!m&&x)be=1,De=nt(De,Fe,Je),De=$e(De,Fe);else if(!c&&!m&&s^x){var We=I;s?(be=1,De=nt(De,Fe,Je),be=0,I=!1,De=nt(De,Fe,Je),I=We):(be=0,De=nt(De,Fe,Je),De=$e(De,Fe),be=1,I=!1,De=nt(De,Fe,Je),I=We,De=$e(De,Fe))}}else be=0,De=nt(De,Fe,Je);else be=s?1:0,De=nt(De,Fe,Je);return De},this.__bidiEngine__.setOptions=function(De){De&&(c=De.isInputVisual,m=De.isOutputVisual,s=De.isInputRtl,x=De.isOutputRtl,I=De.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var n=r.text,o=(r.x,r.y,r.options||{}),c=(r.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var s=0;for(c=[],s=0;s<n.length;s+=1)Object.prototype.toString.call(n[s])==="[object Array]"?c.push([t.doBidiReorder(n[s][0]),n[s][1],n[s][2]]):c.push([t.doBidiReorder(n[s])]);r.text=c}else r.text=t.doBidiReorder(n);t.setOptions({isInputVisual:!0})}])}(kr),kr.API.TTFFont=function(){function i(e){var t;if(this.rawData=e,t=this.contents=new od(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new qte(this),this.registerTTF()}return i.open=function(e){return new i(e)},i.prototype.parse=function(){return this.directory=new Pte(this.contents),this.head=new Dte(this),this.name=new Nte(this),this.cmap=new GF(this),this.toUnicode={},this.hhea=new Rte(this),this.maxp=new zte(this),this.hmtx=new Qte(this),this.post=new Ote(this),this.os2=new kte(this),this.loca=new jte(this),this.glyf=new Vte(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var e,t,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var c,s,m,x;for(x=[],c=0,s=(m=this.bbox).length;c<s;c++)e=m[c],x.push(Math.round(e*this.scaleFactor));return x}).call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},i.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},i.prototype.widthOfString=function(e,t,r){var n,o,c,s;for(c=0,o=0,s=(e=""+e).length;0<=s?o<s:o>s;o=0<=s?++o:--o)n=e.charCodeAt(o),c+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return c*(t/1e3)},i.prototype.lineHeight=function(e,t){var r;return t==null&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},i}();var ih,od=function(){function i(e){this.data=e??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(e){return this.data[this.pos++]=e},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},i.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},i.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},i.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(e){return this.writeInt16(e)},i.prototype.readLongLong=function(){var e,t,r,n,o,c,s,m;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),c=this.readByte(),s=this.readByte(),m=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^c)+256*(255^s)+(255^m)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*o+65536*c+256*s+m},i.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(e){return this.writeInt32(e)},i.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},i.prototype.write=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(this.writeByte(t));return o},i}(),Pte=function(){var i;function e(t){var r,n,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)r={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(t){var r,n,o,c,s,m,x,I,F,O,z,ie,ne;for(ne in z=Object.keys(t).length,m=Math.log(2),F=16*Math.floor(Math.log(z)/m),c=Math.floor(F/m),I=16*z-F,(n=new od).writeInt(this.scalarType),n.writeShort(z),n.writeShort(F),n.writeShort(c),n.writeShort(I),o=16*z,x=n.pos+o,s=null,ie=[],t)for(O=t[ne],n.writeString(ne),n.writeInt(i(O)),n.writeInt(x),n.writeInt(O.length),ie=ie.concat(O),ne==="head"&&(s=x),x+=O.length;x%4;)ie.push(0),x++;return n.write(ie),r=2981146554-i(n.data),n.pos=s+8,n.writeUInt32(r),n.data},i=function(t){var r,n,o,c;for(t=jF.call(t);t.length%4;)t.push(0);for(o=new od(t),n=0,r=0,c=t.length;r<c;r=r+=4)n+=o.readUInt32();return 4294967295&n},e}(),Fte={}.hasOwnProperty,Qh=function(i,e){for(var t in e)Fte.call(e,t)&&(i[t]=e[t]);function r(){this.constructor=i}return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};ih=function(){function i(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var Dte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new od).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),HF=function(){function i(e,t){var r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue,ce,de,be;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),F=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(m=0;m<256;++m)this.codeMap[m]=e.readByte();break;case 4:for(z=e.readUInt16(),O=z/2,e.pos+=6,o=function(){var Te,je;for(je=[],m=Te=0;0<=O?Te<O:Te>O;m=0<=O?++Te:--Te)je.push(e.readUInt16());return je}(),e.pos+=2,ne=function(){var Te,je;for(je=[],m=Te=0;0<=O?Te<O:Te>O;m=0<=O?++Te:--Te)je.push(e.readUInt16());return je}(),x=function(){var Te,je;for(je=[],m=Te=0;0<=O?Te<O:Te>O;m=0<=O?++Te:--Te)je.push(e.readUInt16());return je}(),I=function(){var Te,je;for(je=[],m=Te=0;0<=O?Te<O:Te>O;m=0<=O?++Te:--Te)je.push(e.readUInt16());return je}(),n=(this.length-e.pos+this.offset)/2,s=function(){var Te,je;for(je=[],m=Te=0;0<=n?Te<n:Te>n;m=0<=n?++Te:--Te)je.push(e.readUInt16());return je}(),m=ce=0,be=o.length;ce<be;m=++ce)for(ue=o[m],r=de=ie=ne[m];ie<=ue?de<=ue:de>=ue;r=ie<=ue?++de:--de)I[m]===0?c=r+x[m]:(c=s[I[m]/2+(r-ie)-(O-m)]||0)!==0&&(c+=x[m]),this.codeMap[r]=65535&c}e.pos=F}return i.encode=function(e,t){var r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue,ce,de,be,Te,je,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et,Ct,Lt,_t,Ft,Mt,Wt,Ee,Xe,et,At,ft,wt,Pt,It,Ht,ii,gi;switch(We=new od,c=Object.keys(e).sort(function(mi,Mi){return mi-Mi}),t){case"macroman":for(ne=0,ue=function(){var mi=[];for(ie=0;ie<256;++ie)mi.push(0);return mi}(),de={0:0},o={},Et=0,Ft=c.length;Et<Ft;Et++)de[It=e[n=c[Et]]]==null&&(de[It]=++ne),o[n]={old:e[n],new:de[e[n]]},ue[n]=de[e[n]];return We.writeUInt16(1),We.writeUInt16(0),We.writeUInt32(12),We.writeUInt16(0),We.writeUInt16(262),We.writeUInt16(0),We.write(ue),{charMap:o,subtable:We.data,maxGlyphID:ne+1};case"unicode":for(Fe=[],F=[],be=0,de={},r={},ce=x=null,Ct=0,Mt=c.length;Ct<Mt;Ct++)de[je=e[n=c[Ct]]]==null&&(de[je]=++be),r[n]={old:je,new:de[je]},s=de[je]-n,ce!=null&&s===x||(ce&&F.push(ce),Fe.push(n),x=s),ce=n;for(ce&&F.push(ce),F.push(65535),Fe.push(65535),nt=2*(lt=Fe.length),Ue=2*Math.pow(Math.log(lt)/Math.LN2,2),O=Math.log(Ue/2)/Math.LN2,$e=2*lt-Ue,m=[],Ge=[],z=[],ie=Lt=0,Wt=Fe.length;Lt<Wt;ie=++Lt){if(De=Fe[ie],I=F[ie],De===65535){m.push(0),Ge.push(0);break}if(De-(Je=r[De].new)>=32768)for(m.push(0),Ge.push(2*(z.length+lt-ie)),n=_t=De;De<=I?_t<=I:_t>=I;n=De<=I?++_t:--_t)z.push(r[n].new);else m.push(Je-De),Ge.push(0)}for(We.writeUInt16(3),We.writeUInt16(1),We.writeUInt32(12),We.writeUInt16(4),We.writeUInt16(16+8*lt+2*z.length),We.writeUInt16(0),We.writeUInt16(nt),We.writeUInt16(Ue),We.writeUInt16(O),We.writeUInt16($e),wt=0,Ee=F.length;wt<Ee;wt++)n=F[wt],We.writeUInt16(n);for(We.writeUInt16(0),Pt=0,Xe=Fe.length;Pt<Xe;Pt++)n=Fe[Pt],We.writeUInt16(n);for(Ht=0,et=m.length;Ht<et;Ht++)s=m[Ht],We.writeUInt16(s);for(ii=0,At=Ge.length;ii<At;ii++)Te=Ge[ii],We.writeUInt16(Te);for(gi=0,ft=z.length;gi<ft;gi++)ne=z[gi],We.writeUInt16(ne);return{charMap:r,subtable:We.data,maxGlyphID:be+1}}},i}(),GF=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,o;for(t.pos=this.offset,this.version=t.readUInt16(),o=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)r=new HF(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,o;return r==null&&(r="macroman"),n=HF.encode(t,r),(o=new od).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},e}(),Rte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),kte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),Ote=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,o;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var c;for(n=t.readUInt16(),this.glyphNameIndex=[],c=0;0<=n?c<n:c>n;c=0<=n?++c:--c)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],o=[];t.pos<this.offset+this.length;)r=t.readByte(),o.push(this.names.push(t.readString(r)));return o;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 196608:break;case 262144:return this.map=(function(){var s,m,x;for(x=[],c=s=0,m=this.file.maxp.numGlyphs;0<=m?s<m:s>m;c=0<=m?++s:--s)x.push(t.readUInt32());return x}).call(this)}},e}(),Ute=function(i,e){this.raw=i,this.length=i.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Nte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,o,c,s,m,x,I,F,O,z;for(t.pos=this.offset,t.readShort(),r=t.readShort(),m=t.readShort(),n=[],c=0;0<=r?c<r:c>r;c=0<=r?++c:--c)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+m+t.readShort()});for(x={},c=F=0,O=n.length;F<O;c=++F)o=n[c],t.pos=o.offset,I=t.readString(o.length),s=new Ute(I,o),x[z=o.nameID]==null&&(x[z]=[]),x[o.nameID].push(s);this.strings=x,this.copyright=x[0],this.fontFamily=x[1],this.fontSubfamily=x[2],this.uniqueSubfamily=x[3],this.fontName=x[4],this.version=x[5];try{this.postscriptName=x[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=x[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=x[7],this.manufacturer=x[8],this.designer=x[9],this.description=x[10],this.vendorUrl=x[11],this.designerUrl=x[12],this.license=x[13],this.licenseUrl=x[14],this.preferredFamily=x[15],this.preferredSubfamily=x[17],this.compatibleFull=x[18],this.sampleText=x[19]},e}(),zte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),Qte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,o,c,s,m,x;for(t.pos=this.offset,this.metrics=[],r=0,m=this.file.hhea.numberOfMetrics;0<=m?r<m:r>m;r=0<=m?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var I,F;for(F=[],r=I=0;0<=o?I<o:I>o;r=0<=o?++I:--I)F.push(t.readInt16());return F}(),this.widths=(function(){var I,F,O,z;for(z=[],I=0,F=(O=this.metrics).length;I<F;I++)c=O[I],z.push(c.advance);return z}).call(this),n=this.widths[this.widths.length-1],x=[],r=s=0;0<=o?s<o:s>o;r=0<=o?++s:--s)x.push(this.widths.push(n));return x},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),jF=[].slice,Vte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,o,c,s,m,x,I,F,O;return t in this.cache?this.cache[t]:(c=this.file.loca,r=this.file.contents,n=c.indexOf(t),(o=c.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,s=(m=new od(r.read(o))).readShort(),I=m.readShort(),O=m.readShort(),x=m.readShort(),F=m.readShort(),this.cache[t]=s===-1?new Gte(m,I,O,x,F):new Hte(m,s,I,O,x,F),this.cache[t]))},e.prototype.encode=function(t,r,n){var o,c,s,m,x;for(s=[],c=[],m=0,x=r.length;m<x;m++)o=t[r[m]],c.push(s.length),o&&(s=s.concat(o.encode(n)));return c.push(s.length),{table:s,offsets:c}},e}(),Hte=function(){function i(e,t,r,n,o,c){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=c,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),Gte=function(){function i(e,t,r,n,o){var c,s;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],c=this.raw;s=c.readShort(),this.glyphOffsets.push(c.pos),this.glyphIDs.push(c.readUInt16()),32&s;)c.pos+=1&s?4:2,128&s?c.pos+=8:64&s?c.pos+=4:8&s&&(c.pos+=2)}return i.prototype.encode=function(){var e,t,r;for(t=new od(jF.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},i}(),jte=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Qh(e,ih),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var o,c;for(c=[],n=0,o=this.length;n<o;n+=2)c.push(2*t.readUInt16());return c}).call(this):(function(){var o,c;for(c=[],n=0,o=this.length;n<o;n+=4)c.push(t.readUInt32());return c}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),o=0,c=0,s=0;s<n.length;++s)if(n[s]=o,c<r.length&&r[c]==s){++c,n[s]=o;var m=this.offsets[s],x=this.offsets[s+1]-m;x>0&&(o+=x)}for(var I=new Array(4*n.length),F=0;F<n.length;++F)I[4*F+3]=255&n[F],I[4*F+2]=(65280&n[F])>>8,I[4*F+1]=(16711680&n[F])>>16,I[4*F]=(4278190080&n[F])>>24;return I},e}(),qte=function(){function i(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var e,t,r,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)r=o[t],e[t]=n[r];return e},i.prototype.glyphsFor=function(e){var t,r,n,o,c,s,m;for(n={},c=0,s=e.length;c<s;c++)n[o=e[c]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(r=n[o])!=null&&r.compound&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(o in m=this.glyphsFor(t))r=m[o],n[o]=r;return n},i.prototype.encode=function(e,t){var r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue,ce;for(n in r=GF.encode(this.generateCmap(),"unicode"),c=this.glyphsFor(e),z={0:0},ce=r.charMap)z[(m=ce[n]).old]=m.new;for(ie in O=r.maxGlyphID,c)ie in z||(z[ie]=O++);return I=function(de){var be,Te;for(be in Te={},de)Te[de[be]]=be;return Te}(z),F=Object.keys(I).sort(function(de,be){return de-be}),ne=function(){var de,be,Te;for(Te=[],de=0,be=F.length;de<be;de++)s=F[de],Te.push(I[s]);return Te}(),o=this.font.glyf.encode(c,ne,z),x=this.font.loca.encode(o.offsets,ne),ue={cmap:this.font.cmap.raw(),glyf:o.table,loca:x,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(ue["OS/2"]=this.font.os2.raw()),this.font.directory.encode(ue)},i}();kr.API.PDFObject=function(){var i;function e(){}return i=function(t,r){return(Array(r+1).join("0")+t).slice(-r)},e.convert=function(t){var r,n,o,c;if(Array.isArray(t))return"["+function(){var s,m,x;for(x=[],s=0,m=t.length;s<m;s++)r=t[s],x.push(e.convert(r));return x}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+i(t.getUTCFullYear(),4)+i(t.getUTCMonth(),2)+i(t.getUTCDate(),2)+i(t.getUTCHours(),2)+i(t.getUTCMinutes(),2)+i(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(n in o=["<<"],t)c=t[n],o.push("/"+n+" "+e.convert(c));return o.push(">>"),o.join(`
`)}return""+t},e}(),function(i){var e={};function t(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=i,t.c=e,t.d=function(r,n,o){t.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},t.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,n){if(1&n&&(r=t(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var c in r)t.d(o,c,(function(s){return r[s]}).bind(null,c));return o},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="",t(t.s=0)}([function(i,e,t){i.exports=t(1)},function(i,e){function t(n,o){for(var c=0;c<o.length;c++){var s=o[c];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}var r=function(){function n(){(function(s,m){if(!(s instanceof m))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,c;return o=n,(c=[{key:"show",value:function(s){this.setOptions(s),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var s=document.getElementById("loading-overlay-stylesheet");s&&(s.disabled=!0,s.parentNode.removeChild(s),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(s){if(s!==void 0)for(var m in s)this.options[m]=s[m]}},{key:"generateAndAddOverlayElement",value:function(){var s="50%";this.options.offsetX!==0&&(s="calc(50% + "+this.options.offsetX+")");var m="50%";if(this.options.offsetY!==0&&(m="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var x='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(m,"; left: ").concat(s,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),I=document.getElementById(this.options.containerID);return I.style.position="relative",void I.insertAdjacentHTML("beforeend",x)}var F='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(m,"; left: ").concat(s,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",F)}},{key:"generateSpinnerElement",value:function(){var s=this,m=Object.keys(this.numberOfEmptyDivForSpinner).find(function(I){return I===s.options.spinnerIcon}),x=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[m]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(x,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var s=document.createElement("link");s.setAttribute("id","loading-overlay-stylesheet"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(s)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(s){for(var m="",x=1;x<=s;x++)m+="<div></div>";return m}}])&&t(o.prototype,c),n}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);const ad={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},py={in:"in",mm:"mm"},hg={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},gy={Landscape:"landscape",Portrait:"portrait"},zB={72:72,96:96,200:200,300:300,400:400};let $te=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hg.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ad.PNG.toString(),o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:py.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Ls(this,"map"),Ls(this,"width"),Ls(this,"height"),Ls(this,"dpi"),Ls(this,"format"),Ls(this,"unit"),Ls(this,"fileName"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=r,this.format=n,this.unit=o,this.fileName=c}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),r.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const s=o.sources;Object.keys(s).forEach(m=>{const x=s[m];Object.keys(x).forEach(I=>{x[I]||delete x[I]})})}const c=new qee.Map({container:n,style:o,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});c.once("idle",()=>{var s;const m=c.getCanvas(),x=`${this.fileName}.${e.format}`;switch(e.format){case ad.PNG:e.toPNG(m,x);break;case ad.JPEG:e.toJPEG(m,x);break;case ad.PDF:e.toPDF(c,x);break;case ad.SVG:e.toSVG(m,x);break;default:console.error(`Invalid file format: ${e.format}`);break}c.remove(),(s=r.parentNode)==null||s.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return t}}),r.remove(),JsLoadingOverlay.hide()})}toPNG(e,t){const r=document.createElement("a");r.href=e.toDataURL(),r.download=t,r.click(),r.remove()}toJPEG(e,t){const r=e.toDataURL("image/jpeg",.85);if(e.msToBlob){const n=this.toBlob(r);window.navigator.msSaveBlob(n,t)}else{const n=document.createElement("a");n.href=r,n.download=t,n.click(),n.remove()}}toPDF(e,t){const r=e.getCanvas(),n=new kr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:c}=e.getCenter();n.setProperties({title:e.getStyle().name,subject:`center: [${o}, ${c}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(t)}toSVG(e,t){const r=e.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),c=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${n}" height="${o}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(c)}`,s.download=t,s.click(),s.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===py.mm&&(t/=25.4),`${t*e}px`}toBlob(e){const t=atob(e.replace(/^.*,/,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return new Blob([r.buffer],{type:"image/png"})}},Kte=class{constructor(e){Ls(this,"map"),Ls(this,"width"),Ls(this,"height"),Ls(this,"unit"),Ls(this,"svgCanvas"),Ls(this,"svgPath");var t,r,n;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,c=(r=this.map)==null?void 0:r.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${o}px`),s.setAttribute("height",`${c}px`);const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("style","fill:#888888;stroke-width:0"),m.setAttribute("fill-opacity","0.5"),s.append(m),(n=this.map)==null||n.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=m}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=py.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),n=this.toPixels(this.height),o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,c=(t=this.map)==null?void 0:t.getCanvas().clientHeight,s=o/2-r/2,m=s+r,x=c/2-n/2,I=x+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${c}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${c} L 0 ${c} M ${s} ${x} L ${s} ${I} L ${m} ${I} L ${m} ${x}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===py.mm&&(t/=25.4),t*e}};const qF={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},Wte={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer"},Xte={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Zte={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen"},Jte={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},Yte={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar"},eie={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo"},tie={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати"},iie={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出"},rie={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出"},nie={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力"};let sie=class{constructor(e){Ls(this,"controlContainer"),Ls(this,"exportContainer"),Ls(this,"crosshair"),Ls(this,"printableArea"),Ls(this,"map"),Ls(this,"exportButton"),Ls(this,"options",{PageSize:hg.A4,PageOrientation:gy.Landscape,Format:ad.PDF,DPI:zB[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(hg),Filename:"map"}),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Zte;case"en":return qF;case"fr":return Wte;case"fi":return Xte;case"sv":return Jte;case"es":return Yte;case"vi":return eie;case"uk":return tie;case"zhHans":return iie;case"zhHant":return rie;case"ja":return nie;default:return qF}}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const n={};(t=this.options.AllowedSizes)==null||t.forEach(I=>{hg[I]&&(n[I]=hg[I])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(I,F)=>JSON.stringify(I[F]));r.appendChild(o);const c=this.createSelection(gy,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(I,F)=>I[F]);r.appendChild(c);const s=this.createSelection(ad,this.getTranslation().Format,"format-type",this.options.Format,(I,F)=>I[F]);r.appendChild(s);const m=this.createSelection(zB,this.getTranslation().DPI,"dpi-type",this.options.DPI,(I,F)=>I[F]);r.appendChild(m),this.exportContainer.appendChild(r);const x=document.createElement("button");return x.type="button",x.textContent=this.getTranslation().Generate,x.classList.add("generate-button"),x.addEventListener("click",()=>{const I=document.getElementById("mapbox-gl-export-page-size"),F=document.getElementById("mapbox-gl-export-page-orientation"),O=document.getElementById("mapbox-gl-export-format-type"),z=document.getElementById("mapbox-gl-export-dpi-type"),ie=F.value;let ne=JSON.parse(I.value);ie===gy.Portrait&&(ne=ne.reverse()),new $te(e,ne,Number(z.value),O.value,py.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(x),this.controlContainer}createSelection(e,t,r,n,o){const c=document.createElement("label");c.textContent=t;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${r}`),s.style.width="100%",Object.keys(e).forEach(F=>{const O=document.createElement("option");O.setAttribute("value",o(e,F)),O.appendChild(document.createTextNode(F)),O.setAttribute("name",r),n===e[F]&&(O.selected=!0),s.appendChild(O)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const m=document.createElement("TR"),x=document.createElement("TD"),I=document.createElement("TD");return x.appendChild(c),I.appendChild(s),m.appendChild(x),m.appendChild(I),m}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Wee(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Kte(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(e.value);t===gy.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}};var $F=aie,oie=Object.prototype.hasOwnProperty;function aie(){for(var i={},e=0;e<arguments.length;e++){var t=arguments[e];for(var r in t)oie.call(t,r)&&(i[r]=t[r])}return i}var KF={exports:{}};(function(i,e){(function(){var t={};i.exports=t,t.simpleFilter=function(r,n){return n.filter(function(o){return t.test(r,o)})},t.test=function(r,n){return t.match(r,n)!==null},t.match=function(r,n,o){o=o||{};var c=0,s=[],m=n.length,x=0,I=0,F=o.pre||"",O=o.post||"",z=o.caseSensitive&&n||n.toLowerCase(),ie;r=o.caseSensitive&&r||r.toLowerCase();for(var ne=0;ne<m;ne++)ie=n[ne],z[ne]===r[c]?(ie=F+ie+O,c+=1,I+=1+I):I=0,x+=I,s[s.length]=ie;return c===r.length?(x=z===r?1/0:x,{rendered:s.join(""),score:x}):null},t.filter=function(r,n,o){return!n||n.length===0?[]:typeof r!="string"?n:(o=o||{},n.reduce(function(c,s,m,x){var I=s;o.extract&&(I=o.extract(s));var F=t.match(r,I,o);return F!=null&&(c[c.length]={string:F.rendered,score:F.score,index:m,original:s}),c},[]).sort(function(c,s){var m=s.score-c.score;return m||c.index-s.index}))}})()})(KF);var lie=KF.exports,Ec=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Ec.prototype.show=function(){this.element.style.display="block"},Ec.prototype.hide=function(){this.element.style.display="none"},Ec.prototype.add=function(i){this.items.push(i)},Ec.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},Ec.prototype.isEmpty=function(){return!this.items.length},Ec.prototype.isVisible=function(){return this.element.style.display==="block"},Ec.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()},Ec.prototype.drawItem=function(i,e){var t=document.createElement("li"),r=document.createElement("a");e&&(t.className+=" active"),r.innerHTML=i.string,t.appendChild(r),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))},Ec.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()},Ec.prototype.move=function(i){this.active=i,this.draw()},Ec.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},Ec.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},Ec.prototype.drawError=function(i){var e=document.createElement("li");e.innerHTML=i,this.element.appendChild(e),this.show()};var cie=Ec,uie=$F,hie=lie,Aie=cie,Il=function(i,e,t){return t=t||{},this.options=uie({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=i,this.data=e||[],this.list=new Aie(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Il.prototype.handleKeyUp=function(i,e){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},Il.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},Il.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},Il.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(i.target.value)},100)}},Il.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},Il.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},Il.prototype.update=function(i){this.data=i,this.handleKeyUp()},Il.prototype.clear=function(){this.data=[],this.list.clear()},Il.prototype.normalize=function(i){return i=i.toLowerCase(),i},Il.prototype.match=function(i,e){return i.indexOf(e)>-1},Il.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},Il.prototype.getCandidates=function(i){var e={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},t;this.options.filter?(t=hie.filter(this.query,this.data,e),t=t.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):t=this.data.map((function(r){var n=this.render(r);return{original:r,string:n}}).bind(this)),i(t)},Il.prototype.getItemValue=function(i){return i},Il.prototype.render=function(i,e){if(e)return e;for(var t=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(t),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;t=t.slice(0,n)+"<strong>"+t.slice(n,o)+"</strong>"+t.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return t},Il.prototype.renderError=function(i){this.list.drawError(i)};var die=Il,WF=die,fie=WF;typeof window<"u"&&(window.Suggestions=WF);var pie="Expected a function",XF=NaN,gie="[object Symbol]",mie=/^\s+|\s+$/g,yie=/^[-+]0x[0-9a-f]+$/i,_ie=/^0b[01]+$/i,vie=/^0o[0-7]+$/i,bie=parseInt,xie=typeof Kd=="object"&&Kd&&Kd.Object===Object&&Kd,wie=typeof self=="object"&&self&&self.Object===Object&&self,Bie=xie||wie||Function("return this")(),Cie=Object.prototype,Eie=Cie.toString,Sie=Math.max,Tie=Math.min,QB=function(){return Bie.Date.now()};function Iie(i,e,t){var r,n,o,c,s,m,x=0,I=!1,F=!1,O=!0;if(typeof i!="function")throw new TypeError(pie);e=ZF(e)||0,VB(t)&&(I=!!t.leading,F="maxWait"in t,o=F?Sie(ZF(t.maxWait)||0,e):o,O="trailing"in t?!!t.trailing:O);function z(Ge){var $e=r,Ue=n;return r=n=void 0,x=Ge,c=i.apply(Ue,$e),c}function ie(Ge){return x=Ge,s=setTimeout(ce,e),I?z(Ge):c}function ne(Ge){var $e=Ge-m,Ue=Ge-x,lt=e-$e;return F?Tie(lt,o-Ue):lt}function ue(Ge){var $e=Ge-m,Ue=Ge-x;return m===void 0||$e>=e||$e<0||F&&Ue>=o}function ce(){var Ge=QB();if(ue(Ge))return de(Ge);s=setTimeout(ce,ne(Ge))}function de(Ge){return s=void 0,O&&r?z(Ge):(r=n=void 0,c)}function be(){s!==void 0&&clearTimeout(s),x=0,r=m=n=s=void 0}function Te(){return s===void 0?c:de(QB())}function je(){var Ge=QB(),$e=ue(Ge);if(r=arguments,n=this,m=Ge,$e){if(s===void 0)return ie(m);if(F)return s=setTimeout(ce,e),z(m)}return s===void 0&&(s=setTimeout(ce,e)),c}return je.cancel=be,je.flush=Te,je}function VB(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function Lie(i){return!!i&&typeof i=="object"}function Mie(i){return typeof i=="symbol"||Lie(i)&&Eie.call(i)==gie}function ZF(i){if(typeof i=="number")return i;if(Mie(i))return XF;if(VB(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=VB(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=i.replace(mie,"");var t=_ie.test(i);return t||vie.test(i)?bie(i.slice(2),t?2:8):yie.test(i)?XF:+i}var Pie=Iie,HB={exports:{}},Ag=typeof Reflect=="object"?Reflect:null,JF=Ag&&typeof Ag.apply=="function"?Ag.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},S1;Ag&&typeof Ag.ownKeys=="function"?S1=Ag.ownKeys:Object.getOwnPropertySymbols?S1=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:S1=function(e){return Object.getOwnPropertyNames(e)};function Fie(i){console&&console.warn&&console.warn(i)}var YF=Number.isNaN||function(e){return e!==e};function bs(){bs.init.call(this)}HB.exports=bs,HB.exports.once=Oie,bs.EventEmitter=bs,bs.prototype._events=void 0,bs.prototype._eventsCount=0,bs.prototype._maxListeners=void 0;var e4=10;function T1(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(bs,"defaultMaxListeners",{enumerable:!0,get:function(){return e4},set:function(i){if(typeof i!="number"||i<0||YF(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");e4=i}}),bs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},bs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||YF(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function t4(i){return i._maxListeners===void 0?bs.defaultMaxListeners:i._maxListeners}bs.prototype.getMaxListeners=function(){return t4(this)},bs.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var c;if(t.length>0&&(c=t[0]),c instanceof Error)throw c;var s=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw s.context=c,s}var m=o[e];if(m===void 0)return!1;if(typeof m=="function")JF(m,this,t);else for(var x=m.length,I=o4(m,x),r=0;r<x;++r)JF(I[r],this,t);return!0};function i4(i,e,t,r){var n,o,c;if(T1(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),c=o[e]),c===void 0)c=o[e]=t,++i._eventsCount;else if(typeof c=="function"?c=o[e]=r?[t,c]:[c,t]:r?c.unshift(t):c.push(t),n=t4(i),n>0&&c.length>n&&!c.warned){c.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=i,s.type=e,s.count=c.length,Fie(s)}return i}bs.prototype.addListener=function(e,t){return i4(this,e,t,!1)},bs.prototype.on=bs.prototype.addListener,bs.prototype.prependListener=function(e,t){return i4(this,e,t,!0)};function Die(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function r4(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=Die.bind(r);return n.listener=t,r.wrapFn=n,n}bs.prototype.once=function(e,t){return T1(t),this.on(e,r4(this,e,t)),this},bs.prototype.prependOnceListener=function(e,t){return T1(t),this.prependListener(e,r4(this,e,t)),this},bs.prototype.removeListener=function(e,t){var r,n,o,c,s;if(T1(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,c=r.length-1;c>=0;c--)if(r[c]===t||r[c].listener===t){s=r[c].listener,o=c;break}if(o<0)return this;o===0?r.shift():Rie(r,o),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},bs.prototype.off=bs.prototype.removeListener,bs.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),c;for(n=0;n<o.length;++n)c=o[n],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function n4(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?kie(n):o4(n,n.length)}bs.prototype.listeners=function(e){return n4(this,e,!0)},bs.prototype.rawListeners=function(e){return n4(this,e,!1)},bs.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):s4.call(i,e)},bs.prototype.listenerCount=s4;function s4(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}bs.prototype.eventNames=function(){return this._eventsCount>0?S1(this._events):[]};function o4(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function Rie(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function kie(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function Oie(i,e){return new Promise(function(t,r){function n(c){i.removeListener(e,o),r(c)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}a4(i,e,o,{once:!0}),e!=="error"&&Uie(i,n,{once:!0})})}function Uie(i,e,t){typeof i.on=="function"&&a4(i,"error",e,t)}function a4(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(o){r.once&&i.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var l4=HB.exports,Nie={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},zie={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},Qie={placeholder:zie},c4={exports:{}};(function(i){(function(e,t,r){i.exports?i.exports=r():e[t]=r()})(Kd,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(m){return m.match(t)||[]}function n(m){return r(m).filter(function(x,I){return x&&I})}function o(m){return m=r(m),{language:m[1]||e,extlang:m[2]||e,script:m[3]||e,region:m[4]||e}}function c(m,x,I){Object.defineProperty(m,x,{value:I,enumerable:!0})}function s(m,x,I){function F(O){return r(O)[m]||e}c(F,"pattern",x),c(o,I,F)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(o,"split",n),o})})(c4);var Vie=c4.exports,Hie=fie,Gie=Pie,Yc=$F,jie=l4.EventEmitter,u4=Nie,qie=Qie,$ie=Vie;function h4(i,e){this._eventEmitter=new jie,this.options=Yc({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}h4.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var s=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+s.splice(1,s.length).join(",")+"</div></div></div>"}else{var e=i.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),r=this.query.length,n=e.substring(0,t),o=e.substring(t,t+r),c=e.substring(t+r);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+o+"</span>"+c+"</div></div></div>"}},popupRender:function(i){var e=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function e(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=r.onAdd();n.appendChild(o)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)e(this,i);else if(typeof i=="string"){var t=document.querySelectorAll(i);if(t.length===0)throw new Error("Element ",i,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Gie(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(r),this._typeahead=new Hie(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(i,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var r=document.createElement("div");r.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var n=r.firstChild,o=n.firstChild;t.appendChild(o)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var e=(i.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(i){var e=27,t=9;if(i.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,n=r?r.value:"";if(!n)return this.fresh=!0,i.keyCode!==t&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[t,e,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),i.properties&&u4[i.properties.short_code])e=Yc({},this.options.flyTo),this._map&&this._map.fitBounds(u4[i.properties.short_code].bbox,e);else if(i.bbox){var t=i.bbox;e=Yc({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var r={zoom:this.options.zoom};e=Yc({},r,this.options.flyTo),i.center?e.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(e.center=i.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=i.reduce(function(r,n){return e.options[n]&&(["countries","types","language"].indexOf(n)>-1?r[n]=e.options[n].split(/[\s,]+/):r[n]=e.options[n],n==="proximity"&&e.options[n]&&typeof e.options[n].longitude=="number"&&typeof e.options[n].latitude=="number"&&(r[n]=[e.options[n].longitude,e.options[n].latitude])),r},{});return t},_geocode:function(i,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var c=i.split(/[\s(,)?]+/).map(function(x){return parseFloat(x,10)}).reverse();n.types&&n.types[0],n=Yc(n,{query:c,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=Yc(n,{query:i}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var s=[];this.options.localGeocoder&&(s=this.options.localGeocoder(i),s||(s=[]));var m=[];return o.catch((function(x){r=x}).bind(this)).then((function(x){this._loadingEl.style.display="none";var I={};return x?I=x:I={type:"FeatureCollection",features:[]},I.config=n,this.fresh&&(this.fresh=!1),I.features=I.features?s.concat(I.features):s,this.options.externalGeocoder?(m=this.options.externalGeocoder(i,I.features,n)||[],m.then(function(F){return I.features=I.features?F.concat(I.features):F,I},function(){return I})):I}).bind(this)).then((function(x){if(r)throw r;this.options.filter&&x.features.length&&(x.features=x.features.filter(this.options.filter));var I=[];x.suggestions?I=x.suggestions:x.place?I=[x.place]:I=x.features,I.length?(this._clearEl.style.display="block",this._typeahead.update(I),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(x.features.length>0||x.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",x)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",x))}).bind(this)).catch((function(x){this._loadingEl.style.display="none",s.length&&this.options.localGeocoder||m.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(s)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:x})}).bind(this)),o},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var e=this;i.relatedTarget&&e._clear(i)},_onQueryResult:function(i){var e=i;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],e=$ie.language(i),t=qie.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=Yc({},e,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(n){r.extend(n.geometry.coordinates)}),this._map.fitBounds(r.toArray(),t)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=Yc({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var r;if(this.options.popup){var n={},o=Yc({},n,this.options.popup);r=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=Yc({},e,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);t=Yc(t,{element:n})}var o=new this._maplibregl.Marker(Yc({},t,{element:n})),c;if(this.options.popup){var s={},m=Yc({},s,this.options.popup);c=new this._maplibregl.Popup(m).setHTML(this.options.popupRender(r))}r.center?(o.setLngLat(r.center).addTo(this._map),this.options.popup&&o.setPopup(c)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(o.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(c)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,e){return this._eventEmitter.on(i,e),this},off:function(i,e){return this._eventEmitter.removeListener(i,e),this}};var Kie=h4;const Wie=e_(Kie),I1={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},dg={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Ll={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2015.fgb",agrupacionsCensals2016:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2016.fgb",agrupacionsCensals2017:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2017.fgb",agrupacionsCensals2018:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2018.fgb",agrupacionsCensals2019:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2019.fgb",agrupacionsCensals2020:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2020.fgb",agrupacionsCensals2021:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2021.fgb",agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicials2019:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2019.fgb",areesBasiquesPolicials2020:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2020.fgb",areesBasiquesPolicials2022:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2022.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarques2022:"https://tilemaps.icgc.cat/vector/fgb/comarques_2022.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensals2002:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2002.fgb",districtesCensals2003:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2003.fgb",districtesCensals2004:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2004.fgb",districtesCensals2005:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2005.fgb",districtesCensals2006:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2006.fgb",districtesCensals2007:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2007.fgb",districtesCensals2008:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2008.fgb",districtesCensals2009:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2009.fgb",districtesCensals2010:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2010.fgb",districtesCensals2011:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2011.fgb",districtesCensals2012:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2012.fgb",districtesCensals2013:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2013.fgb",districtesCensals2014:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2014.fgb",districtesCensals2015:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2015.fgb",districtesCensals2016:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2016.fgb",districtesCensals2017:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2017.fgb",districtesCensals2018:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2018.fgb",districtesCensals2019:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2019.fgb",districtesCensals2020:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2020.fgb",districtesCensals2021:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2021.fgb",districtesCensals2022:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2022.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipis2022:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022.fgb",municipis2022Text:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorial2015:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_2015.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensals2002:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2002.fgb",seccionsCensals2003:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2003.fgb",seccionsCensals2004:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2004.fgb",seccionsCensals2005:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2005.fgb",seccionsCensals2006:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2006.fgb",seccionsCensals2007:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2007.fgb",seccionsCensals2008:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2008.fgb",seccionsCensals2009:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2009.fgb",seccionsCensals2010:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2010.fgb",seccionsCensals2011:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2011.fgb",seccionsCensals2012:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2012.fgb",seccionsCensals2013:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2013.fgb",seccionsCensals2014:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2014.fgb",seccionsCensals2015:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2015.fgb",seccionsCensals2016:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2016.fgb",seccionsCensals2017:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2017.fgb",seccionsCensals2018:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2018.fgb",seccionsCensals2019:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2019.fgb",seccionsCensals2020:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2020.fgb",seccionsCensals2021:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2021.fgb",seccionsCensals2022:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2022.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"},Vector:{altimetria:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf"}},co={mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:49,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:{0:{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},1:{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},2:{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},3:{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},4:{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},5:{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},6:{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}},urlTerrainICGC:{0:{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},1:{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}},ortoLayersICGC:{0:{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},1:{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},2:{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},3:{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},4:{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},5:{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},6:{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},7:{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},8:{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},9:{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},10:{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},11:{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},12:{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},13:{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},14:{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},15:{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},16:{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},17:{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},18:{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},19:{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},20:{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},21:{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},22:{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},23:{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},24:{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},25:{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},26:{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},27:{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},28:{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},29:{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},30:{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},31:{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},32:{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},33:{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},34:{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},35:{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},36:{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},37:{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},38:{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},39:{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},40:{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},41:{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},42:{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},43:{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},44:{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},45:{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}},vectorLayersICGC:{0:{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2015.fgb"},1:{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2016.fgb"},2:{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2017.fgb"},3:{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2018.fgb"},4:{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2019.fgb"},5:{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2020.fgb"},6:{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_2021.fgb"},7:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},8:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},9:{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2019.fgb"},10:{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2020.fgb"},11:{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_2022.fgb"},12:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},13:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},14:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},15:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},16:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},17:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},18:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},19:{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},20:{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},21:{name:"comarques2022",key:"comarques_2022",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_2022.fgb"},22:{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},23:{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},24:{name:"districtesCensals2002",key:"districtes_censals_2002",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2002.fgb"},25:{name:"districtesCensals2003",key:"districtes_censals_2003",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2003.fgb"},26:{name:"districtesCensals2004",key:"districtes_censals_2004",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2004.fgb"},27:{name:"districtesCensals2005",key:"districtes_censals_2005",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2005.fgb"},28:{name:"districtesCensals2006",key:"districtes_censals_2006",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2006.fgb"},29:{name:"districtesCensals2007",key:"districtes_censals_2007",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2007.fgb"},30:{name:"districtesCensals2008",key:"districtes_censals_2008",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2008.fgb"},31:{name:"districtesCensals2009",key:"districtes_censals_2009",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2009.fgb"},32:{name:"districtesCensals2010",key:"districtes_censals_2010",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2010.fgb"},33:{name:"districtesCensals2011",key:"districtes_censals_2011",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2011.fgb"},34:{name:"districtesCensals2012",key:"districtes_censals_2012",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2012.fgb"},35:{name:"districtesCensals2013",key:"districtes_censals_2013",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2013.fgb"},36:{name:"districtesCensals2014",key:"districtes_censals_2014",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2014.fgb"},37:{name:"districtesCensals2015",key:"districtes_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2015.fgb"},38:{name:"districtesCensals2016",key:"districtes_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2016.fgb"},39:{name:"districtesCensals2017",key:"districtes_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2017.fgb"},40:{name:"districtesCensals2018",key:"districtes_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2018.fgb"},41:{name:"districtesCensals2019",key:"districtes_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2019.fgb"},42:{name:"districtesCensals2020",key:"districtes_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2020.fgb"},43:{name:"districtesCensals2021",key:"districtes_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2021.fgb"},44:{name:"districtesCensals2022",key:"districtes_censals_2022",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_2022.fgb"},45:{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},46:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},47:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},48:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},49:{name:"municipis2022",key:"municipis_2022",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022.fgb"},50:{name:"municipis2022Text",key:"municipis_2022_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_2022_text.fgb"},51:{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},52:{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},53:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},54:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},55:{name:"plaTerritorial2015",key:"pla_territorial_2015",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_2015.fgb"},56:{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},57:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},58:{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},59:{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},60:{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},61:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},62:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},63:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},64:{name:"seccionsCensals2002",key:"seccions_censals_2002",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2002.fgb"},65:{name:"seccionsCensals2003",key:"seccions_censals_2003",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2003.fgb"},66:{name:"seccionsCensals2004",key:"seccions_censals_2004",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2004.fgb"},67:{name:"seccionsCensals2005",key:"seccions_censals_2005",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2005.fgb"},68:{name:"seccionsCensals2006",key:"seccions_censals_2006",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2006.fgb"},69:{name:"seccionsCensals2007",key:"seccions_censals_2007",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2007.fgb"},70:{name:"seccionsCensals2008",key:"seccions_censals_2008",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2008.fgb"},71:{name:"seccionsCensals2009",key:"seccions_censals_2009",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2009.fgb"},72:{name:"seccionsCensals2010",key:"seccions_censals_2010",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2010.fgb"},73:{name:"seccionsCensals2011",key:"seccions_censals_2011",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2011.fgb"},74:{name:"seccionsCensals2012",key:"seccions_censals_2012",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2012.fgb"},75:{name:"seccionsCensals2013",key:"seccions_censals_2013",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2013.fgb"},76:{name:"seccionsCensals2014",key:"seccions_censals_2014",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2014.fgb"},77:{name:"seccionsCensals2015",key:"seccions_censals_2015",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2015.fgb"},78:{name:"seccionsCensals2016",key:"seccions_censals_2016",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2016.fgb"},79:{name:"seccionsCensals2017",key:"seccions_censals_2017",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2017.fgb"},80:{name:"seccionsCensals2018",key:"seccions_censals_2018",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2018.fgb"},81:{name:"seccionsCensals2019",key:"seccions_censals_2019",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2019.fgb"},82:{name:"seccionsCensals2020",key:"seccions_censals_2020",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2020.fgb"},83:{name:"seccionsCensals2021",key:"seccions_censals_2021",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2021.fgb"},84:{name:"seccionsCensals2022",key:"seccions_censals_2022",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_2022.fgb"},85:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},86:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},87:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},88:{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},89:{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}},vectorLayers:{0:{key:"altimetria",layer:"",url:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf"}},wmsLayers:{0:{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},1:{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},2:{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},3:{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},4:{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},5:{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},6:{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};let Xie=class{constructor(e){if(!e)e=co.mapOptions;else for(const t in co.mapOptions){let r=[co.mapOptions.center[0],co.mapOptions.center[1]];co.mapOptions.center=r,e.hasOwnProperty(t)||(e[t]=co.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new Jl.Map(e),this.map.options=e,this.map.addControl(new Jl.AttributionControl({compact:!0})),this.map.on("load",async()=>{if(window.document.querySelector(".maplibregl-compact-show")){var t=window.document.querySelector(".maplibregl-compact-show");t.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}_3DFyStyle(e){this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]==="place"&&t.minzoom>=15&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-8]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","top"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setLayoutProperty(r,"visibility","visible"),this.map.setPaintProperty(r,"text-color","#ff0000")}})}async _dealOrto3dStyle(e){try{if(e=="orto3d"){const t=await this.map.loadImage(co.map3dOptions.imageIcon);this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const r=new D3({intensity:4}),n=new Kw({ambientLight:r});this.map.setTerrain({source:co.map3dOptions.terrainSource,exaggeration:co.map3dOptions.exaggeration});const o=this._createCitiesMapboxLayer();this.map.getLayer(co.map3dOptions.layerId3d)||(this.map.addLayer(o,co.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(co.map3dOptions.layerId3d,co.map3dOptions.minZoomRange,co.map3dOptions.maxZoomRange),o.deck.setProps({effects:[n]}),console.info(t),this._3DFyStyle(t))}else this.map.getLayer(co.map3dOptions.layerId3d)&&(this.map.removeLayer(co.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_createCitiesMapboxLayer(){try{return new VK({id:co.map3dOptions.layerId3d,type:yB,data:co.map3dOptions.urlTilesetCities,loader:mB,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!1,maximumScreenSpaceError:co.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=co.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=co.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}addGeocoderICGC(e){try{e===void 0&&(e="top-right");const t="https://eines.icgc.cat/geocodificador/autocompletar?text=";let r={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Jl,showResultsWhileTyping:!0,minLength:2};const n={forwardGeocode:async c=>{const s=[];try{const m=`https://nominatim.openstreetmap.org/search?q=${c.query}&format=geojson&polygon_geojson=1&addressdetails=1`,x=t+encodeURIComponent(c.query)+"&layers=topo1%2Ctopo2%2Caddress&size=5",F=await(await fetch(x)).json();for(const O of F.features){const z=O.geometry.coordinates,ie={type:"Feature",geometry:{type:"Point",coordinates:z},place_name:O.properties.label,properties:O.properties,text:O.properties.label,place_type:["place"],center:z};s.push(ie)}}catch(m){console.error(`Failed to forwardGeocode with error: ${m}`)}return{features:s}}};this.map.addControl(new Wie(n,r),e);let o=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");o[0].attributes[2].nodeValue="Cerca...",o[0].addEventListener("input",function(c){c.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(r){console.error(`Error getting addImage: ${r.message}`)}}getConfigStyles(){try{let e=[];for(const t of dg)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Ll.WMS)Ll.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Ll.Orto)Ll.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Ll.Vector)Ll.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Ll.VectorAdmin)Ll.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}async fetchData(e,t,r){try{const o=await(await fetch(e)).json();let c=o.features[0].geometry.type;c.includes("ine")&&(r!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),c.includes("olygon")&&(r!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),c.includes("oint")&&(r!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}}))}catch(n){console.error(`Error fetching data: ${n.message}`)}}async fetchDataAndMenu(e,t,r,n){try{const c=await(await fetch(e)).json(),s=document.getElementById("menu-group");if(r!=="all"){const x=document.createElement("div");x.id="titleDivMenu",x.textContent=t,s.appendChild(x);const I=document.createElement("div");I.id="titleDivMenuSub",I.textContent=`📂 ${r}`,s.appendChild(I)}let m=c.features[0].geometry.type;if(r==="all")m.includes("ine")&&(n!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"line",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),m.includes("olygon")&&(n!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),m.includes("oint")&&(n!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:c},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}})),map.addMenuItem(t);else{let x=r;const I={};c.features.forEach(F=>{const O=F.properties[x];I[O]||(m.includes("ine")&&(n!==void 0?map.addLayer({id:O,type:"line",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:n}):map.addLayer({id:O,type:"line",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:{"line-color":"black","line-width":2,"line-opacity":1}})),m.includes("olygon")&&(n!==void 0?map.addLayer({id:O,type:"fill",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:n}):map.addLayer({id:O,type:"fill",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:{"fill-color":"blue","fill-opacity":.6}})),m.includes("oint")&&(n!==void 0?map.addLayer({id:O,type:"circle",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:n}):map.addLayer({id:O,type:"circle",source:{type:"geojson",data:c},layout:{visibility:"visible"},filter:["==",`${x}`,O],paint:{"circle-color":"red","circle-opacity":.85}})),I[O]=!0,map.addMenuItem(O))})}}catch(o){console.error(`Error fetching data: ${o.message}`)}}on(e,t){try{this.map.on(e,t)}catch(r){console.error(`Error adding event listener: ${r.message}`)}}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}}setStyle(e,t){try{console.log("kk",e),console.log("base",e),t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,r){try{return this.map.setFilter(e,t,r)}catch(n){console.error(`Error setting filter: ${n.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,r){try{this.map.setLayoutProperty(e,t,r)}catch(n){console.error(`Error setting layout property: ${n.message}`)}}setPaintProperty(e,t,r){try{this.map.setPaintProperty(e,t,r)}catch(n){console.error(`Error setting paint property: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(){try{this.map.on("mousemove",function(e){const t=e.lngLat.lat,n="Lon/Lat (WGS 84)   Lon: "+e.lngLat.lng.toFixed(6)+"  Lat: "+t.toFixed(6),o=document.getElementById("divInfo"),c=document.createElement("div");c.className="coordControl",c.innerHTML=n+" - ZL: "+map.getZoom().toFixed(1),o.appendChild(c)})}catch(e){console.error(`Error adding mouse coordinate control: ${e.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Jl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Jl.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,r){try{return this.map.setLayerZoomRange(e,t,r)}catch(n){console.error(`Error setting terrain: ${n.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addLayerGeoJSON(e){try{this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}-sourceIcgcMap`,layout:e.layout,paint:e.paint})}catch(t){console.error(`Error adding GeoJSON layer: ${t.message}`)}}addLayerWMS(e){try{console.log("holaaddlayerwms",e),this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"raster",tiles:[e.tiles],tileSize:256}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:"raster",source:`${e.id}-sourceIcgcMap`,paint:{}})}catch(t){console.error(`Error adding WMS layer: ${t.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e){try{const t=document.createElement("img");t.src=e.url,t.style.height="62px";const r=document.getElementById("logos"),n=document.createElement("a");n.id=e.id,n.href=e.href,n.target="_blank",n.style.position="relative",n.style.bottom="1px",n.appendChild(t),r.appendChild(n)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=n=>{this.map.setStyle(n)},r=document.getElementById("basemap-group");for(const n of e)for(const o of Object.keys(co.baseStyles)){const c=co.baseStyles[o];if(n===c.url){const s=document.createElement("div");s.className="basemap-item",s.title=c.key,s.style.backgroundImage=`url('${c.image}')`,r.appendChild(s),s.addEventListener("click",()=>t(c.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=n=>{console.log("base",n),this.map.setStyle(n.url)},r=document.getElementById("basemap-group");e.forEach(n=>{const o=document.createElement("div");o.className="basemap-item",o.title=n.label,o.style.backgroundImage=`url('${n.image}')`,r.appendChild(o),o.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t){try{let r;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let o=this.map.queryRenderedFeatures(n.point);if(o&&o[0].source===e){let c=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0){if(t!==null){let s="";t.forEach(m=>{let x=o[0].properties[m];s=s+`<h4>${x}</h4>`}),r=s,map.addPopup(c,r)}}else{let s="";for(const m in o[0].properties)s+="<b>"+m+"</b>:"+o[0].properties[m]+"<br>";r=s,map.addPopup(c,r)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(e,t){try{var r=new Jl.ScaleControl(e);this.map.addControl(r,t)}catch(n){console.error(`Error adding scale: ${n.message}`)}}removeMeasureControl(){try{const e=document.getElementById("xButton"),t=document.getElementById("distance");t.innerHTML="";let r=this.map.getStyle().layers;for(let n=0;n<r.length;n++)r[n].id.includes("measure")&&this.map.removeLayer(r[n].id)}catch(e){console.error(`Error removing measure control: ${e.message}`)}}addMeasureControl(){try{let x=function(F,O){const z=O.queryRenderedFeatures(F.point,{layers:["measure-points"]});if(s.features.length>1&&s.features.pop(),r.innerHTML="",z.length){const ue=z[0].properties.id;s.features=s.features.filter(ce=>ce.properties.id!==ue)}else{const ue={type:"Feature",geometry:{type:"Point",coordinates:[F.lngLat.lng,F.lngLat.lat]},properties:{id:String(new Date().getTime())}};s.features.push(ue)}m.geometry.coordinates=s.features.map(ue=>ue.geometry.coordinates),s.features.push(m);const ie=document.createElement("pre");ie.textContent=`Distància total: ${turf.length(m).toLocaleString()}km`,r.appendChild(ie);const ne=document.createElement("div");ne.id="xButton",ne.textContent="X",ne.onclick=()=>{try{const ue=document.getElementById("xButton"),ce=document.getElementById("distance");ce.innerHTML="";let de=O.getStyle().layers;for(let be=0;be<de.length;be++)de[be].id.includes("measure")&&O.removeLayer(de[be].id)}catch(ue){console.error(`Error adding measure control: ${ue.message}`)}},r.appendChild(ne),O.getSource("geojson").setData(s)},I=function(F,O){O.getCanvas().style.cursor="grab",n=!0};const t=document.getElementById("distance"),r=document.getElementById("distanceTotal");let n=!1,o=!1;var e;const c=document.createElement("div");c.id="rulerButton",c.onclick=()=>{try{o?document.getElementById("rulerButton").style.backgroundColor="#ff597a":document.getElementById("rulerButton").style.backgroundColor="#41b883",o=!o}catch(F){console.error(`Error adding measure control: ${F.message}`)}},r.appendChild(c);const s={type:"FeatureCollection",features:[]},m={type:"Feature",geometry:{type:"LineString",coordinates:[]}};this.map.addSource("geojson",{type:"geojson",data:s}),this.map.addLayer({id:"measure-points",type:"circle",source:"geojson",paint:{"circle-radius":5,"circle-color":"#000"},filter:["in","$type","Point"]}),this.map.addLayer({id:"measure-lines",type:"line",source:"geojson",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":2.5},filter:["in","$type","LineString"]}),this.map.on("click",F=>{clearTimeout(e),!n&&o&&(e=setTimeout(()=>{x(F,this.map)},50))}),this.map.on("dblclick",F=>{o&&(clearTimeout(e),I(F,this.map))}),this.map.on("mousemove",F=>{if(!n&&o){const O=this.map.queryRenderedFeatures(F.point,{layers:["measure-points"]});this.map.getCanvas().style.cursor=O.length?"pointer":"crosshair"}else this.map.getCanvas().style.cursor="grab"})}catch{}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:hg.A4,PageOrientation:gy.Landscape,Format:ad.PNG,DPI:zB[300],Crosshair:!0,PrintableArea:!0},t="top-right"),map.addControl(new sie(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addPopup(e,t){try{new Jl.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,r;return e.text===void 0?t=new Jl.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new Jl.Popup({offset:e.textOffset}).setText(e.text),t=new Jl.Marker().setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t){try{return new Jl.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Jl.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{if(e.length>0){const t=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=e,r.checked=!0,t.appendChild(r);const n=document.createElement("label");n.setAttribute("for",e),n.textContent=e,t.appendChild(n),r.addEventListener("change",o=>{this.map.setLayoutProperty(e,"visibility",o.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const r=document.getElementById("filter-group"),n=this.map.getStyle().layers;let o;for(let c=0;c<n.length;c++)if(n[c].type==="symbol"){o=n[c].id;break}this.map.addSource(`${e.id}-source`,{type:e.type,data:t}),t.features.forEach(c=>{const s=c.properties.icon,m=`poi-${s}`;if(!this.map.getLayer(m)){this.map.addLayer({id:m,type:"circle",source:`${e.id}-source`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",s]},o);const x=document.createElement("input");x.type="checkbox",x.id=m,x.checked=!0,r.appendChild(x);const I=document.createElement("label");I.setAttribute("for",m),I.textContent=s,r.appendChild(I),x.addEventListener("change",F=>{this.map.setLayoutProperty(m,"visibility",F.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Jl.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Jl.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e){try{this.map.addControl(new Jl.AttributionControl(e.options),e.position)}catch(t){console.error(`Error adding attribution control: ${t.message}`)}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in dg)if(dg.hasOwnProperty(t)){const r=dg[t];if(t===e)return r}return dg[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}addImageLayerICGC(e){try{let r=function(o,c,s,m,x){console.log("hola",e);const I=[c,s,m,x];for(const F of I)for(const[O,z]of Object.entries(F))if(z===o)return O;return null};console.log("name",e);let t=null;t=r(e,Ll.Orto,Ll.VectorAdmin,Ll.WMS,Ll.Vector),console.log("op",t),t||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let n={id:t,tiles:e};console.log("source",n),this.addLayerWMS(n)}catch(t){console.error(`Error adding ICGC image layer: ${t.message}`)}}async addVectorLayerICGC(e){try{let r=function(n){for(const o in Ll.VectorAdmin)if(Ll.VectorAdmin.hasOwnProperty(o)&&Ll.VectorAdmin[o]===n)return o;return null}(e);if(r===null)console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",r,"font-weight: bold; font-style: italic;");else{const n=await fetch(e),o={type:"FeatureCollection",features:[]};for await(const s of flatgeobuf.deserialize(n.body))o.features.push(s);let c=r+"-source";this.map.addSource(c,{type:"geojson",data:o}),e.includes("text")?this.map.addLayer({id:r+"-text",type:"symbol",source:c,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:"visible","text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}}):(this.map.addLayer({id:r+"-fill",type:"fill",source:c,paint:{"fill-color":"#0000FF","fill-opacity":0}}),this.map.addLayer({id:r+"-underline",type:"line",source:c,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}}),this.map.addLayer({id:r+"-line",type:"line",source:c,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}}))}}catch(t){console.error(`Error adding ICGC vector layer: ${t.message}`)}}addTerrainICGC(e,t){try{let r;for(const o in I1)if(I1.hasOwnProperty(o)){const c=I1[o];c===e&&(r=c)}let n=r;e.includes("terrarium")?this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,maxzoom:16}),this.map.setTerrain({source:"terrainICGC-src",exaggeration:1.5}),t===void 0&&(t="top-right"),this.map.addControl(new hN({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}};var A4={exports:{}};function Zie(i,e){var t=i.getCenter(),r=i.getZoom(),n=i.getBearing(),o=i.getPitch();e.forEach(function(c){c.jumpTo({center:t,zoom:r,bearing:n,pitch:o})})}function Jie(){var i,e=arguments.length;if(e===1)i=arguments[0];else{i=[];for(var t=0;t<e;t++)i.push(arguments[t])}var r=[];i.forEach(function(s,m){r[m]=c.bind(null,s,i.filter(function(x,I){return I!==m}))});function n(){i.forEach(function(s,m){s.on("move",r[m])})}function o(){i.forEach(function(s,m){s.off("move",r[m])})}function c(s,m){o(),Zie(s,m),n()}return n(),function(){o(),r=[],i=[]}}var Yie=Jie;(function(i){var e=Yie,t=l4.EventEmitter;function r(n,o,c,s){if(this.options=s||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof c=="string"&&document.body.querySelectorAll){var m=document.body.querySelectorAll(c)[0];if(!m)throw new Error("Cannot find element with specified container selector.");m.appendChild(this._controlContainer)}else if(c instanceof Element&&c.appendChild)c.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var x=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(x),this._clearSync=e(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var c=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",s=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=c,this._mapB.getContainer().style.clip=s,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(A4);var ere=A4.exports;const tre=e_(ere);class ire{constructor(e,t,r,n){this.mapCompare=new tre(e.map,t.map,r,{})}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var GB=function(i,e){return GB=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},GB(i,e)};function rh(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");GB(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var jB=function(){return jB=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},jB.apply(this,arguments)};function rc(i,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function s(I){try{x(r.next(I))}catch(F){c(F)}}function m(I){try{x(r.throw(I))}catch(F){c(F)}}function x(I){I.done?o(I.value):n(I.value).then(s,m)}x((r=r.apply(i,e||[])).next())})}function Ml(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(x){return function(I){return m([x,I])}}function m(x){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=x[0]&2?n.return:x[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,x[1])).done)return o;switch(n=0,o&&(x=[x[0]&2,o.value]),x[0]){case 0:case 1:o=x;break;case 4:return t.label++,{value:x[1],done:!1};case 5:t.label++,n=x[1],x=[0];continue;case 7:x=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(x[0]===6||x[0]===2)){t=0;continue}if(x[0]===3&&(!o||x[1]>o[0]&&x[1]<o[3])){t.label=x[1];break}if(x[0]===6&&t.label<o[1]){t.label=o[1],o=x;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(x);break}o[2]&&t.ops.pop(),t.trys.pop();continue}x=e.call(i,t)}catch(I){x=[6,I],n=0}finally{r=o=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function L1(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,o;r<n;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||e)}for(var xA=function(){function i(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return i.prototype.add=function(e,t,r,n){return new i(this.left+e,this.top+t,this.width+r,this.height+n)},i.fromClientRect=function(e,t){return new i(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},i.fromDOMRectList=function(e,t){var r=Array.from(t).find(function(n){return n.width!==0});return r?new i(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):i.EMPTY},i.EMPTY=new i(0,0,0,0),i}(),M1=function(i,e){return xA.fromClientRect(i,e.getBoundingClientRect())},rre=function(i){var e=i.body,t=i.documentElement;if(!e||!t)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new xA(0,0,r,n)},P1=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Go=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var c=i[n];c<=65535?r.push(c):(c-=65536,r.push((c>>10)+55296,c%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},d4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nre=typeof Uint8Array>"u"?[]:new Uint8Array(256),F1=0;F1<d4.length;F1++)nre[d4.charCodeAt(F1)]=F1;for(var f4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",my=typeof Uint8Array>"u"?[]:new Uint8Array(256),D1=0;D1<f4.length;D1++)my[f4.charCodeAt(D1)]=D1;for(var sre=function(i){var e=i.length*.75,t=i.length,r,n=0,o,c,s,m;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var x=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),I=Array.isArray(x)?x:new Uint8Array(x);for(r=0;r<t;r+=4)o=my[i.charCodeAt(r)],c=my[i.charCodeAt(r+1)],s=my[i.charCodeAt(r+2)],m=my[i.charCodeAt(r+3)],I[n++]=o<<2|c>>4,I[n++]=(c&15)<<4|s>>2,I[n++]=(s&3)<<6|m&63;return x},ore=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},are=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},gf=5,qB=11,$B=2,lre=qB-gf,p4=65536>>gf,cre=1<<gf,KB=cre-1,ure=1024>>gf,hre=p4+ure,Are=hre,dre=32,fre=Are+dre,pre=65536>>qB,gre=1<<lre,mre=gre-1,g4=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},yre=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},_re=function(i,e){var t=sre(i),r=Array.isArray(t)?are(t):new Uint32Array(t),n=Array.isArray(t)?ore(t):new Uint16Array(t),o=24,c=g4(n,o/2,r[4]/2),s=r[5]===2?g4(n,(o+r[4])/2):yre(r,Math.ceil((o+r[4])/4));return new vre(r[0],r[1],r[2],r[3],c,s)},vre=function(){function i(e,t,r,n,o,c){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=c}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>gf],t=(t<<$B)+(e&KB),this.data[t];if(e<=65535)return t=this.index[p4+(e-55296>>gf)],t=(t<<$B)+(e&KB),this.data[t];if(e<this.highStart)return t=fre-pre+(e>>qB),t=this.index[t],t+=e>>gf&mre,t=this.index[t],t=(t<<$B)+(e&KB),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),m4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bre=typeof Uint8Array>"u"?[]:new Uint8Array(256),R1=0;R1<m4.length;R1++)bre[m4.charCodeAt(R1)]=R1;var xre="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",y4=50,wre=1,_4=2,v4=3,Bre=4,Cre=5,b4=7,x4=8,w4=9,ld=10,WB=11,B4=12,XB=13,Ere=14,yy=15,ZB=16,k1=17,_y=18,Sre=19,C4=20,JB=21,vy=22,YB=23,fg=24,eu=25,by=26,xy=27,pg=28,Tre=29,gg=30,Ire=31,O1=32,U1=33,eC=34,tC=35,iC=36,wy=37,rC=38,N1=39,z1=40,nC=41,E4=42,Lre=43,Mre=[9001,65288],S4="!",nc="×",Q1="÷",sC=_re(xre),wA=[gg,iC],oC=[wre,_4,v4,Cre],T4=[ld,x4],I4=[xy,by],Pre=oC.concat(T4),L4=[rC,N1,z1,eC,tC],Fre=[yy,XB],Dre=function(i,e){e===void 0&&(e="strict");var t=[],r=[],n=[];return i.forEach(function(o,c){var s=sC.get(o);if(s>y4?(n.push(!0),s-=y4):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(o)!==-1)return r.push(c),t.push(ZB);if(s===Bre||s===WB){if(c===0)return r.push(c),t.push(gg);var m=t[c-1];return Pre.indexOf(m)===-1?(r.push(r[c-1]),t.push(m)):(r.push(c),t.push(gg))}if(r.push(c),s===Ire)return t.push(e==="strict"?JB:wy);if(s===E4||s===Tre)return t.push(gg);if(s===Lre)return o>=131072&&o<=196605||o>=196608&&o<=262141?t.push(wy):t.push(gg);t.push(s)}),[r,t,n]},aC=function(i,e,t,r){var n=r[t];if(Array.isArray(i)?i.indexOf(n)!==-1:i===n)for(var o=t;o<=r.length;){o++;var c=r[o];if(c===e)return!0;if(c!==ld)break}if(n===ld)for(var o=t;o>0;){o--;var s=r[o];if(Array.isArray(i)?i.indexOf(s)!==-1:i===s)for(var m=t;m<=r.length;){m++;var c=r[m];if(c===e)return!0;if(c!==ld)break}if(s!==ld)break}return!1},M4=function(i,e){for(var t=i;t>=0;){var r=e[t];if(r===ld)t--;else return r}return 0},Rre=function(i,e,t,r,n){if(t[r]===0)return nc;var o=r-1;if(Array.isArray(n)&&n[o]===!0)return nc;var c=o-1,s=o+1,m=e[o],x=c>=0?e[c]:0,I=e[s];if(m===_4&&I===v4)return nc;if(oC.indexOf(m)!==-1)return S4;if(oC.indexOf(I)!==-1||T4.indexOf(I)!==-1)return nc;if(M4(o,e)===x4)return Q1;if(sC.get(i[o])===WB||(m===O1||m===U1)&&sC.get(i[s])===WB||m===b4||I===b4||m===w4||[ld,XB,yy].indexOf(m)===-1&&I===w4||[k1,_y,Sre,fg,pg].indexOf(I)!==-1||M4(o,e)===vy||aC(YB,vy,o,e)||aC([k1,_y],JB,o,e)||aC(B4,B4,o,e))return nc;if(m===ld)return Q1;if(m===YB||I===YB)return nc;if(I===ZB||m===ZB)return Q1;if([XB,yy,JB].indexOf(I)!==-1||m===Ere||x===iC&&Fre.indexOf(m)!==-1||m===pg&&I===iC||I===C4||wA.indexOf(I)!==-1&&m===eu||wA.indexOf(m)!==-1&&I===eu||m===xy&&[wy,O1,U1].indexOf(I)!==-1||[wy,O1,U1].indexOf(m)!==-1&&I===by||wA.indexOf(m)!==-1&&I4.indexOf(I)!==-1||I4.indexOf(m)!==-1&&wA.indexOf(I)!==-1||[xy,by].indexOf(m)!==-1&&(I===eu||[vy,yy].indexOf(I)!==-1&&e[s+1]===eu)||[vy,yy].indexOf(m)!==-1&&I===eu||m===eu&&[eu,pg,fg].indexOf(I)!==-1)return nc;if([eu,pg,fg,k1,_y].indexOf(I)!==-1)for(var F=o;F>=0;){var O=e[F];if(O===eu)return nc;if([pg,fg].indexOf(O)!==-1)F--;else break}if([xy,by].indexOf(I)!==-1)for(var F=[k1,_y].indexOf(m)!==-1?c:o;F>=0;){var O=e[F];if(O===eu)return nc;if([pg,fg].indexOf(O)!==-1)F--;else break}if(rC===m&&[rC,N1,eC,tC].indexOf(I)!==-1||[N1,eC].indexOf(m)!==-1&&[N1,z1].indexOf(I)!==-1||[z1,tC].indexOf(m)!==-1&&I===z1||L4.indexOf(m)!==-1&&[C4,by].indexOf(I)!==-1||L4.indexOf(I)!==-1&&m===xy||wA.indexOf(m)!==-1&&wA.indexOf(I)!==-1||m===fg&&wA.indexOf(I)!==-1||wA.concat(eu).indexOf(m)!==-1&&I===vy&&Mre.indexOf(i[s])===-1||wA.concat(eu).indexOf(I)!==-1&&m===_y)return nc;if(m===nC&&I===nC){for(var z=t[o],ie=1;z>0&&(z--,e[z]===nC);)ie++;if(ie%2!==0)return nc}return m===O1&&I===U1?nc:Q1},kre=function(i,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=Dre(i,e.lineBreak),r=t[0],n=t[1],o=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(s){return[eu,gg,E4].indexOf(s)!==-1?wy:s}));var c=e.wordBreak==="keep-all"?o.map(function(s,m){return s&&i[m]>=19968&&i[m]<=40959}):void 0;return[r,n,c]},Ore=function(){function i(e,t,r,n){this.codePoints=e,this.required=t===S4,this.start=r,this.end=n}return i.prototype.slice=function(){return Go.apply(void 0,this.codePoints.slice(this.start,this.end))},i}(),Ure=function(i,e){var t=P1(i),r=kre(t,e),n=r[0],o=r[1],c=r[2],s=t.length,m=0,x=0;return{next:function(){if(x>=s)return{done:!0,value:null};for(var I=nc;x<s&&(I=Rre(t,o,n,++x,c))===nc;);if(I!==nc||x===s){var F=new Ore(t,I,m,x);return m=x,{value:F,done:!1}}return{done:!0,value:null}}}},Nre=1,zre=2,By=4,P4=8,V1=10,F4=47,Cy=92,Qre=9,Vre=32,H1=34,Ey=61,Hre=35,Gre=36,jre=37,G1=39,j1=40,Sy=41,qre=95,Sc=45,$re=33,Kre=60,Wre=62,Xre=64,Zre=91,Jre=93,Yre=61,ene=123,q1=63,tne=125,D4=124,ine=126,rne=128,R4=65533,lC=42,mf=43,nne=44,sne=58,one=59,Ty=46,ane=0,lne=8,cne=11,une=14,hne=31,Ane=127,Vh=-1,k4=48,O4=97,U4=101,dne=102,fne=117,pne=122,N4=65,z4=69,Q4=70,gne=85,mne=90,sc=function(i){return i>=k4&&i<=57},yne=function(i){return i>=55296&&i<=57343},mg=function(i){return sc(i)||i>=N4&&i<=Q4||i>=O4&&i<=dne},_ne=function(i){return i>=O4&&i<=pne},vne=function(i){return i>=N4&&i<=mne},bne=function(i){return _ne(i)||vne(i)},xne=function(i){return i>=rne},$1=function(i){return i===V1||i===Qre||i===Vre},K1=function(i){return bne(i)||xne(i)||i===qre},V4=function(i){return K1(i)||sc(i)||i===Sc},wne=function(i){return i>=ane&&i<=lne||i===cne||i>=une&&i<=hne||i===Ane},cd=function(i,e){return i!==Cy?!1:e!==V1},W1=function(i,e,t){return i===Sc?K1(e)||cd(e,t):K1(i)?!0:!!(i===Cy&&cd(i,e))},cC=function(i,e,t){return i===mf||i===Sc?sc(e)?!0:e===Ty&&sc(t):sc(i===Ty?e:i)},Bne=function(i){var e=0,t=1;(i[e]===mf||i[e]===Sc)&&(i[e]===Sc&&(t=-1),e++);for(var r=[];sc(i[e]);)r.push(i[e++]);var n=r.length?parseInt(Go.apply(void 0,r),10):0;i[e]===Ty&&e++;for(var o=[];sc(i[e]);)o.push(i[e++]);var c=o.length,s=c?parseInt(Go.apply(void 0,o),10):0;(i[e]===z4||i[e]===U4)&&e++;var m=1;(i[e]===mf||i[e]===Sc)&&(i[e]===Sc&&(m=-1),e++);for(var x=[];sc(i[e]);)x.push(i[e++]);var I=x.length?parseInt(Go.apply(void 0,x),10):0;return t*(n+s*Math.pow(10,-c))*Math.pow(10,m*I)},Cne={type:2},Ene={type:3},Sne={type:4},Tne={type:13},Ine={type:8},Lne={type:21},Mne={type:9},Pne={type:10},Fne={type:11},Dne={type:12},Rne={type:14},X1={type:23},kne={type:1},One={type:25},Une={type:24},Nne={type:26},zne={type:27},Qne={type:28},Vne={type:29},Hne={type:31},uC={type:32},H4=function(){function i(){this._value=[]}return i.prototype.write=function(e){this._value=this._value.concat(P1(e))},i.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==uC;)e.push(t),t=this.consumeToken();return e},i.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case H1:return this.consumeStringToken(H1);case Hre:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(V4(t)||cd(r,n)){var o=W1(t,r,n)?zre:Nre,c=this.consumeName();return{type:5,value:c,flags:o}}break;case Gre:if(this.peekCodePoint(0)===Ey)return this.consumeCodePoint(),Tne;break;case G1:return this.consumeStringToken(G1);case j1:return Cne;case Sy:return Ene;case lC:if(this.peekCodePoint(0)===Ey)return this.consumeCodePoint(),Rne;break;case mf:if(cC(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case nne:return Sne;case Sc:var s=e,m=this.peekCodePoint(0),x=this.peekCodePoint(1);if(cC(s,m,x))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(W1(s,m,x))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(m===Sc&&x===Wre)return this.consumeCodePoint(),this.consumeCodePoint(),Une;break;case Ty:if(cC(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case F4:if(this.peekCodePoint(0)===lC)for(this.consumeCodePoint();;){var I=this.consumeCodePoint();if(I===lC&&(I=this.consumeCodePoint(),I===F4))return this.consumeToken();if(I===Vh)return this.consumeToken()}break;case sne:return Nne;case one:return zne;case Kre:if(this.peekCodePoint(0)===$re&&this.peekCodePoint(1)===Sc&&this.peekCodePoint(2)===Sc)return this.consumeCodePoint(),this.consumeCodePoint(),One;break;case Xre:var F=this.peekCodePoint(0),O=this.peekCodePoint(1),z=this.peekCodePoint(2);if(W1(F,O,z)){var c=this.consumeName();return{type:7,value:c}}break;case Zre:return Qne;case Cy:if(cd(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Jre:return Vne;case Yre:if(this.peekCodePoint(0)===Ey)return this.consumeCodePoint(),Ine;break;case ene:return Fne;case tne:return Dne;case fne:case gne:var ie=this.peekCodePoint(0),ne=this.peekCodePoint(1);return ie===mf&&(mg(ne)||ne===q1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case D4:if(this.peekCodePoint(0)===Ey)return this.consumeCodePoint(),Mne;if(this.peekCodePoint(0)===D4)return this.consumeCodePoint(),Lne;break;case ine:if(this.peekCodePoint(0)===Ey)return this.consumeCodePoint(),Pne;break;case Vh:return uC}return $1(e)?(this.consumeWhiteSpace(),Hne):sc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):K1(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Go(e)}},i.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},i.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},i.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},i.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();mg(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===q1&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(Go.apply(void 0,e.map(function(m){return m===q1?k4:m})),16),o=parseInt(Go.apply(void 0,e.map(function(m){return m===q1?Q4:m})),16);return{type:30,start:n,end:o}}var c=parseInt(Go.apply(void 0,e),16);if(this.peekCodePoint(0)===Sc&&mg(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];mg(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();var o=parseInt(Go.apply(void 0,s),16);return{type:30,start:c,end:o}}else return{type:30,start:c,end:c}},i.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===j1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===j1?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},i.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Vh)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===G1||t===H1){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Vh||this.peekCodePoint(0)===Sy)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),X1)}for(;;){var n=this.consumeCodePoint();if(n===Vh||n===Sy)return{type:22,value:Go.apply(void 0,e)};if($1(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Vh||this.peekCodePoint(0)===Sy?(this.consumeCodePoint(),{type:22,value:Go.apply(void 0,e)}):(this.consumeBadUrlRemnants(),X1);if(n===H1||n===G1||n===j1||wne(n))return this.consumeBadUrlRemnants(),X1;if(n===Cy)if(cd(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),X1;else e.push(n)}},i.prototype.consumeWhiteSpace=function(){for(;$1(this.peekCodePoint(0));)this.consumeCodePoint()},i.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===Sy||e===Vh)return;cd(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},i.prototype.consumeStringSlice=function(e){for(var t=5e4,r="";e>0;){var n=Math.min(t,e);r+=Go.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},i.prototype.consumeStringToken=function(e){var t="",r=0;do{var n=this._value[r];if(n===Vh||n===void 0||n===e)return t+=this.consumeStringSlice(r),{type:0,value:t};if(n===V1)return this._value.splice(0,r),kne;if(n===Cy){var o=this._value[r+1];o!==Vh&&o!==void 0&&(o===V1?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):cd(n,o)&&(t+=this.consumeStringSlice(r),t+=Go(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},i.prototype.consumeNumber=function(){var e=[],t=By,r=this.peekCodePoint(0);for((r===mf||r===Sc)&&e.push(this.consumeCodePoint());sc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===Ty&&sc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=P4;sc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((r===z4||r===U4)&&((n===mf||n===Sc)&&sc(o)||sc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=P4;sc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[Bne(e),t]},i.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),c=this.peekCodePoint(2);if(W1(n,o,c)){var s=this.consumeName();return{type:15,number:t,flags:r,unit:s}}return n===jre?(this.consumeCodePoint(),{type:16,number:t,flags:r}):{type:17,number:t,flags:r}},i.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(mg(e)){for(var t=Go(e);mg(this.peekCodePoint(0))&&t.length<6;)t+=Go(this.consumeCodePoint());$1(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return r===0||yne(r)||r>1114111?R4:r}return e===Vh?R4:e},i.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(V4(t))e+=Go(t);else if(cd(t,this.peekCodePoint(0)))e+=Go(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},i}(),G4=function(){function i(e){this._tokens=e}return i.create=function(e){var t=new H4;return t.write(e),new i(t.read())},i.parseValue=function(e){return i.create(e).parseComponentValue()},i.parseValues=function(e){return i.create(e).parseComponentValues()},i.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},i.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},i.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},i.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||jne(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},i.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},i.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?uC:e},i.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},i}(),Iy=function(i){return i.type===15},yg=function(i){return i.type===17},xs=function(i){return i.type===20},Gne=function(i){return i.type===0},hC=function(i,e){return xs(i)&&i.value===e},j4=function(i){return i.type!==31},_g=function(i){return i.type!==31&&i.type!==4},Hh=function(i){var e=[],t=[];return i.forEach(function(r){if(r.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}r.type!==31&&t.push(r)}),t.length&&e.push(t),e},jne=function(i,e){return e===11&&i.type===12||e===28&&i.type===29?!0:e===2&&i.type===3},ud=function(i){return i.type===17||i.type===15},oa=function(i){return i.type===16||ud(i)},q4=function(i){return i.length>1?[i[0],i[1]]:[i[0]]},tl={type:17,number:0,flags:By},AC={type:16,number:50,flags:By},hd={type:16,number:100,flags:By},Ly=function(i,e,t){var r=i[0],n=i[1];return[Qs(r,e),Qs(typeof n<"u"?n:r,t)]},Qs=function(i,e){if(i.type===16)return i.number/100*e;if(Iy(i))switch(i.unit){case"rem":case"em":return 16*i.number;case"px":default:return i.number}return i.number},$4="deg",K4="grad",W4="rad",X4="turn",Z1={name:"angle",parse:function(i,e){if(e.type===15)switch(e.unit){case $4:return Math.PI*e.number/180;case K4:return Math.PI/200*e.number;case W4:return e.number;case X4:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},Z4=function(i){return i.type===15&&(i.unit===$4||i.unit===K4||i.unit===W4||i.unit===X4)},J4=function(i){var e=i.filter(xs).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[tl,tl];case"to top":case"bottom":return Bu(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[tl,hd];case"to right":case"left":return Bu(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[hd,hd];case"to bottom":case"top":return Bu(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[hd,tl];case"to left":case"right":return Bu(270)}return 0},Bu=function(i){return Math.PI*i/180},Ad={name:"color",parse:function(i,e){if(e.type===18){var t=qne[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(i,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return fd(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3),c=e.value.substring(3,4);return fd(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(c+c,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6);return fd(parseInt(r,16),parseInt(n,16),parseInt(o,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),c=e.value.substring(6,8);return fd(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(c,16)/255)}}if(e.type===20){var s=BA[e.value.toUpperCase()];if(typeof s<"u")return s}return BA.TRANSPARENT}},dd=function(i){return(255&i)===0},za=function(i){var e=255&i,t=255&i>>8,r=255&i>>16,n=255&i>>24;return e<255?"rgba("+n+","+r+","+t+","+e/255+")":"rgb("+n+","+r+","+t+")"},fd=function(i,e,t,r){return(i<<24|e<<16|t<<8|Math.round(r*255)<<0)>>>0},Y4=function(i,e){if(i.type===17)return i.number;if(i.type===16){var t=e===3?1:255;return e===3?i.number/100*t:Math.round(i.number/100*t)}return 0},eD=function(i,e){var t=e.filter(_g);if(t.length===3){var r=t.map(Y4),n=r[0],o=r[1],c=r[2];return fd(n,o,c,1)}if(t.length===4){var s=t.map(Y4),n=s[0],o=s[1],c=s[2],m=s[3];return fd(n,o,c,m)}return 0};function dC(i,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-i)*t*6+i:t<1/2?e:t<2/3?(e-i)*6*(2/3-t)+i:i}var tD=function(i,e){var t=e.filter(_g),r=t[0],n=t[1],o=t[2],c=t[3],s=(r.type===17?Bu(r.number):Z1.parse(i,r))/(Math.PI*2),m=oa(n)?n.number/100:0,x=oa(o)?o.number/100:0,I=typeof c<"u"&&oa(c)?Qs(c,1):1;if(m===0)return fd(x*255,x*255,x*255,1);var F=x<=.5?x*(m+1):x+m-x*m,O=x*2-F,z=dC(O,F,s+1/3),ie=dC(O,F,s),ne=dC(O,F,s-1/3);return fd(z*255,ie*255,ne*255,I)},qne={hsl:tD,hsla:tD,rgb:eD,rgba:eD},My=function(i,e){return Ad.parse(i,G4.create(e).parseComponentValue())},BA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},$ne={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(xs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Kne={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},J1=function(i,e){var t=Ad.parse(i,e[0]),r=e[1];return r&&oa(r)?{color:t,stop:r}:{color:t,stop:null}},iD=function(i,e){var t=i[0],r=i[i.length-1];t.stop===null&&(t.stop=tl),r.stop===null&&(r.stop=hd);for(var n=[],o=0,c=0;c<i.length;c++){var s=i[c].stop;if(s!==null){var m=Qs(s,e);m>o?n.push(m):n.push(o),o=m}else n.push(null)}for(var x=null,c=0;c<n.length;c++){var I=n[c];if(I===null)x===null&&(x=c);else if(x!==null){for(var F=c-x,O=n[x-1],z=(I-O)/(F+1),ie=1;ie<=F;ie++)n[x+ie-1]=z*ie;x=null}}return i.map(function(ne,ue){var ce=ne.color;return{color:ce,stop:Math.max(Math.min(1,n[ue]/e),0)}})},Wne=function(i,e,t){var r=e/2,n=t/2,o=Qs(i[0],e)-r,c=n-Qs(i[1],t);return(Math.atan2(c,o)+Math.PI*2)%(Math.PI*2)},Xne=function(i,e,t){var r=typeof i=="number"?i:Wne(i,e,t),n=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),o=e/2,c=t/2,s=n/2,m=Math.sin(r-Math.PI/2)*s,x=Math.cos(r-Math.PI/2)*s;return[n,o-x,o+x,c-m,c+m]},nh=function(i,e){return Math.sqrt(i*i+e*e)},rD=function(i,e,t,r,n){var o=[[0,0],[0,e],[i,0],[i,e]];return o.reduce(function(c,s){var m=s[0],x=s[1],I=nh(t-m,r-x);return(n?I<c.optimumDistance:I>c.optimumDistance)?{optimumCorner:s,optimumDistance:I}:c},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},Zne=function(i,e,t,r,n){var o=0,c=0;switch(i.size){case 0:i.shape===0?o=c=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.min(Math.abs(e),Math.abs(e-r)),c=Math.min(Math.abs(t),Math.abs(t-n)));break;case 2:if(i.shape===0)o=c=Math.min(nh(e,t),nh(e,t-n),nh(e-r,t),nh(e-r,t-n));else if(i.shape===1){var s=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-r)),m=rD(r,n,e,t,!0),x=m[0],I=m[1];o=nh(x-e,(I-t)/s),c=s*o}break;case 1:i.shape===0?o=c=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.max(Math.abs(e),Math.abs(e-r)),c=Math.max(Math.abs(t),Math.abs(t-n)));break;case 3:if(i.shape===0)o=c=Math.max(nh(e,t),nh(e,t-n),nh(e-r,t),nh(e-r,t-n));else if(i.shape===1){var s=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-r)),F=rD(r,n,e,t,!1),x=F[0],I=F[1];o=nh(x-e,(I-t)/s),c=s*o}break}return Array.isArray(i.size)&&(o=Qs(i.size[0],r),c=i.size.length===2?Qs(i.size[1],n):o),[o,c]},Jne=function(i,e){var t=Bu(180),r=[];return Hh(e).forEach(function(n,o){if(o===0){var c=n[0];if(c.type===20&&c.value==="to"){t=J4(n);return}else if(Z4(c)){t=Z1.parse(i,c);return}}var s=J1(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Y1=function(i,e){var t=Bu(180),r=[];return Hh(e).forEach(function(n,o){if(o===0){var c=n[0];if(c.type===20&&["top","left","right","bottom"].indexOf(c.value)!==-1){t=J4(n);return}else if(Z4(c)){t=(Z1.parse(i,c)+Bu(270))%Bu(360);return}}var s=J1(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Yne=function(i,e){var t=Bu(180),r=[],n=1,o=0,c=3,s=[];return Hh(e).forEach(function(m,x){var I=m[0];if(x===0){if(xs(I)&&I.value==="linear"){n=1;return}else if(xs(I)&&I.value==="radial"){n=2;return}}if(I.type===18){if(I.name==="from"){var F=Ad.parse(i,I.values[0]);r.push({stop:tl,color:F})}else if(I.name==="to"){var F=Ad.parse(i,I.values[0]);r.push({stop:hd,color:F})}else if(I.name==="color-stop"){var O=I.values.filter(_g);if(O.length===2){var F=Ad.parse(i,O[1]),z=O[0];yg(z)&&r.push({stop:{type:16,number:z.number*100,flags:z.flags},color:F})}}}}),n===1?{angle:(t+Bu(180))%Bu(360),stops:r,type:n}:{size:c,shape:o,stops:r,position:s,type:n}},nD="closest-side",sD="farthest-side",oD="closest-corner",aD="farthest-corner",lD="circle",cD="ellipse",uD="cover",hD="contain",ese=function(i,e){var t=0,r=3,n=[],o=[];return Hh(e).forEach(function(c,s){var m=!0;if(s===0){var x=!1;m=c.reduce(function(F,O){if(x)if(xs(O))switch(O.value){case"center":return o.push(AC),F;case"top":case"left":return o.push(tl),F;case"right":case"bottom":return o.push(hd),F}else(oa(O)||ud(O))&&o.push(O);else if(xs(O))switch(O.value){case lD:return t=0,!1;case cD:return t=1,!1;case"at":return x=!0,!1;case nD:return r=0,!1;case uD:case sD:return r=1,!1;case hD:case oD:return r=2,!1;case aD:return r=3,!1}else if(ud(O)||oa(O))return Array.isArray(r)||(r=[]),r.push(O),!1;return F},m)}if(m){var I=J1(i,c);n.push(I)}}),{size:r,shape:t,stops:n,position:o,type:2}},ev=function(i,e){var t=0,r=3,n=[],o=[];return Hh(e).forEach(function(c,s){var m=!0;if(s===0?m=c.reduce(function(I,F){if(xs(F))switch(F.value){case"center":return o.push(AC),!1;case"top":case"left":return o.push(tl),!1;case"right":case"bottom":return o.push(hd),!1}else if(oa(F)||ud(F))return o.push(F),!1;return I},m):s===1&&(m=c.reduce(function(I,F){if(xs(F))switch(F.value){case lD:return t=0,!1;case cD:return t=1,!1;case hD:case nD:return r=0,!1;case sD:return r=1,!1;case oD:return r=2,!1;case uD:case aD:return r=3,!1}else if(ud(F)||oa(F))return Array.isArray(r)||(r=[]),r.push(F),!1;return I},m)),m){var x=J1(i,c);n.push(x)}}),{size:r,shape:t,stops:n,position:o,type:2}},tse=function(i){return i.type===1},ise=function(i){return i.type===2},fC={name:"image",parse:function(i,e){if(e.type===22){var t={url:e.value,type:0};return i.cache.addImage(e.value),t}if(e.type===18){var r=AD[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(i,e.values)}throw new Error("Unsupported image type "+e.type)}};function rse(i){return!(i.type===20&&i.value==="none")&&(i.type!==18||!!AD[i.name])}var AD={"linear-gradient":Jne,"-moz-linear-gradient":Y1,"-ms-linear-gradient":Y1,"-o-linear-gradient":Y1,"-webkit-linear-gradient":Y1,"radial-gradient":ese,"-moz-radial-gradient":ev,"-ms-radial-gradient":ev,"-o-radial-gradient":ev,"-webkit-radial-gradient":ev,"-webkit-gradient":Yne},nse={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(r){return _g(r)&&rse(r)}).map(function(r){return fC.parse(i,r)})}},sse={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(xs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},ose={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(i,e){return Hh(e).map(function(t){return t.filter(oa)}).map(q4)}},ase={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(i,e){return Hh(e).map(function(t){return t.filter(xs).map(function(r){return r.value}).join(" ")}).map(lse)}},lse=function(i){switch(i){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},vg;(function(i){i.AUTO="auto",i.CONTAIN="contain",i.COVER="cover"})(vg||(vg={}));var cse={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(i,e){return Hh(e).map(function(t){return t.filter(use)})}},use=function(i){return xs(i)||oa(i)},tv=function(i){return{name:"border-"+i+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},hse=tv("top"),Ase=tv("right"),dse=tv("bottom"),fse=tv("left"),iv=function(i){return{name:"border-radius-"+i,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return q4(t.filter(oa))}}},pse=iv("top-left"),gse=iv("top-right"),mse=iv("bottom-right"),yse=iv("bottom-left"),rv=function(i){return{name:"border-"+i+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},_se=rv("top"),vse=rv("right"),bse=rv("bottom"),xse=rv("left"),nv=function(i){return{name:"border-"+i+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Iy(t)?t.number:0}}},wse=nv("top"),Bse=nv("right"),Cse=nv("bottom"),Ese=nv("left"),Sse={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Tse={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(i,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},Ise={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(i,e){return e.filter(xs).reduce(function(t,r){return t|Lse(r.value)},0)}},Lse=function(i){switch(i){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Mse={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Pse={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(i,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},sv;(function(i){i.NORMAL="normal",i.STRICT="strict"})(sv||(sv={}));var Fse={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"strict":return sv.STRICT;case"normal":default:return sv.NORMAL}}},Dse={name:"line-height",initialValue:"normal",prefix:!1,type:4},dD=function(i,e){return xs(i)&&i.value==="normal"?1.2*e:i.type===17?e*i.number:oa(i)?Qs(i,e):e},Rse={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(i,e){return e.type===20&&e.value==="none"?null:fC.parse(i,e)}},kse={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(i,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},pC={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},ov=function(i){return{name:"margin-"+i,initialValue:"0",prefix:!1,type:4}},Ose=ov("top"),Use=ov("right"),Nse=ov("bottom"),zse=ov("left"),Qse={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(i,e){return e.filter(xs).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Vse={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},av=function(i){return{name:"padding-"+i,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Hse=av("top"),Gse=av("right"),jse=av("bottom"),qse=av("left"),$se={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(i,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Kse={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(i,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Wse={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&hC(e[0],"none")?[]:Hh(e).map(function(t){for(var r={color:BA.TRANSPARENT,offsetX:tl,offsetY:tl,blur:tl},n=0,o=0;o<t.length;o++){var c=t[o];ud(c)?(n===0?r.offsetX=c:n===1?r.offsetY=c:r.blur=c,n++):r.color=Ad.parse(i,c)}return r})}},Xse={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Zse={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(i,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=eoe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Jse=function(i){var e=i.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Yse=function(i){var e=i.filter(function(m){return m.type===17}).map(function(m){return m.number}),t=e[0],r=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var c=e[12],s=e[13];return e[14],e[15],e.length===16?[t,r,n,o,c,s]:null},eoe={matrix:Jse,matrix3d:Yse},fD={type:16,number:50,flags:By},toe=[fD,fD],ioe={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(i,e){var t=e.filter(oa);return t.length!==2?toe:[t[0],t[1]]}},roe={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Py;(function(i){i.NORMAL="normal",i.BREAK_ALL="break-all",i.KEEP_ALL="keep-all"})(Py||(Py={}));for(var noe={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-all":return Py.BREAK_ALL;case"keep-all":return Py.KEEP_ALL;case"normal":default:return Py.NORMAL}}},soe={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(i,e){if(e.type===20)return{auto:!0,order:0};if(yg(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},pD={name:"time",parse:function(i,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},ooe={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(i,e){return yg(e)?e.number:1}},aoe={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},loe={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(i,e){return e.filter(xs).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},coe={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(i,e){var t=[],r=[];return e.forEach(function(n){switch(n.type){case 20:case 0:t.push(n.value);break;case 17:t.push(n.number.toString());break;case 4:r.push(t.join(" ")),t.length=0;break}}),t.length&&r.push(t.join(" ")),r.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},uoe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},hoe={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(i,e){if(yg(e))return e.number;if(xs(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Aoe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.filter(xs).map(function(t){return t.value})}},doe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ba=function(i,e){return(i&e)!==0},foe={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},poe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var r=[],n=e.filter(j4),o=0;o<n.length;o++){var c=n[o],s=n[o+1];if(c.type===20){var m=s&&yg(s)?s.number:1;r.push({counter:c.value,increment:m})}}return r}},goe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return[];for(var t=[],r=e.filter(j4),n=0;n<r.length;n++){var o=r[n],c=r[n+1];if(xs(o)&&o.value!=="none"){var s=c&&yg(c)?c.number:0;t.push({counter:o.value,reset:s})}}return t}},moe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(i,e){return e.filter(Iy).map(function(t){return pD.parse(i,t)})}},yoe={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var r=[],n=e.filter(Gne);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var c=n[o].value,s=n[o+1].value;r.push({open:c,close:s})}return r}},gD=function(i,e,t){if(!i)return"";var r=i[Math.min(e,i.length-1)];return r?t?r.open:r.close:""},_oe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&hC(e[0],"none")?[]:Hh(e).map(function(t){for(var r={color:255,offsetX:tl,offsetY:tl,blur:tl,spread:tl,inset:!1},n=0,o=0;o<t.length;o++){var c=t[o];hC(c,"inset")?r.inset=!0:ud(c)?(n===0?r.offsetX=c:n===1?r.offsetY=c:n===2?r.blur=c:r.spread=c,n++):r.color=Ad.parse(i,c)}return r})}},voe={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(i,e){var t=[0,1,2],r=[];return e.filter(xs).forEach(function(n){switch(n.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),t.forEach(function(n){r.indexOf(n)===-1&&r.push(n)}),r}},boe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},xoe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(i,e){return Iy(e)?e.number:0}},woe=function(){function i(e,t){var r,n;this.animationDuration=ir(e,moe,t.animationDuration),this.backgroundClip=ir(e,$ne,t.backgroundClip),this.backgroundColor=ir(e,Kne,t.backgroundColor),this.backgroundImage=ir(e,nse,t.backgroundImage),this.backgroundOrigin=ir(e,sse,t.backgroundOrigin),this.backgroundPosition=ir(e,ose,t.backgroundPosition),this.backgroundRepeat=ir(e,ase,t.backgroundRepeat),this.backgroundSize=ir(e,cse,t.backgroundSize),this.borderTopColor=ir(e,hse,t.borderTopColor),this.borderRightColor=ir(e,Ase,t.borderRightColor),this.borderBottomColor=ir(e,dse,t.borderBottomColor),this.borderLeftColor=ir(e,fse,t.borderLeftColor),this.borderTopLeftRadius=ir(e,pse,t.borderTopLeftRadius),this.borderTopRightRadius=ir(e,gse,t.borderTopRightRadius),this.borderBottomRightRadius=ir(e,mse,t.borderBottomRightRadius),this.borderBottomLeftRadius=ir(e,yse,t.borderBottomLeftRadius),this.borderTopStyle=ir(e,_se,t.borderTopStyle),this.borderRightStyle=ir(e,vse,t.borderRightStyle),this.borderBottomStyle=ir(e,bse,t.borderBottomStyle),this.borderLeftStyle=ir(e,xse,t.borderLeftStyle),this.borderTopWidth=ir(e,wse,t.borderTopWidth),this.borderRightWidth=ir(e,Bse,t.borderRightWidth),this.borderBottomWidth=ir(e,Cse,t.borderBottomWidth),this.borderLeftWidth=ir(e,Ese,t.borderLeftWidth),this.boxShadow=ir(e,_oe,t.boxShadow),this.color=ir(e,Sse,t.color),this.direction=ir(e,Tse,t.direction),this.display=ir(e,Ise,t.display),this.float=ir(e,Mse,t.cssFloat),this.fontFamily=ir(e,coe,t.fontFamily),this.fontSize=ir(e,uoe,t.fontSize),this.fontStyle=ir(e,doe,t.fontStyle),this.fontVariant=ir(e,Aoe,t.fontVariant),this.fontWeight=ir(e,hoe,t.fontWeight),this.letterSpacing=ir(e,Pse,t.letterSpacing),this.lineBreak=ir(e,Fse,t.lineBreak),this.lineHeight=ir(e,Dse,t.lineHeight),this.listStyleImage=ir(e,Rse,t.listStyleImage),this.listStylePosition=ir(e,kse,t.listStylePosition),this.listStyleType=ir(e,pC,t.listStyleType),this.marginTop=ir(e,Ose,t.marginTop),this.marginRight=ir(e,Use,t.marginRight),this.marginBottom=ir(e,Nse,t.marginBottom),this.marginLeft=ir(e,zse,t.marginLeft),this.opacity=ir(e,ooe,t.opacity);var o=ir(e,Qse,t.overflow);this.overflowX=o[0],this.overflowY=o[o.length>1?1:0],this.overflowWrap=ir(e,Vse,t.overflowWrap),this.paddingTop=ir(e,Hse,t.paddingTop),this.paddingRight=ir(e,Gse,t.paddingRight),this.paddingBottom=ir(e,jse,t.paddingBottom),this.paddingLeft=ir(e,qse,t.paddingLeft),this.paintOrder=ir(e,voe,t.paintOrder),this.position=ir(e,Kse,t.position),this.textAlign=ir(e,$se,t.textAlign),this.textDecorationColor=ir(e,aoe,(r=t.textDecorationColor)!==null&&r!==void 0?r:t.color),this.textDecorationLine=ir(e,loe,(n=t.textDecorationLine)!==null&&n!==void 0?n:t.textDecoration),this.textShadow=ir(e,Wse,t.textShadow),this.textTransform=ir(e,Xse,t.textTransform),this.transform=ir(e,Zse,t.transform),this.transformOrigin=ir(e,ioe,t.transformOrigin),this.visibility=ir(e,roe,t.visibility),this.webkitTextStrokeColor=ir(e,boe,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=ir(e,xoe,t.webkitTextStrokeWidth),this.wordBreak=ir(e,noe,t.wordBreak),this.zIndex=ir(e,soe,t.zIndex)}return i.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},i.prototype.isTransparent=function(){return dd(this.backgroundColor)},i.prototype.isTransformed=function(){return this.transform!==null},i.prototype.isPositioned=function(){return this.position!==0},i.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},i.prototype.isFloating=function(){return this.float!==0},i.prototype.isInlineLevel=function(){return Ba(this.display,4)||Ba(this.display,33554432)||Ba(this.display,268435456)||Ba(this.display,536870912)||Ba(this.display,67108864)||Ba(this.display,134217728)},i}(),Boe=function(){function i(e,t){this.content=ir(e,foe,t.content),this.quotes=ir(e,yoe,t.quotes)}return i}(),mD=function(){function i(e,t){this.counterIncrement=ir(e,poe,t.counterIncrement),this.counterReset=ir(e,goe,t.counterReset)}return i}(),ir=function(i,e,t){var r=new H4,n=t!==null&&typeof t<"u"?t.toString():e.initialValue;r.write(n);var o=new G4(r.read());switch(e.type){case 2:var c=o.parseComponentValue();return e.parse(i,xs(c)?c.value:e.initialValue);case 0:return e.parse(i,o.parseComponentValue());case 1:return e.parse(i,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Z1.parse(i,o.parseComponentValue());case"color":return Ad.parse(i,o.parseComponentValue());case"image":return fC.parse(i,o.parseComponentValue());case"length":var s=o.parseComponentValue();return ud(s)?s:tl;case"length-percentage":var m=o.parseComponentValue();return oa(m)?m:tl;case"time":return pD.parse(i,o.parseComponentValue())}break}},Coe="data-html2canvas-debug",Eoe=function(i){var e=i.getAttribute(Coe);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},gC=function(i,e){var t=Eoe(i);return t===1||e===t},Gh=function(){function i(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,gC(t,3))debugger;this.styles=new woe(e,window.getComputedStyle(t,null)),IC(t)&&(this.styles.animationDuration.some(function(r){return r>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=M1(this.context,t),gC(t,4)&&(this.flags|=16)}return i}(),Soe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",yD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fy=typeof Uint8Array>"u"?[]:new Uint8Array(256),lv=0;lv<yD.length;lv++)Fy[yD.charCodeAt(lv)]=lv;for(var Toe=function(i){var e=i.length*.75,t=i.length,r,n=0,o,c,s,m;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var x=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),I=Array.isArray(x)?x:new Uint8Array(x);for(r=0;r<t;r+=4)o=Fy[i.charCodeAt(r)],c=Fy[i.charCodeAt(r+1)],s=Fy[i.charCodeAt(r+2)],m=Fy[i.charCodeAt(r+3)],I[n++]=o<<2|c>>4,I[n++]=(c&15)<<4|s>>2,I[n++]=(s&3)<<6|m&63;return x},Ioe=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},Loe=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},yf=5,mC=11,yC=2,Moe=mC-yf,_D=65536>>yf,Poe=1<<yf,_C=Poe-1,Foe=1024>>yf,Doe=_D+Foe,Roe=Doe,koe=32,Ooe=Roe+koe,Uoe=65536>>mC,Noe=1<<Moe,zoe=Noe-1,vD=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},Qoe=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},Voe=function(i,e){var t=Toe(i),r=Array.isArray(t)?Loe(t):new Uint32Array(t),n=Array.isArray(t)?Ioe(t):new Uint16Array(t),o=24,c=vD(n,o/2,r[4]/2),s=r[5]===2?vD(n,(o+r[4])/2):Qoe(r,Math.ceil((o+r[4])/4));return new Hoe(r[0],r[1],r[2],r[3],c,s)},Hoe=function(){function i(e,t,r,n,o,c){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=c}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>yf],t=(t<<yC)+(e&_C),this.data[t];if(e<=65535)return t=this.index[_D+(e-55296>>yf)],t=(t<<yC)+(e&_C),this.data[t];if(e<this.highStart)return t=Ooe-Uoe+(e>>mC),t=this.index[t],t+=e>>yf&zoe,t=this.index[t],t=(t<<yC)+(e&_C),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),bD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Goe=typeof Uint8Array>"u"?[]:new Uint8Array(256),cv=0;cv<bD.length;cv++)Goe[bD.charCodeAt(cv)]=cv;var joe=1,vC=2,bC=3,xD=4,wD=5,qoe=7,BD=8,xC=9,wC=10,CD=11,ED=12,SD=13,TD=14,BC=15,$oe=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Koe=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var c=i[n];c<=65535?r.push(c):(c-=65536,r.push((c>>10)+55296,c%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},Woe=Voe(Soe),_f="×",ID="÷",Xoe=function(i){return Woe.get(i)},Zoe=function(i,e,t){var r=t-2,n=e[r],o=e[t-1],c=e[t];if(o===vC&&c===bC)return _f;if(o===vC||o===bC||o===xD||c===vC||c===bC||c===xD)return ID;if(o===BD&&[BD,xC,CD,ED].indexOf(c)!==-1||(o===CD||o===xC)&&(c===xC||c===wC)||(o===ED||o===wC)&&c===wC||c===SD||c===wD||c===qoe||o===joe)return _f;if(o===SD&&c===TD){for(;n===wD;)n=e[--r];if(n===TD)return _f}if(o===BC&&c===BC){for(var s=0;n===BC;)s++,n=e[--r];if(s%2===0)return _f}return ID},Joe=function(i){var e=$oe(i),t=e.length,r=0,n=0,o=e.map(Xoe);return{next:function(){if(r>=t)return{done:!0,value:null};for(var c=_f;r<t&&(c=Zoe(e,o,++r))===_f;);if(c!==_f||r===t){var s=Koe.apply(null,e.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},Yoe=function(i){for(var e=Joe(i),t=[],r;!(r=e.next()).done;)r.value&&t.push(r.value.slice());return t},eae=function(i){var e=123;if(i.createRange){var t=i.createRange();if(t.getBoundingClientRect){var r=i.createElement("boundtest");r.style.height=e+"px",r.style.display="block",i.body.appendChild(r),t.selectNode(r);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(i.body.removeChild(r),o===e)return!0}}return!1},tae=function(i){var e=i.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",i.body.appendChild(e);var t=i.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,n=P1(r.data).map(function(m){return Go(m)}),o=0,c={},s=n.every(function(m,x){t.setStart(r,o),t.setEnd(r,o+m.length);var I=t.getBoundingClientRect();o+=m.length;var F=I.x>c.x||I.y>c.y;return c=I,x===0?!0:F});return i.body.removeChild(e),s},iae=function(){return typeof new Image().crossOrigin<"u"},rae=function(){return typeof new XMLHttpRequest().responseType=="string"},nae=function(i){var e=new Image,t=i.createElement("canvas"),r=t.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},LD=function(i){return i[0]===0&&i[1]===255&&i[2]===0&&i[3]===255},sae=function(i){var e=i.createElement("canvas"),t=100;e.width=t,e.height=t;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,t,t);var n=new Image,o=e.toDataURL();n.src=o;var c=CC(t,t,0,0,n);return r.fillStyle="red",r.fillRect(0,0,t,t),MD(c).then(function(s){r.drawImage(s,0,0);var m=r.getImageData(0,0,t,t).data;r.fillStyle="red",r.fillRect(0,0,t,t);var x=i.createElement("div");return x.style.backgroundImage="url("+o+")",x.style.height=t+"px",LD(m)?MD(CC(t,t,0,0,x)):Promise.reject(!1)}).then(function(s){return r.drawImage(s,0,0),LD(r.getImageData(0,0,t,t).data)}).catch(function(){return!1})},CC=function(i,e,t,r,n){var o="http://www.w3.org/2000/svg",c=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return c.setAttributeNS(null,"width",i.toString()),c.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",t.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),c.appendChild(s),s.appendChild(n),c},MD=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},il={get SUPPORT_RANGE_BOUNDS(){var i=eae(document);return Object.defineProperty(il,"SUPPORT_RANGE_BOUNDS",{value:i}),i},get SUPPORT_WORD_BREAKING(){var i=il.SUPPORT_RANGE_BOUNDS&&tae(document);return Object.defineProperty(il,"SUPPORT_WORD_BREAKING",{value:i}),i},get SUPPORT_SVG_DRAWING(){var i=nae(document);return Object.defineProperty(il,"SUPPORT_SVG_DRAWING",{value:i}),i},get SUPPORT_FOREIGNOBJECT_DRAWING(){var i=typeof Array.from=="function"&&typeof window.fetch=="function"?sae(document):Promise.resolve(!1);return Object.defineProperty(il,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:i}),i},get SUPPORT_CORS_IMAGES(){var i=iae();return Object.defineProperty(il,"SUPPORT_CORS_IMAGES",{value:i}),i},get SUPPORT_RESPONSE_TYPE(){var i=rae();return Object.defineProperty(il,"SUPPORT_RESPONSE_TYPE",{value:i}),i},get SUPPORT_CORS_XHR(){var i="withCredentials"in new XMLHttpRequest;return Object.defineProperty(il,"SUPPORT_CORS_XHR",{value:i}),i},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var i=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(il,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:i}),i}},Dy=function(){function i(e,t){this.text=e,this.bounds=t}return i}(),oae=function(i,e,t,r){var n=cae(e,t),o=[],c=0;return n.forEach(function(s){if(t.textDecorationLine.length||s.trim().length>0)if(il.SUPPORT_RANGE_BOUNDS){var m=PD(r,c,s.length).getClientRects();if(m.length>1){var x=EC(s),I=0;x.forEach(function(O){o.push(new Dy(O,xA.fromDOMRectList(i,PD(r,I+c,O.length).getClientRects()))),I+=O.length})}else o.push(new Dy(s,xA.fromDOMRectList(i,m)))}else{var F=r.splitText(s.length);o.push(new Dy(s,aae(i,r))),r=F}else il.SUPPORT_RANGE_BOUNDS||(r=r.splitText(s.length));c+=s.length}),o},aae=function(i,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=M1(i,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return xA.EMPTY},PD=function(i,e,t){var r=i.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(i,e),n.setEnd(i,e+t),n},EC=function(i){if(il.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(i)).map(function(t){return t.segment})}return Yoe(i)},lae=function(i,e){if(il.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(i)).map(function(r){return r.segment})}return hae(i,e)},cae=function(i,e){return e.letterSpacing!==0?EC(i):lae(i,e)},uae=[32,160,4961,65792,65793,4153,4241],hae=function(i,e){for(var t=Ure(i,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],n,o=function(){if(n.value){var c=n.value.slice(),s=P1(c),m="";s.forEach(function(x){uae.indexOf(x)===-1?m+=Go(x):(m.length&&r.push(m),r.push(Go(x)),m="")}),m.length&&r.push(m)}};!(n=t.next()).done;)o();return r},Aae=function(){function i(e,t,r){this.text=dae(t.data,r.textTransform),this.textBounds=oae(e,this.text,r,t)}return i}(),dae=function(i,e){switch(e){case 1:return i.toLowerCase();case 3:return i.replace(fae,pae);case 2:return i.toUpperCase();default:return i}},fae=/(^|\s|:|-|\(|\))([a-z])/g,pae=function(i,e,t){return i.length>0?e+t.toUpperCase():i},FD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return e}(Gh),DD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return e}(Gh),RD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=new XMLSerializer,c=M1(t,r);return r.setAttribute("width",c.width+"px"),r.setAttribute("height",c.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(o.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e}(Gh),kD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Gh),SC=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.start=r.start,n.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,n}return e}(Gh),gae=[{type:15,flags:0,unit:"px",number:3}],mae=[{type:16,flags:0,number:50}],yae=function(i){return i.width>i.height?new xA(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new xA(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i},_ae=function(i){var e=i.type===vae?new Array(i.value.length+1).join("•"):i.value;return e.length===0?i.placeholder||"":e},uv="checkbox",hv="radio",vae="password",OD=707406591,TC=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=_ae(r),(n.type===uv||n.type===hv)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=yae(n.bounds)),n.type){case uv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=gae;break;case hv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=mae;break}return n}return e}(Gh),UD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=r.options[r.selectedIndex||0];return n.value=o&&o.text||"",n}return e}(Gh),ND=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Gh),zD=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=VD(t,r.contentWindow.document.documentElement);var o=r.contentWindow.document.documentElement?My(t,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):BA.TRANSPARENT,c=r.contentWindow.document.body?My(t,getComputedStyle(r.contentWindow.document.body).backgroundColor):BA.TRANSPARENT;n.backgroundColor=dd(o)?dd(c)?n.styles.backgroundColor:c:o}}catch{}return n}return e}(Gh),bae=["OL","UL","MENU"],Av=function(i,e,t,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,HD(n)&&n.data.trim().length>0)t.textNodes.push(new Aae(i,n,t.styles));else if(bg(n))if(WD(n)&&n.assignedNodes)n.assignedNodes().forEach(function(s){return Av(i,s,t,r)});else{var c=QD(i,n);c.styles.isVisible()&&(xae(n,c,r)?c.flags|=4:wae(c.styles)&&(c.flags|=2),bae.indexOf(n.tagName)!==-1&&(c.flags|=8),t.elements.push(c),n.slot,n.shadowRoot?Av(i,n.shadowRoot,c,r):!fv(n)&&!GD(n)&&!pv(n)&&Av(i,n,c,r))}},QD=function(i,e){return MC(e)?new FD(i,e):jD(e)?new DD(i,e):GD(e)?new RD(i,e):Bae(e)?new kD(i,e):Cae(e)?new SC(i,e):Eae(e)?new TC(i,e):pv(e)?new UD(i,e):fv(e)?new ND(i,e):$D(e)?new zD(i,e):new Gh(i,e)},VD=function(i,e){var t=QD(i,e);return t.flags|=4,Av(i,e,t,t),t},xae=function(i,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||LC(i)&&t.styles.isTransparent()},wae=function(i){return i.isPositioned()||i.isFloating()},HD=function(i){return i.nodeType===Node.TEXT_NODE},bg=function(i){return i.nodeType===Node.ELEMENT_NODE},IC=function(i){return bg(i)&&typeof i.style<"u"&&!dv(i)},dv=function(i){return typeof i.className=="object"},Bae=function(i){return i.tagName==="LI"},Cae=function(i){return i.tagName==="OL"},Eae=function(i){return i.tagName==="INPUT"},Sae=function(i){return i.tagName==="HTML"},GD=function(i){return i.tagName==="svg"},LC=function(i){return i.tagName==="BODY"},jD=function(i){return i.tagName==="CANVAS"},qD=function(i){return i.tagName==="VIDEO"},MC=function(i){return i.tagName==="IMG"},$D=function(i){return i.tagName==="IFRAME"},KD=function(i){return i.tagName==="STYLE"},Tae=function(i){return i.tagName==="SCRIPT"},fv=function(i){return i.tagName==="TEXTAREA"},pv=function(i){return i.tagName==="SELECT"},WD=function(i){return i.tagName==="SLOT"},XD=function(i){return i.tagName.indexOf("-")>0},Iae=function(){function i(){this.counters={}}return i.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},i.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},i.prototype.pop=function(e){var t=this;e.forEach(function(r){return t.counters[r].pop()})},i.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,o=!0;r!==null&&r.forEach(function(s){var m=t.counters[s.counter];m&&s.increment!==0&&(o=!1,m.length||m.push(1),m[Math.max(0,m.length-1)]+=s.increment)});var c=[];return o&&n.forEach(function(s){var m=t.counters[s.counter];c.push(s.counter),m||(m=t.counters[s.counter]=[]),m.push(s.reset)}),c},i}(),ZD={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},JD={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Lae={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Mae={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},xg=function(i,e,t,r,n,o){return i<e||i>t?ky(i,n,o.length>0):r.integers.reduce(function(c,s,m){for(;i>=s;)i-=s,c+=r.values[m];return c},"")+o},YD=function(i,e,t,r){var n="";do t||i--,n=r(i)+n,i/=e;while(i*e>=e);return n},jo=function(i,e,t,r,n){var o=t-e+1;return(i<0?"-":"")+(YD(Math.abs(i),o,r,function(c){return Go(Math.floor(c%o)+e)})+n)},vf=function(i,e,t){t===void 0&&(t=". ");var r=e.length;return YD(Math.abs(i),r,!1,function(n){return e[Math.floor(n%r)]})+t},wg=1,pd=2,gd=4,Ry=8,CA=function(i,e,t,r,n,o){if(i<-9999||i>9999)return ky(i,4,n.length>0);var c=Math.abs(i),s=n;if(c===0)return e[0]+s;for(var m=0;c>0&&m<=4;m++){var x=c%10;x===0&&Ba(o,wg)&&s!==""?s=e[x]+s:x>1||x===1&&m===0||x===1&&m===1&&Ba(o,pd)||x===1&&m===1&&Ba(o,gd)&&i>100||x===1&&m>1&&Ba(o,Ry)?s=e[x]+(m>0?t[m-1]:"")+s:x===1&&m>0&&(s=t[m-1]+s),c=Math.floor(c/10)}return(i<0?r:"")+s},eR="十百千萬",tR="拾佰仟萬",iR="マイナス",PC="마이너스",ky=function(i,e,t){var r=t?". ":"",n=t?"、":"",o=t?", ":"",c=t?" ":"";switch(e){case 0:return"•"+c;case 1:return"◦"+c;case 2:return"◾"+c;case 5:var s=jo(i,48,57,!0,r);return s.length<4?"0"+s:s;case 4:return vf(i,"〇一二三四五六七八九",n);case 6:return xg(i,1,3999,ZD,3,r).toLowerCase();case 7:return xg(i,1,3999,ZD,3,r);case 8:return jo(i,945,969,!1,r);case 9:return jo(i,97,122,!1,r);case 10:return jo(i,65,90,!1,r);case 11:return jo(i,1632,1641,!0,r);case 12:case 49:return xg(i,1,9999,JD,3,r);case 35:return xg(i,1,9999,JD,3,r).toLowerCase();case 13:return jo(i,2534,2543,!0,r);case 14:case 30:return jo(i,6112,6121,!0,r);case 15:return vf(i,"子丑寅卯辰巳午未申酉戌亥",n);case 16:return vf(i,"甲乙丙丁戊己庚辛壬癸",n);case 17:case 48:return CA(i,"零一二三四五六七八九",eR,"負",n,pd|gd|Ry);case 47:return CA(i,"零壹貳參肆伍陸柒捌玖",tR,"負",n,wg|pd|gd|Ry);case 42:return CA(i,"零一二三四五六七八九",eR,"负",n,pd|gd|Ry);case 41:return CA(i,"零壹贰叁肆伍陆柒捌玖",tR,"负",n,wg|pd|gd|Ry);case 26:return CA(i,"〇一二三四五六七八九","十百千万",iR,n,0);case 25:return CA(i,"零壱弐参四伍六七八九","拾百千万",iR,n,wg|pd|gd);case 31:return CA(i,"영일이삼사오육칠팔구","십백천만",PC,o,wg|pd|gd);case 33:return CA(i,"零一二三四五六七八九","十百千萬",PC,o,0);case 32:return CA(i,"零壹貳參四五六七八九","拾百千",PC,o,wg|pd|gd);case 18:return jo(i,2406,2415,!0,r);case 20:return xg(i,1,19999,Mae,3,r);case 21:return jo(i,2790,2799,!0,r);case 22:return jo(i,2662,2671,!0,r);case 22:return xg(i,1,10999,Lae,3,r);case 23:return vf(i,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return vf(i,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return jo(i,3302,3311,!0,r);case 28:return vf(i,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",n);case 29:return vf(i,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",n);case 34:return jo(i,3792,3801,!0,r);case 37:return jo(i,6160,6169,!0,r);case 38:return jo(i,4160,4169,!0,r);case 39:return jo(i,2918,2927,!0,r);case 40:return jo(i,1776,1785,!0,r);case 43:return jo(i,3046,3055,!0,r);case 44:return jo(i,3174,3183,!0,r);case 45:return jo(i,3664,3673,!0,r);case 46:return jo(i,3872,3881,!0,r);case 3:default:return jo(i,48,57,!0,r)}},rR="data-html2canvas-ignore",nR=function(){function i(e,t,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=t,this.counters=new Iae,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return i.prototype.toIFrame=function(e,t){var r=this,n=Pae(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,c=e.defaultView.pageYOffset,s=n.contentWindow,m=s.document,x=Rae(n).then(function(){return rc(r,void 0,void 0,function(){var I,F;return Ml(this,function(O){switch(O.label){case 0:return this.scrolledElements.forEach(Nae),s&&(s.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==t.top||s.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),I=this.options.onclone,F=this.clonedReferenceElement,typeof F>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:m.fonts&&m.fonts.ready?[4,m.fonts.ready]:[3,2];case 1:O.sent(),O.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Dae(m)]:[3,4];case 3:O.sent(),O.label=4;case 4:return typeof I=="function"?[2,Promise.resolve().then(function(){return I(m,F)}).then(function(){return n})]:[2,n]}})})});return m.open(),m.write(Oae(document.doctype)+"<html></html>"),Uae(this.referenceElement.ownerDocument,o,c),m.replaceChild(m.adoptNode(this.documentElement),m.documentElement),m.close(),x},i.prototype.createElementClone=function(e){if(gC(e,2))debugger;if(jD(e))return this.createCanvasClone(e);if(qD(e))return this.createVideoClone(e);if(KD(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return MC(t)&&(MC(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),XD(t)?this.createCustomElementClone(t):t},i.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return FC(e.style,t),t},i.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(o,c){return c&&typeof c.cssText=="string"?o+c.cssText:o},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(o){if(this.context.logger.error("Unable to access cssRules property",o),o.name!=="SecurityError")throw o}return e.cloneNode(!1)},i.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var o=e.getContext("2d"),c=n.getContext("2d");if(c)if(!this.options.allowTaint&&o)c.putImageData(o.getImageData(0,0,e.width,e.height),0,0);else{var s=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(s){var m=s.getContextAttributes();(m==null?void 0:m.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}c.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},i.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var r=t.getContext("2d");try{return r&&(r.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||r.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},i.prototype.appendChildNode=function(e,t,r){(!bg(t)||!Tae(t)&&!t.hasAttribute(rR)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!bg(t)||!KD(t))&&e.appendChild(this.cloneNode(t,r))},i.prototype.cloneChildNodes=function(e,t,r){for(var n=this,o=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;o;o=o.nextSibling)if(bg(o)&&WD(o)&&typeof o.assignedNodes=="function"){var c=o.assignedNodes();c.length&&c.forEach(function(s){return n.appendChildNode(t,s,r)})}else this.appendChildNode(t,o,r)},i.prototype.cloneNode=function(e,t){if(HD(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&bg(e)&&(IC(e)||dv(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var o=r.getComputedStyle(e),c=r.getComputedStyle(e,":before"),s=r.getComputedStyle(e,":after");this.referenceElement===e&&IC(n)&&(this.clonedReferenceElement=n),LC(n)&&Vae(n);var m=this.counters.parse(new mD(this.context,o)),x=this.resolvePseudoContent(e,n,c,Oy.BEFORE);XD(e)&&(t=!0),qD(e)||this.cloneChildNodes(e,n,t),x&&n.insertBefore(x,n.firstChild);var I=this.resolvePseudoContent(e,n,s,Oy.AFTER);return I&&n.appendChild(I),this.counters.pop(m),(o&&(this.options.copyStyles||dv(e))&&!$D(e)||t)&&FC(o,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(fv(e)||pv(e))&&(fv(n)||pv(n))&&(n.value=e.value),n}return e.cloneNode(!1)},i.prototype.resolvePseudoContent=function(e,t,r,n){var o=this;if(r){var c=r.content,s=t.ownerDocument;if(!(!s||!c||c==="none"||c==="-moz-alt-content"||r.display==="none")){this.counters.parse(new mD(this.context,r));var m=new Boe(this.context,r),x=s.createElement("html2canvaspseudoelement");FC(r,x),m.content.forEach(function(F){if(F.type===0)x.appendChild(s.createTextNode(F.value));else if(F.type===22){var O=s.createElement("img");O.src=F.value,O.style.opacity="1",x.appendChild(O)}else if(F.type===18){if(F.name==="attr"){var z=F.values.filter(xs);z.length&&x.appendChild(s.createTextNode(e.getAttribute(z[0].value)||""))}else if(F.name==="counter"){var ie=F.values.filter(_g),ne=ie[0],ue=ie[1];if(ne&&xs(ne)){var ce=o.counters.getCounterValue(ne.value),de=ue&&xs(ue)?pC.parse(o.context,ue.value):3;x.appendChild(s.createTextNode(ky(ce,de,!1)))}}else if(F.name==="counters"){var be=F.values.filter(_g),ne=be[0],Te=be[1],ue=be[2];if(ne&&xs(ne)){var je=o.counters.getCounterValues(ne.value),Ge=ue&&xs(ue)?pC.parse(o.context,ue.value):3,$e=Te&&Te.type===0?Te.value:"",Ue=je.map(function(De){return ky(De,Ge,!1)}).join($e);x.appendChild(s.createTextNode(Ue))}}}else if(F.type===20)switch(F.value){case"open-quote":x.appendChild(s.createTextNode(gD(m.quotes,o.quoteDepth++,!0)));break;case"close-quote":x.appendChild(s.createTextNode(gD(m.quotes,--o.quoteDepth,!1)));break;default:x.appendChild(s.createTextNode(F.value))}}),x.className=DC+" "+RC;var I=n===Oy.BEFORE?" "+DC:" "+RC;return dv(t)?t.className.baseValue+=I:t.className+=I,x}}},i.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},i}(),Oy;(function(i){i[i.BEFORE=0]="BEFORE",i[i.AFTER=1]="AFTER"})(Oy||(Oy={}));var Pae=function(i,e){var t=i.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(rR,"true"),i.body.appendChild(t),t},Fae=function(i){return new Promise(function(e){if(i.complete){e();return}if(!i.src){e();return}i.onload=e,i.onerror=e})},Dae=function(i){return Promise.all([].slice.call(i.images,0).map(Fae))},Rae=function(i){return new Promise(function(e,t){var r=i.contentWindow;if(!r)return t("No window assigned for iframe");var n=r.document;r.onload=i.onload=function(){r.onload=i.onload=null;var o=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(o),e(i))},50)}})},kae=["all","d","content"],FC=function(i,e){for(var t=i.length-1;t>=0;t--){var r=i.item(t);kae.indexOf(r)===-1&&e.style.setProperty(r,i.getPropertyValue(r))}return e},Oae=function(i){var e="";return i&&(e+="<!DOCTYPE ",i.name&&(e+=i.name),i.internalSubset&&(e+=i.internalSubset),i.publicId&&(e+='"'+i.publicId+'"'),i.systemId&&(e+='"'+i.systemId+'"'),e+=">"),e},Uae=function(i,e,t){i&&i.defaultView&&(e!==i.defaultView.pageXOffset||t!==i.defaultView.pageYOffset)&&i.defaultView.scrollTo(e,t)},Nae=function(i){var e=i[0],t=i[1],r=i[2];e.scrollLeft=t,e.scrollTop=r},zae=":before",Qae=":after",DC="___html2canvas___pseudoelement_before",RC="___html2canvas___pseudoelement_after",sR=`{
    content: "" !important;
    display: none !important;
}`,Vae=function(i){Hae(i,"."+DC+zae+sR+`
         .`+RC+Qae+sR)},Hae=function(i,e){var t=i.ownerDocument;if(t){var r=t.createElement("style");r.textContent=e,i.appendChild(r)}},oR=function(){function i(){}return i.getOrigin=function(e){var t=i._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},i.isSameOrigin=function(e){return i.getOrigin(e)===i._origin},i.setContext=function(e){i._link=e.document.createElement("a"),i._origin=i.getOrigin(e.location.href)},i._origin="about:blank",i}(),Gae=function(){function i(e,t){this.context=e,this._options=t,this._cache={}}return i.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(OC(e)||Kae(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},i.prototype.match=function(e){return this._cache[e]},i.prototype.loadImage=function(e){return rc(this,void 0,void 0,function(){var t,r,n,o,c=this;return Ml(this,function(s){switch(s.label){case 0:return t=oR.isSameOrigin(e),r=!kC(e)&&this._options.useCORS===!0&&il.SUPPORT_CORS_IMAGES&&!t,n=!kC(e)&&!t&&!OC(e)&&typeof this._options.proxy=="string"&&il.SUPPORT_CORS_XHR&&!r,!t&&this._options.allowTaint===!1&&!kC(e)&&!OC(e)&&!n&&!r?[2]:(o=e,n?[4,this.proxy(o)]:[3,2]);case 1:o=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(m,x){var I=new Image;I.onload=function(){return m(I)},I.onerror=x,(Wae(o)||r)&&(I.crossOrigin="anonymous"),I.src=o,I.complete===!0&&setTimeout(function(){return m(I)},500),c._options.imageTimeout>0&&setTimeout(function(){return x("Timed out ("+c._options.imageTimeout+"ms) loading image")},c._options.imageTimeout)})];case 3:return[2,s.sent()]}})})},i.prototype.has=function(e){return typeof this._cache[e]<"u"},i.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},i.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(o,c){var s=il.SUPPORT_RESPONSE_TYPE?"blob":"text",m=new XMLHttpRequest;m.onload=function(){if(m.status===200)if(s==="text")o(m.response);else{var F=new FileReader;F.addEventListener("load",function(){return o(F.result)},!1),F.addEventListener("error",function(O){return c(O)},!1),F.readAsDataURL(m.response)}else c("Failed to proxy resource "+n+" with status code "+m.status)},m.onerror=c;var x=r.indexOf("?")>-1?"&":"?";if(m.open("GET",""+r+x+"url="+encodeURIComponent(e)+"&responseType="+s),s!=="text"&&m instanceof XMLHttpRequest&&(m.responseType=s),t._options.imageTimeout){var I=t._options.imageTimeout;m.timeout=I,m.ontimeout=function(){return c("Timed out ("+I+"ms) proxying "+n)}}m.send()})},i}(),jae=/^data:image\/svg\+xml/i,qae=/^data:image\/.*;base64,/i,$ae=/^data:image\/.*/i,Kae=function(i){return il.SUPPORT_SVG_DRAWING||!Xae(i)},kC=function(i){return $ae.test(i)},Wae=function(i){return qae.test(i)},OC=function(i){return i.substr(0,4)==="blob"},Xae=function(i){return i.substr(-3).toLowerCase()==="svg"||jae.test(i)},er=function(){function i(e,t){this.type=0,this.x=e,this.y=t}return i.prototype.add=function(e,t){return new i(this.x+e,this.y+t)},i}(),Bg=function(i,e,t){return new er(i.x+(e.x-i.x)*t,i.y+(e.y-i.y)*t)},gv=function(){function i(e,t,r,n){this.type=1,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return i.prototype.subdivide=function(e,t){var r=Bg(this.start,this.startControl,e),n=Bg(this.startControl,this.endControl,e),o=Bg(this.endControl,this.end,e),c=Bg(r,n,e),s=Bg(n,o,e),m=Bg(c,s,e);return t?new i(this.start,r,c,m):new i(m,s,o,this.end)},i.prototype.add=function(e,t){return new i(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},i.prototype.reverse=function(){return new i(this.end,this.endControl,this.startControl,this.start)},i}(),Cu=function(i){return i.type===1},Zae=function(){function i(e){var t=e.styles,r=e.bounds,n=Ly(t.borderTopLeftRadius,r.width,r.height),o=n[0],c=n[1],s=Ly(t.borderTopRightRadius,r.width,r.height),m=s[0],x=s[1],I=Ly(t.borderBottomRightRadius,r.width,r.height),F=I[0],O=I[1],z=Ly(t.borderBottomLeftRadius,r.width,r.height),ie=z[0],ne=z[1],ue=[];ue.push((o+m)/r.width),ue.push((ie+F)/r.width),ue.push((c+ne)/r.height),ue.push((x+O)/r.height);var ce=Math.max.apply(Math,ue);ce>1&&(o/=ce,c/=ce,m/=ce,x/=ce,F/=ce,O/=ce,ie/=ce,ne/=ce);var de=r.width-m,be=r.height-O,Te=r.width-F,je=r.height-ne,Ge=t.borderTopWidth,$e=t.borderRightWidth,Ue=t.borderBottomWidth,lt=t.borderLeftWidth,nt=Qs(t.paddingTop,e.bounds.width),De=Qs(t.paddingRight,e.bounds.width),Fe=Qs(t.paddingBottom,e.bounds.width),Je=Qs(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||c>0?Zs(r.left+lt/3,r.top+Ge/3,o-lt/3,c-Ge/3,as.TOP_LEFT):new er(r.left+lt/3,r.top+Ge/3),this.topRightBorderDoubleOuterBox=o>0||c>0?Zs(r.left+de,r.top+Ge/3,m-$e/3,x-Ge/3,as.TOP_RIGHT):new er(r.left+r.width-$e/3,r.top+Ge/3),this.bottomRightBorderDoubleOuterBox=F>0||O>0?Zs(r.left+Te,r.top+be,F-$e/3,O-Ue/3,as.BOTTOM_RIGHT):new er(r.left+r.width-$e/3,r.top+r.height-Ue/3),this.bottomLeftBorderDoubleOuterBox=ie>0||ne>0?Zs(r.left+lt/3,r.top+je,ie-lt/3,ne-Ue/3,as.BOTTOM_LEFT):new er(r.left+lt/3,r.top+r.height-Ue/3),this.topLeftBorderDoubleInnerBox=o>0||c>0?Zs(r.left+lt*2/3,r.top+Ge*2/3,o-lt*2/3,c-Ge*2/3,as.TOP_LEFT):new er(r.left+lt*2/3,r.top+Ge*2/3),this.topRightBorderDoubleInnerBox=o>0||c>0?Zs(r.left+de,r.top+Ge*2/3,m-$e*2/3,x-Ge*2/3,as.TOP_RIGHT):new er(r.left+r.width-$e*2/3,r.top+Ge*2/3),this.bottomRightBorderDoubleInnerBox=F>0||O>0?Zs(r.left+Te,r.top+be,F-$e*2/3,O-Ue*2/3,as.BOTTOM_RIGHT):new er(r.left+r.width-$e*2/3,r.top+r.height-Ue*2/3),this.bottomLeftBorderDoubleInnerBox=ie>0||ne>0?Zs(r.left+lt*2/3,r.top+je,ie-lt*2/3,ne-Ue*2/3,as.BOTTOM_LEFT):new er(r.left+lt*2/3,r.top+r.height-Ue*2/3),this.topLeftBorderStroke=o>0||c>0?Zs(r.left+lt/2,r.top+Ge/2,o-lt/2,c-Ge/2,as.TOP_LEFT):new er(r.left+lt/2,r.top+Ge/2),this.topRightBorderStroke=o>0||c>0?Zs(r.left+de,r.top+Ge/2,m-$e/2,x-Ge/2,as.TOP_RIGHT):new er(r.left+r.width-$e/2,r.top+Ge/2),this.bottomRightBorderStroke=F>0||O>0?Zs(r.left+Te,r.top+be,F-$e/2,O-Ue/2,as.BOTTOM_RIGHT):new er(r.left+r.width-$e/2,r.top+r.height-Ue/2),this.bottomLeftBorderStroke=ie>0||ne>0?Zs(r.left+lt/2,r.top+je,ie-lt/2,ne-Ue/2,as.BOTTOM_LEFT):new er(r.left+lt/2,r.top+r.height-Ue/2),this.topLeftBorderBox=o>0||c>0?Zs(r.left,r.top,o,c,as.TOP_LEFT):new er(r.left,r.top),this.topRightBorderBox=m>0||x>0?Zs(r.left+de,r.top,m,x,as.TOP_RIGHT):new er(r.left+r.width,r.top),this.bottomRightBorderBox=F>0||O>0?Zs(r.left+Te,r.top+be,F,O,as.BOTTOM_RIGHT):new er(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=ie>0||ne>0?Zs(r.left,r.top+je,ie,ne,as.BOTTOM_LEFT):new er(r.left,r.top+r.height),this.topLeftPaddingBox=o>0||c>0?Zs(r.left+lt,r.top+Ge,Math.max(0,o-lt),Math.max(0,c-Ge),as.TOP_LEFT):new er(r.left+lt,r.top+Ge),this.topRightPaddingBox=m>0||x>0?Zs(r.left+Math.min(de,r.width-$e),r.top+Ge,de>r.width+$e?0:Math.max(0,m-$e),Math.max(0,x-Ge),as.TOP_RIGHT):new er(r.left+r.width-$e,r.top+Ge),this.bottomRightPaddingBox=F>0||O>0?Zs(r.left+Math.min(Te,r.width-lt),r.top+Math.min(be,r.height-Ue),Math.max(0,F-$e),Math.max(0,O-Ue),as.BOTTOM_RIGHT):new er(r.left+r.width-$e,r.top+r.height-Ue),this.bottomLeftPaddingBox=ie>0||ne>0?Zs(r.left+lt,r.top+Math.min(je,r.height-Ue),Math.max(0,ie-lt),Math.max(0,ne-Ue),as.BOTTOM_LEFT):new er(r.left+lt,r.top+r.height-Ue),this.topLeftContentBox=o>0||c>0?Zs(r.left+lt+Je,r.top+Ge+nt,Math.max(0,o-(lt+Je)),Math.max(0,c-(Ge+nt)),as.TOP_LEFT):new er(r.left+lt+Je,r.top+Ge+nt),this.topRightContentBox=m>0||x>0?Zs(r.left+Math.min(de,r.width+lt+Je),r.top+Ge+nt,de>r.width+lt+Je?0:m-lt+Je,x-(Ge+nt),as.TOP_RIGHT):new er(r.left+r.width-($e+De),r.top+Ge+nt),this.bottomRightContentBox=F>0||O>0?Zs(r.left+Math.min(Te,r.width-(lt+Je)),r.top+Math.min(be,r.height+Ge+nt),Math.max(0,F-($e+De)),O-(Ue+Fe),as.BOTTOM_RIGHT):new er(r.left+r.width-($e+De),r.top+r.height-(Ue+Fe)),this.bottomLeftContentBox=ie>0||ne>0?Zs(r.left+lt+Je,r.top+je,Math.max(0,ie-(lt+Je)),ne-(Ue+Fe),as.BOTTOM_LEFT):new er(r.left+lt+Je,r.top+r.height-(Ue+Fe))}return i}(),as;(function(i){i[i.TOP_LEFT=0]="TOP_LEFT",i[i.TOP_RIGHT=1]="TOP_RIGHT",i[i.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",i[i.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(as||(as={}));var Zs=function(i,e,t,r,n){var o=4*((Math.sqrt(2)-1)/3),c=t*o,s=r*o,m=i+t,x=e+r;switch(n){case as.TOP_LEFT:return new gv(new er(i,x),new er(i,x-s),new er(m-c,e),new er(m,e));case as.TOP_RIGHT:return new gv(new er(i,e),new er(i+c,e),new er(m,x-s),new er(m,x));case as.BOTTOM_RIGHT:return new gv(new er(m,e),new er(m,e+s),new er(i+c,x),new er(i,x));case as.BOTTOM_LEFT:default:return new gv(new er(m,x),new er(m-c,x),new er(i,e+s),new er(i,e))}},mv=function(i){return[i.topLeftBorderBox,i.topRightBorderBox,i.bottomRightBorderBox,i.bottomLeftBorderBox]},Jae=function(i){return[i.topLeftContentBox,i.topRightContentBox,i.bottomRightContentBox,i.bottomLeftContentBox]},yv=function(i){return[i.topLeftPaddingBox,i.topRightPaddingBox,i.bottomRightPaddingBox,i.bottomLeftPaddingBox]},Yae=function(){function i(e,t,r){this.offsetX=e,this.offsetY=t,this.matrix=r,this.type=0,this.target=6}return i}(),_v=function(){function i(e,t){this.path=e,this.target=t,this.type=1}return i}(),ele=function(){function i(e){this.opacity=e,this.type=2,this.target=6}return i}(),tle=function(i){return i.type===0},aR=function(i){return i.type===1},ile=function(i){return i.type===2},lR=function(i,e){return i.length===e.length?i.some(function(t,r){return t===e[r]}):!1},rle=function(i,e,t,r,n){return i.map(function(o,c){switch(c){case 0:return o.add(e,t);case 1:return o.add(e+r,t);case 2:return o.add(e+r,t+n);case 3:return o.add(e,t+n)}return o})},cR=function(){function i(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return i}(),uR=function(){function i(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Zae(this.container),this.container.styles.opacity<1&&this.effects.push(new ele(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,o=this.container.styles.transform;this.effects.push(new Yae(r,n,o))}if(this.container.styles.overflowX!==0){var c=mv(this.curves),s=yv(this.curves);lR(c,s)?this.effects.push(new _v(c,6)):(this.effects.push(new _v(c,2)),this.effects.push(new _v(s,4)))}}return i.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,n=this.effects.slice(0);r;){var o=r.effects.filter(function(m){return!aR(m)});if(t||r.container.styles.position!==0||!r.parent){if(n.unshift.apply(n,o),t=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var c=mv(r.curves),s=yv(r.curves);lR(c,s)||n.unshift(new _v(s,6))}}else n.unshift.apply(n,o);r=r.parent}return n.filter(function(m){return Ba(m.target,e)})},i}(),UC=function(i,e,t,r){i.container.elements.forEach(function(n){var o=Ba(n.flags,4),c=Ba(n.flags,2),s=new uR(n,i);Ba(n.styles.display,2048)&&r.push(s);var m=Ba(n.flags,8)?[]:r;if(o||c){var x=o||n.styles.isPositioned()?t:e,I=new cR(s);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var F=n.styles.zIndex.order;if(F<0){var O=0;x.negativeZIndex.some(function(ie,ne){return F>ie.element.container.styles.zIndex.order?(O=ne,!1):O>0}),x.negativeZIndex.splice(O,0,I)}else if(F>0){var z=0;x.positiveZIndex.some(function(ie,ne){return F>=ie.element.container.styles.zIndex.order?(z=ne+1,!1):z>0}),x.positiveZIndex.splice(z,0,I)}else x.zeroOrAutoZIndexOrTransformedOrOpacity.push(I)}else n.styles.isFloating()?x.nonPositionedFloats.push(I):x.nonPositionedInlineLevel.push(I);UC(s,I,o?I:t,m)}else n.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),UC(s,e,t,m);Ba(n.flags,8)&&hR(n,m)})},hR=function(i,e){for(var t=i instanceof SC?i.start:1,r=i instanceof SC?i.reversed:!1,n=0;n<e.length;n++){var o=e[n];o.container instanceof kD&&typeof o.container.value=="number"&&o.container.value!==0&&(t=o.container.value),o.listValue=ky(t,o.container.styles.listStyleType,!0),t+=r?-1:1}},nle=function(i){var e=new uR(i,null),t=new cR(e),r=[];return UC(e,t,t,r),hR(e.container,r),t},AR=function(i,e){switch(e){case 0:return Eu(i.topLeftBorderBox,i.topLeftPaddingBox,i.topRightBorderBox,i.topRightPaddingBox);case 1:return Eu(i.topRightBorderBox,i.topRightPaddingBox,i.bottomRightBorderBox,i.bottomRightPaddingBox);case 2:return Eu(i.bottomRightBorderBox,i.bottomRightPaddingBox,i.bottomLeftBorderBox,i.bottomLeftPaddingBox);case 3:default:return Eu(i.bottomLeftBorderBox,i.bottomLeftPaddingBox,i.topLeftBorderBox,i.topLeftPaddingBox)}},sle=function(i,e){switch(e){case 0:return Eu(i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox,i.topRightBorderBox,i.topRightBorderDoubleOuterBox);case 1:return Eu(i.topRightBorderBox,i.topRightBorderDoubleOuterBox,i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox);case 2:return Eu(i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox,i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox);case 3:default:return Eu(i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox,i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox)}},ole=function(i,e){switch(e){case 0:return Eu(i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox,i.topRightBorderDoubleInnerBox,i.topRightPaddingBox);case 1:return Eu(i.topRightBorderDoubleInnerBox,i.topRightPaddingBox,i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox);case 2:return Eu(i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox,i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox);case 3:default:return Eu(i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox,i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox)}},ale=function(i,e){switch(e){case 0:return vv(i.topLeftBorderStroke,i.topRightBorderStroke);case 1:return vv(i.topRightBorderStroke,i.bottomRightBorderStroke);case 2:return vv(i.bottomRightBorderStroke,i.bottomLeftBorderStroke);case 3:default:return vv(i.bottomLeftBorderStroke,i.topLeftBorderStroke)}},vv=function(i,e){var t=[];return Cu(i)?t.push(i.subdivide(.5,!1)):t.push(i),Cu(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Eu=function(i,e,t,r){var n=[];return Cu(i)?n.push(i.subdivide(.5,!1)):n.push(i),Cu(t)?n.push(t.subdivide(.5,!0)):n.push(t),Cu(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Cu(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},dR=function(i){var e=i.bounds,t=i.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},bv=function(i){var e=i.styles,t=i.bounds,r=Qs(e.paddingLeft,t.width),n=Qs(e.paddingRight,t.width),o=Qs(e.paddingTop,t.width),c=Qs(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+o+c))},lle=function(i,e){return i===0?e.bounds:i===2?bv(e):dR(e)},cle=function(i,e){return i===0?e.bounds:i===2?bv(e):dR(e)},NC=function(i,e,t){var r=lle(Eg(i.styles.backgroundOrigin,e),i),n=cle(Eg(i.styles.backgroundClip,e),i),o=ule(Eg(i.styles.backgroundSize,e),t,r),c=o[0],s=o[1],m=Ly(Eg(i.styles.backgroundPosition,e),r.width-c,r.height-s),x=hle(Eg(i.styles.backgroundRepeat,e),m,o,r,n),I=Math.round(r.left+m[0]),F=Math.round(r.top+m[1]);return[x,I,F,c,s]},Cg=function(i){return xs(i)&&i.value===vg.AUTO},xv=function(i){return typeof i=="number"},ule=function(i,e,t){var r=e[0],n=e[1],o=e[2],c=i[0],s=i[1];if(!c)return[0,0];if(oa(c)&&s&&oa(s))return[Qs(c,t.width),Qs(s,t.height)];var m=xv(o);if(xs(c)&&(c.value===vg.CONTAIN||c.value===vg.COVER)){if(xv(o)){var x=t.width/t.height;return x<o!=(c.value===vg.COVER)?[t.width,t.width/o]:[t.height*o,t.height]}return[t.width,t.height]}var I=xv(r),F=xv(n),O=I||F;if(Cg(c)&&(!s||Cg(s))){if(I&&F)return[r,n];if(!m&&!O)return[t.width,t.height];if(O&&m){var z=I?r:n*o,ie=F?n:r/o;return[z,ie]}var ne=I?r:t.width,ue=F?n:t.height;return[ne,ue]}if(m){var ce=0,de=0;return oa(c)?ce=Qs(c,t.width):oa(s)&&(de=Qs(s,t.height)),Cg(c)?ce=de*o:(!s||Cg(s))&&(de=ce/o),[ce,de]}var be=null,Te=null;if(oa(c)?be=Qs(c,t.width):s&&oa(s)&&(Te=Qs(s,t.height)),be!==null&&(!s||Cg(s))&&(Te=I&&F?be/r*n:t.height),Te!==null&&Cg(c)&&(be=I&&F?Te/n*r:t.width),be!==null&&Te!==null)return[be,Te];throw new Error("Unable to calculate background-size for element")},Eg=function(i,e){var t=i[e];return typeof t>"u"?i[0]:t},hle=function(i,e,t,r,n){var o=e[0],c=e[1],s=t[0],m=t[1];switch(i){case 2:return[new er(Math.round(r.left),Math.round(r.top+c)),new er(Math.round(r.left+r.width),Math.round(r.top+c)),new er(Math.round(r.left+r.width),Math.round(m+r.top+c)),new er(Math.round(r.left),Math.round(m+r.top+c))];case 3:return[new er(Math.round(r.left+o),Math.round(r.top)),new er(Math.round(r.left+o+s),Math.round(r.top)),new er(Math.round(r.left+o+s),Math.round(r.height+r.top)),new er(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new er(Math.round(r.left+o),Math.round(r.top+c)),new er(Math.round(r.left+o+s),Math.round(r.top+c)),new er(Math.round(r.left+o+s),Math.round(r.top+c+m)),new er(Math.round(r.left+o),Math.round(r.top+c+m))];default:return[new er(Math.round(n.left),Math.round(n.top)),new er(Math.round(n.left+n.width),Math.round(n.top)),new er(Math.round(n.left+n.width),Math.round(n.height+n.top)),new er(Math.round(n.left),Math.round(n.height+n.top))]}},Ale="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",fR="Hidden Text",dle=function(){function i(e){this._data={},this._document=e}return i.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),c=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",c.appendChild(r),n.src=Ale,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(fR)),r.appendChild(o),r.appendChild(n);var s=n.offsetTop-o.offsetTop+2;r.removeChild(o),r.appendChild(this._document.createTextNode(fR)),r.style.lineHeight="normal",n.style.verticalAlign="super";var m=n.offsetTop-r.offsetTop+2;return c.removeChild(r),{baseline:s,middle:m}},i.prototype.getMetrics=function(e,t){var r=e+" "+t;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},i}(),pR=function(){function i(e,t){this.context=e,this.options=t}return i}(),fle=1e4,ple=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new dle(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return e.prototype.applyEffects=function(t){for(var r=this;this._activeEffects.length;)this.popEffect();t.forEach(function(n){return r.applyEffect(n)})},e.prototype.applyEffect=function(t){this.ctx.save(),ile(t)&&(this.ctx.globalAlpha=t.opacity),tle(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),aR(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return rc(this,void 0,void 0,function(){var r;return Ml(this,function(n){switch(n.label){case 0:return r=t.element.container.styles,r.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return rc(this,void 0,void 0,function(){return Ml(this,function(r){switch(r.label){case 0:if(Ba(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,r,n){var o=this;if(r===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n);else{var c=EC(t.text);c.reduce(function(s,m){return o.ctx.fillText(m,s,t.bounds.top+n),s+o.ctx.measureText(m).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var r=t.fontVariant.filter(function(c){return c==="normal"||c==="small-caps"}).join(""),n=vle(t.fontFamily).join(", "),o=Iy(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,r,t.fontWeight,o,n].join(" "),n,o]},e.prototype.renderTextNode=function(t,r){return rc(this,void 0,void 0,function(){var n,o,c,s,m,x,I,F,O=this;return Ml(this,function(z){return n=this.createFontStyle(r),o=n[0],c=n[1],s=n[2],this.ctx.font=o,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",m=this.fontMetrics.getMetrics(c,s),x=m.baseline,I=m.middle,F=r.paintOrder,t.textBounds.forEach(function(ie){F.forEach(function(ne){switch(ne){case 0:O.ctx.fillStyle=za(r.color),O.renderTextWithLetterSpacing(ie,r.letterSpacing,x);var ue=r.textShadow;ue.length&&ie.text.trim().length&&(ue.slice(0).reverse().forEach(function(ce){O.ctx.shadowColor=za(ce.color),O.ctx.shadowOffsetX=ce.offsetX.number*O.options.scale,O.ctx.shadowOffsetY=ce.offsetY.number*O.options.scale,O.ctx.shadowBlur=ce.blur.number,O.renderTextWithLetterSpacing(ie,r.letterSpacing,x)}),O.ctx.shadowColor="",O.ctx.shadowOffsetX=0,O.ctx.shadowOffsetY=0,O.ctx.shadowBlur=0),r.textDecorationLine.length&&(O.ctx.fillStyle=za(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(ce){switch(ce){case 1:O.ctx.fillRect(ie.bounds.left,Math.round(ie.bounds.top+x),ie.bounds.width,1);break;case 2:O.ctx.fillRect(ie.bounds.left,Math.round(ie.bounds.top),ie.bounds.width,1);break;case 3:O.ctx.fillRect(ie.bounds.left,Math.ceil(ie.bounds.top+I),ie.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&ie.text.trim().length&&(O.ctx.strokeStyle=za(r.webkitTextStrokeColor),O.ctx.lineWidth=r.webkitTextStrokeWidth,O.ctx.lineJoin=window.chrome?"miter":"round",O.ctx.strokeText(ie.text,ie.bounds.left,ie.bounds.top+x)),O.ctx.strokeStyle="",O.ctx.lineWidth=0,O.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,r,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var o=bv(t),c=yv(r);this.path(c),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,o.left,o.top,o.width,o.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return rc(this,void 0,void 0,function(){var r,n,o,c,s,m,de,de,x,I,F,O,Te,z,ie,je,ne,ue,ce,de,be,Te,je;return Ml(this,function(Ge){switch(Ge.label){case 0:this.applyEffects(t.getEffects(4)),r=t.container,n=t.curves,o=r.styles,c=0,s=r.textNodes,Ge.label=1;case 1:return c<s.length?(m=s[c],[4,this.renderTextNode(m,o)]):[3,4];case 2:Ge.sent(),Ge.label=3;case 3:return c++,[3,1];case 4:if(!(r instanceof FD))return[3,8];Ge.label=5;case 5:return Ge.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return de=Ge.sent(),this.renderReplacedElement(r,n,de),[3,8];case 7:return Ge.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof DD&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof RD))return[3,12];Ge.label=9;case 9:return Ge.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return de=Ge.sent(),this.renderReplacedElement(r,n,de),[3,12];case 11:return Ge.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof zD&&r.tree?(x=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,x.render(r.tree)]):[3,14];case 13:I=Ge.sent(),r.width&&r.height&&this.ctx.drawImage(I,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),Ge.label=14;case 14:if(r instanceof TC&&(F=Math.min(r.bounds.width,r.bounds.height),r.type===uv?r.checked&&(this.ctx.save(),this.path([new er(r.bounds.left+F*.39363,r.bounds.top+F*.79),new er(r.bounds.left+F*.16,r.bounds.top+F*.5549),new er(r.bounds.left+F*.27347,r.bounds.top+F*.44071),new er(r.bounds.left+F*.39694,r.bounds.top+F*.5649),new er(r.bounds.left+F*.72983,r.bounds.top+F*.23),new er(r.bounds.left+F*.84,r.bounds.top+F*.34085),new er(r.bounds.left+F*.39363,r.bounds.top+F*.79)]),this.ctx.fillStyle=za(OD),this.ctx.fill(),this.ctx.restore()):r.type===hv&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+F/2,r.bounds.top+F/2,F/4,0,Math.PI*2,!0),this.ctx.fillStyle=za(OD),this.ctx.fill(),this.ctx.restore())),gle(r)&&r.value.length){switch(O=this.createFontStyle(o),Te=O[0],z=O[1],ie=this.fontMetrics.getMetrics(Te,z).baseline,this.ctx.font=Te,this.ctx.fillStyle=za(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=yle(r.styles.textAlign),je=bv(r),ne=0,r.styles.textAlign){case 1:ne+=je.width/2;break;case 2:ne+=je.width;break}ue=je.add(ne,0,0,-je.height/2+1),this.ctx.save(),this.path([new er(je.left,je.top),new er(je.left+je.width,je.top),new er(je.left+je.width,je.top+je.height),new er(je.left,je.top+je.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Dy(r.value,ue),o.letterSpacing,ie),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ba(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(ce=r.styles.listStyleImage,ce.type!==0)return[3,18];de=void 0,be=ce.url,Ge.label=15;case 15:return Ge.trys.push([15,17,,18]),[4,this.context.cache.match(be)];case 16:return de=Ge.sent(),this.ctx.drawImage(de,r.bounds.left-(de.width+10),r.bounds.top),[3,18];case 17:return Ge.sent(),this.context.logger.error("Error loading list-style-image "+be),[3,18];case 18:return[3,20];case 19:t.listValue&&r.styles.listStyleType!==-1&&(Te=this.createFontStyle(o)[0],this.ctx.font=Te,this.ctx.fillStyle=za(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",je=new xA(r.bounds.left,r.bounds.top+Qs(r.styles.paddingTop,r.bounds.width),r.bounds.width,dD(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Dy(t.listValue,je),o.letterSpacing,dD(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),Ge.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return rc(this,void 0,void 0,function(){var r,n,ce,o,c,ce,s,m,ce,x,I,ce,F,O,ce,z,ie,ce,ne,ue,ce;return Ml(this,function(de){switch(de.label){case 0:if(Ba(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:de.sent(),r=0,n=t.negativeZIndex,de.label=2;case 2:return r<n.length?(ce=n[r],[4,this.renderStack(ce)]):[3,5];case 3:de.sent(),de.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:de.sent(),o=0,c=t.nonInlineLevel,de.label=7;case 7:return o<c.length?(ce=c[o],[4,this.renderNode(ce)]):[3,10];case 8:de.sent(),de.label=9;case 9:return o++,[3,7];case 10:s=0,m=t.nonPositionedFloats,de.label=11;case 11:return s<m.length?(ce=m[s],[4,this.renderStack(ce)]):[3,14];case 12:de.sent(),de.label=13;case 13:return s++,[3,11];case 14:x=0,I=t.nonPositionedInlineLevel,de.label=15;case 15:return x<I.length?(ce=I[x],[4,this.renderStack(ce)]):[3,18];case 16:de.sent(),de.label=17;case 17:return x++,[3,15];case 18:F=0,O=t.inlineLevel,de.label=19;case 19:return F<O.length?(ce=O[F],[4,this.renderNode(ce)]):[3,22];case 20:de.sent(),de.label=21;case 21:return F++,[3,19];case 22:z=0,ie=t.zeroOrAutoZIndexOrTransformedOrOpacity,de.label=23;case 23:return z<ie.length?(ce=ie[z],[4,this.renderStack(ce)]):[3,26];case 24:de.sent(),de.label=25;case 25:return z++,[3,23];case 26:ne=0,ue=t.positiveZIndex,de.label=27;case 27:return ne<ue.length?(ce=ue[ne],[4,this.renderStack(ce)]):[3,30];case 28:de.sent(),de.label=29;case 29:return ne++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var r=this;t.forEach(function(n,o){var c=Cu(n)?n.start:n;o===0?r.ctx.moveTo(c.x,c.y):r.ctx.lineTo(c.x,c.y),Cu(n)&&r.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(t,r,n,o){this.path(t),this.ctx.fillStyle=r,this.ctx.translate(n,o),this.ctx.fill(),this.ctx.translate(-n,-o)},e.prototype.resizeImage=function(t,r,n){var o;if(t.width===r&&t.height===n)return t;var c=(o=this.canvas.ownerDocument)!==null&&o!==void 0?o:document,s=c.createElement("canvas");s.width=Math.max(1,r),s.height=Math.max(1,n);var m=s.getContext("2d");return m.drawImage(t,0,0,t.width,t.height,0,0,r,n),s},e.prototype.renderBackgroundImage=function(t){return rc(this,void 0,void 0,function(){var r,n,o,c,s,m;return Ml(this,function(x){switch(x.label){case 0:r=t.styles.backgroundImage.length-1,n=function(I){var F,O,z,nt,Ct,Lt,Je,We,Ue,ie,nt,Ct,Lt,Je,We,ne,ue,ce,de,be,Te,je,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et,Ct,Lt,_t,Ft,Mt,Wt,Ee,Xe,et,At;return Ml(this,function(ft){switch(ft.label){case 0:if(I.type!==0)return[3,5];F=void 0,O=I.url,ft.label=1;case 1:return ft.trys.push([1,3,,4]),[4,o.context.cache.match(O)];case 2:return F=ft.sent(),[3,4];case 3:return ft.sent(),o.context.logger.error("Error loading background-image "+O),[3,4];case 4:return F&&(z=NC(t,r,[F.width,F.height,F.width/F.height]),nt=z[0],Ct=z[1],Lt=z[2],Je=z[3],We=z[4],Ue=o.ctx.createPattern(o.resizeImage(F,Je,We),"repeat"),o.renderRepeat(nt,Ue,Ct,Lt)),[3,6];case 5:tse(I)?(ie=NC(t,r,[null,null,null]),nt=ie[0],Ct=ie[1],Lt=ie[2],Je=ie[3],We=ie[4],ne=Xne(I.angle,Je,We),ue=ne[0],ce=ne[1],de=ne[2],be=ne[3],Te=ne[4],je=document.createElement("canvas"),je.width=Je,je.height=We,Ge=je.getContext("2d"),$e=Ge.createLinearGradient(ce,be,de,Te),iD(I.stops,ue).forEach(function(wt){return $e.addColorStop(wt.stop,za(wt.color))}),Ge.fillStyle=$e,Ge.fillRect(0,0,Je,We),Je>0&&We>0&&(Ue=o.ctx.createPattern(je,"repeat"),o.renderRepeat(nt,Ue,Ct,Lt))):ise(I)&&(lt=NC(t,r,[null,null,null]),nt=lt[0],De=lt[1],Fe=lt[2],Je=lt[3],We=lt[4],Et=I.position.length===0?[AC]:I.position,Ct=Qs(Et[0],Je),Lt=Qs(Et[Et.length-1],We),_t=Zne(I,Ct,Lt,Je,We),Ft=_t[0],Mt=_t[1],Ft>0&&Mt>0&&(Wt=o.ctx.createRadialGradient(De+Ct,Fe+Lt,0,De+Ct,Fe+Lt,Ft),iD(I.stops,Ft*2).forEach(function(wt){return Wt.addColorStop(wt.stop,za(wt.color))}),o.path(nt),o.ctx.fillStyle=Wt,Ft!==Mt?(Ee=t.bounds.left+.5*t.bounds.width,Xe=t.bounds.top+.5*t.bounds.height,et=Mt/Ft,At=1/et,o.ctx.save(),o.ctx.translate(Ee,Xe),o.ctx.transform(1,0,0,et,0,0),o.ctx.translate(-Ee,-Xe),o.ctx.fillRect(De,At*(Fe-Xe)+Xe,Je,We*At),o.ctx.restore()):o.ctx.fill())),ft.label=6;case 6:return r--,[2]}})},o=this,c=0,s=t.styles.backgroundImage.slice(0).reverse(),x.label=1;case 1:return c<s.length?(m=s[c],[5,n(m)]):[3,4];case 2:x.sent(),x.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,r,n){return rc(this,void 0,void 0,function(){return Ml(this,function(o){return this.path(AR(n,r)),this.ctx.fillStyle=za(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,r,n,o){return rc(this,void 0,void 0,function(){var c,s;return Ml(this,function(m){switch(m.label){case 0:return r<3?[4,this.renderSolidBorder(t,n,o)]:[3,2];case 1:return m.sent(),[2];case 2:return c=sle(o,n),this.path(c),this.ctx.fillStyle=za(t),this.ctx.fill(),s=ole(o,n),this.path(s),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return rc(this,void 0,void 0,function(){var r,n,o,c,s,m,x,I,F=this;return Ml(this,function(O){switch(O.label){case 0:return this.applyEffects(t.getEffects(2)),r=t.container.styles,n=!dd(r.backgroundColor)||r.backgroundImage.length,o=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],c=mle(Eg(r.backgroundClip,0),t.curves),n||r.boxShadow.length?(this.ctx.save(),this.path(c),this.ctx.clip(),dd(r.backgroundColor)||(this.ctx.fillStyle=za(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:O.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(z){F.ctx.save();var ie=mv(t.curves),ne=z.inset?0:fle,ue=rle(ie,-ne+(z.inset?1:-1)*z.spread.number,(z.inset?1:-1)*z.spread.number,z.spread.number*(z.inset?-2:2),z.spread.number*(z.inset?-2:2));z.inset?(F.path(ie),F.ctx.clip(),F.mask(ue)):(F.mask(ie),F.ctx.clip(),F.path(ue)),F.ctx.shadowOffsetX=z.offsetX.number+ne,F.ctx.shadowOffsetY=z.offsetY.number,F.ctx.shadowColor=za(z.color),F.ctx.shadowBlur=z.blur.number,F.ctx.fillStyle=z.inset?za(z.color):"rgba(0,0,0,1)",F.ctx.fill(),F.ctx.restore()}),O.label=2;case 2:s=0,m=0,x=o,O.label=3;case 3:return m<x.length?(I=x[m],I.style!==0&&!dd(I.color)&&I.width>0?I.style!==2?[3,5]:[4,this.renderDashedDottedBorder(I.color,I.width,s,t.curves,2)]:[3,11]):[3,13];case 4:return O.sent(),[3,11];case 5:return I.style!==3?[3,7]:[4,this.renderDashedDottedBorder(I.color,I.width,s,t.curves,3)];case 6:return O.sent(),[3,11];case 7:return I.style!==4?[3,9]:[4,this.renderDoubleBorder(I.color,I.width,s,t.curves)];case 8:return O.sent(),[3,11];case 9:return[4,this.renderSolidBorder(I.color,s,t.curves)];case 10:O.sent(),O.label=11;case 11:s++,O.label=12;case 12:return m++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,r,n,o,c){return rc(this,void 0,void 0,function(){var s,m,x,I,F,O,z,ie,ne,ue,ce,de,be,Te,je,Ge,je,Ge;return Ml(this,function($e){return this.ctx.save(),s=ale(o,n),m=AR(o,n),c===2&&(this.path(m),this.ctx.clip()),Cu(m[0])?(x=m[0].start.x,I=m[0].start.y):(x=m[0].x,I=m[0].y),Cu(m[1])?(F=m[1].end.x,O=m[1].end.y):(F=m[1].x,O=m[1].y),n===0||n===2?z=Math.abs(x-F):z=Math.abs(I-O),this.ctx.beginPath(),c===3?this.formatPath(s):this.formatPath(m.slice(0,2)),ie=r<3?r*3:r*2,ne=r<3?r*2:r,c===3&&(ie=r,ne=r),ue=!0,z<=ie*2?ue=!1:z<=ie*2+ne?(ce=z/(2*ie+ne),ie*=ce,ne*=ce):(de=Math.floor((z+ne)/(ie+ne)),be=(z-de*ie)/(de-1),Te=(z-(de+1)*ie)/de,ne=Te<=0||Math.abs(ne-be)<Math.abs(ne-Te)?be:Te),ue&&(c===3?this.ctx.setLineDash([0,ie+ne]):this.ctx.setLineDash([ie,ne])),c===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=za(t),this.ctx.stroke(),this.ctx.setLineDash([]),c===2&&(Cu(m[0])&&(je=m[3],Ge=m[0],this.ctx.beginPath(),this.formatPath([new er(je.end.x,je.end.y),new er(Ge.start.x,Ge.start.y)]),this.ctx.stroke()),Cu(m[1])&&(je=m[1],Ge=m[2],this.ctx.beginPath(),this.formatPath([new er(je.end.x,je.end.y),new er(Ge.start.x,Ge.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return rc(this,void 0,void 0,function(){var r;return Ml(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=za(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=nle(t),[4,this.renderStack(r)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(pR),gle=function(i){return i instanceof ND||i instanceof UD?!0:i instanceof TC&&i.type!==hv&&i.type!==uv},mle=function(i,e){switch(i){case 0:return mv(e);case 2:return Jae(e);case 1:default:return yv(e)}},yle=function(i){switch(i){case 1:return"center";case 2:return"right";case 0:default:return"left"}},_le=["-apple-system","system-ui"],vle=function(i){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?i.filter(function(e){return _le.indexOf(e)===-1}):i},ble=function(i){rh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return e.prototype.render=function(t){return rc(this,void 0,void 0,function(){var r,n;return Ml(this,function(o){switch(o.label){case 0:return r=CC(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,xle(r)];case 1:return n=o.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=za(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(pR),xle=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},wle=function(){function i(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,L1([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.getTime=function(){return Date.now()-this.start},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,L1([this.id,this.getTime()+"ms"],e))},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,L1([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,L1([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.instances={},i}(),Ble=function(){function i(e,t){var r;this.windowBounds=t,this.instanceName="#"+i.instanceCount++,this.logger=new wle({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new Gae(this,e)}return i.instanceCount=1,i}(),Cle=function(i,e){return e===void 0&&(e={}),Ele(i,e)};typeof window<"u"&&oR.setContext(window);var Ele=function(i,e){return rc(void 0,void 0,void 0,function(){var t,r,n,o,c,s,m,x,I,F,O,z,ie,ne,ue,ce,de,be,Te,je,$e,Ge,$e,Ue,lt,nt,De,Fe,Je,We,Et,Ct,Lt,_t,Ft,Mt,Wt,Ee,Xe,et;return Ml(this,function(At){switch(At.label){case 0:if(!i||typeof i!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=i.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(r=t.defaultView,!r)throw new Error("Document is not attached to a Window");return n={allowTaint:(Ue=e.allowTaint)!==null&&Ue!==void 0?Ue:!1,imageTimeout:(lt=e.imageTimeout)!==null&&lt!==void 0?lt:15e3,proxy:e.proxy,useCORS:(nt=e.useCORS)!==null&&nt!==void 0?nt:!1},o=jB({logging:(De=e.logging)!==null&&De!==void 0?De:!0,cache:e.cache},n),c={windowWidth:(Fe=e.windowWidth)!==null&&Fe!==void 0?Fe:r.innerWidth,windowHeight:(Je=e.windowHeight)!==null&&Je!==void 0?Je:r.innerHeight,scrollX:(We=e.scrollX)!==null&&We!==void 0?We:r.pageXOffset,scrollY:(Et=e.scrollY)!==null&&Et!==void 0?Et:r.pageYOffset},s=new xA(c.scrollX,c.scrollY,c.windowWidth,c.windowHeight),m=new Ble(o,s),x=(Ct=e.foreignObjectRendering)!==null&&Ct!==void 0?Ct:!1,I={allowTaint:(Lt=e.allowTaint)!==null&&Lt!==void 0?Lt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:x,copyStyles:x},m.logger.debug("Starting document clone with size "+s.width+"x"+s.height+" scrolled to "+-s.left+","+-s.top),F=new nR(m,i,I),O=F.clonedReferenceElement,O?[4,F.toIFrame(t,s)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return z=At.sent(),ie=LC(O)||Sae(O)?rre(O.ownerDocument):M1(m,O),ne=ie.width,ue=ie.height,ce=ie.left,de=ie.top,be=Sle(m,O,e.backgroundColor),Te={canvas:e.canvas,backgroundColor:be,scale:(Ft=(_t=e.scale)!==null&&_t!==void 0?_t:r.devicePixelRatio)!==null&&Ft!==void 0?Ft:1,x:((Mt=e.x)!==null&&Mt!==void 0?Mt:0)+ce,y:((Wt=e.y)!==null&&Wt!==void 0?Wt:0)+de,width:(Ee=e.width)!==null&&Ee!==void 0?Ee:Math.ceil(ne),height:(Xe=e.height)!==null&&Xe!==void 0?Xe:Math.ceil(ue)},x?(m.logger.debug("Document cloned, using foreign object rendering"),$e=new ble(m,Te),[4,$e.render(O)]):[3,3];case 2:return je=At.sent(),[3,5];case 3:return m.logger.debug("Document cloned, element located at "+ce+","+de+" with size "+ne+"x"+ue+" using computed rendering"),m.logger.debug("Starting DOM parsing"),Ge=VD(m,O),be===Ge.styles.backgroundColor&&(Ge.styles.backgroundColor=BA.TRANSPARENT),m.logger.debug("Starting renderer for element at "+Te.x+","+Te.y+" with size "+Te.width+"x"+Te.height),$e=new ple(m,Te),[4,$e.render(Ge)];case 4:je=At.sent(),At.label=5;case 5:return(!((et=e.removeContainer)!==null&&et!==void 0)||et)&&(nR.destroy(z)||m.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),m.logger.debug("Finished rendering"),[2,je]}})})},Sle=function(i,e,t){var r=e.ownerDocument,n=r.documentElement?My(i,getComputedStyle(r.documentElement).backgroundColor):BA.TRANSPARENT,o=r.body?My(i,getComputedStyle(r.body).backgroundColor):BA.TRANSPARENT,c=typeof t=="string"?My(i,t):t===null?BA.TRANSPARENT:4294967295;return e===r.documentElement?dd(n)?dd(o)?c:o:n:c};const Tle=Object.freeze(Object.defineProperty({__proto__:null,default:Cle},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function md(i){"@babel/helpers - typeof";return md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},md(i)}function zC(i,e){return zC=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},zC(i,e)}function Ile(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function wv(i,e,t){return Ile()?wv=Reflect.construct:wv=function(r,n,o){var c=[null];c.push.apply(c,n);var s=Function.bind.apply(r,c),m=new s;return o&&zC(m,o.prototype),m},wv.apply(null,arguments)}function sh(i){return Lle(i)||Mle(i)||Ple(i)||Fle()}function Lle(i){if(Array.isArray(i))return QC(i)}function Mle(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Ple(i,e){if(i){if(typeof i=="string")return QC(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return QC(i,e)}}function QC(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function Fle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Dle=Object.hasOwnProperty,gR=Object.setPrototypeOf,Rle=Object.isFrozen,kle=Object.getPrototypeOf,Ole=Object.getOwnPropertyDescriptor,oc=Object.freeze,oh=Object.seal,Ule=Object.create,mR=typeof Reflect<"u"&&Reflect,Bv=mR.apply,VC=mR.construct;Bv||(Bv=function(i,e,t){return i.apply(e,t)}),oc||(oc=function(i){return i}),oh||(oh=function(i){return i}),VC||(VC=function(i,e){return wv(i,sh(e))});var Nle=Su(Array.prototype.forEach),yR=Su(Array.prototype.pop),Uy=Su(Array.prototype.push),Cv=Su(String.prototype.toLowerCase),HC=Su(String.prototype.toString),zle=Su(String.prototype.match),ah=Su(String.prototype.replace),Qle=Su(String.prototype.indexOf),Vle=Su(String.prototype.trim),ac=Su(RegExp.prototype.test),GC=Hle(TypeError);function Su(i){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Bv(i,e,r)}}function Hle(i){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return VC(i,t)}}function nn(i,e,t){t=t||Cv,gR&&gR(i,null);for(var r=e.length;r--;){var n=e[r];if(typeof n=="string"){var o=t(n);o!==n&&(Rle(e)||(e[r]=o),n=o)}i[n]=!0}return i}function bf(i){var e=Ule(null),t;for(t in i)Bv(Dle,i,[t])===!0&&(e[t]=i[t]);return e}function Ev(i,e){for(;i!==null;){var t=Ole(i,e);if(t){if(t.get)return Su(t.get);if(typeof t.value=="function")return Su(t.value)}i=kle(i)}function r(n){return console.warn("fallback value for",n),null}return r}var _R=oc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),jC=oc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),qC=oc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Gle=oc(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),$C=oc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),jle=oc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),vR=oc(["#text"]),bR=oc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),KC=oc(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),xR=oc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Sv=oc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),qle=oh(/\{\{[\w\W]*|[\w\W]*\}\}/gm),$le=oh(/<%[\w\W]*|[\w\W]*%>/gm),Kle=oh(/\${[\w\W]*}/gm),Wle=oh(/^data-[\-\w.\u00B7-\uFFFF]/),Xle=oh(/^aria-[\-\w]+$/),Zle=oh(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Jle=oh(/^(?:\w+script|data):/i),Yle=oh(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ece=oh(/^html$/i),tce=function(){return typeof window>"u"?null:window},ice=function(i,e){if(md(i)!=="object"||typeof i.createPolicy!="function")return null;var t=null,r="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(r)&&(t=e.currentScript.getAttribute(r));var n="dompurify"+(t?"#"+t:"");try{return i.createPolicy(n,{createHTML:function(o){return o},createScriptURL:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}};function wR(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tce(),e=function(st){return wR(st)};if(e.version="2.4.5",e.removed=[],!i||!i.document||i.document.nodeType!==9)return e.isSupported=!1,e;var t=i.document,r=i.document,n=i.DocumentFragment,o=i.HTMLTemplateElement,c=i.Node,s=i.Element,m=i.NodeFilter,x=i.NamedNodeMap,I=x===void 0?i.NamedNodeMap||i.MozNamedAttrMap:x,F=i.HTMLFormElement,O=i.DOMParser,z=i.trustedTypes,ie=s.prototype,ne=Ev(ie,"cloneNode"),ue=Ev(ie,"nextSibling"),ce=Ev(ie,"childNodes"),de=Ev(ie,"parentNode");if(typeof o=="function"){var be=r.createElement("template");be.content&&be.content.ownerDocument&&(r=be.content.ownerDocument)}var Te=ice(z,t),je=Te?Te.createHTML(""):"",Ge=r,$e=Ge.implementation,Ue=Ge.createNodeIterator,lt=Ge.createDocumentFragment,nt=Ge.getElementsByTagName,De=t.importNode,Fe={};try{Fe=bf(r).documentMode?r.documentMode:{}}catch{}var Je={};e.isSupported=typeof de=="function"&&$e&&typeof $e.createHTMLDocument<"u"&&Fe!==9;var We=qle,Et=$le,Ct=Kle,Lt=Wle,_t=Xle,Ft=Jle,Mt=Yle,Wt=Zle,Ee=null,Xe=nn({},[].concat(sh(_R),sh(jC),sh(qC),sh($C),sh(vR))),et=null,At=nn({},[].concat(sh(bR),sh(KC),sh(xR),sh(Sv))),ft=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),wt=null,Pt=null,It=!0,Ht=!0,ii=!1,gi=!0,mi=!1,Mi=!1,kt=!1,ot=!1,xt=!1,Ri=!1,ei=!1,ut=!0,jt=!1,ni="user-content-",di=!0,li=!1,Ki={},tr=null,Ar=nn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Er=null,Nt=nn({},["audio","video","img","source","image","track"]),Ji=null,ci=nn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),$t="http://www.w3.org/1998/Math/MathML",Zi="http://www.w3.org/2000/svg",Qt="http://www.w3.org/1999/xhtml",Bi=Qt,Ii=!1,Gt=null,vi=nn({},[$t,Zi,Qt],HC),Jt,mr=["application/xhtml+xml","text/html"],Sr="text/html",ze,we=null,oe=r.createElement("form"),Y=function(st){return st instanceof RegExp||st instanceof Function},le=function(st){we&&we===st||((!st||md(st)!=="object")&&(st={}),st=bf(st),Jt=mr.indexOf(st.PARSER_MEDIA_TYPE)===-1?Jt=Sr:Jt=st.PARSER_MEDIA_TYPE,ze=Jt==="application/xhtml+xml"?HC:Cv,Ee="ALLOWED_TAGS"in st?nn({},st.ALLOWED_TAGS,ze):Xe,et="ALLOWED_ATTR"in st?nn({},st.ALLOWED_ATTR,ze):At,Gt="ALLOWED_NAMESPACES"in st?nn({},st.ALLOWED_NAMESPACES,HC):vi,Ji="ADD_URI_SAFE_ATTR"in st?nn(bf(ci),st.ADD_URI_SAFE_ATTR,ze):ci,Er="ADD_DATA_URI_TAGS"in st?nn(bf(Nt),st.ADD_DATA_URI_TAGS,ze):Nt,tr="FORBID_CONTENTS"in st?nn({},st.FORBID_CONTENTS,ze):Ar,wt="FORBID_TAGS"in st?nn({},st.FORBID_TAGS,ze):{},Pt="FORBID_ATTR"in st?nn({},st.FORBID_ATTR,ze):{},Ki="USE_PROFILES"in st?st.USE_PROFILES:!1,It=st.ALLOW_ARIA_ATTR!==!1,Ht=st.ALLOW_DATA_ATTR!==!1,ii=st.ALLOW_UNKNOWN_PROTOCOLS||!1,gi=st.ALLOW_SELF_CLOSE_IN_ATTR!==!1,mi=st.SAFE_FOR_TEMPLATES||!1,Mi=st.WHOLE_DOCUMENT||!1,xt=st.RETURN_DOM||!1,Ri=st.RETURN_DOM_FRAGMENT||!1,ei=st.RETURN_TRUSTED_TYPE||!1,ot=st.FORCE_BODY||!1,ut=st.SANITIZE_DOM!==!1,jt=st.SANITIZE_NAMED_PROPS||!1,di=st.KEEP_CONTENT!==!1,li=st.IN_PLACE||!1,Wt=st.ALLOWED_URI_REGEXP||Wt,Bi=st.NAMESPACE||Qt,ft=st.CUSTOM_ELEMENT_HANDLING||{},st.CUSTOM_ELEMENT_HANDLING&&Y(st.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ft.tagNameCheck=st.CUSTOM_ELEMENT_HANDLING.tagNameCheck),st.CUSTOM_ELEMENT_HANDLING&&Y(st.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ft.attributeNameCheck=st.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),st.CUSTOM_ELEMENT_HANDLING&&typeof st.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ft.allowCustomizedBuiltInElements=st.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),mi&&(Ht=!1),Ri&&(xt=!0),Ki&&(Ee=nn({},sh(vR)),et=[],Ki.html===!0&&(nn(Ee,_R),nn(et,bR)),Ki.svg===!0&&(nn(Ee,jC),nn(et,KC),nn(et,Sv)),Ki.svgFilters===!0&&(nn(Ee,qC),nn(et,KC),nn(et,Sv)),Ki.mathMl===!0&&(nn(Ee,$C),nn(et,xR),nn(et,Sv))),st.ADD_TAGS&&(Ee===Xe&&(Ee=bf(Ee)),nn(Ee,st.ADD_TAGS,ze)),st.ADD_ATTR&&(et===At&&(et=bf(et)),nn(et,st.ADD_ATTR,ze)),st.ADD_URI_SAFE_ATTR&&nn(Ji,st.ADD_URI_SAFE_ATTR,ze),st.FORBID_CONTENTS&&(tr===Ar&&(tr=bf(tr)),nn(tr,st.FORBID_CONTENTS,ze)),di&&(Ee["#text"]=!0),Mi&&nn(Ee,["html","head","body"]),Ee.table&&(nn(Ee,["tbody"]),delete wt.tbody),oc&&oc(st),we=st)},ge=nn({},["mi","mo","mn","ms","mtext"]),_e=nn({},["foreignobject","desc","title","annotation-xml"]),Ce=nn({},["title","style","font","a","script"]),ve=nn({},jC);nn(ve,qC),nn(ve,Gle);var Me=nn({},$C);nn(Me,jle);var Oe=function(st){var ti=de(st);(!ti||!ti.tagName)&&(ti={namespaceURI:Bi,tagName:"template"});var zt=Cv(st.tagName),zi=Cv(ti.tagName);return Gt[st.namespaceURI]?st.namespaceURI===Zi?ti.namespaceURI===Qt?zt==="svg":ti.namespaceURI===$t?zt==="svg"&&(zi==="annotation-xml"||ge[zi]):!!ve[zt]:st.namespaceURI===$t?ti.namespaceURI===Qt?zt==="math":ti.namespaceURI===Zi?zt==="math"&&_e[zi]:!!Me[zt]:st.namespaceURI===Qt?ti.namespaceURI===Zi&&!_e[zi]||ti.namespaceURI===$t&&!ge[zi]?!1:!Me[zt]&&(Ce[zt]||!ve[zt]):!!(Jt==="application/xhtml+xml"&&Gt[st.namespaceURI]):!1},Ve=function(st){Uy(e.removed,{element:st});try{st.parentNode.removeChild(st)}catch{try{st.outerHTML=je}catch{st.remove()}}},it=function(st,ti){try{Uy(e.removed,{attribute:ti.getAttributeNode(st),from:ti})}catch{Uy(e.removed,{attribute:null,from:ti})}if(ti.removeAttribute(st),st==="is"&&!et[st])if(xt||Ri)try{Ve(ti)}catch{}else try{ti.setAttribute(st,"")}catch{}},yt=function(st){var ti,zt;if(ot)st="<remove></remove>"+st;else{var zi=zle(st,/^[\r\n\t ]+/);zt=zi&&zi[0]}Jt==="application/xhtml+xml"&&Bi===Qt&&(st='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+st+"</body></html>");var hr=Te?Te.createHTML(st):st;if(Bi===Qt)try{ti=new O().parseFromString(hr,Jt)}catch{}if(!ti||!ti.documentElement){ti=$e.createDocument(Bi,"template",null);try{ti.documentElement.innerHTML=Ii?je:hr}catch{}}var sn=ti.body||ti.documentElement;return st&&zt&&sn.insertBefore(r.createTextNode(zt),sn.childNodes[0]||null),Bi===Qt?nt.call(ti,Mi?"html":"body")[0]:Mi?ti.documentElement:sn},Bt=function(st){return Ue.call(st.ownerDocument||st,st,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT,null,!1)},Yt=function(st){return st instanceof F&&(typeof st.nodeName!="string"||typeof st.textContent!="string"||typeof st.removeChild!="function"||!(st.attributes instanceof I)||typeof st.removeAttribute!="function"||typeof st.setAttribute!="function"||typeof st.namespaceURI!="string"||typeof st.insertBefore!="function"||typeof st.hasChildNodes!="function")},qt=function(st){return md(c)==="object"?st instanceof c:st&&md(st)==="object"&&typeof st.nodeType=="number"&&typeof st.nodeName=="string"},Kt=function(st,ti,zt){Je[st]&&Nle(Je[st],function(zi){zi.call(e,ti,zt,we)})},si=function(st){var ti;if(Kt("beforeSanitizeElements",st,null),Yt(st)||ac(/[\u0080-\uFFFF]/,st.nodeName))return Ve(st),!0;var zt=ze(st.nodeName);if(Kt("uponSanitizeElement",st,{tagName:zt,allowedTags:Ee}),st.hasChildNodes()&&!qt(st.firstElementChild)&&(!qt(st.content)||!qt(st.content.firstElementChild))&&ac(/<[/\w]/g,st.innerHTML)&&ac(/<[/\w]/g,st.textContent)||zt==="select"&&ac(/<template/i,st.innerHTML))return Ve(st),!0;if(!Ee[zt]||wt[zt]){if(!wt[zt]&&Hi(zt)&&(ft.tagNameCheck instanceof RegExp&&ac(ft.tagNameCheck,zt)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(zt)))return!1;if(di&&!tr[zt]){var zi=de(st)||st.parentNode,hr=ce(st)||st.childNodes;if(hr&&zi)for(var sn=hr.length,bn=sn-1;bn>=0;--bn)zi.insertBefore(ne(hr[bn],!0),ue(st))}return Ve(st),!0}return st instanceof s&&!Oe(st)||(zt==="noscript"||zt==="noembed")&&ac(/<\/no(script|embed)/i,st.innerHTML)?(Ve(st),!0):(mi&&st.nodeType===3&&(ti=st.textContent,ti=ah(ti,We," "),ti=ah(ti,Et," "),ti=ah(ti,Ct," "),st.textContent!==ti&&(Uy(e.removed,{element:st.cloneNode()}),st.textContent=ti)),Kt("afterSanitizeElements",st,null),!1)},Ci=function(st,ti,zt){if(ut&&(ti==="id"||ti==="name")&&(zt in r||zt in oe))return!1;if(!(Ht&&!Pt[ti]&&ac(Lt,ti))&&!(It&&ac(_t,ti))){if(!et[ti]||Pt[ti]){if(!(Hi(st)&&(ft.tagNameCheck instanceof RegExp&&ac(ft.tagNameCheck,st)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(st))&&(ft.attributeNameCheck instanceof RegExp&&ac(ft.attributeNameCheck,ti)||ft.attributeNameCheck instanceof Function&&ft.attributeNameCheck(ti))||ti==="is"&&ft.allowCustomizedBuiltInElements&&(ft.tagNameCheck instanceof RegExp&&ac(ft.tagNameCheck,zt)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(zt))))return!1}else if(!Ji[ti]&&!ac(Wt,ah(zt,Mt,""))&&!((ti==="src"||ti==="xlink:href"||ti==="href")&&st!=="script"&&Qle(zt,"data:")===0&&Er[st])&&!(ii&&!ac(Ft,ah(zt,Mt,"")))&&zt)return!1}return!0},Hi=function(st){return st.indexOf("-")>0},wi=function(st){var ti,zt,zi,hr;Kt("beforeSanitizeAttributes",st,null);var sn=st.attributes;if(sn){var bn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:et};for(hr=sn.length;hr--;){ti=sn[hr];var ur=ti,gn=ur.name,mn=ur.namespaceURI;if(zt=gn==="value"?ti.value:Vle(ti.value),zi=ze(gn),bn.attrName=zi,bn.attrValue=zt,bn.keepAttr=!0,bn.forceKeepAttr=void 0,Kt("uponSanitizeAttribute",st,bn),zt=bn.attrValue,!bn.forceKeepAttr&&(it(gn,st),!!bn.keepAttr)){if(!gi&&ac(/\/>/i,zt)){it(gn,st);continue}mi&&(zt=ah(zt,We," "),zt=ah(zt,Et," "),zt=ah(zt,Ct," "));var lr=ze(st.nodeName);if(Ci(lr,zi,zt)){if(jt&&(zi==="id"||zi==="name")&&(it(gn,st),zt=ni+zt),Te&&md(z)==="object"&&typeof z.getAttributeType=="function"&&!mn)switch(z.getAttributeType(lr,zi)){case"TrustedHTML":zt=Te.createHTML(zt);break;case"TrustedScriptURL":zt=Te.createScriptURL(zt);break}try{mn?st.setAttributeNS(mn,gn,zt):st.setAttribute(gn,zt),yR(e.removed)}catch{}}}}Kt("afterSanitizeAttributes",st,null)}},Ui=function st(ti){var zt,zi=Bt(ti);for(Kt("beforeSanitizeShadowDOM",ti,null);zt=zi.nextNode();)Kt("uponSanitizeShadowNode",zt,null),!si(zt)&&(zt.content instanceof n&&st(zt.content),wi(zt));Kt("afterSanitizeShadowDOM",ti,null)};return e.sanitize=function(st){var ti=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},zt,zi,hr,sn,bn;if(Ii=!st,Ii&&(st="<!-->"),typeof st!="string"&&!qt(st)){if(typeof st.toString!="function")throw GC("toString is not a function");if(st=st.toString(),typeof st!="string")throw GC("dirty is not a string, aborting")}if(!e.isSupported){if(md(i.toStaticHTML)==="object"||typeof i.toStaticHTML=="function"){if(typeof st=="string")return i.toStaticHTML(st);if(qt(st))return i.toStaticHTML(st.outerHTML)}return st}if(kt||le(ti),e.removed=[],typeof st=="string"&&(li=!1),li){if(st.nodeName){var ur=ze(st.nodeName);if(!Ee[ur]||wt[ur])throw GC("root node is forbidden and cannot be sanitized in-place")}}else if(st instanceof c)zt=yt("<!---->"),zi=zt.ownerDocument.importNode(st,!0),zi.nodeType===1&&zi.nodeName==="BODY"||zi.nodeName==="HTML"?zt=zi:zt.appendChild(zi);else{if(!xt&&!mi&&!Mi&&st.indexOf("<")===-1)return Te&&ei?Te.createHTML(st):st;if(zt=yt(st),!zt)return xt?null:ei?je:""}zt&&ot&&Ve(zt.firstChild);for(var gn=Bt(li?st:zt);hr=gn.nextNode();)hr.nodeType===3&&hr===sn||si(hr)||(hr.content instanceof n&&Ui(hr.content),wi(hr),sn=hr);if(sn=null,li)return st;if(xt){if(Ri)for(bn=lt.call(zt.ownerDocument);zt.firstChild;)bn.appendChild(zt.firstChild);else bn=zt;return(et.shadowroot||et.shadowrootmod)&&(bn=De.call(t,bn,!0)),bn}var mn=Mi?zt.outerHTML:zt.innerHTML;return Mi&&Ee["!doctype"]&&zt.ownerDocument&&zt.ownerDocument.doctype&&zt.ownerDocument.doctype.name&&ac(ece,zt.ownerDocument.doctype.name)&&(mn="<!DOCTYPE "+zt.ownerDocument.doctype.name+`>
`+mn),mi&&(mn=ah(mn,We," "),mn=ah(mn,Et," "),mn=ah(mn,Ct," ")),Te&&ei?Te.createHTML(mn):mn},e.setConfig=function(st){le(st),kt=!0},e.clearConfig=function(){we=null,kt=!1},e.isValidAttribute=function(st,ti,zt){we||le({});var zi=ze(st),hr=ze(ti);return Ci(zi,hr,zt)},e.addHook=function(st,ti){typeof ti=="function"&&(Je[st]=Je[st]||[],Uy(Je[st],ti))},e.removeHook=function(st){if(Je[st])return yR(Je[st])},e.removeHooks=function(st){Je[st]&&(Je[st]=[])},e.removeAllHooks=function(){Je={}},e}var rce=wR();const nce=Object.freeze(Object.defineProperty({__proto__:null,default:rce},Symbol.toStringTag,{value:"Module"}));var Ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BR(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Tv=function(i){return i&&i.Math==Math&&i},Ca=Tv(typeof globalThis=="object"&&globalThis)||Tv(typeof window=="object"&&window)||Tv(typeof self=="object"&&self)||Tv(typeof Ny=="object"&&Ny)||function(){return this}()||Ny||Function("return this")(),Sg={},qo=function(i){try{return!!i()}catch{return!0}},sce=qo,jh=!sce(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),oce=qo,Iv=!oce(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")}),ace=Iv,Lv=Function.prototype.call,rl=ace?Lv.bind(Lv):function(){return Lv.apply(Lv,arguments)},CR={},ER={}.propertyIsEnumerable,SR=Object.getOwnPropertyDescriptor,lce=SR&&!ER.call({1:2},1);CR.f=lce?function(i){var e=SR(this,i);return!!e&&e.enumerable}:ER;var Mv=function(i,e){return{enumerable:!(i&1),configurable:!(i&2),writable:!(i&4),value:e}},TR=Iv,IR=Function.prototype,WC=IR.call,cce=TR&&IR.bind.bind(WC,WC),$o=TR?cce:function(i){return function(){return WC.apply(i,arguments)}},LR=$o,uce=LR({}.toString),hce=LR("".slice),xf=function(i){return hce(uce(i),8,-1)},Ace=$o,dce=qo,fce=xf,XC=Object,pce=Ace("".split),MR=dce(function(){return!XC("z").propertyIsEnumerable(0)})?function(i){return fce(i)=="String"?pce(i,""):XC(i)}:XC,wf=function(i){return i==null},gce=wf,mce=TypeError,qh=function(i){if(gce(i))throw mce("Can't call method on "+i);return i},yce=MR,_ce=qh,zy=function(i){return yce(_ce(i))},ZC=typeof document=="object"&&document.all,vce=typeof ZC>"u"&&ZC!==void 0,PR={all:ZC,IS_HTMLDDA:vce},FR=PR,bce=FR.all,Co=FR.IS_HTMLDDA?function(i){return typeof i=="function"||i===bce}:function(i){return typeof i=="function"},DR=Co,RR=PR,xce=RR.all,EA=RR.IS_HTMLDDA?function(i){return typeof i=="object"?i!==null:DR(i)||i===xce}:function(i){return typeof i=="object"?i!==null:DR(i)},JC=Ca,wce=Co,Bce=function(i){return wce(i)?i:void 0},Bf=function(i,e){return arguments.length<2?Bce(JC[i]):JC[i]&&JC[i][e]},Cce=$o,Pv=Cce({}.isPrototypeOf),Fv=typeof navigator<"u"&&String(navigator.userAgent)||"",kR=Ca,YC=Fv,OR=kR.process,UR=kR.Deno,NR=OR&&OR.versions||UR&&UR.version,zR=NR&&NR.v8,lh,Dv;zR&&(lh=zR.split("."),Dv=lh[0]>0&&lh[0]<4?1:+(lh[0]+lh[1])),!Dv&&YC&&(lh=YC.match(/Edge\/(\d+)/),(!lh||lh[1]>=74)&&(lh=YC.match(/Chrome\/(\d+)/),lh&&(Dv=+lh[1])));var eE=Dv,QR=eE,Ece=qo,Sce=Ca,Tce=Sce.String,VR=!!Object.getOwnPropertySymbols&&!Ece(function(){var i=Symbol();return!Tce(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&QR&&QR<41}),Ice=VR,HR=Ice&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Lce=Bf,Mce=Co,Pce=Pv,Fce=HR,Dce=Object,GR=Fce?function(i){return typeof i=="symbol"}:function(i){var e=Lce("Symbol");return Mce(e)&&Pce(e.prototype,Dce(i))},Rce=String,Rv=function(i){try{return Rce(i)}catch{return"Object"}},kce=Co,Oce=Rv,Uce=TypeError,SA=function(i){if(kce(i))return i;throw Uce(Oce(i)+" is not a function")},Nce=SA,zce=wf,Tg=function(i,e){var t=i[e];return zce(t)?void 0:Nce(t)},tE=rl,iE=Co,rE=EA,Qce=TypeError,Vce=function(i,e){var t,r;if(e==="string"&&iE(t=i.toString)&&!rE(r=tE(t,i))||iE(t=i.valueOf)&&!rE(r=tE(t,i))||e!=="string"&&iE(t=i.toString)&&!rE(r=tE(t,i)))return r;throw Qce("Can't convert object to primitive value")},jR={exports:{}},qR=Ca,Hce=Object.defineProperty,nE=function(i,e){try{Hce(qR,i,{value:e,configurable:!0,writable:!0})}catch{qR[i]=e}return e},Gce=Ca,jce=nE,$R="__core-js_shared__",qce=Gce[$R]||jce($R,{}),sE=qce,KR=sE;(jR.exports=function(i,e){return KR[i]||(KR[i]=e!==void 0?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var oE=jR.exports,$ce=qh,Kce=Object,kv=function(i){return Kce($ce(i))},Wce=$o,Xce=kv,Zce=Wce({}.hasOwnProperty),ch=Object.hasOwn||function(i,e){return Zce(Xce(i),e)},Jce=$o,Yce=0,eue=Math.random(),tue=Jce(1 .toString),WR=function(i){return"Symbol("+(i===void 0?"":i)+")_"+tue(++Yce+eue,36)},iue=Ca,rue=oE,XR=ch,nue=WR,sue=VR,oue=HR,Ig=iue.Symbol,aE=rue("wks"),aue=oue?Ig.for||Ig:Ig&&Ig.withoutSetter||nue,Qa=function(i){return XR(aE,i)||(aE[i]=sue&&XR(Ig,i)?Ig[i]:aue("Symbol."+i)),aE[i]},lue=rl,ZR=EA,JR=GR,cue=Tg,uue=Vce,hue=Qa,Aue=TypeError,due=hue("toPrimitive"),fue=function(i,e){if(!ZR(i)||JR(i))return i;var t=cue(i,due),r;if(t){if(e===void 0&&(e="default"),r=lue(t,i,e),!ZR(r)||JR(r))return r;throw Aue("Can't convert object to primitive value")}return e===void 0&&(e="number"),uue(i,e)},pue=fue,gue=GR,lE=function(i){var e=pue(i,"string");return gue(e)?e:e+""},mue=Ca,YR=EA,cE=mue.document,yue=YR(cE)&&YR(cE.createElement),Ov=function(i){return yue?cE.createElement(i):{}},_ue=jh,vue=qo,bue=Ov,ek=!_ue&&!vue(function(){return Object.defineProperty(bue("div"),"a",{get:function(){return 7}}).a!=7}),xue=jh,wue=rl,Bue=CR,Cue=Mv,Eue=zy,Sue=lE,Tue=ch,Iue=ek,tk=Object.getOwnPropertyDescriptor;Sg.f=xue?tk:function(i,e){if(i=Eue(i),e=Sue(e),Iue)try{return tk(i,e)}catch{}if(Tue(i,e))return Cue(!wue(Bue.f,i,e),i[e])};var $h={},Lue=jh,Mue=qo,ik=Lue&&Mue(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Pue=EA,Fue=String,Due=TypeError,Pl=function(i){if(Pue(i))return i;throw Due(Fue(i)+" is not an object")},Rue=jh,kue=ek,Oue=ik,Uv=Pl,rk=lE,Uue=TypeError,uE=Object.defineProperty,Nue=Object.getOwnPropertyDescriptor,hE="enumerable",AE="configurable",dE="writable";$h.f=Rue?Oue?function(i,e,t){if(Uv(i),e=rk(e),Uv(t),typeof i=="function"&&e==="prototype"&&"value"in t&&dE in t&&!t[dE]){var r=Nue(i,e);r&&r[dE]&&(i[e]=t.value,t={configurable:AE in t?t[AE]:r[AE],enumerable:hE in t?t[hE]:r[hE],writable:!1})}return uE(i,e,t)}:uE:function(i,e,t){if(Uv(i),e=rk(e),Uv(t),kue)try{return uE(i,e,t)}catch{}if("get"in t||"set"in t)throw Uue("Accessors not supported");return"value"in t&&(i[e]=t.value),i};var zue=jh,Que=$h,Vue=Mv,Qy=zue?function(i,e,t){return Que.f(i,e,Vue(1,t))}:function(i,e,t){return i[e]=t,i},nk={exports:{}},fE=jh,Hue=ch,sk=Function.prototype,Gue=fE&&Object.getOwnPropertyDescriptor,pE=Hue(sk,"name"),jue=pE&&(function(){}).name==="something",que=pE&&(!fE||fE&&Gue(sk,"name").configurable),Nv={EXISTS:pE,PROPER:jue,CONFIGURABLE:que},$ue=$o,Kue=Co,gE=sE,Wue=$ue(Function.toString);Kue(gE.inspectSource)||(gE.inspectSource=function(i){return Wue(i)});var mE=gE.inspectSource,Xue=Ca,Zue=Co,ok=Xue.WeakMap,Jue=Zue(ok)&&/native code/.test(String(ok)),Yue=oE,ehe=WR,ak=Yue("keys"),yE=function(i){return ak[i]||(ak[i]=ehe(i))},_E={},the=Jue,lk=Ca,ihe=EA,rhe=Qy,vE=ch,bE=sE,nhe=yE,she=_E,ck="Object already initialized",xE=lk.TypeError,ohe=lk.WeakMap,zv,Vy,Qv,ahe=function(i){return Qv(i)?Vy(i):zv(i,{})},lhe=function(i){return function(e){var t;if(!ihe(e)||(t=Vy(e)).type!==i)throw xE("Incompatible receiver, "+i+" required");return t}};if(the||bE.state){var Kh=bE.state||(bE.state=new ohe);Kh.get=Kh.get,Kh.has=Kh.has,Kh.set=Kh.set,zv=function(i,e){if(Kh.has(i))throw xE(ck);return e.facade=i,Kh.set(i,e),e},Vy=function(i){return Kh.get(i)||{}},Qv=function(i){return Kh.has(i)}}else{var Lg=nhe("state");she[Lg]=!0,zv=function(i,e){if(vE(i,Lg))throw xE(ck);return e.facade=i,rhe(i,Lg,e),e},Vy=function(i){return vE(i,Lg)?i[Lg]:{}},Qv=function(i){return vE(i,Lg)}}var Vv={set:zv,get:Vy,has:Qv,enforce:ahe,getterFor:lhe},wE=$o,che=qo,uhe=Co,Hv=ch,BE=jh,hhe=Nv.CONFIGURABLE,Ahe=mE,uk=Vv,dhe=uk.enforce,fhe=uk.get,hk=String,Gv=Object.defineProperty,phe=wE("".slice),ghe=wE("".replace),mhe=wE([].join),yhe=BE&&!che(function(){return Gv(function(){},"length",{value:8}).length!==8}),_he=String(String).split("String"),vhe=nk.exports=function(i,e,t){phe(hk(e),0,7)==="Symbol("&&(e="["+ghe(hk(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Hv(i,"name")||hhe&&i.name!==e)&&(BE?Gv(i,"name",{value:e,configurable:!0}):i.name=e),yhe&&t&&Hv(t,"arity")&&i.length!==t.arity&&Gv(i,"length",{value:t.arity});try{t&&Hv(t,"constructor")&&t.constructor?BE&&Gv(i,"prototype",{writable:!1}):i.prototype&&(i.prototype=void 0)}catch{}var r=dhe(i);return Hv(r,"source")||(r.source=mhe(_he,typeof e=="string"?e:"")),i};Function.prototype.toString=vhe(function(){return uhe(this)&&fhe(this).source||Ahe(this)},"toString");var Ak=nk.exports,bhe=Co,xhe=$h,whe=Ak,Bhe=nE,Cf=function(i,e,t,r){r||(r={});var n=r.enumerable,o=r.name!==void 0?r.name:e;if(bhe(t)&&whe(t,o,r),r.global)n?i[e]=t:Bhe(e,t);else{try{r.unsafe?i[e]&&(n=!0):delete i[e]}catch{}n?i[e]=t:xhe.f(i,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return i},dk={},Che=Math.ceil,Ehe=Math.floor,She=Math.trunc||function(i){var e=+i;return(e>0?Ehe:Che)(e)},The=She,jv=function(i){var e=+i;return e!==e||e===0?0:The(e)},Ihe=jv,Lhe=Math.max,Mhe=Math.min,fk=function(i,e){var t=Ihe(i);return t<0?Lhe(t+e,0):Mhe(t,e)},Phe=jv,Fhe=Math.min,Mg=function(i){return i>0?Fhe(Phe(i),9007199254740991):0},Dhe=Mg,qv=function(i){return Dhe(i.length)},Rhe=zy,khe=fk,Ohe=qv,pk=function(i){return function(e,t,r){var n=Rhe(e),o=Ohe(n),c=khe(r,o),s;if(i&&t!=t){for(;o>c;)if(s=n[c++],s!=s)return!0}else for(;o>c;c++)if((i||c in n)&&n[c]===t)return i||c||0;return!i&&-1}},gk={includes:pk(!0),indexOf:pk(!1)},Uhe=$o,CE=ch,Nhe=zy,zhe=gk.indexOf,Qhe=_E,mk=Uhe([].push),yk=function(i,e){var t=Nhe(i),r=0,n=[],o;for(o in t)!CE(Qhe,o)&&CE(t,o)&&mk(n,o);for(;e.length>r;)CE(t,o=e[r++])&&(~zhe(n,o)||mk(n,o));return n},EE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vhe=yk,Hhe=EE,Ghe=Hhe.concat("length","prototype");dk.f=Object.getOwnPropertyNames||function(i){return Vhe(i,Ghe)};var _k={};_k.f=Object.getOwnPropertySymbols;var jhe=Bf,qhe=$o,$he=dk,Khe=_k,Whe=Pl,Xhe=qhe([].concat),Zhe=jhe("Reflect","ownKeys")||function(i){var e=$he.f(Whe(i)),t=Khe.f;return t?Xhe(e,t(i)):e},vk=ch,Jhe=Zhe,Yhe=Sg,eAe=$h,tAe=function(i,e,t){for(var r=Jhe(e),n=eAe.f,o=Yhe.f,c=0;c<r.length;c++){var s=r[c];!vk(i,s)&&!(t&&vk(t,s))&&n(i,s,o(e,s))}},iAe=qo,rAe=Co,nAe=/#|\.prototype\./,Hy=function(i,e){var t=oAe[sAe(i)];return t==lAe?!0:t==aAe?!1:rAe(e)?iAe(e):!!e},sAe=Hy.normalize=function(i){return String(i).replace(nAe,".").toLowerCase()},oAe=Hy.data={},aAe=Hy.NATIVE="N",lAe=Hy.POLYFILL="P",bk=Hy,SE=Ca,cAe=Sg.f,uAe=Qy,hAe=Cf,AAe=nE,dAe=tAe,fAe=bk,lc=function(i,e){var t=i.target,r=i.global,n=i.stat,o,c,s,m,x,I;if(r?c=SE:n?c=SE[t]||AAe(t,{}):c=(SE[t]||{}).prototype,c)for(s in e){if(x=e[s],i.dontCallGetSet?(I=cAe(c,s),m=I&&I.value):m=c[s],o=fAe(r?s:t+(n?".":"#")+s,i.forced),!o&&m!==void 0){if(typeof x==typeof m)continue;dAe(x,m)}(i.sham||m&&m.sham)&&uAe(x,"sham",!0),hAe(c,s,x,i)}},pAe=xf,Gy=typeof process<"u"&&pAe(process)=="process",gAe=$o,mAe=SA,yAe=function(i,e,t){try{return gAe(mAe(Object.getOwnPropertyDescriptor(i,e)[t]))}catch{}},_Ae=Co,vAe=String,bAe=TypeError,xAe=function(i){if(typeof i=="object"||_Ae(i))return i;throw bAe("Can't set "+vAe(i)+" as a prototype")},wAe=yAe,BAe=Pl,CAe=xAe,xk=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,e={},t;try{t=wAe(Object.prototype,"__proto__","set"),t(e,[]),i=e instanceof Array}catch{}return function(r,n){return BAe(r),CAe(n),i?t(r,n):r.__proto__=n,r}}():void 0),EAe=$h.f,SAe=ch,TAe=Qa,wk=TAe("toStringTag"),TE=function(i,e,t){i&&!t&&(i=i.prototype),i&&!SAe(i,wk)&&EAe(i,wk,{configurable:!0,value:e})},Bk=Ak,IAe=$h,LAe=function(i,e,t){return t.get&&Bk(t.get,e,{getter:!0}),t.set&&Bk(t.set,e,{setter:!0}),IAe.f(i,e,t)},MAe=Bf,PAe=LAe,FAe=Qa,DAe=jh,Ck=FAe("species"),RAe=function(i){var e=MAe(i);DAe&&e&&!e[Ck]&&PAe(e,Ck,{configurable:!0,get:function(){return this}})},kAe=Pv,OAe=TypeError,UAe=function(i,e){if(kAe(e,i))return i;throw OAe("Incorrect invocation")},NAe=Qa,zAe=NAe("toStringTag"),Ek={};Ek[zAe]="z";var QAe=String(Ek)==="[object z]",VAe=QAe,HAe=Co,$v=xf,GAe=Qa,jAe=GAe("toStringTag"),qAe=Object,$Ae=$v(function(){return arguments}())=="Arguments",KAe=function(i,e){try{return i[e]}catch{}},IE=VAe?$v:function(i){var e,t,r;return i===void 0?"Undefined":i===null?"Null":typeof(t=KAe(e=qAe(i),jAe))=="string"?t:$Ae?$v(e):(r=$v(e))=="Object"&&HAe(e.callee)?"Arguments":r},WAe=$o,XAe=qo,Sk=Co,ZAe=IE,JAe=Bf,YAe=mE,Tk=function(){},ede=[],Ik=JAe("Reflect","construct"),LE=/^\s*(?:class|function)\b/,tde=WAe(LE.exec),ide=!LE.exec(Tk),jy=function(i){if(!Sk(i))return!1;try{return Ik(Tk,ede,i),!0}catch{return!1}},Lk=function(i){if(!Sk(i))return!1;switch(ZAe(i)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ide||!!tde(LE,YAe(i))}catch{return!0}};Lk.sham=!0;var rde=!Ik||XAe(function(){var i;return jy(jy.call)||!jy(Object)||!jy(function(){i=!0})||i})?Lk:jy,nde=rde,sde=Rv,ode=TypeError,ade=function(i){if(nde(i))return i;throw ode(sde(i)+" is not a constructor")},Mk=Pl,lde=ade,cde=wf,ude=Qa,hde=ude("species"),Pk=function(i,e){var t=Mk(i).constructor,r;return t===void 0||cde(r=Mk(t)[hde])?e:lde(r)},Ade=Iv,Fk=Function.prototype,Dk=Fk.apply,Rk=Fk.call,ME=typeof Reflect=="object"&&Reflect.apply||(Ade?Rk.bind(Dk):function(){return Rk.apply(Dk,arguments)}),dde=xf,fde=$o,qy=function(i){if(dde(i)==="Function")return fde(i)},kk=qy,pde=SA,gde=Iv,mde=kk(kk.bind),PE=function(i,e){return pde(i),e===void 0?i:gde?mde(i,e):function(){return i.apply(e,arguments)}},yde=Bf,Ok=yde("document","documentElement"),_de=$o,vde=_de([].slice),bde=TypeError,xde=function(i,e){if(i<e)throw bde("Not enough arguments");return i},wde=Fv,Uk=/(?:ipad|iphone|ipod).*applewebkit/i.test(wde),tu=Ca,Bde=ME,Cde=PE,Nk=Co,Ede=ch,zk=qo,Qk=Ok,Sde=vde,Vk=Ov,Tde=xde,Ide=Uk,Lde=Gy,FE=tu.setImmediate,DE=tu.clearImmediate,Mde=tu.process,RE=tu.Dispatch,Pde=tu.Function,Hk=tu.MessageChannel,Fde=tu.String,kE=0,$y={},Gk="onreadystatechange",Ky,Ef,OE,UE;zk(function(){Ky=tu.location});var NE=function(i){if(Ede($y,i)){var e=$y[i];delete $y[i],e()}},zE=function(i){return function(){NE(i)}},jk=function(i){NE(i.data)},qk=function(i){tu.postMessage(Fde(i),Ky.protocol+"//"+Ky.host)};(!FE||!DE)&&(FE=function(i){Tde(arguments.length,1);var e=Nk(i)?i:Pde(i),t=Sde(arguments,1);return $y[++kE]=function(){Bde(e,void 0,t)},Ef(kE),kE},DE=function(i){delete $y[i]},Lde?Ef=function(i){Mde.nextTick(zE(i))}:RE&&RE.now?Ef=function(i){RE.now(zE(i))}:Hk&&!Ide?(OE=new Hk,UE=OE.port2,OE.port1.onmessage=jk,Ef=Cde(UE.postMessage,UE)):tu.addEventListener&&Nk(tu.postMessage)&&!tu.importScripts&&Ky&&Ky.protocol!=="file:"&&!zk(qk)?(Ef=qk,tu.addEventListener("message",jk,!1)):Gk in Vk("script")?Ef=function(i){Qk.appendChild(Vk("script"))[Gk]=function(){Qk.removeChild(this),NE(i)}}:Ef=function(i){setTimeout(zE(i),0)});var $k={set:FE,clear:DE},Kk=function(){this.head=null,this.tail=null};Kk.prototype={add:function(i){var e={item:i,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var i=this.head;if(i){var e=this.head=i.next;return e===null&&(this.tail=null),i.item}}};var Wk=Kk,Dde=Fv,Rde=/ipad|iphone|ipod/i.test(Dde)&&typeof Pebble<"u",kde=Fv,Ode=/web0s(?!.*chrome)/i.test(kde),Sf=Ca,Xk=PE,Ude=Sg.f,QE=$k.set,Nde=Wk,zde=Uk,Qde=Rde,Vde=Ode,VE=Gy,Zk=Sf.MutationObserver||Sf.WebKitMutationObserver,Jk=Sf.document,Yk=Sf.process,Kv=Sf.Promise,eO=Ude(Sf,"queueMicrotask"),HE=eO&&eO.value,Pg,GE,jE,Wv,tO;if(!HE){var Xv=new Nde,Zv=function(){var i,e;for(VE&&(i=Yk.domain)&&i.exit();e=Xv.get();)try{e()}catch(t){throw Xv.head&&Pg(),t}i&&i.enter()};!zde&&!VE&&!Vde&&Zk&&Jk?(GE=!0,jE=Jk.createTextNode(""),new Zk(Zv).observe(jE,{characterData:!0}),Pg=function(){jE.data=GE=!GE}):!Qde&&Kv&&Kv.resolve?(Wv=Kv.resolve(void 0),Wv.constructor=Kv,tO=Xk(Wv.then,Wv),Pg=function(){tO(Zv)}):VE?Pg=function(){Yk.nextTick(Zv)}:(QE=Xk(QE,Sf),Pg=function(){QE(Zv)}),HE=function(i){Xv.head||Pg(),Xv.add(i)}}var Hde=HE,Gde=function(i,e){try{arguments.length==1?console.error(i):console.error(i,e)}catch{}},qE=function(i){try{return{error:!1,value:i()}}catch(e){return{error:!0,value:e}}},jde=Ca,Jv=jde.Promise,iO=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",qde=iO,$de=Gy,Kde=!qde&&!$de&&typeof window=="object"&&typeof document=="object",Wde=Ca,Wy=Jv,Xde=Co,Zde=bk,Jde=mE,Yde=Qa,efe=Kde,tfe=iO,$E=eE;Wy&&Wy.prototype;var ife=Yde("species"),KE=!1,rO=Xde(Wde.PromiseRejectionEvent),rfe=Zde("Promise",function(){var i=Jde(Wy),e=i!==String(Wy);if(!e&&$E===66)return!0;if(!$E||$E<51||!/native code/.test(i)){var t=new Wy(function(o){o(1)}),r=function(o){o(function(){},function(){})},n=t.constructor={};if(n[ife]=r,KE=t.then(function(){})instanceof r,!KE)return!0}return!e&&(efe||tfe)&&!rO}),Xy={CONSTRUCTOR:rfe,REJECTION_EVENT:rO,SUBCLASSING:KE},Fg={},nO=SA,nfe=TypeError,sfe=function(i){var e,t;this.promise=new i(function(r,n){if(e!==void 0||t!==void 0)throw nfe("Bad Promise constructor");e=r,t=n}),this.resolve=nO(e),this.reject=nO(t)};Fg.f=function(i){return new sfe(i)};var ofe=lc,Yv=Gy,yd=Ca,Dg=rl,sO=Cf,oO=xk,afe=TE,lfe=RAe,cfe=SA,eb=Co,ufe=EA,hfe=UAe,Afe=Pk,aO=$k.set,WE=Hde,dfe=Gde,ffe=qE,pfe=Wk,lO=Vv,tb=Jv,XE=Xy,cO=Fg,ib="Promise",uO=XE.CONSTRUCTOR,gfe=XE.REJECTION_EVENT,mfe=XE.SUBCLASSING,ZE=lO.getterFor(ib),yfe=lO.set,Rg=tb&&tb.prototype,Tf=tb,rb=Rg,hO=yd.TypeError,JE=yd.document,YE=yd.process,eS=cO.f,_fe=eS,vfe=!!(JE&&JE.createEvent&&yd.dispatchEvent),AO="unhandledrejection",bfe="rejectionhandled",dO=0,fO=1,xfe=2,tS=1,pO=2,nb,gO,wfe,mO,yO=function(i){var e;return ufe(i)&&eb(e=i.then)?e:!1},_O=function(i,e){var t=e.value,r=e.state==fO,n=r?i.ok:i.fail,o=i.resolve,c=i.reject,s=i.domain,m,x,I;try{n?(r||(e.rejection===pO&&Cfe(e),e.rejection=tS),n===!0?m=t:(s&&s.enter(),m=n(t),s&&(s.exit(),I=!0)),m===i.promise?c(hO("Promise-chain cycle")):(x=yO(m))?Dg(x,m,o,c):o(m)):c(t)}catch(F){s&&!I&&s.exit(),c(F)}},vO=function(i,e){i.notified||(i.notified=!0,WE(function(){for(var t=i.reactions,r;r=t.get();)_O(r,i);i.notified=!1,e&&!i.rejection&&Bfe(i)}))},bO=function(i,e,t){var r,n;vfe?(r=JE.createEvent("Event"),r.promise=e,r.reason=t,r.initEvent(i,!1,!0),yd.dispatchEvent(r)):r={promise:e,reason:t},!gfe&&(n=yd["on"+i])?n(r):i===AO&&dfe("Unhandled promise rejection",t)},Bfe=function(i){Dg(aO,yd,function(){var e=i.facade,t=i.value,r=xO(i),n;if(r&&(n=ffe(function(){Yv?YE.emit("unhandledRejection",t,e):bO(AO,e,t)}),i.rejection=Yv||xO(i)?pO:tS,n.error))throw n.value})},xO=function(i){return i.rejection!==tS&&!i.parent},Cfe=function(i){Dg(aO,yd,function(){var e=i.facade;Yv?YE.emit("rejectionHandled",e):bO(bfe,e,i.value)})},kg=function(i,e,t){return function(r){i(e,r,t)}},Og=function(i,e,t){i.done||(i.done=!0,t&&(i=t),i.value=e,i.state=xfe,vO(i,!0))},iS=function(i,e,t){if(!i.done){i.done=!0,t&&(i=t);try{if(i.facade===e)throw hO("Promise can't be resolved itself");var r=yO(e);r?WE(function(){var n={done:!1};try{Dg(r,e,kg(iS,n,i),kg(Og,n,i))}catch(o){Og(n,o,i)}}):(i.value=e,i.state=fO,vO(i,!1))}catch(n){Og({done:!1},n,i)}}};if(uO&&(Tf=function(i){hfe(this,rb),cfe(i),Dg(nb,this);var e=ZE(this);try{i(kg(iS,e),kg(Og,e))}catch(t){Og(e,t)}},rb=Tf.prototype,nb=function(i){yfe(this,{type:ib,done:!1,notified:!1,parent:!1,reactions:new pfe,rejection:!1,state:dO,value:void 0})},nb.prototype=sO(rb,"then",function(i,e){var t=ZE(this),r=eS(Afe(this,Tf));return t.parent=!0,r.ok=eb(i)?i:!0,r.fail=eb(e)&&e,r.domain=Yv?YE.domain:void 0,t.state==dO?t.reactions.add(r):WE(function(){_O(r,t)}),r.promise}),gO=function(){var i=new nb,e=ZE(i);this.promise=i,this.resolve=kg(iS,e),this.reject=kg(Og,e)},cO.f=eS=function(i){return i===Tf||i===wfe?new gO(i):_fe(i)},eb(tb)&&Rg!==Object.prototype)){mO=Rg.then,mfe||sO(Rg,"then",function(i,e){var t=this;return new Tf(function(r,n){Dg(mO,t,r,n)}).then(i,e)},{unsafe:!0});try{delete Rg.constructor}catch{}oO&&oO(Rg,rb)}ofe({global:!0,constructor:!0,wrap:!0,forced:uO},{Promise:Tf}),afe(Tf,ib,!1),lfe(ib);var Zy={},Efe=Qa,Sfe=Zy,Tfe=Efe("iterator"),Ife=Array.prototype,Lfe=function(i){return i!==void 0&&(Sfe.Array===i||Ife[Tfe]===i)},Mfe=IE,wO=Tg,Pfe=wf,Ffe=Zy,Dfe=Qa,Rfe=Dfe("iterator"),BO=function(i){if(!Pfe(i))return wO(i,Rfe)||wO(i,"@@iterator")||Ffe[Mfe(i)]},kfe=rl,Ofe=SA,Ufe=Pl,Nfe=Rv,zfe=BO,Qfe=TypeError,Vfe=function(i,e){var t=arguments.length<2?zfe(i):e;if(Ofe(t))return Ufe(kfe(t,i));throw Qfe(Nfe(i)+" is not iterable")},Hfe=rl,CO=Pl,Gfe=Tg,jfe=function(i,e,t){var r,n;CO(i);try{if(r=Gfe(i,"return"),!r){if(e==="throw")throw t;return t}r=Hfe(r,i)}catch(o){n=!0,r=o}if(e==="throw")throw t;if(n)throw r;return CO(r),t},qfe=PE,$fe=rl,Kfe=Pl,Wfe=Rv,Xfe=Lfe,Zfe=qv,EO=Pv,Jfe=Vfe,Yfe=BO,SO=jfe,epe=TypeError,sb=function(i,e){this.stopped=i,this.result=e},TO=sb.prototype,IO=function(i,e,t){var r=t&&t.that,n=!!(t&&t.AS_ENTRIES),o=!!(t&&t.IS_RECORD),c=!!(t&&t.IS_ITERATOR),s=!!(t&&t.INTERRUPTED),m=qfe(e,r),x,I,F,O,z,ie,ne,ue=function(de){return x&&SO(x,"normal",de),new sb(!0,de)},ce=function(de){return n?(Kfe(de),s?m(de[0],de[1],ue):m(de[0],de[1])):s?m(de,ue):m(de)};if(o)x=i.iterator;else if(c)x=i;else{if(I=Yfe(i),!I)throw epe(Wfe(i)+" is not iterable");if(Xfe(I)){for(F=0,O=Zfe(i);O>F;F++)if(z=ce(i[F]),z&&EO(TO,z))return z;return new sb(!1)}x=Jfe(i,I)}for(ie=o?i.next:x.next;!(ne=$fe(ie,x)).done;){try{z=ce(ne.value)}catch(de){SO(x,"throw",de)}if(typeof z=="object"&&z&&EO(TO,z))return z}return new sb(!1)},tpe=Qa,LO=tpe("iterator"),MO=!1;try{var ipe=0,PO={next:function(){return{done:!!ipe++}},return:function(){MO=!0}};PO[LO]=function(){return this},Array.from(PO,function(){throw 2})}catch{}var rpe=function(i,e){if(!e&&!MO)return!1;var t=!1;try{var r={};r[LO]=function(){return{next:function(){return{done:t=!0}}}},i(r)}catch{}return t},npe=Jv,spe=rpe,ope=Xy.CONSTRUCTOR,FO=ope||!spe(function(i){npe.all(i).then(void 0,function(){})}),ape=lc,lpe=rl,cpe=SA,upe=Fg,hpe=qE,Ape=IO,dpe=FO;ape({target:"Promise",stat:!0,forced:dpe},{all:function(i){var e=this,t=upe.f(e),r=t.resolve,n=t.reject,o=hpe(function(){var c=cpe(e.resolve),s=[],m=0,x=1;Ape(i,function(I){var F=m++,O=!1;x++,lpe(c,e,I).then(function(z){O||(O=!0,s[F]=z,--x||r(s))},n)}),--x||r(s)});return o.error&&n(o.value),t.promise}});var fpe=lc,ppe=Xy.CONSTRUCTOR,rS=Jv,gpe=Bf,mpe=Co,ype=Cf,DO=rS&&rS.prototype;if(fpe({target:"Promise",proto:!0,forced:ppe,real:!0},{catch:function(i){return this.then(void 0,i)}}),mpe(rS)){var RO=gpe("Promise").prototype.catch;DO.catch!==RO&&ype(DO,"catch",RO,{unsafe:!0})}var _pe=lc,vpe=rl,bpe=SA,xpe=Fg,wpe=qE,Bpe=IO,Cpe=FO;_pe({target:"Promise",stat:!0,forced:Cpe},{race:function(i){var e=this,t=xpe.f(e),r=t.reject,n=wpe(function(){var o=bpe(e.resolve);Bpe(i,function(c){vpe(o,e,c).then(t.resolve,r)})});return n.error&&r(n.value),t.promise}});var Epe=lc,Spe=rl,Tpe=Fg,Ipe=Xy.CONSTRUCTOR;Epe({target:"Promise",stat:!0,forced:Ipe},{reject:function(i){var e=Tpe.f(this);return Spe(e.reject,void 0,i),e.promise}});var Lpe=Pl,Mpe=EA,Ppe=Fg,Fpe=function(i,e){if(Lpe(i),Mpe(e)&&e.constructor===i)return e;var t=Ppe.f(i),r=t.resolve;return r(e),t.promise},Dpe=lc,Rpe=Bf,kpe=Xy.CONSTRUCTOR,Ope=Fpe;Rpe("Promise"),Dpe({target:"Promise",stat:!0,forced:kpe},{resolve:function(i){return Ope(this,i)}});function kO(i,e,t,r,n,o,c){try{var s=i[o](c),m=s.value}catch(x){t(x);return}s.done?e(m):Promise.resolve(m).then(r,n)}function TA(i){return function(){var e=this,t=arguments;return new Promise(function(r,n){var o=i.apply(e,t);function c(m){kO(o,r,n,c,s,"next",m)}function s(m){kO(o,r,n,c,s,"throw",m)}c(void 0)})}}var Upe=IE,Npe=String,Wh=function(i){if(Upe(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Npe(i)},zpe=Pl,OO=function(){var i=zpe(this),e="";return i.hasIndices&&(e+="d"),i.global&&(e+="g"),i.ignoreCase&&(e+="i"),i.multiline&&(e+="m"),i.dotAll&&(e+="s"),i.unicode&&(e+="u"),i.unicodeSets&&(e+="v"),i.sticky&&(e+="y"),e},nS=qo,Qpe=Ca,sS=Qpe.RegExp,oS=nS(function(){var i=sS("a","y");return i.lastIndex=2,i.exec("abcd")!=null}),Vpe=oS||nS(function(){return!sS("a","y").sticky}),Hpe=oS||nS(function(){var i=sS("^r","gy");return i.lastIndex=2,i.exec("str")!=null}),UO={BROKEN_CARET:Hpe,MISSED_STICKY:Vpe,UNSUPPORTED_Y:oS},NO={},Gpe=yk,jpe=EE,qpe=Object.keys||function(i){return Gpe(i,jpe)},$pe=jh,Kpe=ik,Wpe=$h,Xpe=Pl,Zpe=zy,Jpe=qpe;NO.f=$pe&&!Kpe?Object.defineProperties:function(i,e){Xpe(i);for(var t=Zpe(e),r=Jpe(e),n=r.length,o=0,c;n>o;)Wpe.f(i,c=r[o++],t[c]);return i};var Ype=Pl,ege=NO,zO=EE,tge=_E,ige=Ok,rge=Ov,nge=yE,QO=">",VO="<",aS="prototype",lS="script",HO=nge("IE_PROTO"),cS=function(){},GO=function(i){return VO+lS+QO+i+VO+"/"+lS+QO},jO=function(i){i.write(GO("")),i.close();var e=i.parentWindow.Object;return i=null,e},sge=function(){var i=rge("iframe"),e="java"+lS+":",t;return i.style.display="none",ige.appendChild(i),i.src=String(e),t=i.contentWindow.document,t.open(),t.write(GO("document.F=Object")),t.close(),t.F},ob,ab=function(){try{ob=new ActiveXObject("htmlfile")}catch{}ab=typeof document<"u"?document.domain&&ob?jO(ob):sge():jO(ob);for(var i=zO.length;i--;)delete ab[aS][zO[i]];return ab()};tge[HO]=!0;var uS=Object.create||function(i,e){var t;return i!==null?(cS[aS]=Ype(i),t=new cS,cS[aS]=null,t[HO]=i):t=ab(),e===void 0?t:ege.f(t,e)},oge=qo,age=Ca,lge=age.RegExp,cge=oge(function(){var i=lge(".","s");return!(i.dotAll&&i.exec(`
`)&&i.flags==="s")}),uge=qo,hge=Ca,Age=hge.RegExp,dge=uge(function(){var i=Age("(?<a>b)","g");return i.exec("b").groups.a!=="b"||"b".replace(i,"$<a>c")!=="bc"}),Ug=rl,lb=$o,fge=Wh,pge=OO,gge=UO,mge=oE,yge=uS,_ge=Vv.get,vge=cge,bge=dge,xge=mge("native-string-replace",String.prototype.replace),cb=RegExp.prototype.exec,hS=cb,wge=lb("".charAt),Bge=lb("".indexOf),Cge=lb("".replace),AS=lb("".slice),dS=function(){var i=/a/,e=/b*/g;return Ug(cb,i,"a"),Ug(cb,e,"a"),i.lastIndex!==0||e.lastIndex!==0}(),qO=gge.BROKEN_CARET,fS=/()??/.exec("")[1]!==void 0,Ege=dS||fS||qO||vge||bge;Ege&&(hS=function(i){var e=this,t=_ge(e),r=fge(i),n=t.raw,o,c,s,m,x,I,F;if(n)return n.lastIndex=e.lastIndex,o=Ug(hS,n,r),e.lastIndex=n.lastIndex,o;var O=t.groups,z=qO&&e.sticky,ie=Ug(pge,e),ne=e.source,ue=0,ce=r;if(z&&(ie=Cge(ie,"y",""),Bge(ie,"g")===-1&&(ie+="g"),ce=AS(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&wge(r,e.lastIndex-1)!==`
`)&&(ne="(?: "+ne+")",ce=" "+ce,ue++),c=new RegExp("^(?:"+ne+")",ie)),fS&&(c=new RegExp("^"+ne+"$(?!\\s)",ie)),dS&&(s=e.lastIndex),m=Ug(cb,z?c:e,ce),z?m?(m.input=AS(m.input,ue),m[0]=AS(m[0],ue),m.index=e.lastIndex,e.lastIndex+=m[0].length):e.lastIndex=0:dS&&m&&(e.lastIndex=e.global?m.index+m[0].length:s),fS&&m&&m.length>1&&Ug(xge,m[0],c,function(){for(x=1;x<arguments.length-2;x++)arguments[x]===void 0&&(m[x]=void 0)}),m&&O)for(m.groups=I=yge(null),x=0;x<O.length;x++)F=O[x],I[F[0]]=m[F[1]];return m});var ub=hS,Sge=lc,$O=ub;Sge({target:"RegExp",proto:!0,forced:/./.exec!==$O},{exec:$O});var KO=qy,WO=Cf,Tge=ub,XO=qo,ZO=Qa,Ige=Qy,Lge=ZO("species"),pS=RegExp.prototype,gS=function(i,e,t,r){var n=ZO(i),o=!XO(function(){var x={};return x[n]=function(){return 7},""[i](x)!=7}),c=o&&!XO(function(){var x=!1,I=/a/;return i==="split"&&(I={},I.constructor={},I.constructor[Lge]=function(){return I},I.flags="",I[n]=/./[n]),I.exec=function(){return x=!0,null},I[n](""),!x});if(!o||!c||t){var s=KO(/./[n]),m=e(n,""[i],function(x,I,F,O,z){var ie=KO(x),ne=I.exec;return ne===Tge||ne===pS.exec?o&&!z?{done:!0,value:s(I,F,O)}:{done:!0,value:ie(F,I,O)}:{done:!1}});WO(String.prototype,i,m[0]),WO(pS,n,m[1])}r&&Ige(pS[n],"sham",!0)},mS=$o,Mge=jv,Pge=Wh,Fge=qh,Dge=mS("".charAt),JO=mS("".charCodeAt),Rge=mS("".slice),YO=function(i){return function(e,t){var r=Pge(Fge(e)),n=Mge(t),o=r.length,c,s;return n<0||n>=o?i?"":void 0:(c=JO(r,n),c<55296||c>56319||n+1===o||(s=JO(r,n+1))<56320||s>57343?i?Dge(r,n):c:i?Rge(r,n,n+2):(c-55296<<10)+(s-56320)+65536)}},kge={codeAt:YO(!1),charAt:YO(!0)},Oge=kge.charAt,yS=function(i,e,t){return e+(t?Oge(i,e).length:1)},eU=rl,Uge=Pl,Nge=Co,zge=xf,Qge=ub,Vge=TypeError,_S=function(i,e){var t=i.exec;if(Nge(t)){var r=eU(t,i,e);return r!==null&&Uge(r),r}if(zge(i)==="RegExp")return eU(Qge,i,e);throw Vge("RegExp#exec called on incompatible receiver")},Hge=rl,Gge=gS,jge=Pl,qge=wf,$ge=Mg,vS=Wh,Kge=qh,Wge=Tg,Xge=yS,tU=_S;Gge("match",function(i,e,t){return[function(r){var n=Kge(this),o=qge(r)?void 0:Wge(r,i);return o?Hge(o,r,n):new RegExp(r)[i](vS(n))},function(r){var n=jge(this),o=vS(r),c=t(e,n,o);if(c.done)return c.value;if(!n.global)return tU(n,o);var s=n.unicode;n.lastIndex=0;for(var m=[],x=0,I;(I=tU(n,o))!==null;){var F=vS(I[0]);m[x]=F,F===""&&(n.lastIndex=Xge(o,$ge(n.lastIndex),s)),x++}return x===0?null:m}]});var bS=$o,Zge=kv,Jge=Math.floor,xS=bS("".charAt),Yge=bS("".replace),wS=bS("".slice),eme=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,tme=/\$([$&'`]|\d{1,2})/g,ime=function(i,e,t,r,n,o){var c=t+i.length,s=r.length,m=tme;return n!==void 0&&(n=Zge(n),m=eme),Yge(o,m,function(x,I){var F;switch(xS(I,0)){case"$":return"$";case"&":return i;case"`":return wS(e,0,t);case"'":return wS(e,c);case"<":F=n[wS(I,1,-1)];break;default:var O=+I;if(O===0)return x;if(O>s){var z=Jge(O/10);return z===0?x:z<=s?r[z-1]===void 0?xS(I,1):r[z-1]+xS(I,1):x}F=r[O-1]}return F===void 0?"":F})},rme=ME,iU=rl,hb=$o,nme=gS,sme=qo,ome=Pl,ame=Co,lme=wf,cme=jv,ume=Mg,Ng=Wh,hme=qh,Ame=yS,dme=Tg,fme=ime,pme=_S,gme=Qa,BS=gme("replace"),mme=Math.max,yme=Math.min,_me=hb([].concat),CS=hb([].push),rU=hb("".indexOf),nU=hb("".slice),vme=function(i){return i===void 0?i:String(i)},bme=function(){return"a".replace(/./,"$0")==="$0"}(),sU=function(){return/./[BS]?/./[BS]("a","$0")==="":!1}(),xme=!sme(function(){var i=/./;return i.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(i,"$<a>")!=="7"});nme("replace",function(i,e,t){var r=sU?"$":"$0";return[function(n,o){var c=hme(this),s=lme(n)?void 0:dme(n,BS);return s?iU(s,n,c,o):iU(e,Ng(c),n,o)},function(n,o){var c=ome(this),s=Ng(n);if(typeof o=="string"&&rU(o,r)===-1&&rU(o,"$<")===-1){var m=t(e,c,s,o);if(m.done)return m.value}var x=ame(o);x||(o=Ng(o));var I=c.global;if(I){var F=c.unicode;c.lastIndex=0}for(var O=[];;){var z=pme(c,s);if(z===null||(CS(O,z),!I))break;var ie=Ng(z[0]);ie===""&&(c.lastIndex=Ame(s,ume(c.lastIndex),F))}for(var ne="",ue=0,ce=0;ce<O.length;ce++){z=O[ce];for(var de=Ng(z[0]),be=mme(yme(cme(z.index),s.length),0),Te=[],je=1;je<z.length;je++)CS(Te,vme(z[je]));var Ge=z.groups;if(x){var $e=_me([de],Te,be,s);Ge!==void 0&&CS($e,Ge);var Ue=Ng(rme(o,void 0,$e))}else Ue=fme(de,s,be,Te,Ge,o);be>=ue&&(ne+=nU(s,ue,be)+Ue,ue=be+de.length)}return ne+nU(s,ue)}]},!xme||!bme||sU);var wme=EA,Bme=xf,Cme=Qa,Eme=Cme("match"),oU=function(i){var e;return wme(i)&&((e=i[Eme])!==void 0?!!e:Bme(i)=="RegExp")},Sme=oU,Tme=TypeError,ES=function(i){if(Sme(i))throw Tme("The method doesn't accept regular expressions");return i},Ime=Qa,Lme=Ime("match"),SS=function(i){var e=/./;try{"/./"[i](e)}catch{try{return e[Lme]=!1,"/./"[i](e)}catch{}}return!1},Mme=lc,aU=qy,Pme=Sg.f,Fme=Mg,lU=Wh,Dme=ES,Rme=qh,kme=SS,cU=aU("".startsWith),Ome=aU("".slice),Ume=Math.min,uU=kme("startsWith"),Nme=!uU&&!!function(){var i=Pme(String.prototype,"startsWith");return i&&!i.writable}();Mme({target:"String",proto:!0,forced:!Nme&&!uU},{startsWith:function(i){var e=lU(Rme(this));Dme(i);var t=Fme(Ume(arguments.length>1?arguments[1]:void 0,e.length)),r=lU(i);return cU?cU(e,r,t):Ome(e,t,t+r.length)===r}});var zme=Qa,Qme=uS,Vme=$h.f,TS=zme("unscopables"),IS=Array.prototype;IS[TS]==null&&Vme(IS,TS,{configurable:!0,value:Qme(null)});var Hme=function(i){IS[TS][i]=!0},Gme=qo,jme=!Gme(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),qme=ch,$me=Co,Kme=kv,Wme=yE,Xme=jme,hU=Wme("IE_PROTO"),LS=Object,Zme=LS.prototype,AU=Xme?LS.getPrototypeOf:function(i){var e=Kme(i);if(qme(e,hU))return e[hU];var t=e.constructor;return $me(t)&&e instanceof t?t.prototype:e instanceof LS?Zme:null},Jme=qo,Yme=Co,eye=EA,dU=AU,tye=Cf,iye=Qa,MS=iye("iterator"),fU=!1,If,PS,FS;[].keys&&(FS=[].keys(),"next"in FS?(PS=dU(dU(FS)),PS!==Object.prototype&&(If=PS)):fU=!0);var rye=!eye(If)||Jme(function(){var i={};return If[MS].call(i)!==i});rye&&(If={}),Yme(If[MS])||tye(If,MS,function(){return this});var pU={IteratorPrototype:If,BUGGY_SAFARI_ITERATORS:fU},nye=pU.IteratorPrototype,sye=uS,oye=Mv,aye=TE,lye=Zy,cye=function(){return this},uye=function(i,e,t,r){var n=e+" Iterator";return i.prototype=sye(nye,{next:oye(+!r,t)}),aye(i,n,!1),lye[n]=cye,i},hye=lc,Aye=rl,gU=Nv,dye=Co,fye=uye,mU=AU,yU=xk,pye=TE,gye=Qy,DS=Cf,mye=Qa,yye=Zy,_U=pU,_ye=gU.PROPER,vye=gU.CONFIGURABLE,vU=_U.IteratorPrototype,Ab=_U.BUGGY_SAFARI_ITERATORS,Jy=mye("iterator"),bU="keys",Yy="values",xU="entries",bye=function(){return this},xye=function(i,e,t,r,n,o,c){fye(t,e,r);var s=function(ce){if(ce===n&&O)return O;if(!Ab&&ce in I)return I[ce];switch(ce){case bU:return function(){return new t(this,ce)};case Yy:return function(){return new t(this,ce)};case xU:return function(){return new t(this,ce)}}return function(){return new t(this)}},m=e+" Iterator",x=!1,I=i.prototype,F=I[Jy]||I["@@iterator"]||n&&I[n],O=!Ab&&F||s(n),z=e=="Array"&&I.entries||F,ie,ne,ue;if(z&&(ie=mU(z.call(new i)),ie!==Object.prototype&&ie.next&&(mU(ie)!==vU&&(yU?yU(ie,vU):dye(ie[Jy])||DS(ie,Jy,bye)),pye(ie,m,!0))),_ye&&n==Yy&&F&&F.name!==Yy&&(vye?gye(I,"name",Yy):(x=!0,O=function(){return Aye(F,this)})),n)if(ne={values:s(Yy),keys:o?O:s(bU),entries:s(xU)},c)for(ue in ne)(Ab||x||!(ue in I))&&DS(I,ue,ne[ue]);else hye({target:e,proto:!0,forced:Ab||x},ne);return I[Jy]!==O&&DS(I,Jy,O,{name:n}),yye[e]=O,ne},wye=function(i,e){return{value:i,done:e}},Bye=zy,RS=Hme,wU=Zy,BU=Vv,Cye=$h.f,Eye=xye,db=wye,Sye=jh,CU="Array Iterator",Tye=BU.set,Iye=BU.getterFor(CU),Lye=Eye(Array,"Array",function(i,e){Tye(this,{type:CU,target:Bye(i),index:0,kind:e})},function(){var i=Iye(this),e=i.target,t=i.kind,r=i.index++;return!e||r>=e.length?(i.target=void 0,db(void 0,!0)):t=="keys"?db(r,!1):t=="values"?db(e[r],!1):db([r,e[r]],!1)},"values"),EU=wU.Arguments=wU.Array;if(RS("keys"),RS("values"),RS("entries"),Sye&&EU.name!=="values")try{Cye(EU,"name",{value:"values"})}catch{}var Mye={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Pye=Ov,kS=Pye("span").classList,SU=kS&&kS.constructor&&kS.constructor.prototype,Fye=SU===Object.prototype?void 0:SU,TU=Ca,IU=Mye,Dye=Fye,e0=Lye,OS=Qy,LU=Qa,US=LU("iterator"),MU=LU("toStringTag"),NS=e0.values,PU=function(i,e){if(i){if(i[US]!==NS)try{OS(i,US,NS)}catch{i[US]=NS}if(i[MU]||OS(i,MU,e),IU[e]){for(var t in e0)if(i[t]!==e0[t])try{OS(i,t,e0[t])}catch{i[t]=e0[t]}}}};for(var zS in IU)PU(TU[zS]&&TU[zS].prototype,zS);PU(Dye,"DOMTokenList");function Rye(i,e){if(Zn(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Zn(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function kye(i){var e=Rye(i,"string");return Zn(e)==="symbol"?e:String(e)}function QS(i,e,t){return e=kye(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var Oye=SA,Uye=kv,Nye=MR,zye=qv,Qye=TypeError,FU=function(i){return function(e,t,r,n){Oye(t);var o=Uye(e),c=Nye(o),s=zye(o),m=i?s-1:0,x=i?-1:1;if(r<2)for(;;){if(m in c){n=c[m],m+=x;break}if(m+=x,i?m<0:s<=m)throw Qye("Reduce of empty array with no initial value")}for(;i?m>=0:s>m;m+=x)m in c&&(n=t(n,c[m],m,o));return n}},Vye={left:FU(!1),right:FU(!0)},Hye=qo,DU=function(i,e){var t=[][i];return!!t&&Hye(function(){t.call(null,e||function(){return 1},1)})},Gye=lc,jye=Vye.left,qye=DU,RU=eE,$ye=Gy,Kye=!$ye&&RU>79&&RU<83,Wye=Kye||!qye("reduce");Gye({target:"Array",proto:!0,forced:Wye},{reduce:function(i){var e=arguments.length;return jye(this,i,e,e>1?arguments[1]:void 0)}});var Xye=lc,kU=qy,Zye=Sg.f,Jye=Mg,OU=Wh,Yye=ES,e0e=qh,t0e=SS,UU=kU("".endsWith),i0e=kU("".slice),r0e=Math.min,NU=t0e("endsWith"),n0e=!NU&&!!function(){var i=Zye(String.prototype,"endsWith");return i&&!i.writable}();Xye({target:"String",proto:!0,forced:!n0e&&!NU},{endsWith:function(i){var e=OU(e0e(this));Yye(i);var t=arguments.length>1?arguments[1]:void 0,r=e.length,n=t===void 0?r:r0e(Jye(t),r),o=OU(i);return UU?UU(e,o,n):i0e(e,n-o.length,n)===o}});var s0e=lE,o0e=$h,a0e=Mv,l0e=function(i,e,t){var r=s0e(e);r in i?o0e.f(i,r,a0e(0,t)):i[r]=t},zU=fk,c0e=qv,u0e=l0e,h0e=Array,A0e=Math.max,d0e=function(i,e,t){for(var r=c0e(i),n=zU(e,r),o=zU(t===void 0?r:t,r),c=h0e(A0e(o-n,0)),s=0;n<o;n++,s++)u0e(c,s,i[n]);return c.length=s,c},f0e=ME,t0=rl,VS=$o,p0e=gS,g0e=Pl,m0e=wf,y0e=oU,QU=qh,_0e=Pk,v0e=yS,b0e=Mg,HS=Wh,x0e=Tg,VU=d0e,HU=_S,w0e=ub,B0e=UO,C0e=qo,zg=B0e.UNSUPPORTED_Y,GU=4294967295,E0e=Math.min,jU=[].push,S0e=VS(/./.exec),Qg=VS(jU),i0=VS("".slice),T0e=!C0e(function(){var i=/(?:)/,e=i.exec;i.exec=function(){return e.apply(this,arguments)};var t="ab".split(i);return t.length!==2||t[0]!=="a"||t[1]!=="b"});p0e("split",function(i,e,t){var r;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?r=function(n,o){var c=HS(QU(this)),s=o===void 0?GU:o>>>0;if(s===0)return[];if(n===void 0)return[c];if(!y0e(n))return t0(e,c,n,s);for(var m=[],x=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),I=0,F=new RegExp(n.source,x+"g"),O,z,ie;(O=t0(w0e,F,c))&&(z=F.lastIndex,!(z>I&&(Qg(m,i0(c,I,O.index)),O.length>1&&O.index<c.length&&f0e(jU,m,VU(O,1)),ie=O[0].length,I=z,m.length>=s)));)F.lastIndex===O.index&&F.lastIndex++;return I===c.length?(ie||!S0e(F,""))&&Qg(m,""):Qg(m,i0(c,I)),m.length>s?VU(m,0,s):m}:"0".split(void 0,0).length?r=function(n,o){return n===void 0&&o===0?[]:t0(e,this,n,o)}:r=e,[function(n,o){var c=QU(this),s=m0e(n)?void 0:x0e(n,i);return s?t0(s,n,c,o):t0(r,HS(c),n,o)},function(n,o){var c=g0e(this),s=HS(n),m=t(r,c,s,o,r!==e);if(m.done)return m.value;var x=_0e(c,RegExp),I=c.unicode,F=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(zg?"g":"y"),O=new x(zg?"^(?:"+c.source+")":c,F),z=o===void 0?GU:o>>>0;if(z===0)return[];if(s.length===0)return HU(O,s)===null?[s]:[];for(var ie=0,ne=0,ue=[];ne<s.length;){O.lastIndex=zg?0:ne;var ce=HU(O,zg?i0(s,ne):s),de;if(ce===null||(de=E0e(b0e(O.lastIndex+(zg?ne:0)),s.length))===ie)ne=v0e(s,ne,I);else{if(Qg(ue,i0(s,ie,ne)),ue.length===z)return ue;for(var be=1;be<=ce.length-1;be++)if(Qg(ue,ce[be]),ue.length===z)return ue;ne=ie=de}}return Qg(ue,i0(s,ie)),ue}]},!T0e,zg);var fb={exports:{}},r0={exports:{}};(function(){var i,e,t,r,n,o;typeof performance<"u"&&performance!==null&&performance.now?r0.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(r0.exports=function(){return(i()-n)/1e6},e=process.hrtime,i=function(){var c;return c=e(),c[0]*1e9+c[1]},r=i(),o=process.uptime()*1e9,n=r-o):Date.now?(r0.exports=function(){return Date.now()-t},t=Date.now()):(r0.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(Ny);for(var I0e=r0.exports,L0e=I0e,IA=typeof window>"u"?Ny:window,pb=["moz","webkit"],Vg="AnimationFrame",Hg=IA["request"+Vg],n0=IA["cancel"+Vg]||IA["cancelRequest"+Vg],s0=0;!Hg&&s0<pb.length;s0++)Hg=IA[pb[s0]+"Request"+Vg],n0=IA[pb[s0]+"Cancel"+Vg]||IA[pb[s0]+"CancelRequest"+Vg];if(!Hg||!n0){var GS=0,qU=0,Lf=[],M0e=1e3/60;Hg=function(i){if(Lf.length===0){var e=L0e(),t=Math.max(0,M0e-(e-GS));GS=t+e,setTimeout(function(){var r=Lf.slice(0);Lf.length=0;for(var n=0;n<r.length;n++)if(!r[n].cancelled)try{r[n].callback(GS)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return Lf.push({handle:++qU,callback:i,cancelled:!1}),qU},n0=function(i){for(var e=0;e<Lf.length;e++)Lf[e].handle===i&&(Lf[e].cancelled=!0)}}fb.exports=function(i){return Hg.call(IA,i)},fb.exports.cancel=function(){n0.apply(IA,arguments)},fb.exports.polyfill=function(i){i||(i=IA),i.requestAnimationFrame=Hg,i.cancelAnimationFrame=n0};var P0e=fb.exports;const jS=BR(P0e);var $U=`	
\v\f\r                　\u2028\u2029\uFEFF`,F0e=$o,D0e=qh,R0e=Wh,qS=$U,KU=F0e("".replace),k0e=RegExp("^["+qS+"]+"),O0e=RegExp("(^|[^"+qS+"])["+qS+"]+$"),$S=function(i){return function(e){var t=R0e(D0e(e));return i&1&&(t=KU(t,k0e,"")),i&2&&(t=KU(t,O0e,"$1")),t}},U0e={start:$S(1),end:$S(2),trim:$S(3)},N0e=Nv.PROPER,z0e=qo,WU=$U,XU="​᠎",Q0e=function(i){return z0e(function(){return!!WU[i]()||XU[i]()!==XU||N0e&&WU[i].name!==i})},V0e=lc,H0e=U0e.trim,G0e=Q0e;V0e({target:"String",proto:!0,forced:G0e("trim")},{trim:function(){return H0e(this)}});var j0e=function(i){this.ok=!1,this.alpha=1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i=i.replace(/ /g,""),i=i.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};i=e[i]||i;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(m){return[parseInt(m[1]),parseInt(m[2]),parseInt(m[3]),parseFloat(m[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(m){return[parseInt(m[1]),parseInt(m[2]),parseInt(m[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(m){return[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(m){return[parseInt(m[1]+m[1],16),parseInt(m[2]+m[2],16),parseInt(m[3]+m[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,c=n.exec(i);if(c){var s=o(c);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var m=this.r.toString(16),x=this.g.toString(16),I=this.b.toString(16);return m.length==1&&(m="0"+m),x.length==1&&(x="0"+x),I.length==1&&(I="0"+I),"#"+m+x+I},this.getHelpXML=function(){for(var m=new Array,x=0;x<t.length;x++)for(var I=t[x].example,F=0;F<I.length;F++)m[m.length]=I[F];for(var O in e)m[m.length]=O;var z=document.createElement("ul");z.setAttribute("id","rgbcolor-examples");for(var x=0;x<m.length;x++)try{var ie=document.createElement("li"),ne=new RGBColor(m[x]),ue=document.createElement("div");ue.style.cssText="margin: 3px; border: 1px solid black; background:"+ne.toHex()+"; color:"+ne.toHex(),ue.appendChild(document.createTextNode("test"));var ce=document.createTextNode(" "+m[x]+" -> "+ne.toRGB()+" -> "+ne.toHex());ie.appendChild(ue),ie.appendChild(ce),z.appendChild(ie)}catch{}return z}};const KS=BR(j0e);var q0e=lc,$0e=qy,K0e=gk.indexOf,W0e=DU,WS=$0e([].indexOf),ZU=!!WS&&1/WS([1],1,-0)<0,X0e=ZU||!W0e("indexOf");q0e({target:"Array",proto:!0,forced:X0e},{indexOf:function(i){var e=arguments.length>1?arguments[1]:void 0;return ZU?WS(this,i,e)||0:K0e(this,i,e)}});var Z0e=lc,J0e=$o,Y0e=ES,e_e=qh,JU=Wh,t_e=SS,i_e=J0e("".indexOf);Z0e({target:"String",proto:!0,forced:!t_e("includes")},{includes:function(i){return!!~i_e(JU(e_e(this)),JU(Y0e(i)),arguments.length>1?arguments[1]:void 0)}});var r_e=xf,n_e=Array.isArray||function(i){return r_e(i)=="Array"},s_e=lc,o_e=$o,a_e=n_e,l_e=o_e([].reverse),YU=[1,2];s_e({target:"Array",proto:!0,forced:String(YU)===String(YU.reverse())},{reverse:function(){return a_e(this)&&(this.length=this.length),l_e(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var e6=function(i,e){return(e6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)};function t6(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}e6(i,e),i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function c_e(i){var e="";Array.isArray(i)||(i=[i]);for(var t=0;t<i.length;t++){var r=i[t];if(r.type===yi.CLOSE_PATH)e+="z";else if(r.type===yi.HORIZ_LINE_TO)e+=(r.relative?"h":"H")+r.x;else if(r.type===yi.VERT_LINE_TO)e+=(r.relative?"v":"V")+r.y;else if(r.type===yi.MOVE_TO)e+=(r.relative?"m":"M")+r.x+" "+r.y;else if(r.type===yi.LINE_TO)e+=(r.relative?"l":"L")+r.x+" "+r.y;else if(r.type===yi.CURVE_TO)e+=(r.relative?"c":"C")+r.x1+" "+r.y1+" "+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===yi.SMOOTH_CURVE_TO)e+=(r.relative?"s":"S")+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===yi.QUAD_TO)e+=(r.relative?"q":"Q")+r.x1+" "+r.y1+" "+r.x+" "+r.y;else if(r.type===yi.SMOOTH_QUAD_TO)e+=(r.relative?"t":"T")+r.x+" "+r.y;else{if(r.type!==yi.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+t+".");e+=(r.relative?"a":"A")+r.rX+" "+r.rY+" "+r.xRot+" "+ +r.lArcFlag+" "+ +r.sweepFlag+" "+r.x+" "+r.y}}return e}function XS(i,e){var t=i[0],r=i[1];return[t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e)]}function uh(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];for(var t=0;t<i.length;t++)if(typeof i[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof i[t]+" == typeof "+i[t]);return!0}var _d=Math.PI;function ZS(i,e,t){i.lArcFlag=i.lArcFlag===0?0:1,i.sweepFlag=i.sweepFlag===0?0:1;var r=i.rX,n=i.rY,o=i.x,c=i.y;r=Math.abs(i.rX),n=Math.abs(i.rY);var s=XS([(e-o)/2,(t-c)/2],-i.xRot/180*_d),m=s[0],x=s[1],I=Math.pow(m,2)/Math.pow(r,2)+Math.pow(x,2)/Math.pow(n,2);1<I&&(r*=Math.sqrt(I),n*=Math.sqrt(I)),i.rX=r,i.rY=n;var F=Math.pow(r,2)*Math.pow(x,2)+Math.pow(n,2)*Math.pow(m,2),O=(i.lArcFlag!==i.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(n,2)-F)/F)),z=r*x/n*O,ie=-n*m/r*O,ne=XS([z,ie],i.xRot/180*_d);i.cX=ne[0]+(e+o)/2,i.cY=ne[1]+(t+c)/2,i.phi1=Math.atan2((x-ie)/n,(m-z)/r),i.phi2=Math.atan2((-x-ie)/n,(-m-z)/r),i.sweepFlag===0&&i.phi2>i.phi1&&(i.phi2-=2*_d),i.sweepFlag===1&&i.phi2<i.phi1&&(i.phi2+=2*_d),i.phi1*=180/_d,i.phi2*=180/_d}function i6(i,e,t){uh(i,e,t);var r=i*i+e*e-t*t;if(0>r)return[];if(r===0)return[[i*t/(i*i+e*e),e*t/(i*i+e*e)]];var n=Math.sqrt(r);return[[(i*t+e*n)/(i*i+e*e),(e*t-i*n)/(i*i+e*e)],[(i*t-e*n)/(i*i+e*e),(e*t+i*n)/(i*i+e*e)]]}var aa,LA=Math.PI/180;function r6(i,e,t){return(1-t)*i+t*e}function n6(i,e,t,r){return i+Math.cos(r/180*_d)*e+Math.sin(r/180*_d)*t}function s6(i,e,t,r){var n=1e-6,o=e-i,c=t-e,s=3*o+3*(r-t)-6*c,m=6*(c-o),x=3*o;return Math.abs(s)<n?[-x/m]:function(I,F,O){O===void 0&&(O=1e-6);var z=I*I/4-F;if(z<-O)return[];if(z<=O)return[-I/2];var ie=Math.sqrt(z);return[-I/2-ie,-I/2+ie]}(m/s,x/s,n)}function o6(i,e,t,r,n){var o=1-n;return i*(o*o*o)+e*(3*o*o*n)+t*(3*o*n*n)+r*(n*n*n)}(function(i){function e(){return n(function(s,m,x){return s.relative&&(s.x1!==void 0&&(s.x1+=m),s.y1!==void 0&&(s.y1+=x),s.x2!==void 0&&(s.x2+=m),s.y2!==void 0&&(s.y2+=x),s.x!==void 0&&(s.x+=m),s.y!==void 0&&(s.y+=x),s.relative=!1),s})}function t(){var s=NaN,m=NaN,x=NaN,I=NaN;return n(function(F,O,z){return F.type&yi.SMOOTH_CURVE_TO&&(F.type=yi.CURVE_TO,s=isNaN(s)?O:s,m=isNaN(m)?z:m,F.x1=F.relative?O-s:2*O-s,F.y1=F.relative?z-m:2*z-m),F.type&yi.CURVE_TO?(s=F.relative?O+F.x2:F.x2,m=F.relative?z+F.y2:F.y2):(s=NaN,m=NaN),F.type&yi.SMOOTH_QUAD_TO&&(F.type=yi.QUAD_TO,x=isNaN(x)?O:x,I=isNaN(I)?z:I,F.x1=F.relative?O-x:2*O-x,F.y1=F.relative?z-I:2*z-I),F.type&yi.QUAD_TO?(x=F.relative?O+F.x1:F.x1,I=F.relative?z+F.y1:F.y1):(x=NaN,I=NaN),F})}function r(){var s=NaN,m=NaN;return n(function(x,I,F){if(x.type&yi.SMOOTH_QUAD_TO&&(x.type=yi.QUAD_TO,s=isNaN(s)?I:s,m=isNaN(m)?F:m,x.x1=x.relative?I-s:2*I-s,x.y1=x.relative?F-m:2*F-m),x.type&yi.QUAD_TO){s=x.relative?I+x.x1:x.x1,m=x.relative?F+x.y1:x.y1;var O=x.x1,z=x.y1;x.type=yi.CURVE_TO,x.x1=((x.relative?0:I)+2*O)/3,x.y1=((x.relative?0:F)+2*z)/3,x.x2=(x.x+2*O)/3,x.y2=(x.y+2*z)/3}else s=NaN,m=NaN;return x})}function n(s){var m=0,x=0,I=NaN,F=NaN;return function(O){if(isNaN(I)&&!(O.type&yi.MOVE_TO))throw new Error("path must start with moveto");var z=s(O,m,x,I,F);return O.type&yi.CLOSE_PATH&&(m=I,x=F),O.x!==void 0&&(m=O.relative?m+O.x:O.x),O.y!==void 0&&(x=O.relative?x+O.y:O.y),O.type&yi.MOVE_TO&&(I=m,F=x),z}}function o(s,m,x,I,F,O){return uh(s,m,x,I,F,O),n(function(z,ie,ne,ue){var ce=z.x1,de=z.x2,be=z.relative&&!isNaN(ue),Te=z.x!==void 0?z.x:be?0:ie,je=z.y!==void 0?z.y:be?0:ne;function Ge(Ee){return Ee*Ee}z.type&yi.HORIZ_LINE_TO&&m!==0&&(z.type=yi.LINE_TO,z.y=z.relative?0:ne),z.type&yi.VERT_LINE_TO&&x!==0&&(z.type=yi.LINE_TO,z.x=z.relative?0:ie),z.x!==void 0&&(z.x=z.x*s+je*x+(be?0:F)),z.y!==void 0&&(z.y=Te*m+z.y*I+(be?0:O)),z.x1!==void 0&&(z.x1=z.x1*s+z.y1*x+(be?0:F)),z.y1!==void 0&&(z.y1=ce*m+z.y1*I+(be?0:O)),z.x2!==void 0&&(z.x2=z.x2*s+z.y2*x+(be?0:F)),z.y2!==void 0&&(z.y2=de*m+z.y2*I+(be?0:O));var $e=s*I-m*x;if(z.xRot!==void 0&&(s!==1||m!==0||x!==0||I!==1))if($e===0)delete z.rX,delete z.rY,delete z.xRot,delete z.lArcFlag,delete z.sweepFlag,z.type=yi.LINE_TO;else{var Ue=z.xRot*Math.PI/180,lt=Math.sin(Ue),nt=Math.cos(Ue),De=1/Ge(z.rX),Fe=1/Ge(z.rY),Je=Ge(nt)*De+Ge(lt)*Fe,We=2*lt*nt*(De-Fe),Et=Ge(lt)*De+Ge(nt)*Fe,Ct=Je*I*I-We*m*I+Et*m*m,Lt=We*(s*I+m*x)-2*(Je*x*I+Et*s*m),_t=Je*x*x-We*s*x+Et*s*s,Ft=(Math.atan2(Lt,Ct-_t)+Math.PI)%Math.PI/2,Mt=Math.sin(Ft),Wt=Math.cos(Ft);z.rX=Math.abs($e)/Math.sqrt(Ct*Ge(Wt)+Lt*Mt*Wt+_t*Ge(Mt)),z.rY=Math.abs($e)/Math.sqrt(Ct*Ge(Mt)-Lt*Mt*Wt+_t*Ge(Wt)),z.xRot=180*Ft/Math.PI}return z.sweepFlag!==void 0&&0>$e&&(z.sweepFlag=+!z.sweepFlag),z})}function c(){return function(s){var m={};for(var x in s)m[x]=s[x];return m}}i.ROUND=function(s){function m(x){return Math.round(x*s)/s}return s===void 0&&(s=1e13),uh(s),function(x){return x.x1!==void 0&&(x.x1=m(x.x1)),x.y1!==void 0&&(x.y1=m(x.y1)),x.x2!==void 0&&(x.x2=m(x.x2)),x.y2!==void 0&&(x.y2=m(x.y2)),x.x!==void 0&&(x.x=m(x.x)),x.y!==void 0&&(x.y=m(x.y)),x.rX!==void 0&&(x.rX=m(x.rX)),x.rY!==void 0&&(x.rY=m(x.rY)),x}},i.TO_ABS=e,i.TO_REL=function(){return n(function(s,m,x){return s.relative||(s.x1!==void 0&&(s.x1-=m),s.y1!==void 0&&(s.y1-=x),s.x2!==void 0&&(s.x2-=m),s.y2!==void 0&&(s.y2-=x),s.x!==void 0&&(s.x-=m),s.y!==void 0&&(s.y-=x),s.relative=!0),s})},i.NORMALIZE_HVZ=function(s,m,x){return s===void 0&&(s=!0),m===void 0&&(m=!0),x===void 0&&(x=!0),n(function(I,F,O,z,ie){if(isNaN(z)&&!(I.type&yi.MOVE_TO))throw new Error("path must start with moveto");return m&&I.type&yi.HORIZ_LINE_TO&&(I.type=yi.LINE_TO,I.y=I.relative?0:O),x&&I.type&yi.VERT_LINE_TO&&(I.type=yi.LINE_TO,I.x=I.relative?0:F),s&&I.type&yi.CLOSE_PATH&&(I.type=yi.LINE_TO,I.x=I.relative?z-F:z,I.y=I.relative?ie-O:ie),I.type&yi.ARC&&(I.rX===0||I.rY===0)&&(I.type=yi.LINE_TO,delete I.rX,delete I.rY,delete I.xRot,delete I.lArcFlag,delete I.sweepFlag),I})},i.NORMALIZE_ST=t,i.QT_TO_C=r,i.INFO=n,i.SANITIZE=function(s){s===void 0&&(s=0),uh(s);var m=NaN,x=NaN,I=NaN,F=NaN;return n(function(O,z,ie,ne,ue){var ce=Math.abs,de=!1,be=0,Te=0;if(O.type&yi.SMOOTH_CURVE_TO&&(be=isNaN(m)?0:z-m,Te=isNaN(x)?0:ie-x),O.type&(yi.CURVE_TO|yi.SMOOTH_CURVE_TO)?(m=O.relative?z+O.x2:O.x2,x=O.relative?ie+O.y2:O.y2):(m=NaN,x=NaN),O.type&yi.SMOOTH_QUAD_TO?(I=isNaN(I)?z:2*z-I,F=isNaN(F)?ie:2*ie-F):O.type&yi.QUAD_TO?(I=O.relative?z+O.x1:O.x1,F=O.relative?ie+O.y1:O.y2):(I=NaN,F=NaN),O.type&yi.LINE_COMMANDS||O.type&yi.ARC&&(O.rX===0||O.rY===0||!O.lArcFlag)||O.type&yi.CURVE_TO||O.type&yi.SMOOTH_CURVE_TO||O.type&yi.QUAD_TO||O.type&yi.SMOOTH_QUAD_TO){var je=O.x===void 0?0:O.relative?O.x:O.x-z,Ge=O.y===void 0?0:O.relative?O.y:O.y-ie;be=isNaN(I)?O.x1===void 0?be:O.relative?O.x:O.x1-z:I-z,Te=isNaN(F)?O.y1===void 0?Te:O.relative?O.y:O.y1-ie:F-ie;var $e=O.x2===void 0?0:O.relative?O.x:O.x2-z,Ue=O.y2===void 0?0:O.relative?O.y:O.y2-ie;ce(je)<=s&&ce(Ge)<=s&&ce(be)<=s&&ce(Te)<=s&&ce($e)<=s&&ce(Ue)<=s&&(de=!0)}return O.type&yi.CLOSE_PATH&&ce(z-ne)<=s&&ce(ie-ue)<=s&&(de=!0),de?[]:O})},i.MATRIX=o,i.ROTATE=function(s,m,x){m===void 0&&(m=0),x===void 0&&(x=0),uh(s,m,x);var I=Math.sin(s),F=Math.cos(s);return o(F,I,-I,F,m-m*F+x*I,x-m*I-x*F)},i.TRANSLATE=function(s,m){return m===void 0&&(m=0),uh(s,m),o(1,0,0,1,s,m)},i.SCALE=function(s,m){return m===void 0&&(m=s),uh(s,m),o(s,0,0,m,0,0)},i.SKEW_X=function(s){return uh(s),o(1,0,Math.atan(s),1,0,0)},i.SKEW_Y=function(s){return uh(s),o(1,Math.atan(s),0,1,0,0)},i.X_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),uh(s),o(-1,0,0,1,s,0)},i.Y_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),uh(s),o(1,0,0,-1,0,s)},i.A_TO_C=function(){return n(function(s,m,x){return yi.ARC===s.type?function(I,F,O){var z,ie,ne,ue;I.cX||ZS(I,F,O);for(var ce=Math.min(I.phi1,I.phi2),de=Math.max(I.phi1,I.phi2)-ce,be=Math.ceil(de/90),Te=new Array(be),je=F,Ge=O,$e=0;$e<be;$e++){var Ue=r6(I.phi1,I.phi2,$e/be),lt=r6(I.phi1,I.phi2,($e+1)/be),nt=lt-Ue,De=4/3*Math.tan(nt*LA/4),Fe=[Math.cos(Ue*LA)-De*Math.sin(Ue*LA),Math.sin(Ue*LA)+De*Math.cos(Ue*LA)],Je=Fe[0],We=Fe[1],Et=[Math.cos(lt*LA),Math.sin(lt*LA)],Ct=Et[0],Lt=Et[1],_t=[Ct+De*Math.sin(lt*LA),Lt-De*Math.cos(lt*LA)],Ft=_t[0],Mt=_t[1];Te[$e]={relative:I.relative,type:yi.CURVE_TO};var Wt=function(Ee,Xe){var et=XS([Ee*I.rX,Xe*I.rY],I.xRot),At=et[0],ft=et[1];return[I.cX+At,I.cY+ft]};z=Wt(Je,We),Te[$e].x1=z[0],Te[$e].y1=z[1],ie=Wt(Ft,Mt),Te[$e].x2=ie[0],Te[$e].y2=ie[1],ne=Wt(Ct,Lt),Te[$e].x=ne[0],Te[$e].y=ne[1],I.relative&&(Te[$e].x1-=je,Te[$e].y1-=Ge,Te[$e].x2-=je,Te[$e].y2-=Ge,Te[$e].x-=je,Te[$e].y-=Ge),je=(ue=[Te[$e].x,Te[$e].y])[0],Ge=ue[1]}return Te}(s,s.relative?0:m,s.relative?0:x):s})},i.ANNOTATE_ARCS=function(){return n(function(s,m,x){return s.relative&&(m=0,x=0),yi.ARC===s.type&&ZS(s,m,x),s})},i.CLONE=c,i.CALCULATE_BOUNDS=function(){var s=function(O){var z={};for(var ie in O)z[ie]=O[ie];return z},m=e(),x=r(),I=t(),F=n(function(O,z,ie){var ne=I(x(m(s(O))));function ue(Mt){Mt>F.maxX&&(F.maxX=Mt),Mt<F.minX&&(F.minX=Mt)}function ce(Mt){Mt>F.maxY&&(F.maxY=Mt),Mt<F.minY&&(F.minY=Mt)}if(ne.type&yi.DRAWING_COMMANDS&&(ue(z),ce(ie)),ne.type&yi.HORIZ_LINE_TO&&ue(ne.x),ne.type&yi.VERT_LINE_TO&&ce(ne.y),ne.type&yi.LINE_TO&&(ue(ne.x),ce(ne.y)),ne.type&yi.CURVE_TO){ue(ne.x),ce(ne.y);for(var de=0,be=s6(z,ne.x1,ne.x2,ne.x);de<be.length;de++)0<(Ft=be[de])&&1>Ft&&ue(o6(z,ne.x1,ne.x2,ne.x,Ft));for(var Te=0,je=s6(ie,ne.y1,ne.y2,ne.y);Te<je.length;Te++)0<(Ft=je[Te])&&1>Ft&&ce(o6(ie,ne.y1,ne.y2,ne.y,Ft))}if(ne.type&yi.ARC){ue(ne.x),ce(ne.y),ZS(ne,z,ie);for(var Ge=ne.xRot/180*Math.PI,$e=Math.cos(Ge)*ne.rX,Ue=Math.sin(Ge)*ne.rX,lt=-Math.sin(Ge)*ne.rY,nt=Math.cos(Ge)*ne.rY,De=ne.phi1<ne.phi2?[ne.phi1,ne.phi2]:-180>ne.phi2?[ne.phi2+360,ne.phi1+360]:[ne.phi2,ne.phi1],Fe=De[0],Je=De[1],We=function(Mt){var Wt=Mt[0],Ee=Mt[1],Xe=180*Math.atan2(Ee,Wt)/Math.PI;return Xe<Fe?Xe+360:Xe},Et=0,Ct=i6(lt,-$e,0).map(We);Et<Ct.length;Et++)(Ft=Ct[Et])>Fe&&Ft<Je&&ue(n6(ne.cX,$e,lt,Ft));for(var Lt=0,_t=i6(nt,-Ue,0).map(We);Lt<_t.length;Lt++){var Ft;(Ft=_t[Lt])>Fe&&Ft<Je&&ce(n6(ne.cY,Ue,nt,Ft))}}return O});return F.minX=1/0,F.maxX=-1/0,F.minY=1/0,F.maxY=-1/0,F}})(aa||(aa={}));var hh,a6=function(){function i(){}return i.prototype.round=function(e){return this.transform(aa.ROUND(e))},i.prototype.toAbs=function(){return this.transform(aa.TO_ABS())},i.prototype.toRel=function(){return this.transform(aa.TO_REL())},i.prototype.normalizeHVZ=function(e,t,r){return this.transform(aa.NORMALIZE_HVZ(e,t,r))},i.prototype.normalizeST=function(){return this.transform(aa.NORMALIZE_ST())},i.prototype.qtToC=function(){return this.transform(aa.QT_TO_C())},i.prototype.aToC=function(){return this.transform(aa.A_TO_C())},i.prototype.sanitize=function(e){return this.transform(aa.SANITIZE(e))},i.prototype.translate=function(e,t){return this.transform(aa.TRANSLATE(e,t))},i.prototype.scale=function(e,t){return this.transform(aa.SCALE(e,t))},i.prototype.rotate=function(e,t,r){return this.transform(aa.ROTATE(e,t,r))},i.prototype.matrix=function(e,t,r,n,o,c){return this.transform(aa.MATRIX(e,t,r,n,o,c))},i.prototype.skewX=function(e){return this.transform(aa.SKEW_X(e))},i.prototype.skewY=function(e){return this.transform(aa.SKEW_Y(e))},i.prototype.xSymmetry=function(e){return this.transform(aa.X_AXIS_SYMMETRY(e))},i.prototype.ySymmetry=function(e){return this.transform(aa.Y_AXIS_SYMMETRY(e))},i.prototype.annotateArcs=function(){return this.transform(aa.ANNOTATE_ARCS())},i}(),u_e=function(i){return i===" "||i==="	"||i==="\r"||i===`
`},l6=function(i){return 48<=i.charCodeAt(0)&&i.charCodeAt(0)<=57},h_e=function(i){function e(){var t=i.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return t6(e,i),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,r){var n=this;r===void 0&&(r=[]);for(var o=function(F){r.push(F),n.curArgs.length=0,n.canParseCommandOrComma=!0},c=0;c<t.length;c++){var s=t[c],m=!(this.curCommandType!==yi.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),x=l6(s)&&(this.curNumber==="0"&&s==="0"||m);if(!l6(s)||x)if(s!=="e"&&s!=="E")if(s!=="-"&&s!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(s!=="."||this.curNumberHasExp||this.curNumberHasDecimal||m){if(this.curNumber&&this.curCommandType!==-1){var I=Number(this.curNumber);if(isNaN(I))throw new SyntaxError("Invalid number ending at "+c);if(this.curCommandType===yi.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>I)throw new SyntaxError('Expected positive number, got "'+I+'" at index "'+c+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+c+'"')}this.curArgs.push(I),this.curArgs.length===A_e[this.curCommandType]&&(yi.HORIZ_LINE_TO===this.curCommandType?o({type:yi.HORIZ_LINE_TO,relative:this.curCommandRelative,x:I}):yi.VERT_LINE_TO===this.curCommandType?o({type:yi.VERT_LINE_TO,relative:this.curCommandRelative,y:I}):this.curCommandType===yi.MOVE_TO||this.curCommandType===yi.LINE_TO||this.curCommandType===yi.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),yi.MOVE_TO===this.curCommandType&&(this.curCommandType=yi.LINE_TO)):this.curCommandType===yi.CURVE_TO?o({type:yi.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===yi.SMOOTH_CURVE_TO?o({type:yi.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===yi.QUAD_TO?o({type:yi.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===yi.ARC&&o({type:yi.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!u_e(s))if(s===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(s!=="+"&&s!=="-"&&s!==".")if(x)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+c+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+c+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,s!=="z"&&s!=="Z")if(s==="h"||s==="H")this.curCommandType=yi.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=yi.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=yi.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=yi.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=yi.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=yi.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=yi.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=yi.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else{if(s!=="a"&&s!=="A")throw new SyntaxError('Unexpected character "'+s+'" at index '+c+".");this.curCommandType=yi.ARC,this.curCommandRelative=s==="a"}else r.push({type:yi.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal=s==="."}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return r},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(r,n){n===void 0&&(n=[]);for(var o=0,c=Object.getPrototypeOf(this).parse.call(this,r);o<c.length;o++){var s=c[o],m=t(s);Array.isArray(m)?n.push.apply(n,m):n.push(m)}return n}}})},e}(a6),yi=function(i){function e(t){var r=i.call(this)||this;return r.commands=typeof t=="string"?e.parse(t):t,r}return t6(e,i),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=aa.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var r=[],n=0,o=this.commands;n<o.length;n++){var c=t(o[n]);Array.isArray(c)?r.push.apply(r,c):r.push(c)}return this.commands=r,this},e.encode=function(t){return c_e(t)},e.parse=function(t){var r=new h_e,n=[];return r.parse(t,n),r.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(a6),A_e=((hh={})[yi.MOVE_TO]=2,hh[yi.LINE_TO]=2,hh[yi.HORIZ_LINE_TO]=1,hh[yi.VERT_LINE_TO]=1,hh[yi.CLOSE_PATH]=0,hh[yi.QUAD_TO]=4,hh[yi.SMOOTH_QUAD_TO]=2,hh[yi.CURVE_TO]=6,hh[yi.SMOOTH_CURVE_TO]=4,hh[yi.ARC]=7,hh),d_e=rl,f_e=ch,p_e=Pv,g_e=OO,c6=RegExp.prototype,m_e=function(i){var e=i.flags;return e===void 0&&!("flags"in c6)&&!f_e(i,"flags")&&p_e(c6,i)?d_e(g_e,i):e},y_e=Nv.PROPER,__e=Cf,v_e=Pl,u6=Wh,b_e=qo,x_e=m_e,JS="toString",w_e=RegExp.prototype,h6=w_e[JS],B_e=b_e(function(){return h6.call({source:"a",flags:"b"})!="/a/b"}),C_e=y_e&&h6.name!=JS;(B_e||C_e)&&__e(RegExp.prototype,JS,function(){var i=v_e(this),e=u6(i.source),t=u6(x_e(i));return"/"+e+"/"+t},{unsafe:!0});function gb(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gb=function(e){return typeof e}:gb=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gb(i)}function E_e(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var S_e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],T_e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function I_e(i,e,t,r,n){if(typeof i=="string"&&(i=document.getElementById(i)),!i||gb(i)!=="object"||!("getContext"in i))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=i.getContext("2d");try{return o.getImageData(e,t,r,n)}catch(c){throw new Error("unable to access image data: "+c)}}function L_e(i,e,t,r,n,o){if(!(isNaN(o)||o<1)){o|=0;var c=I_e(i,e,t,r,n);c=M_e(c,e,t,r,n,o),i.getContext("2d").putImageData(c,e,t)}}function M_e(i,e,t,r,n,o){for(var c=i.data,s=2*o+1,m=r-1,x=n-1,I=o+1,F=I*(I+1)/2,O=new A6,z=O,ie,ne=1;ne<s;ne++)z=z.next=new A6,ne===I&&(ie=z);z.next=O;for(var ue=null,ce=null,de=0,be=0,Te=S_e[o],je=T_e[o],Ge=0;Ge<n;Ge++){z=O;for(var $e=c[be],Ue=c[be+1],lt=c[be+2],nt=c[be+3],De=0;De<I;De++)z.r=$e,z.g=Ue,z.b=lt,z.a=nt,z=z.next;for(var Fe=0,Je=0,We=0,Et=0,Ct=I*$e,Lt=I*Ue,_t=I*lt,Ft=I*nt,Mt=F*$e,Wt=F*Ue,Ee=F*lt,Xe=F*nt,et=1;et<I;et++){var At=be+((m<et?m:et)<<2),ft=c[At],wt=c[At+1],Pt=c[At+2],It=c[At+3],Ht=I-et;Mt+=(z.r=ft)*Ht,Wt+=(z.g=wt)*Ht,Ee+=(z.b=Pt)*Ht,Xe+=(z.a=It)*Ht,Fe+=ft,Je+=wt,We+=Pt,Et+=It,z=z.next}ue=O,ce=ie;for(var ii=0;ii<r;ii++){var gi=Xe*Te>>je;if(c[be+3]=gi,gi!==0){var mi=255/gi;c[be]=(Mt*Te>>je)*mi,c[be+1]=(Wt*Te>>je)*mi,c[be+2]=(Ee*Te>>je)*mi}else c[be]=c[be+1]=c[be+2]=0;Mt-=Ct,Wt-=Lt,Ee-=_t,Xe-=Ft,Ct-=ue.r,Lt-=ue.g,_t-=ue.b,Ft-=ue.a;var Mi=ii+o+1;Mi=de+(Mi<m?Mi:m)<<2,Fe+=ue.r=c[Mi],Je+=ue.g=c[Mi+1],We+=ue.b=c[Mi+2],Et+=ue.a=c[Mi+3],Mt+=Fe,Wt+=Je,Ee+=We,Xe+=Et,ue=ue.next;var kt=ce,ot=kt.r,xt=kt.g,Ri=kt.b,ei=kt.a;Ct+=ot,Lt+=xt,_t+=Ri,Ft+=ei,Fe-=ot,Je-=xt,We-=Ri,Et-=ei,ce=ce.next,be+=4}de+=r}for(var ut=0;ut<r;ut++){be=ut<<2;var jt=c[be],ni=c[be+1],di=c[be+2],li=c[be+3],Ki=I*jt,tr=I*ni,Ar=I*di,Er=I*li,Nt=F*jt,Ji=F*ni,ci=F*di,$t=F*li;z=O;for(var Zi=0;Zi<I;Zi++)z.r=jt,z.g=ni,z.b=di,z.a=li,z=z.next;for(var Qt=r,Bi=0,Ii=0,Gt=0,vi=0,Jt=1;Jt<=o;Jt++){be=Qt+ut<<2;var mr=I-Jt;Nt+=(z.r=jt=c[be])*mr,Ji+=(z.g=ni=c[be+1])*mr,ci+=(z.b=di=c[be+2])*mr,$t+=(z.a=li=c[be+3])*mr,vi+=jt,Bi+=ni,Ii+=di,Gt+=li,z=z.next,Jt<x&&(Qt+=r)}be=ut,ue=O,ce=ie;for(var Sr=0;Sr<n;Sr++){var ze=be<<2;c[ze+3]=li=$t*Te>>je,li>0?(li=255/li,c[ze]=(Nt*Te>>je)*li,c[ze+1]=(Ji*Te>>je)*li,c[ze+2]=(ci*Te>>je)*li):c[ze]=c[ze+1]=c[ze+2]=0,Nt-=Ki,Ji-=tr,ci-=Ar,$t-=Er,Ki-=ue.r,tr-=ue.g,Ar-=ue.b,Er-=ue.a,ze=ut+((ze=Sr+I)<x?ze:x)*r<<2,Nt+=vi+=ue.r=c[ze],Ji+=Bi+=ue.g=c[ze+1],ci+=Ii+=ue.b=c[ze+2],$t+=Gt+=ue.a=c[ze+3],ue=ue.next,Ki+=jt=ce.r,tr+=ni=ce.g,Ar+=di=ce.b,Er+=li=ce.a,vi-=jt,Bi-=ni,Ii-=di,Gt-=li,ce=ce.next,be+=r}}return i}var A6=function i(){E_e(this,i),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function P_e(){var{DOMParser:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:i,createCanvas(t,r){return new OffscreenCanvas(t,r)},createImage(t){return TA(function*(){var r=yield fetch(t),n=yield r.blob(),o=yield createImageBitmap(n);return o})()}};return(typeof DOMParser<"u"||typeof i>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function F_e(i){var{DOMParser:e,canvas:t,fetch:r}=i;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:r,createCanvas:t.createCanvas,createImage:t.loadImage}}var D_e=Object.freeze({__proto__:null,offscreen:P_e,node:F_e});function Mf(i){return i.replace(/(?!\u3000)\s+/gm," ")}function d6(i){return i.replace(/^[\n \t]+/,"")}function f6(i){return i.replace(/[\n \t]+$/,"")}function Tc(i){var e=(i||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var R_e=/^[A-Z-]+$/;function p6(i){return R_e.test(i)?i.toLowerCase():i}function YS(i){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(i)||[];return e[2]||e[3]||e[4]}function g6(i){if(!i.startsWith("rgb"))return i;var e=3,t=i.replace(/\d+(\.\d+)?/g,(r,n)=>e--&&n?String(Math.round(parseFloat(r))):r);return t}var k_e=/(\[[^\]]+\])/g,O_e=/(#[^\s+>~.[:]+)/g,U_e=/(\.[^\s+>~.[:]+)/g,N_e=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,z_e=/(:[\w-]+\([^)]*\))/gi,Q_e=/(:[^\s+>~.[:]+)/g,V_e=/([^\s+>~.[:]+)/g;function Pf(i,e){var t=e.exec(i);return t?[i.replace(e," "),t.length]:[i,0]}function m6(i){var e=[0,0,0],t=i.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),r=0;return[t,r]=Pf(t,k_e),e[1]+=r,[t,r]=Pf(t,O_e),e[0]+=r,[t,r]=Pf(t,U_e),e[1]+=r,[t,r]=Pf(t,N_e),e[2]+=r,[t,r]=Pf(t,z_e),e[1]+=r,[t,r]=Pf(t,Q_e),e[1]+=r,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,r]=Pf(t,V_e),e[2]+=r,e.join("")}var Ff=1e-8;function eT(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))}function mb(i,e){return(i[0]*e[0]+i[1]*e[1])/(eT(i)*eT(e))}function tT(i,e){return(i[0]*e[1]<i[1]*e[0]?-1:1)*Math.acos(mb(i,e))}function iT(i){return i*i*i}function rT(i){return 3*i*i*(1-i)}function nT(i){return 3*i*(1-i)*(1-i)}function sT(i){return(1-i)*(1-i)*(1-i)}function oT(i){return i*i}function aT(i){return 2*i*(1-i)}function lT(i){return(1-i)*(1-i)}class wr{constructor(e,t,r){this.document=e,this.name=t,this.value=r,this.isNormalizedColor=!1}static empty(e){return new wr(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:r}=this;return Mf(this.getString()).trim().split(e).map(n=>new wr(t,r,n))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,r=typeof t=="string";return!r||!e?r:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,r=parseFloat(t);return this.isString(/%$/)&&(r/=100),r}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=g6(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[r,n]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&n):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(r);default:{var c=this.getNumber();return t&&c<1?c*o.computeSize(r):c}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var r=this.getDefinition();if(!r)return null;if(typeof r.createGradient=="function")return r.createGradient(this.document.ctx,e,t);if(typeof r.createPattern=="function"){if(r.getHrefAttribute().hasValue()){var n=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),n.hasValue()&&r.getAttribute("patternTransform",!0).setValue(n.value)}return r.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?wr.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),r=t.length,n=0,o=0;o<r&&(t[o]===","&&n++,n!==3);o++);if(e.hasValue()&&this.isString()&&n!==3){var c=new KS(t);c.ok&&(c.alpha=e.getNumber(),t=c.toRGBA())}return new wr(this.document,this.name,t)}}wr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class y6{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Eo{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[r=t,n=t]=Tc(e);return new Eo(r,n)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[r=t,n=r]=Tc(e);return new Eo(r,n)}static parsePath(e){for(var t=Tc(e),r=t.length,n=[],o=0;o<r;o+=2)n.push(new Eo(t[o],t[o+1]));return n}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:r}=this,n=t*e[0]+r*e[2]+e[4],o=t*e[1]+r*e[3]+e[5];this.x=n,this.y=o}}class _6{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:r}=this,n=e.ctx.canvas;n.onclick=t,n.onmousemove=r,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:r}=this,{style:n}=e.ctx.canvas;n&&(n.cursor=""),t.forEach((o,c)=>{for(var{run:s}=o,m=r[c];m;)s(m),m=m.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,c)=>{var{x:s,y:m}=o;!n[c]&&t.isPointInPath&&t.isPointInPath(s,m)&&(n[c]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,c)=>{var{x:s,y:m}=o;!n[c]&&t.isPointInBox(s,m)&&(n[c]=e)})}}mapXY(e,t){for(var{window:r,ctx:n}=this.screen,o=new Eo(e,t),c=n.canvas;c;)o.x-=c.offsetLeft,o.y-=c.offsetTop,c=c.offsetParent;return r.scrollX&&(o.x+=r.scrollX),r.scrollY&&(o.y+=r.scrollY),o}onClick(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:r,run(n){n.onClick&&n.onClick()}})}onMouseMove(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:r,run(n){n.onMouseMove&&n.onMouseMove()}})}}var v6=typeof window<"u"?window:null,b6=typeof fetch<"u"?fetch.bind(void 0):null;class o0{constructor(e){var{fetch:t=b6,window:r=v6}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new y6,this.mouse=new _6(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=r,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:r,aspectRatio:n,width:o,desiredWidth:c,height:s,desiredHeight:m,minX:x=0,minY:I=0,refX:F,refY:O,clip:z=!1,clipX:ie=0,clipY:ne=0}=e,ue=Mf(n).replace(/^defer\s/,""),[ce,de]=ue.split(" "),be=ce||"xMidYMid",Te=de||"meet",je=o/c,Ge=s/m,$e=Math.min(je,Ge),Ue=Math.max(je,Ge),lt=c,nt=m;Te==="meet"&&(lt*=$e,nt*=$e),Te==="slice"&&(lt*=Ue,nt*=Ue);var De=new wr(t,"refX",F),Fe=new wr(t,"refY",O),Je=De.hasValue()&&Fe.hasValue();if(Je&&r.translate(-$e*De.getPixels("x"),-$e*Fe.getPixels("y")),z){var We=$e*ie,Et=$e*ne;r.beginPath(),r.moveTo(We,Et),r.lineTo(o,Et),r.lineTo(o,s),r.lineTo(We,s),r.closePath(),r.clip()}if(!Je){var Ct=Te==="meet"&&$e===Ge,Lt=Te==="slice"&&Ue===Ge,_t=Te==="meet"&&$e===je,Ft=Te==="slice"&&Ue===je;be.startsWith("xMid")&&(Ct||Lt)&&r.translate(o/2-lt/2,0),be.endsWith("YMid")&&(_t||Ft)&&r.translate(0,s/2-nt/2),be.startsWith("xMax")&&(Ct||Lt)&&r.translate(o-lt,0),be.endsWith("YMax")&&(_t||Ft)&&r.translate(0,s-nt)}switch(!0){case be==="none":r.scale(je,Ge);break;case Te==="meet":r.scale($e,$e);break;case Te==="slice":r.scale(Ue,Ue);break}r.translate(-x,-I)}start(e){var{enableRedraw:t=!1,ignoreMouse:r=!1,ignoreAnimation:n=!1,ignoreDimensions:o=!1,ignoreClear:c=!1,forceRedraw:s,scaleWidth:m,scaleHeight:x,offsetX:I,offsetY:F}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:O,mouse:z}=this,ie=1e3/O;if(this.frameDuration=ie,this.readyPromise=new Promise(be=>{this.resolveReady=be}),this.isReady()&&this.render(e,o,c,m,x,I,F),!!t){var ne=Date.now(),ue=ne,ce=0,de=()=>{ne=Date.now(),ce=ne-ue,ce>=ie&&(ue=ne-ce%ie,this.shouldUpdate(n,s)&&(this.render(e,o,c,m,x,I,F),z.runEvents())),this.intervalId=jS(de)};r||z.start(),this.intervalId=jS(de)}}stop(){this.intervalId&&(jS.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:r}=this,n=this.animations.reduce((o,c)=>c.update(r)||o,!1);if(n)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,r,n,o,c,s){var{CLIENT_WIDTH:m,CLIENT_HEIGHT:x,viewPort:I,ctx:F,isFirstRender:O}=this,z=F.canvas;I.clear(),z.width&&z.height?I.setCurrent(z.width,z.height):I.setCurrent(m,x);var ie=e.getStyle("width"),ne=e.getStyle("height");!t&&(O||typeof n!="number"&&typeof o!="number")&&(ie.hasValue()&&(z.width=ie.getPixels("x"),z.style&&(z.style.width="".concat(z.width,"px"))),ne.hasValue()&&(z.height=ne.getPixels("y"),z.style&&(z.style.height="".concat(z.height,"px"))));var ue=z.clientWidth||z.width,ce=z.clientHeight||z.height;if(t&&ie.hasValue()&&ne.hasValue()&&(ue=ie.getPixels("x"),ce=ne.getPixels("y")),I.setCurrent(ue,ce),typeof c=="number"&&e.getAttribute("x",!0).setValue(c),typeof s=="number"&&e.getAttribute("y",!0).setValue(s),typeof n=="number"||typeof o=="number"){var de=Tc(e.getAttribute("viewBox").getString()),be=0,Te=0;if(typeof n=="number"){var je=e.getStyle("width");je.hasValue()?be=je.getPixels("x")/n:isNaN(de[2])||(be=de[2]/n)}if(typeof o=="number"){var Ge=e.getStyle("height");Ge.hasValue()?Te=Ge.getPixels("y")/o:isNaN(de[3])||(Te=de[3]/o)}be||(be=Te),Te||(Te=be),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var $e=e.getStyle("transform",!0,!0);$e.setValue("".concat($e.getString()," scale(").concat(1/be,", ").concat(1/Te,")"))}r||F.clearRect(0,0,ue,ce),e.render(F),O&&(this.isFirstRender=!1)}}o0.defaultWindow=v6,o0.defaultFetch=b6;var{defaultFetch:H_e}=o0,G_e=typeof DOMParser<"u"?DOMParser:null;class yb{constructor(){var{fetch:e=H_e,DOMParser:t=G_e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return TA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return TA(function*(){var r=yield t.fetch(e),n=yield r.text();return t.parseFromString(n)})()}}class x6{constructor(e,t){this.type="translate",this.point=null,this.point=Eo.parse(t)}apply(e){var{x:t,y:r}=this.point;e.translate(t||0,r||0)}unapply(e){var{x:t,y:r}=this.point;e.translate(-1*t||0,-1*r||0)}applyToPoint(e){var{x:t,y:r}=this.point;e.applyTransform([1,0,0,1,t||0,r||0])}}class w6{constructor(e,t,r){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var n=Tc(t);this.angle=new wr(e,"angle",n[0]),this.originX=r[0],this.originY=r[1],this.cx=n[1]||0,this.cy=n[2]||0}apply(e){var{cx:t,cy:r,originX:n,originY:o,angle:c}=this,s=t+n.getPixels("x"),m=r+o.getPixels("y");e.translate(s,m),e.rotate(c.getRadians()),e.translate(-s,-m)}unapply(e){var{cx:t,cy:r,originX:n,originY:o,angle:c}=this,s=t+n.getPixels("x"),m=r+o.getPixels("y");e.translate(s,m),e.rotate(-1*c.getRadians()),e.translate(-s,-m)}applyToPoint(e){var{cx:t,cy:r,angle:n}=this,o=n.getRadians();e.applyTransform([1,0,0,1,t||0,r||0]),e.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),e.applyTransform([1,0,0,1,-t||0,-r||0])}}class B6{constructor(e,t,r){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var n=Eo.parseScale(t);(n.x===0||n.y===0)&&(n.x=Ff,n.y=Ff),this.scale=n,this.originX=r[0],this.originY=r[1]}apply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,c=n.getPixels("x"),s=o.getPixels("y");e.translate(c,s),e.scale(t,r||t),e.translate(-c,-s)}unapply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,c=n.getPixels("x"),s=o.getPixels("y");e.translate(c,s),e.scale(1/t,1/r||t),e.translate(-c,-s)}applyToPoint(e){var{x:t,y:r}=this.scale;e.applyTransform([t||0,0,0,r||0,0,0])}}class cT{constructor(e,t,r){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=Tc(t),this.originX=r[0],this.originY=r[1]}apply(e){var{originX:t,originY:r,matrix:n}=this,o=t.getPixels("x"),c=r.getPixels("y");e.translate(o,c),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.translate(-o,-c)}unapply(e){var{originX:t,originY:r,matrix:n}=this,o=n[0],c=n[2],s=n[4],m=n[1],x=n[3],I=n[5],F=0,O=0,z=1,ie=1/(o*(x*z-I*O)-c*(m*z-I*F)+s*(m*O-x*F)),ne=t.getPixels("x"),ue=r.getPixels("y");e.translate(ne,ue),e.transform(ie*(x*z-I*O),ie*(I*F-m*z),ie*(s*O-c*z),ie*(o*z-s*F),ie*(c*I-s*x),ie*(s*m-o*I)),e.translate(-ne,-ue)}applyToPoint(e){e.applyTransform(this.matrix)}}class uT extends cT{constructor(e,t,r){super(e,t,r),this.type="skew",this.angle=null,this.angle=new wr(e,"angle",t)}}class C6 extends uT{constructor(e,t,r){super(e,t,r),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class E6 extends uT{constructor(e,t,r){super(e,t,r),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function j_e(i){return Mf(i).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function q_e(i){var[e,t]=i.split("(");return[e.trim(),t.trim().replace(")","")]}class vd{constructor(e,t,r){this.document=e,this.transforms=[];var n=j_e(t);n.forEach(o=>{if(o!=="none"){var[c,s]=q_e(o),m=vd.transformTypes[c];typeof m<"u"&&this.transforms.push(new m(this.document,s,r))}})}static fromElement(e,t){var r=t.getStyle("transform",!1,!0),[n,o=n]=t.getStyle("transform-origin",!1,!0).split(),c=[n,o];return r.hasValue()?new vd(e,r.getString(),c):null}apply(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].apply(e)}unapply(e){for(var{transforms:t}=this,r=t.length,n=r-1;n>=0;n--)t[n].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].applyToPoint(e)}}vd.transformTypes={translate:x6,rotate:w6,scale:B6,matrix:cT,skewX:C6,skewY:E6};class Vs{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=r,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(s=>{var m=p6(s.nodeName);this.attributes[m]=new wr(e,m,s.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var n=this.getAttribute("style").getString().split(";").map(s=>s.trim());n.forEach(s=>{if(s){var[m,x]=s.split(":").map(I=>I.trim());this.styles[m]=new wr(e,m,x)}})}var{definitions:o}=e,c=this.getAttribute("id");c.hasValue()&&(o[c.getString()]||(o[c.getString()]=this)),Array.from(t.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(r&&(s.nodeType===3||s.nodeType===4)){var m=e.createTextNode(s);m.getText().length>0&&this.addChild(m)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.attributes[e];if(!r&&t){var n=new wr(this.document,e,"");return this.attributes[e]=n,n}return r||wr.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return wr.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o!=null&&o.hasValue())return this.styles[e]=o,o;if(!r){var{parent:c}=this;if(c){var s=c.getStyle(e);if(s!=null&&s.hasValue())return s}}if(t){var m=new wr(this.document,e,"");return this.styles[e]=m,m}return n||wr.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var r=this.getStyle("filter").getDefinition();r&&(this.applyEffects(e),r.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=vd.fromElement(this.document,this);t&&t.apply(e);var r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){var n=r.getDefinition();n&&n.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Vs?e:this.document.createElement(e);t.parent=this,Vs.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:r}=this;if(typeof r.matches=="function")return r.matches(e);var n=(t=r.getAttribute)===null||t===void 0?void 0:t.call(r,"class");return!n||n===""?!1:n.split(" ").some(o=>".".concat(o)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var r in e)if(!r.startsWith("@")&&this.matchesSelector(r)){var n=e[r],o=t[r];if(n)for(var c in n){var s=this.stylesSpecificity[c];typeof s>"u"&&(s="000"),o>=s&&(this.styles[c]=n[c],this.stylesSpecificity[c]=o)}}}removeStyles(e,t){var r=t.reduce((n,o)=>{var c=e.getStyle(o);if(!c.hasValue())return n;var s=c.getString();return c.setValue(""),[...n,[o,s]]},[]);return r}restoreStyles(e,t){t.forEach(r=>{var[n,o]=r;e.getStyle(n,!0).setValue(o)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Vs.ignoreChildTypes=["title"];class S6 extends Vs{constructor(e,t,r){super(e,t,r)}}function $_e(i){var e=i.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function K_e(i){return typeof process>"u"?i:i.trim().split(",").map($_e).join(",")}function W_e(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function X_e(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Fl{constructor(e,t,r,n,o,c){var s=c?typeof c=="string"?Fl.parse(c):c:{};this.fontFamily=o||s.fontFamily,this.fontSize=n||s.fontSize,this.fontStyle=e||s.fontStyle,this.fontWeight=r||s.fontWeight,this.fontVariant=t||s.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r="",n="",o="",c="",s="",m=Mf(e).trim().split(" "),x={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return m.forEach(I=>{switch(!0){case(!x.fontStyle&&Fl.styles.includes(I)):I!=="inherit"&&(r=I),x.fontStyle=!0;break;case(!x.fontVariant&&Fl.variants.includes(I)):I!=="inherit"&&(n=I),x.fontStyle=!0,x.fontVariant=!0;break;case(!x.fontWeight&&Fl.weights.includes(I)):I!=="inherit"&&(o=I),x.fontStyle=!0,x.fontVariant=!0,x.fontWeight=!0;break;case!x.fontSize:I!=="inherit"&&([c]=I.split("/")),x.fontStyle=!0,x.fontVariant=!0,x.fontWeight=!0,x.fontSize=!0;break;default:I!=="inherit"&&(s+=I)}}),new Fl(r,n,o,c,s,t)}toString(){return[W_e(this.fontStyle),this.fontVariant,X_e(this.fontWeight),this.fontSize,K_e(this.fontFamily)].join(" ").trim()}}Fl.styles="normal|italic|oblique|inherit",Fl.variants="normal|small-caps|inherit",Fl.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class Tu{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=r,this.y2=n,this.addPoint(e,t),this.addPoint(r,n)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:r,x2:n,y2:o}=e;this.addPoint(t,r),this.addPoint(n,o)}}sumCubic(e,t,r,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}bezierCurveAdd(e,t,r,n,o){var c=6*t-12*r+6*n,s=-3*t+9*r-9*n+3*o,m=3*r-3*t;if(s===0){if(c===0)return;var x=-m/c;0<x&&x<1&&(e?this.addX(this.sumCubic(x,t,r,n,o)):this.addY(this.sumCubic(x,t,r,n,o)));return}var I=Math.pow(c,2)-4*m*s;if(!(I<0)){var F=(-c+Math.sqrt(I))/(2*s);0<F&&F<1&&(e?this.addX(this.sumCubic(F,t,r,n,o)):this.addY(this.sumCubic(F,t,r,n,o)));var O=(-c-Math.sqrt(I))/(2*s);0<O&&O<1&&(e?this.addX(this.sumCubic(O,t,r,n,o)):this.addY(this.sumCubic(O,t,r,n,o)))}}addBezierCurve(e,t,r,n,o,c,s,m){this.addPoint(e,t),this.addPoint(s,m),this.bezierCurveAdd(!0,e,r,o,s),this.bezierCurveAdd(!1,t,n,c,m)}addQuadraticCurve(e,t,r,n,o,c){var s=e+.6666666666666666*(r-e),m=t+2/3*(n-t),x=s+1/3*(o-e),I=m+1/3*(c-t);this.addBezierCurve(e,t,s,x,m,I,o,c)}isPointInBox(e,t){var{x1:r,y1:n,x2:o,y2:c}=this;return r<=e&&e<=o&&n<=t&&t<=c}}class Yr extends yi{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Eo(0,0),this.control=new Eo(0,0),this.current=new Eo(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",r=new Eo(this.command[e],this.command[t]);return this.makeAbsolute(r)}getAsControlPoint(e,t){var r=this.getPoint(e,t);return this.control=r,r}getAsCurrentPoint(e,t){var r=this.getPoint(e,t);return this.current=r,r}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==yi.CURVE_TO&&e!==yi.SMOOTH_CURVE_TO&&e!==yi.QUAD_TO&&e!==yi.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:r},control:{x:n,y:o}}=this,c=new Eo(2*t-n,2*r-o);return c}makeAbsolute(e){if(this.command.relative){var{x:t,y:r}=this.current;e.x+=t,e.y+=r}return e}addMarker(e,t,r){var{points:n,angles:o}=this;r&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(r)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,r=0;r<t;r++)if(!e[r]){for(var n=r+1;n<t;n++)if(e[n]){e[r]=e[n];break}}return e}}class bd extends Vs{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var r=t.getStyle("opacity",!1,!0);r.hasValue(!0)&&(e*=r.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var r=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),c=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var s=r.getFillStyleDefinition(this,n);s&&(e.fillStyle=s)}else if(r.hasValue()){r.getString()==="currentColor"&&r.setValue(this.getStyle("color").getColor());var m=r.getColor();m!=="inherit"&&(e.fillStyle=m==="none"?"rgba(0,0,0,0)":m)}if(n.hasValue()){var x=new wr(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=x}if(o.isUrlDefinition()){var I=o.getFillStyleDefinition(this,c);I&&(e.strokeStyle=I)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());var F=o.getString();F!=="inherit"&&(e.strokeStyle=F==="none"?"rgba(0,0,0,0)":F)}if(c.hasValue()){var O=new wr(this.document,"stroke",e.strokeStyle).addOpacity(c).getString();e.strokeStyle=O}var z=this.getStyle("stroke-width");if(z.hasValue()){var ie=z.getPixels();e.lineWidth=ie||Ff}var ne=this.getStyle("stroke-linecap"),ue=this.getStyle("stroke-linejoin"),ce=this.getStyle("stroke-miterlimit"),de=this.getStyle("stroke-dasharray"),be=this.getStyle("stroke-dashoffset");if(ne.hasValue()&&(e.lineCap=ne.getString()),ue.hasValue()&&(e.lineJoin=ue.getString()),ce.hasValue()&&(e.miterLimit=ce.getNumber()),de.hasValue()&&de.getString()!=="none"){var Te=Tc(de.getString());typeof e.setLineDash<"u"?e.setLineDash(Te):typeof e.webkitLineDash<"u"?e.webkitLineDash=Te:typeof e.mozDash<"u"&&!(Te.length===1&&Te[0]===0)&&(e.mozDash=Te);var je=be.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=je:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=je:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=je)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var Ge=this.getStyle("font"),$e=this.getStyle("font-style"),Ue=this.getStyle("font-variant"),lt=this.getStyle("font-weight"),nt=this.getStyle("font-size"),De=this.getStyle("font-family"),Fe=new Fl($e.getString(),Ue.getString(),lt.getString(),nt.hasValue()?"".concat(nt.getPixels(!0),"px"):"",De.getString(),Fl.parse(Ge.getString(),e.font));$e.setValue(Fe.fontStyle),Ue.setValue(Fe.fontVariant),lt.setValue(Fe.fontWeight),nt.setValue(Fe.fontSize),De.setValue(Fe.fontFamily),e.font=Fe.toString(),nt.isPixels()&&(this.document.emSize=nt.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class ls extends bd{constructor(e,t,r){super(e,t,r),this.type="path",this.pathParser=null,this.pathParser=new Yr(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,r=new Tu;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Yr.MOVE_TO:this.pathM(e,r);break;case Yr.LINE_TO:this.pathL(e,r);break;case Yr.HORIZ_LINE_TO:this.pathH(e,r);break;case Yr.VERT_LINE_TO:this.pathV(e,r);break;case Yr.CURVE_TO:this.pathC(e,r);break;case Yr.SMOOTH_CURVE_TO:this.pathS(e,r);break;case Yr.QUAD_TO:this.pathQ(e,r);break;case Yr.SMOOTH_QUAD_TO:this.pathT(e,r);break;case Yr.ARC:this.pathA(e,r);break;case Yr.CLOSE_PATH:this.pathZ(e,r);break}return r}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),r=e.getMarkerAngles(),n=t.map((o,c)=>[o,r[c]]);return n}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var r=this.getMarkers();if(r){var n=r.length-1,o=this.getStyle("marker-start"),c=this.getStyle("marker-mid"),s=this.getStyle("marker-end");if(o.isUrlDefinition()){var m=o.getDefinition(),[x,I]=r[0];m.render(e,x,I)}if(c.isUrlDefinition())for(var F=c.getDefinition(),O=1;O<n;O++){var[z,ie]=r[O];F.render(e,z,ie)}if(s.isUrlDefinition()){var ne=s.getDefinition(),[ue,ce]=r[n];ne.render(e,ue,ce)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:r}=this,{point:n}=ls.pathM(r),{x:o,y:c}=n;r.addMarker(n),t.addPoint(o,c),e&&e.moveTo(o,c)}static pathL(e){var{current:t}=e,r=e.getAsCurrentPoint();return{current:t,point:r}}pathL(e,t){var{pathParser:r}=this,{current:n,point:o}=ls.pathL(r),{x:c,y:s}=o;r.addMarker(o,n),t.addPoint(c,s),e&&e.lineTo(c,s)}static pathH(e){var{current:t,command:r}=e,n=new Eo((r.relative?t.x:0)+r.x,t.y);return e.current=n,{current:t,point:n}}pathH(e,t){var{pathParser:r}=this,{current:n,point:o}=ls.pathH(r),{x:c,y:s}=o;r.addMarker(o,n),t.addPoint(c,s),e&&e.lineTo(c,s)}static pathV(e){var{current:t,command:r}=e,n=new Eo(t.x,(r.relative?t.y:0)+r.y);return e.current=n,{current:t,point:n}}pathV(e,t){var{pathParser:r}=this,{current:n,point:o}=ls.pathV(r),{x:c,y:s}=o;r.addMarker(o,n),t.addPoint(c,s),e&&e.lineTo(c,s)}static pathC(e){var{current:t}=e,r=e.getPoint("x1","y1"),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathC(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:c,currentPoint:s}=ls.pathC(r);r.addMarker(s,c,o),t.addBezierCurve(n.x,n.y,o.x,o.y,c.x,c.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,c.x,c.y,s.x,s.y)}static pathS(e){var{current:t}=e,r=e.getReflectedControlPoint(),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathS(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:c,currentPoint:s}=ls.pathS(r);r.addMarker(s,c,o),t.addBezierCurve(n.x,n.y,o.x,o.y,c.x,c.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,c.x,c.y,s.x,s.y)}static pathQ(e){var{current:t}=e,r=e.getAsControlPoint("x1","y1"),n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathQ(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:c}=ls.pathQ(r);r.addMarker(c,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,c.x,c.y),e&&e.quadraticCurveTo(o.x,o.y,c.x,c.y)}static pathT(e){var{current:t}=e,r=e.getReflectedControlPoint();e.control=r;var n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathT(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:c}=ls.pathT(r);r.addMarker(c,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,c.x,c.y),e&&e.quadraticCurveTo(o.x,o.y,c.x,c.y)}static pathA(e){var{current:t,command:r}=e,{rX:n,rY:o,xRot:c,lArcFlag:s,sweepFlag:m}=r,x=c*(Math.PI/180),I=e.getAsCurrentPoint(),F=new Eo(Math.cos(x)*(t.x-I.x)/2+Math.sin(x)*(t.y-I.y)/2,-Math.sin(x)*(t.x-I.x)/2+Math.cos(x)*(t.y-I.y)/2),O=Math.pow(F.x,2)/Math.pow(n,2)+Math.pow(F.y,2)/Math.pow(o,2);O>1&&(n*=Math.sqrt(O),o*=Math.sqrt(O));var z=(s===m?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(F.y,2)-Math.pow(o,2)*Math.pow(F.x,2))/(Math.pow(n,2)*Math.pow(F.y,2)+Math.pow(o,2)*Math.pow(F.x,2)));isNaN(z)&&(z=0);var ie=new Eo(z*n*F.y/o,z*-o*F.x/n),ne=new Eo((t.x+I.x)/2+Math.cos(x)*ie.x-Math.sin(x)*ie.y,(t.y+I.y)/2+Math.sin(x)*ie.x+Math.cos(x)*ie.y),ue=tT([1,0],[(F.x-ie.x)/n,(F.y-ie.y)/o]),ce=[(F.x-ie.x)/n,(F.y-ie.y)/o],de=[(-F.x-ie.x)/n,(-F.y-ie.y)/o],be=tT(ce,de);return mb(ce,de)<=-1&&(be=Math.PI),mb(ce,de)>=1&&(be=0),{currentPoint:I,rX:n,rY:o,sweepFlag:m,xAxisRotation:x,centp:ne,a1:ue,ad:be}}pathA(e,t){var{pathParser:r}=this,{currentPoint:n,rX:o,rY:c,sweepFlag:s,xAxisRotation:m,centp:x,a1:I,ad:F}=ls.pathA(r),O=1-s?1:-1,z=I+O*(F/2),ie=new Eo(x.x+o*Math.cos(z),x.y+c*Math.sin(z));if(r.addMarkerAngle(ie,z-O*Math.PI/2),r.addMarkerAngle(n,z-O*Math.PI),t.addPoint(n.x,n.y),e&&!isNaN(I)&&!isNaN(F)){var ne=o>c?o:c,ue=o>c?1:o/c,ce=o>c?c/o:1;e.translate(x.x,x.y),e.rotate(m),e.scale(ue,ce),e.arc(0,0,ne,I,I+F,!!(1-s)),e.scale(1/ue,1/ce),e.rotate(-m),e.translate(-x.x,-x.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){ls.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class hT extends ls{constructor(e,t,r){super(e,t,r),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class MA extends bd{constructor(e,t,r){super(e,t,new.target===MA?!0:r),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(e.textBaseline=r)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((r,n)=>{var o=this.getChildBoundingBox(e,this,this,n);t?t.addBoundingBox(o):t=o}),t}getFontSize(){var{document:e,parent:t}=this,r=Fl.parse(e.ctx.font).fontSize,n=t.getStyle("font-size").getNumber(r);return n}getTElementBoundingBox(e){var t=this.getFontSize();return new Tu(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,r){var n=t[r],o=null;if(e.isArabic){var c=t.length,s=t[r-1],m=t[r+1],x="isolated";if((r===0||s===" ")&&r<c-1&&m!==" "&&(x="terminal"),r>0&&s!==" "&&r<c-1&&m!==" "&&(x="medial"),r>0&&s!==" "&&(r===c-1||m===" ")&&(x="initial"),typeof e.glyphs[n]<"u"){var I=e.glyphs[n];o=I instanceof hT?I:I[x]}}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}getText(){return""}getTextFromNode(e){var t=e||this.node,r=Array.from(t.parentNode.childNodes),n=r.indexOf(t),o=r.length-1,c=Mf(t.textContent||"");return n===0&&(c=d6(c)),n===o&&(c=f6(c)),c}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((r,n)=>{this.renderChild(e,this,this,n)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:r}=this,n=this.getText(),o=r.getStyle("font-family").getDefinition();if(o){for(var{unitsPerEm:c}=o.fontFace,s=Fl.parse(t.ctx.font),m=r.getStyle("font-size").getNumber(s.fontSize),x=r.getStyle("font-style").getString(s.fontStyle),I=m/c,F=o.isRTL?n.split("").reverse().join(""):n,O=Tc(r.getAttribute("dx").getString()),z=F.length,ie=0;ie<z;ie++){var ne=this.getGlyph(o,F,ie);e.translate(this.x,this.y),e.scale(I,-I);var ue=e.lineWidth;e.lineWidth=e.lineWidth*c/m,x==="italic"&&e.transform(1,0,.4,1,0,0),ne.render(e),x==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=ue,e.scale(1/I,-1/I),e.translate(-this.x,-this.y),this.x+=m*(ne.horizAdvX||o.horizAdvX)/c,typeof O[ie]<"u"&&!isNaN(O[ie])&&(this.x+=O[ie])}return}var{x:ce,y:de}=this;e.fillStyle&&e.fillText(n,ce,de),e.strokeStyle&&e.strokeText(n,ce,de)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),r=!1,n=0;t==="start"&&!r||t==="end"&&r?n=e.x-this.minX:t==="end"&&!r||t==="start"&&r?n=e.x-this.maxX:n=e.x-(this.minX+this.maxX)/2;for(var o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=n;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,r)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,r)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,r,n){var o=r.children[n];o.children.length>0?o.children.forEach((c,s)=>{t.adjustChildCoordinatesRecursiveCore(e,t,o,s)}):this.adjustChildCoordinates(e,t,r,n)}adjustChildCoordinates(e,t,r,n){var o=r.children[n];if(typeof o.measureText!="function")return o;e.save(),o.setContext(e,!0);var c=o.getAttribute("x"),s=o.getAttribute("y"),m=o.getAttribute("dx"),x=o.getAttribute("dy"),I=o.getStyle("font-family").getDefinition(),F=!!I&&I.isRTL;n===0&&(c.hasValue()||c.setValue(o.getInheritedAttribute("x")),s.hasValue()||s.setValue(o.getInheritedAttribute("y")),m.hasValue()||m.setValue(o.getInheritedAttribute("dx")),x.hasValue()||x.setValue(o.getInheritedAttribute("dy")));var O=o.measureText(e);return F&&(t.x-=O),c.hasValue()?(t.applyAnchoring(),o.x=c.getPixels("x"),m.hasValue()&&(o.x+=m.getPixels("x"))):(m.hasValue()&&(t.x+=m.getPixels("x")),o.x=t.x),t.x=o.x,F||(t.x+=O),s.hasValue()?(o.y=s.getPixels("y"),x.hasValue()&&(o.y+=x.getPixels("y"))):(x.hasValue()&&(t.y+=x.getPixels("y")),o.y=t.y),t.y=o.y,t.leafTexts.push(o),t.minX=Math.min(t.minX,o.x,o.x+O),t.maxX=Math.max(t.maxX,o.x,o.x+O),o.clearContext(e),e.restore(),o}getChildBoundingBox(e,t,r,n){var o=r.children[n];if(typeof o.getBoundingBox!="function")return null;var c=o.getBoundingBox(e);return c?(o.children.forEach((s,m)=>{var x=t.getChildBoundingBox(e,t,o,m);c.addBoundingBox(x)}),c):null}renderChild(e,t,r,n){var o=r.children[n];o.render(e),o.children.forEach((c,s)=>{t.renderChild(e,t,o,s)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var r=this.getText(),n=this.measureTargetText(e,r);return this.measureCache=n,n}measureTargetText(e,t){if(!t.length)return 0;var{parent:r}=this,n=r.getStyle("font-family").getDefinition();if(n){for(var o=this.getFontSize(),c=n.isRTL?t.split("").reverse().join(""):t,s=Tc(r.getAttribute("dx").getString()),m=c.length,x=0,I=0;I<m;I++){var F=this.getGlyph(n,c,I);x+=(F.horizAdvX||n.horizAdvX)*o/n.fontFace.unitsPerEm,typeof s[I]<"u"&&!isNaN(s[I])&&(x+=s[I])}return x}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:O}=e.measureText(t);return this.clearContext(e),e.restore(),O}getInheritedAttribute(e){for(var t=this;t instanceof MA&&t.isFirstChild();){var r=t.parent.getAttribute(e);if(r.hasValue(!0))return r.getValue("0");t=t.parent}return null}}class a0 extends MA{constructor(e,t,r){super(e,t,new.target===a0?!0:r),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class Z_e extends a0{constructor(){super(...arguments),this.type="textNode"}}class Gg extends bd{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:r}=this,{screen:n,window:o}=r,c=e.canvas;if(n.setDefaults(e),c.style&&typeof e.font<"u"&&o&&typeof o.getComputedStyle<"u"){e.font=o.getComputedStyle(c).getPropertyValue("font");var s=new wr(r,"fontSize",Fl.parse(e.font).fontSize);s.hasValue()&&(r.rootEmSize=s.getPixels("y"),r.emSize=r.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:m,height:x}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var I=this.getAttribute("refX"),F=this.getAttribute("refY"),O=this.getAttribute("viewBox"),z=O.hasValue()?Tc(O.getString()):null,ie=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",ne=0,ue=0,ce=0,de=0;z&&(ne=z[0],ue=z[1]),this.root||(m=this.getStyle("width").getPixels("x"),x=this.getStyle("height").getPixels("y"),this.type==="marker"&&(ce=ne,de=ue,ne=0,ue=0)),n.viewPort.setCurrent(m,x),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),z&&(m=z[2],x=z[3]),r.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:m,height:n.viewPort.height,desiredHeight:x,minX:ne,minY:ue,refX:I.getValue(),refY:F.getValue(),clip:ie,clipX:ce,clipY:de}),z&&(n.viewPort.removeCurrent(),n.viewPort.setCurrent(m,x))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.getAttribute("width",!0),o=this.getAttribute("height",!0),c=this.getAttribute("viewBox"),s=this.getAttribute("style"),m=n.getNumber(0),x=o.getNumber(0);if(r)if(typeof r=="string")this.getAttribute("preserveAspectRatio",!0).setValue(r);else{var I=this.getAttribute("preserveAspectRatio");I.hasValue()&&I.setValue(I.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(n.setValue(e),o.setValue(t),c.hasValue()||c.setValue("0 0 ".concat(m||e," ").concat(x||t)),s.hasValue()){var F=this.getStyle("width"),O=this.getStyle("height");F.hasValue()&&F.setValue("".concat(e,"px")),O.hasValue()&&O.setValue("".concat(t,"px"))}}}class AT extends ls{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),c=this.getAttribute("rx"),s=this.getAttribute("ry"),m=c.getPixels("x"),x=s.getPixels("y");if(c.hasValue()&&!s.hasValue()&&(x=m),s.hasValue()&&!c.hasValue()&&(m=x),m=Math.min(m,n/2),x=Math.min(x,o/2),e){var I=4*((Math.sqrt(2)-1)/3);e.beginPath(),o>0&&n>0&&(e.moveTo(t+m,r),e.lineTo(t+n-m,r),e.bezierCurveTo(t+n-m+I*m,r,t+n,r+x-I*x,t+n,r+x),e.lineTo(t+n,r+o-x),e.bezierCurveTo(t+n,r+o-x+I*x,t+n-m+I*m,r+o,t+n-m,r+o),e.lineTo(t+m,r+o),e.bezierCurveTo(t+m-I*m,r+o,t,r+o-x+I*x,t,r+o-x),e.lineTo(t,r+x),e.bezierCurveTo(t,r+x-I*x,t+m-I*m,r,t+m,r),e.closePath())}return new Tu(t,r,t+n,r+o)}getMarkers(){return null}}class T6 extends ls{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,r,n,0,Math.PI*2,!1),e.closePath()),new Tu(t-n,r-n,t+n,r+n)}getMarkers(){return null}}class I6 extends ls{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),r=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),c=this.getAttribute("cy").getPixels("y");return e&&r>0&&n>0&&(e.beginPath(),e.moveTo(o+r,c),e.bezierCurveTo(o+r,c+t*n,o+t*r,c+n,o,c+n),e.bezierCurveTo(o-t*r,c+n,o-r,c+t*n,o-r,c),e.bezierCurveTo(o-r,c-t*n,o-t*r,c-n,o,c-n),e.bezierCurveTo(o+t*r,c-n,o+r,c-t*n,o+r,c),e.closePath()),new Tu(o-r,c-n,o+r,c+n)}getMarkers(){return null}}class L6 extends ls{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Eo(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Eo(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:r},{x:n,y:o}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,r),e.lineTo(n,o)),new Tu(t,r,n,o)}getMarkers(){var[e,t]=this.getPoints(),r=e.angleTo(t);return[[e,r],[t,r]]}}class dT extends ls{constructor(e,t,r){super(e,t,r),this.type="polyline",this.points=[],this.points=Eo.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:r,y:n}]=t,o=new Tu(r,n);return e&&(e.beginPath(),e.moveTo(r,n)),t.forEach(c=>{var{x:s,y:m}=c;o.addPoint(s,m),e&&e.lineTo(s,m)}),o}getMarkers(){var{points:e}=this,t=e.length-1,r=[];return e.forEach((n,o)=>{o!==t&&r.push([n,n.angleTo(e[o+1])])}),r.length>0&&r.push([e[e.length-1],r[r.length-1][1]]),r}}class M6 extends dT{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:r,y:n}]=this.points;return e&&(e.lineTo(r,n),e.closePath()),t}}class P6 extends Vs{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,r){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),c=new Gg(this.document,null);c.attributes.viewBox=new wr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),c.attributes.width=new wr(this.document,"width","".concat(n,"px")),c.attributes.height=new wr(this.document,"height","".concat(o,"px")),c.attributes.transform=new wr(this.document,"transform",this.getAttribute("patternTransform").getValue()),c.children=this.children;var s=this.document.createCanvas(n,o),m=s.getContext("2d"),x=this.getAttribute("x"),I=this.getAttribute("y");x.hasValue()&&I.hasValue()&&m.translate(x.getPixels("x",!0),I.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(var F=-1;F<=1;F++)for(var O=-1;O<=1;O++)m.save(),c.attributes.x=new wr(this.document,"x",F*s.width),c.attributes.y=new wr(this.document,"y",O*s.height),c.render(m),m.restore();var z=e.createPattern(s,"repeat");return z}}class F6 extends Vs{constructor(){super(...arguments),this.type="marker"}render(e,t,r){if(t){var{x:n,y:o}=t,c=this.getAttribute("orient").getString("auto"),s=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(n,o),c==="auto"&&e.rotate(r),s==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var m=new Gg(this.document,null);m.type=this.type,m.attributes.viewBox=new wr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),m.attributes.refX=new wr(this.document,"refX",this.getAttribute("refX").getValue()),m.attributes.refY=new wr(this.document,"refY",this.getAttribute("refY").getValue()),m.attributes.width=new wr(this.document,"width",this.getAttribute("markerWidth").getValue()),m.attributes.height=new wr(this.document,"height",this.getAttribute("markerHeight").getValue()),m.attributes.overflow=new wr(this.document,"overflow",this.getAttribute("overflow").getValue()),m.attributes.fill=new wr(this.document,"fill",this.getAttribute("fill").getColor("black")),m.attributes.stroke=new wr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),m.children=this.children,m.render(e),e.restore(),s==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),c==="auto"&&e.rotate(-r),e.translate(-n,-o)}}}class D6 extends Vs{constructor(){super(...arguments),this.type="defs"}render(){}}class _b extends bd{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new Tu;return this.children.forEach(r=>{t.addBoundingBox(r.getBoundingBox(e))}),t}}class fT extends Vs{constructor(e,t,r){super(e,t,r),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:n,children:o}=this;o.forEach(c=>{c.type==="stop"&&n.push(c)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,r){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var{stops:o}=n,c=this.getGradient(e,t);if(!c)return this.addParentOpacity(r,o[o.length-1].color);if(o.forEach(ue=>{c.addColorStop(ue.offset,this.addParentOpacity(r,ue.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:s}=this,{MAX_VIRTUAL_PIXELS:m,viewPort:x}=s.screen,[I]=x.viewPorts,F=new AT(s,null);F.attributes.x=new wr(s,"x",-m/3),F.attributes.y=new wr(s,"y",-m/3),F.attributes.width=new wr(s,"width",m),F.attributes.height=new wr(s,"height",m);var O=new _b(s,null);O.attributes.transform=new wr(s,"transform",this.getAttribute("gradientTransform").getValue()),O.children=[F];var z=new Gg(s,null);z.attributes.x=new wr(s,"x",0),z.attributes.y=new wr(s,"y",0),z.attributes.width=new wr(s,"width",I.width),z.attributes.height=new wr(s,"height",I.height),z.children=[O];var ie=s.createCanvas(I.width,I.height),ne=ie.getContext("2d");return ne.fillStyle=c,z.render(ne),ne.createPattern(ie,"no-repeat")}return c}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var r=new wr(this.document,"color",t);return r.addOpacity(e).getColor()}return t}}class R6 extends fT{constructor(e,t,r){super(e,t,r),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=r?t.getBoundingBox(e):null;if(r&&!n)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=r?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),c=r?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),s=r?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),m=r?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===s&&c===m?null:e.createLinearGradient(o,c,s,m)}}class k6 extends fT{constructor(e,t,r){super(e,t,r),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=t.getBoundingBox(e);if(r&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=r?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),c=r?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),s=o,m=c;this.getAttribute("fx").hasValue()&&(s=r?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(m=r?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var x=r?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),I=this.getAttribute("fr").getPixels();return e.createRadialGradient(s,m,I,o,c,x)}}class O6 extends Vs{constructor(e,t,r){super(e,t,r),this.type="stop";var n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),c=this.getStyle("stop-color",!0);c.getString()===""&&c.setValue("#000"),o.hasValue()&&(c=c.addOpacity(o)),this.offset=n,this.color=c.getColor()}}class vb extends Vs{constructor(e,t,r){super(e,t,r),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new wr(e,"values",null);var n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:r,to:n}=this.getProgress(),o=r.getNumber()+(n.getNumber()-r.getNumber())*t;return e==="%"&&(o*=100),"".concat(o).concat(e)}update(e){var{parent:t}=this,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(n==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=r.getString();else if(n==="remove"&&!this.removed)return this.removed=!0,r.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var c=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){var m=s.getString();c="".concat(m,"(").concat(c,")")}r.setValue(c),o=!0}return o}getProgress(){var{document:e,values:t}=this,r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=r.progress*(t.getValue().length-1),o=Math.floor(n),c=Math.ceil(n);r.from=new wr(e,"from",parseFloat(t.getValue()[o])),r.to=new wr(e,"to",parseFloat(t.getValue()[c])),r.progress=(n-o)/(c-o)}else r.from=this.from,r.to=this.to;return r}}class U6 extends vb{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=new KS(t.getColor()),o=new KS(r.getColor());if(n.ok&&o.ok){var c=n.r+(o.r-n.r)*e,s=n.g+(o.g-n.g)*e,m=n.b+(o.b-n.b)*e;return"rgb(".concat(Math.floor(c),", ").concat(Math.floor(s),", ").concat(Math.floor(m),")")}return this.getAttribute("from").getColor()}}class N6 extends vb{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=Tc(t.getString()),o=Tc(r.getString()),c=n.map((s,m)=>{var x=o[m];return s+(x-s)*e}).join(" ");return c}}class z6 extends Vs{constructor(e,t,r){super(e,t,r),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:n}=e,{children:o}=this;for(var c of o)switch(c.type){case"font-face":{this.fontFace=c;var s=c.getStyle("font-family");s.hasValue()&&(n[s.getString()]=this);break}case"missing-glyph":this.missingGlyph=c;break;case"glyph":{var m=c;m.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[m.unicode]>"u"&&(this.glyphs[m.unicode]={}),this.glyphs[m.unicode][m.arabicForm]=m):this.glyphs[m.unicode]=m;break}}}render(){}}class Q6 extends Vs{constructor(e,t,r){super(e,t,r),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class V6 extends ls{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class H6 extends MA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class G6 extends MA{constructor(e,t,r){super(e,t,r),this.type="a";var{childNodes:n}=t,o=n[0],c=n.length>0&&Array.from(n).every(s=>s.nodeType===3);this.hasText=c,this.text=c?this.getTextFromNode(o):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:r,y:n}=this,{mouse:o}=t.screen,c=new wr(t,"fontSize",Fl.parse(t.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new Tu(r,n-c.getPixels("y"),r+this.measureText(e),n))}else if(this.children.length>0){var s=new _b(this.document,null);s.children=this.children,s.parent=this,s.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function j6(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function bb(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?j6(Object(t),!0).forEach(function(r){QS(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):j6(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class q6 extends MA{constructor(e,t,r){super(e,t,r),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(n)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(r=>{var{type:n,points:o}=r;switch(n){case Yr.LINE_TO:e&&e.lineTo(o[0],o[1]);break;case Yr.MOVE_TO:e&&e.moveTo(o[0],o[1]);break;case Yr.CURVE_TO:e&&e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case Yr.QUAD_TO:e&&e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case Yr.ARC:{var[c,s,m,x,I,F,O,z]=o,ie=m>x?m:x,ne=m>x?1:m/x,ue=m>x?x/m:1;e&&(e.translate(c,s),e.rotate(O),e.scale(ne,ue),e.arc(0,0,ie,I,I+F,!!(1-z)),e.scale(1/ne,1/ue),e.rotate(-O),e.translate(-c,-s));break}case Yr.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),{glyphInfo:n}=this,o=e.fillStyle;t==="underline"&&e.beginPath(),n.forEach((c,s)=>{var{p0:m,p1:x,rotation:I,text:F}=c;e.save(),e.translate(m.x,m.y),e.rotate(I),e.fillStyle&&e.fillText(F,0,0),e.strokeStyle&&e.strokeText(F,0,0),e.restore(),t==="underline"&&(s===0&&e.moveTo(m.x,m.y+r/8),e.lineTo(x.x,x.y+r/5))}),t==="underline"&&(e.lineWidth=r/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,r,n,o,c,s,m,x){var I=c,F=this.measureText(e,m);m===" "&&t==="justify"&&r<n&&(F+=(n-r)/o),x>-1&&(I+=this.getLetterSpacingAt(x));var O=this.textHeight/20,z=this.getEquidistantPointOnPath(I,O,0),ie=this.getEquidistantPointOnPath(I+F,O,0),ne={p0:z,p1:ie},ue=z&&ie?Math.atan2(ie.y-z.y,ie.x-z.x):0;if(s){var ce=Math.cos(Math.PI/2+ue)*s,de=Math.cos(-ue)*s;ne.p0=bb(bb({},z),{},{x:z.x+ce,y:z.y+de}),ne.p1=bb(bb({},ie),{},{x:ie.x+ce,y:ie.y+de})}return I+=F,{offset:I,segment:ne,rotation:ue}}measureText(e,t){var{measuresCache:r}=this,n=t||this.getText();if(r.has(n))return r.get(n);var o=this.measureTargetText(e,n);return r.set(n,o),o}setTextData(e){if(!this.glyphInfo){var t=this.getText(),r=t.split(""),n=t.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(Te=>Te.getPixels("x")),c=this.parent.getAttribute("dy").getPixels("y"),s=this.parent.getStyle("text-anchor").getString("start"),m=this.getStyle("letter-spacing"),x=this.parent.getStyle("letter-spacing"),I=0;!m.hasValue()||m.getValue()==="inherit"?I=x.getPixels():m.hasValue()&&m.getValue()!=="initial"&&m.getValue()!=="unset"&&(I=m.getPixels());var F=[],O=t.length;this.letterSpacingCache=F;for(var z=0;z<O;z++)F.push(typeof o[z]<"u"?o[z]:I);var ie=F.reduce((Te,je,Ge)=>Ge===0?0:Te+je||0,0),ne=this.measureText(e),ue=Math.max(ne+ie,0);this.textWidth=ne,this.textHeight=this.getFontSize(),this.glyphInfo=[];var ce=this.getPathLength(),de=this.getStyle("startOffset").getNumber(0)*ce,be=0;(s==="middle"||s==="center")&&(be=-ue/2),(s==="end"||s==="right")&&(be=-ue),be+=de,r.forEach((Te,je)=>{var{offset:Ge,segment:$e,rotation:Ue}=this.findSegmentToFitChar(e,s,ue,ce,n,be,c,Te,je);be=Ge,!(!$e.p0||!$e.p1)&&this.glyphInfo.push({text:r[je],p0:$e.p0,p1:$e.p1,rotation:Ue})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:r}=e;for(r.reset();!r.isEnd();){var{current:n}=r,o=n?n.x:0,c=n?n.y:0,s=r.next(),m=s.type,x=[];switch(s.type){case Yr.MOVE_TO:this.pathM(r,x);break;case Yr.LINE_TO:m=this.pathL(r,x);break;case Yr.HORIZ_LINE_TO:m=this.pathH(r,x);break;case Yr.VERT_LINE_TO:m=this.pathV(r,x);break;case Yr.CURVE_TO:this.pathC(r,x);break;case Yr.SMOOTH_CURVE_TO:m=this.pathS(r,x);break;case Yr.QUAD_TO:this.pathQ(r,x);break;case Yr.SMOOTH_QUAD_TO:m=this.pathT(r,x);break;case Yr.ARC:x=this.pathA(r);break;case Yr.CLOSE_PATH:ls.pathZ(r);break}s.type!==Yr.CLOSE_PATH?t.push({type:m,points:x,start:{x:o,y:c},pathLength:this.calcLength(o,c,m,x)}):t.push({type:Yr.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:r,y:n}=ls.pathM(e).point;t.push(r,n)}pathL(e,t){var{x:r,y:n}=ls.pathL(e).point;return t.push(r,n),Yr.LINE_TO}pathH(e,t){var{x:r,y:n}=ls.pathH(e).point;return t.push(r,n),Yr.LINE_TO}pathV(e,t){var{x:r,y:n}=ls.pathV(e).point;return t.push(r,n),Yr.LINE_TO}pathC(e,t){var{point:r,controlPoint:n,currentPoint:o}=ls.pathC(e);t.push(r.x,r.y,n.x,n.y,o.x,o.y)}pathS(e,t){var{point:r,controlPoint:n,currentPoint:o}=ls.pathS(e);return t.push(r.x,r.y,n.x,n.y,o.x,o.y),Yr.CURVE_TO}pathQ(e,t){var{controlPoint:r,currentPoint:n}=ls.pathQ(e);t.push(r.x,r.y,n.x,n.y)}pathT(e,t){var{controlPoint:r,currentPoint:n}=ls.pathT(e);return t.push(r.x,r.y,n.x,n.y),Yr.QUAD_TO}pathA(e){var{rX:t,rY:r,sweepFlag:n,xAxisRotation:o,centp:c,a1:s,ad:m}=ls.pathA(e);return n===0&&m>0&&(m-=2*Math.PI),n===1&&m<0&&(m+=2*Math.PI),[c.x,c.y,t,r,s,m,o,n]}calcLength(e,t,r,n){var o=0,c=null,s=null,m=0;switch(r){case Yr.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case Yr.CURVE_TO:for(o=0,c=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),m=.01;m<=1;m+=.01)s=this.getPointOnCubicBezier(m,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(c.x,c.y,s.x,s.y),c=s;return o;case Yr.QUAD_TO:for(o=0,c=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),m=.01;m<=1;m+=.01)s=this.getPointOnQuadraticBezier(m,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(c.x,c.y,s.x,s.y),c=s;return o;case Yr.ARC:{o=0;var x=n[4],I=n[5],F=n[4]+I,O=Math.PI/180;if(Math.abs(x-F)<O&&(O=Math.abs(x-F)),c=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],x,0),I<0)for(m=x-O;m>F;m-=O)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],m,0),o+=this.getLineLength(c.x,c.y,s.x,s.y),c=s;else for(m=x+O;m<F;m+=O)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],m,0),o+=this.getLineLength(c.x,c.y,s.x,s.y),c=s;return s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],F,0),o+=this.getLineLength(c.x,c.y,s.x,s.y),o}}return 0}getPointOnLine(e,t,r,n,o){var c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:r,m=(o-r)/(n-t+Ff),x=Math.sqrt(e*e/(1+m*m));n<t&&(x*=-1);var I=m*x,F=null;if(n===t)F={x:c,y:s+I};else if((s-r)/(c-t+Ff)===m)F={x:c+x,y:s+I};else{var O=0,z=0,ie=this.getLineLength(t,r,n,o);if(ie<Ff)return null;var ne=(c-t)*(n-t)+(s-r)*(o-r);ne/=ie*ie,O=t+ne*(n-t),z=r+ne*(o-r);var ue=this.getLineLength(c,s,O,z),ce=Math.sqrt(e*e-ue*ue);x=Math.sqrt(ce*ce/(1+m*m)),n<t&&(x*=-1),I=m*x,F={x:O+x,y:z+I}}return F}getPointOnPath(e){var t=this.getPathLength(),r=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:o}=this;for(var c of o){if(c&&(c.pathLength<5e-5||r+c.pathLength+5e-5<e)){r+=c.pathLength;continue}var s=e-r,m=0;switch(c.type){case Yr.LINE_TO:n=this.getPointOnLine(s,c.start.x,c.start.y,c.points[0],c.points[1],c.start.x,c.start.y);break;case Yr.ARC:{var x=c.points[4],I=c.points[5],F=c.points[4]+I;if(m=x+s/c.pathLength*I,I<0&&m<F||I>=0&&m>F)break;n=this.getPointOnEllipticalArc(c.points[0],c.points[1],c.points[2],c.points[3],m,c.points[6]);break}case Yr.CURVE_TO:m=s/c.pathLength,m>1&&(m=1),n=this.getPointOnCubicBezier(m,c.start.x,c.start.y,c.points[0],c.points[1],c.points[2],c.points[3],c.points[4],c.points[5]);break;case Yr.QUAD_TO:m=s/c.pathLength,m>1&&(m=1),n=this.getPointOnQuadraticBezier(m,c.start.x,c.start.y,c.points[0],c.points[1],c.points[2],c.points[3]);break}if(n)return n;break}return null}getLineLength(e,t,r,n){return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,r,n,o,c,s,m,x){var I=m*iT(e)+c*rT(e)+n*nT(e)+t*sT(e),F=x*iT(e)+s*rT(e)+o*nT(e)+r*sT(e);return{x:I,y:F}}getPointOnQuadraticBezier(e,t,r,n,o,c,s){var m=c*oT(e)+n*aT(e)+t*lT(e),x=s*oT(e)+o*aT(e)+r*lT(e);return{x:m,y:x}}getPointOnEllipticalArc(e,t,r,n,o,c){var s=Math.cos(c),m=Math.sin(c),x={x:r*Math.cos(o),y:n*Math.sin(o)};return{x:e+(x.x*s-x.y*m),y:t+(x.x*m+x.y*s)}}buildEquidistantCache(e,t){var r=this.getPathLength(),n=t||.25,o=e||r/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var c=0,s=0;s<=r;s+=n){var m=this.getPointOnPath(s),x=this.getPointOnPath(s+n);!m||!x||(c+=this.getLineLength(m.x,m.y,x.x,x.y),c>=o&&(this.equidistantCache.points.push({x:m.x,y:m.y,distance:s}),c-=o))}}}getEquidistantPointOnPath(e,t,r){if(this.buildEquidistantCache(t,r),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}var J_e=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class $6 extends bd{constructor(e,t,r){super(e,t,r),this.type="image",this.loaded=!1;var n=this.getHrefAttribute().getString();if(n){var o=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);e.images.push(this),o?this.loadSvg(n):this.loadImage(n),this.isSvg=o}}loadImage(e){var t=this;return TA(function*(){try{var r=yield t.document.createImage(e);t.image=r}catch(n){console.error('Error while loading image "'.concat(e,'":'),n)}t.loaded=!0})()}loadSvg(e){var t=this;return TA(function*(){var r=J_e.exec(e);if(r){var n=r[5];r[4]==="base64"?t.image=atob(n):t.image=decodeURIComponent(n)}else try{var o=yield t.document.fetch(e),c=yield o.text();t.image=c}catch(s){console.error('Error while loading image "'.concat(e,'":'),s)}t.loaded=!0})()}renderChildren(e){var{document:t,image:r,loaded:n}=this,o=this.getAttribute("x").getPixels("x"),c=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),m=this.getStyle("height").getPixels("y");if(!(!n||!r||!s||!m)){if(e.save(),e.translate(o,c),this.isSvg){var x=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:s,scaleHeight:m});x.document.documentElement.parent=this,x.render()}else{var I=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:s,desiredWidth:I.width,height:m,desiredHeight:I.height}),this.loaded&&(typeof I.complete>"u"||I.complete)&&e.drawImage(I,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new Tu(e,t,e+r,t+n)}}class K6 extends bd{constructor(){super(...arguments),this.type="symbol"}render(e){}}class W6{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var r=this;return TA(function*(){try{var{document:n}=r,o=yield n.canvg.parser.load(t),c=o.getElementsByTagName("font");Array.from(c).forEach(s=>{var m=n.createElement(s);n.definitions[e]=m})}catch(s){console.error('Error while loading font "'.concat(t,'":'),s)}r.loaded=!0})()}}class pT extends Vs{constructor(e,t,r){super(e,t,r),this.type="style";var n=Mf(Array.from(t.childNodes).map(c=>c.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),o=n.split("}");o.forEach(c=>{var s=c.trim();if(s){var m=s.split("{"),x=m[0].split(","),I=m[1].split(";");x.forEach(F=>{var O=F.trim();if(O){var z=e.styles[O]||{};if(I.forEach(ue=>{var ce=ue.indexOf(":"),de=ue.substr(0,ce).trim(),be=ue.substr(ce+1,ue.length-ce).trim();de&&be&&(z[de]=new wr(e,de,be))}),e.styles[O]=z,e.stylesSpecificity[O]=m6(O),O==="@font-face"){var ie=z["font-family"].getString().replace(/"|'/g,""),ne=z.src.getString().split(",");ne.forEach(ue=>{if(ue.indexOf('format("svg")')>0){var ce=YS(ue);ce&&new W6(e).load(ie,ce)}})}}})}})}}pT.parseExternalUrl=YS;class X6 extends bd{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),r=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),r.hasValue()&&e.translate(0,r.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:r}=this;if(r){var n=r;if(r.type==="symbol"&&(n=new Gg(t,null),n.attributes.viewBox=new wr(t,"viewBox",r.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new wr(t,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new wr(t,"overflow",r.getAttribute("overflow").getString()),n.children=r.children,r.styles.opacity=new wr(t,"opacity",this.calculateOpacity())),n.type==="svg"){var o=this.getStyle("width",!1,!0),c=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new wr(t,"width",o.getString())),c.hasValue()&&(n.attributes.height=new wr(t,"height",c.getString()))}var s=n.parent;n.parent=this,n.render(e),n.parent=s}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return vd.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function xb(i,e,t,r,n,o){return i[t*r*4+e*4+o]}function wb(i,e,t,r,n,o,c){i[t*r*4+e*4+o]=c}function la(i,e,t){var r=i[e];return r*t}function PA(i,e,t,r){return e+Math.cos(i)*t+Math.sin(i)*r}class gT extends Vs{constructor(e,t,r){super(e,t,r),this.type="feColorMatrix";var n=Tc(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var c=n[0]*Math.PI/180;n=[PA(c,.213,.787,-.213),PA(c,.715,-.715,-.715),PA(c,.072,-.072,.928),0,0,PA(c,.213,-.213,.143),PA(c,.715,.285,.14),PA(c,.072,-.072,-.283),0,0,PA(c,.213,-.213,-.787),PA(c,.715,-.715,.715),PA(c,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,r,n,o){for(var{includeOpacity:c,matrix:s}=this,m=e.getImageData(0,0,n,o),x=0;x<o;x++)for(var I=0;I<n;I++){var F=xb(m.data,I,x,n,o,0),O=xb(m.data,I,x,n,o,1),z=xb(m.data,I,x,n,o,2),ie=xb(m.data,I,x,n,o,3),ne=la(s,0,F)+la(s,1,O)+la(s,2,z)+la(s,3,ie)+la(s,4,1),ue=la(s,5,F)+la(s,6,O)+la(s,7,z)+la(s,8,ie)+la(s,9,1),ce=la(s,10,F)+la(s,11,O)+la(s,12,z)+la(s,13,ie)+la(s,14,1),de=la(s,15,F)+la(s,16,O)+la(s,17,z)+la(s,18,ie)+la(s,19,1);c&&(ne=0,ue=0,ce=0,de*=ie/255),wb(m.data,I,x,n,o,0,ne),wb(m.data,I,x,n,o,1,ue),wb(m.data,I,x,n,o,2,ce),wb(m.data,I,x,n,o,3,de)}e.clearRect(0,0,n,o),e.putImageData(m,0,0)}}class l0 extends Vs{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:r}=this,n=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),c=this.getStyle("width").getPixels("x"),s=this.getStyle("height").getPixels("y");if(!c&&!s){var m=new Tu;this.children.forEach(ie=>{m.addBoundingBox(ie.getBoundingBox(e))}),n=Math.floor(m.x1),o=Math.floor(m.y1),c=Math.floor(m.width),s=Math.floor(m.height)}var x=this.removeStyles(t,l0.ignoreStyles),I=r.createCanvas(n+c,o+s),F=I.getContext("2d");r.screen.setDefaults(F),this.renderChildren(F),new gT(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(F,0,0,n+c,o+s);var O=r.createCanvas(n+c,o+s),z=O.getContext("2d");r.screen.setDefaults(z),t.render(z),z.globalCompositeOperation="destination-in",z.fillStyle=F.createPattern(I,"no-repeat"),z.fillRect(0,0,n+c,o+s),e.fillStyle=z.createPattern(O,"no-repeat"),e.fillRect(0,0,n+c,o+s),this.restoreStyles(t,x)}render(e){}}l0.ignoreStyles=["mask","transform","clip-path"];var Z6=()=>{};class J6 extends Vs{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,r=Reflect.getPrototypeOf(e),{beginPath:n,closePath:o}=e;r&&(r.beginPath=Z6,r.closePath=Z6),Reflect.apply(n,e,[]),this.children.forEach(c=>{if(!(typeof c.path>"u")){var s=typeof c.elementTransform<"u"?c.elementTransform():null;s||(s=vd.fromElement(t,c)),s&&s.apply(e),c.path(e),r&&(r.closePath=o),s&&s.unapply(e)}}),Reflect.apply(o,e,[]),e.clip(),r&&(r.beginPath=n,r.closePath=o)}render(e){}}class c0 extends Vs{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:r,children:n}=this,o=t.getBoundingBox(e);if(o){var c=0,s=0;n.forEach(ce=>{var de=ce.extraFilterDistance||0;c=Math.max(c,de),s=Math.max(s,de)});var m=Math.floor(o.width),x=Math.floor(o.height),I=m+2*c,F=x+2*s;if(!(I<1||F<1)){var O=Math.floor(o.x),z=Math.floor(o.y),ie=this.removeStyles(t,c0.ignoreStyles),ne=r.createCanvas(I,F),ue=ne.getContext("2d");r.screen.setDefaults(ue),ue.translate(-O+c,-z+s),t.render(ue),n.forEach(ce=>{typeof ce.apply=="function"&&ce.apply(ue,0,0,I,F)}),e.drawImage(ne,0,0,I,F,O-c,z-s,I,F),this.restoreStyles(t,ie)}}}render(e){}}c0.ignoreStyles=["filter","transform","clip-path"];class Y6 extends Vs{constructor(e,t,r){super(e,t,r),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,r,n,o){}}class eN extends Vs{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,r,n,o){}}class tN extends Vs{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,r,n,o){}}class iN extends Vs{constructor(e,t,r){super(e,t,r),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,r,n,o){var{document:c,blurRadius:s}=this,m=c.window?c.window.document.body:null,x=e.canvas;x.id=c.getUniqueId(),m&&(x.style.display="none",m.appendChild(x)),L_e(x,t,r,n,o,s),m&&m.removeChild(x)}}class rN extends Vs{constructor(){super(...arguments),this.type="title"}}class nN extends Vs{constructor(){super(...arguments),this.type="desc"}}var Y_e={svg:Gg,rect:AT,circle:T6,ellipse:I6,line:L6,polyline:dT,polygon:M6,path:ls,pattern:P6,marker:F6,defs:D6,linearGradient:R6,radialGradient:k6,stop:O6,animate:vb,animateColor:U6,animateTransform:N6,font:z6,"font-face":Q6,"missing-glyph":V6,glyph:hT,text:MA,tspan:a0,tref:H6,a:G6,textPath:q6,image:$6,g:_b,symbol:K6,style:pT,use:X6,mask:l0,clipPath:J6,filter:c0,feDropShadow:Y6,feMorphology:eN,feComposite:tN,feColorMatrix:gT,feGaussianBlur:iN,title:rN,desc:nN};function sN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function e1e(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sN(Object(t),!0).forEach(function(r){QS(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):sN(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function t1e(i,e){var t=document.createElement("canvas");return t.width=i,t.height=e,t}function i1e(i){return mT.apply(this,arguments)}function mT(){return mT=TA(function*(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((r,n)=>{t.onload=()=>{r(t)},t.onerror=(o,c,s,m,x)=>{n(x)},t.src=i})}),mT.apply(this,arguments)}class FA{constructor(e){var{rootEmSize:t=12,emSize:r=12,createCanvas:n=FA.createCanvas,createImage:o=FA.createImage,anonymousCrossOrigin:c}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=r,this.createCanvas=n,this.createImage=this.bindCreateImage(o,c),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(r,n)=>e(r,typeof n=="boolean"?n:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),r=FA.elementTypes[t];return typeof r<"u"?new r(this,e):new S6(this,e)}createTextNode(e){return new Z_e(this,e)}setViewBox(e){this.screen.setViewBox(e1e({document:this},e))}}FA.createCanvas=t1e,FA.createImage=i1e,FA.elementTypes=Y_e;function oN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Df(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oN(Object(t),!0).forEach(function(r){QS(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):oN(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class Rf{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new yb(r),this.screen=new o0(e,r),this.options=r;var n=new FA(this,r),o=n.createDocumentElement(t);this.document=n,this.documentElement=o}static from(e,t){var r=arguments;return TA(function*(){var n=r.length>2&&r[2]!==void 0?r[2]:{},o=new yb(n),c=yield o.parse(t);return new Rf(e,c,n)})()}static fromString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new yb(r),o=n.parseFromString(t);return new Rf(e,o,r)}fork(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Rf.from(e,t,Df(Df({},this.options),r))}forkString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Rf.fromString(e,t,Df(Df({},this.options),r))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return TA(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Df({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},r)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:r,options:n}=this;r.start(t,Df(Df({enableRedraw:!0},n),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,r)}}const r1e=Object.freeze(Object.defineProperty({__proto__:null,AElement:G6,AnimateColorElement:U6,AnimateElement:vb,AnimateTransformElement:N6,BoundingBox:Tu,CB1:iT,CB2:rT,CB3:nT,CB4:sT,Canvg:Rf,CircleElement:T6,ClipPathElement:J6,DefsElement:D6,DescElement:nN,Document:FA,Element:Vs,EllipseElement:I6,FeColorMatrixElement:gT,FeCompositeElement:tN,FeDropShadowElement:Y6,FeGaussianBlurElement:iN,FeMorphologyElement:eN,FilterElement:c0,Font:Fl,FontElement:z6,FontFaceElement:Q6,GElement:_b,GlyphElement:hT,GradientElement:fT,ImageElement:$6,LineElement:L6,LinearGradientElement:R6,MarkerElement:F6,MaskElement:l0,Matrix:cT,MissingGlyphElement:V6,Mouse:_6,PSEUDO_ZERO:Ff,Parser:yb,PathElement:ls,PathParser:Yr,PatternElement:P6,Point:Eo,PolygonElement:M6,PolylineElement:dT,Property:wr,QB1:oT,QB2:aT,QB3:lT,RadialGradientElement:k6,RectElement:AT,RenderedElement:bd,Rotate:w6,SVGElement:Gg,SVGFontLoader:W6,Scale:B6,Screen:o0,Skew:uT,SkewX:C6,SkewY:E6,StopElement:O6,StyleElement:pT,SymbolElement:K6,TRefElement:H6,TSpanElement:a0,TextElement:MA,TextPathElement:q6,TitleElement:rN,Transform:vd,Translate:x6,UnknownElement:S6,UseElement:X6,ViewPort:y6,compressSpaces:Mf,default:Rf,getSelectorSpecificity:m6,normalizeAttributeName:p6,normalizeColor:g6,parseExternalUrl:YS,presets:D_e,toNumbers:Tc,trimLeft:d6,trimRight:f6,vectorMagnitude:eT,vectorsAngle:tT,vectorsRatio:mb},Symbol.toStringTag,{value:"Module"}));Sh.CompareMaps=ire,Sh.Layers=Ll,Sh.Map=Xie,Sh.Styles=dg,Sh.Terrains=I1,Object.defineProperty(Sh,Symbol.toStringTag,{value:"Module"})});
