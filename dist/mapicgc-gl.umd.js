(function(kh,Om){typeof exports=="object"&&typeof module<"u"?Om(exports):typeof define=="function"&&define.amd?define(["exports"],Om):(kh=typeof globalThis<"u"?globalThis:kh||self,Om(kh.mapicgcgl={}))})(this,function(kh){"use strict";function Om(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const o=Object.getOwnPropertyDescriptor(r,n);o&&Object.defineProperty(i,n,o.get?o:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var cf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Um(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var zI={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(cf,function(){var t={},r={};function n(l,s,g){if(r[l]=g,l==="index"){var b="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(t,S),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),t}}n("shared",["exports"],function(l){function s(p,u,m,C){return new(m||(m=Promise))(function(P,Q){function V(Ae){try{ne(C.next(Ae))}catch(h){Q(h)}}function W(Ae){try{ne(C.throw(Ae))}catch(h){Q(h)}}function ne(Ae){var h;Ae.done?P(Ae.value):(h=Ae.value,h instanceof m?h:new m(function(c){c(h)})).then(V,W)}ne((C=C.apply(p,u||[])).next())})}function g(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}typeof SuppressedError=="function"&&SuppressedError;var b=S;function S(p,u){this.x=p,this.y=u}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,u){return this.clone()._rotateAround(p,u)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var u=p.x-this.x,m=p.y-this.y;return u*u+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,u){return Math.atan2(this.x*u-this.y*p,this.x*p+this.y*u)},_matMult:function(p){var u=p[2]*this.x+p[3]*this.y;return this.x=p[0]*this.x+p[1]*this.y,this.y=u,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var u=Math.cos(p),m=Math.sin(p),C=m*this.x+u*this.y;return this.x=u*this.x-m*this.y,this.y=C,this},_rotateAround:function(p,u){var m=Math.cos(p),C=Math.sin(p),P=u.y+C*(this.x-u.x)+m*(this.y-u.y);return this.x=u.x+m*(this.x-u.x)-C*(this.y-u.y),this.y=P,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(p){return p instanceof S?p:Array.isArray(p)?new S(p[0],p[1]):p};var F=g(b),D=N;function N(p,u,m,C){this.cx=3*p,this.bx=3*(m-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=m,this.p2y=C}N.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var m=p,C=0;C<8;C++){var P=this.sampleCurveX(m)-p;if(Math.abs(P)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=P/Q}var V=0,W=1;for(m=p,C=0;C<20&&(P=this.sampleCurveX(m),!(Math.abs(P-p)<u));C++)p>P?V=m:W=m,m=.5*(W-V)+V;return m},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var J=g(D);let te,he;function ue(){return te==null&&(te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),te}function fe(){if(he==null&&(he=!1,ue())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let C=0;C<5*5;C++){const P=4*C;u.fillStyle=`rgb(${P},${P+1},${P+2})`,u.fillRect(C%5,Math.floor(C/5),1,1)}const m=u.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&m[C]!==C){he=!0;break}}}return he||!1}function ve(p,u,m,C){const P=new J(p,u,m,C);return function(Q){return P.solve(Q)}}const Se=ve(.25,.1,.25,1);function Ge(p,u,m){return Math.min(m,Math.max(u,p))}function He(p,u,m){const C=m-u,P=((p-u)%C+C)%C+u;return P===u?m:P}function $e(p){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const P of m)for(const Q in P)p[Q]=P[Q];return p}let Ne=1;function at(p,u,m){const C={};for(const P in p)C[P]=u.call(m||this,p[P],P,p);return C}function rt(p,u,m){const C={};for(const P in p)u.call(m||this,p[P],P,p)&&(C[P]=p[P]);return C}function Re(p){return Array.isArray(p)?p.map(Re):typeof p=="object"&&p?at(p,Re):p}const Pe={};function Je(p){Pe[p]||(typeof console<"u"&&console.warn(p),Pe[p]=!0)}function Xe(p,u,m){return(m.y-p.y)*(u.x-p.x)>(u.y-p.y)*(m.x-p.x)}function Ct(p){let u=0;for(let m,C,P=0,Q=p.length,V=Q-1;P<Q;V=P++)m=p[P],C=p[V],u+=(C.x-m.x)*(m.y+C.y);return u}function Et(p){return typeof WorkerGlobalScope<"u"&&p!==void 0&&p instanceof WorkerGlobalScope}let Mt=null;function vt(p){return typeof ImageBitmap<"u"&&p instanceof ImageBitmap}const Dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pt(p,u,m,C,P){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const Q=new VideoFrame(p,{timestamp:0});try{const V=Q==null?void 0:Q.format;if(!V||!V.startsWith("BGR")&&!V.startsWith("RGB"))throw new Error(`Unrecognized format ${V}`);const W=V.startsWith("BGR"),ne=new Uint8ClampedArray(C*P*4);if(yield Q.copyTo(ne,function(Ae,h,c,f,v){const E=4*Math.max(-h,0),M=(Math.max(0,c)-c)*f*4+E,R=4*f,G=Math.max(0,h),K=Math.max(0,c);return{rect:{x:G,y:K,width:Math.min(Ae.width,h+f)-G,height:Math.min(Ae.height,c+v)-K},layout:[{offset:M,stride:R}]}}(p,u,m,C,P)),W)for(let Ae=0;Ae<ne.length;Ae+=4){const h=ne[Ae];ne[Ae]=ne[Ae+2],ne[Ae+2]=h}return ne}finally{Q.close()}})}let Xt,Te;const Ze="AbortError";function tt(){return new Error(Ze)}const dt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function pt(p){return dt.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))]}const Bt="global-dispatcher";class Ft extends Error{constructor(u,m,C,P){super(`AJAXError: ${m} (${u}): ${C}`),this.status=u,this.statusText=m,this.url=C,this.body=P}}const Lt=()=>Et(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Gt=function(p,u){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){const C=pt(p.url);if(C)return C(p,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,targetMapId:Bt},u)}if(!(/^file:/.test(m=p.url)||/^file:/.test(Lt())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,P){return s(this,void 0,void 0,function*(){const Q=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:Lt(),signal:P.signal});C.type==="json"&&Q.headers.set("Accept","application/json");const V=yield fetch(Q);if(!V.ok){const Ae=yield V.blob();throw new Ft(V.status,V.statusText,C.url,Ae)}const W=C.type==="arrayBuffer"||C.type==="image"?V.arrayBuffer():C.type==="json"?V.json():V.text(),ne=yield W;if(P.signal.aborted)throw tt();return{data:ne,cacheControl:V.headers.get("Cache-Control"),expires:V.headers.get("Expires")}})}(p,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,mustQueue:!0,targetMapId:Bt},u)}var m;return function(C,P){return new Promise((Q,V)=>{const W=new XMLHttpRequest;W.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(W.responseType="arraybuffer");for(const ne in C.headers)W.setRequestHeader(ne,C.headers[ne]);C.type==="json"&&(W.responseType="text",W.setRequestHeader("Accept","application/json")),W.withCredentials=C.credentials==="include",W.onerror=()=>{V(new Error(W.statusText))},W.onload=()=>{if(!P.signal.aborted)if((W.status>=200&&W.status<300||W.status===0)&&W.response!==null){let ne=W.response;if(C.type==="json")try{ne=JSON.parse(W.response)}catch(Ae){return void V(Ae)}Q({data:ne,cacheControl:W.getResponseHeader("Cache-Control"),expires:W.getResponseHeader("Expires")})}else{const ne=new Blob([W.response],{type:W.getResponseHeader("Content-Type")});V(new Ft(W.status,W.statusText,C.url,ne))}},P.signal.addEventListener("abort",()=>{W.abort(),V(tt())}),W.send(C.body)})}(p,u)};function ri(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;const u=new URL(p),m=window.location;return u.protocol===m.protocol&&u.host===m.host}function mi(p,u,m){m[p]&&m[p].indexOf(u)!==-1||(m[p]=m[p]||[],m[p].push(u))}function yi(p,u,m){if(m&&m[p]){const C=m[p].indexOf(u);C!==-1&&m[p].splice(C,1)}}class Pi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$e(this,m),this.type=u}}class Ot extends Pi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",$e({error:u},m))}}class lt{on(u,m){return this._listeners=this._listeners||{},mi(u,m,this._listeners),this}off(u,m){return yi(u,m,this._listeners),yi(u,m,this._oneTimeListeners),this}once(u,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},mi(u,m,this._oneTimeListeners),this):new Promise(C=>this.once(u,C))}fire(u,m){typeof u=="string"&&(u=new Pi(u,m||{}));const C=u.type;if(this.listens(C)){u.target=this;const P=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const W of P)W.call(this,u);const Q=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const W of Q)yi(C,W,this._oneTimeListeners),W.call(this,u);const V=this._eventedParent;V&&($e(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(u))}else u instanceof Ot&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,m){return this._eventedParent=u,this._eventedParentData=m,this}}var wt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ki=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ti(p,u){const m={};for(const C in p)C!=="ref"&&(m[C]=p[C]);return ki.forEach(C=>{C in u&&(m[C]=u[C])}),m}function ht(p,u){if(Array.isArray(p)){if(!Array.isArray(u)||p.length!==u.length)return!1;for(let m=0;m<p.length;m++)if(!ht(p[m],u[m]))return!1;return!0}if(typeof p=="object"&&p!==null&&u!==null){if(typeof u!="object"||Object.keys(p).length!==Object.keys(u).length)return!1;for(const m in p)if(!ht(p[m],u[m]))return!1;return!0}return p===u}function qt(p,u){p.push(u)}function si(p,u,m){qt(m,{command:"addSource",args:[p,u[p]]})}function fi(p,u,m){qt(u,{command:"removeSource",args:[p]}),m[p]=!0}function ci(p,u,m,C){fi(p,m,C),si(p,u,m)}function Wi(p,u,m){let C;for(C in p[m])if(Object.prototype.hasOwnProperty.call(p[m],C)&&C!=="data"&&!ht(p[m][C],u[m][C]))return!1;for(C in u[m])if(Object.prototype.hasOwnProperty.call(u[m],C)&&C!=="data"&&!ht(p[m][C],u[m][C]))return!1;return!0}function ir(p,u,m,C,P,Q){p=p||{},u=u||{};for(const V in p)Object.prototype.hasOwnProperty.call(p,V)&&(ht(p[V],u[V])||m.push({command:Q,args:[C,V,u[V],P]}));for(const V in u)Object.prototype.hasOwnProperty.call(u,V)&&!Object.prototype.hasOwnProperty.call(p,V)&&(ht(p[V],u[V])||m.push({command:Q,args:[C,V,u[V],P]}))}function dr(p){return p.id}function Sr(p,u){return p[u.id]=u,p}class zt{constructor(u,m,C,P){this.message=(u?`${u}: `:"")+C,P&&(this.identifier=P),m!=null&&m.__line__&&(this.line=m.__line__)}}function Yi(p){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const P of m)for(const Q in P)p[Q]=P[Q];return p}class ui extends Error{constructor(u,m){super(m),this.message=m,this.key=u}}class Kt{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[C,P]of m)this.bindings[C]=P}concat(u){return new Kt(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const Ji={kind:"null"},Vt={kind:"number"},Ci={kind:"string"},Li={kind:"boolean"},jt={kind:"color"},bi={kind:"object"},Yt={kind:"value"},yr={kind:"collator"},Tr={kind:"formatted"},Qe={kind:"padding"},Be={kind:"resolvedImage"},ae={kind:"variableAnchorOffsetCollection"};function ie(p,u){return{kind:"array",itemType:p,N:u}}function ce(p){if(p.kind==="array"){const u=ce(p.itemType);return typeof p.N=="number"?`array<${u}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${u}>`}return p.kind}const me=[Ji,Vt,Ci,Li,jt,Tr,bi,ie(Yt),Qe,Be,ae];function be(p,u){if(u.kind==="error")return null;if(p.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!be(p.itemType,u.itemType))&&(typeof p.N!="number"||p.N===u.N))return null}else{if(p.kind===u.kind)return null;if(p.kind==="value"){for(const m of me)if(!be(m,u))return null}}return`Expected ${ce(p)} but found ${ce(u)} instead.`}function Ee(p,u){return u.some(m=>m.kind===p.kind)}function xe(p,u){return u.some(m=>m==="null"?p===null:m==="array"?Array.isArray(p):m==="object"?p&&!Array.isArray(p)&&typeof p=="object":m===typeof p)}function Fe(p,u){return p.kind==="array"&&u.kind==="array"?p.itemType.kind===u.itemType.kind&&typeof p.N=="number":p.kind===u.kind}const Ue=.96422,je=.82521,nt=4/29,_t=6/29,St=3*_t*_t,ei=_t*_t*_t,$t=Math.PI/180,Wt=180/Math.PI;function oi(p){return(p%=360)<0&&(p+=360),p}function Ei(p){let[u,m,C,P]=p,Q,V;const W=Bi((.2225045*(u=Gi(u))+.7168786*(m=Gi(m))+.0606169*(C=Gi(C)))/1);u===m&&m===C?Q=V=W:(Q=Bi((.4360747*u+.3850649*m+.1430804*C)/Ue),V=Bi((.0139322*u+.0971045*m+.7141733*C)/je));const ne=116*W-16;return[ne<0?0:ne,500*(Q-W),200*(W-V),P]}function Gi(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function Bi(p){return p>ei?Math.pow(p,1/3):p/St+nt}function Ni(p){let[u,m,C,P]=p,Q=(u+16)/116,V=isNaN(m)?Q:Q+m/500,W=isNaN(C)?Q:Q-C/200;return Q=1*ii(Q),V=Ue*ii(V),W=je*ii(W),[ot(3.1338561*V-1.6168667*Q-.4906146*W),ot(-.9787684*V+1.9161415*Q+.033454*W),ot(.0719453*V-.2289914*Q+1.4052427*W),P]}function ot(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function ii(p){return p>_t?p*p*p:St*(p-nt)}function Qt(p){return parseInt(p.padEnd(2,p),16)/255}function Qi(p,u){return Ar(u?p/100:p,0,1)}function Ar(p,u,m){return Math.min(Math.max(u,p),m)}function on(p){return!p.some(Number.isNaN)}const xn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class hr{constructor(u,m,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=m,this.b=C,this.a=P,Q||(this.r*=P,this.g*=P,this.b*=P,P||this.overwriteGetter("rgb",[u,m,C,P]))}static parse(u){if(u instanceof hr)return u;if(typeof u!="string")return;const m=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const P=xn[C];if(P){const[V,W,ne]=P;return[V/255,W/255,ne/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const V=C.length<6?1:2;let W=1;return[Qt(C.slice(W,W+=V)),Qt(C.slice(W,W+=V)),Qt(C.slice(W,W+=V)),Qt(C.slice(W,W+V)||"ff")]}if(C.startsWith("rgb")){const V=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[W,ne,Ae,h,c,f,v,E,M,R,G,K]=V,Z=[h||" ",v||" ",R].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const oe=[Ae,f,M].join(""),de=oe==="%%%"?100:oe===""?255:0;if(de){const ye=[Ar(+ne/de,0,1),Ar(+c/de,0,1),Ar(+E/de,0,1),G?Qi(+G,K):1];if(on(ye))return ye}}return}}const Q=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Q){const[V,W,ne,Ae,h,c,f,v,E]=Q,M=[ne||" ",h||" ",f].join("");if(M==="  "||M==="  /"||M===",,"||M===",,,"){const R=[+W,Ar(+Ae,0,100),Ar(+c,0,100),v?Qi(+v,E):1];if(on(R))return function(G){let[K,Z,oe,de]=G;function ye(Ce){const Ie=(Ce+K/30)%12,Oe=Z*Math.min(oe,1-oe);return oe-Oe*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return K=oi(K),Z/=100,oe/=100,[ye(0),ye(8),ye(4),de]}(R)}}}(u);return m?new hr(...m,!1):void 0}get rgb(){const{r:u,g:m,b:C,a:P}=this,Q=P||1/0;return this.overwriteGetter("rgb",[u/Q,m/Q,C/Q,P])}get hcl(){return this.overwriteGetter("hcl",function(u){const[m,C,P,Q]=Ei(u),V=Math.sqrt(C*C+P*P);return[Math.round(1e4*V)?oi(Math.atan2(P,C)*Wt):NaN,V,m,Q]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ei(this.rgb))}overwriteGetter(u,m){return Object.defineProperty(this,u,{value:m}),m}toString(){const[u,m,C,P]=this.rgb;return`rgba(${[u,m,C].map(Q=>Math.round(255*Q)).join(",")},${P})`}}hr.black=new hr(0,0,0,1),hr.white=new hr(1,1,1,1),hr.transparent=new hr(0,0,0,0),hr.red=new hr(1,0,0,1);class mn{constructor(u,m,C){this.sensitivity=u?m?"variant":"case":m?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,m){return this.collator.compare(u,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yn{constructor(u,m,C,P,Q){this.text=u,this.image=m,this.scale=C,this.fontStack=P,this.textColor=Q}}class cr{constructor(u){this.sections=u}static fromString(u){return new cr([new yn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof cr?u:cr.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class On{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof On)return u;if(typeof u=="number")return new On([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const m of u)if(typeof m!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new On(u)}}toString(){return JSON.stringify(this.values)}}const ms=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vr{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Vr)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let m=0;m<u.length;m+=2){const C=u[m],P=u[m+1];if(typeof C!="string"||!ms.has(C)||!Array.isArray(P)||P.length!==2||typeof P[0]!="number"||typeof P[1]!="number")return}return new Vr(u)}}toString(){return JSON.stringify(this.values)}}class wn{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new wn({name:u,available:!1}):null}}function To(p,u,m,C){return typeof p=="number"&&p>=0&&p<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof m=="number"&&m>=0&&m<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[p,u,m,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[p,u,m,C]:[p,u,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hs(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof hr||p instanceof mn||p instanceof cr||p instanceof On||p instanceof Vr||p instanceof wn)return!0;if(Array.isArray(p)){for(const u of p)if(!hs(u))return!1;return!0}if(typeof p=="object"){for(const u in p)if(!hs(p[u]))return!1;return!0}return!1}function Xi(p){if(p===null)return Ji;if(typeof p=="string")return Ci;if(typeof p=="boolean")return Li;if(typeof p=="number")return Vt;if(p instanceof hr)return jt;if(p instanceof mn)return yr;if(p instanceof cr)return Tr;if(p instanceof On)return Qe;if(p instanceof Vr)return ae;if(p instanceof wn)return Be;if(Array.isArray(p)){const u=p.length;let m;for(const C of p){const P=Xi(C);if(m){if(m===P)continue;m=Yt;break}m=P}return ie(m||Yt,u)}return bi}function eo(p){const u=typeof p;return p===null?"":u==="string"||u==="number"||u==="boolean"?String(p):p instanceof hr||p instanceof cr||p instanceof On||p instanceof Vr||p instanceof wn?p.toString():JSON.stringify(p)}class Cs{constructor(u,m){this.type=u,this.value=m}static parse(u,m){if(u.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!hs(u[1]))return m.error("invalid value");const C=u[1];let P=Xi(C);const Q=m.expectedType;return P.kind!=="array"||P.N!==0||!Q||Q.kind!=="array"||typeof Q.N=="number"&&Q.N!==0||(P=Q),new Cs(P,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class fr{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const Dr={string:Ci,number:Vt,boolean:Li,object:bi};class Gn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");let C,P=1;const Q=u[0];if(Q==="array"){let W,ne;if(u.length>2){const Ae=u[1];if(typeof Ae!="string"||!(Ae in Dr)||Ae==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);W=Dr[Ae],P++}else W=Yt;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return m.error('The length argument to "array" must be a positive integer literal',2);ne=u[2],P++}C=ie(W,ne)}else{if(!Dr[Q])throw new Error(`Types doesn't contain name = ${Q}`);C=Dr[Q]}const V=[];for(;P<u.length;P++){const W=m.parse(u[P],P,Yt);if(!W)return null;V.push(W)}return new Gn(C,V)}evaluate(u){for(let m=0;m<this.args.length;m++){const C=this.args[m].evaluate(u);if(!be(this.type,Xi(C)))return C;if(m===this.args.length-1)throw new fr(`Expected value to be of type ${ce(this.type)}, but found ${ce(Xi(C))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Ur={"to-boolean":Li,"to-color":jt,"to-number":Vt,"to-string":Ci};class Sn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[0];if(!Ur[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&u.length!==2)return m.error("Expected one argument.");const P=Ur[C],Q=[];for(let V=1;V<u.length;V++){const W=m.parse(u[V],V,Yt);if(!W)return null;Q.push(W)}return new Sn(P,Q)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let m,C;for(const P of this.args){if(m=P.evaluate(u),C=null,m instanceof hr)return m;if(typeof m=="string"){const Q=u.parseColor(m);if(Q)return Q}else if(Array.isArray(m)&&(C=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:To(m[0],m[1],m[2],m[3]),!C))return new hr(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new fr(C||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const C of this.args){m=C.evaluate(u);const P=On.parse(m);if(P)return P}throw new fr(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const C of this.args){m=C.evaluate(u);const P=Vr.parse(m);if(P)return P}throw new fr(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const C of this.args){if(m=C.evaluate(u),m===null)return 0;const P=Number(m);if(!isNaN(P))return P}throw new fr(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return cr.fromString(eo(this.args[0].evaluate(u)));case"resolvedImage":return wn.fromString(eo(this.args[0].evaluate(u)));default:return eo(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const dn=["Unknown","Point","LineString","Polygon"];class Gr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let m=this._parseColorCache[u];return m||(m=this._parseColorCache[u]=hr.parse(u)),m}}class js{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],P=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Kt,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=C,this.key=C.map(W=>`[${W}]`).join(""),this.scope=Q,this.errors=V,this.expectedType=P,this._isConstant=m}parse(u,m,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return m?this.concat(m,C,P)._parse(u,Q):this._parse(u,Q)}_parse(u,m){function C(P,Q,V){return V==="assert"?new Gn(Q,[P]):V==="coerce"?new Sn(Q,[P]):P}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const P=u[0];if(typeof P!="string")return this.error(`Expression name must be a string, but found ${typeof P} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[P];if(Q){let V=Q.parse(u,this);if(!V)return null;if(this.expectedType){const W=this.expectedType,ne=V.type;if(W.kind!=="string"&&W.kind!=="number"&&W.kind!=="boolean"&&W.kind!=="object"&&W.kind!=="array"||ne.kind!=="value")if(W.kind!=="color"&&W.kind!=="formatted"&&W.kind!=="resolvedImage"||ne.kind!=="value"&&ne.kind!=="string")if(W.kind!=="padding"||ne.kind!=="value"&&ne.kind!=="number"&&ne.kind!=="array")if(W.kind!=="variableAnchorOffsetCollection"||ne.kind!=="value"&&ne.kind!=="array"){if(this.checkSubtype(W,ne))return null}else V=C(V,W,m.typeAnnotation||"coerce");else V=C(V,W,m.typeAnnotation||"coerce");else V=C(V,W,m.typeAnnotation||"coerce");else V=C(V,W,m.typeAnnotation||"assert")}if(!(V instanceof Cs)&&V.type.kind!=="resolvedImage"&&this._isConstant(V)){const W=new Gr;try{V=new Cs(V.type,V.evaluate(W))}catch(ne){return this.error(ne.message),null}}return V}return this.error(`Unknown expression "${P}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,m,C){const P=typeof u=="number"?this.path.concat(u):this.path,Q=C?this.scope.concat(C):this.scope;return new js(this.registry,this._isConstant,P,m||null,Q,this.errors)}error(u){for(var m=arguments.length,C=new Array(m>1?m-1:0),P=1;P<m;P++)C[P-1]=arguments[P];const Q=`${this.key}${C.map(V=>`[${V}]`).join("")}`;this.errors.push(new ui(Q,u))}checkSubtype(u,m){const C=be(u,m);return C&&this.error(C),C}}class ha{constructor(u,m,C){this.type=yr,this.locale=C,this.caseSensitive=u,this.diacriticSensitive=m}static parse(u,m){if(u.length!==2)return m.error("Expected one argument.");const C=u[1];if(typeof C!="object"||Array.isArray(C))return m.error("Collator options argument must be an object.");const P=m.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Li);if(!P)return null;const Q=m.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Li);if(!Q)return null;let V=null;return C.locale&&(V=m.parse(C.locale,1,Ci),!V)?null:new ha(P,Q,V)}evaluate(u){return new mn(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}const ho=8192;function Ta(p,u){p[0]=Math.min(p[0],u[0]),p[1]=Math.min(p[1],u[1]),p[2]=Math.max(p[2],u[0]),p[3]=Math.max(p[3],u[1])}function ze(p,u){return!(p[0]<=u[0]||p[2]>=u[2]||p[1]<=u[1]||p[3]>=u[3])}function Ye(p,u){const m=(180+p[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,P=Math.pow(2,u.z);return[Math.round(m*P*ho),Math.round(C*P*ho)]}function ft(p,u,m){const C=p[0]-u[0],P=p[1]-u[1],Q=p[0]-m[0],V=p[1]-m[1];return C*V-Q*P==0&&C*Q<=0&&P*V<=0}function Ut(p,u){let m=!1;for(let V=0,W=u.length;V<W;V++){const ne=u[V];for(let Ae=0,h=ne.length;Ae<h-1;Ae++){if(ft(p,ne[Ae],ne[Ae+1]))return!1;(P=ne[Ae])[1]>(C=p)[1]!=(Q=ne[Ae+1])[1]>C[1]&&C[0]<(Q[0]-P[0])*(C[1]-P[1])/(Q[1]-P[1])+P[0]&&(m=!m)}}var C,P,Q;return m}function hi(p,u){for(let m=0;m<u.length;m++)if(Ut(p,u[m]))return!0;return!1}function ji(p,u,m,C){const P=C[0]-m[0],Q=C[1]-m[1],V=(p[0]-m[0])*Q-P*(p[1]-m[1]),W=(u[0]-m[0])*Q-P*(u[1]-m[1]);return V>0&&W<0||V<0&&W>0}function xr(p,u,m){for(const Ae of m)for(let h=0;h<Ae.length-1;++h)if((W=[(V=Ae[h+1])[0]-(Q=Ae[h])[0],V[1]-Q[1]])[0]*(ne=[(P=u)[0]-(C=p)[0],P[1]-C[1]])[1]-W[1]*ne[0]!=0&&ji(C,P,Q,V)&&ji(Q,V,C,P))return!0;var C,P,Q,V,W,ne;return!1}function Tn(p,u){for(let m=0;m<p.length;++m)if(!Ut(p[m],u))return!1;for(let m=0;m<p.length-1;++m)if(xr(p[m],p[m+1],u))return!1;return!0}function Un(p,u){for(let m=0;m<u.length;m++)if(Tn(p,u[m]))return!0;return!1}function ns(p,u,m){const C=[];for(let P=0;P<p.length;P++){const Q=[];for(let V=0;V<p[P].length;V++){const W=Ye(p[P][V],m);Ta(u,W),Q.push(W)}C.push(Q)}return C}function Bn(p,u,m){const C=[];for(let P=0;P<p.length;P++){const Q=ns(p[P],u,m);C.push(Q)}return C}function lu(p,u,m,C){if(p[0]<m[0]||p[0]>m[2]){const P=.5*C;let Q=p[0]-m[0]>P?-C:m[0]-p[0]>P?C:0;Q===0&&(Q=p[0]-m[2]>P?-C:m[2]-p[0]>P?C:0),p[0]+=Q}Ta(u,p)}function Ka(p,u,m,C){const P=Math.pow(2,C.z)*ho,Q=[C.x*ho,C.y*ho],V=[];for(const W of p)for(const ne of W){const Ae=[ne.x+Q[0],ne.y+Q[1]];lu(Ae,u,m,P),V.push(Ae)}return V}function Ir(p,u,m,C){const P=Math.pow(2,C.z)*ho,Q=[C.x*ho,C.y*ho],V=[];for(const ne of p){const Ae=[];for(const h of ne){const c=[h.x+Q[0],h.y+Q[1]];Ta(u,c),Ae.push(c)}V.push(Ae)}if(u[2]-u[0]<=P/2){(W=u)[0]=W[1]=1/0,W[2]=W[3]=-1/0;for(const ne of V)for(const Ae of ne)lu(Ae,u,m,P)}var W;return V}class Wa{constructor(u,m){this.type=Li,this.geojson=u,this.geometries=m}static parse(u,m){if(u.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(hs(u[1])){const C=u[1];if(C.type==="FeatureCollection"){const P=[];for(const Q of C.features){const{type:V,coordinates:W}=Q.geometry;V==="Polygon"&&P.push(W),V==="MultiPolygon"&&P.push(...W)}if(P.length)return new Wa(C,{type:"MultiPolygon",coordinates:P})}else if(C.type==="Feature"){const P=C.geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new Wa(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Wa(C,C)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(m,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(C.type==="Polygon"){const W=ns(C.coordinates,Q,V),ne=Ka(m.geometry(),P,Q,V);if(!ze(P,Q))return!1;for(const Ae of ne)if(!Ut(Ae,W))return!1}if(C.type==="MultiPolygon"){const W=Bn(C.coordinates,Q,V),ne=Ka(m.geometry(),P,Q,V);if(!ze(P,Q))return!1;for(const Ae of ne)if(!hi(Ae,W))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(m,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(C.type==="Polygon"){const W=ns(C.coordinates,Q,V),ne=Ir(m.geometry(),P,Q,V);if(!ze(P,Q))return!1;for(const Ae of ne)if(!Tn(Ae,W))return!1}if(C.type==="MultiPolygon"){const W=Bn(C.coordinates,Q,V),ne=Ir(m.geometry(),P,Q,V);if(!ze(P,Q))return!1;for(const Ae of ne)if(!Un(Ae,W))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Nl{constructor(u,m){this.type=m.type,this.name=u,this.boundExpression=m}static parse(u,m){if(u.length!==2||typeof u[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const C=u[1];return m.scope.has(C)?new Nl(C,m.scope.get(C)):m.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class es{constructor(u,m,C,P){this.name=u,this.type=m,this._evaluate=C,this.args=P}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,m){const C=u[0],P=es.definitions[C];if(!P)return m.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(P)?P[0]:P.type,V=Array.isArray(P)?[[P[1],P[2]]]:P.overloads,W=V.filter(Ae=>{let[h]=Ae;return!Array.isArray(h)||h.length===u.length-1});let ne=null;for(const[Ae,h]of W){ne=new js(m.registry,Io,m.path,null,m.scope);const c=[];let f=!1;for(let v=1;v<u.length;v++){const E=u[v],M=Array.isArray(Ae)?Ae[v-1]:Ae.type,R=ne.parse(E,1+c.length,M);if(!R){f=!0;break}c.push(R)}if(!f)if(Array.isArray(Ae)&&Ae.length!==c.length)ne.error(`Expected ${Ae.length} arguments, but found ${c.length} instead.`);else{for(let v=0;v<c.length;v++){const E=Array.isArray(Ae)?Ae[v]:Ae.type,M=c[v];ne.concat(v+1).checkSubtype(E,M.type)}if(ne.errors.length===0)return new es(C,Q,h,c)}}if(W.length===1)m.errors.push(...ne.errors);else{const Ae=(W.length?W:V).map(c=>{let[f]=c;return v=f,Array.isArray(v)?`(${v.map(ce).join(", ")})`:`(${ce(v.type)}...)`;var v}).join(" | "),h=[];for(let c=1;c<u.length;c++){const f=m.parse(u[c],1+h.length);if(!f)return null;h.push(ce(f.type))}m.error(`Expected arguments of type ${Ae}, but found (${h.join(", ")}) instead.`)}return null}static register(u,m){es.definitions=m;for(const C in m)u[C]=es}}function Io(p){if(p instanceof Nl)return Io(p.boundExpression);if(p instanceof es&&p.name==="error"||p instanceof ha||p instanceof Wa)return!1;const u=p instanceof Sn||p instanceof Gn;let m=!0;return p.eachChild(C=>{m=u?m&&Io(C):m&&C instanceof Cs}),!!m&&Xa(p)&&Aa(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xa(p){if(p instanceof es&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof Wa)return!1;let u=!0;return p.eachChild(m=>{u&&!Xa(m)&&(u=!1)}),u}function ys(p){if(p instanceof es&&p.name==="feature-state")return!1;let u=!0;return p.eachChild(m=>{u&&!ys(m)&&(u=!1)}),u}function Aa(p,u){if(p instanceof es&&u.indexOf(p.name)>=0)return!1;let m=!0;return p.eachChild(C=>{m&&!Aa(C,u)&&(m=!1)}),m}function Za(p,u){const m=p.length-1;let C,P,Q=0,V=m,W=0;for(;Q<=V;)if(W=Math.floor((Q+V)/2),C=p[W],P=p[W+1],C<=u){if(W===m||u<P)return W;Q=W+1}else{if(!(C>u))throw new fr("Input is not a number.");V=W-1}return 0}class Ia{constructor(u,m,C){this.type=u,this.input=m,this.labels=[],this.outputs=[];for(const[P,Q]of C)this.labels.push(P),this.outputs.push(Q)}static parse(u,m){if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");const C=m.parse(u[1],1,Vt);if(!C)return null;const P=[];let Q=null;m.expectedType&&m.expectedType.kind!=="value"&&(Q=m.expectedType);for(let V=1;V<u.length;V+=2){const W=V===1?-1/0:u[V],ne=u[V+1],Ae=V,h=V+1;if(typeof W!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ae);if(P.length&&P[P.length-1][0]>=W)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ae);const c=m.parse(ne,h,Q);if(!c)return null;Q=Q||c.type,P.push([W,c])}return new Ia(Q,C,P)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=m[0])return C[0].evaluate(u);const Q=m.length;return P>=m[Q-1]?C[Q-1].evaluate(u):C[Za(m,P)].evaluate(u)}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Dc(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var Ja=Ao;function Ao(p,u,m,C){this.cx=3*p,this.bx=3*(m-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=m,this.p2y=C}Ao.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var m=p,C=0;C<8;C++){var P=this.sampleCurveX(m)-p;if(Math.abs(P)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=P/Q}var V=0,W=1;for(m=p,C=0;C<20&&(P=this.sampleCurveX(m),!(Math.abs(P-p)<u));C++)p>P?V=m:W=m,m=.5*(W-V)+V;return m},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var Fr=Dc(Ja);function da(p,u,m){return p+m*(u-p)}function As(p,u,m){return p.map((C,P)=>da(C,u[P],m))}const fn={number:da,color:function(p,u,m){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[P,Q,V,W]=As(p.rgb,u.rgb,m);return new hr(P,Q,V,W,!1)}case"hcl":{const[P,Q,V,W]=p.hcl,[ne,Ae,h,c]=u.hcl;let f,v;if(isNaN(P)||isNaN(ne))isNaN(P)?isNaN(ne)?f=NaN:(f=ne,V!==1&&V!==0||(v=Ae)):(f=P,h!==1&&h!==0||(v=Q));else{let K=ne-P;ne>P&&K>180?K-=360:ne<P&&P-ne>180&&(K+=360),f=P+m*K}const[E,M,R,G]=function(K){let[Z,oe,de,ye]=K;return Z=isNaN(Z)?0:Z*$t,Ni([de,Math.cos(Z)*oe,Math.sin(Z)*oe,ye])}([f,v??da(Q,Ae,m),da(V,h,m),da(W,c,m)]);return new hr(E,M,R,G,!1)}case"lab":{const[P,Q,V,W]=Ni(As(p.lab,u.lab,m));return new hr(P,Q,V,W,!1)}}},array:As,padding:function(p,u,m){return new On(As(p.values,u.values,m))},variableAnchorOffsetCollection:function(p,u,m){const C=p.values,P=u.values;if(C.length!==P.length)throw new fr(`Cannot interpolate values of different length. from: ${p.toString()}, to: ${u.toString()}`);const Q=[];for(let V=0;V<C.length;V+=2){if(C[V]!==P[V])throw new fr(`Cannot interpolate values containing mismatched anchors. from[${V}]: ${C[V]}, to[${V}]: ${P[V]}`);Q.push(C[V]);const[W,ne]=C[V+1],[Ae,h]=P[V+1];Q.push([da(W,Ae,m),da(ne,h,m)])}return new Vr(Q)}};class ss{constructor(u,m,C,P,Q){this.type=u,this.operator=m,this.interpolation=C,this.input=P,this.labels=[],this.outputs=[];for(const[V,W]of Q)this.labels.push(V),this.outputs.push(W)}static interpolationFactor(u,m,C,P){let Q=0;if(u.name==="exponential")Q=Hr(m,u.base,C,P);else if(u.name==="linear")Q=Hr(m,1,C,P);else if(u.name==="cubic-bezier"){const V=u.controlPoints;Q=new Fr(V[0],V[1],V[2],V[3]).solve(Hr(m,1,C,P))}return Q}static parse(u,m){let[C,P,Q,...V]=u;if(!Array.isArray(P)||P.length===0)return m.error("Expected an interpolation type expression.",1);if(P[0]==="linear")P={name:"linear"};else if(P[0]==="exponential"){const Ae=P[1];if(typeof Ae!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);P={name:"exponential",base:Ae}}else{if(P[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(P[0])}`,1,0);{const Ae=P.slice(1);if(Ae.length!==4||Ae.some(h=>typeof h!="number"||h<0||h>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);P={name:"cubic-bezier",controlPoints:Ae}}}if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(Q=m.parse(Q,2,Vt),!Q)return null;const W=[];let ne=null;C==="interpolate-hcl"||C==="interpolate-lab"?ne=jt:m.expectedType&&m.expectedType.kind!=="value"&&(ne=m.expectedType);for(let Ae=0;Ae<V.length;Ae+=2){const h=V[Ae],c=V[Ae+1],f=Ae+3,v=Ae+4;if(typeof h!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(W.length&&W[W.length-1][0]>=h)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const E=m.parse(c,v,ne);if(!E)return null;ne=ne||E.type,W.push([h,E])}return Fe(ne,Vt)||Fe(ne,jt)||Fe(ne,Qe)||Fe(ne,ae)||Fe(ne,ie(Vt))?new ss(ne,C,P,Q,W):m.error(`Type ${ce(ne)} is not interpolatable.`)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=m[0])return C[0].evaluate(u);const Q=m.length;if(P>=m[Q-1])return C[Q-1].evaluate(u);const V=Za(m,P),W=ss.interpolationFactor(this.interpolation,P,m[V],m[V+1]),ne=C[V].evaluate(u),Ae=C[V+1].evaluate(u);switch(this.operator){case"interpolate":return fn[this.type.kind](ne,Ae,W);case"interpolate-hcl":return fn.color(ne,Ae,W,"hcl");case"interpolate-lab":return fn.color(ne,Ae,W,"lab")}}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Hr(p,u,m,C){const P=C-m,Q=p-m;return P===0?0:u===1?Q/P:(Math.pow(u,Q)-1)/(Math.pow(u,P)-1)}class Ya{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expectected at least one argument.");let C=null;const P=m.expectedType;P&&P.kind!=="value"&&(C=P);const Q=[];for(const W of u.slice(1)){const ne=m.parse(W,1+Q.length,C,void 0,{typeAnnotation:"omit"});if(!ne)return null;C=C||ne.type,Q.push(ne)}if(!C)throw new Error("No output type");const V=P&&Q.some(W=>be(P,W.type));return new Ya(V?Yt:C,Q)}evaluate(u){let m,C=null,P=0;for(const Q of this.args)if(P++,C=Q.evaluate(u),C&&C instanceof wn&&!C.available&&(m||(m=C.name),C=null,P===this.args.length&&(C=m)),C!==null)break;return C}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class ul{constructor(u,m){this.type=m.type,this.bindings=[].concat(u),this.result=m}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const m of this.bindings)u(m[1]);u(this.result)}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const C=[];for(let Q=1;Q<u.length-1;Q+=2){const V=u[Q];if(typeof V!="string")return m.error(`Expected string, but found ${typeof V} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(V))return m.error("Variable names must contain only alphanumeric characters or '_'.",Q);const W=m.parse(u[Q+1],Q+1);if(!W)return null;C.push([V,W])}const P=m.parse(u[u.length-1],u.length-1,m.expectedType,C);return P?new ul(C,P):null}outputDefined(){return this.result.outputDefined()}}class zl{constructor(u,m,C){this.type=u,this.index=m,this.input=C}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Vt),P=m.parse(u[2],2,ie(m.expectedType||Yt));return C&&P?new zl(P.type.itemType,C,P):null}evaluate(u){const m=this.index.evaluate(u),C=this.input.evaluate(u);if(m<0)throw new fr(`Array index out of bounds: ${m} < 0.`);if(m>=C.length)throw new fr(`Array index out of bounds: ${m} > ${C.length-1}.`);if(m!==Math.floor(m))throw new fr(`Array index must be an integer, but found ${m} instead.`);return C[m]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Lo{constructor(u,m){this.type=Li,this.needle=u,this.haystack=m}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Yt),P=m.parse(u[2],2,Yt);return C&&P?Ee(C.type,[Li,Ci,Vt,Ji,Yt])?new Lo(C,P):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(C.type)} instead`):null}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!C)return!1;if(!xe(m,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${ce(Xi(m))} instead.`);if(!xe(C,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${ce(Xi(C))} instead.`);return C.indexOf(m)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class Xo{constructor(u,m,C){this.type=Vt,this.needle=u,this.haystack=m,this.fromIndex=C}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Yt),P=m.parse(u[2],2,Yt);if(!C||!P)return null;if(!Ee(C.type,[Li,Ci,Vt,Ji,Yt]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Vt);return Q?new Xo(C,P,Q):null}return new Xo(C,P)}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!xe(m,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${ce(Xi(m))} instead.`);if(!xe(C,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${ce(Xi(C))} instead.`);if(this.fromIndex){const P=this.fromIndex.evaluate(u);return C.indexOf(m,P)}return C.indexOf(m)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class fc{constructor(u,m,C,P,Q,V){this.inputType=u,this.type=m,this.input=C,this.cases=P,this.outputs=Q,this.otherwise=V}static parse(u,m){if(u.length<5)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return m.error("Expected an even number of arguments.");let C,P;m.expectedType&&m.expectedType.kind!=="value"&&(P=m.expectedType);const Q={},V=[];for(let Ae=2;Ae<u.length-1;Ae+=2){let h=u[Ae];const c=u[Ae+1];Array.isArray(h)||(h=[h]);const f=m.concat(Ae);if(h.length===0)return f.error("Expected at least one branch label.");for(const E of h){if(typeof E!="number"&&typeof E!="string")return f.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return f.error("Numeric branch labels must be integer values.");if(C){if(f.checkSubtype(C,Xi(E)))return null}else C=Xi(E);if(Q[String(E)]!==void 0)return f.error("Branch labels must be unique.");Q[String(E)]=V.length}const v=m.parse(c,Ae,P);if(!v)return null;P=P||v.type,V.push(v)}const W=m.parse(u[1],1,Yt);if(!W)return null;const ne=m.parse(u[u.length-1],u.length-1,P);return ne?W.type.kind!=="value"&&m.concat(1).checkSubtype(C,W.type)?null:new fc(C,P,W,Q,V,ne):null}evaluate(u){const m=this.input.evaluate(u);return(Xi(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Zo{constructor(u,m,C){this.type=u,this.branches=m,this.otherwise=C}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return m.error("Expected an odd number of arguments.");let C;m.expectedType&&m.expectedType.kind!=="value"&&(C=m.expectedType);const P=[];for(let V=1;V<u.length-1;V+=2){const W=m.parse(u[V],V,Li);if(!W)return null;const ne=m.parse(u[V+1],V+1,C);if(!ne)return null;P.push([W,ne]),C=C||ne.type}const Q=m.parse(u[u.length-1],u.length-1,C);if(!Q)return null;if(!C)throw new Error("Can't infer output type");return new Zo(C,P,Q)}evaluate(u){for(const[m,C]of this.branches)if(m.evaluate(u))return C.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[m,C]of this.branches)u(m),u(C);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[m,C]=u;return C.outputDefined()})&&this.otherwise.outputDefined()}}class fo{constructor(u,m,C,P){this.type=u,this.input=m,this.beginIndex=C,this.endIndex=P}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Yt),P=m.parse(u[2],2,Vt);if(!C||!P)return null;if(!Ee(C.type,[ie(Yt),Ci,Yt]))return m.error(`Expected first argument to be of type array or string, but found ${ce(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Vt);return Q?new fo(C.type,C,P,Q):null}return new fo(C.type,C,P)}evaluate(u){const m=this.input.evaluate(u),C=this.beginIndex.evaluate(u);if(!xe(m,["string","array"]))throw new fr(`Expected first argument to be of type array or string, but found ${ce(Xi(m))} instead.`);if(this.endIndex){const P=this.endIndex.evaluate(u);return m.slice(C,P)}return m.slice(C)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function pc(p,u){return p==="=="||p==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Jo(p,u,m,C){return C.compare(u,m)===0}function Ql(p,u,m){const C=p!=="=="&&p!=="!=";return class p8{constructor(Q,V,W){this.type=Li,this.lhs=Q,this.rhs=V,this.collator=W,this.hasUntypedArgument=Q.type.kind==="value"||V.type.kind==="value"}static parse(Q,V){if(Q.length!==3&&Q.length!==4)return V.error("Expected two or three arguments.");const W=Q[0];let ne=V.parse(Q[1],1,Yt);if(!ne)return null;if(!pc(W,ne.type))return V.concat(1).error(`"${W}" comparisons are not supported for type '${ce(ne.type)}'.`);let Ae=V.parse(Q[2],2,Yt);if(!Ae)return null;if(!pc(W,Ae.type))return V.concat(2).error(`"${W}" comparisons are not supported for type '${ce(Ae.type)}'.`);if(ne.type.kind!==Ae.type.kind&&ne.type.kind!=="value"&&Ae.type.kind!=="value")return V.error(`Cannot compare types '${ce(ne.type)}' and '${ce(Ae.type)}'.`);C&&(ne.type.kind==="value"&&Ae.type.kind!=="value"?ne=new Gn(Ae.type,[ne]):ne.type.kind!=="value"&&Ae.type.kind==="value"&&(Ae=new Gn(ne.type,[Ae])));let h=null;if(Q.length===4){if(ne.type.kind!=="string"&&Ae.type.kind!=="string"&&ne.type.kind!=="value"&&Ae.type.kind!=="value")return V.error("Cannot use collator to compare non-string types.");if(h=V.parse(Q[3],3,yr),!h)return null}return new p8(ne,Ae,h)}evaluate(Q){const V=this.lhs.evaluate(Q),W=this.rhs.evaluate(Q);if(C&&this.hasUntypedArgument){const ne=Xi(V),Ae=Xi(W);if(ne.kind!==Ae.kind||ne.kind!=="string"&&ne.kind!=="number")throw new fr(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${ne.kind}, ${Ae.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const ne=Xi(V),Ae=Xi(W);if(ne.kind!=="string"||Ae.kind!=="string")return u(Q,V,W)}return this.collator?m(Q,V,W,this.collator.evaluate(Q)):u(Q,V,W)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}}}const Rc=Ql("==",function(p,u,m){return u===m},Jo),bh=Ql("!=",function(p,u,m){return u!==m},function(p,u,m,C){return!Jo(0,u,m,C)}),cu=Ql("<",function(p,u,m){return u<m},function(p,u,m,C){return C.compare(u,m)<0}),uu=Ql(">",function(p,u,m){return u>m},function(p,u,m,C){return C.compare(u,m)>0}),ku=Ql("<=",function(p,u,m){return u<=m},function(p,u,m,C){return C.compare(u,m)<=0}),Vl=Ql(">=",function(p,u,m){return u>=m},function(p,u,m,C){return C.compare(u,m)>=0});class el{constructor(u,m,C,P,Q){this.type=Ci,this.number=u,this.locale=m,this.currency=C,this.minFractionDigits=P,this.maxFractionDigits=Q}static parse(u,m){if(u.length!==3)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Vt);if(!C)return null;const P=u[2];if(typeof P!="object"||Array.isArray(P))return m.error("NumberFormat options argument must be an object.");let Q=null;if(P.locale&&(Q=m.parse(P.locale,1,Ci),!Q))return null;let V=null;if(P.currency&&(V=m.parse(P.currency,1,Ci),!V))return null;let W=null;if(P["min-fraction-digits"]&&(W=m.parse(P["min-fraction-digits"],1,Vt),!W))return null;let ne=null;return P["max-fraction-digits"]&&(ne=m.parse(P["max-fraction-digits"],1,Vt),!ne)?null:new el(C,Q,V,W,ne)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class tl{constructor(u){this.type=Tr,this.sections=u}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[1];if(!Array.isArray(C)&&typeof C=="object")return m.error("First argument must be an image or text section.");const P=[];let Q=!1;for(let V=1;V<=u.length-1;++V){const W=u[V];if(Q&&typeof W=="object"&&!Array.isArray(W)){Q=!1;let ne=null;if(W["font-scale"]&&(ne=m.parse(W["font-scale"],1,Vt),!ne))return null;let Ae=null;if(W["text-font"]&&(Ae=m.parse(W["text-font"],1,ie(Ci)),!Ae))return null;let h=null;if(W["text-color"]&&(h=m.parse(W["text-color"],1,jt),!h))return null;const c=P[P.length-1];c.scale=ne,c.font=Ae,c.textColor=h}else{const ne=m.parse(u[V],1,Yt);if(!ne)return null;const Ae=ne.type.kind;if(Ae!=="string"&&Ae!=="value"&&Ae!=="null"&&Ae!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,P.push({content:ne,scale:null,font:null,textColor:null})}}return new tl(P)}evaluate(u){return new cr(this.sections.map(m=>{const C=m.content.evaluate(u);return Xi(C)===Be?new yn("",C,null,null,null):new yn(eo(C),null,m.scale?m.scale.evaluate(u):null,m.font?m.font.evaluate(u).join(","):null,m.textColor?m.textColor.evaluate(u):null)}))}eachChild(u){for(const m of this.sections)u(m.content),m.scale&&u(m.scale),m.font&&u(m.font),m.textColor&&u(m.textColor)}outputDefined(){return!1}}class Hl{constructor(u){this.type=Be,this.input=u}static parse(u,m){if(u.length!==2)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Ci);return C?new Hl(C):m.error("No image name provided.")}evaluate(u){const m=this.input.evaluate(u),C=wn.fromString(m);return C&&u.availableImages&&(C.available=u.availableImages.indexOf(m)>-1),C}eachChild(u){u(this.input)}outputDefined(){return!1}}class il{constructor(u){this.type=Vt,this.input=u}static parse(u,m){if(u.length!==2)return m.error(`Expected 1 argument, but found ${u.length-1} instead.`);const C=m.parse(u[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${ce(C.type)} instead.`):new il(C):null}evaluate(u){const m=this.input.evaluate(u);if(typeof m=="string"||Array.isArray(m))return m.length;throw new fr(`Expected value to be of type string or array, but found ${ce(Xi(m))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const fa={"==":Rc,"!=":bh,">":uu,"<":cu,">=":Vl,"<=":ku,array:Gn,at:zl,boolean:Gn,case:Zo,coalesce:Ya,collator:ha,format:tl,image:Hl,in:Lo,"index-of":Xo,interpolate:ss,"interpolate-hcl":ss,"interpolate-lab":ss,length:il,let:ul,literal:Cs,match:fc,number:Gn,"number-format":el,object:Gn,slice:fo,step:Ia,string:Gn,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:Nl,within:Wa};function hl(p,u){let[m,C,P,Q]=u;m=m.evaluate(p),C=C.evaluate(p),P=P.evaluate(p);const V=Q?Q.evaluate(p):1,W=To(m,C,P,V);if(W)throw new fr(W);return new hr(m/255,C/255,P/255,V,!1)}function Gl(p,u){return p in u}function to(p,u){const m=u[p];return m===void 0?null:m}function pa(p){return{type:p}}function se(p){return{result:"success",value:p}}function Le(p){return{result:"error",value:p}}function ct(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function yt(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function bt(p){return!!p.expression&&p.expression.interpolated}function It(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function gi(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function ni(p){return p}function nr(p,u){const m=u.type==="color",C=p.stops&&typeof p.stops[0][0]=="object",P=C||!(C||p.property!==void 0),Q=p.type||(bt(u)?"exponential":"interval");if(m||u.type==="padding"){const h=m?hr.parse:On.parse;(p=Yi({},p)).stops&&(p.stops=p.stops.map(c=>[c[0],h(c[1])])),p.default=h(p.default?p.default:u.default)}if(p.colorSpace&&(V=p.colorSpace)!=="rgb"&&V!=="hcl"&&V!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var V;let W,ne,Ae;if(Q==="exponential")W=sr;else if(Q==="interval")W=qr;else if(Q==="categorical"){W=Oi,ne=Object.create(null);for(const h of p.stops)ne[h[0]]=h[1];Ae=typeof p.stops[0][0]}else{if(Q!=="identity")throw new Error(`Unknown function type "${Q}"`);W=jn}if(C){const h={},c=[];for(let E=0;E<p.stops.length;E++){const M=p.stops[E],R=M[0].zoom;h[R]===void 0&&(h[R]={zoom:R,type:p.type,property:p.property,default:p.default,stops:[]},c.push(R)),h[R].stops.push([M[0].value,M[1]])}const f=[];for(const E of c)f.push([h[E].zoom,nr(h[E],u)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:ss.interpolationFactor.bind(void 0,v),zoomStops:f.map(E=>E[0]),evaluate:(E,M)=>{let{zoom:R}=E;return sr({stops:f,base:p.base},u,R).evaluate(R,M)}}}if(P){const h=Q==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:ss.interpolationFactor.bind(void 0,h),zoomStops:p.stops.map(c=>c[0]),evaluate:c=>{let{zoom:f}=c;return W(p,u,f,ne,Ae)}}}return{kind:"source",evaluate(h,c){const f=c&&c.properties?c.properties[p.property]:void 0;return f===void 0?$i(p.default,u.default):W(p,u,f,ne,Ae)}}}function $i(p,u,m){return p!==void 0?p:u!==void 0?u:m!==void 0?m:void 0}function Oi(p,u,m,C,P){return $i(typeof m===P?C[m]:void 0,p.default,u.default)}function qr(p,u,m){if(It(m)!=="number")return $i(p.default,u.default);const C=p.stops.length;if(C===1||m<=p.stops[0][0])return p.stops[0][1];if(m>=p.stops[C-1][0])return p.stops[C-1][1];const P=Za(p.stops.map(Q=>Q[0]),m);return p.stops[P][1]}function sr(p,u,m){const C=p.base!==void 0?p.base:1;if(It(m)!=="number")return $i(p.default,u.default);const P=p.stops.length;if(P===1||m<=p.stops[0][0])return p.stops[0][1];if(m>=p.stops[P-1][0])return p.stops[P-1][1];const Q=Za(p.stops.map(h=>h[0]),m),V=function(h,c,f,v){const E=v-f,M=h-f;return E===0?0:c===1?M/E:(Math.pow(c,M)-1)/(Math.pow(c,E)-1)}(m,C,p.stops[Q][0],p.stops[Q+1][0]),W=p.stops[Q][1],ne=p.stops[Q+1][1],Ae=fn[u.type]||ni;return typeof W.evaluate=="function"?{evaluate(){for(var h=arguments.length,c=new Array(h),f=0;f<h;f++)c[f]=arguments[f];const v=W.evaluate.apply(void 0,c),E=ne.evaluate.apply(void 0,c);if(v!==void 0&&E!==void 0)return Ae(v,E,V,p.colorSpace)}}:Ae(W,ne,V,p.colorSpace)}function jn(p,u,m){switch(u.type){case"color":m=hr.parse(m);break;case"formatted":m=cr.fromString(m.toString());break;case"resolvedImage":m=wn.fromString(m.toString());break;case"padding":m=On.parse(m);break;default:It(m)===u.type||u.type==="enum"&&u.values[m]||(m=void 0)}return $i(m,p.default,u.default)}es.register(fa,{error:[{kind:"error"},[Ci],(p,u)=>{let[m]=u;throw new fr(m.evaluate(p))}],typeof:[Ci,[Yt],(p,u)=>{let[m]=u;return ce(Xi(m.evaluate(p)))}],"to-rgba":[ie(Vt,4),[jt],(p,u)=>{let[m]=u;const[C,P,Q,V]=m.evaluate(p).rgb;return[255*C,255*P,255*Q,V]}],rgb:[jt,[Vt,Vt,Vt],hl],rgba:[jt,[Vt,Vt,Vt,Vt],hl],has:{type:Li,overloads:[[[Ci],(p,u)=>{let[m]=u;return Gl(m.evaluate(p),p.properties())}],[[Ci,bi],(p,u)=>{let[m,C]=u;return Gl(m.evaluate(p),C.evaluate(p))}]]},get:{type:Yt,overloads:[[[Ci],(p,u)=>{let[m]=u;return to(m.evaluate(p),p.properties())}],[[Ci,bi],(p,u)=>{let[m,C]=u;return to(m.evaluate(p),C.evaluate(p))}]]},"feature-state":[Yt,[Ci],(p,u)=>{let[m]=u;return to(m.evaluate(p),p.featureState||{})}],properties:[bi,[],p=>p.properties()],"geometry-type":[Ci,[],p=>p.geometryType()],id:[Yt,[],p=>p.id()],zoom:[Vt,[],p=>p.globals.zoom],"heatmap-density":[Vt,[],p=>p.globals.heatmapDensity||0],"line-progress":[Vt,[],p=>p.globals.lineProgress||0],accumulated:[Yt,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[Vt,pa(Vt),(p,u)=>{let m=0;for(const C of u)m+=C.evaluate(p);return m}],"*":[Vt,pa(Vt),(p,u)=>{let m=1;for(const C of u)m*=C.evaluate(p);return m}],"-":{type:Vt,overloads:[[[Vt,Vt],(p,u)=>{let[m,C]=u;return m.evaluate(p)-C.evaluate(p)}],[[Vt],(p,u)=>{let[m]=u;return-m.evaluate(p)}]]},"/":[Vt,[Vt,Vt],(p,u)=>{let[m,C]=u;return m.evaluate(p)/C.evaluate(p)}],"%":[Vt,[Vt,Vt],(p,u)=>{let[m,C]=u;return m.evaluate(p)%C.evaluate(p)}],ln2:[Vt,[],()=>Math.LN2],pi:[Vt,[],()=>Math.PI],e:[Vt,[],()=>Math.E],"^":[Vt,[Vt,Vt],(p,u)=>{let[m,C]=u;return Math.pow(m.evaluate(p),C.evaluate(p))}],sqrt:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.sqrt(m.evaluate(p))}],log10:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))/Math.LN10}],ln:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))}],log2:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))/Math.LN2}],sin:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.sin(m.evaluate(p))}],cos:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.cos(m.evaluate(p))}],tan:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.tan(m.evaluate(p))}],asin:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.asin(m.evaluate(p))}],acos:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.acos(m.evaluate(p))}],atan:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.atan(m.evaluate(p))}],min:[Vt,pa(Vt),(p,u)=>Math.min(...u.map(m=>m.evaluate(p)))],max:[Vt,pa(Vt),(p,u)=>Math.max(...u.map(m=>m.evaluate(p)))],abs:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.abs(m.evaluate(p))}],round:[Vt,[Vt],(p,u)=>{let[m]=u;const C=m.evaluate(p);return C<0?-Math.round(-C):Math.round(C)}],floor:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.floor(m.evaluate(p))}],ceil:[Vt,[Vt],(p,u)=>{let[m]=u;return Math.ceil(m.evaluate(p))}],"filter-==":[Li,[Ci,Yt],(p,u)=>{let[m,C]=u;return p.properties()[m.value]===C.value}],"filter-id-==":[Li,[Yt],(p,u)=>{let[m]=u;return p.id()===m.value}],"filter-type-==":[Li,[Ci],(p,u)=>{let[m]=u;return p.geometryType()===m.value}],"filter-<":[Li,[Ci,Yt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P<Q}],"filter-id-<":[Li,[Yt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C<P}],"filter->":[Li,[Ci,Yt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P>Q}],"filter-id->":[Li,[Yt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C>P}],"filter-<=":[Li,[Ci,Yt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P<=Q}],"filter-id-<=":[Li,[Yt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C<=P}],"filter->=":[Li,[Ci,Yt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P>=Q}],"filter-id->=":[Li,[Yt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C>=P}],"filter-has":[Li,[Yt],(p,u)=>{let[m]=u;return m.value in p.properties()}],"filter-has-id":[Li,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Li,[ie(Ci)],(p,u)=>{let[m]=u;return m.value.indexOf(p.geometryType())>=0}],"filter-id-in":[Li,[ie(Yt)],(p,u)=>{let[m]=u;return m.value.indexOf(p.id())>=0}],"filter-in-small":[Li,[Ci,ie(Yt)],(p,u)=>{let[m,C]=u;return C.value.indexOf(p.properties()[m.value])>=0}],"filter-in-large":[Li,[Ci,ie(Yt)],(p,u)=>{let[m,C]=u;return function(P,Q,V,W){for(;V<=W;){const ne=V+W>>1;if(Q[ne]===P)return!0;Q[ne]>P?W=ne-1:V=ne+1}return!1}(p.properties()[m.value],C.value,0,C.value.length-1)}],all:{type:Li,overloads:[[[Li,Li],(p,u)=>{let[m,C]=u;return m.evaluate(p)&&C.evaluate(p)}],[pa(Li),(p,u)=>{for(const m of u)if(!m.evaluate(p))return!1;return!0}]]},any:{type:Li,overloads:[[[Li,Li],(p,u)=>{let[m,C]=u;return m.evaluate(p)||C.evaluate(p)}],[pa(Li),(p,u)=>{for(const m of u)if(m.evaluate(p))return!0;return!1}]]},"!":[Li,[Li],(p,u)=>{let[m]=u;return!m.evaluate(p)}],"is-supported-script":[Li,[Ci],(p,u)=>{let[m]=u;const C=p.globals&&p.globals.isSupportedScript;return!C||C(m.evaluate(p))}],upcase:[Ci,[Ci],(p,u)=>{let[m]=u;return m.evaluate(p).toUpperCase()}],downcase:[Ci,[Ci],(p,u)=>{let[m]=u;return m.evaluate(p).toLowerCase()}],concat:[Ci,pa(Yt),(p,u)=>u.map(m=>eo(m.evaluate(p))).join("")],"resolved-locale":[Ci,[yr],(p,u)=>{let[m]=u;return m.evaluate(p).resolvedLocale()}]});class Cr{constructor(u,m){var C;this.expression=u,this._warningHistory={},this._evaluator=new Gr,this._defaultValue=m?(C=m).type==="color"&&gi(C.default)?new hr(0,0,0,0):C.type==="color"?hr.parse(C.default)||null:C.type==="padding"?On.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Vr.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._evaluator.globals=u,this._evaluator.feature=m,this._evaluator.featureState=C,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V,this.expression.evaluate(this._evaluator)}evaluate(u,m,C,P,Q,V){this._evaluator.globals=u,this._evaluator.feature=m||null,this._evaluator.featureState=C||null,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V||null;try{const W=this.expression.evaluate(this._evaluator);if(W==null||typeof W=="number"&&W!=W)return this._defaultValue;if(this._enumValues&&!(W in this._enumValues))throw new fr(`Expected value to be one of ${Object.keys(this._enumValues).map(ne=>JSON.stringify(ne)).join(", ")}, but found ${JSON.stringify(W)} instead.`);return W}catch(W){return this._warningHistory[W.message]||(this._warningHistory[W.message]=!0,typeof console<"u"&&console.warn(W.message)),this._defaultValue}}}function Mr(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in fa}function Nn(p,u){const m=new js(fa,Io,[],u?function(P){const Q={color:jt,string:Ci,number:Vt,enum:Ci,boolean:Li,formatted:Tr,padding:Qe,resolvedImage:Be,variableAnchorOffsetCollection:ae};return P.type==="array"?ie(Q[P.value]||Yt,P.length):Q[P.type]}(u):void 0),C=m.parse(p,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?se(new Cr(C,u)):Le(m.errors)}class Ks{constructor(u,m){this.kind=u,this._styleExpression=m,this.isStateDependent=u!=="constant"&&!ys(m.expression)}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,P,Q,V)}evaluate(u,m,C,P,Q,V){return this._styleExpression.evaluate(u,m,C,P,Q,V)}}class io{constructor(u,m,C,P){this.kind=u,this.zoomStops=C,this._styleExpression=m,this.isStateDependent=u!=="camera"&&!ys(m.expression),this.interpolationType=P}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,P,Q,V)}evaluate(u,m,C,P,Q,V){return this._styleExpression.evaluate(u,m,C,P,Q,V)}interpolationFactor(u,m,C){return this.interpolationType?ss.interpolationFactor(this.interpolationType,u,m,C):0}}function Mo(p,u){const m=Nn(p,u);if(m.result==="error")return m;const C=m.value.expression,P=Xa(C);if(!P&&!ct(u))return Le([new ui("","data expressions not supported")]);const Q=Aa(C,["zoom"]);if(!Q&&!yt(u))return Le([new ui("","zoom expressions not supported")]);const V=ga(C);return V||Q?V instanceof ui?Le([V]):V instanceof ss&&!bt(u)?Le([new ui("",'"interpolate" expressions cannot be used with this property')]):se(V?new io(P?"camera":"composite",m.value,V.labels,V instanceof ss?V.interpolation:void 0):new Ks(P?"constant":"source",m.value)):Le([new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class La{constructor(u,m){this._parameters=u,this._specification=m,Yi(this,nr(this._parameters,this._specification))}static deserialize(u){return new La(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function ga(p){let u=null;if(p instanceof ul)u=ga(p.result);else if(p instanceof Ya){for(const m of p.args)if(u=ga(m),u)break}else(p instanceof Ia||p instanceof ss)&&p.input instanceof es&&p.input.name==="zoom"&&(u=p);return u instanceof ui||p.eachChild(m=>{const C=ga(m);C instanceof ui?u=C:!u&&C?u=new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&C&&u!==C&&(u=new ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function jl(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(const u of p.slice(1))if(!jl(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const Al={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(p){if(p==null)return{filter:()=>!0,needGeometry:!1};jl(p)||(p=Ds(p));const u=Nn(p,Al);if(u.result==="error")throw new Error(u.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,C,P)=>u.value.evaluate(m,C,{},P),needGeometry:ma(p)}}function gc(p,u){return p<u?-1:p>u?1:0}function ma(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(let u=1;u<p.length;u++)if(ma(p[u]))return!0;return!1}function Ds(p){if(!p)return!0;const u=p[0];return p.length<=1?u!=="any":u==="=="?dl(p[1],p[2],"=="):u==="!="?Pa(dl(p[1],p[2],"==")):u==="<"||u===">"||u==="<="||u===">="?dl(p[1],p[2],u):u==="any"?(m=p.slice(1),["any"].concat(m.map(Ds))):u==="all"?["all"].concat(p.slice(1).map(Ds)):u==="none"?["all"].concat(p.slice(1).map(Ds).map(Pa)):u==="in"?$l(p[1],p.slice(2)):u==="!in"?Pa($l(p[1],p.slice(2))):u==="has"?Ma(p[1]):u==="!has"?Pa(Ma(p[1])):u!=="within"||p;var m}function dl(p,u,m){switch(p){case"$type":return[`filter-type-${m}`,u];case"$id":return[`filter-id-${m}`,u];default:return[`filter-${m}`,p,u]}}function $l(p,u){if(u.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(m=>typeof m!=typeof u[0])?["filter-in-large",p,["literal",u.sort(gc)]]:["filter-in-small",p,["literal",u]]}}function Ma(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function Pa(p){return["!",p]}function Rs(p){const u=typeof p;if(u==="number"||u==="boolean"||u==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let P="[";for(const Q of p)P+=`${Rs(Q)},`;return`${P}]`}const m=Object.keys(p).sort();let C="{";for(let P=0;P<m.length;P++)C+=`${JSON.stringify(m[P])}:${Rs(p[m[P]])},`;return`${C}}`}function Ou(p){let u="";for(const m of ki)u+=`/${Rs(p[m])}`;return u}function In(p){const u=p.value;return u?[new zt(p.key,u,"constants have been deprecated as of v8")]:[]}function an(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function pn(p){if(Array.isArray(p))return p.map(pn);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){const u={};for(const m in p)u[m]=pn(p[m]);return u}return an(p)}function ts(p){const u=p.key,m=p.value,C=p.valueSpec||{},P=p.objectElementValidators||{},Q=p.style,V=p.styleSpec,W=p.validateSpec;let ne=[];const Ae=It(m);if(Ae!=="object")return[new zt(u,m,`object expected, ${Ae} found`)];for(const h in m){const c=h.split(".")[0],f=C[c]||C["*"];let v;if(P[c])v=P[c];else if(C[c])v=W;else if(P["*"])v=P["*"];else{if(!C["*"]){ne.push(new zt(u,m[h],`unknown property "${h}"`));continue}v=W}ne=ne.concat(v({key:(u&&`${u}.`)+h,value:m[h],valueSpec:f,style:Q,styleSpec:V,object:m,objectKey:h,validateSpec:W},m))}for(const h in C)P[h]||C[h].required&&C[h].default===void 0&&m[h]===void 0&&ne.push(new zt(u,m,`missing required property "${h}"`));return ne}function fl(p){const u=p.value,m=p.valueSpec,C=p.style,P=p.styleSpec,Q=p.key,V=p.arrayElementValidator||p.validateSpec;if(It(u)!=="array")return[new zt(Q,u,`array expected, ${It(u)} found`)];if(m.length&&u.length!==m.length)return[new zt(Q,u,`array length ${m.length} expected, length ${u.length} found`)];if(m["min-length"]&&u.length<m["min-length"])return[new zt(Q,u,`array length at least ${m["min-length"]} expected, length ${u.length} found`)];let W={type:m.value,values:m.values};P.$version<7&&(W.function=m.function),It(m.value)==="object"&&(W=m.value);let ne=[];for(let Ae=0;Ae<u.length;Ae++)ne=ne.concat(V({array:u,arrayIndex:Ae,value:u[Ae],valueSpec:W,validateSpec:p.validateSpec,style:C,styleSpec:P,key:`${Q}[${Ae}]`}));return ne}function pl(p){const u=p.key,m=p.value,C=p.valueSpec;let P=It(m);return P==="number"&&m!=m&&(P="NaN"),P!=="number"?[new zt(u,m,`number expected, ${P} found`)]:"minimum"in C&&m<C.minimum?[new zt(u,m,`${m} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&m>C.maximum?[new zt(u,m,`${m} is greater than the maximum value ${C.maximum}`)]:[]}function po(p){const u=p.valueSpec,m=an(p.value.type);let C,P,Q,V={};const W=m!=="categorical"&&p.value.property===void 0,ne=!W,Ae=It(p.value.stops)==="array"&&It(p.value.stops[0])==="array"&&It(p.value.stops[0][0])==="object",h=ts({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(v){if(m==="identity")return[new zt(v.key,v.value,'identity function may not have a "stops" property')];let E=[];const M=v.value;return E=E.concat(fl({key:v.key,value:M,valueSpec:v.valueSpec,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:c})),It(M)==="array"&&M.length===0&&E.push(new zt(v.key,M,"array must have at least one stop")),E},default:function(v){return v.validateSpec({key:v.key,value:v.value,valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec})}}});return m==="identity"&&W&&h.push(new zt(p.key,p.value,'missing required property "property"')),m==="identity"||p.value.stops||h.push(new zt(p.key,p.value,'missing required property "stops"')),m==="exponential"&&p.valueSpec.expression&&!bt(p.valueSpec)&&h.push(new zt(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(ne&&!ct(p.valueSpec)?h.push(new zt(p.key,p.value,"property functions not supported")):W&&!yt(p.valueSpec)&&h.push(new zt(p.key,p.value,"zoom functions not supported"))),m!=="categorical"&&!Ae||p.value.property!==void 0||h.push(new zt(p.key,p.value,'"property" property is required')),h;function c(v){let E=[];const M=v.value,R=v.key;if(It(M)!=="array")return[new zt(R,M,`array expected, ${It(M)} found`)];if(M.length!==2)return[new zt(R,M,`array length 2 expected, length ${M.length} found`)];if(Ae){if(It(M[0])!=="object")return[new zt(R,M,`object expected, ${It(M[0])} found`)];if(M[0].zoom===void 0)return[new zt(R,M,"object stop key must have zoom")];if(M[0].value===void 0)return[new zt(R,M,"object stop key must have value")];if(Q&&Q>an(M[0].zoom))return[new zt(R,M[0].zoom,"stop zoom values must appear in ascending order")];an(M[0].zoom)!==Q&&(Q=an(M[0].zoom),P=void 0,V={}),E=E.concat(ts({key:`${R}[0]`,value:M[0],valueSpec:{zoom:{}},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:pl,value:f}}))}else E=E.concat(f({key:`${R}[0]`,value:M[0],valueSpec:{},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec},M));return Mr(pn(M[1]))?E.concat([new zt(`${R}[1]`,M[1],"expressions are not allowed in function stops.")]):E.concat(v.validateSpec({key:`${R}[1]`,value:M[1],valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec}))}function f(v,E){const M=It(v.value),R=an(v.value),G=v.value!==null?v.value:E;if(C){if(M!==C)return[new zt(v.key,G,`${M} stop domain type must match previous stop domain type ${C}`)]}else C=M;if(M!=="number"&&M!=="string"&&M!=="boolean")return[new zt(v.key,G,"stop domain value must be a number, string, or boolean")];if(M!=="number"&&m!=="categorical"){let K=`number expected, ${M} found`;return ct(u)&&m===void 0&&(K+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zt(v.key,G,K)]}return m!=="categorical"||M!=="number"||isFinite(R)&&Math.floor(R)===R?m!=="categorical"&&M==="number"&&P!==void 0&&R<P?[new zt(v.key,G,"stop domain values must appear in ascending order")]:(P=R,m==="categorical"&&R in V?[new zt(v.key,G,"stop domain values must be unique")]:(V[R]=!0,[])):[new zt(v.key,G,`integer expected, found ${R}`)]}}function os(p){const u=(p.expressionContext==="property"?Mo:Nn)(pn(p.value),p.valueSpec);if(u.result==="error")return u.value.map(C=>new zt(`${p.key}${C.key}`,p.value,C.message));const m=u.value.expression||u.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!m.outputDefined())return[new zt(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!ys(m))return[new zt(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!ys(m))return[new zt(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!Aa(m,["zoom","feature-state"]))return[new zt(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!Xa(m))return[new zt(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function as(p){const u=p.key,m=p.value,C=p.valueSpec,P=[];return Array.isArray(C.values)?C.values.indexOf(an(m))===-1&&P.push(new zt(u,m,`expected one of [${C.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(C.values).indexOf(an(m))===-1&&P.push(new zt(u,m,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(m)} found`)),P}function Po(p){return jl(pn(p.value))?os(Yi({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fo(p)}function Fo(p){const u=p.value,m=p.key;if(It(u)!=="array")return[new zt(m,u,`array expected, ${It(u)} found`)];const C=p.styleSpec;let P,Q=[];if(u.length<1)return[new zt(m,u,"filter array must have at least 1 element")];switch(Q=Q.concat(as({key:`${m}[0]`,value:u[0],valueSpec:C.filter_operator,style:p.style,styleSpec:p.styleSpec})),an(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&an(u[1])==="$type"&&Q.push(new zt(m,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&Q.push(new zt(m,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(P=It(u[1]),P!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${P} found`)));for(let V=2;V<u.length;V++)P=It(u[V]),an(u[1])==="$type"?Q=Q.concat(as({key:`${m}[${V}]`,value:u[V],valueSpec:C.geometry_type,style:p.style,styleSpec:p.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&Q.push(new zt(`${m}[${V}]`,u[V],`string, number, or boolean expected, ${P} found`));break;case"any":case"all":case"none":for(let V=1;V<u.length;V++)Q=Q.concat(Fo({key:`${m}[${V}]`,value:u[V],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":P=It(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${P} found`));break;case"within":P=It(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="object"&&Q.push(new zt(`${m}[1]`,u[1],`object expected, ${P} found`))}return Q}function ya(p,u){const m=p.key,C=p.validateSpec,P=p.style,Q=p.styleSpec,V=p.value,W=p.objectKey,ne=Q[`${u}_${p.layerType}`];if(!ne)return[];const Ae=W.match(/^(.*)-transition$/);if(u==="paint"&&Ae&&ne[Ae[1]]&&ne[Ae[1]].transition)return C({key:m,value:V,valueSpec:Q.transition,style:P,styleSpec:Q});const h=p.valueSpec||ne[W];if(!h)return[new zt(m,V,`unknown property "${W}"`)];let c;if(It(V)==="string"&&ct(h)&&!h.tokens&&(c=/^{([^}]+)}$/.exec(V)))return[new zt(m,V,`"${W}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const f=[];return p.layerType==="symbol"&&(W==="text-field"&&P&&!P.glyphs&&f.push(new zt(m,V,'use of "text-field" requires a style "glyphs" property')),W==="text-font"&&gi(pn(V))&&an(V.type)==="identity"&&f.push(new zt(m,V,'"text-font" does not support identity functions'))),f.concat(C({key:p.key,value:V,valueSpec:h,style:P,styleSpec:Q,expressionContext:"property",propertyType:u,propertyKey:W}))}function gl(p){return ya(p,"paint")}function ro(p){return ya(p,"layout")}function no(p){let u=[];const m=p.value,C=p.key,P=p.style,Q=p.styleSpec;m.type||m.ref||u.push(new zt(C,m,'either "type" or "ref" is required'));let V=an(m.type);const W=an(m.ref);if(m.id){const ne=an(m.id);for(let Ae=0;Ae<p.arrayIndex;Ae++){const h=P.layers[Ae];an(h.id)===ne&&u.push(new zt(C,m.id,`duplicate layer id "${m.id}", previously used at line ${h.id.__line__}`))}}if("ref"in m){let ne;["type","source","source-layer","filter","layout"].forEach(Ae=>{Ae in m&&u.push(new zt(C,m[Ae],`"${Ae}" is prohibited for ref layers`))}),P.layers.forEach(Ae=>{an(Ae.id)===W&&(ne=Ae)}),ne?ne.ref?u.push(new zt(C,m.ref,"ref cannot reference another ref layer")):V=an(ne.type):u.push(new zt(C,m.ref,`ref layer "${W}" not found`))}else if(V!=="background")if(m.source){const ne=P.sources&&P.sources[m.source],Ae=ne&&an(ne.type);ne?Ae==="vector"&&V==="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster source`)):Ae!=="raster-dem"&&V==="hillshade"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster-dem source`)):Ae==="raster"&&V!=="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a vector source`)):Ae!=="vector"||m["source-layer"]?Ae==="raster-dem"&&V!=="hillshade"?u.push(new zt(C,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="line"||!m.paint||!m.paint["line-gradient"]||Ae==="geojson"&&ne.lineMetrics||u.push(new zt(C,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new zt(C,m,`layer "${m.id}" must specify a "source-layer"`)):u.push(new zt(C,m.source,`source "${m.source}" not found`))}else u.push(new zt(C,m,'missing required property "source"'));return u=u.concat(ts({key:C,value:m,valueSpec:Q.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${C}.type`,value:m.type,valueSpec:Q.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:m,objectKey:"type"}),filter:Po,layout:ne=>ts({layer:m,key:ne.key,value:ne.value,style:ne.style,styleSpec:ne.styleSpec,validateSpec:ne.validateSpec,objectElementValidators:{"*":Ae=>ro(Yi({layerType:V},Ae))}}),paint:ne=>ts({layer:m,key:ne.key,value:ne.value,style:ne.style,styleSpec:ne.styleSpec,validateSpec:ne.validateSpec,objectElementValidators:{"*":Ae=>gl(Yi({layerType:V},Ae))}})}})),u}function go(p){const u=p.value,m=p.key,C=It(u);return C!=="string"?[new zt(m,u,`string expected, ${C} found`)]:[]}const _s={promoteId:function(p){let{key:u,value:m}=p;if(It(m)==="string")return go({key:u,value:m});{const C=[];for(const P in m)C.push(...go({key:`${u}.${P}`,value:m[P]}));return C}}};function so(p){const u=p.value,m=p.key,C=p.styleSpec,P=p.style,Q=p.validateSpec;if(!u.type)return[new zt(m,u,'"type" is required')];const V=an(u.type);let W;switch(V){case"vector":case"raster":return W=ts({key:m,value:u,valueSpec:C[`source_${V.replace("-","_")}`],style:p.style,styleSpec:C,objectElementValidators:_s,validateSpec:Q}),W;case"raster-dem":return W=function(ne){var Ae;const h=(Ae=ne.sourceName)!==null&&Ae!==void 0?Ae:"",c=ne.value,f=ne.styleSpec,v=f.source_raster_dem,E=ne.style;let M=[];const R=It(c);if(c===void 0)return M;if(R!=="object")return M.push(new zt("source_raster_dem",c,`object expected, ${R} found`)),M;const G=an(c.encoding)==="custom",K=["redFactor","greenFactor","blueFactor","baseShift"],Z=ne.value.encoding?`"${ne.value.encoding}"`:"Default";for(const oe in c)!G&&K.includes(oe)?M.push(new zt(oe,c[oe],`In "${h}": "${oe}" is only valid when "encoding" is set to "custom". ${Z} encoding found`)):v[oe]?M=M.concat(ne.validateSpec({key:oe,value:c[oe],valueSpec:v[oe],validateSpec:ne.validateSpec,style:E,styleSpec:f})):M.push(new zt(oe,c[oe],`unknown property "${oe}"`));return M}({sourceName:m,value:u,style:p.style,styleSpec:C,validateSpec:Q}),W;case"geojson":if(W=ts({key:m,value:u,valueSpec:C.source_geojson,style:P,styleSpec:C,validateSpec:Q,objectElementValidators:_s}),u.cluster)for(const ne in u.clusterProperties){const[Ae,h]=u.clusterProperties[ne],c=typeof Ae=="string"?[Ae,["accumulated"],["get",ne]]:Ae;W.push(...os({key:`${m}.${ne}.map`,value:h,validateSpec:Q,expressionContext:"cluster-map"})),W.push(...os({key:`${m}.${ne}.reduce`,value:c,validateSpec:Q,expressionContext:"cluster-reduce"}))}return W;case"video":return ts({key:m,value:u,valueSpec:C.source_video,style:P,validateSpec:Q,styleSpec:C});case"image":return ts({key:m,value:u,valueSpec:C.source_image,style:P,validateSpec:Q,styleSpec:C});case"canvas":return[new zt(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return as({key:`${m}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:P,validateSpec:Q,styleSpec:C})}}function Fa(p){const u=p.value,m=p.styleSpec,C=m.light,P=p.style;let Q=[];const V=It(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new zt("light",u,`object expected, ${V} found`)]),Q;for(const W in u){const ne=W.match(/^(.*)-transition$/);Q=Q.concat(ne&&C[ne[1]]&&C[ne[1]].transition?p.validateSpec({key:W,value:u[W],valueSpec:m.transition,validateSpec:p.validateSpec,style:P,styleSpec:m}):C[W]?p.validateSpec({key:W,value:u[W],valueSpec:C[W],validateSpec:p.validateSpec,style:P,styleSpec:m}):[new zt(W,u[W],`unknown property "${W}"`)])}return Q}function _a(p){const u=p.value,m=p.styleSpec,C=m.sky,P=p.style,Q=It(u);if(u===void 0)return[];if(Q!=="object")return[new zt("sky",u,`object expected, ${Q} found`)];let V=[];for(const W in u)V=V.concat(C[W]?ds({key:W,value:u[W],valueSpec:C[W],style:P,styleSpec:m}):[new zt(W,u[W],`unknown property "${W}"`)]);return V}function Da(p){const u=p.value,m=p.styleSpec,C=m.terrain,P=p.style;let Q=[];const V=It(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new zt("terrain",u,`object expected, ${V} found`)]),Q;for(const W in u)Q=Q.concat(C[W]?p.validateSpec({key:W,value:u[W],valueSpec:C[W],validateSpec:p.validateSpec,style:P,styleSpec:m}):[new zt(W,u[W],`unknown property "${W}"`)]);return Q}function Ln(p){let u=[];const m=p.value,C=p.key;if(Array.isArray(m)){const P=[],Q=[];for(const V in m)m[V].id&&P.includes(m[V].id)&&u.push(new zt(C,m,`all the sprites' ids must be unique, but ${m[V].id} is duplicated`)),P.push(m[V].id),m[V].url&&Q.includes(m[V].url)&&u.push(new zt(C,m,`all the sprites' URLs must be unique, but ${m[V].url} is duplicated`)),Q.push(m[V].url),u=u.concat(ts({key:`${C}[${V}]`,value:m[V],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return u}return go({key:C,value:m})}const Do={"*":()=>[],array:fl,boolean:function(p){const u=p.value,m=p.key,C=It(u);return C!=="boolean"?[new zt(m,u,`boolean expected, ${C} found`)]:[]},number:pl,color:function(p){const u=p.key,m=p.value,C=It(m);return C!=="string"?[new zt(u,m,`color expected, ${C} found`)]:hr.parse(String(m))?[]:[new zt(u,m,`color expected, "${m}" found`)]},constants:In,enum:as,filter:Po,function:po,layer:no,object:ts,source:so,light:Fa,sky:_a,terrain:Da,string:go,formatted:function(p){return go(p).length===0?[]:os(p)},resolvedImage:function(p){return go(p).length===0?[]:os(p)},padding:function(p){const u=p.key,m=p.value;if(It(m)==="array"){if(m.length<1||m.length>4)return[new zt(u,m,`padding requires 1 to 4 values; ${m.length} values found`)];const C={type:"number"};let P=[];for(let Q=0;Q<m.length;Q++)P=P.concat(p.validateSpec({key:`${u}[${Q}]`,value:m[Q],validateSpec:p.validateSpec,valueSpec:C}));return P}return pl({key:u,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(p){const u=p.key,m=p.value,C=It(m),P=p.styleSpec;if(C!=="array"||m.length<1||m.length%2!=0)return[new zt(u,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Q=[];for(let V=0;V<m.length;V+=2)Q=Q.concat(as({key:`${u}[${V}]`,value:m[V],valueSpec:P.layout_symbol["text-anchor"]})),Q=Q.concat(fl({key:`${u}[${V+1}]`,value:m[V+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:P}));return Q},sprite:Ln};function ds(p){const u=p.value,m=p.valueSpec,C=p.styleSpec;return p.validateSpec=ds,m.expression&&gi(an(u))?po(p):m.expression&&Mr(pn(u))?os(p):m.type&&Do[m.type]?Do[m.type](p):ts(Yi({},p,{valueSpec:m.type?C[m.type]:m}))}function vs(p){const u=p.value,m=p.key,C=go(p);return C.length||(u.indexOf("{fontstack}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{range}" token'))),C}function fs(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wt,m=[];return m=m.concat(ds({key:"",value:p,valueSpec:u.$root,styleSpec:u,style:p,validateSpec:ds,objectElementValidators:{glyphs:vs,"*":()=>[]}})),p.constants&&(m=m.concat(In({key:"constants",value:p.constants,style:p,styleSpec:u,validateSpec:ds}))),Jr(m)}function Lr(p){return function(u){return p({...u,validateSpec:ds})}}function Jr(p){return[].concat(p).sort((u,m)=>u.line-m.line)}function ln(p){return function(){for(var u=arguments.length,m=new Array(u),C=0;C<u;C++)m[C]=arguments[C];return Jr(p.apply(this,m))}}fs.source=ln(Lr(so)),fs.sprite=ln(Lr(Ln)),fs.glyphs=ln(Lr(vs)),fs.light=ln(Lr(Fa)),fs.sky=ln(Lr(_a)),fs.terrain=ln(Lr(Da)),fs.layer=ln(Lr(no)),fs.filter=ln(Lr(Po)),fs.paintProperty=ln(Lr(gl)),fs.layoutProperty=ln(Lr(ro));const qn=fs,va=qn.light,Ra=qn.paintProperty,mo=qn.layoutProperty;function Yo(p,u){let m=!1;if(u&&u.length)for(const C of u)p.fire(new Ot(new Error(C.message))),m=!0;return m}class Ui{constructor(u,m,C){const P=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const V=new Int32Array(this.arrayBuffer);u=V[0],this.d=(m=V[1])+2*(C=V[2]);for(let ne=0;ne<this.d*this.d;ne++){const Ae=V[3+ne],h=V[3+ne+1];P.push(Ae===h?null:V.subarray(Ae,h))}const W=V[3+P.length+1];this.keys=V.subarray(V[3+P.length],W),this.bboxes=V.subarray(W),this.insert=this._insertReadonly}else{this.d=m+2*C;for(let V=0;V<this.d*this.d;V++)P.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=u,this.padding=C,this.scale=m/u,this.uid=0;const Q=C/m*u;this.min=-Q,this.max=u+Q}insert(u,m,C,P,Q){this._forEachCell(m,C,P,Q,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(m),this.bboxes.push(C),this.bboxes.push(P),this.bboxes.push(Q)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,m,C,P,Q,V){this.cells[Q].push(V)}query(u,m,C,P,Q){const V=this.min,W=this.max;if(u<=V&&m<=V&&W<=C&&W<=P&&!Q)return Array.prototype.slice.call(this.keys);{const ne=[];return this._forEachCell(u,m,C,P,this._queryCell,ne,{},Q),ne}}_queryCell(u,m,C,P,Q,V,W,ne){const Ae=this.cells[Q];if(Ae!==null){const h=this.keys,c=this.bboxes;for(let f=0;f<Ae.length;f++){const v=Ae[f];if(W[v]===void 0){const E=4*v;(ne?ne(c[E+0],c[E+1],c[E+2],c[E+3]):u<=c[E+2]&&m<=c[E+3]&&C>=c[E+0]&&P>=c[E+1])?(W[v]=!0,V.push(h[v])):W[v]=!1}}}}_forEachCell(u,m,C,P,Q,V,W,ne){const Ae=this._convertToCellCoord(u),h=this._convertToCellCoord(m),c=this._convertToCellCoord(C),f=this._convertToCellCoord(P);for(let v=Ae;v<=c;v++)for(let E=h;E<=f;E++){const M=this.d*E+v;if((!ne||ne(this._convertFromCellCoord(v),this._convertFromCellCoord(E),this._convertFromCellCoord(v+1),this._convertFromCellCoord(E+1)))&&Q.call(this,u,m,C,P,M,V,W,ne))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,m=3+this.cells.length+1+1;let C=0;for(let V=0;V<this.cells.length;V++)C+=this.cells[V].length;const P=new Int32Array(m+C+this.keys.length+this.bboxes.length);P[0]=this.extent,P[1]=this.n,P[2]=this.padding;let Q=m;for(let V=0;V<u.length;V++){const W=u[V];P[3+V]=Q,P.set(W,Q),Q+=W.length}return P[3+u.length]=Q,P.set(this.keys,Q),Q+=this.keys.length,P[3+u.length+1]=Q,P.set(this.bboxes,Q),Q+=this.bboxes.length,P.buffer}static serialize(u,m){const C=u.toArrayBuffer();return m&&m.push(C),{buffer:C}}static deserialize(u){return new Ui(u.buffer)}}const ea={};function Fi(p,u){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ea[p])throw new Error(`${p} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:p,writeable:!1}),ea[p]={klass:u,omit:m.omit||[],shallow:m.shallow||[]}}Fi("Object",Object),Fi("TransferableGridIndex",Ui),Fi("Color",hr),Fi("Error",Error),Fi("AJAXError",Ft),Fi("ResolvedImage",wn),Fi("StylePropertyFunction",La),Fi("StyleExpression",Cr,{omit:["_evaluator"]}),Fi("ZoomDependentExpression",io),Fi("ZoomConstantExpression",Ks),Fi("CompoundExpression",es,{omit:["_evaluate"]});for(const p in fa)fa[p]._classRegistryKey||Fi(`Expression_${p}`,fa[p]);function ml(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function Kl(p,u){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error)return p;if(ml(p)||vt(p))return u&&u.push(p),p;if(ArrayBuffer.isView(p)){const m=p;return u&&u.push(m.buffer),m}if(p instanceof ImageData)return u&&u.push(p.data.buffer),p;if(Array.isArray(p)){const m=[];for(const C of p)m.push(Kl(C,u));return m}if(typeof p=="object"){const m=p.constructor,C=m._classRegistryKey;if(!C)throw new Error(`can't serialize object of unregistered class ${m.name}`);if(!ea[C])throw new Error(`${C} is not registered.`);const P=m.serialize?m.serialize(p,u):{};if(m.serialize){if(u&&P===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Q in p){if(!p.hasOwnProperty(Q)||ea[C].omit.indexOf(Q)>=0)continue;const V=p[Q];P[Q]=ea[C].shallow.indexOf(Q)>=0?V:Kl(V,u)}p instanceof Error&&(P.message=p.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(P.$name=C),P}throw new Error("can't serialize object of type "+typeof p)}function Mi(p){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error||ml(p)||vt(p)||ArrayBuffer.isView(p)||p instanceof ImageData)return p;if(Array.isArray(p))return p.map(Mi);if(typeof p=="object"){const u=p.$name||"Object";if(!ea[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:m}=ea[u];if(!m)throw new Error(`can't deserialize unregistered class ${u}`);if(m.deserialize)return m.deserialize(p);const C=Object.create(m.prototype);for(const P of Object.keys(p)){if(P==="$name")continue;const Q=p[P];C[P]=ea[u].shallow.indexOf(P)>=0?Q:Mi(Q)}return C}throw new Error("can't deserialize object of type "+typeof p)}class Wl{constructor(){this.first=!0}update(u,m){const C=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=m),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=C,!0))}}const Si={"Latin-1 Supplement":p=>p>=128&&p<=255,Arabic:p=>p>=1536&&p<=1791,"Arabic Supplement":p=>p>=1872&&p<=1919,"Arabic Extended-A":p=>p>=2208&&p<=2303,"Hangul Jamo":p=>p>=4352&&p<=4607,"Unified Canadian Aboriginal Syllabics":p=>p>=5120&&p<=5759,Khmer:p=>p>=6016&&p<=6143,"Unified Canadian Aboriginal Syllabics Extended":p=>p>=6320&&p<=6399,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"CJK Radicals Supplement":p=>p>=11904&&p<=12031,"Kangxi Radicals":p=>p>=12032&&p<=12255,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Hiragana:p=>p>=12352&&p<=12447,Katakana:p=>p>=12448&&p<=12543,Bopomofo:p=>p>=12544&&p<=12591,"Hangul Compatibility Jamo":p=>p>=12592&&p<=12687,Kanbun:p=>p>=12688&&p<=12703,"Bopomofo Extended":p=>p>=12704&&p<=12735,"CJK Strokes":p=>p>=12736&&p<=12783,"Katakana Phonetic Extensions":p=>p>=12784&&p<=12799,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"CJK Unified Ideographs Extension A":p=>p>=13312&&p<=19903,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"CJK Unified Ideographs":p=>p>=19968&&p<=40959,"Yi Syllables":p=>p>=40960&&p<=42127,"Yi Radicals":p=>p>=42128&&p<=42191,"Hangul Jamo Extended-A":p=>p>=43360&&p<=43391,"Hangul Syllables":p=>p>=44032&&p<=55215,"Hangul Jamo Extended-B":p=>p>=55216&&p<=55295,"Private Use Area":p=>p>=57344&&p<=63743,"CJK Compatibility Ideographs":p=>p>=63744&&p<=64255,"Arabic Presentation Forms-A":p=>p>=64336&&p<=65023,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Arabic Presentation Forms-B":p=>p>=65136&&p<=65279,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function oo(p){for(const u of p)if(Xl(u.charCodeAt(0)))return!0;return!1}function yo(p){for(const u of p)if(!kc(u.charCodeAt(0)))return!1;return!0}function kc(p){return!(Si.Arabic(p)||Si["Arabic Supplement"](p)||Si["Arabic Extended-A"](p)||Si["Arabic Presentation Forms-A"](p)||Si["Arabic Presentation Forms-B"](p))}function Xl(p){return!(p!==746&&p!==747&&(p<4352||!(Si["Bopomofo Extended"](p)||Si.Bopomofo(p)||Si["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||Si["CJK Compatibility Ideographs"](p)||Si["CJK Compatibility"](p)||Si["CJK Radicals Supplement"](p)||Si["CJK Strokes"](p)||!(!Si["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||Si["CJK Unified Ideographs Extension A"](p)||Si["CJK Unified Ideographs"](p)||Si["Enclosed CJK Letters and Months"](p)||Si["Hangul Compatibility Jamo"](p)||Si["Hangul Jamo Extended-A"](p)||Si["Hangul Jamo Extended-B"](p)||Si["Hangul Jamo"](p)||Si["Hangul Syllables"](p)||Si.Hiragana(p)||Si["Ideographic Description Characters"](p)||Si.Kanbun(p)||Si["Kangxi Radicals"](p)||Si["Katakana Phonetic Extensions"](p)||Si.Katakana(p)&&p!==12540||!(!Si["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!Si["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||Si["Unified Canadian Aboriginal Syllabics"](p)||Si["Unified Canadian Aboriginal Syllabics Extended"](p)||Si["Vertical Forms"](p)||Si["Yijing Hexagram Symbols"](p)||Si["Yi Syllables"](p)||Si["Yi Radicals"](p))))}function Oc(p){return!(Xl(p)||function(u){return!!(Si["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Si["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Si["Letterlike Symbols"](u)||Si["Number Forms"](u)||Si["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Si["Control Pictures"](u)&&u!==9251||Si["Optical Character Recognition"](u)||Si["Enclosed Alphanumerics"](u)||Si["Geometric Shapes"](u)||Si["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Si["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Si["CJK Symbols and Punctuation"](u)||Si.Katakana(u)||Si["Private Use Area"](u)||Si["CJK Compatibility Forms"](u)||Si["Small Form Variants"](u)||Si["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(p))}function Uc(p){return p>=1424&&p<=2303||Si["Arabic Presentation Forms-A"](p)||Si["Arabic Presentation Forms-B"](p)}function Nc(p,u){return!(!u&&Uc(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||Si.Khmer(p))}function zc(p){for(const u of p)if(Uc(u.charCodeAt(0)))return!0;return!1}const rl=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(p){this.pluginStatus=p.pluginStatus,this.pluginURL=p.pluginURL}setMethods(p){this.applyArabicShaping=p.applyArabicShaping,this.processBidirectionalText=p.processBidirectionalText,this.processStyledBidirectionalText=p.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class _n{constructor(u,m){this.zoom=u,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wl,this.transition={})}isSupportedScript(u){return function(m,C){for(const P of m)if(!Nc(P.charCodeAt(0),C))return!1;return!0}(u,rl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,m=u-Math.floor(u),C=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*m}}}class Es{constructor(u,m){this.property=u,this.value=m,this.expression=function(C,P){if(gi(C))return new La(C,P);if(Mr(C)){const Q=Mo(C,P);if(Q.result==="error")throw new Error(Q.value.map(V=>`${V.key}: ${V.message}`).join(", "));return Q.value}{let Q=C;return P.type==="color"&&typeof C=="string"?Q=hr.parse(C):P.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?P.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(Q=Vr.parse(C)):Q=On.parse(C),{kind:"constant",evaluate:()=>Q}}}(m===void 0?u.specification.default:m,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,m,C){return this.property.possiblyEvaluate(this,u,m,C)}}class Ro{constructor(u){this.property=u,this.value=new Es(u,void 0)}transitioned(u,m){return new Uu(this.property,this.value,m,$e({},u.transition,this.transition),u.now)}untransitioned(){return new Uu(this.property,this.value,null,{},0)}}class Zl{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return Re(this._values[u].value.value)}setValue(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ro(this._values[u].property)),this._values[u].value=new Es(this._values[u].property,m===null?void 0:Re(m))}getTransition(u){return Re(this._values[u].transition)}setTransition(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ro(this._values[u].property)),this._values[u].transition=Re(m)||void 0}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C);const P=this.getTransition(m);P!==void 0&&(u[`${m}-transition`]=P)}return u}transitioned(u,m){const C=new mc(this._properties);for(const P of Object.keys(this._values))C._values[P]=this._values[P].transitioned(u,m._values[P]);return C}untransitioned(){const u=new mc(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].untransitioned();return u}}class Uu{constructor(u,m,C,P,Q){this.property=u,this.value=m,this.begin=Q+P.delay||0,this.end=this.begin+P.duration||0,u.specification.transition&&(P.delay||P.duration)&&(this.prior=C)}possiblyEvaluate(u,m,C){const P=u.now||0,Q=this.value.possiblyEvaluate(u,m,C),V=this.prior;if(V){if(P>this.end)return this.prior=null,Q;if(this.value.isDataDriven())return this.prior=null,Q;if(P<this.begin)return V.possiblyEvaluate(u,m,C);{const W=(P-this.begin)/(this.end-this.begin);return this.property.interpolate(V.possiblyEvaluate(u,m,C),Q,function(ne){if(ne<=0)return 0;if(ne>=1)return 1;const Ae=ne*ne,h=Ae*ne;return 4*(ne<.5?h:3*(ne-Ae)+h-.75)}(W))}}return Q}}class mc{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,m,C){const P=new Ws(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return P}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class hu{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return Re(this._values[u].value)}setValue(u,m){this._values[u]=new Es(this._values[u].property,m===null?void 0:Re(m))}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C)}return u}possiblyEvaluate(u,m,C){const P=new Ws(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return P}}class ba{constructor(u,m,C){this.property=u,this.value=m,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,m,C,P){return this.property.evaluate(this.value,this.parameters,u,m,C,P)}}class Ws{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class xi{constructor(u){this.specification=u}possiblyEvaluate(u,m){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(m)}interpolate(u,m,C){const P=fn[this.specification.type];return P?P(u,m,C):u}}class or{constructor(u,m){this.specification=u,this.overrides=m}possiblyEvaluate(u,m,C,P){return new ba(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(m,null,{},C,P)}:u.expression,m)}interpolate(u,m,C){if(u.value.kind!=="constant"||m.value.kind!=="constant")return u;if(u.value.value===void 0||m.value.value===void 0)return new ba(this,{kind:"constant",value:void 0},u.parameters);const P=fn[this.specification.type];if(P){const Q=P(u.value.value,m.value.value,C);return new ba(this,{kind:"constant",value:Q},u.parameters)}return u}evaluate(u,m,C,P,Q,V){return u.kind==="constant"?u.value:u.evaluate(m,C,P,Q,V)}}class Jl extends or{possiblyEvaluate(u,m,C,P){if(u.value===void 0)return new ba(this,{kind:"constant",value:void 0},m);if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,P),V=u.property.specification.type==="resolvedImage"&&typeof Q!="string"?Q.name:Q,W=this._calculate(V,V,V,m);return new ba(this,{kind:"constant",value:W},m)}if(u.expression.kind==="camera"){const Q=this._calculate(u.expression.evaluate({zoom:m.zoom-1}),u.expression.evaluate({zoom:m.zoom}),u.expression.evaluate({zoom:m.zoom+1}),m);return new ba(this,{kind:"constant",value:Q},m)}return new ba(this,u.expression,m)}evaluate(u,m,C,P,Q,V){if(u.kind==="source"){const W=u.evaluate(m,C,P,Q,V);return this._calculate(W,W,W,m)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(m.zoom)-1},C,P),u.evaluate({zoom:Math.floor(m.zoom)},C,P),u.evaluate({zoom:Math.floor(m.zoom)+1},C,P),m):u.value}_calculate(u,m,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Qc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,P){if(u.value!==void 0){if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,P);return this._calculate(Q,Q,Q,m)}return this._calculate(u.expression.evaluate(new _n(Math.floor(m.zoom-1),m)),u.expression.evaluate(new _n(Math.floor(m.zoom),m)),u.expression.evaluate(new _n(Math.floor(m.zoom+1),m)),m)}}_calculate(u,m,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Vc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,P){return!!u.expression.evaluate(m,null,{},C,P)}interpolate(){return!1}}class Ss{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in u){const C=u[m];C.specification.overridable&&this.overridableProperties.push(m);const P=this.defaultPropertyValues[m]=new Es(C,void 0),Q=this.defaultTransitionablePropertyValues[m]=new Ro(C);this.defaultTransitioningPropertyValues[m]=Q.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=P.possiblyEvaluate({})}}}Fi("DataDrivenProperty",or),Fi("DataConstantProperty",xi),Fi("CrossFadedDataDrivenProperty",Jl),Fi("CrossFadedProperty",Qc),Fi("ColorRampProperty",Vc);const xh="-transition";class $n extends lt{constructor(u,m){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),m.layout&&(this._unevaluatedLayout=new hu(m.layout)),m.paint)){this._transitionablePaint=new Zl(m.paint);for(const C in u.paint)this.setPaintProperty(C,u.paint[C],{validate:!1});for(const C in u.layout)this.setLayoutProperty(C,u.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ws(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};m!=null&&this._validate(mo,`layers.${this.id}.layout.${u}`,u,m,C)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,m):this.visibility=m)}getPaintProperty(u){return u.endsWith(xh)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(m!=null&&this._validate(Ra,`layers.${this.id}.paint.${u}`,u,m,C))return!1;if(u.endsWith(xh))return this._transitionablePaint.setTransition(u.slice(0,-11),m||void 0),!1;{const P=this._transitionablePaint._values[u],Q=P.property.specification["property-type"]==="cross-faded-data-driven",V=P.value.isDataDriven(),W=P.value;this._transitionablePaint.setValue(u,m),this._handleSpecialPaintPropertyUpdate(u);const ne=this._transitionablePaint._values[u].value;return ne.isDataDriven()||V||Q||this._handleOverridablePaintPropertyUpdate(u,W,ne)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,m,C){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,m){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,m)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),rt(u,(m,C)=>!(m===void 0||C==="layout"&&!Object.keys(m).length||C==="paint"&&!Object.keys(m).length))}_validate(u,m,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!Q||Q.validate!==!1)&&Yo(this,u.call(qn,{key:m,layerType:this.type,objectKey:C,value:P,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const m=this.paint.get(u);if(m instanceof ba&&ct(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const Au={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ki{constructor(u,m){this._structArray=u,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,m){return u._trim(),m&&(u.isTransferred=!0,m.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const m=Object.create(this.prototype);return m.arrayBuffer=u.arrayBuffer,m.length=u.length,m.capacity=u.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Kn(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=0,C=0;return{members:p.map(P=>{const Q=Au[P.type].BYTES_PER_ELEMENT,V=m=Nu(m,Math.max(u,Q)),W=P.components||1;return C=Math.max(C,Q),m+=Q*W,{name:P.name,type:P.type,components:W,offset:V}}),size:Nu(m,Math.max(C,u)),alignment:u}}function Nu(p,u){return Math.ceil(p/u)*u}class ks extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.int16[P+0]=m,this.int16[P+1]=C,u}}ks.prototype.bytesPerElement=4,Fi("StructArrayLayout2i4",ks);class rn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.int16[Q+0]=m,this.int16[Q+1]=C,this.int16[Q+2]=P,u}}rn.prototype.bytesPerElement=6,Fi("StructArrayLayout3i6",rn);class ta extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=4*u;return this.int16[V+0]=m,this.int16[V+1]=C,this.int16[V+2]=P,this.int16[V+3]=Q,u}}ta.prototype.bytesPerElement=8,Fi("StructArrayLayout4i8",ta);class ko extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const W=this.length;return this.resize(W+1),this.emplace(W,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,W){const ne=6*u;return this.int16[ne+0]=m,this.int16[ne+1]=C,this.int16[ne+2]=P,this.int16[ne+3]=Q,this.int16[ne+4]=V,this.int16[ne+5]=W,u}}ko.prototype.bytesPerElement=12,Fi("StructArrayLayout2i4i12",ko);class du extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const W=this.length;return this.resize(W+1),this.emplace(W,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,W){const ne=4*u,Ae=8*u;return this.int16[ne+0]=m,this.int16[ne+1]=C,this.uint8[Ae+4]=P,this.uint8[Ae+5]=Q,this.uint8[Ae+6]=V,this.uint8[Ae+7]=W,u}}du.prototype.bytesPerElement=8,Fi("StructArrayLayout2i4ub8",du);class Os extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.float32[P+0]=m,this.float32[P+1]=C,u}}Os.prototype.bytesPerElement=8,Fi("StructArrayLayout2f8",Os);class Yr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,W,ne,Ae,h){const c=this.length;return this.resize(c+1),this.emplace(c,u,m,C,P,Q,V,W,ne,Ae,h)}emplace(u,m,C,P,Q,V,W,ne,Ae,h,c){const f=10*u;return this.uint16[f+0]=m,this.uint16[f+1]=C,this.uint16[f+2]=P,this.uint16[f+3]=Q,this.uint16[f+4]=V,this.uint16[f+5]=W,this.uint16[f+6]=ne,this.uint16[f+7]=Ae,this.uint16[f+8]=h,this.uint16[f+9]=c,u}}Yr.prototype.bytesPerElement=20,Fi("StructArrayLayout10ui20",Yr);class zn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,W,ne,Ae,h,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,u,m,C,P,Q,V,W,ne,Ae,h,c,f)}emplace(u,m,C,P,Q,V,W,ne,Ae,h,c,f,v){const E=12*u;return this.int16[E+0]=m,this.int16[E+1]=C,this.int16[E+2]=P,this.int16[E+3]=Q,this.uint16[E+4]=V,this.uint16[E+5]=W,this.uint16[E+6]=ne,this.uint16[E+7]=Ae,this.int16[E+8]=h,this.int16[E+9]=c,this.int16[E+10]=f,this.int16[E+11]=v,u}}zn.prototype.bytesPerElement=24,Fi("StructArrayLayout4i4ui4i24",zn);class Oo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.float32[Q+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}Oo.prototype.bytesPerElement=12,Fi("StructArrayLayout3f12",Oo);class yl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint32[1*u+0]=m,u}}yl.prototype.bytesPerElement=4,Fi("StructArrayLayout1ul4",yl);class nl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,W,ne,Ae){const h=this.length;return this.resize(h+1),this.emplace(h,u,m,C,P,Q,V,W,ne,Ae)}emplace(u,m,C,P,Q,V,W,ne,Ae,h){const c=10*u,f=5*u;return this.int16[c+0]=m,this.int16[c+1]=C,this.int16[c+2]=P,this.int16[c+3]=Q,this.int16[c+4]=V,this.int16[c+5]=W,this.uint32[f+3]=ne,this.uint16[c+8]=Ae,this.uint16[c+9]=h,u}}nl.prototype.bytesPerElement=20,Fi("StructArrayLayout6i1ul2ui20",nl);class ka extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const W=this.length;return this.resize(W+1),this.emplace(W,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,W){const ne=6*u;return this.int16[ne+0]=m,this.int16[ne+1]=C,this.int16[ne+2]=P,this.int16[ne+3]=Q,this.int16[ne+4]=V,this.int16[ne+5]=W,u}}ka.prototype.bytesPerElement=12,Fi("StructArrayLayout2i2i2i12",ka);class Yl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q){const V=this.length;return this.resize(V+1),this.emplace(V,u,m,C,P,Q)}emplace(u,m,C,P,Q,V){const W=4*u,ne=8*u;return this.float32[W+0]=m,this.float32[W+1]=C,this.float32[W+2]=P,this.int16[ne+6]=Q,this.int16[ne+7]=V,u}}Yl.prototype.bytesPerElement=16,Fi("StructArrayLayout2f1f2i16",Yl);class fu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=12*u,W=3*u;return this.uint8[V+0]=m,this.uint8[V+1]=C,this.float32[W+1]=P,this.float32[W+2]=Q,u}}fu.prototype.bytesPerElement=12,Fi("StructArrayLayout2ub2f12",fu);class _o extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.uint16[Q+0]=m,this.uint16[Q+1]=C,this.uint16[Q+2]=P,u}}_o.prototype.bytesPerElement=6,Fi("StructArrayLayout3ui6",_o);class xa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G){const K=this.length;return this.resize(K+1),this.emplace(K,u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G)}emplace(u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G,K){const Z=24*u,oe=12*u,de=48*u;return this.int16[Z+0]=m,this.int16[Z+1]=C,this.uint16[Z+2]=P,this.uint16[Z+3]=Q,this.uint32[oe+2]=V,this.uint32[oe+3]=W,this.uint32[oe+4]=ne,this.uint16[Z+10]=Ae,this.uint16[Z+11]=h,this.uint16[Z+12]=c,this.float32[oe+7]=f,this.float32[oe+8]=v,this.uint8[de+36]=E,this.uint8[de+37]=M,this.uint8[de+38]=R,this.uint32[oe+10]=G,this.int16[Z+22]=K,u}}xa.prototype.bytesPerElement=48,Fi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xa);class _l extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut){const et=this.length;return this.resize(et+1),this.emplace(et,u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut)}emplace(u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut,et){const it=32*u,mt=16*u;return this.int16[it+0]=m,this.int16[it+1]=C,this.int16[it+2]=P,this.int16[it+3]=Q,this.int16[it+4]=V,this.int16[it+5]=W,this.int16[it+6]=ne,this.int16[it+7]=Ae,this.uint16[it+8]=h,this.uint16[it+9]=c,this.uint16[it+10]=f,this.uint16[it+11]=v,this.uint16[it+12]=E,this.uint16[it+13]=M,this.uint16[it+14]=R,this.uint16[it+15]=G,this.uint16[it+16]=K,this.uint16[it+17]=Z,this.uint16[it+18]=oe,this.uint16[it+19]=de,this.uint16[it+20]=ye,this.uint16[it+21]=Ce,this.uint16[it+22]=Ie,this.uint32[mt+12]=Oe,this.float32[mt+13]=qe,this.float32[mt+14]=Ke,this.uint16[it+30]=ut,this.uint16[it+31]=et,u}}_l.prototype.bytesPerElement=64,Fi("StructArrayLayout8i15ui1ul2f2ui64",_l);class jr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.float32[1*u+0]=m,u}}jr.prototype.bytesPerElement=4,Fi("StructArrayLayout1f4",jr);class z extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.uint16[6*u+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}z.prototype.bytesPerElement=12,Fi("StructArrayLayout1ui2f12",z);class A extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=4*u;return this.uint32[2*u+0]=m,this.uint16[Q+2]=C,this.uint16[Q+3]=P,u}}A.prototype.bytesPerElement=8,Fi("StructArrayLayout1ul2ui8",A);class x extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.uint16[P+0]=m,this.uint16[P+1]=C,u}}x.prototype.bytesPerElement=4,Fi("StructArrayLayout2ui4",x);class L extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint16[1*u+0]=m,u}}L.prototype.bytesPerElement=2,Fi("StructArrayLayout1ui2",L);class O extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=4*u;return this.float32[V+0]=m,this.float32[V+1]=C,this.float32[V+2]=P,this.float32[V+3]=Q,u}}O.prototype.bytesPerElement=16,Fi("StructArrayLayout4f16",O);class y extends Ki{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class a extends nl{get(u){return new y(this,u)}}Fi("CollisionBoxArray",a);class d extends Ki{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}d.prototype.size=48;class _ extends xa{get(u){return new d(this,u)}}Fi("PlacedSymbolArray",_);class B extends Ki{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}B.prototype.size=64;class T extends _l{get(u){return new B(this,u)}}Fi("SymbolInstanceArray",T);class U extends jr{getoffsetX(u){return this.float32[1*u+0]}}Fi("GlyphOffsetArray",U);class H extends rn{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}Fi("SymbolLineVertexArray",H);class q extends Ki{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}q.prototype.size=12;class w extends z{get(u){return new q(this,u)}}Fi("TextAnchorOffsetArray",w);class I extends Ki{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}I.prototype.size=8;class k extends A{get(u){return new I(this,u)}}Fi("FeatureIndexArray",k);class j extends ks{}class Y extends ks{}class X extends ks{}class ee extends ko{}class re extends du{}class le extends Os{}class pe extends Yr{}class ge extends zn{}class we extends Oo{}class De extends yl{}class Me extends ka{}class st extends fu{}class We extends _o{}class ke extends x{}const Ve=Kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:gt}=Ve;class xt{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=u}prepareSegment(u,m,C,P){let Q=this.segments[this.segments.length-1];return u>xt.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Q||Q.vertexLength+u>xt.MAX_VERTEX_ARRAY_LENGTH||Q.sortKey!==P)&&(Q={vertexOffset:m.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},P!==void 0&&(Q.sortKey=P),this.segments.push(Q)),Q}get(){return this.segments}destroy(){for(const u of this.segments)for(const m in u.vaos)u.vaos[m].destroy()}static simpleSegment(u,m,C,P){return new xt([{vertexOffset:u,primitiveOffset:m,vertexLength:C,primitiveLength:P,vaos:{},sortKey:0}])}}function At(p,u){return 256*(p=Ge(Math.floor(p),0,255))+Ge(Math.floor(u),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fi("SegmentVector",xt);const kt=Kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Rt={exports:{}},Ai={exports:{}};Ai.exports=function(p,u){var m,C,P,Q,V,W,ne,Ae;for(C=p.length-(m=3&p.length),P=u,V=3432918353,W=461845907,Ae=0;Ae<C;)ne=255&p.charCodeAt(Ae)|(255&p.charCodeAt(++Ae))<<8|(255&p.charCodeAt(++Ae))<<16|(255&p.charCodeAt(++Ae))<<24,++Ae,P=27492+(65535&(Q=5*(65535&(P=(P^=ne=(65535&(ne=(ne=(65535&ne)*V+(((ne>>>16)*V&65535)<<16)&4294967295)<<15|ne>>>17))*W+(((ne>>>16)*W&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(ne=0,m){case 3:ne^=(255&p.charCodeAt(Ae+2))<<16;case 2:ne^=(255&p.charCodeAt(Ae+1))<<8;case 1:P^=ne=(65535&(ne=(ne=(65535&(ne^=255&p.charCodeAt(Ae)))*V+(((ne>>>16)*V&65535)<<16)&4294967295)<<15|ne>>>17))*W+(((ne>>>16)*W&65535)<<16)&4294967295}return P^=p.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0};var Ht=Ai.exports,vi={exports:{}};vi.exports=function(p,u){for(var m,C=p.length,P=u^C,Q=0;C>=4;)m=1540483477*(65535&(m=255&p.charCodeAt(Q)|(255&p.charCodeAt(++Q))<<8|(255&p.charCodeAt(++Q))<<16|(255&p.charCodeAt(++Q))<<24))+((1540483477*(m>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),C-=4,++Q;switch(C){case 3:P^=(255&p.charCodeAt(Q+2))<<16;case 2:P^=(255&p.charCodeAt(Q+1))<<8;case 1:P=1540483477*(65535&(P^=255&p.charCodeAt(Q)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0};var Ti=Ht,er=vi.exports;Rt.exports=Ti,Rt.exports.murmur3=Ti,Rt.exports.murmur2=er;var Ii=g(Rt.exports);class _r{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,m,C,P){this.ids.push(pr(u)),this.positions.push(m,C,P)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=pr(u);let C=0,P=this.ids.length-1;for(;C<P;){const V=C+P>>1;this.ids[V]>=m?P=V:C=V+1}const Q=[];for(;this.ids[C]===m;)Q.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return Q}static serialize(u,m){const C=new Float64Array(u.ids),P=new Uint32Array(u.positions);return qi(C,P,0,C.length-1),m&&m.push(C.buffer,P.buffer),{ids:C,positions:P}}static deserialize(u){const m=new _r;return m.ids=u.ids,m.positions=u.positions,m.indexed=!0,m}}function pr(p){const u=+p;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:Ii(String(p))}function qi(p,u,m,C){for(;m<C;){const P=p[m+C>>1];let Q=m-1,V=C+1;for(;;){do Q++;while(p[Q]<P);do V--;while(p[V]>P);if(Q>=V)break;Nr(p,Q,V),Nr(u,3*Q,3*V),Nr(u,3*Q+1,3*V+1),Nr(u,3*Q+2,3*V+2)}V-m<C-V?(qi(p,u,m,V),m=V+1):(qi(p,u,V+1,C),C=V)}}function Nr(p,u,m){const C=p[u];p[u]=p[m],p[m]=C}Fi("FeaturePositionMap",_r);class nn{constructor(u,m){this.gl=u.gl,this.location=m}}class Pr extends nn{constructor(u,m){super(u,m),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Wr extends nn{constructor(u,m){super(u,m),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class Er extends nn{constructor(u,m){super(u,m),this.current=hr.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const is=new Float32Array(16);function zr(p){return[At(255*p.r,255*p.g),At(255*p.b,255*p.a)]}class gr{constructor(u,m,C){this.value=u,this.uniformNames=m.map(P=>`u_${P}`),this.type=C}setUniform(u,m,C){u.set(C.constantOr(this.value))}getBinding(u,m,C){return this.type==="color"?new Er(u,m):new Pr(u,m)}}class vr{constructor(u,m){this.uniformNames=m.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=u.tlbr}setUniform(u,m,C,P){const Q=P==="u_pattern_to"?this.patternTo:P==="u_pattern_from"?this.patternFrom:P==="u_pixel_ratio_to"?this.pixelRatioTo:P==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Q&&u.set(Q)}getBinding(u,m,C){return C.substr(0,9)==="u_pattern"?new Wr(u,m):new Pr(u,m)}}class ar{constructor(u,m,C,P){this.expression=u,this.type=C,this.maxValue=0,this.paintVertexAttributes=m.map(Q=>({name:`a_${Q}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new P}populatePaintArray(u,m,C,P,Q){const V=this.paintVertexArray.length,W=this.expression.evaluate(new _n(0),m,{},P,[],Q);this.paintVertexArray.resize(u),this._setPaintValue(V,u,W)}updatePaintArray(u,m,C,P){const Q=this.expression.evaluate({zoom:0},C,P);this._setPaintValue(u,m,Q)}_setPaintValue(u,m,C){if(this.type==="color"){const P=zr(C);for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,P[0],P[1])}else{for(let P=u;P<m;P++)this.paintVertexArray.emplace(P,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cn{constructor(u,m,C,P,Q,V){this.expression=u,this.uniformNames=m.map(W=>`u_${W}_t`),this.type=C,this.useIntegerZoom=P,this.zoom=Q,this.maxValue=0,this.paintVertexAttributes=m.map(W=>({name:`a_${W}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new V}populatePaintArray(u,m,C,P,Q){const V=this.expression.evaluate(new _n(this.zoom),m,{},P,[],Q),W=this.expression.evaluate(new _n(this.zoom+1),m,{},P,[],Q),ne=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(ne,u,V,W)}updatePaintArray(u,m,C,P){const Q=this.expression.evaluate({zoom:this.zoom},C,P),V=this.expression.evaluate({zoom:this.zoom+1},C,P);this._setPaintValue(u,m,Q,V)}_setPaintValue(u,m,C,P){if(this.type==="color"){const Q=zr(C),V=zr(P);for(let W=u;W<m;W++)this.paintVertexArray.emplace(W,Q[0],Q[1],V[0],V[1])}else{for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,C,P);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(P))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,m){const C=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,P=Ge(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);u.set(P)}getBinding(u,m,C){return new Pr(u,m)}}class $r{constructor(u,m,C,P,Q,V){this.expression=u,this.type=m,this.useIntegerZoom=C,this.zoom=P,this.layerId=V,this.zoomInPaintVertexArray=new Q,this.zoomOutPaintVertexArray=new Q}populatePaintArray(u,m,C){const P=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(P,u,m.patterns&&m.patterns[this.layerId],C)}updatePaintArray(u,m,C,P,Q){this._setPaintValues(u,m,C.patterns&&C.patterns[this.layerId],Q)}_setPaintValues(u,m,C,P){if(!P||!C)return;const{min:Q,mid:V,max:W}=C,ne=P[Q],Ae=P[V],h=P[W];if(ne&&Ae&&h)for(let c=u;c<m;c++)this.zoomInPaintVertexArray.emplace(c,Ae.tl[0],Ae.tl[1],Ae.br[0],Ae.br[1],ne.tl[0],ne.tl[1],ne.br[0],ne.br[1],Ae.pixelRatio,ne.pixelRatio),this.zoomOutPaintVertexArray.emplace(c,Ae.tl[0],Ae.tl[1],Ae.br[0],Ae.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],Ae.pixelRatio,h.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(u,m,C){this.binders={},this._buffers=[];const P=[];for(const Q in u.paint._values){if(!C(Q))continue;const V=u.paint.get(Q);if(!(V instanceof ba&&ct(V.property.specification)))continue;const W=Wn(Q,u.type),ne=V.value,Ae=V.property.specification.type,h=V.property.useIntegerZoom,c=V.property.specification["property-type"],f=c==="cross-faded"||c==="cross-faded-data-driven";if(ne.kind==="constant")this.binders[Q]=f?new vr(ne.value,W):new gr(ne.value,W,Ae),P.push(`/u_${Q}`);else if(ne.kind==="source"||f){const v=vl(Q,Ae,"source");this.binders[Q]=f?new $r(ne,Ae,h,m,v,u.id):new ar(ne,W,Ae,v),P.push(`/a_${Q}`)}else{const v=vl(Q,Ae,"composite");this.binders[Q]=new cn(ne,W,Ae,h,m,v),P.push(`/z_${Q}`)}}this.cacheKey=P.sort().join("")}getMaxValue(u){const m=this.binders[u];return m instanceof ar||m instanceof cn?m.maxValue:0}populatePaintArrays(u,m,C,P,Q){for(const V in this.binders){const W=this.binders[V];(W instanceof ar||W instanceof cn||W instanceof $r)&&W.populatePaintArray(u,m,C,P,Q)}}setConstantPatternPositions(u,m){for(const C in this.binders){const P=this.binders[C];P instanceof vr&&P.setConstantPatternPositions(u,m)}}updatePaintArrays(u,m,C,P,Q){let V=!1;for(const W in u){const ne=m.getPositions(W);for(const Ae of ne){const h=C.feature(Ae.index);for(const c in this.binders){const f=this.binders[c];if((f instanceof ar||f instanceof cn||f instanceof $r)&&f.expression.isStateDependent===!0){const v=P.paint.get(c);f.expression=v.value,f.updatePaintArray(Ae.start,Ae.end,h,u[W],Q),V=!0}}}}return V}defines(){const u=[];for(const m in this.binders){const C=this.binders[m];(C instanceof gr||C instanceof vr)&&u.push(...C.uniformNames.map(P=>`#define HAS_UNIFORM_${P}`))}return u}getBinderAttributes(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof ar||C instanceof cn)for(let P=0;P<C.paintVertexAttributes.length;P++)u.push(C.paintVertexAttributes[P].name);else if(C instanceof $r)for(let P=0;P<kt.members.length;P++)u.push(kt.members[P].name)}return u}getBinderUniforms(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof gr||C instanceof vr||C instanceof cn)for(const P of C.uniformNames)u.push(P)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,m){const C=[];for(const P in this.binders){const Q=this.binders[P];if(Q instanceof gr||Q instanceof vr||Q instanceof cn){for(const V of Q.uniformNames)if(m[V]){const W=Q.getBinding(u,m[V],V);C.push({name:V,property:P,binding:W})}}}return C}setUniforms(u,m,C,P){for(const{name:Q,property:V,binding:W}of m)this.binders[V].setUniform(W,P,C.get(V),Q)}updatePaintBuffers(u){this._buffers=[];for(const m in this.binders){const C=this.binders[m];if(u&&C instanceof $r){const P=u.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;P&&this._buffers.push(P)}else(C instanceof ar||C instanceof cn)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(u){for(const m in this.binders){const C=this.binders[m];(C instanceof ar||C instanceof cn||C instanceof $r)&&C.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const m=this.binders[u];(m instanceof ar||m instanceof cn||m instanceof $r)&&m.destroy()}}}class Fn{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const P of u)this.programConfigurations[P.id]=new Xr(P,m,C);this.needsUpload=!1,this._featureMap=new _r,this._bufferOffset=0}populatePaintArrays(u,m,C,P,Q,V){for(const W in this.programConfigurations)this.programConfigurations[W].populatePaintArrays(u,m,P,Q,V);m.id!==void 0&&this._featureMap.add(m.id,C,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,m,C,P){for(const Q of C)this.needsUpload=this.programConfigurations[Q.id].updatePaintArrays(u,this._featureMap,m,Q,P)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function Wn(p,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${u}-`,"").replace(/-/g,"_")]}function vl(p,u,m){const C={color:{source:Os,composite:O},number:{source:jr,composite:Os}},P=function(Q){return{"line-pattern":{source:pe,composite:pe},"fill-pattern":{source:pe,composite:pe},"fill-extrusion-pattern":{source:pe,composite:pe}}[Q]}(p);return P&&P[m]||C[u][m]}Fi("ConstantBinder",gr),Fi("CrossFadedConstantBinder",vr),Fi("SourceExpressionBinder",ar),Fi("CrossFadedCompositeBinder",$r),Fi("CompositeExpressionBinder",cn),Fi("ProgramConfiguration",Xr,{omit:["_buffers"]}),Fi("ProgramConfigurationSet",Fn);const Kr=8192,vn=Math.pow(2,14)-1,ia=-vn-1;function Us(p){const u=Kr/p.extent,m=p.loadGeometry();for(let C=0;C<m.length;C++){const P=m[C];for(let Q=0;Q<P.length;Q++){const V=P[Q],W=Math.round(V.x*u),ne=Math.round(V.y*u);V.x=Ge(W,ia,vn),V.y=Ge(ne,ia,vn),(W<V.x||W>V.x+1||ne<V.y||ne>V.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function Xs(p,u){return{type:p.type,id:p.id,properties:p.properties,geometry:u?Us(p):[]}}function Uo(p,u,m,C,P){p.emplaceBack(2*u+(C+1)/2,2*m+(P+1)/2)}class ao{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.indexArray=new We,this.segments=new xt,this.programConfigurations=new Fn(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){const P=this.layers[0],Q=[];let V=null,W=!1;P.type==="circle"&&(V=P.layout.get("circle-sort-key"),W=!V.isConstant());for(const{feature:ne,id:Ae,index:h,sourceLayerIndex:c}of u){const f=this.layers[0]._featureFilter.needGeometry,v=Xs(ne,f);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),v,C))continue;const E=W?V.evaluate(v,{},C):void 0,M={id:Ae,properties:ne.properties,type:ne.type,sourceLayerIndex:c,index:h,geometry:f?v.geometry:Us(ne),patterns:{},sortKey:E};Q.push(M)}W&&Q.sort((ne,Ae)=>ne.sortKey-Ae.sortKey);for(const ne of Q){const{geometry:Ae,index:h,sourceLayerIndex:c}=ne,f=u[h].feature;this.addFeature(ne,Ae,h,C),m.featureIndex.insert(f,Ae,h,c,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,gt),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,m,C,P){for(const Q of m)for(const V of Q){const W=V.x,ne=V.y;if(W<0||W>=Kr||ne<0||ne>=Kr)continue;const Ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),h=Ae.vertexLength;Uo(this.layoutVertexArray,W,ne,-1,-1),Uo(this.layoutVertexArray,W,ne,1,-1),Uo(this.layoutVertexArray,W,ne,1,1),Uo(this.layoutVertexArray,W,ne,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),Ae.vertexLength+=4,Ae.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,{},P)}}function zu(p,u){for(let m=0;m<p.length;m++)if(jc(u,p[m]))return!0;for(let m=0;m<u.length;m++)if(jc(p,u[m]))return!0;return!!pu(p,u)}function Oa(p,u,m){return!!jc(p,u)||!!Gc(u,p,m)}function Mn(p,u){if(p.length===1)return sA(u,p[0]);for(let m=0;m<u.length;m++){const C=u[m];for(let P=0;P<C.length;P++)if(jc(p,C[P]))return!0}for(let m=0;m<p.length;m++)if(sA(u,p[m]))return!0;for(let m=0;m<u.length;m++)if(pu(p,u[m]))return!0;return!1}function yc(p,u,m){if(p.length>1){if(pu(p,u))return!0;for(let C=0;C<u.length;C++)if(Gc(u[C],p,m))return!0}for(let C=0;C<p.length;C++)if(Gc(p[C],u,m))return!0;return!1}function pu(p,u){if(p.length===0||u.length===0)return!1;for(let m=0;m<p.length-1;m++){const C=p[m],P=p[m+1];for(let Q=0;Q<u.length-1;Q++)if(Hc(C,P,u[Q],u[Q+1]))return!0}return!1}function Hc(p,u,m,C){return Xe(p,m,C)!==Xe(u,m,C)&&Xe(p,u,m)!==Xe(p,u,C)}function Gc(p,u,m){const C=m*m;if(u.length===1)return p.distSqr(u[0])<C;for(let P=1;P<u.length;P++)if(Qu(p,u[P-1],u[P])<C)return!0;return!1}function Qu(p,u,m){const C=u.distSqr(m);if(C===0)return p.distSqr(u);const P=((p.x-u.x)*(m.x-u.x)+(p.y-u.y)*(m.y-u.y))/C;return p.distSqr(P<0?u:P>1?m:m.sub(u)._mult(P)._add(u))}function sA(p,u){let m,C,P,Q=!1;for(let V=0;V<p.length;V++){m=p[V];for(let W=0,ne=m.length-1;W<m.length;ne=W++)C=m[W],P=m[ne],C.y>u.y!=P.y>u.y&&u.x<(P.x-C.x)*(u.y-C.y)/(P.y-C.y)+C.x&&(Q=!Q)}return Q}function jc(p,u){let m=!1;for(let C=0,P=p.length-1;C<p.length;P=C++){const Q=p[C],V=p[P];Q.y>u.y!=V.y>u.y&&u.x<(V.x-Q.x)*(u.y-Q.y)/(V.y-Q.y)+Q.x&&(m=!m)}return m}function jA(p,u,m){const C=m[0],P=m[2];if(p.x<C.x&&u.x<C.x||p.x>P.x&&u.x>P.x||p.y<C.y&&u.y<C.y||p.y>P.y&&u.y>P.y)return!1;const Q=Xe(p,u,m[0]);return Q!==Xe(p,u,m[1])||Q!==Xe(p,u,m[2])||Q!==Xe(p,u,m[3])}function oA(p,u,m){const C=u.paint.get(p).value;return C.kind==="constant"?C.value:m.programConfigurations.get(u.id).getMaxValue(p)}function kd(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function Vu(p,u,m,C,P){if(!u[0]&&!u[1])return p;const Q=F.convert(u)._mult(P);m==="viewport"&&Q._rotate(-C);const V=[];for(let W=0;W<p.length;W++)V.push(p[W].sub(Q));return V}let gu,Od;Fi("CircleBucket",ao,{omit:["layers"]});var Am={get paint(){return Od=Od||new Ss({"circle-radius":new or(wt.paint_circle["circle-radius"]),"circle-color":new or(wt.paint_circle["circle-color"]),"circle-blur":new or(wt.paint_circle["circle-blur"]),"circle-opacity":new or(wt.paint_circle["circle-opacity"]),"circle-translate":new xi(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new xi(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xi(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xi(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new or(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new or(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new or(wt.paint_circle["circle-stroke-opacity"])})},get layout(){return gu=gu||new Ss({"circle-sort-key":new or(wt.layout_circle["circle-sort-key"])})}},ra=1e-6,ec=typeof Float32Array<"u"?Float32Array:Array;function aA(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function wh(p,u,m){var C=u[0],P=u[1],Q=u[2],V=u[3],W=u[4],ne=u[5],Ae=u[6],h=u[7],c=u[8],f=u[9],v=u[10],E=u[11],M=u[12],R=u[13],G=u[14],K=u[15],Z=m[0],oe=m[1],de=m[2],ye=m[3];return p[0]=Z*C+oe*W+de*c+ye*M,p[1]=Z*P+oe*ne+de*f+ye*R,p[2]=Z*Q+oe*Ae+de*v+ye*G,p[3]=Z*V+oe*h+de*E+ye*K,p[4]=(Z=m[4])*C+(oe=m[5])*W+(de=m[6])*c+(ye=m[7])*M,p[5]=Z*P+oe*ne+de*f+ye*R,p[6]=Z*Q+oe*Ae+de*v+ye*G,p[7]=Z*V+oe*h+de*E+ye*K,p[8]=(Z=m[8])*C+(oe=m[9])*W+(de=m[10])*c+(ye=m[11])*M,p[9]=Z*P+oe*ne+de*f+ye*R,p[10]=Z*Q+oe*Ae+de*v+ye*G,p[11]=Z*V+oe*h+de*E+ye*K,p[12]=(Z=m[12])*C+(oe=m[13])*W+(de=m[14])*c+(ye=m[15])*M,p[13]=Z*P+oe*ne+de*f+ye*R,p[14]=Z*Q+oe*Ae+de*v+ye*G,p[15]=Z*V+oe*h+de*E+ye*K,p}Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)});var mu,Bh=wh;function Ch(p,u,m){var C=u[0],P=u[1],Q=u[2],V=u[3];return p[0]=m[0]*C+m[4]*P+m[8]*Q+m[12]*V,p[1]=m[1]*C+m[5]*P+m[9]*Q+m[13]*V,p[2]=m[2]*C+m[6]*P+m[10]*Q+m[14]*V,p[3]=m[3]*C+m[7]*P+m[11]*Q+m[15]*V,p}mu=new ec(4),ec!=Float32Array&&(mu[0]=0,mu[1]=0,mu[2]=0,mu[3]=0);class lA extends $n{constructor(u){super(u,Am)}createBucket(u){return new ao(u)}queryRadius(u){const m=u;return oA("circle-radius",this,m)+oA("circle-stroke-width",this,m)+kd(this.paint.get("circle-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,W,ne){const Ae=Vu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),V.angle,W),h=this.paint.get("circle-radius").evaluate(m,C)+this.paint.get("circle-stroke-width").evaluate(m,C),c=this.paint.get("circle-pitch-alignment")==="map",f=c?Ae:function(E,M){return E.map(R=>Yf(R,M))}(Ae,ne),v=c?h*W:h;for(const E of P)for(const M of E){const R=c?M:Yf(M,ne);let G=v;const K=Ch([],[M.x,M.y,0,1],ne);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=K[3]/V.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=V.cameraToCenterDistance/K[3]),Oa(f,R,G))return!0}return!1}}function Yf(p,u){const m=Ch([],[p.x,p.y,0,1],u);return new F(m[0]/m[3],m[1]/m[3])}class na extends ao{}let qc;Fi("HeatmapBucket",na,{omit:["layers"]});var Ud={get paint(){return qc=qc||new Ss({"heatmap-radius":new or(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new or(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xi(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xi(wt.paint_heatmap["heatmap-opacity"])})}};function cA(p,u,m,C){let{width:P,height:Q}=u;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==P*Q*m)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${P*Q*m}`)}else C=new Uint8Array(P*Q*m);return p.width=P,p.height=Q,p.data=C,p}function bl(p,u,m){let{width:C,height:P}=u;if(C===p.width&&P===p.height)return;const Q=cA({},{width:C,height:P},m);Nd(p,Q,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,C),height:Math.min(p.height,P)},m),p.width=C,p.height=P,p.data=Q.data}function Nd(p,u,m,C,P,Q){if(P.width===0||P.height===0)return u;if(P.width>p.width||P.height>p.height||m.x>p.width-P.width||m.y>p.height-P.height)throw new RangeError("out of range source coordinates for image copy");if(P.width>u.width||P.height>u.height||C.x>u.width-P.width||C.y>u.height-P.height)throw new RangeError("out of range destination coordinates for image copy");const V=p.data,W=u.data;if(V===W)throw new Error("srcData equals dstData, so image is already copied");for(let ne=0;ne<P.height;ne++){const Ae=((m.y+ne)*p.width+m.x)*Q,h=((C.y+ne)*u.width+C.x)*Q;for(let c=0;c<P.width*Q;c++)W[h+c]=V[Ae+c]}return u}class yu{constructor(u,m){cA(this,u,1,m)}resize(u){bl(this,u,1)}clone(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,P,Q){Nd(u,m,C,P,Q,1)}}class xl{constructor(u,m){cA(this,u,4,m)}resize(u){bl(this,u,4)}replace(u,m){m?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new xl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,P,Q){Nd(u,m,C,P,Q,4)}}function zd(p){const u={},m=p.resolution||256,C=p.clips?p.clips.length:1,P=p.image||new xl({width:m,height:C});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const Q=(V,W,ne)=>{u[p.evaluationKey]=ne;const Ae=p.expression.evaluate(u);P.data[V+W+0]=Math.floor(255*Ae.r/Ae.a),P.data[V+W+1]=Math.floor(255*Ae.g/Ae.a),P.data[V+W+2]=Math.floor(255*Ae.b/Ae.a),P.data[V+W+3]=Math.floor(255*Ae.a)};if(p.clips)for(let V=0,W=0;V<C;++V,W+=4*m)for(let ne=0,Ae=0;ne<m;ne++,Ae+=4){const h=ne/(m-1),{start:c,end:f}=p.clips[V];Q(W,Ae,c*(1-h)+f*h)}else for(let V=0,W=0;V<m;V++,W+=4)Q(0,W,V/(m-1));return P}Fi("AlphaImage",yu),Fi("RGBAImage",xl);class Eh extends $n{createBucket(u){return new na(u)}constructor(u){super(u,Ud),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ep;var dm={get paint(){return ep=ep||new Ss({"hillshade-illumination-direction":new xi(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xi(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xi(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xi(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xi(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xi(wt.paint_hillshade["hillshade-accent-color"])})}};class tp extends $n{constructor(u){super(u,dm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ip=Kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:rp}=ip;var _c={exports:{}};function No(p,u,m){m=m||2;var C,P,Q,V,W,ne,Ae,h=u&&u.length,c=h?u[0]*m:p.length,f=uA(p,0,c,m,!0),v=[];if(!f||f.next===f.prev)return v;if(h&&(f=function(M,R,G,K){var Z,oe,de,ye=[];for(Z=0,oe=R.length;Z<oe;Z++)(de=uA(M,R[Z]*K,Z<oe-1?R[Z+1]*K:M.length,K,!1))===de.next&&(de.steiner=!0),ye.push(op(de));for(ye.sort(sp),Z=0;Z<ye.length;Z++)G=hA(ye[Z],G);return G}(p,u,f,m)),p.length>80*m){C=Q=p[0],P=V=p[1];for(var E=m;E<c;E+=m)(W=p[E])<C&&(C=W),(ne=p[E+1])<P&&(P=ne),W>Q&&(Q=W),ne>V&&(V=ne);Ae=(Ae=Math.max(Q-C,V-P))!==0?32767/Ae:0}return wl(f,v,m,C,P,Ae,0),v}function uA(p,u,m,C,P){var Q,V;if(P===Gd(p,u,m,C)>0)for(Q=u;Q<m;Q+=C)V=$A(Q,p[Q],p[Q+1],V);else for(Q=m-C;Q>=u;Q-=C)V=$A(Q,p[Q],p[Q+1],V);return V&&pm(V,V.next)&&(ap(V),V=V.next),V}function Ua(p,u){if(!p)return p;u||(u=p);var m,C=p;do if(m=!1,C.steiner||!pm(C,C.next)&&Zs(C.prev,C,C.next)!==0)C=C.next;else{if(ap(C),(C=u=C.prev)===C.next)break;m=!0}while(m||C!==u);return u}function wl(p,u,m,C,P,Q,V){if(p){!V&&Q&&function(h,c,f,v){var E=h;do E.z===0&&(E.z=Sh(E.x,E.y,c,f,v)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==h);E.prevZ.nextZ=null,E.prevZ=null,function(M){var R,G,K,Z,oe,de,ye,Ce,Ie=1;do{for(G=M,M=null,oe=null,de=0;G;){for(de++,K=G,ye=0,R=0;R<Ie&&(ye++,K=K.nextZ);R++);for(Ce=Ie;ye>0||Ce>0&&K;)ye!==0&&(Ce===0||!K||G.z<=K.z)?(Z=G,G=G.nextZ,ye--):(Z=K,K=K.nextZ,Ce--),oe?oe.nextZ=Z:M=Z,Z.prevZ=oe,oe=Z;G=K}oe.nextZ=null,Ie*=2}while(de>1)}(E)}(p,C,P,Q);for(var W,ne,Ae=p;p.prev!==p.next;)if(W=p.prev,ne=p.next,Q?Qd(p,C,P,Q):Hu(p))u.push(W.i/m|0),u.push(p.i/m|0),u.push(ne.i/m|0),ap(p),p=ne.next,Ae=ne.next;else if((p=ne)===Ae){V?V===1?wl(p=np(Ua(p),u,m),u,m,C,P,Q,2):V===2&&fm(p,u,m,C,P,Q):wl(Ua(p),u,m,C,P,Q,1);break}}}function Hu(p){var u=p.prev,m=p,C=p.next;if(Zs(u,m,C)>=0)return!1;for(var P=u.x,Q=m.x,V=C.x,W=u.y,ne=m.y,Ae=C.y,h=P<Q?P<V?P:V:Q<V?Q:V,c=W<ne?W<Ae?W:Ae:ne<Ae?ne:Ae,f=P>Q?P>V?P:V:Q>V?Q:V,v=W>ne?W>Ae?W:Ae:ne>Ae?ne:Ae,E=C.next;E!==u;){if(E.x>=h&&E.x<=f&&E.y>=c&&E.y<=v&&Hd(P,W,Q,ne,V,Ae,E.x,E.y)&&Zs(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Qd(p,u,m,C){var P=p.prev,Q=p,V=p.next;if(Zs(P,Q,V)>=0)return!1;for(var W=P.x,ne=Q.x,Ae=V.x,h=P.y,c=Q.y,f=V.y,v=W<ne?W<Ae?W:Ae:ne<Ae?ne:Ae,E=h<c?h<f?h:f:c<f?c:f,M=W>ne?W>Ae?W:Ae:ne>Ae?ne:Ae,R=h>c?h>f?h:f:c>f?c:f,G=Sh(v,E,u,m,C),K=Sh(M,R,u,m,C),Z=p.prevZ,oe=p.nextZ;Z&&Z.z>=G&&oe&&oe.z<=K;){if(Z.x>=v&&Z.x<=M&&Z.y>=E&&Z.y<=R&&Z!==P&&Z!==V&&Hd(W,h,ne,c,Ae,f,Z.x,Z.y)&&Zs(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,oe.x>=v&&oe.x<=M&&oe.y>=E&&oe.y<=R&&oe!==P&&oe!==V&&Hd(W,h,ne,c,Ae,f,oe.x,oe.y)&&Zs(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Z&&Z.z>=G;){if(Z.x>=v&&Z.x<=M&&Z.y>=E&&Z.y<=R&&Z!==P&&Z!==V&&Hd(W,h,ne,c,Ae,f,Z.x,Z.y)&&Zs(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;oe&&oe.z<=K;){if(oe.x>=v&&oe.x<=M&&oe.y>=E&&oe.y<=R&&oe!==P&&oe!==V&&Hd(W,h,ne,c,Ae,f,oe.x,oe.y)&&Zs(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function np(p,u,m){var C=p;do{var P=C.prev,Q=C.next.next;!pm(P,Q)&&ox(P,C,C.next,Q)&&qA(P,Q)&&qA(Q,P)&&(u.push(P.i/m|0),u.push(C.i/m|0),u.push(Q.i/m|0),ap(C),ap(C.next),C=p=Q),C=C.next}while(C!==p);return Ua(C)}function fm(p,u,m,C,P,Q){var V=p;do{for(var W=V.next.next;W!==V.prev;){if(V.i!==W.i&&fI(V,W)){var ne=ax(V,W);return V=Ua(V,V.next),ne=Ua(ne,ne.next),wl(V,u,m,C,P,Q,0),void wl(ne,u,m,C,P,Q,0)}W=W.next}V=V.next}while(V!==p)}function sp(p,u){return p.x-u.x}function hA(p,u){var m=function(P,Q){var V,W=Q,ne=P.x,Ae=P.y,h=-1/0;do{if(Ae<=W.y&&Ae>=W.next.y&&W.next.y!==W.y){var c=W.x+(Ae-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(c<=ne&&c>h&&(h=c,V=W.x<W.next.x?W:W.next,c===ne))return V}W=W.next}while(W!==Q);if(!V)return null;var f,v=V,E=V.x,M=V.y,R=1/0;W=V;do ne>=W.x&&W.x>=E&&ne!==W.x&&Hd(Ae<M?ne:h,Ae,E,M,Ae<M?h:ne,Ae,W.x,W.y)&&(f=Math.abs(Ae-W.y)/(ne-W.x),qA(W,P)&&(f<R||f===R&&(W.x>V.x||W.x===V.x&&Vd(V,W)))&&(V=W,R=f)),W=W.next;while(W!==v);return V}(p,u);if(!m)return u;var C=ax(m,p);return Ua(C,C.next),Ua(m,m.next)}function Vd(p,u){return Zs(p.prev,p,u.prev)<0&&Zs(u.next,p,p.next)<0}function Sh(p,u,m,C,P){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-m)*P|0)|p<<8))|p<<4))|p<<2))|p<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-C)*P|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function op(p){var u=p,m=p;do(u.x<m.x||u.x===m.x&&u.y<m.y)&&(m=u),u=u.next;while(u!==p);return m}function Hd(p,u,m,C,P,Q,V,W){return(P-V)*(u-W)>=(p-V)*(Q-W)&&(p-V)*(C-W)>=(m-V)*(u-W)&&(m-V)*(Q-W)>=(P-V)*(C-W)}function fI(p,u){return p.next.i!==u.i&&p.prev.i!==u.i&&!function(m,C){var P=m;do{if(P.i!==m.i&&P.next.i!==m.i&&P.i!==C.i&&P.next.i!==C.i&&ox(P,P.next,m,C))return!0;P=P.next}while(P!==m);return!1}(p,u)&&(qA(p,u)&&qA(u,p)&&function(m,C){var P=m,Q=!1,V=(m.x+C.x)/2,W=(m.y+C.y)/2;do P.y>W!=P.next.y>W&&P.next.y!==P.y&&V<(P.next.x-P.x)*(W-P.y)/(P.next.y-P.y)+P.x&&(Q=!Q),P=P.next;while(P!==m);return Q}(p,u)&&(Zs(p.prev,p,u.prev)||Zs(p,u.prev,u))||pm(p,u)&&Zs(p.prev,p,p.next)>0&&Zs(u.prev,u,u.next)>0)}function Zs(p,u,m){return(u.y-p.y)*(m.x-u.x)-(u.x-p.x)*(m.y-u.y)}function pm(p,u){return p.x===u.x&&p.y===u.y}function ox(p,u,m,C){var P=mm(Zs(p,u,m)),Q=mm(Zs(p,u,C)),V=mm(Zs(m,C,p)),W=mm(Zs(m,C,u));return P!==Q&&V!==W||!(P!==0||!gm(p,m,u))||!(Q!==0||!gm(p,C,u))||!(V!==0||!gm(m,p,C))||!(W!==0||!gm(m,u,C))}function gm(p,u,m){return u.x<=Math.max(p.x,m.x)&&u.x>=Math.min(p.x,m.x)&&u.y<=Math.max(p.y,m.y)&&u.y>=Math.min(p.y,m.y)}function mm(p){return p>0?1:p<0?-1:0}function qA(p,u){return Zs(p.prev,p,p.next)<0?Zs(p,u,p.next)>=0&&Zs(p,p.prev,u)>=0:Zs(p,u,p.prev)<0||Zs(p,p.next,u)<0}function ax(p,u){var m=new Ns(p.i,p.x,p.y),C=new Ns(u.i,u.x,u.y),P=p.next,Q=u.prev;return p.next=u,u.prev=p,m.next=P,P.prev=m,C.next=m,m.prev=C,Q.next=C,C.prev=Q,C}function $A(p,u,m,C){var P=new Ns(p,u,m);return C?(P.next=C.next,P.prev=C,C.next.prev=P,C.next=P):(P.prev=P,P.next=P),P}function ap(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Ns(p,u,m){this.i=p,this.x=u,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gd(p,u,m,C){for(var P=0,Q=u,V=m-C;Q<m;Q+=C)P+=(p[V]-p[Q])*(p[Q+1]+p[V+1]),V=Q;return P}_c.exports=No,_c.exports.default=No,No.deviation=function(p,u,m,C){var P=u&&u.length,Q=Math.abs(Gd(p,0,P?u[0]*m:p.length,m));if(P)for(var V=0,W=u.length;V<W;V++)Q-=Math.abs(Gd(p,u[V]*m,V<W-1?u[V+1]*m:p.length,m));var ne=0;for(V=0;V<C.length;V+=3){var Ae=C[V]*m,h=C[V+1]*m,c=C[V+2]*m;ne+=Math.abs((p[Ae]-p[c])*(p[h+1]-p[Ae+1])-(p[Ae]-p[h])*(p[c+1]-p[Ae+1]))}return Q===0&&ne===0?0:Math.abs((ne-Q)/Q)},No.flatten=function(p){for(var u=p[0][0].length,m={vertices:[],holes:[],dimensions:u},C=0,P=0;P<p.length;P++){for(var Q=0;Q<p[P].length;Q++)for(var V=0;V<u;V++)m.vertices.push(p[P][Q][V]);P>0&&m.holes.push(C+=p[P-1].length)}return m};var U0=g(_c.exports);function ym(p,u,m,C,P){lp(p,u,m||0,C||p.length-1,P||lx)}function lp(p,u,m,C,P){for(;C>m;){if(C-m>600){var Q=C-m+1,V=u-m+1,W=Math.log(Q),ne=.5*Math.exp(2*W/3),Ae=.5*Math.sqrt(W*ne*(Q-ne)/Q)*(V-Q/2<0?-1:1);lp(p,u,Math.max(m,Math.floor(u-V*ne/Q+Ae)),Math.min(C,Math.floor(u+(Q-V)*ne/Q+Ae)),P)}var h=p[u],c=m,f=C;for(Th(p,m,u),P(p[C],h)>0&&Th(p,m,C);c<f;){for(Th(p,c,f),c++,f--;P(p[c],h)<0;)c++;for(;P(p[f],h)>0;)f--}P(p[m],h)===0?Th(p,m,f):Th(p,++f,C),f<=u&&(m=f+1),u<=f&&(C=f-1)}}function Th(p,u,m){var C=p[u];p[u]=p[m],p[m]=C}function lx(p,u){return p<u?-1:p>u?1:0}function _m(p,u){const m=p.length;if(m<=1)return[p];const C=[];let P,Q;for(let V=0;V<m;V++){const W=Ct(p[V]);W!==0&&(p[V].area=Math.abs(W),Q===void 0&&(Q=W<0),Q===W<0?(P&&C.push(P),P=[p[V]]):P.push(p[V]))}if(P&&C.push(P),u>1)for(let V=0;V<C.length;V++)C[V].length<=u||(ym(C[V],u,1,C[V].length-1,cp),C[V]=C[V].slice(0,u));return C}function cp(p,u){return u.area-p.area}function up(p,u,m){const C=m.patternDependencies;let P=!1;for(const Q of u){const V=Q.paint.get(`${p}-pattern`);V.isConstant()||(P=!0);const W=V.constantOr(null);W&&(P=!0,C[W.to]=!0,C[W.from]=!0)}return P}function hp(p,u,m,C,P){const Q=P.patternDependencies;for(const V of u){const W=V.paint.get(`${p}-pattern`).value;if(W.kind!=="constant"){let ne=W.evaluate({zoom:C-1},m,{},P.availableImages),Ae=W.evaluate({zoom:C},m,{},P.availableImages),h=W.evaluate({zoom:C+1},m,{},P.availableImages);ne=ne&&ne.name?ne.name:ne,Ae=Ae&&Ae.name?Ae.name:Ae,h=h&&h.name?h.name:h,Q[ne]=!0,Q[Ae]=!0,Q[h]=!0,m.patterns[V.id]={min:ne,mid:Ae,max:h}}}return m}class vm{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new X,this.indexArray=new We,this.indexArray2=new ke,this.programConfigurations=new Fn(u.layers,u.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=up("fill",this.layers,m);const P=this.layers[0].layout.get("fill-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:W,id:ne,index:Ae,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,f=Xs(W,c);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C,m.availableImages):void 0,E={id:ne,properties:W.properties,type:W.type,sourceLayerIndex:h,index:Ae,geometry:c?f.geometry:Us(W),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((W,ne)=>W.sortKey-ne.sortKey);for(const W of V){const{geometry:ne,index:Ae,sourceLayerIndex:h}=W;if(this.hasPattern){const c=hp("fill",this.layers,W,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(W,ne,Ae,C,{});m.featureIndex.insert(u[Ae].feature,ne,Ae,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,rp),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,m,C,P,Q){for(const V of _m(m,500)){let W=0;for(const v of V)W+=v.length;const ne=this.segments.prepareSegment(W,this.layoutVertexArray,this.indexArray),Ae=ne.vertexLength,h=[],c=[];for(const v of V){if(v.length===0)continue;v!==V[0]&&c.push(h.length/2);const E=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),M=E.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(M+v.length-1,M),h.push(v[0].x),h.push(v[0].y);for(let R=1;R<v.length;R++)this.layoutVertexArray.emplaceBack(v[R].x,v[R].y),this.indexArray2.emplaceBack(M+R-1,M+R),h.push(v[R].x),h.push(v[R].y);E.vertexLength+=v.length,E.primitiveLength+=v.length}const f=U0(h,c);for(let v=0;v<f.length;v+=3)this.indexArray.emplaceBack(Ae+f[v],Ae+f[v+1],Ae+f[v+2]);ne.vertexLength+=W,ne.primitiveLength+=f.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}let cx,N0;Fi("FillBucket",vm,{omit:["layers","patternFeatures"]});var Ap={get paint(){return N0=N0||new Ss({"fill-antialias":new xi(wt.paint_fill["fill-antialias"]),"fill-opacity":new or(wt.paint_fill["fill-opacity"]),"fill-color":new or(wt.paint_fill["fill-color"]),"fill-outline-color":new or(wt.paint_fill["fill-outline-color"]),"fill-translate":new xi(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new xi(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Jl(wt.paint_fill["fill-pattern"])})},get layout(){return cx=cx||new Ss({"fill-sort-key":new or(wt.layout_fill["fill-sort-key"])})}};class pI extends $n{constructor(u){super(u,Ap)}recalculate(u,m){super.recalculate(u,m);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new vm(u)}queryRadius(){return kd(this.paint.get("fill-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,W){return Mn(Vu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),V.angle,W),P)}isTileClipped(){return!0}}const z0=Kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gI=Kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Q0}=z0;var Gu={},V0=b,H0=KA;function KA(p,u,m,C,P){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=C,this._values=P,p.readFields(mI,this,u)}function mI(p,u,m){p==1?u.id=m.readVarint():p==2?function(C,P){for(var Q=C.readVarint()+C.pos;C.pos<Q;){var V=P._keys[C.readVarint()],W=P._values[C.readVarint()];P.properties[V]=W}}(m,u):p==3?u.type=m.readVarint():p==4&&(u._geometry=m.pos)}function yI(p){for(var u,m,C=0,P=0,Q=p.length,V=Q-1;P<Q;V=P++)C+=((m=p[V]).x-(u=p[P]).x)*(u.y+m.y);return C}KA.types=["Unknown","Point","LineString","Polygon"],KA.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,m=p.readVarint()+p.pos,C=1,P=0,Q=0,V=0,W=[];p.pos<m;){if(P<=0){var ne=p.readVarint();C=7&ne,P=ne>>3}if(P--,C===1||C===2)Q+=p.readSVarint(),V+=p.readSVarint(),C===1&&(u&&W.push(u),u=[]),u.push(new V0(Q,V));else{if(C!==7)throw new Error("unknown command "+C);u&&u.push(u[0].clone())}}return u&&W.push(u),W},KA.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,m=1,C=0,P=0,Q=0,V=1/0,W=-1/0,ne=1/0,Ae=-1/0;p.pos<u;){if(C<=0){var h=p.readVarint();m=7&h,C=h>>3}if(C--,m===1||m===2)(P+=p.readSVarint())<V&&(V=P),P>W&&(W=P),(Q+=p.readSVarint())<ne&&(ne=Q),Q>Ae&&(Ae=Q);else if(m!==7)throw new Error("unknown command "+m)}return[V,ne,W,Ae]},KA.prototype.toGeoJSON=function(p,u,m){var C,P,Q=this.extent*Math.pow(2,m),V=this.extent*p,W=this.extent*u,ne=this.loadGeometry(),Ae=KA.types[this.type];function h(v){for(var E=0;E<v.length;E++){var M=v[E];v[E]=[360*(M.x+V)/Q-180,360/Math.PI*Math.atan(Math.exp((180-360*(M.y+W)/Q)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(C=0;C<ne.length;C++)c[C]=ne[C][0];h(ne=c);break;case 2:for(C=0;C<ne.length;C++)h(ne[C]);break;case 3:for(ne=function(v){var E=v.length;if(E<=1)return[v];for(var M,R,G=[],K=0;K<E;K++){var Z=yI(v[K]);Z!==0&&(R===void 0&&(R=Z<0),R===Z<0?(M&&G.push(M),M=[v[K]]):M.push(v[K]))}return M&&G.push(M),G}(ne),C=0;C<ne.length;C++)for(P=0;P<ne[C].length;P++)h(ne[C][P])}ne.length===1?ne=ne[0]:Ae="Multi"+Ae;var f={type:"Feature",geometry:{type:Ae,coordinates:ne},properties:this.properties};return"id"in this&&(f.id=this.id),f};var _I=H0,ux=hx;function hx(p,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(AA,this,u),this.length=this._features.length}function AA(p,u,m){p===15?u.version=m.readVarint():p===1?u.name=m.readString():p===5?u.extent=m.readVarint():p===2?u._features.push(m.pos):p===3?u._keys.push(m.readString()):p===4&&u._values.push(function(C){for(var P=null,Q=C.readVarint()+C.pos;C.pos<Q;){var V=C.readVarint()>>3;P=V===1?C.readString():V===2?C.readFloat():V===3?C.readDouble():V===4?C.readVarint64():V===5?C.readVarint():V===6?C.readSVarint():V===7?C.readBoolean():null}return P}(m))}hx.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var u=this._pbf.readVarint()+this._pbf.pos;return new _I(this._pbf,u,this.extent,this._keys,this._values)};var vI=ux;function Ax(p,u,m){if(p===3){var C=new vI(m,m.readVarint()+m.pos);C.length&&(u[C.name]=C)}}Gu.VectorTile=function(p,u){this.layers=p.readFields(Ax,{},u)},Gu.VectorTileFeature=H0,Gu.VectorTileLayer=ux;const jd=Gu.VectorTileFeature.types,G0=Math.pow(2,13);function dp(p,u,m,C,P,Q,V,W){p.emplaceBack(u,m,2*Math.floor(C*G0)+V,P*G0*2,Q*G0*2,Math.round(W))}class j0{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new ee,this.centroidVertexArray=new j,this.indexArray=new We,this.programConfigurations=new Fn(u.layers,u.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.features=[],this.hasPattern=up("fill-extrusion",this.layers,m);for(const{feature:P,id:Q,index:V,sourceLayerIndex:W}of u){const ne=this.layers[0]._featureFilter.needGeometry,Ae=Xs(P,ne);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),Ae,C))continue;const h={id:Q,sourceLayerIndex:W,index:V,geometry:ne?Ae.geometry:Us(P),properties:P.properties,type:P.type,patterns:{}};this.hasPattern?this.features.push(hp("fill-extrusion",this.layers,h,this.zoom,m)):this.addFeature(h,h.geometry,V,C,{}),m.featureIndex.insert(P,h.geometry,V,W,this.index,!0)}}addFeatures(u,m,C){for(const P of this.features){const{geometry:Q}=P;this.addFeature(P,Q,P.index,m,C)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Q0),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,gI.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,m,C,P,Q){const V={x:0,y:0,vertexCount:0};for(const W of _m(m,500)){let ne=0;for(const E of W)ne+=E.length;let Ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const E of W){if(E.length===0||fx(E))continue;let M=0;for(let R=0;R<E.length;R++){const G=E[R];if(R>=1){const K=E[R-1];if(!dx(G,K)){Ae.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(Ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Z=G.sub(K)._perp()._unit(),oe=K.dist(G);M+oe>32768&&(M=0),dp(this.layoutVertexArray,G.x,G.y,Z.x,Z.y,0,0,M),dp(this.layoutVertexArray,G.x,G.y,Z.x,Z.y,0,1,M),V.x+=2*G.x,V.y+=2*G.y,V.vertexCount+=2,M+=oe,dp(this.layoutVertexArray,K.x,K.y,Z.x,Z.y,0,0,M),dp(this.layoutVertexArray,K.x,K.y,Z.x,Z.y,0,1,M),V.x+=2*K.x,V.y+=2*K.y,V.vertexCount+=2;const de=Ae.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),Ae.vertexLength+=4,Ae.primitiveLength+=2}}}}if(Ae.vertexLength+ne>xt.MAX_VERTEX_ARRAY_LENGTH&&(Ae=this.segments.prepareSegment(ne,this.layoutVertexArray,this.indexArray)),jd[u.type]!=="Polygon")continue;const h=[],c=[],f=Ae.vertexLength;for(const E of W)if(E.length!==0){E!==W[0]&&c.push(h.length/2);for(let M=0;M<E.length;M++){const R=E[M];dp(this.layoutVertexArray,R.x,R.y,0,0,1,1,0),V.x+=R.x,V.y+=R.y,V.vertexCount+=1,h.push(R.x),h.push(R.y)}}const v=U0(h,c);for(let E=0;E<v.length;E+=3)this.indexArray.emplaceBack(f+v[E],f+v[E+2],f+v[E+1]);Ae.primitiveLength+=v.length/3,Ae.vertexLength+=ne}for(let W=0;W<V.vertexCount;W++)this.centroidVertexArray.emplaceBack(Math.floor(V.x/V.vertexCount),Math.floor(V.y/V.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}function dx(p,u){return p.x===u.x&&(p.x<0||p.x>Kr)||p.y===u.y&&(p.y<0||p.y>Kr)}function fx(p){return p.every(u=>u.x<0)||p.every(u=>u.x>Kr)||p.every(u=>u.y<0)||p.every(u=>u.y>Kr)}let px;Fi("FillExtrusionBucket",j0,{omit:["layers","features"]});var bI={get paint(){return px=px||new Ss({"fill-extrusion-opacity":new xi(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new or(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xi(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xi(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Jl(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new or(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new or(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xi(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xI extends $n{constructor(u){super(u,bI)}createBucket(u){return new j0(u)}queryRadius(){return kd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,m,C,P,Q,V,W,ne){const Ae=Vu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),V.angle,W),h=this.paint.get("fill-extrusion-height").evaluate(m,C),c=this.paint.get("fill-extrusion-base").evaluate(m,C),f=function(E,M,R,G){const K=[];for(const Z of E){const oe=[Z.x,Z.y,0,1];Ch(oe,oe,M),K.push(new F(oe[0]/oe[3],oe[1]/oe[3]))}return K}(Ae,ne),v=function(E,M,R,G){const K=[],Z=[],oe=G[8]*M,de=G[9]*M,ye=G[10]*M,Ce=G[11]*M,Ie=G[8]*R,Oe=G[9]*R,qe=G[10]*R,Ke=G[11]*R;for(const ut of E){const et=[],it=[];for(const mt of ut){const Tt=mt.x,Zt=mt.y,wi=G[0]*Tt+G[4]*Zt+G[12],ai=G[1]*Tt+G[5]*Zt+G[13],di=G[2]*Tt+G[6]*Zt+G[14],pi=G[3]*Tt+G[7]*Zt+G[15],Di=di+ye,li=pi+Ce,Jt=wi+Ie,Hi=ai+Oe,Vi=di+qe,mr=pi+Ke,Rr=new F((wi+oe)/li,(ai+de)/li);Rr.z=Di/li,et.push(Rr);const Qr=new F(Jt/mr,Hi/mr);Qr.z=Vi/mr,it.push(Qr)}K.push(et),Z.push(it)}return[K,Z]}(P,c,h,ne);return function(E,M,R){let G=1/0;Mn(R,M)&&(G=bm(R,M[0]));for(let K=0;K<M.length;K++){const Z=M[K],oe=E[K];for(let de=0;de<Z.length-1;de++){const ye=Z[de],Ce=[ye,Z[de+1],oe[de+1],oe[de],ye];zu(R,Ce)&&(G=Math.min(G,bm(R,Ce)))}}return G!==1/0&&G}(v[0],v[1],f)}}function fp(p,u){return p.x*u.x+p.y*u.y}function bm(p,u){if(p.length===1){let m=0;const C=u[m++];let P;for(;!P||C.equals(P);)if(P=u[m++],!P)return 1/0;for(;m<u.length;m++){const Q=u[m],V=p[0],W=P.sub(C),ne=Q.sub(C),Ae=V.sub(C),h=fp(W,W),c=fp(W,ne),f=fp(ne,ne),v=fp(Ae,W),E=fp(Ae,ne),M=h*f-c*c,R=(f*v-c*E)/M,G=(h*E-c*v)/M,K=C.z*(1-R-G)+P.z*R+Q.z*G;if(isFinite(K))return K}return 1/0}{let m=1/0;for(const C of u)m=Math.min(m,C.z);return m}}const pp=Kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:q0}=pp,wI=Kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:BI}=wI,gx=Gu.VectorTileFeature.types,CI=Math.cos(Math.PI/180*37.5),mx=Math.pow(2,14)/.5;class WA{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new re,this.layoutVertexArray2=new le,this.indexArray=new We,this.programConfigurations=new Fn(u.layers,u.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=up("line",this.layers,m);const P=this.layers[0].layout.get("line-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:W,id:ne,index:Ae,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,f=Xs(W,c);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C):void 0,E={id:ne,properties:W.properties,type:W.type,sourceLayerIndex:h,index:Ae,geometry:c?f.geometry:Us(W),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((W,ne)=>W.sortKey-ne.sortKey);for(const W of V){const{geometry:ne,index:Ae,sourceLayerIndex:h}=W;if(this.hasPattern){const c=hp("line",this.layers,W,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(W,ne,Ae,C,{});m.featureIndex.insert(u[Ae].feature,ne,Ae,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,BI)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,q0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,m,C,P,Q){const V=this.layers[0].layout,W=V.get("line-join").evaluate(u,{}),ne=V.get("line-cap"),Ae=V.get("line-miter-limit"),h=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const c of m)this.addLine(c,u,W,ne,Ae,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}addLine(u,m,C,P,Q,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<u.length-1;G++)this.totalDistance+=u[G].dist(u[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const W=gx[m.type]==="Polygon";let ne=u.length;for(;ne>=2&&u[ne-1].equals(u[ne-2]);)ne--;let Ae=0;for(;Ae<ne-1&&u[Ae].equals(u[Ae+1]);)Ae++;if(ne<(W?3:2))return;C==="bevel"&&(Q=1.05);const h=this.overscaling<=16?15*Kr/(512*this.overscaling):0,c=this.segments.prepareSegment(10*ne,this.layoutVertexArray,this.indexArray);let f,v,E,M,R;this.e1=this.e2=-1,W&&(f=u[ne-2],R=u[Ae].sub(f)._unit()._perp());for(let G=Ae;G<ne;G++){if(E=G===ne-1?W?u[Ae+1]:void 0:u[G+1],E&&u[G].equals(E))continue;R&&(M=R),f&&(v=f),f=u[G],R=E?E.sub(f)._unit()._perp():M,M=M||R;let K=M.add(R);K.x===0&&K.y===0||K._unit();const Z=M.x*R.x+M.y*R.y,oe=K.x*R.x+K.y*R.y,de=oe!==0?1/oe:1/0,ye=2*Math.sqrt(2-2*oe),Ce=oe<CI&&v&&E,Ie=M.x*R.y-M.y*R.x>0;if(Ce&&G>Ae){const Ke=f.dist(v);if(Ke>2*h){const ut=f.sub(f.sub(v)._mult(h/Ke)._round());this.updateDistance(v,ut),this.addCurrentVertex(ut,M,0,0,c),v=ut}}const Oe=v&&E;let qe=Oe?C:W?"butt":P;if(Oe&&qe==="round"&&(de<V?qe="miter":de<=2&&(qe="fakeround")),qe==="miter"&&de>Q&&(qe="bevel"),qe==="bevel"&&(de>2&&(qe="flipbevel"),de<Q&&(qe="miter")),v&&this.updateDistance(v,f),qe==="miter")K._mult(de),this.addCurrentVertex(f,K,0,0,c);else if(qe==="flipbevel"){if(de>100)K=R.mult(-1);else{const Ke=de*M.add(R).mag()/M.sub(R).mag();K._perp()._mult(Ke*(Ie?-1:1))}this.addCurrentVertex(f,K,0,0,c),this.addCurrentVertex(f,K.mult(-1),0,0,c)}else if(qe==="bevel"||qe==="fakeround"){const Ke=-Math.sqrt(de*de-1),ut=Ie?Ke:0,et=Ie?0:Ke;if(v&&this.addCurrentVertex(f,M,ut,et,c),qe==="fakeround"){const it=Math.round(180*ye/Math.PI/20);for(let mt=1;mt<it;mt++){let Tt=mt/it;if(Tt!==.5){const wi=Tt-.5;Tt+=Tt*wi*(Tt-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*wi*wi+(.848013+Z*(.215638*Z-1.06021)))}const Zt=R.sub(M)._mult(Tt)._add(M)._unit()._mult(Ie?-1:1);this.addHalfVertex(f,Zt.x,Zt.y,!1,Ie,0,c)}}E&&this.addCurrentVertex(f,R,-ut,-et,c)}else if(qe==="butt")this.addCurrentVertex(f,K,0,0,c);else if(qe==="square"){const Ke=v?1:-1;this.addCurrentVertex(f,K,Ke,Ke,c)}else qe==="round"&&(v&&(this.addCurrentVertex(f,M,0,0,c),this.addCurrentVertex(f,M,1,1,c,!0)),E&&(this.addCurrentVertex(f,R,-1,-1,c,!0),this.addCurrentVertex(f,R,0,0,c)));if(Ce&&G<ne-1){const Ke=f.dist(E);if(Ke>2*h){const ut=f.add(E.sub(f)._mult(h/Ke)._round());this.updateDistance(f,ut),this.addCurrentVertex(ut,R,0,0,c),f=ut}}}}addCurrentVertex(u,m,C,P,Q){let V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const W=m.y*P-m.x,ne=-m.y-m.x*P;this.addHalfVertex(u,m.x+m.y*C,m.y-m.x*C,V,!1,C,Q),this.addHalfVertex(u,W,ne,V,!0,-P,Q),this.distance>mx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,m,C,P,Q,V))}addHalfVertex(u,m,C,P,Q,V,W){let{x:ne,y:Ae}=u;const h=.5*(this.lineClips?this.scaledDistance*(mx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((ne<<1)+(P?1:0),(Ae<<1)+(Q?1:0),Math.round(63*m)+128,Math.round(63*C)+128,1+(V===0?0:V<0?-1:1)|(63&h)<<2,h>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=W.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),W.primitiveLength++),Q?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,m){this.distance+=u.dist(m),this.updateScaledDistance()}}let $0,yx;Fi("LineBucket",WA,{omit:["layers","patternFeatures"]});var _x={get paint(){return yx=yx||new Ss({"line-opacity":new or(wt.paint_line["line-opacity"]),"line-color":new or(wt.paint_line["line-color"]),"line-translate":new xi(wt.paint_line["line-translate"]),"line-translate-anchor":new xi(wt.paint_line["line-translate-anchor"]),"line-width":new or(wt.paint_line["line-width"]),"line-gap-width":new or(wt.paint_line["line-gap-width"]),"line-offset":new or(wt.paint_line["line-offset"]),"line-blur":new or(wt.paint_line["line-blur"]),"line-dasharray":new Qc(wt.paint_line["line-dasharray"]),"line-pattern":new Jl(wt.paint_line["line-pattern"]),"line-gradient":new Vc(wt.paint_line["line-gradient"])})},get layout(){return $0=$0||new Ss({"line-cap":new xi(wt.layout_line["line-cap"]),"line-join":new or(wt.layout_line["line-join"]),"line-miter-limit":new xi(wt.layout_line["line-miter-limit"]),"line-round-limit":new xi(wt.layout_line["line-round-limit"]),"line-sort-key":new or(wt.layout_line["line-sort-key"])})}};class EI extends or{possiblyEvaluate(u,m){return m=new _n(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(u,m)}evaluate(u,m,C,P){return m=$e({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(u,m,C,P)}}let xm;class SI extends $n{constructor(u){super(u,_x),this.gradientVersion=0,xm||(xm=new EI(_x.paint.properties["line-width"].specification),xm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Ia,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,m){super.recalculate(u,m),this.paint._values["line-floorwidth"]=xm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new WA(u)}queryRadius(u){const m=u,C=vx(oA("line-width",this,m),oA("line-gap-width",this,m)),P=oA("line-offset",this,m);return C/2+Math.abs(P)+kd(this.paint.get("line-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,W){const ne=Vu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),V.angle,W),Ae=W/2*vx(this.paint.get("line-width").evaluate(m,C),this.paint.get("line-gap-width").evaluate(m,C)),h=this.paint.get("line-offset").evaluate(m,C);return h&&(P=function(c,f){const v=[];for(let E=0;E<c.length;E++){const M=c[E],R=[];for(let G=0;G<M.length;G++){const K=M[G-1],Z=M[G],oe=M[G+1],de=G===0?new F(0,0):Z.sub(K)._unit()._perp(),ye=G===M.length-1?new F(0,0):oe.sub(Z)._unit()._perp(),Ce=de._add(ye)._unit(),Ie=Ce.x*ye.x+Ce.y*ye.y;Ie!==0&&Ce._mult(1/Ie),R.push(Ce._mult(f)._add(Z))}v.push(R)}return v}(P,h*W)),function(c,f,v){for(let E=0;E<f.length;E++){const M=f[E];if(c.length>=3){for(let R=0;R<M.length;R++)if(jc(c,M[R]))return!0}if(yc(c,M,v))return!0}return!1}(ne,P,Ae)}isTileClipped(){return!0}}function vx(p,u){return u>0?u+2*p:p}const bx=Kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K0=Kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xx=Kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W0=Kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wx=Kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function TI(p,u,m){return p.sections.forEach(C=>{C.text=function(P,Q,V){const W=Q.layout.get("text-transform").evaluate(V,{});return W==="uppercase"?P=P.toLocaleUpperCase():W==="lowercase"&&(P=P.toLocaleLowerCase()),rl.applyArabicShaping&&(P=rl.applyArabicShaping(P)),P}(C.text,u,m)}),p}Kn([{name:"triangle",components:3,type:"Uint16"}]),Kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Kn([{type:"Float32",name:"offsetX"}]),Kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dA={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var vo=24,X0=Xn,Bx=function(p,u,m,C,P){var Q,V,W=8*P-C-1,ne=(1<<W)-1,Ae=ne>>1,h=-7,c=m?P-1:0,f=m?-1:1,v=p[u+c];for(c+=f,Q=v&(1<<-h)-1,v>>=-h,h+=W;h>0;Q=256*Q+p[u+c],c+=f,h-=8);for(V=Q&(1<<-h)-1,Q>>=-h,h+=C;h>0;V=256*V+p[u+c],c+=f,h-=8);if(Q===0)Q=1-Ae;else{if(Q===ne)return V?NaN:1/0*(v?-1:1);V+=Math.pow(2,C),Q-=Ae}return(v?-1:1)*V*Math.pow(2,Q-C)},Cx=function(p,u,m,C,P,Q){var V,W,ne,Ae=8*Q-P-1,h=(1<<Ae)-1,c=h>>1,f=P===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=C?0:Q-1,E=C?1:-1,M=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(W=isNaN(u)?1:0,V=h):(V=Math.floor(Math.log(u)/Math.LN2),u*(ne=Math.pow(2,-V))<1&&(V--,ne*=2),(u+=V+c>=1?f/ne:f*Math.pow(2,1-c))*ne>=2&&(V++,ne/=2),V+c>=h?(W=0,V=h):V+c>=1?(W=(u*ne-1)*Math.pow(2,P),V+=c):(W=u*Math.pow(2,c-1)*Math.pow(2,P),V=0));P>=8;p[m+v]=255&W,v+=E,W/=256,P-=8);for(V=V<<P|W,Ae+=P;Ae>0;p[m+v]=255&V,v+=E,V/=256,Ae-=8);p[m+v-E]|=128*M};function Xn(p){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(p)?p:new Uint8Array(p||0),this.pos=0,this.type=0,this.length=this.buf.length}Xn.Varint=0,Xn.Fixed64=1,Xn.Bytes=2,Xn.Fixed32=5;var wm=4294967296,Ex=1/wm,Sx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function vc(p){return p.type===Xn.Bytes?p.readVarint()+p.pos:p.pos+1}function Ts(p,u,m){return m?4294967296*u+(p>>>0):4294967296*(u>>>0)+(p>>>0)}function Z0(p,u,m){var C=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));m.realloc(C);for(var P=m.pos-1;P>=p;P--)m.buf[P+C]=m.buf[P]}function Tx(p,u){for(var m=0;m<p.length;m++)u.writeVarint(p[m])}function Ix(p,u){for(var m=0;m<p.length;m++)u.writeSVarint(p[m])}function Zn(p,u){for(var m=0;m<p.length;m++)u.writeFloat(p[m])}function J0(p,u){for(var m=0;m<p.length;m++)u.writeDouble(p[m])}function Lx(p,u){for(var m=0;m<p.length;m++)u.writeBoolean(p[m])}function Mx(p,u){for(var m=0;m<p.length;m++)u.writeFixed32(p[m])}function Ih(p,u){for(var m=0;m<p.length;m++)u.writeSFixed32(p[m])}function qd(p,u){for(var m=0;m<p.length;m++)u.writeFixed64(p[m])}function Px(p,u){for(var m=0;m<p.length;m++)u.writeSFixed64(p[m])}function Bm(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+16777216*p[u+3]}function $d(p,u,m){p[m]=u,p[m+1]=u>>>8,p[m+2]=u>>>16,p[m+3]=u>>>24}function Fx(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+(p[u+3]<<24)}Xn.prototype={destroy:function(){this.buf=null},readFields:function(p,u,m){for(m=m||this.length;this.pos<m;){var C=this.readVarint(),P=C>>3,Q=this.pos;this.type=7&C,p(P,u,this),this.pos===Q&&this.skip(C)}return u},readMessage:function(p,u){return this.readFields(p,u,this.readVarint()+this.pos)},readFixed32:function(){var p=Bm(this.buf,this.pos);return this.pos+=4,p},readSFixed32:function(){var p=Fx(this.buf,this.pos);return this.pos+=4,p},readFixed64:function(){var p=Bm(this.buf,this.pos)+Bm(this.buf,this.pos+4)*wm;return this.pos+=8,p},readSFixed64:function(){var p=Bm(this.buf,this.pos)+Fx(this.buf,this.pos+4)*wm;return this.pos+=8,p},readFloat:function(){var p=Bx(this.buf,this.pos,!0,23,4);return this.pos+=4,p},readDouble:function(){var p=Bx(this.buf,this.pos,!0,52,8);return this.pos+=8,p},readVarint:function(p){var u,m,C=this.buf;return u=127&(m=C[this.pos++]),m<128?u:(u|=(127&(m=C[this.pos++]))<<7,m<128?u:(u|=(127&(m=C[this.pos++]))<<14,m<128?u:(u|=(127&(m=C[this.pos++]))<<21,m<128?u:function(P,Q,V){var W,ne,Ae=V.buf;if(W=(112&(ne=Ae[V.pos++]))>>4,ne<128||(W|=(127&(ne=Ae[V.pos++]))<<3,ne<128)||(W|=(127&(ne=Ae[V.pos++]))<<10,ne<128)||(W|=(127&(ne=Ae[V.pos++]))<<17,ne<128)||(W|=(127&(ne=Ae[V.pos++]))<<24,ne<128)||(W|=(1&(ne=Ae[V.pos++]))<<31,ne<128))return Ts(P,W,Q);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(m=C[this.pos]))<<28,p,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var p=this.readVarint();return p%2==1?(p+1)/-2:p/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var p=this.readVarint()+this.pos,u=this.pos;return this.pos=p,p-u>=12&&Sx?function(m,C,P){return Sx.decode(m.subarray(C,P))}(this.buf,u,p):function(m,C,P){for(var Q="",V=C;V<P;){var W,ne,Ae,h=m[V],c=null,f=h>239?4:h>223?3:h>191?2:1;if(V+f>P)break;f===1?h<128&&(c=h):f===2?(192&(W=m[V+1]))==128&&(c=(31&h)<<6|63&W)<=127&&(c=null):f===3?(ne=m[V+2],(192&(W=m[V+1]))==128&&(192&ne)==128&&((c=(15&h)<<12|(63&W)<<6|63&ne)<=2047||c>=55296&&c<=57343)&&(c=null)):f===4&&(ne=m[V+2],Ae=m[V+3],(192&(W=m[V+1]))==128&&(192&ne)==128&&(192&Ae)==128&&((c=(15&h)<<18|(63&W)<<12|(63&ne)<<6|63&Ae)<=65535||c>=1114112)&&(c=null)),c===null?(c=65533,f=1):c>65535&&(c-=65536,Q+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),Q+=String.fromCharCode(c),V+=f}return Q}(this.buf,u,p)},readBytes:function(){var p=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,p);return this.pos=p,u},readPackedVarint:function(p,u){if(this.type!==Xn.Bytes)return p.push(this.readVarint(u));var m=vc(this);for(p=p||[];this.pos<m;)p.push(this.readVarint(u));return p},readPackedSVarint:function(p){if(this.type!==Xn.Bytes)return p.push(this.readSVarint());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readSVarint());return p},readPackedBoolean:function(p){if(this.type!==Xn.Bytes)return p.push(this.readBoolean());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readBoolean());return p},readPackedFloat:function(p){if(this.type!==Xn.Bytes)return p.push(this.readFloat());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readFloat());return p},readPackedDouble:function(p){if(this.type!==Xn.Bytes)return p.push(this.readDouble());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readDouble());return p},readPackedFixed32:function(p){if(this.type!==Xn.Bytes)return p.push(this.readFixed32());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readFixed32());return p},readPackedSFixed32:function(p){if(this.type!==Xn.Bytes)return p.push(this.readSFixed32());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed32());return p},readPackedFixed64:function(p){if(this.type!==Xn.Bytes)return p.push(this.readFixed64());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readFixed64());return p},readPackedSFixed64:function(p){if(this.type!==Xn.Bytes)return p.push(this.readSFixed64());var u=vc(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed64());return p},skip:function(p){var u=7&p;if(u===Xn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Xn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Xn.Fixed32)this.pos+=4;else{if(u!==Xn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(p,u){this.writeVarint(p<<3|u)},realloc:function(p){for(var u=this.length||16;u<this.pos+p;)u*=2;if(u!==this.length){var m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(p){this.realloc(4),$d(this.buf,p,this.pos),this.pos+=4},writeSFixed32:function(p){this.realloc(4),$d(this.buf,p,this.pos),this.pos+=4},writeFixed64:function(p){this.realloc(8),$d(this.buf,-1&p,this.pos),$d(this.buf,Math.floor(p*Ex),this.pos+4),this.pos+=8},writeSFixed64:function(p){this.realloc(8),$d(this.buf,-1&p,this.pos),$d(this.buf,Math.floor(p*Ex),this.pos+4),this.pos+=8},writeVarint:function(p){(p=+p||0)>268435455||p<0?function(u,m){var C,P;if(u>=0?(C=u%4294967296|0,P=u/4294967296|0):(P=~(-u/4294967296),4294967295^(C=~(-u%4294967296))?C=C+1|0:(C=0,P=P+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(Q,V,W){W.buf[W.pos++]=127&Q|128,Q>>>=7,W.buf[W.pos++]=127&Q|128,Q>>>=7,W.buf[W.pos++]=127&Q|128,Q>>>=7,W.buf[W.pos++]=127&Q|128,W.buf[W.pos]=127&(Q>>>=7)}(C,0,m),function(Q,V){var W=(7&Q)<<4;V.buf[V.pos++]|=W|((Q>>>=3)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q)))))}(P,m)}(p,this):(this.realloc(4),this.buf[this.pos++]=127&p|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=p>>>7&127))))},writeSVarint:function(p){this.writeVarint(p<0?2*-p-1:2*p)},writeBoolean:function(p){this.writeVarint(!!p)},writeString:function(p){p=String(p),this.realloc(4*p.length),this.pos++;var u=this.pos;this.pos=function(C,P,Q){for(var V,W,ne=0;ne<P.length;ne++){if((V=P.charCodeAt(ne))>55295&&V<57344){if(!W){V>56319||ne+1===P.length?(C[Q++]=239,C[Q++]=191,C[Q++]=189):W=V;continue}if(V<56320){C[Q++]=239,C[Q++]=191,C[Q++]=189,W=V;continue}V=W-55296<<10|V-56320|65536,W=null}else W&&(C[Q++]=239,C[Q++]=191,C[Q++]=189,W=null);V<128?C[Q++]=V:(V<2048?C[Q++]=V>>6|192:(V<65536?C[Q++]=V>>12|224:(C[Q++]=V>>18|240,C[Q++]=V>>12&63|128),C[Q++]=V>>6&63|128),C[Q++]=63&V|128)}return Q}(this.buf,p,this.pos);var m=this.pos-u;m>=128&&Z0(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m},writeFloat:function(p){this.realloc(4),Cx(this.buf,p,this.pos,!0,23,4),this.pos+=4},writeDouble:function(p){this.realloc(8),Cx(this.buf,p,this.pos,!0,52,8),this.pos+=8},writeBytes:function(p){var u=p.length;this.writeVarint(u),this.realloc(u);for(var m=0;m<u;m++)this.buf[this.pos++]=p[m]},writeRawMessage:function(p,u){this.pos++;var m=this.pos;p(u,this);var C=this.pos-m;C>=128&&Z0(m,C,this),this.pos=m-1,this.writeVarint(C),this.pos+=C},writeMessage:function(p,u,m){this.writeTag(p,Xn.Bytes),this.writeRawMessage(u,m)},writePackedVarint:function(p,u){u.length&&this.writeMessage(p,Tx,u)},writePackedSVarint:function(p,u){u.length&&this.writeMessage(p,Ix,u)},writePackedBoolean:function(p,u){u.length&&this.writeMessage(p,Lx,u)},writePackedFloat:function(p,u){u.length&&this.writeMessage(p,Zn,u)},writePackedDouble:function(p,u){u.length&&this.writeMessage(p,J0,u)},writePackedFixed32:function(p,u){u.length&&this.writeMessage(p,Mx,u)},writePackedSFixed32:function(p,u){u.length&&this.writeMessage(p,Ih,u)},writePackedFixed64:function(p,u){u.length&&this.writeMessage(p,qd,u)},writePackedSFixed64:function(p,u){u.length&&this.writeMessage(p,Px,u)},writeBytesField:function(p,u){this.writeTag(p,Xn.Bytes),this.writeBytes(u)},writeFixed32Field:function(p,u){this.writeTag(p,Xn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(p,u){this.writeTag(p,Xn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(p,u){this.writeTag(p,Xn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(p,u){this.writeTag(p,Xn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(p,u){this.writeTag(p,Xn.Varint),this.writeVarint(u)},writeSVarintField:function(p,u){this.writeTag(p,Xn.Varint),this.writeSVarint(u)},writeStringField:function(p,u){this.writeTag(p,Xn.Bytes),this.writeString(u)},writeFloatField:function(p,u){this.writeTag(p,Xn.Fixed32),this.writeFloat(u)},writeDoubleField:function(p,u){this.writeTag(p,Xn.Fixed64),this.writeDouble(u)},writeBooleanField:function(p,u){this.writeVarintField(p,!!u)}};var Y0=g(X0);const e_=3;function II(p,u,m){p===1&&m.readMessage(LI,u)}function LI(p,u,m){if(p===3){const{id:C,bitmap:P,width:Q,height:V,left:W,top:ne,advance:Ae}=m.readMessage(MI,{});u.push({id:C,bitmap:new yu({width:Q+2*e_,height:V+2*e_},P),metrics:{width:Q,height:V,left:W,top:ne,advance:Ae}})}}function MI(p,u,m){p===1?u.id=m.readVarint():p===2?u.bitmap=m.readBytes():p===3?u.width=m.readVarint():p===4?u.height=m.readVarint():p===5?u.left=m.readSVarint():p===6?u.top=m.readSVarint():p===7&&(u.advance=m.readVarint())}const Dx=e_;function gp(p){let u=0,m=0;for(const V of p)u+=V.w*V.h,m=Math.max(m,V.w);p.sort((V,W)=>W.h-V.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),m),h:1/0}];let P=0,Q=0;for(const V of p)for(let W=C.length-1;W>=0;W--){const ne=C[W];if(!(V.w>ne.w||V.h>ne.h)){if(V.x=ne.x,V.y=ne.y,Q=Math.max(Q,V.y+V.h),P=Math.max(P,V.x+V.w),V.w===ne.w&&V.h===ne.h){const Ae=C.pop();W<C.length&&(C[W]=Ae)}else V.h===ne.h?(ne.x+=V.w,ne.w-=V.w):V.w===ne.w?(ne.y+=V.h,ne.h-=V.h):(C.push({x:ne.x+V.w,y:ne.y,w:ne.w-V.w,h:V.h}),ne.y+=V.h,ne.h-=V.h);break}}return{w:P,h:Q,fill:u/(P*Q)||0}}const zo=1;class Cm{constructor(u,m){let{pixelRatio:C,version:P,stretchX:Q,stretchY:V,content:W}=m;this.paddedRect=u,this.pixelRatio=C,this.stretchX=Q,this.stretchY=V,this.content=W,this.version=P}get tl(){return[this.paddedRect.x+zo,this.paddedRect.y+zo]}get br(){return[this.paddedRect.x+this.paddedRect.w-zo,this.paddedRect.y+this.paddedRect.h-zo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*zo)/this.pixelRatio,(this.paddedRect.h-2*zo)/this.pixelRatio]}}class Em{constructor(u,m){const C={},P={};this.haveRenderCallbacks=[];const Q=[];this.addImages(u,C,Q),this.addImages(m,P,Q);const{w:V,h:W}=gp(Q),ne=new xl({width:V||1,height:W||1});for(const Ae in u){const h=u[Ae],c=C[Ae].paddedRect;xl.copy(h.data,ne,{x:0,y:0},{x:c.x+zo,y:c.y+zo},h.data)}for(const Ae in m){const h=m[Ae],c=P[Ae].paddedRect,f=c.x+zo,v=c.y+zo,E=h.data.width,M=h.data.height;xl.copy(h.data,ne,{x:0,y:0},{x:f,y:v},h.data),xl.copy(h.data,ne,{x:0,y:M-1},{x:f,y:v-1},{width:E,height:1}),xl.copy(h.data,ne,{x:0,y:0},{x:f,y:v+M},{width:E,height:1}),xl.copy(h.data,ne,{x:E-1,y:0},{x:f-1,y:v},{width:1,height:M}),xl.copy(h.data,ne,{x:0,y:0},{x:f+E,y:v},{width:1,height:M})}this.image=ne,this.iconPositions=C,this.patternPositions=P}addImages(u,m,C){for(const P in u){const Q=u[P],V={x:0,y:0,w:Q.data.width+2*zo,h:Q.data.height+2*zo};C.push(V),m[P]=new Cm(V,Q),Q.hasRenderCallback&&this.haveRenderCallbacks.push(P)}}patchUpdatedImages(u,m){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in u.updatedImages)this.patchUpdatedImage(this.iconPositions[C],u.getImage(C),m),this.patchUpdatedImage(this.patternPositions[C],u.getImage(C),m)}patchUpdatedImage(u,m,C){if(!u||!m||u.version===m.version)return;u.version=m.version;const[P,Q]=u.tl;C.update(m.data,void 0,{x:P,y:Q})}}var ju;Fi("ImagePosition",Cm),Fi("ImageAtlas",Em),l.ah=void 0,(ju=l.ah||(l.ah={}))[ju.none=0]="none",ju[ju.horizontal=1]="horizontal",ju[ju.vertical=2]="vertical",ju[ju.horizontalOnly=3]="horizontalOnly";const mp=-17;class yp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,m){const C=new yp;return C.scale=u||1,C.fontStack=m,C}static forImage(u){const m=new yp;return m.imageName=u,m}}class Kd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,m){const C=new Kd;for(let P=0;P<u.sections.length;P++){const Q=u.sections[P];Q.image?C.addImageSection(Q):C.addTextSection(Q,m)}return C}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let m="";for(let C=0;C<u.length;C++){const P=u.charCodeAt(C+1)||null,Q=u.charCodeAt(C-1)||null;m+=P&&Oc(P)&&!dA[u[C+1]]||Q&&Oc(Q)&&!dA[u[C-1]]||!dA[u[C]]?u[C]:dA[u[C]]}return m}(this.text)}trim(){let u=0;for(let C=0;C<this.text.length&&vp[this.text.charCodeAt(C)];C++)u++;let m=this.text.length;for(let C=this.text.length-1;C>=0&&C>=u&&vp[this.text.charCodeAt(C)];C--)m--;this.text=this.text.substring(u,m),this.sectionIndex=this.sectionIndex.slice(u,m)}substring(u,m){const C=new Kd;return C.text=this.text.substring(u,m),C.sectionIndex=this.sectionIndex.slice(u,m),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,m)=>Math.max(u,this.sections[m].scale),0)}addTextSection(u,m){this.text+=u.text,this.sections.push(yp.forText(u.scale,u.fontStack||m));const C=this.sections.length-1;for(let P=0;P<u.text.length;++P)this.sectionIndex.push(C)}addImageSection(u){const m=u.image?u.image.name:"";if(m.length===0)return void Je("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(yp.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _p(p,u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E,M){const R=Kd.fromFeature(p,P);let G;c===l.ah.vertical&&R.verticalizePunctuation();const{processBidirectionalText:K,processStyledBidirectionalText:Z}=rl;if(K&&R.sections.length===1){G=[];const ye=K(R.toString(),pA(R,Ae,Q,u,C,v,E));for(const Ce of ye){const Ie=new Kd;Ie.text=Ce,Ie.sections=R.sections;for(let Oe=0;Oe<Ce.length;Oe++)Ie.sectionIndex.push(0);G.push(Ie)}}else if(Z){G=[];const ye=Z(R.text,R.sectionIndex,pA(R,Ae,Q,u,C,v,E));for(const Ce of ye){const Ie=new Kd;Ie.text=Ce[0],Ie.sectionIndex=Ce[1],Ie.sections=R.sections,G.push(Ie)}}else G=function(ye,Ce){const Ie=[],Oe=ye.text;let qe=0;for(const Ke of Ce)Ie.push(ye.substring(qe,Ke)),qe=Ke;return qe<Oe.length&&Ie.push(ye.substring(qe,Oe.length)),Ie}(R,pA(R,Ae,Q,u,C,v,E));const oe=[],de={positionedLines:oe,text:R.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(ye,Ce,Ie,Oe,qe,Ke,ut,et,it,mt,Tt,Zt){let wi=0,ai=mp,di=0,pi=0;const Di=et==="right"?1:et==="left"?0:.5;let li=0;for(const Rr of qe){Rr.trim();const Qr=Rr.getMaxScale(),gn=(Qr-1)*vo,ls={positionedGlyphs:[],lineOffset:0};ye.positionedLines[li]=ls;const Qn=ls.positionedGlyphs;let bn=0;if(!Rr.length()){ai+=Ke,++li;continue}for(let un=0;un<Rr.length();un++){const br=Rr.getSection(un),Vn=Rr.getSectionIndex(un),hn=Rr.getCharCode(un);let tn=0,ps=null,Is=null,bs=null,Js=vo;const Ls=!(it===l.ah.horizontal||!Tt&&!Xl(hn)||Tt&&(vp[hn]||(Jt=hn,Si.Arabic(Jt)||Si["Arabic Supplement"](Jt)||Si["Arabic Extended-A"](Jt)||Si["Arabic Presentation Forms-A"](Jt)||Si["Arabic Presentation Forms-B"](Jt))));if(br.imageName){const Rn=Oe[br.imageName];if(!Rn)continue;bs=br.imageName,ye.iconsInText=ye.iconsInText||!0,Is=Rn.paddedRect;const wr=Rn.displaySize;br.scale=br.scale*vo/Zt,ps={width:wr[0],height:wr[1],left:zo,top:-Dx,advance:Ls?wr[1]:wr[0]},tn=gn+(vo-wr[1]*br.scale),Js=ps.advance;const zs=Ls?wr[0]*br.scale-vo*Qr:wr[1]*br.scale-vo*Qr;zs>0&&zs>bn&&(bn=zs)}else{const Rn=Ie[br.fontStack],wr=Rn&&Rn[hn];if(wr&&wr.rect)Is=wr.rect,ps=wr.metrics;else{const zs=Ce[br.fontStack],lo=zs&&zs[hn];if(!lo)continue;ps=lo.metrics}tn=(Qr-br.scale)*vo}Ls?(ye.verticalizable=!0,Qn.push({glyph:hn,imageName:bs,x:wi,y:ai+tn,vertical:Ls,scale:br.scale,fontStack:br.fontStack,sectionIndex:Vn,metrics:ps,rect:Is}),wi+=Js*br.scale+mt):(Qn.push({glyph:hn,imageName:bs,x:wi,y:ai+tn,vertical:Ls,scale:br.scale,fontStack:br.fontStack,sectionIndex:Vn,metrics:ps,rect:Is}),wi+=ps.advance*br.scale+mt)}Qn.length!==0&&(di=Math.max(wi-mt,di),Tm(Qn,0,Qn.length-1,Di,bn)),wi=0;const Dn=Ke*Qr+bn;ls.lineOffset=Math.max(bn,gn),ai+=Dn,pi=Math.max(Dn,pi),++li}var Jt;const Hi=ai-mp,{horizontalAlign:Vi,verticalAlign:mr}=Zd(ut);(function(Rr,Qr,gn,ls,Qn,bn,Dn,un,br){const Vn=(Qr-gn)*Qn;let hn=0;hn=bn!==Dn?-un*ls-mp:(-ls*br+.5)*Dn;for(const tn of Rr)for(const ps of tn.positionedGlyphs)ps.x+=Vn,ps.y+=hn})(ye.positionedLines,Di,Vi,mr,di,pi,Ke,Hi,qe.length),ye.top+=-mr*Hi,ye.bottom=ye.top+Hi,ye.left+=-Vi*di,ye.right=ye.left+di}(de,u,m,C,G,V,W,ne,c,Ae,f,M),!function(ye){for(const Ce of ye)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(oe)&&de}const vp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Bl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sm(p,u,m,C,P,Q){if(u.imageName){const V=C[u.imageName];return V?V.displaySize[0]*u.scale*vo/Q+P:0}{const V=m[u.fontStack],W=V&&V[p];return W?W.metrics.advance*u.scale+P:0}}function t_(p,u,m,C){const P=Math.pow(p-u,2);return C?p<u?P/2:2*P:P+Math.abs(m)*m}function fA(p,u,m){let C=0;return p===10&&(C-=1e4),m&&(C+=150),p!==40&&p!==65288||(C+=50),u!==41&&u!==65289||(C+=50),C}function Wd(p,u,m,C,P,Q){let V=null,W=t_(u,m,P,Q);for(const ne of C){const Ae=t_(u-ne.x,m,P,Q)+ne.badness;Ae<=W&&(V=ne,W=Ae)}return{index:p,x:u,priorBreak:V,badness:W}}function Xd(p){return p?Xd(p.priorBreak).concat(p.index):[]}function pA(p,u,m,C,P,Q,V){if(Q!=="point")return[];if(!p)return[];const W=[],ne=function(f,v,E,M,R,G){let K=0;for(let Z=0;Z<f.length();Z++){const oe=f.getSection(Z);K+=Sm(f.getCharCode(Z),oe,M,R,v,G)}return K/Math.max(1,Math.ceil(K/E))}(p,u,m,C,P,V),Ae=p.text.indexOf("")>=0;let h=0;for(let f=0;f<p.length();f++){const v=p.getSection(f),E=p.getCharCode(f);if(vp[E]||(h+=Sm(E,v,C,P,u,V)),f<p.length()-1){const M=!((c=E)<11904||!(Si["Bopomofo Extended"](c)||Si.Bopomofo(c)||Si["CJK Compatibility Forms"](c)||Si["CJK Compatibility Ideographs"](c)||Si["CJK Compatibility"](c)||Si["CJK Radicals Supplement"](c)||Si["CJK Strokes"](c)||Si["CJK Symbols and Punctuation"](c)||Si["CJK Unified Ideographs Extension A"](c)||Si["CJK Unified Ideographs"](c)||Si["Enclosed CJK Letters and Months"](c)||Si["Halfwidth and Fullwidth Forms"](c)||Si.Hiragana(c)||Si["Ideographic Description Characters"](c)||Si["Kangxi Radicals"](c)||Si["Katakana Phonetic Extensions"](c)||Si.Katakana(c)||Si["Vertical Forms"](c)||Si["Yi Radicals"](c)||Si["Yi Syllables"](c)));(Bl[E]||M||v.imageName)&&W.push(Wd(f+1,h,ne,W,fA(E,p.getCharCode(f+1),M&&Ae),!1))}}var c;return Xd(Wd(p.length(),h,ne,W,0,!0))}function Zd(p){let u=.5,m=.5;switch(p){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:u,verticalAlign:m}}function Tm(p,u,m,C,P){if(!C&&!P)return;const Q=p[m],V=(p[m].x+Q.metrics.advance*Q.scale)*C;for(let W=u;W<=m;W++)p[W].x-=V,p[W].y+=P}function PI(p,u,m){const{horizontalAlign:C,verticalAlign:P}=Zd(m),Q=u[0]-p.displaySize[0]*C,V=u[1]-p.displaySize[1]*P;return{image:p,top:V,bottom:V+p.displaySize[1],left:Q,right:Q+p.displaySize[0]}}function i_(p,u,m,C,P,Q){const V=p.image;let W;if(V.content){const R=V.content,G=V.pixelRatio||1;W=[R[0]/G,R[1]/G,V.displaySize[0]-R[2]/G,V.displaySize[1]-R[3]/G]}const ne=u.left*Q,Ae=u.right*Q;let h,c,f,v;m==="width"||m==="both"?(v=P[0]+ne-C[3],c=P[0]+Ae+C[1]):(v=P[0]+(ne+Ae-V.displaySize[0])/2,c=v+V.displaySize[0]);const E=u.top*Q,M=u.bottom*Q;return m==="height"||m==="both"?(h=P[1]+E-C[0],f=P[1]+M+C[2]):(h=P[1]+(E+M-V.displaySize[1])/2,f=h+V.displaySize[1]),{image:V,top:h,right:c,bottom:f,left:v,collisionPadding:W}}const Jd=255,qu=128,Lh=Jd*qu;function r_(p,u){const{expression:m}=u;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new _n(p+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:P}=m;let Q=0;for(;Q<C.length&&C[Q]<=p;)Q++;Q=Math.max(0,Q-1);let V=Q;for(;V<C.length&&C[V]<p+1;)V++;V=Math.min(C.length-1,V);const W=C[Q],ne=C[V];return m.kind==="composite"?{kind:"composite",minZoom:W,maxZoom:ne,interpolationType:P}:{kind:"camera",minZoom:W,maxZoom:ne,minSize:m.evaluate(new _n(W)),maxSize:m.evaluate(new _n(ne)),interpolationType:P}}}function bp(p,u,m){let C="never";const P=p.get(u);return P?C=P:p.get(m)&&(C="always"),C}const n_=Gu.VectorTileFeature.types,FI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Im(p,u,m,C,P,Q,V,W,ne,Ae,h,c,f){const v=W?Math.min(Lh,Math.round(W[0])):0,E=W?Math.min(Lh,Math.round(W[1])):0;p.emplaceBack(u,m,Math.round(32*C),Math.round(32*P),Q,V,(v<<1)+(ne?1:0),E,16*Ae,16*h,256*c,256*f)}function Lm(p,u,m){p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m)}function xp(p){for(const u of p.sections)if(zc(u.text))return!0;return!1}class $c{constructor(u){this.layoutVertexArray=new ge,this.indexArray=new We,this.programConfigurations=u,this.segments=new xt,this.dynamicLayoutVertexArray=new we,this.opacityVertexArray=new De,this.hasVisibleVertices=!1,this.placedSymbolArray=new _}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,m,C,P){this.isEmpty()||(C&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,bx.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,K0.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,FI,!0),this.opacityVertexBuffer.itemSize=1),(C||P)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Fi("SymbolBuffers",$c);class $u{constructor(u,m,C){this.layoutVertexArray=new u,this.layoutAttributes=m,this.indexArray=new C,this.segments=new xt,this.collisionVertexArray=new st}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,xx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Fi("CollisionBuffers",$u);class XA{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(V=>V.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=aA([]),this.placementViewportMatrix=aA([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=r_(this.zoom,m["text-size"]),this.iconSizeData=r_(this.zoom,m["icon-size"]);const C=this.layers[0].layout,P=C.get("symbol-sort-key"),Q=C.get("symbol-z-order");this.canOverlap=bp(C,"text-overlap","text-allow-overlap")!=="never"||bp(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=Q!=="viewport-y"&&!P.isConstant(),this.sortFeaturesByY=(Q==="viewport-y"||Q==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(V=>l.ah[V])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=u.sourceID}createArrays(){this.text=new $c(new Fn(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new $c(new Fn(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new U,this.lineVertexArray=new H,this.symbolInstances=new T,this.textAnchorOffsets=new w}calculateGlyphDependencies(u,m,C,P,Q){for(let V=0;V<u.length;V++)if(m[u.charCodeAt(V)]=!0,(C||P)&&Q){const W=dA[u.charAt(V)];W&&(m[W.charCodeAt(0)]=!0)}}populate(u,m,C){const P=this.layers[0],Q=P.layout,V=Q.get("text-font"),W=Q.get("text-field"),ne=Q.get("icon-image"),Ae=(W.value.kind!=="constant"||W.value.value instanceof cr&&!W.value.value.isEmpty()||W.value.value.toString().length>0)&&(V.value.kind!=="constant"||V.value.value.length>0),h=ne.value.kind!=="constant"||!!ne.value.value||Object.keys(ne.parameters).length>0,c=Q.get("symbol-sort-key");if(this.features=[],!Ae&&!h)return;const f=m.iconDependencies,v=m.glyphDependencies,E=m.availableImages,M=new _n(this.zoom);for(const{feature:R,id:G,index:K,sourceLayerIndex:Z}of u){const oe=P._featureFilter.needGeometry,de=Xs(R,oe);if(!P._featureFilter.filter(M,de,C))continue;let ye,Ce;if(oe||(de.geometry=Us(R)),Ae){const Oe=P.getValueAndResolveTokens("text-field",de,C,E),qe=cr.factory(Oe);xp(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||rl.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&rl.isParsed())&&(ye=TI(qe,P,de))}if(h){const Oe=P.getValueAndResolveTokens("icon-image",de,C,E);Ce=Oe instanceof wn?Oe:wn.fromString(Oe)}if(!ye&&!Ce)continue;const Ie=this.sortFeaturesByKey?c.evaluate(de,{},C):void 0;if(this.features.push({id:G,text:ye,icon:Ce,index:K,sourceLayerIndex:Z,geometry:de.geometry,properties:R.properties,type:n_[R.type],sortKey:Ie}),Ce&&(f[Ce.name]=!0),ye){const Oe=V.evaluate(de,{},C).join(","),qe=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ah.vertical)>=0;for(const Ke of ye.sections)if(Ke.image)f[Ke.image.name]=!0;else{const ut=oo(ye.toString()),et=Ke.fontStack||Oe,it=v[et]=v[et]||{};this.calculateGlyphDependencies(Ke.text,it,qe,this.allowVerticalPlacement,ut)}}}Q.get("symbol-placement")==="line"&&(this.features=function(R){const G={},K={},Z=[];let oe=0;function de(Oe){Z.push(R[Oe]),oe++}function ye(Oe,qe,Ke){const ut=K[Oe];return delete K[Oe],K[qe]=ut,Z[ut].geometry[0].pop(),Z[ut].geometry[0]=Z[ut].geometry[0].concat(Ke[0]),ut}function Ce(Oe,qe,Ke){const ut=G[qe];return delete G[qe],G[Oe]=ut,Z[ut].geometry[0].shift(),Z[ut].geometry[0]=Ke[0].concat(Z[ut].geometry[0]),ut}function Ie(Oe,qe,Ke){const ut=Ke?qe[0][qe[0].length-1]:qe[0][0];return`${Oe}:${ut.x}:${ut.y}`}for(let Oe=0;Oe<R.length;Oe++){const qe=R[Oe],Ke=qe.geometry,ut=qe.text?qe.text.toString():null;if(!ut){de(Oe);continue}const et=Ie(ut,Ke),it=Ie(ut,Ke,!0);if(et in K&&it in G&&K[et]!==G[it]){const mt=Ce(et,it,Ke),Tt=ye(et,it,Z[mt].geometry);delete G[et],delete K[it],K[Ie(ut,Z[Tt].geometry,!0)]=Tt,Z[mt].geometry=null}else et in K?ye(et,it,Ke):it in G?Ce(et,it,Ke):(de(Oe),G[et]=oe-1,K[it]=oe-1)}return Z.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((R,G)=>R.sortKey-G.sortKey)}update(u,m,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,m,this.layers,C),this.icon.programConfigurations.updatePaintArrays(u,m,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,m){const C=this.lineVertexArray.length;if(u.segment!==void 0){let P=u.dist(m[u.segment+1]),Q=u.dist(m[u.segment]);const V={};for(let W=u.segment+1;W<m.length;W++)V[W]={x:m[W].x,y:m[W].y,tileUnitDistanceFromAnchor:P},W<m.length-1&&(P+=m[W+1].dist(m[W]));for(let W=u.segment||0;W>=0;W--)V[W]={x:m[W].x,y:m[W].y,tileUnitDistanceFromAnchor:Q},W>0&&(Q+=m[W-1].dist(m[W]));for(let W=0;W<m.length;W++){const ne=V[W];this.lineVertexArray.emplaceBack(ne.x,ne.y,ne.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(u,m,C,P,Q,V,W,ne,Ae,h,c,f){const v=u.indexArray,E=u.layoutVertexArray,M=u.segments.prepareSegment(4*m.length,E,v,this.canOverlap?V.sortKey:void 0),R=this.glyphOffsetArray.length,G=M.vertexLength,K=this.allowVerticalPlacement&&W===l.ah.vertical?Math.PI/2:0,Z=V.text&&V.text.sections;for(let oe=0;oe<m.length;oe++){const{tl:de,tr:ye,bl:Ce,br:Ie,tex:Oe,pixelOffsetTL:qe,pixelOffsetBR:Ke,minFontScaleX:ut,minFontScaleY:et,glyphOffset:it,isSDF:mt,sectionIndex:Tt}=m[oe],Zt=M.vertexLength,wi=it[1];Im(E,ne.x,ne.y,de.x,wi+de.y,Oe.x,Oe.y,C,mt,qe.x,qe.y,ut,et),Im(E,ne.x,ne.y,ye.x,wi+ye.y,Oe.x+Oe.w,Oe.y,C,mt,Ke.x,qe.y,ut,et),Im(E,ne.x,ne.y,Ce.x,wi+Ce.y,Oe.x,Oe.y+Oe.h,C,mt,qe.x,Ke.y,ut,et),Im(E,ne.x,ne.y,Ie.x,wi+Ie.y,Oe.x+Oe.w,Oe.y+Oe.h,C,mt,Ke.x,Ke.y,ut,et),Lm(u.dynamicLayoutVertexArray,ne,K),v.emplaceBack(Zt,Zt+1,Zt+2),v.emplaceBack(Zt+1,Zt+2,Zt+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),oe!==m.length-1&&Tt===m[oe+1].sectionIndex||u.programConfigurations.populatePaintArrays(E.length,V,V.index,{},f,Z&&Z[Tt])}u.placedSymbolArray.emplaceBack(ne.x,ne.y,R,this.glyphOffsetArray.length-R,G,Ae,h,ne.segment,C?C[0]:0,C?C[1]:0,P[0],P[1],W,0,!1,0,c)}_addCollisionDebugVertex(u,m,C,P,Q,V){return m.emplaceBack(0,0),u.emplaceBack(C.x,C.y,P,Q,Math.round(V.x),Math.round(V.y))}addCollisionDebugVertices(u,m,C,P,Q,V,W){const ne=Q.segments.prepareSegment(4,Q.layoutVertexArray,Q.indexArray),Ae=ne.vertexLength,h=Q.layoutVertexArray,c=Q.collisionVertexArray,f=W.anchorX,v=W.anchorY;this._addCollisionDebugVertex(h,c,V,f,v,new F(u,m)),this._addCollisionDebugVertex(h,c,V,f,v,new F(C,m)),this._addCollisionDebugVertex(h,c,V,f,v,new F(C,P)),this._addCollisionDebugVertex(h,c,V,f,v,new F(u,P)),ne.vertexLength+=4;const E=Q.indexArray;E.emplaceBack(Ae,Ae+1),E.emplaceBack(Ae+1,Ae+2),E.emplaceBack(Ae+2,Ae+3),E.emplaceBack(Ae+3,Ae),ne.primitiveLength+=4}addDebugCollisionBoxes(u,m,C,P){for(let Q=u;Q<m;Q++){const V=this.collisionBoxArray.get(Q);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,P?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $u(Me,W0.members,ke),this.iconCollisionBox=new $u(Me,W0.members,ke);for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(u,m,C,P,Q,V,W,ne,Ae){const h={};for(let c=m;c<C;c++){const f=u.get(c);h.textBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.textFeatureIndex=f.featureIndex;break}for(let c=P;c<Q;c++){const f=u.get(c);h.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalTextFeatureIndex=f.featureIndex;break}for(let c=V;c<W;c++){const f=u.get(c);h.iconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.iconFeatureIndex=f.featureIndex;break}for(let c=ne;c<Ae;c++){const f=u.get(c);h.verticalIconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalIconFeatureIndex=f.featureIndex;break}return h}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const C=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,m){const C=u.placedSymbolArray.get(m),P=C.vertexStartIndex+4*C.numGlyphs;for(let Q=C.vertexStartIndex;Q<P;Q+=4)u.indexArray.emplaceBack(Q,Q+1,Q+2),u.indexArray.emplaceBack(Q+1,Q+2,Q+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(u),C=Math.cos(u),P=[],Q=[],V=[];for(let W=0;W<this.symbolInstances.length;++W){V.push(W);const ne=this.symbolInstances.get(W);P.push(0|Math.round(m*ne.anchorX+C*ne.anchorY)),Q.push(ne.featureIndex)}return V.sort((W,ne)=>P[W]-P[ne]||Q[ne]-Q[W]),V}addToSortKeyRanges(u,m){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===m?C.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const C=this.symbolInstances.get(m);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((P,Q,V)=>{P>=0&&V.indexOf(P)===Q&&this.addIndicesForPlacedSymbol(this.text,P)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Mm,Rx;Fi("SymbolBucket",XA,{omit:["layers","collisionBoxArray","features","compareText"]}),XA.MAX_GLYPHS=65535,XA.addDynamicAttributes=Lm;var s_={get paint(){return Rx=Rx||new Ss({"icon-opacity":new or(wt.paint_symbol["icon-opacity"]),"icon-color":new or(wt.paint_symbol["icon-color"]),"icon-halo-color":new or(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new or(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new or(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new xi(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new xi(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new or(wt.paint_symbol["text-opacity"]),"text-color":new or(wt.paint_symbol["text-color"],{runtimeType:jt,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new or(wt.paint_symbol["text-halo-color"]),"text-halo-width":new or(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new or(wt.paint_symbol["text-halo-blur"]),"text-translate":new xi(wt.paint_symbol["text-translate"]),"text-translate-anchor":new xi(wt.paint_symbol["text-translate-anchor"])})},get layout(){return Mm=Mm||new Ss({"symbol-placement":new xi(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new xi(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xi(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new or(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xi(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xi(wt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xi(wt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xi(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new xi(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xi(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new or(wt.layout_symbol["icon-size"]),"icon-text-fit":new xi(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xi(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new or(wt.layout_symbol["icon-image"]),"icon-rotate":new or(wt.layout_symbol["icon-rotate"]),"icon-padding":new or(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new xi(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new or(wt.layout_symbol["icon-offset"]),"icon-anchor":new or(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xi(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xi(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xi(wt.layout_symbol["text-rotation-alignment"]),"text-field":new or(wt.layout_symbol["text-field"]),"text-font":new or(wt.layout_symbol["text-font"]),"text-size":new or(wt.layout_symbol["text-size"]),"text-max-width":new or(wt.layout_symbol["text-max-width"]),"text-line-height":new xi(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new or(wt.layout_symbol["text-letter-spacing"]),"text-justify":new or(wt.layout_symbol["text-justify"]),"text-radial-offset":new or(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xi(wt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new or(wt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new or(wt.layout_symbol["text-anchor"]),"text-max-angle":new xi(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new xi(wt.layout_symbol["text-writing-mode"]),"text-rotate":new or(wt.layout_symbol["text-rotate"]),"text-padding":new xi(wt.layout_symbol["text-padding"]),"text-keep-upright":new xi(wt.layout_symbol["text-keep-upright"]),"text-transform":new or(wt.layout_symbol["text-transform"]),"text-offset":new or(wt.layout_symbol["text-offset"]),"text-allow-overlap":new xi(wt.layout_symbol["text-allow-overlap"]),"text-overlap":new xi(wt.layout_symbol["text-overlap"]),"text-ignore-placement":new xi(wt.layout_symbol["text-ignore-placement"]),"text-optional":new xi(wt.layout_symbol["text-optional"])})}};class wp{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:Ji,this.defaultValue=u}evaluate(u){if(u.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(u.formattedSection))return m.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fi("FormatSectionOverride",wp,{omit:["defaultValue"]});class Yd extends $n{constructor(u){super(u,s_)}recalculate(u,m){if(super.recalculate(u,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const P=[];for(const Q of C)P.indexOf(Q)<0&&P.push(Q);this.layout._values["text-writing-mode"]=P}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,m,C,P){const Q=this.layout.get(u).evaluate(m,{},C,P),V=this._unevaluatedLayout._values[u];return V.isDataDriven()||Mr(V.value)||!Q?Q:function(W,ne){return ne.replace(/{([^{}]+)}/g,(Ae,h)=>W&&h in W?String(W[h]):"")}(m.properties,Q)}createBucket(u){return new XA(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of s_.paint.overridableProperties){if(!Yd.hasPaintOverride(this.layout,u))continue;const m=this.paint.get(u),C=new wp(m),P=new Cr(C,m.property.specification);let Q=null;Q=m.value.kind==="constant"||m.value.kind==="source"?new Ks("source",P):new io("composite",P,m.value.zoomStops),this.paint._values[u]=new ba(m.property,Q,m.parameters)}}_handleOverridablePaintPropertyUpdate(u,m,C){return!(!this.layout||m.isDataDriven()||C.isDataDriven())&&Yd.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,m){const C=u.get("text-field"),P=s_.paint.properties[m];let Q=!1;const V=W=>{for(const ne of W)if(P.overrides&&P.overrides.hasOverride(ne))return void(Q=!0)};if(C.value.kind==="constant"&&C.value.value instanceof cr)V(C.value.value.sections);else if(C.value.kind==="source"){const W=Ae=>{Q||(Ae instanceof Cs&&Xi(Ae.value)===Tr?V(Ae.value.sections):Ae instanceof tl?V(Ae.sections):Ae.eachChild(W))},ne=C.value;ne._styleExpression&&W(ne._styleExpression.expression)}return Q}}let kx;var o_={get paint(){return kx=kx||new Ss({"background-color":new xi(wt.paint_background["background-color"]),"background-pattern":new Qc(wt.paint_background["background-pattern"]),"background-opacity":new xi(wt.paint_background["background-opacity"])})}};class a_ extends $n{constructor(u){super(u,o_)}}let ZA;var Ox={get paint(){return ZA=ZA||new Ss({"raster-opacity":new xi(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new xi(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xi(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xi(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new xi(wt.paint_raster["raster-saturation"]),"raster-contrast":new xi(wt.paint_raster["raster-contrast"]),"raster-resampling":new xi(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new xi(wt.paint_raster["raster-fade-duration"])})}};class Ux extends $n{constructor(u){super(u,Ox)}}class l_ extends $n{constructor(u){super(u,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Nx{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ef=63710088e-1;class Mh{constructor(u,m){if(isNaN(u)||isNaN(m))throw new Error(`Invalid LngLat object: (${u}, ${m})`);if(this.lng=+u,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mh(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const m=Math.PI/180,C=this.lat*m,P=u.lat*m,Q=Math.sin(C)*Math.sin(P)+Math.cos(C)*Math.cos(P)*Math.cos((u.lng-this.lng)*m);return ef*Math.acos(Math.min(Q,1))}static convert(u){if(u instanceof Mh)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new Mh(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new Mh(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const zx=2*Math.PI*ef;function Qx(p){return zx*Math.cos(p*Math.PI/180)}function c_(p){return(180+p)/360}function Vx(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function Hx(p,u){return p/Qx(u)}function u_(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}class Pm{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+m,this.z=+C}static fromLngLat(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=Mh.convert(u);return new Pm(c_(C.lng),Vx(C.lat),Hx(m,C.lat))}toLngLat(){return new Mh(360*this.x-180,u_(this.y))}toAltitude(){return this.z*Qx(u_(this.y))}meterInMercatorCoordinateUnits(){return 1/zx*(u=u_(this.y),1/Math.cos(u*Math.PI/180));var u}}function Fm(p,u,m){var C=2*Math.PI*6378137/256/Math.pow(2,m);return[p*C-2*Math.PI*6378137/2,u*C-2*Math.PI*6378137/2]}class Ku{constructor(u,m,C){if(u<0||u>25||C<0||C>=Math.pow(2,u)||m<0||m>=Math.pow(2,u))throw new Error(`x=${m}, y=${C}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=m,this.y=C,this.key=tf(0,u,u,m,C)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,m,C){const P=(V=this.y,W=this.z,ne=Fm(256*(Q=this.x),256*(V=Math.pow(2,W)-V-1),W),Ae=Fm(256*(Q+1),256*(V+1),W),ne[0]+","+ne[1]+","+Ae[0]+","+Ae[1]);var Q,V,W,ne,Ae;const h=function(c,f,v){let E,M="";for(let R=c;R>0;R--)E=1<<R-1,M+=(f&E?1:0)+(v&E?2:0);return M}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,P)}isChildOf(u){const m=this.z-u.z;return m>0&&u.x===this.x>>m&&u.y===this.y>>m}getTilePoint(u){const m=Math.pow(2,this.z);return new F((u.x*m-this.x)*Kr,(u.y*m-this.y)*Kr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class h_{constructor(u,m){this.wrap=u,this.canonical=m,this.key=tf(u,m.z,m.z,m.x,m.y)}}class tc{constructor(u,m,C,P,Q){if(u<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${C}`);this.overscaledZ=u,this.wrap=m,this.canonical=new Ku(C,+P,+Q),this.key=tf(m,u,C,P,Q)}clone(){return new tc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-u;return u>this.canonical.z?new tc(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tc(u,this.wrap,u,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(u,m){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-u;return u>this.canonical.z?tf(this.wrap*+m,u,this.canonical.z,this.canonical.x,this.canonical.y):tf(this.wrap*+m,u,u,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const m=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>m&&u.canonical.y===this.canonical.y>>m}children(u){if(this.overscaledZ>=u)return[new tc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,C=2*this.canonical.x,P=2*this.canonical.y;return[new tc(m,this.wrap,m,C,P),new tc(m,this.wrap,m,C+1,P),new tc(m,this.wrap,m,C,P+1),new tc(m,this.wrap,m,C+1,P+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new tc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new tc(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new h_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new Pm(u.x-this.wrap,u.y))}}function tf(p,u,m,C,P){(p*=2)<0&&(p=-1*p-1);const Q=1<<m;return(Q*Q*p+Q*P+C).toString(36)+m.toString(36)+u.toString(36)}Fi("CanonicalTileID",Ku),Fi("OverscaledTileID",tc,{omit:["posMatrix"]});class A_{constructor(u,m,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,W=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void Je(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const ne=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=P,this.greenFactor=Q,this.blueFactor=V,this.baseShift=W;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Ae=0;Ae<ne;Ae++)this.data[this._idx(-1,Ae)]=this.data[this._idx(0,Ae)],this.data[this._idx(ne,Ae)]=this.data[this._idx(ne-1,Ae)],this.data[this._idx(Ae,-1)]=this.data[this._idx(Ae,0)],this.data[this._idx(Ae,ne)]=this.data[this._idx(Ae,ne-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ne,-1)]=this.data[this._idx(ne-1,0)],this.data[this._idx(-1,ne)]=this.data[this._idx(0,ne-1)],this.data[this._idx(ne,ne)]=this.data[this._idx(ne-1,ne-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ae=0;Ae<ne;Ae++)for(let h=0;h<ne;h++){const c=this.get(Ae,h);c>this.max&&(this.max=c),c<this.min&&(this.min=c)}}get(u,m){const C=new Uint8Array(this.data.buffer),P=4*this._idx(u,m);return this.unpack(C[P],C[P+1],C[P+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,m){if(u<-1||u>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(u+1)}unpack(u,m,C){return u*this.redFactor+m*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new xl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,m,C){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let P=m*this.dim,Q=m*this.dim+this.dim,V=C*this.dim,W=C*this.dim+this.dim;switch(m){case-1:P=Q-1;break;case 1:Q=P+1}switch(C){case-1:V=W-1;break;case 1:W=V+1}const ne=-m*this.dim,Ae=-C*this.dim;for(let h=V;h<W;h++)for(let c=P;c<Q;c++)this.data[this._idx(c,h)]=u.data[this._idx(c+ne,h+Ae)]}}Fi("DEMData",A_);class d_{constructor(u){this._stringToNumber={},this._numberToString=[];for(let m=0;m<u.length;m++){const C=u[m];this._stringToNumber[C]=m,this._numberToString[m]=C}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class f_{constructor(u,m,C,P,Q){this.type="Feature",this._vectorTileFeature=u,u._z=m,u._x=C,u._y=P,this.properties=u.properties,this.id=Q}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(u[m]=this[m]);return u}}class Dm{constructor(u,m){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Ui(Kr,16,0),this.grid3D=new Ui(Kr,16,0),this.featureIndexArray=new k,this.promoteId=m}insert(u,m,C,P,Q,V){const W=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,P,Q);const ne=V?this.grid3D:this.grid;for(let Ae=0;Ae<m.length;Ae++){const h=m[Ae],c=[1/0,1/0,-1/0,-1/0];for(let f=0;f<h.length;f++){const v=h[f];c[0]=Math.min(c[0],v.x),c[1]=Math.min(c[1],v.y),c[2]=Math.max(c[2],v.x),c[3]=Math.max(c[3],v.y)}c[0]<Kr&&c[1]<Kr&&c[2]>=0&&c[3]>=0&&ne.insert(W,c[0],c[1],c[2],c[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Gu.VectorTile(new Y0(this.rawTileData)).layers,this.sourceLayerCoder=new d_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,m,C,P){this.loadVTLayers();const Q=u.params||{},V=Kr/u.tileSize/u.scale,W=ql(Q.filter),ne=u.queryGeometry,Ae=u.queryPadding*V,h=p_(ne),c=this.grid.query(h.minX-Ae,h.minY-Ae,h.maxX+Ae,h.maxY+Ae),f=p_(u.cameraQueryGeometry),v=this.grid3D.query(f.minX-Ae,f.minY-Ae,f.maxX+Ae,f.maxY+Ae,(R,G,K,Z)=>function(oe,de,ye,Ce,Ie){for(const qe of oe)if(de<=qe.x&&ye<=qe.y&&Ce>=qe.x&&Ie>=qe.y)return!0;const Oe=[new F(de,ye),new F(de,Ie),new F(Ce,Ie),new F(Ce,ye)];if(oe.length>2){for(const qe of Oe)if(jc(oe,qe))return!0}for(let qe=0;qe<oe.length-1;qe++)if(jA(oe[qe],oe[qe+1],Oe))return!0;return!1}(u.cameraQueryGeometry,R-Ae,G-Ae,K+Ae,Z+Ae));for(const R of v)c.push(R);c.sort(g_);const E={};let M;for(let R=0;R<c.length;R++){const G=c[R];if(G===M)continue;M=G;const K=this.featureIndexArray.get(G);let Z=null;this.loadMatchingFeature(E,K.bucketIndex,K.sourceLayerIndex,K.featureIndex,W,Q.layers,Q.availableImages,m,C,P,(oe,de,ye)=>(Z||(Z=Us(oe)),de.queryIntersectsFeature(ne,oe,ye,Z,this.z,u.transform,V,u.pixelPosMatrix)))}return E}loadMatchingFeature(u,m,C,P,Q,V,W,ne,Ae,h,c){const f=this.bucketLayerIDs[m];if(V&&!function(R,G){for(let K=0;K<R.length;K++)if(G.indexOf(R[K])>=0)return!0;return!1}(V,f))return;const v=this.sourceLayerCoder.decode(C),E=this.vtLayers[v].feature(P);if(Q.needGeometry){const R=Xs(E,!0);if(!Q.filter(new _n(this.tileID.overscaledZ),R,this.tileID.canonical))return}else if(!Q.filter(new _n(this.tileID.overscaledZ),E))return;const M=this.getId(E,v);for(let R=0;R<f.length;R++){const G=f[R];if(V&&V.indexOf(G)<0)continue;const K=ne[G];if(!K)continue;let Z={};M&&h&&(Z=h.getState(K.sourceLayer||"_geojsonTileLayer",M));const oe=$e({},Ae[G]);oe.paint=Bp(oe.paint,K.paint,E,Z,W),oe.layout=Bp(oe.layout,K.layout,E,Z,W);const de=!c||c(E,K,Z);if(!de)continue;const ye=new f_(E,this.z,this.x,this.y,M);ye.layer=oe;let Ce=u[G];Ce===void 0&&(Ce=u[G]=[]),Ce.push({featureIndex:P,feature:ye,intersectionZ:de})}}lookupSymbolFeatures(u,m,C,P,Q,V,W,ne){const Ae={};this.loadVTLayers();const h=ql(Q);for(const c of u)this.loadMatchingFeature(Ae,C,P,c,h,V,W,ne,m);return Ae}hasLayer(u){for(const m of this.bucketLayerIDs)for(const C of m)if(u===C)return!0;return!1}getId(u,m){let C=u.id;return this.promoteId&&(C=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof C=="boolean"&&(C=Number(C))),C}}function Bp(p,u,m,C,P){return at(p,(Q,V)=>{const W=u instanceof Ws?u.get(V):null;return W&&W.evaluate?W.evaluate(m,C,P):W})}function p_(p){let u=1/0,m=1/0,C=-1/0,P=-1/0;for(const Q of p)u=Math.min(u,Q.x),m=Math.min(m,Q.y),C=Math.max(C,Q.x),P=Math.max(P,Q.y);return{minX:u,minY:m,maxX:C,maxY:P}}function g_(p,u){return u-p}function m_(p,u,m,C,P){const Q=[];for(let V=0;V<p.length;V++){const W=p[V];let ne;for(let Ae=0;Ae<W.length-1;Ae++){let h=W[Ae],c=W[Ae+1];h.x<u&&c.x<u||(h.x<u?h=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x<u&&(c=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y<m&&c.y<m||(h.y<m?h=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round():c.y<m&&(c=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round()),h.x>=C&&c.x>=C||(h.x>=C?h=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x>=C&&(c=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y>=P&&c.y>=P||(h.y>=P?h=new F(h.x+(P-h.y)/(c.y-h.y)*(c.x-h.x),P)._round():c.y>=P&&(c=new F(h.x+(P-h.y)/(c.y-h.y)*(c.x-h.x),P)._round()),ne&&h.equals(ne[ne.length-1])||(ne=[h],Q.push(ne)),ne.push(c)))))}}return Q}Fi("FeatureIndex",Dm,{omit:["rawTileData","sourceLayerCoder"]});class Qo extends F{constructor(u,m,C,P){super(u,m),this.angle=C,P!==void 0&&(this.segment=P)}clone(){return new Qo(this.x,this.y,this.angle,this.segment)}}function rf(p,u,m,C,P){if(u.segment===void 0||m===0)return!0;let Q=u,V=u.segment+1,W=0;for(;W>-m/2;){if(V--,V<0)return!1;W-=p[V].dist(Q),Q=p[V]}W+=p[V].dist(p[V+1]),V++;const ne=[];let Ae=0;for(;W<m/2;){const h=p[V],c=p[V+1];if(!c)return!1;let f=p[V-1].angleTo(h)-h.angleTo(c);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),ne.push({distance:W,angleDelta:f}),Ae+=f;W-ne[0].distance>C;)Ae-=ne.shift().angleDelta;if(Ae>P)return!1;V++,W+=h.dist(c)}return!0}function y_(p){let u=0;for(let m=0;m<p.length-1;m++)u+=p[m].dist(p[m+1]);return u}function __(p,u,m){return p?.6*u*m:0}function v_(p,u){return Math.max(p?p.right-p.left:0,u?u.right-u.left:0)}function Gx(p,u,m,C,P,Q){const V=__(m,P,Q),W=v_(m,C)*Q;let ne=0;const Ae=y_(p)/2;for(let h=0;h<p.length-1;h++){const c=p[h],f=p[h+1],v=c.dist(f);if(ne+v>Ae){const E=(Ae-ne)/v,M=fn.number(c.x,f.x,E),R=fn.number(c.y,f.y,E),G=new Qo(M,R,f.angleTo(c),h);return G._round(),!V||rf(p,G,W,V,u)?G:void 0}ne+=v}}function jx(p,u,m,C,P,Q,V,W,ne){const Ae=__(C,Q,V),h=v_(C,P),c=h*V,f=p[0].x===0||p[0].x===ne||p[0].y===0||p[0].y===ne;return u-c<u/4&&(u=c+u/4),b_(p,f?u/2*W%u:(h/2+2*Q)*V*W%u,u,Ae,m,c,f,!1,ne)}function b_(p,u,m,C,P,Q,V,W,ne){const Ae=Q/2,h=y_(p);let c=0,f=u-m,v=[];for(let E=0;E<p.length-1;E++){const M=p[E],R=p[E+1],G=M.dist(R),K=R.angleTo(M);for(;f+m<c+G;){f+=m;const Z=(f-c)/G,oe=fn.number(M.x,R.x,Z),de=fn.number(M.y,R.y,Z);if(oe>=0&&oe<ne&&de>=0&&de<ne&&f-Ae>=0&&f+Ae<=h){const ye=new Qo(oe,de,K,E);ye._round(),C&&!rf(p,ye,Q,C,P)||v.push(ye)}}c+=G}return W||v.length||V||(v=b_(p,c/2,m,C,P,Q,V,!0,ne)),v}Fi("Anchor",Qo);const nf=zo;function x_(p,u,m,C){const P=[],Q=p.image,V=Q.pixelRatio,W=Q.paddedRect.w-2*nf,ne=Q.paddedRect.h-2*nf,Ae=p.right-p.left,h=p.bottom-p.top,c=Q.stretchX||[[0,W]],f=Q.stretchY||[[0,ne]],v=(Ke,ut)=>Ke+ut[1]-ut[0],E=c.reduce(v,0),M=f.reduce(v,0),R=W-E,G=ne-M;let K=0,Z=E,oe=0,de=M,ye=0,Ce=R,Ie=0,Oe=G;if(Q.content&&C){const Ke=Q.content;K=_u(c,0,Ke[0]),oe=_u(f,0,Ke[1]),Z=_u(c,Ke[0],Ke[2]),de=_u(f,Ke[1],Ke[3]),ye=Ke[0]-K,Ie=Ke[1]-oe,Ce=Ke[2]-Ke[0]-Z,Oe=Ke[3]-Ke[1]-de}const qe=(Ke,ut,et,it)=>{const mt=Cp(Ke.stretch-K,Z,Ae,p.left),Tt=Ep(Ke.fixed-ye,Ce,Ke.stretch,E),Zt=Cp(ut.stretch-oe,de,h,p.top),wi=Ep(ut.fixed-Ie,Oe,ut.stretch,M),ai=Cp(et.stretch-K,Z,Ae,p.left),di=Ep(et.fixed-ye,Ce,et.stretch,E),pi=Cp(it.stretch-oe,de,h,p.top),Di=Ep(it.fixed-Ie,Oe,it.stretch,M),li=new F(mt,Zt),Jt=new F(ai,Zt),Hi=new F(ai,pi),Vi=new F(mt,pi),mr=new F(Tt/V,wi/V),Rr=new F(di/V,Di/V),Qr=u*Math.PI/180;if(Qr){const Qn=Math.sin(Qr),bn=Math.cos(Qr),Dn=[bn,-Qn,Qn,bn];li._matMult(Dn),Jt._matMult(Dn),Vi._matMult(Dn),Hi._matMult(Dn)}const gn=Ke.stretch+Ke.fixed,ls=ut.stretch+ut.fixed;return{tl:li,tr:Jt,bl:Vi,br:Hi,tex:{x:Q.paddedRect.x+nf+gn,y:Q.paddedRect.y+nf+ls,w:et.stretch+et.fixed-gn,h:it.stretch+it.fixed-ls},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mr,pixelOffsetBR:Rr,minFontScaleX:Ce/V/Ae,minFontScaleY:Oe/V/h,isSDF:m}};if(C&&(Q.stretchX||Q.stretchY)){const Ke=w_(c,R,E),ut=w_(f,G,M);for(let et=0;et<Ke.length-1;et++){const it=Ke[et],mt=Ke[et+1];for(let Tt=0;Tt<ut.length-1;Tt++)P.push(qe(it,ut[Tt],mt,ut[Tt+1]))}}else P.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:W+1},{fixed:0,stretch:ne+1}));return P}function _u(p,u,m){let C=0;for(const P of p)C+=Math.max(u,Math.min(m,P[1]))-Math.max(u,Math.min(m,P[0]));return C}function w_(p,u,m){const C=[{fixed:-nf,stretch:0}];for(const[P,Q]of p){const V=C[C.length-1];C.push({fixed:P-V.stretch,stretch:V.stretch}),C.push({fixed:P-V.stretch,stretch:V.stretch+(Q-P)})}return C.push({fixed:u+nf,stretch:m}),C}function Cp(p,u,m,C){return p/u*m+C}function Ep(p,u,m,C){return p-u*m/C}class Sp{constructor(u,m,C,P,Q,V,W,ne,Ae,h){if(this.boxStartIndex=u.length,Ae){let c=V.top,f=V.bottom;const v=V.collisionPadding;v&&(c-=v[1],f+=v[3]);let E=f-c;E>0&&(E=Math.max(10,E),this.circleDiameter=E)}else{let c=V.top*W-ne[0],f=V.bottom*W+ne[2],v=V.left*W-ne[3],E=V.right*W+ne[1];const M=V.collisionPadding;if(M&&(v-=M[0]*W,c-=M[1]*W,E+=M[2]*W,f+=M[3]*W),h){const R=new F(v,c),G=new F(E,c),K=new F(v,f),Z=new F(E,f),oe=h*Math.PI/180;R._rotate(oe),G._rotate(oe),K._rotate(oe),Z._rotate(oe),v=Math.min(R.x,G.x,K.x,Z.x),E=Math.max(R.x,G.x,K.x,Z.x),c=Math.min(R.y,G.y,K.y,Z.y),f=Math.max(R.y,G.y,K.y,Z.y)}u.emplaceBack(m.x,m.y,v,c,E,f,C,P,Q)}this.boxEndIndex=u.length}}class DI{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:RI;if(this.data=u,this.length=this.data.length,this.compare=m,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:m,compare:C}=this,P=m[u];for(;u>0;){const Q=u-1>>1,V=m[Q];if(C(P,V)>=0)break;m[u]=V,u=Q}m[u]=P}_down(u){const{data:m,compare:C}=this,P=this.length>>1,Q=m[u];for(;u<P;){let V=1+(u<<1),W=m[V];const ne=V+1;if(ne<this.length&&C(m[ne],W)<0&&(V=ne,W=m[ne]),C(W,Q)>=0)break;m[u]=W,u=V}m[u]=Q}}function RI(p,u){return p<u?-1:p>u?1:0}function qx(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,P=1/0,Q=-1/0,V=-1/0;const W=p[0];for(let v=0;v<W.length;v++){const E=W[v];(!v||E.x<C)&&(C=E.x),(!v||E.y<P)&&(P=E.y),(!v||E.x>Q)&&(Q=E.x),(!v||E.y>V)&&(V=E.y)}const ne=Math.min(Q-C,V-P);let Ae=ne/2;const h=new DI([],sf);if(ne===0)return new F(C,P);for(let v=C;v<Q;v+=ne)for(let E=P;E<V;E+=ne)h.push(new JA(v+Ae,E+Ae,Ae,p));let c=function(v){let E=0,M=0,R=0;const G=v[0];for(let K=0,Z=G.length,oe=Z-1;K<Z;oe=K++){const de=G[K],ye=G[oe],Ce=de.x*ye.y-ye.x*de.y;M+=(de.x+ye.x)*Ce,R+=(de.y+ye.y)*Ce,E+=3*Ce}return new JA(M/E,R/E,0,v)}(p),f=h.length;for(;h.length;){const v=h.pop();(v.d>c.d||!c.d)&&(c=v,m&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,f)),v.max-c.d<=u||(Ae=v.h/2,h.push(new JA(v.p.x-Ae,v.p.y-Ae,Ae,p)),h.push(new JA(v.p.x+Ae,v.p.y-Ae,Ae,p)),h.push(new JA(v.p.x-Ae,v.p.y+Ae,Ae,p)),h.push(new JA(v.p.x+Ae,v.p.y+Ae,Ae,p)),f+=4)}return m&&(console.log(`num probes: ${f}`),console.log(`best distance: ${c.d}`)),c.p}function sf(p,u){return u.max-p.max}function JA(p,u,m,C){this.p=new F(p,u),this.h=m,this.d=function(P,Q){let V=!1,W=1/0;for(let ne=0;ne<Q.length;ne++){const Ae=Q[ne];for(let h=0,c=Ae.length,f=c-1;h<c;f=h++){const v=Ae[h],E=Ae[f];v.y>P.y!=E.y>P.y&&P.x<(E.x-v.x)*(P.y-v.y)/(E.y-v.y)+v.x&&(V=!V),W=Math.min(W,Qu(P,v,E))}}return(V?1:-1)*Math.sqrt(W)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var bo;l.ap=void 0,(bo=l.ap||(l.ap={}))[bo.center=1]="center",bo[bo.left=2]="left",bo[bo.right=3]="right",bo[bo.top=4]="top",bo[bo.bottom=5]="bottom",bo[bo["top-left"]=6]="top-left",bo[bo["top-right"]=7]="top-right",bo[bo["bottom-left"]=8]="bottom-left",bo[bo["bottom-right"]=9]="bottom-right";const Ph=7,of=Number.POSITIVE_INFINITY;function Tp(p,u){return u[1]!==of?function(m,C,P){let Q=0,V=0;switch(C=Math.abs(C),P=Math.abs(P),m){case"top-right":case"top-left":case"top":V=P-Ph;break;case"bottom-right":case"bottom-left":case"bottom":V=-P+Ph}switch(m){case"top-right":case"bottom-right":case"right":Q=-C;break;case"top-left":case"bottom-left":case"left":Q=C}return[Q,V]}(p,u[0],u[1]):function(m,C){let P=0,Q=0;C<0&&(C=0);const V=C/Math.SQRT2;switch(m){case"top-right":case"top-left":Q=V-Ph;break;case"bottom-right":case"bottom-left":Q=-V+Ph;break;case"bottom":Q=-C+Ph;break;case"top":Q=C-Ph}switch(m){case"top-right":case"bottom-right":P=-V;break;case"top-left":case"bottom-left":P=V;break;case"left":P=C;break;case"right":P=-C}return[P,Q]}(p,u[0])}function Ip(p,u,m){var C;const P=p.layout,Q=(C=P.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(u,{},m);if(Q){const W=Q.values,ne=[];for(let Ae=0;Ae<W.length;Ae+=2){const h=ne[Ae]=W[Ae],c=W[Ae+1].map(f=>f*vo);h.startsWith("top")?c[1]-=Ph:h.startsWith("bottom")&&(c[1]+=Ph),ne[Ae+1]=c}return new Vr(ne)}const V=P.get("text-variable-anchor");if(V){let W;W=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[P.get("text-radial-offset").evaluate(u,{},m)*vo,of]:P.get("text-offset").evaluate(u,{},m).map(Ae=>Ae*vo);const ne=[];for(const Ae of V)ne.push(Ae,Tp(Ae,W));return new Vr(ne)}return null}function B_(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kI(p,u,m,C,P,Q,V,W,ne,Ae,h){let c=Q.textMaxSize.evaluate(u,{});c===void 0&&(c=V);const f=p.layers[0].layout,v=f.get("icon-offset").evaluate(u,{},h),E=Kx(m.horizontal),M=V/24,R=p.tilePixelRatio*M,G=p.tilePixelRatio*c/24,K=p.tilePixelRatio*W,Z=p.tilePixelRatio*f.get("symbol-spacing"),oe=f.get("text-padding")*p.tilePixelRatio,de=function(it,mt,Tt){let Zt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const wi=it.get("icon-padding").evaluate(mt,{},Tt),ai=wi&&wi.values;return[ai[0]*Zt,ai[1]*Zt,ai[2]*Zt,ai[3]*Zt]}(f,u,h,p.tilePixelRatio),ye=f.get("text-max-angle")/180*Math.PI,Ce=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",Ie=f.get("icon-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point",Oe=f.get("symbol-placement"),qe=Z/2,Ke=f.get("icon-text-fit");let ut;C&&Ke!=="none"&&(p.allowVerticalPlacement&&m.vertical&&(ut=i_(C,m.vertical,Ke,f.get("icon-text-fit-padding"),v,M)),E&&(C=i_(C,E,Ke,f.get("icon-text-fit-padding"),v,M)));const et=(it,mt)=>{mt.x<0||mt.x>=Kr||mt.y<0||mt.y>=Kr||function(Tt,Zt,wi,ai,di,pi,Di,li,Jt,Hi,Vi,mr,Rr,Qr,gn,ls,Qn,bn,Dn,un,br,Vn,hn,tn,ps){const Is=Tt.addToLineVertexArray(Zt,wi);let bs,Js,Ls,Rn,wr=0,zs=0,lo=0,co=0,ic=-1,bc=-1;const oa={};let Xu=Ii("");if(Tt.allowVerticalPlacement&&ai.vertical){const Na=li.layout.get("text-rotate").evaluate(br,{},tn)+90;Ls=new Sp(Jt,Zt,Hi,Vi,mr,ai.vertical,Rr,Qr,gn,Na),Di&&(Rn=new Sp(Jt,Zt,Hi,Vi,mr,Di,Qn,bn,gn,Na))}if(di){const Na=li.layout.get("icon-rotate").evaluate(br,{}),Bc=li.layout.get("icon-text-fit")!=="none",YA=x_(di,Na,hn,Bc),vu=Di?x_(Di,Na,hn,Bc):void 0;Js=new Sp(Jt,Zt,Hi,Vi,mr,di,Qn,bn,!1,Na),wr=4*YA.length;const za=Tt.iconSizeData;let Cc=null;za.kind==="source"?(Cc=[qu*li.layout.get("icon-size").evaluate(br,{})],Cc[0]>Lh&&Je(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${Jd}. Reduce your "icon-size".`)):za.kind==="composite"&&(Cc=[qu*Vn.compositeIconSizes[0].evaluate(br,{},tn),qu*Vn.compositeIconSizes[1].evaluate(br,{},tn)],(Cc[0]>Lh||Cc[1]>Lh)&&Je(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${Jd}. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,YA,Cc,un,Dn,br,l.ah.none,Zt,Is.lineStartIndex,Is.lineLength,-1,tn),ic=Tt.icon.placedSymbolArray.length-1,vu&&(zs=4*vu.length,Tt.addSymbols(Tt.icon,vu,Cc,un,Dn,br,l.ah.vertical,Zt,Is.lineStartIndex,Is.lineLength,-1,tn),bc=Tt.icon.placedSymbolArray.length-1)}const xc=Object.keys(ai.horizontal);for(const Na of xc){const Bc=ai.horizontal[Na];if(!bs){Xu=Ii(Bc.text);const vu=li.layout.get("text-rotate").evaluate(br,{},tn);bs=new Sp(Jt,Zt,Hi,Vi,mr,Bc,Rr,Qr,gn,vu)}const YA=Bc.positionedLines.length===1;if(lo+=$x(Tt,Zt,Bc,pi,li,gn,br,ls,Is,ai.vertical?l.ah.horizontal:l.ah.horizontalOnly,YA?xc:[Na],oa,ic,Vn,tn),YA)break}ai.vertical&&(co+=$x(Tt,Zt,ai.vertical,pi,li,gn,br,ls,Is,l.ah.vertical,["vertical"],oa,bc,Vn,tn));const wc=bs?bs.boxStartIndex:Tt.collisionBoxArray.length,Cl=bs?bs.boxEndIndex:Tt.collisionBoxArray.length,Fh=Ls?Ls.boxStartIndex:Tt.collisionBoxArray.length,kp=Ls?Ls.boxEndIndex:Tt.collisionBoxArray.length,Zx=Js?Js.boxStartIndex:Tt.collisionBoxArray.length,E_=Js?Js.boxEndIndex:Tt.collisionBoxArray.length,S_=Rn?Rn.boxStartIndex:Tt.collisionBoxArray.length,Dh=Rn?Rn.boxEndIndex:Tt.collisionBoxArray.length;let Kc=-1;const Op=(Na,Bc)=>Na&&Na.circleDiameter?Math.max(Na.circleDiameter,Bc):Bc;Kc=Op(bs,Kc),Kc=Op(Ls,Kc),Kc=Op(Js,Kc),Kc=Op(Rn,Kc);const Jx=Kc>-1?1:0;Jx&&(Kc*=ps/vo),Tt.glyphOffsetArray.length>=XA.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),br.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,br.sortKey);const OI=Ip(li,br,tn),[UI,NI]=function(Na,Bc){const YA=Na.length,vu=Bc==null?void 0:Bc.values;if((vu==null?void 0:vu.length)>0)for(let za=0;za<vu.length;za+=2){const Cc=vu[za+1];Na.emplaceBack(l.ap[vu[za]],Cc[0],Cc[1])}return[YA,Na.length]}(Tt.textAnchorOffsets,OI);Tt.symbolInstances.emplaceBack(Zt.x,Zt.y,oa.right>=0?oa.right:-1,oa.center>=0?oa.center:-1,oa.left>=0?oa.left:-1,oa.vertical||-1,ic,bc,Xu,wc,Cl,Fh,kp,Zx,E_,S_,Dh,Hi,lo,co,wr,zs,Jx,0,Rr,Kc,UI,NI)}(p,mt,it,m,C,P,ut,p.layers[0],p.collisionBoxArray,u.index,u.sourceLayerIndex,p.index,R,[oe,oe,oe,oe],Ce,ne,K,de,Ie,v,u,Q,Ae,h,V)};if(Oe==="line")for(const it of m_(u.geometry,0,0,Kr,Kr)){const mt=jx(it,Z,ye,m.vertical||E,C,24,G,p.overscaling,Kr);for(const Tt of mt)E&&af(p,E.text,qe,Tt)||et(it,Tt)}else if(Oe==="line-center"){for(const it of u.geometry)if(it.length>1){const mt=Gx(it,ye,m.vertical||E,C,24,G);mt&&et(it,mt)}}else if(u.type==="Polygon")for(const it of _m(u.geometry,0)){const mt=qx(it,16);et(it[0],new Qo(mt.x,mt.y,0))}else if(u.type==="LineString")for(const it of u.geometry)et(it,new Qo(it[0].x,it[0].y,0));else if(u.type==="Point")for(const it of u.geometry)for(const mt of it)et([mt],new Qo(mt.x,mt.y,0))}function $x(p,u,m,C,P,Q,V,W,ne,Ae,h,c,f,v,E){const M=function(K,Z,oe,de,ye,Ce,Ie,Oe){const qe=de.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,Ke=[];for(const ut of Z.positionedLines)for(const et of ut.positionedGlyphs){if(!et.rect)continue;const it=et.rect||{};let mt=Dx+1,Tt=!0,Zt=1,wi=0;const ai=(ye||Oe)&&et.vertical,di=et.metrics.advance*et.scale/2;if(Oe&&Z.verticalizable&&(wi=ut.lineOffset/2-(et.imageName?-(vo-et.metrics.width*et.scale)/2:(et.scale-1)*vo)),et.imageName){const un=Ie[et.imageName];Tt=un.sdf,Zt=un.pixelRatio,mt=zo/Zt}const pi=ye?[et.x+di,et.y]:[0,0];let Di=ye?[0,0]:[et.x+di+oe[0],et.y+oe[1]-wi],li=[0,0];ai&&(li=Di,Di=[0,0]);const Jt=et.metrics.isDoubleResolution?2:1,Hi=(et.metrics.left-mt)*et.scale-di+Di[0],Vi=(-et.metrics.top-mt)*et.scale+Di[1],mr=Hi+it.w/Jt*et.scale/Zt,Rr=Vi+it.h/Jt*et.scale/Zt,Qr=new F(Hi,Vi),gn=new F(mr,Vi),ls=new F(Hi,Rr),Qn=new F(mr,Rr);if(ai){const un=new F(-di,di-mp),br=-Math.PI/2,Vn=vo/2-di,hn=new F(5-mp-Vn,-(et.imageName?Vn:0)),tn=new F(...li);Qr._rotateAround(br,un)._add(hn)._add(tn),gn._rotateAround(br,un)._add(hn)._add(tn),ls._rotateAround(br,un)._add(hn)._add(tn),Qn._rotateAround(br,un)._add(hn)._add(tn)}if(qe){const un=Math.sin(qe),br=Math.cos(qe),Vn=[br,-un,un,br];Qr._matMult(Vn),gn._matMult(Vn),ls._matMult(Vn),Qn._matMult(Vn)}const bn=new F(0,0),Dn=new F(0,0);Ke.push({tl:Qr,tr:gn,bl:ls,br:Qn,tex:it,writingMode:Z.writingMode,glyphOffset:pi,sectionIndex:et.sectionIndex,isSDF:Tt,pixelOffsetTL:bn,pixelOffsetBR:Dn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,m,W,P,Q,V,C,p.allowVerticalPlacement),R=p.textSizeData;let G=null;R.kind==="source"?(G=[qu*P.layout.get("text-size").evaluate(V,{})],G[0]>Lh&&Je(`${p.layerIds[0]}: Value for "text-size" is >= ${Jd}. Reduce your "text-size".`)):R.kind==="composite"&&(G=[qu*v.compositeTextSizes[0].evaluate(V,{},E),qu*v.compositeTextSizes[1].evaluate(V,{},E)],(G[0]>Lh||G[1]>Lh)&&Je(`${p.layerIds[0]}: Value for "text-size" is >= ${Jd}. Reduce your "text-size".`)),p.addSymbols(p.text,M,G,W,Q,V,Ae,u,ne.lineStartIndex,ne.lineLength,f,E);for(const K of h)c[K]=p.text.placedSymbolArray.length-1;return 4*M.length}function Kx(p){for(const u in p)return p[u];return null}function af(p,u,m,C){const P=p.compareText;if(u in P){const Q=P[u];for(let V=Q.length-1;V>=0;V--)if(C.dist(Q[V])<m)return!0}else P[u]=[];return P[u].push(C),!1}const sa=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wu{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,C]=new Uint8Array(u,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const P=C>>4;if(P!==1)throw new Error(`Got v${P} data when expected v1.`);const Q=sa[15&C];if(!Q)throw new Error("Unrecognized array type.");const[V]=new Uint16Array(u,2,1),[W]=new Uint32Array(u,4,1);return new Wu(W,V,Q,u)}constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,P=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=C,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Q=sa.indexOf(this.ArrayType),V=2*u*this.ArrayType.BYTES_PER_ELEMENT,W=u*this.IndexArrayType.BYTES_PER_ELEMENT,ne=(8-W%8)%8;if(Q<0)throw new Error(`Unexpected typed array class: ${C}.`);P&&P instanceof ArrayBuffer?(this.data=P,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+W+ne,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+V+W+ne),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+W+ne,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Q]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=u)}add(u,m){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=u,this.coords[this._pos++]=m,C}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return Lp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,m,C,P){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Q,coords:V,nodeSize:W}=this,ne=[0,Q.length-1,0],Ae=[];for(;ne.length;){const h=ne.pop()||0,c=ne.pop()||0,f=ne.pop()||0;if(c-f<=W){for(let R=f;R<=c;R++){const G=V[2*R],K=V[2*R+1];G>=u&&G<=C&&K>=m&&K<=P&&Ae.push(Q[R])}continue}const v=f+c>>1,E=V[2*v],M=V[2*v+1];E>=u&&E<=C&&M>=m&&M<=P&&Ae.push(Q[v]),(h===0?u<=E:m<=M)&&(ne.push(f),ne.push(v-1),ne.push(1-h)),(h===0?C>=E:P>=M)&&(ne.push(v+1),ne.push(c),ne.push(1-h))}return Ae}within(u,m,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:Q,nodeSize:V}=this,W=[0,P.length-1,0],ne=[],Ae=C*C;for(;W.length;){const h=W.pop()||0,c=W.pop()||0,f=W.pop()||0;if(c-f<=V){for(let R=f;R<=c;R++)Wx(Q[2*R],Q[2*R+1],u,m)<=Ae&&ne.push(P[R]);continue}const v=f+c>>1,E=Q[2*v],M=Q[2*v+1];Wx(E,M,u,m)<=Ae&&ne.push(P[v]),(h===0?u-C<=E:m-C<=M)&&(W.push(f),W.push(v-1),W.push(1-h)),(h===0?u+C>=E:m+C>=M)&&(W.push(v+1),W.push(c),W.push(1-h))}return ne}}function Lp(p,u,m,C,P,Q){if(P-C<=m)return;const V=C+P>>1;C_(p,u,V,C,P,Q),Lp(p,u,m,C,V-1,1-Q),Lp(p,u,m,V+1,P,1-Q)}function C_(p,u,m,C,P,Q){for(;P>C;){if(P-C>600){const Ae=P-C+1,h=m-C+1,c=Math.log(Ae),f=.5*Math.exp(2*c/3),v=.5*Math.sqrt(c*f*(Ae-f)/Ae)*(h-Ae/2<0?-1:1);C_(p,u,m,Math.max(C,Math.floor(m-h*f/Ae+v)),Math.min(P,Math.floor(m+(Ae-h)*f/Ae+v)),Q)}const V=u[2*m+Q];let W=C,ne=P;for(lf(p,u,C,m),u[2*P+Q]>V&&lf(p,u,C,P);W<ne;){for(lf(p,u,W,ne),W++,ne--;u[2*W+Q]<V;)W++;for(;u[2*ne+Q]>V;)ne--}u[2*C+Q]===V?lf(p,u,C,ne):(ne++,lf(p,u,ne,P)),ne<=m&&(C=ne+1),m<=ne&&(P=ne-1)}}function lf(p,u,m,C){Mp(p,m,C),Mp(u,2*m,2*C),Mp(u,2*m+1,2*C+1)}function Mp(p,u,m){const C=p[u];p[u]=p[m],p[m]=C}function Wx(p,u,m,C){const P=p-m,Q=u-C;return P*P+Q*Q}var Rm;l.bc=void 0,(Rm=l.bc||(l.bc={})).create="create",Rm.load="load",Rm.fullLoad="fullLoad";let Pp=null,Fp=[];const km=1e3/60,Dp="loadTime",Rp="fullLoadTime",Xx={mark(p){performance.mark(p)},frame(p){const u=p;Pp!=null&&Fp.push(u-Pp),Pp=u},clearMetrics(){Pp=null,Fp=[],performance.clearMeasures(Dp),performance.clearMeasures(Rp);for(const p in l.bc)performance.clearMarks(l.bc[p])},getPerformanceMetrics(){performance.measure(Dp,l.bc.create,l.bc.load),performance.measure(Rp,l.bc.create,l.bc.fullLoad);const p=performance.getEntriesByName(Dp)[0].duration,u=performance.getEntriesByName(Rp)[0].duration,m=Fp.length,C=1/(Fp.reduce((Q,V)=>Q+V,0)/m/1e3),P=Fp.filter(Q=>Q>km).reduce((Q,V)=>Q+(V-km)/km,0);return{loadTime:p,fullLoadTime:u,fps:C,percentDroppedFrames:P/(m+P)*100,totalFrames:m}}};l.$=xt,l.A=ec,l.B=function(p){if(Mt==null){const u=p.navigator?p.navigator.userAgent:null;Mt=!!p.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Mt},l.C=class{constructor(p,u){this.target=p,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Nx(()=>this.process()),this.subscription=function(m,C,P,Q){return m.addEventListener(C,P,!1),{unsubscribe:()=>{m.removeEventListener(C,P,!1)}}}(this.target,"message",m=>this.receive(m)),this.globalScope=Et(self)?p:window}registerMessageHandler(p,u){this.messageHandlers[p]=u}sendAsync(p,u){return new Promise((m,C)=>{const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[P]={resolve:m,reject:C},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[P];const W={id:P,type:"<cancel>",origin:location.origin,targetMapId:p.targetMapId,sourceMapId:this.mapId};this.target.postMessage(W)},{once:!0});const Q=[],V=Object.assign(Object.assign({},p),{id:P,sourceMapId:this.mapId,origin:location.origin,data:Kl(p.data,Q)});this.target.postMessage(V,{transfer:Q})})}receive(p){const u=p.data,m=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[m];const C=this.abortControllers[m];return delete this.abortControllers[m],void(C&&C.abort())}if(Et(self)||u.mustQueue)return this.tasks[m]=u,this.taskQueue.push(m),void this.invoker.trigger();this.processTask(m,u)}}process(){if(this.taskQueue.length===0)return;const p=this.taskQueue.shift(),u=this.tasks[p];delete this.tasks[p],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(p,u)}processTask(p,u){return s(this,void 0,void 0,function*(){if(u.type==="<response>"){const P=this.resolveRejects[p];return delete this.resolveRejects[p],P?void(u.error?P.reject(Mi(u.error)):P.resolve(Mi(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(p,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const m=Mi(u.data),C=new AbortController;this.abortControllers[p]=C;try{const P=yield this.messageHandlers[u.type](u.sourceMapId,m,C);this.completeTask(p,null,P)}catch(P){this.completeTask(p,P)}})}completeTask(p,u,m){const C=[];delete this.abortControllers[p];const P={id:p,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?Kl(u):null,data:Kl(m,C)};this.target.postMessage(P,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},l.D=xi,l.E=lt,l.F=function(){var p=new ec(16);return ec!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},l.G=Bt,l.H=function(p,u,m){var C,P,Q,V,W,ne,Ae,h,c,f,v,E,M=m[0],R=m[1],G=m[2];return u===p?(p[12]=u[0]*M+u[4]*R+u[8]*G+u[12],p[13]=u[1]*M+u[5]*R+u[9]*G+u[13],p[14]=u[2]*M+u[6]*R+u[10]*G+u[14],p[15]=u[3]*M+u[7]*R+u[11]*G+u[15]):(P=u[1],Q=u[2],V=u[3],W=u[4],ne=u[5],Ae=u[6],h=u[7],c=u[8],f=u[9],v=u[10],E=u[11],p[0]=C=u[0],p[1]=P,p[2]=Q,p[3]=V,p[4]=W,p[5]=ne,p[6]=Ae,p[7]=h,p[8]=c,p[9]=f,p[10]=v,p[11]=E,p[12]=C*M+W*R+c*G+u[12],p[13]=P*M+ne*R+f*G+u[13],p[14]=Q*M+Ae*R+v*G+u[14],p[15]=V*M+h*R+E*G+u[15]),p},l.I=Cm,l.J=function(p,u,m){var C=m[0],P=m[1],Q=m[2];return p[0]=u[0]*C,p[1]=u[1]*C,p[2]=u[2]*C,p[3]=u[3]*C,p[4]=u[4]*P,p[5]=u[5]*P,p[6]=u[6]*P,p[7]=u[7]*P,p[8]=u[8]*Q,p[9]=u[9]*Q,p[10]=u[10]*Q,p[11]=u[11]*Q,p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},l.K=wh,l.L=function(p,u){const m={};for(let C=0;C<u.length;C++){const P=u[C];P in p&&(m[P]=p[P])}return m},l.M=Mh,l.N=c_,l.O=Vx,l.P=F,l.Q=tc,l.R=xl,l.S=ue,l.T=Zl,l.U=fe,l.V=Pt,l.W=Kr,l.X=Kn,l.Y=Pm,l.Z=class extends ta{},l._=s,l.a=dt,l.a$=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]+p[3]*u[3]},l.a0=Ku,l.a1=zt,l.a2=p=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(m=>{u.onloadstart=()=>{m(u)};for(const C of p){const P=window.document.createElement("source");ri(C)||(u.crossOrigin="Anonymous"),P.src=C,u.appendChild(P)}})},l.a3=function(){return Ne++},l.a4=a,l.a5=XA,l.a6=ql,l.a7=Xs,l.a8=_n,l.a9=f_,l.aA=Re,l.aB=function(p,u){if(!p)return[{command:"setStyle",args:[u]}];let m=[];try{if(!ht(p.version,u.version))return[{command:"setStyle",args:[u]}];ht(p.center,u.center)||m.push({command:"setCenter",args:[u.center]}),ht(p.zoom,u.zoom)||m.push({command:"setZoom",args:[u.zoom]}),ht(p.bearing,u.bearing)||m.push({command:"setBearing",args:[u.bearing]}),ht(p.pitch,u.pitch)||m.push({command:"setPitch",args:[u.pitch]}),ht(p.sprite,u.sprite)||m.push({command:"setSprite",args:[u.sprite]}),ht(p.glyphs,u.glyphs)||m.push({command:"setGlyphs",args:[u.glyphs]}),ht(p.transition,u.transition)||m.push({command:"setTransition",args:[u.transition]}),ht(p.light,u.light)||m.push({command:"setLight",args:[u.light]}),ht(p.terrain,u.terrain)||m.push({command:"setTerrain",args:[u.terrain]}),ht(p.sky,u.sky)||m.push({command:"setSky",args:[u.sky]});const C={},P=[];(function(V,W,ne,Ae){let h;for(h in W=W||{},V=V||{})Object.prototype.hasOwnProperty.call(V,h)&&(Object.prototype.hasOwnProperty.call(W,h)||fi(h,ne,Ae));for(h in W)Object.prototype.hasOwnProperty.call(W,h)&&(Object.prototype.hasOwnProperty.call(V,h)?ht(V[h],W[h])||(V[h].type==="geojson"&&W[h].type==="geojson"&&Wi(V,W,h)?qt(ne,{command:"setGeoJSONSourceData",args:[h,W[h].data]}):ci(h,W,ne,Ae)):si(h,W,ne))})(p.sources,u.sources,P,C);const Q=[];p.layers&&p.layers.forEach(V=>{"source"in V&&C[V.source]?m.push({command:"removeLayer",args:[V.id]}):Q.push(V)}),m=m.concat(P),function(V,W,ne){W=W||[];const Ae=(V=V||[]).map(dr),h=W.map(dr),c=V.reduce(Sr,{}),f=W.reduce(Sr,{}),v=Ae.slice(),E=Object.create(null);let M,R,G,K,Z;for(let oe=0,de=0;oe<Ae.length;oe++)M=Ae[oe],Object.prototype.hasOwnProperty.call(f,M)?de++:(qt(ne,{command:"removeLayer",args:[M]}),v.splice(v.indexOf(M,de),1));for(let oe=0,de=0;oe<h.length;oe++)M=h[h.length-1-oe],v[v.length-1-oe]!==M&&(Object.prototype.hasOwnProperty.call(c,M)?(qt(ne,{command:"removeLayer",args:[M]}),v.splice(v.lastIndexOf(M,v.length-de),1)):de++,K=v[v.length-oe],qt(ne,{command:"addLayer",args:[f[M],K]}),v.splice(v.length-oe,0,M),E[M]=!0);for(let oe=0;oe<h.length;oe++)if(M=h[oe],R=c[M],G=f[M],!E[M]&&!ht(R,G))if(ht(R.source,G.source)&&ht(R["source-layer"],G["source-layer"])&&ht(R.type,G.type)){for(Z in ir(R.layout,G.layout,ne,M,null,"setLayoutProperty"),ir(R.paint,G.paint,ne,M,null,"setPaintProperty"),ht(R.filter,G.filter)||qt(ne,{command:"setFilter",args:[M,G.filter]}),ht(R.minzoom,G.minzoom)&&ht(R.maxzoom,G.maxzoom)||qt(ne,{command:"setLayerZoomRange",args:[M,G.minzoom,G.maxzoom]}),R)Object.prototype.hasOwnProperty.call(R,Z)&&Z!=="layout"&&Z!=="paint"&&Z!=="filter"&&Z!=="metadata"&&Z!=="minzoom"&&Z!=="maxzoom"&&(Z.indexOf("paint.")===0?ir(R[Z],G[Z],ne,M,Z.slice(6),"setPaintProperty"):ht(R[Z],G[Z])||qt(ne,{command:"setLayerProperty",args:[M,Z,G[Z]]}));for(Z in G)Object.prototype.hasOwnProperty.call(G,Z)&&!Object.prototype.hasOwnProperty.call(R,Z)&&Z!=="layout"&&Z!=="paint"&&Z!=="filter"&&Z!=="metadata"&&Z!=="minzoom"&&Z!=="maxzoom"&&(Z.indexOf("paint.")===0?ir(R[Z],G[Z],ne,M,Z.slice(6),"setPaintProperty"):ht(R[Z],G[Z])||qt(ne,{command:"setLayerProperty",args:[M,Z,G[Z]]}))}else qt(ne,{command:"removeLayer",args:[M]}),K=v[v.lastIndexOf(M)+1],qt(ne,{command:"addLayer",args:[G,K]})}(Q,u.layers,m)}catch(C){console.warn("Unable to compute style diff:",C),m=[{command:"setStyle",args:[u]}]}return m},l.aC=function(p){const u=[],m=p.id;return m===void 0&&u.push({message:`layers.${m}: missing required property "id"`}),p.render===void 0&&u.push({message:`layers.${m}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&u.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),u},l.aD=function p(u,m){if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let C=0;C<u.length;C++)if(!p(u[C],m[C]))return!1;return!0}if(typeof u=="object"&&u!==null&&m!==null){if(typeof m!="object"||Object.keys(u).length!==Object.keys(m).length)return!1;for(const C in u)if(!p(u[C],m[C]))return!1;return!0}return u===m},l.aE=at,l.aF=rt,l.aG=class extends nn{constructor(p,u){super(p,u),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},l.aH=Pr,l.aI=class extends nn{constructor(p,u){super(p,u),this.current=is}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let u=1;u<16;u++)if(p[u]!==this.current[u]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},l.aJ=Wr,l.aK=class extends nn{constructor(p,u){super(p,u),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},l.aL=class extends nn{constructor(p,u){super(p,u),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},l.aM=Er,l.aN=function(p,u,m,C,P,Q,V){var W=1/(u-m),ne=1/(C-P),Ae=1/(Q-V);return p[0]=-2*W,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*ne,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*Ae,p[11]=0,p[12]=(u+m)*W,p[13]=(P+C)*ne,p[14]=(V+Q)*Ae,p[15]=1,p},l.aO=hr,l.aP=Bh,l.aQ=class extends Yl{},l.aR=wx,l.aS=class extends _o{},l.aT=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},l.aU=zd,l.aV=j,l.aW=class extends L{},l.aX=We,l.aY=function(p,u){var m=p[0],C=p[1],P=p[2],Q=p[3],V=p[4],W=p[5],ne=p[6],Ae=p[7],h=p[8],c=p[9],f=p[10],v=p[11],E=p[12],M=p[13],R=p[14],G=p[15],K=u[0],Z=u[1],oe=u[2],de=u[3],ye=u[4],Ce=u[5],Ie=u[6],Oe=u[7],qe=u[8],Ke=u[9],ut=u[10],et=u[11],it=u[12],mt=u[13],Tt=u[14],Zt=u[15];return Math.abs(m-K)<=ra*Math.max(1,Math.abs(m),Math.abs(K))&&Math.abs(C-Z)<=ra*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(P-oe)<=ra*Math.max(1,Math.abs(P),Math.abs(oe))&&Math.abs(Q-de)<=ra*Math.max(1,Math.abs(Q),Math.abs(de))&&Math.abs(V-ye)<=ra*Math.max(1,Math.abs(V),Math.abs(ye))&&Math.abs(W-Ce)<=ra*Math.max(1,Math.abs(W),Math.abs(Ce))&&Math.abs(ne-Ie)<=ra*Math.max(1,Math.abs(ne),Math.abs(Ie))&&Math.abs(Ae-Oe)<=ra*Math.max(1,Math.abs(Ae),Math.abs(Oe))&&Math.abs(h-qe)<=ra*Math.max(1,Math.abs(h),Math.abs(qe))&&Math.abs(c-Ke)<=ra*Math.max(1,Math.abs(c),Math.abs(Ke))&&Math.abs(f-ut)<=ra*Math.max(1,Math.abs(f),Math.abs(ut))&&Math.abs(v-et)<=ra*Math.max(1,Math.abs(v),Math.abs(et))&&Math.abs(E-it)<=ra*Math.max(1,Math.abs(E),Math.abs(it))&&Math.abs(M-mt)<=ra*Math.max(1,Math.abs(M),Math.abs(mt))&&Math.abs(R-Tt)<=ra*Math.max(1,Math.abs(R),Math.abs(Tt))&&Math.abs(G-Zt)<=ra*Math.max(1,Math.abs(G),Math.abs(Zt))},l.aZ=function(p,u){return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},l.a_=function(p,u,m){return p[0]=u[0]*m[0],p[1]=u[1]*m[1],p[2]=u[2]*m[2],p[3]=u[3]*m[3],p},l.aa=function(p){const u={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,C,P,Q)=>{const V=P||Q;return u[C]=!V||V.toLowerCase(),""}),u["max-age"]){const m=parseInt(u["max-age"],10);isNaN(m)?delete u["max-age"]:u["max-age"]=m}return u},l.ab=function(p,u){const m=[];for(const C in p)C in u||m.push(C);return m},l.ac=Ge,l.ad=function(p,u,m){var C=Math.sin(m),P=Math.cos(m),Q=u[0],V=u[1],W=u[2],ne=u[3],Ae=u[4],h=u[5],c=u[6],f=u[7];return u!==p&&(p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=Q*P+Ae*C,p[1]=V*P+h*C,p[2]=W*P+c*C,p[3]=ne*P+f*C,p[4]=Ae*P-Q*C,p[5]=h*P-V*C,p[6]=c*P-W*C,p[7]=f*P-ne*C,p},l.ae=function(p){var u=new ec(16);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u},l.af=Ch,l.ag=function(p,u){let m=0,C=0;if(p.kind==="constant")C=p.layoutSize;else if(p.kind!=="source"){const{interpolationType:P,minZoom:Q,maxZoom:V}=p,W=P?Ge(ss.interpolationFactor(P,u,Q,V),0,1):0;p.kind==="camera"?C=fn.number(p.minSize,p.maxSize,W):m=W}return{uSizeT:m,uSize:C}},l.ai=function(p,u,m){let{uSize:C,uSizeT:P}=u,{lowerSize:Q,upperSize:V}=m;return p.kind==="source"?Q/qu:p.kind==="composite"?fn.number(Q/qu,V/qu,P):C},l.aj=Lm,l.ak=function(p,u,m,C){const P=u.y-p.y,Q=u.x-p.x,V=C.y-m.y,W=C.x-m.x,ne=V*Q-W*P;if(ne===0)return null;const Ae=(W*(p.y-m.y)-V*(p.x-m.x))/ne;return new F(p.x+Ae*Q,p.y+Ae*P)},l.al=m_,l.am=zu,l.an=aA,l.ao=vo,l.aq=bp,l.ar=function(p,u){var m=u[0],C=u[1],P=u[2],Q=u[3],V=u[4],W=u[5],ne=u[6],Ae=u[7],h=u[8],c=u[9],f=u[10],v=u[11],E=u[12],M=u[13],R=u[14],G=u[15],K=m*W-C*V,Z=m*ne-P*V,oe=m*Ae-Q*V,de=C*ne-P*W,ye=C*Ae-Q*W,Ce=P*Ae-Q*ne,Ie=h*M-c*E,Oe=h*R-f*E,qe=h*G-v*E,Ke=c*R-f*M,ut=c*G-v*M,et=f*G-v*R,it=K*et-Z*ut+oe*Ke+de*qe-ye*Oe+Ce*Ie;return it?(p[0]=(W*et-ne*ut+Ae*Ke)*(it=1/it),p[1]=(P*ut-C*et-Q*Ke)*it,p[2]=(M*Ce-R*ye+G*de)*it,p[3]=(f*ye-c*Ce-v*de)*it,p[4]=(ne*qe-V*et-Ae*Oe)*it,p[5]=(m*et-P*qe+Q*Oe)*it,p[6]=(R*oe-E*Ce-G*Z)*it,p[7]=(h*Ce-f*oe+v*Z)*it,p[8]=(V*ut-W*qe+Ae*Ie)*it,p[9]=(C*qe-m*ut-Q*Ie)*it,p[10]=(E*ye-M*oe+G*K)*it,p[11]=(c*oe-h*ye-v*K)*it,p[12]=(W*Oe-V*Ke-ne*Ie)*it,p[13]=(m*Ke-C*Oe+P*Ie)*it,p[14]=(M*Z-E*de-R*K)*it,p[15]=(h*de-c*Z+f*K)*it,p):null},l.as=B_,l.at=Zd,l.au=Wu,l.av=function(){const p={},u=wt.$version;for(const m in wt.$root){const C=wt.$root[m];if(C.required){let P=null;P=m==="version"?u:C.type==="array"?[]:{},P!=null&&(p[m]=P)}}return p},l.aw=Wl,l.ax=Lt,l.ay=function(p){p=p.slice();const u=Object.create(null);for(let m=0;m<p.length;m++)u[p[m].id]=p[m];for(let m=0;m<p.length;m++)"ref"in p[m]&&(p[m]=ti(p[m],u[p[m].ref]));return p},l.az=function(p){if(p.type==="custom")return new l_(p);switch(p.type){case"background":return new a_(p);case"circle":return new lA(p);case"fill":return new pI(p);case"fill-extrusion":return new xI(p);case"heatmap":return new Eh(p);case"hillshade":return new tp(p);case"line":return new SI(p);case"raster":return new Ux(p);case"symbol":return new Yd(p)}},l.b=vt,l.b0=He,l.b1=h_,l.b2=Hx,l.b3=function(p,u,m,C,P){var Q,V=1/Math.tan(u/2);return p[0]=V/m,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,P!=null&&P!==1/0?(p[10]=(P+C)*(Q=1/(C-P)),p[14]=2*P*C*Q):(p[10]=-1,p[14]=-2*C),p},l.b4=function(p,u,m){var C=Math.sin(m),P=Math.cos(m),Q=u[4],V=u[5],W=u[6],ne=u[7],Ae=u[8],h=u[9],c=u[10],f=u[11];return u!==p&&(p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[4]=Q*P+Ae*C,p[5]=V*P+h*C,p[6]=W*P+c*C,p[7]=ne*P+f*C,p[8]=Ae*P-Q*C,p[9]=h*P-V*C,p[10]=c*P-W*C,p[11]=f*P-ne*C,p},l.b5=ve,l.b6=Se,l.b7=function(p){return p*Math.PI/180},l.b8=function(p,u){return p[0]=u[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=u[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},l.b9=class extends rn{},l.ba=ef,l.bb=Xx,l.bd=Ft,l.be=function(p,u){dt.REGISTERED_PROTOCOLS[p]=u},l.bf=function(p){delete dt.REGISTERED_PROTOCOLS[p]},l.bg=function(p,u){const m={};for(let P=0;P<p.length;P++){const Q=u&&u[p[P].id]||Ou(p[P]);u&&(u[p[P].id]=Q);let V=m[Q];V||(V=m[Q]=[]),V.push(p[P])}const C=[];for(const P in m)C.push(m[P]);return C},l.bh=Fi,l.bi=d_,l.bj=Dm,l.bk=Em,l.bl=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=Kr/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;const u=p.bucket.layers[0],m=u.layout,C=u._unevaluatedLayout._values,P={layoutIconSize:C["icon-size"].possiblyEvaluate(new _n(p.bucket.zoom+1),p.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new _n(p.bucket.zoom+1),p.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new _n(18))};if(p.bucket.textSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:h}=p.bucket.textSizeData;P.compositeTextSizes=[C["text-size"].possiblyEvaluate(new _n(Ae),p.canonical),C["text-size"].possiblyEvaluate(new _n(h),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:h}=p.bucket.iconSizeData;P.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new _n(Ae),p.canonical),C["icon-size"].possiblyEvaluate(new _n(h),p.canonical)]}const Q=m.get("text-line-height")*vo,V=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",W=m.get("text-keep-upright"),ne=m.get("text-size");for(const Ae of p.bucket.features){const h=m.get("text-font").evaluate(Ae,{},p.canonical).join(","),c=ne.evaluate(Ae,{},p.canonical),f=P.layoutTextSize.evaluate(Ae,{},p.canonical),v=P.layoutIconSize.evaluate(Ae,{},p.canonical),E={horizontal:{},vertical:void 0},M=Ae.text;let R,G=[0,0];if(M){const oe=M.toString(),de=m.get("text-letter-spacing").evaluate(Ae,{},p.canonical)*vo,ye=yo(oe)?de:0,Ce=m.get("text-anchor").evaluate(Ae,{},p.canonical),Ie=Ip(u,Ae,p.canonical);if(!Ie){const et=m.get("text-radial-offset").evaluate(Ae,{},p.canonical);G=et?Tp(Ce,[et*vo,of]):m.get("text-offset").evaluate(Ae,{},p.canonical).map(it=>it*vo)}let Oe=V?"center":m.get("text-justify").evaluate(Ae,{},p.canonical);const qe=m.get("symbol-placement"),Ke=qe==="point"?m.get("text-max-width").evaluate(Ae,{},p.canonical)*vo:0,ut=()=>{p.bucket.allowVerticalPlacement&&oo(oe)&&(E.vertical=_p(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,Ke,Q,Ce,"left",ye,G,l.ah.vertical,!0,qe,f,c))};if(!V&&Ie){const et=new Set;if(Oe==="auto")for(let mt=0;mt<Ie.values.length;mt+=2)et.add(B_(Ie.values[mt]));else et.add(Oe);let it=!1;for(const mt of et)if(!E.horizontal[mt])if(it)E.horizontal[mt]=E.horizontal[0];else{const Tt=_p(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,Ke,Q,"center",mt,ye,G,l.ah.horizontal,!1,qe,f,c);Tt&&(E.horizontal[mt]=Tt,it=Tt.positionedLines.length===1)}ut()}else{Oe==="auto"&&(Oe=B_(Ce));const et=_p(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,Ke,Q,Ce,Oe,ye,G,l.ah.horizontal,!1,qe,f,c);et&&(E.horizontal[Oe]=et),ut(),oo(oe)&&V&&W&&(E.vertical=_p(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,Ke,Q,Ce,Oe,ye,G,l.ah.vertical,!1,qe,f,c))}}let K=!1;if(Ae.icon&&Ae.icon.name){const oe=p.imageMap[Ae.icon.name];oe&&(R=PI(p.imagePositions[Ae.icon.name],m.get("icon-offset").evaluate(Ae,{},p.canonical),m.get("icon-anchor").evaluate(Ae,{},p.canonical)),K=!!oe.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=K:p.bucket.sdfIcons!==K&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==p.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}const Z=Kx(E.horizontal)||E.vertical;p.bucket.iconsInText=!!Z&&Z.iconsInText,(Z||R)&&kI(p.bucket,Ae,E,R,p.imageMap,P,f,v,G,K,p.canonical)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},l.bm=WA,l.bn=vm,l.bo=j0,l.bp=Gu,l.bq=Y0,l.br=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},l.bs=function(p,u,m,C,P){return s(this,void 0,void 0,function*(){if(fe())try{return yield Pt(p,u,m,C,P)}catch{}return function(Q,V,W,ne,Ae){const h=Q.width,c=Q.height;Xt&&Te||(Xt=new OffscreenCanvas(h,c),Te=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=h,Xt.height=c,Te.drawImage(Q,0,0,h,c);const f=Te.getImageData(V,W,ne,Ae);return Te.clearRect(0,0,h,c),f.data}(p,u,m,C,P)})},l.bt=A_,l.bu=g,l.bv=b,l.bw=X0,l.bx=Nn,l.by=function(p){return p.message===Ze},l.bz=rl,l.c=tt,l.d=p=>s(void 0,void 0,void 0,function*(){if(p.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(p)],{type:"image/png"});try{return createImageBitmap(u)}catch(m){throw new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),l.e=$e,l.f=p=>new Promise((u,m)=>{const C=new Image;C.onload=()=>{u(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Dt})},C.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(p)],{type:"image/png"});C.src=p.byteLength?URL.createObjectURL(P):Dt}),l.g=pt,l.h=(p,u)=>Gt($e(p,{type:"json"}),u),l.i=Et,l.j=Ot,l.k=Pi,l.l=(p,u)=>Gt($e(p,{type:"arrayBuffer"}),u),l.m=Gt,l.n=function(p){return new Y0(p).readFields(II,[])},l.o=yu,l.p=gp,l.q=Ss,l.r=va,l.s=ri,l.t=Yo,l.u=Si,l.v=wt,l.w=Je,l.x=qn,l.y=function(p){let[u,m,C]=p;return m+=90,m*=Math.PI/180,C*=Math.PI/180,{x:u*Math.cos(m)*Math.sin(C),y:u*Math.sin(m)*Math.sin(C),z:u*Math.cos(C)}},l.z=fn}),n("worker",["./shared"],function(l){class s{constructor(Be){this.keyCache={},Be&&this.replace(Be)}replace(Be){this._layerConfigs={},this._layers={},this.update(Be,[])}update(Be,ae){for(const ce of Be){this._layerConfigs[ce.id]=ce;const me=this._layers[ce.id]=l.az(ce);me._featureFilter=l.a6(me.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of ae)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const ie=l.bg(Object.values(this._layerConfigs),this.keyCache);for(const ce of ie){const me=ce.map(je=>this._layers[je.id]),be=me[0];if(be.visibility==="none")continue;const Ee=be.source||"";let xe=this.familiesBySource[Ee];xe||(xe=this.familiesBySource[Ee]={});const Fe=be.sourceLayer||"_geojsonTileLayer";let Ue=xe[Fe];Ue||(Ue=xe[Fe]=[]),Ue.push(me)}}}class g{constructor(Be){const ae={},ie=[];for(const Ee in Be){const xe=Be[Ee],Fe=ae[Ee]={};for(const Ue in xe){const je=xe[+Ue];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const nt={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};ie.push(nt),Fe[Ue]={rect:nt,metrics:je.metrics}}}const{w:ce,h:me}=l.p(ie),be=new l.o({width:ce||1,height:me||1});for(const Ee in Be){const xe=Be[Ee];for(const Fe in xe){const Ue=xe[+Fe];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const je=ae[Ee][Fe].rect;l.o.copy(Ue.bitmap,be,{x:0,y:0},{x:je.x+1,y:je.y+1},Ue.bitmap)}}this.image=be,this.positions=ae}}l.bh("GlyphAtlas",g);class b{constructor(Be){this.tileID=new l.Q(Be.tileID.overscaledZ,Be.tileID.wrap,Be.tileID.canonical.z,Be.tileID.canonical.x,Be.tileID.canonical.y),this.uid=Be.uid,this.zoom=Be.zoom,this.pixelRatio=Be.pixelRatio,this.tileSize=Be.tileSize,this.source=Be.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Be.showCollisionBoxes,this.collectResourceTiming=!!Be.collectResourceTiming,this.returnDependencies=!!Be.returnDependencies,this.promoteId=Be.promoteId,this.inFlightDependencies=[]}parse(Be,ae,ie,ce){return l._(this,void 0,void 0,function*(){this.status="parsing",this.data=Be,this.collisionBoxArray=new l.a4;const me=new l.bi(Object.keys(Be.layers).sort()),be=new l.bj(this.tileID,this.promoteId);be.bucketLayerIDs=[];const Ee={},xe={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},Fe=ae.familiesBySource[this.source];for(const Bi in Fe){const Ni=Be.layers[Bi];if(!Ni)continue;Ni.version===1&&l.w(`Vector tile source "${this.source}" layer "${Bi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=me.encode(Bi),ii=[];for(let Qt=0;Qt<Ni.length;Qt++){const Qi=Ni.feature(Qt),Ar=be.getId(Qi,Bi);ii.push({feature:Qi,id:Ar,index:Qt,sourceLayerIndex:ot})}for(const Qt of Fe[Bi]){const Qi=Qt[0];Qi.source!==this.source&&l.w(`layer.source = ${Qi.source} does not equal this.source = ${this.source}`),Qi.minzoom&&this.zoom<Math.floor(Qi.minzoom)||Qi.maxzoom&&this.zoom>=Qi.maxzoom||Qi.visibility!=="none"&&(S(Qt,this.zoom,ie),(Ee[Qi.id]=Qi.createBucket({index:be.bucketLayerIDs.length,layers:Qt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(ii,xe,this.tileID.canonical),be.bucketLayerIDs.push(Qt.map(Ar=>Ar.id)))}}const Ue=l.aE(xe.glyphDependencies,Bi=>Object.keys(Bi).map(Number));this.inFlightDependencies.forEach(Bi=>Bi==null?void 0:Bi.abort()),this.inFlightDependencies=[];let je=Promise.resolve({});if(Object.keys(Ue).length){const Bi=new AbortController;this.inFlightDependencies.push(Bi),je=ce.sendAsync({type:"getGlyphs",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Bi)}const nt=Object.keys(xe.iconDependencies);let _t=Promise.resolve({});if(nt.length){const Bi=new AbortController;this.inFlightDependencies.push(Bi),_t=ce.sendAsync({type:"getImages",data:{icons:nt,source:this.source,tileID:this.tileID,type:"icons"}},Bi)}const St=Object.keys(xe.patternDependencies);let ei=Promise.resolve({});if(St.length){const Bi=new AbortController;this.inFlightDependencies.push(Bi),ei=ce.sendAsync({type:"getImages",data:{icons:St,source:this.source,tileID:this.tileID,type:"patterns"}},Bi)}const[$t,Wt,oi]=yield Promise.all([je,_t,ei]),Ei=new g($t),Gi=new l.bk(Wt,oi);for(const Bi in Ee){const Ni=Ee[Bi];Ni instanceof l.a5?(S(Ni.layers,this.zoom,ie),l.bl({bucket:Ni,glyphMap:$t,glyphPositions:Ei.positions,imageMap:Wt,imagePositions:Gi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ni.hasPattern&&(Ni instanceof l.bm||Ni instanceof l.bn||Ni instanceof l.bo)&&(S(Ni.layers,this.zoom,ie),Ni.addFeatures(xe,this.tileID.canonical,Gi.patternPositions))}return this.status="done",{buckets:Object.values(Ee).filter(Bi=>!Bi.isEmpty()),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Gi,glyphMap:this.returnDependencies?$t:null,iconMap:this.returnDependencies?Wt:null,glyphPositions:this.returnDependencies?Ei.positions:null}})}}function S(Qe,Be,ae){const ie=new l.a8(Be);for(const ce of Qe)ce.recalculate(ie,ae)}class F{constructor(Be,ae,ie){this.actor=Be,this.layerIndex=ae,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Be,ae){return l._(this,void 0,void 0,function*(){const ie=yield l.l(Be.request,ae);try{return{vectorTile:new l.bp.VectorTile(new l.bq(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(ce){const me=new Uint8Array(ie.data);let be=`Unable to parse the tile at ${Be.request.url}, `;throw be+=me[0]===31&&me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.messge}`,new Error(be)}})}loadTile(Be){return l._(this,void 0,void 0,function*(){const ae=Be.uid,ie=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new l.br(Be.request),ce=new b(Be);this.loading[ae]=ce;const me=new AbortController;ce.abort=me;try{const be=yield this.loadVectorTile(Be,me);if(delete this.loading[ae],!be)return null;const Ee=be.rawData,xe={};be.expires&&(xe.expires=be.expires),be.cacheControl&&(xe.cacheControl=be.cacheControl);const Fe={};if(ie){const je=ie.finish();je&&(Fe.resourceTiming=JSON.parse(JSON.stringify(je)))}ce.vectorTile=be.vectorTile;const Ue=ce.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ae]=ce,this.fetching[ae]={rawTileData:Ee,cacheControl:xe,resourceTiming:Fe};try{const je=yield Ue;return l.e({rawTileData:Ee.slice(0)},je,xe,Fe)}finally{delete this.fetching[ae]}}catch(be){throw delete this.loading[ae],ce.status="done",this.loaded[ae]=ce,be}})}reloadTile(Be){return l._(this,void 0,void 0,function*(){const ae=Be.uid;if(!this.loaded||!this.loaded[ae])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[ae];if(ie.showCollisionBoxes=Be.showCollisionBoxes,ie.status==="parsing"){const ce=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor);let me;if(this.fetching[ae]){const{rawTileData:be,cacheControl:Ee,resourceTiming:xe}=this.fetching[ae];delete this.fetching[ae],me=l.e({rawTileData:be.slice(0)},ce,Ee,xe)}else me=ce;return me}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Be){return l._(this,void 0,void 0,function*(){const ae=this.loading,ie=Be.uid;ae&&ae[ie]&&ae[ie].abort&&(ae[ie].abort.abort(),delete ae[ie])})}removeTile(Be){return l._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Be.uid]&&delete this.loaded[Be.uid]})}}class D{constructor(){this.loaded={}}loadTile(Be){return l._(this,void 0,void 0,function*(){const{uid:ae,encoding:ie,rawImageData:ce,redFactor:me,greenFactor:be,blueFactor:Ee,baseShift:xe}=Be,Fe=ce.width+2,Ue=ce.height+2,je=l.b(ce)?new l.R({width:Fe,height:Ue},yield l.bs(ce,-1,-1,Fe,Ue)):ce,nt=new l.bt(ae,je,ie,me,be,Ee,xe);return this.loaded=this.loaded||{},this.loaded[ae]=nt,nt})}removeTile(Be){const ae=this.loaded,ie=Be.uid;ae&&ae[ie]&&delete ae[ie]}}function N(Qe,Be){if(Qe.length!==0){J(Qe[0],Be);for(var ae=1;ae<Qe.length;ae++)J(Qe[ae],!Be)}}function J(Qe,Be){for(var ae=0,ie=0,ce=0,me=Qe.length,be=me-1;ce<me;be=ce++){var Ee=(Qe[ce][0]-Qe[be][0])*(Qe[be][1]+Qe[ce][1]),xe=ae+Ee;ie+=Math.abs(ae)>=Math.abs(Ee)?ae-xe+Ee:Ee-xe+ae,ae=xe}ae+ie>=0!=!!Be&&Qe.reverse()}var te=l.bu(function Qe(Be,ae){var ie,ce=Be&&Be.type;if(ce==="FeatureCollection")for(ie=0;ie<Be.features.length;ie++)Qe(Be.features[ie],ae);else if(ce==="GeometryCollection")for(ie=0;ie<Be.geometries.length;ie++)Qe(Be.geometries[ie],ae);else if(ce==="Feature")Qe(Be.geometry,ae);else if(ce==="Polygon")N(Be.coordinates,ae);else if(ce==="MultiPolygon")for(ie=0;ie<Be.coordinates.length;ie++)N(Be.coordinates[ie],ae);return Be});const he=l.bp.VectorTileFeature.prototype.toGeoJSON;var ue={exports:{}},fe=l.bv,ve=l.bp.VectorTileFeature,Se=Ge;function Ge(Qe,Be){this.options=Be||{},this.features=Qe,this.length=Qe.length}function He(Qe,Be){this.id=typeof Qe.id=="number"?Qe.id:void 0,this.type=Qe.type,this.rawGeometry=Qe.type===1?[Qe.geometry]:Qe.geometry,this.properties=Qe.tags,this.extent=Be||4096}Ge.prototype.feature=function(Qe){return new He(this.features[Qe],this.options.extent)},He.prototype.loadGeometry=function(){var Qe=this.rawGeometry;this.geometry=[];for(var Be=0;Be<Qe.length;Be++){for(var ae=Qe[Be],ie=[],ce=0;ce<ae.length;ce++)ie.push(new fe(ae[ce][0],ae[ce][1]));this.geometry.push(ie)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qe=this.geometry,Be=1/0,ae=-1/0,ie=1/0,ce=-1/0,me=0;me<Qe.length;me++)for(var be=Qe[me],Ee=0;Ee<be.length;Ee++){var xe=be[Ee];Be=Math.min(Be,xe.x),ae=Math.max(ae,xe.x),ie=Math.min(ie,xe.y),ce=Math.max(ce,xe.y)}return[Be,ie,ae,ce]},He.prototype.toGeoJSON=ve.prototype.toGeoJSON;var $e=l.bw,Ne=Se;function at(Qe){var Be=new $e;return function(ae,ie){for(var ce in ae.layers)ie.writeMessage(3,rt,ae.layers[ce])}(Qe,Be),Be.finish()}function rt(Qe,Be){var ae;Be.writeVarintField(15,Qe.version||1),Be.writeStringField(1,Qe.name||""),Be.writeVarintField(5,Qe.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<Qe.length;ae++)ie.feature=Qe.feature(ae),Be.writeMessage(2,Re,ie);var ce=ie.keys;for(ae=0;ae<ce.length;ae++)Be.writeStringField(3,ce[ae]);var me=ie.values;for(ae=0;ae<me.length;ae++)Be.writeMessage(4,Et,me[ae])}function Re(Qe,Be){var ae=Qe.feature;ae.id!==void 0&&Be.writeVarintField(1,ae.id),Be.writeMessage(2,Pe,Qe),Be.writeVarintField(3,ae.type),Be.writeMessage(4,Ct,ae)}function Pe(Qe,Be){var ae=Qe.feature,ie=Qe.keys,ce=Qe.values,me=Qe.keycache,be=Qe.valuecache;for(var Ee in ae.properties){var xe=ae.properties[Ee],Fe=me[Ee];if(xe!==null){Fe===void 0&&(ie.push(Ee),me[Ee]=Fe=ie.length-1),Be.writeVarint(Fe);var Ue=typeof xe;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(xe=JSON.stringify(xe));var je=Ue+":"+xe,nt=be[je];nt===void 0&&(ce.push(xe),be[je]=nt=ce.length-1),Be.writeVarint(nt)}}}function Je(Qe,Be){return(Be<<3)+(7&Qe)}function Xe(Qe){return Qe<<1^Qe>>31}function Ct(Qe,Be){for(var ae=Qe.loadGeometry(),ie=Qe.type,ce=0,me=0,be=ae.length,Ee=0;Ee<be;Ee++){var xe=ae[Ee],Fe=1;ie===1&&(Fe=xe.length),Be.writeVarint(Je(1,Fe));for(var Ue=ie===3?xe.length-1:xe.length,je=0;je<Ue;je++){je===1&&ie!==1&&Be.writeVarint(Je(2,Ue-1));var nt=xe[je].x-ce,_t=xe[je].y-me;Be.writeVarint(Xe(nt)),Be.writeVarint(Xe(_t)),ce+=nt,me+=_t}ie===3&&Be.writeVarint(Je(7,1))}}function Et(Qe,Be){var ae=typeof Qe;ae==="string"?Be.writeStringField(1,Qe):ae==="boolean"?Be.writeBooleanField(7,Qe):ae==="number"&&(Qe%1!=0?Be.writeDoubleField(3,Qe):Qe<0?Be.writeSVarintField(6,Qe):Be.writeVarintField(5,Qe))}ue.exports=at,ue.exports.fromVectorTileJs=at,ue.exports.fromGeojsonVt=function(Qe,Be){Be=Be||{};var ae={};for(var ie in Qe)ae[ie]=new Ne(Qe[ie].features,Be),ae[ie].name=ie,ae[ie].version=Be.version,ae[ie].extent=Be.extent;return at({layers:ae})},ue.exports.GeoJSONWrapper=Ne;var Mt=l.bu(ue.exports);const vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},Dt=Math.fround||(Pt=new Float32Array(1),Qe=>(Pt[0]=+Qe,Pt[0]));var Pt;const Xt=3,Te=5,Ze=6;class tt{constructor(Be){this.options=Object.assign(Object.create(vt),Be),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Be){const{log:ae,minZoom:ie,maxZoom:ce}=this.options;ae&&console.time("total time");const me=`prepare ${Be.length} points`;ae&&console.time(me),this.points=Be;const be=[];for(let xe=0;xe<Be.length;xe++){const Fe=Be[xe];if(!Fe.geometry)continue;const[Ue,je]=Fe.geometry.coordinates,nt=Dt(Bt(Ue)),_t=Dt(Ft(je));be.push(nt,_t,1/0,xe,-1,1),this.options.reduce&&be.push(0)}let Ee=this.trees[ce+1]=this._createTree(be);ae&&console.timeEnd(me);for(let xe=ce;xe>=ie;xe--){const Fe=+Date.now();Ee=this.trees[xe]=this._createTree(this._cluster(Ee,xe)),ae&&console.log("z%d: %d clusters in %dms",xe,Ee.numItems,+Date.now()-Fe)}return ae&&console.timeEnd("total time"),this}getClusters(Be,ae){let ie=((Be[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,Be[1]));let me=Be[2]===180?180:((Be[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,Be[3]));if(Be[2]-Be[0]>=360)ie=-180,me=180;else if(ie>me){const je=this.getClusters([ie,ce,180,be],ae),nt=this.getClusters([-180,ce,me,be],ae);return je.concat(nt)}const Ee=this.trees[this._limitZoom(ae)],xe=Ee.range(Bt(ie),Ft(be),Bt(me),Ft(ce)),Fe=Ee.data,Ue=[];for(const je of xe){const nt=this.stride*je;Ue.push(Fe[nt+Te]>1?dt(Fe,nt,this.clusterProps):this.points[Fe[nt+Xt]])}return Ue}getChildren(Be){const ae=this._getOriginId(Be),ie=this._getOriginZoom(Be),ce="No cluster with the specified id.",me=this.trees[ie];if(!me)throw new Error(ce);const be=me.data;if(ae*this.stride>=be.length)throw new Error(ce);const Ee=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),xe=me.within(be[ae*this.stride],be[ae*this.stride+1],Ee),Fe=[];for(const Ue of xe){const je=Ue*this.stride;be[je+4]===Be&&Fe.push(be[je+Te]>1?dt(be,je,this.clusterProps):this.points[be[je+Xt]])}if(Fe.length===0)throw new Error(ce);return Fe}getLeaves(Be,ae,ie){const ce=[];return this._appendLeaves(ce,Be,ae=ae||10,ie=ie||0,0),ce}getTile(Be,ae,ie){const ce=this.trees[this._limitZoom(Be)],me=Math.pow(2,Be),{extent:be,radius:Ee}=this.options,xe=Ee/be,Fe=(ie-xe)/me,Ue=(ie+1+xe)/me,je={features:[]};return this._addTileFeatures(ce.range((ae-xe)/me,Fe,(ae+1+xe)/me,Ue),ce.data,ae,ie,me,je),ae===0&&this._addTileFeatures(ce.range(1-xe/me,Fe,1,Ue),ce.data,me,ie,me,je),ae===me-1&&this._addTileFeatures(ce.range(0,Fe,xe/me,Ue),ce.data,-1,ie,me,je),je.features.length?je:null}getClusterExpansionZoom(Be){let ae=this._getOriginZoom(Be)-1;for(;ae<=this.options.maxZoom;){const ie=this.getChildren(Be);if(ae++,ie.length!==1)break;Be=ie[0].properties.cluster_id}return ae}_appendLeaves(Be,ae,ie,ce,me){const be=this.getChildren(ae);for(const Ee of be){const xe=Ee.properties;if(xe&&xe.cluster?me+xe.point_count<=ce?me+=xe.point_count:me=this._appendLeaves(Be,xe.cluster_id,ie,ce,me):me<ce?me++:Be.push(Ee),Be.length===ie)break}return me}_createTree(Be){const ae=new l.au(Be.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<Be.length;ie+=this.stride)ae.add(Be[ie],Be[ie+1]);return ae.finish(),ae.data=Be,ae}_addTileFeatures(Be,ae,ie,ce,me,be){for(const Ee of Be){const xe=Ee*this.stride,Fe=ae[xe+Te]>1;let Ue,je,nt;if(Fe)Ue=pt(ae,xe,this.clusterProps),je=ae[xe],nt=ae[xe+1];else{const ei=this.points[ae[xe+Xt]];Ue=ei.properties;const[$t,Wt]=ei.geometry.coordinates;je=Bt($t),nt=Ft(Wt)}const _t={type:1,geometry:[[Math.round(this.options.extent*(je*me-ie)),Math.round(this.options.extent*(nt*me-ce))]],tags:Ue};let St;St=Fe||this.options.generateId?ae[xe+Xt]:this.points[ae[xe+Xt]].id,St!==void 0&&(_t.id=St),be.features.push(_t)}}_limitZoom(Be){return Math.max(this.options.minZoom,Math.min(Math.floor(+Be),this.options.maxZoom+1))}_cluster(Be,ae){const{radius:ie,extent:ce,reduce:me,minPoints:be}=this.options,Ee=ie/(ce*Math.pow(2,ae)),xe=Be.data,Fe=[],Ue=this.stride;for(let je=0;je<xe.length;je+=Ue){if(xe[je+2]<=ae)continue;xe[je+2]=ae;const nt=xe[je],_t=xe[je+1],St=Be.within(xe[je],xe[je+1],Ee),ei=xe[je+Te];let $t=ei;for(const Wt of St){const oi=Wt*Ue;xe[oi+2]>ae&&($t+=xe[oi+Te])}if($t>ei&&$t>=be){let Wt,oi=nt*ei,Ei=_t*ei,Gi=-1;const Bi=((je/Ue|0)<<5)+(ae+1)+this.points.length;for(const Ni of St){const ot=Ni*Ue;if(xe[ot+2]<=ae)continue;xe[ot+2]=ae;const ii=xe[ot+Te];oi+=xe[ot]*ii,Ei+=xe[ot+1]*ii,xe[ot+4]=Bi,me&&(Wt||(Wt=this._map(xe,je,!0),Gi=this.clusterProps.length,this.clusterProps.push(Wt)),me(Wt,this._map(xe,ot)))}xe[je+4]=Bi,Fe.push(oi/$t,Ei/$t,1/0,Bi,-1,$t),me&&Fe.push(Gi)}else{for(let Wt=0;Wt<Ue;Wt++)Fe.push(xe[je+Wt]);if($t>1)for(const Wt of St){const oi=Wt*Ue;if(!(xe[oi+2]<=ae)){xe[oi+2]=ae;for(let Ei=0;Ei<Ue;Ei++)Fe.push(xe[oi+Ei])}}}}return Fe}_getOriginId(Be){return Be-this.points.length>>5}_getOriginZoom(Be){return(Be-this.points.length)%32}_map(Be,ae,ie){if(Be[ae+Te]>1){const be=this.clusterProps[Be[ae+Ze]];return ie?Object.assign({},be):be}const ce=this.points[Be[ae+Xt]].properties,me=this.options.map(ce);return ie&&me===ce?Object.assign({},me):me}}function dt(Qe,Be,ae){return{type:"Feature",id:Qe[Be+Xt],properties:pt(Qe,Be,ae),geometry:{type:"Point",coordinates:[(ie=Qe[Be],360*(ie-.5)),Lt(Qe[Be+1])]}};var ie}function pt(Qe,Be,ae){const ie=Qe[Be+Te],ce=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,me=Qe[Be+Ze],be=me===-1?{}:Object.assign({},ae[me]);return Object.assign(be,{cluster:!0,cluster_id:Qe[Be+Xt],point_count:ie,point_count_abbreviated:ce})}function Bt(Qe){return Qe/360+.5}function Ft(Qe){const Be=Math.sin(Qe*Math.PI/180),ae=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ae<0?0:ae>1?1:ae}function Lt(Qe){const Be=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(Be))/Math.PI-90}function Gt(Qe,Be,ae,ie){for(var ce,me=ie,be=ae-Be>>1,Ee=ae-Be,xe=Qe[Be],Fe=Qe[Be+1],Ue=Qe[ae],je=Qe[ae+1],nt=Be+3;nt<ae;nt+=3){var _t=ri(Qe[nt],Qe[nt+1],xe,Fe,Ue,je);if(_t>me)ce=nt,me=_t;else if(_t===me){var St=Math.abs(nt-be);St<Ee&&(ce=nt,Ee=St)}}me>ie&&(ce-Be>3&&Gt(Qe,Be,ce,ie),Qe[ce+2]=me,ae-ce>3&&Gt(Qe,ce,ae,ie))}function ri(Qe,Be,ae,ie,ce,me){var be=ce-ae,Ee=me-ie;if(be!==0||Ee!==0){var xe=((Qe-ae)*be+(Be-ie)*Ee)/(be*be+Ee*Ee);xe>1?(ae=ce,ie=me):xe>0&&(ae+=be*xe,ie+=Ee*xe)}return(be=Qe-ae)*be+(Ee=Be-ie)*Ee}function mi(Qe,Be,ae,ie){var ce={id:Qe===void 0?null:Qe,type:Be,geometry:ae,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var be=me.geometry,Ee=me.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")yi(me,be);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var xe=0;xe<be.length;xe++)yi(me,be[xe]);else if(Ee==="MultiPolygon")for(xe=0;xe<be.length;xe++)for(var Fe=0;Fe<be[xe].length;Fe++)yi(me,be[xe][Fe])}(ce),ce}function yi(Qe,Be){for(var ae=0;ae<Be.length;ae+=3)Qe.minX=Math.min(Qe.minX,Be[ae]),Qe.minY=Math.min(Qe.minY,Be[ae+1]),Qe.maxX=Math.max(Qe.maxX,Be[ae]),Qe.maxY=Math.max(Qe.maxY,Be[ae+1])}function Pi(Qe,Be,ae,ie){if(Be.geometry){var ce=Be.geometry.coordinates,me=Be.geometry.type,be=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),Ee=[],xe=Be.id;if(ae.promoteId?xe=Be.properties[ae.promoteId]:ae.generateId&&(xe=ie||0),me==="Point")Ot(ce,Ee);else if(me==="MultiPoint")for(var Fe=0;Fe<ce.length;Fe++)Ot(ce[Fe],Ee);else if(me==="LineString")lt(ce,Ee,be,!1);else if(me==="MultiLineString"){if(ae.lineMetrics){for(Fe=0;Fe<ce.length;Fe++)lt(ce[Fe],Ee=[],be,!1),Qe.push(mi(xe,"LineString",Ee,Be.properties));return}wt(ce,Ee,be,!1)}else if(me==="Polygon")wt(ce,Ee,be,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Fe=0;Fe<Be.geometry.geometries.length;Fe++)Pi(Qe,{id:xe,geometry:Be.geometry.geometries[Fe],properties:Be.properties},ae,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<ce.length;Fe++){var Ue=[];wt(ce[Fe],Ue,be,!0),Ee.push(Ue)}}Qe.push(mi(xe,me,Ee,Be.properties))}}function Ot(Qe,Be){Be.push(ki(Qe[0])),Be.push(ti(Qe[1])),Be.push(0)}function lt(Qe,Be,ae,ie){for(var ce,me,be=0,Ee=0;Ee<Qe.length;Ee++){var xe=ki(Qe[Ee][0]),Fe=ti(Qe[Ee][1]);Be.push(xe),Be.push(Fe),Be.push(0),Ee>0&&(be+=ie?(ce*Fe-xe*me)/2:Math.sqrt(Math.pow(xe-ce,2)+Math.pow(Fe-me,2))),ce=xe,me=Fe}var Ue=Be.length-3;Be[2]=1,Gt(Be,0,Ue,ae),Be[Ue+2]=1,Be.size=Math.abs(be),Be.start=0,Be.end=Be.size}function wt(Qe,Be,ae,ie){for(var ce=0;ce<Qe.length;ce++){var me=[];lt(Qe[ce],me,ae,ie),Be.push(me)}}function ki(Qe){return Qe/360+.5}function ti(Qe){var Be=Math.sin(Qe*Math.PI/180),ae=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ae<0?0:ae>1?1:ae}function ht(Qe,Be,ae,ie,ce,me,be,Ee){if(ie/=Be,me>=(ae/=Be)&&be<ie)return Qe;if(be<ae||me>=ie)return null;for(var xe=[],Fe=0;Fe<Qe.length;Fe++){var Ue=Qe[Fe],je=Ue.geometry,nt=Ue.type,_t=ce===0?Ue.minX:Ue.minY,St=ce===0?Ue.maxX:Ue.maxY;if(_t>=ae&&St<ie)xe.push(Ue);else if(!(St<ae||_t>=ie)){var ei=[];if(nt==="Point"||nt==="MultiPoint")qt(je,ei,ae,ie,ce);else if(nt==="LineString")si(je,ei,ae,ie,ce,!1,Ee.lineMetrics);else if(nt==="MultiLineString")ci(je,ei,ae,ie,ce,!1);else if(nt==="Polygon")ci(je,ei,ae,ie,ce,!0);else if(nt==="MultiPolygon")for(var $t=0;$t<je.length;$t++){var Wt=[];ci(je[$t],Wt,ae,ie,ce,!0),Wt.length&&ei.push(Wt)}if(ei.length){if(Ee.lineMetrics&&nt==="LineString"){for($t=0;$t<ei.length;$t++)xe.push(mi(Ue.id,nt,ei[$t],Ue.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(ei.length===1?(nt="LineString",ei=ei[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=ei.length===3?"Point":"MultiPoint"),xe.push(mi(Ue.id,nt,ei,Ue.tags))}}}return xe.length?xe:null}function qt(Qe,Be,ae,ie,ce){for(var me=0;me<Qe.length;me+=3){var be=Qe[me+ce];be>=ae&&be<=ie&&(Be.push(Qe[me]),Be.push(Qe[me+1]),Be.push(Qe[me+2]))}}function si(Qe,Be,ae,ie,ce,me,be){for(var Ee,xe,Fe=fi(Qe),Ue=ce===0?ir:dr,je=Qe.start,nt=0;nt<Qe.length-3;nt+=3){var _t=Qe[nt],St=Qe[nt+1],ei=Qe[nt+2],$t=Qe[nt+3],Wt=Qe[nt+4],oi=ce===0?_t:St,Ei=ce===0?$t:Wt,Gi=!1;be&&(Ee=Math.sqrt(Math.pow(_t-$t,2)+Math.pow(St-Wt,2))),oi<ae?Ei>ae&&(xe=Ue(Fe,_t,St,$t,Wt,ae),be&&(Fe.start=je+Ee*xe)):oi>ie?Ei<ie&&(xe=Ue(Fe,_t,St,$t,Wt,ie),be&&(Fe.start=je+Ee*xe)):Wi(Fe,_t,St,ei),Ei<ae&&oi>=ae&&(xe=Ue(Fe,_t,St,$t,Wt,ae),Gi=!0),Ei>ie&&oi<=ie&&(xe=Ue(Fe,_t,St,$t,Wt,ie),Gi=!0),!me&&Gi&&(be&&(Fe.end=je+Ee*xe),Be.push(Fe),Fe=fi(Qe)),be&&(je+=Ee)}var Bi=Qe.length-3;_t=Qe[Bi],St=Qe[Bi+1],ei=Qe[Bi+2],(oi=ce===0?_t:St)>=ae&&oi<=ie&&Wi(Fe,_t,St,ei),Bi=Fe.length-3,me&&Bi>=3&&(Fe[Bi]!==Fe[0]||Fe[Bi+1]!==Fe[1])&&Wi(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&Be.push(Fe)}function fi(Qe){var Be=[];return Be.size=Qe.size,Be.start=Qe.start,Be.end=Qe.end,Be}function ci(Qe,Be,ae,ie,ce,me){for(var be=0;be<Qe.length;be++)si(Qe[be],Be,ae,ie,ce,me,!1)}function Wi(Qe,Be,ae,ie){Qe.push(Be),Qe.push(ae),Qe.push(ie)}function ir(Qe,Be,ae,ie,ce,me){var be=(me-Be)/(ie-Be);return Qe.push(me),Qe.push(ae+(ce-ae)*be),Qe.push(1),be}function dr(Qe,Be,ae,ie,ce,me){var be=(me-ae)/(ce-ae);return Qe.push(Be+(ie-Be)*be),Qe.push(me),Qe.push(1),be}function Sr(Qe,Be){for(var ae=[],ie=0;ie<Qe.length;ie++){var ce,me=Qe[ie],be=me.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")ce=zt(me.geometry,Be);else if(be==="MultiLineString"||be==="Polygon"){ce=[];for(var Ee=0;Ee<me.geometry.length;Ee++)ce.push(zt(me.geometry[Ee],Be))}else if(be==="MultiPolygon")for(ce=[],Ee=0;Ee<me.geometry.length;Ee++){for(var xe=[],Fe=0;Fe<me.geometry[Ee].length;Fe++)xe.push(zt(me.geometry[Ee][Fe],Be));ce.push(xe)}ae.push(mi(me.id,be,ce,me.tags))}return ae}function zt(Qe,Be){var ae=[];ae.size=Qe.size,Qe.start!==void 0&&(ae.start=Qe.start,ae.end=Qe.end);for(var ie=0;ie<Qe.length;ie+=3)ae.push(Qe[ie]+Be,Qe[ie+1],Qe[ie+2]);return ae}function Yi(Qe,Be){if(Qe.transformed)return Qe;var ae,ie,ce,me=1<<Qe.z,be=Qe.x,Ee=Qe.y;for(ae=0;ae<Qe.features.length;ae++){var xe=Qe.features[ae],Fe=xe.geometry,Ue=xe.type;if(xe.geometry=[],Ue===1)for(ie=0;ie<Fe.length;ie+=2)xe.geometry.push(ui(Fe[ie],Fe[ie+1],Be,me,be,Ee));else for(ie=0;ie<Fe.length;ie++){var je=[];for(ce=0;ce<Fe[ie].length;ce+=2)je.push(ui(Fe[ie][ce],Fe[ie][ce+1],Be,me,be,Ee));xe.geometry.push(je)}}return Qe.transformed=!0,Qe}function ui(Qe,Be,ae,ie,ce,me){return[Math.round(ae*(Qe*ie-ce)),Math.round(ae*(Be*ie-me))]}function Kt(Qe,Be,ae,ie,ce){for(var me=Be===ce.maxZoom?0:ce.tolerance/((1<<Be)*ce.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:ie,z:Be,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<Qe.length;Ee++){be.numFeatures++,Ji(be,Qe[Ee],me,ce);var xe=Qe[Ee].minX,Fe=Qe[Ee].minY,Ue=Qe[Ee].maxX,je=Qe[Ee].maxY;xe<be.minX&&(be.minX=xe),Fe<be.minY&&(be.minY=Fe),Ue>be.maxX&&(be.maxX=Ue),je>be.maxY&&(be.maxY=je)}return be}function Ji(Qe,Be,ae,ie){var ce=Be.geometry,me=Be.type,be=[];if(me==="Point"||me==="MultiPoint")for(var Ee=0;Ee<ce.length;Ee+=3)be.push(ce[Ee]),be.push(ce[Ee+1]),Qe.numPoints++,Qe.numSimplified++;else if(me==="LineString")Vt(be,ce,Qe,ae,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(Ee=0;Ee<ce.length;Ee++)Vt(be,ce[Ee],Qe,ae,me==="Polygon",Ee===0);else if(me==="MultiPolygon")for(var xe=0;xe<ce.length;xe++){var Fe=ce[xe];for(Ee=0;Ee<Fe.length;Ee++)Vt(be,Fe[Ee],Qe,ae,!0,Ee===0)}if(be.length){var Ue=Be.tags||null;if(me==="LineString"&&ie.lineMetrics){for(var je in Ue={},Be.tags)Ue[je]=Be.tags[je];Ue.mapbox_clip_start=ce.start/ce.size,Ue.mapbox_clip_end=ce.end/ce.size}var nt={geometry:be,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Ue};Be.id!==null&&(nt.id=Be.id),Qe.features.push(nt)}}function Vt(Qe,Be,ae,ie,ce,me){var be=ie*ie;if(ie>0&&Be.size<(ce?be:ie))ae.numPoints+=Be.length/3;else{for(var Ee=[],xe=0;xe<Be.length;xe+=3)(ie===0||Be[xe+2]>be)&&(ae.numSimplified++,Ee.push(Be[xe]),Ee.push(Be[xe+1])),ae.numPoints++;ce&&function(Fe,Ue){for(var je=0,nt=0,_t=Fe.length,St=_t-2;nt<_t;St=nt,nt+=2)je+=(Fe[nt]-Fe[St])*(Fe[nt+1]+Fe[St+1]);if(je>0===Ue)for(nt=0,_t=Fe.length;nt<_t/2;nt+=2){var ei=Fe[nt],$t=Fe[nt+1];Fe[nt]=Fe[_t-2-nt],Fe[nt+1]=Fe[_t-1-nt],Fe[_t-2-nt]=ei,Fe[_t-1-nt]=$t}}(Ee,me),Qe.push(Ee)}}function Ci(Qe,Be){var ae=(Be=this.options=function(ce,me){for(var be in me)ce[be]=me[be];return ce}(Object.create(this.options),Be)).debug;if(ae&&console.time("preprocess data"),Be.maxZoom<0||Be.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Be.promoteId&&Be.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(ce,me){var be=[];if(ce.type==="FeatureCollection")for(var Ee=0;Ee<ce.features.length;Ee++)Pi(be,ce.features[Ee],me,Ee);else Pi(be,ce.type==="Feature"?ce:{geometry:ce},me);return be}(Qe,Be);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Be.indexMaxZoom,Be.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ce,me){var be=me.buffer/me.extent,Ee=ce,xe=ht(ce,1,-1-be,be,0,-1,2,me),Fe=ht(ce,1,1-be,2+be,0,-1,2,me);return(xe||Fe)&&(Ee=ht(ce,1,-be,1+be,0,-1,2,me)||[],xe&&(Ee=Sr(xe,1).concat(Ee)),Fe&&(Ee=Ee.concat(Sr(Fe,-1)))),Ee}(ie,Be),ie.length&&this.splitTile(ie,0,0,0),ae&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Li(Qe,Be,ae){return 32*((1<<Qe)*ae+Be)+Qe}function jt(Qe,Be){return Be?Qe.properties[Be]:Qe.id}function bi(Qe,Be){if(Qe==null)return!0;if(Qe.type==="Feature")return jt(Qe,Be)!=null;if(Qe.type==="FeatureCollection"){const ae=new Set;for(const ie of Qe.features){const ce=jt(ie,Be);if(ce==null||ae.has(ce))return!1;ae.add(ce)}return!0}return!1}function Yt(Qe,Be){const ae=new Map;if(Qe!=null)if(Qe.type==="Feature")ae.set(jt(Qe,Be),Qe);else for(const ie of Qe.features)ae.set(jt(ie,Be),ie);return ae}Ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ci.prototype.splitTile=function(Qe,Be,ae,ie,ce,me,be){for(var Ee=[Qe,Be,ae,ie],xe=this.options,Fe=xe.debug;Ee.length;){ie=Ee.pop(),ae=Ee.pop(),Be=Ee.pop(),Qe=Ee.pop();var Ue=1<<Be,je=Li(Be,ae,ie),nt=this.tiles[je];if(!nt&&(Fe>1&&console.time("creation"),nt=this.tiles[je]=Kt(Qe,Be,ae,ie,xe),this.tileCoords.push({z:Be,x:ae,y:ie}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Be,ae,ie,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));var _t="z"+Be;this.stats[_t]=(this.stats[_t]||0)+1,this.total++}if(nt.source=Qe,ce){if(Be===xe.maxZoom||Be===ce)continue;var St=1<<ce-Be;if(ae!==Math.floor(me/St)||ie!==Math.floor(be/St))continue}else if(Be===xe.indexMaxZoom||nt.numPoints<=xe.indexMaxPoints)continue;if(nt.source=null,Qe.length!==0){Fe>1&&console.time("clipping");var ei,$t,Wt,oi,Ei,Gi,Bi=.5*xe.buffer/xe.extent,Ni=.5-Bi,ot=.5+Bi,ii=1+Bi;ei=$t=Wt=oi=null,Ei=ht(Qe,Ue,ae-Bi,ae+ot,0,nt.minX,nt.maxX,xe),Gi=ht(Qe,Ue,ae+Ni,ae+ii,0,nt.minX,nt.maxX,xe),Qe=null,Ei&&(ei=ht(Ei,Ue,ie-Bi,ie+ot,1,nt.minY,nt.maxY,xe),$t=ht(Ei,Ue,ie+Ni,ie+ii,1,nt.minY,nt.maxY,xe),Ei=null),Gi&&(Wt=ht(Gi,Ue,ie-Bi,ie+ot,1,nt.minY,nt.maxY,xe),oi=ht(Gi,Ue,ie+Ni,ie+ii,1,nt.minY,nt.maxY,xe),Gi=null),Fe>1&&console.timeEnd("clipping"),Ee.push(ei||[],Be+1,2*ae,2*ie),Ee.push($t||[],Be+1,2*ae,2*ie+1),Ee.push(Wt||[],Be+1,2*ae+1,2*ie),Ee.push(oi||[],Be+1,2*ae+1,2*ie+1)}}},Ci.prototype.getTile=function(Qe,Be,ae){var ie=this.options,ce=ie.extent,me=ie.debug;if(Qe<0||Qe>24)return null;var be=1<<Qe,Ee=Li(Qe,Be=(Be%be+be)%be,ae);if(this.tiles[Ee])return Yi(this.tiles[Ee],ce);me>1&&console.log("drilling down to z%d-%d-%d",Qe,Be,ae);for(var xe,Fe=Qe,Ue=Be,je=ae;!xe&&Fe>0;)Fe--,Ue=Math.floor(Ue/2),je=Math.floor(je/2),xe=this.tiles[Li(Fe,Ue,je)];return xe&&xe.source?(me>1&&console.log("found parent tile z%d-%d-%d",Fe,Ue,je),me>1&&console.time("drilling down"),this.splitTile(xe.source,Fe,Ue,je,Qe,Be,ae),me>1&&console.timeEnd("drilling down"),this.tiles[Ee]?Yi(this.tiles[Ee],ce):null):null};class yr extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Be,ae){return l._(this,void 0,void 0,function*(){const ie=Be.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!ce)return null;const me=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.W,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(xe){this._feature=xe,this.extent=l.W,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){const xe=[];for(const Fe of this._feature.geometry)xe.push([new l.P(Fe[0],Fe[1])]);return xe}{const xe=[];for(const Fe of this._feature.geometry){const Ue=[];for(const je of Fe)Ue.push(new l.P(je[0],je[1]));xe.push(Ue)}return xe}}toGeoJSON(xe,Fe,Ue){return he.call(this,xe,Fe,Ue)}}(this._features[Ee])}}(ce.features);let be=Mt(me);return be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),{vectorTile:me,rawData:be.buffer}})}loadData(Be){var ae;return l._(this,void 0,void 0,function*(){(ae=this._pendingRequest)===null||ae===void 0||ae.abort();const ie=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new l.br(Be.request);this._pendingRequest=new AbortController;try{let ce=yield this.loadGeoJSON(Be,this._pendingRequest);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(te(ce,!0),Be.filter){const be=l.bx(Be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map(xe=>`${xe.key}: ${xe.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(xe=>be.value.evaluate({zoom:0},xe))}}this._geoJSONIndex=Be.cluster?new tt(function(be){let{superclusterOptions:Ee,clusterProperties:xe}=be;if(!xe||!Ee)return Ee;const Fe={},Ue={},je={accumulated:null,zoom:0},nt={properties:null},_t=Object.keys(xe);for(const St of _t){const[ei,$t]=xe[St],Wt=l.bx($t),oi=l.bx(typeof ei=="string"?[ei,["accumulated"],["get",St]]:ei);Fe[St]=Wt.value,Ue[St]=oi.value}return Ee.map=St=>{nt.properties=St;const ei={};for(const $t of _t)ei[$t]=Fe[$t].evaluate(je,nt);return ei},Ee.reduce=(St,ei)=>{nt.properties=ei;for(const $t of _t)je.accumulated=St[$t],St[$t]=Ue[$t].evaluate(je,nt)},Ee}(Be)).load(ce.features):function(be,Ee){return new Ci(be,Ee)}(ce,Be.geojsonVtOptions),this.loaded={};const me={};if(ie){const be=ie.finish();be&&(me.resourceTiming={},me.resourceTiming[Be.source]=JSON.parse(JSON.stringify(be)))}return me}catch(ce){if(delete this._pendingRequest,l.by(ce))return{abandoned:!0};throw ce}})}reloadTile(Be){const ae=this.loaded;return ae&&ae[Be.uid]?super.reloadTile(Be):this.loadTile(Be)}loadGeoJSON(Be,ae){return l._(this,void 0,void 0,function*(){const{promoteId:ie}=Be;if(Be.request){const ce=yield l.h(Be.request,ae);return this._dataUpdateable=bi(ce.data,ie)?Yt(ce.data,ie):void 0,ce.data}if(typeof Be.data=="string")try{const ce=JSON.parse(Be.data);return this._dataUpdateable=bi(ce,ie)?Yt(ce,ie):void 0,ce}catch{throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`)}if(!Be.dataDiff)throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Be.source}`);return function(ce,me,be){var Ee,xe,Fe,Ue;if(me.removeAll&&ce.clear(),me.remove)for(const je of me.remove)ce.delete(je);if(me.add)for(const je of me.add){const nt=jt(je,be);nt!=null&&ce.set(nt,je)}if(me.update)for(const je of me.update){let nt=ce.get(je.id);if(nt==null)continue;const _t=!je.removeAllProperties&&(((Ee=je.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0||((xe=je.addOrUpdateProperties)===null||xe===void 0?void 0:xe.length)>0);if((je.newGeometry||je.removeAllProperties||_t)&&(nt=Object.assign({},nt),ce.set(je.id,nt),_t&&(nt.properties=Object.assign({},nt.properties))),je.newGeometry&&(nt.geometry=je.newGeometry),je.removeAllProperties)nt.properties={};else if(((Fe=je.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const St of je.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,St)&&delete nt.properties[St];if(((Ue=je.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:St,value:ei}of je.addOrUpdateProperties)nt.properties[St]=ei}}(this._dataUpdateable,Be.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Be){return l._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Be){return this._geoJSONIndex.getClusterExpansionZoom(Be.clusterId)}getClusterChildren(Be){return this._geoJSONIndex.getChildren(Be.clusterId)}getClusterLeaves(Be){return this._geoJSONIndex.getLeaves(Be.clusterId,Be.limit,Be.offset)}}class Tr{constructor(Be){this.self=Be,this.actor=new l.C(Be),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ae,ie)=>{if(this.externalWorkerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.externalWorkerSourceTypes[ae]=ie},this.self.addProtocol=l.be,this.self.removeProtocol=l.bf,this.self.registerRTLTextPlugin=ae=>{if(l.bz.isParsed())throw new Error("RTL text plugin already registered.");l.bz.setMethods(ae)},this.actor.registerMessageHandler("loadDEMTile",(ae,ie)=>this._getDEMWorkerSource(ae,ie.source).loadTile(ie)),this.actor.registerMessageHandler("removeDEMTile",(ae,ie)=>l._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ae,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(ae,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("getClusterChildren",(ae,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("getClusterLeaves",(ae,ie)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("loadData",(ae,ie)=>this._getWorkerSource(ae,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("loadTile",(ae,ie)=>this._getWorkerSource(ae,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("reloadTile",(ae,ie)=>this._getWorkerSource(ae,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("abortTile",(ae,ie)=>this._getWorkerSource(ae,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("removeTile",(ae,ie)=>this._getWorkerSource(ae,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("removeSource",(ae,ie)=>l._(this,void 0,void 0,function*(){if(!this.workerSources[ae]||!this.workerSources[ae][ie.type]||!this.workerSources[ae][ie.type][ie.source])return;const ce=this.workerSources[ae][ie.type][ie.source];delete this.workerSources[ae][ie.type][ie.source],ce.removeSource!==void 0&&ce.removeSource(ie)})),this.actor.registerMessageHandler("removeMap",ae=>l._(this,void 0,void 0,function*(){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.workerSources[ae],delete this.demWorkerSources[ae]})),this.actor.registerMessageHandler("setReferrer",(ae,ie)=>l._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("syncRTLPluginState",(ae,ie)=>this._syncRTLPluginState(ae,ie)),this.actor.registerMessageHandler("importScript",(ae,ie)=>l._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("setImages",(ae,ie)=>this._setImages(ae,ie)),this.actor.registerMessageHandler("updateLayers",(ae,ie)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(ae).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("setLayers",(ae,ie)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(ae).replace(ie)}))}_setImages(Be,ae){return l._(this,void 0,void 0,function*(){this.availableImages[Be]=ae;for(const ie in this.workerSources[Be]){const ce=this.workerSources[Be][ie];for(const me in ce)ce[me].availableImages=ae}})}_syncRTLPluginState(Be,ae){return l._(this,void 0,void 0,function*(){l.bz.setState(ae);const ie=l.bz.getPluginURL();if(ae.pluginStatus==="loaded"&&!l.bz.isParsed()&&ie!=null){this.self.importScripts(ie);const ce=l.bz.isParsed();if(ce)return ce;throw new Error(`RTL Text Plugin failed to import scripts from ${ie}`)}return!1})}_getAvailableImages(Be){let ae=this.availableImages[Be];return ae||(ae=[]),ae}_getLayerIndex(Be){let ae=this.layerIndexes[Be];return ae||(ae=this.layerIndexes[Be]=new s),ae}_getWorkerSource(Be,ae,ie){if(this.workerSources[Be]||(this.workerSources[Be]={}),this.workerSources[Be][ae]||(this.workerSources[Be][ae]={}),!this.workerSources[Be][ae][ie]){const ce={sendAsync:(me,be)=>(me.targetMapId=Be,this.actor.sendAsync(me,be))};switch(ae){case"vector":this.workerSources[Be][ae][ie]=new F(ce,this._getLayerIndex(Be),this._getAvailableImages(Be));break;case"geojson":this.workerSources[Be][ae][ie]=new yr(ce,this._getLayerIndex(Be),this._getAvailableImages(Be));break;default:this.workerSources[Be][ae][ie]=new this.externalWorkerSourceTypes[ae](ce,this._getLayerIndex(Be),this._getAvailableImages(Be))}}return this.workerSources[Be][ae][ie]}_getDEMWorkerSource(Be,ae){return this.demWorkerSources[Be]||(this.demWorkerSources[Be]={}),this.demWorkerSources[Be][ae]||(this.demWorkerSources[Be][ae]=new D),this.demWorkerSources[Be][ae]}}return l.i(self)&&(self.worker=new Tr(self)),Tr}),n("index",["exports","./shared"],function(l,s){var g="4.1.0";let b,S;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((a,d)=>{const _=requestAnimationFrame(a);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),d(s.c())})}),getImageData(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(y).getImageData(-a,-a,y.width+2*a,y.height+2*a)},getImageCanvasContext(y){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=y.width,a.height=y.height,d.drawImage(y,0,0,y.width,y.height),d},resolveURL:y=>(b||(b=document.createElement("a")),b.href=y,b.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class D{static testProp(a){if(!D.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in D.docStyle)return a[d];return a[0]}static create(a,d,_){const B=window.document.createElement(a);return d!==void 0&&(B.className=d),_&&_.appendChild(B),B}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){D.docStyle&&D.selectProp&&(D.userSelect=D.docStyle[D.selectProp],D.docStyle[D.selectProp]="none")}static enableDrag(){D.docStyle&&D.selectProp&&(D.docStyle[D.selectProp]=D.userSelect)}static setTransform(a,d){a.style[D.transformProp]=d}static addEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(d,_,"passive"in B?B:B.capture)}static removeEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(d,_,"passive"in B?B:B.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",D.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",D.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",D.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,_){const B=d.boundingClientRect;return new s.P((_.clientX-B.left)/d.x-a.clientLeft,(_.clientY-B.top)/d.y-a.clientTop)}static mousePos(a,d){const _=D.getScale(a);return D.getPoint(a,_,d)}static touchPos(a,d){const _=[],B=D.getScale(a);for(let T=0;T<d.length;T++)_.push(D.getPoint(a,B,d[T]));return _}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}D.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,D.selectProp=D.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),D.transformProp=D.testProp(["transform","WebkitTransform"]);const N={supported:!1,testSupport:function(y){!he&&te&&(ue?fe(y):J=y)}};let J,te,he=!1,ue=!1;function fe(y){const a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,te),y.isContextLost())return;N.supported=!0}catch{}y.deleteTexture(a),he=!0}var ve,Se;typeof document<"u"&&(te=document.createElement("img"),te.onload=function(){J&&fe(J),J=null,ue=!0},te.onerror=function(){he=!0,J=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let a,d,_,B;y.resetRequestQueue=()=>{a=[],d=0,_=0,B={}},y.addThrottleControl=q=>{const w=_++;return B[w]=q,w},y.removeThrottleControl=q=>{delete B[q],U()},y.getImage=function(q,w){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((k,j)=>{N.supported&&(q.headers||(q.headers={}),q.headers.accept="image/webp,*/*"),s.e(q,{type:"image"}),a.push({abortController:w,requestParameters:q,supportImageRefresh:I,state:"queued",onError:Y=>{j(Y)},onSuccess:Y=>{k(Y)}}),U()})};const T=q=>s._(this,void 0,void 0,function*(){q.state="running";const{requestParameters:w,supportImageRefresh:I,onError:k,onSuccess:j,abortController:Y}=q,X=I===!1&&!s.i(self)&&!s.g(w.url)&&(!w.headers||Object.keys(w.headers).reduce((le,pe)=>le&&pe==="accept",!0));d++;const ee=X?H(w,Y):s.m(w,Y);try{const le=yield ee;delete q.abortController,q.state="completed",le.data instanceof HTMLImageElement||s.b(le.data)?j(le):le.data&&j({data:yield(re=le.data,typeof createImageBitmap=="function"?s.d(re):s.f(re)),cacheControl:le.cacheControl,expires:le.expires})}catch(le){delete q.abortController,k(le)}finally{d--,U()}var re}),U=()=>{const q=(()=>{for(const w of Object.keys(B))if(B[w]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=d;w<q&&a.length>0;w++){const I=a.shift();I.abortController.signal.aborted?w--:T(I)}},H=(q,w)=>new Promise((I,k)=>{const j=new Image,Y=q.url,X=q.credentials;X&&X==="include"?j.crossOrigin="use-credentials":(X&&X==="same-origin"||!s.s(Y))&&(j.crossOrigin="anonymous"),w.signal.addEventListener("abort",()=>{j.src="",k(s.c())}),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,I({data:j})},j.onerror=()=>{j.onerror=j.onload=null,w.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=Y})}(ve||(ve={})),ve.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Se||(Se={}));class Ge{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,_){const B=function(T){const U=T.match(He);if(!U)throw new Error(`Unable to parse URL "${T}"`);return{protocol:U[1],authority:U[2],path:U[3]||"/",params:U[4]?U[4].split("&"):[]}}(a);return B.path+=`${d}${_}`,function(T){const U=T.params.length?`?${T.params.join("&")}`:"";return`${T.protocol}://${T.authority}${T.path}${U}`}(B)}setTransformRequest(a){this._transformRequestFn=a}}const He=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $e(y){var a=new s.A(3);return a[0]=y[0],a[1]=y[1],a[2]=y[2],a}var Ne,at=function(y,a,d){return y[0]=a[0]-d[0],y[1]=a[1]-d[1],y[2]=a[2]-d[2],y};Ne=new s.A(3),s.A!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0);var rt=function(y){var a=y[0],d=y[1];return a*a+d*d};function Re(y){const a=[];if(typeof y=="string")a.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:_,url:B}of y){const T=`${_}${B}`;d.indexOf(T)===-1&&(d.push(T),a.push({id:_,url:B}))}}return a}(function(){var y=new s.A(2);s.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Pe{constructor(a,d,_,B){this.context=a,this.format=_,this.texture=a.gl.createTexture(),this.update(d,B)}update(a,d,_){const{width:B,height:T}=a,U=!(this.size&&this.size[0]===B&&this.size[1]===T||_),{context:H}=this,{gl:q}=H;if(this.useMipmap=!!(d&&d.useMipmap),q.bindTexture(q.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===q.RGBA&&(!d||d.premultiply!==!1)),U)this.size=[B,T],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texImage2D(q.TEXTURE_2D,0,this.format,this.format,q.UNSIGNED_BYTE,a):q.texImage2D(q.TEXTURE_2D,0,this.format,B,T,0,this.format,q.UNSIGNED_BYTE,a.data);else{const{x:w,y:I}=_||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texSubImage2D(q.TEXTURE_2D,0,w,I,q.RGBA,q.UNSIGNED_BYTE,a):q.texSubImage2D(q.TEXTURE_2D,0,w,I,B,T,q.RGBA,q.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&q.generateMipmap(q.TEXTURE_2D)}bind(a,d,_){const{context:B}=this,{gl:T}=B;T.bindTexture(T.TEXTURE_2D,this.texture),_!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=T.LINEAR),a!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,a),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,_||a),this.filter=a),d!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,d),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Je(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class Xe extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let _=!0;const B=d.data||d.spriteData;return this._validateStretch(d.stretchX,B&&B.width)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,B&&B.height)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const B of a){if(B[0]<_||B[1]<B[0]||d<B[1])return!1;_=B[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const _=d.spriteData,B=_&&_.width||d.data.width,T=_&&_.height||d.data.height;return!(a[0]<0||B<a[0]||a[1]<0||T<a[1]||a[2]<0||B<a[2]||a[3]<0||T<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const B=this.getImage(a);if(_&&(B.data.width!==d.data.width||B.data.height!==d.data.height))throw new Error(`size mismatch between old image (${B.data.width}x${B.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=B.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,_)=>{let B=!0;if(!this.isLoaded())for(const T of a)this.images[T]||(B=!1);this.isLoaded()||B?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const _ of a){let B=this.getImage(_);B||(this.fire(new s.k("styleimagemissing",{id:_})),B=this.getImage(_)),B?d[_]={data:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],_=this.getImage(a);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const B={w:_.data.width+2,h:_.data.height+2,x:0,y:0},T=new s.I(B,_);this.patterns[a]={bin:B,position:T}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Pe(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const T in this.patterns)a.push(this.patterns[T].bin);const{w:d,h:_}=s.p(a),B=this.atlasImage;B.resize({width:d||1,height:_||1});for(const T in this.patterns){const{bin:U}=this.patterns[T],H=U.x+1,q=U.y+1,w=this.getImage(T).data,I=w.width,k=w.height;s.R.copy(w,B,{x:0,y:0},{x:H,y:q},{width:I,height:k}),s.R.copy(w,B,{x:0,y:k-1},{x:H,y:q-1},{width:I,height:1}),s.R.copy(w,B,{x:0,y:0},{x:H,y:q+k},{width:I,height:1}),s.R.copy(w,B,{x:I-1,y:0},{x:H-1,y:q},{width:1,height:k}),s.R.copy(w,B,{x:0,y:0},{x:H+I,y:q},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||s.w(`Image with ID: "${d}" was not found`),Je(_)&&this.updateImage(d,_)}}}const Ct=1e20;function Et(y,a,d,_,B,T,U,H,q){for(let w=a;w<a+_;w++)Mt(y,d*T+w,T,B,U,H,q);for(let w=d;w<d+B;w++)Mt(y,w*T+a,1,_,U,H,q)}function Mt(y,a,d,_,B,T,U){T[0]=0,U[0]=-Ct,U[1]=Ct,B[0]=y[a];for(let H=1,q=0,w=0;H<_;H++){B[H]=y[a+H*d];const I=H*H;do{const k=T[q];w=(B[H]-B[k]+I-k*k)/(H-k)/2}while(w<=U[q]&&--q>-1);q++,T[q]=H,U[q]=w,U[q+1]=Ct}for(let H=0,q=0;H<_;H++){for(;U[q+1]<H;)q++;const w=T[q],I=H-w;y[a+H*d]=B[w]+I*I}}class vt{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return s._(this,void 0,void 0,function*(){const d=[];for(const T in a)for(const U of a[T])d.push(this._getAndCacheGlyphsPromise(T,U));const _=yield Promise.all(d),B={};for(const{stack:T,id:U,glyph:H}of _)B[T]||(B[T]={}),B[T][U]=H&&{id:H.id,bitmap:H.bitmap.clone(),metrics:H.metrics};return B})}_getAndCacheGlyphsPromise(a,d){return s._(this,void 0,void 0,function*(){let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return{stack:a,id:d,glyph:B};if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,{stack:a,id:d,glyph:B};const T=Math.floor(d/256);if(256*T>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[T])return{stack:a,id:d,glyph:B};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[T]){const H=vt.loadGlyphRange(a,T,this.url,this.requestManager);_.requests[T]=H}const U=yield _.requests[T];for(const H in U)this._doesCharSupportLocalGlyph(+H)||(_.glyphs[+H]=U[+H]);return _.ranges[T]=!0,{stack:a,id:d,glyph:U[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](a)||s.u["Hangul Syllables"](a)||s.u.Hiragana(a)||s.u.Katakana(a))}_tinySDF(a,d,_){const B=this.localIdeographFontFamily;if(!B||!this._doesCharSupportLocalGlyph(_))return;let T=a.tinySDF;if(!T){let H="400";/bold/i.test(d)?H="900":/medium/i.test(d)?H="500":/light/i.test(d)&&(H="200"),T=a.tinySDF=new vt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:B,fontWeight:H})}const U=T.draw(String.fromCharCode(_));return{id:_,bitmap:new s.o({width:U.width||60,height:U.height||60},U.data),metrics:{width:U.glyphWidth/2||24,height:U.glyphHeight/2||24,left:U.glyphLeft/2+.5||0,top:U.glyphTop/2-27.5||-8,advance:U.glyphAdvance/2||24,isDoubleResolution:!0}}}}vt.loadGlyphRange=function(y,a,d,_){return s._(this,void 0,void 0,function*(){const B=256*a,T=B+255,U=_.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${B}-${T}`),Se.Glyphs),H=yield s.l(U,new AbortController);if(!H||!H.data)throw new Error(`Could not load glyph range. range: ${a}, ${B}-${T}`);const q={};for(const w of s.n(H.data))q[w.id]=w;return q})},vt.TinySDF=class{constructor(){let{fontSize:y=24,buffer:a=3,radius:d=8,cutoff:_=.25,fontFamily:B="sans-serif",fontWeight:T="normal",fontStyle:U="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=_,this.radius=d;const H=this.size=y+4*a,q=this._createCanvas(H),w=this.ctx=q.getContext("2d",{willReadFrequently:!0});w.font=`${U} ${T} ${y}px ${B}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(y){const a=document.createElement("canvas");return a.width=a.height=y,a}draw(y){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:B,actualBoundingBoxRight:T}=this.ctx.measureText(y),U=Math.ceil(d),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-B))),q=Math.min(this.size-this.buffer,U+Math.ceil(_)),w=H+2*this.buffer,I=q+2*this.buffer,k=Math.max(w*I,0),j=new Uint8ClampedArray(k),Y={data:j,width:w,height:I,glyphWidth:H,glyphHeight:q,glyphTop:U,glyphLeft:0,glyphAdvance:a};if(H===0||q===0)return Y;const{ctx:X,buffer:ee,gridInner:re,gridOuter:le}=this;X.clearRect(ee,ee,H,q),X.fillText(y,ee,ee+U);const pe=X.getImageData(ee,ee,H,q);le.fill(Ct,0,k),re.fill(0,0,k);for(let ge=0;ge<q;ge++)for(let we=0;we<H;we++){const De=pe.data[4*(ge*H+we)+3]/255;if(De===0)continue;const Me=(ge+ee)*w+we+ee;if(De===1)le[Me]=0,re[Me]=Ct;else{const st=.5-De;le[Me]=st>0?st*st:0,re[Me]=st<0?st*st:0}}Et(le,0,0,w,I,w,this.f,this.v,this.z),Et(re,ee,ee,H,q,w,this.f,this.v,this.z);for(let ge=0;ge<k;ge++){const we=Math.sqrt(le[ge])-Math.sqrt(re[ge]);j[ge]=Math.round(255-255*(we/this.radius+this.cutoff))}return Y}};class Dt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(a,d){return s.y(a.expression.evaluate(d))}interpolate(a,d,_){return{x:s.z.number(a.x,d.x,_),y:s.z.number(a.y,d.y,_),z:s.z.number(a.z,d.z,_)}}}let Pt;class Xt extends s.E{constructor(a){super(),Pt=Pt||new s.q({anchor:new s.D(s.v.light.anchor),position:new Dt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Pt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.r,a,d))for(const _ in a){const B=a[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),B):this._transitionable.setValue(_,B)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||_.validate!==!1)&&s.t(this,a.call(s.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Te{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const _=a.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(a,d)),this.dashEntry[_]}getDashRanges(a,d,_){const B=[];let T=a.length%2==1?-a[a.length-1]*_:0,U=a[0]*_,H=!0;B.push({left:T,right:U,isDash:H,zeroLength:a[0]===0});let q=a[0];for(let w=1;w<a.length;w++){H=!H;const I=a[w];T=q*_,q+=I,U=q*_,B.push({left:T,right:U,isDash:H,zeroLength:I===0})}return B}addRoundDash(a,d,_){const B=d/2;for(let T=-_;T<=_;T++){const U=this.width*(this.nextRow+_+T);let H=0,q=a[H];for(let w=0;w<this.width;w++){w/q.right>1&&(q=a[++H]);const I=Math.abs(w-q.left),k=Math.abs(w-q.right),j=Math.min(I,k);let Y;const X=T/_*(B+1);if(q.isDash){const ee=B-Math.abs(X);Y=Math.sqrt(j*j+ee*ee)}else Y=B-Math.sqrt(j*j+X*X);this.data[U+w]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(a){for(let H=a.length-1;H>=0;--H){const q=a[H],w=a[H+1];q.zeroLength?a.splice(H,1):w&&w.isDash===q.isDash&&(w.left=q.left,a.splice(H,1))}const d=a[0],_=a[a.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const B=this.width*this.nextRow;let T=0,U=a[T];for(let H=0;H<this.width;H++){H/U.right>1&&(U=a[++T]);const q=Math.abs(H-U.left),w=Math.abs(H-U.right),I=Math.min(q,w);this.data[B+H]=Math.max(0,Math.min(255,(U.isDash?I:-I)+128))}}addDash(a,d){const _=d?7:0,B=2*_+1;if(this.nextRow+B>this.height)return s.w("LineAtlas out of space"),null;let T=0;for(let H=0;H<a.length;H++)T+=a[H];if(T!==0){const H=this.width/T,q=this.getDashRanges(a,this.width,H);d?this.addRoundDash(q,H,_):this.addRegularDash(q)}const U={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:T};return this.nextRow+=B,this.dirty=!0,U}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Ze="maplibre_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}const dt=Math.floor(F.hardwareConcurrency/2);let pt,Bt;function Ft(){return pt||(pt=new tt),pt}tt.workerCount=s.B(globalThis)?Math.max(Math.min(dt,3),1):1;class Lt{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let B=0;B<_.length;B++){const T=new s.C(_[B],d);T.name=`Worker ${B}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const _=[];for(const B of this.actors)_.push(B.sendAsync({type:a,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const _ of this.actors)_.registerMessageHandler(a,d)}}function Gt(){return Bt||(Bt=new Lt(Ft(),s.G),Bt.registerMessageHandler("getResource",(y,a,d)=>s.m(a,d))),Bt}function ri(y,a){const d=s.F();return s.H(d,d,[1,1,0]),s.J(d,d,[.5*y.width,.5*y.height,1]),s.K(d,d,y.calculatePosMatrix(a.toUnwrapped()))}function mi(y,a,d,_,B,T){const U=function(k,j,Y){if(k)for(const X of k){const ee=j[X];if(ee&&ee.source===Y&&ee.type==="fill-extrusion")return!0}else for(const X in j){const ee=j[X];if(ee.source===Y&&ee.type==="fill-extrusion")return!0}return!1}(B&&B.layers,a,y.id),H=T.maxPitchScaleFactor(),q=y.tilesIn(_,H,U);q.sort(yi);const w=[];for(const k of q)w.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(a,d,y._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,B,T,H,ri(y.transform,k.tileID))});const I=function(k){const j={},Y={};for(const X of k){const ee=X.queryResults,re=X.wrappedTileID,le=Y[re]=Y[re]||{};for(const pe in ee){const ge=ee[pe],we=le[pe]=le[pe]||{},De=j[pe]=j[pe]||[];for(const Me of ge)we[Me.featureIndex]||(we[Me.featureIndex]=!0,De.push(Me))}}return j}(w);for(const k in I)I[k].forEach(j=>{const Y=j.feature,X=y.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=X});return I}function yi(y,a){const d=y.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Pi(y,a,d){return s._(this,void 0,void 0,function*(){let _=y;if(y.url?_=(yield s.h(a.transformRequest(y.url,Se.Source),d)).data:yield F.frameAsync(d),!_)return null;const B=s.L(s.e(_,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(B.vectorLayerIds=_.vector_layers.map(T=>T.id)),B})}class Ot{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}extend(a){const d=this._sw,_=this._ne;let B,T;if(a instanceof s.M)B=a,T=a;else{if(!(a instanceof Ot))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ot.convert(a)):this.extend(s.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(s.M.convert(a)):this;if(B=a._sw,T=a._ne,!B||!T)return this}return d||_?(d.lng=Math.min(B.lng,d.lng),d.lat=Math.min(B.lat,d.lat),_.lng=Math.max(T.lng,_.lng),_.lat=Math.max(T.lat,_.lat)):(this._sw=new s.M(B.lng,B.lat),this._ne=new s.M(T.lng,T.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:_}=s.M.convert(a);let B=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&B}static convert(a){return a instanceof Ot?a:a&&new Ot(a)}static fromLngLat(a){const _=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,B=_/Math.cos(Math.PI/180*a.lat);return new Ot(new s.M(a.lng-B,a.lat-_),new s.M(a.lng+B,a.lat+_))}}class lt{constructor(a,d,_){this.bounds=Ot.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),_=Math.floor(s.N(this.bounds.getWest())*d),B=Math.floor(s.O(this.bounds.getNorth())*d),T=Math.ceil(s.N(this.bounds.getEast())*d),U=Math.ceil(s.O(this.bounds.getSouth())*d);return a.x>=_&&a.x<T&&a.y>=B&&a.y<U}}class wt extends s.E{constructor(a,d,_,B){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(d,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(B)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(s.e(this,a),a.bounds&&(this.tileBounds=new lt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,Se.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let B="reloadTile";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((T,U)=>{a.reloadPromise={resolve:T,reject:U}})}else a.actor=this.dispatcher.getActor(),B="loadTile";a.abortController=new AbortController;try{const T=yield a.actor.sendAsync({type:B,data:_},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,T)}catch(T){if(delete a.abortController,a.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const _=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(_.resolve).catch(_.reject)}}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"abortTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ki extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.setEventedParent(B),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.L(d,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Pi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(s.e(this,a),a.bounds&&(this.tileBounds=new lt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return s.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const _=yield ve.getImage(this.map._requestManager.transformRequest(d,Se.Tile),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&a.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const B=this.map.painter.context,T=B.gl,U=_.data;a.texture=this.map.painter.getTileTexture(U.width),a.texture?a.texture.update(U,{useMipmap:!0}):(a.texture=new Pe(B,U,T.RGBA,{useMipmap:!0}),a.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(_){if(delete a.abortController,a.aborted)a.state="unloaded";else if(_)throw a.state="errored",_}})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ti extends ki{constructor(a,d,_,B){super(a,d,_,B),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,Se.Tile);a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const B=yield ve.getImage(_,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(B&&B.data){const T=B.data;this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&a.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const U=s.b(T)&&s.S()?T:yield this.readImageNow(T),H={type:this.type,uid:a.uid,source:this.id,rawImageData:U,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const q=yield a.actor.sendAsync({type:"loadDEMTile",data:H});a.dem=q,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(B){if(delete a.abortController,a.aborted)a.state="unloaded";else if(B)throw a.state="errored",B}})}readImageNow(a){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const d=a.width+2,_=a.height+2;try{return new s.R({width:d,height:_},yield s.V(a,-1,-1,d,_))}catch{}}return F.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,_=Math.pow(2,d.z),B=(d.x-1+_)%_,T=d.x===0?a.wrap-1:a.wrap,U=(d.x+1+_)%_,H=d.x+1===_?a.wrap+1:a.wrap,q={};return q[new s.Q(a.overscaledZ,T,d.z,B,d.y).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y).key]={backfilled:!1},d.y>0&&(q[new s.Q(a.overscaledZ,T,d.z,B,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y-1).key]={backfilled:!1}),d.y+1<_&&(q[new s.Q(a.overscaledZ,T,d.z,B,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y+1).key]={backfilled:!1}),q}unloadTile(a){return s._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class ht extends s.E{constructor(a,d,_,B){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(B),this._data=d.data,this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const T=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*T,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*T,extent:s.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.W,radius:(d.clusterRadius||50)*T,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,_){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:_}})}_updateWorkerData(a){return s._(this,void 0,void 0,function*(){const d=s.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),Se.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let B=null;_.resourceTiming&&_.resourceTiming[this.id]&&(B=_.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(T,{resourceTiming:B}),this.fire(new s.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const _={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const B=yield this.actor.sendAsync({type:d,data:_},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(B,this.map.painter,d==="reloadTile")})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var qt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class si extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(B),this.options=d}load(a){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield ve.getImage(this.map._requestManager.transformRequest(this.url,Se.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this.fire(new s.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(s.Y.fromLngLat);this.tileID=function(B){let T=1/0,U=1/0,H=-1/0,q=-1/0;for(const j of B)T=Math.min(T,j.x),U=Math.min(U,j.y),H=Math.max(H,j.x),q=Math.max(q,j.y);const w=Math.max(H-T,q-U),I=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),k=Math.pow(2,I);return new s.a0(I,Math.floor((T+H)/2*k),Math.floor((U+q)/2*k))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(B=>this.tileID.getTilePoint(B)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,s.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,s.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Pe(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const T=this.tiles[B];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class fi extends si{constructor(a,d,_,B){super(a,d,_,B),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,Se.Source).url);try{const d=yield s.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Pe(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const T=this.tiles[B];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ci extends si{constructor(a,d,_,B){super(a,d,_,B),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(T=>!Array.isArray(T)||T.length!==2||T.some(U=>typeof U!="number"))||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,qt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Pe(d,this.canvas,_.RGBA,{premultiply:!0});let B=!1;for(const T in this.tiles){const U=this.tiles[T];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture,B=!0)}B&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Wi={},ir=y=>{switch(y){case"geojson":return ht;case"image":return si;case"raster":return ki;case"raster-dem":return ti;case"vector":return wt;case"video":return fi;case"canvas":return ci}return Wi[y]};class dr extends s.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=Gt(),this.queue=[]}_sendPluginStateToWorker(){return s._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new s.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return s._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=F.resolveURL(a),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),d||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield s.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let Sr=null;function zt(){return Sr||(Sr=new dr),Sr}class Yi{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=s.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,T){const U={};if(!T)return U;for(const H of B){const q=H.layerIds.map(w=>T.getLayer(w)).filter(Boolean);if(q.length!==0){H.layers=q,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(w=>q.filter(I=>I.id===w)[0]));for(const w of q)U[w.id]=H}}return U}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const B in this.buckets){const T=this.buckets[B];if(T instanceof s.a5){if(this.hasSymbolBuckets=!0,!_)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const B in this.buckets){const T=this.buckets[B];if(T instanceof s.a5&&T.hasRTLText){this.hasRTLText=!0,zt().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const B in this.buckets){const T=this.buckets[B];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(B).queryRadius(T))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const _ in this.buckets){const B=this.buckets[_];B.uploadPending()&&B.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pe(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pe(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,_,B,T,U,H,q,w,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:B,cameraQueryGeometry:T,scale:U,tileSize:this.tileSize,pixelPosMatrix:I,transform:q,params:H,queryPadding:this.queryPadding*w},a,d,_):{}}querySourceFeatures(a,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const B=_.loadVTLayers(),T=d&&d.sourceLayer?d.sourceLayer:"",U=B._geojsonTileLayer||B[T];if(!U)return;const H=s.a6(d&&d.filter),{z:q,x:w,y:I}=this.tileID.canonical,k={z:q,x:w,y:I};for(let j=0;j<U.length;j++){const Y=U.feature(j);if(H.needGeometry){const re=s.a7(Y,!0);if(!H.filter(new s.a8(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!H.filter(new s.a8(this.tileID.overscaledZ),Y))continue;const X=_.getId(Y,T),ee=new s.a9(Y,q,w,I,X);ee.tile=k,a.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const _=s.aa(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let B=!1;if(this.expirationTime>_)B=!1;else if(d)if(this.expirationTime<d)B=!0;else{const T=this.expirationTime-d;T?this.expirationTime=_+Math.max(T,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const B in this.buckets){if(!d.style.hasLayer(B))continue;const T=this.buckets[B],U=T.layers[0].sourceLayer||"_geojsonTileLayer",H=_[U],q=a[U];if(!H||!q||Object.keys(q).length===0)continue;T.update(q,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=d&&d.style&&d.style.getLayer(B);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=F.now()+a}setDependencies(a,d){const _={};for(const B of d)_[B]=!0;this.dependencies[a]=_}hasDependency(a,d){for(const _ of a){const B=this.dependencies[_];if(B){for(const T of d)if(B[T])return!0}}return!1}}class ui{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,_){const B=a.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);const T={value:d,timeout:void 0};if(_!==void 0&&(T.timeout=setTimeout(()=>{this.remove(a,T)},_)),this.data[B].push(T),this.order.push(B),this.order.length>this.max){const U=this._getAndRemoveByKey(this.order[0]);U&&this.onRemove(U)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const _=a.wrapped().key,B=d===void 0?0:this.data[_].indexOf(d),T=this.data[_][B];return this.data[_].splice(B,1),T.timeout&&clearTimeout(T.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(T.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const _ in this.data)for(const B of this.data[_])a(B.value)||d.push(B);for(const _ of d)this.remove(_.value.tileID,_)}}class Kt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,_){const B=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][B]=this.stateChanges[a][B]||{},s.e(this.stateChanges[a][B],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const T in this.state[a])T!==B&&(this.deletedStates[a][T]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][B]===null){this.deletedStates[a][B]={};for(const T in this.state[a][B])_[T]||(this.deletedStates[a][B][T]=null)}else for(const T in _)this.deletedStates[a]&&this.deletedStates[a][B]&&this.deletedStates[a][B][T]===null&&delete this.deletedStates[a][B][T]}removeFeatureState(a,d,_){if(this.deletedStates[a]===null)return;const B=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&d!==void 0)this.deletedStates[a][B]!==null&&(this.deletedStates[a][B]=this.deletedStates[a][B]||{},this.deletedStates[a][B][_]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][B])for(_ in this.deletedStates[a][B]={},this.stateChanges[a][B])this.deletedStates[a][B][_]=null;else this.deletedStates[a][B]=null;else this.deletedStates[a]=null}getState(a,d){const _=String(d),B=s.e({},(this.state[a]||{})[_],(this.stateChanges[a]||{})[_]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const T=this.deletedStates[a][d];if(T===null)return{};for(const U in T)delete B[U]}return B}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const _={};for(const B in this.stateChanges){this.state[B]=this.state[B]||{};const T={};for(const U in this.stateChanges[B])this.state[B][U]||(this.state[B][U]={}),s.e(this.state[B][U],this.stateChanges[B][U]),T[U]=this.state[B][U];_[B]=T}for(const B in this.deletedStates){this.state[B]=this.state[B]||{};const T={};if(this.deletedStates[B]===null)for(const U in this.state[B])T[U]={},this.state[B][U]={};else for(const U in this.deletedStates[B]){if(this.deletedStates[B][U]===null)this.state[B][U]={};else for(const H of Object.keys(this.deletedStates[B][U]))delete this.state[B][U][H];T[U]=this.state[B][U]}_[B]=_[B]||{},s.e(_[B],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const B in a)a[B].setFeatureState(_,d)}}class Ji extends s.E{constructor(a,d,_){super(),this.id=a,this.dispatcher=_,this.on("data",B=>{B.dataType==="source"&&B.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((B,T,U,H)=>{const q=new(ir(T.type))(B,T,U,H);if(q.id!==B)throw new Error(`Expected Source id to be ${B} instead of ${q.id}`);return q})(a,d,_,this),this._tiles={},this._cache=new ui(0,B=>this._unloadTile(B)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kt,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,_)}catch(B){a.state="errored",B.status!==404?this._source.fire(new s.j(B,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new s.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(a),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Vt).map(a=>a.key)}getRenderableIds(a){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,a)&&d.push(this._tiles[_]);return a?d.sort((_,B)=>{const T=_.tileID,U=B.tileID,H=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),q=new s.P(U.canonical.x,U.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-U.overscaledZ||q.y-H.y||q.x-H.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(Vt).map(_=>_.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return s._(this,void 0,void 0,function*(){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,a,d))})}_tileLoaded(a,d,_){a.timeAdded=F.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let B=0;B<d.length;B++){const T=d[B];if(a.neighboringTiles&&a.neighboringTiles[T]){const U=this.getTileByID(T);_(a,U),_(U,a)}}function _(B,T){B.needsHillshadePrepare=!0,B.needsTerrainPrepare=!0;let U=T.tileID.canonical.x-B.tileID.canonical.x;const H=T.tileID.canonical.y-B.tileID.canonical.y,q=Math.pow(2,B.tileID.canonical.z),w=T.tileID.key;U===0&&H===0||Math.abs(H)>1||(Math.abs(U)>1&&(Math.abs(U+q)===1?U+=q:Math.abs(U-q)===1&&(U-=q)),T.dem&&B.dem&&(B.dem.backfillBorder(T.dem,U,H),B.neighboringTiles&&B.neighboringTiles[w]&&(B.neighboringTiles[w].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,_,B){for(const T in this._tiles){let U=this._tiles[T];if(B[T]||!U.hasData()||U.tileID.overscaledZ<=d||U.tileID.overscaledZ>_)continue;let H=U.tileID;for(;U&&U.tileID.overscaledZ>d+1;){const w=U.tileID.scaledTo(U.tileID.overscaledZ-1);U=this._tiles[w.key],U&&U.hasData()&&(H=w)}let q=H;for(;q.overscaledZ>d;)if(q=q.scaledTo(q.overscaledZ-1),a[q.key]){B[H.key]=H;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=a.overscaledZ-1;_>=d;_--){const B=a.scaledTo(_),T=this._getLoadedTile(B);if(T)return T}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,_=Math.ceil(a.height/this._source.tileSize)+1,B=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,B):B;this._cache.setMaxSize(T)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const _={};for(const B in this._tiles){const T=this._tiles[B];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),_[T.tileID.key]=T}this._tiles=_;for(const B in this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(const B in this._tiles)this._setTileReloadTimer(B,this._tiles[B])}}update(a,d){if(this.transform=a,this.terrain=d,!this._sourceLoaded||this._paused)return;let _;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new s.Q(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(_=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(I=>this._source.hasTile(I)))):_=[];const B=a.coveringZoomLevel(this._source),T=Math.max(B-Ji.maxOverzooming,this._source.minzoom),U=Math.max(B+Ji.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const k of _)if(k.canonical.z>this._source.minzoom){const j=k.scaledTo(k.canonical.z-1);I[j.key]=j;const Y=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));I[Y.key]=Y}_=_.concat(Object.values(I))}const H=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,H&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const q=this._updateRetainedTiles(_,B);if(Ci(this._source.type)){const I={},k={},j=Object.keys(q),Y=F.now();for(const X of j){const ee=q[X],re=this._tiles[X];if(!re||re.fadeEndTime!==0&&re.fadeEndTime<=Y)continue;const le=this.findLoadedParent(ee,T);le&&(this._addTile(le.tileID),I[le.tileID.key]=le.tileID),k[X]=ee}this._retainLoadedChildren(k,B,U,q);for(const X in I)q[X]||(this._coveredTiles[X]=!0,q[X]=I[X]);if(d){const X={},ee={};for(const re of _)this._tiles[re.key].hasData()?X[re.key]=re:ee[re.key]=re;for(const re in ee){const le=ee[re].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(X[le[0].key]=q[le[0].key]=le[0],X[le[1].key]=q[le[1].key]=le[1],X[le[2].key]=q[le[2].key]=le[2],X[le[3].key]=q[le[3].key]=le[3],delete ee[re])}for(const re in ee){const le=this.findLoadedParent(ee[re],this._source.minzoom);if(le){X[le.tileID.key]=q[le.tileID.key]=le.tileID;for(const pe in X)X[pe].isChildOf(le.tileID)&&delete X[pe]}}for(const re in this._tiles)X[re]||(this._coveredTiles[re]=!0)}}for(const I in q)this._tiles[I].clearFadeHold();const w=s.ab(this._tiles,q);for(const I of w){const k=this._tiles[I];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){const _={},B={},T=Math.max(d-Ji.maxOverzooming,this._source.minzoom),U=Math.max(d+Ji.maxUnderzooming,this._source.minzoom),H={};for(const q of a){const w=this._addTile(q);_[q.key]=q,w.hasData()||d<this._source.maxzoom&&(H[q.key]=q)}this._retainLoadedChildren(H,d,U,_);for(const q of a){let w=this._tiles[q.key];if(w.hasData())continue;if(d+1>this._source.maxzoom){const k=q.children(this._source.maxzoom)[0],j=this.getTile(k);if(j&&j.hasData()){_[k.key]=k;continue}}else{const k=q.children(this._source.maxzoom);if(_[k[0].key]&&_[k[1].key]&&_[k[2].key]&&_[k[3].key])continue}let I=w.wasRequested();for(let k=q.overscaledZ-1;k>=T;--k){const j=q.scaledTo(k);if(B[j.key])break;if(B[j.key]=!0,w=this.getTile(j),!w&&I&&(w=this._addTile(j)),w){const Y=w.hasData();if((I||Y)&&(_[j.key]=j),I=w.wasRequested(),Y)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let _,B=this._tiles[a].tileID;for(;B.overscaledZ>0;){if(B.key in this._loadedParentTiles){_=this._loadedParentTiles[B.key];break}d.push(B.key);const T=B.scaledTo(B.overscaledZ-1);if(_=this._getLoadedTile(T),_)break;B=T}for(const T of d)this._loadedParentTiles[T]=_}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const _=d;return d||(d=new Yi(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,_||this._source.fire(new s.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=d.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,_){const B=[],T=this.transform;if(!T)return B;const U=_?T.getCameraQueryGeometry(a):a,H=a.map(X=>T.pointCoordinate(X,this.terrain)),q=U.map(X=>T.pointCoordinate(X,this.terrain)),w=this.getIds();let I=1/0,k=1/0,j=-1/0,Y=-1/0;for(const X of q)I=Math.min(I,X.x),k=Math.min(k,X.y),j=Math.max(j,X.x),Y=Math.max(Y,X.y);for(let X=0;X<w.length;X++){const ee=this._tiles[w[X]];if(ee.holdingForFade())continue;const re=ee.tileID,le=Math.pow(2,T.zoom-ee.tileID.overscaledZ),pe=d*ee.queryPadding*s.W/ee.tileSize/le,ge=[re.getTilePoint(new s.Y(I,k)),re.getTilePoint(new s.Y(j,Y))];if(ge[0].x-pe<s.W&&ge[0].y-pe<s.W&&ge[1].x+pe>=0&&ge[1].y+pe>=0){const we=H.map(Me=>re.getTilePoint(Me)),De=q.map(Me=>re.getTilePoint(Me));B.push({tile:ee,tileID:re,queryGeometry:we,cameraQueryGeometry:De,scale:le})}}return B}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Ci(this._source.type)){const a=F.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,_){this._state.updateState(a=a||"_geojsonTileLayer",d,_)}removeFeatureState(a,d,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,_)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,_){const B=this._tiles[a];B&&B.setDependencies(d,_)}reloadTilesForDependencies(a,d){for(const _ in this._tiles)this._tiles[_].hasDependency(a,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(a,d))}}function Vt(y,a){const d=Math.abs(2*y.wrap)-+(y.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return y.overscaledZ-a.overscaledZ||_-d||a.canonical.y-y.canonical.y||a.canonical.x-y.canonical.x}function Ci(y){return y==="raster"||y==="image"||y==="video"}Ji.maxOverzooming=10,Ji.maxUnderzooming=3;class Li{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ac(a,0,1);let d=1,_=this._distances[d];const B=a*this.paddedLength+this.padding;for(;_<B&&d<this._distances.length;)_=this._distances[++d];const T=d-1,U=this._distances[T],H=_-U,q=H>0?(B-U)/H:0;return this.points[T].mult(1-q).add(this.points[d].mult(q))}}function jt(y,a){let d=!0;return y==="always"||y!=="never"&&a!=="never"||(d=!1),d}class bi{constructor(a,d,_){const B=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let U=0;U<this.xCellCount*this.yCellCount;U++)B.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,B,T){this._forEachCell(d,_,B,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(B),this.bboxes.push(T)}insertCircle(a,d,_,B){this._forEachCell(d-B,_-B,d+B,_+B,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(B)}_insertBoxCell(a,d,_,B,T,U){this.boxCells[T].push(U)}_insertCircleCell(a,d,_,B,T,U){this.circleCells[T].push(U)}_query(a,d,_,B,T,U,H){if(_<0||a>this.width||B<0||d>this.height)return[];const q=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=B){if(T)return[{key:null,x1:a,y1:d,x2:_,y2:B}];for(let w=0;w<this.boxKeys.length;w++)q.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const I=this.circles[3*w],k=this.circles[3*w+1],j=this.circles[3*w+2];q.push({key:this.circleKeys[w],x1:I-j,y1:k-j,x2:I+j,y2:k+j})}}else this._forEachCell(a,d,_,B,this._queryCell,q,{hitTest:T,overlapMode:U,seenUids:{box:{},circle:{}}},H);return q}query(a,d,_,B){return this._query(a,d,_,B,!1,null)}hitTest(a,d,_,B,T,U){return this._query(a,d,_,B,!0,T,U).length>0}hitTestCircle(a,d,_,B,T){const U=a-_,H=a+_,q=d-_,w=d+_;if(H<0||U>this.width||w<0||q>this.height)return!1;const I=[];return this._forEachCell(U,q,H,w,this._queryCellCircle,I,{hitTest:!0,overlapMode:B,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},T),I.length>0}_queryCell(a,d,_,B,T,U,H,q){const{seenUids:w,hitTest:I,overlapMode:k}=H,j=this.boxCells[T];if(j!==null){const X=this.bboxes;for(const ee of j)if(!w.box[ee]){w.box[ee]=!0;const re=4*ee,le=this.boxKeys[ee];if(a<=X[re+2]&&d<=X[re+3]&&_>=X[re+0]&&B>=X[re+1]&&(!q||q(le))&&(!I||!jt(k,le.overlapMode))&&(U.push({key:le,x1:X[re],y1:X[re+1],x2:X[re+2],y2:X[re+3]}),I))return!0}}const Y=this.circleCells[T];if(Y!==null){const X=this.circles;for(const ee of Y)if(!w.circle[ee]){w.circle[ee]=!0;const re=3*ee,le=this.circleKeys[ee];if(this._circleAndRectCollide(X[re],X[re+1],X[re+2],a,d,_,B)&&(!q||q(le))&&(!I||!jt(k,le.overlapMode))){const pe=X[re],ge=X[re+1],we=X[re+2];if(U.push({key:le,x1:pe-we,y1:ge-we,x2:pe+we,y2:ge+we}),I)return!0}}}return!1}_queryCellCircle(a,d,_,B,T,U,H,q){const{circle:w,seenUids:I,overlapMode:k}=H,j=this.boxCells[T];if(j!==null){const X=this.bboxes;for(const ee of j)if(!I.box[ee]){I.box[ee]=!0;const re=4*ee,le=this.boxKeys[ee];if(this._circleAndRectCollide(w.x,w.y,w.radius,X[re+0],X[re+1],X[re+2],X[re+3])&&(!q||q(le))&&!jt(k,le.overlapMode))return U.push(!0),!0}}const Y=this.circleCells[T];if(Y!==null){const X=this.circles;for(const ee of Y)if(!I.circle[ee]){I.circle[ee]=!0;const re=3*ee,le=this.circleKeys[ee];if(this._circlesCollide(X[re],X[re+1],X[re+2],w.x,w.y,w.radius)&&(!q||q(le))&&!jt(k,le.overlapMode))return U.push(!0),!0}}}_forEachCell(a,d,_,B,T,U,H,q){const w=this._convertToXCellCoord(a),I=this._convertToYCellCoord(d),k=this._convertToXCellCoord(_),j=this._convertToYCellCoord(B);for(let Y=w;Y<=k;Y++)for(let X=I;X<=j;X++)if(T.call(this,a,d,_,B,this.xCellCount*X+Y,U,H,q))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,B,T,U){const H=B-a,q=T-d,w=_+U;return w*w>H*H+q*q}_circleAndRectCollide(a,d,_,B,T,U,H){const q=(U-B)/2,w=Math.abs(a-(B+q));if(w>q+_)return!1;const I=(H-T)/2,k=Math.abs(d-(T+I));if(k>I+_)return!1;if(w<=q||k<=I)return!0;const j=w-q,Y=k-I;return j*j+Y*Y<=_*_}}function Yt(y,a,d,_,B){const T=s.F();return a?(s.J(T,T,[1/B,1/B,1]),d||s.ad(T,T,_.angle)):s.K(T,_.labelPlaneMatrix,y),T}function yr(y,a,d,_,B){if(a){const T=s.ae(y);return s.J(T,T,[B,B,1]),d||s.ad(T,T,-_.angle),T}return _.glCoordMatrix}function Tr(y,a,d){let _;d?(_=[y.x,y.y,d(y.x,y.y),1],s.af(_,_,a)):(_=[y.x,y.y,0,1],_t(_,_,a));const B=_[3];return{point:new s.P(_[0]/B,_[1]/B),signedDistanceFromCamera:B}}function Qe(y,a){return .5+y/a*.5}function Be(y,a){const d=y[0]/y[3],_=y[1]/y[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function ae(y,a,d,_,B,T,U,H,q,w){const I=_?y.textSizeData:y.iconSizeData,k=s.ag(I,d.transform.zoom),j=[256/d.width*2+1,256/d.height*2+1],Y=_?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Y.clear();const X=y.lineVertexArray,ee=_?y.text.placedSymbolArray:y.icon.placedSymbolArray,re=d.transform.width/d.transform.height;let le=!1;for(let pe=0;pe<ee.length;pe++){const ge=ee.get(pe);if(ge.hidden||ge.writingMode===s.ah.vertical&&!le){nt(ge.numGlyphs,Y);continue}let we;if(le=!1,w?(we=[ge.anchorX,ge.anchorY,w(ge.anchorX,ge.anchorY),1],s.af(we,we,a)):(we=[ge.anchorX,ge.anchorY,0,1],_t(we,we,a)),!Be(we,j)){nt(ge.numGlyphs,Y);continue}const De=Qe(d.transform.cameraToCenterDistance,we[3]),Me=s.ai(I,k,ge),st=U?Me/De:Me*De,We=new s.P(ge.anchorX,ge.anchorY),ke=Tr(We,B,w).point,Ve={projections:{},offsets:{}},gt=me(ge,st,!1,H,a,B,T,y.glyphOffsetArray,X,Y,ke,We,Ve,re,q,w);le=gt.useVertical,(gt.notEnoughRoom||le||gt.needsFlipping&&me(ge,st,!0,H,a,B,T,y.glyphOffsetArray,X,Y,ke,We,Ve,re,q,w).notEnoughRoom)&&nt(ge.numGlyphs,Y)}_?y.text.dynamicLayoutVertexBuffer.updateData(Y):y.icon.dynamicLayoutVertexBuffer.updateData(Y)}function ie(y,a,d,_,B,T,U,H,q,w,I,k,j){const Y=H.glyphStartIndex+H.numGlyphs,X=H.lineStartIndex,ee=H.lineStartIndex+H.lineLength,re=a.getoffsetX(H.glyphStartIndex),le=a.getoffsetX(Y-1),pe=Ue(y*re,d,_,B,T,U,H.segment,X,ee,q,w,I,k,j);if(!pe)return null;const ge=Ue(y*le,d,_,B,T,U,H.segment,X,ee,q,w,I,k,j);return ge?{first:pe,last:ge}:null}function ce(y,a,d,_){return y===s.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*_?{useVertical:!0}:(y===s.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function me(y,a,d,_,B,T,U,H,q,w,I,k,j,Y,X,ee){const re=a/24,le=y.lineOffsetX*re,pe=y.lineOffsetY*re;let ge;if(y.numGlyphs>1){const we=y.glyphStartIndex+y.numGlyphs,De=y.lineStartIndex,Me=y.lineStartIndex+y.lineLength,st=ie(re,H,le,pe,d,I,k,y,q,T,j,X,ee);if(!st)return{notEnoughRoom:!0};const We=Tr(st.first.point,U,ee).point,ke=Tr(st.last.point,U,ee).point;if(_&&!d){const Ve=ce(y.writingMode,We,ke,Y);if(Ve)return Ve}ge=[st.first];for(let Ve=y.glyphStartIndex+1;Ve<we-1;Ve++)ge.push(Ue(re*H.getoffsetX(Ve),le,pe,d,I,k,y.segment,De,Me,q,T,j,X,ee));ge.push(st.last)}else{if(_&&!d){const De=Tr(k,B,ee).point,Me=y.lineStartIndex+y.segment+1,st=new s.P(q.getx(Me),q.gety(Me)),We=Tr(st,B,ee),ke=We.signedDistanceFromCamera>0?We.point:be(k,st,De,1,B,ee),Ve=ce(y.writingMode,De,ke,Y);if(Ve)return Ve}const we=Ue(re*H.getoffsetX(y.glyphStartIndex),le,pe,d,I,k,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,q,T,j,X,ee);if(!we)return{notEnoughRoom:!0};ge=[we]}for(const we of ge)s.aj(w,we.point,we.angle);return{}}function be(y,a,d,_,B,T){const U=Tr(y.add(y.sub(a)._unit()),B,T).point,H=d.sub(U);return d.add(H._mult(_/H.mag()))}function Ee(y,a){const{projectionCache:d,lineVertexArray:_,labelPlaneMatrix:B,tileAnchorPoint:T,distanceFromAnchor:U,getElevation:H,previousVertex:q,direction:w,absOffsetX:I}=a;if(d.projections[y])return d.projections[y];const k=new s.P(_.getx(y),_.gety(y)),j=Tr(k,B,H);if(j.signedDistanceFromCamera>0)return d.projections[y]=j.point,j.point;const Y=y-w;return be(U===0?T:new s.P(_.getx(Y),_.gety(Y)),k,q,I-U+1,B,H)}function xe(y,a,d){return y._unit()._perp()._mult(a*d)}function Fe(y,a,d,_,B,T,U,H){const{projectionCache:q,direction:w}=H;if(q.offsets[y])return q.offsets[y];const I=d.add(a);if(y+w<_||y+w>=B)return q.offsets[y]=I,I;const k=Ee(y+w,H),j=xe(k.sub(d),U,w),Y=d.add(j),X=k.add(j);return q.offsets[y]=s.ak(T,I,Y,X)||I,q.offsets[y]}function Ue(y,a,d,_,B,T,U,H,q,w,I,k,j,Y){const X=_?y-a:y+a;let ee=X>0?1:-1,re=0;_&&(ee*=-1,re=Math.PI),ee<0&&(re+=Math.PI);let le,pe,ge=ee>0?H+U:H+U+1,we=B,De=B,Me=0,st=0;const We=Math.abs(X),ke=[];let Ve;for(;Me+st<=We;){if(ge+=ee,ge<H||ge>=q)return null;Me+=st,De=we,pe=le;const At={projectionCache:k,lineVertexArray:w,labelPlaneMatrix:I,tileAnchorPoint:T,distanceFromAnchor:Me,getElevation:Y,previousVertex:De,direction:ee,absOffsetX:We};if(we=Ee(ge,At),d===0)ke.push(De),Ve=we.sub(De);else{let kt;const Rt=we.sub(De);kt=Rt.mag()===0?xe(Ee(ge+ee,At).sub(we),d,ee):xe(Rt,d,ee),pe||(pe=De.add(kt)),le=Fe(ge,kt,we,H,q,pe,d,At),ke.push(pe),Ve=le.sub(pe)}st=Ve.mag()}const gt=Ve._mult((We-Me)/st)._add(pe||De),xt=re+Math.atan2(we.y-De.y,we.x-De.x);return ke.push(gt),{point:gt,angle:j?xt:0,path:ke}}const je=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(y,a){for(let d=0;d<y;d++){const _=a.length;a.resize(_+4),a.float32.set(je,3*_)}}function _t(y,a,d){const _=a[0],B=a[1];return y[0]=d[0]*_+d[4]*B+d[12],y[1]=d[1]*_+d[5]*B+d[13],y[3]=d[3]*_+d[7]*B+d[15],y}const St=100;class ei{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new bi(a.width+200,a.height+200,25),_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new bi(a.width+200,a.height+200,25);this.transform=a,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+St,this.screenBottomBoundary=a.height+St,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,_,B,T,U){const H=this.projectAndGetPerspectiveRatio(B,a.anchorPointX,a.anchorPointY,U),q=_*H.perspectiveRatio,w=a.x1*q+H.point.x,I=a.y1*q+H.point.y,k=a.x2*q+H.point.x,j=a.y2*q+H.point.y;return!this.isInsideGrid(w,I,k,j)||d!=="always"&&this.grid.hitTest(w,I,k,j,d,T)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[w,I,k,j],offscreen:this.isOffscreen(w,I,k,j)}}placeCollisionCircles(a,d,_,B,T,U,H,q,w,I,k,j,Y,X){const ee=[],re=new s.P(d.anchorX,d.anchorY),le=Tr(re,U,X),pe=Qe(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),ge=(I?T/pe:T*pe)/s.ao,we=Tr(re,H,X).point,De=ie(ge,B,d.lineOffsetX*ge,d.lineOffsetY*ge,!1,we,re,d,_,H,{projections:{},offsets:{}},!1,X);let Me=!1,st=!1,We=!0;if(De){const ke=.5*j*pe+Y,Ve=new s.P(-100,-100),gt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Li,At=De.first,kt=De.last;let Rt=[];for(let vi=At.path.length-1;vi>=1;vi--)Rt.push(At.path[vi]);for(let vi=1;vi<kt.path.length;vi++)Rt.push(kt.path[vi]);const Ai=2.5*ke;if(q){const vi=Rt.map(Ti=>Tr(Ti,q,X));Rt=vi.some(Ti=>Ti.signedDistanceFromCamera<=0)?[]:vi.map(Ti=>Ti.point)}let Ht=[];if(Rt.length>0){const vi=Rt[0].clone(),Ti=Rt[0].clone();for(let er=1;er<Rt.length;er++)vi.x=Math.min(vi.x,Rt[er].x),vi.y=Math.min(vi.y,Rt[er].y),Ti.x=Math.max(Ti.x,Rt[er].x),Ti.y=Math.max(Ti.y,Rt[er].y);Ht=vi.x>=Ve.x&&Ti.x<=gt.x&&vi.y>=Ve.y&&Ti.y<=gt.y?[Rt]:Ti.x<Ve.x||vi.x>gt.x||Ti.y<Ve.y||vi.y>gt.y?[]:s.al([Rt],Ve.x,Ve.y,gt.x,gt.y)}for(const vi of Ht){xt.reset(vi,.25*ke);let Ti=0;Ti=xt.length<=.5*ke?1:Math.ceil(xt.paddedLength/Ai)+1;for(let er=0;er<Ti;er++){const Ii=er/Math.max(Ti-1,1),_r=xt.lerp(Ii),pr=_r.x+St,qi=_r.y+St;ee.push(pr,qi,ke,0);const Nr=pr-ke,nn=qi-ke,Pr=pr+ke,Wr=qi+ke;if(We=We&&this.isOffscreen(Nr,nn,Pr,Wr),st=st||this.isInsideGrid(Nr,nn,Pr,Wr),a!=="always"&&this.grid.hitTestCircle(pr,qi,ke,a,k)&&(Me=!0,!w))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!w&&Me||!st||pe<this.perspectiveRatioCutoff?[]:ee,offscreen:We,collisionDetected:Me}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,B=1/0,T=-1/0,U=-1/0;for(const I of a){const k=new s.P(I.x+St,I.y+St);_=Math.min(_,k.x),B=Math.min(B,k.y),T=Math.max(T,k.x),U=Math.max(U,k.y),d.push(k)}const H=this.grid.query(_,B,T,U).concat(this.ignoredGrid.query(_,B,T,U)),q={},w={};for(const I of H){const k=I.key;if(q[k.bucketInstanceId]===void 0&&(q[k.bucketInstanceId]={}),q[k.bucketInstanceId][k.featureIndex])continue;const j=[new s.P(I.x1,I.y1),new s.P(I.x2,I.y1),new s.P(I.x2,I.y2),new s.P(I.x1,I.y2)];s.am(d,j)&&(q[k.bucketInstanceId][k.featureIndex]=!0,w[k.bucketInstanceId]===void 0&&(w[k.bucketInstanceId]=[]),w[k.bucketInstanceId].push(k.featureIndex))}return w}insertCollisionBox(a,d,_,B,T,U){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:T,collisionGroupID:U,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,B,T,U){const H=_?this.ignoredGrid:this.grid,q={bucketInstanceId:B,featureIndex:T,collisionGroupID:U,overlapMode:d};for(let w=0;w<a.length;w+=4)H.insertCircle(q,a[w],a[w+1],a[w+2])}projectAndGetPerspectiveRatio(a,d,_,B){let T;return B?(T=[d,_,B(d,_),1],s.af(T,T,a)):(T=[d,_,0,1],_t(T,T,a)),{point:new s.P((T[0]/T[3]+1)/2*this.transform.width+St,(-T[1]/T[3]+1)/2*this.transform.height+St),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T[3]*.5}}isOffscreen(a,d,_,B){return _<St||a>=this.screenRightBoundary||B<St||d>this.screenBottomBoundary}isInsideGrid(a,d,_,B){return _>=0&&a<this.gridRightBoundary&&B>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=s.an([]);return s.H(a,a,[-100,-100,0]),a}}function $t(y,a,d){return a*(s.W/(y.tileSize*Math.pow(2,d-y.tileID.overscaledZ)))}class Wt{constructor(a,d,_,B){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):B&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class oi{constructor(a,d,_,B,T){this.text=new Wt(a?a.text:null,d,_,T),this.icon=new Wt(a?a.icon:null,d,B,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ei{constructor(a,d,_){this.text=a,this.icon=d,this.skipFade=_}}class Gi{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Bi{constructor(a,d,_,B,T){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=B,this.tileID=T}}class Ni{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function ot(y,a,d,_,B){const{horizontalAlign:T,verticalAlign:U}=s.at(y);return new s.P(-(T-.5)*a+_[0]*B,-(U-.5)*d+_[1]*B)}function ii(y,a,d,_,B,T){const{x1:U,x2:H,y1:q,y2:w,anchorPointX:I,anchorPointY:k}=y,j=new s.P(a,d);return _&&j._rotate(B?T:-T),{x1:U+j.x,y1:q+j.y,x2:H+j.x,y2:w+j.y,anchorPointX:I,anchorPointY:k}}class Qt{constructor(a,d,_,B,T){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new ei(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Ni(B),this.collisionCircleArrays={},this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,B){const T=_.getBucket(d),U=_.latestFeatureIndex;if(!T||!U||d.id!==T.layerIds[0])return;const H=_.collisionBoxArray,q=T.layers[0].layout,w=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),I=_.tileSize/s.W,k=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),j=q.get("text-pitch-alignment")==="map",Y=q.get("text-rotation-alignment")==="map",X=$t(_,1,this.transform.zoom),ee=Yt(k,j,Y,this.transform,X);let re=null;if(j){const pe=yr(k,j,Y,this.transform,X);re=s.K([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[T.bucketInstanceId]=new Bi(T.bucketInstanceId,U,T.sourceLayerIndex,T.index,_.tileID);const le={bucket:T,layout:q,posMatrix:k,textLabelPlaneMatrix:ee,labelToScreenMatrix:re,scale:w,textPixelRatio:I,holdingForFade:_.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:s.ag(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(B)for(const pe of T.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:we,symbolInstanceEnd:De}=pe;a.push({sortKey:ge,symbolInstanceStart:we,symbolInstanceEnd:De,parameters:le})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:le})}attemptAnchorPlacement(a,d,_,B,T,U,H,q,w,I,k,j,Y,X,ee,re){const le=s.ap[a.textAnchor],pe=[a.textOffset0,a.textOffset1],ge=ot(le,_,B,pe,T),we=this.collisionIndex.placeCollisionBox(ii(d,ge.x,ge.y,U,H,this.transform.angle),k,q,w,I.predicate,re);if((!ee||this.collisionIndex.placeCollisionBox(ii(ee,ge.x,ge.y,U,H,this.transform.angle),k,q,w,I.predicate,re).box.length!==0)&&we.box.length>0){let De;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(De=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:pe,width:_,height:B,anchor:le,textBoxScale:T,prevAnchor:De},this.markUsedJustification(Y,le,j,X),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,X,j),this.placedOrientations[j.crossTileID]=X),{shift:ge,placedGlyphBoxes:we}}}placeLayerBucketPart(a,d,_){const{bucket:B,layout:T,posMatrix:U,textLabelPlaneMatrix:H,labelToScreenMatrix:q,textPixelRatio:w,holdingForFade:I,collisionBoxArray:k,partiallyEvaluatedTextSize:j,collisionGroup:Y}=a.parameters,X=T.get("text-optional"),ee=T.get("icon-optional"),re=s.aq(T,"text-overlap","text-allow-overlap"),le=re==="always",pe=s.aq(T,"icon-overlap","icon-allow-overlap"),ge=pe==="always",we=T.get("text-rotation-alignment")==="map",De=T.get("text-pitch-alignment")==="map",Me=T.get("icon-text-fit")!=="none",st=T.get("symbol-z-order")==="viewport-y",We=le&&(ge||!B.hasIconData()||ee),ke=ge&&(le||!B.hasTextData()||X);!B.collisionArrays&&k&&B.deserializeCollisionBoxes(k);const Ve=this.retainedQueryData[B.bucketInstanceId].tileID,gt=this.terrain?(At,kt)=>this.terrain.getElevation(Ve,At,kt):null,xt=(At,kt)=>{var Rt,Ai;if(d[At.crossTileID])return;if(I)return void(this.placements[At.crossTileID]=new Ei(!1,!1,!1));let Ht=!1,vi=!1,Ti=!0,er=null,Ii={box:null,offscreen:null},_r={box:null,offscreen:null},pr=null,qi=null,Nr=null,nn=0,Pr=0,Wr=0;kt.textFeatureIndex?nn=kt.textFeatureIndex:At.useRuntimeCollisionCircles&&(nn=At.featureIndex),kt.verticalTextFeatureIndex&&(Pr=kt.verticalTextFeatureIndex);const Er=kt.textBox;if(Er){const gr=$r=>{let Xr=s.ah.horizontal;if(B.allowVerticalPlacement&&!$r&&this.prevPlacement){const Fn=this.prevPlacement.placedOrientations[At.crossTileID];Fn&&(this.placedOrientations[At.crossTileID]=Fn,Xr=Fn,this.markUsedOrientation(B,Xr,At))}return Xr},vr=($r,Xr)=>{if(B.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const Fn of B.writingModes)if(Fn===s.ah.vertical?(Ii=Xr(),_r=Ii):Ii=$r(),Ii&&Ii.box&&Ii.box.length)break}else Ii=$r()},ar=At.textAnchorOffsetStartIndex,cn=At.textAnchorOffsetEndIndex;if(cn===ar){const $r=(Xr,Fn)=>{const Wn=this.collisionIndex.placeCollisionBox(Xr,re,w,U,Y.predicate,gt);return Wn&&Wn.box&&Wn.box.length&&(this.markUsedOrientation(B,Fn,At),this.placedOrientations[At.crossTileID]=Fn),Wn};vr(()=>$r(Er,s.ah.horizontal),()=>{const Xr=kt.verticalTextBox;return B.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&Xr?$r(Xr,s.ah.vertical):{box:null,offscreen:null}}),gr(Ii&&Ii.box&&Ii.box.length)}else{let $r=s.ap[(Ai=(Rt=this.prevPlacement)===null||Rt===void 0?void 0:Rt.variableOffsets[At.crossTileID])===null||Ai===void 0?void 0:Ai.anchor];const Xr=(Wn,vl,Kr)=>{const vn=Wn.x2-Wn.x1,ia=Wn.y2-Wn.y1,Us=At.textBoxScale,Xs=Me&&pe==="never"?vl:null;let Uo={box:[],offscreen:!1},ao=re==="never"?1:2,zu="never";$r&&ao++;for(let Oa=0;Oa<ao;Oa++){for(let Mn=ar;Mn<cn;Mn++){const yc=B.textAnchorOffsets.get(Mn);if($r&&yc.textAnchor!==$r)continue;const pu=this.attemptAnchorPlacement(yc,Wn,vn,ia,Us,we,De,w,U,Y,zu,At,B,Kr,Xs,gt);if(pu&&(Uo=pu.placedGlyphBoxes,Uo&&Uo.box&&Uo.box.length))return Ht=!0,er=pu.shift,Uo}$r?$r=null:zu=re}return Uo};vr(()=>Xr(Er,kt.iconBox,s.ah.horizontal),()=>{const Wn=kt.verticalTextBox;return B.allowVerticalPlacement&&!(Ii&&Ii.box&&Ii.box.length)&&At.numVerticalGlyphVertices>0&&Wn?Xr(Wn,kt.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),Ii&&(Ht=Ii.box,Ti=Ii.offscreen);const Fn=gr(Ii&&Ii.box);if(!Ht&&this.prevPlacement){const Wn=this.prevPlacement.variableOffsets[At.crossTileID];Wn&&(this.variableOffsets[At.crossTileID]=Wn,this.markUsedJustification(B,Wn.anchor,At,Fn))}}}if(pr=Ii,Ht=pr&&pr.box&&pr.box.length>0,Ti=pr&&pr.offscreen,At.useRuntimeCollisionCircles){const gr=B.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex),vr=s.ai(B.textSizeData,j,gr),ar=T.get("text-padding");qi=this.collisionIndex.placeCollisionCircles(re,gr,B.lineVertexArray,B.glyphOffsetArray,vr,U,H,q,_,De,Y.predicate,At.collisionCircleDiameter,ar,gt),qi.circles.length&&qi.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),Ht=le||qi.circles.length>0&&!qi.collisionDetected,Ti=Ti&&qi.offscreen}if(kt.iconFeatureIndex&&(Wr=kt.iconFeatureIndex),kt.iconBox){const gr=vr=>{const ar=Me&&er?ii(vr,er.x,er.y,we,De,this.transform.angle):vr;return this.collisionIndex.placeCollisionBox(ar,pe,w,U,Y.predicate,gt)};_r&&_r.box&&_r.box.length&&kt.verticalIconBox?(Nr=gr(kt.verticalIconBox),vi=Nr.box.length>0):(Nr=gr(kt.iconBox),vi=Nr.box.length>0),Ti=Ti&&Nr.offscreen}const is=X||At.numHorizontalGlyphVertices===0&&At.numVerticalGlyphVertices===0,zr=ee||At.numIconVertices===0;if(is||zr?zr?is||(vi=vi&&Ht):Ht=vi&&Ht:vi=Ht=vi&&Ht,Ht&&pr&&pr.box&&this.collisionIndex.insertCollisionBox(pr.box,re,T.get("text-ignore-placement"),B.bucketInstanceId,_r&&_r.box&&Pr?Pr:nn,Y.ID),vi&&Nr&&this.collisionIndex.insertCollisionBox(Nr.box,pe,T.get("icon-ignore-placement"),B.bucketInstanceId,Wr,Y.ID),qi&&(Ht&&this.collisionIndex.insertCollisionCircles(qi.circles,re,T.get("text-ignore-placement"),B.bucketInstanceId,nn,Y.ID),_)){const gr=B.bucketInstanceId;let vr=this.collisionCircleArrays[gr];vr===void 0&&(vr=this.collisionCircleArrays[gr]=new Gi);for(let ar=0;ar<qi.circles.length;ar+=4)vr.circles.push(qi.circles[ar+0]),vr.circles.push(qi.circles[ar+1]),vr.circles.push(qi.circles[ar+2]),vr.circles.push(qi.collisionDetected?1:0)}if(At.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(B.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[At.crossTileID]=new Ei(Ht||We,vi||ke,Ti||B.justReloaded),d[At.crossTileID]=!0};if(st){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const At=B.getSortedSymbolIndexes(this.transform.angle);for(let kt=At.length-1;kt>=0;--kt){const Rt=At[kt];xt(B.symbolInstances.get(Rt),B.collisionArrays[Rt])}}else for(let At=a.symbolInstanceStart;At<a.symbolInstanceEnd;At++)xt(B.symbolInstances.get(At),B.collisionArrays[At]);if(_&&B.bucketInstanceId in this.collisionCircleArrays){const At=this.collisionCircleArrays[B.bucketInstanceId];s.ar(At.invProjMatrix,U),At.viewportMatrix=this.collisionIndex.getViewportMatrix()}B.justReloaded=!1}markUsedJustification(a,d,_,B){let T;T=B===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.as(d)];const U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const H of U)H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=T>=0&&H!==T?0:_.crossTileID)}markUsedOrientation(a,d,_){const B=d===s.ah.horizontal||d===s.ah.horizontalOnly?d:0,T=d===s.ah.vertical?d:0,U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const H of U)a.text.placedSymbolArray.get(H).placedOrientation=B;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const B=d?d.symbolFadeChange(a):1,T=d?d.opacities:{},U=d?d.variableOffsets:{},H=d?d.placedOrientations:{};for(const q in this.placements){const w=this.placements[q],I=T[q];I?(this.opacities[q]=new oi(I,B,w.text,w.icon),_=_||w.text!==I.text.placed||w.icon!==I.icon.placed):(this.opacities[q]=new oi(null,B,w.text,w.icon,w.skipFade),_=_||w.text||w.icon)}for(const q in T){const w=T[q];if(!this.opacities[q]){const I=new oi(w,B,!1,!1);I.isHidden()||(this.opacities[q]=I,_=_||w.text.placed||w.icon.placed)}}for(const q in U)this.variableOffsets[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.variableOffsets[q]=U[q]);for(const q in H)this.placedOrientations[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.placedOrientations[q]=H[q]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const _={};for(const B of d){const T=B.getBucket(a);T&&B.latestFeatureIndex&&a.id===T.layerIds[0]&&this.updateBucketOpacities(T,_,B.collisionBoxArray)}}updateBucketOpacities(a,d,_){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const B=a.layers[0],T=B.layout,U=new oi(null,0,!1,!1,!0),H=T.get("text-allow-overlap"),q=T.get("icon-allow-overlap"),w=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=T.get("text-rotation-alignment")==="map",k=T.get("text-pitch-alignment")==="map",j=T.get("icon-text-fit")!=="none",Y=new oi(null,0,H&&(q||!a.hasIconData()||T.get("icon-optional")),q&&(H||!a.hasTextData()||T.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const X=(ee,re,le)=>{for(let pe=0;pe<re/4;pe++)ee.opacityVertexArray.emplaceBack(le);ee.hasVisibleVertices=ee.hasVisibleVertices||le!==ms};for(let ee=0;ee<a.symbolInstances.length;ee++){const re=a.symbolInstances.get(ee),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:pe,crossTileID:ge}=re;let we=this.opacities[ge];d[ge]?we=U:we||(we=Y,this.opacities[ge]=we),d[ge]=!0;const De=re.numIconVertices>0,Me=this.placedOrientations[re.crossTileID],st=Me===s.ah.vertical,We=Me===s.ah.horizontal||Me===s.ah.horizontalOnly;if(le>0||pe>0){const ke=On(we.text);X(a.text,le,st?ms:ke),X(a.text,pe,We?ms:ke);const Ve=we.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(At=>{At>=0&&(a.text.placedSymbolArray.get(At).hidden=Ve||st?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=Ve||We?1:0);const gt=this.variableOffsets[re.crossTileID];gt&&this.markUsedJustification(a,gt.anchor,re,Me);const xt=this.placedOrientations[re.crossTileID];xt&&(this.markUsedJustification(a,"left",re,xt),this.markUsedOrientation(a,xt,re))}if(De){const ke=On(we.icon),Ve=!(j&&re.verticalPlacedIconSymbolIndex&&st);re.placedIconSymbolIndex>=0&&(X(a.icon,re.numIconVertices,Ve?ke:ms),a.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=we.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(X(a.icon,re.numVerticalIconVertices,Ve?ms:ke),a.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ke=a.collisionArrays[ee];if(ke){let Ve=new s.P(0,0);if(ke.textBox||ke.verticalTextBox){let xt=!0;if(w){const At=this.variableOffsets[ge];At?(Ve=ot(At.anchor,At.width,At.height,At.textOffset,At.textBoxScale),I&&Ve._rotate(k?this.transform.angle:-this.transform.angle)):xt=!1}ke.textBox&&Qi(a.textCollisionBox.collisionVertexArray,we.text.placed,!xt||st,Ve.x,Ve.y),ke.verticalTextBox&&Qi(a.textCollisionBox.collisionVertexArray,we.text.placed,!xt||We,Ve.x,Ve.y)}const gt=!!(!We&&ke.verticalIconBox);ke.iconBox&&Qi(a.iconCollisionBox.collisionVertexArray,we.icon.placed,gt,j?Ve.x:0,j?Ve.y:0),ke.verticalIconBox&&Qi(a.iconCollisionBox.collisionVertexArray,we.icon.placed,!gt,j?Ve.x:0,j?Ve.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ee.invProjMatrix,a.placementViewportMatrix=ee.viewportMatrix,a.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Qi(y,a,d,_,B){y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0)}const Ar=Math.pow(2,25),on=Math.pow(2,24),xn=Math.pow(2,17),hr=Math.pow(2,16),mn=Math.pow(2,9),yn=Math.pow(2,8),cr=Math.pow(2,1);function On(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,d=Math.floor(127*y.opacity);return d*Ar+a*on+d*xn+a*hr+d*mn+a*yn+d*cr+a}const ms=0;class Vr{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,_,B,T){const U=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(U,B,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,U.sort((H,q)=>H.sortKey-q.sortKey));this._currentPartIndex<U.length;)if(d.placeLayerBucketPart(U[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,T())return!0;return!1}}class wn{constructor(a,d,_,B,T,U,H,q){this.placement=new Qt(a,d,U,H,q),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_){const B=F.now(),T=()=>!this._forceFullPlacement&&F.now()-B>2;for(;this._currentPlacementIndex>=0;){const U=d[a[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=H)&&(!U.maxzoom||U.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Vr(U)),this._inProgressLayer.continuePlacement(_[U.source],this.placement,this._showCollisionBoxes,U,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const To=512/s.W/2;class hs{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this._symbolsByKey={};const B=new Map;for(let T=0;T<d.length;T++){const U=d.get(T),H=U.key,q=B.get(H);q?q.push(U):B.set(H,[U])}for(const[T,U]of B){const H={positions:U.map(q=>({x:Math.floor(q.anchorX*To),y:Math.floor(q.anchorY*To)})),crossTileIDs:U.map(q=>q.crossTileID)};if(H.positions.length>128){const q=new s.au(H.positions.length,16,Uint16Array);for(const{x:w,y:I}of H.positions)q.add(w,I);q.finish(),delete H.positions,H.index=q}this._symbolsByKey[T]=H}}getScaledCoordinates(a,d){const{x:_,y:B,z:T}=this.tileID.canonical,{x:U,y:H,z:q}=d.canonical,w=To/Math.pow(2,q-T),I=(H*s.W+a.anchorY)*w,k=B*s.W*To;return{x:Math.floor((U*s.W+a.anchorX)*w-_*s.W*To),y:Math.floor(I-k)}}findMatches(a,d,_){const B=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let T=0;T<a.length;T++){const U=a.get(T);if(U.crossTileID)continue;const H=this._symbolsByKey[U.key];if(!H)continue;const q=this.getScaledCoordinates(U,d);if(H.index){const w=H.index.range(q.x-B,q.y-B,q.x+B,q.y+B).sort();for(const I of w){const k=H.crossTileIDs[I];if(!_[k]){_[k]=!0,U.crossTileID=k;break}}}else if(H.positions)for(let w=0;w<H.positions.length;w++){const I=H.positions[w],k=H.crossTileIDs[w];if(Math.abs(I.x-q.x)<=B&&Math.abs(I.y-q.y)<=B&&!_[k]){_[k]=!0,U.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:d}=a;return d})}}class Xi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const _ in this.indexes){const B=this.indexes[_],T={};for(const U in B){const H=B[U];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+d),T[H.tileID.key]=H}this.indexes[_]=T}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const B=this.usedCrossTileIDs[a.overscaledZ];for(const T in this.indexes){const U=this.indexes[T];if(Number(T)>a.overscaledZ)for(const H in U){const q=U[H];q.tileID.isChildOf(a)&&q.findMatches(d.symbolInstances,a,B)}else{const H=U[a.scaledTo(Number(T)).key];H&&H.findMatches(d.symbolInstances,a,B)}}for(let T=0;T<d.symbolInstances.length;T++){const U=d.symbolInstances.get(T);U.crossTileID||(U.crossTileID=_.generate(),B[U.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new hs(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.getCrossTileIDsLists())for(const B of _)delete this.usedCrossTileIDs[a][B]}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const B=this.indexes[_];for(const T in B)a[B[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,B[T]),delete B[T],d=!0)}return d}}class Cs{constructor(){this.layerIndexes={},this.crossTileIDs=new Xi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_){let B=this.layerIndexes[a.id];B===void 0&&(B=this.layerIndexes[a.id]=new eo);let T=!1;const U={};B.handleWrapJump(_);for(const H of d){const q=H.getBucket(a);q&&a.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),B.addBucket(H.tileID,q,this.crossTileIDs)&&(T=!0),U[q.bucketInstanceId]=!0)}return B.removeStaleBuckets(U)&&(T=!0),T}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const fr=(y,a)=>s.t(y,a&&a.filter(d=>d.identifier!=="source.canvas")),Dr=s.av();class Gn extends s.E{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlTextPluginStateChange=()=>{for(const _ in this.sourceCaches){const B=this.sourceCaches[_].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[_].reload()}},this.map=a,this.dispatcher=new Lt(Ft(),a._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(_,B)=>this.getGlyphs(_,B)),this.dispatcher.registerMessageHandler("getImages",(_,B)=>this.getImages(_,B)),this.imageManager=new Xe,this.imageManager.setEventedParent(this),this.glyphManager=new vt(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Te(256,512),this.crossTileSymbolIndex=new Cs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.ax()),zt().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const B=this.sourceCaches[_.sourceId];if(!B)return;const T=B.getSource();if(T&&T.vectorLayerIds)for(const U in this._layers){const H=this._layers[U];H.source===T.id&&this._validateLayer(H)}})}loadURL(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const B=this.map._requestManager.transformRequest(a,Se.Style);this._loadStyleRequest=new AbortController,s.h(B,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,d,_)}).catch(T=>{this._loadStyleRequest=null,T&&this.fire(new s.j(T))})}loadJSON(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Dr,{validate:!1})}_load(a,d,_){var B;const T=d.transformStyle?d.transformStyle(_,a):a;if(!d.validate||!fr(this,s.x(T))){this._loaded=!0,this.stylesheet=T;for(const U in T.sources)this.addSource(U,T.sources[U],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new Xt(this.stylesheet.light),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const a=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const _=s.az(d);_.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=_}}_loadSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,B;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(T,U,H,q){return s._(this,void 0,void 0,function*(){const w=Re(T),I=H>1?"@2x":"",k={},j={};for(const{id:Y,url:X}of w){const ee=U.transformRequest(U.normalizeSpriteURL(X,I,".json"),Se.SpriteJSON);k[Y]=s.h(ee,q);const re=U.transformRequest(U.normalizeSpriteURL(X,I,".png"),Se.SpriteImage);j[Y]=ve.getImage(re,q)}return yield Promise.all([...Object.values(k),...Object.values(j)]),function(Y,X){return s._(this,void 0,void 0,function*(){const ee={};for(const re in Y){ee[re]={};const le=F.getImageCanvasContext((yield X[re]).data),pe=(yield Y[re]).data;for(const ge in pe){const{width:we,height:De,x:Me,y:st,sdf:We,pixelRatio:ke,stretchX:Ve,stretchY:gt,content:xt}=pe[ge];ee[re][ge]={data:null,pixelRatio:ke,sdf:We,stretchX:Ve,stretchY:gt,content:xt,spriteData:{width:we,height:De,x:Me,y:st,context:le}}}}return ee})}(k,j)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const U in T){this._spritesImagesIds[U]=[];const H=this._spritesImagesIds[U]?this._spritesImagesIds[U].filter(q=>!(q in T)):[];for(const q of H)this.imageManager.removeImage(q),this._changedImages[q]=!0;for(const q in T[U]){const w=U==="default"?q:`${U}:${q}`;this._spritesImagesIds[U].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,T[U][q],!1):this.imageManager.addImage(w,T[U][q]),d&&(this._changedImages[w]=!0)}}}).catch(T=>{this._spriteRequest=null,B=T,this.fire(new s.j(B))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),_&&_(B)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const _=a.sourceLayer;if(!_)return;const B=d.getSource();(B.type==="geojson"||B.vectorLayerIds&&B.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.j(new Error(`Source layer "${_}" does not exist on source "${B.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const _=[];for(const B of a)d[B]&&_.push(d[B]);return _}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const B=this._layers[_];B.type!=="custom"&&(a[_]=B.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const B=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(B.length||T.length)&&this._updateWorkerLayers(B,T);for(const U in this._updatedSources){const H=this._updatedSources[U];if(H==="reload")this._reloadSource(U);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(U)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const U in this._updatedPaintProps)this._layers[U].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const _={};for(const B in this.sourceCaches){const T=this.sourceCaches[B];_[B]=T.used,T.used=!1}for(const B of this._order){const T=this._layers[B];T.recalculate(a,this._availableImages),!T.isHidden(a.zoom)&&T.source&&(this.sourceCaches[T.source].used=!0)}for(const B in _){const T=this.sourceCaches[B];_[B]!==T.used&&T.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:B}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var _;this._checkLoaded();const B=this.serialize();if(a=d.transformStyle?d.transformStyle(B,a):a,((_=d.validate)===null||_===void 0||_)&&fr(this,s.x(a)))return!1;(a=s.aA(a)).layers=s.ay(a.layers);const T=s.aB(B,a),U=this._getOperationsToPerform(T);if(U.unimplemented.length>0)throw new Error(`Unimplemented: ${U.unimplemented.join(", ")}.`);if(U.operations.length===0)return!1;for(const H of U.operations)H();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],_=[];for(const B of a)switch(B.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,B.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,B.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,B.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,B.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,B.args));break;case"addSource":d.push(()=>this.addSource.apply(this,B.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,B.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,B.args));break;case"setLight":d.push(()=>this.setLight.apply(this,B.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,B.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,B.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,B.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,B.args));break;case"setTransition":d.push(()=>{});break;default:_.push(B.command)}return{operations:d,unimplemented:_}}addImage(a,d){if(this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.x.source,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const B=this.sourceCaches[a]=new Ji(a,d,this.dispatcher);B.style=this,B.setEventedParent(this,()=>({isSourceLoaded:B.loaded(),source:B.serialize(),sourceId:a})),B.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===a)return this.fire(new s.j(new Error(`Source "${a}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const _=this.sourceCaches[a].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=a.id;if(this.getLayer(B))return void this.fire(new s.j(new Error(`Layer "${B}" already exists on this map.`)));let T;if(a.type==="custom"){if(fr(this,s.aC(a)))return;T=s.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(B,a.source),a=s.aA(a),a=s.e(a,{source:B})),this._validate(s.x.layer,`layers.${B}`,a,{arrayIndex:-1},_))return;T=s.az(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:B}})}const U=d?this._order.indexOf(d):this._order.length;if(d&&U===-1)this.fire(new s.j(new Error(`Cannot add layer "${B}" before non-existing layer "${d}".`)));else{if(this._order.splice(U,0,B),this._layerOrderChanged=!0,this._layers[B]=T,this._removedLayers[B]&&T.source&&T.type!=="custom"){const H=this._removedLayers[B];delete this._removedLayers[B],H.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const _=this._order.indexOf(a);this._order.splice(_,1);const B=d?this._order.indexOf(d):this._order.length;d&&B===-1?this.fire(new s.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(B,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,_){this._checkLoaded();const B=this.getLayer(a);B?B.minzoom===d&&B.maxzoom===_||(d!=null&&(B.minzoom=d),_!=null&&(B.maxzoom=_),this._updateLayer(B)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=this.getLayer(a);if(B){if(!s.aD(B.filter,d))return d==null?(B.filter=void 0,void this._updateLayer(B)):void(this._validate(s.x.filter,`layers.${B.id}.filter`,d,null,_)||(B.filter=s.aA(d),this._updateLayer(B)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return s.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const T=this.getLayer(a);T?s.aD(T.getLayoutProperty(d),_)||(T.setLayoutProperty(d,_,B),this._updateLayer(T)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const _=this.getLayer(a);if(_)return _.getLayoutProperty(d);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const T=this.getLayer(a);T?s.aD(T.getPaintProperty(d),_)||(T.setPaintProperty(d,_,B)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const _=a.source,B=a.sourceLayer,T=this.sourceCaches[_];if(T===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const U=T.getSource().type;U==="geojson"&&B?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||B?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),T.setFeatureState(B,a.id,d)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const _=a.source,B=this.sourceCaches[_];if(B===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const T=B.getSource().type,U=T==="vector"?a.sourceLayer:void 0;T!=="vector"||U?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):B.removeFeatureState(U,a.id,d):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,_=a.sourceLayer,B=this.sourceCaches[d];if(B!==void 0)return B.getSource().type!=="vector"||_?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),B.getFeatureState(_,a.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=s.aE(this.sourceCaches,T=>T.serialize()),d=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,B=this.stylesheet;return s.aF({version:B.version,name:B.name,metadata:B.metadata,light:B.light,center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch,sprite:B.sprite,glyphs:B.glyphs,transition:B.transition,sources:a,layers:d,terrain:_},T=>T!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=U=>this._layers[U].type==="fill-extrusion",_={},B=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H)){_[H]=U;for(const q of a){const w=q[H];if(w)for(const I of w)B.push(I)}}}B.sort((U,H)=>H.intersectionZ-U.intersectionZ);const T=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H))for(let q=B.length-1;q>=0;q--){const w=B[q].feature;if(_[w.layer.id]<U)break;T.push(w),B.pop()}else for(const q of a){const w=q[H];if(w)for(const I of w)T.push(I.feature)}}return T}queryRenderedFeatures(a,d,_){d&&d.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const B={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const H of d.layers){const q=this._layers[H];if(!q)return this.fire(new s.j(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];B[q.source]=!0}}const T=[];d.availableImages=this._availableImages;const U=this._serializedAllLayers();for(const H in this.sourceCaches)d.layers&&!B[H]||T.push(mi(this.sourceCaches[H],this._layers,U,a,d,_));return this.placement&&T.push(function(H,q,w,I,k,j,Y){const X={},ee=j.queryRenderedSymbols(I),re=[];for(const le of Object.keys(ee).map(Number))re.push(Y[le]);re.sort(yi);for(const le of re){const pe=le.featureIndex.lookupSymbolFeatures(ee[le.bucketInstanceId],q,le.bucketIndex,le.sourceLayerIndex,k.filter,k.layers,k.availableImages,H);for(const ge in pe){const we=X[ge]=X[ge]||[],De=pe[ge];De.sort((Me,st)=>{const We=le.featureSortOrder;if(We){const ke=We.indexOf(Me.featureIndex);return We.indexOf(st.featureIndex)-ke}return st.featureIndex-Me.featureIndex});for(const Me of De)we.push(Me)}}for(const le in X)X[le].forEach(pe=>{const ge=pe.feature,we=w[H[le].source].getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=we});return X}(this._layers,U,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(a,d){d&&d.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[a];return _?function(B,T){const U=B.getRenderableIds().map(w=>B.getTileByID(w)),H=[],q={};for(let w=0;w<U.length;w++){const I=U[w],k=I.tileID.canonical.key;q[k]||(q[k]=!0,I.querySourceFeatures(H,T))}return H}(_,d):[]}getLight(){return this.light.getLight()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const _=this.light.getLight();let B=!1;for(const U in a)if(!s.aD(a[U],_[U])){B=!0;break}if(!B)return;const T={now:F.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(T)}_validate(a,d,_,B){let T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!T||T.validate!==!1)&&fr(this,a.call(s.x,s.e({key:d,style:this.serialize(),value:_,styleSpec:s.v},B)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),zt().off("pluginStateChange",this._rtlTextPluginStateChange);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const _=this.sourceCaches[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,_,B){let T=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,U=!1,H=!1;const q={};for(const w of this._order){const I=this._layers[w];if(I.type!=="symbol")continue;if(!q[I.source]){const j=this.sourceCaches[I.source];q[I.source]=j.getRenderableIds(!0).map(Y=>j.getTileByID(Y)).sort((Y,X)=>X.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(X.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(I,q[I.source],a.center.lng);U=U||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),a.zoom))&&(this.pauseablePlacement=new wn(a,this.map.terrain,this._order,T,d,_,B,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),H=!0),U&&this.pauseablePlacement.placement.setStale()),H||U)for(const w of this._order){const I=this._layers[w];I.type==="symbol"&&this.placement.updateLayerOpacities(I,q[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,d.icons),_})}getGlyphs(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(s.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const T=[{id:a,url:d}],U=[...Re(this.stylesheet.sprite),...T];this._validate(s.x.sprite,"sprite",U,null,_)||(this.stylesheet.sprite=U,this._loadSprite(T,!0,B))}removeSprite(a){this._checkLoaded();const d=Re(this.stylesheet.sprite);if(d.find(_=>_.id===a)){if(this._spritesImagesIds[a])for(const _ of this._spritesImagesIds[a])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex(_=>_.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return Re(this.stylesheet.sprite)}setSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(s.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,_):(this._unloadSprite(),_&&_(null)))}}var Ur=s.X([{name:"a_pos",type:"Int16",components:2}]),Sn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const dn={prelude:Gr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Gr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Gr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Gr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Gr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Gr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Gr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Gr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Gr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Gr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Gr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Sn),terrainDepth:Gr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Sn),terrainCoords:Gr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Sn)};function Gr(y,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute ([\w]+) ([\w]+)/g),B=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),U=T?T.concat(B):B,H={};return{fragmentSource:y=y.replace(d,(q,w,I,k,j)=>(H[j]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${I} ${k} ${j};
#else
uniform ${I} ${k} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${I} ${k} ${j} = u_${j};
#endif
`)),vertexSource:a=a.replace(d,(q,w,I,k,j)=>{const Y=k==="float"?"vec2":"vec4",X=j.match(/color/)?"color":Y;return H[j]?w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${I} ${Y} a_${j};
varying ${I} ${k} ${j};
#else
uniform ${I} ${k} u_${j};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${I} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${X}(a_${j}, u_${j}_t);
#else
    ${I} ${k} ${j} = u_${j};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${I} ${Y} a_${j};
#else
uniform ${I} ${k} u_${j};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${I} ${k} ${j} = a_${j};
#else
    ${I} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${I} ${k} ${j} = unpack_mix_${X}(a_${j}, u_${j}_t);
#else
    ${I} ${k} ${j} = u_${j};
#endif
`}),staticAttributes:_,staticUniforms:U}}class js{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,_,B,T,U,H,q,w){this.context=a;let I=this.boundPaintVertexBuffers.length!==B.length;for(let k=0;!I&&k<B.length;k++)this.boundPaintVertexBuffers[k]!==B[k]&&(I=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||I||this.boundIndexBuffer!==T||this.boundVertexOffset!==U||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==q||this.boundDynamicVertexBuffer3!==w?this.freshBind(d,_,B,T,U,H,q,w):(a.bindVertexArray.set(this.vao),H&&H.bind(),T&&T.dynamicDraw&&T.bind(),q&&q.bind(),w&&w.bind())}freshBind(a,d,_,B,T,U,H,q){const w=a.numAttributes,I=this.context,k=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=B,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=U,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=q,d.enableAttributes(k,a);for(const j of _)j.enableAttributes(k,a);U&&U.enableAttributes(k,a),H&&H.enableAttributes(k,a),q&&q.enableAttributes(k,a),d.bind(),d.setVertexAttribPointers(k,a,T);for(const j of _)j.bind(),j.setVertexAttribPointers(k,a,T);U&&(U.bind(),U.setVertexAttribPointers(k,a,T)),B&&B.bind(),H&&(H.bind(),H.setVertexAttribPointers(k,a,T)),q&&(q.bind(),q.setVertexAttribPointers(k,a,T)),I.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ha(y){const a=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const _=y[d].split(" ");a.push(_.pop())}return a}class ho{constructor(a,d,_,B,T,U){const H=a.gl;this.program=H.createProgram();const q=ha(d.staticAttributes),w=_?_.getBinderAttributes():[],I=q.concat(w),k=dn.prelude.staticUniforms?ha(dn.prelude.staticUniforms):[],j=d.staticUniforms?ha(d.staticUniforms):[],Y=_?_.getBinderUniforms():[],X=k.concat(j).concat(Y),ee=[];for(const Me of X)ee.indexOf(Me)<0&&ee.push(Me);const re=_?_.defines():[];T&&re.push("#define OVERDRAW_INSPECTOR;"),U&&re.push("#define TERRAIN3D;");const le=re.concat(dn.prelude.fragmentSource,d.fragmentSource).join(`
`),pe=re.concat(dn.prelude.vertexSource,d.vertexSource).join(`
`),ge=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(ge,le),H.compileShader(ge),!H.getShaderParameter(ge,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(ge)}`);H.attachShader(this.program,ge);const we=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(we,pe),H.compileShader(we),!H.getShaderParameter(we,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(we)}`);H.attachShader(this.program,we),this.attributes={};const De={};this.numAttributes=I.length;for(let Me=0;Me<this.numAttributes;Me++)I[Me]&&(H.bindAttribLocation(this.program,Me,I[Me]),this.attributes[I[Me]]=Me);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(we),H.deleteShader(ge);for(let Me=0;Me<ee.length;Me++){const st=ee[Me];if(st&&!De[st]){const We=H.getUniformLocation(this.program,st);We&&(De[st]=We)}}this.fixedUniforms=B(a,De),this.terrainUniforms=((Me,st)=>({u_depth:new s.aG(Me,st.u_depth),u_terrain:new s.aG(Me,st.u_terrain),u_terrain_dim:new s.aH(Me,st.u_terrain_dim),u_terrain_matrix:new s.aI(Me,st.u_terrain_matrix),u_terrain_unpack:new s.aJ(Me,st.u_terrain_unpack),u_terrain_exaggeration:new s.aH(Me,st.u_terrain_exaggeration)}))(a,De),this.binderUniforms=_?_.getUniforms(a,De):[]}draw(a,d,_,B,T,U,H,q,w,I,k,j,Y,X,ee,re,le,pe){const ge=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(B),a.setColorMode(T),a.setCullFace(U),q){a.activeTexture.set(ge.TEXTURE2),ge.bindTexture(ge.TEXTURE_2D,q.depthTexture),a.activeTexture.set(ge.TEXTURE3),ge.bindTexture(ge.TEXTURE_2D,q.texture);for(const De in this.terrainUniforms)this.terrainUniforms[De].set(q[De])}for(const De in this.fixedUniforms)this.fixedUniforms[De].set(H[De]);ee&&ee.setUniforms(a,this.binderUniforms,Y,{zoom:X});let we=0;switch(d){case ge.LINES:we=2;break;case ge.TRIANGLES:we=3;break;case ge.LINE_STRIP:we=1}for(const De of j.get()){const Me=De.vaos||(De.vaos={});(Me[w]||(Me[w]=new js)).bind(a,this,I,ee?ee.getPaintVertexBuffers():[],k,De.vertexOffset,re,le,pe),ge.drawElements(d,De.primitiveLength*we,ge.UNSIGNED_SHORT,De.primitiveOffset*we*2)}}}function Ta(y,a,d){const _=1/$t(d,1,a.transform.tileZoom),B=Math.pow(2,d.tileID.overscaledZ),T=d.tileSize*Math.pow(2,a.transform.tileZoom)/B,U=T*(d.tileID.canonical.x+d.tileID.wrap*B),H=T*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[U>>16,H>>16],u_pixel_coord_lower:[65535&U,65535&H]}}const ze=(y,a,d,_)=>{const B=a.style.light,T=B.properties.get("position"),U=[T.x,T.y,T.z],H=function(){var w=new s.A(9);return s.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}();B.properties.get("anchor")==="viewport"&&function(w,I){var k=Math.sin(I),j=Math.cos(I);w[0]=j,w[1]=k,w[2]=0,w[3]=-k,w[4]=j,w[5]=0,w[6]=0,w[7]=0,w[8]=1}(H,-a.transform.angle),function(w,I,k){var j=I[0],Y=I[1],X=I[2];w[0]=j*k[0]+Y*k[3]+X*k[6],w[1]=j*k[1]+Y*k[4]+X*k[7],w[2]=j*k[2]+Y*k[5]+X*k[8]}(U,U,H);const q=B.properties.get("color");return{u_matrix:y,u_lightpos:U,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+d,u_opacity:_}},Ye=(y,a,d,_,B,T,U)=>s.e(ze(y,a,d,_),Ta(T,a,U),{u_height_factor:-Math.pow(2,B.overscaledZ)/U.tileSize/8}),ft=y=>({u_matrix:y}),Ut=(y,a,d,_)=>s.e(ft(y),Ta(d,a,_)),hi=(y,a)=>({u_matrix:y,u_world:a}),ji=(y,a,d,_,B)=>s.e(Ut(y,a,d,_),{u_world:B}),xr=(y,a,d,_)=>{const B=y.transform;let T,U;if(_.paint.get("circle-pitch-alignment")==="map"){const H=$t(d,1,B.zoom);T=!0,U=[H,H]}else T=!1,U=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(a.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:U}},Tn=(y,a,d)=>{const _=$t(d,1,a.zoom),B=Math.pow(2,a.zoom-d.tileID.overscaledZ),T=d.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[a.pixelsToGLUnits[0]/(_*B),a.pixelsToGLUnits[1]/(_*B)],u_overscale_factor:T}},Un=function(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:d}},ns=y=>({u_matrix:y}),Bn=(y,a,d,_)=>({u_matrix:y,u_extrude_scale:$t(a,1,d),u_intensity:_});function lu(y,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new s.Y(0,_/d).toLngLat().lat,new s.Y(0,(_+1)/d).toLngLat().lat]}const Ka=(y,a,d,_)=>{const B=y.transform;return{u_matrix:Io(y,a,d,_),u_ratio:1/$t(a,1,B.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Ir=(y,a,d,_,B)=>s.e(Ka(y,a,d,B),{u_image:0,u_image_height:_}),Wa=(y,a,d,_,B)=>{const T=y.transform,U=es(a,T);return{u_matrix:Io(y,a,d,B),u_texsize:a.imageAtlasTexture.size,u_ratio:1/$t(a,1,T.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[U,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Nl=(y,a,d,_,B,T)=>{const U=y.lineAtlas,H=es(a,y.transform),q=d.layout.get("line-cap")==="round",w=U.getDash(_.from,q),I=U.getDash(_.to,q),k=w.width*B.fromScale,j=I.width*B.toScale;return s.e(Ka(y,a,d,T),{u_patternscale_a:[H/k,-w.height/2],u_patternscale_b:[H/j,-I.height/2],u_sdfgamma:U.width/(256*Math.min(k,j)*y.pixelRatio)/2,u_image:0,u_tex_y_a:w.y,u_tex_y_b:I.y,u_mix:B.t})};function es(y,a){return 1/$t(y,1,a.tileZoom)}function Io(y,a,d,_){return y.translatePosMatrix(_?_.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Xa=(y,a,d,_,B)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(U=B.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(T=B.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:ys(B.paint.get("raster-hue-rotate"))};var T,U};function ys(y){y*=Math.PI/180;const a=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const Aa=(y,a,d,_,B,T,U,H,q,w)=>{const I=B.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:I.cameraToCenterDistance,u_pitch:I.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:I.width/I.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:U,u_coord_matrix:H,u_is_text:+q,u_pitch_with_map:+_,u_texsize:w,u_texture:0}},Za=(y,a,d,_,B,T,U,H,q,w,I)=>{const k=B.transform;return s.e(Aa(y,a,d,_,B,T,U,H,q,w),{u_gamma_scale:_?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:B.pixelRatio,u_is_halo:+I})},Ia=(y,a,d,_,B,T,U,H,q,w)=>s.e(Za(y,a,d,_,B,T,U,H,!0,q,!0),{u_texsize_icon:w,u_texture_icon:1}),Dc=(y,a,d)=>({u_matrix:y,u_opacity:a,u_color:d}),Ja=(y,a,d,_,B,T)=>s.e(function(U,H,q,w){const I=q.imageManager.getPattern(U.from.toString()),k=q.imageManager.getPattern(U.to.toString()),{width:j,height:Y}=q.imageManager.getPixelSize(),X=Math.pow(2,w.tileID.overscaledZ),ee=w.tileSize*Math.pow(2,q.transform.tileZoom)/X,re=ee*(w.tileID.canonical.x+w.tileID.wrap*X),le=ee*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[j,Y],u_mix:H.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/$t(w,1,q.transform.tileZoom),u_pixel_coord_upper:[re>>16,le>>16],u_pixel_coord_lower:[65535&re,65535&le]}}(_,T,d,B),{u_matrix:y,u_opacity:a}),Ao={fillExtrusion:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_opacity:new s.aH(y,a.u_opacity)}),fillExtrusionPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_height_factor:new s.aH(y,a.u_height_factor),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade),u_opacity:new s.aH(y,a.u_opacity)}),fill:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),fillPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),fillOutline:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world)}),fillOutlinePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),circle:(y,a)=>({u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_scale_with_map:new s.aG(y,a.u_scale_with_map),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_matrix:new s.aI(y,a.u_matrix)}),collisionBox:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(y,a.u_pixels_to_tile_units),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_overscale_factor:new s.aH(y,a.u_overscale_factor)}),collisionCircle:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_inv_matrix:new s.aI(y,a.u_inv_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_viewport_size:new s.aL(y,a.u_viewport_size)}),debug:(y,a)=>({u_color:new s.aM(y,a.u_color),u_matrix:new s.aI(y,a.u_matrix),u_overlay:new s.aG(y,a.u_overlay),u_overlay_scale:new s.aH(y,a.u_overlay_scale)}),clippingMask:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),heatmap:(y,a)=>({u_extrude_scale:new s.aH(y,a.u_extrude_scale),u_intensity:new s.aH(y,a.u_intensity),u_matrix:new s.aI(y,a.u_matrix)}),heatmapTexture:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_color_ramp:new s.aG(y,a.u_color_ramp),u_opacity:new s.aH(y,a.u_opacity)}),hillshade:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_latrange:new s.aL(y,a.u_latrange),u_light:new s.aL(y,a.u_light),u_shadow:new s.aM(y,a.u_shadow),u_highlight:new s.aM(y,a.u_highlight),u_accent:new s.aM(y,a.u_accent)}),hillshadePrepare:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_dimension:new s.aL(y,a.u_dimension),u_zoom:new s.aH(y,a.u_zoom),u_unpack:new s.aJ(y,a.u_unpack)}),line:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels)}),lineGradient:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_image:new s.aG(y,a.u_image),u_image_height:new s.aH(y,a.u_image_height)}),linePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texsize:new s.aL(y,a.u_texsize),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_image:new s.aG(y,a.u_image),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),lineSDF:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_patternscale_a:new s.aL(y,a.u_patternscale_a),u_patternscale_b:new s.aL(y,a.u_patternscale_b),u_sdfgamma:new s.aH(y,a.u_sdfgamma),u_image:new s.aG(y,a.u_image),u_tex_y_a:new s.aH(y,a.u_tex_y_a),u_tex_y_b:new s.aH(y,a.u_tex_y_b),u_mix:new s.aH(y,a.u_mix)}),raster:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_tl_parent:new s.aL(y,a.u_tl_parent),u_scale_parent:new s.aH(y,a.u_scale_parent),u_buffer_scale:new s.aH(y,a.u_buffer_scale),u_fade_t:new s.aH(y,a.u_fade_t),u_opacity:new s.aH(y,a.u_opacity),u_image0:new s.aG(y,a.u_image0),u_image1:new s.aG(y,a.u_image1),u_brightness_low:new s.aH(y,a.u_brightness_low),u_brightness_high:new s.aH(y,a.u_brightness_high),u_saturation_factor:new s.aH(y,a.u_saturation_factor),u_contrast_factor:new s.aH(y,a.u_contrast_factor),u_spin_weights:new s.aK(y,a.u_spin_weights)}),symbolIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture)}),symbolSDF:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),symbolTextAndIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texsize_icon:new s.aL(y,a.u_texsize_icon),u_texture:new s.aG(y,a.u_texture),u_texture_icon:new s.aG(y,a.u_texture_icon),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),background:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_color:new s.aM(y,a.u_color)}),backgroundPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_image:new s.aG(y,a.u_image),u_pattern_tl_a:new s.aL(y,a.u_pattern_tl_a),u_pattern_br_a:new s.aL(y,a.u_pattern_br_a),u_pattern_tl_b:new s.aL(y,a.u_pattern_tl_b),u_pattern_br_b:new s.aL(y,a.u_pattern_br_b),u_texsize:new s.aL(y,a.u_texsize),u_mix:new s.aH(y,a.u_mix),u_pattern_size_a:new s.aL(y,a.u_pattern_size_a),u_pattern_size_b:new s.aL(y,a.u_pattern_size_b),u_scale_a:new s.aH(y,a.u_scale_a),u_scale_b:new s.aH(y,a.u_scale_b),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(y,a.u_tile_units_to_pixels)}),terrain:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainDepth:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainCoords:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_terrain_coords_id:new s.aH(y,a.u_terrain_coords_id),u_ele_delta:new s.aH(y,a.u_ele_delta)})};class Fr{constructor(a,d,_){this.context=a;const B=a.gl;this.buffer=B.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const da={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class As{constructor(a,d,_,B){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=B,this.context=a;const T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const B=d.attributes[this.attributes[_].name];B!==void 0&&a.enableVertexAttribArray(B)}}setVertexAttribPointers(a,d,_){for(let B=0;B<this.attributes.length;B++){const T=this.attributes[B],U=d.attributes[T.name];U!==void 0&&a.vertexAttribPointer(U,T.components,a[da[T.type]],!1,this.itemSize,T.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fn=new WeakMap;function ss(y){var a;if(fn.has(y))return fn.get(y);{const d=(a=y.getParameter(y.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return fn.set(y,d),d}}class Hr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ya extends Hr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ul extends Hr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class zl extends Hr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Lo extends Hr{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Xo extends Hr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class fc extends Hr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Zo extends Hr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class fo extends Hr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class pc extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Jo extends Hr{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Ql extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class Rc extends Hr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class bh extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class cu extends Hr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class uu extends Hr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ku extends Hr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Vl extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class el extends Hr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class tl extends Hr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Hl extends Hr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class il extends Hr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class fa extends Hr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class hl extends Hr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Gl extends Hr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class to extends Hr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class pa extends Hr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class se extends Hr{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Le extends Hr{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const _=this.gl;ss(_)?_.bindVertexArray(a):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class ct extends Hr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class yt extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class bt extends Hr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class It extends Hr{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class gi extends It{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ni extends It{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class nr extends It{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class $i{constructor(a,d,_,B,T){this.context=a,this.width=d,this.height=_;const U=a.gl,H=this.framebuffer=U.createFramebuffer();if(this.colorAttachment=new gi(a,H),B)this.depthAttachment=T?new nr(a,H):new ni(a,H);else if(T)throw new Error("Stencil cannot be set without depth");if(U.checkFramebufferStatus(U.FRAMEBUFFER)!==U.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class Oi{constructor(a,d,_){this.blendFunction=a,this.blendColor=d,this.mask=_}}Oi.Replace=[1,0],Oi.disabled=new Oi(Oi.Replace,s.aO.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,s.aO.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,771],s.aO.transparent,[!0,!0,!0,!0]);class qr{constructor(a){var d,_;if(this.gl=a,this.clearColor=new Ya(this),this.clearDepth=new ul(this),this.clearStencil=new zl(this),this.colorMask=new Lo(this),this.depthMask=new Xo(this),this.stencilMask=new fc(this),this.stencilFunc=new Zo(this),this.stencilOp=new fo(this),this.stencilTest=new pc(this),this.depthRange=new Jo(this),this.depthTest=new Ql(this),this.depthFunc=new Rc(this),this.blend=new bh(this),this.blendFunc=new cu(this),this.blendColor=new uu(this),this.blendEquation=new ku(this),this.cullFace=new Vl(this),this.cullFaceSide=new el(this),this.frontFace=new tl(this),this.program=new Hl(this),this.activeTexture=new il(this),this.viewport=new fa(this),this.bindFramebuffer=new hl(this),this.bindRenderbuffer=new Gl(this),this.bindTexture=new to(this),this.bindVertexBuffer=new pa(this),this.bindElementBuffer=new se(this),this.bindVertexArray=new Le(this),this.pixelStoreUnpack=new ct(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),ss(a)){this.HALF_FLOAT=a.HALF_FLOAT;const B=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:B==null?void 0:B.RGBA16F_EXT,this.RGB16F=(_=a.RGB16F)!==null&&_!==void 0?_:B==null?void 0:B.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const B=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=B==null?void 0:B.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Fr(this,a,d)}createVertexBuffer(a,d,_){return new As(this,a,d,_)}createRenderbuffer(a,d,_){const B=this.gl,T=B.createRenderbuffer();return this.bindRenderbuffer.set(T),B.renderbufferStorage(B.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),T}createFramebuffer(a,d,_,B){return new $i(this,a,d,_,B)}clear(a){let{color:d,depth:_,stencil:B}=a;const T=this.gl;let U=0;d&&(U|=T.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(U|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),B!==void 0&&(U|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),T.clear(U)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.aD(a.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return ss(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return ss(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class sr{constructor(a,d,_){this.func=a,this.mask=d,this.range=_}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const jn=7680;class Cr{constructor(a,d,_,B,T,U){this.test=a,this.ref=d,this.mask=_,this.fail=B,this.depthFail=T,this.pass=U}}Cr.disabled=new Cr({func:519,mask:0},0,0,jn,jn,jn);class Mr{constructor(a,d,_){this.enable=a,this.mode=d,this.frontFace=_}}let Nn;function Ks(y,a,d,_,B,T,U){const H=y.context,q=H.gl,w=y.useProgram("collisionBox"),I=[];let k=0,j=0;for(let ge=0;ge<_.length;ge++){const we=_[ge],De=a.getTile(we),Me=De.getBucket(d);if(!Me)continue;let st=we.posMatrix;B[0]===0&&B[1]===0||(st=y.translatePosMatrix(we.posMatrix,De,B,T));const We=U?Me.textCollisionBox:Me.iconCollisionBox,ke=Me.collisionCircleArray;if(ke.length>0){const Ve=s.F(),gt=st;s.aP(Ve,Me.placementInvProjMatrix,y.transform.glCoordMatrix),s.aP(Ve,Ve,Me.placementViewportMatrix),I.push({circleArray:ke,circleOffset:j,transform:gt,invTransform:Ve,coord:we}),k+=ke.length/4,j=k}We&&w.draw(H,q.LINES,sr.disabled,Cr.disabled,y.colorModeForRenderPass(),Mr.disabled,Tn(st,y.transform,De),y.style.map.terrain&&y.style.map.terrain.getTerrainData(we),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,y.transform.zoom,null,null,We.collisionVertexBuffer)}if(!U||!I.length)return;const Y=y.useProgram("collisionCircle"),X=new s.aQ;X.resize(4*k),X._trim();let ee=0;for(const ge of I)for(let we=0;we<ge.circleArray.length/4;we++){const De=4*we,Me=ge.circleArray[De+0],st=ge.circleArray[De+1],We=ge.circleArray[De+2],ke=ge.circleArray[De+3];X.emplace(ee++,Me,st,We,ke,0),X.emplace(ee++,Me,st,We,ke,1),X.emplace(ee++,Me,st,We,ke,2),X.emplace(ee++,Me,st,We,ke,3)}(!Nn||Nn.length<2*k)&&(Nn=function(ge){const we=2*ge,De=new s.aS;De.resize(we),De._trim();for(let Me=0;Me<we;Me++){const st=6*Me;De.uint16[st+0]=4*Me+0,De.uint16[st+1]=4*Me+1,De.uint16[st+2]=4*Me+2,De.uint16[st+3]=4*Me+2,De.uint16[st+4]=4*Me+3,De.uint16[st+5]=4*Me+0}return De}(k));const re=H.createIndexBuffer(Nn,!0),le=H.createVertexBuffer(X,s.aR.members,!0);for(const ge of I){const we={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(pe=y.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};Y.draw(H,q.TRIANGLES,sr.disabled,Cr.disabled,y.colorModeForRenderPass(),Mr.disabled,we,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ge.coord),d.id,le,re,s.$.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,y.transform.zoom,null,null,null)}var pe;le.destroy(),re.destroy()}Mr.disabled=new Mr(!1,1029,2305),Mr.backCCW=new Mr(!0,1029,2305);const io=s.an(new Float32Array(16));function Mo(y,a,d,_,B,T){const{horizontalAlign:U,verticalAlign:H}=s.at(y);return new s.P((-(U-.5)*a/B+_[0])*T,(-(H-.5)*d/B+_[1])*T)}function La(y,a,d,_,B,T,U,H,q,w,I){const k=y.text.placedSymbolArray,j=y.text.dynamicLayoutVertexArray,Y=y.icon.dynamicLayoutVertexArray,X={};j.clear();for(let ee=0;ee<k.length;ee++){const re=k.get(ee),le=re.hidden||!re.crossTileID||y.allowVerticalPlacement&&!re.placedOrientation?null:_[re.crossTileID];if(le){const pe=new s.P(re.anchorX,re.anchorY),ge=Tr(pe,d?U:T,I),we=Qe(B.cameraToCenterDistance,ge.signedDistanceFromCamera);let De=s.ai(y.textSizeData,q,re)*we/s.ao;d&&(De*=y.tilePixelRatio/H);const{width:Me,height:st,anchor:We,textOffset:ke,textBoxScale:Ve}=le,gt=Mo(We,Me,st,ke,Ve,De),xt=d?Tr(pe.add(gt),T,I).point:ge.point.add(a?gt.rotate(-B.angle):gt),At=y.allowVerticalPlacement&&re.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let kt=0;kt<re.numGlyphs;kt++)s.aj(j,xt,At);w&&re.associatedIconIndex>=0&&(X[re.associatedIconIndex]={shiftedAnchor:xt,angle:At})}else nt(re.numGlyphs,j)}if(w){Y.clear();const ee=y.icon.placedSymbolArray;for(let re=0;re<ee.length;re++){const le=ee.get(re);if(le.hidden)nt(le.numGlyphs,Y);else{const pe=X[re];if(pe)for(let ge=0;ge<le.numGlyphs;ge++)s.aj(Y,pe.shiftedAnchor,pe.angle);else nt(le.numGlyphs,Y)}}y.icon.dynamicLayoutVertexBuffer.updateData(Y)}y.text.dynamicLayoutVertexBuffer.updateData(j)}function ga(y,a,d){return d.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function jl(y,a,d,_,B,T,U,H,q,w,I,k){const j=y.context,Y=j.gl,X=y.transform,ee=H==="map",re=q==="map",le=H!=="viewport"&&d.layout.get("symbol-placement")!=="point",pe=ee&&!re&&!le,ge=!d.layout.get("symbol-sort-key").isConstant();let we=!1;const De=y.depthModeForSublayer(0,sr.ReadOnly),Me=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),st=[];for(const We of _){const ke=a.getTile(We),Ve=ke.getBucket(d);if(!Ve)continue;const gt=B?Ve.text:Ve.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const xt=gt.programConfigurations.get(d.id),At=B||Ve.sdfIcons,kt=B?Ve.textSizeData:Ve.iconSizeData,Rt=re||X.pitch!==0,Ai=y.useProgram(ga(At,B,Ve),xt),Ht=s.ag(kt,X.zoom),vi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(We);let Ti,er,Ii,_r,pr=[0,0],qi=null;if(B)er=ke.glyphAtlasTexture,Ii=Y.LINEAR,Ti=ke.glyphAtlasTexture.size,Ve.iconsInText&&(pr=ke.imageAtlasTexture.size,qi=ke.imageAtlasTexture,_r=Rt||y.options.rotating||y.options.zooming||kt.kind==="composite"||kt.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const $r=d.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;er=ke.imageAtlasTexture,Ii=At||y.options.rotating||y.options.zooming||$r||Rt?Y.LINEAR:Y.NEAREST,Ti=ke.imageAtlasTexture.size}const Nr=$t(ke,1,y.transform.zoom),nn=Yt(We.posMatrix,re,ee,y.transform,Nr),Pr=yr(We.posMatrix,re,ee,y.transform,Nr),Wr=Me&&Ve.hasTextData(),Er=d.layout.get("icon-text-fit")!=="none"&&Wr&&Ve.hasIconData();if(le){const $r=y.style.map.terrain?(Fn,Wn)=>y.style.map.terrain.getElevation(We,Fn,Wn):null,Xr=d.layout.get("text-rotation-alignment")==="map";ae(Ve,We.posMatrix,y,B,nn,Pr,re,w,Xr,$r)}const is=y.translatePosMatrix(We.posMatrix,ke,T,U),zr=le||B&&Me||Er?io:nn,gr=y.translatePosMatrix(Pr,ke,T,U,!0),vr=At&&d.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ar;ar=At?Ve.iconsInText?Ia(kt.kind,Ht,pe,re,y,is,zr,gr,Ti,pr):Za(kt.kind,Ht,pe,re,y,is,zr,gr,B,Ti,!0):Aa(kt.kind,Ht,pe,re,y,is,zr,gr,B,Ti);const cn={program:Ai,buffers:gt,uniformValues:ar,atlasTexture:er,atlasTextureIcon:qi,atlasInterpolation:Ii,atlasInterpolationIcon:_r,isSDF:At,hasHalo:vr};if(ge&&Ve.canOverlap){we=!0;const $r=gt.segments.get();for(const Xr of $r)st.push({segments:new s.$([Xr]),sortKey:Xr.sortKey,state:cn,terrainData:vi})}else st.push({segments:gt.segments,sortKey:0,state:cn,terrainData:vi})}we&&st.sort((We,ke)=>We.sortKey-ke.sortKey);for(const We of st){const ke=We.state;if(j.activeTexture.set(Y.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,Y.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(j.activeTexture.set(Y.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),ke.isSDF){const Ve=ke.uniformValues;ke.hasHalo&&(Ve.u_is_halo=1,Al(ke.buffers,We.segments,d,y,ke.program,De,I,k,Ve,We.terrainData)),Ve.u_is_halo=0}Al(ke.buffers,We.segments,d,y,ke.program,De,I,k,ke.uniformValues,We.terrainData)}}function Al(y,a,d,_,B,T,U,H,q,w){const I=_.context;B.draw(I,I.gl.TRIANGLES,T,U,H,Mr.disabled,q,w,d.id,y.layoutVertexBuffer,y.indexBuffer,a,d.paint,_.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ql(y,a,d,_,B){if(!d||!_||!_.imageAtlas)return;const T=_.imageAtlas.patternPositions;let U=T[d.to.toString()],H=T[d.from.toString()];if(!U&&H&&(U=H),!H&&U&&(H=U),!U||!H){const q=B.getPaintProperty(a);U=T[q],H=T[q]}U&&H&&y.setConstantPatternPositions(U,H)}function gc(y,a,d,_,B,T,U){const H=y.context.gl,q="fill-pattern",w=d.paint.get(q),I=w&&w.constantOr(1),k=d.getCrossfadeParameters();let j,Y,X,ee,re;U?(Y=I&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=H.LINES):(Y=I?"fillPattern":"fill",j=H.TRIANGLES);const le=w.constantOr(null);for(const pe of _){const ge=a.getTile(pe);if(I&&!ge.patternsLoaded())continue;const we=ge.getBucket(d);if(!we)continue;const De=we.programConfigurations.get(d.id),Me=y.useProgram(Y,De),st=y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe);I&&(y.context.activeTexture.set(H.TEXTURE0),ge.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),De.updatePaintBuffers(k)),ql(De,q,le,ge,d);const We=st?pe:null,ke=y.translatePosMatrix(We?We.posMatrix:pe.posMatrix,ge,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(U){ee=we.indexBuffer2,re=we.segments2;const Ve=[H.drawingBufferWidth,H.drawingBufferHeight];X=Y==="fillOutlinePattern"&&I?ji(ke,y,k,ge,Ve):hi(ke,Ve)}else ee=we.indexBuffer,re=we.segments,X=I?Ut(ke,y,k,ge):ft(ke);Me.draw(y.context,j,B,y.stencilModeForClipping(pe),T,Mr.disabled,X,st,d.id,we.layoutVertexBuffer,ee,re,d.paint,y.transform.zoom,De)}}function ma(y,a,d,_,B,T,U){const H=y.context,q=H.gl,w="fill-extrusion-pattern",I=d.paint.get(w),k=I.constantOr(1),j=d.getCrossfadeParameters(),Y=d.paint.get("fill-extrusion-opacity"),X=I.constantOr(null);for(const ee of _){const re=a.getTile(ee),le=re.getBucket(d);if(!le)continue;const pe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ee),ge=le.programConfigurations.get(d.id),we=y.useProgram(k?"fillExtrusionPattern":"fillExtrusion",ge);k&&(y.context.activeTexture.set(q.TEXTURE0),re.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ge.updatePaintBuffers(j)),ql(ge,w,X,re,d);const De=y.translatePosMatrix(ee.posMatrix,re,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Me=d.paint.get("fill-extrusion-vertical-gradient"),st=k?Ye(De,y,Me,Y,ee,j,re):ze(De,y,Me,Y);we.draw(H,H.gl.TRIANGLES,B,T,U,Mr.backCCW,st,pe,d.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,d.paint,y.transform.zoom,ge,y.style.map.terrain&&le.centroidVertexBuffer)}}function Ds(y,a,d,_,B,T,U){const H=y.context,q=H.gl,w=d.fbo;if(!w)return;const I=y.useProgram("hillshade"),k=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,w.colorAttachment.get()),I.draw(H,q.TRIANGLES,B,T,U,Mr.disabled,((j,Y,X,ee)=>{const re=X.paint.get("hillshade-shadow-color"),le=X.paint.get("hillshade-highlight-color"),pe=X.paint.get("hillshade-accent-color");let ge=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=j.transform.angle);const we=!j.options.moving;return{u_matrix:ee?ee.posMatrix:j.transform.calculatePosMatrix(Y.tileID.toUnwrapped(),we),u_image:0,u_latrange:lu(0,Y.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ge],u_shadow:re,u_highlight:le,u_accent:pe}})(y,d,_,k?a:null),k,_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function dl(y,a,d,_,B,T){const U=y.context,H=U.gl,q=a.dem;if(q&&q.data){const w=q.dim,I=q.stride,k=q.getPixels();if(U.activeTexture.set(H.TEXTURE1),U.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(I),a.demTexture){const Y=a.demTexture;Y.update(k,{premultiply:!1}),Y.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else a.demTexture=new Pe(U,k,H.RGBA,{premultiply:!1}),a.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);U.activeTexture.set(H.TEXTURE0);let j=a.fbo;if(!j){const Y=new Pe(U,{width:w,height:w,data:null},H.RGBA);Y.bind(H.LINEAR,H.CLAMP_TO_EDGE),j=a.fbo=U.createFramebuffer(w,w,!0,!1),j.colorAttachment.set(Y.texture)}U.bindFramebuffer.set(j.framebuffer),U.viewport.set([0,0,w,w]),y.useProgram("hillshadePrepare").draw(U,H.TRIANGLES,_,B,T,Mr.disabled,((Y,X)=>{const ee=X.stride,re=s.F();return s.aN(re,0,s.W,-s.W,0,0,1),s.H(re,re,[0,-s.W,0]),{u_matrix:re,u_image:1,u_dimension:[ee,ee],u_zoom:Y.overscaledZ,u_unpack:X.getUnpackVector()}})(a.tileID,q),null,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function $l(y,a,d,_,B,T){const U=_.paint.get("raster-fade-duration");if(!T&&U>0){const H=F.now(),q=(H-y.timeAdded)/U,w=a?(H-a.timeAdded)/U:-1,I=d.getSource(),k=B.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),j=!a||Math.abs(a.tileID.overscaledZ-k)>Math.abs(y.tileID.overscaledZ-k),Y=j&&y.refreshedUponExpiration?1:s.ac(j?q:1-w,0,1);return y.refreshedUponExpiration&&q>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const Ma=new s.aO(1,0,0,1),Pa=new s.aO(0,1,0,1),Rs=new s.aO(0,0,1,1),Ou=new s.aO(1,0,1,1),In=new s.aO(0,1,1,1);function an(y,a,d,_){ts(y,0,a+d/2,y.transform.width,d,_)}function pn(y,a,d,_){ts(y,a-d/2,0,d,y.transform.height,_)}function ts(y,a,d,_,B,T){const U=y.context,H=U.gl;H.enable(H.SCISSOR_TEST),H.scissor(a*y.pixelRatio,d*y.pixelRatio,_*y.pixelRatio,B*y.pixelRatio),U.clear({color:T}),H.disable(H.SCISSOR_TEST)}function fl(y,a,d){const _=y.context,B=_.gl,T=d.posMatrix,U=y.useProgram("debug"),H=sr.disabled,q=Cr.disabled,w=y.colorModeForRenderPass(),I="$debug",k=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);_.activeTexture.set(B.TEXTURE0);const j=a.getTileByID(d.key).latestRawTileData,Y=Math.floor((j&&j.byteLength||0)/1024),X=a.getTile(d).tileSize,ee=512/Math.min(X,512)*(d.overscaledZ/y.transform.zoom)*.5;let re=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(re+=` => ${d.overscaledZ}`),function(le,pe){le.initDebugOverlayCanvas();const ge=le.debugOverlayCanvas,we=le.context.gl,De=le.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,ge.width,ge.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(pe,5,5),De.strokeText(pe,5,5),le.debugOverlayTexture.update(ge),le.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(y,`${re} ${Y}kB`),U.draw(_,B.TRIANGLES,H,q,Oi.alphaBlended,Mr.disabled,Un(T,s.aO.transparent,ee),null,I,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),U.draw(_,B.LINE_STRIP,H,q,w,Mr.disabled,Un(T,s.aO.red),k,I,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function pl(y,a,d){const _=y.context,B=_.gl,T=y.colorModeForRenderPass(),U=new sr(B.LEQUAL,sr.ReadWrite,y.depthRangeFor3D),H=y.useProgram("terrain"),q=a.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,y.width,y.height]);for(const w of d){const I=y.renderToTexture.getTexture(w),k=a.getTerrainData(w.tileID);_.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,I.texture);const j={u_matrix:y.transform.calculatePosMatrix(w.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(y.transform.zoom)};H.draw(_,B.TRIANGLES,U,Cr.disabled,T,Mr.backCCW,j,k,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}}class po{constructor(a,d){this.context=new qr(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.F(),renderTime:0},this.setup(),this.numSublayers=Ji.maxUnderzooming+Ji.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cs}resize(a,d,_){if(this.width=Math.floor(a*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style._order)this.style._layers[B].resize()}setup(){const a=this.context,d=new s.aV;d.emplaceBack(0,0),d.emplaceBack(s.W,0),d.emplaceBack(0,s.W),d.emplaceBack(s.W,s.W),this.tileExtentBuffer=a.createVertexBuffer(d,Ur.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const _=new s.aV;_.emplaceBack(0,0),_.emplaceBack(s.W,0),_.emplaceBack(0,s.W),_.emplaceBack(s.W,s.W),this.debugBuffer=a.createVertexBuffer(_,Ur.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const B=new s.Z;B.emplaceBack(0,0,0,0),B.emplaceBack(s.W,0,s.W,0),B.emplaceBack(0,s.W,0,s.W),B.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=a.createVertexBuffer(B,qt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const T=new s.aV;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(T,Ur.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const U=new s.aW;U.emplaceBack(0),U.emplaceBack(1),U.emplaceBack(3),U.emplaceBack(2),U.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(U);const H=new s.aX;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(H);const q=this.context.gl;this.stencilClearMode=new Cr({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.F();s.aN(_,0,this.width,this.height,0,0,1),s.J(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,sr.disabled,this.stencilClearMode,Oi.disabled,Mr.disabled,ns(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const _=this.context,B=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Oi.disabled),_.setDepthMode(sr.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of d){const H=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U);T.draw(_,B.TRIANGLES,sr.disabled,new Cr({func:B.ALWAYS,mask:0},H,255,B.KEEP,B.KEEP,B.REPLACE),Oi.disabled,Mr.disabled,ns(U.posMatrix),q,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Cr({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new Cr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((U,H)=>H.overscaledZ-U.overscaledZ),B=_[_.length-1].overscaledZ,T=_[0].overscaledZ-B+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const U={};for(let H=0;H<T;H++)U[H+B]=new Cr({func:d.GEQUAL,mask:255},H+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[U,_]}return[{[B]:Cr.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Oi([a.CONSTANT_COLOR,a.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oi.unblended:Oi.alphaBlended}depthModeForSublayer(a,d,_){if(!this.opaquePassEnabledForLayer())return sr.disabled;const B=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new sr(_||this.context.gl.LEQUAL,d,[B,B])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const _=this.style._order,B=this.style.sourceCaches,T={},U={},H={};for(const q in B){const w=B[q];w.used&&w.prepare(this.context),T[q]=w.getVisibleCoordinates(),U[q]=T[q].slice().reverse(),H[q]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<_.length;q++)if(this.style._layers[_[q]].is3D()){this.opaquePassCutoff=q;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const q=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||q.length)&&(s.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,I){const k=w.context,j=k.gl,Y=Oi.unblended,X=new sr(j.LEQUAL,sr.ReadWrite,[0,1]),ee=I.getTerrainMesh(),re=I.sourceCache.getRenderableTiles(),le=w.useProgram("terrainDepth");k.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),k.clear({color:s.aO.transparent,depth:1});for(const pe of re){const ge=I.getTerrainData(pe.tileID),we={u_matrix:w.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(w.transform.zoom)};le.draw(k,j.TRIANGLES,X,Cr.disabled,Y,Mr.backCCW,we,ge,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,I){const k=w.context,j=k.gl,Y=Oi.unblended,X=new sr(j.LEQUAL,sr.ReadWrite,[0,1]),ee=I.getTerrainMesh(),re=I.getCoordsTexture(),le=I.sourceCache.getRenderableTiles(),pe=w.useProgram("terrainCoords");k.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),k.clear({color:s.aO.transparent,depth:1}),I.coordsIndex=[];for(const ge of le){const we=I.getTerrainData(ge.tileID);k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,re.texture);const De={u_matrix:w.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(w.transform.zoom)};pe.draw(k,j.TRIANGLES,X,Cr.disabled,Y,Mr.backCCW,De,we,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),I.coordsIndex.push(ge.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const q of _){const w=this.style._layers[q];if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const I=U[w.source];(w.type==="custom"||I.length)&&this.renderLayer(this,B[w.source],w,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[_[this.currentLayer]],w=B[q.source],I=T[q.source];this._renderTileClippingMasks(q,I),this.renderLayer(this,w,q,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const q=this.style._layers[_[this.currentLayer]],w=B[q.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(q))continue;const I=(q.type==="symbol"?H:U)[q.source];this._renderTileClippingMasks(q,T[q.source]),this.renderLayer(this,w,q,I)}if(this.options.showTileBoundaries){const q=function(w,I){let k=null;const j=Object.values(w._layers).flatMap(re=>re.source&&!re.isHidden(I)?[w.sourceCaches[re.source]]:[]),Y=j.filter(re=>re.getSource().type==="vector"),X=j.filter(re=>re.getSource().type!=="vector"),ee=re=>{(!k||k.getSource().maxzoom<re.getSource().maxzoom)&&(k=re)};return Y.forEach(re=>ee(re)),k||X.forEach(re=>ee(re)),k}(this.style,this.transform.zoom);q&&function(w,I,k){for(let j=0;j<k.length;j++)fl(w,I,k[j])}(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const w=q.transform.padding;an(q,q.transform.height-(w.top||0),3,Ma),an(q,w.bottom||0,3,Pa),pn(q,w.left||0,3,Rs),pn(q,q.transform.width-(w.right||0),3,Ou);const I=q.transform.centerPoint;(function(k,j,Y,X){ts(k,j-1,Y-10,2,20,X),ts(k,j-10,Y-1,20,2,X)})(q,I.x,q.transform.height-I.y,In)}(this),this.context.setDefault()}renderLayer(a,d,_,B){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(B||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(T,U,H,q,w){if(T.renderPass!=="translucent")return;const I=Cr.disabled,k=T.colorModeForRenderPass();(H._unevaluatedLayout.hasValue("text-variable-anchor")||H._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,Y,X,ee,re,le,pe){const ge=Y.transform,we=re==="map",De=le==="map";for(const Me of j){const st=ee.getTile(Me),We=st.getBucket(X);if(!We||!We.text||!We.text.segments.get().length)continue;const ke=s.ag(We.textSizeData,ge.zoom),Ve=$t(st,1,Y.transform.zoom),gt=Yt(Me.posMatrix,De,we,Y.transform,Ve),xt=X.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(ke){const At=Math.pow(2,ge.zoom-st.tileID.overscaledZ);La(We,we,De,pe,ge,gt,Me.posMatrix,At,ke,xt,Y.style.map.terrain?(kt,Rt)=>Y.style.map.terrain.getElevation(Me,kt,Rt):null)}}}(q,T,H,U,H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),w),H.paint.get("icon-opacity").constantOr(1)!==0&&jl(T,U,H,q,!1,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),H.layout.get("icon-rotation-alignment"),H.layout.get("icon-pitch-alignment"),H.layout.get("icon-keep-upright"),I,k),H.paint.get("text-opacity").constantOr(1)!==0&&jl(T,U,H,q,!0,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),H.layout.get("text-keep-upright"),I,k),U.map.showCollisionBoxes&&(Ks(T,U,H,q,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),!0),Ks(T,U,H,q,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),!1))})(a,d,_,B,this.style.placement.variableOffsets);break;case"circle":(function(T,U,H,q){if(T.renderPass!=="translucent")return;const w=H.paint.get("circle-opacity"),I=H.paint.get("circle-stroke-width"),k=H.paint.get("circle-stroke-opacity"),j=!H.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(I.constantOr(1)===0||k.constantOr(1)===0))return;const Y=T.context,X=Y.gl,ee=T.depthModeForSublayer(0,sr.ReadOnly),re=Cr.disabled,le=T.colorModeForRenderPass(),pe=[];for(let ge=0;ge<q.length;ge++){const we=q[ge],De=U.getTile(we),Me=De.getBucket(H);if(!Me)continue;const st=Me.programConfigurations.get(H.id),We=T.useProgram("circle",st),ke=Me.layoutVertexBuffer,Ve=Me.indexBuffer,gt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(we),xt={programConfiguration:st,program:We,layoutVertexBuffer:ke,indexBuffer:Ve,uniformValues:xr(T,we,De,H),terrainData:gt};if(j){const At=Me.segments.get();for(const kt of At)pe.push({segments:new s.$([kt]),sortKey:kt.sortKey,state:xt})}else pe.push({segments:Me.segments,sortKey:0,state:xt})}j&&pe.sort((ge,we)=>ge.sortKey-we.sortKey);for(const ge of pe){const{programConfiguration:we,program:De,layoutVertexBuffer:Me,indexBuffer:st,uniformValues:We,terrainData:ke}=ge.state;De.draw(Y,X.TRIANGLES,ee,re,le,Mr.disabled,We,ke,H.id,Me,st,ge.segments,H.paint,T.transform.zoom,we)}})(a,d,_,B);break;case"heatmap":(function(T,U,H,q){if(H.paint.get("heatmap-opacity")!==0)if(T.renderPass==="offscreen"){const w=T.context,I=w.gl,k=Cr.disabled,j=new Oi([I.ONE,I.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(Y,X,ee){const re=Y.gl;Y.activeTexture.set(re.TEXTURE1),Y.viewport.set([0,0,X.width/4,X.height/4]);let le=ee.heatmapFbo;if(le)re.bindTexture(re.TEXTURE_2D,le.colorAttachment.get()),Y.bindFramebuffer.set(le.framebuffer);else{const pe=re.createTexture();re.bindTexture(re.TEXTURE_2D,pe),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),le=ee.heatmapFbo=Y.createFramebuffer(X.width/4,X.height/4,!1,!1),function(ge,we,De,Me){var st,We;const ke=ge.gl,Ve=(st=ge.HALF_FLOAT)!==null&&st!==void 0?st:ke.UNSIGNED_BYTE,gt=(We=ge.RGBA16F)!==null&&We!==void 0?We:ke.RGBA;ke.texImage2D(ke.TEXTURE_2D,0,gt,we.width/4,we.height/4,0,ke.RGBA,Ve,null),Me.colorAttachment.set(De)}(Y,X,pe,le)}})(w,T,H),w.clear({color:s.aO.transparent});for(let Y=0;Y<q.length;Y++){const X=q[Y];if(U.hasRenderableParent(X))continue;const ee=U.getTile(X),re=ee.getBucket(H);if(!re)continue;const le=re.programConfigurations.get(H.id),pe=T.useProgram("heatmap",le),{zoom:ge}=T.transform;pe.draw(w,I.TRIANGLES,sr.disabled,k,j,Mr.disabled,Bn(X.posMatrix,ee,ge,H.paint.get("heatmap-intensity")),null,H.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,H.paint,T.transform.zoom,le)}w.viewport.set([0,0,T.width,T.height])}else T.renderPass==="translucent"&&(T.context.setColorMode(T.colorModeForRenderPass()),function(w,I){const k=w.context,j=k.gl,Y=I.heatmapFbo;if(!Y)return;k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,Y.colorAttachment.get()),k.activeTexture.set(j.TEXTURE1);let X=I.colorRampTexture;X||(X=I.colorRampTexture=new Pe(k,I.colorRamp,j.RGBA)),X.bind(j.LINEAR,j.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(k,j.TRIANGLES,sr.disabled,Cr.disabled,w.colorModeForRenderPass(),Mr.disabled,((ee,re,le,pe)=>{const ge=s.F();s.aN(ge,0,ee.width,ee.height,0,0,1);const we=ee.context.gl;return{u_matrix:ge,u_world:[we.drawingBufferWidth,we.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:re.paint.get("heatmap-opacity")}})(w,I),null,I.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,I.paint,w.transform.zoom)}(T,H))})(a,d,_,B);break;case"line":(function(T,U,H,q){if(T.renderPass!=="translucent")return;const w=H.paint.get("line-opacity"),I=H.paint.get("line-width");if(w.constantOr(1)===0||I.constantOr(1)===0)return;const k=T.depthModeForSublayer(0,sr.ReadOnly),j=T.colorModeForRenderPass(),Y=H.paint.get("line-dasharray"),X=H.paint.get("line-pattern"),ee=X.constantOr(1),re=H.paint.get("line-gradient"),le=H.getCrossfadeParameters(),pe=ee?"linePattern":Y?"lineSDF":re?"lineGradient":"line",ge=T.context,we=ge.gl;let De=!0;for(const Me of q){const st=U.getTile(Me);if(ee&&!st.patternsLoaded())continue;const We=st.getBucket(H);if(!We)continue;const ke=We.programConfigurations.get(H.id),Ve=T.context.program.get(),gt=T.useProgram(pe,ke),xt=De||gt.program!==Ve,At=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Me),kt=X.constantOr(null);if(kt&&st.imageAtlas){const Ht=st.imageAtlas,vi=Ht.patternPositions[kt.to.toString()],Ti=Ht.patternPositions[kt.from.toString()];vi&&Ti&&ke.setConstantPatternPositions(vi,Ti)}const Rt=At?Me:null,Ai=ee?Wa(T,st,H,le,Rt):Y?Nl(T,st,H,Y,le,Rt):re?Ir(T,st,H,We.lineClipsArray.length,Rt):Ka(T,st,H,Rt);if(ee)ge.activeTexture.set(we.TEXTURE0),st.imageAtlasTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE),ke.updatePaintBuffers(le);else if(Y&&(xt||T.lineAtlas.dirty))ge.activeTexture.set(we.TEXTURE0),T.lineAtlas.bind(ge);else if(re){const Ht=We.gradients[H.id];let vi=Ht.texture;if(H.gradientVersion!==Ht.version){let Ti=256;if(H.stepInterpolant){const er=U.getSource().maxzoom,Ii=Me.canonical.z===er?Math.ceil(1<<T.transform.maxZoom-Me.canonical.z):1;Ti=s.ac(s.aT(We.maxLineLength/s.W*1024*Ii),256,ge.maxTextureSize)}Ht.gradient=s.aU({expression:H.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:Ht.gradient||void 0,clips:We.lineClipsArray}),Ht.texture?Ht.texture.update(Ht.gradient):Ht.texture=new Pe(ge,Ht.gradient,we.RGBA),Ht.version=H.gradientVersion,vi=Ht.texture}ge.activeTexture.set(we.TEXTURE0),vi.bind(H.stepInterpolant?we.NEAREST:we.LINEAR,we.CLAMP_TO_EDGE)}gt.draw(ge,we.TRIANGLES,k,T.stencilModeForClipping(Me),j,Mr.disabled,Ai,At,H.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,H.paint,T.transform.zoom,ke,We.layoutVertexBuffer2),De=!1}})(a,d,_,B);break;case"fill":(function(T,U,H,q){const w=H.paint.get("fill-color"),I=H.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const k=T.colorModeForRenderPass(),j=H.paint.get("fill-pattern"),Y=T.opaquePassEnabledForLayer()&&!j.constantOr(1)&&w.constantOr(s.aO.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===Y){const X=T.depthModeForSublayer(1,T.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly);gc(T,U,H,q,X,k,!1)}if(T.renderPass==="translucent"&&H.paint.get("fill-antialias")){const X=T.depthModeForSublayer(H.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly);gc(T,U,H,q,X,k,!0)}})(a,d,_,B);break;case"fill-extrusion":(function(T,U,H,q){const w=H.paint.get("fill-extrusion-opacity");if(w!==0&&T.renderPass==="translucent"){const I=new sr(T.context.gl.LEQUAL,sr.ReadWrite,T.depthRangeFor3D);if(w!==1||H.paint.get("fill-extrusion-pattern").constantOr(1))ma(T,U,H,q,I,Cr.disabled,Oi.disabled),ma(T,U,H,q,I,T.stencilModeFor3D(),T.colorModeForRenderPass());else{const k=T.colorModeForRenderPass();ma(T,U,H,q,I,Cr.disabled,k)}}})(a,d,_,B);break;case"hillshade":(function(T,U,H,q){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const w=T.context,I=T.depthModeForSublayer(0,sr.ReadOnly),k=T.colorModeForRenderPass(),[j,Y]=T.renderPass==="translucent"?T.stencilConfigForOverlap(q):[{},q];for(const X of Y){const ee=U.getTile(X);ee.needsHillshadePrepare!==void 0&&ee.needsHillshadePrepare&&T.renderPass==="offscreen"?dl(T,ee,H,I,Cr.disabled,k):T.renderPass==="translucent"&&Ds(T,X,ee,H,I,j[X.overscaledZ],k)}w.viewport.set([0,0,T.width,T.height])})(a,d,_,B);break;case"raster":(function(T,U,H,q){if(T.renderPass!=="translucent"||H.paint.get("raster-opacity")===0||!q.length)return;const w=T.context,I=w.gl,k=U.getSource(),j=T.useProgram("raster"),Y=T.colorModeForRenderPass(),[X,ee]=k instanceof si?[{},q]:T.stencilConfigForOverlap(q),re=ee[ee.length-1].overscaledZ,le=!T.options.moving;for(const pe of ee){const ge=T.depthModeForSublayer(pe.overscaledZ-re,H.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,I.LESS),we=U.getTile(pe);we.registerFadeDuration(H.paint.get("raster-fade-duration"));const De=U.findLoadedParent(pe,0),Me=$l(we,De,U,H,T.transform,T.style.map.terrain);let st,We;const ke=H.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;w.activeTexture.set(I.TEXTURE0),we.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(I.TEXTURE1),De?(De.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),st=Math.pow(2,De.tileID.overscaledZ-we.tileID.overscaledZ),We=[we.tileID.canonical.x*st%1,we.tileID.canonical.y*st%1]):we.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Ve=T.style.map.terrain&&T.style.map.terrain.getTerrainData(pe),gt=Ve?pe:null,xt=gt?gt.posMatrix:T.transform.calculatePosMatrix(pe.toUnwrapped(),le),At=Xa(xt,We||[0,0],st||1,Me,H);k instanceof si?j.draw(w,I.TRIANGLES,ge,Cr.disabled,Y,Mr.disabled,At,Ve,H.id,k.boundsBuffer,T.quadTriangleIndexBuffer,k.boundsSegments):j.draw(w,I.TRIANGLES,ge,X[pe.overscaledZ],Y,Mr.disabled,At,Ve,H.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments)}})(a,d,_,B);break;case"background":(function(T,U,H,q){const w=H.paint.get("background-color"),I=H.paint.get("background-opacity");if(I===0)return;const k=T.context,j=k.gl,Y=T.transform,X=Y.tileSize,ee=H.paint.get("background-pattern");if(T.isPatternMissing(ee))return;const re=!ee&&w.a===1&&I===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==re)return;const le=Cr.disabled,pe=T.depthModeForSublayer(0,re==="opaque"?sr.ReadWrite:sr.ReadOnly),ge=T.colorModeForRenderPass(),we=T.useProgram(ee?"backgroundPattern":"background"),De=q||Y.coveringTiles({tileSize:X,terrain:T.style.map.terrain});ee&&(k.activeTexture.set(j.TEXTURE0),T.imageManager.bind(T.context));const Me=H.getCrossfadeParameters();for(const st of De){const We=q?st.posMatrix:T.transform.calculatePosMatrix(st.toUnwrapped()),ke=ee?Ja(We,I,T,ee,{tileID:st,tileSize:X},Me):Dc(We,I,w),Ve=T.style.map.terrain&&T.style.map.terrain.getTerrainData(st);we.draw(k,j.TRIANGLES,pe,le,ge,Mr.disabled,ke,Ve,H.id,T.tileExtentBuffer,T.quadTriangleIndexBuffer,T.tileExtentSegments)}})(a,0,_,B);break;case"custom":(function(T,U,H){const q=T.context,w=H.implementation;if(T.renderPass==="offscreen"){const I=w.prerender;I&&(T.setCustomLayerDefaults(),q.setColorMode(T.colorModeForRenderPass()),I.call(w,q.gl,T.transform.customLayerMatrix()),q.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),q.setColorMode(T.colorModeForRenderPass()),q.setStencilMode(Cr.disabled);const I=w.renderingMode==="3d"?new sr(T.context.gl.LEQUAL,sr.ReadWrite,T.depthRangeFor3D):T.depthModeForSublayer(0,sr.ReadOnly);q.setDepthMode(I),w.render(q.gl,T.transform.customLayerMatrix()),q.setDirty(),T.setBaseState(),q.bindFramebuffer.set(null)}})(a,0,_)}}translatePosMatrix(a,d,_,B,T){if(!_[0]&&!_[1])return a;const U=T?B==="map"?this.transform.angle:0:B==="viewport"?-this.transform.angle:0;if(U){const w=Math.sin(U),I=Math.cos(U);_=[_[0]*I-_[1]*w,_[0]*w+_[1]*I]}const H=[T?_[0]:$t(d,_[0],this.transform.zoom),T?_[1]:$t(d,_[1],this.transform.zoom),0],q=new Float32Array(16);return s.H(q,a,H),q}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!d||!_}useProgram(a,d){this.cache=this.cache||{};const _=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new ho(this.context,dn[a],d,Ao[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Pe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class os{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,_){const B=Math.pow(2,_),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{const q=1/(H=s.af([],H,a))[3]/d*B;return s.a_(H,H,[q,q,1/H[3],q])}),U=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{const q=function(j,Y){var X=Y[0],ee=Y[1],re=Y[2],le=X*X+ee*ee+re*re;return le>0&&(le=1/Math.sqrt(le)),j[0]=Y[0]*le,j[1]=Y[1]*le,j[2]=Y[2]*le,j}([],function(j,Y,X){var ee=Y[0],re=Y[1],le=Y[2],pe=X[0],ge=X[1],we=X[2];return j[0]=re*we-le*ge,j[1]=le*pe-ee*we,j[2]=ee*ge-re*pe,j}([],at([],T[H[0]],T[H[1]]),at([],T[H[2]],T[H[1]]))),w=-((I=q)[0]*(k=T[H[1]])[0]+I[1]*k[1]+I[2]*k[2]);var I,k;return q.concat(w)});return new os(T,U)}}class as{constructor(a,d){this.min=a,this.max=d,this.center=function(_,B,T){return _[0]=.5*B[0],_[1]=.5*B[1],_[2]=.5*B[2],_}([],function(_,B,T){return _[0]=B[0]+T[0],_[1]=B[1]+T[1],_[2]=B[2]+T[2],_}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],_=$e(this.min),B=$e(this.max);for(let T=0;T<d.length;T++)_[T]=d[T]?this.min[T]:this.center[T],B[T]=d[T]?this.center[T]:this.max[T];return B[2]=this.max[2],new as(_,B)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let B=0;B<a.planes.length;B++){const T=a.planes[B];let U=0;for(let H=0;H<d.length;H++)s.a$(T,d[H])>=0&&U++;if(U===0)return 0;U!==d.length&&(_=!1)}if(_)return 2;for(let B=0;B<3;B++){let T=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let H=0;H<a.points.length;H++){const q=a.points[H][B]-this.min[B];T=Math.min(T,q),U=Math.max(U,q)}if(U<0||T>this.max[B]-this.min[B])return 0}return 1}}class Po{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(B)||B<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=B}interpolate(a,d,_){return d.top!=null&&a.top!=null&&(this.top=s.z.number(a.top,d.top,_)),d.bottom!=null&&a.bottom!=null&&(this.bottom=s.z.number(a.bottom,d.bottom,_)),d.left!=null&&a.left!=null&&(this.left=s.z.number(a.left,d.left,_)),d.right!=null&&a.right!=null&&(this.right=s.z.number(a.right,d.right,_)),this}getCenter(a,d){const _=s.ac((this.left+a-this.right)/2,0,a),B=s.ac((this.top+d-this.bottom)/2,0,d);return new s.P(_,B)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Fo{constructor(a,d,_,B,T){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=T===void 0||!!T,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=B??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Po,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new Fo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-s.b0(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var _=new s.A(4);return s.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,B,T){var U=B[0],H=B[1],q=B[2],w=B[3],I=Math.sin(T),k=Math.cos(T);_[0]=U*k+q*I,_[1]=H*k+w*I,_[2]=U*-I+q*k,_[3]=H*-I+w*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=s.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new s.b1(0,a)];if(this._renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),B=this.pointCoordinate(new s.P(this.width,0)),T=this.pointCoordinate(new s.P(this.width,this.height)),U=this.pointCoordinate(new s.P(0,this.height)),H=Math.floor(Math.min(_.x,B.x,T.x,U.x)),q=Math.floor(Math.max(_.x,B.x,T.x,U.x)),w=1;for(let I=H-w;I<=q+w;I++)I!==0&&d.push(new s.b1(I,a))}return d}coveringTiles(a){var d,_;let B=this.coveringZoomLevel(a);const T=B;if(a.minzoom!==void 0&&B<a.minzoom)return[];a.maxzoom!==void 0&&B>a.maxzoom&&(B=a.maxzoom);const U=this.pointCoordinate(this.getCameraPoint()),H=s.Y.fromLngLat(this.center),q=Math.pow(2,B),w=[q*U.x,q*U.y,0],I=[q*H.x,q*H.y,0],k=os.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,B);let j=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=B);const Y=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,X=ge=>({aabb:new as([ge*q,0,0],[(ge+1)*q,q,0]),zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),ee=[],re=[],le=B,pe=a.reparseOverscaled?T:B;if(this._renderWorldCopies)for(let ge=1;ge<=3;ge++)ee.push(X(-ge)),ee.push(X(ge));for(ee.push(X(0));ee.length>0;){const ge=ee.pop(),we=ge.x,De=ge.y;let Me=ge.fullyVisible;if(!Me){const gt=ge.aabb.intersects(k);if(gt===0)continue;Me=gt===2}const st=a.terrain?w:I,We=ge.aabb.distanceX(st),ke=ge.aabb.distanceY(st),Ve=Math.max(Math.abs(We),Math.abs(ke));if(ge.zoom===le||Ve>Y+(1<<le-ge.zoom)-2&&ge.zoom>=j){const gt=le-ge.zoom,xt=w[0]-.5-(we<<gt),At=w[1]-.5-(De<<gt);re.push({tileID:new s.Q(ge.zoom===le?pe:ge.zoom,ge.wrap,ge.zoom,we,De),distanceSq:rt([I[0]-.5-we,I[1]-.5-De]),tileDistanceToCamera:Math.sqrt(xt*xt+At*At)})}else for(let gt=0;gt<4;gt++){const xt=(we<<1)+gt%2,At=(De<<1)+(gt>>1),kt=ge.zoom+1;let Rt=ge.aabb.quadrant(gt);if(a.terrain){const Ai=new s.Q(kt,ge.wrap,kt,xt,At),Ht=a.terrain.getMinMaxElevation(Ai),vi=(d=Ht.minElevation)!==null&&d!==void 0?d:this.elevation,Ti=(_=Ht.maxElevation)!==null&&_!==void 0?_:this.elevation;Rt=new as([Rt.min[0],Rt.min[1],vi],[Rt.max[0],Rt.max[1],Ti])}ee.push({aabb:Rt,zoom:kt,x:xt,y:At,wrap:ge.wrap,fullyVisible:Me})}}return re.sort((ge,we)=>ge.distanceSq-we.distanceSq).map(ge=>ge.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=s.ac(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.N(a.lng)*this.worldSize,s.O(d)*this.worldSize)}unproject(a){return new s.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.pointLocation(this.centerPoint,a),_=a.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-_))return;const B=this.getCameraPosition(),T=s.Y.fromLngLat(B.lngLat,B.altitude),U=s.Y.fromLngLat(d,_),H=T.x-U.x,q=T.y-U.y,w=T.z-U.z,I=Math.sqrt(H*H+q*q+w*w),k=this.scaleZoom(this.cameraToCenterDistance/I/this.tileSize);this._elevation=_,this._center=d,this.zoom=k}setLocationAtPoint(a,d){const _=this.pointCoordinate(d),B=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(a),U=new s.Y(T.x-(_.x-B.x),T.y-(_.y-B.y));this.center=this.coordinateLocation(U),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return s.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const j=d.pointCoordinate(a);if(j!=null)return j}const _=[a.x,a.y,0,1],B=[a.x,a.y,1,1];s.af(_,_,this.pixelMatrixInverse),s.af(B,B,this.pixelMatrixInverse);const T=_[3],U=B[3],H=_[1]/T,q=B[1]/U,w=_[2]/T,I=B[2]/U,k=w===I?0:(0-w)/(I-w);return new s.Y(s.z.number(_[0]/T,B[0]/U,k)/this.worldSize,s.z.number(H,q,k)/this.worldSize)}coordinatePoint(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const B=[a.x*this.worldSize,a.y*this.worldSize,d,1];return s.af(B,B,_),new s.P(B[0]/B[3],B[1]/B[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new Ot().extend(this.pointLocation(new s.P(0,a))).extend(this.pointLocation(new s.P(this.width,a))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ot([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=a.key,B=d?this._alignedPosMatrixCache:this._posMatrixCache;if(B[_])return B[_];const T=a.canonical,U=this.worldSize/this.zoomScale(T.z),H=T.x+Math.pow(2,T.z)*a.wrap,q=s.an(new Float64Array(16));return s.H(q,q,[H*U,T.y*U,0]),s.J(q,q,[U/s.W,U/s.W,1]),s.K(q,d?this.alignedProjMatrix:this.projMatrix,q),B[_]=new Float32Array(q),B[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;let a=this.lngRange;if(!this._renderWorldCopies&&a===null){const X=179.9999999999;a=[-X,X]}this._constraining=!0;let d,_,B,T,U=-90,H=90,q=-180,w=180;const I=this.size,k=this._unmodified;if(this.latRange){const X=this.latRange;U=s.O(X[1])*this.worldSize,H=s.O(X[0])*this.worldSize,d=H-U<I.y?I.y/(H-U):0}a&&(q=s.b0(s.N(a[0])*this.worldSize,0,this.worldSize),w=s.b0(s.N(a[1])*this.worldSize,0,this.worldSize),w<q&&(w+=this.worldSize),_=w-q<I.x?I.x/(w-q):0);const j=this.point,Y=Math.max(_||0,d||0);if(Y)return this.center=this.unproject(new s.P(_?(w+q)/2:j.x,d?(H+U)/2:j.y)),this.zoom+=this.scaleZoom(Y),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const X=j.y,ee=I.y/2;X-ee<U&&(T=U+ee),X+ee>H&&(T=H-ee)}if(a){const X=(q+w)/2;let ee=j.x;this._renderWorldCopies&&(ee=s.b0(j.x,X-this.worldSize/2,X+this.worldSize/2));const re=I.x/2;ee-re<q&&(B=q+re),ee+re>w&&(B=w-re)}B===void 0&&T===void 0||(this.center=this.unproject(new s.P(B!==void 0?B:j.x,T!==void 0?T:j.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b2(1,this.center.lat)*this.worldSize;let B=s.an(new Float64Array(16));s.J(B,B,[this.width/2,-this.height/2,1]),s.H(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.an(new Float64Array(16)),s.J(B,B,[1,-1,1]),s.H(B,B,[-1,-1,0]),s.J(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B;const T=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),U=Math.min(this.elevation,this.minElevationForCurrentTile),H=T-U*this._pixelPerMeter/Math.cos(this._pitch),q=U<0?H:T,w=Math.PI/2+this._pitch,I=this._fov*(.5+a.y/this.height),k=Math.sin(I)*q/Math.sin(s.ac(Math.PI-w-I,.01,Math.PI-.01)),j=this.getHorizon(),Y=2*Math.atan(j/this.cameraToCenterDistance)*(.5+a.y/(2*j)),X=Math.sin(Y)*q/Math.sin(s.ac(Math.PI-w-Y,.01,Math.PI-.01)),ee=Math.min(k,X),re=1.01*(Math.cos(Math.PI/2-this._pitch)*ee+q),le=this.height/50;B=new Float64Array(16),s.b3(B,this._fov,this.width/this.height,le,re),B[8]=2*-a.x/this.width,B[9]=2*a.y/this.height,s.J(B,B,[1,-1,1]),s.H(B,B,[0,0,-this.cameraToCenterDistance]),s.b4(B,B,this._pitch),s.ad(B,B,this.angle),s.H(B,B,[-d,-_,0]),this.mercatorMatrix=s.J([],B,[this.worldSize,this.worldSize,this.worldSize]),s.J(B,B,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,B),s.H(B,B,[0,0,-this.elevation]),this.projMatrix=B,this.invProjMatrix=s.ar([],B),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,B);const pe=this.width%2/2,ge=this.height%2/2,we=Math.cos(this.angle),De=Math.sin(this.angle),Me=d-Math.round(d)+we*pe+De*ge,st=_-Math.round(_)+we*ge+De*pe,We=new Float64Array(B);if(s.H(We,We,[Me>.5?Me-1:Me,st>.5?st-1:st,0]),this.alignedProjMatrix=We,B=s.ar(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");this.pixelMatrixInverse=B,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new s.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return s.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let _=d.x,B=d.y,T=d.x,U=d.y;for(const H of a)_=Math.min(_,H.x),B=Math.min(B,H.y),T=Math.max(T,H.x),U=Math.max(U,H.y);return[new s.P(_,B),new s.P(T,B),new s.P(T,U),new s.P(_,U),new s.P(_,B)]}}lngLatToCameraDepth(a,d){const _=this.locationCoordinate(a),B=[_.x*this.worldSize,_.y*this.worldSize,d,1];return s.af(B,B,this.projMatrix),B[2]/B[3]}}function ya(y,a){var d=this;let _,B=!1,T=null,U=null;const H=()=>{T=null,B&&(y.apply(U,_),T=setTimeout(H,a),B=!1)};return function(){for(var q=arguments.length,w=new Array(q),I=0;I<q;I++)w[I]=arguments[I];return B=!0,U=d,_=w,T||H(),T}}class gl{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(_=B)}),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=ya(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,B=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,B),U=Math.round(d.lng*T)/T,H=Math.round(d.lat*T)/T,q=this._map.getBearing(),w=this._map.getPitch();let I="";if(I+=a?`/${U}/${H}/${_}`:`${_}/${H}/${U}`,(q||w)&&(I+="/"+Math.round(10*q)/10),w&&(I+=`/${Math.round(w)}`),this._hashName){const k=this._hashName;let j=!1;const Y=window.location.hash.slice(1).split("&").map(X=>{const ee=X.split("=")[0];return ee===k?(j=!0,`${ee}=${I}`):X}).filter(X=>X);return j||Y.push(`${k}=${I}`),`#${Y.join("&")}`}return`#${I}`}}const ro={linearity:.3,easing:s.b5(0,0,.3,1)},no=s.e({deceleration:2500,maxSpeed:1400},ro),go=s.e({deceleration:20,maxSpeed:1400},ro),_s=s.e({deceleration:1e3,maxSpeed:360},ro),so=s.e({deceleration:1e3,maxSpeed:90},ro);class Fa{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=F.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(d.pan.mag()){const T=Da(d.pan.mag(),_,s.e({},no,a||{}));B.offset=d.pan.mult(T.amount/d.pan.mag()),B.center=this._map.transform.center,_a(B,T)}if(d.zoom){const T=Da(d.zoom,_,go);B.zoom=this._map.transform.zoom+T.amount,_a(B,T)}if(d.bearing){const T=Da(d.bearing,_,_s);B.bearing=this._map.transform.bearing+s.ac(T.amount,-179,179),_a(B,T)}if(d.pitch){const T=Da(d.pitch,_,so);B.pitch=this._map.transform.pitch+T.amount,_a(B,T)}if(B.zoom||B.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;B.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),s.e(B,{noMoveStart:!0})}}function _a(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Da(y,a,d){const{maxSpeed:_,linearity:B,deceleration:T}=d,U=s.ac(y*B/(a/1e3),-_,_),H=Math.abs(U)/(T*B);return{easing:d.easing,duration:1e3*H,amount:U*(H/2)}}class Ln extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const T=D.mousePos(d.getCanvas(),_),U=d.unproject(T);super(a,s.e({point:T,lngLat:U,originalEvent:_},B)),this._defaultPrevented=!1,this.target=d}}class Do extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const B=a==="touchend"?_.changedTouches:_.touches,T=D.touchPos(d.getCanvasContainer(),B),U=T.map(q=>d.unproject(q)),H=T.reduce((q,w,I,k)=>q.add(w.div(k.length)),new s.P(0,0));super(a,{points:T,point:H,lngLats:U,lngLat:d.unproject(H),originalEvent:_}),this._defaultPrevented=!1}}class ds extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class vs{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new ds(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new Ln(a.type,this._map,a))}mouseup(a){this._map.fire(new Ln(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ln(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Ln(a.type,this._map,a))}mouseover(a){this._map.fire(new Ln(a.type,this._map,a))}mouseout(a){this._map.fire(new Ln(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Do(a.type,this._map,a))}touchmove(a){this._map.fire(new Do(a.type,this._map,a))}touchend(a){this._map.fire(new Do(a.type,this._map,a))}touchcancel(a){this._map.fire(new Do(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fs{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Ln(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Ln(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lr{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(s.P.convert(a),this._map.terrain)}}class Jr{constructor(a,d){this._map=a,this._tr=new Lr(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(D.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const B=this._startPos;this._lastPos=_,this._box||(this._box=D.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const T=Math.min(B.x,_.x),U=Math.max(B.x,_.x),H=Math.min(B.y,_.y),q=Math.max(B.y,_.y);D.setTransform(this._box,`translate(${T}px,${H}px)`),this._box.style.width=U-T+"px",this._box.style.height=q-H+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const _=this._startPos,B=d;if(this.reset(),D.suppressClick(),_.x!==B.x||_.y!==B.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:a})),{cameraAnimation:T=>T.fitScreenCoordinates(_,B,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(D.remove(this._box),this._box=null),D.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new s.k(a,{originalEvent:d}))}}function ln(y,a){if(y.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${a.length}`);const d={};for(let _=0;_<y.length;_++)d[y[_].identifier]=a[_];return d}class qn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(B){const T=new s.P(0,0);for(const U of B)T._add(U);return T.div(B.length)}(d),this.touches=ln(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const B=ln(_,d);for(const T in this.touches){const U=B[T];(!U||U.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const B=!this.aborted&&this.centroid;if(this.reset(),B)return B}}}class va{constructor(a){this.singleTap=new qn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const B=this.singleTap.touchend(a,d,_);if(B){const T=a.timeStamp-this.lastTime<500,U=!this.lastTap||this.lastTap.dist(B)<30;if(T&&U||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=B,this.count===this.numTaps)return this.reset(),B}}}class Ra{constructor(a){this._tr=new Lr(a),this._zoomIn=new va({numTouches:1,numTaps:2}),this._zoomOut=new va({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const B=this._zoomIn.touchend(a,d,_),T=this._zoomOut.touchend(a,d,_),U=this._tr;return B?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom+1,around:U.unproject(B)},{originalEvent:a})}):T?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom-1,around:U.unproject(T)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const B=d.length?d[0]:d;return!this._moved&&B.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=B,this._move(_,B))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&D.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Yo={0:1,2:2};class Ui{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=D.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,_){const B=Yo[_];return d.buttons===void 0||(d.buttons&B)!==B}(a,this._eventButton)}isValidEndEvent(a){return D.mouseButton(a)===this._eventButton}}class ea{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const Fi=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(a){a.preventDefault()}},ml=y=>{let{enable:a,clickTolerance:d,bearingDegreesPerPixelMoved:_=.8}=y;const B=new Ui({checkCorrectEvent:T=>D.mouseButton(T)===0&&T.ctrlKey||D.mouseButton(T)===2});return new mo({clickTolerance:d,move:(T,U)=>({bearingDelta:(U.x-T.x)*_}),moveStateManager:B,enable:a,assignEvents:Fi})},Kl=y=>{let{enable:a,clickTolerance:d,pitchDegreesPerPixelMoved:_=-.5}=y;const B=new Ui({checkCorrectEvent:T=>D.mouseButton(T)===0&&T.ctrlKey||D.mouseButton(T)===2});return new mo({clickTolerance:d,move:(T,U)=>({pitchDelta:(U.y-T.y)*_}),moveStateManager:B,enable:a,assignEvents:Fi})};class Mi{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,_)}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const B=ln(_,d),T=new s.P(0,0),U=new s.P(0,0);let H=0;for(const w in B){const I=B[w],k=this._touches[w];k&&(T._add(I),U._add(I.sub(k)),H++,B[w]=I)}if(this._touches=B,H<this.minTouchs()||!U.mag())return;const q=U.div(H);return this._sum._add(q),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(H),panDelta:q}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){if(!this._firstTwoTouches)return;a.preventDefault();const[B,T]=this._firstTwoTouches,U=Si(_,d,B),H=Si(_,d,T);if(!U||!H)return;const q=this._aroundCenter?null:U.add(H).div(2);return this._move([U,H],q,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[B,T]=this._firstTwoTouches,U=Si(_,d,B),H=Si(_,d,T);U&&H||(this._active&&D.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Si(y,a,d){for(let _=0;_<y.length;_++)if(y[_].identifier===d)return a[_]}function oo(y,a){return Math.log(y/a)/Math.LN2}class yo extends Wl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(oo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oo(this._distance,_),pinchAround:d}}}function kc(y,a){return 180*y.angleWith(a)/Math.PI}class Xl extends Wl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,_){const B=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:kc(this._vector,B),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=kc(a,this._startVector);return Math.abs(_)<d}}function Oc(y){return Math.abs(y.y)>Math.abs(y.x)}class Uc extends Wl{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,_){super.touchstart(a,d,_),this._currentTouchCount=_.length}_start(a){this._lastPoints=a,Oc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const B=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(B,T,_.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(B.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,_){if(this._valid!==void 0)return this._valid;const B=a.mag()>=2,T=d.mag()>=2;if(!B&&!T)return;if(!B||!T)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const U=a.y>0==d.y>0;return Oc(a)&&Oc(d)&&U}}const Nc={panStep:100,bearingStep:15,pitchStep:10};class zc{constructor(a){this._tr=new Lr(a);const d=Nc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,B=0,T=0,U=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),T=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),T=1);break;case 38:a.shiftKey?B=1:(a.preventDefault(),U=-1);break;case 40:a.shiftKey?B=-1:(a.preventDefault(),U=1);break;default:return}return this._rotationDisabled&&(_=0,B=0),{cameraAnimation:H=>{const q=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:rl,zoom:d?Math.round(q.zoom)+d*(a.shiftKey?2:1):q.zoom,bearing:q.bearing+_*this._bearingStep,pitch:q.pitch+B*this._pitchStep,offset:[-T*this._panStep,-U*this._panStep],center:q.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rl(y){return y*(2-y)}const _n=4.000244140625;class Es{constructor(a,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=a,this._tr=new Lr(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=F.now(),B=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%_n==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":B>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(B*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=D.mousePos(this._map.getCanvas(),a),_=this._tr;this._around=d.y>_.transform.height/2-_.transform.getHorizon()?s.M.convert(this._aroundCenter?_.center:_.unproject(d)):s.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>_n?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&q!==0&&(q=1/q);const w=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(w*q))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,_=this._startZoom,B=this._easing;let T,U=!1;if(this._type==="wheel"&&_&&B){const H=Math.min((F.now()-this._lastWheelEventTime)/200,1),q=B(H);T=s.z.number(_,d,q),H<1?this._frameId||(this._frameId=!0):U=!0}else T=d,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:T-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=s.b6;if(this._prevEase){const _=this._prevEase,B=(F.now()-_.start)/_.duration,T=_.easing(B+.01)-_.easing(B),U=.27/Math.sqrt(T*T+1e-4)*.01,H=Math.sqrt(.0729-U*U);d=s.b5(U,H,.25,1)}return this._prevEase={start:F.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ro{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zl{constructor(a){this._tr=new Lr(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(){this._tap=new va({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,_){if(!this._swipePoint)if(this._tapTime){const B=d[0],T=a.timeStamp-this._tapTime<500,U=this._tapPoint.dist(B)<30;T&&U?_.length>0&&(this._swipePoint=B,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(a,d,_)}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const B=d[0],T=B.y-this._swipePoint.y;return this._swipePoint=B,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const B=this._tap.touchend(a,d,_);B&&(this._tapTime=a.timeStamp,this._tapPoint=B)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mc{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hu{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ba{constructor(a,d,_,B){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=B,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ws{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=D.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),B=document.createElement("div");B.className="maplibregl-desktop-message",B.textContent=d,this._container.appendChild(B);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=_,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(D.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const xi=y=>y.zoom||y.drag||y.pitch||y.rotate;class or extends s.k{}function Jl(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Qc{constructor(a,d){this.handleWindowEvent=B=>{this.handleEvent(B,`${B.type}Window`)},this.handleEvent=(B,T)=>{if(B.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const U=B.type==="renderFrame"?void 0:B,H={needsRenderFrame:!1},q={},w={},I=B.touches,k=I?this._getMapTouches(I):void 0,j=k?D.touchPos(this._map.getCanvas(),k):D.mousePos(this._map.getCanvas(),B);for(const{handlerName:ee,handler:re,allowed:le}of this._handlers){if(!re.isEnabled())continue;let pe;this._blockedByActive(w,le,ee)?re.reset():re[T||B.type]&&(pe=re[T||B.type](B,j,k),this.mergeHandlerResult(H,q,pe,ee,U),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||re.isActive())&&(w[ee]=re)}const Y={};for(const ee in this._previousActiveHandlers)w[ee]||(Y[ee]=U);this._previousActiveHandlers=w,(Object.keys(Y).length||Jl(H))&&(this._changes.push([H,q,Y]),this._triggerRenderFrame()),(Object.keys(w).length||Jl(H))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=H;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fa(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[B,T,U]of this._listeners)D.addEventListener(B,T,B===document?this.handleWindowEvent:this.handleEvent,U)}destroy(){for(const[a,d,_]of this._listeners)D.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new vs(d,a));const B=d.boxZoom=new Jr(d,a);this._add("boxZoom",B),a.interactive&&a.boxZoom&&B.enable();const T=d.cooperativeGestures=new Ws(d,a.cooperativeGestures);this._add("cooperativeGestures",T),a.cooperativeGestures&&T.enable();const U=new Ra(d),H=new Zl(d);d.doubleClickZoom=new Ro(H,U),this._add("tapZoom",U),this._add("clickZoom",H),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const q=new Uu;this._add("tapDragZoom",q);const w=d.touchPitch=new Uc(d);this._add("touchPitch",w),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const I=ml(a),k=Kl(a);d.dragRotate=new hu(a,I,k),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const j=(pe=>{let{enable:ge,clickTolerance:we}=pe;const De=new Ui({checkCorrectEvent:Me=>D.mouseButton(Me)===0&&!Me.ctrlKey});return new mo({clickTolerance:we,move:(Me,st)=>({around:st,panDelta:st.sub(Me)}),activateOnStart:!0,moveStateManager:De,enable:ge,assignEvents:Fi})})(a),Y=new Mi(a,d);d.dragPan=new mc(_,j,Y),this._add("mousePan",j),this._add("touchPan",Y,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const X=new Xl,ee=new yo;d.touchZoomRotate=new ba(_,ee,X,q),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const re=d.scrollZoom=new Es(d,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const le=d.keyboard=new zc(d);this._add("keyboard",le),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new fs(d))}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xi(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,_){for(const B in a)if(B!==_&&(!d||d.indexOf(B)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(a,d,_,B,T){if(!_)return;s.e(a,_);const U={handlerName:B,originalEvent:_.originalEvent||T};_.zoomDelta!==void 0&&(d.zoom=U),_.panDelta!==void 0&&(d.drag=U),_.pitchDelta!==void 0&&(d.pitch=U),_.bearingDelta!==void 0&&(d.rotate=U)}_applyChanges(){const a={},d={},_={};for(const[B,T,U]of this._changes)B.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(B.panDelta)),B.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(a.around=B.around),B.pinchAround!==void 0&&(a.pinchAround=B.pinchAround),B.noInertia&&(a.noInertia=B.noInertia),s.e(d,T),s.e(_,U);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const B=this._map,T=B._getTransformForUpdate(),U=B.terrain;if(!(Jl(a)||U&&this._terrainMovement))return this._fireEvents(d,_,!0);let{panDelta:H,zoomDelta:q,bearingDelta:w,pitchDelta:I,around:k,pinchAround:j}=a;j!==void 0&&(k=j),B._stop(!0),k=k||B.transform.centerPoint;const Y=T.pointLocation(H?k.sub(H):k);w&&(T.bearing+=w),I&&(T.pitch+=I),q&&(T.zoom+=q),U?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?T.center=T.pointLocation(T.centerPoint.sub(H)):T.setLocationAtPoint(Y,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,T.setLocationAtPoint(Y,k),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,T.recalculateZoom(B.terrain)})):T.setLocationAtPoint(Y,k),B._applyUpdatedTransform(T),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const B=xi(this._eventsInProgress),T=xi(a),U={};for(const I in a){const{originalEvent:k}=a[I];this._eventsInProgress[I]||(U[`${I}start`]=k),this._eventsInProgress[I]=a[I]}!B&&T&&this._fireEvent("movestart",T.originalEvent);for(const I in U)this._fireEvent(I,U[I]);T&&this._fireEvent("move",T.originalEvent);for(const I in a){const{originalEvent:k}=a[I];this._fireEvent(I,k)}const H={};let q;for(const I in this._eventsInProgress){const{handlerName:k,originalEvent:j}=this._eventsInProgress[I];this._handlersById[k].isActive()||(delete this._eventsInProgress[I],q=d[k]||j,H[`${I}end`]=q)}for(const I in H)this._fireEvent(I,H[I]);const w=xi(this._eventsInProgress);if(_&&(B||T)&&!w){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!I||!I.essential&&F.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:q})),k(this._map.getBearing())&&this._map.resetNorth()):(k(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:q})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new s.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new or("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vc extends s.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const _=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.e({offset:a},d),_)}panTo(a,d,_){return this.easeTo(s.e({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(s.e({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(s.e({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,s.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=Ot.convert(a);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,d)}_cameraForBoxAndBearing(a,d,_,B){const T={top:0,bottom:0,right:0,left:0};if(typeof(B=s.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},B)).padding=="number"){const gt=B.padding;B.padding={top:gt,bottom:gt,right:gt,left:gt}}B.padding=s.e(T,B.padding);const U=this.transform,H=U.padding,q=new Ot(a,d),w=U.project(q.getNorthWest()),I=U.project(q.getNorthEast()),k=U.project(q.getSouthEast()),j=U.project(q.getSouthWest()),Y=s.b7(-_),X=w.rotate(Y),ee=I.rotate(Y),re=k.rotate(Y),le=j.rotate(Y),pe=new s.P(Math.max(X.x,ee.x,le.x,re.x),Math.max(X.y,ee.y,le.y,re.y)),ge=new s.P(Math.min(X.x,ee.x,le.x,re.x),Math.min(X.y,ee.y,le.y,re.y)),we=pe.sub(ge),De=(U.width-(H.left+H.right+B.padding.left+B.padding.right))/we.x,Me=(U.height-(H.top+H.bottom+B.padding.top+B.padding.bottom))/we.y;if(Me<0||De<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const st=Math.min(U.scaleZoom(U.scale*Math.min(De,Me)),B.maxZoom),We=s.P.convert(B.offset),ke=new s.P((B.padding.left-B.padding.right)/2,(B.padding.top-B.padding.bottom)/2).rotate(s.b7(_)),Ve=We.add(ke).mult(U.scale/U.zoomScale(st));return{center:U.unproject(w.add(k).div(2).sub(Ve)),zoom:st,bearing:_}}fitBounds(a,d,_){return this._fitInternal(this.cameraForBounds(a,d),d,_)}fitScreenCoordinates(a,d,_,B,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(a)),this.transform.pointLocation(s.P.convert(d)),_,B),B,T)}_fitInternal(a,d,_){return a?(delete(d=s.e(a,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(a,d){this.stop();const _=this._getTransformForUpdate();let B=!1,T=!1,U=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(B=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=s.M.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(T=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(U=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),this._applyUpdatedTransform(_),this.fire(new s.k("movestart",d)).fire(new s.k("move",d)),B&&this.fire(new s.k("zoomstart",d)).fire(new s.k("zoom",d)).fire(new s.k("zoomend",d)),T&&this.fire(new s.k("rotatestart",d)).fire(new s.k("rotate",d)).fire(new s.k("rotateend",d)),U&&this.fire(new s.k("pitchstart",d)).fire(new s.k("pitch",d)).fire(new s.k("pitchend",d)),this.fire(new s.k("moveend",d))}calculateCameraOptionsFromTo(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const T=s.Y.fromLngLat(a,d),U=s.Y.fromLngLat(_,B),H=U.x-T.x,q=U.y-T.y,w=U.z-T.z,I=Math.hypot(H,q,w);if(I===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(H,q),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/I/this.transform.tileSize),Y=180*Math.atan2(H,-q)/Math.PI;let X=180*Math.acos(k/I)/Math.PI;return X=w<0?90-X:90+X,{center:U.toLngLat(),zoom:j,pitch:X,bearing:Y}}easeTo(a,d){this._stop(!1,a.easeId),((a=s.e({offset:[0,0],duration:500,easing:s.b6},a)).animate===!1||!a.essential&&F.prefersReducedMotion)&&(a.duration=0);const _=this._getTransformForUpdate(),B=this.getZoom(),T=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?+a.zoom:B,w="bearing"in a?this._normalizeBearing(a.bearing,T):T,I="pitch"in a?+a.pitch:U,k="padding"in a?a.padding:_.padding,j=s.P.convert(a.offset);let Y=_.centerPoint.add(j);const X=_.pointLocation(Y),ee=s.M.convert(a.center||X);this._normalizeCenter(ee);const re=_.project(X),le=_.project(ee).sub(re),pe=_.zoomScale(q-B);let ge,we;a.around&&(ge=s.M.convert(a.around),we=_.locationPoint(ge));const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==B,this._rotating=this._rotating||T!==w,this._pitching=this._pitching||I!==U,this._padding=!_.isPaddingEqual(k),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,De),this.terrain&&this._prepareElevation(ee),this._ease(Me=>{if(this._zooming&&(_.zoom=s.z.number(B,q,Me)),this._rotating&&(_.bearing=s.z.number(T,w,Me)),this._pitching&&(_.pitch=s.z.number(U,I,Me)),this._padding&&(_.interpolatePadding(H,k,Me),Y=_.centerPoint.add(j)),this.terrain&&!a.freezeElevation&&this._updateElevation(Me),ge)_.setLocationAtPoint(ge,we);else{const st=_.zoomScale(_.zoom-B),We=q>B?Math.min(2,pe):Math.max(.5,pe),ke=Math.pow(We,1-Me),Ve=_.unproject(re.add(le.mult(Me*ke)).mult(st));_.setLocationAtPoint(_.renderWorldCopies?Ve.wrap():Ve,Y)}this._applyUpdatedTransform(_),this._fireMoveEvents(d)},Me=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Me)},a),this}_prepareEase(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||_.moving||this.fire(new s.k("movestart",a)),this._zooming&&!_.zooming&&this.fire(new s.k("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new s.k("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new s.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(_-(d-(_*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:_,zoom:B,pitch:T,bearing:U,elevation:H}=this.transformCameraUpdate(d);_&&(d.center=_),B!==void 0&&(d.zoom=B),T!==void 0&&(d.pitch=T),U!==void 0&&(d.bearing=U),H!==void 0&&(d.elevation=H),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new s.k("move",a)),this._zooming&&this.fire(new s.k("zoom",a)),this._rotating&&this.fire(new s.k("rotate",a)),this._pitching&&this.fire(new s.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,B=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.k("zoomend",a)),B&&this.fire(new s.k("rotateend",a)),T&&this.fire(new s.k("pitchend",a)),this.fire(new s.k("moveend",a))}flyTo(a,d){if(!a.essential&&F.prefersReducedMotion){const Rt=s.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,d)}this.stop(),a=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b6},a);const _=this._getTransformForUpdate(),B=this.getZoom(),T=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?s.ac(+a.zoom,_.minZoom,_.maxZoom):B,w="bearing"in a?this._normalizeBearing(a.bearing,T):T,I="pitch"in a?+a.pitch:U,k="padding"in a?a.padding:_.padding,j=_.zoomScale(q-B),Y=s.P.convert(a.offset);let X=_.centerPoint.add(Y);const ee=_.pointLocation(X),re=s.M.convert(a.center||ee);this._normalizeCenter(re);const le=_.project(ee),pe=_.project(re).sub(le);let ge=a.curve;const we=Math.max(_.width,_.height),De=we/j,Me=pe.mag();if("minZoom"in a){const Rt=s.ac(Math.min(a.minZoom,B,q),_.minZoom,_.maxZoom),Ai=we/_.zoomScale(Rt-B);ge=Math.sqrt(Ai/Me*2)}const st=ge*ge;function We(Rt){const Ai=(De*De-we*we+(Rt?-1:1)*st*st*Me*Me)/(2*(Rt?De:we)*st*Me);return Math.log(Math.sqrt(Ai*Ai+1)-Ai)}function ke(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function Ve(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const gt=We(!1);let xt=function(Rt){return Ve(gt)/Ve(gt+ge*Rt)},At=function(Rt){return we*((Ve(gt)*(ke(Ai=gt+ge*Rt)/Ve(Ai))-ke(gt))/st)/Me;var Ai},kt=(We(!0)-gt)/ge;if(Math.abs(Me)<1e-6||!isFinite(kt)){if(Math.abs(we-De)<1e-6)return this.easeTo(a,d);const Rt=De<we?-1:1;kt=Math.abs(Math.log(De/we))/ge,At=function(){return 0},xt=function(Ai){return Math.exp(Rt*ge*Ai)}}return a.duration="duration"in a?+a.duration:1e3*kt/("screenSpeed"in a?+a.screenSpeed/ge:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=T!==w,this._pitching=I!==U,this._padding=!_.isPaddingEqual(k),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(re),this._ease(Rt=>{const Ai=Rt*kt,Ht=1/xt(Ai);_.zoom=Rt===1?q:B+_.scaleZoom(Ht),this._rotating&&(_.bearing=s.z.number(T,w,Rt)),this._pitching&&(_.pitch=s.z.number(U,I,Rt)),this._padding&&(_.interpolatePadding(H,k,Rt),X=_.centerPoint.add(Y)),this.terrain&&!a.freezeElevation&&this._updateElevation(Rt);const vi=Rt===1?re:_.unproject(le.add(pe.mult(At(Ai))).mult(Ht));_.setLocationAtPoint(_.renderWorldCopies?vi.wrap():vi,X),this._applyUpdatedTransform(_),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){_.animate===!1||_.duration===0?(a(1),d()):(this._easeStart=F.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=s.b0(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Ss={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xh{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ss;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=D.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=D.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){D.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const _=this._map._getUIString(`AttributionControl.${d}`);a.title=_,a.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(B=>typeof B!="string"?"":B)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const B=this._map.style.stylesheet;this.styleOwner=B.owner,this.styleId=B.id}const d=this._map.style.sourceCaches;for(const B in d){const T=d[B];if(T.used||T.usedForTerrain){const U=T.getSource();U.attribution&&a.indexOf(U.attribution)<0&&a.push(U.attribution)}}a=a.filter(B=>String(B).trim()),a.sort((B,T)=>B.length-T.length),a=a.filter((B,T)=>{for(let U=T+1;U<a.length;U++)if(a[U].indexOf(B)>=0)return!1;return!0});const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class $n{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=D.create("div","maplibregl-ctrl");const d=D.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){D.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Au{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const B of _)if(B.id===a)return void(B.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ki=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class zi extends s.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const _={};for(const B of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))_[B.key]=!0,this._renderableTilesKeys.push(B.key),this._tiles[B.key]||(B.posMatrix=new Float64Array(16),s.aN(B.posMatrix,0,s.W,0,s.W,0,1),this._tiles[B.key]=new Yi(B,this.tileSize));for(const B in this._tiles)_[B]||delete this._tiles[B]}freeRtt(a){for(const d in this._tiles){const _=this._tiles[d];(!a||_.tileID.equals(a)||_.tileID.isChildOf(a)||a.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const _ of this._renderableTilesKeys){const B=this._tiles[_].tileID;if(B.canonical.equals(a.canonical)){const T=a.clone();T.posMatrix=new Float64Array(16),s.aN(T.posMatrix,0,s.W,0,s.W,0,1),d[_]=T}else if(B.canonical.isChildOf(a.canonical)){const T=a.clone();T.posMatrix=new Float64Array(16);const U=B.canonical.z-a.canonical.z,H=B.canonical.x-(B.canonical.x>>U<<U),q=B.canonical.y-(B.canonical.y>>U<<U),w=s.W>>U;s.aN(T.posMatrix,0,w,0,w,0,1),s.H(T.posMatrix,T.posMatrix,[-H*w,-q*w,0]),d[_]=T}else if(a.canonical.isChildOf(B.canonical)){const T=a.clone();T.posMatrix=new Float64Array(16);const U=a.canonical.z-B.canonical.z,H=a.canonical.x-(a.canonical.x>>U<<U),q=a.canonical.y-(a.canonical.y>>U<<U),w=s.W>>U;s.aN(T.posMatrix,0,s.W,0,s.W,0,1),s.H(T.posMatrix,T.posMatrix,[H*w,q*w,0]),s.J(T.posMatrix,T.posMatrix,[1/2**U,1/2**U,0]),d[_]=T}}return d}getSourceTile(a,d){const _=this.sourceCache._source;let B=a.overscaledZ-this.deltaZoom;if(B>_.maxzoom&&(B=_.maxzoom),B<_.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(B).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!T||!T.dem)&&d)for(;B>=_.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(a.scaledTo(B--).key);return T}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class Kn{constructor(a,d,_){this.painter=a,this.sourceCache=new zi(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;var T;if(!(d>=0&&d<B&&_>=0&&_<B))return 0;const U=this.getTerrainData(a),H=(T=U.tile)===null||T===void 0?void 0:T.dem;if(!H)return 0;const q=function(X,ee,re){var le=ee[0],pe=ee[1];return X[0]=re[0]*le+re[4]*pe+re[12],X[1]=re[1]*le+re[5]*pe+re[13],X}([],[d/B*s.W,_/B*s.W],U.u_terrain_matrix),w=[q[0]*H.dim,q[1]*H.dim],I=Math.floor(w[0]),k=Math.floor(w[1]),j=w[0]-I,Y=w[1]-k;return H.get(I,k)*(1-j)*(1-Y)+H.get(I+1,k)*j*(1-Y)+H.get(I,k+1)*(1-j)*Y+H.get(I+1,k+1)*j*Y}getElevationForLngLatZoom(a,d){const{tileID:_,mercatorX:B,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(_,B%s.W,T%s.W,s.W)}getElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;return this.getDEMElevation(a,d,_,B)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const B=this.painter.context,T=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Pe(B,T,B.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Pe(B,new s.R({width:1,height:1}),B.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const B=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Pe(B,d.dem.getPixels(),B.gl.RGBA,{premultiply:!1}),d.demTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+a.key;if(_&&!this._demMatrixCache[_]){const B=this.sourceCache.sourceCache._source.maxzoom;let T=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=B?T=a.canonical.z-B:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const U=a.canonical.x-(a.canonical.x>>T<<T),H=a.canonical.y-(a.canonical.y>>T<<T),q=s.b8(new Float64Array(16),[1/(s.W<<T),1/(s.W<<T),0]);s.H(q,q,[U*s.W,H*s.W,0]),this._demMatrixCache[a.key]={matrix:q,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,_=d.width/devicePixelRatio,B=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===B||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Pe(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Pe(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,B,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,B))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,U=0;T<this._coordsTextureSize;T++)for(let H=0;H<this._coordsTextureSize;H++,U+=4)d[U+0]=255&H,d[U+1]=255&T,d[U+2]=H>>8<<4|T>>8,d[U+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),B=new Pe(a,_,a.gl.RGBA,{premultiply:!1});return B.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=B,B}pointCoordinate(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const T=d[0]+(d[2]>>4<<8),U=d[1]+((15&d[2])<<8),H=this.coordsIndex[255-d[3]],q=H&&this.sourceCache.getTileByID(H);if(!q)return null;const w=this._coordsTextureSize,I=(1<<q.tileID.canonical.z)*w;return new s.Y((q.tileID.canonical.x*w+T)/I+q.tileID.wrap,(q.tileID.canonical.y*w+U)/I,this.getElevation(q.tileID,T,U,w))}depthAtPoint(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new s.b9,_=new s.aX,B=this.meshSize,T=s.W/B,U=B*B;for(let k=0;k<=B;k++)for(let j=0;j<=B;j++)d.emplaceBack(j*T,k*T,0);for(let k=0;k<U;k+=B+1)for(let j=0;j<B;j++)_.emplaceBack(j+k,B+j+k+1,B+j+k+2),_.emplaceBack(j+k,B+j+k+2,j+k+1);const H=d.length,q=H+2*(B+1);for(const k of[0,1])for(let j=0;j<=B;j++)for(const Y of[0,1])d.emplaceBack(j*T,k*s.W,Y);for(let k=0;k<2*B;k+=2)_.emplaceBack(q+k,q+k+1,q+k+3),_.emplaceBack(q+k,q+k+3,q+k+2),_.emplaceBack(H+k,H+k+3,H+k+1),_.emplaceBack(H+k,H+k+2,H+k+3);const w=d.length,I=w+2*(B+1);for(const k of[0,1])for(let j=0;j<=B;j++)for(const Y of[0,1])d.emplaceBack(k*s.W,j*T,Y);for(let k=0;k<2*B;k+=2)_.emplaceBack(w+k,w+k+1,w+k+3),_.emplaceBack(w+k,w+k+3,w+k+2),_.emplaceBack(I+k,I+k+3,I+k+1),_.emplaceBack(I+k,I+k+2,I+k+3);return this._mesh={indexBuffer:a.createIndexBuffer(_),vertexBuffer:a.createVertexBuffer(d,Ki.members),segments:s.$.simpleSegment(0,0,d.length,_.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*s.ba/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var _;const{tileID:B}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(_=this.getMinMaxElevation(B).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(a,d){const _=s.Y.fromLngLat(a.wrap()),B=(1<<d)*s.W,T=_.x*B,U=_.y*B,H=Math.floor(T/s.W),q=Math.floor(U/s.W);return{tileID:new s.Q(d,0,d,H,q),mercatorX:T,mercatorY:U}}}class Nu{constructor(a,d,_){this._context=a,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new Pe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:a,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const ks={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class rn{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new Nu(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(_=>!a._layers[_].isHidden(d)),this._coordsDescendingInv={};for(const _ in a.sourceCaches){this._coordsDescendingInv[_]={};const B=a.sourceCaches[_].getVisibleCoordinates();for(const T of B){const U=this.terrain.sourceCache.getTerrainCoords(T);for(const H in U)this._coordsDescendingInv[_][H]||(this._coordsDescendingInv[_][H]=[]),this._coordsDescendingInv[_][H].push(U[H])}}this._coordsDescendingInvStr={};for(const _ of a._order){const B=a._layers[_],T=B.source;if(ks[B.type]&&!this._coordsDescendingInvStr[T]){this._coordsDescendingInvStr[T]={};for(const U in this._coordsDescendingInv[T])this._coordsDescendingInvStr[T][U]=this._coordsDescendingInv[T][U].map(H=>H.key).sort().join()}}for(const _ of this._renderableTiles)for(const B in this._coordsDescendingInvStr){const T=this._coordsDescendingInvStr[B][_.tileID.key];T&&T!==_.rttCoords[B]&&(_.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,_=this.painter,B=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(ks[d]&&(this._prevType&&ks[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!B))return!0;if(ks[this._prevType]||ks[d]&&B){this._prevType=d;const T=this._stacks.length-1,U=this._stacks[T]||[];for(const H of this._renderableTiles){if(this.pool.isFull()&&(pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[T]){const w=this.pool.getObjectForId(H.rtt[T].id);if(w.stamp===H.rtt[T].stamp){this.pool.useObject(w);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),H.rtt[T]={id:q.id,stamp:q.stamp},_.context.bindFramebuffer.set(q.fbo.framebuffer),_.context.clear({color:s.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let w=0;w<U.length;w++){const I=_.style._layers[U[w]],k=I.source?this._coordsDescendingInv[I.source][H.tileID.key]:[H.tileID];_.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),_._renderTileClippingMasks(I,k),_.renderLayer(_,_.style.sourceCaches[I.source],I,k),I.source&&(H.rttCoords[I.source]=this._coordsDescendingInvStr[I.source][H.tileID.key])}}return pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ks[d]}return!1}}const ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ko=g,du={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ss,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Os=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Yr={showCompass:!0,showZoom:!0,visualizePitch:!1};class zn{constructor(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=U=>{this.startMouse(s.e({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),D.mousePos(this.element,U)),D.addEventListener(window,"mousemove",this.mousemove),D.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=U=>{this.moveMouse(U,D.mousePos(this.element,U))},this.mouseup=U=>{this.mouseRotate.dragEnd(U),this.mousePitch&&this.mousePitch.dragEnd(U),this.offTemp()},this.touchstart=U=>{U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=D.touchPos(this.element,U.targetTouches)[0],this.startTouch(U,this._startPos),D.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.addEventListener(window,"touchend",this.touchend))},this.touchmove=U=>{U.targetTouches.length!==1?this.reset():(this._lastPos=D.touchPos(this.element,U.targetTouches)[0],this.moveTouch(U,this._lastPos))},this.touchend=U=>{U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const B=a.dragRotate._mouseRotate.getClickTolerance(),T=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=ml({clickTolerance:B,enable:!0}),this.touchRotate=(U=>{let{enable:H,clickTolerance:q,bearingDegreesPerPixelMoved:w=.8}=U;const I=new ea;return new mo({clickTolerance:q,move:(k,j)=>({bearingDelta:(j.x-k.x)*w}),moveStateManager:I,enable:H,assignEvents:Os})})({clickTolerance:B,enable:!0}),this.map=a,_&&(this.mousePitch=Kl({clickTolerance:T,enable:!0}),this.touchPitch=(U=>{let{enable:H,clickTolerance:q,pitchDegreesPerPixelMoved:w=-.5}=U;const I=new ea;return new mo({clickTolerance:q,move:(k,j)=>({pitchDelta:(j.y-k.y)*w}),moveStateManager:I,enable:H,assignEvents:Os})})({clickTolerance:T,enable:!0})),D.addEventListener(d,"mousedown",this.mousedown),D.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),D.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),D.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),D.disableDrag()}moveMouse(a,d){const _=this.map,{bearingDelta:B}=this.mouseRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.mousePitch){const{pitchDelta:T}=this.mousePitch.dragMove(a,d)||{};T&&_.setPitch(_.getPitch()+T)}}moveTouch(a,d){const _=this.map,{bearingDelta:B}=this.touchRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.touchPitch){const{pitchDelta:T}=this.touchPitch.dragMove(a,d)||{};T&&_.setPitch(_.getPitch()+T)}}off(){const a=this.element;D.removeEventListener(a,"mousedown",this.mousedown),D.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend),D.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){D.enableDrag(),D.removeEventListener(window,"mousemove",this.mousemove),D.removeEventListener(window,"mouseup",this.mouseup),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend)}}let Oo;function yl(y,a,d){const _=new s.M(y.lng,y.lat);if(y=new s.M(y.lng,y.lat),a){const B=new s.M(y.lng-360,y.lat),T=new s.M(y.lng+360,y.lat),U=d.locationPoint(y).distSqr(a);d.locationPoint(B).distSqr(a)<U?y=B:d.locationPoint(T).distSqr(a)<U&&(y=T)}for(;Math.abs(y.lng-d.center.lng)>180;){const B=d.locationPoint(y);if(B.x>=0&&B.y>=0&&B.x<=d.width&&B.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y.lng!==_.lng&&d.locationPoint(y).y>d.height/2-d.getHorizon()?y:_}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ka(y,a,d){const _=y.classList;for(const B in nl)_.remove(`maplibregl-${d}-anchor-${B}`);_.add(`maplibregl-${d}-anchor-${a}`)}class Yl extends s.E{constructor(a){if(super(),this._onKeyPress=d=>{const _=d.code,B=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&B!==32&&B!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,B=this._element;this._popup&&(_===B||B.contains(_))&&this.togglePopup()},this._update=d=>{var _;if(!this._map)return;const B=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!B)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yl(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let T="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?T=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(T=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let U="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?U="rotateX(0deg)":this._pitchAlignment==="map"&&(U=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),D.setTransform(this._element,`${nl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${U} ${T}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=D.create("div"),this._element.setAttribute("aria-label","Map marker");const d=D.createNS("http://www.w3.org/2000/svg","svg"),_=41,B=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${B}px`),d.setAttributeNS(null,"viewBox",`0 0 ${B} ${_}`);const T=D.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const U=D.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const H=D.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");const q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of q){const pe=D.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",le.rx),pe.setAttributeNS(null,"ry",le.ry),H.appendChild(pe)}const w=D.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const I=D.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(I);const k=D.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const j=D.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(j);const Y=D.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const X=D.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=D.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const re=D.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),X.appendChild(ee),X.appendChild(re),U.appendChild(H),U.appendChild(w),U.appendChild(k),U.appendChild(Y),U.appendChild(X),d.appendChild(U),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),ka(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),D.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const B=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[B,-1*(38.1-13.5+B)],"bottom-right":[-B,-1*(38.1-13.5+B)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,B=_.terrain.depthAtPoint(this._pos),T=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,T)-B<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/_.transform._pixelPerMeter,H=Math.sin(_.getPitch()*Math.PI/180)*U,q=_.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),w=_.transform.lngLatToCameraDepth(this._lngLat,T+H);this._element.style.opacity=w-q>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const fu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let _o=0,xa=!1;const _l={maxWidth:100,unit:"metric"};function jr(y,a,d){const _=d&&d.maxWidth||100,B=y._container.clientHeight/2,T=y.unproject([0,B]),U=y.unproject([_,B]),H=T.distanceTo(U);if(d&&d.unit==="imperial"){const q=3.2808*H;q>5280?z(a,_,q/5280,y._getUIString("ScaleControl.Miles")):z(a,_,q,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?z(a,_,H/1852,y._getUIString("ScaleControl.NauticalMiles")):H>=1e3?z(a,_,H/1e3,y._getUIString("ScaleControl.Kilometers")):z(a,_,H,y._getUIString("ScaleControl.Meters"))}function z(y,a,d,_){const B=function(T){const U=Math.pow(10,`${Math.floor(T)}`.length-1);let H=T/U;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(q){const w=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*w)/w}(H),U*H}(d);y.style.width=a*(B/d)+"px",y.innerHTML=`${B}&nbsp;${_}`}const A={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},x=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function L(y){if(y){if(typeof y=="number"){const a=Math.round(Math.abs(y)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,y),"top-left":new s.P(a,a),"top-right":new s.P(-a,a),bottom:new s.P(0,-y),"bottom-left":new s.P(a,-a),"bottom-right":new s.P(-a,-a),left:new s.P(y,0),right:new s.P(-y,0)}}if(y instanceof s.P||Array.isArray(y)){const a=s.P.convert(y);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:s.P.convert(y.center||[0,0]),top:s.P.convert(y.top||[0,0]),"top-left":s.P.convert(y["top-left"]||[0,0]),"top-right":s.P.convert(y["top-right"]||[0,0]),bottom:s.P.convert(y.bottom||[0,0]),"bottom-left":s.P.convert(y["bottom-left"]||[0,0]),"bottom-right":s.P.convert(y["bottom-right"]||[0,0]),left:s.P.convert(y.left||[0,0]),right:s.P.convert(y.right||[0,0])}}return L(new s.P(0,0))}const O=g;l.AJAXError=s.bd,l.Evented=s.E,l.LngLat=s.M,l.MercatorCoordinate=s.Y,l.Point=s.P,l.addProtocol=s.be,l.config=s.a,l.removeProtocol=s.bf,l.AttributionControl=xh,l.BoxZoomHandler=Jr,l.CanvasSource=ci,l.CooperativeGesturesHandler=Ws,l.DoubleClickZoomHandler=Ro,l.DragPanHandler=mc,l.DragRotateHandler=hu,l.EdgeInsets=Po,l.FullscreenControl=class extends s.E{constructor(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var a;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=d==null?void 0:d.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){D.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=D.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);D.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},l.GeoJSONSource=ht,l.GeolocateControl=class extends s.E{constructor(y){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new s.M(a.coords.longitude,a.coords.latitude),_=a.coords.accuracy,B=this._map.getBearing(),T=s.e({bearing:B},this.options.fitBoundsOptions),U=Ot.fromLngLat(d,_);this._map.fitBounds(U,T,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new s.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&xa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=D.create("button","maplibregl-ctrl-geolocate",this._container),D.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Yl({element:this._dotElement}),this._circleElement=D.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},fu,y)}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return s._(this,void 0,void 0,function*(){if(Oo!==void 0&&!a)return Oo;if(window.navigator.permissions===void 0)return Oo=!!window.navigator.geolocation,Oo;try{Oo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Oo=!!window.navigator.geolocation}return Oo})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),D.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_o=0,xa=!1}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),d=y.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),a=y.getSouthEast(),d=y.getNorthEast(),_=a.distanceTo(d),B=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${B}px`,this._circleElement.style.height=`${B}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_o--,xa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_o++,_o>1?(y={maximumAge:6e5,timeout:0},xa=!0):(y=this.options.positionOptions,xa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},l.Hash=gl,l.ImageSource=si,l.KeyboardHandler=zc,l.LngLatBounds=Ot,l.LogoControl=$n,l.Map=class extends Vc{constructor(y){if(s.bb.mark(s.bc.create),(y=s.e({},du,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Fo(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Au,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},ta,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=ve.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ge(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=ya(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{a?d(_):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Qc(this,y),this._hash=y.hash&&new gl(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new xh(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new $n,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new s.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,a,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,a,d,_)}resize(y){var a;const d=this._containerDimensions(),_=d[0],B=d[1],T=this._getClampedPixelRatio(_,B);if(this._resizeCanvas(_,B,T),this.painter.resize(_,B,T),this.painter.overLimit()){const H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];const q=this._getClampedPixelRatio(_,B);this._resizeCanvas(_,B,q),this.painter.resize(_,B,q)}this.transform.resize(_,B),(a=this._requestedCameraState)===null||a===void 0||a.resize(_,B);const U=!this._moving;return U&&(this.stop(),this.fire(new s.k("movestart",y)).fire(new s.k("move",y))),this.fire(new s.k("resize",y)),U&&this.fire(new s.k("moveend",y)),this}_getClampedPixelRatio(y,a){const{0:d,1:_}=this._maxCanvasSize,B=this.getPixelRatio(),T=y*B,U=a*B;return Math.min(T>d?d/T:1,U>_?_/U:1)*B}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Ot.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(s.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(s.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,a,d){if(y==="mouseenter"||y==="mouseover"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:T=>{const U=this.getLayer(a)?this.queryRenderedFeatures(T.point,{layers:[a]}):[];U.length?_||(_=!0,d.call(this,new Ln(y,this,T.originalEvent,{features:U}))):_=!1},mouseout:()=>{_=!1}}}}if(y==="mouseleave"||y==="mouseout"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:U=>{(this.getLayer(a)?this.queryRenderedFeatures(U.point,{layers:[a]}):[]).length?_=!0:_&&(_=!1,d.call(this,new Ln(y,this,U.originalEvent)))},mouseout:U=>{_&&(_=!1,d.call(this,new Ln(y,this,U.originalEvent)))}}}}{const _=B=>{const T=this.getLayer(a)?this.queryRenderedFeatures(B.point,{layers:[a]}):[];T.length&&(B.features=T,d.call(this,B),delete B.features)};return{layer:a,listener:d,delegates:{[y]:_}}}}on(y,a,d){if(d===void 0)return super.on(y,a);const _=this._createDelegatedListener(y,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(_);for(const B in _.delegates)this.on(B,_.delegates[B]);return this}once(y,a,d){if(d===void 0)return super.once(y,a);const _=this._createDelegatedListener(y,a,d);for(const B in _.delegates)this.once(B,_.delegates[B]);return this}off(y,a,d){return d===void 0?super.off(y,a):(this._delegatedListeners&&this._delegatedListeners[y]&&(_=>{const B=this._delegatedListeners[y];for(let T=0;T<B.length;T++){const U=B[T];if(U.layer===a&&U.listener===d){for(const H in U.delegates)this.off(H,U.delegates[H]);return B.splice(T,1),this}}})(),this)}queryRenderedFeatures(y,a){if(!this.style)return[];let d;const _=y instanceof s.P||Array.isArray(y),B=_?y:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(_?{}:y)||{},B instanceof s.P||typeof B[0]=="number")d=[s.P.convert(B)];else{const T=s.P.convert(B[0]),U=s.P.convert(B[1]);d=[T,new s.P(U.x,T.y),U,new s.P(T.x,U.y),T]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}setStyle(y,a){return(a=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(y,a))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Gn(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,a,d):this.style.loadJSON(y,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,Se.Style);s.h(d,new AbortController).then(_=>{this._updateDiff(_.data,a)}).catch(_=>{_&&this.fire(new s.j(_))})}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y,a)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){const a=this.style&&this.style.sourceCaches[y];if(a!==void 0)return a.loaded();this.fire(new s.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const a=this.style.sourceCaches[y.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===y.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Kn(this.painter,a,y),this.painter.renderToTexture=new rn(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:y})),this}getTerrain(){var y,a;return(a=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const a in y){const d=y[a]._tiles;for(const _ in d){const B=d[_];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:_=1,sdf:B=!1,stretchX:T,stretchY:U,content:H}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||s.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:w,data:I}=a,k=a;return this.style.addImage(y,{data:new s.R({width:q,height:w},new Uint8Array(I)),pixelRatio:_,stretchX:T,stretchY:U,content:H,sdf:B,version:0,userImage:k}),k.onAdd&&k.onAdd(this,y),this}}{const{width:q,height:w,data:I}=F.getImageData(a);this.style.addImage(y,{data:new s.R({width:q,height:w},I),pixelRatio:_,stretchX:T,stretchY:U,content:H,sdf:B,version:0})}}updateImage(y,a){const d=this.style.getImage(y);if(!d)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof HTMLImageElement||s.b(a)?F.getImageData(a):a,{width:B,height:T,data:U}=_;if(B===void 0||T===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(B!==d.data.width||T!==d.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const H=!(a instanceof HTMLImageElement||s.b(a));return d.data.replace(U,H),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return ve.getImage(this._requestManager.transformRequest(y,Se.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,a,d){return this.style.setLayerZoomRange(y,a,d),this._update(!0)}setFilter(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(y,a,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(y,a,d,_),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(y,a,d,_),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setGlyphs(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(y,a,d,_=>{_||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(y,a,d=>{d||this._update(!0)}),this}setLight(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,a=0;return this._container&&(y=this._container.clientWidth||400,a=this._container.clientHeight||300),[y,a]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const a=this._canvasContainer=D.create("div","maplibregl-canvas-container",y);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=D.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const B=this._controlContainer=D.create("div","maplibregl-control-container",y),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(U=>{T[U]=D.create("div",`maplibregl-ctrl-${U} `,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{a={requestedAttributes:y},_&&(a.statusMessage=_.statusMessage,a.type=_.type)},{once:!0});const d=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!d){const _="Failed to initialize WebGL";throw a?(a.message=_,new Error(JSON.stringify(a))):new Error(_)}this.painter=new po(d,this.transform),N.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,T=F.now();this.style.zoomHistory.update(B,T);const U=new s.a8(B,{now:T,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=U.crossFadingFactor();H===1&&H===this._crossFadingFactor||(d=!0,this._crossFadingFactor=H),this.style.update(U)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bb.mark(s.bc.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,s.bb.mark(s.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ve.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),D.remove(this._canvasContainer),D.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bb.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(y=>{s.bb.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return ko}getCameraTargetElevation(){return this.transform.elevation}},l.MapMouseEvent=Ln,l.MapTouchEvent=Do,l.MapWheelEvent=ds,l.Marker=Yl,l.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),_=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);a.title=_,a.setAttribute("aria-label",_)},this.options=s.e({},Yr,y),this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),D.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),D.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=D.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){D.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,a){const d=D.create("button",y,this._container);return d.type="button",d.addEventListener("click",a),d}},l.Popup=class extends s.E{constructor(y){super(),this.remove=()=>(this._content&&D.remove(this._content),this._container&&(D.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=D.create("div","maplibregl-popup",this._map.getContainer()),this._tip=D.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const H of this.options.className.split(" "))this._container.classList.add(H);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yl(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!a)return;const _=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let B=this.options.anchor;const T=L(this.options.offset);if(!B){const H=this._container.offsetWidth,q=this._container.offsetHeight;let w;w=_.y+T.bottom.y<q?["top"]:_.y>this._map.transform.height-q?["bottom"]:[],_.x<H/2?w.push("left"):_.x>this._map.transform.width-H/2&&w.push("right"),B=w.length===0?"bottom":w.join("-")}let U=_.add(T[B]);this.options.subpixelPositioning||(U=U.round()),D.setTransform(this._container,`${nl[B]} translate(${U.x}px,${U.y}px)`),ka(this._container,B,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(A),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=s.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const a=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=y;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=D.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=D.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(x);y&&y.focus()}},l.RasterDEMTileSource=ti,l.RasterTileSource=ki,l.ScaleControl=class{constructor(y){this._onMove=()=>{jr(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,jr(this._map,this._container,this.options)},this.options=s.e({},_l,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){D.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},l.ScrollZoomHandler=Es,l.Style=Gn,l.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=D.create("button","maplibregl-ctrl-terrain",this._container),D.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){D.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},l.TwoFingersTouchPitchHandler=Uc,l.TwoFingersTouchRotateHandler=Xl,l.TwoFingersTouchZoomHandler=yo,l.TwoFingersTouchZoomRotateHandler=ba,l.VectorTileSource=wt,l.VideoSource=fi,l.addSourceType=(y,a)=>s._(void 0,void 0,void 0,function*(){if(ir(y))throw new Error(`A source type called "${y}" already exists.`);((d,_)=>{Wi[d]=_})(y,a)}),l.clearPrewarmedResources=function(){const y=pt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Ze),pt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},l.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},l.getRTLTextPluginStatus=function(){return zt().getRTLTextPluginStatus()},l.getVersion=function(){return O},l.getWorkerCount=function(){return tt.workerCount},l.getWorkerUrl=function(){return s.a.WORKER_URL},l.importScriptInWorkers=function(y){return Gt().broadcast("importScript",y)},l.prewarm=function(){Ft().acquire(Ze)},l.setMaxParallelImageRequests=function(y){s.a.MAX_PARALLEL_IMAGE_REQUESTS=y},l.setRTLTextPlugin=function(y,a){return zt().setRTLTextPlugin(y,a)},l.setWorkerCount=function(y){tt.workerCount=y},l.setWorkerUrl=function(y){s.a.WORKER_URL=y}});var o=t;return o})})(zI);var m8=zI.exports;const rc=Um(m8);var Qa;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(Qa||(Qa={}));const Nm=4,zm=4,Qm=4,ed=new Int32Array(2),QI=new Float32Array(ed.buffer),VI=new Float64Array(ed.buffer),T_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Yx;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Yx||(Yx={}));class mA{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new mA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return ed[0]=this.readInt32(e),QI[0]}readFloat64(e){return ed[T_?0:1]=this.readInt32(e),ed[T_?1:0]=this.readInt32(e+4),VI[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){QI[0]=t,this.writeInt32(e,ed[0])}writeFloat64(e,t){VI[0]=t,this.writeInt32(e,ed[T_?0:1]),this.writeInt32(e+4,ed[T_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Nm+zm)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<zm;t++)e+=String.fromCharCode(this.readInt8(this.position_+Nm+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=Nm;const n=this.bytes_.subarray(e,e+r);return t===Yx.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Nm}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=zm)throw new Error("FlatBuffers: file identifier must be length "+zm);for(let t=0;t<zm;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Nm+t))return!1;return!0}createScalarList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o)}return r}createObjList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o.unpack())}return r}}let y8=class Wc{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Wc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Qm),(t||new Wc).__init(e.readInt32(e.position())+e.position(),e)}ends(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}endsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}xyLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}zLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}mLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}tLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}tmLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Qa.Unknown}parts(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Wc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}partsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Qa.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,n,o,l,s,g,b){return Wc.startGeometry(e),Wc.addEnds(e,t),Wc.addXy(e,r),Wc.addZ(e,n),Wc.addM(e,o),Wc.addT(e,l),Wc.addTm(e,s),Wc.addType(e,g),Wc.addParts(e,b),Wc.endGeometry(e)}};function ew(i,e){const t=[];for(let r=0;r<i.length;r+=2){const n=[i[r],i[r+1]];e&&n.push(e[r>>1]),t.push(n)}return t}function HI(i,e,t){if(!t||t.length===0)return[ew(i,e)];let r=0;const n=Array.from(t).map(l=>i.slice(r,r=l<<1));let o;return e&&(r=0,o=Array.from(t).map(l=>e.slice(r,r=l))),n.map((l,s)=>ew(l,o?o[s]:void 0))}function _8(i,e){const t=i.xyArray(),r=i.zArray();switch(e){case Qa.Point:{const n=Array.from(t);return r&&n.push(r[0]),n}case Qa.MultiPoint:case Qa.LineString:return ew(t,r);case Qa.MultiLineString:return HI(t,r,i.endsArray());case Qa.Polygon:return HI(t,r,i.endsArray())}}function tw(i,e){let t=e;if(t===Qa.Unknown&&(t=i.type()),t===Qa.GeometryCollection){const n=[];for(let o=0;o<i.partsLength();o++){const l=i.parts(o),s=l.type();n.push(tw(l,s))}return{type:Qa[t],geometries:n}}else if(t===Qa.MultiPolygon){const n=[];for(let o=0;o<i.partsLength();o++)n.push(tw(i.parts(o),Qa.Polygon));return{type:Qa[t],coordinates:n.map(o=>o.coordinates)}}const r=_8(i,t);return{type:Qa[t],coordinates:r}}var Va;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(Va||(Va={}));class Ha{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Ha).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Qm),(t||new Ha).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Va.Byte}title(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){const e=this.bb.__offset(this.bb_pos,18);return e?!!this.bb.readInt8(this.bb_pos+e):!0}unique(){const e=this.bb.__offset(this.bb_pos,20);return e?!!this.bb.readInt8(this.bb_pos+e):!1}primaryKey(){const e=this.bb.__offset(this.bb_pos,22);return e?!!this.bb.readInt8(this.bb_pos+e):!1}metadata(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Va.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){const t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,n,o,l,s,g,b,S,F,D){return Ha.startColumn(e),Ha.addName(e,t),Ha.addType(e,r),Ha.addTitle(e,n),Ha.addDescription(e,o),Ha.addWidth(e,l),Ha.addPrecision(e,s),Ha.addScale(e,g),Ha.addNullable(e,b),Ha.addUnique(e,S),Ha.addPrimaryKey(e,F),Ha.addMetadata(e,D),Ha.endColumn(e)}}class Zu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Zu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Qm),(t||new Zu).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){const t=this.bb.__offset(this.bb_pos,4);return t?(e||new y8).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){const r=this.bb.__offset(this.bb_pos,8);return r?(t||new Ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,n){return Zu.startFeature(e),Zu.addGeometry(e,t),Zu.addProperties(e,r),Zu.addColumns(e,n),Zu.endFeature(e)}}new TextEncoder;const GI=new TextDecoder;function v8(i,e){const t={};if(!e||e.length===0)return t;const r=i.propertiesArray();if(!r)return t;const n=new DataView(r.buffer,r.byteOffset),o=i.propertiesLength();let l=0;for(;l<o;){const s=n.getUint16(l,!0);l+=2;const g=e[s],b=g.name;switch(g.type){case Va.Bool:{t[b]=!!n.getUint8(l),l+=1;break}case Va.Byte:{t[b]=n.getInt8(l),l+=1;break}case Va.UByte:{t[b]=n.getUint8(l),l+=1;break}case Va.Short:{t[b]=n.getInt16(l,!0),l+=2;break}case Va.UShort:{t[b]=n.getUint16(l,!0),l+=2;break}case Va.Int:{t[b]=n.getInt32(l,!0),l+=4;break}case Va.UInt:{t[b]=n.getUint32(l,!0),l+=4;break}case Va.Long:{t[b]=Number(n.getBigInt64(l,!0)),l+=8;break}case Va.ULong:{t[b]=Number(n.getBigUint64(l,!0)),l+=8;break}case Va.Float:{t[b]=n.getFloat32(l,!0),l+=4;break}case Va.Double:{t[b]=n.getFloat64(l,!0),l+=8;break}case Va.DateTime:case Va.String:{const S=n.getUint32(l,!0);l+=4,t[b]=GI.decode(r.subarray(l,l+S)),l+=S;break}case Va.Json:{const S=n.getUint32(l,!0);l+=4;const F=GI.decode(r.subarray(l,l+S));t[b]=JSON.parse(F),l+=S;break}default:throw new Error("Unknown type "+g.type)}}return t}function iw(i,e){const t=e.columns;return{type:"Feature",geometry:tw(i.geometry(),e.geometryType),properties:v8(i,t)}}const rw=new Uint8Array(0);function b8(){return this._source.cancel()}function x8(i,e){if(!i.length)return e;if(!e.length)return i;var t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function w8(){var i=this,e=i._array.subarray(i._index);return i._source.read().then(function(t){return i._array=rw,i._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:x8(e,t.value)}})}function B8(i){if((i|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function n(){return e._source.read().then(function(o){return o.done?(e._array=rw,e._index=0,t>0?r.subarray(0,t):null):t+o.value.length>=i?(e._array=o.value,e._index=i-t,r.set(o.value.subarray(0,i-t),t),r):(r.set(o.value,t),t+=o.value.length,n())})}()}function C8(i){return typeof i.slice=="function"?i:new I_(typeof i.read=="function"?i:i.getReader())}function I_(i){this._source=i,this._array=rw,this._index=0}I_.prototype.read=w8,I_.prototype.slice=B8,I_.prototype.cancel=b8;class xu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new xu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Qm),(t||new xu).__init(e.readInt32(e.position())+e.position(),e)}org(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,n,o,l,s){return xu.startCrs(e),xu.addOrg(e,t),xu.addCode(e,r),xu.addName(e,n),xu.addDescription(e,o),xu.addWkt(e,l),xu.addCodeString(e,s),xu.endCrs(e)}}class L_{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new L_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Qm),(t||new L_).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}envelopeLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Qa.Unknown}hasZ(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasM(){const e=this.bb.__offset(this.bb_pos,12);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasT(){const e=this.bb.__offset(this.bb_pos,14);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasTm(){const e=this.bb.__offset(this.bb_pos,16);return e?!!this.bb.readInt8(this.bb_pos+e):!1}columns(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){const t=this.bb.__offset(this.bb_pos,24);return t?(e||new xu).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Qa.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function nw(i){const e=L_.getRootAsHeader(i),t=e.featuresCount(),r=e.indexNodeSize(),n=[];for(let g=0;g<e.columnsLength();g++){const b=e.columns(g);if(!b)throw new Error("Column unexpectedly missing");if(!b.name())throw new Error("Column name unexpectedly missing");n.push({name:b.name(),type:b.type(),title:b.title(),description:b.description(),width:b.width(),precision:b.precision(),scale:b.scale(),nullable:b.nullable(),unique:b.unique(),primary_key:b.primaryKey()})}const o=e.crs(),l=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:n,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:l,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var sw=function(i,e){return sw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},sw(i,e)};function E8(i,e){sw(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function zp(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(S){try{b(r.next(S))}catch(F){l(F)}}function g(S){try{b(r.throw(S))}catch(F){l(F)}}function b(S){S.done?o(S.value):n(S.value).then(s,g)}b((r=r.apply(i,e||[])).next())})}function td(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(b){return function(S){return g([b,S])}}function g(b){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=b[0]&2?n.return:b[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,b[1])).done)return o;switch(n=0,o&&(b=[b[0]&2,o.value]),b[0]){case 0:case 1:o=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,n=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!o||b[1]>o[0]&&b[1]<o[3])){t.label=b[1];break}if(b[0]===6&&t.label<o[1]){t.label=o[1],o=b;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(b);break}o[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(i,t)}catch(S){b=[6,S],n=0}finally{r=o=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Qp(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Vm(i){return this instanceof Vm?(this.v=i,this):new Vm(i)}function S8(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(i,e||[]),n,o=[];return n={},l("next"),l("throw"),l("return"),n[Symbol.asyncIterator]=function(){return this},n;function l(D){r[D]&&(n[D]=function(N){return new Promise(function(J,te){o.push([D,N,J,te])>1||s(D,N)})})}function s(D,N){try{g(r[D](N))}catch(J){F(o[0][3],J)}}function g(D){D.value instanceof Vm?Promise.resolve(D.value.v).then(b,S):F(o[0][2],D)}function b(D){s("next",D)}function S(D){s("throw",D)}function F(D,N){D(N),o.shift(),o.length&&s(o[0][0],o[0][1])}}var jI=function(i){E8(e,i);function e(t){var r=i.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function i(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}();function ow(i){i!=null&&typeof i.then=="function"&&i.then(F_,F_)}var aw=0,qI=1,uf=2,M_=3,lw=4,P_=1024,F_=function(){};function Vp(i){var e=i.err,t=Promise.resolve(i.execution).then(function(r){if(e!=null)throw e;return r});return i.err=void 0,i.execution=t.then(function(){},function(){}),i.pending===void 0?t:i.pending.then(function(){return t})}function hf(i,e){var t=i.state>=M_;return Promise.resolve(e).then(function(r){return!t&&i.state>=lw?Vp(i).then(function(n){return{value:n,done:!0}}):{value:r,done:t}})}function cw(i,e){var t,r;if(!(i.state>=uf))if(i.state=uf,i.onnext(),i.onstop(),i.err==null&&(i.err=e),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))Hm(i);else try{for(var n=Qp(i.pushes),o=n.next();!o.done;o=n.next()){var l=o.value;l.resolve()}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}function Hm(i){var e,t;if(!(i.state>=M_)){i.state<uf&&cw(i),i.state=M_,i.buffer=void 0;try{for(var r=Qp(i.nexts),n=r.next();!n.done;n=r.next()){var o=n.value,l=i.pending===void 0?Vp(i):i.pending.then(function(){return Vp(i)});o.resolve(hf(i,l))}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}i.pushes=[],i.nexts=[]}}function $I(i){i.state>=lw||(i.state<M_&&Hm(i),i.state=lw)}function T8(i,e){if(ow(e),i.pushes.length>=P_)throw new jI("No more than "+P_+" pending calls to push are allowed on a single repeater.");if(i.state>=uf)return Promise.resolve(void 0);var t=i.pending===void 0?Promise.resolve(e):i.pending.then(function(){return e});t=t.catch(function(g){i.state<uf&&(i.err=g),$I(i)});var r;if(i.nexts.length){var n=i.nexts.shift();n.resolve(hf(i,t)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(g){return i.onnext=g})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(g){return i.pushes.push({resolve:g,value:t})});var o=!0,l={},s=r.catch(function(g){if(o)throw g});return l.then=function(g,b){return o=!1,Promise.prototype.then.call(r,g,b)},l.catch=function(g){return o=!1,Promise.prototype.catch.call(r,g)},l.finally=r.finally.bind(r),i.pending=t.then(function(){return s}).catch(function(g){i.err=g,$I(i)}),l}function I8(i){var e=cw.bind(null,i),t=new Promise(function(r){return i.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function L8(i){if(!(i.state>=qI)){i.state=qI;var e=T8.bind(null,i),t=I8(i);i.execution=new Promise(function(r){return r(i.executor(e,t))}),i.execution.catch(function(){return cw(i)})}}var D_=new WeakMap,Gm=function(){function i(e,t){D_.set(this,{executor:e,buffer:t,err:void 0,state:aw,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:F_,onstop:F_})}return i.prototype.next=function(e){ow(e);var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=P_)throw new jI("No more than "+P_+" pending calls to next are allowed on a single repeater.");if(t.state<=aw&&L8(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=hf(t,t.buffer.remove());if(t.pushes.length){var n=t.pushes.shift();t.buffer.add(n.value),t.onnext=n.resolve}return r}else if(t.pushes.length){var o=t.pushes.shift();return t.onnext=o.resolve,hf(t,o.value)}else if(t.state>=uf)return Hm(t),hf(t,Vp(t));return new Promise(function(l){return t.nexts.push({resolve:l,value:e})})},i.prototype.return=function(e){ow(e);var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");return Hm(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),hf(t,Vp(t))},i.prototype.throw=function(e){var t=D_.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=aw||t.state>=uf||typeof t.buffer<"u"&&!t.buffer.empty?(Hm(t),t.err==null&&(t.err=e),hf(t,Vp(t))):this.next(Promise.reject(e))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=M8,i.merge=P8,i.zip=F8,i.latest=D8,i}();function R_(i,e){var t,r,n=[],o=function(b){b!=null&&typeof b[Symbol.asyncIterator]=="function"?n.push(b[Symbol.asyncIterator]()):b!=null&&typeof b[Symbol.iterator]=="function"?n.push(b[Symbol.iterator]()):n.push(function(){return S8(this,arguments,function(){return td(this,function(D){switch(D.label){case 0:return e.yieldValues?[4,Vm(b)]:[3,3];case 1:return[4,D.sent()];case 2:D.sent(),D.label=3;case 3:return e.returnValues?[4,Vm(b)]:[3,5];case 4:return[2,D.sent()];case 5:return[2]}})})}())};try{for(var l=Qp(i),s=l.next();!s.done;s=l.next()){var g=s.value;o(g)}}catch(b){t={error:b}}finally{try{s&&!s.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return n}function M8(i){var e=this,t=R_(i,{returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g,b,S;return td(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2];l=!1,n.then(function(){o(),l=!0}),F.label=1;case 1:F.trys.push([1,,5,7]),g=void 0,b=0,S=function(){var D,N,J,te,he,ue;return td(this,function(fe){switch(fe.label){case 0:D=b;try{for(N=(he=void 0,Qp(t)),J=N.next();!J.done;J=N.next())te=J.value,Promise.resolve(te.next()).then(function(ve){ve.done?(n(),s===void 0&&(s=ve)):b===D&&(b++,o(ve))},function(ve){return n(ve)})}catch(ve){he={error:ve}}finally{try{J&&!J.done&&(ue=N.return)&&ue.call(N)}finally{if(he)throw he.error}}return[4,new Promise(function(ve){return o=ve})];case 1:return g=fe.sent(),g===void 0?[3,3]:[4,r(g.value)];case 2:fe.sent(),fe.label=3;case 3:return[2]}})},F.label=2;case 2:return l?[3,4]:[5,S()];case 3:return F.sent(),[3,2];case 4:return[2,s&&s.value];case 5:return n(),[4,Promise.race(t.map(function(D){return D.return&&D.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}function P8(i){var e=this,t=R_(i,{yieldValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g=this;return td(this,function(b){switch(b.label){case 0:if(!t.length)return n(),[2];o=[],l=!1,n.then(function(){var S,F;l=!0;try{for(var D=Qp(o),N=D.next();!N.done;N=D.next()){var J=N.value;J()}}catch(te){S={error:te}}finally{try{N&&!N.done&&(F=D.return)&&F.call(D)}finally{if(S)throw S.error}}}),b.label=1;case 1:return b.trys.push([1,,3,4]),[4,Promise.all(t.map(function(S,F){return zp(g,void 0,void 0,function(){var D,N;return td(this,function(J){switch(J.label){case 0:J.trys.push([0,,6,9]),J.label=1;case 1:return l?[3,5]:(Promise.resolve(S.next()).then(function(te){return o[F](te)},function(te){return n(te)}),[4,new Promise(function(te){o[F]=te})]);case 2:return D=J.sent(),D===void 0?[3,4]:D.done?(s=D,[2]):[4,r(D.value)];case 3:J.sent(),J.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return N=S.return,N?[4,S.return()]:[3,8];case 7:N=J.sent(),J.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return b.sent(),[2,s&&s.value];case 3:return n(),[7];case 4:return[2]}})})})}function F8(i){var e=this,t=R_(i,{returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g;return td(this,function(b){switch(b.label){case 0:if(!t.length)return n(),[2,[]];l=!1,n.then(function(){o(),l=!0}),b.label=1;case 1:b.trys.push([1,,6,8]),b.label=2;case 2:return l?[3,5]:(Promise.all(t.map(function(S){return S.next()})).then(function(S){return o(S)},function(S){return n(S)}),[4,new Promise(function(S){return o=S})]);case 3:return s=b.sent(),s===void 0?[2]:(g=s.map(function(S){return S.value}),s.some(function(S){return S.done})?[2,g]:[4,r(g)]);case 4:return b.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(t.map(function(S){return S.return&&S.return()}))];case 7:return b.sent(),[7];case 8:return[2]}})})})}function D8(i){var e=this,t=R_(i,{yieldValues:!0,returnValues:!0});return new Gm(function(r,n){return zp(e,void 0,void 0,function(){var o,l,s,g,b,S=this;return td(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2,[]];l=[],s=!1,n.then(function(){var D,N;o();try{for(var J=Qp(l),te=J.next();!te.done;te=J.next()){var he=te.value;he()}}catch(ue){D={error:ue}}finally{try{te&&!te.done&&(N=J.return)&&N.call(J)}finally{if(D)throw D.error}}s=!0}),F.label=1;case 1:return F.trys.push([1,,5,7]),Promise.all(t.map(function(D){return D.next()})).then(function(D){return o(D)},function(D){return n(D)}),[4,new Promise(function(D){return o=D})];case 2:return g=F.sent(),g===void 0?[2]:(b=g.map(function(D){return D.value}),g.every(function(D){return D.done})?[2,b]:[4,r(b.slice())]);case 3:return F.sent(),[4,Promise.all(t.map(function(D,N){return zp(S,void 0,void 0,function(){var J;return td(this,function(te){switch(te.label){case 0:if(g[N].done)return[2,g[N].value];te.label=1;case 1:return s?[3,4]:(Promise.resolve(D.next()).then(function(he){return l[N](he)},function(he){return n(he)}),[4,new Promise(function(he){return l[N]=he})]);case 2:return J=te.sent(),J===void 0?[2,g[N].value]:J.done?[2,J.value]:(b[N]=J.value,[4,r(b.slice())]);case 3:return te.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,F.sent()];case 5:return n(),[4,Promise.all(t.map(function(D){return D.return&&D.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}class k_{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}}k_.global=new k_;var Ju;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(Ju||(Ju={}));class Ga{static debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Debug,...t)}static info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Info,...t)}static warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Warn,...t)}static error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Ju.Error,...t)}static log(e){if(!(this.logLevel>e)){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];switch(e){case Ju.Debug:{console.debug(...r);break}case Ju.Info:{console.info(...r);break}case Ju.Warn:{console.warn(...r);break}case Ju.Error:{console.error(...r);break}}}}}Ga.logLevel=Ju.Warn;const Af=8*4+8,R8=16;function uw(i,e){e=Math.min(Math.max(+e,2),65535);let t=i,r=t;do t=Math.ceil(t/e),r+=t;while(t!==1);return r*Af}function k8(i,e){if(e<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let t=i,r=t;const n=[t];do t=Math.ceil(t/e),r+=t,n.push(t);while(t!==1);const o=[];t=r;for(const s of n)o.push(t-s),t-=s;const l=[];for(let s=0;s<n.length;s++)l.push([o[s],o[s]+n[s]]);return l}async function*O8(i,e,t,r){class n{constructor(J,te){this._level=te,this.nodes=J}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(J){console.assert(J>this.nodes[1]),this.nodes[1]=J}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:o,minY:l,maxX:s,maxY:g}=t;Ga.info(`tree items: ${i}, nodeSize: ${e}`);const b=k8(i,e),S=b[0][0],D=[(()=>{const N=[0,1],J=b.length-1;return new n(N,J)})()];for(Ga.debug(`starting stream search with queue: ${D}, numItems: ${i}, nodeSize: ${e}, levelBounds: ${b}`);D.length!=0;){const N=D.shift();Ga.debug(`popped node: ${N}, queueLength: ${D.length}`);const J=N.startNodeIdx(),te=J>=S,he=(()=>{const[,Se]=b[N.level()],Ge=Math.min(N.endNodeIdx()+e,Se);return te&&Ge<Se?Ge+1:Ge})(),ue=he-J,fe=await r(J*Af,ue*Af),ve=new DataView(fe);for(let Se=J;Se<he;Se++){const Ge=Se-J,He=Ge*Af;if(s<ve.getFloat64(He+0,!0)||g<ve.getFloat64(He+8,!0)||o>ve.getFloat64(He+16,!0)||l>ve.getFloat64(He+24,!0))continue;const $e=ve.getBigUint64(He+32,!0);if(te){const Pe=$e,Je=(()=>{if(Se<i-1){const Ct=(Ge+1)*Af;return ve.getBigUint64(Ct+32,!0)-Pe}else return null})(),Xe=Se-S;yield[Number(Pe),Xe,Number(Je)];continue}const Ne=$e,at=k_.global.extraRequestThreshold()/Af,rt=D[D.length-1];if(rt!==void 0&&rt.level()==N.level()-1&&Ne<rt.endNodeIdx()+at){Ga.debug(`Merging "nodeRange" request into existing range: ${rt}, newEndNodeIdx: ${rt.endNodeIdx()} -> ${Ne}`),rt.extendEndNodeIdx(Number(Ne));continue}const Re=(()=>{const Pe=N.level()-1,Je=[Number(Ne),Number(Ne)+1];return new n(Je,Pe)})();rt!==void 0&&rt.level()==Re.level()?Ga.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Ne} rather than merging with distant ${rt}`):Ga.info(`Pushing new level for ${Re} onto queue with nearestNodeRange: ${rt} since there's not already a range for this level.`),D.push(Re)}}}const id=new Uint8Array([102,103,98,3,102,103,98,0]),yA=4;class hw{constructor(e,t,r,n){this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=n}static async open(e){const r=new KI(e),n=(()=>{const F=R8,D=3;let N=0,J;for(J=0;J<D;J++){const te=F**J*Af;N+=te}return N})(),o=2024+n;Ga.debug(`fetching header. minReqLength: ${o} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const F=new Uint8Array(await r.getRange(0,8,o,"header"));if(!F.subarray(0,3).every((D,N)=>id[N]===D))throw Ga.error(`bytes: ${F} != ${id}`),new Error("Not a FlatGeobuf file");Ga.debug("magic bytes look good")}let l;{const F=await r.getRange(8,4,o,"header");l=new DataView(F).getUint32(0,!0);const D=1048576*10;if(l>D||l<8)throw new Error("Invalid header size");Ga.debug(`headerLength: ${l}`)}const s=await r.getRange(12,l,o,"header"),g=new mA(new Uint8Array(s)),b=nw(g),S=uw(b.featuresCount,b.indexNodeSize);return Ga.debug("completed: opening http reader"),new hw(r,b,l,S)}async*selectBbox(e){const t=this.lengthBeforeTree(),r=this.headerClient,n=async function(g,b){return r.getRange(t+g,b,0,"index")},o=[];let l=[];for await(const g of O8(this.header.featuresCount,this.header.indexNodeSize,e,n)){const[b,,]=g;let[,,S]=g;if(S||(Ga.info("final feature"),S=4),l.length==0){l.push([b,S]);continue}const F=l[l.length-1],D=b-(F[0]+F[1]);D>k_.global.extraRequestThreshold()&&(Ga.info(`Pushing new feature batch, since gap ${D} was too large`),o.push(l),l=[]),l.push([b,S])}this.headerClient.logUsage("header+index"),l.length>0&&o.push(l);const s=o.flatMap(g=>this.readFeatureBatch(g));yield*Gm.merge(s)}lengthBeforeTree(){return id.length+yA+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(){return new KI(this.headerClient.httpClient)}async*readFeatureBatch(e){const[t]=e[0],[r,n]=e[e.length-1],o=t,s=r+n-o,g=this.buildFeatureClient();let b=s;for(const[S]of e)yield await this.readFeature(g,S,b),b=0;g.logUsage("feature")}async readFeature(e,t,r){const n=t+this.lengthBeforeFeatures();let o;{const S=await e.getRange(n,4,r,"feature length");o=new DataView(S).getUint32(0,!0)}const l=await e.getRange(n+4,o,r,"feature data"),s=new Uint8Array(l),g=new Uint8Array(o+yA);g.set(s,yA);const b=new mA(g);return b.setPosition(yA),Zu.getRootAsFeature(b)}}class KI{constructor(e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof e=="string")this.httpClient=new WI(e);else if(e instanceof WI)this.httpClient=e;else throw new Error("Unknown source ")}async getRange(e,t,r,n){this.bytesEverUsed+=t;const o=e-this.head,l=o+t;if(o>=0&&l<=this.buffer.byteLength)return this.buffer.slice(o,l);const s=Math.max(t,r);return this.bytesEverFetched+=s,Ga.debug(`requesting for new Range: ${e}-${e+s-1}`),this.buffer=await this.httpClient.getRange(e,s,n),this.head=e,this.buffer.slice(0,t)}logUsage(e){const t=e.split(" ")[0],r=this.bytesEverUsed,n=this.bytesEverFetched,o=(100*r/n).toFixed(2);Ga.info(`${t} bytes used/requested: ${r} / ${n} = ${o}%`)}}class WI{constructor(e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;const n=`bytes=${e}-${e+t-1}`;return Ga.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${t}, ever: ${this.bytesEverRequested}), Range: ${n}`),(await fetch(this.url,{headers:{Range:n}})).arrayBuffer()}}function U8(i,e,t){if(!i.subarray(0,3).every((S,F)=>id[F]===S))throw new Error("Not a FlatGeobuf file");const r=new mA(i),n=r.readUint32(id.length);r.setPosition(id.length+yA);const o=nw(r);t&&t(o);let l=id.length+yA+n;const{indexNodeSize:s,featuresCount:g}=o;s>0&&(l+=uw(g,s));const b=[];for(;l<r.capacity();){const S=r.readUint32(l);r.setPosition(l+yA);const F=Zu.getRootAsFeature(r);b.push(e(F,o)),l+=yA+S}return b}async function*N8(i,e,t){const r=C8(i),n=async D=>await r.slice(D);let o=new Uint8Array(await n(8));if(!o.subarray(0,3).every((D,N)=>id[N]===D))throw new Error("Not a FlatGeobuf file");o=new Uint8Array(await n(4));let l=new mA(o);const s=l.readUint32(0);o=new Uint8Array(await n(s)),l=new mA(o);const g=nw(l);t&&t(g);const{indexNodeSize:b,featuresCount:S}=g;if(b>0){const D=uw(S,b);await n(D)}let F;for(;F=await Q8(n,g,e);)yield F}async function*z8(i,e,t,r){const n=await hw.open(i);Ga.debug("opened reader"),r&&r(n.header);for await(const o of n.selectBbox(e))yield t(o,n.header)}async function Q8(i,e,t){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let n=new mA(r);const o=n.readUint32(0);r=new Uint8Array(await i(o,"feature data"));const l=new Uint8Array(o+4);l.set(r,4),n=new mA(l),n.setPosition(yA);const s=Zu.getRootAsFeature(n);return t(s,e)}function V8(i,e){return{type:"FeatureCollection",features:U8(i,iw,e)}}function H8(i,e){return N8(i,iw,e)}function G8(i,e,t){return z8(i,e,iw,t)}function j8(i,e,t){return i instanceof Uint8Array?V8(i,t):i instanceof ReadableStream?H8(i,t):G8(i,e,t)}class q8{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let b={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(b.zoom=t._minpitchzoom);var r=0,n=38.5,o=6,l=62.33,{longitude:s,latitude:g}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainMapZen",exaggeration:1.5}):s>=r&&s<=o&&g>=n&&g<=l?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainMapZen",exaggeration:1.5}),e.easeTo(b),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function jm(i){"@babel/helpers - typeof";return jm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jm(i)}function $8(i,e){if(jm(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(jm(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function K8(i){var e=$8(i,"string");return jm(e)=="symbol"?e:String(e)}function _e(i,e,t){return e=K8(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ms(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const O_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),XI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);XI&&parseFloat(XI[1]);const W8="3.4.14";function Oh(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const Aw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},X8=Aw.global||Aw.self||Aw.window||{},_A=typeof process!="object"||String(process)!=="[object process]"||process.browser,dw=typeof importScripts=="function",Z8=typeof window<"u"&&typeof window.orientation<"u",ZI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ZI&&parseFloat(ZI[1]);class J8{constructor(e,t){_e(this,"name",void 0),_e(this,"workerThread",void 0),_e(this,"isRunning",!0),_e(this,"result",void 0),_e(this,"_resolve",()=>{}),_e(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Oh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Oh(this.isRunning),this.isRunning=!1,this._reject(e)}}let fw=class{terminate(){}};const pw=new Map;function Y8(i){Oh(i.source&&!i.url||!i.source&&i.url);let e=pw.get(i.source||i.url);return e||(i.url&&(e=ez(i.url),pw.set(i.url,e)),i.source&&(e=JI(i.source),pw.set(i.source,e))),Oh(e),e}function ez(i){if(!i.startsWith("http"))return i;const e=tz(i);return JI(e)}function JI(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function tz(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function YI(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(i){if(e5(i))r.add(i);else if(e5(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const n in i)YI(i[n],e,r)}}return t===void 0?Array.from(r):[]}function e5(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const gw=()=>{};class mw{static isSupported(){return typeof Worker<"u"&&_A||typeof fw<"u"&&!_A}constructor(e){_e(this,"name",void 0),_e(this,"source",void 0),_e(this,"url",void 0),_e(this,"terminated",!1),_e(this,"worker",void 0),_e(this,"onMessage",void 0),_e(this,"onError",void 0),_e(this,"_loadableURL","");const{name:t,source:r,url:n}=e;Oh(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=gw,this.onError=o=>console.log(o),this.worker=_A?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=gw,this.onError=gw,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||YI(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=Y8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new fw(r,{eval:!1})}else if(this.source)e=new fw(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class iz{static isSupported(){return mw.isSupported()}constructor(e){_e(this,"name","unnamed"),_e(this,"source",void 0),_e(this,"url",void 0),_e(this,"maxConcurrency",1),_e(this,"maxMobileConcurrency",1),_e(this,"onDebug",()=>{}),_e(this,"reuseWorkers",!0),_e(this,"props",{}),_e(this,"jobQueue",[]),_e(this,"idleQueue",[]),_e(this,"count",0),_e(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,l,s)=>o.done(s),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,l)=>o.error(l);const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new J8(t.name,e);e.onMessage=n=>t.onMessage(r,n.type,n.payload),e.onError=n=>t.onError(r,n),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new mw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Z8?this.maxMobileConcurrency:this.maxConcurrency}}const rz={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class vA{static isSupported(){return mw.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return vA._workerFarm=vA._workerFarm||new vA({}),vA._workerFarm.setProps(e),vA._workerFarm}constructor(e){_e(this,"props",void 0),_e(this,"workerPools",new Map),this.props={...rz},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new iz({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}_e(vA,"_workerFarm",void 0);const nz="latest";function sz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[i.id]||{},r="".concat(i.id,"-worker.js");let n=t.workerUrl;if(!n&&i.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(n="modules/".concat(i.module,"/dist/").concat(r)),!n){let o=i.version;o==="latest"&&(o=nz);const l=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(i.module).concat(l,"/dist/").concat(r)}return Oh(n),n}function oz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W8;Oh(i,"no worker provided");const t=i.version;return!(!e||!t)}const az=null,lz=null,yw=null,t5=null,cz=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:az,readFileAsText:lz,requireFromFile:yw,requireFromString:t5},Symbol.toStringTag,{value:"Module"})),uz="3.4.14",_w={};async function df(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(i=hz(i,e,t)),_w[i]=_w[i]||Az(i),await _w[i]}function hz(i,e,t){if(i.startsWith("http"))return i;const r=t.modules||{};return r[i]?r[i]:_A?t.CDN?(Oh(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(uz,"/dist/libs/").concat(i)):dw?"../src/libs/".concat(i):"modules/".concat(e,"/src/libs/").concat(i):"modules/".concat(e,"/dist/libs/").concat(i)}async function Az(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!_A)try{return cz&&yw&&await yw(i)}catch{return null}if(dw)return importScripts(i);const t=await(await fetch(i)).text();return dz(t,i)}function dz(i,e){if(!_A)return t5;if(dw)return eval.call(X8,i),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(i))}catch{t.text=i}return document.body.appendChild(t),null}function fz(i,e){return!vA.isSupported()||!_A&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function pz(i,e,t,r,n){const o=i.id,l=sz(i,t),g=vA.getWorkerFarm(t).getWorkerPool({name:o,url:l});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const b=await g.startJob("process-on-worker",gz.bind(null,n));return b.postMessage("process",{input:e,options:t,context:r}),await(await b.result).result}async function gz(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:n,input:o,options:l}=r;try{const s=await i(o,l);e.postMessage("done",{id:n,result:s})}catch(s){const g=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:n,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function mz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?i5(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?i5(i,0,e):""}function i5(i,e,t){if(i.byteLength<=e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function yz(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(mz(i),'"'))}}function _z(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function vz(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];const r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=r.reduce((s,g)=>s+g.byteLength,0),o=new Uint8Array(n);let l=0;for(const s of r)o.set(s,l),l+=s.byteLength;return o.buffer}function vw(i,e,t){const r=t!==void 0?new Uint8Array(i).subarray(e,e+t):new Uint8Array(i).subarray(e);return new Uint8Array(r).buffer}function qm(i,e){return Ms(i>=0),Ms(e>0),i+(e-1)&~(e-1)}function bz(i,e,t){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const n=i.byteOffset,o=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,n,o)}return e.set(r,t),t+qm(r.byteLength,4)}async function xz(i){const e=[];for await(const t of i)e.push(t);return vz(...e)}function r5(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let n5=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=r5(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(r5()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},wz=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof n5?n=e:n=new n5(t,r),this.stats[t]=n),n}};const Bz="Queued Requests",Cz="Active Requests",Ez="Cancelled Requests",Sz="Queued Requests Ever",Tz="Active Requests Ever",Iz={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Lz{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"props",void 0),_e(this,"stats",void 0),_e(this,"activeRequestCount",0),_e(this,"requestQueue",[]),_e(this,"requestMap",new Map),_e(this,"deferredUpdate",null),this.props={...Iz,...e},this.stats=new wz({id:this.props.id}),this.stats.get(Bz),this.stats.get(Cz),this.stats.get(Ez),this.stats.get(Sz),this.stats.get(Tz)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},n=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Mz="";const s5={};function Pz(i){for(const e in s5)if(i.startsWith(e)){const t=s5[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(Mz).concat(i)),i}function qve(i){return i}function Fz(i){return i&&typeof i=="object"&&i.isBuffer}function o5(i){if(Fz(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function a5(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function bw(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const Dz=i=>typeof i=="boolean",$m=i=>typeof i=="function",Km=i=>i!==null&&typeof i=="object",l5=i=>Km(i)&&i.constructor==={}.constructor,Rz=i=>i&&typeof i[Symbol.iterator]=="function",kz=i=>i&&typeof i[Symbol.asyncIterator]=="function",ff=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,pf=i=>typeof Blob<"u"&&i instanceof Blob,Oz=i=>i&&typeof i=="object"&&i.isBuffer,Uz=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||Km(i)&&$m(i.tee)&&$m(i.cancel)&&$m(i.getReader),Nz=i=>Km(i)&&$m(i.read)&&$m(i.pipe)&&Dz(i.readable),c5=i=>Uz(i)||Nz(i),zz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qz=/^([-\w.]+\/[-\w.+]+)/;function Vz(i){const e=Qz.exec(i);return e?e[1]:i}function u5(i){const e=zz.exec(i);return e?e[1]:""}const h5=/\?.*/;function Hz(i){const e=i.match(h5);return e&&e[0]}function xw(i){return i.replace(h5,"")}function U_(i){return ff(i)?i.url:pf(i)?i.name||"":typeof i=="string"?i:""}function ww(i){if(ff(i)){const e=i,t=e.headers.get("content-type")||"",r=xw(e.url);return Vz(t)||u5(r)}return pf(i)?i.type||"":typeof i=="string"?u5(i):""}function Gz(i){return ff(i)?i.headers["content-length"]||-1:pf(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function A5(i){if(ff(i))return i;const e={},t=Gz(i);t>=0&&(e["content-length"]=String(t));const r=U_(i),n=ww(i);n&&(e["content-type"]=n);const o=await $z(i);o&&(e["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const l=new Response(i,{headers:e});return Object.defineProperty(l,"url",{value:r}),l}async function jz(i){if(!i.ok){const e=await qz(i);throw new Error(e)}}async function qz(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const t=i.headers.get("Content-Type");let r=i.statusText;t.includes("application/json")&&(r+=" ".concat(await i.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function $z(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=o=>{var l;return r(o==null||(l=o.target)===null||l===void 0?void 0:l.result)},n.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),r=Kz(t);return"data:base64,".concat(r)}return null}function Kz(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function d5(i,e){if(typeof i=="string"){i=Pz(i);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(i,t)}return await A5(i)}function Wz(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function Wm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Wz()}const N_=globalThis.window||globalThis.self||globalThis.global,Xm=globalThis.process||{},f5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Wm();function Xz(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let Zz=class{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Xz(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Jz(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function Yz(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}function Bw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;",`padding:${Math.floor(l/2)}px ${Math.floor(o/2)}px;`,`line-height:${l}px;`,`background:url(${n});`,`background-size:${o}px ${l}px;`,"color:transparent;"].join("");return[`${e} %c+`,s]}let z_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(z_||(z_={}));const eQ=10;function p5(i){return typeof i!="string"?i:(i=i.toUpperCase(),z_[i]||z_.WHITE)}function tQ(i,e,t){return!Wm&&typeof i=="string"&&(e&&(i=`\x1B[${p5(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${p5(t)+eQ}m${i}\x1B[49m`)),i}function iQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),n=i;for(const o of r){const l=n[o];typeof l=="function"&&(e.find(s=>o===s)||(n[o]=l.bind(i)))}}function Q_(i,e){if(!i)throw new Error(e||"Assertion failed")}function Hp(){let i;if(Wm()&&N_.performance){var e,t;i=N_==null||(e=N_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Xm){var r;const n=Xm==null||(r=Xm.hrtime)===null||r===void 0?void 0:r.call(Xm);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const Gp={debug:Wm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},rQ={enabled:!0,level:0};function wu(){}const g5={},m5={once:!0};let Cw=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=f5,this._startTs=Hp(),this._deltaTs=Hp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Zz(`__probe-${this.id}__`,rQ),this.timeStamp(`${this.id} started`),iQ(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Hp()-this._startTs).toPrecision(10))}getDelta(){return Number((Hp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Q_(e,t)}warn(e){return this._getLogFunction(0,e,Gp.warn,arguments,m5)}error(e){return this._getLogFunction(0,e,Gp.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gp.debug||Gp.info,arguments,m5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||wu,r&&[r],{tag:aQ(t)}):wu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?Wm()?oQ({image:n,message:o,scale:l}):sQ():wu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||wu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=_5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||wu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=y5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=_5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,Q_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Hp();const l=o.tag||o.message;if(o.once&&l)if(!g5[l])g5[l]=Hp();else return wu;return t=nQ(this.id,o.message,o),r.bind(console,t,...o.args)}return wu}};Cw.VERSION=f5;function y5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return Q_(Number.isFinite(e)&&e>=0),e}function _5(i){const{logLevel:e,message:t}=i;i.logLevel=y5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return Q_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function nQ(i,e,t){if(typeof e=="string"){const r=t.time?Yz(Jz(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=tQ(e,t.color,t.background)}return e}function sQ(i){return console.warn("removed"),wu}function oQ(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=Bw(o,t,r);console.log(...l)},o.src=e,wu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Bw(e,t,r)),wu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Bw(o,t,r)),o.src=e.toDataURL(),wu}return wu}function aQ(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const v5=new Cw({id:"loaders.gl"});class lQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class cQ{constructor(){_e(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const b5={fetch:null,mimeType:void 0,nothrow:!1,log:new cQ,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:O_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},uQ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function x5(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const w5=()=>{const i=x5();return i.globalOptions=i.globalOptions||{...b5},i.globalOptions};function hQ(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],AQ(i,t),fQ(e,i,r)}function AQ(i,e){B5(i,null,b5,uQ,e);for(const t of e){const r=i&&i[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};B5(r,t.id,n,o,e)}}function B5(i,e,t,r,n){const o=e||"Top level",l=e?"".concat(e,"."):"";for(const s in i){const g=!e&&Km(i[s]),b=s==="baseUri"&&!e,S=s==="workerUrl"&&e;if(!(s in t)&&!b&&!S){if(s in r)v5.warn("".concat(o," loader option '").concat(l).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!g){const F=dQ(s,n);v5.warn("".concat(o," loader option '").concat(l).concat(s,"' not recognized. ").concat(F))()}}}}function dQ(i,e){const t=i.toLowerCase();let r="";for(const n of e)for(const o in n.options){if(i===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const l=o.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(r=r||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return r}function fQ(i,e,t){const n={...i.options||{}};return pQ(n,t),n.log===null&&(n.log=new lQ),C5(n,w5()),C5(n,e),n}function C5(i,e){for(const t in e)if(t in e){const r=e[t];l5(r)&&l5(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function pQ(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function Ew(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function Sw(i){var e,t;Ms(i,"null loader"),Ms(Ew(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(t=i)!==null&&t!==void 0&&t.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const E5=()=>{const i=x5();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function gQ(i){const e=E5();i=Array.isArray(i)?i:[i];for(const t of i){const r=Sw(t);e.find(n=>r===n)||e.unshift(r)}}function mQ(){return E5()}const yQ=new Cw({id:"loaders.gl"}),_Q=/\.([^.]+)$/;async function vQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!T5(i))return null;let n=S5(i,e,{...t,nothrow:!0},r);if(n)return n;if(pf(i)&&(i=await i.slice(0,10).arrayBuffer(),n=S5(i,e,t,r)),!n&&!(t!=null&&t.nothrow))throw new Error(I5(i));return n}function S5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!T5(i))return null;if(e&&!Array.isArray(e))return Sw(e);let n=[];e&&(n=n.concat(e)),t!=null&&t.ignoreRegisteredLoaders||n.push(...mQ()),xQ(n);const o=bQ(i,n,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(I5(i));return o}function bQ(i,e,t,r){const n=U_(i),o=ww(i),l=xw(n)||(r==null?void 0:r.url);let s=null,g="";if(t!=null&&t.mimeType&&(s=Tw(e,t==null?void 0:t.mimeType),g="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),s=s||wQ(e,l),g=g||(s?"matched url ".concat(l):""),s=s||Tw(e,o),g=g||(s?"matched MIME type ".concat(o):""),s=s||CQ(e,i),g=g||(s?"matched initial data ".concat(M5(i)):""),s=s||Tw(e,t==null?void 0:t.fallbackMimeType),g=g||(s?"matched fallback MIME type ".concat(o):""),g){var b;yQ.log(1,"selectLoader selected ".concat((b=s)===null||b===void 0?void 0:b.name,": ").concat(g,"."))}return s}function T5(i){return!(i instanceof Response&&i.status===204)}function I5(i){const e=U_(i),t=ww(i);let r="No valid loader found (";r+=e?"".concat(a5(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const n=i?M5(i):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")",r}function xQ(i){for(const e of i)Sw(e)}function wQ(i,e){const t=e&&_Q.exec(e),r=t&&t[1];return r?BQ(i,r):null}function BQ(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Tw(i,e){for(const t of i)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function CQ(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(EQ(e,t))return t}else if(ArrayBuffer.isView(e)){if(L5(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&L5(e,0,t))return t;return null}function EQ(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function L5(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>SQ(i,e,t,n))}function SQ(i,e,t,r){if(r instanceof ArrayBuffer)return _z(r,i,r.byteLength);switch(typeof r){case"function":return r(i,t);case"string":const n=Iw(i,e,r.length);return r===n;default:return!1}}function M5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Iw(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Iw(i,0,e):""}function Iw(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}const TQ=256*1024;function*IQ(i,e){const t=(e==null?void 0:e.chunkSize)||TQ;let r=0;const n=new TextEncoder;for(;r<i.length;){const o=Math.min(i.length-r,t),l=i.slice(r,r+o);r+=o,yield n.encode(l)}}const LQ=256*1024;function MQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=LQ}=e;let r=0;for(;r<i.byteLength;){const n=Math.min(i.byteLength-r,t),o=new ArrayBuffer(n),l=new Uint8Array(i,r,n);new Uint8Array(o).set(l),r+=n,yield o}}()}const PQ=1024*1024;async function*FQ(i,e){const t=(e==null?void 0:e.chunkSize)||PQ;let r=0;for(;r<i.size;){const n=r+t,o=await i.slice(r,n).arrayBuffer();r=n,yield o}}function P5(i,e){return O_?DQ(i,e):RQ(i)}async function*DQ(i,e){const t=i.getReader();let r;try{for(;;){const n=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:l}=await n;if(o)return;yield o5(l)}}catch{t.releaseLock()}}async function*RQ(i,e){for await(const t of i)yield o5(t)}function kQ(i,e){if(typeof i=="string")return IQ(i,e);if(i instanceof ArrayBuffer)return MQ(i,e);if(pf(i))return FQ(i,e);if(c5(i))return P5(i,e);if(ff(i))return P5(i.body,e);throw new Error("makeIterator")}const F5="Cannot convert supplied data type";function OQ(i,e,t){if(e.text&&typeof i=="string")return i;if(Oz(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const n=i.byteLength||i.length;return(i.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+n)),r}throw new Error(F5)}async function UQ(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return OQ(i,e);if(pf(i)&&(i=await A5(i)),ff(i)){const n=i;return await jz(n),e.binary?await n.arrayBuffer():await n.text()}if(c5(i)&&(i=kQ(i,t)),Rz(i)||kz(i))return xz(i);throw new Error(F5)}function D5(i,e){const t=w5(),r=i||t;return typeof r.fetch=="function"?r.fetch:Km(r.fetch)?n=>d5(n,r):e!=null&&e.fetch?e==null?void 0:e.fetch:d5}function NQ(i,e,t){if(t)return t;const r={fetch:D5(e,i),...i};if(r.url){const n=xw(r.url);r.baseUrl=n,r.queryString=Hz(r.url),r.filename=a5(n),r.baseUrl=bw(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function zQ(i,e){if(!e&&i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Lw(i,e,t,r){Oh(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Ew(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const n=U_(i),l=zQ(e,r),s=await vQ(i,l,t);return s?(t=hQ(t,s,l,n),r=NQ({url:n,parse:Lw,loaders:l},t,r||null),await QQ(s,i,t,r)):null}async function QQ(i,e,t,r){if(oz(i),ff(e)){const n=e,{ok:o,redirected:l,status:s,statusText:g,type:b,url:S}=n,F=Object.fromEntries(n.headers.entries());r.response={headers:F,ok:o,redirected:l,status:s,statusText:g,type:b,url:S}}if(e=await UQ(e,i,t),i.parseTextSync&&typeof e=="string")return t.dataType="text",i.parseTextSync(e,t,r,i);if(fz(i,t))return await pz(i,e,t,r,Lw);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r,i);if(i.parse)return await i.parse(e,t,r,i);throw Oh(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function rd(i,e,t,r){!Array.isArray(e)&&!Ew(e)&&(t=e,e=void 0);const n=D5(t);let o=i;return typeof i=="string"&&(o=await n(i)),pf(i)&&(o=await n(i)),await Lw(o,e,t)}const VQ="3.4.14",{_parseImageNode:HQ}=globalThis,Mw=typeof Image<"u",Pw=typeof ImageBitmap<"u",Fw=O_?!0:!!HQ;function GQ(i){switch(i){case"auto":return Pw||Mw||Fw;case"imagebitmap":return Pw;case"image":return Mw;case"data":return Fw;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function jQ(){if(Pw)return"imagebitmap";if(Mw)return"image";if(Fw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function qQ(i){const e=KQ(i);if(!e)throw new Error("Not an image");return e}function $Q(i){switch(qQ(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function KQ(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const WQ=/^data:image\/svg\+xml/,XQ=/\.svg((\?|#).*)?$/;function Dw(i){return i&&(WQ.test(i)||XQ.test(i))}function ZQ(i,e){if(Dw(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return R5(i,e)}function R5(i,e){if(Dw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function k5(i,e,t){const r=ZQ(i,t),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await JQ(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function JQ(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,n)=>{try{t.onload=()=>r(t),t.onerror=o=>n(new Error("Could not load image ".concat(i,": ").concat(o)))}catch(o){n(o)}})}const YQ={};let O5=!0;async function eV(i,e,t){let r;Dw(t)?r=await k5(i,e,t):r=R5(i,t);const n=e&&e.imagebitmap;return await tV(r,n)}async function tV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((iV(e)||!O5)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),O5=!1}return await createImageBitmap(i)}function iV(i){for(const e in i||YQ)return!1;return!0}function rV(i){return!aV(i,"ftyp",4)||!(i[8]&96)?null:nV(i)}function nV(i){switch(sV(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function sV(i,e,t){return String.fromCharCode(...i.slice(e,t))}function oV(i){return[...i].map(e=>e.charCodeAt(0))}function aV(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=oV(e);for(let n=0;n<r.length;++n)if(r[n]!==i[n+t])return!1;return!0}const Uh=!1,Zm=!0;function Rw(i){const e=Jm(i);return cV(e)||AV(e)||uV(e)||hV(e)||lV(e)}function lV(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=rV(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function cV(i){const e=Jm(i);return e.byteLength>=24&&e.getUint32(0,Uh)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Uh),height:e.getUint32(20,Uh)}:null}function uV(i){const e=Jm(i);return e.byteLength>=10&&e.getUint32(0,Uh)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Zm),height:e.getUint16(8,Zm)}:null}function hV(i){const e=Jm(i);return e.byteLength>=14&&e.getUint16(0,Uh)===16973&&e.getUint32(2,Zm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Zm),height:e.getUint32(22,Zm)}:null}function AV(i){const e=Jm(i);if(!(e.byteLength>=3&&e.getUint16(0,Uh)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=dV();let o=2;for(;o+9<e.byteLength;){const l=e.getUint16(o,Uh);if(n.has(l))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Uh),width:e.getUint16(o+7,Uh)};if(!r.has(l))return null;o+=2,o+=e.getUint16(o,Uh)}return null}function dV(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Jm(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function fV(i,e){const{mimeType:t}=Rw(i)||{},r=globalThis._parseImageNode;return Ms(r),await r(i,t)}async function pV(i,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=t||{},l=gV(n);let s;switch(l){case"imagebitmap":s=await eV(i,e,o);break;case"image":s=await k5(i,e,o);break;case"data":s=await fV(i);break;default:Ms(!1)}return n==="data"&&(s=$Q(s)),s}function gV(i){switch(i){case"auto":case"data":return jQ();default:return GQ(i),i}}const U5={id:"image",module:"images",name:"Images",version:VQ,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:pV,tests:[i=>!!Rw(new DataView(i))],options:{image:{type:"auto",decode:!0}}},kw={};function mV(i){if(kw[i]===void 0){const e=O_?_V(i):yV(i);kw[i]=e}return kw[i]}function yV(i){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:r=e}=globalThis;return!!t&&r.includes(i)}function _V(i){switch(i){case"image/avif":case"image/webp":return vV(i);default:return!0}}function vV(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}function N5(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function bA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||N5()}const V_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},H_=V_.window||V_.self||V_.global,Ym=V_.process||{},z5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";bA();const Ow=globalThis;function Q5(i){if(!i&&!bA())return"Node";if(N5(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n?"IE":Ow.chrome?"Chrome":Ow.safari?"Safari":Ow.mozInnerScreenX?"Firefox":"Unknown"}function bV(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class xV{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";_e(this,"storage",void 0),_e(this,"id",void 0),_e(this,"config",void 0),this.storage=bV(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function wV(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function BV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return"".concat(" ".repeat(t)).concat(i)}function Uw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;","padding:".concat(Math.floor(l/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(l,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(l,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let G_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(G_||(G_={}));function V5(i){return typeof i=="string"?G_[i.toUpperCase()]||G_.WHITE:i}function CV(i,e,t){return!bA&&typeof i=="string"&&(e&&(e=V5(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),t&&(e=V5(t),i="\x1B[".concat(t+10,"m").concat(i,"\x1B[49m"))),i}function EV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t);for(const n of r)typeof i[n]=="function"&&(e.find(o=>n===o)||(i[n]=i[n].bind(i)))}function j_(i,e){if(!i)throw new Error(e||"Assertion failed")}function jp(){let i;if(bA&&"performance"in H_){var e,t;i=H_==null||(e=H_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Ym){var r;const n=Ym==null||(r=Ym.hrtime)===null||r===void 0?void 0:r.call(Ym);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const qp={debug:bA&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},SV={enabled:!0,level:0};function Bu(){}const H5={},G5={once:!0};class Nw{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};_e(this,"id",void 0),_e(this,"VERSION",z5),_e(this,"_startTs",jp()),_e(this,"_deltaTs",jp()),_e(this,"_storage",void 0),_e(this,"userData",{}),_e(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new xV("__probe-".concat(this.id,"__"),SV),this.timeStamp("".concat(this.id," started")),EV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jp()-this._startTs).toPrecision(10))}getDelta(){return Number((jp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){j_(e,t)}warn(e){return this._getLogFunction(0,e,qp.warn,arguments,G5)}error(e){return this._getLogFunction(0,e,qp.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,qp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,qp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,qp.debug||qp.info,arguments,G5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Bu,r&&[r],{tag:MV(t)}):Bu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?bA?LV({image:n,message:o,scale:l}):IV():Bu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Bu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=q5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Bu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=j5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=q5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,j_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=jp();const l=o.tag||o.message;if(o.once)if(!H5[l])H5[l]=jp();else return Bu;return t=TV(this.id,o.message,o),r.bind(console,t,...o.args)}return Bu}}_e(Nw,"VERSION",z5);function j5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return j_(Number.isFinite(e)&&e>=0),e}function q5(i){const{logLevel:e,message:t}=i;i.logLevel=j5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return j_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function TV(i,e,t){if(typeof e=="string"){const r=t.time?BV(wV(t.total)):"";e=t.time?"".concat(i,": ").concat(r,"  ").concat(e):"".concat(i,": ").concat(e),e=CV(e,t.color,t.background)}return e}function IV(i){return console.warn("removed"),Bu}function LV(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=Uw(o,t,r);console.log(...l)},o.src=e,Bu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Uw(e,t,r)),Bu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Uw(o,t,r)),o.src=e.toDataURL(),Bu}return Bu}function MV(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const kn=new Nw({id:"deck"}),nd={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},zw=1,ey=2,Qw=3,Vw=4,PV=2,FV=i=>({"layer.changeFlag":(e,t,r)=>{i.log(Qw,"".concat(e.id," ").concat(t,": "),r[t])()},"layer.initialize":e=>{i.log(zw,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const r=e.getChangeFlags();i.log(ey,"Updating ".concat(e," because: ").concat(Object.keys(r).filter(n=>r[n]).join(", ")))()}else i.log(Vw,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&i.log(Vw,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{i.log(zw,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,r)=>{t?i.log(ey,"Composite layer rendered new subLayers ".concat(e),r)():i.log(Vw,"Composite layer reused subLayers ".concat(e),r)()},"layerManager.setLayers":(e,t,r)=>{t&&i.log(ey,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{i.log(Qw,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,r)=>{i.log(zw,r?"invalidated attributes ".concat(r," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{nd.attributeUpdateMessages.length=0,nd.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const r=Math.round(Date.now()-nd.attributeManagerUpdateStart);i.groupCollapsed(ey,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(r,"ms"))();for(const n of nd.attributeUpdateMessages)i.log(Qw,n)();i.groupEnd(ey)()},"attribute.updateStart":e=>{nd.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const r="".concat(e.id," allocated ").concat(t);nd.attributeUpdateMessages.push(r)},"attribute.updateEnd":(e,t)=>{const r=Math.round(Date.now()-nd.attributeUpdateStart),n="".concat(e.id," updated ").concat(t," in ").concat(r,"ms");nd.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(e,t,r)=>{const{pass:n,redrawReason:o,stats:l}=r;for(const s of t){const{totalCount:g,visibleCount:b,compositeCount:S,pickableCount:F}=s,N=g-S-b;i.log(PV,"RENDER #".concat(e.renderCount,"   ").concat(b," (of ").concat(g," layers) to ").concat(n," because ").concat(o,"   (").concat(N," hidden, ").concat(S," composite ").concat(F," pickable)"))(),l&&l.get("Redraw Layers").add(b)}}});var DV={};let q_={};DV.NODE_ENV!=="production"&&(q_=FV(kn));function RV(i){q_=i}function Sl(i,e,t,r){kn.level>0&&q_[i]&&q_[i].call(null,e,t,r)}function kV(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const OV={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:kV,parseTextSync:JSON.parse};function UV(){const i="8.9.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(i));return e||(kn.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:kn,_registerLoggers:RV},gQ([OV,[U5,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const NV=UV(),Pn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Pn,"IDENTITY",{get:()=>(kn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Nh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Hw={common:0,meters:1,pixels:2},$5={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},lr=new Nw({id:"luma.gl"});function nc(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const zV="Invalid WebGLRenderingContext",QV="Requires WebGL2";function $_(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function An(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function VV(i){return An(i)?i:null}function K_(i){return nc($_(i),zV),i}function sc(i){return nc(An(i),QV),i}const ty={};function HV(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function GV(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function jV(i,e){ty[i]=!0,e!==void 0&&HV(e)}function qV(i){const e=i.getError;i.getError=function(){let r;do r=e.apply(i),r!==0&&(ty[r]=!0);while(r!==0);for(r in ty)if(ty[r])return delete ty[r],parseInt(r,10);return 0}}const iy=function i(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const n=new i.VertexAttrib(t);this.attribs[r]=n}this.maxAttrib=0};iy.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},iy.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const gf=function(e){const t=this;this.gl=e,qV(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,l){switch(o){case 34962:t.currentArrayBuffer=l;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=l;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,l){const g=t.currentVertexArrayObject.attribs[o];switch(l){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,l,s,g,b,S){const F=t.currentVertexArrayObject;F.maxAttrib=Math.max(F.maxAttrib,o);const D=F.attribs[o];return D.buffer=t.currentArrayBuffer,D.size=l,D.type=s,D.normalized=g,D.stride=b,D.offset=S,D.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{GV("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};gf.prototype.VERTEX_ARRAY_BINDING_OES=34229,gf.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new iy(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},gf.prototype.createVertexArrayOES=function(){const e=new iy(this);return this.vertexArrayObjects.push(e),e},gf.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},gf.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof iy&&e.hasBeenBound&&e.ext===this)},gf.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){jV(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(n===o)return;(!n||o.elementArrayBuffer!==n.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let l=this.currentArrayBuffer;const s=Math.max(n?n.maxAttrib:0,o.maxAttrib);for(let g=0;g<=s;g++){const b=o.attribs[g],S=n?n.attribs[g]:null;if((!n||b.enabled!==S.enabled)&&(b.enabled?r.enableVertexAttribArray.call(t,g):r.disableVertexAttribArray.call(t,g)),b.enabled){let F=!1;(!n||b.buffer!==S.buffer)&&(l!==b.buffer&&(r.bindBuffer.call(t,34962,b.buffer),l=b.buffer),F=!0),(F||b.cached!==S.cached)&&r.vertexAttribPointer.call(t,g,b.size,b.type,b.normalized,b.stride,b.offset)}}this.currentArrayBuffer!==l&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function $V(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const n=e.call(this)||[];return n.indexOf("OES_vertex_array_object")<0&&n.push("OES_vertex_array_object"),n};const t=i.getExtension;i.getExtension=function(n){const o=t.call(this,n);return o||(n!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new gf(this)),this.__OESVertexArrayObject))}}const K5="OES_element_index",W5="WEBGL_draw_buffers",KV="EXT_disjoint_timer_query",WV="EXT_disjoint_timer_query_webgl2",XV="EXT_texture_filter_anisotropic",X5="WEBGL_debug_renderer_info",ZV=35723,JV=4352,YV=36795,e9=34047,t9=37445,i9=37446,Qs=i=>An(i)?void 0:0,r9={3074:i=>An(i)?void 0:36064,[ZV]:i=>An(i)?void 0:JV,35977:Qs,32937:Qs,[YV]:(i,e)=>{const t=An(i)?i.getExtension(WV):i.getExtension(KV);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[t9]:(i,e)=>{const t=i.getExtension(X5);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[i9]:(i,e)=>{const t=i.getExtension(X5);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[e9]:(i,e)=>{const t=i.luma.extensions[XV];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Qs,35071:Qs,37447:Qs,36063:(i,e)=>{if(!An(i)){const t=i.getExtension(W5);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Qs,35374:Qs,35377:Qs,34852:i=>{if(!An(i)){const e=i.getExtension(W5);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(K5)?2147483647:65535,33001:i=>i.getExtension(K5)?16777216:65535,33e3:i=>16777216,37157:Qs,35373:Qs,35657:Qs,36183:Qs,37137:Qs,34045:Qs,35978:Qs,35979:Qs,35968:Qs,35376:Qs,35375:Qs,35659:Qs,37154:Qs,35371:Qs,35658:Qs,35076:Qs,35077:Qs,35380:Qs};function n9(i,e,t){const r=r9[t],n=typeof r=="function"?r(i,e,t):r;return n!==void 0?n:e(t)}const s9="OES_vertex_array_object",Z5="ANGLE_instanced_arrays",o9="WEBGL_draw_buffers",a9="EXT_disjoint_timer_query",l9="EXT_texture_filter_anisotropic",c9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function u9(i,e){return{webgl2:An(i),ext:i.getExtension(e)}}const J5={[s9]:{meta:{suffix:"OES"},createVertexArray:()=>{nc(!1,c9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Z5]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){nc(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[o9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{nc(!1)}},[a9]:{meta:{suffix:"EXT"},createQuery:()=>{nc(!1)},deleteQuery:()=>{nc(!1)},beginQuery:()=>{nc(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},Gw={readBuffer:(i,e,t)=>{An(i)&&e(t)},getVertexAttrib:(i,e,t,r)=>{const{webgl2:n,ext:o}=u9(i,Z5);let l;switch(r){case 35069:l=n?void 0:!1;break;case 35070:l=!n&&!o?0:void 0;break}return l!==void 0?l:e(t,r)},getProgramParameter:(i,e,t,r)=>{if(!An(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(i,e,t,r,n)=>{if(!An(i))switch(n){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(t,r,n)},getTexParameter(i,e,t,r){switch(r){case 34046:const{extensions:n}=i.luma,o=n[l9];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:n9,hint(i,e,t,r){return e(t,r)}};function h9(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||($V(i),A9(i),f9(i,J5),d9(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=h9;function A9(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const t of e)i.luma[t]=i.getExtension(t)}function d9(i,e){let{target:t,target2:r}=e;Object.keys(Gw).forEach(n=>{if(typeof Gw[n]=="function"){const o=i[n]?i[n].bind(i):()=>{},l=Gw[n].bind(null,i,o);t[n]=l,r[n]=l}})}function f9(i,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&p9(i,{extension:t,target:i.luma,target2:i})}function p9(i,e){let{extension:t,target:r,target2:n}=e;const o=J5[t];nc(o);const{meta:l={}}=o,{suffix:s=""}=l,g=i.getExtension(t);for(const b of Object.keys(o)){const S="".concat(b).concat(s);let F=null;b==="meta"||typeof i[b]=="function"||(g&&typeof g[S]=="function"?F=function(){return g[S](...arguments)}:typeof o[b]=="function"&&(F=o[b].bind(r))),F&&(r[b]=F,n[b]=F)}}const jw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},sd=(i,e,t)=>e?i.enable(t):i.disable(t),Y5=(i,e,t)=>i.hint(t,e),Xc=(i,e,t)=>i.pixelStorei(t,e),g9=(i,e)=>{const t=An(i)?36009:36160;return i.bindFramebuffer(t,e)},m9=(i,e)=>i.bindFramebuffer(36008,e);function ry(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const y9={3042:sd,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:sd,2885:(i,e)=>i.cullFace(e),2929:sd,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:sd,35723:Y5,36006:g9,2886:(i,e)=>i.frontFace(e),33170:Y5,2849:(i,e)=>i.lineWidth(e),32823:sd,32824:"polygonOffset",10752:"polygonOffset",35977:sd,32938:"sampleCoverage",32939:"sampleCoverage",3089:sd,3088:(i,e)=>i.scissor(...e),2960:sd,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),3333:Xc,3317:Xc,37440:Xc,37441:Xc,37443:Xc,3330:Xc,3332:Xc,3331:Xc,36010:m9,3314:Xc,32878:Xc,3316:Xc,3315:Xc,32877:Xc,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=ry(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=ry(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=ry(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=ry(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilFuncSeparate(1028,t,r,n),i.stencilFuncSeparate(1029,o,l,s)},stencilOp:(i,e)=>{e=ry(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilOpSeparate(1028,t,r,n),i.stencilOpSeparate(1029,o,l,s)},viewport:(i,e)=>i.viewport(...e)};function xo(i,e,t){return e[i]!==void 0?e[i]:t[i]}const _9={blendEquation:(i,e,t)=>i.blendEquationSeparate(xo(32777,e,t),xo(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(xo(32969,e,t),xo(32968,e,t),xo(32971,e,t),xo(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(xo(32824,e,t),xo(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(xo(32938,e,t),xo(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,xo(2962,e,t),xo(2967,e,t),xo(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,xo(34816,e,t),xo(36003,e,t),xo(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,xo(2964,e,t),xo(2965,e,t),xo(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,xo(34817,e,t),xo(34818,e,t),xo(34819,e,t))},e3={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},blendColor:(i,e,t,r,n)=>i({32773:new Float32Array([e,t,r,n])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,n)=>i({32969:e,32968:t,32971:r,32970:n}),clearColor:(i,e,t,r,n)=>i({3106:new Float32Array([e,t,r,n])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,n)=>i({3107:[e,t,r,n]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,n)=>i({3088:new Int32Array([e,t,r,n])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,n)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:n}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,n)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:n}),viewport:(i,e,t,r,n)=>i({2978:[e,t,r,n]})},zh=(i,e)=>i.isEnabled(e),t3={3042:zh,2884:zh,2929:zh,3024:zh,32823:zh,32926:zh,32928:zh,3089:zh,2960:zh,35977:zh};function i3(i){for(const e in i)return!1;return!0}function v9(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let n=0;n<i.length;++n)if(i[n]!==e[n])return!1;return!0}return!1}function r3(i,e){const t=i[e].bind(i);i[e]=function(){const n=arguments.length<=0?void 0:arguments[0];return n in i.state.cache?i.state.enable?i.state.cache[n]:t(...arguments):t(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function b9(i,e,t){const r=i[e].bind(i);i[e]=function(){for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];const{valueChanged:g,oldValue:b}=t(i.state._updateCache,...l);return g&&r(...l),b},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function x9(i){const e=i.useProgram.bind(i);i.useProgram=function(r){i.state.program!==r&&(e(r),i.state.program=r)}}class w9{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?C9(e):Object.assign({},jw),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){nc(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];xA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){nc(o!==void 0);const l=e[o],s=this.cache[o];v9(l,s)||(t=!0,r=s,n&&!(o in n)&&(n[o]=s),this.cache[o]=l)}return{valueChanged:t,oldValue:r}}}function n3(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(nc(r!==void 0),!i.state){const{polyfillContext:n}=globalThis;n&&n(i),i.state=new w9(i,{copyState:r}),x9(i);for(const o in e3){const l=e3[o];b9(i,o,l)}r3(i,"getParameter"),r3(i,"isEnabled")}return i.state.enable=t,i}function B9(i){i.state||n3(i,{copyState:!1}),i.state.push()}function s3(i){nc(i.state),i.state.pop()}function xA(i,e){if(nc($_(i),"setParameters requires a WebGL context"),i3(e))return;const t={};for(const n in e){const o=Number(n),l=y9[n];l&&(typeof l=="string"?t[l]=!0:l(i,e[n],o))}const r=i.state&&i.state.cache;if(r)for(const n in t){const o=_9[n];o(i,e,r)}}function C9(i,e){if(e=e||jw,typeof e=="number"){const n=e,o=t3[n];return o?o(i,n):i.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const n of t){const o=t3[n];r[n]=o?o(i,Number(n)):i.getParameter(Number(n))}return r}function E9(i){xA(i,jw)}function Yu(i,e,t){if(i3(e))return t(i);const{nocatch:r=!0}=e;B9(i),xA(i,e);let n;if(r)n=t(i),s3(i);else try{n=t(i)}finally{s3(i)}return n}function $p(i){const{luma:e}=i;if(i.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function qw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=$p(i),n=i.drawingBufferWidth,o=i.drawingBufferHeight;return T9(e,r,n,o,t)}function S9(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function T9(i,e,t,r,n){const o=o3(i[0],e,t);let l=a3(i[1],e,r,n),s=o3(i[0]+1,e,t);const g=s===t-1?s:s-1;s=a3(i[1]+1,e,r,n);let b;return n?(s=s===0?s:s+1,b=l,l=s):b=s===r-1?s:s-1,{x:o,y:l,width:Math.max(g-o+1,1),height:Math.max(b-l+1,1)}}function o3(i,e,t){return Math.min(Math.round(i*e),t-1)}function a3(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const $w=bA(),I9=$w&&typeof document<"u",l3={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function c3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};nc($w,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},l3,i);const{width:e,height:t}=i;function r(s){if(i.throwOnError)throw new Error(s);return console.error(s),null}i.onError=r;let n;const{canvas:o}=i,l=F9({canvas:o,width:e,height:t,onError:r});return n=P9(l,i),n?(n=Kw(n,i),D9(n),n):null}function Kw(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||R9(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},l3,e);const{manageState:t,debug:r}=e;return t&&n3(i,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return lr.log(1,...o)()}}),$w&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),lr.level=Math.max(lr.level,1)):lr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function L9(i){const e=i.getParameter(7936),t=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),n=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function M9(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=S9(e.useDevicePixels);k9(i,r,e);return}const t=i.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function P9(i,e){const{onError:t}=e;let r=null;const n=g=>r=g.statusMessage||r;i.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:l=!0}=e;let s=null;return l&&(s=s||i.getContext("webgl2",e),s=s||i.getContext("experimental-webgl2",e)),o&&(s=s||i.getContext("webgl",e),s=s||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):t("Failed to create ".concat(l&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function F9(i){let{canvas:e,width:t=800,height:r=600,onError:n}=i,o;return typeof e=="string"?(I9&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function D9(i){const e=An(i)?"WebGL2":"WebGL1",t=L9(i),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",n=i.debug?" debug":"";lr.info(1,"".concat(e).concat(n," context ").concat(r))()}function R9(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function k9(i,e,t){let r="width"in t?t.width:i.canvas.clientWidth,n="height"in t?t.height:i.canvas.clientHeight;(!r||!n)&&(lr.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=i.canvas.width||1,n=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const o=i.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==e){let l=e;const s=Math.floor(r*l),g=Math.floor(n*l);i.canvas.width=s,i.canvas.height=g,(i.drawingBufferWidth!==s||i.drawingBufferHeight!==g)&&(lr.warn("Device pixel ratio clamped")(),l=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/n),i.canvas.width=Math.floor(r*l),i.canvas.height=Math.floor(n*l)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:e})}}function u3(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let h3=class{constructor(e,t){_e(this,"name",void 0),_e(this,"type",void 0),_e(this,"sampleSize",1),_e(this,"time",void 0),_e(this,"count",void 0),_e(this,"samples",void 0),_e(this,"lastTiming",void 0),_e(this,"lastSampleTime",void 0),_e(this,"lastSampleCount",void 0),_e(this,"_count",0),_e(this,"_time",0),_e(this,"_samples",0),_e(this,"_startTime",0),_e(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=u3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(u3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},Ww=class{constructor(e){_e(this,"id",void 0),_e(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof h3?this.stats[t]=e:this.stats[t]=new h3(t,r)),this.stats[t]}};const ny="8.5.21",O9="set luma.log.level=1 (or higher) to trace rendering";class U9{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Ww({id:e})),this.stats.get(e)}}const mf=new U9;if(globalThis.luma&&globalThis.luma.VERSION!==ny)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ny));globalThis.luma||(bA()&&lr.log(1,"luma.gl ".concat(ny," - ").concat(O9))(),globalThis.luma=globalThis.luma||{VERSION:ny,version:ny,log:lr,stats:mf,globals:{modules:{},nodeIO:{}}});function N9(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function z9(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function Zi(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function Xw(i,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=i[e];return Zi(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function od(i,e){e=Number(e);for(const t in i)if(i[t]===e)return"GL.".concat(t);return String(e)}const Zw={};function wA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Zw[i]=Zw[i]||1;const e=Zw[i]++;return"".concat(i,"-").concat(e)}function A3(i){return Zi(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Kp(i){let e=!0;for(const t in i){e=!1;break}return e}function d3(i,e,t,r){const n="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(i);r.forEach(l=>{o.methodName||(o[l]=()=>{throw lr.removed("Calling removed method ".concat(e,".").concat(l,": "),n)(),new Error(l)})})}const Wp="Resource subclass must define virtual methods";let BA=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e);const{id:r,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=r||wA(this[Symbol.toStringTag]),this.userData=n,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Xw(this.gl,e),Zi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=An(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const s=n.webgl1,g="webgl2"in n?n.webgl2:n.webgl1;return o?g:s}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,n=this.constructor.PARAMETERS||{},o=An(this.gl),l={},s=t||Object.keys(n);for(const g of s){const b=n[g];if(b&&(!("webgl2"in b)||o)&&(!("extension"in b)||this.gl.getExtension(b.extension))){const F=r?od(this.gl,g):g;l[F]=this.getParameter(g,e),r&&b.type==="GLenum"&&(l[F]=od(this.gl,l[F]))}}return l}setParameter(e,t){e=Xw(this.gl,e),Zi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=An(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");n.type==="GLenum"&&(t=Xw(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return d3(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(Wp)}_deleteHandle(){throw new Error(Wp)}_bindHandle(e){throw new Error(Wp)}_getOptsFromHandle(){throw new Error(Wp)}_getParameter(e,t){throw new Error(Wp)}_setParameter(e,t){throw new Error(Wp)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=mf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];mf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const n=mf.get("Memory Usage".concat(r));n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=mf.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const Q9="Failed to deduce GL constant from typed array";function Jw(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Q9)}}function sy(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function V9(i){let{data:e,width:t,height:r,bytesPerPixel:n=4,temp:o}=i;const l=t*n;o=o||new Uint8Array(l);for(let s=0;s<r/2;++s){const g=s*l,b=(r-s-1)*l;o.set(e.subarray(g,g+l)),e.copyWithin(g,b,b+l),e.set(o,b)}}function H9(i){let{data:e,width:t,height:r}=i;const n=Math.round(t/2),o=Math.round(r/2),l=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let g=0;g<n;g++)for(let b=0;b<4;b++)l[(s*n+g)*4+b]=e[(s*2*t+g*2)*4+b];return{data:l,width:n,height:o}}function Yw(i,e,t){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=t;for(const s in r)if(s in e){const b=r[s]?"".concat(i,".").concat(r[s]):"N/A";lr.removed("".concat(i,".").concat(s),b)()}for(const s in n)if(s in e){const g=n[s];lr.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))()}let l=null;for(const s in o)if(s in e){const g=o[s];lr.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))(),l=l||Object.assign({},e),l[g]=e[s],delete l[s]}return l||e}const G9={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},j9={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ec{static getBytesPerElement(e){return sy(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Zi(e.size),sy(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Ec(G9,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ec.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ec.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Yw("Accessor",e,j9),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const f3=10,p3={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},q9={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:p3},$9={removedProps:p3};class xs extends BA{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ec.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Ec.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Yw("Buffer",e,q9),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Yw("Buffer",e,$9),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Ec(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,o=e.byteLength||e.length;Zi(t);const l=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(l,this.handle),n!==0||o!==void 0?(sc(this.gl),this.gl.bufferSubData(this.target,r,t,n,o)):this.gl.bufferSubData(l,r,t),this.gl.bindBuffer(l,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:n=0,size:o}=e;const{gl:l}=this;return sc(l),l.bindBuffer(36662,t.handle),l.bindBuffer(36663,this.handle),l.copyBufferSubData(36662,36663,r,n,o),l.bindBuffer(36662,null),l.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};sc(this.gl);const o=sy(this.accessor.type||5126,{clamped:!1}),l=this._getAvailableElementCount(t),s=r;let g,b;e?(b=e.length,g=b-s):(g=Math.min(l,n||l),b=s+g);const S=Math.min(l,g);return n=n||S,Zi(n<=S),e=e||new o(b),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,n),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?n!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,n):(Zi(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(f3,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Zi(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,f3),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=Jw(e);return Zi(o),this.setAccessor(new Ec(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Zi(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=sy(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Ec(this.accessor,{type:Jw(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return lr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return lr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return lr.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return lr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Ec(this.accessor,e),this}}const e2={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},g3={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},m3={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function K9(i,e){const t=e2[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=An(i)&&t.gl2||t.gl1;return typeof r=="string"?i.getExtension(r):r}function W9(i,e){const t=e2[e];switch(t&&t.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const X9=[9729,9728],y3=globalThis.WebGLBuffer||function(){};class Xp extends BA{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:n}=t;let o=!0;return r&&(o=o&&K9(e,r),o=o&&(!n||W9(e,r))),o}constructor(e,t){const{id:r=wA("texture"),handle:n,target:o}=t;super(e,{id:r,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(fe=>this.initialize(Object.assign({},e,{pixels:fe,data:fe}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:o=6408,border:l=0,recreate:s=!1,parameters:g={},pixelStore:b={},textureUnit:S=void 0}=e;t||(t=n);let{width:F,height:D,dataFormat:N,type:J,compressed:te=!1,mipmaps:he=!0}=e;const{depth:ue=0}=e;return{width:F,height:D,compressed:te,dataFormat:N,type:J}=this._deduceParameters({format:o,type:J,dataFormat:N,compressed:te,data:t,width:F,height:D}),this.width=F,this.height=D,this.depth=ue,this.format=o,this.type=J,this.dataFormat=N,this.border=l,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),he&&this._isNPOT()&&(lr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),he=!1,this._updateForNPOT(g)),this.mipmaps=he,this.setImageData({data:t,width:F,height:D,depth:ue,format:o,type:J,dataFormat:N,border:l,mipmaps:he,parameters:b,compressed:te}),he&&this.generateMipmap(),this.setParameters(g),s&&(this.data=t),r&&(this._video={video:t,parameters:g,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:n=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(lr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Yu(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:n=0,format:o=this.format,border:l=this.border,offset:s=0,parameters:g={}}=e;let{data:b=null,type:S=this.type,width:F=this.width,height:D=this.height,dataFormat:N=this.dataFormat,compressed:J=!1}=e;b||(b=r),{type:S,dataFormat:N,compressed:J,width:F,height:D}=this._deduceParameters({format:o,type:S,dataFormat:N,compressed:J,data:b,width:F,height:D});const{gl:te}=this;te.bindTexture(this.target,this.handle);let he=null;({data:b,dataType:he}=this._getDataType({data:b,compressed:J}));let ue,fe=0;if(Yu(this.gl,g,()=>{switch(he){case"null":te.texImage2D(t,n,o,F,D,l,N,S,b);break;case"typed-array":te.texImage2D(t,n,o,F,D,l,N,S,b,s);break;case"buffer":ue=sc(te),ue.bindBuffer(35052,b.handle||b),ue.texImage2D(t,n,o,F,D,l,N,S,s),ue.bindBuffer(35052,null);break;case"browser-object":An(te)?te.texImage2D(t,n,o,F,D,l,N,S,b):te.texImage2D(t,n,o,N,S,b);break;case"compressed":for(const[ve,Se]of b.entries())te.compressedTexImage2D(t,ve,Se.format,Se.width,Se.height,l,Se.data),fe+=Se.levelSize;break;default:Zi(!1,"Unknown image data type")}}),he==="compressed")this._trackAllocatedMemory(fe,"Texture");else if(b&&b.byteLength)this._trackAllocatedMemory(b.byteLength,"Texture");else{const ve=g3[this.dataFormat]||4,Se=m3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ve*Se,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:n=null,x:o=0,y:l=0,width:s=this.width,height:g=this.height,level:b=0,format:S=this.format,type:F=this.type,dataFormat:D=this.dataFormat,compressed:N=!1,offset:J=0,border:te=this.border,parameters:he={}}=e;if({type:F,dataFormat:D,compressed:N,width:s,height:g}=this._deduceParameters({format:S,type:F,dataFormat:D,compressed:N,data:n,width:s,height:g}),Zi(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const ue=n;n=ue.data,s=ue.shape[0],g=ue.shape[1]}n instanceof xs&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Yu(this.gl,he,()=>{if(N)this.gl.compressedTexSubImage2D(t,b,o,l,s,g,S,n);else if(n===null)this.gl.texSubImage2D(t,b,o,l,s,g,D,F,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,b,o,l,s,g,D,F,n,J);else if(n instanceof y3){const ue=sc(this.gl);ue.bindBuffer(35052,n),ue.texSubImage2D(t,b,o,l,s,g,D,F,J),ue.bindBuffer(35052,null)}else An(this.gl)?sc(this.gl).texSubImage2D(t,b,o,l,s,g,D,F,n):this.gl.texSubImage2D(t,b,o,l,D,F,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return lr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof xs?{data:t.handle,dataType:"buffer"}:t instanceof y3?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:o,dataFormat:l,type:s,compressed:g}=e;const b=e2[t];return l=l||b&&b.dataFormat,s=s||b&&b.types[0],g=g||b&&b.compressed,{width:n,height:o}=this._deduceImageSize(r,n,o),{dataFormat:l,type:s,compressed:g,width:n,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:t,height:r}:n={width:t>=0?t:1,height:r>=0?r:1},Zi(n,"Could not deduced texture size"),Zi(t===void 0||n.width===t,"Deduced texture width does not match supplied width"),Zi(r===void 0||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Zi(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return An(this.gl)||!this.width||!this.height?!1:!A3(this.width)||!A3(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:X9.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let Z9="";function J9(i,e){return Zi(typeof i=="string"),i=Z9+i,new Promise((t,r)=>{try{const n=new Image;n.onload=()=>t(n),n.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=i}catch(n){r(n)}})}class Zc extends Xp{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Xp.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:J9(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const t2=[34069,34070,34071,34072,34073,34074];class _3 extends Xp{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};K_(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:n=0,y:o=0,mipmapLevel:l=0}=e;return this._subImage({target:t,data:r,x:n,y:o,mipmapLevel:l})}async setCubeMapImageData(e){let{width:t,height:r,pixels:n,data:o,border:l=0,format:s=6408,type:g=5121}=e;const{gl:b}=this,S=n||o,F=await Promise.all(t2.map(D=>{const N=S[D];return Promise.all(Array.isArray(N)?N:[N])}));this.bind(),t2.forEach((D,N)=>{F[N].length>1&&this.opts.mipmaps!==!1&&lr.warn("".concat(this.id," has mipmap and multiple LODs."))(),F[N].forEach((J,te)=>{t&&r?b.texImage2D(D,te,s,t,r,l,s,g,J):b.texImage2D(D,te,s,s,g,J)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:o,data:l,border:s=0,format:g=6408,type:b=5121}=e,{gl:S}=this,F=o||l;return this.bind(),F instanceof Promise?F.then(D=>this.setImageDataForFace(Object.assign({},e,{face:t,data:D,pixels:D}))):this.width||this.height?S.texImage2D(t,0,g,r,n,s,g,b,F):S.texImage2D(t,0,g,g,b,F),this}}_3.FACES=t2;class Y9 extends Xp{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return An(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};sc(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:n,height:o,depth:l=1,border:s=0,format:g,type:b=5121,offset:S=0,data:F,parameters:D={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Yu(this.gl,D,()=>{ArrayBuffer.isView(F)&&this.gl.texImage3D(this.target,t,r,n,o,l,s,g,b,F),F instanceof xs&&(this.gl.bindBuffer(35052,F.handle),this.gl.texImage3D(this.target,t,r,n,o,l,s,g,b,S))}),F&&F.byteLength)this._trackAllocatedMemory(F.byteLength,"Texture");else{const N=g3[this.dataFormat]||4,J=m3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*N*J,"Texture")}return this.loaded=!0,this}}const yf="EXT_color_buffer_float",v3={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:yf,bpp:2},33327:{gl2:yf,bpp:4},34842:{gl2:yf,bpp:8},33326:{gl2:yf,bpp:4},33328:{gl2:yf,bpp:8},34836:{gl2:yf,bpp:16},35898:{gl2:yf,bpp:4}};function eH(i,e,t){const r=t[e];if(!r)return!1;const n=An(i)&&r.gl2||r.gl1;return typeof n=="string"?i.getExtension(n):n}class Zp extends BA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||eH(e,t,v3)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:n=1,samples:o=0}=e;return Zi(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&An(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,n):this.gl.renderbufferStorage(36161,t,r,n),this.format=t,this.width=r,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*v3[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const tH=256,iH=1024,rH=16384,b3=6144,x3=6145,w3=6146,B3=34041,C3="clear: bad arguments";function i2(i){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let l=0;t&&(l|=rH,t!==!0&&(o.clearColor=t)),r&&(l|=tH,r!==!0&&(o.clearDepth=r)),n&&(l|=iH,r!==!0&&(o.clearStencil=r)),Zi(l!==0,C3),Yu(i,o,()=>{i.clear(l)})}function nH(i){let{framebuffer:e=null,buffer:t=b3,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};sc(i),Yu(i,{framebuffer:e},()=>{switch(t){case b3:switch(n.constructor){case Int32Array:i.clearBufferiv(t,r,n);break;case Uint32Array:i.clearBufferuiv(t,r,n);break;case Float32Array:default:i.clearBufferfv(t,r,n)}break;case x3:i.clearBufferfv(x3,0,[n]);break;case w3:i.clearBufferiv(w3,0,[n]);break;case B3:const[o,l]=n;i.clearBufferfi(B3,0,o,l);break;default:Zi(!1,C3)}})}function sH(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Zi(!1),0}}function W_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:l=null,sourceWidth:s,sourceHeight:g,sourceType:b}=e;const{framebuffer:S,deleteFramebuffer:F}=oH(i);Zi(S);const{gl:D,handle:N,attachments:J}=S;s=s||S.width,g=g||S.height,o===36064&&N===null&&(o=1028),Zi(J[o]),b=b||J[o].type,l=aH(l,b,n,s,g),b=b||Jw(l);const te=D.bindFramebuffer(36160,N);return D.readPixels(t,r,s,g,n,b,l),D.bindFramebuffer(36160,te||null),F&&S.delete(),l}function E3(i){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=W_(i,{sourceAttachment:e}),{width:n,height:o}=i;for(;o>t;)({data:r,width:n,height:o}=H9({data:r,width:n,height:o}));V9({data:r,width:n,height:o});const l=document.createElement("canvas");l.width=n,l.height=o;const s=l.getContext("2d"),g=s.createImageData(n,o);return g.data.set(r),s.putImageData(g,0,0),l.toDataURL()}function oH(i){return i instanceof wa?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:gH(i),deleteFramebuffer:!0}}function aH(i,e,t,r,n){if(i)return i;e=e||5121;const o=sy(e,{clamped:!1}),l=sH(t);return new o(r*n*l)}const Vs={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function lH(i){const e=new Zc(i,{format:6408,type:5126,dataFormat:6408}),t=new wa(i,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const S3={[Vs.WEBGL2]:[!1,!0],[Vs.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Vs.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Vs.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Vs.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Vs.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Vs.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Vs.FLOAT_BLEND]:["EXT_float_blend"],[Vs.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Vs.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Vs.TEXTURE_FLOAT]:["OES_texture_float",!0],[Vs.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Vs.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Vs.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Vs.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Vs.COLOR_ATTACHMENT_RGBA32F]:[lH,"EXT_color_buffer_float"],[Vs.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Vs.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Vs.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Vs.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Vs.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Vs.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},cH=2;function r2(i,e){return T3(i,e)}function T3(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>I3(i,t))}function uH(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in S3)i.luma.caps[e]===void 0&&(i.luma.caps[e]=I3(i,e));return i.luma.caps}function I3(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=hH(i,e)),i.luma.caps[e]||lr.log(cH,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function hH(i,e){const t=S3[e];Zi(t,e);let r;const n=An(i)&&t[1]||t[0];if(typeof n=="function")r=n(i);else if(Array.isArray(n)){r=!0;for(const o of n)r=r&&!!i.getExtension(o)}else typeof n=="string"?r=!!i.getExtension(n):typeof n=="boolean"?r=n:Zi(!1);return r}const L3="Multiple render targets not supported";class wa extends BA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:n}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new wa(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=sc(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=sc(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:n=null,color:o=!0,depth:l=!0,stencil:s=!1,check:g=!0,readBuffer:b=void 0,drawBuffers:S=void 0}=e;if(Zi(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,n)for(const F in n){const D=n[F];(Array.isArray(D)?D[0]:D).resize({width:t,height:r})}else n=this._createDefaultAttachments(o,l,s,t,r);this.update({clearAttachments:!0,attachments:n,readBuffer:b,drawBuffers:S}),n&&g&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:l=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:l});const{gl:s}=this,g=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,g||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Zi(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&lr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const n in this.attachments)this.attachments[n].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&Object.keys(this.attachments).forEach(l=>{n[l]=null}),Object.assign(n,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const l in n){Zi(l!==void 0,"Misspelled framebuffer binding point?");const s=Number(l),g=n[s];let b=g;if(!b)this._unattach(s);else if(b instanceof Zp)this._attachRenderbuffer({attachment:s,renderbuffer:b});else if(Array.isArray(g)){const[S,F=0,D=0]=g;b=S,this._attachTexture({attachment:s,texture:S,layer:F,level:D})}else this._attachTexture({attachment:s,texture:b,layer:0,level:0});r&&b&&b.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(l=>!this.attachments[l]).forEach(l=>{delete this.attachments[l]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(dH(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:n,drawBuffers:o=[]}=e,l=this.gl.bindFramebuffer(36160,this.handle);return(t||r||n)&&i2(this.gl,{color:t,depth:r,stencil:n}),o.forEach((s,g)=>{nH(this.gl,{drawBuffer:g,value:s})}),this.gl.bindFramebuffer(36160,l||null),this}readPixels(){return lr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return lr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return lr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return lr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return lr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return lr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:n=0,width:o,height:l}=e;const s=sc(this.gl),g=s.bindFramebuffer(36008,this.handle);return r===0&&n===0&&o===void 0&&l===void 0?s.invalidateFramebuffer(36008,t):s.invalidateFramebuffer(36008,t,r,n,o,l),s.bindFramebuffer(36008,g),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=od(this.gl,n)),n}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of r){const l=t?od(this.gl,o):o;n[l]=this.getAttachmentParameter(e,o,t)}return n}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const n of t){const o=Number(n),l=e?od(this.gl,o):o;r[l]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(E3(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>lr.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=E3(this,{targetMaxHeight:100});return lr.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,o){let l=null;return e&&(l=l||{},l[36064]=new Zc(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(l[36064])),t&&r?(l=l||{},l[33306]=new Zp(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(l[33306])):t?(l=l||{},l[36096]=new Zp(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(l[36096])):r&&Zi(!1),l}_unattach(e){const t=this.attachments[e];t&&(t instanceof Zp?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:n,level:o}=e;const{gl:l}=this;switch(l.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:sc(l).framebufferTextureLayer(36160,t,r.target,o,n);break;case 34067:const g=AH(n);l.framebufferTexture2D(36160,t,g,r.handle,o);break;case 3553:l.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Zi(!1,"Illegal texture type")}l.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=VV(this.gl);t?t.readBuffer(e):Zi(e===36064||e===1029,L3),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=sc(t);if(r)r.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Zi(e.length===1&&(e[0]===36064||e[0]===1029),L3)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=uH(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function AH(i){return i<34069?i+34069:i}function dH(i){return(wa.STATUS||{})[i]||"Framebuffer error ".concat(i)}const fH=[36049,36048,33296,33298,33299,33300,33301,33302,33303];wa.ATTACHMENT_PARAMETERS=fH;function pH(i,e){Zi(i instanceof Zc||i instanceof _3||i instanceof Y9);const t=i.constructor,{gl:r,width:n,height:o,format:l,type:s,dataFormat:g,border:b,mipmaps:S}=i,F=Object.assign({width:n,height:o,format:l,type:s,dataFormat:g,border:b,mipmaps:S},e);return new t(r,F)}function gH(i,e){const{gl:t,width:r,height:n,id:o}=i;return new wa(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{36064:i}}))}function X_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(t);return r?r[1]:e}const mH=35632,yH=35633;function _H(i){switch(i){case mH:return"fragment";case yH:return"vertex";default:return"unknown type"}}function vH(i,e,t,r){const n=i.split(/\r?\n/),o={},l={},s=r||X_(e)||"(unnamed)",g="".concat(_H(t)," shader ").concat(s);for(let S=0;S<n.length;S++){const F=n[S];if(F.length<=1)continue;const D=F.split(":"),N=D[0],J=parseInt(D[2],10);if(isNaN(J))throw new Error("GLSL compilation error in ".concat(g,": ").concat(i));N!=="WARNING"?o[J]=F:l[J]=F}const b=bH(e);return{shaderName:g,errors:M3(o,b),warnings:M3(l,b)}}function M3(i,e){let t="";for(let r=0;r<e.length;r++){const n=e[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(t+="".concat(n,`
`),i[r+1])){const o=i[r+1],l=o.split(":",3),s=l[0],g=parseInt(l[1],10)||0,b=o.substring(l.join(":").length+1).trim();t+=P3("^^^ ".concat(s,": ").concat(b,`

`),g)}}return t}function bH(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),n=String(r.length+e-1).length;return r.map((o,l)=>{const s=String(l+e),g=s.length;return P3(s,n-g)+t+o})}function P3(i,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(i)}function F3(i){let e=100;const t=i.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const xH="Shader: GLSL source code must be a JavaScript string";class oy extends BA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Zi(!1),"unknown"}}constructor(e,t){K_(e),Zi(typeof t.source=="string",xH);const r=X_(t.source,null)||t.id||wA("unnamed ".concat(oy.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=X_(t,null);r&&(this.id=wA(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(oy.getTypeName(this.shaderType),":").concat(this.id)}getName(){return X_(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:n,errors:o,warnings:l}=vH(r,this.source,this.shaderType,this.id);throw lr.error("GLSL compilation errors in ".concat(n,`
`).concat(o))(),lr.warn("GLSL compilation warnings in ".concat(n,`
`).concat(l))(),new Error("GLSL compilation errors in ".concat(n))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class n2 extends oy{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class s2 extends oy{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const wH={5126:qs.bind(null,"uniform1fv",Jc,1,Tl),35664:qs.bind(null,"uniform2fv",Jc,2,Tl),35665:qs.bind(null,"uniform3fv",Jc,3,Tl),35666:qs.bind(null,"uniform4fv",Jc,4,Tl),5124:qs.bind(null,"uniform1iv",ad,1,Tl),35667:qs.bind(null,"uniform2iv",ad,2,Tl),35668:qs.bind(null,"uniform3iv",ad,3,Tl),35669:qs.bind(null,"uniform4iv",ad,4,Tl),35670:qs.bind(null,"uniform1iv",ad,1,Tl),35671:qs.bind(null,"uniform2iv",ad,2,Tl),35672:qs.bind(null,"uniform3iv",ad,3,Tl),35673:qs.bind(null,"uniform4iv",ad,4,Tl),35674:qs.bind(null,"uniformMatrix2fv",Jc,4,CA),35675:qs.bind(null,"uniformMatrix3fv",Jc,9,CA),35676:qs.bind(null,"uniformMatrix4fv",Jc,16,CA),35678:sl,35680:sl,5125:qs.bind(null,"uniform1uiv",Z_,1,Tl),36294:qs.bind(null,"uniform2uiv",Z_,2,Tl),36295:qs.bind(null,"uniform3uiv",Z_,3,Tl),36296:qs.bind(null,"uniform4uiv",Z_,4,Tl),35685:qs.bind(null,"uniformMatrix2x3fv",Jc,6,CA),35686:qs.bind(null,"uniformMatrix2x4fv",Jc,8,CA),35687:qs.bind(null,"uniformMatrix3x2fv",Jc,6,CA),35688:qs.bind(null,"uniformMatrix3x4fv",Jc,12,CA),35689:qs.bind(null,"uniformMatrix4x2fv",Jc,8,CA),35690:qs.bind(null,"uniformMatrix4x3fv",Jc,12,CA),35678:sl,35680:sl,35679:sl,35682:sl,36289:sl,36292:sl,36293:sl,36298:sl,36299:sl,36300:sl,36303:sl,36306:sl,36307:sl,36308:sl,36311:sl},BH={},CH={},EH={},D3=[0];function o2(i,e,t,r){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(D3[0]=i,i=D3);const n=i.length;if(n%e&&lr.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof t)return i;let o=r[n];o||(o=new t(n),r[n]=o);for(let l=0;l<n;l++)o[l]=i[l];return o}function Jc(i,e){return o2(i,e,Float32Array,BH)}function ad(i,e){return o2(i,e,Int32Array,CH)}function Z_(i,e){return o2(i,e,Uint32Array,EH)}function R3(i,e,t){const r=wH[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,i,e)}function SH(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=i.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function TH(i,e,t){for(const r in i){const n=i[r];if((!t||!!t[r])&&!IH(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),n),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function IH(i){return Array.isArray(i)||ArrayBuffer.isView(i)?MH(i):isFinite(i)||i===!0||i===!1||i instanceof Xp||i instanceof Zp?!0:i instanceof wa?!!i.texture:!1}function LH(i,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(i[e]){const r=i[e];for(let n=0,o=t.length;n<o;++n)r[n]=t[n]}else i[e]=t.slice();else i[e]=t}function MH(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(i[t]))return!1;return!0}function sl(){let i=null;return(e,t,r)=>{const n=i!==r;return n&&(e.uniform1i(t,r),i=r),n}}function qs(i,e,t,r){let n=null,o=null;return(l,s,g)=>{const b=e(g,t),S=b.length;let F=!1;if(n===null)n=new Float32Array(S),o=S,F=!0;else{Zi(o===S,"Uniform length cannot change.");for(let D=0;D<S;++D)if(b[D]!==n[D]){F=!0;break}}return F&&(r(l,i,s,b),n.set(b)),F}}function Tl(i,e,t,r){i[e](t,r)}function CA(i,e,t,r){i[e](t,!1,r)}const PH=5120,FH=5121,DH=5122,RH=5123,k3=0,J_=1,kH=2,OH=3,Y_=4,UH=5,NH=6,Ba=5126,zH=35664,QH=35665,VH=35666,ay=5124,HH=35667,GH=35668,jH=35669,ly=5125,qH=36294,$H=36295,KH=36296,WH=35670,XH=35671,ZH=35672,JH=35673,YH=35674,e7=35675,t7=35676,i7=35685,r7=35686,n7=35687,s7=35688,o7=35689,a7=35690,a2={[Ba]:[Ba,1,"float"],[zH]:[Ba,2,"vec2"],[QH]:[Ba,3,"vec3"],[VH]:[Ba,4,"vec4"],[ay]:[ay,1,"int"],[HH]:[ay,2,"ivec2"],[GH]:[ay,3,"ivec3"],[jH]:[ay,4,"ivec4"],[ly]:[ly,1,"uint"],[qH]:[ly,2,"uvec2"],[$H]:[ly,3,"uvec3"],[KH]:[ly,4,"uvec4"],[WH]:[Ba,1,"bool"],[XH]:[Ba,2,"bvec2"],[ZH]:[Ba,3,"bvec3"],[JH]:[Ba,4,"bvec4"],[YH]:[Ba,8,"mat2"],[i7]:[Ba,8,"mat2x3"],[r7]:[Ba,8,"mat2x4"],[e7]:[Ba,12,"mat3"],[n7]:[Ba,12,"mat3x2"],[s7]:[Ba,12,"mat3x4"],[t7]:[Ba,16,"mat4"],[o7]:[Ba,16,"mat4x2"],[a7]:[Ba,16,"mat4x3"]};function l7(i){switch(i){case k3:return k3;case J_:return J_;case OH:return J_;case kH:return J_;case Y_:return Y_;case UH:return Y_;case NH:return Y_;default:return Zi(!1),0}}function O3(i){const e=a2[i];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function U3(i,e){switch(i){case PH:case FH:case DH:case RH:i=Ba;break}for(const t in a2){const[r,n,o]=a2[t];if(r===i&&n===e)return{glType:t,name:o}}return null}class c7{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getActiveAttrib(e.handle,n),g=t.getAttribLocation(e.handle,o);g>=0&&this._addAttribute(g,o,l,s)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!An(t))return;const r=t.getProgramParameter(e.handle,35971);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,o,l,s)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(e,t,r,n){const{type:o,components:l}=O3(r),s={type:o,size:n*l};this._inferProperties(e,t,s);const g={location:e,name:t,accessor:new Ec(s)};this.attributeInfos.push(g),this.attributeInfosByLocation[e]=g,this.attributeInfosByName[g.name]=g}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:o,components:l}=O3(r),s=new Ec({type:o,size:n*l}),g={location:e,name:t,accessor:s};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const N3=4,u7=35981,h7=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class z3 extends BA{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",h7),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:n,varyings:o,bufferMode:l=u7}=e;return this.hash=t||"",this.vs=typeof r=="string"?new n2(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof n=="string"?new s2(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Zi(this.vs instanceof n2),Zi(this.fs instanceof s2),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(sc(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,l)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new c7(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:n,offset:o=0,start:l,end:s,isIndexed:g=!1,indexType:b=5123,instanceCount:S=0,isInstanced:F=S>0,vertexArray:D=null,transformFeedback:N,framebuffer:J,parameters:te={},uniforms:he,samplers:ue}=e;if((he||ue)&&(lr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(he||{})),lr.priority>=t){const fe=J?J.id:"default",ve="mode=".concat(od(this.gl,r)," verts=").concat(n," ")+"instances=".concat(S," indexType=").concat(od(this.gl,b)," ")+"isInstanced=".concat(F," isIndexed=").concat(g," ")+"Framebuffer=".concat(fe);lr.log(t,ve)()}return Zi(D),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||F&&S===0?!1:(D.bindForDraw(n,S,()=>{if(J!==void 0&&(te=Object.assign({},te,{framebuffer:J})),N){const fe=l7(r);N.begin(fe)}this._bindTextures(),Yu(this.gl,te,()=>{g&&F?this.gl2.drawElementsInstanced(r,n,b,o,S):g&&An(this.gl)&&!isNaN(l)&&!isNaN(s)?this.gl2.drawRangeElements(r,l,s,n,b,o):g?this.gl.drawElements(r,n,b,o):F?this.gl2.drawArraysInstanced(r,o,n,S):this.gl.drawArrays(r,o,n)}),N&&N.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lr.priority>=2&&TH(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let o=r,l=!1;if(o instanceof wa&&(o=o.texture),o instanceof Xp)if(l=this.uniforms[t]!==r,l){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:g}=n;s.bind(g),o=g,this._textureUniforms[t]=s}else o=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(o)||l)&&LH(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const n of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new n2({handle:n});break;case 35632:r.fs=new s2({handle:n});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=wA(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),lr.time(N3,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),lr.timeEnd(N3,"linkProgram for ".concat(this._getName()))(),e.debug||lr.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n}=SH(r.name);let o=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=R3(e,o,r),r.size>1)for(let l=0;l<r.size;l++)o=e.getUniformLocation(this.handle,"".concat(n,"[").concat(l,"]")),this._uniformSetters["".concat(n,"[").concat(l,"]")]=R3(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const A7=34918,d7=34919,f7=35007,p7=36795,g7=35976,m7=35887,y7=36202;class e1 extends BA{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=An(e),n=T3(e,Vs.TIMER_QUERY);let o=r||n;for(const l of t)switch(l){case"queries":o=o&&r;break;case"timers":o=o&&n;break;default:Zi(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(f7)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?y7:m7)}beginTransformFeedbackQuery(){return this.begin(g7)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,d7);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(p7)}getResult(){return this.gl2.getQueryParameter(this.handle,A7)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return e1.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class Q3 extends BA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return An(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};sc(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Kp(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:o,byteOffset:l}=this._getBufferParams(t);return r<0?(this.unused[e]=n,lr.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,l,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,n;return e instanceof xs?n=e:(n=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let t1=null;function _7(i){return(!t1||t1.byteLength<i)&&(t1=new ArrayBuffer(i)),t1}function v7(i,e){const t=_7(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function b7(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}const x7="elements must be GL.ELEMENT_ARRAY_BUFFER";class Yc extends BA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?An(e)||Q5()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Yc(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Yc.MAX_ATTRIBUTES=Yc.MAX_ATTRIBUTES||e.getParameter(34921),Yc.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:Yc._setConstantFloatArray(e,t,r);break;case Int32Array:Yc._setConstantIntArray(e,t,r);break;case Uint32Array:Yc._setConstantUintArray(e,t,r);break;default:Zi(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Yc.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Zi(!e||e.target===34963,x7),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:n,type:o,stride:l,offset:s,normalized:g,integer:b,divisor:S}=r,{gl:F,gl2:D}=this;return e=Number(e),this.bind(()=>{F.bindBuffer(34962,t.handle),b?(Zi(An(F)),D.vertexAttribIPointer(e,n,o,l,s)):F.vertexAttribPointer(e,n,o,g,l,s),F.enableVertexAttribArray(e),D.vertexAttribDivisor(e,S||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!Yc.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,o=r.length*e;let l=!this.buffer;if(this.buffer=this.buffer||new xs(this.gl,n),l=l||this.buffer.reallocate(n),l=l||!this._compareConstantArrayValues(r,this.bufferValue),l){const s=v7(t.constructor,o);b7({target:s,source:r,start:0,count:o}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Zi(!1)}}static _setConstantIntArray(e,t,r){switch(Zi(An(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Zi(!1)}}static _setConstantUintArray(e,t,r){switch(Zi(An(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Zi(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Zi(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const w7="VertexArray: attributes must be Buffers or constants (i.e. typed array)",B7=/^(.+)__LOCATION_([0-9]+)$/,C7=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class E7{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Yc(e),d3(this,"VertexArray","v6.0",C7),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new xs(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof xs&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof xs&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const o={location:-1,accessor:null},{location:l,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(l)||l<0)return this.unused[e]=t,lr.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const g=this._getAttributeInfo(s||l);if(!g)return o;const b=this.accessors[l]||{},S=Ec.resolve(g.accessor,b,r,n),{size:F,type:D}=S;return Zi(Number.isFinite(F)&&Number.isFinite(D)),{location:l,accessor:S}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=B7.exec(e),n=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof xs)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof xs){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof xs){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(w7)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(e,t){if(Yc.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){Yc.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:o}=n,l=o>0;if(e.isInstanced=e.isInstanced||l,r instanceof xs){const s=r;if(l){const g=s.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,g)}else{const g=s.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,g)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function S7(i,e){const{maxElts:t=16,size:r=1}=e;let n="[";for(let l=0;l<i.length&&l<t;++l)l>0&&(n+=",".concat(l%r===0?" ":"")),n+=cy(i[l],e);const o=i.length>t?"...":"]";return"".concat(n).concat(o)}function cy(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return S7(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<t)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const n=i.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function V3(i){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}=i;Zi(t);const o=".*_.*",l=".*Matrix",s=t._uniformSetters,g={},b=Object.keys(s).sort();let S=0;for(const N of b)!N.match(o)&&!N.match(l)&&l2({table:g,header:e,uniforms:r,uniformName:N,undefinedOnly:n})&&S++;for(const N of b)N.match(l)&&l2({table:g,header:e,uniforms:r,uniformName:N,undefinedOnly:n})&&S++;for(const N of b)g[N]||l2({table:g,header:e,uniforms:r,uniformName:N,undefinedOnly:n})&&S++;let F=0;const D={};if(!n)for(const N in r){const J=r[N];g[N]||(F++,D[N]={Type:"NOT USED: ".concat(J),[e]:cy(J)})}return{table:g,count:S,unusedTable:D,unusedCount:F}}function l2(i){let{table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:o}=i;const l=r[n],s=T7(l);return!o||!s?(e[n]={[t]:s?cy(l):"N/A","Uniform Type":s?l:"NOT PROVIDED"},!0):!1}function T7(i){return i!=null}function I7(i){let{vertexArray:e,header:t="Attributes"}=i;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=H3(e,e.elements,null,t));const n=e.values;for(const o in n){const l=e._getAttributeInfo(o);if(l){let s="".concat(o,": ").concat(l.name);const g=e.accessors[l.location];g&&(s="".concat(o,": ").concat(L7(l.name,g))),r[s]=H3(e,n[o],g,t)}}return r}function H3(i,e,t,r){const{gl:n}=i;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",l=1,s=0,g=0,b,S,F;if(t&&(o=t.type,l=t.size,o=String(o).replace("Array",""),b=o.indexOf("nt")!==-1),e instanceof xs){const D=e,{data:N,changed:J}=D.getDebugData();S=J?"*":"",F=N,g=D.byteLength,s=g/N.BYTES_PER_ELEMENT/l;let te;if(t){const he=t.divisor>0;te="".concat(he?"I ":"P "," ").concat(s," (x").concat(l,"=").concat(g," bytes ").concat(od(n,o),")")}else b=!0,te="".concat(g," bytes");return{[r]:"".concat(S).concat(cy(F,{size:l,isInteger:b})),"Format ":te}}return F=e,l=e.length,o=String(e.constructor.name).replace("Array",""),b=o.indexOf("nt")!==-1,{[r]:"".concat(cy(F,{size:l,isInteger:b})," (constant)"),"Format ":"".concat(l,"x").concat(o," (constant)")}}function L7(i,e){const{type:t,size:r}=e,n=U3(t,r);return n?"".concat(i," (").concat(n.name,")"):i}function M7(i){const e={},t="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const n=G3(r);e["in ".concat(n)]={[t]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const n=G3(r);e["out ".concat(n)]={[t]:JSON.stringify(r.accessor)}}return e}function G3(i){const{type:e,size:t}=i.accessor,r=U3(e,t);return r?"".concat(r.name," ").concat(i.name):i.name}const j3=bA()&&typeof document<"u";let P7=0;class F7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=he=>c3(he),onAddHTML:r=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:l=()=>{},onError:s,gl:g=null,glOptions:b={},debug:S=!1,createFramebuffer:F=!1,autoResizeViewport:D=!0,autoResizeDrawingBuffer:N=!0,stats:J=mf.get("animation-loop-".concat(P7++))}=e;let{useDevicePixels:te=!0}=e;"useDevicePixelRatio"in e&&(lr.deprecated("useDevicePixelRatio","useDevicePixels")(),te=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:o,onFinalize:l,onError:s,gl:g,glOptions:b,debug:S,createFramebuffer:F},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=J,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:D,autoResizeDrawingBuffer:N,useDevicePixels:te}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Zi(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=e1.isSupported(this.gl,["timers"])?new e1(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return lr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=j3?new Promise((e,t)=>{if(j3&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):z9(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):N9(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Kw(this.props.gl,e):this.onCreateContext(e),!$_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");E9(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&M9(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new wa(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const uy="vs",c2="fs";function eu(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const u2={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function D7(i){const e={};for(const t in i){const r=i[t],n=R7(r);e[t]=n}return e}function R7(i){let e=q3(i);return e==="object"?i?"type"in i?Object.assign({},i,u2[i.type]):"value"in i?(e=q3(i.value),Object.assign({type:e},i,u2[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},u2[e])}function q3(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const k7="vs",O7="fs";class $3{constructor(e){let{name:t,vs:r,fs:n,dependencies:o=[],uniforms:l,getUniforms:s,deprecations:g=[],defines:b={},inject:S={},vertexShader:F,fragmentShader:D}=e;eu(typeof t=="string"),this.name=t,this.vs=r||F,this.fs=n||D,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=b,this.injections=U7(S),l&&(this.uniforms=D7(l))}getModuleSource(e){let t;switch(e){case k7:t=this.vs||"";break;case O7:t=this.fs||"";break;default:eu(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const n in r){const o=r[n];n in e&&!o.private?(o.validate&&eu(o.validate(e[n],o),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=o.value}return t}}function U7(i){const e={vs:{},fs:{}};for(const t in i){let r=i[t];const n=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[n][t]=r}return e}function N7(i){return z7(W3(i))}function z7(i){const e={},t={};return K3({modules:i,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,n)=>t[n]-t[r]).map(r=>e[r])}function K3(i){let{modules:e,level:t,moduleMap:r,moduleDepth:n}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(n[o.name]===void 0||n[o.name]<t)&&(n[o.name]=t);for(const o of e)o.dependencies&&K3({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}function W3(i,e){return i.map(t=>(t instanceof $3||(eu(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),eu(t.name,"shader module has no name"),t=new $3(t),t.dependencies=W3(t.dependencies)),t))}function Q7(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=i.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n}const V7=7936,H7=7937,G7=7938,j7=35724,h2={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},_f={};Object.keys(h2).forEach(i=>{_f[i]=i});function q7(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function $7(i){const e=i.getExtension("WEBGL_debug_renderer_info"),t=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||V7),r=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||H7);return{gpuVendor:K7(t,r),vendor:t,renderer:r,version:i.getParameter(G7),shadingLanguageVersion:i.getParameter(j7)}}function K7(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const A2={};function X3(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=h2[e];if(eu(r,e),!Q7(t))return!0;if(e in A2)return A2[e];const n=r[0],o=t.behavior||"enable",l="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),s=i.createShader(35633);i.shaderSource(s,l),i.compileShader(s);const g=i.getShaderParameter(s,35713);return i.deleteShader(s),A2[e]=g,g}function W7(i,e){const t=h2[e];eu(t,e);const r=q7(i)&&t[1]||t[0],n=typeof r=="string"?!!i.getExtension(r):r;return eu(n===!1||n===!0),n}function i1(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>W7(i,t))}function X7(i){switch($7(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Z7(i,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return i1(i,_f.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),i1(i,_f.GLSL_DERIVATIVES)&&X3(i,_f.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),i1(i,_f.GLSL_FRAG_DATA)&&X3(i,_f.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),i1(i,_f.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const J7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Y7=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,eG={[uy]:J7,[c2]:Y7},r1="__LUMA_INJECT_DECLARATIONS__",Z3=/void\s+main\s*\([^)]*\)\s*\{\n?/,J3=/}\n?[^{}]*$/,d2=[];function Y3(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=e===uy;for(const o in t){const l=t[o];l.sort((g,b)=>g.order-b.order),d2.length=l.length;for(let g=0,b=l.length;g<b;++g)d2[g]=l[g].injection;const s="".concat(d2.join(`
`),`
`);switch(o){case"vs:#decl":n&&(i=i.replace(r1,s));break;case"vs:#main-start":n&&(i=i.replace(Z3,g=>g+s));break;case"vs:#main-end":n&&(i=i.replace(J3,g=>s+g));break;case"fs:#decl":n||(i=i.replace(r1,s));break;case"fs:#main-start":n||(i=i.replace(Z3,g=>g+s));break;case"fs:#main-end":n||(i=i.replace(J3,g=>s+g));break;default:i=i.replace(o,g=>g+s)}}return i=i.replace(r1,""),r&&(i=i.replace(/\}\s*$/,o=>o+eG[e])),i}function f2(i){const e={};return eu(Array.isArray(i)&&i.length>1),i.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Jp(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const eL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],tG=[...eL,[Jp("attribute"),"in $1"],[Jp("varying"),"out $1"]],iG=[...eL,[Jp("varying"),"in $1"]],tL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],rG=[...tL,[Jp("in"),"attribute $1"],[Jp("out"),"varying $1"]],nG=[...tL,[Jp("in"),"varying $1"]],p2="gl_FragColor",g2=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,sG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function oG(i,e,t){switch(e){case 300:return t?n1(i,tG):aG(i);case 100:return t?n1(i,rG):lG(i);default:throw new Error("unknown GLSL version ".concat(e))}}function n1(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function aG(i){i=n1(i,iG);const e=i.match(g2);if(e){const t=e[1];i=i.replace(new RegExp("\\b".concat(p2,"\\b"),"g"),t)}else{const t="fragmentColor";i=i.replace(sG,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(p2,"\\b"),"g"),t)}return i}function lG(i){i=n1(i,nG);const e=i.match(g2);if(e){const t=e[1];i=i.replace(g2,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),p2)}return i}const cG=`

`.concat(r1,`

`),iL={[uy]:"vertex",[c2]:"fragment"},uG=`precision highp float;

`;function hG(i,e){const{vs:t,fs:r}=e,n=N7(e.modules||[]);return{gl:i,vs:rL(i,Object.assign({},e,{source:t,type:uy,modules:n})),fs:rL(i,Object.assign({},e,{source:r,type:c2,modules:n})),getUniforms:AG(n)}}function rL(i,e){let{id:t,source:r,type:n,modules:o,defines:l={},hookFunctions:s=[],inject:g={},transpileToGLSL100:b=!1,prologue:S=!0,log:F}=e;eu(typeof r=="string","shader source must be a string");const D=n===uy,N=r.split(`
`);let J=100,te="",he=r;N[0].indexOf("#version ")===0?(J=300,te=N[0],he=N.slice(1).join(`
`)):te="#version ".concat(J);const ue={};o.forEach($e=>{Object.assign(ue,$e.getDefines())}),Object.assign(ue,l);let fe=S?"".concat(te,`
`).concat(fG({id:t,source:r,type:n}),`
`).concat(dG({type:n}),`
`).concat(X7(i),`
`).concat(Z7(i),`
`).concat(pG(ue),`
`).concat(D?"":uG,`
`):"".concat(te,`
`);const ve=mG(s),Se={},Ge={},He={};for(const $e in g){const Ne=typeof g[$e]=="string"?{injection:g[$e],order:0}:g[$e],at=$e.match(/^(v|f)s:(#)?([\w-]+)$/);if(at){const rt=at[2],Re=at[3];rt?Re==="decl"?Ge[$e]=[Ne]:He[$e]=[Ne]:Se[$e]=[Ne]}else He[$e]=[Ne]}for(const $e of o){F&&$e.checkDeprecations(he,F);const Ne=$e.getModuleSource(n,J);fe+=Ne;const at=$e.injections[n];for(const rt in at){const Re=rt.match(/^(v|f)s:#([\w-]+)$/);if(Re){const Je=Re[2]==="decl"?Ge:He;Je[rt]=Je[rt]||[],Je[rt].push(at[rt])}else Se[rt]=Se[rt]||[],Se[rt].push(at[rt])}}return fe+=cG,fe=Y3(fe,n,Ge),fe+=gG(ve[n],Se),fe+=he,fe=Y3(fe,n,He),fe=oG(fe,b?100:J,D),fe}function AG(i){return function(t){const r={};for(const n of i){const o=n.getUniforms(t,r);Object.assign(r,o)}return r}}function dG(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(iL[e].toUpperCase(),`
`)}function fG(i){let{id:e,source:t,type:r}=i;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(iL[r],`

`):""}function pG(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in i){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const n=i[r];(n||Number.isFinite(n))&&(t+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return e===0&&(t+=`
`),t}function gG(i,e){let t="";for(const r in i){const n=i[r];if(t+="void ".concat(n.signature,` {
`),n.header&&(t+="  ".concat(n.header)),e[r]){const o=e[r];o.sort((l,s)=>l.order-s.order);for(const l of o)t+="  ".concat(l.injection,`
`)}n.footer&&(t+="  ".concat(n.footer)),t+=`}
`}return t}function mG(i){const e={vs:{},fs:{}};return i.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[n,o]=t.split(":"),l=t.replace(/\(.+/,"");e[n][l]=Object.assign(r,{signature:o})}),e}const yG="void main() {gl_FragColor = vec4(0);}",nL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,_G=`#version 300 es
`.concat(nL);function sL(i,e){e=Array.isArray(e)?e:[e];const t=i.replace(/^\s+/,"").split(/\s+/),[r,n,o]=t;if(!e.includes(r)||!n||!o)return null;const l=o.split(";")[0];return{qualifier:r,type:n,name:l}}function oL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:n}=i;if(!t)return e===300?_G:e>300?"#version ".concat(e,`
`).concat(nL):yG;const o=xG(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function vG(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return eu(!1),null}}function bG(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return eu(!1),null}}function xG(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return eu(!1),null}}const wG={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function eh(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const BG=1/Math.PI*180,CG=1/180*Math.PI,Ca={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function EG(i){let{precision:e=Ca.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=LG(i),"".concat(parseFloat(i.toPrecision(e)))}function ld(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function SG(i){return IG(i)}function TG(i){return EA(i)}function IG(i,e){return m2(i,t=>t*CG,e)}function EA(i,e){return m2(i,t=>t*BG,e)}function SA(i,e,t){return m2(i,r=>Math.max(e,Math.min(t,r)))}function s1(i,e,t){return ld(i)?i.map((r,n)=>s1(r,e[n],t)):t*e+(1-t)*i}function th(i,e,t){const r=Ca.EPSILON;t&&(Ca.EPSILON=t);try{if(i===e)return!0;if(ld(i)&&ld(e)){if(i.length!==e.length)return!1;for(let n=0;n<i.length;++n)if(!th(i[n],e[n]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=Ca.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{Ca.EPSILON=r}}function LG(i){return Math.round(i/Ca.EPSILON)*Ca.EPSILON}function MG(i){return i.clone?i.clone():new Array(i.length)}function m2(i,e,t){if(ld(i)){const r=i;t=t||MG(r);for(let n=0;n<t.length&&n<r.length;++n)t[n]=e(i[n],n,t);return t}return e(i)}function PG(i){function e(){var t=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class y2 extends PG(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ld(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ca)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+EG(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!th(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const o=e[n];this[n]=o+r*(t[n]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ca.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function FG(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function rs(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function hy(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Ca.debug&&!FG(i,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return i}let _2=class extends y2{get x(){return this[0]}set x(e){this[0]=rs(e)}get y(){return this[1]}set y(e){this[1]=rs(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-e[r];t+=n*n}return rs(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return rs(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return eh(e>=0&&e<this.ELEMENTS,"index is out of range"),rs(this[e])}setComponent(e,t){return eh(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var Ay=1e-6,ih=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function DG(){var i=new ih(2);return ih!=Float32Array&&(i[0]=0,i[1]=0),i}function aL(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function RG(i,e){return i[0]=-e[0],i[1]=-e[1],i}function lL(i,e,t,r){var n=e[0],o=e[1];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i}function kG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i}function OG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n+t[4],i[1]=t[1]*r+t[3]*n+t[5],i}function cL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[3]*n+t[6],i[1]=t[1]*r+t[4]*n+t[7],i}function uL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[4]*n+t[12],i[1]=t[1]*r+t[5]*n+t[13],i}(function(){var i=DG();return function(e,t,r,n,o,l){var s,g;for(t||(t=2),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],o(i,i,l),e[s]=i[0],e[s+1]=i[1];return e}})();function hL(i,e,t){const r=e[0],n=e[1],o=t[3]*r+t[7]*n||1;return i[0]=(t[0]*r+t[4]*n)/o,i[1]=(t[1]*r+t[5]*n)/o,i}function AL(i,e,t){const r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o||1;return i[0]=(t[0]*r+t[4]*n+t[8]*o)/l,i[1]=(t[1]*r+t[5]*n+t[9]*o)/l,i[2]=(t[2]*r+t[6]*n+t[10]*o)/l,i}function UG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i}function NG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i[3]=e[3],i}function dL(i,e,t){const r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[3]*n+t[6]*o,i[1]=t[1]*r+t[4]*n+t[7]*o,i[2]=t[2]*r+t[5]*n+t[8]*o,i[3]=e[3],i}class v2 extends _2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),ld(e)&&arguments.length===1?this.copy(e):(Ca.debug&&(rs(e),rs(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Ca.debug&&(rs(e.x),rs(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return uL(this,this,e),this.check()}transformAsVector(e){return hL(this,this,e),this.check()}transformByMatrix3(e){return cL(this,this,e),this.check()}transformByMatrix2x3(e){return OG(this,this,e),this.check()}transformByMatrix2(e){return kG(this,this,e),this.check()}}function fL(){var i=new ih(3);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function pL(i){var e=i[0],t=i[1],r=i[2];return Math.hypot(e,t,r)}function gL(i,e,t){var r=new ih(3);return r[0]=i,r[1]=e,r[2]=t,r}function zG(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function QG(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function VG(i,e){var t=e[0],r=e[1],n=e[2],o=t*t+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i}function b2(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function o1(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2];return i[0]=n*g-o*s,i[1]=o*l-r*g,i[2]=r*s-n*l,i}function x2(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o+t[15];return l=l||1,i[0]=(t[0]*r+t[4]*n+t[8]*o+t[12])/l,i[1]=(t[1]*r+t[5]*n+t[9]*o+t[13])/l,i[2]=(t[2]*r+t[6]*n+t[10]*o+t[14])/l,i}function mL(i,e,t){var r=e[0],n=e[1],o=e[2];return i[0]=r*t[0]+n*t[3]+o*t[6],i[1]=r*t[1]+n*t[4]+o*t[7],i[2]=r*t[2]+n*t[5]+o*t[8],i}function yL(i,e,t){var r=t[0],n=t[1],o=t[2],l=t[3],s=e[0],g=e[1],b=e[2],S=n*b-o*g,F=o*s-r*b,D=r*g-n*s,N=n*D-o*F,J=o*S-r*D,te=r*F-n*S,he=l*2;return S*=he,F*=he,D*=he,N*=2,J*=2,te*=2,i[0]=s+S+N,i[1]=g+F+J,i[2]=b+D+te,i}function HG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function GG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function jG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function qG(i,e){var t=i[0],r=i[1],n=i[2],o=e[0],l=e[1],s=e[2],g=Math.sqrt(t*t+r*r+n*n),b=Math.sqrt(o*o+l*l+s*s),S=g*b,F=S&&b2(i,e)/S;return Math.acos(Math.min(Math.max(F,-1),1))}var $G=zG,KG=pL;(function(){var i=fL();return function(e,t,r,n,o,l){var s,g;for(t||(t=3),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];return e}})();const w2=[0,0,0];let a1;class Nt extends _2{static get ZERO(){return a1||(a1=new Nt(0,0,0),Object.freeze(a1)),a1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&ld(e)?this.copy(e):(Ca.debug&&(rs(e),rs(t),rs(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ca.debug&&(rs(e.x),rs(e.y),rs(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=rs(e)}angle(e){return qG(this,e)}cross(e){return o1(this,this,e),this.check()}rotateX(e){let{radians:t,origin:r=w2}=e;return HG(this,this,r,t),this.check()}rotateY(e){let{radians:t,origin:r=w2}=e;return GG(this,this,r,t),this.check()}rotateZ(e){let{radians:t,origin:r=w2}=e;return jG(this,this,r,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return x2(this,this,e),this.check()}transformAsVector(e){return AL(this,this,e),this.check()}transformByMatrix3(e){return mL(this,this,e),this.check()}transformByMatrix2(e){return UG(this,this,e),this.check()}transformByQuaternion(e){return yL(this,this,e),this.check()}}let l1;class B2 extends _2{static get ZERO(){return l1||(l1=new B2(0,0,0,0),Object.freeze(l1)),l1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),ld(e)&&arguments.length===1?this.copy(e):(Ca.debug&&(rs(e),rs(t),rs(r),rs(n)),this[0]=e,this[1]=t,this[2]=r,this[3]=n)}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ca.debug&&(rs(e.x),rs(e.y),rs(e.z),rs(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=rs(e)}get w(){return this[3]}set w(e){this[3]=rs(e)}transform(e){return x2(this,this,e),this.check()}transformByMatrix3(e){return dL(this,this,e),this.check()}transformByMatrix2(e){return NG(this,this,e),this.check()}transformByQuaternion(e){return yL(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class _L extends y2{toString(){let e="[";if(Ca.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=rs(r),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[r+n];return t}setColumn(e,t){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=t[n];return this}}function WG(){var i=new ih(9);return ih!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function XG(i,e){if(i===e){var t=e[1],r=e[2],n=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=n}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function ZG(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],b=e[7],S=e[8],F=S*l-s*b,D=-S*o+s*g,N=b*o-l*g,J=t*F+r*D+n*N;return J?(J=1/J,i[0]=F*J,i[1]=(-S*r+n*b)*J,i[2]=(s*r-n*l)*J,i[3]=D*J,i[4]=(S*t-n*g)*J,i[5]=(-s*t+n*o)*J,i[6]=N*J,i[7]=(-b*t+r*g)*J,i[8]=(l*t-r*o)*J,i):null}function JG(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],b=i[8];return e*(b*o-l*g)+t*(-b*n+l*s)+r*(g*n-o*s)}function vL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],S=e[7],F=e[8],D=t[0],N=t[1],J=t[2],te=t[3],he=t[4],ue=t[5],fe=t[6],ve=t[7],Se=t[8];return i[0]=D*r+N*l+J*b,i[1]=D*n+N*s+J*S,i[2]=D*o+N*g+J*F,i[3]=te*r+he*l+ue*b,i[4]=te*n+he*s+ue*S,i[5]=te*o+he*g+ue*F,i[6]=fe*r+ve*l+Se*b,i[7]=fe*n+ve*s+Se*S,i[8]=fe*o+ve*g+Se*F,i}function YG(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],S=e[7],F=e[8],D=t[0],N=t[1];return i[0]=r,i[1]=n,i[2]=o,i[3]=l,i[4]=s,i[5]=g,i[6]=D*r+N*l+b,i[7]=D*n+N*s+S,i[8]=D*o+N*g+F,i}function ej(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],S=e[7],F=e[8],D=Math.sin(t),N=Math.cos(t);return i[0]=N*r+D*l,i[1]=N*n+D*s,i[2]=N*o+D*g,i[3]=N*l-D*r,i[4]=N*s-D*n,i[5]=N*g-D*o,i[6]=b,i[7]=S,i[8]=F,i}function bL(i,e,t){var r=t[0],n=t[1];return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function tj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,b=t*l,S=r*l,F=r*s,D=n*l,N=n*s,J=n*g,te=o*l,he=o*s,ue=o*g;return i[0]=1-F-J,i[3]=S-ue,i[6]=D+he,i[1]=S+ue,i[4]=1-b-J,i[7]=N-te,i[2]=D-he,i[5]=N+te,i[8]=1-b-F,i}var C2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(C2||(C2={}));const ij=Object.freeze([1,0,0,0,1,0,0,0,1]);class wo extends _L{static get IDENTITY(){return nj()}static get ZERO(){return rj()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return C2}constructor(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ij)}fromObject(e){return this.check()}fromQuaternion(e){return tj(this,e),this.check()}set(e,t,r,n,o,l,s,g,b){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=b,this.check()}setRowMajor(e,t,r,n,o,l,s,g,b){return this[0]=e,this[1]=n,this[2]=s,this[3]=t,this[4]=o,this[5]=g,this[6]=r,this[7]=l,this[8]=b,this.check()}determinant(){return JG(this)}transpose(){return XG(this,this),this.check()}invert(){return ZG(this,this),this.check()}multiplyLeft(e){return vL(this,e,this),this.check()}multiplyRight(e){return vL(this,this,e),this.check()}rotate(e){return ej(this,this,e),this.check()}scale(e){return Array.isArray(e)?bL(this,this,e):bL(this,this,[e,e]),this.check()}translate(e){return YG(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=cL(t||[-0,-0],e,this);break;case 3:r=mL(t||[-0,-0,-0],e,this);break;case 4:r=dL(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let c1,u1;function rj(){return c1||(c1=new wo([0,0,0,0,0,0,0,0,0]),Object.freeze(c1)),c1}function nj(){return u1||(u1=new wo,Object.freeze(u1)),u1}function sj(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oj(i,e){if(i===e){var t=e[1],r=e[2],n=e[3],o=e[6],l=e[7],s=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=o,i[11]=e[14],i[12]=n,i[13]=l,i[14]=s}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function E2(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],b=e[7],S=e[8],F=e[9],D=e[10],N=e[11],J=e[12],te=e[13],he=e[14],ue=e[15],fe=t*s-r*l,ve=t*g-n*l,Se=t*b-o*l,Ge=r*g-n*s,He=r*b-o*s,$e=n*b-o*g,Ne=S*te-F*J,at=S*he-D*J,rt=S*ue-N*J,Re=F*he-D*te,Pe=F*ue-N*te,Je=D*ue-N*he,Xe=fe*Je-ve*Pe+Se*Re+Ge*rt-He*at+$e*Ne;return Xe?(Xe=1/Xe,i[0]=(s*Je-g*Pe+b*Re)*Xe,i[1]=(n*Pe-r*Je-o*Re)*Xe,i[2]=(te*$e-he*He+ue*Ge)*Xe,i[3]=(D*He-F*$e-N*Ge)*Xe,i[4]=(g*rt-l*Je-b*at)*Xe,i[5]=(t*Je-n*rt+o*at)*Xe,i[6]=(he*Se-J*$e-ue*ve)*Xe,i[7]=(S*$e-D*Se+N*ve)*Xe,i[8]=(l*Pe-s*rt+b*Ne)*Xe,i[9]=(r*rt-t*Pe-o*Ne)*Xe,i[10]=(J*He-te*Se+ue*fe)*Xe,i[11]=(F*Se-S*He-N*fe)*Xe,i[12]=(s*at-l*Re-g*Ne)*Xe,i[13]=(t*Re-r*at+n*Ne)*Xe,i[14]=(te*ve-J*Ge-he*fe)*Xe,i[15]=(S*Ge-F*ve+D*fe)*Xe,i):null}function aj(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],b=i[8],S=i[9],F=i[10],D=i[11],N=i[12],J=i[13],te=i[14],he=i[15],ue=e*l-t*o,fe=e*s-r*o,ve=e*g-n*o,Se=t*s-r*l,Ge=t*g-n*l,He=r*g-n*s,$e=b*J-S*N,Ne=b*te-F*N,at=b*he-D*N,rt=S*te-F*J,Re=S*he-D*J,Pe=F*he-D*te;return ue*Pe-fe*Re+ve*rt+Se*at-Ge*Ne+He*$e}function vf(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],S=e[7],F=e[8],D=e[9],N=e[10],J=e[11],te=e[12],he=e[13],ue=e[14],fe=e[15],ve=t[0],Se=t[1],Ge=t[2],He=t[3];return i[0]=ve*r+Se*s+Ge*F+He*te,i[1]=ve*n+Se*g+Ge*D+He*he,i[2]=ve*o+Se*b+Ge*N+He*ue,i[3]=ve*l+Se*S+Ge*J+He*fe,ve=t[4],Se=t[5],Ge=t[6],He=t[7],i[4]=ve*r+Se*s+Ge*F+He*te,i[5]=ve*n+Se*g+Ge*D+He*he,i[6]=ve*o+Se*b+Ge*N+He*ue,i[7]=ve*l+Se*S+Ge*J+He*fe,ve=t[8],Se=t[9],Ge=t[10],He=t[11],i[8]=ve*r+Se*s+Ge*F+He*te,i[9]=ve*n+Se*g+Ge*D+He*he,i[10]=ve*o+Se*b+Ge*N+He*ue,i[11]=ve*l+Se*S+Ge*J+He*fe,ve=t[12],Se=t[13],Ge=t[14],He=t[15],i[12]=ve*r+Se*s+Ge*F+He*te,i[13]=ve*n+Se*g+Ge*D+He*he,i[14]=ve*o+Se*b+Ge*N+He*ue,i[15]=ve*l+Se*S+Ge*J+He*fe,i}function h1(i,e,t){var r=t[0],n=t[1],o=t[2],l,s,g,b,S,F,D,N,J,te,he,ue;return e===i?(i[12]=e[0]*r+e[4]*n+e[8]*o+e[12],i[13]=e[1]*r+e[5]*n+e[9]*o+e[13],i[14]=e[2]*r+e[6]*n+e[10]*o+e[14],i[15]=e[3]*r+e[7]*n+e[11]*o+e[15]):(l=e[0],s=e[1],g=e[2],b=e[3],S=e[4],F=e[5],D=e[6],N=e[7],J=e[8],te=e[9],he=e[10],ue=e[11],i[0]=l,i[1]=s,i[2]=g,i[3]=b,i[4]=S,i[5]=F,i[6]=D,i[7]=N,i[8]=J,i[9]=te,i[10]=he,i[11]=ue,i[12]=l*r+S*n+J*o+e[12],i[13]=s*r+F*n+te*o+e[13],i[14]=g*r+D*n+he*o+e[14],i[15]=b*r+N*n+ue*o+e[15]),i}function S2(i,e,t){var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function lj(i,e,t,r){var n=r[0],o=r[1],l=r[2],s=Math.hypot(n,o,l),g,b,S,F,D,N,J,te,he,ue,fe,ve,Se,Ge,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct;return s<Ay?null:(s=1/s,n*=s,o*=s,l*=s,g=Math.sin(t),b=Math.cos(t),S=1-b,F=e[0],D=e[1],N=e[2],J=e[3],te=e[4],he=e[5],ue=e[6],fe=e[7],ve=e[8],Se=e[9],Ge=e[10],He=e[11],$e=n*n*S+b,Ne=o*n*S+l*g,at=l*n*S-o*g,rt=n*o*S-l*g,Re=o*o*S+b,Pe=l*o*S+n*g,Je=n*l*S+o*g,Xe=o*l*S-n*g,Ct=l*l*S+b,i[0]=F*$e+te*Ne+ve*at,i[1]=D*$e+he*Ne+Se*at,i[2]=N*$e+ue*Ne+Ge*at,i[3]=J*$e+fe*Ne+He*at,i[4]=F*rt+te*Re+ve*Pe,i[5]=D*rt+he*Re+Se*Pe,i[6]=N*rt+ue*Re+Ge*Pe,i[7]=J*rt+fe*Re+He*Pe,i[8]=F*Je+te*Xe+ve*Ct,i[9]=D*Je+he*Xe+Se*Ct,i[10]=N*Je+ue*Xe+Ge*Ct,i[11]=J*Je+fe*Xe+He*Ct,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function xL(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[4],l=e[5],s=e[6],g=e[7],b=e[8],S=e[9],F=e[10],D=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=o*n+b*r,i[5]=l*n+S*r,i[6]=s*n+F*r,i[7]=g*n+D*r,i[8]=b*n-o*r,i[9]=S*n-l*r,i[10]=F*n-s*r,i[11]=D*n-g*r,i}function cj(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],b=e[8],S=e[9],F=e[10],D=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n-b*r,i[1]=l*n-S*r,i[2]=s*n-F*r,i[3]=g*n-D*r,i[8]=o*r+b*n,i[9]=l*r+S*n,i[10]=s*r+F*n,i[11]=g*r+D*n,i}function wL(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],b=e[4],S=e[5],F=e[6],D=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n+b*r,i[1]=l*n+S*r,i[2]=s*n+F*r,i[3]=g*n+D*r,i[4]=b*n-o*r,i[5]=S*n-l*r,i[6]=F*n-s*r,i[7]=D*n-g*r,i}function uj(i,e){var t=e[0],r=e[1],n=e[2],o=e[4],l=e[5],s=e[6],g=e[8],b=e[9],S=e[10];return i[0]=Math.hypot(t,r,n),i[1]=Math.hypot(o,l,s),i[2]=Math.hypot(g,b,S),i}function hj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,b=t*l,S=r*l,F=r*s,D=n*l,N=n*s,J=n*g,te=o*l,he=o*s,ue=o*g;return i[0]=1-F-J,i[1]=S+ue,i[2]=D-he,i[3]=0,i[4]=S-ue,i[5]=1-b-J,i[6]=N+te,i[7]=0,i[8]=D+he,i[9]=N-te,i[10]=1-b-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Aj(i,e,t,r,n,o,l){var s=1/(t-e),g=1/(n-r),b=1/(o-l);return i[0]=o*2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*g,i[6]=0,i[7]=0,i[8]=(t+e)*s,i[9]=(n+r)*g,i[10]=(l+o)*b,i[11]=-1,i[12]=0,i[13]=0,i[14]=l*o*2*b,i[15]=0,i}function dj(i,e,t,r,n){var o=1/Math.tan(e/2),l;return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(l=1/(r-n),i[10]=(n+r)*l,i[14]=2*n*r*l):(i[10]=-1,i[14]=-2*r),i}var fj=dj;function pj(i,e,t,r,n,o,l){var s=1/(e-t),g=1/(r-n),b=1/(o-l);return i[0]=-2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(e+t)*s,i[13]=(n+r)*g,i[14]=(l+o)*b,i[15]=1,i}var gj=pj;function mj(i,e,t,r){var n,o,l,s,g,b,S,F,D,N,J=e[0],te=e[1],he=e[2],ue=r[0],fe=r[1],ve=r[2],Se=t[0],Ge=t[1],He=t[2];return Math.abs(J-Se)<Ay&&Math.abs(te-Ge)<Ay&&Math.abs(he-He)<Ay?sj(i):(S=J-Se,F=te-Ge,D=he-He,N=1/Math.hypot(S,F,D),S*=N,F*=N,D*=N,n=fe*D-ve*F,o=ve*S-ue*D,l=ue*F-fe*S,N=Math.hypot(n,o,l),N?(N=1/N,n*=N,o*=N,l*=N):(n=0,o=0,l=0),s=F*l-D*o,g=D*n-S*l,b=S*o-F*n,N=Math.hypot(s,g,b),N?(N=1/N,s*=N,g*=N,b*=N):(s=0,g=0,b=0),i[0]=n,i[1]=s,i[2]=S,i[3]=0,i[4]=o,i[5]=g,i[6]=F,i[7]=0,i[8]=l,i[9]=b,i[10]=D,i[11]=0,i[12]=-(n*J+o*te+l*he),i[13]=-(s*J+g*te+b*he),i[14]=-(S*J+F*te+D*he),i[15]=1,i)}function yj(){var i=new ih(4);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function _j(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function BL(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function vj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return Math.hypot(e,t,r,n)}function bj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return e*e+t*t+r*r+n*n}function xj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o;return l>0&&(l=1/Math.sqrt(l)),i[0]=t*l,i[1]=r*l,i[2]=n*l,i[3]=o*l,i}function wj(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function Bj(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i[2]=l+r*(t[2]-l),i[3]=s+r*(t[3]-s),i}function dy(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*l,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*l,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*l,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*l,i}function Cj(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2],b=t[3],S=b*r+s*o-g*n,F=b*n+g*r-l*o,D=b*o+l*n-s*r,N=-l*r-s*n-g*o;return i[0]=S*b+N*-l+F*-g-D*-s,i[1]=F*b+N*-s+D*-l-S*-g,i[2]=D*b+N*-g+S*-s-F*-l,i[3]=e[3],i}(function(){var i=yj();return function(e,t,r,n,o,l){var s,g;for(t||(t=4),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3];return e}})();var T2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(T2||(T2={}));const Ej=45*Math.PI/180,Sj=1,I2=.1,L2=500,Tj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Cn extends _L{static get IDENTITY(){return Lj()}static get ZERO(){return Ij()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return T2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,n,o,l,s,g,b,S,F,D,N,J,te,he){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=b,this[9]=S,this[10]=F,this[11]=D,this[12]=N,this[13]=J,this[14]=te,this[15]=he,this.check()}setRowMajor(e,t,r,n,o,l,s,g,b,S,F,D,N,J,te,he){return this[0]=e,this[1]=o,this[2]=b,this[3]=N,this[4]=t,this[5]=l,this[6]=S,this[7]=J,this[8]=r,this[9]=s,this[10]=F,this[11]=te,this[12]=n,this[13]=g,this[14]=D,this[15]=he,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Tj)}fromObject(e){return this.check()}fromQuaternion(e){return hj(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:n,top:o,near:l=I2,far:s=L2}=e;return s===1/0?Mj(this,t,r,n,o,l):Aj(this,t,r,n,o,l,s),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:n=[0,1,0]}=e;return mj(this,t,r,n),this.check()}ortho(e){const{left:t,right:r,bottom:n,top:o,near:l=I2,far:s=L2}=e;return gj(this,t,r,n,o,l,s),this.check()}orthographic(e){const{fovy:t=Ej,aspect:r=Sj,focalDistance:n=1,near:o=I2,far:l=L2}=e;CL(t);const s=t/2,g=n*Math.tan(s),b=g*r;return this.ortho({left:-b,right:b,bottom:-g,top:g,near:o,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:n=.1,far:o=500}=e;return CL(t),fj(this,t,r,n,o),this.check()}determinant(){return aj(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*l,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*l,e}transpose(){return oj(this,this),this.check()}invert(){return E2(this,this),this.check()}multiplyLeft(e){return vf(this,e,this),this.check()}multiplyRight(e){return vf(this,this,e),this.check()}rotateX(e){return xL(this,this,e),this.check()}rotateY(e){return cj(this,this,e),this.check()}rotateZ(e){return wL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return lj(this,this,e,t),this.check()}scale(e){return S2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return h1(this,this,e),this.check()}transform(e,t){return e.length===4?(t=dy(t||[-0,-0,-0,-0],e,this),hy(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let n;switch(r){case 2:n=uL(t||[-0,-0],e,this);break;case 3:n=x2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(n,e.length),n}transformAsVector(e,t){let r;switch(e.length){case 2:r=hL(t||[-0,-0],e,this);break;case 3:r=AL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hy(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let A1,d1;function Ij(){return A1||(A1=new Cn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(A1)),A1}function Lj(){return d1||(d1=new Cn,Object.freeze(d1)),d1}function CL(i){if(i>Math.PI*2)throw Error("expected radians")}function Mj(i,e,t,r,n,o){const l=2*o/(t-e),s=2*o/(n-r),g=(t+e)/(t-e),b=(n+r)/(n-r),S=-1,F=-1,D=-2*o;return i[0]=l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=g,i[9]=b,i[10]=S,i[11]=F,i[12]=0,i[13]=0,i[14]=D,i[15]=0,i}function EL(){var i=new ih(4);return ih!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Pj(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function SL(i,e,t){t=t*.5;var r=Math.sin(t);return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=Math.cos(t),i}function TL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=t[0],g=t[1],b=t[2],S=t[3];return i[0]=r*S+l*s+n*b-o*g,i[1]=n*S+l*g+o*s-r*b,i[2]=o*S+l*b+r*g-n*s,i[3]=l*S-r*s-n*g-o*b,i}function Fj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+l*s,i[1]=n*g+o*s,i[2]=o*g-n*s,i[3]=l*g-r*s,i}function Dj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g-o*s,i[1]=n*g+l*s,i[2]=o*g+r*s,i[3]=l*g-n*s,i}function Rj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+n*s,i[1]=n*g-r*s,i[2]=o*g+l*s,i[3]=l*g-o*s,i}function kj(i,e){var t=e[0],r=e[1],n=e[2];return i[0]=t,i[1]=r,i[2]=n,i[3]=Math.sqrt(Math.abs(1-t*t-r*r-n*n)),i}function f1(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3],g=t[0],b=t[1],S=t[2],F=t[3],D,N,J,te,he;return N=n*g+o*b+l*S+s*F,N<0&&(N=-N,g=-g,b=-b,S=-S,F=-F),1-N>Ay?(D=Math.acos(N),J=Math.sin(D),te=Math.sin((1-r)*D)/J,he=Math.sin(r*D)/J):(te=1-r,he=r),i[0]=te*n+he*g,i[1]=te*o+he*b,i[2]=te*l+he*S,i[3]=te*s+he*F,i}function Oj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o,s=l?1/l:0;return i[0]=-t*s,i[1]=-r*s,i[2]=-n*s,i[3]=o*s,i}function Uj(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function IL(i,e){var t=e[0]+e[4]+e[8],r;if(t>0)r=Math.sqrt(t+1),i[3]=.5*r,r=.5/r,i[0]=(e[5]-e[7])*r,i[1]=(e[6]-e[2])*r,i[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var o=(n+1)%3,l=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[o*3+o]-e[l*3+l]+1),i[n]=.5*r,r=.5/r,i[3]=(e[o*3+l]-e[l*3+o])*r,i[o]=(e[o*3+n]+e[n*3+o])*r,i[l]=(e[l*3+n]+e[n*3+l])*r}return i}var Nj=_j,zj=BL,Qj=wj,Vj=Bj,Hj=vj,Gj=bj,LL=xj,jj=function(){var i=fL(),e=gL(1,0,0),t=gL(0,1,0);return function(r,n,o){var l=b2(n,o);return l<-.999999?(o1(i,e,n),KG(i)<1e-6&&o1(i,t,n),VG(i,i),SL(r,i,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o1(i,n,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+l,LL(r,r))}}();(function(){var i=EL(),e=EL();return function(t,r,n,o,l,s){return f1(i,r,l,s),f1(e,n,o,s),f1(t,i,e,2*s*(1-s)),t}})(),function(){var i=WG();return function(e,t,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],LL(e,IL(e,i))}}();const qj=[0,0,0,1];class fy extends y2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return IL(this,e),this.check()}fromAxisRotation(e,t){return SL(this,e,t),this.check()}identity(){return Pj(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=rs(e)}get y(){return this[1]}set y(e){this[1]=rs(e)}get z(){return this[2]}set z(e){this[2]=rs(e)}get w(){return this[3]}set w(e){this[3]=rs(e)}len(){return Hj(this)}lengthSquared(){return Gj(this)}dot(e){return Qj(this,e)}rotationTo(e,t){return jj(this,e,t),this.check()}add(e){return Nj(this,this,e),this.check()}calculateW(){return kj(this,this),this.check()}conjugate(){return Uj(this,this),this.check()}invert(){return Oj(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(Vj(this,e,t,r),this.check())}multiplyRight(e){return TL(this,this,e),this.check()}multiplyLeft(e){return TL(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Fj(this,this,e),this.check()}rotateY(e){return Dj(this,this,e),this.check()}rotateZ(e){return Rj(this,this,e),this.check()}scale(e){return zj(this,this,e),this.check()}slerp(e,t,r){let n,o,l;switch(arguments.length){case 1:({start:n=qj,target:o,ratio:l}=e);break;case 2:n=this,o=e,l=t;break;default:n=e,o=t,l=r}return f1(this,n,o,l),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new B2;return Cj(t,e,this),hy(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const py={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},ML=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,$j={lightSources:{}};function M2(){let{color:i=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(t=>t*e/255)}function Kj(i){let{ambientLight:e,pointLights:t=[],directionalLights:r=[]}=i;const n={};return e?n["lighting_uAmbientLight.color"]=M2(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,l)=>{n["lighting_uPointLight[".concat(l,"].color")]=M2(o),n["lighting_uPointLight[".concat(l,"].position")]=o.position,n["lighting_uPointLight[".concat(l,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((o,l)=>{n["lighting_uDirectionalLight[".concat(l,"].color")]=M2(o),n["lighting_uDirectionalLight[".concat(l,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function PL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$j;if("lightSources"in i){const{ambientLight:e,pointLights:t,directionalLights:r}=i.lightSources||{};return e||t&&t.length>0||r&&r.length>0?Object.assign({},Kj({ambientLight:e,pointLights:t,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const e={pointLights:[],directionalLights:[]};for(const t of i.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return PL({lightSources:e})}return{}}const P2={name:"lights",vs:ML,fs:ML,getUniforms:PL,defines:{MAX_LIGHTS:3}},Wj={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function Xj(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wj;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(i.pickingHighlightColor){const t=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return i.pickingActive!==void 0&&(e.picking_uActive=!!i.pickingActive,e.picking_uAttribute=!!i.pickingAttribute),e}const Zj={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:Xj},FL=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Jj={};function Yj(i){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:n=[30,30,30]}=i;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:n.map(o=>o/255)}}function DL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jj;if(!("material"in i))return{};const{material:e}=i;return e?Yj(e):{lighting_uEnabled:!1}}const eq={name:"gouraud-lighting",dependencies:[P2],vs:FL,defines:{LIGHTING_VERTEX:1},getUniforms:DL},tq={name:"phong-lighting",dependencies:[P2],fs:FL,defines:{LIGHTING_FRAGMENT:1},getUniforms:DL},F2={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[P2]},iq={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class gy{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new gy(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:n={},inject:o={},varyings:l=[],bufferMode:s=35981,transpileToGLSL100:g=!1}=e,b=this._getModuleList(e.modules),S=this._getHash(t),F=this._getHash(r),D=b.map(ve=>this._getHash(ve.name)).sort(),N=l.map(ve=>this._getHash(ve)),J=Object.keys(n).sort(),te=Object.keys(o).sort(),he=[],ue=[];for(const ve of J)he.push(this._getHash(ve)),he.push(this._getHash(n[ve]));for(const ve of te)ue.push(this._getHash(ve)),ue.push(this._getHash(o[ve]));const fe="".concat(S,"/").concat(F,"D").concat(he.join("/"),"M").concat(D.join("/"),"I").concat(ue.join("/"),"V").concat(N.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(g?"T":"");if(!this._programCache[fe]){const ve=hG(this.gl,{vs:t,fs:r,modules:b,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[fe]=new z3(this.gl,{hash:fe,vs:ve.vs,fs:ve.fs,varyings:l,bufferMode:s}),this._getUniforms[fe]=ve.getUniforms||(Se=>{}),this._useCounts[fe]=0}return this._useCounts[fe]++,this._programCache[fe]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let o=0,l=this._defaultModules.length;o<l;++o){const s=this._defaultModules[o],g=s.name;t[n++]=s,r[g]=!0}for(let o=0,l=e.length;o<l;++o){const s=e[o],g=s.name;r[g]||(t[n++]=s,r[g]=!0)}return t.length=n,t}}const rq={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function nq(i,e,t){const r={};let n=e.indices;for(const o in e.attributes){const l=e.attributes[o],s=sq(o,t);if(o==="indices")n=l;else if(l.constant)r[s]=l.value;else{const g=l.value,b={...l};delete b.value,r[s]=[new xs(i,g),b],oq(o,b)}}if(n){const o=n.value||n;Zi(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const l={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};r.indices=[new xs(i,{data:o,target:34963}),l]}return r}function sq(i,e){const{attributeMap:t=rq}=e||{};return t&&t[i]||i}function oq(i,e){let t;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Zi(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const Yp=2,aq=1e4,lq="Model needs drawMode and vertexCount",RL=()=>{},cq={};class eg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=wA("model")}=t;Zi($_(e)),this.id=r,this.gl=e,this.id=t.id||wA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||gy.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:S}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Zi(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),lq)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:S}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Zi(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Zi(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=nq(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kp(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return i2(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:o={},transformFeedback:l=this.transformFeedback,parameters:s={},vertexArray:g=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(n);let b;lr.priority>=Yp&&(b=this._logDrawCallStart(Yp));const S=this.vertexArray.getDrawParams(),{isIndexed:F=S.isIndexed,indexType:D=S.indexType,indexOffset:N=S.indexOffset,vertexArrayInstanced:J=S.isInstanced}=this.props;J&&!this.isInstanced&&lr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:te,instanceCount:he}=this,{onBeforeRender:ue=RL,onAfterRender:fe=RL}=this.props;ue(),this.program.setUniforms(this.uniforms);const ve=this.program.draw(Object.assign(cq,e,{logPriority:b,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:l,isIndexed:F,indexType:D,isInstanced:te,instanceCount:he,offset:F?N:0}));return fe(),lr.priority>=Yp&&this._logDrawCallEnd(b,g,r),ve}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),n.forEach(l=>l.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{n.forEach(l=>l.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:b,transpileToGLSL100:S}=this.programProps;t=this.programManager.get({vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:b,transpileToGLSL100:S}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Zi(t instanceof z3,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new E7(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof xs&&t.delete()}}_setAnimationProps(e){this.animated&&Zi(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kp(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new Q3(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:aq;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),lr.group(Yp,">>> DRAWING MODEL ".concat(this.id),{collapsed:lr.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(e===void 0)return;const o=I7({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:l,unusedTable:s,unusedCount:g}=V3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:b,count:S}=V3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});S>0&&lr.log("MISSING UNIFORMS",Object.keys(b))(),g>0&&lr.log("UNUSED UNIFORMS",Object.keys(s))();const F=M7(this.vertexArray.configuration);lr.table(e,o)(),lr.table(e,l)(),lr.table(e+1,F)(),n&&n.log({logLevel:Yp,message:"Rendered to ".concat(n.id)}),lr.groupEnd(Yp)()}}class uq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof xs?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Zi(An(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in t&&(r[o]=n)}Object.assign(r,e.feedbackBuffers);for(const n in r){const o=r[n];if(typeof o=="string"){const l=t[o],{byteLength:s,usage:g,accessor:b}=l;r[n]=this._createNewBuffer(n,{byteLength:s,usage:g,accessor:b})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:n}=r;e.transformFeedback=new Q3(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];t[n]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[n],Zi(r[o]instanceof xs)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new xs(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const hq="transform_uSampler_",p1="transform_uSize_",kL="transform_position";function Aq(i){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}=i,l=Object.keys(t).length,s=null;const g={};let b=e,S={};if(l>0||r){const F=b.split(`
`),D=F.slice();if(F.forEach((N,J,te)=>{if(l>0){const he=mq(N,t);if(he){const{updatedLine:ue,inject:fe}=he;D[J]=ue,S=f2([S,fe]),Object.assign(g,he.samplerTextureMap),l--}}r&&!s&&(s=gq(N,r))}),r){Zi(n);const N="".concat(p1).concat(r),J="uniform vec2 ".concat(N,`;
`),te="     vec2 ".concat(kL," = transform_getPos(").concat(N,`);
     gl_Position = vec4(`).concat(kL,`, 0, 1.);
`);S=f2([S,{"vs:#decl":J,"vs:#main-start":te}])}b=D.join(`
`)}return{vs:b,targetTextureType:s,inject:S,samplerTextureMap:g}}function dq(i){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=i;const n={};let o,l;t&&({width:o,height:l}=r,n["".concat(p1).concat(t)]=[o,l]);for(const s in e)({width:o,height:l}=e[s]),n["".concat(p1).concat(s)]=[o,l];return n}function fq(i){return sL(i,["attribute","in"])}function pq(i){const e="".concat(hq).concat(i),t="".concat(p1).concat(i),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function gq(i,e){const t=sL(i,["varying","out"]);return t&&t.name===e?t.type:null}function mq(i,e){const t={},r=fq(i);if(!r)return null;const{type:n,name:o}=r;if(o&&e[o]){const l="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:g,uniformDeclerations:b}=pq(o),S=vG(n),F="  ".concat(n," ").concat(o," = transform_getInput(").concat(s,", ").concat(g,").").concat(S,`;
`);return t[s]=o,{updatedLine:l,inject:{"vs:#decl":b,"vs:#main-start":F},samplerTextureMap:t}}return null}const yq={10241:9728,10240:9728,10242:33071,10243:33071},_q="transform_output";class vq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],l=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),g=Object.assign({},e.parameters);let b=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){l.transform_elementID=this.elementIDBuffer;for(const F in this.samplerTextureMap){const D=this.samplerTextureMap[F];s[F]=r[D]}this._setSourceTextureParameters();const S=dq({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,S)}return this.hasTargetTexture&&(b=!1,g.viewport=[0,0,n.width,n.height]),{attributes:l,framebuffer:n,uniforms:s,discard:b,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=W_(t);if(!e)return r;const n=r.constructor,o=bG(this.targetTextureType),l=new n(r.length*o/4);let s=0;for(let g=0;g<r.length;g+=4)for(let b=0;b<o;b++)l[s++]=r[g+b];return l}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof Zc)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new xs(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:l,height:s}=o,{framebuffer:g}=e;g?(g.update({attachments:{36064:o},resizeAttachments:!1}),g.resize({width:l,height:s})):e.framebuffer=new wa(this.gl,{id:"transform-framebuffer",width:l,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(yq)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=pH(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:l,inject:s,samplerTextureMap:g}=Aq({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),b=f2([e.inject||{},s]);this.targetTextureType=l,this.samplerTextureMap=g;const S=e._fs||oL({version:F3(n),input:this.targetTextureVarying,inputType:l,output:_q}),F=this.hasSourceTextures||this.targetTextureVarying?[iq].concat(e.modules||[]):e.modules;return{vs:n,fs:S,modules:F,uniforms:o,inject:b}}}class D2{static isSupported(e){return An(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Zi(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const n=r.getData(e);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new eg(t,Object.assign({},e,{fs:e.fs||oL({version:F3(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=n.updateModelProps(t);return t}_buildResourceTransforms(e,t){bq(t)&&(this.bufferTransform=new uq(e,t)),xq(t)&&(this.textureTransform=new vq(e,t)),Zi(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=Object.assign(t,n.getDrawOptions(t));return t}}function bq(i){return!!(!Kp(i.feedbackBuffers)||!Kp(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function xq(i){return!!(!Kp(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const OL={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class my{static get DRAW_MODE(){return OL}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=wA("geometry"),drawMode:r=OL.TRIANGLES,attributes:n={},indices:o=null,vertexCount:l=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=l||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let n=e[r];n=ArrayBuffer.isView(n)?{value:n}:n,Zi(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!n.size&&(n.size=3),r==="indices"?(Zi(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const n in e){const o=e[n],{value:l,size:s,constant:g}=o;!g&&l&&s>=1&&(r=Math.min(r,l.length/s))}return Zi(Number.isFinite(r)),r}}let wq=1,Bq=1;class UL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,l=wq++,s={time:0,delay:t,duration:r,rate:n,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(l,s),l}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:o,channel:l}=n;o.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=Bq++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,n=e.duration*e.repeat;r>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const Cq=[255,255,255],Eq=1;let Sq=0;class NL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"id",void 0),_e(this,"color",void 0),_e(this,"intensity",void 0),_e(this,"type","ambient");const{color:t=Cq}=e,{intensity:r=Eq}=e;this.id=e.id||"ambient-".concat(Sq++),this.color=t,this.intensity=r}}const Tq=[255,255,255],Iq=1,Lq=[0,0,-1];let Mq=0;class zL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"id",void 0),_e(this,"color",void 0),_e(this,"intensity",void 0),_e(this,"type","directional"),_e(this,"direction",void 0),_e(this,"shadow",void 0);const{color:t=Tq}=e,{intensity:r=Iq}=e,{direction:n=Lq}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(Mq++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Nt(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class Pq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};_e(this,"id",void 0),_e(this,"gl",void 0),_e(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class R2 extends Pq{constructor(){super(...arguments),_e(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return xA(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:n,views:o,onViewportActive:l,clearStack:s=!0,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const b=this.gl;g&&Dq(b,t),s&&(this._lastRenderIndex=-1);const S=[];for(const F of n){const D=o&&o[F.id];l==null||l(F);const N=this._getDrawLayerParams(F,e),J=F.subViewports||[F];for(const te of J){const he=this._drawLayersInViewport(b,{target:t,moduleParameters:r,viewport:te,view:D,pass:e.pass,layers:e.layers},N);S.push(he)}}return S}_getDrawLayerParams(e,t){let{layers:r,pass:n,isPicking:o=!1,layerFilter:l,cullRect:s,effects:g,moduleParameters:b}=t,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const F=[],D=QL(this._lastRenderIndex+1),N={layer:r[0],viewport:e,isPicking:o,renderPass:n,cullRect:s},J={};for(let te=0;te<r.length;te++){const he=r[te],ue=this._shouldDrawLayer(he,N,l,J),fe={shouldDrawLayer:ue};ue&&!S&&(fe.layerRenderIndex=D(he,ue),fe.moduleParameters=this._getModuleParameters(he,g,n,b),fe.layerParameters=this.getLayerParameters(he,te,e)),F[te]=fe}return F}_drawLayersInViewport(e,t,r){let{layers:n,moduleParameters:o,pass:l,target:s,viewport:g,view:b}=t;const S=Fq(e,{moduleParameters:o,target:s,viewport:g});if(b&&b.props.clear){const D=b.props.clear===!0?{color:!0,depth:!0}:b.props.clear;Yu(e,{scissorTest:!0,scissor:S},()=>i2(e,D))}const F={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};xA(e,{viewport:S});for(let D=0;D<n.length;D++){const N=n[D],{shouldDrawLayer:J,layerRenderIndex:te,moduleParameters:he,layerParameters:ue}=r[D];if(J&&N.props.pickable&&F.pickableCount++,N.isComposite)F.compositeCount++;else if(J){F.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,te),he.viewport=g;try{N._drawLayer({moduleParameters:he,uniforms:{layerIndex:te},parameters:ue})}catch(fe){N.raiseError(fe,"drawing ".concat(N," to ").concat(l))}}}return F}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(r){const s=t.layer.id;if(s in n||(n[s]=r(t)),!n[s])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,n){var o;const l=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:$p(this.gl)});if(t)for(const g of t){var s;Object.assign(l,(s=g.getModuleParameters)===null||s===void 0?void 0:s.call(g,e))}return Object.assign(l,this.getModuleParameters(e,t),n)}}function QL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},r=(n,o)=>{const l=n.props._offset,s=n.id,g=n.parent&&n.parent.id;let b;if(g&&!(g in e)&&r(n.parent,!1),g in t){const S=t[g]=t[g]||QL(e[g],e);b=S(n,o),t[s]=S}else Number.isFinite(l)?(b=l+(e[g]||0),t[s]=null):b=i;return o&&b>=i&&(i=b+1),e[s]=b,b};return r}function Fq(i,e){let{moduleParameters:t,target:r,viewport:n}=e;const o=r&&r.id!=="default-framebuffer",l=t&&t.devicePixelRatio||$p(i),s=o?r.height:i.drawingBufferHeight,g=n;return[g.x*l,s-(g.y+g.height)*l,g.width*l,g.height*l]}function Dq(i,e){const t=e?e.width:i.drawingBufferWidth,r=e?e.height:i.drawingBufferHeight;xA(i,{viewport:[0,0,t,r]}),i.clear(16640)}class Rq extends R2{constructor(e,t){super(e,t),_e(this,"shadowMap",void 0),_e(this,"depthBuffer",void 0),_e(this,"fbo",void 0),this.shadowMap=new Zc(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Zp(e,{format:33189,width:1,height:1}),this.fbo=new wa(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Yu(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],n=$p(this.gl),o=r.width*n,l=r.height*n;(o!==t.width||l!==t.height)&&t.resize({width:o,height:l}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const VL="#define SMOOTH_EDGE_RADIUS 0.5",kq=`
`.concat(VL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Oq=`
`.concat(VL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Uq={name:"geometry",vs:kq,fs:Oq},Nq=Object.keys(Pn).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(Pn[i],";")).join(""),zq=Object.keys(Nh).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(Nh[i],";")).join(""),Qq=Object.keys(Hw).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(Hw[i],";")).join(""),Vq="".concat(Nq,`
`).concat(zq,`
`).concat(Qq,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function Hq(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function yy(i){let e={},t;return r=>{for(const n in r)if(!Hq(r[n],e[n])){t=i(r),e=r;break}return t}}const HL=[0,0,0,0],Gq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],jL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jq=[0,0,0],qL=[0,0,0],qq=yy(Wq);function $L(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qL;t.length<3&&(t=[t[0],t[1],0]);let r=t,n,o=!0;switch(e===Pn.LNGLAT_OFFSETS||e===Pn.METER_OFFSETS?n=t:n=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Nh.WEB_MERCATOR:(e===Pn.LNGLAT||e===Pn.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Nh.WEB_MERCATOR_AUTO_OFFSET:e===Pn.LNGLAT?r=n:e===Pn.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],n=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Nh.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Nh.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:o}}function $q(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:n}=i;let{viewMatrix:o,viewProjectionMatrix:l}=i,s=HL,g=HL,b=i.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:F,offsetMode:D}=$L(i,e,t);return D&&(g=i.projectPosition(S||F),b=[b[0]-g[0],b[1]-g[1],b[2]-g[2]],g[3]=1,s=dy([],g,l),o=r||o,l=vf([],n,o),l=vf([],l,Gq)),{viewMatrix:o,viewProjectionMatrix:l,projectionCenter:s,originCommon:g,cameraPosCommon:b,shaderCoordinateOrigin:F,geospatialOrigin:S}}function Kq(i){let{viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Pn.DEFAULT,coordinateOrigin:o=qL,autoWrapLongitude:l=!1}=i;n===Pn.DEFAULT&&(n=e.isGeospatial?Pn.LNGLAT:Pn.CARTESIAN);const s=qq({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=l,s.project_uModelMatrix=r||jL,s}function Wq(i){let{viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}=i;const{projectionCenter:o,viewProjectionMatrix:l,originCommon:s,cameraPosCommon:g,shaderCoordinateOrigin:b,geospatialOrigin:S}=$q(e,r,n),F=e.getDistanceScales(),D=[e.width*t,e.height*t],N=dy([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,J={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:D,project_uDevicePixelRatio:t,project_uFocalDistance:N,project_uCommonUnitsPerMeter:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:jq,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:jL,project_uCameraPosition:g};if(S){const te=e.getDistanceScales(S);switch(r){case Pn.METER_OFFSETS:J.project_uCommonUnitsPerWorldUnit=te.unitsPerMeter,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerMeter2;break;case Pn.LNGLAT:case Pn.LNGLAT_OFFSETS:e._pseudoMeters||(J.project_uCommonUnitsPerMeter=te.unitsPerMeter),J.project_uCommonUnitsPerWorldUnit=te.unitsPerDegree,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerDegree2;break;case Pn.CARTESIAN:J.project_uCommonUnitsPerWorldUnit=[1,1,te.unitsPerMeter[2]],J.project_uCommonUnitsPerWorldUnit2=[0,0,te.unitsPerMeter2[2]];break}}return J}const Xq={};function Zq(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Xq;return"viewport"in i?Kq(i):{}}const k2={name:"project",dependencies:[wG,Uq],vs:Vq,getUniforms:Zq};function Jq(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tg(i,e){const t=dy([],e,i);return BL(t,t,1/t[3]),t}function KL(i,e){const t=i%e;return t<0?e+t:t}function O2(i,e,t){return i<e?e:i>t?t:i}function Yq(i){return Math.log(i)*Math.LOG2E}const U2=Math.log2||Yq;function TA(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const rh=Math.PI,WL=rh/4,Cu=rh/180,N2=180/rh,ig=512,g1=4003e4,m1=85.051129,e$=1.5;function t$(i){return U2(i)}function _y(i){const[e,t]=i;TA(Number.isFinite(e)),TA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Cu,n=t*Cu,o=ig*(r+rh)/(2*rh),l=ig*(rh+Math.log(Math.tan(WL+n*.5)))/(2*rh);return[o,l]}function rg(i){const[e,t]=i,r=e/ig*(2*rh)-rh,n=2*(Math.atan(Math.exp(t/ig*(2*rh)-rh))-WL);return[r*N2,n*N2]}function i$(i){const{latitude:e}=i;TA(Number.isFinite(e));const t=Math.cos(e*Cu);return t$(g1*t)-9}function y1(i){const e=Math.cos(i*Cu);return ig/g1/e}function z2(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;TA(Number.isFinite(e)&&Number.isFinite(t));const n=ig,o=Math.cos(e*Cu),l=n/360,s=l/o,g=n/g1/o,b={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[l,s,g],degreesPerUnit:[1/l,1/s,1/g]};if(r){const S=Cu*Math.tan(e*Cu)/o,F=l*S/2,D=n/g1*S,N=D/s*g;b.unitsPerDegree2=[0,F,D],b.unitsPerMeter2=[N,0,N]}return b}function XL(i,e){const[t,r,n]=i,[o,l,s]=e,{unitsPerMeter:g,unitsPerMeter2:b}=z2({longitude:t,latitude:r,highPrecision:!0}),S=_y(i);S[0]+=o*(g[0]+b[0]*l),S[1]+=l*(g[1]+b[1]*l);const F=rg(S),D=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[F[0],F[1],D]:F}function r$(i){const{height:e,pitch:t,bearing:r,altitude:n,scale:o,center:l}=i,s=Jq();h1(s,s,[0,0,-n]),xL(s,s,-t*Cu),wL(s,s,r*Cu);const g=o/e;return S2(s,s,[g,g,g]),l&&h1(s,s,QG([],l)),s}function n$(i){const{width:e,height:t,altitude:r,pitch:n=0,offset:o,center:l,scale:s,nearZMultiplier:g=1,farZMultiplier:b=1}=i;let{fovy:S=_1(e$)}=i;r!==void 0&&(S=_1(r));const F=S*Cu,D=n*Cu,N=ZL(S);let J=N;l&&(J+=l[2]*s/Math.cos(D)/t);const te=F*(.5+(o?o[1]:0)/t),he=Math.sin(te)*J/Math.sin(O2(Math.PI/2-D-te,.01,Math.PI-.01)),ue=Math.sin(D)*he+J,fe=J*10,ve=Math.min(ue*b,fe);return{fov:F,aspect:e/t,focalDistance:N,near:g,far:ve}}function _1(i){return 2*Math.atan(.5/i)*N2}function ZL(i){return .5/Math.tan(.5*i*Cu)}function JL(i,e){const[t,r,n=0]=i;return TA(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(n)),tg(e,[t,r,n,1])}function Q2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,n,o]=i;if(TA(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return tg(e,[r,n,o,1]);const l=tg(e,[r,n,0,1]),s=tg(e,[r,n,1,1]),g=l[2],b=s[2],S=g===b?0:((t||0)-g)/(b-g);return lL([],l,s,S)}function s$(i){const{width:e,height:t,bounds:r,minExtent:n=0,maxZoom:o=24,offset:l=[0,0]}=i,[[s,g],[b,S]]=r,F=o$(i.padding),D=_y([s,O2(S,-m1,m1)]),N=_y([b,O2(g,-m1,m1)]),J=[Math.max(Math.abs(N[0]-D[0]),n),Math.max(Math.abs(N[1]-D[1]),n)],te=[e-F.left-F.right-Math.abs(l[0])*2,t-F.top-F.bottom-Math.abs(l[1])*2];TA(te[0]>0&&te[1]>0);const he=te[0]/J[0],ue=te[1]/J[1],fe=(F.right-F.left)/2/he,ve=(F.top-F.bottom)/2/ue,Se=[(N[0]+D[0])/2+fe,(N[1]+D[1])/2+ve],Ge=rg(Se),He=Math.min(o,U2(Math.abs(Math.min(he,ue))));return TA(Number.isFinite(He)),{longitude:Ge[0],latitude:Ge[1],zoom:He}}function o$(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(TA(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const YL=Math.PI/180;function a$(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:r,unproject:n}=i,o={targetZ:e},l=n([0,r],o),s=n([t,r],o);let g,b;const S=i.fovy?.5*i.fovy*YL:Math.atan(.5/i.altitude),F=(90-i.pitch)*YL;return S>F-.01?(g=eM(i,0,e),b=eM(i,t,e)):(g=n([0,0],o),b=n([t,0],o)),[l,s,b,g]}function eM(i,e,t){const{pixelUnprojectionMatrix:r}=i,n=tg(r,[e,0,1,1]),o=tg(r,[e,i.height,1,1]),s=(t*i.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),g=lL([],n,o,s),b=rg(g);return b.push(t),b}const tM=512;function l$(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:n,latitude:o,zoom:l,bearing:s=0}=i;(n<-180||n>180)&&(n=KL(n+180,360)-180),(s<-180||s>180)&&(s=KL(s+180,360)-180);const g=U2(t/tM);if(l<=g)l=g,o=0;else{const b=t/2/Math.pow(2,l),S=rg([0,b])[1];if(o<S)o=S;else{const F=rg([0,tM-b])[1];o>F&&(o=F)}}return{width:e,height:t,longitude:n,latitude:o,zoom:l,pitch:r,bearing:s}}const c$=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,u$=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,h$=yy(g$),A$=yy(m$),d$=[0,0,0,1],f$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function p$(i,e){const[t,r,n]=i,o=Q2([t,r,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function g$(i){let{viewport:e,center:t}=i;return new Cn(e.viewProjectionMatrix).invert().transform(t)}function m$(i){let{viewport:e,shadowMatrices:t}=i;const r=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,l=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>p$(s,n));for(const s of t){const g=s.clone().translate(new Nt(e.center).negate()),b=l.map(F=>g.transform(F)),S=new Cn().ortho({left:Math.min(...b.map(F=>F[0])),right:Math.max(...b.map(F=>F[0])),bottom:Math.min(...b.map(F=>F[1])),top:Math.max(...b.map(F=>F[1])),near:Math.min(...b.map(F=>-F[2])),far:Math.max(...b.map(F=>-F[2]))});r.push(S.multiplyRight(s))}return r}function y$(i,e){const{shadowEnabled:t=!0}=i;if(!t||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||d$,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},n=h$({viewport:i.viewport,center:e.project_uCenter}),o=[],l=A$({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let s=0;s<i.shadowMatrices.length;s++){const g=l[s],b=g.clone().translate(new Nt(i.viewport.center).negate());e.project_uCoordinateSystem===Pn.LNGLAT&&e.project_uProjectionMode===Nh.WEB_MERCATOR?(l[s]=b,o[s]=n):(l[s]=g.clone().multiplyRight(f$),o[s]=b.transform(n))}for(let s=0;s<l.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=l[s],r["shadow_uProjectCenters[".concat(s,"]")]=o[s],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=i.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=i.dummyShadowMap;return r}const V2={name:"shadow",dependencies:[k2],vs:c$,fs:u$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?y$(i,e):{}}},_$={color:[255,255,255],intensity:1},iM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],v$=[0,0,0,200/255];class H2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"id","lighting-effect"),_e(this,"props",void 0),_e(this,"shadowColor",v$),_e(this,"shadow",void 0),_e(this,"ambientLight",void 0),_e(this,"directionalLights",void 0),_e(this,"pointLights",void 0),_e(this,"shadowPasses",[]),_e(this,"shadowMaps",[]),_e(this,"dummyShadowMap",null),_e(this,"programManager",void 0),_e(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,t){let{layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s}=t;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=gy.getDefaultProgramManager(e),V2&&this.programManager.addDefaultModule(V2)),this.dummyShadowMap||(this.dummyShadowMap=new Zc(e,{width:1,height:1}));for(let g=0;g<this.shadowPasses.length;g++)this.shadowPasses[g].render({layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s,moduleParameters:{shadowLightId:g,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(V2),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Cn().lookAt({eye:new Nt(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new Rq(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new NL(_$),this.directionalLights.push(new zL(iM[0]),new zL(iM[1])))}}class b${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"_pool",[]),_e(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,r){let{size:n=1,type:o,padding:l=0,copy:s=!1,initialize:g=!1,maxCount:b}=r;const S=o||e&&e.constructor||Float32Array,F=t*n+l;if(ArrayBuffer.isView(e)){if(F<=e.length)return e;if(F*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new S(e.buffer,0,F)}let D=1/0;b&&(D=b*n+l);const N=this._allocate(S,F,g,D);return e&&s?N.set(e):g||N.fill(0,0,4),this._release(e),N}release(e){this._release(e)}_allocate(e,t,r,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const l=this._pool,s=e.BYTES_PER_ELEMENT*o,g=l.findIndex(b=>b.byteLength>=s);if(g>=0){const b=new e(l.splice(g,1)[0],0,o);return r&&b.fill(0),b}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:n}=r,o=t.findIndex(l=>l.byteLength>=n);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const vy=new b$;function by(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x$(i){return[i[12],i[13],i[14]]}function w$(i){return{left:ng(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:ng(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:ng(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:ng(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:ng(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:ng(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const rM=new Nt;function ng(i,e,t,r){rM.set(i,e,t);const n=rM.len();return{distance:r/n,normal:new Nt(-i/n,-e/n,-t/n)}}function B$(i){return i-Math.fround(i)}let xy;function G2(i,e){const{size:t=1,startIndex:r=0}=e,n=e.endIndex!==void 0?e.endIndex:i.length,o=(n-r)/t;xy=vy.allocate(xy,o,{type:Float32Array,size:t*2});let l=r,s=0;for(;l<n;){for(let g=0;g<t;g++){const b=i[l++];xy[s+g]=b,xy[s+g+t]=B$(b)}s+=t*2}return xy.subarray(0,o*t*2)}function C$(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const E$=Math.PI/180,S$=by(),nM=[0,0,0],T$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function I$(i){let{width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:o,padding:l,near:s,far:g}=i;const b=e/t,S=r?new Cn().orthographic({fovy:n,aspect:b,focalDistance:o,near:s,far:g}):new Cn().perspective({fovy:n,aspect:b,near:s,far:g});if(l){const{left:F=0,right:D=0,top:N=0,bottom:J=0}=l,te=SA((F+e-D)/2,0,e)-e/2,he=SA((N+t-J)/2,0,t)-t/2;S[8]-=te*2/e,S[9]+=he*2/t}return S}class sg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_e(this,"id",void 0),_e(this,"x",void 0),_e(this,"y",void 0),_e(this,"width",void 0),_e(this,"height",void 0),_e(this,"padding",void 0),_e(this,"isGeospatial",void 0),_e(this,"zoom",void 0),_e(this,"focalDistance",void 0),_e(this,"position",void 0),_e(this,"modelMatrix",void 0),_e(this,"distanceScales",void 0),_e(this,"scale",void 0),_e(this,"center",void 0),_e(this,"cameraPosition",void 0),_e(this,"projectionMatrix",void 0),_e(this,"viewMatrix",void 0),_e(this,"viewMatrixUncentered",void 0),_e(this,"viewMatrixInverse",void 0),_e(this,"viewProjectionMatrix",void 0),_e(this,"pixelProjectionMatrix",void 0),_e(this,"pixelUnprojectionMatrix",void 0),_e(this,"resolution",void 0),_e(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||T$,this.focalDistance=e.focalDistance||1,this.position=e.position||nM,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Nh.WEB_MERCATOR:Nh.WEB_MERCATOR_AUTO_OFFSET:Nh.IDENTITY}equals(e){return e instanceof sg?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&th(e.projectionMatrix,this.projectionMatrix)&&th(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(e),n=JL(r,this.pixelProjectionMatrix),[o,l]=n,s=t?l:this.height-l;return e.length===2?[o,s]:[o,s,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,l]=e,s=t?o:this.height-o,g=r&&r*this.distanceScales.unitsPerMeter[2],b=Q2([n,s,l],this.pixelUnprojectionMatrix,g),[S,F,D]=this.unprojectPosition(b);return Number.isFinite(l)?[S,F,D]:Number.isFinite(r)?[S,F,r]:[S,F]}projectPosition(e){const[t,r]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,n]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,n]}projectFlat(e){if(this.isGeospatial){const t=_y(e);return t[1]=SA(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?rg(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(r[0],n[0],o[0],l[0]),Math.min(r[1],n[1],o[1],l[1]),Math.max(r[0],n[0],o[0],l[0]),Math.max(r[1],n[1],o[1],l[1])]}getDistanceScales(e){return e?z2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:r,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,w$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=i$({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||z2({latitude:r,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:l}=e;let s=nM;if(o&&(s=l?new Cn(l).transformAsVector(o,[]):o),this.isGeospatial){const g=this.projectPosition([t,r,0]);this.center=new Nt(s).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=S$,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:o,fovy:l=75,near:s=.1,far:g=1e3,padding:b=null,focalDistance:S=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Cn().multiplyRight(t).translate(new Nt(this.center).negate()),this.projectionMatrix=r||I$({width:this.width,height:this.height,orthographic:n,fovyRadians:o||l*E$,focalDistance:S,padding:b,near:s,far:g});const F=by();vf(F,F,this.projectionMatrix),vf(F,F,this.viewMatrix),this.viewProjectionMatrix=F,this.viewMatrixInverse=E2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x$(this.viewMatrixInverse);const D=by(),N=by();S2(D,D,[this.width/2,-this.height/2,1]),h1(D,D,[1,-1,0]),vf(N,D,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=E2(by(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||kn.warn("Pixel project matrix not invertible")()}}_e(sg,"displayName","Viewport");class bf extends sg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:r=0,zoom:n=0,pitch:o=0,bearing:l=0,nearZMultiplier:s=.1,farZMultiplier:g=1.01,nearZ:b,farZ:S,orthographic:F=!1,projectionMatrix:D,repeat:N=!1,worldOffset:J=0,position:te,padding:he,legacyMeterSizes:ue=!1}=e;let{width:fe,height:ve,altitude:Se=1.5}=e;const Ge=Math.pow(2,n);fe=fe||1,ve=ve||1;let He,$e=null;if(D)Se=D[5]/2,He=_1(Se);else{e.fovy?(He=e.fovy,Se=ZL(He)):He=_1(Se);let at;if(he){const{top:rt=0,bottom:Re=0}=he;at=[0,SA((rt+ve-Re)/2,0,ve)-ve/2]}$e=n$({width:fe,height:ve,scale:Ge,center:te&&[0,0,te[2]*y1(t)],offset:at,pitch:o,fovy:He,nearZMultiplier:s,farZMultiplier:g}),Number.isFinite(b)&&($e.near=b),Number.isFinite(S)&&($e.far=S)}let Ne=r$({height:ve,pitch:o,bearing:l,scale:Ge,altitude:Se});J&&(Ne=new Cn().translate([512*J,0,0]).multiplyLeft(Ne)),super({...e,width:fe,height:ve,viewMatrix:Ne,longitude:r,latitude:t,zoom:n,...$e,fovy:He,focalDistance:Se}),_e(this,"longitude",void 0),_e(this,"latitude",void 0),_e(this,"pitch",void 0),_e(this,"bearing",void 0),_e(this,"altitude",void 0),_e(this,"fovy",void 0),_e(this,"orthographic",void 0),_e(this,"_subViewports",void 0),_e(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=n,this.pitch=o,this.bearing=l,this.altitude=Se,this.fovy=He,this.orthographic=F,this._subViewports=N?[]:null,this._pseudoMeters=ue,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let n=t;n<=r;n++){const o=n?new bf({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),n=(e[2]||0)*y1(e[1]);return[t,r,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),n=(e[2]||0)/y1(r);return[t,r,n]}addMetersToLngLat(e,t){return XL(e,t)}panByPosition(e,t){const r=Q2(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=aL([],n,RG([],r)),l=aL([],this.center,o),[s,g]=this.unprojectFlat(l);return{longitude:s,latitude:g}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=a$(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:n}=this,{longitude:o,latitude:l,zoom:s}=s$({width:r,height:n,bounds:e,...t});return new bf({width:r,height:n,longitude:o,latitude:l,zoom:s})}}_e(bf,"displayName","WebMercatorViewport");const sM=[0,0,0];function j2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=e.projectPosition(i);if(t&&e instanceof bf){const[n,o,l=0]=i,s=e.getDistanceScales([n,o]);r[2]=l*s.unitsPerMeter[2]}return r}function L$(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:l}=i;return n===Pn.DEFAULT&&(n=e.isGeospatial?Pn.LNGLAT:Pn.CARTESIAN),o===void 0&&(o=n),l===void 0&&(l=r),{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:l}}function oM(i,e){let{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:l}=e,[s,g,b=0]=i;switch(r&&([s,g,b]=dy([],[s,g,b,1],r)),n){case Pn.LNGLAT:return j2([s,g,b],t,l);case Pn.LNGLAT_OFFSETS:return j2([s+o[0],g+o[1],b+(o[2]||0)],t,l);case Pn.METER_OFFSETS:return j2(XL(o,[s,g,b]),t,l);case Pn.CARTESIAN:default:return t.isGeospatial?[s+o[0],g+o[1],b+o[2]]:t.projectPosition([s,g,b])}}function M$(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:l,fromCoordinateOrigin:s}=L$(e),{autoOffset:g=!0}=e,{geospatialOrigin:b=sM,shaderCoordinateOrigin:S=sM,offsetMode:F=!1}=g?$L(t,r,n):{},D=oM(i,{viewport:t,modelMatrix:o,coordinateSystem:l,coordinateOrigin:s,offsetMode:F});if(F){const N=t.projectPosition(b||S);$G(D,D,N)}return D}const aM={blendFunc:[1,0,32771,0],blendEquation:32774};class lM extends R2{constructor(){super(...arguments),_e(this,"pickZ",void 0),_e(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,pickingFBO:s,deviceRect:{x:g,y:b,width:S,height:F},cullRect:D,effects:N,pass:J="picking",pickZ:te,moduleParameters:he}=e;const ue=this.gl;this.pickZ=te;const fe=this._resetColorEncoder(te),ve=Yu(ue,{scissorTest:!0,scissor:[g,b,S,F],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...aM,blend:!te},()=>super.render({target:s,layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,cullRect:D,effects:N==null?void 0:N.filter(Ge=>Ge.useInPicking),pass:J,isPicking:!0,moduleParameters:he}));return this._colorEncoderState=null,{decodePickingColor:fe&&F$.bind(null,fe),stats:ve}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const n={...e.props.parameters},{pickable:o,operation:l}=e.props;return this._colorEncoderState?o&&l.includes("draw")&&(Object.assign(n,aM),n.blend=!0,n.blendColor=P$(this._colorEncoderState,e,r)):n.blend=!1,l.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function P$(i,e,t){const{byLayer:r,byAlpha:n}=i;let o,l=r.get(e);return l?(l.viewports.push(t),o=l.a):(o=r.size+1,o<=255?(l={a:o,layer:e,viewports:[t]},r.set(e,l),n[o]=l):(kn.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function F$(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const og={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},v1=Symbol.for("component"),cd=Symbol.for("propTypes"),q2=Symbol.for("deprecatedProps"),ag=Symbol.for("asyncPropDefaults"),xf=Symbol.for("asyncPropOriginal"),ud=Symbol.for("asyncPropResolved");function b1(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?cM(i,e,[]):e(i)?[i]:[]}function cM(i,e,t){let r=-1;for(;++r<i.length;){const n=i[r];Array.isArray(n)?cM(n,e,t):e(n)&&t.push(n)}return t}function D$(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}class R${constructor(e,t,r){_e(this,"id",void 0),_e(this,"context",void 0),_e(this,"isLoaded",void 0),_e(this,"persistent",void 0),_e(this,"_loadCount",0),_e(this,"_subscribers",new Set),_e(this,"_data",void 0),_e(this,"_loader",void 0),_e(this,"_error",void 0),_e(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let n=e;typeof e=="string"&&(n=rd(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class k${constructor(e){let{gl:t,protocol:r}=e;_e(this,"protocol",void 0),_e(this,"_context",void 0),_e(this,"_resources",void 0),_e(this,"_consumers",void 0),_e(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:r,forceUpdate:n=!1,persistent:o=!0}=e,l=this._resources[t];l?l.setData(r,n):(l=new R$(t,r,this._context),this._resources[t]=l),l.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const r=this._consumers[t];if(r){for(const n in r){const o=r[n],l=this._resources[o.resourceId];l&&l.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:r,consumerId:n,requestId:o="default"}=e;const{_resources:l,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),l[t]||this.add({resourceId:t,data:null,persistent:!1}));const g=l[t];if(this._track(n,o,g,r),g)return g.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,n){const o=this._consumers,l=o[e]=o[e]||{},s=l[t]||{},g=s.resourceId&&this._resources[s.resourceId];g&&(g.unsubscribe(s),this.prune()),r&&(l[t]=s,s.onChange=n,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const $2={name:"project32",dependencies:[k2],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},K2={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Zj},O$=[k2],U$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function N$(i){const e=gy.getDefaultProgramManager(i);for(const t of O$)e.addDefaultModule(t);for(const t of U$)e.addShaderHook(t);return e}const z$="layerManager.setLayers",Q$="layerManager.activateViewport";class V${constructor(e){let{deck:t,stats:r,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};_e(this,"layers",void 0),_e(this,"context",void 0),_e(this,"resourceManager",void 0),_e(this,"_lastRenderedLayers",[]),_e(this,"_needsRedraw",!1),_e(this,"_needsUpdate",!1),_e(this,"_nextLayers",null),_e(this,"_debug",!1),_e(this,"activateViewport",l=>{Sl(Q$,this,l),l&&(this.context.viewport=l)}),this.layers=[],this.resourceManager=new k$({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&N$(e),stats:r||new Ww({id:"deck.gl"}),viewport:n||new sg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new UL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Sl(z$,this,t,e),this._lastRenderedLayers=e;const r=b1(e,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const l of e)r[l.id]?kn.warn("Multiple old layers with same id ".concat(l.id))():r[l.id]=l;const n=[];this._updateSublayersRecursively(t,r,n),this._finalizeOldLayers(r);let o=!1;for(const l of n)if(l.hasUniformTransition()){o="Uniform transition in ".concat(l);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,r){for(const n of e){n.context=this.context;const o=t[n.id];o===null&&kn.warn("Multiple new layers with same id ".concat(n.id))(),t[n.id]=null;let l=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),l=n.isComposite?n.getSubLayers():null}catch(s){this._handleError("matching",s,n)}l&&this._updateSublayersRecursively(l,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=og.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=og.MATCHED,t!==e&&(e.lifecycle=og.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=og.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=og.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Qh(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Qh(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),n=Object.keys(e);if(r.length!==n.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!Qh(i[o],e[o],t-1))return!1;return!0}return!1}class H${constructor(e){_e(this,"width",void 0),_e(this,"height",void 0),_e(this,"views",void 0),_e(this,"viewState",void 0),_e(this,"controllers",void 0),_e(this,"timeline",void 0),_e(this,"_viewports",void 0),_e(this,"_viewportMap",void 0),_e(this,"_isUpdating",void 0),_e(this,"_needsRedraw",void 0),_e(this,"_needsUpdate",void 0),_e(this,"_eventManager",void 0),_e(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),n={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const l=r[o];if(l.containsPixel(n)){const s=e.slice();return s[0]-=l.x,s[1]-=l.y,l.unproject(s,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=b1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Qh(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):kn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var l;return(l=this.getView(e.id))===null||l===void 0?void 0:l.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,n){const o=e.controller;if(o&&r){const l={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,l)),n&&n.setProps(l),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=e.length;n--;){const o=e[n],l=this.getViewState(o),s=o.makeViewport({viewState:l,width:this.width,height:this.height});let g=t[o.id];const b=!!o.controller;b&&!g&&(r=!0),(r||!b)&&g&&(g.finalize(),g=null),this.controllers[o.id]=this._updateController(o,l,s,g),s&&this._viewports.unshift(s)}for(const n in t){const o=t[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,n)=>!e[n].equals(t[n]))}}const G$=/([0-9]+\.?[0-9]*)(%|px)/;function hd(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=G$.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(i))}}function Ad(i,e){return i.relative?Math.round(i.position*e):i.position}function ol(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class j${constructor(e){_e(this,"id",void 0),_e(this,"viewportInstance",void 0),_e(this,"_x",void 0),_e(this,"_y",void 0),_e(this,"_width",void 0),_e(this,"_height",void 0),_e(this,"_padding",void 0),_e(this,"props",void 0);const{id:t,x:r=0,y:n=0,width:o="100%",height:l="100%",padding:s=null,viewportInstance:g}=e||{};ol(!g||g instanceof sg),this.viewportInstance=g,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=hd(r),this._y=hd(n),this._width=hd(o),this._height=hd(l),this._padding=s&&{left:hd(s.left||0),right:hd(s.right||0),top:hd(s.top||0),bottom:hd(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Qh(this.props,e.props,2)}makeViewport(e){let{width:t,height:r,viewState:n}=e;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions(e){let{width:t,height:r}=e;const n={x:Ad(this._x,t),y:Ad(this._y,r),width:Ad(this._width,t),height:Ad(this._height,r)};return this._padding&&(n.padding={left:Ad(this._padding.left,t),top:Ad(this._padding.top,r),right:Ad(this._padding.right,t),bottom:Ad(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class wy{constructor(e){_e(this,"_inProgress",void 0),_e(this,"_handle",void 0),_e(this,"_timeline",void 0),_e(this,"time",void 0),_e(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const uM=()=>{},W2={BREAK:1,SNAP_TO_END:2,IGNORE:3},q$=i=>i,$$=W2.BREAK;class K${constructor(e){_e(this,"getControllerState",void 0),_e(this,"props",void 0),_e(this,"propsInTransition",void 0),_e(this,"transition",void 0),_e(this,"onViewStateChange",void 0),_e(this,"onStateChange",void 0),_e(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:n,startProps:o,endProps:l,duration:s,easing:g}}=t,b=g(r/s),S=n.interpolateProps(o,l,b);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new wy(e.timeline),this.onViewStateChange=e.onViewStateChange||uM,this.onStateChange=e.onStateChange||uM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let n=r;if(this.transition.inProgress){const{interruption:o,endProps:l}=this.transition.settings;n={...r,...o===W2.SNAP_TO_END?l:this.propsInTransition||r}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===W2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,l=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(l===0)return;const s=o.initializeProps(e,n);this.propsInTransition={};const g={duration:l,easing:t.transitionEasing||q$,interpolator:o,interruption:t.transitionInterruption||$$,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class W${constructor(e){_e(this,"_propsToCompare",void 0),_e(this,"_propsToExtract",void 0),_e(this,"_requiredProps",void 0);const{compare:t,extract:r,required:n}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=n}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!th(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];ol(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const X$=["longitude","latitude","zoom","bearing","pitch"],Z$=["longitude","latitude","zoom"];class hM extends W${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:X$,required:Z$},super(r.transitionProps),_e(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const l=n(e),s=n(t),g=l.unproject(o);r.start.around=o,Object.assign(r.end,{around:s.project(g),aroundPosition:g,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const n={};for(const o of this._propsToExtract)n[o]=s1(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...n});Object.assign(n,o.panByPosition(t.aroundPosition,s1(e.around,t.around,r)))}return n}}const dd={transitionDuration:0},J$=300,x1=i=>1-(1-i)*(1-i),lg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},wf={};class Y${constructor(e){_e(this,"props",void 0),_e(this,"state",{}),_e(this,"transitionManager",void 0),_e(this,"eventManager",void 0),_e(this,"onViewStateChange",void 0),_e(this,"onStateChange",void 0),_e(this,"makeViewport",void 0),_e(this,"_controllerState",void 0),_e(this,"_events",{}),_e(this,"_interactionState",{isDragging:!1}),_e(this,"_customEvents",[]),_e(this,"_eventStartBlocked",null),_e(this,"_panMove",!1),_e(this,"invertPan",!1),_e(this,"dragMode","rotate"),_e(this,"inertia",0),_e(this,"scrollZoom",!0),_e(this,"dragPan",!0),_e(this,"dragRotate",!0),_e(this,"doubleClickZoom",!0),_e(this,"touchZoom",!0),_e(this,"touchRotate",!1),_e(this,"keyboard",!0),this.transitionManager=new K$({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-r]}isPointInBounds(e,t){const{width:r,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?J$:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:l=!0,touchZoom:s=!0,touchRotate:g=!1,keyboard:b=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(lg.WHEEL,S&&r),this.toggleEvents(lg.PAN,S),this.toggleEvents(lg.PINCH,S&&(s||g)),this.toggleEvents(lg.TRIPLE_PAN,S&&g),this.toggleEvents(lg.DOUBLE_TAP,S&&l),this.toggleEvents(lg.KEYBOARD,S&&b),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=l,this.touchZoom=s,this.touchRotate=g,this.keyboard=b}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:l})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(n,dd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let l=2/(1+Math.exp(-Math.abs(o*r)));o<0&&l!==0&&(l=1/l);const s=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,dd,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,dd,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return wf._startPinchRotation=e.rotation,wf._lastPinchEvent=e,this.updateViewport(r,dd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:wf._startPinchRotation-r})}return this.updateViewport(t,dd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),wf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=wf;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const l=Math.log2(e.scale),s=(l-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),g=Math.pow(2,l+s*t/2);o=o.zoom({pos:n,scale:g}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:x1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return wf._startPinchRotation=null,wf._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let g;const b={};switch(e.srcEvent.code){case"Minus":g=t?s.zoomOut(r).zoomOut(r):s.zoomOut(r),b.isZooming=!0;break;case"Equal":g=t?s.zoomIn(r).zoomIn(r):s.zoomIn(r),b.isZooming=!0;break;case"ArrowLeft":t?(g=s.rotateLeft(o),b.isRotating=!0):(g=s.moveLeft(n),b.isPanning=!0);break;case"ArrowRight":t?(g=s.rotateRight(o),b.isRotating=!0):(g=s.moveRight(n),b.isPanning=!0);break;case"ArrowUp":t?(g=s.rotateUp(l),b.isRotating=!0):(g=s.moveUp(n),b.isPanning=!0);break;case"ArrowDown":t?(g=s.rotateDown(l),b.isRotating=!0):(g=s.moveDown(n),b.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),b),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?dd:e?{...t,transitionInterpolator:new hM({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class eK{constructor(e,t){_e(this,"_viewportProps",void 0),_e(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const AM=5,tK=1.2;class iK extends eK{constructor(e){const{width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s=0,pitch:g=0,altitude:b=1.5,position:S=[0,0,0],maxZoom:F=20,minZoom:D=0,maxPitch:N=60,minPitch:J=0,startPanLngLat:te,startZoomLngLat:he,startRotatePos:ue,startBearing:fe,startPitch:ve,startZoom:Se,normalize:Ge=!0}=e;ol(Number.isFinite(o)),ol(Number.isFinite(n)),ol(Number.isFinite(l)),super({width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s,pitch:g,altitude:b,maxZoom:F,minZoom:D,maxPitch:N,minPitch:J,normalize:Ge,position:S},{startPanLngLat:te,startZoomLngLat:he,startRotatePos:ue,startBearing:fe,startPitch:ve,startZoom:Se}),_e(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:r}=e;const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:r=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:l,startPitch:s}=this.getState();if(!o||l===void 0||s===void 0)return this;let g;return t?g=this._getNewRotation(t,o,s,l):g={bearing:l+r,pitch:s+n},this._getUpdatedState(g)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:r,scale:n}=e,{startZoom:o,startZoomLngLat:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(t)),!l)return this;const{maxZoom:s,minZoom:g}=this.getViewportProps();let b=o+Math.log2(n);b=SA(b,g,s);const S=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...S.panByPosition(l,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:o}=r;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:n}=e;e.zoom=SA(n,r,t);const{maxPitch:o,minPitch:l,pitch:s}=e;e.pitch=SA(s,l,o);const{normalize:g=!0}=e;return g&&Object.assign(e,l$(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,n){const o=e[0]-t[0],l=e[1]-t[1],s=e[1],g=t[1],{width:b,height:S}=this.getViewportProps(),F=o/b;let D=0;l>0?Math.abs(S-g)>AM&&(D=l/(g-S)*tK):l<0&&g>AM&&(D=1-s/g),D=SA(D,-1,1);const{minPitch:N,maxPitch:J}=this.getViewportProps(),te=n+180*F;let he=r;return D>0?he=r+D*(J-r):D<0&&(he=r-D*(N-r)),{pitch:he,bearing:te}}}class rK extends Y${constructor(){super(...arguments),_e(this,"ControllerState",iK),_e(this,"transition",{transitionDuration:300,transitionInterpolator:new hM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),_e(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class X2 extends j${get ViewportType(){return bf}get ControllerType(){return rK}}_e(X2,"displayName","MapView");const nK=new H2;function sK(i,e){var t,r;const n=(t=i.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return n-o}class oK{constructor(){_e(this,"effects",void 0),_e(this,"_resolvedEffects",[]),_e(this,"_defaultEffects",[]),_e(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(n=>sK(n,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Qh(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const r=[];for(const n of e){const o=t[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),r.push(o)):(o.cleanup(),r.push(n)):r.push(n),delete t[n.id]}for(const n in t)t[n].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(n=>n instanceof H2)||this._resolvedEffects.push(nK),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class aK extends R2{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const lK="deckRenderer.renderLayers";class cK{constructor(e){_e(this,"gl",void 0),_e(this,"layerFilter",void 0),_e(this,"drawPickingColors",void 0),_e(this,"drawLayersPass",void 0),_e(this,"pickLayersPass",void 0),_e(this,"renderCount",void 0),_e(this,"_needsRedraw",void 0),_e(this,"renderBuffers",void 0),_e(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new aK(e),this.pickLayersPass=new lM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||wa.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,Sl(lK,this,o,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new wa(this.gl),new wa(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,n={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=t.target,o.postRender(this.gl,n);break}const l=o.postRender(this.gl,n);n.inputBuffer=l,n.swapBuffer=l===r[0]?r[1]:r[0]}}}const uK={pickedColor:null,pickedObjectIndex:-1};function hK(i){let{pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:l}=i;const{x:s,y:g,width:b,height:S}=l;let F=o*o,D=-1,N=0;for(let J=0;J<S;J++){const te=J+g-n,he=te*te;if(he>F)N+=4*b;else for(let ue=0;ue<b;ue++){if(e[N+3]-1>=0){const ve=ue+s-r,Se=ve*ve+he;Se<=F&&(F=Se,D=N)}N+=4}}if(D>=0){const J=e.slice(D,D+4),te=t(J);if(te){const he=Math.floor(D/4/b),ue=D/4-he*b;return{...te,pickedColor:J,pickedX:s+ue,pickedY:g+he}}kn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return uK}function AK(i){let{pickedColors:e,decodePickingColor:t}=i;const r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const l=e.slice(n,n+4),s=l.join(",");if(!r.has(s)){const g=t(l);g?r.set(s,{...g,color:l}):kn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function dM(i){let{pickInfo:e,viewports:t,pixelRatio:r,x:n,y:o,z:l}=i,s=t[0];t.length>1&&(s=fK((e==null?void 0:e.pickedViewports)||t,{x:n,y:o}));let g;if(s){const b=[n-s.x,o-s.y];l!==void 0&&(b[2]=l),g=s.unproject(b)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:g,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function dK(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:n}=i,{pickedColor:o,pickedLayer:l,pickedObjectIndex:s}=e,g=l?[l]:[];if(r==="hover"){const F=t.index,D=t.layerId,N=l?l.props.id:null;if(N!==D||s!==F){if(N!==D){const J=n.find(te=>te.props.id===D);J&&g.unshift(J)}t.layerId=N,t.index=s,t.info=null}}const b=dM(i),S=new Map;return S.set(null,b),g.forEach(F=>{let D={...b};F===l&&(D.color=o,D.index=s,D.picked=!0),D=fM({layer:F,info:D,mode:r});const N=D.layer;F===l&&r==="hover"&&(t.info=D),S.set(N.id,D),r==="hover"&&N.updateAutoHighlight(D)}),S}function fM(i){let{layer:e,info:t,mode:r}=i;for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function fK(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class pK{constructor(e){_e(this,"gl",void 0),_e(this,"pickingFBO",void 0),_e(this,"depthFBO",void 0),_e(this,"pickLayersPass",void 0),_e(this,"layerFilter",void 0),_e(this,"lastPickedInfo",void 0),_e(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new lM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:r,layers:n,viewports:o}=e,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const s=l&&l.layer&&l.layer.id,g=l&&l.viewport&&l.viewport.id,b=s?n.find(N=>N.id===s):null,S=g&&o.find(N=>N.id===g)||o[0],F=S&&S.unproject([t-S.x,r-S.y]);return{...l,...{x:t,y:r,viewport:S,coordinate:F,layer:b}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new wa(r),wa.isSupported(r,{colorBufferFloat:!0}))){const n=new wa(r);n.attach({36064:new Zc(r,{format:An(r)?34836:6408,type:5126})}),this.depthFBO=n}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:r,viewports:n,x:o,y:l,radius:s=0,depth:g=1,mode:b="query",unproject3D:S,onViewportActive:F,effects:D}=e;const N=this._getPickable(t),J=$p(this.gl);if(!N)return{result:[],emptyInfo:dM({viewports:n,x:o,y:l,pixelRatio:J})};this._resizeBuffer();const te=qw(this.gl,[o,l],!0),he=[te.x+Math.floor(te.width/2),te.y+Math.floor(te.height/2)],ue=Math.round(s*J),{width:fe,height:ve}=this.pickingFBO,Se=this._getPickingRect({deviceX:he[0],deviceY:he[1],deviceRadius:ue,deviceWidth:fe,deviceHeight:ve}),Ge={x:o-s,y:l-s,width:s*2+1,height:s*2+1};let He;const $e=[],Ne=new Set;for(let at=0;at<g;at++){let rt;if(Se){const Pe=this._drawAndSample({layers:N,views:r,viewports:n,onViewportActive:F,deviceRect:Se,cullRect:Ge,effects:D,pass:"picking:".concat(b)});rt=hK({...Pe,deviceX:he[0],deviceY:he[1],deviceRadius:ue,deviceRect:Se})}else rt={pickedColor:null,pickedObjectIndex:-1};let Re;if(rt.pickedLayer&&S&&this.depthFBO){const{pickedColors:Pe}=this._drawAndSample({layers:[rt.pickedLayer],views:r,viewports:n,onViewportActive:F,deviceRect:{x:rt.pickedX,y:rt.pickedY,width:1,height:1},cullRect:Ge,effects:D,pass:"picking:".concat(b,":z")},!0);Pe[3]&&(Re=Pe[0])}rt.pickedLayer&&at+1<g&&(Ne.add(rt.pickedLayer),rt.pickedLayer.disablePickingIndex(rt.pickedObjectIndex)),He=dK({pickInfo:rt,lastPickedInfo:this.lastPickedInfo,mode:b,layers:N,viewports:n,x:o,y:l,z:Re,pixelRatio:J});for(const Pe of He.values())Pe.layer&&$e.push(Pe);if(!rt.pickedColor)break}for(const at of Ne)at.restorePickingColors();return{result:$e,emptyInfo:He.get(null)}}_pickVisibleObjects(e){let{layers:t,views:r,viewports:n,x:o,y:l,width:s=1,height:g=1,mode:b="query",maxObjects:S=null,onViewportActive:F,effects:D}=e;const N=this._getPickable(t);if(!N)return[];this._resizeBuffer();const J=$p(this.gl),te=qw(this.gl,[o,l],!0),he=te.x,ue=te.y+te.height,fe=qw(this.gl,[o+s,l+g],!0),ve=fe.x+fe.width,Se=fe.y,Ge={x:he,y:Se,width:ve-he,height:ue-Se},He=this._drawAndSample({layers:N,views:r,viewports:n,onViewportActive:F,deviceRect:Ge,cullRect:{x:o,y:l,width:s,height:g},effects:D,pass:"picking:".concat(b)}),$e=AK(He),Ne=new Map,at=Number.isFinite(S);for(let Re=0;Re<$e.length;Re++){var rt;if(at&&S&&Ne.size>=S)break;const Pe=$e[Re];let Je={color:Pe.pickedColor,layer:null,index:Pe.pickedObjectIndex,picked:!0,x:o,y:l,pixelRatio:J};Je=fM({layer:Pe.pickedLayer,info:Je,mode:b});const Xe=(rt=Je.object)!==null&&rt!==void 0?rt:"".concat(Je.layer.id,"[").concat(Je.index,"]");Ne.has(Xe)||Ne.set(Xe,Je)}return Array.from(Ne.values())}_drawAndSample(e){let{layers:t,views:r,viewports:n,onViewportActive:o,deviceRect:l,cullRect:s,effects:g,pass:b}=e,S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const F=S?this.depthFBO:this.pickingFBO,D={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:F,deviceRect:l,cullRect:s,effects:g,pass:b,pickZ:S,preRenderStats:{}};for(const ve of g)ve.useInPicking&&(D.preRenderStats[ve.id]=ve.preRender(this.gl,D));const{decodePickingColor:N}=this.pickLayersPass.render(D),{x:J,y:te,width:he,height:ue}=l,fe=new(S?Float32Array:Uint8Array)(he*ue*4);return W_(F,{sourceX:J,sourceY:te,sourceWidth:he,sourceHeight:ue,target:fe}),{pickedColors:fe,decodePickingColor:N}}_getPickingRect(e){let{deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:l}=e;const s=Math.max(0,t-n),g=Math.max(0,r-n),b=Math.min(o,t+n+1)-s,S=Math.min(l,r+n+1)-g;return b<=0||S<=0?null:{x:s,y:g,width:b,height:S}}}const gK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class mK{constructor(e){_e(this,"el",null),_e(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,gK),t.appendChild(this.el))}setTooltip(e,t,r){const n=this.el;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var pM={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,t,r,n){var o=["","webkit","Moz","MS","ms","o"],l=t.createElement("div"),s="function",g=Math.round,b=Math.abs,S=Date.now;function F(ze,Ye,ft){return setTimeout(ve(ze,ft),Ye)}function D(ze,Ye,ft){return Array.isArray(ze)?(N(ze,ft[Ye],ft),!0):!1}function N(ze,Ye,ft){var Ut;if(ze)if(ze.forEach)ze.forEach(Ye,ft);else if(ze.length!==n)for(Ut=0;Ut<ze.length;)Ye.call(ft,ze[Ut],Ut,ze),Ut++;else for(Ut in ze)ze.hasOwnProperty(Ut)&&Ye.call(ft,ze[Ut],Ut,ze)}function J(ze,Ye,ft){var Ut="DEPRECATED METHOD: "+Ye+`
`+ft+` AT 
`;return function(){var hi=new Error("get-stack-trace"),ji=hi&&hi.stack?hi.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",xr=e.console&&(e.console.warn||e.console.log);return xr&&xr.call(e.console,Ut,ji),ze.apply(this,arguments)}}var te;typeof Object.assign!="function"?te=function(Ye){if(Ye===n||Ye===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(Ye),Ut=1;Ut<arguments.length;Ut++){var hi=arguments[Ut];if(hi!==n&&hi!==null)for(var ji in hi)hi.hasOwnProperty(ji)&&(ft[ji]=hi[ji])}return ft}:te=Object.assign;var he=J(function(Ye,ft,Ut){for(var hi=Object.keys(ft),ji=0;ji<hi.length;)(!Ut||Ut&&Ye[hi[ji]]===n)&&(Ye[hi[ji]]=ft[hi[ji]]),ji++;return Ye},"extend","Use `assign`."),ue=J(function(Ye,ft){return he(Ye,ft,!0)},"merge","Use `assign`.");function fe(ze,Ye,ft){var Ut=Ye.prototype,hi;hi=ze.prototype=Object.create(Ut),hi.constructor=ze,hi._super=Ut,ft&&te(hi,ft)}function ve(ze,Ye){return function(){return ze.apply(Ye,arguments)}}function Se(ze,Ye){return typeof ze==s?ze.apply(Ye&&Ye[0]||n,Ye):ze}function Ge(ze,Ye){return ze===n?Ye:ze}function He(ze,Ye,ft){N(rt(Ye),function(Ut){ze.addEventListener(Ut,ft,!1)})}function $e(ze,Ye,ft){N(rt(Ye),function(Ut){ze.removeEventListener(Ut,ft,!1)})}function Ne(ze,Ye){for(;ze;){if(ze==Ye)return!0;ze=ze.parentNode}return!1}function at(ze,Ye){return ze.indexOf(Ye)>-1}function rt(ze){return ze.trim().split(/\s+/g)}function Re(ze,Ye,ft){if(ze.indexOf&&!ft)return ze.indexOf(Ye);for(var Ut=0;Ut<ze.length;){if(ft&&ze[Ut][ft]==Ye||!ft&&ze[Ut]===Ye)return Ut;Ut++}return-1}function Pe(ze){return Array.prototype.slice.call(ze,0)}function Je(ze,Ye,ft){for(var Ut=[],hi=[],ji=0;ji<ze.length;){var xr=Ye?ze[ji][Ye]:ze[ji];Re(hi,xr)<0&&Ut.push(ze[ji]),hi[ji]=xr,ji++}return ft&&(Ye?Ut=Ut.sort(function(Un,ns){return Un[Ye]>ns[Ye]}):Ut=Ut.sort()),Ut}function Xe(ze,Ye){for(var ft,Ut,hi=Ye[0].toUpperCase()+Ye.slice(1),ji=0;ji<o.length;){if(ft=o[ji],Ut=ft?ft+hi:Ye,Ut in ze)return Ut;ji++}return n}var Ct=1;function Et(){return Ct++}function Mt(ze){var Ye=ze.ownerDocument||ze;return Ye.defaultView||Ye.parentWindow||e}var vt=/mobile|tablet|ip(ad|hone|od)|android/i,Dt="ontouchstart"in e,Pt=Xe(e,"PointerEvent")!==n,Xt=Dt&&vt.test(navigator.userAgent),Te="touch",Ze="pen",tt="mouse",dt="kinect",pt=25,Bt=1,Ft=2,Lt=4,Gt=8,ri=1,mi=2,yi=4,Pi=8,Ot=16,lt=mi|yi,wt=Pi|Ot,ki=lt|wt,ti=["x","y"],ht=["clientX","clientY"];function qt(ze,Ye){var ft=this;this.manager=ze,this.callback=Ye,this.element=ze.element,this.target=ze.options.inputTarget,this.domHandler=function(Ut){Se(ze.options.enable,[ze])&&ft.handler(Ut)},this.init()}qt.prototype={handler:function(){},init:function(){this.evEl&&He(this.element,this.evEl,this.domHandler),this.evTarget&&He(this.target,this.evTarget,this.domHandler),this.evWin&&He(Mt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Mt(this.element),this.evWin,this.domHandler)}};function si(ze){var Ye,ft=ze.options.inputClass;return ft?Ye=ft:Pt?Ye=Be:Xt?Ye=Fe:Dt?Ye=_t:Ye=bi,new Ye(ze,fi)}function fi(ze,Ye,ft){var Ut=ft.pointers.length,hi=ft.changedPointers.length,ji=Ye&Bt&&Ut-hi===0,xr=Ye&(Lt|Gt)&&Ut-hi===0;ft.isFirst=!!ji,ft.isFinal=!!xr,ji&&(ze.session={}),ft.eventType=Ye,ci(ze,ft),ze.emit("hammer.input",ft),ze.recognize(ft),ze.session.prevInput=ft}function ci(ze,Ye){var ft=ze.session,Ut=Ye.pointers,hi=Ut.length;ft.firstInput||(ft.firstInput=dr(Ye)),hi>1&&!ft.firstMultiple?ft.firstMultiple=dr(Ye):hi===1&&(ft.firstMultiple=!1);var ji=ft.firstInput,xr=ft.firstMultiple,Tn=xr?xr.center:ji.center,Un=Ye.center=Sr(Ut);Ye.timeStamp=S(),Ye.deltaTime=Ye.timeStamp-ji.timeStamp,Ye.angle=Kt(Tn,Un),Ye.distance=ui(Tn,Un),Wi(ft,Ye),Ye.offsetDirection=Yi(Ye.deltaX,Ye.deltaY);var ns=zt(Ye.deltaTime,Ye.deltaX,Ye.deltaY);Ye.overallVelocityX=ns.x,Ye.overallVelocityY=ns.y,Ye.overallVelocity=b(ns.x)>b(ns.y)?ns.x:ns.y,Ye.scale=xr?Vt(xr.pointers,Ut):1,Ye.rotation=xr?Ji(xr.pointers,Ut):0,Ye.maxPointers=ft.prevInput?Ye.pointers.length>ft.prevInput.maxPointers?Ye.pointers.length:ft.prevInput.maxPointers:Ye.pointers.length,ir(ft,Ye);var Bn=ze.element;Ne(Ye.srcEvent.target,Bn)&&(Bn=Ye.srcEvent.target),Ye.target=Bn}function Wi(ze,Ye){var ft=Ye.center,Ut=ze.offsetDelta||{},hi=ze.prevDelta||{},ji=ze.prevInput||{};(Ye.eventType===Bt||ji.eventType===Lt)&&(hi=ze.prevDelta={x:ji.deltaX||0,y:ji.deltaY||0},Ut=ze.offsetDelta={x:ft.x,y:ft.y}),Ye.deltaX=hi.x+(ft.x-Ut.x),Ye.deltaY=hi.y+(ft.y-Ut.y)}function ir(ze,Ye){var ft=ze.lastInterval||Ye,Ut=Ye.timeStamp-ft.timeStamp,hi,ji,xr,Tn;if(Ye.eventType!=Gt&&(Ut>pt||ft.velocity===n)){var Un=Ye.deltaX-ft.deltaX,ns=Ye.deltaY-ft.deltaY,Bn=zt(Ut,Un,ns);ji=Bn.x,xr=Bn.y,hi=b(Bn.x)>b(Bn.y)?Bn.x:Bn.y,Tn=Yi(Un,ns),ze.lastInterval=Ye}else hi=ft.velocity,ji=ft.velocityX,xr=ft.velocityY,Tn=ft.direction;Ye.velocity=hi,Ye.velocityX=ji,Ye.velocityY=xr,Ye.direction=Tn}function dr(ze){for(var Ye=[],ft=0;ft<ze.pointers.length;)Ye[ft]={clientX:g(ze.pointers[ft].clientX),clientY:g(ze.pointers[ft].clientY)},ft++;return{timeStamp:S(),pointers:Ye,center:Sr(Ye),deltaX:ze.deltaX,deltaY:ze.deltaY}}function Sr(ze){var Ye=ze.length;if(Ye===1)return{x:g(ze[0].clientX),y:g(ze[0].clientY)};for(var ft=0,Ut=0,hi=0;hi<Ye;)ft+=ze[hi].clientX,Ut+=ze[hi].clientY,hi++;return{x:g(ft/Ye),y:g(Ut/Ye)}}function zt(ze,Ye,ft){return{x:Ye/ze||0,y:ft/ze||0}}function Yi(ze,Ye){return ze===Ye?ri:b(ze)>=b(Ye)?ze<0?mi:yi:Ye<0?Pi:Ot}function ui(ze,Ye,ft){ft||(ft=ti);var Ut=Ye[ft[0]]-ze[ft[0]],hi=Ye[ft[1]]-ze[ft[1]];return Math.sqrt(Ut*Ut+hi*hi)}function Kt(ze,Ye,ft){ft||(ft=ti);var Ut=Ye[ft[0]]-ze[ft[0]],hi=Ye[ft[1]]-ze[ft[1]];return Math.atan2(hi,Ut)*180/Math.PI}function Ji(ze,Ye){return Kt(Ye[1],Ye[0],ht)+Kt(ze[1],ze[0],ht)}function Vt(ze,Ye){return ui(Ye[0],Ye[1],ht)/ui(ze[0],ze[1],ht)}var Ci={mousedown:Bt,mousemove:Ft,mouseup:Lt},Li="mousedown",jt="mousemove mouseup";function bi(){this.evEl=Li,this.evWin=jt,this.pressed=!1,qt.apply(this,arguments)}fe(bi,qt,{handler:function(Ye){var ft=Ci[Ye.type];ft&Bt&&Ye.button===0&&(this.pressed=!0),ft&Ft&&Ye.which!==1&&(ft=Lt),this.pressed&&(ft&Lt&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[Ye],changedPointers:[Ye],pointerType:tt,srcEvent:Ye}))}});var Yt={pointerdown:Bt,pointermove:Ft,pointerup:Lt,pointercancel:Gt,pointerout:Gt},yr={2:Te,3:Ze,4:tt,5:dt},Tr="pointerdown",Qe="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Tr="MSPointerDown",Qe="MSPointerMove MSPointerUp MSPointerCancel");function Be(){this.evEl=Tr,this.evWin=Qe,qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}fe(Be,qt,{handler:function(Ye){var ft=this.store,Ut=!1,hi=Ye.type.toLowerCase().replace("ms",""),ji=Yt[hi],xr=yr[Ye.pointerType]||Ye.pointerType,Tn=xr==Te,Un=Re(ft,Ye.pointerId,"pointerId");ji&Bt&&(Ye.button===0||Tn)?Un<0&&(ft.push(Ye),Un=ft.length-1):ji&(Lt|Gt)&&(Ut=!0),!(Un<0)&&(ft[Un]=Ye,this.callback(this.manager,ji,{pointers:ft,changedPointers:[Ye],pointerType:xr,srcEvent:Ye}),Ut&&ft.splice(Un,1))}});var ae={touchstart:Bt,touchmove:Ft,touchend:Lt,touchcancel:Gt},ie="touchstart",ce="touchstart touchmove touchend touchcancel";function me(){this.evTarget=ie,this.evWin=ce,this.started=!1,qt.apply(this,arguments)}fe(me,qt,{handler:function(Ye){var ft=ae[Ye.type];if(ft===Bt&&(this.started=!0),!!this.started){var Ut=be.call(this,Ye,ft);ft&(Lt|Gt)&&Ut[0].length-Ut[1].length===0&&(this.started=!1),this.callback(this.manager,ft,{pointers:Ut[0],changedPointers:Ut[1],pointerType:Te,srcEvent:Ye})}}});function be(ze,Ye){var ft=Pe(ze.touches),Ut=Pe(ze.changedTouches);return Ye&(Lt|Gt)&&(ft=Je(ft.concat(Ut),"identifier",!0)),[ft,Ut]}var Ee={touchstart:Bt,touchmove:Ft,touchend:Lt,touchcancel:Gt},xe="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=xe,this.targetIds={},qt.apply(this,arguments)}fe(Fe,qt,{handler:function(Ye){var ft=Ee[Ye.type],Ut=Ue.call(this,Ye,ft);Ut&&this.callback(this.manager,ft,{pointers:Ut[0],changedPointers:Ut[1],pointerType:Te,srcEvent:Ye})}});function Ue(ze,Ye){var ft=Pe(ze.touches),Ut=this.targetIds;if(Ye&(Bt|Ft)&&ft.length===1)return Ut[ft[0].identifier]=!0,[ft,ft];var hi,ji,xr=Pe(ze.changedTouches),Tn=[],Un=this.target;if(ji=ft.filter(function(ns){return Ne(ns.target,Un)}),Ye===Bt)for(hi=0;hi<ji.length;)Ut[ji[hi].identifier]=!0,hi++;for(hi=0;hi<xr.length;)Ut[xr[hi].identifier]&&Tn.push(xr[hi]),Ye&(Lt|Gt)&&delete Ut[xr[hi].identifier],hi++;if(Tn.length)return[Je(ji.concat(Tn),"identifier",!0),Tn]}var je=2500,nt=25;function _t(){qt.apply(this,arguments);var ze=ve(this.handler,this);this.touch=new Fe(this.manager,ze),this.mouse=new bi(this.manager,ze),this.primaryTouch=null,this.lastTouches=[]}fe(_t,qt,{handler:function(Ye,ft,Ut){var hi=Ut.pointerType==Te,ji=Ut.pointerType==tt;if(!(ji&&Ut.sourceCapabilities&&Ut.sourceCapabilities.firesTouchEvents)){if(hi)St.call(this,ft,Ut);else if(ji&&$t.call(this,Ut))return;this.callback(Ye,ft,Ut)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function St(ze,Ye){ze&Bt?(this.primaryTouch=Ye.changedPointers[0].identifier,ei.call(this,Ye)):ze&(Lt|Gt)&&ei.call(this,Ye)}function ei(ze){var Ye=ze.changedPointers[0];if(Ye.identifier===this.primaryTouch){var ft={x:Ye.clientX,y:Ye.clientY};this.lastTouches.push(ft);var Ut=this.lastTouches,hi=function(){var ji=Ut.indexOf(ft);ji>-1&&Ut.splice(ji,1)};setTimeout(hi,je)}}function $t(ze){for(var Ye=ze.srcEvent.clientX,ft=ze.srcEvent.clientY,Ut=0;Ut<this.lastTouches.length;Ut++){var hi=this.lastTouches[Ut],ji=Math.abs(Ye-hi.x),xr=Math.abs(ft-hi.y);if(ji<=nt&&xr<=nt)return!0}return!1}var Wt=Xe(l.style,"touchAction"),oi=Wt!==n,Ei="compute",Gi="auto",Bi="manipulation",Ni="none",ot="pan-x",ii="pan-y",Qt=on();function Qi(ze,Ye){this.manager=ze,this.set(Ye)}Qi.prototype={set:function(ze){ze==Ei&&(ze=this.compute()),oi&&this.manager.element.style&&Qt[ze]&&(this.manager.element.style[Wt]=ze),this.actions=ze.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ze=[];return N(this.manager.recognizers,function(Ye){Se(Ye.options.enable,[Ye])&&(ze=ze.concat(Ye.getTouchAction()))}),Ar(ze.join(" "))},preventDefaults:function(ze){var Ye=ze.srcEvent,ft=ze.offsetDirection;if(this.manager.session.prevented){Ye.preventDefault();return}var Ut=this.actions,hi=at(Ut,Ni)&&!Qt[Ni],ji=at(Ut,ii)&&!Qt[ii],xr=at(Ut,ot)&&!Qt[ot];if(hi){var Tn=ze.pointers.length===1,Un=ze.distance<2,ns=ze.deltaTime<250;if(Tn&&Un&&ns)return}if(!(xr&&ji)&&(hi||ji&&ft&lt||xr&&ft&wt))return this.preventSrc(Ye)},preventSrc:function(ze){this.manager.session.prevented=!0,ze.preventDefault()}};function Ar(ze){if(at(ze,Ni))return Ni;var Ye=at(ze,ot),ft=at(ze,ii);return Ye&&ft?Ni:Ye||ft?Ye?ot:ii:at(ze,Bi)?Bi:Gi}function on(){if(!oi)return!1;var ze={},Ye=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){ze[ft]=Ye?e.CSS.supports("touch-action",ft):!0}),ze}var xn=1,hr=2,mn=4,yn=8,cr=yn,On=16,ms=32;function Vr(ze){this.options=te({},this.defaults,ze||{}),this.id=Et(),this.manager=null,this.options.enable=Ge(this.options.enable,!0),this.state=xn,this.simultaneous={},this.requireFail=[]}Vr.prototype={defaults:{},set:function(ze){return te(this.options,ze),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ze){if(D(ze,"recognizeWith",this))return this;var Ye=this.simultaneous;return ze=hs(ze,this),Ye[ze.id]||(Ye[ze.id]=ze,ze.recognizeWith(this)),this},dropRecognizeWith:function(ze){return D(ze,"dropRecognizeWith",this)?this:(ze=hs(ze,this),delete this.simultaneous[ze.id],this)},requireFailure:function(ze){if(D(ze,"requireFailure",this))return this;var Ye=this.requireFail;return ze=hs(ze,this),Re(Ye,ze)===-1&&(Ye.push(ze),ze.requireFailure(this)),this},dropRequireFailure:function(ze){if(D(ze,"dropRequireFailure",this))return this;ze=hs(ze,this);var Ye=Re(this.requireFail,ze);return Ye>-1&&this.requireFail.splice(Ye,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ze){return!!this.simultaneous[ze.id]},emit:function(ze){var Ye=this,ft=this.state;function Ut(hi){Ye.manager.emit(hi,ze)}ft<yn&&Ut(Ye.options.event+wn(ft)),Ut(Ye.options.event),ze.additionalEvent&&Ut(ze.additionalEvent),ft>=yn&&Ut(Ye.options.event+wn(ft))},tryEmit:function(ze){if(this.canEmit())return this.emit(ze);this.state=ms},canEmit:function(){for(var ze=0;ze<this.requireFail.length;){if(!(this.requireFail[ze].state&(ms|xn)))return!1;ze++}return!0},recognize:function(ze){var Ye=te({},ze);if(!Se(this.options.enable,[this,Ye])){this.reset(),this.state=ms;return}this.state&(cr|On|ms)&&(this.state=xn),this.state=this.process(Ye),this.state&(hr|mn|yn|On)&&this.tryEmit(Ye)},process:function(ze){},getTouchAction:function(){},reset:function(){}};function wn(ze){return ze&On?"cancel":ze&yn?"end":ze&mn?"move":ze&hr?"start":""}function To(ze){return ze==Ot?"down":ze==Pi?"up":ze==mi?"left":ze==yi?"right":""}function hs(ze,Ye){var ft=Ye.manager;return ft?ft.get(ze):ze}function Xi(){Vr.apply(this,arguments)}fe(Xi,Vr,{defaults:{pointers:1},attrTest:function(ze){var Ye=this.options.pointers;return Ye===0||ze.pointers.length===Ye},process:function(ze){var Ye=this.state,ft=ze.eventType,Ut=Ye&(hr|mn),hi=this.attrTest(ze);return Ut&&(ft&Gt||!hi)?Ye|On:Ut||hi?ft&Lt?Ye|yn:Ye&hr?Ye|mn:hr:ms}});function eo(){Xi.apply(this,arguments),this.pX=null,this.pY=null}fe(eo,Xi,{defaults:{event:"pan",threshold:10,pointers:1,direction:ki},getTouchAction:function(){var ze=this.options.direction,Ye=[];return ze&lt&&Ye.push(ii),ze&wt&&Ye.push(ot),Ye},directionTest:function(ze){var Ye=this.options,ft=!0,Ut=ze.distance,hi=ze.direction,ji=ze.deltaX,xr=ze.deltaY;return hi&Ye.direction||(Ye.direction&lt?(hi=ji===0?ri:ji<0?mi:yi,ft=ji!=this.pX,Ut=Math.abs(ze.deltaX)):(hi=xr===0?ri:xr<0?Pi:Ot,ft=xr!=this.pY,Ut=Math.abs(ze.deltaY))),ze.direction=hi,ft&&Ut>Ye.threshold&&hi&Ye.direction},attrTest:function(ze){return Xi.prototype.attrTest.call(this,ze)&&(this.state&hr||!(this.state&hr)&&this.directionTest(ze))},emit:function(ze){this.pX=ze.deltaX,this.pY=ze.deltaY;var Ye=To(ze.direction);Ye&&(ze.additionalEvent=this.options.event+Ye),this._super.emit.call(this,ze)}});function Cs(){Xi.apply(this,arguments)}fe(Cs,Xi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(ze){return this._super.attrTest.call(this,ze)&&(Math.abs(ze.scale-1)>this.options.threshold||this.state&hr)},emit:function(ze){if(ze.scale!==1){var Ye=ze.scale<1?"in":"out";ze.additionalEvent=this.options.event+Ye}this._super.emit.call(this,ze)}});function fr(){Vr.apply(this,arguments),this._timer=null,this._input=null}fe(fr,Vr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Gi]},process:function(ze){var Ye=this.options,ft=ze.pointers.length===Ye.pointers,Ut=ze.distance<Ye.threshold,hi=ze.deltaTime>Ye.time;if(this._input=ze,!Ut||!ft||ze.eventType&(Lt|Gt)&&!hi)this.reset();else if(ze.eventType&Bt)this.reset(),this._timer=F(function(){this.state=cr,this.tryEmit()},Ye.time,this);else if(ze.eventType&Lt)return cr;return ms},reset:function(){clearTimeout(this._timer)},emit:function(ze){this.state===cr&&(ze&&ze.eventType&Lt?this.manager.emit(this.options.event+"up",ze):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function Dr(){Xi.apply(this,arguments)}fe(Dr,Xi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(ze){return this._super.attrTest.call(this,ze)&&(Math.abs(ze.rotation)>this.options.threshold||this.state&hr)}});function Gn(){Xi.apply(this,arguments)}fe(Gn,Xi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:lt|wt,pointers:1},getTouchAction:function(){return eo.prototype.getTouchAction.call(this)},attrTest:function(ze){var Ye=this.options.direction,ft;return Ye&(lt|wt)?ft=ze.overallVelocity:Ye&lt?ft=ze.overallVelocityX:Ye&wt&&(ft=ze.overallVelocityY),this._super.attrTest.call(this,ze)&&Ye&ze.offsetDirection&&ze.distance>this.options.threshold&&ze.maxPointers==this.options.pointers&&b(ft)>this.options.velocity&&ze.eventType&Lt},emit:function(ze){var Ye=To(ze.offsetDirection);Ye&&this.manager.emit(this.options.event+Ye,ze),this.manager.emit(this.options.event,ze)}});function Ur(){Vr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}fe(Ur,Vr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Bi]},process:function(ze){var Ye=this.options,ft=ze.pointers.length===Ye.pointers,Ut=ze.distance<Ye.threshold,hi=ze.deltaTime<Ye.time;if(this.reset(),ze.eventType&Bt&&this.count===0)return this.failTimeout();if(Ut&&hi&&ft){if(ze.eventType!=Lt)return this.failTimeout();var ji=this.pTime?ze.timeStamp-this.pTime<Ye.interval:!0,xr=!this.pCenter||ui(this.pCenter,ze.center)<Ye.posThreshold;this.pTime=ze.timeStamp,this.pCenter=ze.center,!xr||!ji?this.count=1:this.count+=1,this._input=ze;var Tn=this.count%Ye.taps;if(Tn===0)return this.hasRequireFailures()?(this._timer=F(function(){this.state=cr,this.tryEmit()},Ye.interval,this),hr):cr}return ms},failTimeout:function(){return this._timer=F(function(){this.state=ms},this.options.interval,this),ms},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==cr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Sn(ze,Ye){return Ye=Ye||{},Ye.recognizers=Ge(Ye.recognizers,Sn.defaults.preset),new js(ze,Ye)}Sn.VERSION="2.0.7",Sn.defaults={domEvents:!1,touchAction:Ei,enable:!0,inputTarget:null,inputClass:null,preset:[[Dr,{enable:!1}],[Cs,{enable:!1},["rotate"]],[Gn,{direction:lt}],[eo,{direction:lt},["swipe"]],[Ur],[Ur,{event:"doubletap",taps:2},["tap"]],[fr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var dn=1,Gr=2;function js(ze,Ye){this.options=te({},Sn.defaults,Ye||{}),this.options.inputTarget=this.options.inputTarget||ze,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ze,this.input=si(this),this.touchAction=new Qi(this,this.options.touchAction),ha(this,!0),N(this.options.recognizers,function(ft){var Ut=this.add(new ft[0](ft[1]));ft[2]&&Ut.recognizeWith(ft[2]),ft[3]&&Ut.requireFailure(ft[3])},this)}js.prototype={set:function(ze){return te(this.options,ze),ze.touchAction&&this.touchAction.update(),ze.inputTarget&&(this.input.destroy(),this.input.target=ze.inputTarget,this.input.init()),this},stop:function(ze){this.session.stopped=ze?Gr:dn},recognize:function(ze){var Ye=this.session;if(!Ye.stopped){this.touchAction.preventDefaults(ze);var ft,Ut=this.recognizers,hi=Ye.curRecognizer;(!hi||hi&&hi.state&cr)&&(hi=Ye.curRecognizer=null);for(var ji=0;ji<Ut.length;)ft=Ut[ji],Ye.stopped!==Gr&&(!hi||ft==hi||ft.canRecognizeWith(hi))?ft.recognize(ze):ft.reset(),!hi&&ft.state&(hr|mn|yn)&&(hi=Ye.curRecognizer=ft),ji++}},get:function(ze){if(ze instanceof Vr)return ze;for(var Ye=this.recognizers,ft=0;ft<Ye.length;ft++)if(Ye[ft].options.event==ze)return Ye[ft];return null},add:function(ze){if(D(ze,"add",this))return this;var Ye=this.get(ze.options.event);return Ye&&this.remove(Ye),this.recognizers.push(ze),ze.manager=this,this.touchAction.update(),ze},remove:function(ze){if(D(ze,"remove",this))return this;if(ze=this.get(ze),ze){var Ye=this.recognizers,ft=Re(Ye,ze);ft!==-1&&(Ye.splice(ft,1),this.touchAction.update())}return this},on:function(ze,Ye){if(ze!==n&&Ye!==n){var ft=this.handlers;return N(rt(ze),function(Ut){ft[Ut]=ft[Ut]||[],ft[Ut].push(Ye)}),this}},off:function(ze,Ye){if(ze!==n){var ft=this.handlers;return N(rt(ze),function(Ut){Ye?ft[Ut]&&ft[Ut].splice(Re(ft[Ut],Ye),1):delete ft[Ut]}),this}},emit:function(ze,Ye){this.options.domEvents&&ho(ze,Ye);var ft=this.handlers[ze]&&this.handlers[ze].slice();if(!(!ft||!ft.length)){Ye.type=ze,Ye.preventDefault=function(){Ye.srcEvent.preventDefault()};for(var Ut=0;Ut<ft.length;)ft[Ut](Ye),Ut++}},destroy:function(){this.element&&ha(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ha(ze,Ye){var ft=ze.element;if(ft.style){var Ut;N(ze.options.cssProps,function(hi,ji){Ut=Xe(ft.style,ji),Ye?(ze.oldCssProps[Ut]=ft.style[Ut],ft.style[Ut]=hi):ft.style[Ut]=ze.oldCssProps[Ut]||""}),Ye||(ze.oldCssProps={})}}function ho(ze,Ye){var ft=t.createEvent("Event");ft.initEvent(ze,!0,!0),ft.gesture=Ye,Ye.target.dispatchEvent(ft)}te(Sn,{INPUT_START:Bt,INPUT_MOVE:Ft,INPUT_END:Lt,INPUT_CANCEL:Gt,STATE_POSSIBLE:xn,STATE_BEGAN:hr,STATE_CHANGED:mn,STATE_ENDED:yn,STATE_RECOGNIZED:cr,STATE_CANCELLED:On,STATE_FAILED:ms,DIRECTION_NONE:ri,DIRECTION_LEFT:mi,DIRECTION_RIGHT:yi,DIRECTION_UP:Pi,DIRECTION_DOWN:Ot,DIRECTION_HORIZONTAL:lt,DIRECTION_VERTICAL:wt,DIRECTION_ALL:ki,Manager:js,Input:qt,TouchAction:Qi,TouchInput:Fe,MouseInput:bi,PointerEventInput:Be,TouchMouseInput:_t,SingleTouchInput:me,Recognizer:Vr,AttrRecognizer:Xi,Tap:Ur,Pan:eo,Swipe:Gn,Pinch:Cs,Rotate:Dr,Press:fr,on:He,off:$e,each:N,merge:ue,extend:he,assign:te,inherit:fe,bindFn:ve,prefixed:Xe});var Ta=typeof e<"u"?e:typeof self<"u"?self:{};Ta.Hammer=Sn,typeof n=="function"&&n.amd?n(function(){return Sn}):i.exports?i.exports=Sn:e[r]=Sn})(window,document,"Hammer")})(pM);var By=pM.exports;const Vh=Om({__proto__:null,default:Um(By)},[By]),gM=1,mM=2,Z2=4,yK={mousedown:gM,mousemove:mM,mouseup:Z2};function _K(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function vK(i){const e=i.prototype.handler;i.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(_K(n,o=>o.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function bK(i){i.prototype.handler=function(t){let r=yK[t.type];r&gM&&t.button>=0&&(this.pressed=!0),r&mM&&t.which===0&&(r=Z2),this.pressed&&(r&Z2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}vK(By.PointerEventInput),bK(By.MouseInput);const xK=By.Manager;class w1{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const wK=Vh?[[Vh.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Vh.Rotate,{enable:!1}],[Vh.Pinch,{enable:!1}],[Vh.Swipe,{enable:!1}],[Vh.Pan,{threshold:0,enable:!1}],[Vh.Press,{enable:!1}],[Vh.Tap,{event:"doubletap",taps:2,enable:!1}],[Vh.Tap,{event:"anytap",enable:!1}],[Vh.Tap,{enable:!1}]]:null,yM={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},BK={doubletap:["tap"]},CK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},J2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},EK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},_M={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},SK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",cg=typeof window<"u"?window:global;let Y2=!1;try{const i={get passive(){return Y2=!0,!0}};cg.addEventListener("test",null,i),cg.removeEventListener("test",null)}catch{Y2=!1}const TK=SK.indexOf("firefox")!==-1,{WHEEL_EVENTS:IK}=J2,vM="wheel",bM=4.000244140625,LK=40,MK=.25;class PK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;cg.WheelEvent&&(TK&&n.deltaMode===cg.WheelEvent.DOM_DELTA_PIXEL&&(o/=cg.devicePixelRatio),n.deltaMode===cg.WheelEvent.DOM_DELTA_LINE&&(o*=LK)),o!==0&&o%bM===0&&(o=Math.floor(o/bM)),n.shiftKey&&o&&(o=o*MK),this.callback({type:vM,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(IK),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,Y2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===vM&&(this.options.enable=t)}}const{MOUSE_EVENTS:FK}=J2,xM="pointermove",wM="pointerover",BM="pointerout",CM="pointerenter",EM="pointerleave";class DK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(FK),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===xM&&(this.enableMoveEvent=t),e===wM&&(this.enableOverEvent=t),e===BM&&(this.enableOutEvent=t),e===CM&&(this.enableEnterEvent=t),e===EM&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(wM,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(BM,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(CM,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(EM,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(xM,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:RK}=J2,SM="keydown",TM="keyup";class kK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:SM,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:TM,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(RK),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===SM&&(this.enableDownEvent=t),e===TM&&(this.enableUpEvent=t)}}const IM="contextmenu";class OK extends w1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:IM,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===IM&&(this.options.enable=t)}}const eB=1,B1=2,tB=4,UK={pointerdown:eB,pointermove:B1,pointerup:tB,mousedown:eB,mousemove:B1,mouseup:tB},NK=1,zK=2,QK=3,VK=0,HK=1,GK=2,jK=1,qK=2,$K=4;function KK(i){const e=UK[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:n}=i.srcEvent;let o=!1,l=!1,s=!1;return e===tB||e===B1&&!Number.isFinite(t)?(o=n===NK,l=n===zK,s=n===QK):e===B1?(o=!!(t&jK),l=!!(t&$K),s=!!(t&qK)):e===eB&&(o=r===VK,l=r===HK,s=r===GK),{leftButton:o,middleButton:l,rightButton:s}}function WK(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,l={x:(t.x-r.left-e.clientLeft)/n,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:l}}const iB={srcElement:"root",priority:0};class XK{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:l,handlersByElement:s}=this;let g=iB;typeof r=="string"||r&&r.addEventListener?g={...iB,srcElement:r}:r&&(g={...iB,...r});let b=s.get(g.srcElement);b||(b=[],s.set(g.srcElement,b));const S={type:e,handler:t,srcElement:g.srcElement,priority:g.priority};n&&(S.once=!0),o&&(S.passive=!0),l.push(S),this._active=this._active||!S.passive;let F=b.length-1;for(;F>=0&&!(b[F].priority>=S.priority);)F--;b.splice(F+1,0,S)}remove(e,t){const{handlers:r,handlersByElement:n}=this;for(let o=r.length-1;o>=0;o--){const l=r[o];if(l.type===e&&l.handler===t){r.splice(o,1);const s=n.get(l.srcElement);s.splice(s.indexOf(l),1),s.length===0&&n.delete(l.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let n=!1;const o=()=>{e.handled=!0},l=()=>{e.handled=!0,n=!0},s=[];for(let g=0;g<r.length;g++){const{type:b,handler:S,once:F}=r[g];if(S({...e,type:b,stopPropagation:o,stopImmediatePropagation:l}),F&&s.push(r[g]),n)break}for(let g=0;g<s.length;g++){const{type:b,handler:S}=s[g];this.remove(b,S)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...KK(e),...WK(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const ZK={events:null,recognizers:null,recognizerOptions:{},Manager:xK,touchAction:"none",tabIndex:0};class JK{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,l=CK[o.type];l&&this.manager.emit(l,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...ZK,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||wK}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(yM).forEach(n=>{const o=this.manager.get(n);o&&yM[n].forEach(l=>{o.recognizeWith(l)})});for(const n in t.recognizerOptions){const o=this.manager.get(n);if(o){const l=t.recognizerOptions[n];delete l.enable,o.set(l)}}this.wheelInput=new PK(e,this._onOtherEvent,{enable:!1}),this.moveInput=new DK(e,this._onOtherEvent,{enable:!1}),this.keyInput=new kK(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new OK(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const n=r.get(e);if(n&&n.options.enable!==t){n.set({enable:t});const o=BK[e];o&&!this.options.recognizers&&o.forEach(l=>{const s=r.get(l);t?(s.requireFailure(e),n.dropRequireFailure(l)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,n,o){if(typeof e!="string"){r=t;for(const S in e)this._addEventHandler(S,e[S],r,n,o);return}const{manager:l,events:s}=this,g=_M[e]||e;let b=s.get(g);b||(b=new XK(this),s.set(g,b),b.recognizerName=EK[g]||g,l&&l.on(g,b.handleEvent)),b.add(e,t,r,n,o),b.isEmpty()||this._toggleRecognizer(b.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const l in e)this._removeEventHandler(l,e[l]);return}const{events:r}=this,n=_M[e]||e,o=r.get(n);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:l}=o;let s=!1;for(const g of r.values())if(g.recognizerName===l&&!g.isEmpty()){s=!0;break}s||this._toggleRecognizer(l,!1)}}}function Bf(){}const LM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Bf,onResize:Bf,onViewStateChange:Bf,onInteractionStateChange:Bf,onBeforeRender:Bf,onAfterRender:Bf,onLoad:Bf,onError:i=>kn.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i=>{let{isDragging:e}=i;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class rB{constructor(e){_e(this,"props",void 0),_e(this,"width",0),_e(this,"height",0),_e(this,"userData",{}),_e(this,"canvas",null),_e(this,"viewManager",null),_e(this,"layerManager",null),_e(this,"effectManager",null),_e(this,"deckRenderer",null),_e(this,"deckPicker",null),_e(this,"eventManager",null),_e(this,"tooltip",null),_e(this,"metrics",void 0),_e(this,"animationLoop",void 0),_e(this,"stats",void 0),_e(this,"viewState",void 0),_e(this,"cursorState",void 0),_e(this,"_needsRedraw",void 0),_e(this,"_pickRequest",void 0),_e(this,"_lastPointerDownInfo",null),_e(this,"_metricsCounter",void 0),_e(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;r.x=n.x,r.y=n.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),_e(this,"_onEvent",t=>{const r=$5[t.type],n=t.offsetCenter;if(!r||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=l,g=s&&(s[r.handler]||s.props[r.handler]),b=this.props[r.handler];let S=!1;g&&(S=g.call(s,l,t)),!S&&b&&b(l,t)}),_e(this,"_onPointerDown",t=>{const r=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...LM,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&kn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Q5()==="IE"&&kn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Ww({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&vy.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,n,o,l,s,g;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)===null||l===void 0||l.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(g=this.tooltip)===null||g===void 0||g.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var b;(b=this.canvas.parentElement)===null||b===void 0||b.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&kn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&kn.removed("onLayerClick","onClick")(),e.initialViewState&&!Qh(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||r||n||o||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return ol(this.viewManager),this.viewManager.views}getViewports(e){return ol(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){ol(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),ol(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var n;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((n=e.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const n=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(n!==this.width||o!==this.height){var l,s;this.width=n,this.height=o,(l=this.viewManager)===null||l===void 0||l.setProps({width:n,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:n,glOptions:o,debug:l,onError:s,onBeforeRender:g,onAfterRender:b,useDevicePixels:S}=e;return new F7({width:t,height:r,useDevicePixels:S,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:F=>c3({...o,...F,canvas:this.canvas,debug:l,onContextLost:()=>this._onContextLost()}),onInitialize:F=>this._setGLContext(F.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:b,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new X2({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=n,l=!1;for(const s of r){var t;o=s,l=((t=s.layer)===null||t===void 0?void 0:t.onHover(s,e.event))||l}if(!l&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Kw(e,{enable:!0,copyState:!0})),this.tooltip=new mK(this.canvas),xA(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new UL;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new JK(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in $5)this.eventManager.on(n,this._onEvent);this.viewManager=new H$({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new V$(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new oK,this.deckRenderer=new cK(e),this.deckPicker=new pK(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;xA(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),kn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=mf.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}_e(rB,"defaultProps",LM),_e(rB,"VERSION",NV);class nB{constructor(e,t){_e(this,"opts",void 0),_e(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:n}=t;let o=r;if(r&&r.length!==n){o=new Float32Array(n);const l=t.elementOffset||0;for(let s=0;s<n;++s)o[s]=r[l+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function YK(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function C1(i){return i.stride||i.size*i.bytesPerElement}function MM(i,e){e.offset&&kn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=C1(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,n=e.elementOffset||0,o=r*t+n*i.bytesPerElement+(i.offset||0);return{...e,offset:o,stride:t}}function eW(i,e){const t=MM(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class tW{constructor(e,t,r){_e(this,"gl",void 0),_e(this,"id",void 0),_e(this,"size",void 0),_e(this,"settings",void 0),_e(this,"value",void 0),_e(this,"doublePrecision",void 0),_e(this,"_buffer",void 0),_e(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,o=n===5130;let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let s;o?s=5126:!n&&t.isIndexed?s=e&&r2(e,Vs.ELEMENT_INDEX_UINT32)?5125:5123:s=n||5126;let g=YK(n||s||5126);this.doublePrecision=o,o&&t.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...t,defaultType:g,defaultValue:l,logicalType:n,type:s,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new xs(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*C1(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),vy.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},n=this.value instanceof Float64Array,o=eW(this.getAccessor(),t||{});return r[e]=new nB(this,o.high),r["".concat(e,"64Low")]=n?new nB(this,o.low):new Float32Array(this.size),r}if(t){const r=MM(this.getAccessor(),t);return{[e]:new nB(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:n}=this,o=r*n;if(t&&o&&t.length>=o){const l=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let g=0;g<o;)for(let b=0;b<n;b++){const S=t[g++];S<l[b]&&(l[b]=S),S>s[b]&&(s[b]=S)}e=[l,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof xs?r={buffer:e}:r=e;const n={...this.settings,...r};if(t.bufferAccessor=n,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const l=r.value instanceof Float64Array;n.type=r.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(l?2:1),n.stride=C1(n)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=C1(n);const{buffer:l,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=G2(o,n));const g=o.byteLength+s+n.stride*2;l.byteLength<g&&l.reallocate(g),l.setAccessor(null),l.subData({data:o,offset:s}),n.type=r.type||l.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:n}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?G2(t,{size:this.size,startIndex:r,endIndex:n}):t.subarray(r,n),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,n=r.allocatedValue,o=vy.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:l,byteOffset:s}=this;return l.byteLength<o.byteLength+s&&(l.reallocate(o.byteLength+s),t&&n&&l.subData({data:n instanceof Float64Array?G2(n,this):n,offset:s})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&kn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let l=o;for(;--l>=0;)t[r+l]=n[l];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let l=o;for(;--l>=0;)t[r+l]=Number.isFinite(e[l])?e[l]:n[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}const PM=[],FM=[];function DM(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=PM;const n={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(FM.length=i.length,r=FM):r=PM,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),n.index=e-1),{iterable:r,objectInfo:n}}function RM(i){return i&&i[Symbol.asyncIterator]}function iW(i,e){const{size:t,stride:r,offset:n,startIndices:o,nested:l}=e,s=i.BYTES_PER_ELEMENT,g=r?r/s:t,b=n?n/s:0,S=Math.floor((i.length-b)/g);return(F,D)=>{let{index:N,target:J}=D;if(!o){const fe=N*g+b;for(let ve=0;ve<t;ve++)J[ve]=i[fe+ve];return J}const te=o[N],he=o[N+1]||S;let ue;if(l){ue=new Array(he-te);for(let fe=te;fe<he;fe++){const ve=fe*g+b;J=new Array(t);for(let Se=0;Se<t;Se++)J[Se]=i[ve+Se];ue[fe-te]=J}}else if(g===t)ue=i.subarray(te*t+b,he*t+b);else{ue=new i.constructor((he-te)*t);let fe=0;for(let ve=te;ve<he;ve++){const Se=ve*g+b;for(let Ge=0;Ge<t;Ge++)ue[fe++]=i[Se+Ge]}}return ue}}const rW=[],E1=[[0,1/0]];function nW(i,e){if(i===E1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let n=0;for(let o=0;o<r;o++){const l=i[o];l[1]<e[0]?(t.push(l),n=o+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(n,0,e),t}function sB(i){const{source:e,target:t,start:r=0,size:n,getData:o}=i,l=i.end||t.length,s=e.length,g=l-r;if(s>g){t.set(e.subarray(0,g),r);return}if(t.set(e,r),!o)return;let b=s;for(;b<g;){const S=o(b,e);for(let F=0;F<n;F++)t[r+b]=S[F]||0,b++}}function sW(i){let{source:e,target:t,size:r,getData:n,sourceStartIndices:o,targetStartIndices:l}=i;if(!Array.isArray(l))return sB({source:e,target:t,size:r,getData:n}),t;let s=0,g=0;const b=n&&((F,D)=>n(F+g,D)),S=Math.min(o.length,l.length);for(let F=1;F<S;F++){const D=o[F]*r,N=l[F]*r;sB({source:e.subarray(s,D),target:t,start:g,end:N,size:r,getData:b}),s=D,g=N}return g<t.length&&sB({source:[],target:t,start:g,size:r,getData:b}),t}const oW={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function kM(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...oW[t],...e,...i,type:t}}function OM(i,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function UM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function NM(i){i.push(i.shift())}function oB(i,e){const{doublePrecision:t,settings:r,value:n,size:o}=i,l=t&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:e*o)*l}function zM(i){let{buffer:e,numInstances:t,attribute:r,fromLength:n,fromStartIndices:o,getData:l=fe=>fe}=i;const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,g=r.size*s,b=r.byteOffset,S=r.startIndices,F=o&&S,D=oB(r,t),N=r.isConstant;if(!F&&n>=D)return;const J=N?r.value:r.getBuffer().getData({srcByteOffset:b});if(r.settings.normalized&&!N){const fe=l;l=(ve,Se)=>r.normalizeConstant(fe(ve,Se))}const te=N?(fe,ve)=>l(J,ve):(fe,ve)=>l(J.subarray(fe,fe+g),ve),he=e.getData({length:n}),ue=new Float32Array(D);sW({source:he,target:ue,sourceStartIndices:o,targetStartIndices:S,size:g,getData:te}),e.byteLength<ue.byteLength+b&&e.reallocate(ue.byteLength+b),e.subData({data:ue,offset:b})}class aB extends tW{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:E1}),_e(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,n=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return kM(n,r)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:n=1/0}=t;this.state.updateRanges=nW(this.state.updateRanges,[r,n])}else this.state.updateRanges=E1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=rW}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==E1),!0):!1}updateBuffer(e){let{numInstances:t,data:r,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:s,noAlloc:g}}=this;let b=!0;if(s){for(const[S,F]of l)s.call(o,this,{data:r,startRow:S,endRow:F,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[S,F]of l){const D=Number.isFinite(S)?this.getVertexOffset(S):0,N=Number.isFinite(F)?this.getVertexOffset(F):g||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:D,endOffset:N})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:n}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;ol(ArrayBuffer.isView(l.value),"invalid ".concat(n.accessor));const s=!!l.size&&l.size!==this.size;return r.binaryAccessor=iW(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,t){let{data:r,startRow:n,endRow:o,props:l,numInstances:s}=t;if(e.constant)return;const{settings:g,state:b,value:S,size:F,startIndices:D}=e,{accessor:N,transform:J}=g,te=b.binaryAccessor||(typeof N=="function"?N:l[N]);ol(typeof te=="function",'accessor "'.concat(N,'" is not a function'));let he=e.getVertexOffset(n);const{iterable:ue,objectInfo:fe}=DM(r,n,o);for(const ve of ue){fe.index++;let Se=te(ve,fe);if(J&&(Se=J.call(this,Se)),D){const Ge=(fe.index<D.length-1?D[fe.index+1]:s)-D[fe.index];if(Se&&Array.isArray(Se[0])){let He=he;for(const $e of Se)e._normalizeValue($e,S,He),He+=F}else Se&&Se.length>F?S.set(Se,he):(e._normalizeValue(Se,fe.target,0),D$({target:S,source:fe.target,start:he,count:Ge}));he+=Ge*F}else e._normalizeValue(Se,S,he),he+=F}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class aW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;_e(this,"gl",void 0),_e(this,"type","interpolation"),_e(this,"attributeInTransition",void 0),_e(this,"settings",void 0),_e(this,"attribute",void 0),_e(this,"transition",void 0),_e(this,"currentStartIndices",void 0),_e(this,"currentLength",void 0),_e(this,"transform",void 0),_e(this,"buffers",void 0),this.gl=t,this.transition=new wy(n),this.attribute=r,this.attributeInTransition=new aB(t,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=cW(t,r);const o={byteLength:0,usage:35050};this.buffers=[new xs(t,o),new xs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:n,attribute:o}=this;NM(n);const l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)zM({buffer:s,...l});this.currentStartIndices=o.startIndices,this.currentLength=oB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:OM(r,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:n}=this.transition;let o=n/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const lW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function cW(i,e){const t=UM(e.size);return new D2(i,{vs:lW,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class uW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;_e(this,"gl",void 0),_e(this,"type","spring"),_e(this,"attributeInTransition",void 0),_e(this,"settings",void 0),_e(this,"attribute",void 0),_e(this,"transition",void 0),_e(this,"currentStartIndices",void 0),_e(this,"currentLength",void 0),_e(this,"texture",void 0),_e(this,"framebuffer",void 0),_e(this,"transform",void 0),_e(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new wy(n),this.attribute=r,this.attributeInTransition=new aB(t,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=AW(t),this.framebuffer=dW(t,this.texture),this.transform=hW(t,r,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new xs(t,o),new xs(t,o),new xs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:n,attribute:o}=this,l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)zM({buffer:s,...l});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=oB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:OM(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:n}=this;if(!n.update())return!1;const l=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:l.stiffness,damping:l.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),NM(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),W_(r)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function hW(i,e,t){const r=UM(e.size);return new D2(i,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function AW(i){return new Zc(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function dW(i,e){return new wa(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const fW={interpolation:aW,spring:uW};class pW{constructor(e,t){let{id:r,timeline:n}=t;_e(this,"id",void 0),_e(this,"isSupported",void 0),_e(this,"gl",void 0),_e(this,"timeline",void 0),_e(this,"transitions",void 0),_e(this,"needsRedraw",void 0),_e(this,"numInstances",void 0),this.id=r,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=D2.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:r,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const l=t[o],s=l.getTransitionSetting(r);s&&this._updateAttribute(o,l,s)}for(const o in this.transitions){const l=t[o];(!l||!l.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const n=this.transitions[e];let o=!n||n.type!==r.type;if(o){if(!this.isSupported){kn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}n&&this._removeTransition(e);const l=fW[r.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,gl:this.gl}):(kn.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const QM="attributeManager.invalidate",gW="attributeManager.updateStart",mW="attributeManager.updateEnd",yW="attribute.updateStart",_W="attribute.allocate",vW="attribute.updateEnd";class bW{constructor(e){let{id:t="attribute-manager",stats:r,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};_e(this,"id",void 0),_e(this,"gl",void 0),_e(this,"attributes",void 0),_e(this,"updateTriggers",void 0),_e(this,"needsRedraw",void 0),_e(this,"userData",void 0),_e(this,"stats",void 0),_e(this,"attributeTransitionManager",void 0),_e(this,"mergeBoundsMemoized",yy(C$)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new pW(e,{id:"".concat(t,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Sl(QM,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Sl(QM,this,"all")}update(e){let{data:t,numInstances:r,startIndices:n=null,transitions:o,props:l={},buffers:s={},context:g={}}=e,b=!1;Sl(gW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const S in this.attributes){const F=this.attributes[S],D=F.settings.accessor;F.startIndices=n,F.numInstances=r,l[S]&&kn.removed("props.".concat(S),"data.attributes.".concat(S))(),F.setExternalBuffer(s[S])||F.setBinaryValue(typeof D=="string"?s[D]:void 0,t.startIndices)||typeof D=="string"&&!s[D]&&F.setConstantValue(l[D])||F.needsUpdate()&&(b=!0,this._updateAttribute({attribute:F,numInstances:r,data:t,props:l,context:g})),this.needsRedraw=this.needsRedraw||F.needsRedraw()}b&&Sl(mW,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var n;return(n=this.attributes[r])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const o in t){const l=t[o];l.needsRedraw(e)&&!r.hasAttribute(o)&&(n[o]=l)}return n}getShaderAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const r={};for(const n in e)t[n]||Object.assign(r,e[n].getShaderAttributes());return r}_add(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in e){const n=e[r];this.attributes[r]=this._createAttribute(r,n,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const n={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new aB(this.gl,n)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:n}=this,o=n[e];return o&&o.forEach(l=>{const s=r[l];s&&s.setNeedsUpdate(s.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Sl(yW,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Sl(_W,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Sl(vW,t,r))}}class xW extends wy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:n,easing:o}}=this,l=o(e/n);this._value=s1(t,r,l)}}const VM=1e-5;function HM(i,e,t,r,n){const o=e-i,s=(t-e)*n,g=-o*r;return s+g+o+e}function wW(i,e,t,r,n){if(Array.isArray(t)){const o=[];for(let l=0;l<t.length;l++)o[l]=HM(i[l],e[l],t[l],r,n);return o}return HM(i,e,t,r,n)}function GM(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const n=i[r]-e[r];t+=n*n}return Math.sqrt(t)}return Math.abs(i-e)}class BW extends wy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:l=e}=this;let s=wW(o,l,t,r,n);const g=GM(s,t),b=GM(s,l);g<VM&&b<VM&&(s=t,this.end()),this._prevValue=l,this._currValue=s}}const CW={interpolation:xW,spring:BW};class EW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,n){const{transitions:o}=this;if(o.has(e)){const g=o.get(e),{value:b=g.settings.fromValue}=g;t=b,this.remove(e)}if(n=kM(n),!n)return;const l=CW[n.type];if(!l){kn.error("unsupported transition type '".concat(n.type,"'"))();return}const s=new l(this.timeline);s.start({...n,fromValue:t,toValue:r}),o.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function SW(i){const e=i[cd];for(const t in e){const r=e[t],{validate:n}=r;if(n&&!n(i[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(i[t]))}}function TW(i,e){const t=jM({newProps:i,oldProps:e,propTypes:i[cd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=LW(i,e);let n=!1;return r||(n=MW(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:n,extensionsChanged:PW(i,e),transitionsChanged:IW(i,e)}}function IW(i,e){if(!i.transitions)return!1;const t={},r=i[cd];let n=!1;for(const o in i.transitions){const l=r[o],s=l&&l.type;(s==="number"||s==="color"||s==="array")&&lB(i[o],e[o],l)&&(t[o]=!0,n=!0)}return n?t:!1}function jM(i){let{newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:o="props"}=i;if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return"".concat(o,".").concat(l," added");const s=lB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return"".concat(o,".").concat(l," dropped");if(!Object.hasOwnProperty.call(e,l)){const s=lB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}}return!1}function lB(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function LW(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:n}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(i.data,e.data)||t),t}function MW(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&qM(i,e,"all"))return{all:!0};const t={};let r=!1;for(const n in i.updateTriggers)n!=="all"&&qM(i,e,n)&&(t[n]=!0,r=!0);return r?t:!1}function PW(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(t[n]))return!0;return!1}function qM(i,e,t){let r=i.updateTriggers[t];r=r??{};let n=e.updateTriggers[t];return n=n??{},jM({oldProps:n,newProps:r,triggerName:t})}const FW="count(): argument not an object",DW="count(): argument not a container";function RW(i){if(!OW(i))throw new Error(FW);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(kW(i))return Object.keys(i).length;throw new Error(DW)}function kW(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function OW(i){return i!==null&&typeof i=="object"}function UW(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(n=>n.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const n in e.inject)r[n]=(r[n]||"")+e.inject[n];t.inject=r}return t}const NW={10241:9987,10240:9729,10242:33071,10243:33071},cB={};function zW(i,e,t,r){if(t instanceof Zc)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={10241:t.data.length>1?9985:9729});const o=new Zc(e,{...t,parameters:{...NW,...n,...r}});return cB[o.id]=i,o}function QW(i,e){!e||!(e instanceof Zc)||cB[e.id]===i&&(e.delete(),delete cB[e.id])}const VW={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||uB(i)&&(i.length===3||i.length===4)},equal(i,e,t){return Qh(i,e,1)}},accessor:{validate(i,e){const t=S1(i);return t==="function"||t===S1(e.value)},equal(i,e,t){return typeof e=="function"?!0:Qh(i,e,1)}},array:{validate(i,e){return e.optional&&!i||uB(i)},equal(i,e,t){const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?Qh(i,e,n):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?Qh(i,e,n):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{const{dataTransform:r}=t.props;return r&&i?r(i):i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.gl?null:zW(t.id,r.gl,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{QW(t.id,i)}}};function HW(i){const e={},t={},r={};for(const[n,o]of Object.entries(i)){const l=o==null?void 0:o.deprecatedFor;if(l)r[n]=Array.isArray(l)?l:[l];else{const s=GW(n,o);e[n]=s,t[n]=s.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function GW(i,e){switch(S1(e)){case"object":return Cy(i,e);case"array":return Cy(i,{type:"array",value:e,compare:!1});case"boolean":return Cy(i,{type:"boolean",value:e});case"number":return Cy(i,{type:"number",value:e});case"function":return Cy(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function Cy(i,e){return"type"in e?{name:i,...VW[e.type],...e}:"value"in e?{name:i,type:S1(e.value),...e}:{name:i,type:"object",value:e}}function uB(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function S1(i){return uB(i)?"array":i===null?"null":typeof i}function jW(i,e){let t;for(let o=e.length-1;o>=0;o--){const l=e[o];"extensions"in l&&(t=l.extensions)}const r=hB(i.constructor,t),n=Object.create(r);n[v1]=i,n[xf]={},n[ud]={};for(let o=0;o<e.length;++o){const l=e[o];for(const s in l)n[s]=l[s]}return Object.freeze(n),n}const qW="_mergedDefaultProps";function hB(i,e){let t=qW;if(e)for(const n of e){const o=n.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=$M(i,t);return r||(i[t]=$W(i,e||[]))}function $W(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),n=hB(r),o=$M(i,"defaultProps")||{},l=HW(o),s=Object.assign(Object.create(null),n,l.defaultProps),g=Object.assign(Object.create(null),n==null?void 0:n[cd],l.propTypes),b=Object.assign(Object.create(null),n==null?void 0:n[q2],l.deprecatedProps);for(const S of e){const F=hB(S.constructor);F&&(Object.assign(s,F),Object.assign(g,F[cd]),Object.assign(b,F[q2]))}return KW(s,i),XW(s,g),WW(s,b),s[cd]=g,s[q2]=b,e.length===0&&!AB(i,"_propTypes")&&(i._propTypes=g),s}function KW(i,e){const t=JW(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function WW(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const n="".concat(this.id,": ").concat(t);for(const o of e[t])AB(this,o)||(this[o]=r);kn.deprecated(n,e[t].join("/"))()}})}function XW(i,e){const t={},r={};for(const n in e){const o=e[n],{name:l,value:s}=o;o.async&&(t[l]=s,r[l]=ZW(l))}i[ag]=t,i[xf]={},Object.defineProperties(i,r)}function ZW(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||RM(e)?this[xf][i]=e:this[ud][i]=e},get(){if(this[ud]){if(i in this[ud])return this[ud][i]||this[ag][i];if(i in this[xf]){const e=this[v1]&&this[v1].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[ag][i]}}return this[ag][i]}}}function AB(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function $M(i,e){return AB(i,e)&&i[e]}function JW(i){const e=i.componentName;return e||kn.warn("".concat(i.name,".componentName not specified"))(),e||i.name}let YW=0;class dB{constructor(){_e(this,"id",void 0),_e(this,"props",void 0),_e(this,"count",void 0);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.props=jW(this,t),this.id=this.props.id,this.count=YW++}clone(e){const{props:t}=this,r={};for(const n in t[ag])n in t[ud]?r[n]=t[ud][n]:n in t[xf]&&(r[n]=t[xf][n]);return new this.constructor({...t,...r,...e})}}_e(dB,"componentName","Component"),_e(dB,"defaultProps",{});const eX=Object.freeze({});class tX{constructor(e){_e(this,"component",void 0),_e(this,"onAsyncPropUpdated",void 0),_e(this,"asyncProps",void 0),_e(this,"oldProps",void 0),_e(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||eX}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[v1]||this.component;const t=e[ud]||{},r=e[xf]||e,n=e[ag]||{};for(const o in t){const l=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l),t[o]=this.getAsyncProp(o)}for(const o in r){const l=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(RM(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],l=0;for await(const s of t){if(!this.component)return;const{dataTransform:g}=this.component.props;g?o=g(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:l,endRow:o.length}]}),l=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[cd];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class iX extends tX{constructor(e){let{attributeManager:t,layer:r}=e;super(r),_e(this,"attributeManager",void 0),_e(this,"needsRedraw",void 0),_e(this,"needsUpdate",void 0),_e(this,"subLayers",void 0),_e(this,"usesPickingColorCache",void 0),_e(this,"hasPickingBuffer",void 0),_e(this,"changeFlags",void 0),_e(this,"viewport",void 0),_e(this,"uniformTransitions",void 0),_e(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const n=r.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const rX="layer.changeFlag",nX="layer.initialize",sX="layer.update",oX="layer.finalize",aX="layer.matched",KM=2**24-1,lX=Object.freeze([]),cX=yy(i=>{let{oldViewport:e,viewport:t}=i;return e.equals(t)});let Hh=new Uint8ClampedArray(0);const uX={data:{type:"data",value:lX,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,e)=>{let{propName:t,layer:r,loaders:n,loadOptions:o,signal:l}=e;const{resourceManager:s}=r.context;if(o=o||r.getLoadOptions(),n=n||r.props.loaders,l){var g;o={...o,fetch:{...(g=o)===null||g===void 0?void 0:g.fetch,signal:l}}}let b=s.contains(i);return!b&&!o&&(s.add({resourceId:i,data:rd(i,n),persistent:!1}),b=!0),b?s.subscribe({resourceId:i,onChange:S=>{var F;return(F=r.internalState)===null||F===void 0?void 0:F.reloadAsyncProp(t,S)},consumerId:r.id,requestId:t}):rd(i,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Pn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:e}=i;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ug extends dB{constructor(){super(...arguments),_e(this,"internalState",null),_e(this,"lifecycle",og.NO_STATE),_e(this,"context",void 0),_e(this,"state",void 0),_e(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){ol(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=oM(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,l]=JL(r,t.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,l]}unproject(e){return ol(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){ol(this.internalState);const r=this.internalState.viewport||this.context.viewport;return M$(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Pn.DEFAULT||e===Pn.LNGLAT||e===Pn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){ol(e instanceof Uint8Array);const[t,r,n]=e;return t+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:RW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=UW(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const n of r)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,o=this.internalState.hasPickingBuffer,l=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:s,instancePickingColors:g}=t.attributes,b=s||g;b&&(l&&b.constant&&(b.constant=!1,t.invalidate(b.id)),!b.value&&!l&&(b.constant=!0,b.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:r,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var r,n;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(n=this.props).onError)!==null&&r!==void 0&&r.call(n,e))){var o,l;(o=this.context)===null||o===void 0||(l=o.onError)===null||l===void 0||l.call(o,e,this)}}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!cX({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const n in t)Object.defineProperty(r,n,{value:t[n]});return r}return this.props}calculateInstancePickingColors(e,t){let{numInstances:r}=t;if(e.constant)return;const n=Math.floor(Hh.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>KM&&kn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Hh=vy.allocate(Hh,r,{size:3,copy:!0,maxCount:Math.max(r,KM)});const o=Math.floor(Hh.length/3),l=[];for(let s=n;s<o;s++)this.encodePickingColor(s,l),Hh[s*3+0]=l[0],Hh[s*3+1]=l[1],Hh[s*3+2]=l[2]}e.value=Hh.subarray(0,r*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),n=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,n);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n,l=o&&t.attributes&&t.attributes[o.id];if(l&&l.value){const s=l.value,g=this.encodePickingColor(e);for(let b=0;b<t.length;b++){const S=o.getVertexOffset(b);s[S]===g[0]&&s[S+1]===g[1]&&s[S+2]===g[2]&&this._disablePickingIndex(b)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;if(!n)return;const o=n.getVertexOffset(e),l=n.getVertexOffset(e+1);n.buffer.subData({data:new Uint8Array(l-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Hh.buffer&&(r.value=Hh.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ol(!this.internalState),ol(Number.isFinite(this.props.coordinateSystem)),Sl(nX,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new iX({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(kn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new EW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Sl(aX,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Sl(sX,this,e),!e)return;const t=this.props,r=this.context,n=this.internalState,o=r.viewport,l=this._updateUniformTransition();n.propsInTransition=l,r.viewport=n.viewport||o,this.props=l;try{const s=this._getUpdateParams(),g=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const S of this.props.extensions)S.updateState.call(this,s,S);const b=this.getModels()[0]!==g[0];this._postUpdate(s,b)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Sl(oX,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{moduleParameters:t=null,uniforms:r={},parameters:n={}}=e;this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;r.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:g}=this.props,b=g&&g(r)||[0,0];xA(l.gl,{polygonOffset:b}),Yu(l.gl,n,()=>{const S={moduleParameters:t,uniforms:r,parameters:n,context:l};for(const F of this.props.extensions)F.draw.call(this,S,F);this.draw(S)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const l=e[n],s=t[n];l&&Array.isArray(s)&&(t.dataChanged=Array.isArray(l)?s.concat(l):l,o=!0);default:t[n]||(t[n]=e[n],o=!0)}o&&Sl(rX,this,n,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=TW(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],(n=e.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(r)}validateProps(){SW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new bW(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:s,highlightColor:g}=r;if(t||n.autoHighlight!==l||n.highlightedObjectIndex!==s||n.highlightColor!==g){const b={};l||(b.pickingSelectedColor=null),Array.isArray(g)&&(b.pickingHighlightColor=g),(t||s!==n.highlightedObjectIndex)&&(b.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(b)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(e):!1;if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}_e(ug,"defaultProps",uX),_e(ug,"layerName","Layer");const hX="compositeLayer.renderLayers";class WM extends ug{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,n)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;const{opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:b,highlightColor:S,coordinateSystem:F,coordinateOrigin:D,wrapLongitude:N,positionFormat:J,modelMatrix:te,extensions:he,fetch:ue,operation:fe,_subLayerProps:ve}=this.props,Se={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:b,highlightColor:S,coordinateSystem:F,coordinateOrigin:D,wrapLongitude:N,positionFormat:J,modelMatrix:te,extensions:he,fetch:ue,operation:fe},Ge=ve&&e.id&&ve[e.id],He=Ge&&Ge.updateTriggers,$e=e.id||"sublayer";if(Ge){const Ne=this.props[cd],at=e.type?e.type._propTypes:{};for(const rt in Ge){const Re=at[rt]||Ne[rt];Re&&Re.type==="accessor"&&(Ge[rt]=this.getSubLayerAccessor(Ge[rt]))}}Object.assign(Se,e,Ge),Se.id="".concat(this.props.id,"-").concat($e),Se.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...He};for(const Ne of he){const at=Ne.getSubLayerProps.call(this,Ne);at&&Object.assign(Se,at,{updateTriggers:Object.assign(Se.updateTriggers,at.updateTriggers)})}return Se}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const o=this.renderLayers();r=b1(o,Boolean),this.internalState.subLayers=r}Sl(hX,this,n,r);for(const o of r)o.parent=this}}_e(WM,"layerName","CompositeLayer");const fB=512,AX=Math.PI/180;function dX(i){let{map:e,gl:t,deck:r}=i;if(e.__deck)return e.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,l=pX({...r==null?void 0:r.props,_customRender:()=>{e.triggerRepaint(),n==null||n("")}});let s;return(!r||r.props.gl===t)&&(Object.assign(l,{gl:t,width:null,height:null,touchAction:"unset",viewState:pB(e)}),r!=null&&r.isInitialized?XM(r,e):l.onLoad=()=>{o==null||o(),XM(s,e)}),r?(s=r,r.setProps(l),r.userData.isExternal=!0):(s=new rB(l),e.on("remove",()=>{fX(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&bX(s,e)}),s}function XM(i,e){const t=()=>{i.isInitialized?xX(i,e):e.off("move",t)};e.on("move",t)}function fX(i){var e;(e=i.__deck)===null||e===void 0||e.finalize(),i.__deck=null}function pX(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new X2({id:"mapbox"})]}}function gX(i,e){i.userData.mapboxLayers.add(e),gB(i)}function mX(i,e){i.userData.mapboxLayers.delete(e),gB(i)}function yX(i,e){gB(i)}function _X(i,e,t){let{currentViewport:r}=i.userData,n=!1;r||(r=ZM(i,e,!0),i.userData.currentViewport=r,n=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:o=>{let{layer:l}=o;return t.id===l.id||l.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function pB(i){var e;const{lng:t,lat:r}=i.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(e=i.getTerrain)!==null&&e!==void 0&&e.call(i)&&vX(i,n),n}function vX(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:n,latitude:o,pitch:l}=e,s=t.x*fB,g=(1-t.y)*fB,b=t.z*fB,S=_y([n,o]),F=s-S[0],D=g-S[1],N=Math.sqrt(F*F+D*D),J=l*AX,te=1.5*r,he=J<.001?te*Math.cos(J)/b:te*Math.sin(J)/N;e.zoom=Math.log2(he);const ue=te*Math.cos(J)/he,fe=b-ue;e.position=[0,0,fe/y1(o)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function ZM(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new bf({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...pB(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function bX(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const n=Array.from(t,S=>S.id),l=b1(i.props.layers,Boolean).some(S=>S&&!n.includes(S.id));let s=i.getViewports();const g=s.findIndex(S=>S.id==="mapbox"),b=s.length>1||g<0;(l||b)&&(g>=0&&(s=s.slice(),s[g]=ZM(i,e,!1)),i._drawLayers("mapbox-repaint",{viewports:s,layerFilter:S=>(!i.props.layerFilter||i.props.layerFilter(S))&&(S.viewport.id!=="mapbox"||!n.includes(S.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function xX(i,e){i.setProps({viewState:pB(e)}),i.needsRedraw({clearRedrawFlags:!0})}function gB(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,n=new r(t.props);e.push(n)}),i.setProps({layers:e})}class wX{constructor(e){if(_e(this,"id",void 0),_e(this,"type",void 0),_e(this,"renderingMode",void 0),_e(this,"map",void 0),_e(this,"deck",void 0),_e(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=dX({map:e,gl:t,deck:this.props.deck}),gX(this.deck,this)}onRemove(){this.deck&&mX(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&yX(this.deck)}render(){_X(this.deck,this.map,this)}}const BX=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,CX=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,JM=[0,0,0,255],YM=[0,0,1],EX={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:YM},getColor:{type:"accessor",value:JM},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function SX(i){const{header:e,attributes:t}=i;!e||!t||(i.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class mB extends ug{getShaders(){return super.getShaders({vs:BX,fs:CX,modules:[$2,eq,K2]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:YM},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:JM}})}updateState(e){const{changeFlags:t,props:r}=e;if(super.updateState(e),t.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}t.dataChanged&&SX(r.data)}draw(e){let{uniforms:t}=e;const{pointSize:r,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:Hw[n],radiusPixels:r}).draw()}_getModel(e){const t=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new eg(e,{...this.getShaders(),id:this.props.id,geometry:new my({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}_e(mB,"layerName","PointCloudLayer"),_e(mB,"defaultProps",EX);const tu={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Nt,new Nt;const Ey=new Nt,eP=new Nt;class Sy{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;_e(this,"center",void 0),_e(this,"radius",void 0),this.radius=-0,this.center=new Nt,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Ey.from(t),this.center=new Nt().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Sy(this.center,this.radius)}union(e){const t=this.center,r=this.radius,n=e.center,o=e.radius,l=Ey.copy(n).subtract(t),s=l.magnitude();if(r>=s+o)return this.clone();if(o>=s+r)return e.clone();const g=(r+s+o)*.5;return eP.copy(l).scale((-r+g)/s).add(t),this.center.copy(eP),this.radius=g,this}expand(e){const r=Ey.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=uj(Ey,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=Ey.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,o=e.normal.dot(t)+e.distance;return o<-r?tu.OUTSIDE:o<r?tu.INTERSECTING:tu.INSIDE}}const TX=new Nt,IX=new Nt,T1=new Nt,I1=new Nt,L1=new Nt,LX=new Nt,MX=new Nt,IA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ty{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];_e(this,"center",void 0),_e(this,"halfAxes",void 0),this.center=new Nt().from(e),this.halfAxes=new wo(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Nt(e).len(),new Nt(t).len(),new Nt(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Nt(e).normalize(),o=new Nt(t).normalize(),l=new Nt(r).normalize();return new fy().fromMatrix3(new wo([...n,...o,...l]))}fromCenterHalfSizeQuaternion(e,t,r){const n=new fy(r),o=new wo().fromQuaternion(n);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new Nt().from(e),this.halfAxes=o,this}clone(){return new Ty(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Sy;const t=this.halfAxes,r=t.getColumn(0,T1),n=t.getColumn(1,I1),o=t.getColumn(2,L1),l=TX.copy(r).add(n).add(o);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,n=this.halfAxes,o=r.x,l=r.y,s=r.z,g=Math.abs(o*n[IA.COLUMN0ROW0]+l*n[IA.COLUMN0ROW1]+s*n[IA.COLUMN0ROW2])+Math.abs(o*n[IA.COLUMN1ROW0]+l*n[IA.COLUMN1ROW1]+s*n[IA.COLUMN1ROW2])+Math.abs(o*n[IA.COLUMN2ROW0]+l*n[IA.COLUMN2ROW1]+s*n[IA.COLUMN2ROW2]),b=r.dot(t)+e.distance;return b<=-g?tu.OUTSIDE:b>=g?tu.INSIDE:tu.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=IX.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,T1),o=r.getColumn(1,I1),l=r.getColumn(2,L1),s=n.magnitude(),g=o.magnitude(),b=l.magnitude();n.normalize(),o.normalize(),l.normalize();let S=0,F;return F=Math.abs(t.dot(n))-s,F>0&&(S+=F*F),F=Math.abs(t.dot(o))-g,F>0&&(S+=F*F),F=Math.abs(t.dot(l))-b,F>0&&(S+=F*F),S}computePlaneDistances(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const l=this.center,s=this.halfAxes,g=s.getColumn(0,T1),b=s.getColumn(1,I1),S=s.getColumn(2,L1),F=LX.copy(g).add(b).add(S).add(l),D=MX.copy(F).subtract(e);let N=t.dot(D);return n=Math.min(N,n),o=Math.max(N,o),F.copy(l).add(g).add(b).subtract(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),F.copy(l).add(g).subtract(b).add(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),F.copy(l).add(g).subtract(b).subtract(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),l.copy(F).subtract(g).add(b).add(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),l.copy(F).subtract(g).add(b).subtract(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),l.copy(F).subtract(g).subtract(b).add(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),l.copy(F).subtract(g).subtract(b).subtract(S),D.copy(F).subtract(e),N=t.dot(D),n=Math.min(N,n),o=Math.max(N,o),r[0]=n,r[1]=o,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,T1);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,I1);r.transformAsPoint(e);const n=this.halfAxes.getColumn(2,L1);return n.transformAsPoint(e),this.halfAxes=new wo([...t,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const tP=new Nt,iP=new Nt;class nh{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;_e(this,"normal",void 0),_e(this,"distance",void 0),this.normal=new Nt,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return eh(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=tP.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,n){return this.normal.set(e,t,r),eh(th(this.normal.len(),1)),this.distance=n,this}clone(){return new nh(this.normal,this.distance)}equals(e){return th(this.distance,e.distance)&&th(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=iP.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=tP.from(e);const r=this.getPointDistance(e),n=iP.copy(this.normal).scale(r);return e.subtract(n).to(t)}}const rP=[new Nt([1,0,0]),new Nt([0,1,0]),new Nt([0,0,1])],nP=new Nt,PX=new Nt;new nh(new Nt(1,0,0),0);class Eu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];_e(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*rP.length;const t=e.center,r=e.radius;let n=0;for(const o of rP){let l=this.planes[n],s=this.planes[n+1];l||(l=this.planes[n]=new nh),s||(s=this.planes[n+1]=new nh);const g=nP.copy(o).scale(-r).add(t);-o.dot(g),l.fromPointNormal(g,o);const b=nP.copy(o).scale(r).add(t),S=PX.copy(o).negate();-S.dot(b),s.fromPointNormal(b,S),n+=2}return this}computeVisibility(e){let t=tu.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case tu.OUTSIDE:return tu.OUTSIDE;case tu.INTERSECTING:t=tu.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(eh(Number.isFinite(t),"parentPlaneMask is required."),t===Eu.MASK_OUTSIDE||t===Eu.MASK_INSIDE)return t;let r=Eu.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const l=o<31?1<<o:0;if(o<31&&!(t&l))continue;const s=n[o],g=e.intersectPlane(s);if(g===tu.OUTSIDE)return Eu.MASK_OUTSIDE;g===tu.INTERSECTING&&(r|=l)}return r}}_e(Eu,"MASK_OUTSIDE",4294967295),_e(Eu,"MASK_INSIDE",0),_e(Eu,"MASK_INDETERMINATE",2147483647),new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt;const Gh=new wo,FX=new wo,DX=new wo,M1=new wo,sP=new wo;function RX(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=py.EPSILON20,r=10;let n=0,o=0;const l=FX,s=DX;l.identity(),s.copy(i);const g=t*kX(s);for(;o<r&&OX(s)>g;)UX(s,M1),sP.copy(M1).transpose(),s.multiplyRight(M1),s.multiplyLeft(sP),l.multiplyRight(M1),++n>2&&(++o,n=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function kX(i){let e=0;for(let t=0;t<9;++t){const r=i[t];e+=r*r}return Math.sqrt(e)}const yB=[1,0,0],_B=[2,2,1];function OX(i){let e=0;for(let t=0;t<3;++t){const r=i[Gh.getElementIndex(_B[t],yB[t])];e+=2*r*r}return Math.sqrt(e)}function UX(i,e){const t=py.EPSILON15;let r=0,n=1;for(let b=0;b<3;++b){const S=Math.abs(i[Gh.getElementIndex(_B[b],yB[b])]);S>r&&(n=b,r=S)}const o=yB[n],l=_B[n];let s=1,g=0;if(Math.abs(i[Gh.getElementIndex(l,o)])>t){const b=i[Gh.getElementIndex(l,l)],S=i[Gh.getElementIndex(o,o)],F=i[Gh.getElementIndex(l,o)],D=(b-S)/2/F;let N;D<0?N=-1/(-D+Math.sqrt(1+D*D)):N=1/(D+Math.sqrt(1+D*D)),s=1/Math.sqrt(1+N*N),g=N*s}return wo.IDENTITY.to(e),e[Gh.getElementIndex(o,o)]=e[Gh.getElementIndex(l,l)]=s,e[Gh.getElementIndex(l,o)]=g,e[Gh.getElementIndex(o,l)]=-g,e}const fd=new Nt,NX=new Nt,zX=new Nt,QX=new Nt,VX=new Nt,HX=new wo,GX={diagonal:new wo,unitary:new wo};function jX(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ty;if(!i||i.length===0)return e.halfAxes=new wo([0,0,0,0,0,0,0,0,0]),e.center=new Nt,e;const t=i.length,r=new Nt(0,0,0);for(const at of i)r.add(at);const n=1/t;r.multiplyByScalar(n);let o=0,l=0,s=0,g=0,b=0,S=0;for(const at of i){const rt=fd.copy(at).subtract(r);o+=rt.x*rt.x,l+=rt.x*rt.y,s+=rt.x*rt.z,g+=rt.y*rt.y,b+=rt.y*rt.z,S+=rt.z*rt.z}o*=n,l*=n,s*=n,g*=n,b*=n,S*=n;const F=HX;F[0]=o,F[1]=l,F[2]=s,F[3]=l,F[4]=g,F[5]=b,F[6]=s,F[7]=b,F[8]=S;const{unitary:D}=RX(F,GX),N=e.halfAxes.copy(D);let J=N.getColumn(0,zX),te=N.getColumn(1,QX),he=N.getColumn(2,VX),ue=-Number.MAX_VALUE,fe=-Number.MAX_VALUE,ve=-Number.MAX_VALUE,Se=Number.MAX_VALUE,Ge=Number.MAX_VALUE,He=Number.MAX_VALUE;for(const at of i)fd.copy(at),ue=Math.max(fd.dot(J),ue),fe=Math.max(fd.dot(te),fe),ve=Math.max(fd.dot(he),ve),Se=Math.min(fd.dot(J),Se),Ge=Math.min(fd.dot(te),Ge),He=Math.min(fd.dot(he),He);J=J.multiplyByScalar(.5*(Se+ue)),te=te.multiplyByScalar(.5*(Ge+fe)),he=he.multiplyByScalar(.5*(He+ve)),e.center.copy(J).add(te).add(he);const $e=NX.set(ue-Se,fe-Ge,ve-He).multiplyByScalar(.5),Ne=new wo([$e[0],0,0,0,$e[1],0,0,0,$e[2]]);return e.halfAxes.multiplyRight(Ne),e}const vB=Math.PI/180,P1=new Float32Array(16),oP=new Float32Array(12);function aP(i,e,t){const r=e[0]*vB,n=e[1]*vB,o=e[2]*vB,l=Math.sin(o),s=Math.sin(r),g=Math.sin(n),b=Math.cos(o),S=Math.cos(r),F=Math.cos(n),D=t[0],N=t[1],J=t[2];i[0]=D*F*S,i[1]=D*g*S,i[2]=D*-s,i[3]=N*(-g*b+F*s*l),i[4]=N*(F*b+g*s*l),i[5]=N*S*l,i[6]=J*(g*l+F*s*b),i[7]=J*(-F*l+g*s*b),i[8]=J*S*b}function lP(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const cP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,e){let{startRow:t,endRow:r}=e;const{data:n,getOrientation:o,getScale:l,getTranslation:s,getTransformMatrix:g}=this.props,b=Array.isArray(g),S=b&&g.length===16,F=Array.isArray(l),D=Array.isArray(o),N=Array.isArray(s),J=S||!b&&!!g(n[0]);J?i.constant=S:i.constant=D&&F&&N;const te=i.value;if(i.constant){let he;J?(P1.set(g),he=lP(P1)):(he=oP,aP(he,o,l),he.set(s,9)),i.value=new Float32Array(he)}else{let he=t*i.size;const{iterable:ue,objectInfo:fe}=DM(n,t,r);for(const ve of ue){fe.index++;let Se;if(J)P1.set(S?g:g(ve,fe)),Se=lP(P1);else{Se=oP;const Ge=D?o:o(ve,fe),He=F?l:l(ve,fe);aP(Se,Ge,He),Se.set(N?s:s(ve,fe),9)}te[he++]=Se[0],te[he++]=Se[1],te[he++]=Se[2],te[he++]=Se[3],te[he++]=Se[4],te[he++]=Se[5],te[he++]=Se[6],te[he++]=Se[7],te[he++]=Se[8],te[he++]=Se[9],te[he++]=Se[10],te[he++]=Se[11]}}}};function uP(i,e){return e===Pn.CARTESIAN||e===Pn.METER_OFFSETS||e===Pn.DEFAULT&&!i.isGeospatial}const qX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,$X=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function hP(i){let e=1/0,t=1/0,r=1/0,n=-1/0,o=-1/0,l=-1/0;const s=i.POSITION?i.POSITION.value:[],g=s&&s.length;for(let b=0;b<g;b+=3){const S=s[b],F=s[b+1],D=s[b+2];e=S<e?S:e,t=F<t?F:t,r=D<r?D:r,n=S>n?S:n,o=F>o?F:o,l=D>l?D:l}return[[e,t,r],[n,o,l]]}function KX(i,e){if(!i)throw new Error(e||"loader assertion failed.")}class hg{constructor(e,t){_e(this,"fields",void 0),_e(this,"metadata",void 0),KX(Array.isArray(e)),WX(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const l of r)e[l]=!0;const o=this.fields.filter(l=>e[l.name]);return new hg(o,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(o=>this.fields[o]).filter(Boolean);return new hg(n,this.metadata)}assign(e){let t,r=this.metadata;if(e instanceof hg){const l=e;t=l.fields,r=AP(AP(new Map,this.metadata),l.metadata)}else t=e;const n=Object.create(null);for(const l of this.fields)n[l.name]=l;for(const l of t)n[l.name]=l;const o=Object.values(n);return new hg(o,r)}}function WX(i){const e={};for(const t of i)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function AP(i,e){return new Map([...i||new Map,...e||new Map])}class F1{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;_e(this,"name",void 0),_e(this,"type",void 0),_e(this,"nullable",void 0),_e(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new F1(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Bo=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),dP,fP,pP;class bB{static isNull(e){return e&&e.typeId===Bo.Null}static isInt(e){return e&&e.typeId===Bo.Int}static isFloat(e){return e&&e.typeId===Bo.Float}static isBinary(e){return e&&e.typeId===Bo.Binary}static isUtf8(e){return e&&e.typeId===Bo.Utf8}static isBool(e){return e&&e.typeId===Bo.Bool}static isDecimal(e){return e&&e.typeId===Bo.Decimal}static isDate(e){return e&&e.typeId===Bo.Date}static isTime(e){return e&&e.typeId===Bo.Time}static isTimestamp(e){return e&&e.typeId===Bo.Timestamp}static isInterval(e){return e&&e.typeId===Bo.Interval}static isList(e){return e&&e.typeId===Bo.List}static isStruct(e){return e&&e.typeId===Bo.Struct}static isUnion(e){return e&&e.typeId===Bo.Union}static isFixedSizeBinary(e){return e&&e.typeId===Bo.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Bo.FixedSizeList}static isMap(e){return e&&e.typeId===Bo.Map}static isDictionary(e){return e&&e.typeId===Bo.Dictionary}get typeId(){return Bo.NONE}compareTo(e){return this===e}}dP=Symbol.toStringTag;class Ag extends bB{constructor(e,t){super(),_e(this,"isSigned",void 0),_e(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return Bo.Int}get[dP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class XX extends Ag{constructor(){super(!0,8)}}class ZX extends Ag{constructor(){super(!0,16)}}class JX extends Ag{constructor(){super(!0,32)}}class YX extends Ag{constructor(){super(!1,8)}}class eZ extends Ag{constructor(){super(!1,16)}}class tZ extends Ag{constructor(){super(!1,32)}}const gP={HALF:16,SINGLE:32,DOUBLE:64};fP=Symbol.toStringTag;class mP extends bB{constructor(e){super(),_e(this,"precision",void 0),this.precision=e}get typeId(){return Bo.Float}get[fP](){return"Float"}toString(){return"Float".concat(this.precision)}}class iZ extends mP{constructor(){super(gP.SINGLE)}}class rZ extends mP{constructor(){super(gP.DOUBLE)}}pP=Symbol.toStringTag;class nZ extends bB{constructor(e,t){super(),_e(this,"listSize",void 0),_e(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return Bo.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[pP](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function sZ(i){switch(i.constructor){case Int8Array:return new XX;case Uint8Array:return new YX;case Int16Array:return new ZX;case Uint16Array:return new eZ;case Int32Array:return new JX;case Uint32Array:return new tZ;case Float32Array:return new iZ;case Float64Array:return new rZ;default:throw new Error("array type not supported")}}function oZ(i,e,t){const r=sZ(e.value),n=t||aZ(e);return new F1(i,new nZ(e.size,new F1("value",r)),!1,n)}function aZ(i){const e=new Map;return"byteOffset"in i&&e.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&e.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&e.set("normalized",i.normalized.toString()),e}function yP(i,e){(i.COLOR_0||i.colors)&&e||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),kn.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function _P(i,e){if(i.attributes)return yP(i.attributes,e),i instanceof my?i:new my(i);if(i.positions||i.POSITION)return yP(i,e),new my({attributes:i});throw Error("Invalid mesh")}const lZ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class xB extends ug{constructor(){super(...arguments),_e(this,"state",void 0)}getShaders(){const e=!An(this.context.gl),t={};return r2(this.context.gl,Vs.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:qX,fs:$X,modules:[$2,tq,K2],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:r}=this.props;if(!r)return null;if(t=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:n}=_P(r,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,t=hP(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:cP}),this.setState({emptyTexture:new Zc(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:n}=e;if(t.mesh!==r.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const l=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:l}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!l||uP(r,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new eg(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:_P(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return t.setUniforms({sampler:r||n,hasTexture:!!r}),t}setTexture(e){const{emptyTexture:t,model:r}=this.state;r&&r.setUniforms({sampler:e||t,hasTexture:!!e})}}_e(xB,"defaultProps",lZ),_e(xB,"layerName","SimpleMeshLayer");class dg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||wA(this.constructor.name),this.display=!0,this.position=new Nt,this.rotation=new Nt,this.scale=new Nt(1,1,1),this.matrix=new Cn,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Zi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Zi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Zi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:r,scale:n,update:o=!0}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:r,scale:n}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){Zi(e),t=t||this.matrix;const r=new Cn(e).multiplyRight(t),n=r.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Iy extends dg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;lr.assert(t.every(r=>r instanceof dg),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(e){const t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,r)=>{let{worldMatrix:n}=r;const o=t.getBounds();if(!o)return;const[l,s]=o,g=new Nt(l).add(s).divide([2,2,2]);n.transformAsPoint(g,g);const b=new Nt(s).subtract(l).divide([2,2,2]);n.transformAsVector(b,b);for(let S=0;S<8;S++){const F=new Nt(S&1?-1:1,S&2?-1:1,S&4?-1:1).multiply(b).add(g);for(let D=0;D<3;D++)e[0][D]=Math.min(e[0][D],F[D]),e[1][D]=Math.max(e[1][D],F[D])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new Cn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Cn(t).multiplyRight(this.matrix);for(const n of this.children)n instanceof Iy?n.traverse(e,{worldMatrix:r}):e(n,{worldMatrix:r})}}const cZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function vP(i){if(!i._animation){const e=uZ[i.componentType],t=cZ[i.type],r=t*i.count,{buffer:n,byteOffset:o}=i.bufferView.data,l=new e(n,o+(i.byteOffset||0),r);if(t===1)i._animation=Array.from(l);else{const s=[];for(let g=0;g<l.length;g+=t)s.push(Array.from(l.slice(g,g+t)));i._animation=s}}return i._animation}const hZ=new Cn;function AZ(i,e){if(e.matrix.identity(),i.translation&&e.matrix.translate(i.translation),i.rotation){const t=hZ.fromQuaternion(i.rotation);e.matrix.multiplyRight(t)}i.scale&&e.matrix.scale(i.scale)}const wB=new fy;function dZ(i,e,t,r,n){if(e==="rotation"){wB.slerp({start:t,target:r,ratio:n});for(let o=0;o<wB.length;o++)i[e][o]=wB[o]}else for(let o=0;o<t.length;o++)i[e][o]=n*r[o]+(1-n)*t[o]}function fZ(i,e,t){let{p0:r,outTangent0:n,inTangent1:o,p1:l,tDiff:s,ratio:g}=t;for(let b=0;b<i[e].length;b++){const S=n[b]*s,F=o[b]*s;i[e][b]=(2*Math.pow(g,3)-3*Math.pow(g,2)+1)*r[b]+(Math.pow(g,3)-2*Math.pow(g,2)+g)*S+(-2*Math.pow(g,3)+3*Math.pow(g,2))*l[b]+(Math.pow(g,3)-Math.pow(g,2))*F}}function pZ(i,e,t){for(let r=0;r<t.length;r++)i[e][r]=t[r]}function gZ(i,e,t,r){let{input:n,interpolation:o,output:l}=e;const s=n[n.length-1],g=i%s,b=n.findIndex(N=>N>=g),S=Math.max(0,b-1);if(!Array.isArray(t[r]))switch(r){case"translation":t[r]=[0,0,0];break;case"rotation":t[r]=[0,0,0,1];break;case"scale":t[r]=[1,1,1];break;default:lr.warn("Bad animation path ".concat(r))()}Zi(t[r].length===l[S].length);const F=n[S],D=n[b];switch(o){case"STEP":pZ(t,r,l[S]);break;case"LINEAR":if(D>F){const N=(g-F)/(D-F);dZ(t,r,l[S],l[b],N)}break;case"CUBICSPLINE":if(D>F){const N=(g-F)/(D-F),J=D-F,te=l[3*S+1],he=l[3*S+2],ue=l[3*b+0],fe=l[3*b+1];fZ(t,r,{p0:te,outTangent0:he,inTangent1:ue,p1:fe,tDiff:J,ratio:N})}break;default:lr.warn("Interpolation ".concat(o," not supported"))();break}}class mZ{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(n=>{let{sampler:o,target:l,path:s}=n;gZ(r,o,l,s),AZ(l,l._node)})}}class yZ{constructor(e){this.animations=e.animations.map((t,r)=>{const n=t.name||"Animation-".concat(r),o=t.samplers.map(s=>{let{input:g,interpolation:b="LINEAR",output:S}=s;return{input:vP(e.accessors[g]),interpolation:b,output:vP(e.accessors[S])}}),l=t.channels.map(s=>{let{sampler:g,target:b}=s;return{sampler:o[g],target:e.nodes[b.node],path:b.path}});return new mZ({name:n,channels:l})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class _Z extends dg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof eg?(this.model=e,this._setModelNodeProps(t)):this.model=new eg(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class bP{constructor(e,t){let{attributes:r,material:n,pbrDebug:o,imageBasedLightingEnvironment:l,lights:s,useTangents:g}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},r2(e,Vs.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],l&&(this.uniforms.u_DiffuseEnvSampler=l.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=l.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=l.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&g,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(l,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let l,s={};o.compressed?(l=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):l={data:o};const g=new Zc(this.gl,{id:e.name||e.id,parameters:{...n,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...l});this.uniforms[t]=g,this.defineIfPresent(r,r),this.generatedTextures.push(g)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(lr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const vZ=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,bZ=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function xP(i,e){return An(i)?`#version 300 es
`.concat(e):e}function xZ(i,e){const{id:t,drawMode:r,vertexCount:n,attributes:o,modelOptions:l}=e,s=new bP(i,e);lr.info(4,"createGLTFModel defines: ",s.defines)();const g=[];g.push(...s.generatedTextures),g.push(...Object.values(o).map(S=>S.buffer));const b=new _Z(i,{id:t,drawMode:r,vertexCount:n,modules:[F2],parameters:s.parameters,vs:xP(i,vZ),fs:xP(i,bZ),managedResources:g,...l,defines:{...s.defines,...l.defines}});return b.setProps({attributes:o}),b.setUniforms(s.uniforms),b}const wZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BZ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class CZ{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},BZ,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new yZ(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(o=>this.createNode(o));return new Iy({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const n=new Iy({id:e.name||e.id,children:r});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Cn().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((o,l)=>this.createPrimitive(o,l,e)),n=new Iy({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}getVertexCount(e){lr.warn("getVertexCount() not found")()}createPrimitive(e,t,r){const n=xZ(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}createAttributes(e,t){const r={};return Object.keys(e).forEach(n=>{r[n]=this.createAccessor(e[n],this.createBuffer(e[n],this.gl.ARRAY_BUFFER))}),t&&(r.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),lr.info(4,"glTF Attributes",{attributes:e,indices:t,generated:r})(),r}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=new xs(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:t})),r.lumaBuffers[t]}createAccessor(e,t){return new Ec({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:wZ[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function EZ(i,e,t){const r=new CZ(i,t),n=r.instantiate(e),o=r.createAnimator();return{scenes:n,animator:o}}const SZ="3.4.14",TZ="3.4.14",wP="3.4.14",IZ="https://unpkg.com/@loaders.gl/textures@".concat(wP,"/dist/libs/basis_encoder.wasm"),LZ="https://unpkg.com/@loaders.gl/textures@".concat(wP,"/dist/libs/basis_encoder.js");let BB;async function BP(i){const e=i.modules||{};return e.basis?e.basis:(BB=BB||MZ(i),await BB)}async function MZ(i){let e=null,t=null;return[e,t]=await Promise.all([await df("basis_transcoder.js","textures",i),await df("basis_transcoder.wasm","textures",i)]),e=e||globalThis.BASIS,await PZ(e,t)}function PZ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,initializeBasis:l}=n;l(),r({BasisFile:o})})})}let CB;async function CP(i){const e=i.modules||{};return e.basisEncoder?e.basisEncoder:(CB=CB||FZ(i),await CB)}async function FZ(i){let e=null,t=null;return[e,t]=await Promise.all([await df(LZ,"textures",i),await df(IZ,"textures",i)]),e=e||globalThis.BASIS,await DZ(e,t)}function DZ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,KTX2File:l,initializeBasis:s,BasisEncoder:g}=n;s(),r({BasisFile:o,KTX2File:l,BasisEncoder:g})})})}const fg={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},RZ=["","WEBKIT_","MOZ_"],EP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let D1=null;function kZ(i){if(!D1){i=i||OZ()||void 0,D1=new Set;for(const e of RZ)for(const t in EP)if(i&&i.getExtension("".concat(e).concat(t))){const r=EP[t];D1.add(r)}}return D1}function OZ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var SP,TP,IP,LP,MP,PP,FP,DP;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(SP||(SP={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(TP||(TP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(IP||(IP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(LP||(LP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(MP||(MP={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(PP||(PP={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(FP||(FP={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(DP||(DP={}));const iu=[171,75,84,88,32,50,48,187,13,10,26,10];function UZ(i){const e=new Uint8Array(i);return!(e.byteLength<iu.length||e[0]!==iu[0]||e[1]!==iu[1]||e[2]!==iu[2]||e[3]!==iu[3]||e[4]!==iu[4]||e[5]!==iu[5]||e[6]!==iu[6]||e[7]!==iu[7]||e[8]!==iu[8]||e[9]!==iu[9]||e[10]!==iu[10]||e[11]!==iu[11])}const NZ={etc1:{basisFormat:0,compressed:!0,format:fg.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:fg.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:fg.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:fg.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:fg.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:fg.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function zZ(i,e){if(e.basis.containerFormat==="auto"){if(UZ(i)){const r=await CP(e);return RP(r.KTX2File,i,e)}const{BasisFile:t}=await BP(e);return EB(t,i,e)}switch(e.basis.module){case"encoder":const t=await CP(e);switch(e.basis.containerFormat){case"ktx2":return RP(t.KTX2File,i,e);case"basis":default:return EB(t.BasisFile,i,e)}case"transcoder":default:const{BasisFile:r}=await BP(e);return EB(r,i,e)}}function EB(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),o=[];for(let l=0;l<n;l++){const s=r.getNumLevels(l),g=[];for(let b=0;b<s;b++)g.push(QZ(r,l,b,t));o.push(g)}return o}finally{r.close(),r.delete()}}function QZ(i,e,t,r){const n=i.getImageWidth(e,t),o=i.getImageHeight(e,t),l=i.getHasAlpha(),{compressed:s,format:g,basisFormat:b}=kP(r,l),S=i.getImageTranscodedSizeInBytes(e,t,b),F=new Uint8Array(S);if(!i.transcodeImage(F,e,t,b,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:F,compressed:s,format:g,hasAlpha:l}}function RP(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),o=[];for(let l=0;l<n;l++){o.push(VZ(r,l,t));break}return[o]}finally{r.close(),r.delete()}}function VZ(i,e,t){const{alphaFlag:r,height:n,width:o}=i.getImageLevelInfo(e,0,0),{compressed:l,format:s,basisFormat:g}=kP(t,r),b=i.getImageTranscodedSizeInBytes(e,0,0,g),S=new Uint8Array(b);if(!i.transcodeImage(S,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:S,compressed:l,levelSize:b,hasAlpha:r,format:s}}function kP(i,e){let t=i&&i.basis&&i.basis.format;return t==="auto"&&(t=OP()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),NZ[t]}function OP(){const i=kZ();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const HZ={...{name:"Basis",id:_A?"basis":"basis-nodejs",module:"textures",version:TZ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:zZ};function ru(i,e){if(!i)throw new Error(e||"assert failed: gltf")}function UP(i,e){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return r.substr(0,r.lastIndexOf("/")+1)+i}function GZ(i,e,t){const r=i.bufferViews[t];ru(r);const n=r.buffer,o=e[n];ru(o);const l=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,l,r.byteLength)}const NP=["SCALAR","VEC2","VEC3","VEC4"],jZ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],qZ=new Map(jZ),$Z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},KZ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},WZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function zP(i){return NP[i-1]||NP[0]}function QP(i){const e=qZ.get(i.constructor);if(!e)throw new Error("Illegal typed array");return e}function SB(i,e){const t=WZ[i.componentType],r=$Z[i.type],n=KZ[i.componentType],o=i.count*r,l=i.count*r*n;return ru(l>=0&&l<=e.byteLength),{ArrayType:t,length:o,byteLength:l}}function VP(i){let{images:e,bufferViews:t}=i;e=e||[],t=t||[];const r=e.map(l=>l.bufferView);t=t.filter(l=>!r.includes(l));const n=t.reduce((l,s)=>l+s.byteLength,0),o=e.reduce((l,s)=>{const{width:g,height:b}=s.image;return l+g*b},0);return n+Math.ceil(4*o*1.33)}const XZ={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Sc{constructor(e){_e(this,"gltf",void 0),_e(this,"sourceBuffers",void 0),_e(this,"byteLength",void 0),this.gltf=e||{json:{...XZ},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,r=this.gltf.buffers[t];ru(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:o,length:l}=SB(e,t),s=t.byteOffset+e.byteOffset;return new o(n,s,l)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{},n=r[t];return delete r[t],n}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ru(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ru(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:r,material:n,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(r){const g=this._addIndices(r);s.primitives[0].indices=g}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,t){const r=Rw(e),n=t||(r==null?void 0:r.mimeType),l={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e){const t=e.byteLength;ru(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=qm(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:zP(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:QP(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),o=new Uint8Array(n);let l=0;for(const s of this.sourceBuffers||[])l=bz(s,o,l);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const r in e){const n=e[r],o=this._getGltfAttributeName(r),l=this.addBinaryBuffer(n.value,n);t[o]=l}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];const n=e.subarray(0,t);for(const o of n)r.min.push(o),r.max.push(o);for(let o=t;o<e.length;o+=t)for(let l=0;l<t;l++)r.min[0+l]=Math.min(r.min[0+l],e[o+l]),r.max[0+l]=Math.max(r.max[0+l],e[o+l]);return r}}const ZZ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",JZ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",YZ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),eJ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),tJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},iJ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function rJ(i,e,t,r,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const l=await nJ();aJ(l,l.exports[iJ[n]],i,e,t,r,l.exports[tJ[o||"NONE"]])}let TB;async function nJ(){return TB||(TB=sJ()),TB}async function sJ(){let i=ZZ;WebAssembly.validate(YZ)&&(i=JZ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(oJ(i),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function oJ(i){const e=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const n=i.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let r=0;r<i.length;++r)e[t++]=e[r]<60?eJ[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,t)}function aJ(i,e,t,r,n,o,l){const s=i.exports.sbrk,g=r+3&-4,b=s(g*n),S=s(o.length),F=new Uint8Array(i.exports.memory.buffer);F.set(o,S);const D=e(b,r,n,S,o.length);if(D===0&&l&&l(b,g,n),t.set(F.subarray(b,b+r*n)),s(b-s(0)),D!==0)throw new Error("Malformed buffer data: ".concat(D))}const IB="EXT_meshopt_compression",lJ=IB;async function cJ(i,e){var t;const r=new Sc(i);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const n=[];for(const o of i.json.bufferViews||[])n.push(uJ(r,o));await Promise.all(n),r.removeExtension(IB)}async function uJ(i,e){const t=i.getObjectExtension(e,IB);if(t){const{byteOffset:r=0,byteLength:n=0,byteStride:o,count:l,mode:s,filter:g="NONE",buffer:b}=t,S=i.gltf.buffers[b],F=new Uint8Array(S.arrayBuffer,S.byteOffset+r,n),D=new Uint8Array(i.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await rJ(D,l,o,F,s,g),D}return null}const hJ=Object.freeze(Object.defineProperty({__proto__:null,decode:cJ,name:lJ},Symbol.toStringTag,{value:"Module"})),pg="EXT_texture_webp",AJ=pg;function dJ(i,e){const t=new Sc(i);if(!mV("image/webp")){if(t.getRequiredExtensions().includes(pg))throw new Error("gltf: Required extension ".concat(pg," not supported by browser"));return}const{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,pg);o&&(n.source=o.source),t.removeObjectExtension(n,pg)}t.removeExtension(pg)}const fJ=Object.freeze(Object.defineProperty({__proto__:null,name:AJ,preprocess:dJ},Symbol.toStringTag,{value:"Module"})),R1="KHR_texture_basisu",pJ=R1;function gJ(i,e){const t=new Sc(i),{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,R1);o&&(n.source=o.source),t.removeObjectExtension(n,R1)}t.removeExtension(R1)}const mJ=Object.freeze(Object.defineProperty({__proto__:null,name:pJ,preprocess:gJ},Symbol.toStringTag,{value:"Module"})),yJ={name:"Draco",id:_A?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function _J(i,e,t){const r=GP(e.metadata),n=[],o=vJ(e.attributes);for(const l in i){const s=i[l],g=HP(l,s,o[l]);n.push(g)}if(t){const l=HP("indices",t);n.push(l)}return new hg(n,r)}function vJ(i){const e={};for(const t in i){const r=i[t];e[r.name||"undefined"]=r}return e}function HP(i,e,t){const r=t?GP(t.metadata):void 0;return oZ(i,e,r)}function GP(i){const e=new Map;for(const t in i)e.set("".concat(t,".string"),JSON.stringify(i[t]));return e}const jP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},bJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},xJ=4;class wJ{constructor(e){_e(this,"draco",void 0),_e(this,"decoder",void 0),_e(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let l;switch(n){case this.draco.TRIANGULAR_MESH:l=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:l=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!l.ok()||!o.ptr){const D="DRACO decompression failed: ".concat(l.error_msg());throw new Error(D)}const s=this._getDracoLoaderData(o,n,t),g=this._getMeshData(o,s,t),b=hP(g.attributes),S=_J(g.attributes,s,g.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:b},...g,schema:S}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,r){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){const r={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),l=this._getAttributeMetadata(e,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:l};const s=this._getQuantizationTransform(o,t);s&&(r[o.unique_id()].quantization_transform=s);const g=this._getOctahedronTransform(o,t);g&&(r[o.unique_id()].octahedron_transform=g)}return r}_getMeshData(e,t,r){const n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const o of Object.values(e.attributes)){const l=this._deduceAttributeName(o,r);o.name=l;const{value:s,size:g}=this._getAttributeValues(t,o);n[l]={value:s,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(e){const r=e.num_faces()*3,n=r*xJ,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),EJ(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=bJ[t.data_type],n=t.num_components,l=e.num_points()*n,s=l*r.BYTES_PER_ELEMENT,g=BJ(this.draco,r);let b;const S=this.draco._malloc(s);try{const F=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,F,g,s,S),b=new r(this.draco.HEAPF32.buffer,S,l).slice()}finally{this.draco._free(S)}return{value:b,size:n}}_deduceAttributeName(e,t){const r=e.unique_id;for(const[l,s]of Object.entries(t.extraAttributes||{}))if(s===r)return l;const n=e.attribute_type;for(const l in jP)if(this.draco[l]===n)return jP[l];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);const n=CJ(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(s=>l.min_value(s))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function BJ(i,e){switch(e){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function CJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}function EJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}const LB="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),SJ="".concat(LB,"/draco_decoder.js"),TJ="".concat(LB,"/draco_wasm_wrapper.js"),IJ="".concat(LB,"/draco_decoder.wasm");let Ly;async function LJ(i){const e=i.modules||{};return e.draco3d?Ly=Ly||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Ly=Ly||MJ(i),await Ly}async function MJ(i){let e,t;switch(i.draco&&i.draco.decoderType){case"js":e=await df(SJ,"draco",i);break;case"wasm":default:[e,t]=await Promise.all([await df(TJ,"draco",i),await df(IJ,"draco",i)])}return e=e||globalThis.DracoDecoderModule,await PJ(e,t)}function PJ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i({...t,onModuleLoaded:n=>r({draco:n})})})}const qP={...yJ,parse:FJ};async function FJ(i,e){const{draco:t}=await LJ(e),r=new wJ(t);try{return r.parseSync(i,e==null?void 0:e.draco)}finally{r.destroy()}}function DJ(i){const e={};for(const t in i){const r=i[t];if(t!=="indices"){const n=$P(r);e[t]=n}}return e}function $P(i){const{buffer:e,size:t,count:r}=RJ(i);return{value:e,size:t,byteOffset:0,count:r,type:zP(t),componentType:QP(e)}}function RJ(i){let e=i,t=1,r=0;return i&&i.value&&(e=i.value,t=i.size||1),e&&(ArrayBuffer.isView(e)||(e=kJ(e,Float32Array)),r=e.length/t),{buffer:e,size:t,count:r}}function kJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new e(i):t&&!(i instanceof e)?new e(i):i:null}const Cf="KHR_draco_mesh_compression",OJ=Cf;function UJ(i,e,t){const r=new Sc(i);for(const n of KP(r))r.getObjectExtension(n,Cf)}async function NJ(i,e,t){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=new Sc(i),o=[];for(const l of KP(n))n.getObjectExtension(l,Cf)&&o.push(QJ(n,l,e,t));await Promise.all(o),n.removeExtension(Cf)}function zJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Sc(i);for(const r of t.json.meshes||[])VJ(r,e),t.addRequiredExtension(Cf)}async function QJ(i,e,t,r){const n=i.getObjectExtension(e,Cf);if(!n)return;const o=i.getTypedArrayForBufferView(n.bufferView),l=vw(o.buffer,o.byteOffset),{parse:s}=r,g={...t};delete g["3d-tiles"];const b=await s(l,qP,g,r),S=DJ(b.attributes);for(const[F,D]of Object.entries(S))if(F in e.attributes){const N=e.attributes[F],J=i.getAccessor(N);J!=null&&J.min&&J!==null&&J!==void 0&&J.max&&(D.min=J.min,D.max=J.max)}e.attributes=S,b.indices&&(e.indices=$P(b.indices)),HJ(e)}function VJ(i,e){var t;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const l=n.DracoWriter.encodeSync({attributes:i}),s=o==null||(t=o.parseSync)===null||t===void 0?void 0:t.call(o,{attributes:i}),g=n._addFauxAttributes(s.attributes),b=n.addBufferView(l);return{primitives:[{attributes:g,mode:r,extensions:{[Cf]:{bufferView:b,attributes:g}}}]}}function HJ(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*KP(i){for(const e of i.json.meshes||[])for(const t of e.primitives)yield t}const GJ=Object.freeze(Object.defineProperty({__proto__:null,decode:NJ,encode:zJ,name:OJ,preprocess:UJ},Symbol.toStringTag,{value:"Module"})),jJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},MB="KHR_texture_transform",$J=MB,k1=new Nt,KJ=new wo,WJ=new wo;async function XJ(i,e){if(!new Sc(i).getExtension(MB))return;const n=i.json.materials||[];for(let o=0;o<n.length;o++)ZJ(o,i)}function ZJ(i,e){var t,r,n;const o=[],l=(t=e.json.materials)===null||t===void 0?void 0:t[i],s=l==null||(r=l.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;s&&My(e,i,s,o);const g=l==null?void 0:l.emissiveTexture;g&&My(e,i,g,o);const b=l==null?void 0:l.normalTexture;b&&My(e,i,b,o);const S=l==null?void 0:l.occlusionTexture;S&&My(e,i,S,o);const F=l==null||(n=l.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;F&&My(e,i,F,o)}function My(i,e,t,r){const n=JJ(t,r);if(!n)return;const o=i.json.meshes||[];for(const l of o)for(const s of l.primitives){const g=s.material;Number.isFinite(g)&&e===g&&YJ(i,s,n)}}function JJ(i,e){var t;const r=(t=i.extensions)===null||t===void 0?void 0:t[MB],{texCoord:n=0}=i,{texCoord:o=n}=r;if(!(e.findIndex(s=>{let[g,b]=s;return g===n&&b===o})!==-1)){const s=iY(r);return n!==o&&(i.texCoord=o),e.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:s}}return null}function YJ(i,e,t){const{originalTexCoord:r,texCoord:n,matrix:o}=t,l=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(l)){var s;const b=(s=i.json.accessors)===null||s===void 0?void 0:s[l];if(b&&b.bufferView){var g;const S=(g=i.json.bufferViews)===null||g===void 0?void 0:g[b.bufferView];if(S){const{arrayBuffer:F,byteOffset:D}=i.buffers[S.buffer],N=(D||0)+(b.byteOffset||0)+(S.byteOffset||0),{ArrayType:J,length:te}=SB(b,S),he=qJ[b.componentType],ue=jJ[b.type],fe=S.byteStride||he*ue,ve=new Float32Array(te);for(let Se=0;Se<b.count;Se++){const Ge=new J(F,N+Se*fe,2);k1.set(Ge[0],Ge[1],1),k1.transformByMatrix3(o),ve.set([k1[0],k1[1]],Se*ue)}r===n?eY(b,S,i.buffers,ve):tY(n,b,e,i,ve)}}}}function eY(i,e,t,r){i.componentType=5126,t.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function tY(i,e,t,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const l=r.json.accessors;l&&(l.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(i)]=l.length-1)}function iY(i){const{offset:e=[0,0],rotation:t=0,scale:r=[1,1]}=i,n=new wo().set(1,0,0,0,1,0,e[0],e[1],1),o=KJ.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),l=WJ.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(l)}const rY=Object.freeze(Object.defineProperty({__proto__:null,decode:XJ,name:$J},Symbol.toStringTag,{value:"Module"})),Ef="KHR_lights_punctual",nY=Ef;async function sY(i){const e=new Sc(i),{json:t}=e,r=e.getExtension(Ef);r&&(e.json.lights=r.lights,e.removeExtension(Ef));for(const n of t.nodes||[]){const o=e.getObjectExtension(n,Ef);o&&(n.light=o.light),e.removeObjectExtension(n,Ef)}}async function oY(i){const e=new Sc(i),{json:t}=e;if(t.lights){const r=e.addExtension(Ef);ru(!r.lights),r.lights=t.lights,delete t.lights}if(e.json.lights){for(const r of e.json.lights){const n=r.node;e.addObjectExtension(n,Ef,r)}delete e.json.lights}}const aY=Object.freeze(Object.defineProperty({__proto__:null,decode:sY,encode:oY,name:nY},Symbol.toStringTag,{value:"Module"})),Py="KHR_materials_unlit",lY=Py;async function cY(i){const e=new Sc(i),{json:t}=e;for(const r of t.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Py);e.removeExtension(Py)}function uY(i){const e=new Sc(i),{json:t}=e;if(e.materials)for(const r of t.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Py,{}),e.addExtension(Py))}const hY=Object.freeze(Object.defineProperty({__proto__:null,decode:cY,encode:uY,name:lY},Symbol.toStringTag,{value:"Module"})),Fy="KHR_techniques_webgl",AY=Fy;async function dY(i){const e=new Sc(i),{json:t}=e,r=e.getExtension(Fy);if(r){const n=pY(r,e);for(const o of t.materials||[]){const l=e.getObjectExtension(o,Fy);l&&(o.technique=Object.assign({},l,n[l.technique]),o.technique.values=gY(o.technique,e)),e.removeObjectExtension(o,Fy)}e.removeExtension(Fy)}}async function fY(i,e){}function pY(i,e){const{programs:t=[],shaders:r=[],techniques:n=[]}=i,o=new TextDecoder;return r.forEach(l=>{if(Number.isFinite(l.bufferView))l.code=o.decode(e.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(l=>{l.fragmentShader=r[l.fragmentShader],l.vertexShader=r[l.vertexShader]}),n.forEach(l=>{l.program=t[l.program]}),n}function gY(i,e){const t=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in t)&&(t[r]=i.uniforms[r].value)}),Object.keys(t).forEach(r=>{typeof t[r]=="object"&&t[r].index!==void 0&&(t[r].texture=e.getTexture(t[r].index))}),t}const mY=Object.freeze(Object.defineProperty({__proto__:null,decode:dY,encode:fY,name:AY},Symbol.toStringTag,{value:"Module"})),WP="EXT_feature_metadata",yY=WP;async function _Y(i){const e=new Sc(i);vY(e)}function vY(i){var e;const t=i.getExtension(WP),r=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,n=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&n)for(const l in r){const s=r[l],g=wY(n,l);g&&bY(i,g,s)}}function bY(i,e,t){for(const n in t.properties){var r;const o=t.properties[n],l=e==null||(r=e.properties)===null||r===void 0?void 0:r[n],s=e.count;if(l){const g=xY(i,o,s,l);l.data=g}}}function xY(i,e,t,r){const n=r.bufferView;let o=i.getTypedArrayForBufferView(n);switch(e.type){case"STRING":{const l=r.stringOffsetBufferView,s=i.getTypedArrayForBufferView(l);o=BY(o,s,t);break}}return o}function wY(i,e){for(const t in i){const r=i[t];if(r.class===e)return r}return null}function BY(i,e,t){const r=[],n=new TextDecoder("utf8");let o=0;const l=4;for(let s=0;s<t;s++){const g=e[(s+1)*l]-e[s*l],b=i.subarray(o,g+o),S=n.decode(b);r.push(S),o+=g}return r}const XP=[hJ,fJ,mJ,GJ,aY,hY,mY,rY,Object.freeze(Object.defineProperty({__proto__:null,decode:_Y,name:yY},Symbol.toStringTag,{value:"Module"}))];function CY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=XP.filter(o=>ZP(o.name,e));for(const o of r){var n;(n=o.preprocess)===null||n===void 0||n.call(o,i,e,t)}}async function EY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=XP.filter(o=>ZP(o.name,e));for(const o of r){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,i,e,t))}}function ZP(i,e){var t;const r=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(i in r&&!r[i])}const PB="KHR_binary_glTF";function SY(i){const e=new Sc(i),{json:t}=e;for(const r of t.images||[]){const n=e.getObjectExtension(r,PB);n&&Object.assign(r,n),e.removeObjectExtension(r,PB)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(PB)}const JP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},TY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class IY{constructor(){_e(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),_e(this,"json",void 0)}normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),SY(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in JP)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(!(!r||Array.isArray(r))){e[t]=[];for(const n in r){const o=r[n];o.id=o.id||n;const l=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=l}}}_convertObjectIdsToArrayIndices(e){for(const t in JP)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:o}=t;for(const l in r)r[l]=this._convertIdToIndex(r[l],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const r of e[t])for(const n in r){const o=r[n],l=this._convertIdToIndex(o,n);r[n]=l}}_convertIdToIndex(e,t){const r=TY[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const o of e.materials){var t,r,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const l=((t=o.values)===null||t===void 0?void 0:t.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),s=e.textures.findIndex(g=>g.id===l);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function LY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new IY().normalize(i,e)}const MY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},PY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Su={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},FY={magFilter:Su.TEXTURE_MAG_FILTER,minFilter:Su.TEXTURE_MIN_FILTER,wrapS:Su.TEXTURE_WRAP_S,wrapT:Su.TEXTURE_WRAP_T},DY={[Su.TEXTURE_MAG_FILTER]:Su.LINEAR,[Su.TEXTURE_MIN_FILTER]:Su.NEAREST_MIPMAP_LINEAR,[Su.TEXTURE_WRAP_S]:Su.REPEAT,[Su.TEXTURE_WRAP_T]:Su.REPEAT};function RY(i){return PY[i]}function kY(i){return MY[i]}class OY{constructor(){_e(this,"baseUri",""),_e(this,"json",{}),_e(this,"buffers",[]),_e(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:n=[],images:o=[],baseUri:l=""}=e;return ru(r),this.baseUri=l,this.json=r,this.buffers=n,this.images=o,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,r)=>this._resolveBufferView(t,r))),e.images&&(e.images=e.images.map((t,r)=>this._resolveImage(t,r))),e.samplers&&(e.samplers=e.samplers.map((t,r)=>this._resolveSampler(t,r))),e.textures&&(e.textures=e.textures.map((t,r)=>this._resolveTexture(t,r))),e.accessors&&(e.accessors=e.accessors.map((t,r)=>this._resolveAccessor(t,r))),e.materials&&(e.materials=e.materials.map((t,r)=>this._resolveMaterial(t,r))),e.meshes&&(e.meshes=e.meshes.map((t,r)=>this._resolveMesh(t,r))),e.nodes&&(e.nodes=e.nodes.map((t,r)=>this._resolveNode(t,r))),e.skins&&(e.skins=e.skins.map((t,r)=>this._resolveSkin(t,r))),e.scenes&&(e.scenes=e.scenes.map((t,r)=>this._resolveScene(t,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,n)=>{const o=this.getMesh(n);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const n=r.attributes;r.attributes={};for(const o in n)r.attributes[o]=this.getAccessor(n[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=RY(e.componentType),e.components=kY(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:o}=SB(e,e.bufferView),l=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let s=r.arrayBuffer.slice(l,l+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(r,l,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,r,n,o){const l=new Uint8Array(o*n);for(let s=0;s<o;s++){const g=t+s*r;l.set(new Uint8Array(e.arrayBuffer.slice(g,g+n)),s*n)}return l.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):DY,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const r in e){const n=this._enumSamplerParameter(r);n!==void 0&&(e.parameters[n]=e[r])}return e}_enumSamplerParameter(e){return FY[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){const r=e.buffer,n={id:"bufferView-".concat(t),...e,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let l=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(l+=e.byteOffset),n.data=new Uint8Array(o,l,e.byteLength),n}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function UY(i,e){return new OY().postProcess(i,e)}const YP=1735152710,FB=12,O1=8,NY=1313821514,zY=5130562,QY=0,VY=1,HY=0,gg=!0;function GY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(e+0))).concat(String.fromCharCode(i.getUint8(e+1))).concat(String.fromCharCode(i.getUint8(e+2))).concat(String.fromCharCode(i.getUint8(e+3)))}function jY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:n=YP}=t,o=r.getUint32(e,!1);return o===n||o===YP}function qY(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),n=GY(r,t+0),o=r.getUint32(t+4,gg),l=r.getUint32(t+8,gg);switch(Object.assign(i,{header:{byteOffset:t,byteLength:l,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),t+=FB,i.version){case 1:return $Y(i,r,t);case 2:return KY(i,r,t,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function $Y(i,e,t){Ms(i.header.byteLength>FB+O1);const r=e.getUint32(t+0,gg),n=e.getUint32(t+4,gg);return t+=O1,Ms(n===HY),DB(i,e,t,r),t+=r,t+=RB(i,e,t,i.header.byteLength),t}function KY(i,e,t,r){return Ms(i.header.byteLength>FB+O1),WY(i,e,t,r),t+i.header.byteLength}function WY(i,e,t,r){for(;t+8<=i.header.byteLength;){const n=e.getUint32(t+0,gg),o=e.getUint32(t+4,gg);switch(t+=O1,o){case NY:DB(i,e,t,n);break;case zY:RB(i,e,t,n);break;case QY:r.strict||DB(i,e,t,n);break;case VY:r.strict||RB(i,e,t,n);break}t+=qm(n,4)}return t}function DB(i,e,t,r){const n=new Uint8Array(e.buffer,t,r),l=new TextDecoder("utf8").decode(n);return i.json=JSON.parse(l),qm(r,4)}function RB(i,e,t,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:t,byteLength:r,arrayBuffer:e.buffer}),qm(r,4)}async function XY(i,e){var t,r,n,o;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;ZY(i,e,l,s),LY(i,{normalize:s==null||(t=s.gltf)===null||t===void 0?void 0:t.normalize}),CY(i,s,g);const b=[];if(s!=null&&(r=s.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await JY(i,s,g),s!=null&&(n=s.gltf)!==null&&n!==void 0&&n.loadImages){const F=YY(i,s,g);b.push(F)}const S=EY(i,s,g);return b.push(S),await Promise.all(b),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?UY(i,s):i}function ZY(i,e,t,r){if(r.uri&&(i.baseUri=r.uri),e instanceof ArrayBuffer&&!jY(e,t,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")i.json=yz(e);else if(e instanceof ArrayBuffer){const l={};t=qY(l,e,t,r.glb),ru(l.type==="glTF","Invalid GLB magic string ".concat(l.type)),i._glb=l,i.json=l.json}else ru(!1,"GLTF: must be ArrayBuffer or string");const n=i.json.buffers||[];if(i.buffers=new Array(n.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:l}=i._glb;i.buffers[0]={arrayBuffer:l[0].arrayBuffer,byteOffset:l[0].byteOffset,byteLength:l[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function JY(i,e,t){const r=i.json.buffers||[];for(let l=0;l<r.length;++l){const s=r[l];if(s.uri){var n,o;const{fetch:g}=t;ru(g);const b=UP(s.uri,e),S=await(t==null||(n=t.fetch)===null||n===void 0?void 0:n.call(t,b)),F=await(S==null||(o=S.arrayBuffer)===null||o===void 0?void 0:o.call(S));i.buffers[l]={arrayBuffer:F,byteOffset:0,byteLength:F.byteLength},delete s.uri}else i.buffers[l]===null&&(i.buffers[l]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function YY(i,e,t){const r=eee(i),n=i.json.images||[],o=[];for(const l of r)o.push(tee(i,n[l],l,e,t));return await Promise.all(o)}function eee(i){const e=new Set,t=i.json.textures||[];for(const r of t)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function tee(i,e,t,r,n){const{fetch:o,parse:l}=n;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const b=UP(e.uri,r);s=await(await o(b)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const b=GZ(i.json,i.buffers,e.bufferView);s=vw(b.buffer,b.byteOffset,b.byteLength)}ru(s,"glTF image has no data");let g=await l(s,[U5,HZ],{mimeType:e.mimeType,basis:r.basis||{format:OP()}},n);g&&g[0]&&(g={compressed:!0,mipmaps:!1,width:g[0].width,height:g[0].height,data:g[0]}),i.images=i.images||[],i.images[t]=g}const Dy={name:"glTF",id:"gltf",module:"gltf",version:SZ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:iee,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function iee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...Dy.options,...e},e.gltf={...Dy.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await XY({},i,r,e,t)}async function ree(i){const e=[];return i.scenes.forEach(t=>{t.traverse(r=>{Object.values(r.model.getUniforms()).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await nee(()=>e.some(t=>!t.loaded))}async function nee(i){for(;i();)await new Promise(e=>requestAnimationFrame(e))}const see=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oee=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,eF=[255,255,255,255],aee={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:eF},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Dy]};class kB extends ug{constructor(){super(...arguments),_e(this,"state",void 0)}getShaders(){const e=[$2,K2];return this.props._lighting==="pbr"&&e.push(F2),super.getShaders({vs:see,fs:oee,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:eF,transition:!0},instanceModelMatrix:cP})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let r=null;if(e.scenegraph instanceof dg)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,g=EZ(t,s,this._getModelOptions());r={gltf:s,...g},ree(g).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(kn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const n={layer:this,gl:t},o=e.getScene(r,n),l=e.getAnimator(r,n);o instanceof dg?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,l,e._animations),this.setState({scenegraph:o,animator:l})):o!==null&&kn.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,t)})}}_applyAnimationsProp(e,t,r){if(!e||!t||!r)return;const n=t.getAnimations();Object.keys(r).sort().forEach(o=>{const l=r[o];if(o==="*")n.forEach(s=>{Object.assign(s,l)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<n.length?Object.assign(n[s],l):kn.warn("animation ".concat(o," not found"))()}else{const s=n.find(g=>{let{name:b}=g;return b===o});s?Object.assign(s,l):kn.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof dg&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!An(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw(e){let{moduleParameters:t=null,parameters:r={},context:n}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:l,sizeMinPixels:s,sizeMaxPixels:g,opacity:b,coordinateSystem:S}=this.props,F=this.getNumInstances();this.state.scenegraph.traverse((D,N)=>{let{worldMatrix:J}=N;D.model.setInstanceCount(F),D.updateModuleSettings(t),D.draw({parameters:r,uniforms:{sizeScale:l,opacity:b,sizeMinPixels:s,sizeMaxPixels:g,composeModelMatrix:uP(o,S),sceneModelMatrix:J,u_Camera:D.model.getUniforms().project_uCameraPosition}})})}}_e(kB,"defaultProps",aee),_e(kB,"layerName","ScenegraphLayer");const lee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function uee(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const hee={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class OB extends xB{getShaders(){const e=super.getShaders();return e.modules.push(F2),{...e,vs:lee,fs:cee}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:r}=this.props,n=this.parseMaterial(r,e);this.setState({materialParser:n});const o=this.getShaders();return uee(e.attributes),new eg(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:r}=this.props,n=this.parseMaterial(e,r);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var r;const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new bP(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],n),r[o*3]=n[0],r[o*3+1]=n[1],r[o*3+2]=n[2];e.value=r}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}_e(OB,"layerName","MeshLayer"),_e(OB,"defaultProps",hee);const Aee=6378137,dee=6378137,fee=6356752314245179e-9;function U1(i){return i}new Nt;function pee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U1;return"longitude"in i?(e[0]=t(i.longitude),e[1]=t(i.latitude),e[2]=i.height):"x"in i?(e[0]=t(i.x),e[1]=t(i.y),e[2]=i.z):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function gee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pee(i,e,Ca._cartographicRadians?U1:SG)}function mee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U1;return"longitude"in e?(e.longitude=t(i[0]),e.latitude=t(i[1]),e.height=i[2]):"x"in e?(e.x=t(i[0]),e.y=t(i[1]),e.z=i[2]):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function yee(i,e){return mee(i,e,Ca._cartographicRadians?U1:TG)}const mg=new Nt,_ee=new Nt,vee=new Nt;function bee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;mg.from(i);const l=mg.x,s=mg.y,g=mg.z,b=r.x,S=r.y,F=r.z,D=l*l*b*b,N=s*s*S*S,J=g*g*F*F,te=D+N+J,he=Math.sqrt(1/te);if(!Number.isFinite(he))return;const ue=_ee;if(ue.copy(i).scale(he),te<o)return ue.to(t);const fe=n.x,ve=n.y,Se=n.z,Ge=vee;Ge.set(ue.x*fe*2,ue.y*ve*2,ue.z*Se*2);let He=(1-he)*mg.len()/(.5*Ge.len()),$e=0,Ne,at,rt,Re;do{He-=$e,Ne=1/(1+He*fe),at=1/(1+He*ve),rt=1/(1+He*Se);const Pe=Ne*Ne,Je=at*at,Xe=rt*rt,Ct=Pe*Ne,Et=Je*at,Mt=Xe*rt;Re=D*Pe+N*Je+J*Xe-1;const Dt=-2*(D*Ct*fe+N*Et*ve+J*Mt*Se);$e=Re/Dt}while(Math.abs(Re)>py.EPSILON12);return mg.scale([Ne,at,rt]).to(t)}const tF=1e-14,xee=new Nt,iF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},UB={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ry={east:new Nt,north:new Nt,up:new Nt,west:new Nt,south:new Nt,down:new Nt},wee=new Nt,Bee=new Nt,Cee=new Nt;function rF(i,e,t,r,n,o){const l=iF[e]&&iF[e][t];eh(l&&(!r||r===l));let s,g,b;const S=xee.copy(n);if(th(S.x,0,tF)&&th(S.y,0,tF)){const D=Math.sign(S.z);s=wee.fromArray(UB[e]),e!=="east"&&e!=="west"&&s.scale(D),g=Bee.fromArray(UB[t]),t!=="east"&&t!=="west"&&g.scale(D),b=Cee.fromArray(UB[r]),r!=="east"&&r!=="west"&&b.scale(D)}else{const{up:D,east:N,north:J}=Ry;N.set(-S.y,S.x,0).normalize(),i.geodeticSurfaceNormal(S,D),J.copy(D).cross(N);const{down:te,west:he,south:ue}=Ry;te.copy(D).scale(-1),he.copy(N).scale(-1),ue.copy(J).scale(-1),s=Ry[e],g=Ry[t],b=Ry[r]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=g.x,o[5]=g.y,o[6]=g.z,o[7]=0,o[8]=b.x,o[9]=b.y,o[10]=b.z,o[11]=0,o[12]=S.x,o[13]=S.y,o[14]=S.z,o[15]=1,o}const N1=new Nt,nF=new Nt,Eee=new Nt,sh=new Nt,See=new Nt,z1=new Nt;class uo{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;_e(this,"radii",void 0),_e(this,"radiiSquared",void 0),_e(this,"radiiToTheFourth",void 0),_e(this,"oneOverRadii",void 0),_e(this,"oneOverRadiiSquared",void 0),_e(this,"minimumRadius",void 0),_e(this,"maximumRadius",void 0),_e(this,"centerToleranceSquared",py.EPSILON1),_e(this,"squaredXOverSquaredZ",void 0),eh(e>=0),eh(t>=0),eh(r>=0),this.radii=new Nt(e,t,r),this.radiiSquared=new Nt(e*e,t*t,r*r),this.radiiToTheFourth=new Nt(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new Nt(e===0?0:1/e,t===0?0:1/t,r===0?0:1/r),this.oneOverRadiiSquared=new Nt(e===0?0:1/(e*e),t===0?0:1/(t*t),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=nF,n=Eee,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,r),n.copy(this.radiiSquared).scale(r);const l=Math.sqrt(r.dot(n));return n.scale(1/l),r.scale(o),n.add(r),n.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];z1.from(e);const r=this.scaleToGeodeticSurface(z1,sh);if(!r)return;const n=this.geodeticSurfaceNormal(r,nF),o=See;o.copy(z1).subtract(r);const l=Math.atan2(n.y,n.x),s=Math.asin(n.z),g=Math.sign(b2(o,z1))*pL(o);return yee([l,s,g],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Cn;return rF(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Cn;return rF(this,e,t,r,n,o)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return N1.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=gee(e),n=r[0],o=r[1],l=Math.cos(o);return N1.set(l*Math.cos(n),l*Math.sin(n),Math.sin(o)).normalize(),N1.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return N1.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return bee(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];sh.from(e);const r=sh.x,n=sh.y,o=sh.z,l=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*l.x+n*n*l.y+o*o*l.z);return sh.multiplyScalar(s).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return sh.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return sh.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];eh(th(this.radii.x,this.radii.y,py.EPSILON15)),eh(this.radii.z>0),sh.from(e);const n=sh.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return sh.set(0,0,n).to(r)}}_e(uo,"WGS84",new uo(Aee,dee,fee));function sF(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class oF{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=sF(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(sF()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Tee{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof oF?n=e:n=new oF(t,r),this.stats[t]=n),n}}class Iee{constructor(e,t,r){_e(this,"item",void 0),_e(this,"previous",void 0),_e(this,"next",void 0),this.item=e,this.previous=t,this.next=r}}class Lee{constructor(){_e(this,"head",null),_e(this,"tail",null),_e(this,"_length",0)}get length(){return this._length}add(e){const t=new Iee(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class Mee{constructor(){_e(this,"_list",void 0),_e(this,"_sentinel",void 0),_e(this,"_trimTiles",void 0),this._list=new Lee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,l=this._sentinel;let s=n.head;for(;s!==l&&(e.gpuMemoryUsageInBytes>o||r);){const g=s.item;s=s.next,this.unloadTile(e,g,t)}}trim(){this._trimTiles=!0}}function Pee(i,e){Ms(i),Ms(e);const{rtcCenter:t,gltfUpAxis:r}=e,{computedTransform:n,boundingVolume:{center:o}}=i;let l=new Cn(n);switch(t&&l.translate(t),r){case"Z":break;case"Y":const F=new Cn().rotateX(Math.PI/2);l=l.multiplyRight(F);break;case"X":const D=new Cn().rotateY(-Math.PI/2);l=l.multiplyRight(D);break}e.isQuantized&&l.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new Nt(o);e.cartesianModelMatrix=l,e.cartesianOrigin=s;const g=uo.WGS84.cartesianToCartographic(s,new Nt),S=uo.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=S.multiplyRight(l),e.cartographicOrigin=g,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const aF=new Nt,NB=new Nt,zB=new Eu([new nh,new nh,new nh,new nh,new nh,new nh]);function Fee(i,e){const{cameraDirection:t,cameraUp:r,height:n}=i,{metersPerUnit:o}=i.distanceScales,l=Q1(i,i.center),s=uo.WGS84.eastNorthUpToFixedFrame(l),g=i.unprojectPosition(i.cameraPosition),b=uo.WGS84.cartographicToCartesian(g,new Nt),S=new Nt(s.transformAsVector(new Nt(t).scale(o))).normalize(),F=new Nt(s.transformAsVector(new Nt(r).scale(o))).normalize();Ree(i);const D=i.constructor,{longitude:N,latitude:J,width:te,bearing:he,zoom:ue}=i,fe=new D({longitude:N,latitude:J,height:n,width:te,bearing:he,zoom:ue,pitch:0});return{camera:{position:b,direction:S,up:F},viewport:i,topDownViewport:fe,height:n,cullingVolume:zB,frameNumber:e,sseDenominator:1.15}}function Dee(i,e,t){if(t===0||i.length<=t)return[i,[]];const r=[],{longitude:n,latitude:o}=e.viewport;for(const[b,S]of i.entries()){const[F,D]=S.header.mbs,N=Math.abs(n-F),J=Math.abs(o-D),te=Math.sqrt(J*J+N*N);r.push([b,te])}const l=r.sort((b,S)=>b[1]-S[1]),s=[];for(let b=0;b<t;b++)s.push(i[l[b][0]]);const g=[];for(let b=t;b<l.length;b++)g.push(i[l[b][0]]);return[s,g]}function Ree(i){const e=i.getFrustumPlanes(),t=lF(e.near,i.cameraPosition),r=Q1(i,t),n=Q1(i,i.cameraPosition,NB);let o=0;zB.planes[o++].fromPointNormal(r,aF.copy(r).subtract(n));for(const l in e){if(l==="near")continue;const s=e[l],g=lF(s,t,NB),b=Q1(i,g,NB);zB.planes[o++].fromPointNormal(b,aF.copy(r).subtract(b))}}function lF(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Nt;const r=i.normal.dot(e);return t.copy(i.normal).scale(i.distance-r).add(e),t}function Q1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Nt;const r=i.unprojectPosition(e);return uo.WGS84.cartographicToCartesian(r,t)}const kee=6378137,Oee=6378137,QB=6356752314245179e-9,cF=new Nt;function Uee(i,e){if(i instanceof Ty){const{halfAxes:t}=i,r=zee(t);return Math.log2(QB/(r+e[2]))}else if(i instanceof Sy){const{radius:t}=i;return Math.log2(QB/(t+e[2]))}else if(i.width&&i.height){const{width:t,height:r}=i,n=Math.log2(kee/t),o=Math.log2(Oee/r);return(n+o)/2}return 1}function uF(i,e,t){const r=uo.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new Nt),n=Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2));return Math.log2(QB/(n+e[2]))}function Nee(i,e,t){const[r,n,o,l]=i;return uF({xmin:r,xmax:o,ymin:n,ymax:l,zmin:0,zmax:0},e,t)}function zee(i){i.getColumn(0,cF);const e=i.getColumn(1),t=i.getColumn(2);return cF.add(e).add(t).len()}const nu={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},LA={ADD:1,REPLACE:2},yg={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Tu={I3S:"I3S",TILES3D:"TILES3D"},V1={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Qee={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function hF(i){return i!=null}const Il=new Nt,H1=new Nt,Vee=new Nt,Hee=new Nt;function VB(i,e,t){if(Ms(i,"3D Tile: boundingVolume must be defined"),i.box)return jee(i.box,e,t);if(i.region){const[r,n,o,l,s,g]=i.region,b=uo.WGS84.cartographicToCartesian([EA(r),EA(l),s],Vee),S=uo.WGS84.cartographicToCartesian([EA(o),EA(n),g],Hee),F=new Nt().addVectors(b,S).multiplyScalar(.5),D=new Nt().subVectors(b,S).len()/2;return AF([F[0],F[1],F[2],D],new Cn)}if(i.sphere)return AF(i.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Gee(i,e){if(i.box)return qee(e);if(i.region){const[t,r,n,o,l,s]=i.region;return[[EA(t),EA(r),l],[EA(n),EA(o),s]]}if(i.sphere)return $ee(e);throw new Error("Unkown boundingVolume type")}function jee(i,e,t){const r=new Nt(i[0],i[1],i[2]);e.transform(r,r);let n=[];if(i.length===10){const b=i.slice(3,6),S=new fy;S.fromArray(i,6);const F=new Nt([1,0,0]),D=new Nt([0,1,0]),N=new Nt([0,0,1]);F.transformByQuaternion(S),F.scale(b[0]),D.transformByQuaternion(S),D.scale(b[1]),N.transformByQuaternion(S),N.scale(b[2]),n=[...F.toArray(),...D.toArray(),...N.toArray()]}else n=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),l=e.transformAsVector(n.slice(3,6)),s=e.transformAsVector(n.slice(6,9)),g=new wo([o[0],o[1],o[2],l[0],l[1],l[2],s[0],s[1],s[2]]);return hF(t)?(t.center=r,t.halfAxes=g,t):new Ty(r,g)}function AF(i,e,t){const r=new Nt(i[0],i[1],i[2]);e.transform(r,r);const n=e.getScale(H1),o=Math.max(Math.max(n[0],n[1]),n[2]),l=i[3]*o;return hF(t)?(t.center=r,t.radius=l,t):new Sy(r,l)}function qee(i){const e=dF(),{halfAxes:t}=i,r=new Nt(t.getColumn(0)),n=new Nt(t.getColumn(1)),o=new Nt(t.getColumn(2));for(let l=0;l<2;l++){for(let s=0;s<2;s++){for(let g=0;g<2;g++)Il.copy(i.center),Il.add(r),Il.add(n),Il.add(o),fF(e,Il),o.negate();n.negate()}r.negate()}return e}function $ee(i){const e=dF(),{center:t,radius:r}=i,n=uo.WGS84.scaleToGeodeticSurface(t,Il);let o;n?o=uo.WGS84.geodeticSurfaceNormal(n):o=new Nt(0,0,1);let l=new Nt(o[2],-o[1],0);l.len()>0?l.normalize():l=new Nt(0,1,0);const s=l.clone().cross(o);for(const g of[l,s,o]){H1.copy(g).scale(r);for(let b=0;b<2;b++)Il.copy(t),Il.add(H1),fF(e,Il),H1.negate()}return e}function dF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function fF(i,e){uo.WGS84.cartesianToCartographic(e,Il),i[0][0]=Math.min(i[0][0],Il[0]),i[0][1]=Math.min(i[0][1],Il[1]),i[0][2]=Math.min(i[0][2],Il[2]),i[1][0]=Math.max(i[1][0],Il[0]),i[1][1]=Math.max(i[1][1],Il[1]),i[1][2]=Math.max(i[1][2],Il[2])}new Nt,new Nt,new Cn,new Nt,new Nt,new Nt;function Kee(i,e){const t=i*e;return 1-Math.exp(-(t*t))}function Wee(i,e){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const t=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return Kee(e,t)*r}return 0}function Xee(i,e,t){const r=i.tileset,n=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=t?n:i.lodMetricValue;if(o===0)return 0;const l=Math.max(i._distanceToCamera,1e-7),{height:s,sseDenominator:g}=e,{viewDistanceScale:b}=r.options;let S=o*s*(b||1)/(l*g);return S-=Wee(r,l),S}const HB=new Nt,pF=new Nt,pd=new Nt,gF=new Nt,Zee=new Nt,GB=new Cn,mF=new Cn;function Jee(i,e){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const t=2*yF(i,e);return t<2?"OUT":!i.header.children||t<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function yF(i,e){const{topDownViewport:t}=e,r=i.header.mbs[1],n=i.header.mbs[0],o=i.header.mbs[2],l=i.header.mbs[3],s=[...i.boundingVolume.center],g=t.unprojectPosition(t.cameraPosition);uo.WGS84.cartographicToCartesian(g,HB),pF.copy(HB).subtract(s).normalize(),uo.WGS84.eastNorthUpToFixedFrame(s,GB),mF.copy(GB).invert(),pd.copy(HB).transform(mF);const b=Math.sqrt(pd[0]*pd[0]+pd[1]*pd[1]),S=b*b/pd[2];gF.copy([pd[0],pd[1],S]);const D=gF.transform(GB).subtract(s).normalize(),J=pF.cross(D).normalize().scale(l).add(s),te=uo.WGS84.cartesianToCartographic(J),he=t.project([n,r,o]),ue=t.project(te);return Zee.copy(he).subtract(ue).magnitude()}function Yee(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class _F{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;_e(this,"_map",new Map),_e(this,"_array",void 0),_e(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ms(e<this._array.length),this._array[e]}set(e,t){Ms(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ms(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ms(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const ete={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class G1{traversalFinished(e){return!0}constructor(e){_e(this,"options",void 0),_e(this,"root",null),_e(this,"selectedTiles",{}),_e(this,"requestedTiles",{}),_e(this,"emptyTiles",{}),_e(this,"lastUpdate",new Date().getTime()),_e(this,"updateDebounceTime",1e3),_e(this,"_traversalStack",new _F),_e(this,"_emptyTraversalStack",new _F),_e(this,"_frameNumber",null),this.options={...ete,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const o=r.pop();let l=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),l=this.updateAndPushChildren(o,t,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,g=!!(!s||s._shouldRefine),b=!l;o.hasRenderContent?o.refine===LA.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===LA.REPLACE&&(this.loadTile(o,t),b&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),b&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=l&&g}const n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const n of r)this.updateTile(n,t)}updateAndPushChildren(e,t,r,n){const{loadSiblings:o,skipLevelOfDetail:l}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const g=e.refine===LA.REPLACE&&e.hasRenderContent&&!l;let b=!1,S=!0;for(const F of s)if(F._selectionDepth=n,F.isVisibleAndInRequestVolume?(r.find(F)&&r.delete(F),r.push(F),b=!0):(g||o)&&(this.loadTile(F,t),this.touchTile(F,t)),g){let D;if(F._inRequestVolume?F.hasRenderContent?D=F.contentAvailable:D=this.executeEmptyTraversal(F,t):D=!1,S=S&&D,!S)return!1}return b||(S=!1),S}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n);else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){const o=n.pop();if(this.updateTile(o,t),o.isVisibleAndInRequestVolume||this.loadTile(o,t),this.touchTile(o,t),!o.hasRenderContent&&this.canTraverse(o,t,!1,!0)){const s=o.children;for(const g of s)n.find(g)&&n.delete(g),n.push(g)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const vF=new Nt;function tte(i){return i!=null}class jB{constructor(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";_e(this,"tileset",void 0),_e(this,"header",void 0),_e(this,"id",void 0),_e(this,"url",void 0),_e(this,"parent",void 0),_e(this,"refine",void 0),_e(this,"type",void 0),_e(this,"contentUrl",void 0),_e(this,"lodMetricType","geometricError"),_e(this,"lodMetricValue",0),_e(this,"boundingVolume",null),_e(this,"content",null),_e(this,"contentState",nu.UNLOADED),_e(this,"gpuMemoryUsageInBytes",0),_e(this,"children",[]),_e(this,"depth",0),_e(this,"viewportIds",[]),_e(this,"transform",new Cn),_e(this,"extensions",null),_e(this,"implicitTiling",null),_e(this,"userData",{}),_e(this,"computedTransform",void 0),_e(this,"hasEmptyContent",!1),_e(this,"hasTilesetContent",!1),_e(this,"traverser",new G1({})),_e(this,"_cacheNode",null),_e(this,"_frameNumber",null),_e(this,"_expireDate",null),_e(this,"_expiredContent",null),_e(this,"_boundingBox",void 0),_e(this,"_distanceToCamera",0),_e(this,"_screenSpaceError",0),_e(this,"_visibilityPlaneMask",void 0),_e(this,"_visible",void 0),_e(this,"_contentBoundingVolume",void 0),_e(this,"_viewerRequestVolume",void 0),_e(this,"_initialTransform",new Cn),_e(this,"_priority",0),_e(this,"_selectedFrame",0),_e(this,"_requestedFrame",0),_e(this,"_selectionDepth",0),_e(this,"_touchedFrame",0),_e(this,"_centerZDepth",0),_e(this,"_shouldRefine",!1),_e(this,"_stackLength",0),_e(this,"_visitedFrame",0),_e(this,"_inRequestVolume",!1),_e(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===nu.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===nu.UNLOADED}get contentExpired(){return this.contentState===nu.EXPIRED}get contentFailed(){return this.contentState===nu.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Gee(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Tu.I3S:return yF(this,e);case Tu.TILES3D:return Xee(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===LA.ADD||t;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===nu.UNLOADED)return-1;const n=this.parent,l=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=nu.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=nu.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await rd(r,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=nu.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=nu.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=nu.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Eu.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Eu.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const r=this.boundingVolume;return vF.subVectors(r.center,t.position),t.direction.dot(vF)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(tte(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=nu.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Cn(e.transform):new Cn;const t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Cn(n).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new Cn;this._initialTransform=new Cn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=nu.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Eu.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||LA.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=VB(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=VB(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=VB(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Cn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Yee(this.tileset.tileset)}}}class ite extends G1{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const l=e.children[0];this.updateTileVisibility(l,t),e._visible=l._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const n=e.refine===LA.REPLACE,o=e._optimChildrenWithinParent===Qee.USE_OPTIMIZATION;if(n&&o&&r&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==LA.ADD?!1:!this.shouldRefine(e,t,!0)}}class rte{constructor(){_e(this,"frameNumberMap",new Map)}register(e,t){const r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const n=r.get(t)||1;r.set(t,n-1)}isZero(e,t){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(t))||0)===0}}const qB={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class nte{constructor(){_e(this,"_statusMap",void 0),_e(this,"pendingTilesRegister",new rte),this._statusMap={}}add(e,t,r,n){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:l}}=n;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:qB.REQUESTED},this.pendingTilesRegister.register(l,o),e().then(s=>{this._statusMap[t].status=qB.COMPLETED;const{frameNumber:g,viewport:{id:b}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(b,g),this._statusMap[t].callback(s,n)}).catch(s=>{this._statusMap[t].status=qB.ERROR;const{frameNumber:g,viewport:{id:b}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(b,g),r(s)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:o,viewport:{id:l}}=t;this.pendingTilesRegister.register(l,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ste extends G1{constructor(e){super(e),_e(this,"_tileManager",void 0),this._tileManager=new nte}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=Jee(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,o=e.tileset;for(const l of r){const s="".concat(l.id,"-").concat(t.viewport.id),g=n&&n.find(b=>b.id===s);if(g)g&&this.updateTile(g,t);else{let b=()=>this._loadTile(l.id,o);this._tileManager.find(s)?this._tileManager.update(s,t):(o.tileset.nodePages&&(b=()=>o.tileset.nodePagesTile.formTileFromNodePages(l.id)),this._tileManager.add(b,s,F=>this._onTileLoad(F,e,s),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),o={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await rd(n,r,o)}_onTileLoad(e,t,r){const n=new jB(t.tileset,e,t,r);t.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const ote={description:"",ellipsoid:uo.WGS84,modelMatrix:new Cn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},j1="Tiles In Tileset(s)",$B="Tiles In Memory",bF="Tiles In View",xF="Tiles To Render",wF="Tiles Loaded",KB="Tiles Loading",BF="Tiles Unloaded",CF="Failed Tile Loads",EF="Points/Vertices",WB="Tile Memory Use";class ate{constructor(e,t){_e(this,"options",void 0),_e(this,"loadOptions",void 0),_e(this,"type",void 0),_e(this,"tileset",void 0),_e(this,"loader",void 0),_e(this,"url",void 0),_e(this,"basePath",void 0),_e(this,"modelMatrix",void 0),_e(this,"ellipsoid",void 0),_e(this,"lodMetricType",void 0),_e(this,"lodMetricValue",void 0),_e(this,"refine",void 0),_e(this,"root",null),_e(this,"roots",{}),_e(this,"asset",{}),_e(this,"description",""),_e(this,"properties",void 0),_e(this,"extras",null),_e(this,"attributions",{}),_e(this,"credits",{}),_e(this,"stats",void 0),_e(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),_e(this,"cartographicCenter",null),_e(this,"cartesianCenter",null),_e(this,"zoom",1),_e(this,"boundingVolume",null),_e(this,"dynamicScreenSpaceErrorComputedDensity",0),_e(this,"maximumMemoryUsage",32),_e(this,"gpuMemoryUsageInBytes",0),_e(this,"_frameNumber",0),_e(this,"_queryParams",{}),_e(this,"_extensionsUsed",[]),_e(this,"_tiles",{}),_e(this,"_pendingCount",0),_e(this,"selectedTiles",[]),_e(this,"traverseCounter",0),_e(this,"geometricError",0),_e(this,"lastUpdatedVieports",null),_e(this,"_requestedTiles",[]),_e(this,"_emptyTiles",[]),_e(this,"frameStateData",{}),_e(this,"_traverser",void 0),_e(this,"_cache",new Mee),_e(this,"_requestScheduler",void 0),_e(this,"updatePromise",null),_e(this,"tilesetInitializationPromise",void 0),this.options={...ote,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||bw(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Lz({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new Tee({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const n of t){const o=n.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const n of t){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const l=Fee(n,this._frameNumber);this._traverser.traverse(this.roots[o],l,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[o,l]=Dee(n,e,this.options.maximumTilesSelected);r.selectedTiles=o;for(const s of l)s.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map(l=>l.id)),n=new Set(t.map(l=>l.id));let o=e.filter(l=>!n.has(l.id)).length>0;return o=o||t.filter(l=>!r.has(l.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(bF).count=this.selectedTiles.length,this.stats.get(xF).count=e,this.stats.get(EF).count=t}async _initializeTileSet(e){this.type===Tu.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Tu.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Tu.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:o,ymin:l,ymax:s,zmin:g,zmax:b}=t;this.cartographicCenter=new Nt(n+(o-n)/2,l+(s-l)/2,g+(b-g)/2),this.cartesianCenter=uo.WGS84.cartographicToCartesian(this.cartographicCenter,new Nt),this.zoom=uF(t,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[n,o,l,s]=r;this.cartographicCenter=new Nt(n+(l-n)/2,o+(s-o)/2,0),this.cartesianCenter=uo.WGS84.cartographicToCartesian(this.cartographicCenter,new Nt),this.zoom=Nee(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Nt,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Nt,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=uo.WGS84.cartesianToCartographic(t,new Nt):this.cartographicCenter=new Nt(0,0,-uo.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Uee(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(j1),this.stats.get(KB),this.stats.get($B),this.stats.get(bF),this.stats.get(xF),this.stats.get(wF),this.stats.get(BF),this.stats.get(CF),this.stats.get(EF),this.stats.get(WB,"memory")}_initializeTileHeaders(e,t){const r=new jB(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===Tu.TILES3D){const o=[];for(o.push(r);o.length>0;){const l=o.pop();this.stats.get(j1).incrementCount();const s=l.header.children||[];for(const g of s){var n;const b=new jB(this,g,l);if((n=b.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const F=new URL(b.contentUrl).searchParams.get("session");F&&(this._queryParams.session=F)}l.children.push(b),b.depth=l.depth+1,o.push(b)}}}return r}_initializeTraverser(){let e;switch(this.type){case Tu.TILES3D:e=ite;break;case Tu.I3S:e=ste;break;default:e=G1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(CF).incrementCount();const r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}_onTileLoad(e,t){if(t){if(this.type===Tu.I3S){var r,n;const o=((r=this.tileset)===null||r===void 0||(n=r.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(j1).reset(),this.stats.get(j1).addCount(o)}e&&e.content&&Pee(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Tu.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Tu.TILES3D){var t;const{extensionsRemoved:r=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(KB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(KB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(wF).incrementCount(),this.stats.get($B).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(WB).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get($B).decrementCount(),this.stats.get(BF).incrementCount(),this.stats.get(WB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const n of e.children)r.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const SF="3.4.14",ky={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function TF(i,e,t){Ms(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(i,e,t);return r.decode(n)}function lte(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(i);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const cte={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},aa={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Hn={...cte,...aa},XB={[aa.DOUBLE]:Float64Array,[aa.FLOAT]:Float32Array,[aa.UNSIGNED_SHORT]:Uint16Array,[aa.UNSIGNED_INT]:Uint32Array,[aa.UNSIGNED_BYTE]:Uint8Array,[aa.BYTE]:Int8Array,[aa.SHORT]:Int16Array,[aa.INT]:Int32Array},ute={DOUBLE:aa.DOUBLE,FLOAT:aa.FLOAT,UNSIGNED_SHORT:aa.UNSIGNED_SHORT,UNSIGNED_INT:aa.UNSIGNED_INT,UNSIGNED_BYTE:aa.UNSIGNED_BYTE,BYTE:aa.BYTE,SHORT:aa.SHORT,INT:aa.INT},ZB="Failed to convert GL type";class jh{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in XB)if(XB[t]===e)return t;throw new Error(ZB)}static fromName(e){const t=ute[e];if(!t)throw new Error(ZB);return t}static getArrayType(e){switch(e){case aa.UNSIGNED_SHORT_5_6_5:case aa.UNSIGNED_SHORT_4_4_4_4:case aa.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=XB[e];if(!t)throw new Error(ZB);return t}}static getByteSize(e){return jh.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!jh.getArrayType(e)}static createTypedArray(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(t.byteLength-r)/jh.getByteSize(e));const o=jh.getArrayType(e);return new o(t,r,n)}}function hte(i,e){if(!i)throw new Error("math.gl assertion failed. ".concat(e))}function Ate(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=i>>11&31,r=i>>5&63,n=i&31;return e[0]=t<<3,e[1]=r<<2,e[2]=n<<3,e}new v2,new Nt,new v2,new v2;function IF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return SA(i,0,e)/e*2-1}function LF(i){return i<0?-1:1}function dte(i,e,t,r){if(hte(r),i<0||i>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(r.x=IF(i,t),r.y=IF(e,t),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*LF(n),r.y=(1-Math.abs(n))*LF(r.y)}return r.normalize()}function fte(i,e,t){return dte(i,e,255,t)}class JB{constructor(e,t){_e(this,"json",void 0),_e(this,"buffer",void 0),_e(this,"featuresLength",0),_e(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hn.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=jh.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,o){const l=this.json[e];if(!l)return l;const s=this.getPropertyArray(e,t,r);if(r===1)return s[n];for(let g=0;g<r;++g)o[g]=s[r*n+g];return o}_getTypedArrayFromBinary(e,t,r,n,o){const l=this._cachedTypedArrays;let s=l[e];return s||(s=jh.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,n*r),l[e]=s),s}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=jh.createTypedArray(t,r),n[e]=o),o}}const pte={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gte={SCALAR:(i,e)=>i[e],VEC2:(i,e)=>[i[2*e+0],i[2*e+1]],VEC3:(i,e)=>[i[3*e+0],i[3*e+1],i[3*e+2]],VEC4:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT2:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT3:(i,e)=>[i[9*e+0],i[9*e+1],i[9*e+2],i[9*e+3],i[9*e+4],i[9*e+5],i[9*e+6],i[9*e+7],i[9*e+8]],MAT4:(i,e)=>[i[16*e+0],i[16*e+1],i[16*e+2],i[16*e+3],i[16*e+4],i[16*e+5],i[16*e+6],i[16*e+7],i[16*e+8],i[16*e+9],i[16*e+10],i[16*e+11],i[16*e+12],i[16*e+13],i[16*e+14],i[16*e+15]]},mte={SCALAR:(i,e,t)=>{e[t]=i},VEC2:(i,e,t)=>{e[2*t+0]=i[0],e[2*t+1]=i[1]},VEC3:(i,e,t)=>{e[3*t+0]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]},VEC4:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT2:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT3:(i,e,t)=>{e[9*t+0]=i[0],e[9*t+1]=i[1],e[9*t+2]=i[2],e[9*t+3]=i[3],e[9*t+4]=i[4],e[9*t+5]=i[5],e[9*t+6]=i[6],e[9*t+7]=i[7],e[9*t+8]=i[8],e[9*t+9]=i[9]},MAT4:(i,e,t)=>{e[16*t+0]=i[0],e[16*t+1]=i[1],e[16*t+2]=i[2],e[16*t+3]=i[3],e[16*t+4]=i[4],e[16*t+5]=i[5],e[16*t+6]=i[6],e[16*t+7]=i[7],e[16*t+8]=i[8],e[16*t+9]=i[9],e[16*t+10]=i[10],e[16*t+11]=i[11],e[16*t+12]=i[12],e[16*t+13]=i[13],e[16*t+14]=i[14],e[16*t+15]=i[15]}};function yte(i,e,t,r){const{componentType:n}=i;Ms(i.componentType);const o=typeof n=="string"?jh.fromName(n):n,l=pte[i.type],s=gte[i.type],g=mte[i.type];return t+=i.byteOffset,{values:jh.createTypedArray(o,e,t,l*r),type:o,size:l,unpacker:s,packer:g}}const qh=i=>i!==void 0;function _te(i,e,t){if(!e)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?vte(r,t):null}function vte(i,e){let t,r,n;const o=i.instancesLength,l=i.classes;let s=i.classIds,g=i.parentCounts,b=i.parentIds,S=o;qh(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,n=getBinaryAccessor(s),s=n.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let F;if(qh(g))for(qh(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,n=getBinaryAccessor(g),g=n.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,o)),F=new Uint16Array(o),S=0,t=0;t<o;++t)F[t]=S,S+=g[t];qh(b)&&qh(b.byteOffset)&&(b.componentType=defaultValue(b.componentType,GL.UNSIGNED_SHORT),b.type=AttributeType.SCALAR,n=getBinaryAccessor(b),b=n.createArrayBufferView(e.buffer,e.byteOffset+b.byteOffset,S));const D=l.length;for(t=0;t<D;++t){const he=l[t].length,ue=l[t].instances,fe=getBinaryProperties(he,ue,e);l[t].instances=combine(fe,ue)}const N=new Array(D).fill(0),J=new Uint16Array(o);for(t=0;t<o;++t)r=s[t],J[t]=N[r],++N[r];const te={classes:l,classIds:s,classIndexes:J,parentCounts:g,parentIndexes:F,parentIds:b};return wte(te),te}function Oy(i,e,t){if(!i)return;const r=i.parentCounts;return i.parentIds?t(i,e):r>0?bte(i,e,t):xte(i,e,t)}function bte(i,e,t){const r=i.classIds,n=i.parentCounts,o=i.parentIds,l=i.parentIndexes,s=r.length,g=scratchVisited;g.length=Math.max(g.length,s);const b=++marker,S=scratchStack;for(S.length=0,S.push(e);S.length>0;){if(e=S.pop(),g[e]===b)continue;g[e]=b;const F=t(i,e);if(qh(F))return F;const D=n[e],N=l[e];for(let J=0;J<D;++J){const te=o[N+J];te!==e&&S.push(te)}}return null}function xte(i,e,t){let r=!0;for(;r;){const n=t(i,e);if(qh(n))return n;const o=i.parentIds[e];r=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function wte(i){const t=i.classIds.length;for(let r=0;r<t;++r)MF(i,r,stack)}function MF(i,e,t){const r=i.parentCounts,n=i.parentIds,o=i.parentIndexes,s=i.classIds.length;if(!qh(n))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const g=qh(r)?r[e]:1,b=qh(r)?o[e]:e;for(let S=0;S<g;++S){const F=n[b+S];F!==e&&MF(i,F,t)}t.pop(e)}function Tc(i){return i!=null}const q1=(i,e)=>i,Bte={HIERARCHY:!0,extensions:!0,extras:!0};class PF{constructor(e,t,r){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};_e(this,"json",void 0),_e(this,"binary",void 0),_e(this,"featureCount",void 0),_e(this,"_extensions",void 0),_e(this,"_properties",void 0),_e(this,"_binaryProperties",void 0),_e(this,"_hierarchy",void 0),Ms(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const l in this.json)Bte[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=_te(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ms(typeof t=="string",t),this._hierarchy){const r=Oy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o];return n.classes[l].name===t});return Tc(r)}return!1}isExactClass(e,t){return Ms(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ms(typeof t=="string",t),Tc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Tc(t)?t:[],t.length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ms(typeof t=="string",t),this._binaryProperties){const n=this._binaryProperties[t];if(Tc(n))return this._getBinaryProperty(n,e)}const r=this._properties[t];if(Tc(r))return q1(r[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(Tc(n))return n}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),Ms(typeof t=="string",t),this._binaryProperties){const l=this._binaryProperties[t];if(l){this._setBinaryProperty(l,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let o=this._properties[t];Tc(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=q1(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;Ms(this.binary,"Property ".concat(e," requires a batch table binary.")),Ms(r.type,"Property ".concat(e," requires a type."));const n=yte(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=Oy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o],s=n.classes[l].instances;return Tc(s[t])});return Tc(r)}_getPropertyNamesInHierarchy(e,t){Oy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o].instances;for(const s in l)l.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)})}_getHierarchyProperty(e,t){return Oy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o],s=r.classIndexes[n],g=l.instances[t];return Tc(g)?Tc(g.typedArray)?this._getBinaryProperty(g,s):q1(g[s]):null})}_setHierarchyProperty(e,t,r,n){const o=Oy(this._hierarchy,t,(l,s)=>{const g=l.classIds[s],b=l.classes[g],S=l.classIndexes[s],F=b.instances[r];return Tc(F)?(Ms(s===t,'Inherited property "'.concat(r,'" is read-only.')),Tc(F.typedArray)?this._setBinaryProperty(F,S,n):F[S]=q1(n),!0):!1});return Tc(o)}}const YB=4;function $1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(i.magic=r.getUint32(t,!0),t+=YB,i.version=r.getUint32(t,!0),t+=YB,i.byteLength=r.getUint32(t,!0),t+=YB,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return t}const _g=4,FF="b3dm tile in legacy format.";function eC(i,e,t){const r=new DataView(e);let n;i.header=i.header||{};let o=r.getUint32(t,!0);t+=_g;let l=r.getUint32(t,!0);t+=_g;let s=r.getUint32(t,!0);t+=_g;let g=r.getUint32(t,!0);return t+=_g,s>=570425344?(t-=_g*2,n=o,s=l,g=0,o=0,l=0,console.warn(FF)):g>=570425344&&(t-=_g,n=s,s=o,g=l,o=0,l=0,console.warn(FF)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=l,i.header.batchTableJsonByteLength=s,i.header.batchTableBinaryByteLength=g,i.header.batchLength=n,t}function tC(i,e,t,r){return t=Cte(i,e,t),t=Ete(i,e,t),t}function Cte(i,e,t,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:l}=i.header;if(i.featureTableJson={BATCH_LENGTH:l||0},n>0){const s=TF(e,t,n);i.featureTableJson=JSON.parse(s)}return t+=n,i.featureTableBinary=new Uint8Array(e,t,o),t+=o,t}function Ete(i,e,t,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=i.header;if(n>0){const l=TF(e,t,n);i.batchTableJson=JSON.parse(l),t+=n,o>0&&(i.batchTableBinary=new Uint8Array(e,t,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),t+=o)}return t}function DF(i,e,t){if(!e&&(!i||!i.batchIds||!t))return null;const{batchIds:r,isRGB565:n,pointCount:o}=i;if(r&&t){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=r[s],S=t.getProperty(g,"dimensions").map(F=>F*255);l[s*3]=S[0],l[s*3+1]=S[1],l[s*3+2]=S[2]}return{type:Hn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}if(n){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=Ate(e[s]);l[s*3]=g[0],l[s*3+1]=g[1],l[s*3+2]=g[2]}return{type:Hn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return e&&e.length===o*3?{type:Hn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Hn.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const RF=new Nt;function Ste(i,e){if(!e)return null;if(i.isOctEncoded16P){const t=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)fte(e[r*2],e[r*2+1],RF),RF.toArray(t,r*3);return{type:Hn.FLOAT,size:2,value:t}}return{type:Hn.FLOAT,size:2,value:e}}function Tte(i,e,t){return i.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,Ite(i,e)):{type:Hn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Ite(i,e){const t=new Nt,r=new Float32Array(i.pointCount*3);for(let n=0;n<i.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,n*3);return r}async function Lte(i,e,t,r,n){t=$1(i,e,t),t=eC(i,e,t),t=tC(i,e,t),Mte(i);const{featureTable:o,batchTable:l}=Pte(i);return await Ote(i,o,l,r,n),Fte(i,o,r),Dte(i,o,l),Rte(i,o),t}function Mte(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function Pte(i){const e=new JB(i.featureTableJson,i.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,i.featuresLength=t,i.pointsLength=t,i.pointCount=t,i.rtcCenter=e.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3);const r=kte(i,e);return{featureTable:e,batchTable:r}}function Fte(i,e,t){if(!i.attributes.positions){if(e.hasProperty("POSITION"))i.attributes.positions=e.getPropertyArray("POSITION",Hn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Hn.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Hn.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Hn.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=Tte(i,r,t)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Dte(i,e,t){if(!i.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Hn.UNSIGNED_BYTE,4),i.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Hn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Hn.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=DF(i,r,t)}e.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Hn.UNSIGNED_BYTE,4))}function Rte(i,e){if(!i.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Hn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Hn.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=Ste(i,t)}}function kte(i,e){let t=null;if(!i.batchIds&&e.hasProperty("BATCH_ID")&&(i.batchIds=e.getPropertyArray("BATCH_ID",Hn.UNSIGNED_SHORT,1),i.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=i;t=new PF(n,o,r)}return t}async function Ote(i,e,t,r,n){let o,l,s;const g=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];g&&(s=g.properties);const b=e.getExtension("3DTILES_draco_point_compression");if(b){l=b.properties;const F=b.byteOffset,D=b.byteLength;if(!l||!Number.isFinite(F)||!D)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=i.featureTableBinary.slice(F,F+D),i.hasPositions=Number.isFinite(l.POSITION),i.hasColors=Number.isFinite(l.RGB)||Number.isFinite(l.RGBA),i.hasNormals=Number.isFinite(l.NORMAL),i.hasBatchIds=Number.isFinite(l.BATCH_ID),i.isTranslucent=Number.isFinite(l.RGBA)}if(!o)return!0;const S={buffer:o,properties:{...l,...s},featureTableProperties:l,batchTableProperties:s,dequantizeInShader:!1};return await Ute(i,S,r,n)}async function Ute(i,e,t,r){const{parse:n}=r,o={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const l=await n(e.buffer,qP,o),s=l.attributes.POSITION&&l.attributes.POSITION.value,g=l.attributes.COLOR_0&&l.attributes.COLOR_0.value,b=l.attributes.NORMAL&&l.attributes.NORMAL.value,S=l.attributes.BATCH_ID&&l.attributes.BATCH_ID.value,F=s&&l.attributes.POSITION.value.quantization,D=b&&l.attributes.NORMAL.value.quantization;if(F){const J=l.POSITION.data.quantization,te=J.range;i.quantizedVolumeScale=new Nt(te,te,te),i.quantizedVolumeOffset=new Nt(J.minValues),i.quantizedRange=(1<<J.quantizationBits)-1,i.isQuantizedDraco=!0}D&&(i.octEncodedRange=(1<<l.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const N={};if(e.batchTableProperties)for(const J of Object.keys(e.batchTableProperties))l.attributes[J]&&l.attributes[J].value&&(N[J.toLowerCase()]=l.attributes[J].value);i.attributes={positions:s,colors:DF(i,g,void 0),normals:b,batchIds:S,...N}}const iC={URI:0,EMBEDDED:1};function kF(i,e,t,r){i.rotateYtoZ=!0;const n=i.byteOffset+i.byteLength-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=vw(e,t,n),i.gltfByteOffset=0,i.gltfByteLength=n,t%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function OF(i,e,t,r){const n=t["3d-tiles"]||{};if(Nte(i,e),n.loadGLTF){const{parse:o,fetch:l}=r;i.gltfUrl&&(i.gltfArrayBuffer=await l(i.gltfUrl,t),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await o(i.gltfArrayBuffer,Dy,t,r),i.gpuMemoryUsageInBytes=VP(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function Nte(i,e,t){switch(e){case iC.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),o=new TextDecoder().decode(r);i.gltfUrl=o.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case iC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function zte(i,e,t,r,n){var o;t=Qte(i,e,t,r),await OF(i,iC.EMBEDDED,r,n);const l=i==null||(o=i.gltf)===null||o===void 0?void 0:o.extensions;return l&&l.CESIUM_RTC&&(i.rtcCenter=l.CESIUM_RTC.center),t}function Qte(i,e,t,r,n){t=$1(i,e,t),t=eC(i,e,t),t=tC(i,e,t),t=kF(i,e,t,r);const o=new JB(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3),t}async function Vte(i,e,t,r,n){return t=Hte(i,e,t,r),await OF(i,i.gltfFormat,r,n),t}function Hte(i,e,t,r,n){if(t=$1(i,e,t),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));t=eC(i,e,t);const o=new DataView(e);if(i.gltfFormat=o.getUint32(t,!0),t+=4,t=tC(i,e,t),t=kF(i,e,t,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new JB(i.featureTableJson,i.featureTableBinary),s=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=l.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3);const g=new PF(i.batchTableJson,i.batchTableBinary,s);return Gte(i,l,g,s),t}function Gte(i,e,t,r){const o={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,l=new Nt;new Nt,new Nt,new Nt;const s=new wo,g=new fy,b=new Nt,S={},F=new Cn,D=[],N=[],J=new Nt,te=new Nt;for(let he=0;he<r;he++){let ue;if(e.hasProperty("POSITION"))ue=e.getProperty("POSITION",Hn.FLOAT,3,he,l);else if(e.hasProperty("POSITION_QUANTIZED")){ue=e.getProperty("POSITION_QUANTIZED",Hn.UNSIGNED_SHORT,3,he,l);const $e=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Hn.FLOAT,3,J);if(!$e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ne=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Hn.FLOAT,3,te);if(!Ne)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const at=65535;for(let rt=0;rt<3;rt++)ue[rt]=ue[rt]/at*Ne[rt]+$e[rt]}if(!ue)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(ue),S.translation=l,i.normalUp=e.getProperty("NORMAL_UP",Hn.FLOAT,3,he,D),i.normalRight=e.getProperty("NORMAL_RIGHT",Hn.FLOAT,3,he,N),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Hn.UNSIGNED_SHORT,2,D),i.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Hn.UNSIGNED_SHORT,2,N),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(uo.WGS84.eastNorthUpToFixedFrame(l,F),F.getRotationMatrix3(s)):s.identity()}g.fromMatrix3(s),S.rotation=g,b.set(1,1,1);const fe=e.getProperty("SCALE",Hn.FLOAT,1,he);Number.isFinite(fe)&&b.multiplyByScalar(fe);const ve=e.getProperty("SCALE_NON_UNIFORM",Hn.FLOAT,3,he,D);ve&&b.scale(ve),S.scale=b;let Se=e.getProperty("BATCH_ID",Hn.UNSIGNED_SHORT,1,he);Se===void 0&&(Se=he);const Ge=new Cn().fromQuaternion(S.rotation);F.identity(),F.translate(S.translation),F.multiplyRight(Ge),F.scale(S.scale);const He=F.clone();o[he]={modelMatrix:He,batchId:Se}}i.instances=o}async function jte(i,e,t,r,n,o){t=$1(i,e,t);const l=new DataView(e);for(i.tilesLength=l.getUint32(t,!0),t+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-t>12;){const s={};i.tiles.push(s),t=await o(e,t,r,n,s)}return t}async function qte(i,e,t,r){i.rotateYtoZ=!0,i.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=r;i.gltf=await n(e,Dy,t,r),i.gpuMemoryUsageInBytes=VP(i.gltf)}async function UF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=e,n.type=lte(i,e),n.type){case ky.COMPOSITE:return await jte(n,i,e,t,r,UF);case ky.BATCHED_3D_MODEL:return await zte(n,i,e,t,r);case ky.GLTF:return await qte(n,i,t,r);case ky.INSTANCED_3D_MODEL:return await Vte(n,i,e,t,r);case ky.POINT_CLOUD:return await Lte(n,i,e,t,r);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const $te=1952609651,Kte=1;async function Wte(i,e,t){if(new Uint32Array(i.slice(0,4))[0]!==$te)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==Kte)throw new Error("Wrong subtree file verson, must be 1");const o=NF(i.slice(8,16)),l=new Uint8Array(i,24,o),g=new TextDecoder("utf8").decode(l),b=JSON.parse(g),S=NF(i.slice(16,24));let F=new ArrayBuffer(0);return S&&(F=i.slice(24+o)),"bufferView"in b.tileAvailability&&(b.tileAvailability.explicitBitstream=await rC(b,"tileAvailability",F,t)),"bufferView"in b.contentAvailability&&(b.contentAvailability.explicitBitstream=await rC(b,"contentAvailability",F,t)),"bufferView"in b.childSubtreeAvailability&&(b.childSubtreeAvailability.explicitBitstream=await rC(b,"childSubtreeAvailability",F,t)),b}function Xte(i,e){if(e.startsWith("http")){const o=new URL(i,e);return decodeURI(o.toString())}const r="http://".concat(e),n=new URL(i,r);return"/".concat(n.host).concat(n.pathname)}async function rC(i,e,t,r){const n=i[e].bufferView,o=i.bufferViews[n],l=i.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(l.uri){const s=Xte(l.uri,r==null?void 0:r.url),b=await(await r.fetch(s)).arrayBuffer();return new Uint8Array(b,o.byteOffset,o.byteLength)}return new Uint8Array(t,o.byteOffset,o.byteLength)}function NF(i){const e=new DataView(i),t=e.getUint32(0,!0),r=e.getUint32(4,!0);return t+2**32*r}const zF={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:SF,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Wte,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Iu=null;try{Iu=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function gs(i,e,t){this.low=i|0,this.high=e|0,this.unsigned=!!t}gs.prototype.__isLong__,Object.defineProperty(gs.prototype,"__isLong__",{value:!0});function Ll(i){return(i&&i.__isLong__)===!0}function QF(i){var e=Math.clz32(i&-i);return i?31-e:e}gs.isLong=Ll;var VF={},HF={};function Sf(i,e){var t,r,n;return e?(i>>>=0,(n=0<=i&&i<256)&&(r=HF[i],r)?r:(t=Jn(i,0,!0),n&&(HF[i]=t),t)):(i|=0,(n=-128<=i&&i<128)&&(r=VF[i],r)?r:(t=Jn(i,i<0?-1:0,!1),n&&(VF[i]=t),t))}gs.fromInt=Sf;function Lu(i,e){if(isNaN(i))return e?MA:ah;if(e){if(i<0)return MA;if(i>=jF)return XF}else{if(i<=-qF)return Ic;if(i+1>=qF)return WF}return i<0?Lu(-i,e).neg():Jn(i%vg|0,i/vg|0,e)}gs.fromNumber=Lu;function Jn(i,e,t){return new gs(i,e,t)}gs.fromBits=Jn;var K1=Math.pow;function nC(i,e,t){if(i.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return e?MA:ah;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return nC(i.substring(1),e,t).neg();for(var n=Lu(K1(t,8)),o=ah,l=0;l<i.length;l+=8){var s=Math.min(8,i.length-l),g=parseInt(i.substring(l,l+s),t);if(s<8){var b=Lu(K1(t,s));o=o.mul(b).add(Lu(g))}else o=o.mul(n),o=o.add(Lu(g))}return o.unsigned=e,o}gs.fromString=nC;function oh(i,e){return typeof i=="number"?Lu(i,e):typeof i=="string"?nC(i,e):Jn(i.low,i.high,typeof e=="boolean"?e:i.unsigned)}gs.fromValue=oh;var GF=65536,Zte=1<<24,vg=GF*GF,jF=vg*vg,qF=jF/2,$F=Sf(Zte),ah=Sf(0);gs.ZERO=ah;var MA=Sf(0,!0);gs.UZERO=MA;var bg=Sf(1);gs.ONE=bg;var KF=Sf(1,!0);gs.UONE=KF;var sC=Sf(-1);gs.NEG_ONE=sC;var WF=Jn(-1,2147483647,!1);gs.MAX_VALUE=WF;var XF=Jn(-1,-1,!0);gs.MAX_UNSIGNED_VALUE=XF;var Ic=Jn(0,-2147483648,!1);gs.MIN_VALUE=Ic;var Ri=gs.prototype;Ri.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ri.toNumber=function(){return this.unsigned?(this.high>>>0)*vg+(this.low>>>0):this.high*vg+(this.low>>>0)},Ri.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ic)){var t=Lu(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Lu(K1(e,6),this.unsigned),l=this,s="";;){var g=l.div(o),b=l.sub(g.mul(o)).toInt()>>>0,S=b.toString(e);if(l=g,l.isZero())return S+s;for(;S.length<6;)S="0"+S;s=""+S+s}},Ri.getHighBits=function(){return this.high},Ri.getHighBitsUnsigned=function(){return this.high>>>0},Ri.getLowBits=function(){return this.low},Ri.getLowBitsUnsigned=function(){return this.low>>>0},Ri.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ic)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},Ri.isZero=function(){return this.high===0&&this.low===0},Ri.eqz=Ri.isZero,Ri.isNegative=function(){return!this.unsigned&&this.high<0},Ri.isPositive=function(){return this.unsigned||this.high>=0},Ri.isOdd=function(){return(this.low&1)===1},Ri.isEven=function(){return(this.low&1)===0},Ri.equals=function(e){return Ll(e)||(e=oh(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Ri.eq=Ri.equals,Ri.notEquals=function(e){return!this.eq(e)},Ri.neq=Ri.notEquals,Ri.ne=Ri.notEquals,Ri.lessThan=function(e){return this.comp(e)<0},Ri.lt=Ri.lessThan,Ri.lessThanOrEqual=function(e){return this.comp(e)<=0},Ri.lte=Ri.lessThanOrEqual,Ri.le=Ri.lessThanOrEqual,Ri.greaterThan=function(e){return this.comp(e)>0},Ri.gt=Ri.greaterThan,Ri.greaterThanOrEqual=function(e){return this.comp(e)>=0},Ri.gte=Ri.greaterThanOrEqual,Ri.ge=Ri.greaterThanOrEqual,Ri.compare=function(e){if(Ll(e)||(e=oh(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Ri.comp=Ri.compare,Ri.negate=function(){return!this.unsigned&&this.eq(Ic)?Ic:this.not().add(bg)},Ri.neg=Ri.negate,Ri.add=function(e){Ll(e)||(e=oh(e));var t=this.high>>>16,r=this.high&65535,n=this.low>>>16,o=this.low&65535,l=e.high>>>16,s=e.high&65535,g=e.low>>>16,b=e.low&65535,S=0,F=0,D=0,N=0;return N+=o+b,D+=N>>>16,N&=65535,D+=n+g,F+=D>>>16,D&=65535,F+=r+s,S+=F>>>16,F&=65535,S+=t+l,S&=65535,Jn(D<<16|N,S<<16|F,this.unsigned)},Ri.subtract=function(e){return Ll(e)||(e=oh(e)),this.add(e.neg())},Ri.sub=Ri.subtract,Ri.multiply=function(e){if(this.isZero())return this;if(Ll(e)||(e=oh(e)),Iu){var t=Iu.mul(this.low,this.high,e.low,e.high);return Jn(t,Iu.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?MA:ah;if(this.eq(Ic))return e.isOdd()?Ic:ah;if(e.eq(Ic))return this.isOdd()?Ic:ah;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt($F)&&e.lt($F))return Lu(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,l=this.low&65535,s=e.high>>>16,g=e.high&65535,b=e.low>>>16,S=e.low&65535,F=0,D=0,N=0,J=0;return J+=l*S,N+=J>>>16,J&=65535,N+=o*S,D+=N>>>16,N&=65535,N+=l*b,D+=N>>>16,N&=65535,D+=n*S,F+=D>>>16,D&=65535,D+=o*b,F+=D>>>16,D&=65535,D+=l*g,F+=D>>>16,D&=65535,F+=r*S+n*b+o*g+l*s,F&=65535,Jn(N<<16|J,F<<16|D,this.unsigned)},Ri.mul=Ri.multiply,Ri.divide=function(e){if(Ll(e)||(e=oh(e)),e.isZero())throw Error("division by zero");if(Iu){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Iu.div_u:Iu.div_s)(this.low,this.high,e.low,e.high);return Jn(t,Iu.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?MA:ah;var r,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return MA;if(e.gt(this.shru(1)))return KF;o=MA}else{if(this.eq(Ic)){if(e.eq(bg)||e.eq(sC))return Ic;if(e.eq(Ic))return bg;var l=this.shr(1);return r=l.div(e).shl(1),r.eq(ah)?e.isNegative()?bg:sC:(n=this.sub(e.mul(r)),o=r.add(n.div(e)),o)}else if(e.eq(Ic))return this.unsigned?MA:ah;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=ah}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),g=s<=48?1:K1(2,s-48),b=Lu(r),S=b.mul(e);S.isNegative()||S.gt(n);)r-=g,b=Lu(r,this.unsigned),S=b.mul(e);b.isZero()&&(b=bg),o=o.add(b),n=n.sub(S)}return o},Ri.div=Ri.divide,Ri.modulo=function(e){if(Ll(e)||(e=oh(e)),Iu){var t=(this.unsigned?Iu.rem_u:Iu.rem_s)(this.low,this.high,e.low,e.high);return Jn(t,Iu.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Ri.mod=Ri.modulo,Ri.rem=Ri.modulo,Ri.not=function(){return Jn(~this.low,~this.high,this.unsigned)},Ri.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Ri.clz=Ri.countLeadingZeros,Ri.countTrailingZeros=function(){return this.low?QF(this.low):QF(this.high)+32},Ri.ctz=Ri.countTrailingZeros,Ri.and=function(e){return Ll(e)||(e=oh(e)),Jn(this.low&e.low,this.high&e.high,this.unsigned)},Ri.or=function(e){return Ll(e)||(e=oh(e)),Jn(this.low|e.low,this.high|e.high,this.unsigned)},Ri.xor=function(e){return Ll(e)||(e=oh(e)),Jn(this.low^e.low,this.high^e.high,this.unsigned)},Ri.shiftLeft=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jn(0,this.low<<e-32,this.unsigned)},Ri.shl=Ri.shiftLeft,Ri.shiftRight=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Ri.shr=Ri.shiftRight,Ri.shiftRightUnsigned=function(e){return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Jn(this.high,0,this.unsigned):Jn(this.high>>>e-32,0,this.unsigned)},Ri.shru=Ri.shiftRightUnsigned,Ri.shr_u=Ri.shiftRightUnsigned,Ri.rotateLeft=function(e){var t;return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jn(this.high,this.low,this.unsigned):e<32?(t=32-e,Jn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Jn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Ri.rotl=Ri.rotateLeft,Ri.rotateRight=function(e){var t;return Ll(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jn(this.high,this.low,this.unsigned):e<32?(t=32-e,Jn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Jn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Ri.rotr=Ri.rotateRight,Ri.toSigned=function(){return this.unsigned?Jn(this.low,this.high,!1):this},Ri.toUnsigned=function(){return this.unsigned?this:Jn(this.low,this.high,!0)},Ri.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Ri.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Ri.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},gs.fromBytes=function(e,t,r){return r?gs.fromBytesLE(e,t):gs.fromBytesBE(e,t)},gs.fromBytesLE=function(e,t){return new gs(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},gs.fromBytesBE=function(e,t){return new gs(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Jte=16;function ZF(i){i==="X"&&(i="");const e=i.padEnd(Jte,"0");return gs.fromString(e,!0,16)}function Yte(i){if(i.isZero())return"X";let e=i.countTrailingZeros();const t=e%4;e=(e-t)/4;const r=e;e*=4;const o=i.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-o.length).join("0")+o}function eie(i,e){const t=tie(i).shiftRightUnsigned(2);return i.add(gs.fromNumber(2*e+1-4).multiply(t))}function tie(i){return i.and(i.not().add(1))}const iie=3,rie=2*30+1,JF=180/Math.PI;function nie(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const e=i.split("/"),t=parseInt(e[0],10),r=e[1],n=r.length;let o=0;const l=[0,0];for(let s=n-1;s>=0;s--){o=n-s;const g=r[s];let b=0,S=0;g==="1"?S=1:g==="2"?(b=1,S=1):g==="3"&&(b=1);const F=Math.pow(2,o-1);oie(F,l,b,S),l[0]+=F*b,l[1]+=F*S}if(t%2===1){const s=l[0];l[0]=l[1],l[1]=s}return{face:t,ij:l,level:o}}function sie(i){if(i.isZero())return"";let e=i.toString(2);for(;e.length<iie+rie;)e="0"+e;const t=e.lastIndexOf("1"),r=e.substring(0,3),n=e.substring(3,t),o=n.length/2,l=gs.fromString(r,!0,2).toString(10);let s="";if(o!==0)for(s=gs.fromString(n,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(l,"/").concat(s)}function YF(i,e,t){const r=1<<e;return[(i[0]+t[0])/r,(i[1]+t[1])/r]}function e4(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function t4(i){return[e4(i[0]),e4(i[1])]}function i4(i,e){let[t,r]=e;switch(i){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function r4(i){let[e,t,r]=i;const n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*JF,n*JF]}function oie(i,e,t,r){if(r===0){t===1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function aie(i){const e=YF(i.ij,i.level,[.5,.5]),t=t4(e),r=i4(i.face,t);return r4(r)}const lie=100;function n4(i){const{face:e,ij:t,level:r}=i,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(lie*Math.pow(2,-r))),l=new Float64Array(4*o*2+2);let s=0,g=0;for(let b=0;b<4;b++){const S=n[b].slice(0),F=n[b+1],D=(F[0]-S[0])/o,N=(F[1]-S[1])/o;for(let J=0;J<o;J++){S[0]+=D,S[1]+=N;const te=YF(t,r,S),he=t4(te),ue=i4(e,he),fe=r4(ue);Math.abs(fe[1])>89.999&&(fe[0]=g);const ve=fe[0]-g;fe[0]+=ve>180?-360:ve<-180?360:0,l[s++]=fe[0],l[s++]=fe[1],g=fe[0]}}return l[s++]=l[0],l[s++]=l[1],l}function oC(i){const e=cie(i);return nie(e)}function cie(i){if(i.indexOf("/")>0)return i;const e=ZF(i);return sie(e)}function uie(i){const e=oC(i);return aie(e)}function hie(i){let e;if(i.face===2||i.face===5){let t=null,r=0;for(let n=0;n<4;n++){const o="".concat(i.face,"/").concat(n),l=oC(o),s=n4(l);(typeof t>"u"||t===null)&&(t=new Float64Array(4*s.length)),t.set(s,r),r+=s.length}e=s4(t)}else{const t=n4(i);e=s4(t)}return e}function s4(i){if(i.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let r=0;r<i.length;r+=2)e.push(i[r]),t.push(i[r+1]);return e.sort((r,n)=>r-n),t.sort((r,n)=>r-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function Aie(i,e){const t=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,n=oC(i),o=hie(n),l=o.west,s=o.south,g=o.east,b=o.north,S=[];return S.push(new Nt(l,b,t)),S.push(new Nt(g,b,t)),S.push(new Nt(g,s,t)),S.push(new Nt(l,s,t)),S.push(new Nt(l,b,r)),S.push(new Nt(g,b,r)),S.push(new Nt(g,s,r)),S.push(new Nt(l,s,r)),S}function o4(i){const e=i.token,t={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=Aie(e,t),n=uie(e),o=n[0],l=n[1],s=uo.WGS84.cartographicToCartesian([o,l,t.maximumHeight]),g=new Nt(s[0],s[1],s[2]);r.push(g);const b=jX(r);return[...b.center,...b.halfAxes]}const die={QUADTREE:4,OCTREE:8};function fie(i,e,t){if(i!=null&&i.box){const r=ZF(i.s2VolumeInfo.token),n=eie(r,e),o=Yte(n),l={...i.s2VolumeInfo};switch(l.token=o,t){case"OCTREE":const b=i.s2VolumeInfo,S=b.maximumHeight-b.minimumHeight,F=S/2,D=b.minimumHeight+S/2;b.minimumHeight=D-F,b.maximumHeight=D+F;break}return{box:o4(l),s2VolumeInfo:l}}}async function a4(i){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=i;let{subtree:l,level:s=0}=i;const{subdivisionScheme:g,subtreeLevels:b,maximumLevel:S,contentUrlTemplate:F,subtreesUriTemplate:D,basePath:N}=e,J={children:[],lodMetricValue:0,contentUrl:""},te=die[g],he=r&1,ue=r>>1&1,fe=r>>2&1,ve=(te**s-1)/(te-1);let Se=Tf(t.mortonIndex,r),Ge=ve+Se,He=Tf(t.x,he),$e=Tf(t.y,ue),Ne=Tf(t.z,fe),at=!1;s+1>b&&(at=aC(l.childSubtreeAvailability,Se));const rt=Tf(n.x,He),Re=Tf(n.y,$e),Pe=Tf(n.z,Ne),Je=s+n.level;if(at){const vt="".concat(N,"/").concat(D),Dt=lC(vt,Je,rt,Re,Pe);l=await rd(Dt,zF),n.mortonIndex=Se,n.x=He,n.y=$e,n.z=Ne,n.level=s,Se=0,Ge=0,He=0,$e=0,Ne=0,s=0}if(!aC(l.tileAvailability,Ge)||s>S)return J;aC(l.contentAvailability,Ge)&&(J.contentUrl=lC(F,Je,rt,Re,Pe));const Et=s+1,Mt={mortonIndex:Se,x:He,y:$e,z:Ne};for(let vt=0;vt<te;vt++){const Dt=fie(o,vt,g),Pt=await a4({subtree:l,options:e,parentData:Mt,childIndex:vt,level:Et,globalData:n,s2VolumeBox:Dt});if(Pt.contentUrl||Pt.children.length){const Xt=Je+1,Ze=pie(Pt,Xt,{childTileX:He,childTileY:$e,childTileZ:Ne},e,o);J.children.push(Ze)}}return J}function aC(i,e){return"constant"in i?!!i.constant:i.explicitBitstream?yie(e,i.explicitBitstream):!1}function pie(i,e,t,r,n){const{basePath:o,refine:l,getRefine:s,lodMetricType:g,getTileType:b,rootLodMetricValue:S,rootBoundingVolume:F}=r,D=i.contentUrl&&i.contentUrl.replace("".concat(o,"/"),""),N=S/2**e,J=n!=null&&n.box?{box:n.box}:F,te=gie(e,J,t);return{children:i.children,contentUrl:i.contentUrl,content:{uri:D},id:i.contentUrl,refine:s(l),type:b(i),lodMetricType:g,lodMetricValue:N,geometricError:N,transform:i.transform,boundingVolume:te}}function gie(i,e,t){if(e.region){const{childTileX:r,childTileY:n,childTileZ:o}=t,[l,s,g,b,S,F]=e.region,D=2**i,N=(g-l)/D,J=(b-s)/D,te=(F-S)/D,[he,ue]=[l+N*r,l+N*(r+1)],[fe,ve]=[s+J*n,s+J*(n+1)],[Se,Ge]=[S+te*o,S+te*(o+1)];return{region:[he,fe,ue,ve,Se,Ge]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Tf(i,e){return parseInt(i.toString(2)+e.toString(2),2)}function lC(i,e,t,r,n){const o=mie({level:e,x:t,y:r,z:n});return i.replace(/{level}|{x}|{y}|{z}/gi,l=>o[l])}function mie(i){const e={};for(const t in i)e["{".concat(t,"}")]=i[t];return e}function yie(i,e){const t=Math.floor(i/8),r=i%8;return(e[t]>>r&1)===1}function cC(i){if(!i.contentUrl)return yg.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return yg.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return yg.SCENEGRAPH;default:return t}}function uC(i){switch(i){case"REPLACE":case"replace":return LA.REPLACE;case"ADD":case"add":return LA.ADD;default:return i}}function hC(i,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(i,"".concat(e,"/"));return decodeURI(r.toString())}else if(i.startsWith("/"))return i;return"".concat(e,"/").concat(i)}function l4(i,e){if(!i)return null;if(i.content){const t=i.content.uri||i.content.url;i.contentUrl=hC(t,e.basePath)}return i.id=i.contentUrl,i.lodMetricType=V1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=cC(i),i.refine=uC(i.refine),i}async function _ie(i,e){const t=i.basePath;let r;const n=u4(i==null?void 0:i.root);n&&i.root?r=await c4(i.root,i,n,e):r=l4(i.root,i);const o=[];for(o.push(r);o.length>0;){const s=(o.pop()||{}).children||[];for(let g of s){const b=u4(g);b?g=await c4(g,i,b,e):l4(g,{basePath:t}),o.push(g)}}return r}async function c4(i,e,t,r){var n,o;const l=e.basePath,{subdivisionScheme:s,maximumLevel:g,subtreeLevels:b,subtrees:{uri:S}}=t,F=lC(S,0,0,0,0),D=hC(F,l),N=await rd(D,zF,r),J=hC(i.content.uri,l),te=e==null||(n=e.root)===null||n===void 0?void 0:n.refine,he=i.geometricError,ue=(o=i.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(ue){const Ge={box:o4(ue),s2VolumeInfo:ue};i.boundingVolume=Ge}const fe=i.boundingVolume,ve={contentUrlTemplate:J,subtreesUriTemplate:S,subdivisionScheme:s,subtreeLevels:b,maximumLevel:g,refine:te,basePath:l,lodMetricType:V1.GEOMETRIC_ERROR,rootLodMetricValue:he,rootBoundingVolume:fe,getTileType:cC,getRefine:uC};return await vie(i,N,ve)}async function vie(i,e,t){if(!i)return null;i.lodMetricType=V1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:n}=await a4({subtree:e,options:t,s2VolumeBox:i});return n&&(i.contentUrl=n,i.content={uri:n.replace("".concat(t.basePath,"/"),"")}),i.refine=uC(i.refine),i.type=cC(i),i.children=r,i.id=i.contentUrl,i}function u4(i){var e;return(i==null||(e=i.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const AC={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:SF,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Bie,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function bie(i){return bw(i.url)}async function xie(i,e,t){const r={content:{featureIds:null}};return await UF(i,0,e,t,r.content),r.content}async function wie(i,e,t){var r;const n=JSON.parse(new TextDecoder().decode(i));return n.loader=e.loader||AC,n.url=t.url,n.queryString=t.queryString,n.basePath=bie(n),n.root=await _ie(n,e),n.type=Tu.TILES3D,n.lodMetricType=V1.GEOMETRIC_ERROR,n.lodMetricValue=((r=n.root)===null||r===void 0?void 0:r.lodMetricValue)||0,n}async function Bie(i,e,t){const r=e["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=t.url&&t.url.indexOf(".json")!==-1:n=r.isTileset,n?i=await wie(i,e,t):i=await xie(i,e,t),i}const h4=[0],Cie={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:AC,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,e,t)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class dC extends WM{constructor(){super(...arguments),_e(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&kn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:r,changeFlags:n}=e;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const l in o)o[l].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=r==null?void 0:r[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:r}=e;const n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer(e){let{layer:t,viewport:r}=e;const{tile:n}=t.props,{id:o}=r;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(e){const t=e.sourceTile,r=this.state.layerMap[t==null?void 0:t.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};let o=e;if(r.preload){const g=await r.preload(e,t);g.url&&(o=g.url),g.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:g.headers}),Object.assign(n,g)}const l=await rd(o,r,n.loadOptions),s=new ate(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:r}=this.context,n=Object.keys(e).length;!r||!n||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case yg.POINTCLOUD:return this._makePointCloudLayer(e,t);case yg.SCENEGRAPH:return this._make3DModelLayer(e);case yg.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:r,pointCount:n,constantRGBA:o,cartographicOrigin:l,modelMatrix:s}=e.content,{positions:g,normals:b,colors:S}=r;if(!g)return null;const F=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:g,NORMAL:b,COLOR_0:S}},{pointSize:D,getPointColor:N}=this.props,J=this.getSubLayerClass("pointcloud",mB);return new J({pointSize:D},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:F,coordinateSystem:Pn.METER_OFFSETS,coordinateOrigin:l,modelMatrix:s,getColor:o||N,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:r,cartographicOrigin:n,modelMatrix:o}=e.content,l=this.getSubLayerClass("scenegraph",kB);return new l({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||h4,scenegraph:t,coordinateSystem:Pn.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const r=e.content,{attributes:n,indices:o,modelMatrix:l,cartographicOrigin:s,coordinateSystem:g=Pn.METER_OFFSETS,material:b,featureIds:S}=r,{_getMeshColor:F}=this.props,D=t&&t.props.mesh||new my({drawMode:4,attributes:Eie(n),indices:o}),N=this.getSubLayerClass("mesh",OB);return new N(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:D,data:h4,getColor:F(e),pbrMaterial:b,modelMatrix:l,coordinateOrigin:s,coordinateSystem:g,featureIds:S,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(r=>{const n=t[r.id]=t[r.id]||{tile:r};let{layer:o}=n;return r.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(r,o),n.needsUpdate=!1):o=this._getSubLayer(r)),n.layer=o,o}).filter(Boolean):null}}_e(dC,"defaultProps",Cie),_e(dC,"layerName","Tile3DLayer");function Eie(i){const e={};return e.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(e.normals=i.normals),i.texCoords&&(e.texCoords=i.texCoords),i.colors&&(e.colors=i.colors),i.uvRegions&&(e.uvRegions=i.uvRegions),e}var A4={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(cf,function(){var t,r,n;function o(s,g){if(!t)t=g;else if(!r)r=g;else{var b="var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk);",S={};t(S),n=g(S),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}o(["exports"],function(s){function g(h,c,f,v){return new(f||(f=Promise))(function(E,M){function R(Z){try{K(v.next(Z))}catch(oe){M(oe)}}function G(Z){try{K(v.throw(Z))}catch(oe){M(oe)}}function K(Z){var oe;Z.done?E(Z.value):(oe=Z.value,oe instanceof f?oe:new f(function(de){de(oe)})).then(R,G)}K((v=v.apply(h,c||[])).next())})}function b(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var S=F;function F(h,c){this.x=h,this.y=c}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,c){return this.clone()._rotateAround(h,c)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var c=h.x-this.x,f=h.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,c){return Math.atan2(this.x*c-this.y*h,this.x*h+this.y*c)},_matMult:function(h){var c=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=c,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var c=Math.cos(h),f=Math.sin(h),v=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=v,this},_rotateAround:function(h,c){var f=Math.cos(h),v=Math.sin(h),E=c.y+v*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-v*(this.y-c.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(h){return h instanceof F?h:Array.isArray(h)?new F(h[0],h[1]):h};var D=b(S),N=J;function J(h,c,f,v){this.cx=3*h,this.bx=3*(f-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(v-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=c,this.p2x=f,this.p2y=v}J.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,c){if(c===void 0&&(c=1e-6),h<0)return 0;if(h>1)return 1;for(var f=h,v=0;v<8;v++){var E=this.sampleCurveX(f)-h;if(Math.abs(E)<c)return f;var M=this.sampleCurveDerivativeX(f);if(Math.abs(M)<1e-6)break;f-=E/M}var R=0,G=1;for(f=h,v=0;v<20&&(E=this.sampleCurveX(f),!(Math.abs(E-h)<c));v++)h>E?R=f:G=f,f=.5*(G-R)+R;return f},solve:function(h,c){return this.sampleCurveY(this.solveCurveX(h,c))}};var te=b(N);let he,ue;function fe(){return he==null&&(he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),he}function ve(){if(ue==null&&(ue=!1,fe())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let v=0;v<5*5;v++){const E=4*v;c.fillStyle=`rgb(${E},${E+1},${E+2})`,c.fillRect(v%5,Math.floor(v/5),1,1)}const f=c.getImageData(0,0,5,5).data;for(let v=0;v<5*5*4;v++)if(v%4!=3&&f[v]!==v){ue=!0;break}}}return ue||!1}function Se(h,c,f,v){const E=new te(h,c,f,v);return function(M){return E.solve(M)}}const Ge=Se(.25,.1,.25,1);function He(h,c,f){return Math.min(f,Math.max(c,h))}function $e(h,c,f){const v=f-c,E=((h-c)%v+v)%v+c;return E===c?f:E}function Ne(h){for(var c=arguments.length,f=new Array(c>1?c-1:0),v=1;v<c;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}let at=1;function rt(h,c,f){const v={};for(const E in h)v[E]=c.call(f||this,h[E],E,h);return v}function Re(h,c,f){const v={};for(const E in h)c.call(f||this,h[E],E,h)&&(v[E]=h[E]);return v}function Pe(h){return Array.isArray(h)?h.map(Pe):typeof h=="object"&&h?rt(h,Pe):h}const Je={};function Xe(h){Je[h]||(typeof console<"u"&&console.warn(h),Je[h]=!0)}function Ct(h,c,f){return(f.y-h.y)*(c.x-h.x)>(c.y-h.y)*(f.x-h.x)}function Et(h){let c=0;for(let f,v,E=0,M=h.length,R=M-1;E<M;R=E++)f=h[E],v=h[R],c+=(v.x-f.x)*(f.y+v.y);return c}function Mt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let vt=null;function Dt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xt(h,c,f,v,E){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const M=new VideoFrame(h,{timestamp:0});try{const R=M==null?void 0:M.format;if(!R||!R.startsWith("BGR")&&!R.startsWith("RGB"))throw new Error(`Unrecognized format ${R}`);const G=R.startsWith("BGR"),K=new Uint8ClampedArray(v*E*4);if(yield M.copyTo(K,function(Z,oe,de,ye,Ce){const Ie=4*Math.max(-oe,0),Oe=(Math.max(0,de)-de)*ye*4+Ie,qe=4*ye,Ke=Math.max(0,oe),ut=Math.max(0,de);return{rect:{x:Ke,y:ut,width:Math.min(Z.width,oe+ye)-Ke,height:Math.min(Z.height,de+Ce)-ut},layout:[{offset:Oe,stride:qe}]}}(h,c,f,v,E)),G)for(let Z=0;Z<K.length;Z+=4){const oe=K[Z];K[Z]=K[Z+2],K[Z+2]=oe}return K}finally{M.close()}})}let Te,Ze,tt,dt;const pt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h){const c=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(h).getImageData(-c,-c,h.width+2*c,h.height+2*c)},getImageCanvasContext(h){const c=window.document.createElement("canvas"),f=c.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return c.width=h.width,c.height=h.height,f.drawImage(h,0,0,h.width,h.height),f},resolveURL:h=>(tt||(tt=document.createElement("a")),tt.href=h,tt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(dt==null&&(dt=matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}},Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ft extends Error{constructor(c,f,v,E){super(`AJAXError: ${f} (${c}): ${v}`),this.status=c,this.statusText=f,this.url=v,this.body=E}}const Lt=Mt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Gt=h=>Bt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))];function ri(h,c){const f=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Lt(),signal:f.signal});let E=!1,M=!1;return h.type==="json"&&v.headers.set("Accept","application/json"),M||fetch(v).then(R=>R.ok?(G=>{(h.type==="arrayBuffer"||h.type==="image"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then(K=>{M||(E=!0,c(null,K,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(K=>{M||c(new Error(K.message))})})(R):R.blob().then(G=>c(new Ft(R.status,R.statusText,h.url,G)))).catch(R=>{R.code!==20&&c(new Error(R.message))}),{cancel:()=>{M=!0,E||f.abort()}}}const mi=function(h,c){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){if(Mt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c);if(!Mt())return(Gt(h.url)||ri)(h,c)}if(!(/^file:/.test(f=h.url)||/^file:/.test(Lt())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ri(h,c);if(Mt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c,void 0,!0)}var f;return function(v,E){const M=new XMLHttpRequest;M.open(v.method||"GET",v.url,!0),v.type!=="arrayBuffer"&&v.type!=="image"||(M.responseType="arraybuffer");for(const R in v.headers)M.setRequestHeader(R,v.headers[R]);return v.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=v.credentials==="include",M.onerror=()=>{E(new Error(M.statusText))},M.onload=()=>{if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let R=M.response;if(v.type==="json")try{R=JSON.parse(M.response)}catch(G){return E(G)}E(null,R,M.getResponseHeader("Cache-Control"),M.getResponseHeader("Expires"))}else{const R=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});E(new Ft(M.status,M.statusText,v.url,R))}},M.send(v.body),{cancel:()=>M.abort()}}(h,c)},yi=function(h,c){return mi(Ne(h,{type:"arrayBuffer"}),c)};function Pi(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const c=new URL(h),f=window.location;return c.protocol===f.protocol&&c.host===f.host}function Ot(h,c,f){f[h]&&f[h].indexOf(c)!==-1||(f[h]=f[h]||[],f[h].push(c))}function lt(h,c,f){if(f&&f[h]){const v=f[h].indexOf(c);v!==-1&&f[h].splice(v,1)}}class wt{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ne(this,f),this.type=c}}class ki extends wt{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Ne({error:c},f))}}class ti{on(c,f){return this._listeners=this._listeners||{},Ot(c,f,this._listeners),this}off(c,f){return lt(c,f,this._listeners),lt(c,f,this._oneTimeListeners),this}once(c,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},Ot(c,f,this._oneTimeListeners),this):new Promise(v=>this.once(c,v))}fire(c,f){typeof c=="string"&&(c=new wt(c,f||{}));const v=c.type;if(this.listens(v)){c.target=this;const E=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const G of E)G.call(this,c);const M=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const G of M)lt(v,G,this._oneTimeListeners),G.call(this,c);const R=this._eventedParent;R&&(Ne(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),R.fire(c))}else c instanceof ki&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,f){return this._eventedParent=c,this._eventedParentData=f,this}}var ht={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const qt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function si(h,c){const f={};for(const v in h)v!=="ref"&&(f[v]=h[v]);return qt.forEach(v=>{v in c&&(f[v]=c[v])}),f}function fi(h,c){if(Array.isArray(h)){if(!Array.isArray(c)||h.length!==c.length)return!1;for(let f=0;f<h.length;f++)if(!fi(h[f],c[f]))return!1;return!0}if(typeof h=="object"&&h!==null&&c!==null){if(typeof c!="object"||Object.keys(h).length!==Object.keys(c).length)return!1;for(const f in h)if(!fi(h[f],c[f]))return!1;return!0}return h===c}const ci={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Wi(h,c,f){f.push({command:ci.addSource,args:[h,c[h]]})}function ir(h,c,f){c.push({command:ci.removeSource,args:[h]}),f[h]=!0}function dr(h,c,f,v){ir(h,f,v),Wi(h,c,f)}function Sr(h,c,f){let v;for(v in h[f])if(Object.prototype.hasOwnProperty.call(h[f],v)&&v!=="data"&&!fi(h[f][v],c[f][v]))return!1;for(v in c[f])if(Object.prototype.hasOwnProperty.call(c[f],v)&&v!=="data"&&!fi(h[f][v],c[f][v]))return!1;return!0}function zt(h,c,f,v,E,M){let R;for(R in c=c||{},h=h||{})Object.prototype.hasOwnProperty.call(h,R)&&(fi(h[R],c[R])||f.push({command:M,args:[v,R,c[R],E]}));for(R in c)Object.prototype.hasOwnProperty.call(c,R)&&!Object.prototype.hasOwnProperty.call(h,R)&&(fi(h[R],c[R])||f.push({command:M,args:[v,R,c[R],E]}))}function Yi(h){return h.id}function ui(h,c){return h[c.id]=c,h}class Kt{constructor(c,f,v,E){this.message=(c?`${c}: `:"")+v,E&&(this.identifier=E),f!=null&&f.__line__&&(this.line=f.__line__)}}function Ji(h){for(var c=arguments.length,f=new Array(c>1?c-1:0),v=1;v<c;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}class Vt extends Error{constructor(c,f){super(f),this.message=f,this.key=c}}class Ci{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[v,E]of f)this.bindings[v]=E}concat(c){return new Ci(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Li={kind:"null"},jt={kind:"number"},bi={kind:"string"},Yt={kind:"boolean"},yr={kind:"color"},Tr={kind:"object"},Qe={kind:"value"},Be={kind:"collator"},ae={kind:"formatted"},ie={kind:"padding"},ce={kind:"resolvedImage"},me={kind:"variableAnchorOffsetCollection"};function be(h,c){return{kind:"array",itemType:h,N:c}}function Ee(h){if(h.kind==="array"){const c=Ee(h.itemType);return typeof h.N=="number"?`array<${c}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${c}>`}return h.kind}const xe=[Li,jt,bi,Yt,yr,ae,Tr,be(Qe),ie,ce,me];function Fe(h,c){if(c.kind==="error")return null;if(h.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Fe(h.itemType,c.itemType))&&(typeof h.N!="number"||h.N===c.N))return null}else{if(h.kind===c.kind)return null;if(h.kind==="value"){for(const f of xe)if(!Fe(f,c))return null}}return`Expected ${Ee(h)} but found ${Ee(c)} instead.`}function Ue(h,c){return c.some(f=>f.kind===h.kind)}function je(h,c){return c.some(f=>f==="null"?h===null:f==="array"?Array.isArray(h):f==="object"?h&&!Array.isArray(h)&&typeof h=="object":f===typeof h)}function nt(h,c){return h.kind==="array"&&c.kind==="array"?h.itemType.kind===c.itemType.kind&&typeof h.N=="number":h.kind===c.kind}const _t=.96422,St=.82521,ei=4/29,$t=6/29,Wt=3*$t*$t,oi=$t*$t*$t,Ei=Math.PI/180,Gi=180/Math.PI;function Bi(h){return(h%=360)<0&&(h+=360),h}function Ni(h){let[c,f,v,E]=h,M,R;const G=ii((.2225045*(c=ot(c))+.7168786*(f=ot(f))+.0606169*(v=ot(v)))/1);c===f&&f===v?M=R=G:(M=ii((.4360747*c+.3850649*f+.1430804*v)/_t),R=ii((.0139322*c+.0971045*f+.7141733*v)/St));const K=116*G-16;return[K<0?0:K,500*(M-G),200*(G-R),E]}function ot(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ii(h){return h>oi?Math.pow(h,1/3):h/Wt+ei}function Qt(h){let[c,f,v,E]=h,M=(c+16)/116,R=isNaN(f)?M:M+f/500,G=isNaN(v)?M:M-v/200;return M=1*Ar(M),R=_t*Ar(R),G=St*Ar(G),[Qi(3.1338561*R-1.6168667*M-.4906146*G),Qi(-.9787684*R+1.9161415*M+.033454*G),Qi(.0719453*R-.2289914*M+1.4052427*G),E]}function Qi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Ar(h){return h>$t?h*h*h:Wt*(h-ei)}function on(h){return parseInt(h.padEnd(2,h),16)/255}function xn(h,c){return hr(c?h/100:h,0,1)}function hr(h,c,f){return Math.min(Math.max(c,h),f)}function mn(h){return!h.some(Number.isNaN)}const yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class cr{constructor(c,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=f,this.b=v,this.a=E,M||(this.r*=E,this.g*=E,this.b*=E,E||this.overwriteGetter("rgb",[c,f,v,E]))}static parse(c){if(c instanceof cr)return c;if(typeof c!="string")return;const f=function(v){if((v=v.toLowerCase().trim())==="transparent")return[0,0,0,0];const E=yn[v];if(E){const[R,G,K]=E;return[R/255,G/255,K/255,1]}if(v.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(v)){const R=v.length<6?1:2;let G=1;return[on(v.slice(G,G+=R)),on(v.slice(G,G+=R)),on(v.slice(G,G+=R)),on(v.slice(G,G+R)||"ff")]}if(v.startsWith("rgb")){const R=v.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(R){const[G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut]=R,et=[oe||" ",Ce||" ",qe].join("");if(et==="  "||et==="  /"||et===",,"||et===",,,"){const it=[Z,ye,Oe].join(""),mt=it==="%%%"?100:it===""?255:0;if(mt){const Tt=[hr(+K/mt,0,1),hr(+de/mt,0,1),hr(+Ie/mt,0,1),Ke?xn(+Ke,ut):1];if(mn(Tt))return Tt}}return}}const M=v.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[R,G,K,Z,oe,de,ye,Ce,Ie]=M,Oe=[K||" ",oe||" ",ye].join("");if(Oe==="  "||Oe==="  /"||Oe===",,"||Oe===",,,"){const qe=[+G,hr(+Z,0,100),hr(+de,0,100),Ce?xn(+Ce,Ie):1];if(mn(qe))return function(Ke){let[ut,et,it,mt]=Ke;function Tt(Zt){const wi=(Zt+ut/30)%12,ai=et*Math.min(it,1-it);return it-ai*Math.max(-1,Math.min(wi-3,9-wi,1))}return ut=Bi(ut),et/=100,it/=100,[Tt(0),Tt(8),Tt(4),mt]}(qe)}}}(c);return f?new cr(...f,!1):void 0}get rgb(){const{r:c,g:f,b:v,a:E}=this,M=E||1/0;return this.overwriteGetter("rgb",[c/M,f/M,v/M,E])}get hcl(){return this.overwriteGetter("hcl",function(c){const[f,v,E,M]=Ni(c),R=Math.sqrt(v*v+E*E);return[Math.round(1e4*R)?Bi(Math.atan2(E,v)*Gi):NaN,R,f,M]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ni(this.rgb))}overwriteGetter(c,f){return Object.defineProperty(this,c,{value:f}),f}toString(){const[c,f,v,E]=this.rgb;return`rgba(${[c,f,v].map(M=>Math.round(255*M)).join(",")},${E})`}}cr.black=new cr(0,0,0,1),cr.white=new cr(1,1,1,1),cr.transparent=new cr(0,0,0,0),cr.red=new cr(1,0,0,1);class On{constructor(c,f,v){this.sensitivity=c?f?"variant":"case":f?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,f){return this.collator.compare(c,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ms{constructor(c,f,v,E,M){this.text=c,this.image=f,this.scale=v,this.fontStack=E,this.textColor=M}}class Vr{constructor(c){this.sections=c}static fromString(c){return new Vr([new ms(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Vr?c:Vr.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class wn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof wn)return c;if(typeof c=="number")return new wn([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const f of c)if(typeof f!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new wn(c)}}toString(){return JSON.stringify(this.values)}}const To=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hs{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof hs)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let f=0;f<c.length;f+=2){const v=c[f],E=c[f+1];if(typeof v!="string"||!To.has(v)||!Array.isArray(E)||E.length!==2||typeof E[0]!="number"||typeof E[1]!="number")return}return new hs(c)}}toString(){return JSON.stringify(this.values)}}class Xi{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Xi({name:c,available:!1}):null}}function eo(h,c,f,v){return typeof h=="number"&&h>=0&&h<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[h,c,f,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[h,c,f,v]:[h,c,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Cs(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof cr||h instanceof On||h instanceof Vr||h instanceof wn||h instanceof hs||h instanceof Xi)return!0;if(Array.isArray(h)){for(const c of h)if(!Cs(c))return!1;return!0}if(typeof h=="object"){for(const c in h)if(!Cs(h[c]))return!1;return!0}return!1}function fr(h){if(h===null)return Li;if(typeof h=="string")return bi;if(typeof h=="boolean")return Yt;if(typeof h=="number")return jt;if(h instanceof cr)return yr;if(h instanceof On)return Be;if(h instanceof Vr)return ae;if(h instanceof wn)return ie;if(h instanceof hs)return me;if(h instanceof Xi)return ce;if(Array.isArray(h)){const c=h.length;let f;for(const v of h){const E=fr(v);if(f){if(f===E)continue;f=Qe;break}f=E}return be(f||Qe,c)}return Tr}function Dr(h){const c=typeof h;return h===null?"":c==="string"||c==="number"||c==="boolean"?String(h):h instanceof cr||h instanceof Vr||h instanceof wn||h instanceof hs||h instanceof Xi?h.toString():JSON.stringify(h)}class Gn{constructor(c,f){this.type=c,this.value=f}static parse(c,f){if(c.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Cs(c[1]))return f.error("invalid value");const v=c[1];let E=fr(v);const M=f.expectedType;return E.kind!=="array"||E.N!==0||!M||M.kind!=="array"||typeof M.N=="number"&&M.N!==0||(E=M),new Gn(E,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ur{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Sn={string:bi,number:jt,boolean:Yt,object:Tr};class dn{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");let v,E=1;const M=c[0];if(M==="array"){let G,K;if(c.length>2){const Z=c[1];if(typeof Z!="string"||!(Z in Sn)||Z==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);G=Sn[Z],E++}else G=Qe;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return f.error('The length argument to "array" must be a positive integer literal',2);K=c[2],E++}v=be(G,K)}else{if(!Sn[M])throw new Error(`Types doesn't contain name = ${M}`);v=Sn[M]}const R=[];for(;E<c.length;E++){const G=f.parse(c[E],E,Qe);if(!G)return null;R.push(G)}return new dn(v,R)}evaluate(c){for(let f=0;f<this.args.length;f++){const v=this.args[f].evaluate(c);if(!Fe(this.type,fr(v)))return v;if(f===this.args.length-1)throw new Ur(`Expected value to be of type ${Ee(this.type)}, but found ${Ee(fr(v))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Gr={"to-boolean":Yt,"to-color":yr,"to-number":jt,"to-string":bi};class js{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[0];if(!Gr[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&c.length!==2)return f.error("Expected one argument.");const E=Gr[v],M=[];for(let R=1;R<c.length;R++){const G=f.parse(c[R],R,Qe);if(!G)return null;M.push(G)}return new js(E,M)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let f,v;for(const E of this.args){if(f=E.evaluate(c),v=null,f instanceof cr)return f;if(typeof f=="string"){const M=c.parseColor(f);if(M)return M}else if(Array.isArray(f)&&(v=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:eo(f[0],f[1],f[2],f[3]),!v))return new cr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Ur(v||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const v of this.args){f=v.evaluate(c);const E=wn.parse(f);if(E)return E}throw new Ur(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const v of this.args){f=v.evaluate(c);const E=hs.parse(f);if(E)return E}throw new Ur(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const v of this.args){if(f=v.evaluate(c),f===null)return 0;const E=Number(f);if(!isNaN(E))return E}throw new Ur(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Vr.fromString(Dr(this.args[0].evaluate(c)));case"resolvedImage":return Xi.fromString(Dr(this.args[0].evaluate(c)));default:return Dr(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const ha=["Unknown","Point","LineString","Polygon"];class ho{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ha[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let f=this._parseColorCache[c];return f||(f=this._parseColorCache[c]=cr.parse(c)),f}}class Ta{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],E=arguments.length>3?arguments[3]:void 0,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Ci,R=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=v,this.key=v.map(G=>`[${G}]`).join(""),this.scope=M,this.errors=R,this.expectedType=E,this._isConstant=f}parse(c,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return f?this.concat(f,v,E)._parse(c,M):this._parse(c,M)}_parse(c,f){function v(E,M,R){return R==="assert"?new dn(M,[E]):R==="coerce"?new js(M,[E]):E}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const E=c[0];if(typeof E!="string")return this.error(`Expression name must be a string, but found ${typeof E} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const M=this.registry[E];if(M){let R=M.parse(c,this);if(!R)return null;if(this.expectedType){const G=this.expectedType,K=R.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||K.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||K.kind!=="value"&&K.kind!=="string")if(G.kind!=="padding"||K.kind!=="value"&&K.kind!=="number"&&K.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||K.kind!=="value"&&K.kind!=="array"){if(this.checkSubtype(G,K))return null}else R=v(R,G,f.typeAnnotation||"coerce");else R=v(R,G,f.typeAnnotation||"coerce");else R=v(R,G,f.typeAnnotation||"coerce");else R=v(R,G,f.typeAnnotation||"assert")}if(!(R instanceof Gn)&&R.type.kind!=="resolvedImage"&&this._isConstant(R)){const G=new ho;try{R=new Gn(R.type,R.evaluate(G))}catch(K){return this.error(K.message),null}}return R}return this.error(`Unknown expression "${E}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,f,v){const E=typeof c=="number"?this.path.concat(c):this.path,M=v?this.scope.concat(v):this.scope;return new Ta(this.registry,this._isConstant,E,f||null,M,this.errors)}error(c){for(var f=arguments.length,v=new Array(f>1?f-1:0),E=1;E<f;E++)v[E-1]=arguments[E];const M=`${this.key}${v.map(R=>`[${R}]`).join("")}`;this.errors.push(new Vt(M,c))}checkSubtype(c,f){const v=Fe(c,f);return v&&this.error(v),v}}class ze{constructor(c,f,v){this.type=Be,this.locale=v,this.caseSensitive=c,this.diacriticSensitive=f}static parse(c,f){if(c.length!==2)return f.error("Expected one argument.");const v=c[1];if(typeof v!="object"||Array.isArray(v))return f.error("Collator options argument must be an object.");const E=f.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,Yt);if(!E)return null;const M=f.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,Yt);if(!M)return null;let R=null;return v.locale&&(R=f.parse(v.locale,1,bi),!R)?null:new ze(E,M,R)}evaluate(c){return new On(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const Ye=8192;function ft(h,c){h[0]=Math.min(h[0],c[0]),h[1]=Math.min(h[1],c[1]),h[2]=Math.max(h[2],c[0]),h[3]=Math.max(h[3],c[1])}function Ut(h,c){return!(h[0]<=c[0]||h[2]>=c[2]||h[1]<=c[1]||h[3]>=c[3])}function hi(h,c){const f=(180+h[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,E=Math.pow(2,c.z);return[Math.round(f*E*Ye),Math.round(v*E*Ye)]}function ji(h,c,f){const v=h[0]-c[0],E=h[1]-c[1],M=h[0]-f[0],R=h[1]-f[1];return v*R-M*E==0&&v*M<=0&&E*R<=0}function xr(h,c){let f=!1;for(let R=0,G=c.length;R<G;R++){const K=c[R];for(let Z=0,oe=K.length;Z<oe-1;Z++){if(ji(h,K[Z],K[Z+1]))return!1;(E=K[Z])[1]>(v=h)[1]!=(M=K[Z+1])[1]>v[1]&&v[0]<(M[0]-E[0])*(v[1]-E[1])/(M[1]-E[1])+E[0]&&(f=!f)}}var v,E,M;return f}function Tn(h,c){for(let f=0;f<c.length;f++)if(xr(h,c[f]))return!0;return!1}function Un(h,c,f,v){const E=v[0]-f[0],M=v[1]-f[1],R=(h[0]-f[0])*M-E*(h[1]-f[1]),G=(c[0]-f[0])*M-E*(c[1]-f[1]);return R>0&&G<0||R<0&&G>0}function ns(h,c,f){for(const Z of f)for(let oe=0;oe<Z.length-1;++oe)if((G=[(R=Z[oe+1])[0]-(M=Z[oe])[0],R[1]-M[1]])[0]*(K=[(E=c)[0]-(v=h)[0],E[1]-v[1]])[1]-G[1]*K[0]!=0&&Un(v,E,M,R)&&Un(M,R,v,E))return!0;var v,E,M,R,G,K;return!1}function Bn(h,c){for(let f=0;f<h.length;++f)if(!xr(h[f],c))return!1;for(let f=0;f<h.length-1;++f)if(ns(h[f],h[f+1],c))return!1;return!0}function lu(h,c){for(let f=0;f<c.length;f++)if(Bn(h,c[f]))return!0;return!1}function Ka(h,c,f){const v=[];for(let E=0;E<h.length;E++){const M=[];for(let R=0;R<h[E].length;R++){const G=hi(h[E][R],f);ft(c,G),M.push(G)}v.push(M)}return v}function Ir(h,c,f){const v=[];for(let E=0;E<h.length;E++){const M=Ka(h[E],c,f);v.push(M)}return v}function Wa(h,c,f,v){if(h[0]<f[0]||h[0]>f[2]){const E=.5*v;let M=h[0]-f[0]>E?-v:f[0]-h[0]>E?v:0;M===0&&(M=h[0]-f[2]>E?-v:f[2]-h[0]>E?v:0),h[0]+=M}ft(c,h)}function Nl(h,c,f,v){const E=Math.pow(2,v.z)*Ye,M=[v.x*Ye,v.y*Ye],R=[];for(const G of h)for(const K of G){const Z=[K.x+M[0],K.y+M[1]];Wa(Z,c,f,E),R.push(Z)}return R}function es(h,c,f,v){const E=Math.pow(2,v.z)*Ye,M=[v.x*Ye,v.y*Ye],R=[];for(const K of h){const Z=[];for(const oe of K){const de=[oe.x+M[0],oe.y+M[1]];ft(c,de),Z.push(de)}R.push(Z)}if(c[2]-c[0]<=E/2){(G=c)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(const K of R)for(const Z of K)Wa(Z,c,f,E)}var G;return R}class Io{constructor(c,f){this.type=Yt,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Cs(c[1])){const v=c[1];if(v.type==="FeatureCollection")for(let E=0;E<v.features.length;++E){const M=v.features[E].geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new Io(v,v.features[E].geometry)}else if(v.type==="Feature"){const E=v.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Io(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new Io(v,v)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],R=f.canonicalID();if(v.type==="Polygon"){const G=Ka(v.coordinates,M,R),K=Nl(f.geometry(),E,M,R);if(!Ut(E,M))return!1;for(const Z of K)if(!xr(Z,G))return!1}if(v.type==="MultiPolygon"){const G=Ir(v.coordinates,M,R),K=Nl(f.geometry(),E,M,R);if(!Ut(E,M))return!1;for(const Z of K)if(!Tn(Z,G))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],R=f.canonicalID();if(v.type==="Polygon"){const G=Ka(v.coordinates,M,R),K=es(f.geometry(),E,M,R);if(!Ut(E,M))return!1;for(const Z of K)if(!Bn(Z,G))return!1}if(v.type==="MultiPolygon"){const G=Ir(v.coordinates,M,R),K=es(f.geometry(),E,M,R);if(!Ut(E,M))return!1;for(const Z of K)if(!lu(Z,G))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Xa{constructor(c,f){this.type=f.type,this.name=c,this.boundExpression=f}static parse(c,f){if(c.length!==2||typeof c[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const v=c[1];return f.scope.has(v)?new Xa(v,f.scope.get(v)):f.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class ys{constructor(c,f,v,E){this.name=c,this.type=f,this._evaluate=v,this.args=E}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,f){const v=c[0],E=ys.definitions[v];if(!E)return f.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const M=Array.isArray(E)?E[0]:E.type,R=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,G=R.filter(Z=>{let[oe]=Z;return!Array.isArray(oe)||oe.length===c.length-1});let K=null;for(const[Z,oe]of G){K=new Ta(f.registry,Aa,f.path,null,f.scope);const de=[];let ye=!1;for(let Ce=1;Ce<c.length;Ce++){const Ie=c[Ce],Oe=Array.isArray(Z)?Z[Ce-1]:Z.type,qe=K.parse(Ie,1+de.length,Oe);if(!qe){ye=!0;break}de.push(qe)}if(!ye)if(Array.isArray(Z)&&Z.length!==de.length)K.error(`Expected ${Z.length} arguments, but found ${de.length} instead.`);else{for(let Ce=0;Ce<de.length;Ce++){const Ie=Array.isArray(Z)?Z[Ce]:Z.type,Oe=de[Ce];K.concat(Ce+1).checkSubtype(Ie,Oe.type)}if(K.errors.length===0)return new ys(v,M,oe,de)}}if(G.length===1)f.errors.push(...K.errors);else{const Z=(G.length?G:R).map(de=>{let[ye]=de;return Ce=ye,Array.isArray(Ce)?`(${Ce.map(Ee).join(", ")})`:`(${Ee(Ce.type)}...)`;var Ce}).join(" | "),oe=[];for(let de=1;de<c.length;de++){const ye=f.parse(c[de],1+oe.length);if(!ye)return null;oe.push(Ee(ye.type))}f.error(`Expected arguments of type ${Z}, but found (${oe.join(", ")}) instead.`)}return null}static register(c,f){ys.definitions=f;for(const v in f)c[v]=ys}}function Aa(h){if(h instanceof Xa)return Aa(h.boundExpression);if(h instanceof ys&&h.name==="error"||h instanceof ze||h instanceof Io)return!1;const c=h instanceof js||h instanceof dn;let f=!0;return h.eachChild(v=>{f=c?f&&Aa(v):f&&v instanceof Gn}),!!f&&Za(h)&&Dc(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Za(h){if(h instanceof ys&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Io)return!1;let c=!0;return h.eachChild(f=>{c&&!Za(f)&&(c=!1)}),c}function Ia(h){if(h instanceof ys&&h.name==="feature-state")return!1;let c=!0;return h.eachChild(f=>{c&&!Ia(f)&&(c=!1)}),c}function Dc(h,c){if(h instanceof ys&&c.indexOf(h.name)>=0)return!1;let f=!0;return h.eachChild(v=>{f&&!Dc(v,c)&&(f=!1)}),f}function Ja(h,c){const f=h.length-1;let v,E,M=0,R=f,G=0;for(;M<=R;)if(G=Math.floor((M+R)/2),v=h[G],E=h[G+1],v<=c){if(G===f||c<E)return G;M=G+1}else{if(!(v>c))throw new Ur("Input is not a number.");R=G-1}return 0}class Ao{constructor(c,f,v){this.type=c,this.input=f,this.labels=[],this.outputs=[];for(const[E,M]of v)this.labels.push(E),this.outputs.push(M)}static parse(c,f){if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");const v=f.parse(c[1],1,jt);if(!v)return null;const E=[];let M=null;f.expectedType&&f.expectedType.kind!=="value"&&(M=f.expectedType);for(let R=1;R<c.length;R+=2){const G=R===1?-1/0:c[R],K=c[R+1],Z=R,oe=R+1;if(typeof G!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(E.length&&E[E.length-1][0]>=G)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Z);const de=f.parse(K,oe,M);if(!de)return null;M=M||de.type,E.push([G,de])}return new Ao(M,v,E)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const E=this.input.evaluate(c);if(E<=f[0])return v[0].evaluate(c);const M=f.length;return E>=f[M-1]?v[M-1].evaluate(c):v[Ja(f,E)].evaluate(c)}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Fr(h,c,f){return h+f*(c-h)}function da(h,c,f){return h.map((v,E)=>Fr(v,c[E],f))}const As={number:Fr,color:function(h,c,f){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[E,M,R,G]=da(h.rgb,c.rgb,f);return new cr(E,M,R,G,!1)}case"hcl":{const[E,M,R,G]=h.hcl,[K,Z,oe,de]=c.hcl;let ye,Ce;if(isNaN(E)||isNaN(K))isNaN(E)?isNaN(K)?ye=NaN:(ye=K,R!==1&&R!==0||(Ce=Z)):(ye=E,oe!==1&&oe!==0||(Ce=M));else{let ut=K-E;K>E&&ut>180?ut-=360:K<E&&E-K>180&&(ut+=360),ye=E+f*ut}const[Ie,Oe,qe,Ke]=function(ut){let[et,it,mt,Tt]=ut;return et=isNaN(et)?0:et*Ei,Qt([mt,Math.cos(et)*it,Math.sin(et)*it,Tt])}([ye,Ce??Fr(M,Z,f),Fr(R,oe,f),Fr(G,de,f)]);return new cr(Ie,Oe,qe,Ke,!1)}case"lab":{const[E,M,R,G]=Qt(da(h.lab,c.lab,f));return new cr(E,M,R,G,!1)}}},array:da,padding:function(h,c,f){return new wn(da(h.values,c.values,f))},variableAnchorOffsetCollection:function(h,c,f){const v=h.values,E=c.values;if(v.length!==E.length)throw new Ur(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${c.toString()}`);const M=[];for(let R=0;R<v.length;R+=2){if(v[R]!==E[R])throw new Ur(`Cannot interpolate values containing mismatched anchors. from[${R}]: ${v[R]}, to[${R}]: ${E[R]}`);M.push(v[R]);const[G,K]=v[R+1],[Z,oe]=E[R+1];M.push([Fr(G,Z,f),Fr(K,oe,f)])}return new hs(M)}};class fn{constructor(c,f,v,E,M){this.type=c,this.operator=f,this.interpolation=v,this.input=E,this.labels=[],this.outputs=[];for(const[R,G]of M)this.labels.push(R),this.outputs.push(G)}static interpolationFactor(c,f,v,E){let M=0;if(c.name==="exponential")M=ss(f,c.base,v,E);else if(c.name==="linear")M=ss(f,1,v,E);else if(c.name==="cubic-bezier"){const R=c.controlPoints;M=new te(R[0],R[1],R[2],R[3]).solve(ss(f,1,v,E))}return M}static parse(c,f){let[v,E,M,...R]=c;if(!Array.isArray(E)||E.length===0)return f.error("Expected an interpolation type expression.",1);if(E[0]==="linear")E={name:"linear"};else if(E[0]==="exponential"){const Z=E[1];if(typeof Z!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);E={name:"exponential",base:Z}}else{if(E[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(E[0])}`,1,0);{const Z=E.slice(1);if(Z.length!==4||Z.some(oe=>typeof oe!="number"||oe<0||oe>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);E={name:"cubic-bezier",controlPoints:Z}}}if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(M=f.parse(M,2,jt),!M)return null;const G=[];let K=null;v==="interpolate-hcl"||v==="interpolate-lab"?K=yr:f.expectedType&&f.expectedType.kind!=="value"&&(K=f.expectedType);for(let Z=0;Z<R.length;Z+=2){const oe=R[Z],de=R[Z+1],ye=Z+3,Ce=Z+4;if(typeof oe!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ye);if(G.length&&G[G.length-1][0]>=oe)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ye);const Ie=f.parse(de,Ce,K);if(!Ie)return null;K=K||Ie.type,G.push([oe,Ie])}return nt(K,jt)||nt(K,yr)||nt(K,ie)||nt(K,me)||nt(K,be(jt))?new fn(K,v,E,M,G):f.error(`Type ${Ee(K)} is not interpolatable.`)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const E=this.input.evaluate(c);if(E<=f[0])return v[0].evaluate(c);const M=f.length;if(E>=f[M-1])return v[M-1].evaluate(c);const R=Ja(f,E),G=fn.interpolationFactor(this.interpolation,E,f[R],f[R+1]),K=v[R].evaluate(c),Z=v[R+1].evaluate(c);switch(this.operator){case"interpolate":return As[this.type.kind](K,Z,G);case"interpolate-hcl":return As.color(K,Z,G,"hcl");case"interpolate-lab":return As.color(K,Z,G,"lab")}}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function ss(h,c,f,v){const E=v-f,M=h-f;return E===0?0:c===1?M/E:(Math.pow(c,M)-1)/(Math.pow(c,E)-1)}class Hr{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expectected at least one argument.");let v=null;const E=f.expectedType;E&&E.kind!=="value"&&(v=E);const M=[];for(const G of c.slice(1)){const K=f.parse(G,1+M.length,v,void 0,{typeAnnotation:"omit"});if(!K)return null;v=v||K.type,M.push(K)}if(!v)throw new Error("No output type");const R=E&&M.some(G=>Fe(E,G.type));return new Hr(R?Qe:v,M)}evaluate(c){let f,v=null,E=0;for(const M of this.args)if(E++,v=M.evaluate(c),v&&v instanceof Xi&&!v.available&&(f||(f=v.name),v=null,E===this.args.length&&(v=f)),v!==null)break;return v}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class Ya{constructor(c,f){this.type=f.type,this.bindings=[].concat(c),this.result=f}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const f of this.bindings)c(f[1]);c(this.result)}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const v=[];for(let M=1;M<c.length-1;M+=2){const R=c[M];if(typeof R!="string")return f.error(`Expected string, but found ${typeof R} instead.`,M);if(/[^a-zA-Z0-9_]/.test(R))return f.error("Variable names must contain only alphanumeric characters or '_'.",M);const G=f.parse(c[M+1],M+1);if(!G)return null;v.push([R,G])}const E=f.parse(c[c.length-1],c.length-1,f.expectedType,v);return E?new Ya(v,E):null}outputDefined(){return this.result.outputDefined()}}class ul{constructor(c,f,v){this.type=c,this.index=f,this.input=v}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,jt),E=f.parse(c[2],2,be(f.expectedType||Qe));return v&&E?new ul(E.type.itemType,v,E):null}evaluate(c){const f=this.index.evaluate(c),v=this.input.evaluate(c);if(f<0)throw new Ur(`Array index out of bounds: ${f} < 0.`);if(f>=v.length)throw new Ur(`Array index out of bounds: ${f} > ${v.length-1}.`);if(f!==Math.floor(f))throw new Ur(`Array index must be an integer, but found ${f} instead.`);return v[f]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class zl{constructor(c,f){this.type=Yt,this.needle=c,this.haystack=f}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,Qe),E=f.parse(c[2],2,Qe);return v&&E?Ue(v.type,[Yt,bi,jt,Li,Qe])?new zl(v,E):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(v.type)} instead`):null}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!v)return!1;if(!je(f,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(fr(f))} instead.`);if(!je(v,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Ee(fr(v))} instead.`);return v.indexOf(f)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Lo{constructor(c,f,v){this.type=jt,this.needle=c,this.haystack=f,this.fromIndex=v}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,Qe),E=f.parse(c[2],2,Qe);if(!v||!E)return null;if(!Ue(v.type,[Yt,bi,jt,Li,Qe]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(v.type)} instead`);if(c.length===4){const M=f.parse(c[3],3,jt);return M?new Lo(v,E,M):null}return new Lo(v,E)}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!je(f,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(fr(f))} instead.`);if(!je(v,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Ee(fr(v))} instead.`);if(this.fromIndex){const E=this.fromIndex.evaluate(c);return v.indexOf(f,E)}return v.indexOf(f)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Xo{constructor(c,f,v,E,M,R){this.inputType=c,this.type=f,this.input=v,this.cases=E,this.outputs=M,this.otherwise=R}static parse(c,f){if(c.length<5)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return f.error("Expected an even number of arguments.");let v,E;f.expectedType&&f.expectedType.kind!=="value"&&(E=f.expectedType);const M={},R=[];for(let Z=2;Z<c.length-1;Z+=2){let oe=c[Z];const de=c[Z+1];Array.isArray(oe)||(oe=[oe]);const ye=f.concat(Z);if(oe.length===0)return ye.error("Expected at least one branch label.");for(const Ie of oe){if(typeof Ie!="number"&&typeof Ie!="string")return ye.error("Branch labels must be numbers or strings.");if(typeof Ie=="number"&&Math.abs(Ie)>Number.MAX_SAFE_INTEGER)return ye.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ie=="number"&&Math.floor(Ie)!==Ie)return ye.error("Numeric branch labels must be integer values.");if(v){if(ye.checkSubtype(v,fr(Ie)))return null}else v=fr(Ie);if(M[String(Ie)]!==void 0)return ye.error("Branch labels must be unique.");M[String(Ie)]=R.length}const Ce=f.parse(de,Z,E);if(!Ce)return null;E=E||Ce.type,R.push(Ce)}const G=f.parse(c[1],1,Qe);if(!G)return null;const K=f.parse(c[c.length-1],c.length-1,E);return K?G.type.kind!=="value"&&f.concat(1).checkSubtype(v,G.type)?null:new Xo(v,E,G,M,R,K):null}evaluate(c){const f=this.input.evaluate(c);return(fr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class fc{constructor(c,f,v){this.type=c,this.branches=f,this.otherwise=v}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return f.error("Expected an odd number of arguments.");let v;f.expectedType&&f.expectedType.kind!=="value"&&(v=f.expectedType);const E=[];for(let R=1;R<c.length-1;R+=2){const G=f.parse(c[R],R,Yt);if(!G)return null;const K=f.parse(c[R+1],R+1,v);if(!K)return null;E.push([G,K]),v=v||K.type}const M=f.parse(c[c.length-1],c.length-1,v);if(!M)return null;if(!v)throw new Error("Can't infer output type");return new fc(v,E,M)}evaluate(c){for(const[f,v]of this.branches)if(f.evaluate(c))return v.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[f,v]of this.branches)c(f),c(v);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[f,v]=c;return v.outputDefined()})&&this.otherwise.outputDefined()}}class Zo{constructor(c,f,v,E){this.type=c,this.input=f,this.beginIndex=v,this.endIndex=E}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,Qe),E=f.parse(c[2],2,jt);if(!v||!E)return null;if(!Ue(v.type,[be(Qe),bi,Qe]))return f.error(`Expected first argument to be of type array or string, but found ${Ee(v.type)} instead`);if(c.length===4){const M=f.parse(c[3],3,jt);return M?new Zo(v.type,v,E,M):null}return new Zo(v.type,v,E)}evaluate(c){const f=this.input.evaluate(c),v=this.beginIndex.evaluate(c);if(!je(f,["string","array"]))throw new Ur(`Expected first argument to be of type array or string, but found ${Ee(fr(f))} instead.`);if(this.endIndex){const E=this.endIndex.evaluate(c);return f.slice(v,E)}return f.slice(v)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function fo(h,c){return h==="=="||h==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function pc(h,c,f,v){return v.compare(c,f)===0}function Jo(h,c,f){const v=h!=="=="&&h!=="!=";return class g8{constructor(M,R,G){this.type=Yt,this.lhs=M,this.rhs=R,this.collator=G,this.hasUntypedArgument=M.type.kind==="value"||R.type.kind==="value"}static parse(M,R){if(M.length!==3&&M.length!==4)return R.error("Expected two or three arguments.");const G=M[0];let K=R.parse(M[1],1,Qe);if(!K)return null;if(!fo(G,K.type))return R.concat(1).error(`"${G}" comparisons are not supported for type '${Ee(K.type)}'.`);let Z=R.parse(M[2],2,Qe);if(!Z)return null;if(!fo(G,Z.type))return R.concat(2).error(`"${G}" comparisons are not supported for type '${Ee(Z.type)}'.`);if(K.type.kind!==Z.type.kind&&K.type.kind!=="value"&&Z.type.kind!=="value")return R.error(`Cannot compare types '${Ee(K.type)}' and '${Ee(Z.type)}'.`);v&&(K.type.kind==="value"&&Z.type.kind!=="value"?K=new dn(Z.type,[K]):K.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new dn(K.type,[Z])));let oe=null;if(M.length===4){if(K.type.kind!=="string"&&Z.type.kind!=="string"&&K.type.kind!=="value"&&Z.type.kind!=="value")return R.error("Cannot use collator to compare non-string types.");if(oe=R.parse(M[3],3,Be),!oe)return null}return new g8(K,Z,oe)}evaluate(M){const R=this.lhs.evaluate(M),G=this.rhs.evaluate(M);if(v&&this.hasUntypedArgument){const K=fr(R),Z=fr(G);if(K.kind!==Z.kind||K.kind!=="string"&&K.kind!=="number")throw new Ur(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${K.kind}, ${Z.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const K=fr(R),Z=fr(G);if(K.kind!=="string"||Z.kind!=="string")return c(M,R,G)}return this.collator?f(M,R,G,this.collator.evaluate(M)):c(M,R,G)}eachChild(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)}outputDefined(){return!0}}}const Ql=Jo("==",function(h,c,f){return c===f},pc),Rc=Jo("!=",function(h,c,f){return c!==f},function(h,c,f,v){return!pc(0,c,f,v)}),bh=Jo("<",function(h,c,f){return c<f},function(h,c,f,v){return v.compare(c,f)<0}),cu=Jo(">",function(h,c,f){return c>f},function(h,c,f,v){return v.compare(c,f)>0}),uu=Jo("<=",function(h,c,f){return c<=f},function(h,c,f,v){return v.compare(c,f)<=0}),ku=Jo(">=",function(h,c,f){return c>=f},function(h,c,f,v){return v.compare(c,f)>=0});class Vl{constructor(c,f,v,E,M){this.type=bi,this.number=c,this.locale=f,this.currency=v,this.minFractionDigits=E,this.maxFractionDigits=M}static parse(c,f){if(c.length!==3)return f.error("Expected two arguments.");const v=f.parse(c[1],1,jt);if(!v)return null;const E=c[2];if(typeof E!="object"||Array.isArray(E))return f.error("NumberFormat options argument must be an object.");let M=null;if(E.locale&&(M=f.parse(E.locale,1,bi),!M))return null;let R=null;if(E.currency&&(R=f.parse(E.currency,1,bi),!R))return null;let G=null;if(E["min-fraction-digits"]&&(G=f.parse(E["min-fraction-digits"],1,jt),!G))return null;let K=null;return E["max-fraction-digits"]&&(K=f.parse(E["max-fraction-digits"],1,jt),!K)?null:new Vl(v,M,R,G,K)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(c){this.type=ae,this.sections=c}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[1];if(!Array.isArray(v)&&typeof v=="object")return f.error("First argument must be an image or text section.");const E=[];let M=!1;for(let R=1;R<=c.length-1;++R){const G=c[R];if(M&&typeof G=="object"&&!Array.isArray(G)){M=!1;let K=null;if(G["font-scale"]&&(K=f.parse(G["font-scale"],1,jt),!K))return null;let Z=null;if(G["text-font"]&&(Z=f.parse(G["text-font"],1,be(bi)),!Z))return null;let oe=null;if(G["text-color"]&&(oe=f.parse(G["text-color"],1,yr),!oe))return null;const de=E[E.length-1];de.scale=K,de.font=Z,de.textColor=oe}else{const K=f.parse(c[R],1,Qe);if(!K)return null;const Z=K.type.kind;if(Z!=="string"&&Z!=="value"&&Z!=="null"&&Z!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");M=!0,E.push({content:K,scale:null,font:null,textColor:null})}}return new el(E)}evaluate(c){return new Vr(this.sections.map(f=>{const v=f.content.evaluate(c);return fr(v)===ce?new ms("",v,null,null,null):new ms(Dr(v),null,f.scale?f.scale.evaluate(c):null,f.font?f.font.evaluate(c).join(","):null,f.textColor?f.textColor.evaluate(c):null)}))}eachChild(c){for(const f of this.sections)c(f.content),f.scale&&c(f.scale),f.font&&c(f.font),f.textColor&&c(f.textColor)}outputDefined(){return!1}}class tl{constructor(c){this.type=ce,this.input=c}static parse(c,f){if(c.length!==2)return f.error("Expected two arguments.");const v=f.parse(c[1],1,bi);return v?new tl(v):f.error("No image name provided.")}evaluate(c){const f=this.input.evaluate(c),v=Xi.fromString(f);return v&&c.availableImages&&(v.available=c.availableImages.indexOf(f)>-1),v}eachChild(c){c(this.input)}outputDefined(){return!1}}class Hl{constructor(c){this.type=jt,this.input=c}static parse(c,f){if(c.length!==2)return f.error(`Expected 1 argument, but found ${c.length-1} instead.`);const v=f.parse(c[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${Ee(v.type)} instead.`):new Hl(v):null}evaluate(c){const f=this.input.evaluate(c);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Ur(`Expected value to be of type string or array, but found ${Ee(fr(f))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const il={"==":Ql,"!=":Rc,">":cu,"<":bh,">=":ku,"<=":uu,array:dn,at:ul,boolean:dn,case:fc,coalesce:Hr,collator:ze,format:el,image:tl,in:zl,"index-of":Lo,interpolate:fn,"interpolate-hcl":fn,"interpolate-lab":fn,length:Hl,let:Ya,literal:Gn,match:Xo,number:dn,"number-format":Vl,object:dn,slice:Zo,step:Ao,string:dn,"to-boolean":js,"to-color":js,"to-number":js,"to-string":js,var:Xa,within:Io};function fa(h,c){let[f,v,E,M]=c;f=f.evaluate(h),v=v.evaluate(h),E=E.evaluate(h);const R=M?M.evaluate(h):1,G=eo(f,v,E,R);if(G)throw new Ur(G);return new cr(f/255,v/255,E/255,R,!1)}function hl(h,c){return h in c}function Gl(h,c){const f=c[h];return f===void 0?null:f}function to(h){return{type:h}}function pa(h){return{result:"success",value:h}}function se(h){return{result:"error",value:h}}function Le(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function ct(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function yt(h){return!!h.expression&&h.expression.interpolated}function bt(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function It(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function gi(h){return h}function ni(h,c){const f=c.type==="color",v=h.stops&&typeof h.stops[0][0]=="object",E=v||!(v||h.property!==void 0),M=h.type||(yt(c)?"exponential":"interval");if(f||c.type==="padding"){const oe=f?cr.parse:wn.parse;(h=Ji({},h)).stops&&(h.stops=h.stops.map(de=>[de[0],oe(de[1])])),h.default=oe(h.default?h.default:c.default)}if(h.colorSpace&&(R=h.colorSpace)!=="rgb"&&R!=="hcl"&&R!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var R;let G,K,Z;if(M==="exponential")G=qr;else if(M==="interval")G=Oi;else if(M==="categorical"){G=$i,K=Object.create(null);for(const oe of h.stops)K[oe[0]]=oe[1];Z=typeof h.stops[0][0]}else{if(M!=="identity")throw new Error(`Unknown function type "${M}"`);G=sr}if(v){const oe={},de=[];for(let Ie=0;Ie<h.stops.length;Ie++){const Oe=h.stops[Ie],qe=Oe[0].zoom;oe[qe]===void 0&&(oe[qe]={zoom:qe,type:h.type,property:h.property,default:h.default,stops:[]},de.push(qe)),oe[qe].stops.push([Oe[0].value,Oe[1]])}const ye=[];for(const Ie of de)ye.push([oe[Ie].zoom,ni(oe[Ie],c)]);const Ce={name:"linear"};return{kind:"composite",interpolationType:Ce,interpolationFactor:fn.interpolationFactor.bind(void 0,Ce),zoomStops:ye.map(Ie=>Ie[0]),evaluate:(Ie,Oe)=>{let{zoom:qe}=Ie;return qr({stops:ye,base:h.base},c,qe).evaluate(qe,Oe)}}}if(E){const oe=M==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:oe,interpolationFactor:fn.interpolationFactor.bind(void 0,oe),zoomStops:h.stops.map(de=>de[0]),evaluate:de=>{let{zoom:ye}=de;return G(h,c,ye,K,Z)}}}return{kind:"source",evaluate(oe,de){const ye=de&&de.properties?de.properties[h.property]:void 0;return ye===void 0?nr(h.default,c.default):G(h,c,ye,K,Z)}}}function nr(h,c,f){return h!==void 0?h:c!==void 0?c:f!==void 0?f:void 0}function $i(h,c,f,v,E){return nr(typeof f===E?v[f]:void 0,h.default,c.default)}function Oi(h,c,f){if(bt(f)!=="number")return nr(h.default,c.default);const v=h.stops.length;if(v===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[v-1][0])return h.stops[v-1][1];const E=Ja(h.stops.map(M=>M[0]),f);return h.stops[E][1]}function qr(h,c,f){const v=h.base!==void 0?h.base:1;if(bt(f)!=="number")return nr(h.default,c.default);const E=h.stops.length;if(E===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[E-1][0])return h.stops[E-1][1];const M=Ja(h.stops.map(oe=>oe[0]),f),R=function(oe,de,ye,Ce){const Ie=Ce-ye,Oe=oe-ye;return Ie===0?0:de===1?Oe/Ie:(Math.pow(de,Oe)-1)/(Math.pow(de,Ie)-1)}(f,v,h.stops[M][0],h.stops[M+1][0]),G=h.stops[M][1],K=h.stops[M+1][1],Z=As[c.type]||gi;return typeof G.evaluate=="function"?{evaluate(){for(var oe=arguments.length,de=new Array(oe),ye=0;ye<oe;ye++)de[ye]=arguments[ye];const Ce=G.evaluate.apply(void 0,de),Ie=K.evaluate.apply(void 0,de);if(Ce!==void 0&&Ie!==void 0)return Z(Ce,Ie,R,h.colorSpace)}}:Z(G,K,R,h.colorSpace)}function sr(h,c,f){switch(c.type){case"color":f=cr.parse(f);break;case"formatted":f=Vr.fromString(f.toString());break;case"resolvedImage":f=Xi.fromString(f.toString());break;case"padding":f=wn.parse(f);break;default:bt(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0)}return nr(f,h.default,c.default)}ys.register(il,{error:[{kind:"error"},[bi],(h,c)=>{let[f]=c;throw new Ur(f.evaluate(h))}],typeof:[bi,[Qe],(h,c)=>{let[f]=c;return Ee(fr(f.evaluate(h)))}],"to-rgba":[be(jt,4),[yr],(h,c)=>{let[f]=c;const[v,E,M,R]=f.evaluate(h).rgb;return[255*v,255*E,255*M,R]}],rgb:[yr,[jt,jt,jt],fa],rgba:[yr,[jt,jt,jt,jt],fa],has:{type:Yt,overloads:[[[bi],(h,c)=>{let[f]=c;return hl(f.evaluate(h),h.properties())}],[[bi,Tr],(h,c)=>{let[f,v]=c;return hl(f.evaluate(h),v.evaluate(h))}]]},get:{type:Qe,overloads:[[[bi],(h,c)=>{let[f]=c;return Gl(f.evaluate(h),h.properties())}],[[bi,Tr],(h,c)=>{let[f,v]=c;return Gl(f.evaluate(h),v.evaluate(h))}]]},"feature-state":[Qe,[bi],(h,c)=>{let[f]=c;return Gl(f.evaluate(h),h.featureState||{})}],properties:[Tr,[],h=>h.properties()],"geometry-type":[bi,[],h=>h.geometryType()],id:[Qe,[],h=>h.id()],zoom:[jt,[],h=>h.globals.zoom],"heatmap-density":[jt,[],h=>h.globals.heatmapDensity||0],"line-progress":[jt,[],h=>h.globals.lineProgress||0],accumulated:[Qe,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[jt,to(jt),(h,c)=>{let f=0;for(const v of c)f+=v.evaluate(h);return f}],"*":[jt,to(jt),(h,c)=>{let f=1;for(const v of c)f*=v.evaluate(h);return f}],"-":{type:jt,overloads:[[[jt,jt],(h,c)=>{let[f,v]=c;return f.evaluate(h)-v.evaluate(h)}],[[jt],(h,c)=>{let[f]=c;return-f.evaluate(h)}]]},"/":[jt,[jt,jt],(h,c)=>{let[f,v]=c;return f.evaluate(h)/v.evaluate(h)}],"%":[jt,[jt,jt],(h,c)=>{let[f,v]=c;return f.evaluate(h)%v.evaluate(h)}],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(h,c)=>{let[f,v]=c;return Math.pow(f.evaluate(h),v.evaluate(h))}],sqrt:[jt,[jt],(h,c)=>{let[f]=c;return Math.sqrt(f.evaluate(h))}],log10:[jt,[jt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))/Math.LN10}],ln:[jt,[jt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))}],log2:[jt,[jt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))/Math.LN2}],sin:[jt,[jt],(h,c)=>{let[f]=c;return Math.sin(f.evaluate(h))}],cos:[jt,[jt],(h,c)=>{let[f]=c;return Math.cos(f.evaluate(h))}],tan:[jt,[jt],(h,c)=>{let[f]=c;return Math.tan(f.evaluate(h))}],asin:[jt,[jt],(h,c)=>{let[f]=c;return Math.asin(f.evaluate(h))}],acos:[jt,[jt],(h,c)=>{let[f]=c;return Math.acos(f.evaluate(h))}],atan:[jt,[jt],(h,c)=>{let[f]=c;return Math.atan(f.evaluate(h))}],min:[jt,to(jt),(h,c)=>Math.min(...c.map(f=>f.evaluate(h)))],max:[jt,to(jt),(h,c)=>Math.max(...c.map(f=>f.evaluate(h)))],abs:[jt,[jt],(h,c)=>{let[f]=c;return Math.abs(f.evaluate(h))}],round:[jt,[jt],(h,c)=>{let[f]=c;const v=f.evaluate(h);return v<0?-Math.round(-v):Math.round(v)}],floor:[jt,[jt],(h,c)=>{let[f]=c;return Math.floor(f.evaluate(h))}],ceil:[jt,[jt],(h,c)=>{let[f]=c;return Math.ceil(f.evaluate(h))}],"filter-==":[Yt,[bi,Qe],(h,c)=>{let[f,v]=c;return h.properties()[f.value]===v.value}],"filter-id-==":[Yt,[Qe],(h,c)=>{let[f]=c;return h.id()===f.value}],"filter-type-==":[Yt,[bi],(h,c)=>{let[f]=c;return h.geometryType()===f.value}],"filter-<":[Yt,[bi,Qe],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<M}],"filter-id-<":[Yt,[Qe],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v<E}],"filter->":[Yt,[bi,Qe],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>M}],"filter-id->":[Yt,[Qe],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v>E}],"filter-<=":[Yt,[bi,Qe],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<=M}],"filter-id-<=":[Yt,[Qe],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v<=E}],"filter->=":[Yt,[bi,Qe],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>=M}],"filter-id->=":[Yt,[Qe],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v>=E}],"filter-has":[Yt,[Qe],(h,c)=>{let[f]=c;return f.value in h.properties()}],"filter-has-id":[Yt,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Yt,[be(bi)],(h,c)=>{let[f]=c;return f.value.indexOf(h.geometryType())>=0}],"filter-id-in":[Yt,[be(Qe)],(h,c)=>{let[f]=c;return f.value.indexOf(h.id())>=0}],"filter-in-small":[Yt,[bi,be(Qe)],(h,c)=>{let[f,v]=c;return v.value.indexOf(h.properties()[f.value])>=0}],"filter-in-large":[Yt,[bi,be(Qe)],(h,c)=>{let[f,v]=c;return function(E,M,R,G){for(;R<=G;){const K=R+G>>1;if(M[K]===E)return!0;M[K]>E?G=K-1:R=K+1}return!1}(h.properties()[f.value],v.value,0,v.value.length-1)}],all:{type:Yt,overloads:[[[Yt,Yt],(h,c)=>{let[f,v]=c;return f.evaluate(h)&&v.evaluate(h)}],[to(Yt),(h,c)=>{for(const f of c)if(!f.evaluate(h))return!1;return!0}]]},any:{type:Yt,overloads:[[[Yt,Yt],(h,c)=>{let[f,v]=c;return f.evaluate(h)||v.evaluate(h)}],[to(Yt),(h,c)=>{for(const f of c)if(f.evaluate(h))return!0;return!1}]]},"!":[Yt,[Yt],(h,c)=>{let[f]=c;return!f.evaluate(h)}],"is-supported-script":[Yt,[bi],(h,c)=>{let[f]=c;const v=h.globals&&h.globals.isSupportedScript;return!v||v(f.evaluate(h))}],upcase:[bi,[bi],(h,c)=>{let[f]=c;return f.evaluate(h).toUpperCase()}],downcase:[bi,[bi],(h,c)=>{let[f]=c;return f.evaluate(h).toLowerCase()}],concat:[bi,to(Qe),(h,c)=>c.map(f=>Dr(f.evaluate(h))).join("")],"resolved-locale":[bi,[Be],(h,c)=>{let[f]=c;return f.evaluate(h).resolvedLocale()}]});class jn{constructor(c,f){var v;this.expression=c,this._warningHistory={},this._evaluator=new ho,this._defaultValue=f?(v=f).type==="color"&&It(v.default)?new cr(0,0,0,0):v.type==="color"?cr.parse(v.default)||null:v.type==="padding"?wn.parse(v.default)||null:v.type==="variableAnchorOffsetCollection"?hs.parse(v.default)||null:v.default===void 0?null:v.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(c,f,v,E,M,R){return this._evaluator.globals=c,this._evaluator.feature=f,this._evaluator.featureState=v,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=R,this.expression.evaluate(this._evaluator)}evaluate(c,f,v,E,M,R){this._evaluator.globals=c,this._evaluator.feature=f||null,this._evaluator.featureState=v||null,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=R||null;try{const G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new Ur(`Expected value to be one of ${Object.keys(this._enumValues).map(K=>JSON.stringify(K)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console<"u"&&console.warn(G.message)),this._defaultValue}}}function Cr(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in il}function Mr(h,c){const f=new Ta(il,Aa,[],c?function(E){const M={color:yr,string:bi,number:jt,enum:bi,boolean:Yt,formatted:ae,padding:ie,resolvedImage:ce,variableAnchorOffsetCollection:me};return E.type==="array"?be(M[E.value]||Qe,E.length):M[E.type]}(c):void 0),v=f.parse(h,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?pa(new jn(v,c)):se(f.errors)}class Nn{constructor(c,f){this.kind=c,this._styleExpression=f,this.isStateDependent=c!=="constant"&&!Ia(f.expression)}evaluateWithoutErrorHandling(c,f,v,E,M,R){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,E,M,R)}evaluate(c,f,v,E,M,R){return this._styleExpression.evaluate(c,f,v,E,M,R)}}class Ks{constructor(c,f,v,E){this.kind=c,this.zoomStops=v,this._styleExpression=f,this.isStateDependent=c!=="camera"&&!Ia(f.expression),this.interpolationType=E}evaluateWithoutErrorHandling(c,f,v,E,M,R){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,E,M,R)}evaluate(c,f,v,E,M,R){return this._styleExpression.evaluate(c,f,v,E,M,R)}interpolationFactor(c,f,v){return this.interpolationType?fn.interpolationFactor(this.interpolationType,c,f,v):0}}function io(h,c){const f=Mr(h,c);if(f.result==="error")return f;const v=f.value.expression,E=Za(v);if(!E&&!Le(c))return se([new Vt("","data expressions not supported")]);const M=Dc(v,["zoom"]);if(!M&&!ct(c))return se([new Vt("","zoom expressions not supported")]);const R=La(v);return R||M?R instanceof Vt?se([R]):R instanceof fn&&!yt(c)?se([new Vt("",'"interpolate" expressions cannot be used with this property')]):pa(R?new Ks(E?"camera":"composite",f.value,R.labels,R instanceof fn?R.interpolation:void 0):new Nn(E?"constant":"source",f.value)):se([new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Mo{constructor(c,f){this._parameters=c,this._specification=f,Ji(this,ni(this._parameters,this._specification))}static deserialize(c){return new Mo(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function La(h){let c=null;if(h instanceof Ya)c=La(h.result);else if(h instanceof Hr){for(const f of h.args)if(c=La(f),c)break}else(h instanceof Ao||h instanceof fn)&&h.input instanceof ys&&h.input.name==="zoom"&&(c=h);return c instanceof Vt||h.eachChild(f=>{const v=La(f);v instanceof Vt?c=v:!c&&v?c=new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&v&&c!==v&&(c=new Vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function ga(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const c of h.slice(1))if(!ga(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Al(h){if(h==null)return{filter:()=>!0,needGeometry:!1};ga(h)||(h=ma(h));const c=Mr(h,jl);if(c.result==="error")throw new Error(c.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,v,E)=>c.value.evaluate(f,v,{},E),needGeometry:gc(h)}}function ql(h,c){return h<c?-1:h>c?1:0}function gc(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let c=1;c<h.length;c++)if(gc(h[c]))return!0;return!1}function ma(h){if(!h)return!0;const c=h[0];return h.length<=1?c!=="any":c==="=="?Ds(h[1],h[2],"=="):c==="!="?Ma(Ds(h[1],h[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Ds(h[1],h[2],c):c==="any"?(f=h.slice(1),["any"].concat(f.map(ma))):c==="all"?["all"].concat(h.slice(1).map(ma)):c==="none"?["all"].concat(h.slice(1).map(ma).map(Ma)):c==="in"?dl(h[1],h.slice(2)):c==="!in"?Ma(dl(h[1],h.slice(2))):c==="has"?$l(h[1]):c==="!has"?Ma($l(h[1])):c!=="within"||h;var f}function Ds(h,c,f){switch(h){case"$type":return[`filter-type-${f}`,c];case"$id":return[`filter-id-${f}`,c];default:return[`filter-${f}`,h,c]}}function dl(h,c){if(c.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(f=>typeof f!=typeof c[0])?["filter-in-large",h,["literal",c.sort(ql)]]:["filter-in-small",h,["literal",c]]}}function $l(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ma(h){return["!",h]}function Pa(h){const c=typeof h;if(c==="number"||c==="boolean"||c==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let E="[";for(const M of h)E+=`${Pa(M)},`;return`${E}]`}const f=Object.keys(h).sort();let v="{";for(let E=0;E<f.length;E++)v+=`${JSON.stringify(f[E])}:${Pa(h[f[E]])},`;return`${v}}`}function Rs(h){let c="";for(const f of qt)c+=`/${Pa(h[f])}`;return c}function Ou(h){const c=h.value;return c?[new Kt(h.key,c,"constants have been deprecated as of v8")]:[]}function In(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function an(h){if(Array.isArray(h))return h.map(an);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const c={};for(const f in h)c[f]=an(h[f]);return c}return In(h)}function pn(h){const c=h.key,f=h.value,v=h.valueSpec||{},E=h.objectElementValidators||{},M=h.style,R=h.styleSpec,G=h.validateSpec;let K=[];const Z=bt(f);if(Z!=="object")return[new Kt(c,f,`object expected, ${Z} found`)];for(const oe in f){const de=oe.split(".")[0],ye=v[de]||v["*"];let Ce;if(E[de])Ce=E[de];else if(v[de])Ce=G;else if(E["*"])Ce=E["*"];else{if(!v["*"]){K.push(new Kt(c,f[oe],`unknown property "${oe}"`));continue}Ce=G}K=K.concat(Ce({key:(c&&`${c}.`)+oe,value:f[oe],valueSpec:ye,style:M,styleSpec:R,object:f,objectKey:oe,validateSpec:G},f))}for(const oe in v)E[oe]||v[oe].required&&v[oe].default===void 0&&f[oe]===void 0&&K.push(new Kt(c,f,`missing required property "${oe}"`));return K}function ts(h){const c=h.value,f=h.valueSpec,v=h.style,E=h.styleSpec,M=h.key,R=h.arrayElementValidator||h.validateSpec;if(bt(c)!=="array")return[new Kt(M,c,`array expected, ${bt(c)} found`)];if(f.length&&c.length!==f.length)return[new Kt(M,c,`array length ${f.length} expected, length ${c.length} found`)];if(f["min-length"]&&c.length<f["min-length"])return[new Kt(M,c,`array length at least ${f["min-length"]} expected, length ${c.length} found`)];let G={type:f.value,values:f.values};E.$version<7&&(G.function=f.function),bt(f.value)==="object"&&(G=f.value);let K=[];for(let Z=0;Z<c.length;Z++)K=K.concat(R({array:c,arrayIndex:Z,value:c[Z],valueSpec:G,validateSpec:h.validateSpec,style:v,styleSpec:E,key:`${M}[${Z}]`}));return K}function fl(h){const c=h.key,f=h.value,v=h.valueSpec;let E=bt(f);return E==="number"&&f!=f&&(E="NaN"),E!=="number"?[new Kt(c,f,`number expected, ${E} found`)]:"minimum"in v&&f<v.minimum?[new Kt(c,f,`${f} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&f>v.maximum?[new Kt(c,f,`${f} is greater than the maximum value ${v.maximum}`)]:[]}function pl(h){const c=h.valueSpec,f=In(h.value.type);let v,E,M,R={};const G=f!=="categorical"&&h.value.property===void 0,K=!G,Z=bt(h.value.stops)==="array"&&bt(h.value.stops[0])==="array"&&bt(h.value.stops[0][0])==="object",oe=pn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Ce){if(f==="identity")return[new Kt(Ce.key,Ce.value,'identity function may not have a "stops" property')];let Ie=[];const Oe=Ce.value;return Ie=Ie.concat(ts({key:Ce.key,value:Oe,valueSpec:Ce.valueSpec,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:de})),bt(Oe)==="array"&&Oe.length===0&&Ie.push(new Kt(Ce.key,Oe,"array must have at least one stop")),Ie},default:function(Ce){return Ce.validateSpec({key:Ce.key,value:Ce.value,valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec})}}});return f==="identity"&&G&&oe.push(new Kt(h.key,h.value,'missing required property "property"')),f==="identity"||h.value.stops||oe.push(new Kt(h.key,h.value,'missing required property "stops"')),f==="exponential"&&h.valueSpec.expression&&!yt(h.valueSpec)&&oe.push(new Kt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(K&&!Le(h.valueSpec)?oe.push(new Kt(h.key,h.value,"property functions not supported")):G&&!ct(h.valueSpec)&&oe.push(new Kt(h.key,h.value,"zoom functions not supported"))),f!=="categorical"&&!Z||h.value.property!==void 0||oe.push(new Kt(h.key,h.value,'"property" property is required')),oe;function de(Ce){let Ie=[];const Oe=Ce.value,qe=Ce.key;if(bt(Oe)!=="array")return[new Kt(qe,Oe,`array expected, ${bt(Oe)} found`)];if(Oe.length!==2)return[new Kt(qe,Oe,`array length 2 expected, length ${Oe.length} found`)];if(Z){if(bt(Oe[0])!=="object")return[new Kt(qe,Oe,`object expected, ${bt(Oe[0])} found`)];if(Oe[0].zoom===void 0)return[new Kt(qe,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new Kt(qe,Oe,"object stop key must have value")];if(M&&M>In(Oe[0].zoom))return[new Kt(qe,Oe[0].zoom,"stop zoom values must appear in ascending order")];In(Oe[0].zoom)!==M&&(M=In(Oe[0].zoom),E=void 0,R={}),Ie=Ie.concat(pn({key:`${qe}[0]`,value:Oe[0],valueSpec:{zoom:{}},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:fl,value:ye}}))}else Ie=Ie.concat(ye({key:`${qe}[0]`,value:Oe[0],valueSpec:{},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec},Oe));return Cr(an(Oe[1]))?Ie.concat([new Kt(`${qe}[1]`,Oe[1],"expressions are not allowed in function stops.")]):Ie.concat(Ce.validateSpec({key:`${qe}[1]`,value:Oe[1],valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec}))}function ye(Ce,Ie){const Oe=bt(Ce.value),qe=In(Ce.value),Ke=Ce.value!==null?Ce.value:Ie;if(v){if(Oe!==v)return[new Kt(Ce.key,Ke,`${Oe} stop domain type must match previous stop domain type ${v}`)]}else v=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new Kt(Ce.key,Ke,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&f!=="categorical"){let ut=`number expected, ${Oe} found`;return Le(c)&&f===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Kt(Ce.key,Ke,ut)]}return f!=="categorical"||Oe!=="number"||isFinite(qe)&&Math.floor(qe)===qe?f!=="categorical"&&Oe==="number"&&E!==void 0&&qe<E?[new Kt(Ce.key,Ke,"stop domain values must appear in ascending order")]:(E=qe,f==="categorical"&&qe in R?[new Kt(Ce.key,Ke,"stop domain values must be unique")]:(R[qe]=!0,[])):[new Kt(Ce.key,Ke,`integer expected, found ${qe}`)]}}function po(h){const c=(h.expressionContext==="property"?io:Mr)(an(h.value),h.valueSpec);if(c.result==="error")return c.value.map(v=>new Kt(`${h.key}${v.key}`,h.value,v.message));const f=c.value.expression||c.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!f.outputDefined())return[new Kt(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Ia(f))return[new Kt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Ia(f))return[new Kt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Dc(f,["zoom","feature-state"]))return[new Kt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Za(f))return[new Kt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function os(h){const c=h.key,f=h.value,v=h.valueSpec,E=[];return Array.isArray(v.values)?v.values.indexOf(In(f))===-1&&E.push(new Kt(c,f,`expected one of [${v.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(v.values).indexOf(In(f))===-1&&E.push(new Kt(c,f,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(f)} found`)),E}function as(h){return ga(an(h.value))?po(Ji({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Po(h)}function Po(h){const c=h.value,f=h.key;if(bt(c)!=="array")return[new Kt(f,c,`array expected, ${bt(c)} found`)];const v=h.styleSpec;let E,M=[];if(c.length<1)return[new Kt(f,c,"filter array must have at least 1 element")];switch(M=M.concat(os({key:`${f}[0]`,value:c[0],valueSpec:v.filter_operator,style:h.style,styleSpec:h.styleSpec})),In(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&In(c[1])==="$type"&&M.push(new Kt(f,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&M.push(new Kt(f,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(E=bt(c[1]),E!=="string"&&M.push(new Kt(`${f}[1]`,c[1],`string expected, ${E} found`)));for(let R=2;R<c.length;R++)E=bt(c[R]),In(c[1])==="$type"?M=M.concat(os({key:`${f}[${R}]`,value:c[R],valueSpec:v.geometry_type,style:h.style,styleSpec:h.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new Kt(`${f}[${R}]`,c[R],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let R=1;R<c.length;R++)M=M.concat(Po({key:`${f}[${R}]`,value:c[R],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":E=bt(c[1]),c.length!==2?M.push(new Kt(f,c,`filter array for "${c[0]}" operator must have 2 elements`)):E!=="string"&&M.push(new Kt(`${f}[1]`,c[1],`string expected, ${E} found`));break;case"within":E=bt(c[1]),c.length!==2?M.push(new Kt(f,c,`filter array for "${c[0]}" operator must have 2 elements`)):E!=="object"&&M.push(new Kt(`${f}[1]`,c[1],`object expected, ${E} found`))}return M}function Fo(h,c){const f=h.key,v=h.validateSpec,E=h.style,M=h.styleSpec,R=h.value,G=h.objectKey,K=M[`${c}_${h.layerType}`];if(!K)return[];const Z=G.match(/^(.*)-transition$/);if(c==="paint"&&Z&&K[Z[1]]&&K[Z[1]].transition)return v({key:f,value:R,valueSpec:M.transition,style:E,styleSpec:M});const oe=h.valueSpec||K[G];if(!oe)return[new Kt(f,R,`unknown property "${G}"`)];let de;if(bt(R)==="string"&&Le(oe)&&!oe.tokens&&(de=/^{([^}]+)}$/.exec(R)))return[new Kt(f,R,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(de[1])} }\`.`)];const ye=[];return h.layerType==="symbol"&&(G==="text-field"&&E&&!E.glyphs&&ye.push(new Kt(f,R,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&It(an(R))&&In(R.type)==="identity"&&ye.push(new Kt(f,R,'"text-font" does not support identity functions'))),ye.concat(v({key:h.key,value:R,valueSpec:oe,style:E,styleSpec:M,expressionContext:"property",propertyType:c,propertyKey:G}))}function ya(h){return Fo(h,"paint")}function gl(h){return Fo(h,"layout")}function ro(h){let c=[];const f=h.value,v=h.key,E=h.style,M=h.styleSpec;f.type||f.ref||c.push(new Kt(v,f,'either "type" or "ref" is required'));let R=In(f.type);const G=In(f.ref);if(f.id){const K=In(f.id);for(let Z=0;Z<h.arrayIndex;Z++){const oe=E.layers[Z];In(oe.id)===K&&c.push(new Kt(v,f.id,`duplicate layer id "${f.id}", previously used at line ${oe.id.__line__}`))}}if("ref"in f){let K;["type","source","source-layer","filter","layout"].forEach(Z=>{Z in f&&c.push(new Kt(v,f[Z],`"${Z}" is prohibited for ref layers`))}),E.layers.forEach(Z=>{In(Z.id)===G&&(K=Z)}),K?K.ref?c.push(new Kt(v,f.ref,"ref cannot reference another ref layer")):R=In(K.type):c.push(new Kt(v,f.ref,`ref layer "${G}" not found`))}else if(R!=="background")if(f.source){const K=E.sources&&E.sources[f.source],Z=K&&In(K.type);K?Z==="vector"&&R==="raster"?c.push(new Kt(v,f.source,`layer "${f.id}" requires a raster source`)):Z!=="raster-dem"&&R==="hillshade"?c.push(new Kt(v,f.source,`layer "${f.id}" requires a raster-dem source`)):Z==="raster"&&R!=="raster"?c.push(new Kt(v,f.source,`layer "${f.id}" requires a vector source`)):Z!=="vector"||f["source-layer"]?Z==="raster-dem"&&R!=="hillshade"?c.push(new Kt(v,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!f.paint||!f.paint["line-gradient"]||Z==="geojson"&&K.lineMetrics||c.push(new Kt(v,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Kt(v,f,`layer "${f.id}" must specify a "source-layer"`)):c.push(new Kt(v,f.source,`source "${f.source}" not found`))}else c.push(new Kt(v,f,'missing required property "source"'));return c=c.concat(pn({key:v,value:f,valueSpec:M.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${v}.type`,value:f.type,valueSpec:M.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:f,objectKey:"type"}),filter:as,layout:K=>pn({layer:f,key:K.key,value:K.value,style:K.style,styleSpec:K.styleSpec,validateSpec:K.validateSpec,objectElementValidators:{"*":Z=>gl(Ji({layerType:R},Z))}}),paint:K=>pn({layer:f,key:K.key,value:K.value,style:K.style,styleSpec:K.styleSpec,validateSpec:K.validateSpec,objectElementValidators:{"*":Z=>ya(Ji({layerType:R},Z))}})}})),c}function no(h){const c=h.value,f=h.key,v=bt(c);return v!=="string"?[new Kt(f,c,`string expected, ${v} found`)]:[]}const go={promoteId:function(h){let{key:c,value:f}=h;if(bt(f)==="string")return no({key:c,value:f});{const v=[];for(const E in f)v.push(...no({key:`${c}.${E}`,value:f[E]}));return v}}};function _s(h){const c=h.value,f=h.key,v=h.styleSpec,E=h.style,M=h.validateSpec;if(!c.type)return[new Kt(f,c,'"type" is required')];const R=In(c.type);let G;switch(R){case"vector":case"raster":return G=pn({key:f,value:c,valueSpec:v[`source_${R.replace("-","_")}`],style:h.style,styleSpec:v,objectElementValidators:go,validateSpec:M}),G;case"raster-dem":return G=function(K){var Z;const oe=(Z=K.sourceName)!==null&&Z!==void 0?Z:"",de=K.value,ye=K.styleSpec,Ce=ye.source_raster_dem,Ie=K.style;let Oe=[];const qe=bt(de);if(de===void 0)return Oe;if(qe!=="object")return Oe.push(new Kt("source_raster_dem",de,`object expected, ${qe} found`)),Oe;const Ke=In(de.encoding)==="custom",ut=["redFactor","greenFactor","blueFactor","baseShift"],et=K.value.encoding?`"${K.value.encoding}"`:"Default";for(const it in de)!Ke&&ut.includes(it)?Oe.push(new Kt(it,de[it],`In "${oe}": "${it}" is only valid when "encoding" is set to "custom". ${et} encoding found`)):Ce[it]?Oe=Oe.concat(K.validateSpec({key:it,value:de[it],valueSpec:Ce[it],validateSpec:K.validateSpec,style:Ie,styleSpec:ye})):Oe.push(new Kt(it,de[it],`unknown property "${it}"`));return Oe}({sourceName:f,value:c,style:h.style,styleSpec:v,validateSpec:M}),G;case"geojson":if(G=pn({key:f,value:c,valueSpec:v.source_geojson,style:E,styleSpec:v,validateSpec:M,objectElementValidators:go}),c.cluster)for(const K in c.clusterProperties){const[Z,oe]=c.clusterProperties[K],de=typeof Z=="string"?[Z,["accumulated"],["get",K]]:Z;G.push(...po({key:`${f}.${K}.map`,value:oe,validateSpec:M,expressionContext:"cluster-map"})),G.push(...po({key:`${f}.${K}.reduce`,value:de,validateSpec:M,expressionContext:"cluster-reduce"}))}return G;case"video":return pn({key:f,value:c,valueSpec:v.source_video,style:E,validateSpec:M,styleSpec:v});case"image":return pn({key:f,value:c,valueSpec:v.source_image,style:E,validateSpec:M,styleSpec:v});case"canvas":return[new Kt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return os({key:`${f}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,validateSpec:M,styleSpec:v})}}function so(h){const c=h.value,f=h.styleSpec,v=f.light,E=h.style;let M=[];const R=bt(c);if(c===void 0)return M;if(R!=="object")return M=M.concat([new Kt("light",c,`object expected, ${R} found`)]),M;for(const G in c){const K=G.match(/^(.*)-transition$/);M=M.concat(K&&v[K[1]]&&v[K[1]].transition?h.validateSpec({key:G,value:c[G],valueSpec:f.transition,validateSpec:h.validateSpec,style:E,styleSpec:f}):v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new Kt(G,c[G],`unknown property "${G}"`)])}return M}function Fa(h){const c=h.value,f=h.styleSpec,v=f.terrain,E=h.style;let M=[];const R=bt(c);if(c===void 0)return M;if(R!=="object")return M=M.concat([new Kt("terrain",c,`object expected, ${R} found`)]),M;for(const G in c)M=M.concat(v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new Kt(G,c[G],`unknown property "${G}"`)]);return M}function _a(h){let c=[];const f=h.value,v=h.key;if(Array.isArray(f)){const E=[],M=[];for(const R in f)f[R].id&&E.includes(f[R].id)&&c.push(new Kt(v,f,`all the sprites' ids must be unique, but ${f[R].id} is duplicated`)),E.push(f[R].id),f[R].url&&M.includes(f[R].url)&&c.push(new Kt(v,f,`all the sprites' URLs must be unique, but ${f[R].url} is duplicated`)),M.push(f[R].url),c=c.concat(pn({key:`${v}[${R}]`,value:f[R],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return c}return no({key:v,value:f})}const Da={"*":()=>[],array:ts,boolean:function(h){const c=h.value,f=h.key,v=bt(c);return v!=="boolean"?[new Kt(f,c,`boolean expected, ${v} found`)]:[]},number:fl,color:function(h){const c=h.key,f=h.value,v=bt(f);return v!=="string"?[new Kt(c,f,`color expected, ${v} found`)]:cr.parse(String(f))?[]:[new Kt(c,f,`color expected, "${f}" found`)]},constants:Ou,enum:os,filter:as,function:pl,layer:ro,object:pn,source:_s,light:so,terrain:Fa,string:no,formatted:function(h){return no(h).length===0?[]:po(h)},resolvedImage:function(h){return no(h).length===0?[]:po(h)},padding:function(h){const c=h.key,f=h.value;if(bt(f)==="array"){if(f.length<1||f.length>4)return[new Kt(c,f,`padding requires 1 to 4 values; ${f.length} values found`)];const v={type:"number"};let E=[];for(let M=0;M<f.length;M++)E=E.concat(h.validateSpec({key:`${c}[${M}]`,value:f[M],validateSpec:h.validateSpec,valueSpec:v}));return E}return fl({key:c,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const c=h.key,f=h.value,v=bt(f),E=h.styleSpec;if(v!=="array"||f.length<1||f.length%2!=0)return[new Kt(c,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let M=[];for(let R=0;R<f.length;R+=2)M=M.concat(os({key:`${c}[${R}]`,value:f[R],valueSpec:E.layout_symbol["text-anchor"]})),M=M.concat(ts({key:`${c}[${R+1}]`,value:f[R+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:E}));return M},sprite:_a};function Ln(h){const c=h.value,f=h.valueSpec,v=h.styleSpec;return h.validateSpec=Ln,f.expression&&It(In(c))?pl(h):f.expression&&Cr(an(c))?po(h):f.type&&Da[f.type]?Da[f.type](h):pn(Ji({},h,{valueSpec:f.type?v[f.type]:f}))}function Do(h){const c=h.value,f=h.key,v=no(h);return v.length||(c.indexOf("{fontstack}")===-1&&v.push(new Kt(f,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&v.push(new Kt(f,c,'"glyphs" url must include a "{range}" token'))),v}function ds(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ht,f=[];return f=f.concat(Ln({key:"",value:h,valueSpec:c.$root,styleSpec:c,style:h,validateSpec:Ln,objectElementValidators:{glyphs:Do,"*":()=>[]}})),h.constants&&(f=f.concat(Ou({key:"constants",value:h.constants,style:h,styleSpec:c,validateSpec:Ln}))),fs(f)}function vs(h){return function(c){return h({...c,validateSpec:Ln})}}function fs(h){return[].concat(h).sort((c,f)=>c.line-f.line)}function Lr(h){return function(){for(var c=arguments.length,f=new Array(c),v=0;v<c;v++)f[v]=arguments[v];return fs(h.apply(this,f))}}ds.source=Lr(vs(_s)),ds.sprite=Lr(vs(_a)),ds.glyphs=Lr(vs(Do)),ds.light=Lr(vs(so)),ds.terrain=Lr(vs(Fa)),ds.layer=Lr(vs(ro)),ds.filter=Lr(vs(as)),ds.paintProperty=Lr(vs(ya)),ds.layoutProperty=Lr(vs(gl));const Jr=ds,ln=Jr.light,qn=Jr.paintProperty,va=Jr.layoutProperty;function Ra(h,c){let f=!1;if(c&&c.length)for(const v of c)h.fire(new ki(new Error(v.message))),f=!0;return f}class mo{constructor(c,f,v){const E=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const R=new Int32Array(this.arrayBuffer);c=R[0],this.d=(f=R[1])+2*(v=R[2]);for(let K=0;K<this.d*this.d;K++){const Z=R[3+K],oe=R[3+K+1];E.push(Z===oe?null:R.subarray(Z,oe))}const G=R[3+E.length+1];this.keys=R.subarray(R[3+E.length],G),this.bboxes=R.subarray(G),this.insert=this._insertReadonly}else{this.d=f+2*v;for(let R=0;R<this.d*this.d;R++)E.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=v,this.scale=f/c,this.uid=0;const M=v/f*c;this.min=-M,this.max=c+M}insert(c,f,v,E,M){this._forEachCell(f,v,E,M,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(M)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,f,v,E,M,R){this.cells[M].push(R)}query(c,f,v,E,M){const R=this.min,G=this.max;if(c<=R&&f<=R&&G<=v&&G<=E&&!M)return Array.prototype.slice.call(this.keys);{const K=[];return this._forEachCell(c,f,v,E,this._queryCell,K,{},M),K}}_queryCell(c,f,v,E,M,R,G,K){const Z=this.cells[M];if(Z!==null){const oe=this.keys,de=this.bboxes;for(let ye=0;ye<Z.length;ye++){const Ce=Z[ye];if(G[Ce]===void 0){const Ie=4*Ce;(K?K(de[Ie+0],de[Ie+1],de[Ie+2],de[Ie+3]):c<=de[Ie+2]&&f<=de[Ie+3]&&v>=de[Ie+0]&&E>=de[Ie+1])?(G[Ce]=!0,R.push(oe[Ce])):G[Ce]=!1}}}}_forEachCell(c,f,v,E,M,R,G,K){const Z=this._convertToCellCoord(c),oe=this._convertToCellCoord(f),de=this._convertToCellCoord(v),ye=this._convertToCellCoord(E);for(let Ce=Z;Ce<=de;Ce++)for(let Ie=oe;Ie<=ye;Ie++){const Oe=this.d*Ie+Ce;if((!K||K(this._convertFromCellCoord(Ce),this._convertFromCellCoord(Ie),this._convertFromCellCoord(Ce+1),this._convertFromCellCoord(Ie+1)))&&M.call(this,c,f,v,E,Oe,R,G,K))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,f=3+this.cells.length+1+1;let v=0;for(let R=0;R<this.cells.length;R++)v+=this.cells[R].length;const E=new Int32Array(f+v+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;let M=f;for(let R=0;R<c.length;R++){const G=c[R];E[3+R]=M,E.set(G,M),M+=G.length}return E[3+c.length]=M,E.set(this.keys,M),M+=this.keys.length,E[3+c.length+1]=M,E.set(this.bboxes,M),M+=this.bboxes.length,E.buffer}static serialize(c,f){const v=c.toArrayBuffer();return f&&f.push(v),{buffer:v}}static deserialize(c){return new mo(c.buffer)}}const Yo={};function Ui(h,c){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Yo[h])throw new Error(`${h} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:h,writeable:!1}),Yo[h]={klass:c,omit:f.omit||[],shallow:f.shallow||[]}}Ui("Object",Object),Ui("TransferableGridIndex",mo),Ui("Color",cr),Ui("Error",Error),Ui("AJAXError",Ft),Ui("ResolvedImage",Xi),Ui("StylePropertyFunction",Mo),Ui("StyleExpression",jn,{omit:["_evaluator"]}),Ui("ZoomDependentExpression",Ks),Ui("ZoomConstantExpression",Nn),Ui("CompoundExpression",ys,{omit:["_evaluate"]});for(const h in il)il[h]._classRegistryKey||Ui(`Expression_${h}`,il[h]);function ea(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Fi(h,c){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob)return h;if(ea(h)||Dt(h))return c&&c.push(h),h;if(ArrayBuffer.isView(h)){const f=h;return c&&c.push(f.buffer),f}if(h instanceof ImageData)return c&&c.push(h.data.buffer),h;if(Array.isArray(h)){const f=[];for(const v of h)f.push(Fi(v,c));return f}if(typeof h=="object"){const f=h.constructor,v=f._classRegistryKey;if(!v)throw new Error("can't serialize object of unregistered class");if(!Yo[v])throw new Error(`${v} is not registered.`);const E=f.serialize?f.serialize(h,c):{};if(f.serialize){if(c&&E===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const M in h){if(!h.hasOwnProperty(M)||Yo[v].omit.indexOf(M)>=0)continue;const R=h[M];E[M]=Yo[v].shallow.indexOf(M)>=0?R:Fi(R,c)}h instanceof Error&&(E.message=h.message)}if(E.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(E.$name=v),E}throw new Error("can't serialize object of type "+typeof h)}function ml(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||ea(h)||Dt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(ml);if(typeof h=="object"){const c=h.$name||"Object";if(!Yo[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:f}=Yo[c];if(!f)throw new Error(`can't deserialize unregistered class ${c}`);if(f.deserialize)return f.deserialize(h);const v=Object.create(f.prototype);for(const E of Object.keys(h)){if(E==="$name")continue;const M=h[E];v[E]=Yo[c].shallow.indexOf(E)>=0?M:ml(M)}return v}throw new Error("can't deserialize object of type "+typeof h)}class Kl{constructor(){this.first=!0}update(c,f){const v=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=f),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=v,!0))}}const Mi={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Wl(h){for(const c of h)if(yo(c.charCodeAt(0)))return!0;return!1}function Si(h){for(const c of h)if(!oo(c.charCodeAt(0)))return!1;return!0}function oo(h){return!(Mi.Arabic(h)||Mi["Arabic Supplement"](h)||Mi["Arabic Extended-A"](h)||Mi["Arabic Presentation Forms-A"](h)||Mi["Arabic Presentation Forms-B"](h))}function yo(h){return!(h!==746&&h!==747&&(h<4352||!(Mi["Bopomofo Extended"](h)||Mi.Bopomofo(h)||Mi["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Mi["CJK Compatibility Ideographs"](h)||Mi["CJK Compatibility"](h)||Mi["CJK Radicals Supplement"](h)||Mi["CJK Strokes"](h)||!(!Mi["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Mi["CJK Unified Ideographs Extension A"](h)||Mi["CJK Unified Ideographs"](h)||Mi["Enclosed CJK Letters and Months"](h)||Mi["Hangul Compatibility Jamo"](h)||Mi["Hangul Jamo Extended-A"](h)||Mi["Hangul Jamo Extended-B"](h)||Mi["Hangul Jamo"](h)||Mi["Hangul Syllables"](h)||Mi.Hiragana(h)||Mi["Ideographic Description Characters"](h)||Mi.Kanbun(h)||Mi["Kangxi Radicals"](h)||Mi["Katakana Phonetic Extensions"](h)||Mi.Katakana(h)&&h!==12540||!(!Mi["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Mi["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Mi["Unified Canadian Aboriginal Syllabics"](h)||Mi["Unified Canadian Aboriginal Syllabics Extended"](h)||Mi["Vertical Forms"](h)||Mi["Yijing Hexagram Symbols"](h)||Mi["Yi Syllables"](h)||Mi["Yi Radicals"](h))))}function kc(h){return!(yo(h)||function(c){return!!(Mi["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Mi["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Mi["Letterlike Symbols"](c)||Mi["Number Forms"](c)||Mi["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Mi["Control Pictures"](c)&&c!==9251||Mi["Optical Character Recognition"](c)||Mi["Enclosed Alphanumerics"](c)||Mi["Geometric Shapes"](c)||Mi["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Mi["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Mi["CJK Symbols and Punctuation"](c)||Mi.Katakana(c)||Mi["Private Use Area"](c)||Mi["CJK Compatibility Forms"](c)||Mi["Small Form Variants"](c)||Mi["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(h))}function Xl(h){return h>=1424&&h<=2303||Mi["Arabic Presentation Forms-A"](h)||Mi["Arabic Presentation Forms-B"](h)}function Oc(h,c){return!(!c&&Xl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Mi.Khmer(h))}function Uc(h){for(const c of h)if(Xl(c.charCodeAt(0)))return!0;return!1}const Nc="deferred",zc="loading",rl="loaded";let _n=null,Es="unavailable",Ro=null;const Zl=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Es="error"),_n&&_n(h)};function Uu(){mc.fire(new wt("pluginStateChange",{pluginStatus:Es,pluginURL:Ro}))}const mc=new ti,hu=function(){return Es},ba=function(){if(Es!==Nc||!Ro)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Es=zc,Uu(),Ro&&yi({url:Ro},h=>{h?Zl(h):(Es=rl,Uu())})},Ws={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Es===rl||Ws.applyArabicShaping!=null,isLoading:()=>Es===zc,setState(h){if(!Mt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Es=h.pluginStatus,Ro=h.pluginURL},isParsed(){if(!Mt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ws.applyArabicShaping!=null&&Ws.processBidirectionalText!=null&&Ws.processStyledBidirectionalText!=null},getPluginURL(){if(!Mt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ro}};class xi{constructor(c,f){this.zoom=c,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kl,this.transition={})}isSupportedScript(c){return function(f,v){for(const E of f)if(!Oc(E.charCodeAt(0),v))return!1;return!0}(c,Ws.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,f=c-Math.floor(c),v=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*f}}}class or{constructor(c,f){this.property=c,this.value=f,this.expression=function(v,E){if(It(v))return new Mo(v,E);if(Cr(v)){const M=io(v,E);if(M.result==="error")throw new Error(M.value.map(R=>`${R.key}: ${R.message}`).join(", "));return M.value}{let M=v;return E.type==="color"&&typeof v=="string"?M=cr.parse(v):E.type!=="padding"||typeof v!="number"&&!Array.isArray(v)?E.type==="variableAnchorOffsetCollection"&&Array.isArray(v)&&(M=hs.parse(v)):M=wn.parse(v),{kind:"constant",evaluate:()=>M}}}(f===void 0?c.specification.default:f,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,f,v){return this.property.possiblyEvaluate(this,c,f,v)}}class Jl{constructor(c){this.property=c,this.value=new or(c,void 0)}transitioned(c,f){return new Vc(this.property,this.value,f,Ne({},c.transition,this.transition),c.now)}untransitioned(){return new Vc(this.property,this.value,null,{},0)}}class Qc{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return Pe(this._values[c].value.value)}setValue(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Jl(this._values[c].property)),this._values[c].value=new or(this._values[c].property,f===null?void 0:Pe(f))}getTransition(c){return Pe(this._values[c].transition)}setTransition(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Jl(this._values[c].property)),this._values[c].transition=Pe(f)||void 0}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v);const E=this.getTransition(f);E!==void 0&&(c[`${f}-transition`]=E)}return c}transitioned(c,f){const v=new Ss(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].transitioned(c,f._values[E]);return v}untransitioned(){const c=new Ss(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].untransitioned();return c}}class Vc{constructor(c,f,v,E,M){this.property=c,this.value=f,this.begin=M+E.delay||0,this.end=this.begin+E.duration||0,c.specification.transition&&(E.delay||E.duration)&&(this.prior=v)}possiblyEvaluate(c,f,v){const E=c.now||0,M=this.value.possiblyEvaluate(c,f,v),R=this.prior;if(R){if(E>this.end)return this.prior=null,M;if(this.value.isDataDriven())return this.prior=null,M;if(E<this.begin)return R.possiblyEvaluate(c,f,v);{const G=(E-this.begin)/(this.end-this.begin);return this.property.interpolate(R.possiblyEvaluate(c,f,v),M,function(K){if(K<=0)return 0;if(K>=1)return 1;const Z=K*K,oe=Z*K;return 4*(K<.5?oe:3*(K-Z)+oe-.75)}(G))}}return M}}class Ss{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,f,v){const E=new Au(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(c,f,v);return E}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class xh{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return Pe(this._values[c].value)}setValue(c,f){this._values[c]=new or(this._values[c].property,f===null?void 0:Pe(f))}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v)}return c}possiblyEvaluate(c,f,v){const E=new Au(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(c,f,v);return E}}class $n{constructor(c,f,v){this.property=c,this.value=f,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,f,v,E){return this.property.evaluate(this.value,this.parameters,c,f,v,E)}}class Au{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class Ki{constructor(c){this.specification=c}possiblyEvaluate(c,f){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(f)}interpolate(c,f,v){const E=As[this.specification.type];return E?E(c,f,v):c}}class zi{constructor(c,f){this.specification=c,this.overrides=f}possiblyEvaluate(c,f,v,E){return new $n(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(f,null,{},v,E)}:c.expression,f)}interpolate(c,f,v){if(c.value.kind!=="constant"||f.value.kind!=="constant")return c;if(c.value.value===void 0||f.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},c.parameters);const E=As[this.specification.type];if(E){const M=E(c.value.value,f.value.value,v);return new $n(this,{kind:"constant",value:M},c.parameters)}return c}evaluate(c,f,v,E,M,R){return c.kind==="constant"?c.value:c.evaluate(f,v,E,M,R)}}class Kn extends zi{possiblyEvaluate(c,f,v,E){if(c.value===void 0)return new $n(this,{kind:"constant",value:void 0},f);if(c.expression.kind==="constant"){const M=c.expression.evaluate(f,null,{},v,E),R=c.property.specification.type==="resolvedImage"&&typeof M!="string"?M.name:M,G=this._calculate(R,R,R,f);return new $n(this,{kind:"constant",value:G},f)}if(c.expression.kind==="camera"){const M=this._calculate(c.expression.evaluate({zoom:f.zoom-1}),c.expression.evaluate({zoom:f.zoom}),c.expression.evaluate({zoom:f.zoom+1}),f);return new $n(this,{kind:"constant",value:M},f)}return new $n(this,c.expression,f)}evaluate(c,f,v,E,M,R){if(c.kind==="source"){const G=c.evaluate(f,v,E,M,R);return this._calculate(G,G,G,f)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(f.zoom)-1},v,E),c.evaluate({zoom:Math.floor(f.zoom)},v,E),c.evaluate({zoom:Math.floor(f.zoom)+1},v,E),f):c.value}_calculate(c,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:v,to:f}}interpolate(c){return c}}class Nu{constructor(c){this.specification=c}possiblyEvaluate(c,f,v,E){if(c.value!==void 0){if(c.expression.kind==="constant"){const M=c.expression.evaluate(f,null,{},v,E);return this._calculate(M,M,M,f)}return this._calculate(c.expression.evaluate(new xi(Math.floor(f.zoom-1),f)),c.expression.evaluate(new xi(Math.floor(f.zoom),f)),c.expression.evaluate(new xi(Math.floor(f.zoom+1),f)),f)}}_calculate(c,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:v,to:f}}interpolate(c){return c}}class ks{constructor(c){this.specification=c}possiblyEvaluate(c,f,v,E){return!!c.expression.evaluate(f,null,{},v,E)}interpolate(){return!1}}class rn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in c){const v=c[f];v.specification.overridable&&this.overridableProperties.push(f);const E=this.defaultPropertyValues[f]=new or(v,void 0),M=this.defaultTransitionablePropertyValues[f]=new Jl(v);this.defaultTransitioningPropertyValues[f]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=E.possiblyEvaluate({})}}}Ui("DataDrivenProperty",zi),Ui("DataConstantProperty",Ki),Ui("CrossFadedDataDrivenProperty",Kn),Ui("CrossFadedProperty",Nu),Ui("ColorRampProperty",ks);const ta="-transition";class ko extends ti{constructor(c,f){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),f.layout&&(this._unevaluatedLayout=new xh(f.layout)),f.paint)){this._transitionablePaint=new Qc(f.paint);for(const v in c.paint)this.setPaintProperty(v,c.paint[v],{validate:!1});for(const v in c.layout)this.setLayoutProperty(v,c.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Au(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};f!=null&&this._validate(va,`layers.${this.id}.layout.${c}`,c,f,v)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,f):this.visibility=f)}getPaintProperty(c){return c.endsWith(ta)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(f!=null&&this._validate(qn,`layers.${this.id}.paint.${c}`,c,f,v))return!1;if(c.endsWith(ta))return this._transitionablePaint.setTransition(c.slice(0,-11),f||void 0),!1;{const E=this._transitionablePaint._values[c],M=E.property.specification["property-type"]==="cross-faded-data-driven",R=E.value.isDataDriven(),G=E.value;this._transitionablePaint.setValue(c,f),this._handleSpecialPaintPropertyUpdate(c);const K=this._transitionablePaint._values[c].value;return K.isDataDriven()||R||M||this._handleOverridablePaintPropertyUpdate(c,G,K)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,f,v){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,f){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,f)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Re(c,(f,v)=>!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length))}_validate(c,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!M||M.validate!==!1)&&Ra(this,c.call(Jr,{key:f,layerType:this.type,objectKey:v,value:E,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const f=this.paint.get(c);if(f instanceof $n&&Le(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const du={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Os{constructor(c,f){this._structArray=c,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,f){return c._trim(),f&&(c.isTransferred=!0,f.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const f=Object.create(this.prototype);return f.arrayBuffer=c.arrayBuffer,f.length=c.length,f.capacity=c.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zn(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=0,v=0;return{members:h.map(E=>{const M=du[E.type].BYTES_PER_ELEMENT,R=f=Oo(f,Math.max(c,M)),G=E.components||1;return v=Math.max(v,M),f+=M*G,{name:E.name,type:E.type,components:G,offset:R}}),size:Oo(f,Math.max(v,c)),alignment:c}}function Oo(h,c){return Math.ceil(h/c)*c}class yl extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.int16[E+0]=f,this.int16[E+1]=v,c}}yl.prototype.bytesPerElement=4,Ui("StructArrayLayout2i4",yl);class nl extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=E,c}}nl.prototype.bytesPerElement=6,Ui("StructArrayLayout3i6",nl);class ka extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const R=4*c;return this.int16[R+0]=f,this.int16[R+1]=v,this.int16[R+2]=E,this.int16[R+3]=M,c}}ka.prototype.bytesPerElement=8,Ui("StructArrayLayout4i8",ka);class Yl extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,R)}emplace(c,f,v,E,M,R,G){const K=6*c;return this.int16[K+0]=f,this.int16[K+1]=v,this.int16[K+2]=E,this.int16[K+3]=M,this.int16[K+4]=R,this.int16[K+5]=G,c}}Yl.prototype.bytesPerElement=12,Ui("StructArrayLayout2i4i12",Yl);class fu extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,R)}emplace(c,f,v,E,M,R,G){const K=4*c,Z=8*c;return this.int16[K+0]=f,this.int16[K+1]=v,this.uint8[Z+4]=E,this.uint8[Z+5]=M,this.uint8[Z+6]=R,this.uint8[Z+7]=G,c}}fu.prototype.bytesPerElement=8,Ui("StructArrayLayout2i4ub8",fu);class _o extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.float32[E+0]=f,this.float32[E+1]=v,c}}_o.prototype.bytesPerElement=8,Ui("StructArrayLayout2f8",_o);class xa extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R,G,K,Z,oe){const de=this.length;return this.resize(de+1),this.emplace(de,c,f,v,E,M,R,G,K,Z,oe)}emplace(c,f,v,E,M,R,G,K,Z,oe,de){const ye=10*c;return this.uint16[ye+0]=f,this.uint16[ye+1]=v,this.uint16[ye+2]=E,this.uint16[ye+3]=M,this.uint16[ye+4]=R,this.uint16[ye+5]=G,this.uint16[ye+6]=K,this.uint16[ye+7]=Z,this.uint16[ye+8]=oe,this.uint16[ye+9]=de,c}}xa.prototype.bytesPerElement=20,Ui("StructArrayLayout10ui20",xa);class _l extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R,G,K,Z,oe,de,ye){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,c,f,v,E,M,R,G,K,Z,oe,de,ye)}emplace(c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce){const Ie=12*c;return this.int16[Ie+0]=f,this.int16[Ie+1]=v,this.int16[Ie+2]=E,this.int16[Ie+3]=M,this.uint16[Ie+4]=R,this.uint16[Ie+5]=G,this.uint16[Ie+6]=K,this.uint16[Ie+7]=Z,this.int16[Ie+8]=oe,this.int16[Ie+9]=de,this.int16[Ie+10]=ye,this.int16[Ie+11]=Ce,c}}_l.prototype.bytesPerElement=24,Ui("StructArrayLayout4i4ui4i24",_l);class jr extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,c}}jr.prototype.bytesPerElement=12,Ui("StructArrayLayout3f12",jr);class z extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint32[1*c+0]=f,c}}z.prototype.bytesPerElement=4,Ui("StructArrayLayout1ul4",z);class A extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R,G,K,Z){const oe=this.length;return this.resize(oe+1),this.emplace(oe,c,f,v,E,M,R,G,K,Z)}emplace(c,f,v,E,M,R,G,K,Z,oe){const de=10*c,ye=5*c;return this.int16[de+0]=f,this.int16[de+1]=v,this.int16[de+2]=E,this.int16[de+3]=M,this.int16[de+4]=R,this.int16[de+5]=G,this.uint32[ye+3]=K,this.uint16[de+8]=Z,this.uint16[de+9]=oe,c}}A.prototype.bytesPerElement=20,Ui("StructArrayLayout6i1ul2ui20",A);class x extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,R)}emplace(c,f,v,E,M,R,G){const K=6*c;return this.int16[K+0]=f,this.int16[K+1]=v,this.int16[K+2]=E,this.int16[K+3]=M,this.int16[K+4]=R,this.int16[K+5]=G,c}}x.prototype.bytesPerElement=12,Ui("StructArrayLayout2i2i2i12",x);class L extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M){const R=this.length;return this.resize(R+1),this.emplace(R,c,f,v,E,M)}emplace(c,f,v,E,M,R){const G=4*c,K=8*c;return this.float32[G+0]=f,this.float32[G+1]=v,this.float32[G+2]=E,this.int16[K+6]=M,this.int16[K+7]=R,c}}L.prototype.bytesPerElement=16,Ui("StructArrayLayout2f1f2i16",L);class O extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const R=12*c,G=3*c;return this.uint8[R+0]=f,this.uint8[R+1]=v,this.float32[G+1]=E,this.float32[G+2]=M,c}}O.prototype.bytesPerElement=12,Ui("StructArrayLayout2ub2f12",O);class y extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.uint16[M+0]=f,this.uint16[M+1]=v,this.uint16[M+2]=E,c}}y.prototype.bytesPerElement=6,Ui("StructArrayLayout3ui6",y);class a extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke){const ut=this.length;return this.resize(ut+1),this.emplace(ut,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke)}emplace(c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut){const et=24*c,it=12*c,mt=48*c;return this.int16[et+0]=f,this.int16[et+1]=v,this.uint16[et+2]=E,this.uint16[et+3]=M,this.uint32[it+2]=R,this.uint32[it+3]=G,this.uint32[it+4]=K,this.uint16[et+10]=Z,this.uint16[et+11]=oe,this.uint16[et+12]=de,this.float32[it+7]=ye,this.float32[it+8]=Ce,this.uint8[mt+36]=Ie,this.uint8[mt+37]=Oe,this.uint8[mt+38]=qe,this.uint32[it+10]=Ke,this.int16[et+22]=ut,c}}a.prototype.bytesPerElement=48,Ui("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",a);class d extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut,et,it,mt,Tt,Zt,wi,ai,di,pi,Di){const li=this.length;return this.resize(li+1),this.emplace(li,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut,et,it,mt,Tt,Zt,wi,ai,di,pi,Di)}emplace(c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe,qe,Ke,ut,et,it,mt,Tt,Zt,wi,ai,di,pi,Di,li){const Jt=32*c,Hi=16*c;return this.int16[Jt+0]=f,this.int16[Jt+1]=v,this.int16[Jt+2]=E,this.int16[Jt+3]=M,this.int16[Jt+4]=R,this.int16[Jt+5]=G,this.int16[Jt+6]=K,this.int16[Jt+7]=Z,this.uint16[Jt+8]=oe,this.uint16[Jt+9]=de,this.uint16[Jt+10]=ye,this.uint16[Jt+11]=Ce,this.uint16[Jt+12]=Ie,this.uint16[Jt+13]=Oe,this.uint16[Jt+14]=qe,this.uint16[Jt+15]=Ke,this.uint16[Jt+16]=ut,this.uint16[Jt+17]=et,this.uint16[Jt+18]=it,this.uint16[Jt+19]=mt,this.uint16[Jt+20]=Tt,this.uint16[Jt+21]=Zt,this.uint16[Jt+22]=wi,this.uint32[Hi+12]=ai,this.float32[Hi+13]=di,this.float32[Hi+14]=pi,this.uint16[Jt+30]=Di,this.uint16[Jt+31]=li,c}}d.prototype.bytesPerElement=64,Ui("StructArrayLayout8i15ui1ul2f2ui64",d);class _ extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.float32[1*c+0]=f,c}}_.prototype.bytesPerElement=4,Ui("StructArrayLayout1f4",_);class B extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.uint16[6*c+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,c}}B.prototype.bytesPerElement=12,Ui("StructArrayLayout1ui2f12",B);class T extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=4*c;return this.uint32[2*c+0]=f,this.uint16[M+2]=v,this.uint16[M+3]=E,c}}T.prototype.bytesPerElement=8,Ui("StructArrayLayout1ul2ui8",T);class U extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.uint16[E+0]=f,this.uint16[E+1]=v,c}}U.prototype.bytesPerElement=4,Ui("StructArrayLayout2ui4",U);class H extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint16[1*c+0]=f,c}}H.prototype.bytesPerElement=2,Ui("StructArrayLayout1ui2",H);class q extends Yr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const R=4*c;return this.float32[R+0]=f,this.float32[R+1]=v,this.float32[R+2]=E,this.float32[R+3]=M,c}}q.prototype.bytesPerElement=16,Ui("StructArrayLayout4f16",q);class w extends Os{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new D(this.anchorPointX,this.anchorPointY)}}w.prototype.size=20;class I extends A{get(c){return new w(this,c)}}Ui("CollisionBoxArray",I);class k extends Os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}k.prototype.size=48;class j extends a{get(c){return new k(this,c)}}Ui("PlacedSymbolArray",j);class Y extends Os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Y.prototype.size=64;class X extends d{get(c){return new Y(this,c)}}Ui("SymbolInstanceArray",X);class ee extends _{getoffsetX(c){return this.float32[1*c+0]}}Ui("GlyphOffsetArray",ee);class re extends nl{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Ui("SymbolLineVertexArray",re);class le extends Os{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}le.prototype.size=12;class pe extends B{get(c){return new le(this,c)}}Ui("TextAnchorOffsetArray",pe);class ge extends Os{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class we extends T{get(c){return new ge(this,c)}}Ui("FeatureIndexArray",we);class De extends yl{}class Me extends yl{}class st extends yl{}class We extends Yl{}class ke extends fu{}class Ve extends _o{}class gt extends xa{}class xt extends _l{}class At extends jr{}class kt extends z{}class Rt extends x{}class Ai extends O{}class Ht extends y{}class vi extends U{}const Ti=zn([{name:"a_pos",components:2,type:"Int16"}],4),{members:er}=Ti;class Ii{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,f,v,E){let M=this.segments[this.segments.length-1];return c>Ii.MAX_VERTEX_ARRAY_LENGTH&&Xe(`Max vertices per segment is ${Ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!M||M.vertexLength+c>Ii.MAX_VERTEX_ARRAY_LENGTH||M.sortKey!==E)&&(M={vertexOffset:f.length,primitiveOffset:v.length,vertexLength:0,primitiveLength:0},E!==void 0&&(M.sortKey=E),this.segments.push(M)),M}get(){return this.segments}destroy(){for(const c of this.segments)for(const f in c.vaos)c.vaos[f].destroy()}static simpleSegment(c,f,v,E){return new Ii([{vertexOffset:c,primitiveOffset:f,vertexLength:v,primitiveLength:E,vaos:{},sortKey:0}])}}function _r(h,c){return 256*(h=He(Math.floor(h),0,255))+He(Math.floor(c),0,255)}Ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ui("SegmentVector",Ii);const pr=zn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var qi={exports:{}},Nr={exports:{}};Nr.exports=function(h,c){var f,v,E,M,R,G,K,Z;for(v=h.length-(f=3&h.length),E=c,R=3432918353,G=461845907,Z=0;Z<v;)K=255&h.charCodeAt(Z)|(255&h.charCodeAt(++Z))<<8|(255&h.charCodeAt(++Z))<<16|(255&h.charCodeAt(++Z))<<24,++Z,E=27492+(65535&(M=5*(65535&(E=(E^=K=(65535&(K=(K=(65535&K)*R+(((K>>>16)*R&65535)<<16)&4294967295)<<15|K>>>17))*G+(((K>>>16)*G&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(K=0,f){case 3:K^=(255&h.charCodeAt(Z+2))<<16;case 2:K^=(255&h.charCodeAt(Z+1))<<8;case 1:E^=K=(65535&(K=(K=(65535&(K^=255&h.charCodeAt(Z)))*R+(((K>>>16)*R&65535)<<16)&4294967295)<<15|K>>>17))*G+(((K>>>16)*G&65535)<<16)&4294967295}return E^=h.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0};var nn=Nr.exports,Pr={exports:{}};Pr.exports=function(h,c){for(var f,v=h.length,E=c^v,M=0;v>=4;)f=1540483477*(65535&(f=255&h.charCodeAt(M)|(255&h.charCodeAt(++M))<<8|(255&h.charCodeAt(++M))<<16|(255&h.charCodeAt(++M))<<24))+((1540483477*(f>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++M;switch(v){case 3:E^=(255&h.charCodeAt(M+2))<<16;case 2:E^=(255&h.charCodeAt(M+1))<<8;case 1:E=1540483477*(65535&(E^=255&h.charCodeAt(M)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0};var Wr=nn,Er=Pr.exports;qi.exports=Wr,qi.exports.murmur3=Wr,qi.exports.murmur2=Er;var is=b(qi.exports);class zr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,f,v,E){this.ids.push(gr(c)),this.positions.push(f,v,E)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=gr(c);let v=0,E=this.ids.length-1;for(;v<E;){const R=v+E>>1;this.ids[R]>=f?E=R:v=R+1}const M=[];for(;this.ids[v]===f;)M.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return M}static serialize(c,f){const v=new Float64Array(c.ids),E=new Uint32Array(c.positions);return vr(v,E,0,v.length-1),f&&f.push(v.buffer,E.buffer),{ids:v,positions:E}}static deserialize(c){const f=new zr;return f.ids=c.ids,f.positions=c.positions,f.indexed=!0,f}}function gr(h){const c=+h;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:is(String(h))}function vr(h,c,f,v){for(;f<v;){const E=h[f+v>>1];let M=f-1,R=v+1;for(;;){do M++;while(h[M]<E);do R--;while(h[R]>E);if(M>=R)break;ar(h,M,R),ar(c,3*M,3*R),ar(c,3*M+1,3*R+1),ar(c,3*M+2,3*R+2)}R-f<v-R?(vr(h,c,f,R),f=R+1):(vr(h,c,R+1,v),v=R)}}function ar(h,c,f){const v=h[c];h[c]=h[f],h[f]=v}Ui("FeaturePositionMap",zr);class cn{constructor(c,f){this.gl=c.gl,this.location=f}}class $r extends cn{constructor(c,f){super(c,f),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Xr extends cn{constructor(c,f){super(c,f),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Fn extends cn{constructor(c,f){super(c,f),this.current=cr.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const Wn=new Float32Array(16);function vl(h){return[_r(255*h.r,255*h.g),_r(255*h.b,255*h.a)]}class Kr{constructor(c,f,v){this.value=c,this.uniformNames=f.map(E=>`u_${E}`),this.type=v}setUniform(c,f,v){c.set(v.constantOr(this.value))}getBinding(c,f,v){return this.type==="color"?new Fn(c,f):new $r(c,f)}}class vn{constructor(c,f){this.uniformNames=f.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=c.tlbr}setUniform(c,f,v,E){const M=E==="u_pattern_to"?this.patternTo:E==="u_pattern_from"?this.patternFrom:E==="u_pixel_ratio_to"?this.pixelRatioTo:E==="u_pixel_ratio_from"?this.pixelRatioFrom:null;M&&c.set(M)}getBinding(c,f,v){return v.substr(0,9)==="u_pattern"?new Xr(c,f):new $r(c,f)}}class ia{constructor(c,f,v,E){this.expression=c,this.type=v,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new E}populatePaintArray(c,f,v,E,M){const R=this.paintVertexArray.length,G=this.expression.evaluate(new xi(0),f,{},E,[],M);this.paintVertexArray.resize(c),this._setPaintValue(R,c,G)}updatePaintArray(c,f,v,E){const M=this.expression.evaluate({zoom:0},v,E);this._setPaintValue(c,f,M)}_setPaintValue(c,f,v){if(this.type==="color"){const E=vl(v);for(let M=c;M<f;M++)this.paintVertexArray.emplace(M,E[0],E[1])}else{for(let E=c;E<f;E++)this.paintVertexArray.emplace(E,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Us{constructor(c,f,v,E,M,R){this.expression=c,this.uniformNames=f.map(G=>`u_${G}_t`),this.type=v,this.useIntegerZoom=E,this.zoom=M,this.maxValue=0,this.paintVertexAttributes=f.map(G=>({name:`a_${G}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new R}populatePaintArray(c,f,v,E,M){const R=this.expression.evaluate(new xi(this.zoom),f,{},E,[],M),G=this.expression.evaluate(new xi(this.zoom+1),f,{},E,[],M),K=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(K,c,R,G)}updatePaintArray(c,f,v,E){const M=this.expression.evaluate({zoom:this.zoom},v,E),R=this.expression.evaluate({zoom:this.zoom+1},v,E);this._setPaintValue(c,f,M,R)}_setPaintValue(c,f,v,E){if(this.type==="color"){const M=vl(v),R=vl(E);for(let G=c;G<f;G++)this.paintVertexArray.emplace(G,M[0],M[1],R[0],R[1])}else{for(let M=c;M<f;M++)this.paintVertexArray.emplace(M,v,E);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(E))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,f){const v=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,E=He(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);c.set(E)}getBinding(c,f,v){return new $r(c,f)}}class Xs{constructor(c,f,v,E,M,R){this.expression=c,this.type=f,this.useIntegerZoom=v,this.zoom=E,this.layerId=R,this.zoomInPaintVertexArray=new M,this.zoomOutPaintVertexArray=new M}populatePaintArray(c,f,v){const E=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(E,c,f.patterns&&f.patterns[this.layerId],v)}updatePaintArray(c,f,v,E,M){this._setPaintValues(c,f,v.patterns&&v.patterns[this.layerId],M)}_setPaintValues(c,f,v,E){if(!E||!v)return;const{min:M,mid:R,max:G}=v,K=E[M],Z=E[R],oe=E[G];if(K&&Z&&oe)for(let de=c;de<f;de++)this.zoomInPaintVertexArray.emplace(de,Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],K.tl[0],K.tl[1],K.br[0],K.br[1],Z.pixelRatio,K.pixelRatio),this.zoomOutPaintVertexArray.emplace(de,Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],oe.tl[0],oe.tl[1],oe.br[0],oe.br[1],Z.pixelRatio,oe.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,pr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,pr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uo{constructor(c,f,v){this.binders={},this._buffers=[];const E=[];for(const M in c.paint._values){if(!v(M))continue;const R=c.paint.get(M);if(!(R instanceof $n&&Le(R.property.specification)))continue;const G=zu(M,c.type),K=R.value,Z=R.property.specification.type,oe=R.property.useIntegerZoom,de=R.property.specification["property-type"],ye=de==="cross-faded"||de==="cross-faded-data-driven";if(K.kind==="constant")this.binders[M]=ye?new vn(K.value,G):new Kr(K.value,G,Z),E.push(`/u_${M}`);else if(K.kind==="source"||ye){const Ce=Oa(M,Z,"source");this.binders[M]=ye?new Xs(K,Z,oe,f,Ce,c.id):new ia(K,G,Z,Ce),E.push(`/a_${M}`)}else{const Ce=Oa(M,Z,"composite");this.binders[M]=new Us(K,G,Z,oe,f,Ce),E.push(`/z_${M}`)}}this.cacheKey=E.sort().join("")}getMaxValue(c){const f=this.binders[c];return f instanceof ia||f instanceof Us?f.maxValue:0}populatePaintArrays(c,f,v,E,M){for(const R in this.binders){const G=this.binders[R];(G instanceof ia||G instanceof Us||G instanceof Xs)&&G.populatePaintArray(c,f,v,E,M)}}setConstantPatternPositions(c,f){for(const v in this.binders){const E=this.binders[v];E instanceof vn&&E.setConstantPatternPositions(c,f)}}updatePaintArrays(c,f,v,E,M){let R=!1;for(const G in c){const K=f.getPositions(G);for(const Z of K){const oe=v.feature(Z.index);for(const de in this.binders){const ye=this.binders[de];if((ye instanceof ia||ye instanceof Us||ye instanceof Xs)&&ye.expression.isStateDependent===!0){const Ce=E.paint.get(de);ye.expression=Ce.value,ye.updatePaintArray(Z.start,Z.end,oe,c[G],M),R=!0}}}}return R}defines(){const c=[];for(const f in this.binders){const v=this.binders[f];(v instanceof Kr||v instanceof vn)&&c.push(...v.uniformNames.map(E=>`#define HAS_UNIFORM_${E}`))}return c}getBinderAttributes(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof ia||v instanceof Us)for(let E=0;E<v.paintVertexAttributes.length;E++)c.push(v.paintVertexAttributes[E].name);else if(v instanceof Xs)for(let E=0;E<pr.members.length;E++)c.push(pr.members[E].name)}return c}getBinderUniforms(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof Kr||v instanceof vn||v instanceof Us)for(const E of v.uniformNames)c.push(E)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,f){const v=[];for(const E in this.binders){const M=this.binders[E];if(M instanceof Kr||M instanceof vn||M instanceof Us){for(const R of M.uniformNames)if(f[R]){const G=M.getBinding(c,f[R],R);v.push({name:R,property:E,binding:G})}}}return v}setUniforms(c,f,v,E){for(const{name:M,property:R,binding:G}of f)this.binders[R].setUniform(G,E,v.get(R),M)}updatePaintBuffers(c){this._buffers=[];for(const f in this.binders){const v=this.binders[f];if(c&&v instanceof Xs){const E=c.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;E&&this._buffers.push(E)}else(v instanceof ia||v instanceof Us)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(c){for(const f in this.binders){const v=this.binders[f];(v instanceof ia||v instanceof Us||v instanceof Xs)&&v.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const f=this.binders[c];(f instanceof ia||f instanceof Us||f instanceof Xs)&&f.destroy()}}}class ao{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const E of c)this.programConfigurations[E.id]=new Uo(E,f,v);this.needsUpload=!1,this._featureMap=new zr,this._bufferOffset=0}populatePaintArrays(c,f,v,E,M,R){for(const G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(c,f,E,M,R);f.id!==void 0&&this._featureMap.add(f.id,v,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,f,v,E){for(const M of v)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(c,this._featureMap,f,M,E)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function zu(h,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${c}-`,"").replace(/-/g,"_")]}function Oa(h,c,f){const v={color:{source:_o,composite:q},number:{source:_,composite:_o}},E=function(M){return{"line-pattern":{source:gt,composite:gt},"fill-pattern":{source:gt,composite:gt},"fill-extrusion-pattern":{source:gt,composite:gt}}[M]}(h);return E&&E[f]||v[c][f]}Ui("ConstantBinder",Kr),Ui("CrossFadedConstantBinder",vn),Ui("SourceExpressionBinder",ia),Ui("CrossFadedCompositeBinder",Xs),Ui("CompositeExpressionBinder",Us),Ui("ProgramConfiguration",Uo,{omit:["_buffers"]}),Ui("ProgramConfigurationSet",ao);const Mn=8192,yc=Math.pow(2,14)-1,pu=-yc-1;function Hc(h){const c=Mn/h.extent,f=h.loadGeometry();for(let v=0;v<f.length;v++){const E=f[v];for(let M=0;M<E.length;M++){const R=E[M],G=Math.round(R.x*c),K=Math.round(R.y*c);R.x=He(G,pu,yc),R.y=He(K,pu,yc),(G<R.x||G>R.x+1||K<R.y||K>R.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Gc(h,c){return{type:h.type,id:h.id,properties:h.properties,geometry:c?Hc(h):[]}}function Qu(h,c,f,v,E){h.emplaceBack(2*c+(v+1)/2,2*f+(E+1)/2)}class sA{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.indexArray=new Ht,this.segments=new Ii,this.programConfigurations=new ao(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){const E=this.layers[0],M=[];let R=null,G=!1;E.type==="circle"&&(R=E.layout.get("circle-sort-key"),G=!R.isConstant());for(const{feature:K,id:Z,index:oe,sourceLayerIndex:de}of c){const ye=this.layers[0]._featureFilter.needGeometry,Ce=Gc(K,ye);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom),Ce,v))continue;const Ie=G?R.evaluate(Ce,{},v):void 0,Oe={id:Z,properties:K.properties,type:K.type,sourceLayerIndex:de,index:oe,geometry:ye?Ce.geometry:Hc(K),patterns:{},sortKey:Ie};M.push(Oe)}G&&M.sort((K,Z)=>K.sortKey-Z.sortKey);for(const K of M){const{geometry:Z,index:oe,sourceLayerIndex:de}=K,ye=c[oe].feature;this.addFeature(K,Z,oe,v),f.featureIndex.insert(ye,Z,oe,de,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,er),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,f,v,E){for(const M of f)for(const R of M){const G=R.x,K=R.y;if(G<0||G>=Mn||K<0||K>=Mn)continue;const Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),oe=Z.vertexLength;Qu(this.layoutVertexArray,G,K,-1,-1),Qu(this.layoutVertexArray,G,K,1,-1),Qu(this.layoutVertexArray,G,K,1,1),Qu(this.layoutVertexArray,G,K,-1,1),this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+3,oe+2),Z.vertexLength+=4,Z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,{},E)}}function jc(h,c){for(let f=0;f<h.length;f++)if(ec(c,h[f]))return!0;for(let f=0;f<c.length;f++)if(ec(h,c[f]))return!0;return!!Vu(h,c)}function jA(h,c,f){return!!ec(h,c)||!!Od(c,h,f)}function oA(h,c){if(h.length===1)return ra(c,h[0]);for(let f=0;f<c.length;f++){const v=c[f];for(let E=0;E<v.length;E++)if(ec(h,v[E]))return!0}for(let f=0;f<h.length;f++)if(ra(c,h[f]))return!0;for(let f=0;f<c.length;f++)if(Vu(h,c[f]))return!0;return!1}function kd(h,c,f){if(h.length>1){if(Vu(h,c))return!0;for(let v=0;v<c.length;v++)if(Od(c[v],h,f))return!0}for(let v=0;v<h.length;v++)if(Od(h[v],c,f))return!0;return!1}function Vu(h,c){if(h.length===0||c.length===0)return!1;for(let f=0;f<h.length-1;f++){const v=h[f],E=h[f+1];for(let M=0;M<c.length-1;M++)if(gu(v,E,c[M],c[M+1]))return!0}return!1}function gu(h,c,f,v){return Ct(h,f,v)!==Ct(c,f,v)&&Ct(h,c,f)!==Ct(h,c,v)}function Od(h,c,f){const v=f*f;if(c.length===1)return h.distSqr(c[0])<v;for(let E=1;E<c.length;E++)if(Am(h,c[E-1],c[E])<v)return!0;return!1}function Am(h,c,f){const v=c.distSqr(f);if(v===0)return h.distSqr(c);const E=((h.x-c.x)*(f.x-c.x)+(h.y-c.y)*(f.y-c.y))/v;return h.distSqr(E<0?c:E>1?f:f.sub(c)._mult(E)._add(c))}function ra(h,c){let f,v,E,M=!1;for(let R=0;R<h.length;R++){f=h[R];for(let G=0,K=f.length-1;G<f.length;K=G++)v=f[G],E=f[K],v.y>c.y!=E.y>c.y&&c.x<(E.x-v.x)*(c.y-v.y)/(E.y-v.y)+v.x&&(M=!M)}return M}function ec(h,c){let f=!1;for(let v=0,E=h.length-1;v<h.length;E=v++){const M=h[v],R=h[E];M.y>c.y!=R.y>c.y&&c.x<(R.x-M.x)*(c.y-M.y)/(R.y-M.y)+M.x&&(f=!f)}return f}function aA(h,c,f){const v=f[0],E=f[2];if(h.x<v.x&&c.x<v.x||h.x>E.x&&c.x>E.x||h.y<v.y&&c.y<v.y||h.y>E.y&&c.y>E.y)return!1;const M=Ct(h,c,f[0]);return M!==Ct(h,c,f[1])||M!==Ct(h,c,f[2])||M!==Ct(h,c,f[3])}function wh(h,c,f){const v=c.paint.get(h).value;return v.kind==="constant"?v.value:f.programConfigurations.get(c.id).getMaxValue(h)}function mu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Bh(h,c,f,v,E){if(!c[0]&&!c[1])return h;const M=D.convert(c)._mult(E);f==="viewport"&&M._rotate(-v);const R=[];for(let G=0;G<h.length;G++)R.push(h[G].sub(M));return R}let Ch,lA;Ui("CircleBucket",sA,{omit:["layers"]});var Yf={get paint(){return lA=lA||new rn({"circle-radius":new zi(ht.paint_circle["circle-radius"]),"circle-color":new zi(ht.paint_circle["circle-color"]),"circle-blur":new zi(ht.paint_circle["circle-blur"]),"circle-opacity":new zi(ht.paint_circle["circle-opacity"]),"circle-translate":new Ki(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Ki(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ki(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ki(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zi(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zi(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zi(ht.paint_circle["circle-stroke-opacity"])})},get layout(){return Ch=Ch||new rn({"circle-sort-key":new zi(ht.layout_circle["circle-sort-key"])})}},na=1e-6,qc=typeof Float32Array<"u"?Float32Array:Array;function Ud(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function cA(h,c,f){var v=c[0],E=c[1],M=c[2],R=c[3],G=c[4],K=c[5],Z=c[6],oe=c[7],de=c[8],ye=c[9],Ce=c[10],Ie=c[11],Oe=c[12],qe=c[13],Ke=c[14],ut=c[15],et=f[0],it=f[1],mt=f[2],Tt=f[3];return h[0]=et*v+it*G+mt*de+Tt*Oe,h[1]=et*E+it*K+mt*ye+Tt*qe,h[2]=et*M+it*Z+mt*Ce+Tt*Ke,h[3]=et*R+it*oe+mt*Ie+Tt*ut,h[4]=(et=f[4])*v+(it=f[5])*G+(mt=f[6])*de+(Tt=f[7])*Oe,h[5]=et*E+it*K+mt*ye+Tt*qe,h[6]=et*M+it*Z+mt*Ce+Tt*Ke,h[7]=et*R+it*oe+mt*Ie+Tt*ut,h[8]=(et=f[8])*v+(it=f[9])*G+(mt=f[10])*de+(Tt=f[11])*Oe,h[9]=et*E+it*K+mt*ye+Tt*qe,h[10]=et*M+it*Z+mt*Ce+Tt*Ke,h[11]=et*R+it*oe+mt*Ie+Tt*ut,h[12]=(et=f[12])*v+(it=f[13])*G+(mt=f[14])*de+(Tt=f[15])*Oe,h[13]=et*E+it*K+mt*ye+Tt*qe,h[14]=et*M+it*Z+mt*Ce+Tt*Ke,h[15]=et*R+it*oe+mt*Ie+Tt*ut,h}Math.hypot||(Math.hypot=function(){for(var h=0,c=arguments.length;c--;)h+=arguments[c]*arguments[c];return Math.sqrt(h)});var bl,Nd=cA;function yu(h,c,f){var v=c[0],E=c[1],M=c[2],R=c[3];return h[0]=f[0]*v+f[4]*E+f[8]*M+f[12]*R,h[1]=f[1]*v+f[5]*E+f[9]*M+f[13]*R,h[2]=f[2]*v+f[6]*E+f[10]*M+f[14]*R,h[3]=f[3]*v+f[7]*E+f[11]*M+f[15]*R,h}bl=new qc(4),qc!=Float32Array&&(bl[0]=0,bl[1]=0,bl[2]=0,bl[3]=0);class xl extends ko{constructor(c){super(c,Yf)}createBucket(c){return new sA(c)}queryRadius(c){const f=c;return wh("circle-radius",this,f)+wh("circle-stroke-width",this,f)+mu(this.paint.get("circle-translate"))}queryIntersectsFeature(c,f,v,E,M,R,G,K){const Z=Bh(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,G),oe=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),de=this.paint.get("circle-pitch-alignment")==="map",ye=de?Z:function(Ie,Oe){return Ie.map(qe=>zd(qe,Oe))}(Z,K),Ce=de?oe*G:oe;for(const Ie of E)for(const Oe of Ie){const qe=de?Oe:zd(Oe,K);let Ke=Ce;const ut=yu([],[Oe.x,Oe.y,0,1],K);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ke*=ut[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ke*=R.cameraToCenterDistance/ut[3]),jA(ye,qe,Ke))return!0}return!1}}function zd(h,c){const f=yu([],[h.x,h.y,0,1],c);return new D(f[0]/f[3],f[1]/f[3])}class Eh extends sA{}let ep;Ui("HeatmapBucket",Eh,{omit:["layers"]});var dm={get paint(){return ep=ep||new rn({"heatmap-radius":new zi(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zi(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ki(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ks(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ki(ht.paint_heatmap["heatmap-opacity"])})}};function tp(h,c,f,v){let{width:E,height:M}=c;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==E*M*f)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${E*M*f}`)}else v=new Uint8Array(E*M*f);return h.width=E,h.height=M,h.data=v,h}function ip(h,c,f){let{width:v,height:E}=c;if(v===h.width&&E===h.height)return;const M=tp({},{width:v,height:E},f);rp(h,M,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,v),height:Math.min(h.height,E)},f),h.width=v,h.height=E,h.data=M.data}function rp(h,c,f,v,E,M){if(E.width===0||E.height===0)return c;if(E.width>h.width||E.height>h.height||f.x>h.width-E.width||f.y>h.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>c.width||E.height>c.height||v.x>c.width-E.width||v.y>c.height-E.height)throw new RangeError("out of range destination coordinates for image copy");const R=h.data,G=c.data;if(R===G)throw new Error("srcData equals dstData, so image is already copied");for(let K=0;K<E.height;K++){const Z=((f.y+K)*h.width+f.x)*M,oe=((v.y+K)*c.width+v.x)*M;for(let de=0;de<E.width*M;de++)G[oe+de]=R[Z+de]}return c}class _c{constructor(c,f){tp(this,c,1,f)}resize(c){ip(this,c,1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,E,M){rp(c,f,v,E,M,1)}}class No{constructor(c,f){tp(this,c,4,f)}resize(c){ip(this,c,4)}replace(c,f){f?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,E,M){rp(c,f,v,E,M,4)}}function uA(h){const c={},f=h.resolution||256,v=h.clips?h.clips.length:1,E=h.image||new No({width:f,height:v});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const M=(R,G,K)=>{c[h.evaluationKey]=K;const Z=h.expression.evaluate(c);E.data[R+G+0]=Math.floor(255*Z.r/Z.a),E.data[R+G+1]=Math.floor(255*Z.g/Z.a),E.data[R+G+2]=Math.floor(255*Z.b/Z.a),E.data[R+G+3]=Math.floor(255*Z.a)};if(h.clips)for(let R=0,G=0;R<v;++R,G+=4*f)for(let K=0,Z=0;K<f;K++,Z+=4){const oe=K/(f-1),{start:de,end:ye}=h.clips[R];M(G,Z,de*(1-oe)+ye*oe)}else for(let R=0,G=0;R<f;R++,G+=4)M(0,G,R/(f-1));return E}Ui("AlphaImage",_c),Ui("RGBAImage",No);class Ua extends ko{createBucket(c){return new Eh(c)}constructor(c){super(c,dm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wl;var Hu={get paint(){return wl=wl||new rn({"hillshade-illumination-direction":new Ki(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ki(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ki(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ki(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ki(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ki(ht.paint_hillshade["hillshade-accent-color"])})}};class Qd extends ko{constructor(c){super(c,Hu)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const np=zn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fm}=np;var sp={exports:{}};function hA(h,c,f){f=f||2;var v,E,M,R,G,K,Z,oe=c&&c.length,de=oe?c[0]*f:h.length,ye=Vd(h,0,de,f,!0),Ce=[];if(!ye||ye.next===ye.prev)return Ce;if(oe&&(ye=function(Oe,qe,Ke,ut){var et,it,mt,Tt=[];for(et=0,it=qe.length;et<it;et++)(mt=Vd(Oe,qe[et]*ut,et<it-1?qe[et+1]*ut:Oe.length,ut,!1))===mt.next&&(mt.steiner=!0),Tt.push(ax(mt));for(Tt.sort(ox),et=0;et<Tt.length;et++)Ke=gm(Tt[et],Ke);return Ke}(h,c,ye,f)),h.length>80*f){v=M=h[0],E=R=h[1];for(var Ie=f;Ie<de;Ie+=f)(G=h[Ie])<v&&(v=G),(K=h[Ie+1])<E&&(E=K),G>M&&(M=G),K>R&&(R=K);Z=(Z=Math.max(M-v,R-E))!==0?32767/Z:0}return op(ye,Ce,f,v,E,Z,0),Ce}function Vd(h,c,f,v,E){var M,R;if(E===hp(h,c,f,v)>0)for(M=c;M<f;M+=v)R=_m(M,h[M],h[M+1],R);else for(M=f-v;M>=c;M-=v)R=_m(M,h[M],h[M+1],R);return R&&Gd(R,R.next)&&(cp(R),R=R.next),R}function Sh(h,c){if(!h)return h;c||(c=h);var f,v=h;do if(f=!1,v.steiner||!Gd(v,v.next)&&Ns(v.prev,v,v.next)!==0)v=v.next;else{if(cp(v),(v=c=v.prev)===v.next)break;f=!0}while(f||v!==c);return c}function op(h,c,f,v,E,M,R){if(h){!R&&M&&function(oe,de,ye,Ce){var Ie=oe;do Ie.z===0&&(Ie.z=qA(Ie.x,Ie.y,de,ye,Ce)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==oe);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(Oe){var qe,Ke,ut,et,it,mt,Tt,Zt,wi=1;do{for(Ke=Oe,Oe=null,it=null,mt=0;Ke;){for(mt++,ut=Ke,Tt=0,qe=0;qe<wi&&(Tt++,ut=ut.nextZ);qe++);for(Zt=wi;Tt>0||Zt>0&&ut;)Tt!==0&&(Zt===0||!ut||Ke.z<=ut.z)?(et=Ke,Ke=Ke.nextZ,Tt--):(et=ut,ut=ut.nextZ,Zt--),it?it.nextZ=et:Oe=et,et.prevZ=it,it=et;Ke=ut}it.nextZ=null,wi*=2}while(mt>1)}(Ie)}(h,v,E,M);for(var G,K,Z=h;h.prev!==h.next;)if(G=h.prev,K=h.next,M?fI(h,v,E,M):Hd(h))c.push(G.i/f|0),c.push(h.i/f|0),c.push(K.i/f|0),cp(h),h=K.next,Z=K.next;else if((h=K)===Z){R?R===1?op(h=Zs(Sh(h),c,f),c,f,v,E,M,2):R===2&&pm(h,c,f,v,E,M):op(Sh(h),c,f,v,E,M,1);break}}}function Hd(h){var c=h.prev,f=h,v=h.next;if(Ns(c,f,v)>=0)return!1;for(var E=c.x,M=f.x,R=v.x,G=c.y,K=f.y,Z=v.y,oe=E<M?E<R?E:R:M<R?M:R,de=G<K?G<Z?G:Z:K<Z?K:Z,ye=E>M?E>R?E:R:M>R?M:R,Ce=G>K?G>Z?G:Z:K>Z?K:Z,Ie=v.next;Ie!==c;){if(Ie.x>=oe&&Ie.x<=ye&&Ie.y>=de&&Ie.y<=Ce&&$A(E,G,M,K,R,Z,Ie.x,Ie.y)&&Ns(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.next}return!0}function fI(h,c,f,v){var E=h.prev,M=h,R=h.next;if(Ns(E,M,R)>=0)return!1;for(var G=E.x,K=M.x,Z=R.x,oe=E.y,de=M.y,ye=R.y,Ce=G<K?G<Z?G:Z:K<Z?K:Z,Ie=oe<de?oe<ye?oe:ye:de<ye?de:ye,Oe=G>K?G>Z?G:Z:K>Z?K:Z,qe=oe>de?oe>ye?oe:ye:de>ye?de:ye,Ke=qA(Ce,Ie,c,f,v),ut=qA(Oe,qe,c,f,v),et=h.prevZ,it=h.nextZ;et&&et.z>=Ke&&it&&it.z<=ut;){if(et.x>=Ce&&et.x<=Oe&&et.y>=Ie&&et.y<=qe&&et!==E&&et!==R&&$A(G,oe,K,de,Z,ye,et.x,et.y)&&Ns(et.prev,et,et.next)>=0||(et=et.prevZ,it.x>=Ce&&it.x<=Oe&&it.y>=Ie&&it.y<=qe&&it!==E&&it!==R&&$A(G,oe,K,de,Z,ye,it.x,it.y)&&Ns(it.prev,it,it.next)>=0))return!1;it=it.nextZ}for(;et&&et.z>=Ke;){if(et.x>=Ce&&et.x<=Oe&&et.y>=Ie&&et.y<=qe&&et!==E&&et!==R&&$A(G,oe,K,de,Z,ye,et.x,et.y)&&Ns(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;it&&it.z<=ut;){if(it.x>=Ce&&it.x<=Oe&&it.y>=Ie&&it.y<=qe&&it!==E&&it!==R&&$A(G,oe,K,de,Z,ye,it.x,it.y)&&Ns(it.prev,it,it.next)>=0)return!1;it=it.nextZ}return!0}function Zs(h,c,f){var v=h;do{var E=v.prev,M=v.next.next;!Gd(E,M)&&U0(E,v,v.next,M)&&Th(E,M)&&Th(M,E)&&(c.push(E.i/f|0),c.push(v.i/f|0),c.push(M.i/f|0),cp(v),cp(v.next),v=h=M),v=v.next}while(v!==h);return Sh(v)}function pm(h,c,f,v,E,M){var R=h;do{for(var G=R.next.next;G!==R.prev;){if(R.i!==G.i&&ap(R,G)){var K=lx(R,G);return R=Sh(R,R.next),K=Sh(K,K.next),op(R,c,f,v,E,M,0),void op(K,c,f,v,E,M,0)}G=G.next}R=R.next}while(R!==h)}function ox(h,c){return h.x-c.x}function gm(h,c){var f=function(E,M){var R,G=M,K=E.x,Z=E.y,oe=-1/0;do{if(Z<=G.y&&Z>=G.next.y&&G.next.y!==G.y){var de=G.x+(Z-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(de<=K&&de>oe&&(oe=de,R=G.x<G.next.x?G:G.next,de===K))return R}G=G.next}while(G!==M);if(!R)return null;var ye,Ce=R,Ie=R.x,Oe=R.y,qe=1/0;G=R;do K>=G.x&&G.x>=Ie&&K!==G.x&&$A(Z<Oe?K:oe,Z,Ie,Oe,Z<Oe?oe:K,Z,G.x,G.y)&&(ye=Math.abs(Z-G.y)/(K-G.x),Th(G,E)&&(ye<qe||ye===qe&&(G.x>R.x||G.x===R.x&&mm(R,G)))&&(R=G,qe=ye)),G=G.next;while(G!==Ce);return R}(h,c);if(!f)return c;var v=lx(f,h);return Sh(v,v.next),Sh(f,f.next)}function mm(h,c){return Ns(h.prev,h,c.prev)<0&&Ns(c.next,h,h.next)<0}function qA(h,c,f,v,E){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-f)*E|0)|h<<8))|h<<4))|h<<2))|h<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-v)*E|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function ax(h){var c=h,f=h;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==h);return f}function $A(h,c,f,v,E,M,R,G){return(E-R)*(c-G)>=(h-R)*(M-G)&&(h-R)*(v-G)>=(f-R)*(c-G)&&(f-R)*(M-G)>=(E-R)*(v-G)}function ap(h,c){return h.next.i!==c.i&&h.prev.i!==c.i&&!function(f,v){var E=f;do{if(E.i!==f.i&&E.next.i!==f.i&&E.i!==v.i&&E.next.i!==v.i&&U0(E,E.next,f,v))return!0;E=E.next}while(E!==f);return!1}(h,c)&&(Th(h,c)&&Th(c,h)&&function(f,v){var E=f,M=!1,R=(f.x+v.x)/2,G=(f.y+v.y)/2;do E.y>G!=E.next.y>G&&E.next.y!==E.y&&R<(E.next.x-E.x)*(G-E.y)/(E.next.y-E.y)+E.x&&(M=!M),E=E.next;while(E!==f);return M}(h,c)&&(Ns(h.prev,h,c.prev)||Ns(h,c.prev,c))||Gd(h,c)&&Ns(h.prev,h,h.next)>0&&Ns(c.prev,c,c.next)>0)}function Ns(h,c,f){return(c.y-h.y)*(f.x-c.x)-(c.x-h.x)*(f.y-c.y)}function Gd(h,c){return h.x===c.x&&h.y===c.y}function U0(h,c,f,v){var E=lp(Ns(h,c,f)),M=lp(Ns(h,c,v)),R=lp(Ns(f,v,h)),G=lp(Ns(f,v,c));return E!==M&&R!==G||!(E!==0||!ym(h,f,c))||!(M!==0||!ym(h,v,c))||!(R!==0||!ym(f,h,v))||!(G!==0||!ym(f,c,v))}function ym(h,c,f){return c.x<=Math.max(h.x,f.x)&&c.x>=Math.min(h.x,f.x)&&c.y<=Math.max(h.y,f.y)&&c.y>=Math.min(h.y,f.y)}function lp(h){return h>0?1:h<0?-1:0}function Th(h,c){return Ns(h.prev,h,h.next)<0?Ns(h,c,h.next)>=0&&Ns(h,h.prev,c)>=0:Ns(h,c,h.prev)<0||Ns(h,h.next,c)<0}function lx(h,c){var f=new up(h.i,h.x,h.y),v=new up(c.i,c.x,c.y),E=h.next,M=c.prev;return h.next=c,c.prev=h,f.next=E,E.prev=f,v.next=f,f.prev=v,M.next=v,v.prev=M,v}function _m(h,c,f,v){var E=new up(h,c,f);return v?(E.next=v.next,E.prev=v,v.next.prev=E,v.next=E):(E.prev=E,E.next=E),E}function cp(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function up(h,c,f){this.i=h,this.x=c,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hp(h,c,f,v){for(var E=0,M=c,R=f-v;M<f;M+=v)E+=(h[R]-h[M])*(h[M+1]+h[R+1]),R=M;return E}sp.exports=hA,sp.exports.default=hA,hA.deviation=function(h,c,f,v){var E=c&&c.length,M=Math.abs(hp(h,0,E?c[0]*f:h.length,f));if(E)for(var R=0,G=c.length;R<G;R++)M-=Math.abs(hp(h,c[R]*f,R<G-1?c[R+1]*f:h.length,f));var K=0;for(R=0;R<v.length;R+=3){var Z=v[R]*f,oe=v[R+1]*f,de=v[R+2]*f;K+=Math.abs((h[Z]-h[de])*(h[oe+1]-h[Z+1])-(h[Z]-h[oe])*(h[de+1]-h[Z+1]))}return M===0&&K===0?0:Math.abs((K-M)/M)},hA.flatten=function(h){for(var c=h[0][0].length,f={vertices:[],holes:[],dimensions:c},v=0,E=0;E<h.length;E++){for(var M=0;M<h[E].length;M++)for(var R=0;R<c;R++)f.vertices.push(h[E][M][R]);E>0&&f.holes.push(v+=h[E-1].length)}return f};var vm=b(sp.exports);function cx(h,c,f,v,E){N0(h,c,f||0,v||h.length-1,E||pI)}function N0(h,c,f,v,E){for(;v>f;){if(v-f>600){var M=v-f+1,R=c-f+1,G=Math.log(M),K=.5*Math.exp(2*G/3),Z=.5*Math.sqrt(G*K*(M-K)/M)*(R-M/2<0?-1:1);N0(h,c,Math.max(f,Math.floor(c-R*K/M+Z)),Math.min(v,Math.floor(c+(M-R)*K/M+Z)),E)}var oe=h[c],de=f,ye=v;for(Ap(h,f,c),E(h[v],oe)>0&&Ap(h,f,v);de<ye;){for(Ap(h,de,ye),de++,ye--;E(h[de],oe)<0;)de++;for(;E(h[ye],oe)>0;)ye--}E(h[f],oe)===0?Ap(h,f,ye):Ap(h,++ye,v),ye<=c&&(f=ye+1),c<=ye&&(v=ye-1)}}function Ap(h,c,f){var v=h[c];h[c]=h[f],h[f]=v}function pI(h,c){return h<c?-1:h>c?1:0}function z0(h,c){const f=h.length;if(f<=1)return[h];const v=[];let E,M;for(let R=0;R<f;R++){const G=Et(h[R]);G!==0&&(h[R].area=Math.abs(G),M===void 0&&(M=G<0),M===G<0?(E&&v.push(E),E=[h[R]]):E.push(h[R]))}if(E&&v.push(E),c>1)for(let R=0;R<v.length;R++)v[R].length<=c||(cx(v[R],c,1,v[R].length-1,gI),v[R]=v[R].slice(0,c));return v}function gI(h,c){return c.area-h.area}function Q0(h,c,f){const v=f.patternDependencies;let E=!1;for(const M of c){const R=M.paint.get(`${h}-pattern`);R.isConstant()||(E=!0);const G=R.constantOr(null);G&&(E=!0,v[G.to]=!0,v[G.from]=!0)}return E}function Gu(h,c,f,v,E){const M=E.patternDependencies;for(const R of c){const G=R.paint.get(`${h}-pattern`).value;if(G.kind!=="constant"){let K=G.evaluate({zoom:v-1},f,{},E.availableImages),Z=G.evaluate({zoom:v},f,{},E.availableImages),oe=G.evaluate({zoom:v+1},f,{},E.availableImages);K=K&&K.name?K.name:K,Z=Z&&Z.name?Z.name:Z,oe=oe&&oe.name?oe.name:oe,M[K]=!0,M[Z]=!0,M[oe]=!0,f.patterns[R.id]={min:K,mid:Z,max:oe}}}return f}class V0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new st,this.indexArray=new Ht,this.indexArray2=new vi,this.programConfigurations=new ao(c.layers,c.zoom),this.segments=new Ii,this.segments2=new Ii,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.hasPattern=Q0("fill",this.layers,f);const E=this.layers[0].layout.get("fill-sort-key"),M=!E.isConstant(),R=[];for(const{feature:G,id:K,index:Z,sourceLayerIndex:oe}of c){const de=this.layers[0]._featureFilter.needGeometry,ye=Gc(G,de);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom),ye,v))continue;const Ce=M?E.evaluate(ye,{},v,f.availableImages):void 0,Ie={id:K,properties:G.properties,type:G.type,sourceLayerIndex:oe,index:Z,geometry:de?ye.geometry:Hc(G),patterns:{},sortKey:Ce};R.push(Ie)}M&&R.sort((G,K)=>G.sortKey-K.sortKey);for(const G of R){const{geometry:K,index:Z,sourceLayerIndex:oe}=G;if(this.hasPattern){const de=Gu("fill",this.layers,G,this.zoom,f);this.patternFeatures.push(de)}else this.addFeature(G,K,Z,v,{});f.featureIndex.insert(c[Z].feature,K,Z,oe,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}addFeatures(c,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,fm),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,f,v,E,M){for(const R of z0(f,500)){let G=0;for(const Ce of R)G+=Ce.length;const K=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),Z=K.vertexLength,oe=[],de=[];for(const Ce of R){if(Ce.length===0)continue;Ce!==R[0]&&de.push(oe.length/2);const Ie=this.segments2.prepareSegment(Ce.length,this.layoutVertexArray,this.indexArray2),Oe=Ie.vertexLength;this.layoutVertexArray.emplaceBack(Ce[0].x,Ce[0].y),this.indexArray2.emplaceBack(Oe+Ce.length-1,Oe),oe.push(Ce[0].x),oe.push(Ce[0].y);for(let qe=1;qe<Ce.length;qe++)this.layoutVertexArray.emplaceBack(Ce[qe].x,Ce[qe].y),this.indexArray2.emplaceBack(Oe+qe-1,Oe+qe),oe.push(Ce[qe].x),oe.push(Ce[qe].y);Ie.vertexLength+=Ce.length,Ie.primitiveLength+=Ce.length}const ye=vm(oe,de);for(let Ce=0;Ce<ye.length;Ce+=3)this.indexArray.emplaceBack(Z+ye[Ce],Z+ye[Ce+1],Z+ye[Ce+2]);K.vertexLength+=G,K.primitiveLength+=ye.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}}let H0,KA;Ui("FillBucket",V0,{omit:["layers","patternFeatures"]});var mI={get paint(){return KA=KA||new rn({"fill-antialias":new Ki(ht.paint_fill["fill-antialias"]),"fill-opacity":new zi(ht.paint_fill["fill-opacity"]),"fill-color":new zi(ht.paint_fill["fill-color"]),"fill-outline-color":new zi(ht.paint_fill["fill-outline-color"]),"fill-translate":new Ki(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Ki(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kn(ht.paint_fill["fill-pattern"])})},get layout(){return H0=H0||new rn({"fill-sort-key":new zi(ht.layout_fill["fill-sort-key"])})}};class yI extends ko{constructor(c){super(c,mI)}recalculate(c,f){super.recalculate(c,f);const v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new V0(c)}queryRadius(){return mu(this.paint.get("fill-translate"))}queryIntersectsFeature(c,f,v,E,M,R,G){return oA(Bh(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,G),E)}isTileClipped(){return!0}}const _I=zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ux=zn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hx}=_I;var AA={},vI=S,Ax=jd;function jd(h,c,f,v,E){this.properties={},this.extent=f,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=E,h.readFields(G0,this,c)}function G0(h,c,f){h==1?c.id=f.readVarint():h==2?function(v,E){for(var M=v.readVarint()+v.pos;v.pos<M;){var R=E._keys[v.readVarint()],G=E._values[v.readVarint()];E.properties[R]=G}}(f,c):h==3?c.type=f.readVarint():h==4&&(c._geometry=f.pos)}function dp(h){for(var c,f,v=0,E=0,M=h.length,R=M-1;E<M;R=E++)v+=((f=h[R]).x-(c=h[E]).x)*(c.y+f.y);return v}jd.types=["Unknown","Point","LineString","Polygon"],jd.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var c,f=h.readVarint()+h.pos,v=1,E=0,M=0,R=0,G=[];h.pos<f;){if(E<=0){var K=h.readVarint();v=7&K,E=K>>3}if(E--,v===1||v===2)M+=h.readSVarint(),R+=h.readSVarint(),v===1&&(c&&G.push(c),c=[]),c.push(new vI(M,R));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&G.push(c),G},jd.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var c=h.readVarint()+h.pos,f=1,v=0,E=0,M=0,R=1/0,G=-1/0,K=1/0,Z=-1/0;h.pos<c;){if(v<=0){var oe=h.readVarint();f=7&oe,v=oe>>3}if(v--,f===1||f===2)(E+=h.readSVarint())<R&&(R=E),E>G&&(G=E),(M+=h.readSVarint())<K&&(K=M),M>Z&&(Z=M);else if(f!==7)throw new Error("unknown command "+f)}return[R,K,G,Z]},jd.prototype.toGeoJSON=function(h,c,f){var v,E,M=this.extent*Math.pow(2,f),R=this.extent*h,G=this.extent*c,K=this.loadGeometry(),Z=jd.types[this.type];function oe(Ce){for(var Ie=0;Ie<Ce.length;Ie++){var Oe=Ce[Ie];Ce[Ie]=[360*(Oe.x+R)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+G)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var de=[];for(v=0;v<K.length;v++)de[v]=K[v][0];oe(K=de);break;case 2:for(v=0;v<K.length;v++)oe(K[v]);break;case 3:for(K=function(Ce){var Ie=Ce.length;if(Ie<=1)return[Ce];for(var Oe,qe,Ke=[],ut=0;ut<Ie;ut++){var et=dp(Ce[ut]);et!==0&&(qe===void 0&&(qe=et<0),qe===et<0?(Oe&&Ke.push(Oe),Oe=[Ce[ut]]):Oe.push(Ce[ut]))}return Oe&&Ke.push(Oe),Ke}(K),v=0;v<K.length;v++)for(E=0;E<K[v].length;E++)oe(K[v][E])}K.length===1?K=K[0]:Z="Multi"+Z;var ye={type:"Feature",geometry:{type:Z,coordinates:K},properties:this.properties};return"id"in this&&(ye.id=this.id),ye};var j0=Ax,dx=fx;function fx(h,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(px,this,c),this.length=this._features.length}function px(h,c,f){h===15?c.version=f.readVarint():h===1?c.name=f.readString():h===5?c.extent=f.readVarint():h===2?c._features.push(f.pos):h===3?c._keys.push(f.readString()):h===4&&c._values.push(function(v){for(var E=null,M=v.readVarint()+v.pos;v.pos<M;){var R=v.readVarint()>>3;E=R===1?v.readString():R===2?v.readFloat():R===3?v.readDouble():R===4?v.readVarint64():R===5?v.readVarint():R===6?v.readSVarint():R===7?v.readBoolean():null}return E}(f))}fx.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var c=this._pbf.readVarint()+this._pbf.pos;return new j0(this._pbf,c,this.extent,this._keys,this._values)};var bI=dx;function xI(h,c,f){if(h===3){var v=new bI(f,f.readVarint()+f.pos);v.length&&(c[v.name]=v)}}AA.VectorTile=function(h,c){this.layers=h.readFields(xI,{},c)},AA.VectorTileFeature=Ax,AA.VectorTileLayer=dx;const fp=AA.VectorTileFeature.types,bm=Math.pow(2,13);function pp(h,c,f,v,E,M,R,G){h.emplaceBack(c,f,2*Math.floor(v*bm)+R,E*bm*2,M*bm*2,Math.round(G))}class q0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new We,this.centroidVertexArray=new De,this.indexArray=new Ht,this.programConfigurations=new ao(c.layers,c.zoom),this.segments=new Ii,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.features=[],this.hasPattern=Q0("fill-extrusion",this.layers,f);for(const{feature:E,id:M,index:R,sourceLayerIndex:G}of c){const K=this.layers[0]._featureFilter.needGeometry,Z=Gc(E,K);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom),Z,v))continue;const oe={id:M,sourceLayerIndex:G,index:R,geometry:K?Z.geometry:Hc(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(Gu("fill-extrusion",this.layers,oe,this.zoom,f)):this.addFeature(oe,oe.geometry,R,v,{}),f.featureIndex.insert(E,oe.geometry,R,G,this.index,!0)}}addFeatures(c,f,v){for(const E of this.features){const{geometry:M}=E;this.addFeature(E,M,E.index,f,v)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,hx),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,ux.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,f,v,E,M){const R={x:0,y:0,vertexCount:0};for(const G of z0(f,500)){let K=0;for(const Ie of G)K+=Ie.length;let Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Ie of G){if(Ie.length===0||BI(Ie))continue;let Oe=0;for(let qe=0;qe<Ie.length;qe++){const Ke=Ie[qe];if(qe>=1){const ut=Ie[qe-1];if(!wI(Ke,ut)){Z.vertexLength+4>Ii.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const et=Ke.sub(ut)._perp()._unit(),it=ut.dist(Ke);Oe+it>32768&&(Oe=0),pp(this.layoutVertexArray,Ke.x,Ke.y,et.x,et.y,0,0,Oe),pp(this.layoutVertexArray,Ke.x,Ke.y,et.x,et.y,0,1,Oe),R.x+=2*Ke.x,R.y+=2*Ke.y,R.vertexCount+=2,Oe+=it,pp(this.layoutVertexArray,ut.x,ut.y,et.x,et.y,0,0,Oe),pp(this.layoutVertexArray,ut.x,ut.y,et.x,et.y,0,1,Oe),R.x+=2*ut.x,R.y+=2*ut.y,R.vertexCount+=2;const mt=Z.vertexLength;this.indexArray.emplaceBack(mt,mt+2,mt+1),this.indexArray.emplaceBack(mt+1,mt+2,mt+3),Z.vertexLength+=4,Z.primitiveLength+=2}}}}if(Z.vertexLength+K>Ii.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray)),fp[c.type]!=="Polygon")continue;const oe=[],de=[],ye=Z.vertexLength;for(const Ie of G)if(Ie.length!==0){Ie!==G[0]&&de.push(oe.length/2);for(let Oe=0;Oe<Ie.length;Oe++){const qe=Ie[Oe];pp(this.layoutVertexArray,qe.x,qe.y,0,0,1,1,0),R.x+=qe.x,R.y+=qe.y,R.vertexCount+=1,oe.push(qe.x),oe.push(qe.y)}}const Ce=vm(oe,de);for(let Ie=0;Ie<Ce.length;Ie+=3)this.indexArray.emplaceBack(ye+Ce[Ie],ye+Ce[Ie+2],ye+Ce[Ie+1]);Z.primitiveLength+=Ce.length/3,Z.vertexLength+=K}for(let G=0;G<R.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(R.x/R.vertexCount),Math.floor(R.y/R.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}}function wI(h,c){return h.x===c.x&&(h.x<0||h.x>Mn)||h.y===c.y&&(h.y<0||h.y>Mn)}function BI(h){return h.every(c=>c.x<0)||h.every(c=>c.x>Mn)||h.every(c=>c.y<0)||h.every(c=>c.y>Mn)}let gx;Ui("FillExtrusionBucket",q0,{omit:["layers","features"]});var CI={get paint(){return gx=gx||new rn({"fill-extrusion-opacity":new Ki(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zi(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ki(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ki(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kn(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zi(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zi(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ki(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mx extends ko{constructor(c){super(c,CI)}createBucket(c){return new q0(c)}queryRadius(){return mu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,f,v,E,M,R,G,K){const Z=Bh(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,G),oe=this.paint.get("fill-extrusion-height").evaluate(f,v),de=this.paint.get("fill-extrusion-base").evaluate(f,v),ye=function(Ie,Oe,qe,Ke){const ut=[];for(const et of Ie){const it=[et.x,et.y,0,1];yu(it,it,Oe),ut.push(new D(it[0]/it[3],it[1]/it[3]))}return ut}(Z,K),Ce=function(Ie,Oe,qe,Ke){const ut=[],et=[],it=Ke[8]*Oe,mt=Ke[9]*Oe,Tt=Ke[10]*Oe,Zt=Ke[11]*Oe,wi=Ke[8]*qe,ai=Ke[9]*qe,di=Ke[10]*qe,pi=Ke[11]*qe;for(const Di of Ie){const li=[],Jt=[];for(const Hi of Di){const Vi=Hi.x,mr=Hi.y,Rr=Ke[0]*Vi+Ke[4]*mr+Ke[12],Qr=Ke[1]*Vi+Ke[5]*mr+Ke[13],gn=Ke[2]*Vi+Ke[6]*mr+Ke[14],ls=Ke[3]*Vi+Ke[7]*mr+Ke[15],Qn=gn+Tt,bn=ls+Zt,Dn=Rr+wi,un=Qr+ai,br=gn+di,Vn=ls+pi,hn=new D((Rr+it)/bn,(Qr+mt)/bn);hn.z=Qn/bn,li.push(hn);const tn=new D(Dn/Vn,un/Vn);tn.z=br/Vn,Jt.push(tn)}ut.push(li),et.push(Jt)}return[ut,et]}(E,de,oe,K);return function(Ie,Oe,qe){let Ke=1/0;oA(qe,Oe)&&(Ke=$0(qe,Oe[0]));for(let ut=0;ut<Oe.length;ut++){const et=Oe[ut],it=Ie[ut];for(let mt=0;mt<et.length-1;mt++){const Tt=et[mt],Zt=[Tt,et[mt+1],it[mt+1],it[mt],Tt];jc(qe,Zt)&&(Ke=Math.min(Ke,$0(qe,Zt)))}}return Ke!==1/0&&Ke}(Ce[0],Ce[1],ye)}}function WA(h,c){return h.x*c.x+h.y*c.y}function $0(h,c){if(h.length===1){let f=0;const v=c[f++];let E;for(;!E||v.equals(E);)if(E=c[f++],!E)return 1/0;for(;f<c.length;f++){const M=c[f],R=h[0],G=E.sub(v),K=M.sub(v),Z=R.sub(v),oe=WA(G,G),de=WA(G,K),ye=WA(K,K),Ce=WA(Z,G),Ie=WA(Z,K),Oe=oe*ye-de*de,qe=(ye*Ce-de*Ie)/Oe,Ke=(oe*Ie-de*Ce)/Oe,ut=v.z*(1-qe-Ke)+E.z*qe+M.z*Ke;if(isFinite(ut))return ut}return 1/0}{let f=1/0;for(const v of c)f=Math.min(f,v.z);return f}}const yx=zn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_x}=yx,EI=zn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xm}=EI,SI=AA.VectorTileFeature.types,vx=Math.cos(Math.PI/180*37.5),bx=Math.pow(2,14)/.5;class K0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new Ve,this.indexArray=new Ht,this.programConfigurations=new ao(c.layers,c.zoom),this.segments=new Ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.hasPattern=Q0("line",this.layers,f);const E=this.layers[0].layout.get("line-sort-key"),M=!E.isConstant(),R=[];for(const{feature:G,id:K,index:Z,sourceLayerIndex:oe}of c){const de=this.layers[0]._featureFilter.needGeometry,ye=Gc(G,de);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom),ye,v))continue;const Ce=M?E.evaluate(ye,{},v):void 0,Ie={id:K,properties:G.properties,type:G.type,sourceLayerIndex:oe,index:Z,geometry:de?ye.geometry:Hc(G),patterns:{},sortKey:Ce};R.push(Ie)}M&&R.sort((G,K)=>G.sortKey-K.sortKey);for(const G of R){const{geometry:K,index:Z,sourceLayerIndex:oe}=G;if(this.hasPattern){const de=Gu("line",this.layers,G,this.zoom,f);this.patternFeatures.push(de)}else this.addFeature(G,K,Z,v,{});f.featureIndex.insert(c[Z].feature,K,Z,oe,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}addFeatures(c,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,xm)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,_x),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,f,v,E,M){const R=this.layers[0].layout,G=R.get("line-join").evaluate(c,{}),K=R.get("line-cap"),Z=R.get("line-miter-limit"),oe=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const de of f)this.addLine(de,c,G,K,Z,oe);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}addLine(c,f,v,E,M,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<c.length-1;Ke++)this.totalDistance+=c[Ke].dist(c[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const G=SI[f.type]==="Polygon";let K=c.length;for(;K>=2&&c[K-1].equals(c[K-2]);)K--;let Z=0;for(;Z<K-1&&c[Z].equals(c[Z+1]);)Z++;if(K<(G?3:2))return;v==="bevel"&&(M=1.05);const oe=this.overscaling<=16?15*Mn/(512*this.overscaling):0,de=this.segments.prepareSegment(10*K,this.layoutVertexArray,this.indexArray);let ye,Ce,Ie,Oe,qe;this.e1=this.e2=-1,G&&(ye=c[K-2],qe=c[Z].sub(ye)._unit()._perp());for(let Ke=Z;Ke<K;Ke++){if(Ie=Ke===K-1?G?c[Z+1]:void 0:c[Ke+1],Ie&&c[Ke].equals(Ie))continue;qe&&(Oe=qe),ye&&(Ce=ye),ye=c[Ke],qe=Ie?Ie.sub(ye)._unit()._perp():Oe,Oe=Oe||qe;let ut=Oe.add(qe);ut.x===0&&ut.y===0||ut._unit();const et=Oe.x*qe.x+Oe.y*qe.y,it=ut.x*qe.x+ut.y*qe.y,mt=it!==0?1/it:1/0,Tt=2*Math.sqrt(2-2*it),Zt=it<vx&&Ce&&Ie,wi=Oe.x*qe.y-Oe.y*qe.x>0;if(Zt&&Ke>Z){const pi=ye.dist(Ce);if(pi>2*oe){const Di=ye.sub(ye.sub(Ce)._mult(oe/pi)._round());this.updateDistance(Ce,Di),this.addCurrentVertex(Di,Oe,0,0,de),Ce=Di}}const ai=Ce&&Ie;let di=ai?v:G?"butt":E;if(ai&&di==="round"&&(mt<R?di="miter":mt<=2&&(di="fakeround")),di==="miter"&&mt>M&&(di="bevel"),di==="bevel"&&(mt>2&&(di="flipbevel"),mt<M&&(di="miter")),Ce&&this.updateDistance(Ce,ye),di==="miter")ut._mult(mt),this.addCurrentVertex(ye,ut,0,0,de);else if(di==="flipbevel"){if(mt>100)ut=qe.mult(-1);else{const pi=mt*Oe.add(qe).mag()/Oe.sub(qe).mag();ut._perp()._mult(pi*(wi?-1:1))}this.addCurrentVertex(ye,ut,0,0,de),this.addCurrentVertex(ye,ut.mult(-1),0,0,de)}else if(di==="bevel"||di==="fakeround"){const pi=-Math.sqrt(mt*mt-1),Di=wi?pi:0,li=wi?0:pi;if(Ce&&this.addCurrentVertex(ye,Oe,Di,li,de),di==="fakeround"){const Jt=Math.round(180*Tt/Math.PI/20);for(let Hi=1;Hi<Jt;Hi++){let Vi=Hi/Jt;if(Vi!==.5){const Rr=Vi-.5;Vi+=Vi*Rr*(Vi-1)*((1.0904+et*(et*(3.55645-1.43519*et)-3.2452))*Rr*Rr+(.848013+et*(.215638*et-1.06021)))}const mr=qe.sub(Oe)._mult(Vi)._add(Oe)._unit()._mult(wi?-1:1);this.addHalfVertex(ye,mr.x,mr.y,!1,wi,0,de)}}Ie&&this.addCurrentVertex(ye,qe,-Di,-li,de)}else if(di==="butt")this.addCurrentVertex(ye,ut,0,0,de);else if(di==="square"){const pi=Ce?1:-1;this.addCurrentVertex(ye,ut,pi,pi,de)}else di==="round"&&(Ce&&(this.addCurrentVertex(ye,Oe,0,0,de),this.addCurrentVertex(ye,Oe,1,1,de,!0)),Ie&&(this.addCurrentVertex(ye,qe,-1,-1,de,!0),this.addCurrentVertex(ye,qe,0,0,de)));if(Zt&&Ke<K-1){const pi=ye.dist(Ie);if(pi>2*oe){const Di=ye.add(Ie.sub(ye)._mult(oe/pi)._round());this.updateDistance(ye,Di),this.addCurrentVertex(Di,qe,0,0,de),ye=Di}}}}addCurrentVertex(c,f,v,E,M){let R=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const G=f.y*E-f.x,K=-f.y-f.x*E;this.addHalfVertex(c,f.x+f.y*v,f.y-f.x*v,R,!1,v,M),this.addHalfVertex(c,G,K,R,!0,-E,M),this.distance>bx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,f,v,E,M,R))}addHalfVertex(c,f,v,E,M,R,G){let{x:K,y:Z}=c;const oe=.5*(this.lineClips?this.scaledDistance*(bx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((K<<1)+(E?1:0),(Z<<1)+(M?1:0),Math.round(63*f)+128,Math.round(63*v)+128,1+(R===0?0:R<0?-1:1)|(63&oe)<<2,oe>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const de=G.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,de),G.primitiveLength++),M?this.e2=de:this.e1=de}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,f){this.distance+=c.dist(f),this.updateScaledDistance()}}let xx,W0;Ui("LineBucket",K0,{omit:["layers","patternFeatures"]});var wx={get paint(){return W0=W0||new rn({"line-opacity":new zi(ht.paint_line["line-opacity"]),"line-color":new zi(ht.paint_line["line-color"]),"line-translate":new Ki(ht.paint_line["line-translate"]),"line-translate-anchor":new Ki(ht.paint_line["line-translate-anchor"]),"line-width":new zi(ht.paint_line["line-width"]),"line-gap-width":new zi(ht.paint_line["line-gap-width"]),"line-offset":new zi(ht.paint_line["line-offset"]),"line-blur":new zi(ht.paint_line["line-blur"]),"line-dasharray":new Nu(ht.paint_line["line-dasharray"]),"line-pattern":new Kn(ht.paint_line["line-pattern"]),"line-gradient":new ks(ht.paint_line["line-gradient"])})},get layout(){return xx=xx||new rn({"line-cap":new Ki(ht.layout_line["line-cap"]),"line-join":new zi(ht.layout_line["line-join"]),"line-miter-limit":new Ki(ht.layout_line["line-miter-limit"]),"line-round-limit":new Ki(ht.layout_line["line-round-limit"]),"line-sort-key":new zi(ht.layout_line["line-sort-key"])})}};class TI extends zi{possiblyEvaluate(c,f){return f=new xi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(c,f)}evaluate(c,f,v,E){return f=Ne({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(c,f,v,E)}}let dA;class vo extends ko{constructor(c){super(c,wx),this.gradientVersion=0,dA||(dA=new TI(wx.paint.properties["line-width"].specification),dA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(v){return v._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof Ao,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,f){super.recalculate(c,f),this.paint._values["line-floorwidth"]=dA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new K0(c)}queryRadius(c){const f=c,v=X0(wh("line-width",this,f),wh("line-gap-width",this,f)),E=wh("line-offset",this,f);return v/2+Math.abs(E)+mu(this.paint.get("line-translate"))}queryIntersectsFeature(c,f,v,E,M,R,G){const K=Bh(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,G),Z=G/2*X0(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),oe=this.paint.get("line-offset").evaluate(f,v);return oe&&(E=function(de,ye){const Ce=[];for(let Ie=0;Ie<de.length;Ie++){const Oe=de[Ie],qe=[];for(let Ke=0;Ke<Oe.length;Ke++){const ut=Oe[Ke-1],et=Oe[Ke],it=Oe[Ke+1],mt=Ke===0?new D(0,0):et.sub(ut)._unit()._perp(),Tt=Ke===Oe.length-1?new D(0,0):it.sub(et)._unit()._perp(),Zt=mt._add(Tt)._unit(),wi=Zt.x*Tt.x+Zt.y*Tt.y;wi!==0&&Zt._mult(1/wi),qe.push(Zt._mult(ye)._add(et))}Ce.push(qe)}return Ce}(E,oe*G)),function(de,ye,Ce){for(let Ie=0;Ie<ye.length;Ie++){const Oe=ye[Ie];if(de.length>=3){for(let qe=0;qe<Oe.length;qe++)if(ec(de,Oe[qe]))return!0}if(kd(de,Oe,Ce))return!0}return!1}(K,E,Z)}isTileClipped(){return!0}}function X0(h,c){return c>0?c+2*h:h}const Bx=zn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cx=zn([{name:"a_projected_pos",components:3,type:"Float32"}],4);zn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xn=zn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);zn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wm=zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ex=zn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sx(h,c,f){return h.sections.forEach(v=>{v.text=function(E,M,R){const G=M.layout.get("text-transform").evaluate(R,{});return G==="uppercase"?E=E.toLocaleUpperCase():G==="lowercase"&&(E=E.toLocaleLowerCase()),Ws.applyArabicShaping&&(E=Ws.applyArabicShaping(E)),E}(v.text,c,f)}),h}zn([{name:"triangle",components:3,type:"Uint16"}]),zn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),zn([{type:"Float32",name:"offsetX"}]),zn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),zn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ts=24,Z0=Zn,Tx=function(h,c,f,v,E){var M,R,G=8*E-v-1,K=(1<<G)-1,Z=K>>1,oe=-7,de=f?E-1:0,ye=f?-1:1,Ce=h[c+de];for(de+=ye,M=Ce&(1<<-oe)-1,Ce>>=-oe,oe+=G;oe>0;M=256*M+h[c+de],de+=ye,oe-=8);for(R=M&(1<<-oe)-1,M>>=-oe,oe+=v;oe>0;R=256*R+h[c+de],de+=ye,oe-=8);if(M===0)M=1-Z;else{if(M===K)return R?NaN:1/0*(Ce?-1:1);R+=Math.pow(2,v),M-=Z}return(Ce?-1:1)*R*Math.pow(2,M-v)},Ix=function(h,c,f,v,E,M){var R,G,K,Z=8*M-E-1,oe=(1<<Z)-1,de=oe>>1,ye=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ce=v?0:M-1,Ie=v?1:-1,Oe=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(G=isNaN(c)?1:0,R=oe):(R=Math.floor(Math.log(c)/Math.LN2),c*(K=Math.pow(2,-R))<1&&(R--,K*=2),(c+=R+de>=1?ye/K:ye*Math.pow(2,1-de))*K>=2&&(R++,K/=2),R+de>=oe?(G=0,R=oe):R+de>=1?(G=(c*K-1)*Math.pow(2,E),R+=de):(G=c*Math.pow(2,de-1)*Math.pow(2,E),R=0));E>=8;h[f+Ce]=255&G,Ce+=Ie,G/=256,E-=8);for(R=R<<E|G,Z+=E;Z>0;h[f+Ce]=255&R,Ce+=Ie,R/=256,Z-=8);h[f+Ce-Ie]|=128*Oe};function Zn(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Zn.Varint=0,Zn.Fixed64=1,Zn.Bytes=2,Zn.Fixed32=5;var J0=4294967296,Lx=1/J0,Mx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ih(h){return h.type===Zn.Bytes?h.readVarint()+h.pos:h.pos+1}function qd(h,c,f){return f?4294967296*c+(h>>>0):4294967296*(c>>>0)+(h>>>0)}function Px(h,c,f){var v=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));f.realloc(v);for(var E=f.pos-1;E>=h;E--)f.buf[E+v]=f.buf[E]}function Bm(h,c){for(var f=0;f<h.length;f++)c.writeVarint(h[f])}function $d(h,c){for(var f=0;f<h.length;f++)c.writeSVarint(h[f])}function Fx(h,c){for(var f=0;f<h.length;f++)c.writeFloat(h[f])}function Y0(h,c){for(var f=0;f<h.length;f++)c.writeDouble(h[f])}function e_(h,c){for(var f=0;f<h.length;f++)c.writeBoolean(h[f])}function II(h,c){for(var f=0;f<h.length;f++)c.writeFixed32(h[f])}function LI(h,c){for(var f=0;f<h.length;f++)c.writeSFixed32(h[f])}function MI(h,c){for(var f=0;f<h.length;f++)c.writeFixed64(h[f])}function Dx(h,c){for(var f=0;f<h.length;f++)c.writeSFixed64(h[f])}function gp(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+16777216*h[c+3]}function zo(h,c,f){h[f]=c,h[f+1]=c>>>8,h[f+2]=c>>>16,h[f+3]=c>>>24}function Cm(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+(h[c+3]<<24)}Zn.prototype={destroy:function(){this.buf=null},readFields:function(h,c,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),E=v>>3,M=this.pos;this.type=7&v,h(E,c,this),this.pos===M&&this.skip(v)}return c},readMessage:function(h,c){return this.readFields(h,c,this.readVarint()+this.pos)},readFixed32:function(){var h=gp(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=Cm(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=gp(this.buf,this.pos)+gp(this.buf,this.pos+4)*J0;return this.pos+=8,h},readSFixed64:function(){var h=gp(this.buf,this.pos)+Cm(this.buf,this.pos+4)*J0;return this.pos+=8,h},readFloat:function(){var h=Tx(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=Tx(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var c,f,v=this.buf;return c=127&(f=v[this.pos++]),f<128?c:(c|=(127&(f=v[this.pos++]))<<7,f<128?c:(c|=(127&(f=v[this.pos++]))<<14,f<128?c:(c|=(127&(f=v[this.pos++]))<<21,f<128?c:function(E,M,R){var G,K,Z=R.buf;if(G=(112&(K=Z[R.pos++]))>>4,K<128||(G|=(127&(K=Z[R.pos++]))<<3,K<128)||(G|=(127&(K=Z[R.pos++]))<<10,K<128)||(G|=(127&(K=Z[R.pos++]))<<17,K<128)||(G|=(127&(K=Z[R.pos++]))<<24,K<128)||(G|=(1&(K=Z[R.pos++]))<<31,K<128))return qd(E,G,M);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(f=v[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,c=this.pos;return this.pos=h,h-c>=12&&Mx?function(f,v,E){return Mx.decode(f.subarray(v,E))}(this.buf,c,h):function(f,v,E){for(var M="",R=v;R<E;){var G,K,Z,oe=f[R],de=null,ye=oe>239?4:oe>223?3:oe>191?2:1;if(R+ye>E)break;ye===1?oe<128&&(de=oe):ye===2?(192&(G=f[R+1]))==128&&(de=(31&oe)<<6|63&G)<=127&&(de=null):ye===3?(K=f[R+2],(192&(G=f[R+1]))==128&&(192&K)==128&&((de=(15&oe)<<12|(63&G)<<6|63&K)<=2047||de>=55296&&de<=57343)&&(de=null)):ye===4&&(K=f[R+2],Z=f[R+3],(192&(G=f[R+1]))==128&&(192&K)==128&&(192&Z)==128&&((de=(15&oe)<<18|(63&G)<<12|(63&K)<<6|63&Z)<=65535||de>=1114112)&&(de=null)),de===null?(de=65533,ye=1):de>65535&&(de-=65536,M+=String.fromCharCode(de>>>10&1023|55296),de=56320|1023&de),M+=String.fromCharCode(de),R+=ye}return M}(this.buf,c,h)},readBytes:function(){var h=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,h);return this.pos=h,c},readPackedVarint:function(h,c){if(this.type!==Zn.Bytes)return h.push(this.readVarint(c));var f=Ih(this);for(h=h||[];this.pos<f;)h.push(this.readVarint(c));return h},readPackedSVarint:function(h){if(this.type!==Zn.Bytes)return h.push(this.readSVarint());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Zn.Bytes)return h.push(this.readBoolean());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Zn.Bytes)return h.push(this.readFloat());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Zn.Bytes)return h.push(this.readDouble());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Zn.Bytes)return h.push(this.readFixed32());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Zn.Bytes)return h.push(this.readSFixed32());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Zn.Bytes)return h.push(this.readFixed64());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Zn.Bytes)return h.push(this.readSFixed64());var c=Ih(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed64());return h},skip:function(h){var c=7&h;if(c===Zn.Varint)for(;this.buf[this.pos++]>127;);else if(c===Zn.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Zn.Fixed32)this.pos+=4;else{if(c!==Zn.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(h,c){this.writeVarint(h<<3|c)},realloc:function(h){for(var c=this.length||16;c<this.pos+h;)c*=2;if(c!==this.length){var f=new Uint8Array(c);f.set(this.buf),this.buf=f,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),zo(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),zo(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),zo(this.buf,-1&h,this.pos),zo(this.buf,Math.floor(h*Lx),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),zo(this.buf,-1&h,this.pos),zo(this.buf,Math.floor(h*Lx),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(c,f){var v,E;if(c>=0?(v=c%4294967296|0,E=c/4294967296|0):(E=~(-c/4294967296),4294967295^(v=~(-c%4294967296))?v=v+1|0:(v=0,E=E+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(M,R,G){G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,G.buf[G.pos]=127&(M>>>=7)}(v,0,f),function(M,R){var G=(7&M)<<4;R.buf[R.pos++]|=G|((M>>>=3)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M)))))}(E,f)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var c=this.pos;this.pos=function(v,E,M){for(var R,G,K=0;K<E.length;K++){if((R=E.charCodeAt(K))>55295&&R<57344){if(!G){R>56319||K+1===E.length?(v[M++]=239,v[M++]=191,v[M++]=189):G=R;continue}if(R<56320){v[M++]=239,v[M++]=191,v[M++]=189,G=R;continue}R=G-55296<<10|R-56320|65536,G=null}else G&&(v[M++]=239,v[M++]=191,v[M++]=189,G=null);R<128?v[M++]=R:(R<2048?v[M++]=R>>6|192:(R<65536?v[M++]=R>>12|224:(v[M++]=R>>18|240,v[M++]=R>>12&63|128),v[M++]=R>>6&63|128),v[M++]=63&R|128)}return M}(this.buf,h,this.pos);var f=this.pos-c;f>=128&&Px(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeFloat:function(h){this.realloc(4),Ix(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Ix(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var c=h.length;this.writeVarint(c),this.realloc(c);for(var f=0;f<c;f++)this.buf[this.pos++]=h[f]},writeRawMessage:function(h,c){this.pos++;var f=this.pos;h(c,this);var v=this.pos-f;v>=128&&Px(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(h,c,f){this.writeTag(h,Zn.Bytes),this.writeRawMessage(c,f)},writePackedVarint:function(h,c){c.length&&this.writeMessage(h,Bm,c)},writePackedSVarint:function(h,c){c.length&&this.writeMessage(h,$d,c)},writePackedBoolean:function(h,c){c.length&&this.writeMessage(h,e_,c)},writePackedFloat:function(h,c){c.length&&this.writeMessage(h,Fx,c)},writePackedDouble:function(h,c){c.length&&this.writeMessage(h,Y0,c)},writePackedFixed32:function(h,c){c.length&&this.writeMessage(h,II,c)},writePackedSFixed32:function(h,c){c.length&&this.writeMessage(h,LI,c)},writePackedFixed64:function(h,c){c.length&&this.writeMessage(h,MI,c)},writePackedSFixed64:function(h,c){c.length&&this.writeMessage(h,Dx,c)},writeBytesField:function(h,c){this.writeTag(h,Zn.Bytes),this.writeBytes(c)},writeFixed32Field:function(h,c){this.writeTag(h,Zn.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(h,c){this.writeTag(h,Zn.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(h,c){this.writeTag(h,Zn.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(h,c){this.writeTag(h,Zn.Fixed64),this.writeSFixed64(c)},writeVarintField:function(h,c){this.writeTag(h,Zn.Varint),this.writeVarint(c)},writeSVarintField:function(h,c){this.writeTag(h,Zn.Varint),this.writeSVarint(c)},writeStringField:function(h,c){this.writeTag(h,Zn.Bytes),this.writeString(c)},writeFloatField:function(h,c){this.writeTag(h,Zn.Fixed32),this.writeFloat(c)},writeDoubleField:function(h,c){this.writeTag(h,Zn.Fixed64),this.writeDouble(c)},writeBooleanField:function(h,c){this.writeVarintField(h,!!c)}};var Em=b(Z0);const ju=3;function mp(h,c,f){h===1&&f.readMessage(yp,c)}function yp(h,c,f){if(h===3){const{id:v,bitmap:E,width:M,height:R,left:G,top:K,advance:Z}=f.readMessage(Kd,{});c.push({id:v,bitmap:new _c({width:M+2*ju,height:R+2*ju},E),metrics:{width:M,height:R,left:G,top:K,advance:Z}})}}function Kd(h,c,f){h===1?c.id=f.readVarint():h===2?c.bitmap=f.readBytes():h===3?c.width=f.readVarint():h===4?c.height=f.readVarint():h===5?c.left=f.readSVarint():h===6?c.top=f.readSVarint():h===7&&(c.advance=f.readVarint())}const _p=ju;function vp(h){let c=0,f=0;for(const R of h)c+=R.w*R.h,f=Math.max(f,R.w);h.sort((R,G)=>G.h-R.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}];let E=0,M=0;for(const R of h)for(let G=v.length-1;G>=0;G--){const K=v[G];if(!(R.w>K.w||R.h>K.h)){if(R.x=K.x,R.y=K.y,M=Math.max(M,R.y+R.h),E=Math.max(E,R.x+R.w),R.w===K.w&&R.h===K.h){const Z=v.pop();G<v.length&&(v[G]=Z)}else R.h===K.h?(K.x+=R.w,K.w-=R.w):R.w===K.w?(K.y+=R.h,K.h-=R.h):(v.push({x:K.x+R.w,y:K.y,w:K.w-R.w,h:R.h}),K.y+=R.h,K.h-=R.h);break}}return{w:E,h:M,fill:c/(E*M)||0}}const Bl=1;class Sm{constructor(c,f){let{pixelRatio:v,version:E,stretchX:M,stretchY:R,content:G}=f;this.paddedRect=c,this.pixelRatio=v,this.stretchX=M,this.stretchY=R,this.content=G,this.version=E}get tl(){return[this.paddedRect.x+Bl,this.paddedRect.y+Bl]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bl,this.paddedRect.y+this.paddedRect.h-Bl]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Bl)/this.pixelRatio,(this.paddedRect.h-2*Bl)/this.pixelRatio]}}class t_{constructor(c,f){const v={},E={};this.haveRenderCallbacks=[];const M=[];this.addImages(c,v,M),this.addImages(f,E,M);const{w:R,h:G}=vp(M),K=new No({width:R||1,height:G||1});for(const Z in c){const oe=c[Z],de=v[Z].paddedRect;No.copy(oe.data,K,{x:0,y:0},{x:de.x+Bl,y:de.y+Bl},oe.data)}for(const Z in f){const oe=f[Z],de=E[Z].paddedRect,ye=de.x+Bl,Ce=de.y+Bl,Ie=oe.data.width,Oe=oe.data.height;No.copy(oe.data,K,{x:0,y:0},{x:ye,y:Ce},oe.data),No.copy(oe.data,K,{x:0,y:Oe-1},{x:ye,y:Ce-1},{width:Ie,height:1}),No.copy(oe.data,K,{x:0,y:0},{x:ye,y:Ce+Oe},{width:Ie,height:1}),No.copy(oe.data,K,{x:Ie-1,y:0},{x:ye-1,y:Ce},{width:1,height:Oe}),No.copy(oe.data,K,{x:0,y:0},{x:ye+Ie,y:Ce},{width:1,height:Oe})}this.image=K,this.iconPositions=v,this.patternPositions=E}addImages(c,f,v){for(const E in c){const M=c[E],R={x:0,y:0,w:M.data.width+2*Bl,h:M.data.height+2*Bl};v.push(R),f[E]=new Sm(R,M),M.hasRenderCallback&&this.haveRenderCallbacks.push(E)}}patchUpdatedImages(c,f){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in c.updatedImages)this.patchUpdatedImage(this.iconPositions[v],c.getImage(v),f),this.patchUpdatedImage(this.patternPositions[v],c.getImage(v),f)}patchUpdatedImage(c,f,v){if(!c||!f||c.version===f.version)return;c.version=f.version;const[E,M]=c.tl;v.update(f.data,void 0,{x:E,y:M})}}var fA;Ui("ImagePosition",Sm),Ui("ImageAtlas",t_),s.ai=void 0,(fA=s.ai||(s.ai={}))[fA.none=0]="none",fA[fA.horizontal=1]="horizontal",fA[fA.vertical=2]="vertical",fA[fA.horizontalOnly=3]="horizontalOnly";const Wd=-17;class Xd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,f){const v=new Xd;return v.scale=c||1,v.fontStack=f,v}static forImage(c){const f=new Xd;return f.imageName=c,f}}class pA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,f){const v=new pA;for(let E=0;E<c.sections.length;E++){const M=c.sections[E];M.image?v.addImageSection(M):v.addTextSection(M,f)}return v}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let f="";for(let v=0;v<c.length;v++){const E=c.charCodeAt(v+1)||null,M=c.charCodeAt(v-1)||null;f+=E&&kc(E)&&!vc[c[v+1]]||M&&kc(M)&&!vc[c[v-1]]||!vc[c[v]]?c[v]:vc[c[v]]}return f}(this.text)}trim(){let c=0;for(let v=0;v<this.text.length&&Tm[this.text.charCodeAt(v)];v++)c++;let f=this.text.length;for(let v=this.text.length-1;v>=0&&v>=c&&Tm[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(c,f),this.sectionIndex=this.sectionIndex.slice(c,f)}substring(c,f){const v=new pA;return v.text=this.text.substring(c,f),v.sectionIndex=this.sectionIndex.slice(c,f),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,f)=>Math.max(c,this.sections[f].scale),0)}addTextSection(c,f){this.text+=c.text,this.sections.push(Xd.forText(c.scale,c.fontStack||f));const v=this.sections.length-1;for(let E=0;E<c.text.length;++E)this.sectionIndex.push(v)}addImageSection(c){const f=c.image?c.image.name:"";if(f.length===0)return void Xe("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(Xd.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zd(h,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe){const qe=pA.fromFeature(h,E);let Ke;de===s.ai.vertical&&qe.verticalizePunctuation();const{processBidirectionalText:ut,processStyledBidirectionalText:et}=Ws;if(ut&&qe.sections.length===1){Ke=[];const Tt=ut(qe.toString(),bp(qe,Z,M,c,v,Ce,Ie));for(const Zt of Tt){const wi=new pA;wi.text=Zt,wi.sections=qe.sections;for(let ai=0;ai<Zt.length;ai++)wi.sectionIndex.push(0);Ke.push(wi)}}else if(et){Ke=[];const Tt=et(qe.text,qe.sectionIndex,bp(qe,Z,M,c,v,Ce,Ie));for(const Zt of Tt){const wi=new pA;wi.text=Zt[0],wi.sectionIndex=Zt[1],wi.sections=qe.sections,Ke.push(wi)}}else Ke=function(Tt,Zt){const wi=[],ai=Tt.text;let di=0;for(const pi of Zt)wi.push(Tt.substring(di,pi)),di=pi;return di<ai.length&&wi.push(Tt.substring(di,ai.length)),wi}(qe,bp(qe,Z,M,c,v,Ce,Ie));const it=[],mt={positionedLines:it,text:qe.toString(),top:oe[1],bottom:oe[1],left:oe[0],right:oe[0],writingMode:de,iconsInText:!1,verticalizable:!1};return function(Tt,Zt,wi,ai,di,pi,Di,li,Jt,Hi,Vi,mr){let Rr=0,Qr=Wd,gn=0,ls=0;const Qn=li==="right"?1:li==="left"?0:.5;let bn=0;for(const hn of di){hn.trim();const tn=hn.getMaxScale(),ps=(tn-1)*Ts,Is={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[bn]=Is;const bs=Is.positionedGlyphs;let Js=0;if(!hn.length()){Qr+=pi,++bn;continue}for(let Rn=0;Rn<hn.length();Rn++){const wr=hn.getSection(Rn),zs=hn.getSectionIndex(Rn),lo=hn.getCharCode(Rn);let co=0,ic=null,bc=null,oa=null,Xu=Ts;const xc=!(Jt===s.ai.horizontal||!Vi&&!yo(lo)||Vi&&(Tm[lo]||(Dn=lo,Mi.Arabic(Dn)||Mi["Arabic Supplement"](Dn)||Mi["Arabic Extended-A"](Dn)||Mi["Arabic Presentation Forms-A"](Dn)||Mi["Arabic Presentation Forms-B"](Dn))));if(wr.imageName){const wc=ai[wr.imageName];if(!wc)continue;oa=wr.imageName,Tt.iconsInText=Tt.iconsInText||!0,bc=wc.paddedRect;const Cl=wc.displaySize;wr.scale=wr.scale*Ts/mr,ic={width:Cl[0],height:Cl[1],left:Bl,top:-_p,advance:xc?Cl[1]:Cl[0]},co=ps+(Ts-Cl[1]*wr.scale),Xu=ic.advance;const Fh=xc?Cl[0]*wr.scale-Ts*tn:Cl[1]*wr.scale-Ts*tn;Fh>0&&Fh>Js&&(Js=Fh)}else{const wc=wi[wr.fontStack],Cl=wc&&wc[lo];if(Cl&&Cl.rect)bc=Cl.rect,ic=Cl.metrics;else{const Fh=Zt[wr.fontStack],kp=Fh&&Fh[lo];if(!kp)continue;ic=kp.metrics}co=(tn-wr.scale)*Ts}xc?(Tt.verticalizable=!0,bs.push({glyph:lo,imageName:oa,x:Rr,y:Qr+co,vertical:xc,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:zs,metrics:ic,rect:bc}),Rr+=Xu*wr.scale+Hi):(bs.push({glyph:lo,imageName:oa,x:Rr,y:Qr+co,vertical:xc,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:zs,metrics:ic,rect:bc}),Rr+=ic.advance*wr.scale+Hi)}bs.length!==0&&(gn=Math.max(Rr-Hi,gn),FI(bs,0,bs.length-1,Qn,Js)),Rr=0;const Ls=pi*tn+Js;Is.lineOffset=Math.max(Js,ps),Qr+=Ls,ls=Math.max(Ls,ls),++bn}var Dn;const un=Qr-Wd,{horizontalAlign:br,verticalAlign:Vn}=n_(Di);(function(hn,tn,ps,Is,bs,Js,Ls,Rn,wr){const zs=(tn-ps)*bs;let lo=0;lo=Js!==Ls?-Rn*Is-Wd:(-Is*wr+.5)*Ls;for(const co of hn)for(const ic of co.positionedGlyphs)ic.x+=zs,ic.y+=lo})(Tt.positionedLines,Qn,br,Vn,gn,ls,pi,un,di.length),Tt.top+=-Vn*un,Tt.bottom=Tt.top+un,Tt.left+=-br*gn,Tt.right=Tt.left+gn}(mt,c,f,v,Ke,R,G,K,de,Z,ye,Oe),!function(Tt){for(const Zt of Tt)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(it)&&mt}const Tm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function i_(h,c,f,v,E,M){if(c.imageName){const R=v[c.imageName];return R?R.displaySize[0]*c.scale*Ts/M+E:0}{const R=f[c.fontStack],G=R&&R[h];return G?G.metrics.advance*c.scale+E:0}}function Jd(h,c,f,v){const E=Math.pow(h-c,2);return v?h<c?E/2:2*E:E+Math.abs(f)*f}function qu(h,c,f){let v=0;return h===10&&(v-=1e4),f&&(v+=150),h!==40&&h!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function Lh(h,c,f,v,E,M){let R=null,G=Jd(c,f,E,M);for(const K of v){const Z=Jd(c-K.x,f,E,M)+K.badness;Z<=G&&(R=K,G=Z)}return{index:h,x:c,priorBreak:R,badness:G}}function r_(h){return h?r_(h.priorBreak).concat(h.index):[]}function bp(h,c,f,v,E,M,R){if(M!=="point")return[];if(!h)return[];const G=[],K=function(ye,Ce,Ie,Oe,qe,Ke){let ut=0;for(let et=0;et<ye.length();et++){const it=ye.getSection(et);ut+=i_(ye.getCharCode(et),it,Oe,qe,Ce,Ke)}return ut/Math.max(1,Math.ceil(ut/Ie))}(h,c,f,v,E,R),Z=h.text.indexOf("")>=0;let oe=0;for(let ye=0;ye<h.length();ye++){const Ce=h.getSection(ye),Ie=h.getCharCode(ye);if(Tm[Ie]||(oe+=i_(Ie,Ce,v,E,c,R)),ye<h.length()-1){const Oe=!((de=Ie)<11904||!(Mi["Bopomofo Extended"](de)||Mi.Bopomofo(de)||Mi["CJK Compatibility Forms"](de)||Mi["CJK Compatibility Ideographs"](de)||Mi["CJK Compatibility"](de)||Mi["CJK Radicals Supplement"](de)||Mi["CJK Strokes"](de)||Mi["CJK Symbols and Punctuation"](de)||Mi["CJK Unified Ideographs Extension A"](de)||Mi["CJK Unified Ideographs"](de)||Mi["Enclosed CJK Letters and Months"](de)||Mi["Halfwidth and Fullwidth Forms"](de)||Mi.Hiragana(de)||Mi["Ideographic Description Characters"](de)||Mi["Kangxi Radicals"](de)||Mi["Katakana Phonetic Extensions"](de)||Mi.Katakana(de)||Mi["Vertical Forms"](de)||Mi["Yi Radicals"](de)||Mi["Yi Syllables"](de)));(PI[Ie]||Oe||Ce.imageName)&&G.push(Lh(ye+1,oe,K,G,qu(Ie,h.getCharCode(ye+1),Oe&&Z),!1))}}var de;return r_(Lh(h.length(),oe,K,G,0,!0))}function n_(h){let c=.5,f=.5;switch(h){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function FI(h,c,f,v,E){if(!v&&!E)return;const M=h[f],R=(h[f].x+M.metrics.advance*M.scale)*v;for(let G=c;G<=f;G++)h[G].x-=R,h[G].y+=E}function Im(h,c,f){const{horizontalAlign:v,verticalAlign:E}=n_(f),M=c[0]-h.displaySize[0]*v,R=c[1]-h.displaySize[1]*E;return{image:h,top:R,bottom:R+h.displaySize[1],left:M,right:M+h.displaySize[0]}}function Lm(h,c,f,v,E,M){const R=h.image;let G;if(R.content){const qe=R.content,Ke=R.pixelRatio||1;G=[qe[0]/Ke,qe[1]/Ke,R.displaySize[0]-qe[2]/Ke,R.displaySize[1]-qe[3]/Ke]}const K=c.left*M,Z=c.right*M;let oe,de,ye,Ce;f==="width"||f==="both"?(Ce=E[0]+K-v[3],de=E[0]+Z+v[1]):(Ce=E[0]+(K+Z-R.displaySize[0])/2,de=Ce+R.displaySize[0]);const Ie=c.top*M,Oe=c.bottom*M;return f==="height"||f==="both"?(oe=E[1]+Ie-v[0],ye=E[1]+Oe+v[2]):(oe=E[1]+(Ie+Oe-R.displaySize[1])/2,ye=oe+R.displaySize[1]),{image:R,top:oe,right:de,bottom:ye,left:Ce,collisionPadding:G}}const xp=255,$c=128,$u=xp*$c;function XA(h,c){const{expression:f}=c;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new xi(h+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:E}=f;let M=0;for(;M<v.length&&v[M]<=h;)M++;M=Math.max(0,M-1);let R=M;for(;R<v.length&&v[R]<h+1;)R++;R=Math.min(v.length-1,R);const G=v[M],K=v[R];return f.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:K,interpolationType:E}:{kind:"camera",minZoom:G,maxZoom:K,minSize:f.evaluate(new xi(G)),maxSize:f.evaluate(new xi(K)),interpolationType:E}}}function Mm(h,c,f){let v="never";const E=h.get(c);return E?v=E:h.get(f)&&(v="always"),v}const Rx=AA.VectorTileFeature.types,s_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wp(h,c,f,v,E,M,R,G,K,Z,oe,de,ye){const Ce=G?Math.min($u,Math.round(G[0])):0,Ie=G?Math.min($u,Math.round(G[1])):0;h.emplaceBack(c,f,Math.round(32*v),Math.round(32*E),M,R,(Ce<<1)+(K?1:0),Ie,16*Z,16*oe,256*de,256*ye)}function Yd(h,c,f){h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f)}function kx(h){for(const c of h.sections)if(Uc(c.text))return!0;return!1}class o_{constructor(c){this.layoutVertexArray=new xt,this.indexArray=new Ht,this.programConfigurations=c,this.segments=new Ii,this.dynamicLayoutVertexArray=new At,this.opacityVertexArray=new kt,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,f,v,E){this.isEmpty()||(v&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Bx.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Cx.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,s_,!0),this.opacityVertexBuffer.itemSize=1),(v||E)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ui("SymbolBuffers",o_);class a_{constructor(c,f,v){this.layoutVertexArray=new c,this.layoutAttributes=f,this.indexArray=new v,this.segments=new Ii,this.collisionVertexArray=new Ai}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Xn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ui("CollisionBuffers",a_);class ZA{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(R=>R.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ud([]),this.placementViewportMatrix=Ud([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=XA(this.zoom,f["text-size"]),this.iconSizeData=XA(this.zoom,f["icon-size"]);const v=this.layers[0].layout,E=v.get("symbol-sort-key"),M=v.get("symbol-z-order");this.canOverlap=Mm(v,"text-overlap","text-allow-overlap")!=="never"||Mm(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=M!=="viewport-y"&&!E.isConstant(),this.sortFeaturesByY=(M==="viewport-y"||M==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(R=>s.ai[R])),this.stateDependentLayerIds=this.layers.filter(R=>R.isStateDependent()).map(R=>R.id),this.sourceID=c.sourceID}createArrays(){this.text=new o_(new ao(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new o_(new ao(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new ee,this.lineVertexArray=new re,this.symbolInstances=new X,this.textAnchorOffsets=new pe}calculateGlyphDependencies(c,f,v,E,M){for(let R=0;R<c.length;R++)if(f[c.charCodeAt(R)]=!0,(v||E)&&M){const G=vc[c.charAt(R)];G&&(f[G.charCodeAt(0)]=!0)}}populate(c,f,v){const E=this.layers[0],M=E.layout,R=M.get("text-font"),G=M.get("text-field"),K=M.get("icon-image"),Z=(G.value.kind!=="constant"||G.value.value instanceof Vr&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(R.value.kind!=="constant"||R.value.value.length>0),oe=K.value.kind!=="constant"||!!K.value.value||Object.keys(K.parameters).length>0,de=M.get("symbol-sort-key");if(this.features=[],!Z&&!oe)return;const ye=f.iconDependencies,Ce=f.glyphDependencies,Ie=f.availableImages,Oe=new xi(this.zoom);for(const{feature:qe,id:Ke,index:ut,sourceLayerIndex:et}of c){const it=E._featureFilter.needGeometry,mt=Gc(qe,it);if(!E._featureFilter.filter(Oe,mt,v))continue;let Tt,Zt;if(it||(mt.geometry=Hc(qe)),Z){const ai=E.getValueAndResolveTokens("text-field",mt,v,Ie),di=Vr.factory(ai);kx(di)&&(this.hasRTLText=!0),(!this.hasRTLText||hu()==="unavailable"||this.hasRTLText&&Ws.isParsed())&&(Tt=Sx(di,E,mt))}if(oe){const ai=E.getValueAndResolveTokens("icon-image",mt,v,Ie);Zt=ai instanceof Xi?ai:Xi.fromString(ai)}if(!Tt&&!Zt)continue;const wi=this.sortFeaturesByKey?de.evaluate(mt,{},v):void 0;if(this.features.push({id:Ke,text:Tt,icon:Zt,index:ut,sourceLayerIndex:et,geometry:mt.geometry,properties:qe.properties,type:Rx[qe.type],sortKey:wi}),Zt&&(ye[Zt.name]=!0),Tt){const ai=R.evaluate(mt,{},v).join(","),di=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const pi of Tt.sections)if(pi.image)ye[pi.image.name]=!0;else{const Di=Wl(Tt.toString()),li=pi.fontStack||ai,Jt=Ce[li]=Ce[li]||{};this.calculateGlyphDependencies(pi.text,Jt,di,this.allowVerticalPlacement,Di)}}}M.get("symbol-placement")==="line"&&(this.features=function(qe){const Ke={},ut={},et=[];let it=0;function mt(ai){et.push(qe[ai]),it++}function Tt(ai,di,pi){const Di=ut[ai];return delete ut[ai],ut[di]=Di,et[Di].geometry[0].pop(),et[Di].geometry[0]=et[Di].geometry[0].concat(pi[0]),Di}function Zt(ai,di,pi){const Di=Ke[di];return delete Ke[di],Ke[ai]=Di,et[Di].geometry[0].shift(),et[Di].geometry[0]=pi[0].concat(et[Di].geometry[0]),Di}function wi(ai,di,pi){const Di=pi?di[0][di[0].length-1]:di[0][0];return`${ai}:${Di.x}:${Di.y}`}for(let ai=0;ai<qe.length;ai++){const di=qe[ai],pi=di.geometry,Di=di.text?di.text.toString():null;if(!Di){mt(ai);continue}const li=wi(Di,pi),Jt=wi(Di,pi,!0);if(li in ut&&Jt in Ke&&ut[li]!==Ke[Jt]){const Hi=Zt(li,Jt,pi),Vi=Tt(li,Jt,et[Hi].geometry);delete Ke[li],delete ut[Jt],ut[wi(Di,et[Vi].geometry,!0)]=Vi,et[Hi].geometry=null}else li in ut?Tt(li,Jt,pi):Jt in Ke?Zt(li,Jt,pi):(mt(ai),Ke[li]=it-1,ut[Jt]=it-1)}return et.filter(ai=>ai.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((qe,Ke)=>qe.sortKey-Ke.sortKey)}update(c,f,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,f,this.layers,v),this.icon.programConfigurations.updatePaintArrays(c,f,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,f){const v=this.lineVertexArray.length;if(c.segment!==void 0){let E=c.dist(f[c.segment+1]),M=c.dist(f[c.segment]);const R={};for(let G=c.segment+1;G<f.length;G++)R[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:E},G<f.length-1&&(E+=f[G+1].dist(f[G]));for(let G=c.segment||0;G>=0;G--)R[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:M},G>0&&(M+=f[G-1].dist(f[G]));for(let G=0;G<f.length;G++){const K=R[G];this.lineVertexArray.emplaceBack(K.x,K.y,K.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(c,f,v,E,M,R,G,K,Z,oe,de,ye){const Ce=c.indexArray,Ie=c.layoutVertexArray,Oe=c.segments.prepareSegment(4*f.length,Ie,Ce,this.canOverlap?R.sortKey:void 0),qe=this.glyphOffsetArray.length,Ke=Oe.vertexLength,ut=this.allowVerticalPlacement&&G===s.ai.vertical?Math.PI/2:0,et=R.text&&R.text.sections;for(let it=0;it<f.length;it++){const{tl:mt,tr:Tt,bl:Zt,br:wi,tex:ai,pixelOffsetTL:di,pixelOffsetBR:pi,minFontScaleX:Di,minFontScaleY:li,glyphOffset:Jt,isSDF:Hi,sectionIndex:Vi}=f[it],mr=Oe.vertexLength,Rr=Jt[1];wp(Ie,K.x,K.y,mt.x,Rr+mt.y,ai.x,ai.y,v,Hi,di.x,di.y,Di,li),wp(Ie,K.x,K.y,Tt.x,Rr+Tt.y,ai.x+ai.w,ai.y,v,Hi,pi.x,di.y,Di,li),wp(Ie,K.x,K.y,Zt.x,Rr+Zt.y,ai.x,ai.y+ai.h,v,Hi,di.x,pi.y,Di,li),wp(Ie,K.x,K.y,wi.x,Rr+wi.y,ai.x+ai.w,ai.y+ai.h,v,Hi,pi.x,pi.y,Di,li),Yd(c.dynamicLayoutVertexArray,K,ut),Ce.emplaceBack(mr,mr+1,mr+2),Ce.emplaceBack(mr+1,mr+2,mr+3),Oe.vertexLength+=4,Oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jt[0]),it!==f.length-1&&Vi===f[it+1].sectionIndex||c.programConfigurations.populatePaintArrays(Ie.length,R,R.index,{},ye,et&&et[Vi])}c.placedSymbolArray.emplaceBack(K.x,K.y,qe,this.glyphOffsetArray.length-qe,Ke,Z,oe,K.segment,v?v[0]:0,v?v[1]:0,E[0],E[1],G,0,!1,0,de)}_addCollisionDebugVertex(c,f,v,E,M,R){return f.emplaceBack(0,0),c.emplaceBack(v.x,v.y,E,M,Math.round(R.x),Math.round(R.y))}addCollisionDebugVertices(c,f,v,E,M,R,G){const K=M.segments.prepareSegment(4,M.layoutVertexArray,M.indexArray),Z=K.vertexLength,oe=M.layoutVertexArray,de=M.collisionVertexArray,ye=G.anchorX,Ce=G.anchorY;this._addCollisionDebugVertex(oe,de,R,ye,Ce,new D(c,f)),this._addCollisionDebugVertex(oe,de,R,ye,Ce,new D(v,f)),this._addCollisionDebugVertex(oe,de,R,ye,Ce,new D(v,E)),this._addCollisionDebugVertex(oe,de,R,ye,Ce,new D(c,E)),K.vertexLength+=4;const Ie=M.indexArray;Ie.emplaceBack(Z,Z+1),Ie.emplaceBack(Z+1,Z+2),Ie.emplaceBack(Z+2,Z+3),Ie.emplaceBack(Z+3,Z),K.primitiveLength+=4}addDebugCollisionBoxes(c,f,v,E){for(let M=c;M<f;M++){const R=this.collisionBoxArray.get(M);this.addCollisionDebugVertices(R.x1,R.y1,R.x2,R.y2,E?this.textCollisionBox:this.iconCollisionBox,R.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a_(Rt,wm.members,vi),this.iconCollisionBox=new a_(Rt,wm.members,vi);for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(c,f,v,E,M,R,G,K,Z){const oe={};for(let de=f;de<v;de++){const ye=c.get(de);oe.textBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},oe.textFeatureIndex=ye.featureIndex;break}for(let de=E;de<M;de++){const ye=c.get(de);oe.verticalTextBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},oe.verticalTextFeatureIndex=ye.featureIndex;break}for(let de=R;de<G;de++){const ye=c.get(de);oe.iconBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},oe.iconFeatureIndex=ye.featureIndex;break}for(let de=K;de<Z;de++){const ye=c.get(de);oe.verticalIconBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},oe.verticalIconFeatureIndex=ye.featureIndex;break}return oe}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const v=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,f){const v=c.placedSymbolArray.get(f),E=v.vertexStartIndex+4*v.numGlyphs;for(let M=v.vertexStartIndex;M<E;M+=4)c.indexArray.emplaceBack(M,M+1,M+2),c.indexArray.emplaceBack(M+1,M+2,M+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(c),v=Math.cos(c),E=[],M=[],R=[];for(let G=0;G<this.symbolInstances.length;++G){R.push(G);const K=this.symbolInstances.get(G);E.push(0|Math.round(f*K.anchorX+v*K.anchorY)),M.push(K.featureIndex)}return R.sort((G,K)=>E[G]-E[K]||M[K]-M[G]),R}addToSortKeyRanges(c,f){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===f?v.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const v=this.symbolInstances.get(f);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((E,M,R)=>{E>=0&&R.indexOf(E)===M&&this.addIndicesForPlacedSymbol(this.text,E)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ox,Ux;Ui("SymbolBucket",ZA,{omit:["layers","collisionBoxArray","features","compareText"]}),ZA.MAX_GLYPHS=65535,ZA.addDynamicAttributes=Yd;var l_={get paint(){return Ux=Ux||new rn({"icon-opacity":new zi(ht.paint_symbol["icon-opacity"]),"icon-color":new zi(ht.paint_symbol["icon-color"]),"icon-halo-color":new zi(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new zi(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zi(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Ki(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ki(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new zi(ht.paint_symbol["text-opacity"]),"text-color":new zi(ht.paint_symbol["text-color"],{runtimeType:yr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new zi(ht.paint_symbol["text-halo-color"]),"text-halo-width":new zi(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new zi(ht.paint_symbol["text-halo-blur"]),"text-translate":new Ki(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Ki(ht.paint_symbol["text-translate-anchor"])})},get layout(){return Ox=Ox||new rn({"symbol-placement":new Ki(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Ki(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ki(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zi(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ki(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ki(ht.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ki(ht.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ki(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ki(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ki(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new zi(ht.layout_symbol["icon-size"]),"icon-text-fit":new Ki(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ki(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new zi(ht.layout_symbol["icon-image"]),"icon-rotate":new zi(ht.layout_symbol["icon-rotate"]),"icon-padding":new zi(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Ki(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new zi(ht.layout_symbol["icon-offset"]),"icon-anchor":new zi(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ki(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ki(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ki(ht.layout_symbol["text-rotation-alignment"]),"text-field":new zi(ht.layout_symbol["text-field"]),"text-font":new zi(ht.layout_symbol["text-font"]),"text-size":new zi(ht.layout_symbol["text-size"]),"text-max-width":new zi(ht.layout_symbol["text-max-width"]),"text-line-height":new Ki(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new zi(ht.layout_symbol["text-letter-spacing"]),"text-justify":new zi(ht.layout_symbol["text-justify"]),"text-radial-offset":new zi(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ki(ht.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zi(ht.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zi(ht.layout_symbol["text-anchor"]),"text-max-angle":new Ki(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Ki(ht.layout_symbol["text-writing-mode"]),"text-rotate":new zi(ht.layout_symbol["text-rotate"]),"text-padding":new Ki(ht.layout_symbol["text-padding"]),"text-keep-upright":new Ki(ht.layout_symbol["text-keep-upright"]),"text-transform":new zi(ht.layout_symbol["text-transform"]),"text-offset":new zi(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Ki(ht.layout_symbol["text-allow-overlap"]),"text-overlap":new Ki(ht.layout_symbol["text-overlap"]),"text-ignore-placement":new Ki(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Ki(ht.layout_symbol["text-optional"])})}};class Nx{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Li,this.defaultValue=c}evaluate(c){if(c.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(c.formattedSection))return f.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ui("FormatSectionOverride",Nx,{omit:["defaultValue"]});class ef extends ko{constructor(c){super(c,l_)}recalculate(c,f){if(super.recalculate(c,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const E=[];for(const M of v)E.indexOf(M)<0&&E.push(M);this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,f,v,E){const M=this.layout.get(c).evaluate(f,{},v,E),R=this._unevaluatedLayout._values[c];return R.isDataDriven()||Cr(R.value)||!M?M:function(G,K){return K.replace(/{([^{}]+)}/g,(Z,oe)=>G&&oe in G?String(G[oe]):"")}(f.properties,M)}createBucket(c){return new ZA(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of l_.paint.overridableProperties){if(!ef.hasPaintOverride(this.layout,c))continue;const f=this.paint.get(c),v=new Nx(f),E=new jn(v,f.property.specification);let M=null;M=f.value.kind==="constant"||f.value.kind==="source"?new Nn("source",E):new Ks("composite",E,f.value.zoomStops),this.paint._values[c]=new $n(f.property,M,f.parameters)}}_handleOverridablePaintPropertyUpdate(c,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&ef.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,f){const v=c.get("text-field"),E=l_.paint.properties[f];let M=!1;const R=G=>{for(const K of G)if(E.overrides&&E.overrides.hasOverride(K))return void(M=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Vr)R(v.value.value.sections);else if(v.value.kind==="source"){const G=Z=>{M||(Z instanceof Gn&&fr(Z.value)===ae?R(Z.value.sections):Z instanceof el?R(Z.sections):Z.eachChild(G))},K=v.value;K._styleExpression&&G(K._styleExpression.expression)}return M}}let Mh;var zx={get paint(){return Mh=Mh||new rn({"background-color":new Ki(ht.paint_background["background-color"]),"background-pattern":new Nu(ht.paint_background["background-pattern"]),"background-opacity":new Ki(ht.paint_background["background-opacity"])})}};class Qx extends ko{constructor(c){super(c,zx)}}let c_;var Vx={get paint(){return c_=c_||new rn({"raster-opacity":new Ki(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ki(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ki(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ki(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Ki(ht.paint_raster["raster-saturation"]),"raster-contrast":new Ki(ht.paint_raster["raster-contrast"]),"raster-resampling":new Ki(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Ki(ht.paint_raster["raster-fade-duration"])})}};class Hx extends ko{constructor(c){super(c,Vx)}}class u_ extends ko{constructor(c){super(c,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pm{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Fm=63710088e-1;class Ku{constructor(c,f){if(isNaN(c)||isNaN(f))throw new Error(`Invalid LngLat object: (${c}, ${f})`);if(this.lng=+c,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ku($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const f=Math.PI/180,v=this.lat*f,E=c.lat*f,M=Math.sin(v)*Math.sin(E)+Math.cos(v)*Math.cos(E)*Math.cos((c.lng-this.lng)*f);return Fm*Math.acos(Math.min(M,1))}static convert(c){if(c instanceof Ku)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Ku(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Ku(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const h_=2*Math.PI*Fm;function tc(h){return h_*Math.cos(h*Math.PI/180)}function tf(h){return(180+h)/360}function A_(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function d_(h,c){return h/tc(c)}function f_(h){return 360*h-180}function Dm(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Bp{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+f,this.z=+v}static fromLngLat(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const v=Ku.convert(c);return new Bp(tf(v.lng),A_(v.lat),d_(f,v.lat))}toLngLat(){return new Ku(f_(this.x),Dm(this.y))}toAltitude(){return this.z*tc(Dm(this.y))}meterInMercatorCoordinateUnits(){return 1/h_*(c=Dm(this.y),1/Math.cos(c*Math.PI/180));var c}}function p_(h,c,f){var v=2*Math.PI*6378137/256/Math.pow(2,f);return[h*v-2*Math.PI*6378137/2,c*v-2*Math.PI*6378137/2]}class g_{constructor(c,f,v){if(c<0||c>25||v<0||v>=Math.pow(2,c)||f<0||f>=Math.pow(2,c))throw new Error(`x=${f}, y=${v}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=f,this.y=v,this.key=rf(0,c,c,f,v)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,f,v){const E=(R=this.y,G=this.z,K=p_(256*(M=this.x),256*(R=Math.pow(2,G)-R-1),G),Z=p_(256*(M+1),256*(R+1),G),K[0]+","+K[1]+","+Z[0]+","+Z[1]);var M,R,G,K,Z;const oe=function(de,ye,Ce){let Ie,Oe="";for(let qe=de;qe>0;qe--)Ie=1<<qe-1,Oe+=(ye&Ie?1:0)+(Ce&Ie?2:0);return Oe}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,oe).replace(/{bbox-epsg-3857}/g,E)}isChildOf(c){const f=this.z-c.z;return f>0&&c.x===this.x>>f&&c.y===this.y>>f}getTilePoint(c){const f=Math.pow(2,this.z);return new D((c.x*f-this.x)*Mn,(c.y*f-this.y)*Mn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class m_{constructor(c,f){this.wrap=c,this.canonical=f,this.key=rf(c,f.z,f.z,f.x,f.y)}}class Qo{constructor(c,f,v,E,M){if(c<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${v}`);this.overscaledZ=c,this.wrap=f,this.canonical=new g_(v,+E,+M),this.key=rf(f,c,v,E,M)}clone(){return new Qo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-c;return c>this.canonical.z?new Qo(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qo(c,this.wrap,c,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(c,f){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-c;return c>this.canonical.z?rf(this.wrap*+f,c,this.canonical.z,this.canonical.x,this.canonical.y):rf(this.wrap*+f,c,c,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const f=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>f&&c.canonical.y===this.canonical.y>>f}children(c){if(this.overscaledZ>=c)return[new Qo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,v=2*this.canonical.x,E=2*this.canonical.y;return[new Qo(f,this.wrap,f,v,E),new Qo(f,this.wrap,f,v+1,E),new Qo(f,this.wrap,f,v,E+1),new Qo(f,this.wrap,f,v+1,E+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Qo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Qo(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new m_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new Bp(c.x-this.wrap,c.y))}}function rf(h,c,f,v,E){(h*=2)<0&&(h=-1*h-1);const M=1<<f;return(M*M*h+M*E+v).toString(36)+f.toString(36)+c.toString(36)}Ui("CanonicalTileID",g_),Ui("OverscaledTileID",Qo,{omit:["posMatrix"]});class y_{constructor(c,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,R=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,G=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(v&&!["mapbox","terrarium","custom"].includes(v))return void Xe(`"${v}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const K=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),v){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=E,this.greenFactor=M,this.blueFactor=R,this.baseShift=G;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Z=0;Z<K;Z++)this.data[this._idx(-1,Z)]=this.data[this._idx(0,Z)],this.data[this._idx(K,Z)]=this.data[this._idx(K-1,Z)],this.data[this._idx(Z,-1)]=this.data[this._idx(Z,0)],this.data[this._idx(Z,K)]=this.data[this._idx(Z,K-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(K,-1)]=this.data[this._idx(K-1,0)],this.data[this._idx(-1,K)]=this.data[this._idx(0,K-1)],this.data[this._idx(K,K)]=this.data[this._idx(K-1,K-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Z=0;Z<K;Z++)for(let oe=0;oe<K;oe++){const de=this.get(Z,oe);de>this.max&&(this.max=de),de<this.min&&(this.min=de)}}get(c,f){const v=new Uint8Array(this.data.buffer),E=4*this._idx(c,f);return this.unpack(v[E],v[E+1],v[E+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,f){if(c<-1||c>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(c+1)}unpack(c,f,v){return c*this.redFactor+f*this.greenFactor+v*this.blueFactor-this.baseShift}getPixels(){return new No({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,f,v){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let E=f*this.dim,M=f*this.dim+this.dim,R=v*this.dim,G=v*this.dim+this.dim;switch(f){case-1:E=M-1;break;case 1:M=E+1}switch(v){case-1:R=G-1;break;case 1:G=R+1}const K=-f*this.dim,Z=-v*this.dim;for(let oe=R;oe<G;oe++)for(let de=E;de<M;de++)this.data[this._idx(de,oe)]=c.data[this._idx(de+K,oe+Z)]}}Ui("DEMData",y_);class __{constructor(c){this._stringToNumber={},this._numberToString=[];for(let f=0;f<c.length;f++){const v=c[f];this._stringToNumber[v]=f,this._numberToString[f]=v}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class v_{constructor(c,f,v,E,M){this.type="Feature",this._vectorTileFeature=c,c._z=f,c._x=v,c._y=E,this.properties=c.properties,this.id=M}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(c[f]=this[f]);return c}}class Gx{constructor(c,f){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new mo(Mn,16,0),this.grid3D=new mo(Mn,16,0),this.featureIndexArray=new we,this.promoteId=f}insert(c,f,v,E,M,R){const G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,E,M);const K=R?this.grid3D:this.grid;for(let Z=0;Z<f.length;Z++){const oe=f[Z],de=[1/0,1/0,-1/0,-1/0];for(let ye=0;ye<oe.length;ye++){const Ce=oe[ye];de[0]=Math.min(de[0],Ce.x),de[1]=Math.min(de[1],Ce.y),de[2]=Math.max(de[2],Ce.x),de[3]=Math.max(de[3],Ce.y)}de[0]<Mn&&de[1]<Mn&&de[2]>=0&&de[3]>=0&&K.insert(G,de[0],de[1],de[2],de[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new AA.VectorTile(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new __(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,f,v,E){this.loadVTLayers();const M=c.params||{},R=Mn/c.tileSize/c.scale,G=Al(M.filter),K=c.queryGeometry,Z=c.queryPadding*R,oe=b_(K),de=this.grid.query(oe.minX-Z,oe.minY-Z,oe.maxX+Z,oe.maxY+Z),ye=b_(c.cameraQueryGeometry),Ce=this.grid3D.query(ye.minX-Z,ye.minY-Z,ye.maxX+Z,ye.maxY+Z,(qe,Ke,ut,et)=>function(it,mt,Tt,Zt,wi){for(const di of it)if(mt<=di.x&&Tt<=di.y&&Zt>=di.x&&wi>=di.y)return!0;const ai=[new D(mt,Tt),new D(mt,wi),new D(Zt,wi),new D(Zt,Tt)];if(it.length>2){for(const di of ai)if(ec(it,di))return!0}for(let di=0;di<it.length-1;di++)if(aA(it[di],it[di+1],ai))return!0;return!1}(c.cameraQueryGeometry,qe-Z,Ke-Z,ut+Z,et+Z));for(const qe of Ce)de.push(qe);de.sort(nf);const Ie={};let Oe;for(let qe=0;qe<de.length;qe++){const Ke=de[qe];if(Ke===Oe)continue;Oe=Ke;const ut=this.featureIndexArray.get(Ke);let et=null;this.loadMatchingFeature(Ie,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,G,M.layers,M.availableImages,f,v,E,(it,mt,Tt)=>(et||(et=Hc(it)),mt.queryIntersectsFeature(K,it,Tt,et,this.z,c.transform,R,c.pixelPosMatrix)))}return Ie}loadMatchingFeature(c,f,v,E,M,R,G,K,Z,oe,de){const ye=this.bucketLayerIDs[f];if(R&&!function(qe,Ke){for(let ut=0;ut<qe.length;ut++)if(Ke.indexOf(qe[ut])>=0)return!0;return!1}(R,ye))return;const Ce=this.sourceLayerCoder.decode(v),Ie=this.vtLayers[Ce].feature(E);if(M.needGeometry){const qe=Gc(Ie,!0);if(!M.filter(new xi(this.tileID.overscaledZ),qe,this.tileID.canonical))return}else if(!M.filter(new xi(this.tileID.overscaledZ),Ie))return;const Oe=this.getId(Ie,Ce);for(let qe=0;qe<ye.length;qe++){const Ke=ye[qe];if(R&&R.indexOf(Ke)<0)continue;const ut=K[Ke];if(!ut)continue;let et={};Oe&&oe&&(et=oe.getState(ut.sourceLayer||"_geojsonTileLayer",Oe));const it=Ne({},Z[Ke]);it.paint=jx(it.paint,ut.paint,Ie,et,G),it.layout=jx(it.layout,ut.layout,Ie,et,G);const mt=!de||de(Ie,ut,et);if(!mt)continue;const Tt=new v_(Ie,this.z,this.x,this.y,Oe);Tt.layer=it;let Zt=c[Ke];Zt===void 0&&(Zt=c[Ke]=[]),Zt.push({featureIndex:E,feature:Tt,intersectionZ:mt})}}lookupSymbolFeatures(c,f,v,E,M,R,G,K){const Z={};this.loadVTLayers();const oe=Al(M);for(const de of c)this.loadMatchingFeature(Z,v,E,de,oe,R,G,K,f);return Z}hasLayer(c){for(const f of this.bucketLayerIDs)for(const v of f)if(c===v)return!0;return!1}getId(c,f){let v=c.id;return this.promoteId&&(v=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof v=="boolean"&&(v=Number(v))),v}}function jx(h,c,f,v,E){return rt(h,(M,R)=>{const G=c instanceof Au?c.get(R):null;return G&&G.evaluate?G.evaluate(f,v,E):G})}function b_(h){let c=1/0,f=1/0,v=-1/0,E=-1/0;for(const M of h)c=Math.min(c,M.x),f=Math.min(f,M.y),v=Math.max(v,M.x),E=Math.max(E,M.y);return{minX:c,minY:f,maxX:v,maxY:E}}function nf(h,c){return c-h}function x_(h,c,f,v,E){const M=[];for(let R=0;R<h.length;R++){const G=h[R];let K;for(let Z=0;Z<G.length-1;Z++){let oe=G[Z],de=G[Z+1];oe.x<c&&de.x<c||(oe.x<c?oe=new D(c,oe.y+(c-oe.x)/(de.x-oe.x)*(de.y-oe.y))._round():de.x<c&&(de=new D(c,oe.y+(c-oe.x)/(de.x-oe.x)*(de.y-oe.y))._round()),oe.y<f&&de.y<f||(oe.y<f?oe=new D(oe.x+(f-oe.y)/(de.y-oe.y)*(de.x-oe.x),f)._round():de.y<f&&(de=new D(oe.x+(f-oe.y)/(de.y-oe.y)*(de.x-oe.x),f)._round()),oe.x>=v&&de.x>=v||(oe.x>=v?oe=new D(v,oe.y+(v-oe.x)/(de.x-oe.x)*(de.y-oe.y))._round():de.x>=v&&(de=new D(v,oe.y+(v-oe.x)/(de.x-oe.x)*(de.y-oe.y))._round()),oe.y>=E&&de.y>=E||(oe.y>=E?oe=new D(oe.x+(E-oe.y)/(de.y-oe.y)*(de.x-oe.x),E)._round():de.y>=E&&(de=new D(oe.x+(E-oe.y)/(de.y-oe.y)*(de.x-oe.x),E)._round()),K&&oe.equals(K[K.length-1])||(K=[oe],M.push(K)),K.push(de)))))}}return M}Ui("FeatureIndex",Gx,{omit:["rawTileData","sourceLayerCoder"]});class _u extends D{constructor(c,f,v,E){super(c,f),this.angle=v,E!==void 0&&(this.segment=E)}clone(){return new _u(this.x,this.y,this.angle,this.segment)}}function w_(h,c,f,v,E){if(c.segment===void 0||f===0)return!0;let M=c,R=c.segment+1,G=0;for(;G>-f/2;){if(R--,R<0)return!1;G-=h[R].dist(M),M=h[R]}G+=h[R].dist(h[R+1]),R++;const K=[];let Z=0;for(;G<f/2;){const oe=h[R],de=h[R+1];if(!de)return!1;let ye=h[R-1].angleTo(oe)-oe.angleTo(de);for(ye=Math.abs((ye+3*Math.PI)%(2*Math.PI)-Math.PI),K.push({distance:G,angleDelta:ye}),Z+=ye;G-K[0].distance>v;)Z-=K.shift().angleDelta;if(Z>E)return!1;R++,G+=oe.dist(de)}return!0}function Cp(h){let c=0;for(let f=0;f<h.length-1;f++)c+=h[f].dist(h[f+1]);return c}function Ep(h,c,f){return h?.6*c*f:0}function Sp(h,c){return Math.max(h?h.right-h.left:0,c?c.right-c.left:0)}function DI(h,c,f,v,E,M){const R=Ep(f,E,M),G=Sp(f,v)*M;let K=0;const Z=Cp(h)/2;for(let oe=0;oe<h.length-1;oe++){const de=h[oe],ye=h[oe+1],Ce=de.dist(ye);if(K+Ce>Z){const Ie=(Z-K)/Ce,Oe=As.number(de.x,ye.x,Ie),qe=As.number(de.y,ye.y,Ie),Ke=new _u(Oe,qe,ye.angleTo(de),oe);return Ke._round(),!R||w_(h,Ke,G,R,c)?Ke:void 0}K+=Ce}}function RI(h,c,f,v,E,M,R,G,K){const Z=Ep(v,M,R),oe=Sp(v,E),de=oe*R,ye=h[0].x===0||h[0].x===K||h[0].y===0||h[0].y===K;return c-de<c/4&&(c=de+c/4),qx(h,ye?c/2*G%c:(oe/2+2*M)*R*G%c,c,Z,f,de,ye,!1,K)}function qx(h,c,f,v,E,M,R,G,K){const Z=M/2,oe=Cp(h);let de=0,ye=c-f,Ce=[];for(let Ie=0;Ie<h.length-1;Ie++){const Oe=h[Ie],qe=h[Ie+1],Ke=Oe.dist(qe),ut=qe.angleTo(Oe);for(;ye+f<de+Ke;){ye+=f;const et=(ye-de)/Ke,it=As.number(Oe.x,qe.x,et),mt=As.number(Oe.y,qe.y,et);if(it>=0&&it<K&&mt>=0&&mt<K&&ye-Z>=0&&ye+Z<=oe){const Tt=new _u(it,mt,ut,Ie);Tt._round(),v&&!w_(h,Tt,M,v,E)||Ce.push(Tt)}}de+=Ke}return G||Ce.length||R||(Ce=qx(h,de/2,f,v,E,M,R,!0,K)),Ce}Ui("Anchor",_u);const sf=Bl;function JA(h,c,f,v){const E=[],M=h.image,R=M.pixelRatio,G=M.paddedRect.w-2*sf,K=M.paddedRect.h-2*sf,Z=h.right-h.left,oe=h.bottom-h.top,de=M.stretchX||[[0,G]],ye=M.stretchY||[[0,K]],Ce=(pi,Di)=>pi+Di[1]-Di[0],Ie=de.reduce(Ce,0),Oe=ye.reduce(Ce,0),qe=G-Ie,Ke=K-Oe;let ut=0,et=Ie,it=0,mt=Oe,Tt=0,Zt=qe,wi=0,ai=Ke;if(M.content&&v){const pi=M.content;ut=bo(de,0,pi[0]),it=bo(ye,0,pi[1]),et=bo(de,pi[0],pi[2]),mt=bo(ye,pi[1],pi[3]),Tt=pi[0]-ut,wi=pi[1]-it,Zt=pi[2]-pi[0]-et,ai=pi[3]-pi[1]-mt}const di=(pi,Di,li,Jt)=>{const Hi=of(pi.stretch-ut,et,Z,h.left),Vi=Tp(pi.fixed-Tt,Zt,pi.stretch,Ie),mr=of(Di.stretch-it,mt,oe,h.top),Rr=Tp(Di.fixed-wi,ai,Di.stretch,Oe),Qr=of(li.stretch-ut,et,Z,h.left),gn=Tp(li.fixed-Tt,Zt,li.stretch,Ie),ls=of(Jt.stretch-it,mt,oe,h.top),Qn=Tp(Jt.fixed-wi,ai,Jt.stretch,Oe),bn=new D(Hi,mr),Dn=new D(Qr,mr),un=new D(Qr,ls),br=new D(Hi,ls),Vn=new D(Vi/R,Rr/R),hn=new D(gn/R,Qn/R),tn=c*Math.PI/180;if(tn){const bs=Math.sin(tn),Js=Math.cos(tn),Ls=[Js,-bs,bs,Js];bn._matMult(Ls),Dn._matMult(Ls),br._matMult(Ls),un._matMult(Ls)}const ps=pi.stretch+pi.fixed,Is=Di.stretch+Di.fixed;return{tl:bn,tr:Dn,bl:br,br:un,tex:{x:M.paddedRect.x+sf+ps,y:M.paddedRect.y+sf+Is,w:li.stretch+li.fixed-ps,h:Jt.stretch+Jt.fixed-Is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:hn,minFontScaleX:Zt/R/Z,minFontScaleY:ai/R/oe,isSDF:f}};if(v&&(M.stretchX||M.stretchY)){const pi=Ph(de,qe,Ie),Di=Ph(ye,Ke,Oe);for(let li=0;li<pi.length-1;li++){const Jt=pi[li],Hi=pi[li+1];for(let Vi=0;Vi<Di.length-1;Vi++)E.push(di(Jt,Di[Vi],Hi,Di[Vi+1]))}}else E.push(di({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:K+1}));return E}function bo(h,c,f){let v=0;for(const E of h)v+=Math.max(c,Math.min(f,E[1]))-Math.max(c,Math.min(f,E[0]));return v}function Ph(h,c,f){const v=[{fixed:-sf,stretch:0}];for(const[E,M]of h){const R=v[v.length-1];v.push({fixed:E-R.stretch,stretch:R.stretch}),v.push({fixed:E-R.stretch,stretch:R.stretch+(M-E)})}return v.push({fixed:c+sf,stretch:f}),v}function of(h,c,f,v){return h/c*f+v}function Tp(h,c,f,v){return h-c*f/v}class Ip{constructor(c,f,v,E,M,R,G,K,Z,oe){if(this.boxStartIndex=c.length,Z){let de=R.top,ye=R.bottom;const Ce=R.collisionPadding;Ce&&(de-=Ce[1],ye+=Ce[3]);let Ie=ye-de;Ie>0&&(Ie=Math.max(10,Ie),this.circleDiameter=Ie)}else{let de=R.top*G-K[0],ye=R.bottom*G+K[2],Ce=R.left*G-K[3],Ie=R.right*G+K[1];const Oe=R.collisionPadding;if(Oe&&(Ce-=Oe[0]*G,de-=Oe[1]*G,Ie+=Oe[2]*G,ye+=Oe[3]*G),oe){const qe=new D(Ce,de),Ke=new D(Ie,de),ut=new D(Ce,ye),et=new D(Ie,ye),it=oe*Math.PI/180;qe._rotate(it),Ke._rotate(it),ut._rotate(it),et._rotate(it),Ce=Math.min(qe.x,Ke.x,ut.x,et.x),Ie=Math.max(qe.x,Ke.x,ut.x,et.x),de=Math.min(qe.y,Ke.y,ut.y,et.y),ye=Math.max(qe.y,Ke.y,ut.y,et.y)}c.emplaceBack(f.x,f.y,Ce,de,Ie,ye,v,E,M)}this.boxEndIndex=c.length}}class B_{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kI;if(this.data=c,this.length=this.data.length,this.compare=f,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:f,compare:v}=this,E=f[c];for(;c>0;){const M=c-1>>1,R=f[M];if(v(E,R)>=0)break;f[c]=R,c=M}f[c]=E}_down(c){const{data:f,compare:v}=this,E=this.length>>1,M=f[c];for(;c<E;){let R=1+(c<<1),G=f[R];const K=R+1;if(K<this.length&&v(f[K],G)<0&&(R=K,G=f[K]),v(G,M)>=0)break;f[c]=G,c=R}f[c]=M}}function kI(h,c){return h<c?-1:h>c?1:0}function $x(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=1/0,E=1/0,M=-1/0,R=-1/0;const G=h[0];for(let Ce=0;Ce<G.length;Ce++){const Ie=G[Ce];(!Ce||Ie.x<v)&&(v=Ie.x),(!Ce||Ie.y<E)&&(E=Ie.y),(!Ce||Ie.x>M)&&(M=Ie.x),(!Ce||Ie.y>R)&&(R=Ie.y)}const K=Math.min(M-v,R-E);let Z=K/2;const oe=new B_([],Kx);if(K===0)return new D(v,E);for(let Ce=v;Ce<M;Ce+=K)for(let Ie=E;Ie<R;Ie+=K)oe.push(new af(Ce+Z,Ie+Z,Z,h));let de=function(Ce){let Ie=0,Oe=0,qe=0;const Ke=Ce[0];for(let ut=0,et=Ke.length,it=et-1;ut<et;it=ut++){const mt=Ke[ut],Tt=Ke[it],Zt=mt.x*Tt.y-Tt.x*mt.y;Oe+=(mt.x+Tt.x)*Zt,qe+=(mt.y+Tt.y)*Zt,Ie+=3*Zt}return new af(Oe/Ie,qe/Ie,0,Ce)}(h),ye=oe.length;for(;oe.length;){const Ce=oe.pop();(Ce.d>de.d||!de.d)&&(de=Ce,f&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,ye)),Ce.max-de.d<=c||(Z=Ce.h/2,oe.push(new af(Ce.p.x-Z,Ce.p.y-Z,Z,h)),oe.push(new af(Ce.p.x+Z,Ce.p.y-Z,Z,h)),oe.push(new af(Ce.p.x-Z,Ce.p.y+Z,Z,h)),oe.push(new af(Ce.p.x+Z,Ce.p.y+Z,Z,h)),ye+=4)}return f&&(console.log(`num probes: ${ye}`),console.log(`best distance: ${de.d}`)),de.p}function Kx(h,c){return c.max-h.max}function af(h,c,f,v){this.p=new D(h,c),this.h=f,this.d=function(E,M){let R=!1,G=1/0;for(let K=0;K<M.length;K++){const Z=M[K];for(let oe=0,de=Z.length,ye=de-1;oe<de;ye=oe++){const Ce=Z[oe],Ie=Z[ye];Ce.y>E.y!=Ie.y>E.y&&E.x<(Ie.x-Ce.x)*(E.y-Ce.y)/(Ie.y-Ce.y)+Ce.x&&(R=!R),G=Math.min(G,Am(E,Ce,Ie))}}return(R?1:-1)*Math.sqrt(G)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}var sa;s.aq=void 0,(sa=s.aq||(s.aq={}))[sa.center=1]="center",sa[sa.left=2]="left",sa[sa.right=3]="right",sa[sa.top=4]="top",sa[sa.bottom=5]="bottom",sa[sa["top-left"]=6]="top-left",sa[sa["top-right"]=7]="top-right",sa[sa["bottom-left"]=8]="bottom-left",sa[sa["bottom-right"]=9]="bottom-right";const Wu=7,Lp=Number.POSITIVE_INFINITY;function C_(h,c){return c[1]!==Lp?function(f,v,E){let M=0,R=0;switch(v=Math.abs(v),E=Math.abs(E),f){case"top-right":case"top-left":case"top":R=E-Wu;break;case"bottom-right":case"bottom-left":case"bottom":R=-E+Wu}switch(f){case"top-right":case"bottom-right":case"right":M=-v;break;case"top-left":case"bottom-left":case"left":M=v}return[M,R]}(h,c[0],c[1]):function(f,v){let E=0,M=0;v<0&&(v=0);const R=v/Math.SQRT2;switch(f){case"top-right":case"top-left":M=R-Wu;break;case"bottom-right":case"bottom-left":M=-R+Wu;break;case"bottom":M=-v+Wu;break;case"top":M=v-Wu}switch(f){case"top-right":case"bottom-right":E=-R;break;case"top-left":case"bottom-left":E=R;break;case"left":E=v;break;case"right":E=-v}return[E,M]}(h,c[0])}function lf(h,c,f){var v;const E=h.layout,M=(v=E.get("text-variable-anchor-offset"))===null||v===void 0?void 0:v.evaluate(c,{},f);if(M){const G=M.values,K=[];for(let Z=0;Z<G.length;Z+=2){const oe=K[Z]=G[Z],de=G[Z+1].map(ye=>ye*Ts);oe.startsWith("top")?de[1]-=Wu:oe.startsWith("bottom")&&(de[1]+=Wu),K[Z+1]=de}return new hs(K)}const R=E.get("text-variable-anchor");if(R){let G;G=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[E.get("text-radial-offset").evaluate(c,{},f)*Ts,Lp]:E.get("text-offset").evaluate(c,{},f).map(Z=>Z*Ts);const K=[];for(const Z of R)K.push(Z,C_(Z,G));return new hs(K)}return null}function Mp(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wx(h,c,f,v,E,M,R,G,K,Z,oe){let de=M.textMaxSize.evaluate(c,{});de===void 0&&(de=R);const ye=h.layers[0].layout,Ce=ye.get("icon-offset").evaluate(c,{},oe),Ie=Pp(f.horizontal),Oe=R/24,qe=h.tilePixelRatio*Oe,Ke=h.tilePixelRatio*de/24,ut=h.tilePixelRatio*G,et=h.tilePixelRatio*ye.get("symbol-spacing"),it=ye.get("text-padding")*h.tilePixelRatio,mt=function(Jt,Hi,Vi){let mr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Rr=Jt.get("icon-padding").evaluate(Hi,{},Vi),Qr=Rr&&Rr.values;return[Qr[0]*mr,Qr[1]*mr,Qr[2]*mr,Qr[3]*mr]}(ye,c,oe,h.tilePixelRatio),Tt=ye.get("text-max-angle")/180*Math.PI,Zt=ye.get("text-rotation-alignment")!=="viewport"&&ye.get("symbol-placement")!=="point",wi=ye.get("icon-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",ai=ye.get("symbol-placement"),di=et/2,pi=ye.get("icon-text-fit");let Di;v&&pi!=="none"&&(h.allowVerticalPlacement&&f.vertical&&(Di=Lm(v,f.vertical,pi,ye.get("icon-text-fit-padding"),Ce,Oe)),Ie&&(v=Lm(v,Ie,pi,ye.get("icon-text-fit-padding"),Ce,Oe)));const li=(Jt,Hi)=>{Hi.x<0||Hi.x>=Mn||Hi.y<0||Hi.y>=Mn||function(Vi,mr,Rr,Qr,gn,ls,Qn,bn,Dn,un,br,Vn,hn,tn,ps,Is,bs,Js,Ls,Rn,wr,zs,lo,co,ic){const bc=Vi.addToLineVertexArray(mr,Rr);let oa,Xu,xc,wc,Cl=0,Fh=0,kp=0,Zx=0,E_=-1,S_=-1;const Dh={};let Kc=is("");if(Vi.allowVerticalPlacement&&Qr.vertical){const El=bn.layout.get("text-rotate").evaluate(wr,{},co)+90;xc=new Ip(Dn,mr,un,br,Vn,Qr.vertical,hn,tn,ps,El),Qn&&(wc=new Ip(Dn,mr,un,br,Vn,Qn,bs,Js,ps,El))}if(gn){const El=bn.layout.get("icon-rotate").evaluate(wr,{}),bu=bn.layout.get("icon-text-fit")!=="none",Up=JA(gn,El,lo,bu),Rh=Qn?JA(Qn,El,lo,bu):void 0;Xu=new Ip(Dn,mr,un,br,Vn,gn,bs,Js,!1,El),Cl=4*Up.length;const Np=Vi.iconSizeData;let gA=null;Np.kind==="source"?(gA=[$c*bn.layout.get("icon-size").evaluate(wr,{})],gA[0]>$u&&Xe(`${Vi.layerIds[0]}: Value for "icon-size" is >= ${xp}. Reduce your "icon-size".`)):Np.kind==="composite"&&(gA=[$c*zs.compositeIconSizes[0].evaluate(wr,{},co),$c*zs.compositeIconSizes[1].evaluate(wr,{},co)],(gA[0]>$u||gA[1]>$u)&&Xe(`${Vi.layerIds[0]}: Value for "icon-size" is >= ${xp}. Reduce your "icon-size".`)),Vi.addSymbols(Vi.icon,Up,gA,Rn,Ls,wr,s.ai.none,mr,bc.lineStartIndex,bc.lineLength,-1,co),E_=Vi.icon.placedSymbolArray.length-1,Rh&&(Fh=4*Rh.length,Vi.addSymbols(Vi.icon,Rh,gA,Rn,Ls,wr,s.ai.vertical,mr,bc.lineStartIndex,bc.lineLength,-1,co),S_=Vi.icon.placedSymbolArray.length-1)}const Op=Object.keys(Qr.horizontal);for(const El of Op){const bu=Qr.horizontal[El];if(!oa){Kc=is(bu.text);const Rh=bn.layout.get("text-rotate").evaluate(wr,{},co);oa=new Ip(Dn,mr,un,br,Vn,bu,hn,tn,ps,Rh)}const Up=bu.positionedLines.length===1;if(kp+=Rm(Vi,mr,bu,ls,bn,ps,wr,Is,bc,Qr.vertical?s.ai.horizontal:s.ai.horizontalOnly,Up?Op:[El],Dh,E_,zs,co),Up)break}Qr.vertical&&(Zx+=Rm(Vi,mr,Qr.vertical,ls,bn,ps,wr,Is,bc,s.ai.vertical,["vertical"],Dh,S_,zs,co));const Jx=oa?oa.boxStartIndex:Vi.collisionBoxArray.length,OI=oa?oa.boxEndIndex:Vi.collisionBoxArray.length,UI=xc?xc.boxStartIndex:Vi.collisionBoxArray.length,NI=xc?xc.boxEndIndex:Vi.collisionBoxArray.length,Na=Xu?Xu.boxStartIndex:Vi.collisionBoxArray.length,Bc=Xu?Xu.boxEndIndex:Vi.collisionBoxArray.length,YA=wc?wc.boxStartIndex:Vi.collisionBoxArray.length,vu=wc?wc.boxEndIndex:Vi.collisionBoxArray.length;let za=-1;const Cc=(El,bu)=>El&&El.circleDiameter?Math.max(El.circleDiameter,bu):bu;za=Cc(oa,za),za=Cc(xc,za),za=Cc(Xu,za),za=Cc(wc,za);const f8=za>-1?1:0;f8&&(za*=ic/Ts),Vi.glyphOffsetArray.length>=ZA.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wr.sortKey!==void 0&&Vi.addToSortKeyRanges(Vi.symbolInstances.length,wr.sortKey);const Hve=lf(bn,wr,co),[Gve,jve]=function(El,bu){const Up=El.length,Rh=bu==null?void 0:bu.values;if((Rh==null?void 0:Rh.length)>0)for(let Np=0;Np<Rh.length;Np+=2){const gA=Rh[Np+1];El.emplaceBack(s.aq[Rh[Np]],gA[0],gA[1])}return[Up,El.length]}(Vi.textAnchorOffsets,Hve);Vi.symbolInstances.emplaceBack(mr.x,mr.y,Dh.right>=0?Dh.right:-1,Dh.center>=0?Dh.center:-1,Dh.left>=0?Dh.left:-1,Dh.vertical||-1,E_,S_,Kc,Jx,OI,UI,NI,Na,Bc,YA,vu,un,kp,Zx,Cl,Fh,f8,0,hn,za,Gve,jve)}(h,Hi,Jt,f,v,E,Di,h.layers[0],h.collisionBoxArray,c.index,c.sourceLayerIndex,h.index,qe,[it,it,it,it],Zt,K,ut,mt,wi,Ce,c,M,Z,oe,R)};if(ai==="line")for(const Jt of x_(c.geometry,0,0,Mn,Mn)){const Hi=RI(Jt,et,Tt,f.vertical||Ie,v,24,Ke,h.overscaling,Mn);for(const Vi of Hi)Ie&&Fp(h,Ie.text,di,Vi)||li(Jt,Vi)}else if(ai==="line-center"){for(const Jt of c.geometry)if(Jt.length>1){const Hi=DI(Jt,Tt,f.vertical||Ie,v,24,Ke);Hi&&li(Jt,Hi)}}else if(c.type==="Polygon")for(const Jt of z0(c.geometry,0)){const Hi=$x(Jt,16);li(Jt[0],new _u(Hi.x,Hi.y,0))}else if(c.type==="LineString")for(const Jt of c.geometry)li(Jt,new _u(Jt[0].x,Jt[0].y,0));else if(c.type==="Point")for(const Jt of c.geometry)for(const Hi of Jt)li([Hi],new _u(Hi.x,Hi.y,0))}function Rm(h,c,f,v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie){const Oe=function(ut,et,it,mt,Tt,Zt,wi,ai){const di=mt.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,pi=[];for(const Di of et.positionedLines)for(const li of Di.positionedGlyphs){if(!li.rect)continue;const Jt=li.rect||{};let Hi=_p+1,Vi=!0,mr=1,Rr=0;const Qr=(Tt||ai)&&li.vertical,gn=li.metrics.advance*li.scale/2;if(ai&&et.verticalizable&&(Rr=Di.lineOffset/2-(li.imageName?-(Ts-li.metrics.width*li.scale)/2:(li.scale-1)*Ts)),li.imageName){const Rn=wi[li.imageName];Vi=Rn.sdf,mr=Rn.pixelRatio,Hi=Bl/mr}const ls=Tt?[li.x+gn,li.y]:[0,0];let Qn=Tt?[0,0]:[li.x+gn+it[0],li.y+it[1]-Rr],bn=[0,0];Qr&&(bn=Qn,Qn=[0,0]);const Dn=li.metrics.isDoubleResolution?2:1,un=(li.metrics.left-Hi)*li.scale-gn+Qn[0],br=(-li.metrics.top-Hi)*li.scale+Qn[1],Vn=un+Jt.w/Dn*li.scale/mr,hn=br+Jt.h/Dn*li.scale/mr,tn=new D(un,br),ps=new D(Vn,br),Is=new D(un,hn),bs=new D(Vn,hn);if(Qr){const Rn=new D(-gn,gn-Wd),wr=-Math.PI/2,zs=Ts/2-gn,lo=new D(5-Wd-zs,-(li.imageName?zs:0)),co=new D(...bn);tn._rotateAround(wr,Rn)._add(lo)._add(co),ps._rotateAround(wr,Rn)._add(lo)._add(co),Is._rotateAround(wr,Rn)._add(lo)._add(co),bs._rotateAround(wr,Rn)._add(lo)._add(co)}if(di){const Rn=Math.sin(di),wr=Math.cos(di),zs=[wr,-Rn,Rn,wr];tn._matMult(zs),ps._matMult(zs),Is._matMult(zs),bs._matMult(zs)}const Js=new D(0,0),Ls=new D(0,0);pi.push({tl:tn,tr:ps,bl:Is,br:bs,tex:Jt,writingMode:et.writingMode,glyphOffset:ls,sectionIndex:li.sectionIndex,isSDF:Vi,pixelOffsetTL:Js,pixelOffsetBR:Ls,minFontScaleX:0,minFontScaleY:0})}return pi}(0,f,G,E,M,R,v,h.allowVerticalPlacement),qe=h.textSizeData;let Ke=null;qe.kind==="source"?(Ke=[$c*E.layout.get("text-size").evaluate(R,{})],Ke[0]>$u&&Xe(`${h.layerIds[0]}: Value for "text-size" is >= ${xp}. Reduce your "text-size".`)):qe.kind==="composite"&&(Ke=[$c*Ce.compositeTextSizes[0].evaluate(R,{},Ie),$c*Ce.compositeTextSizes[1].evaluate(R,{},Ie)],(Ke[0]>$u||Ke[1]>$u)&&Xe(`${h.layerIds[0]}: Value for "text-size" is >= ${xp}. Reduce your "text-size".`)),h.addSymbols(h.text,Oe,Ke,G,M,R,Z,c,K.lineStartIndex,K.lineLength,ye,Ie);for(const ut of oe)de[ut]=h.text.placedSymbolArray.length-1;return 4*Oe.length}function Pp(h){for(const c in h)return h[c];return null}function Fp(h,c,f,v){const E=h.compareText;if(c in E){const M=E[c];for(let R=M.length-1;R>=0;R--)if(v.dist(M[R])<f)return!0}else E[c]=[];return E[c].push(v),!1}const km=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dp{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,v]=new Uint8Array(c,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const E=v>>4;if(E!==1)throw new Error(`Got v${E} data when expected v1.`);const M=km[15&v];if(!M)throw new Error("Unrecognized array type.");const[R]=new Uint16Array(c,2,1),[G]=new Uint32Array(c,4,1);return new Dp(G,R,M,c)}constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,E=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=v,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const M=km.indexOf(this.ArrayType),R=2*c*this.ArrayType.BYTES_PER_ELEMENT,G=c*this.IndexArrayType.BYTES_PER_ELEMENT,K=(8-G%8)%8;if(M<0)throw new Error(`Unexpected typed array class: ${v}.`);E&&E instanceof ArrayBuffer?(this.data=E,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+K,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+R+G+K),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+K,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+M]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=c)}add(c,f){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=c,this.coords[this._pos++]=f,v}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return Rp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,f,v,E){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:R,nodeSize:G}=this,K=[0,M.length-1,0],Z=[];for(;K.length;){const oe=K.pop()||0,de=K.pop()||0,ye=K.pop()||0;if(de-ye<=G){for(let qe=ye;qe<=de;qe++){const Ke=R[2*qe],ut=R[2*qe+1];Ke>=c&&Ke<=v&&ut>=f&&ut<=E&&Z.push(M[qe])}continue}const Ce=ye+de>>1,Ie=R[2*Ce],Oe=R[2*Ce+1];Ie>=c&&Ie<=v&&Oe>=f&&Oe<=E&&Z.push(M[Ce]),(oe===0?c<=Ie:f<=Oe)&&(K.push(ye),K.push(Ce-1),K.push(1-oe)),(oe===0?v>=Ie:E>=Oe)&&(K.push(Ce+1),K.push(de),K.push(1-oe))}return Z}within(c,f,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:M,nodeSize:R}=this,G=[0,E.length-1,0],K=[],Z=v*v;for(;G.length;){const oe=G.pop()||0,de=G.pop()||0,ye=G.pop()||0;if(de-ye<=R){for(let qe=ye;qe<=de;qe++)m(M[2*qe],M[2*qe+1],c,f)<=Z&&K.push(E[qe]);continue}const Ce=ye+de>>1,Ie=M[2*Ce],Oe=M[2*Ce+1];m(Ie,Oe,c,f)<=Z&&K.push(E[Ce]),(oe===0?c-v<=Ie:f-v<=Oe)&&(G.push(ye),G.push(Ce-1),G.push(1-oe)),(oe===0?c+v>=Ie:f+v>=Oe)&&(G.push(Ce+1),G.push(de),G.push(1-oe))}return K}}function Rp(h,c,f,v,E,M){if(E-v<=f)return;const R=v+E>>1;Xx(h,c,R,v,E,M),Rp(h,c,f,v,R-1,1-M),Rp(h,c,f,R+1,E,1-M)}function Xx(h,c,f,v,E,M){for(;E>v;){if(E-v>600){const Z=E-v+1,oe=f-v+1,de=Math.log(Z),ye=.5*Math.exp(2*de/3),Ce=.5*Math.sqrt(de*ye*(Z-ye)/Z)*(oe-Z/2<0?-1:1);Xx(h,c,f,Math.max(v,Math.floor(f-oe*ye/Z+Ce)),Math.min(E,Math.floor(f+(Z-oe)*ye/Z+Ce)),M)}const R=c[2*f+M];let G=v,K=E;for(p(h,c,v,f),c[2*E+M]>R&&p(h,c,v,E);G<K;){for(p(h,c,G,K),G++,K--;c[2*G+M]<R;)G++;for(;c[2*K+M]>R;)K--}c[2*v+M]===R?p(h,c,v,K):(K++,p(h,c,K,E)),K<=f&&(v=K+1),f<=K&&(E=K-1)}}function p(h,c,f,v){u(h,f,v),u(c,2*f,2*v),u(c,2*f+1,2*v+1)}function u(h,c,f){const v=h[c];h[c]=h[f],h[f]=v}function m(h,c,f,v){const E=h-f,M=c-v;return E*E+M*M}var C;s.bh=void 0,(C=s.bh||(s.bh={})).create="create",C.load="load",C.fullLoad="fullLoad";let P=null,Q=[];const V=1e3/60,W="loadTime",ne="fullLoadTime",Ae={mark(h){performance.mark(h)},frame(h){const c=h;P!=null&&Q.push(c-P),P=c},clearMetrics(){P=null,Q=[],performance.clearMeasures(W),performance.clearMeasures(ne);for(const h in s.bh)performance.clearMarks(s.bh[h])},getPerformanceMetrics(){performance.measure(W,s.bh.create,s.bh.load),performance.measure(ne,s.bh.create,s.bh.fullLoad);const h=performance.getEntriesByName(W)[0].duration,c=performance.getEntriesByName(ne)[0].duration,f=Q.length,v=1/(Q.reduce((M,R)=>M+R,0)/f/1e3),E=Q.filter(M=>M>V).reduce((M,R)=>M+(R-V)/V,0);return{loadTime:h,fullLoadTime:c,fps:v,percentDroppedFrames:E/(f+E)*100,totalFrames:f}}};s.$=function(h,c,f){var v,E,M,R,G,K,Z,oe,de,ye,Ce,Ie,Oe=f[0],qe=f[1],Ke=f[2];return c===h?(h[12]=c[0]*Oe+c[4]*qe+c[8]*Ke+c[12],h[13]=c[1]*Oe+c[5]*qe+c[9]*Ke+c[13],h[14]=c[2]*Oe+c[6]*qe+c[10]*Ke+c[14],h[15]=c[3]*Oe+c[7]*qe+c[11]*Ke+c[15]):(E=c[1],M=c[2],R=c[3],G=c[4],K=c[5],Z=c[6],oe=c[7],de=c[8],ye=c[9],Ce=c[10],Ie=c[11],h[0]=v=c[0],h[1]=E,h[2]=M,h[3]=R,h[4]=G,h[5]=K,h[6]=Z,h[7]=oe,h[8]=de,h[9]=ye,h[10]=Ce,h[11]=Ie,h[12]=v*Oe+G*qe+de*Ke+c[12],h[13]=E*Oe+K*qe+ye*Ke+c[13],h[14]=M*Oe+Z*qe+Ce*Ke+c[14],h[15]=R*Oe+oe*qe+Ie*Ke+c[15]),h},s.A=qc,s.B=As,s.C=class{constructor(h,c,f){this.receive=v=>{const E=v.data,M=E.id;if(M&&(!E.targetMapId||this.mapId===E.targetMapId))if(E.type==="<cancel>"){delete this.tasks[M];const R=this.cancelCallbacks[M];delete this.cancelCallbacks[M],R&&R()}else Mt()||E.mustQueue?(this.tasks[M]=E,this.taskQueue.push(M),this.invoker.trigger()):this.processTask(M,E)},this.process=()=>{if(!this.taskQueue.length)return;const v=this.taskQueue.shift(),E=this.tasks[v];delete this.tasks[v],this.taskQueue.length&&this.invoker.trigger(),E&&this.processTask(v,E)},this.target=h,this.parent=c,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Pm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Mt()?h:window}send(h,c,f,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[M]=f);const R=[],G={id:M,type:h,hasCallback:!!f,targetMapId:v,mustQueue:E,sourceMapId:this.mapId,data:Fi(c,R)};return this.target.postMessage(G,{transfer:R}),{cancel:()=>{f&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}processTask(h,c){if(c.type==="<response>"){const f=this.callbacks[h];delete this.callbacks[h],f&&(c.error?f(ml(c.error)):f(null,ml(c.data)))}else{let f=!1;const v=[],E=c.hasCallback?(G,K)=>{f=!0,delete this.cancelCallbacks[h];const Z={id:h,type:"<response>",sourceMapId:this.mapId,error:G?Fi(G):null,data:Fi(K,v)};this.target.postMessage(Z,{transfer:v})}:G=>{f=!0};let M=null;const R=ml(c.data);if(this.parent[c.type])M=this.parent[c.type](c.sourceMapId,R,E);else if("getWorkerSource"in this.parent){const G=c.type.split(".");M=this.parent.getWorkerSource(c.sourceMapId,G[0],R.source)[G[1]](R,E)}else E(new Error(`Could not find function ${c.type}`));!f&&M&&M.cancel&&(this.cancelCallbacks[h]=M.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=Ki,s.E=ti,s.F=function(h,c){const f={};for(let v=0;v<c.length;v++){const E=c[v];E in h&&(f[E]=h[E])}return f},s.G=tf,s.H=A_,s.I=Sm,s.J=fe,s.K=ve,s.L=Ku,s.M=Xt,s.N=Mn,s.O=Qo,s.P=D,s.Q=zn,s.R=No,s.S=Ii,s.T=Qc,s.U=Bp,s.V=class extends ka{},s.W=g_,s.X=function(h,c){const f=window.document.createElement("video");f.muted=!0,f.onloadstart=function(){c(null,f)};for(let v=0;v<h.length;v++){const E=window.document.createElement("source");Pi(h[v])||(f.crossOrigin="Anonymous"),E.src=h[v],f.appendChild(E)}return{cancel:()=>{}}},s.Y=Kt,s.Z=function(){var h=new qc(16);return qc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},s._=g,s.a=Dt,s.a$=class extends H{},s.a0=function(h,c,f){var v=f[0],E=f[1],M=f[2];return h[0]=c[0]*v,h[1]=c[1]*v,h[2]=c[2]*v,h[3]=c[3]*v,h[4]=c[4]*E,h[5]=c[5]*E,h[6]=c[6]*E,h[7]=c[7]*E,h[8]=c[8]*M,h[9]=c[9]*M,h[10]=c[10]*M,h[11]=c[11]*M,h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.a1=cA,s.a2=function(){return at++},s.a3=I,s.a4=ZA,s.a5=function(){Ws.isLoading()||Ws.isLoaded()||hu()!=="deferred"||ba()},s.a6=Al,s.a7=Gc,s.a8=xi,s.a9=v_,s.aA=Zl,s.aB=function(h){h=h.slice();const c=Object.create(null);for(let f=0;f<h.length;f++)c[h[f].id]=h[f];for(let f=0;f<h.length;f++)"ref"in h[f]&&(h[f]=si(h[f],c[h[f].ref]));return h},s.aC=function(h){if(h.type==="custom")return new u_(h);switch(h.type){case"background":return new Qx(h);case"circle":return new xl(h);case"fill":return new yI(h);case"fill-extrusion":return new mx(h);case"heatmap":return new Ua(h);case"hillshade":return new Qd(h);case"line":return new vo(h);case"raster":return new Hx(h);case"symbol":return new ef(h)}},s.aD=Pe,s.aE=function(h,c){if(!h)return[{command:ci.setStyle,args:[c]}];let f=[];try{if(!fi(h.version,c.version))return[{command:ci.setStyle,args:[c]}];fi(h.center,c.center)||f.push({command:ci.setCenter,args:[c.center]}),fi(h.zoom,c.zoom)||f.push({command:ci.setZoom,args:[c.zoom]}),fi(h.bearing,c.bearing)||f.push({command:ci.setBearing,args:[c.bearing]}),fi(h.pitch,c.pitch)||f.push({command:ci.setPitch,args:[c.pitch]}),fi(h.sprite,c.sprite)||f.push({command:ci.setSprite,args:[c.sprite]}),fi(h.glyphs,c.glyphs)||f.push({command:ci.setGlyphs,args:[c.glyphs]}),fi(h.transition,c.transition)||f.push({command:ci.setTransition,args:[c.transition]}),fi(h.light,c.light)||f.push({command:ci.setLight,args:[c.light]});const v={},E=[];(function(R,G,K,Z){let oe;for(oe in G=G||{},R=R||{})Object.prototype.hasOwnProperty.call(R,oe)&&(Object.prototype.hasOwnProperty.call(G,oe)||ir(oe,K,Z));for(oe in G)Object.prototype.hasOwnProperty.call(G,oe)&&(Object.prototype.hasOwnProperty.call(R,oe)?fi(R[oe],G[oe])||(R[oe].type==="geojson"&&G[oe].type==="geojson"&&Sr(R,G,oe)?K.push({command:ci.setGeoJSONSourceData,args:[oe,G[oe].data]}):dr(oe,G,K,Z)):Wi(oe,G,K))})(h.sources,c.sources,E,v);const M=[];h.layers&&h.layers.forEach(R=>{v[R.source]?f.push({command:ci.removeLayer,args:[R.id]}):M.push(R)}),f=f.concat(E),function(R,G,K){G=G||[];const Z=(R=R||[]).map(Yi),oe=G.map(Yi),de=R.reduce(ui,{}),ye=G.reduce(ui,{}),Ce=Z.slice(),Ie=Object.create(null);let Oe,qe,Ke,ut,et,it,mt;for(Oe=0,qe=0;Oe<Z.length;Oe++)Ke=Z[Oe],Object.prototype.hasOwnProperty.call(ye,Ke)?qe++:(K.push({command:ci.removeLayer,args:[Ke]}),Ce.splice(Ce.indexOf(Ke,qe),1));for(Oe=0,qe=0;Oe<oe.length;Oe++)Ke=oe[oe.length-1-Oe],Ce[Ce.length-1-Oe]!==Ke&&(Object.prototype.hasOwnProperty.call(de,Ke)?(K.push({command:ci.removeLayer,args:[Ke]}),Ce.splice(Ce.lastIndexOf(Ke,Ce.length-qe),1)):qe++,it=Ce[Ce.length-Oe],K.push({command:ci.addLayer,args:[ye[Ke],it]}),Ce.splice(Ce.length-Oe,0,Ke),Ie[Ke]=!0);for(Oe=0;Oe<oe.length;Oe++)if(Ke=oe[Oe],ut=de[Ke],et=ye[Ke],!Ie[Ke]&&!fi(ut,et))if(fi(ut.source,et.source)&&fi(ut["source-layer"],et["source-layer"])&&fi(ut.type,et.type)){for(mt in zt(ut.layout,et.layout,K,Ke,null,ci.setLayoutProperty),zt(ut.paint,et.paint,K,Ke,null,ci.setPaintProperty),fi(ut.filter,et.filter)||K.push({command:ci.setFilter,args:[Ke,et.filter]}),fi(ut.minzoom,et.minzoom)&&fi(ut.maxzoom,et.maxzoom)||K.push({command:ci.setLayerZoomRange,args:[Ke,et.minzoom,et.maxzoom]}),ut)Object.prototype.hasOwnProperty.call(ut,mt)&&mt!=="layout"&&mt!=="paint"&&mt!=="filter"&&mt!=="metadata"&&mt!=="minzoom"&&mt!=="maxzoom"&&(mt.indexOf("paint.")===0?zt(ut[mt],et[mt],K,Ke,mt.slice(6),ci.setPaintProperty):fi(ut[mt],et[mt])||K.push({command:ci.setLayerProperty,args:[Ke,mt,et[mt]]}));for(mt in et)Object.prototype.hasOwnProperty.call(et,mt)&&!Object.prototype.hasOwnProperty.call(ut,mt)&&mt!=="layout"&&mt!=="paint"&&mt!=="filter"&&mt!=="metadata"&&mt!=="minzoom"&&mt!=="maxzoom"&&(mt.indexOf("paint.")===0?zt(ut[mt],et[mt],K,Ke,mt.slice(6),ci.setPaintProperty):fi(ut[mt],et[mt])||K.push({command:ci.setLayerProperty,args:[Ke,mt,et[mt]]}))}else K.push({command:ci.removeLayer,args:[Ke]}),it=Ce[Ce.lastIndexOf(Ke)+1],K.push({command:ci.addLayer,args:[et,it]})}(M,c.layers,f)}catch(v){console.warn("Unable to compute style diff:",v),f=[{command:ci.setStyle,args:[c]}]}return f},s.aF=function(h){const c=[],f=h.id;return f===void 0&&c.push({message:`layers.${f}: missing required property "id"`}),h.render===void 0&&c.push({message:`layers.${f}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&c.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),c},s.aG=function h(c,f){if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(let v=0;v<c.length;v++)if(!h(c[v],f[v]))return!1;return!0}if(typeof c=="object"&&c!==null&&f!==null){if(typeof f!="object"||Object.keys(c).length!==Object.keys(f).length)return!1;for(const v in c)if(!h(c[v],f[v]))return!1;return!0}return c===f},s.aH=rt,s.aI=Re,s.aJ=mc,s.aK=function(h){return h({pluginStatus:Es,pluginURL:Ro}),mc.on("pluginStateChange",h),h},s.aL=class extends cn{constructor(h,c){super(h,c),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.aM=$r,s.aN=class extends cn{constructor(h,c){super(h,c),this.current=Wn}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let c=1;c<16;c++)if(h[c]!==this.current[c]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},s.aO=Xr,s.aP=class extends cn{constructor(h,c){super(h,c),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},s.aQ=class extends cn{constructor(h,c){super(h,c),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},s.aR=Fn,s.aS=function(h,c,f,v,E,M,R){var G=1/(c-f),K=1/(v-E),Z=1/(M-R);return h[0]=-2*G,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*K,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*Z,h[11]=0,h[12]=(c+f)*G,h[13]=(E+v)*K,h[14]=(R+M)*Z,h[15]=1,h},s.aT=cr,s.aU=Nd,s.aV=class extends L{},s.aW=Ex,s.aX=class extends y{},s.aY=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},s.aZ=uA,s.a_=De,s.aa=function(h){const c={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,v,E,M)=>{const R=E||M;return c[v]=!R||R.toLowerCase(),""}),c["max-age"]){const f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c},s.ab=function(h,c){const f=[];for(const v in h)v in c||f.push(v);return f},s.ac=function(h){if(vt==null){const c=h.navigator?h.navigator.userAgent:null;vt=!!h.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return vt},s.ad=He,s.ae=function(h,c,f){var v=Math.sin(f),E=Math.cos(f),M=c[0],R=c[1],G=c[2],K=c[3],Z=c[4],oe=c[5],de=c[6],ye=c[7];return c!==h&&(h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[0]=M*E+Z*v,h[1]=R*E+oe*v,h[2]=G*E+de*v,h[3]=K*E+ye*v,h[4]=Z*E-M*v,h[5]=oe*E-R*v,h[6]=de*E-G*v,h[7]=ye*E-K*v,h},s.af=function(h){var c=new qc(16);return c[0]=h[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=h[6],c[7]=h[7],c[8]=h[8],c[9]=h[9],c[10]=h[10],c[11]=h[11],c[12]=h[12],c[13]=h[13],c[14]=h[14],c[15]=h[15],c},s.ag=yu,s.ah=function(h,c){let f=0,v=0;if(h.kind==="constant")v=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:E,minZoom:M,maxZoom:R}=h,G=E?He(fn.interpolationFactor(E,c,M,R),0,1):0;h.kind==="camera"?v=As.number(h.minSize,h.maxSize,G):f=G}return{uSizeT:f,uSize:v}},s.aj=function(h,c,f){let{uSize:v,uSizeT:E}=c,{lowerSize:M,upperSize:R}=f;return h.kind==="source"?M/$c:h.kind==="composite"?As.number(M/$c,R/$c,E):v},s.ak=Yd,s.al=function(h,c,f,v){const E=c.y-h.y,M=c.x-h.x,R=v.y-f.y,G=v.x-f.x,K=R*M-G*E;if(K===0)return null;const Z=(G*(h.y-f.y)-R*(h.x-f.x))/K;return new D(h.x+Z*M,h.y+Z*E)},s.am=x_,s.an=jc,s.ao=Ud,s.ap=Ts,s.ar=Mm,s.as=function(h,c){var f=c[0],v=c[1],E=c[2],M=c[3],R=c[4],G=c[5],K=c[6],Z=c[7],oe=c[8],de=c[9],ye=c[10],Ce=c[11],Ie=c[12],Oe=c[13],qe=c[14],Ke=c[15],ut=f*G-v*R,et=f*K-E*R,it=f*Z-M*R,mt=v*K-E*G,Tt=v*Z-M*G,Zt=E*Z-M*K,wi=oe*Oe-de*Ie,ai=oe*qe-ye*Ie,di=oe*Ke-Ce*Ie,pi=de*qe-ye*Oe,Di=de*Ke-Ce*Oe,li=ye*Ke-Ce*qe,Jt=ut*li-et*Di+it*pi+mt*di-Tt*ai+Zt*wi;return Jt?(h[0]=(G*li-K*Di+Z*pi)*(Jt=1/Jt),h[1]=(E*Di-v*li-M*pi)*Jt,h[2]=(Oe*Zt-qe*Tt+Ke*mt)*Jt,h[3]=(ye*Tt-de*Zt-Ce*mt)*Jt,h[4]=(K*di-R*li-Z*ai)*Jt,h[5]=(f*li-E*di+M*ai)*Jt,h[6]=(qe*it-Ie*Zt-Ke*et)*Jt,h[7]=(oe*Zt-ye*it+Ce*et)*Jt,h[8]=(R*Di-G*di+Z*wi)*Jt,h[9]=(v*di-f*Di-M*wi)*Jt,h[10]=(Ie*Tt-Oe*it+Ke*ut)*Jt,h[11]=(de*it-oe*Tt-Ce*ut)*Jt,h[12]=(G*ai-R*pi-K*wi)*Jt,h[13]=(f*pi-v*ai+E*wi)*Jt,h[14]=(Oe*et-Ie*mt-qe*ut)*Jt,h[15]=(oe*mt-de*et+ye*ut)*Jt,h):null},s.at=Mp,s.au=n_,s.av=Dp,s.aw=function(){const h={},c=ht.$version;for(const f in ht.$root){const v=ht.$root[f];if(v.required){let E=null;E=f==="version"?c:v.type==="array"?[]:{},E!=null&&(h[f]=E)}}return h},s.ax=ci,s.ay=Kl,s.az=Lt,s.b=function(h,c){const f=new Blob([new Uint8Array(h)],{type:"image/png"});createImageBitmap(f).then(v=>{c(null,v)}).catch(v=>{c(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Ht,s.b1=function(h,c){var f=h[0],v=h[1],E=h[2],M=h[3],R=h[4],G=h[5],K=h[6],Z=h[7],oe=h[8],de=h[9],ye=h[10],Ce=h[11],Ie=h[12],Oe=h[13],qe=h[14],Ke=h[15],ut=c[0],et=c[1],it=c[2],mt=c[3],Tt=c[4],Zt=c[5],wi=c[6],ai=c[7],di=c[8],pi=c[9],Di=c[10],li=c[11],Jt=c[12],Hi=c[13],Vi=c[14],mr=c[15];return Math.abs(f-ut)<=na*Math.max(1,Math.abs(f),Math.abs(ut))&&Math.abs(v-et)<=na*Math.max(1,Math.abs(v),Math.abs(et))&&Math.abs(E-it)<=na*Math.max(1,Math.abs(E),Math.abs(it))&&Math.abs(M-mt)<=na*Math.max(1,Math.abs(M),Math.abs(mt))&&Math.abs(R-Tt)<=na*Math.max(1,Math.abs(R),Math.abs(Tt))&&Math.abs(G-Zt)<=na*Math.max(1,Math.abs(G),Math.abs(Zt))&&Math.abs(K-wi)<=na*Math.max(1,Math.abs(K),Math.abs(wi))&&Math.abs(Z-ai)<=na*Math.max(1,Math.abs(Z),Math.abs(ai))&&Math.abs(oe-di)<=na*Math.max(1,Math.abs(oe),Math.abs(di))&&Math.abs(de-pi)<=na*Math.max(1,Math.abs(de),Math.abs(pi))&&Math.abs(ye-Di)<=na*Math.max(1,Math.abs(ye),Math.abs(Di))&&Math.abs(Ce-li)<=na*Math.max(1,Math.abs(Ce),Math.abs(li))&&Math.abs(Ie-Jt)<=na*Math.max(1,Math.abs(Ie),Math.abs(Jt))&&Math.abs(Oe-Hi)<=na*Math.max(1,Math.abs(Oe),Math.abs(Hi))&&Math.abs(qe-Vi)<=na*Math.max(1,Math.abs(qe),Math.abs(Vi))&&Math.abs(Ke-mr)<=na*Math.max(1,Math.abs(Ke),Math.abs(mr))},s.b2=function(h,c){return h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=c[6],h[7]=c[7],h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.b3=function(h,c,f){return h[0]=c[0]*f[0],h[1]=c[1]*f[1],h[2]=c[2]*f[2],h[3]=c[3]*f[3],h},s.b4=function(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]+h[3]*c[3]},s.b5=$e,s.b6=m_,s.b7=d_,s.b8=function(h,c,f,v,E){var M,R=1/Math.tan(c/2);return h[0]=R/f,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=R,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,E!=null&&E!==1/0?(h[10]=(E+v)*(M=1/(v-E)),h[14]=2*E*v*M):(h[10]=-1,h[14]=-2*v),h},s.b9=function(h,c,f){var v=Math.sin(f),E=Math.cos(f),M=c[4],R=c[5],G=c[6],K=c[7],Z=c[8],oe=c[9],de=c[10],ye=c[11];return c!==h&&(h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[4]=M*E+Z*v,h[5]=R*E+oe*v,h[6]=G*E+de*v,h[7]=K*E+ye*v,h[8]=Z*E-M*v,h[9]=oe*E-R*v,h[10]=de*E-G*v,h[11]=ye*E-K*v,h},s.bA=S,s.bB=Z0,s.bC=Mr,s.bD=Ws,s.ba=Se,s.bb=Ge,s.bc=function(h,c){return h[0]=c[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=c[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=c[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},s.bd=class extends nl{},s.be=Fm,s.bf=f_,s.bg=Ae,s.bi=Ft,s.bj=function(h,c){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(Es===Nc||Es===zc||Es===rl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ro=pt.resolveURL(h),Es=Nc,_n=c,Uu(),f||ba()},s.bk=hu,s.bl=function(h,c){const f={};for(let E=0;E<h.length;E++){const M=c&&c[h[E].id]||Rs(h[E]);c&&(c[h[E].id]=M);let R=f[M];R||(R=f[M]=[]),R.push(h[E])}const v=[];for(const E in f)v.push(f[E]);return v},s.bm=Ui,s.bn=__,s.bo=Gx,s.bp=t_,s.bq=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Mn/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const c=h.bucket.layers[0],f=c.layout,v=c._unevaluatedLayout._values,E={layoutIconSize:v["icon-size"].possiblyEvaluate(new xi(h.bucket.zoom+1),h.canonical),layoutTextSize:v["text-size"].possiblyEvaluate(new xi(h.bucket.zoom+1),h.canonical),textMaxSize:v["text-size"].possiblyEvaluate(new xi(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:Z,maxZoom:oe}=h.bucket.textSizeData;E.compositeTextSizes=[v["text-size"].possiblyEvaluate(new xi(Z),h.canonical),v["text-size"].possiblyEvaluate(new xi(oe),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:Z,maxZoom:oe}=h.bucket.iconSizeData;E.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new xi(Z),h.canonical),v["icon-size"].possiblyEvaluate(new xi(oe),h.canonical)]}const M=f.get("text-line-height")*Ts,R=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",G=f.get("text-keep-upright"),K=f.get("text-size");for(const Z of h.bucket.features){const oe=f.get("text-font").evaluate(Z,{},h.canonical).join(","),de=K.evaluate(Z,{},h.canonical),ye=E.layoutTextSize.evaluate(Z,{},h.canonical),Ce=E.layoutIconSize.evaluate(Z,{},h.canonical),Ie={horizontal:{},vertical:void 0},Oe=Z.text;let qe,Ke=[0,0];if(Oe){const it=Oe.toString(),mt=f.get("text-letter-spacing").evaluate(Z,{},h.canonical)*Ts,Tt=Si(it)?mt:0,Zt=f.get("text-anchor").evaluate(Z,{},h.canonical),wi=lf(c,Z,h.canonical);if(!wi){const li=f.get("text-radial-offset").evaluate(Z,{},h.canonical);Ke=li?C_(Zt,[li*Ts,Lp]):f.get("text-offset").evaluate(Z,{},h.canonical).map(Jt=>Jt*Ts)}let ai=R?"center":f.get("text-justify").evaluate(Z,{},h.canonical);const di=f.get("symbol-placement"),pi=di==="point"?f.get("text-max-width").evaluate(Z,{},h.canonical)*Ts:0,Di=()=>{h.bucket.allowVerticalPlacement&&Wl(it)&&(Ie.vertical=Zd(Oe,h.glyphMap,h.glyphPositions,h.imagePositions,oe,pi,M,Zt,"left",Tt,Ke,s.ai.vertical,!0,di,ye,de))};if(!R&&wi){const li=new Set;if(ai==="auto")for(let Hi=0;Hi<wi.values.length;Hi+=2)li.add(Mp(wi.values[Hi]));else li.add(ai);let Jt=!1;for(const Hi of li)if(!Ie.horizontal[Hi])if(Jt)Ie.horizontal[Hi]=Ie.horizontal[0];else{const Vi=Zd(Oe,h.glyphMap,h.glyphPositions,h.imagePositions,oe,pi,M,"center",Hi,Tt,Ke,s.ai.horizontal,!1,di,ye,de);Vi&&(Ie.horizontal[Hi]=Vi,Jt=Vi.positionedLines.length===1)}Di()}else{ai==="auto"&&(ai=Mp(Zt));const li=Zd(Oe,h.glyphMap,h.glyphPositions,h.imagePositions,oe,pi,M,Zt,ai,Tt,Ke,s.ai.horizontal,!1,di,ye,de);li&&(Ie.horizontal[ai]=li),Di(),Wl(it)&&R&&G&&(Ie.vertical=Zd(Oe,h.glyphMap,h.glyphPositions,h.imagePositions,oe,pi,M,Zt,ai,Tt,Ke,s.ai.vertical,!1,di,ye,de))}}let ut=!1;if(Z.icon&&Z.icon.name){const it=h.imageMap[Z.icon.name];it&&(qe=Im(h.imagePositions[Z.icon.name],f.get("icon-offset").evaluate(Z,{},h.canonical),f.get("icon-anchor").evaluate(Z,{},h.canonical)),ut=!!it.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=ut:h.bucket.sdfIcons!==ut&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==h.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const et=Pp(Ie.horizontal)||Ie.vertical;h.bucket.iconsInText=!!et&&et.iconsInText,(et||qe)&&Wx(h.bucket,Z,Ie,qe,h.imageMap,E,ye,Ce,Ke,ut,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},s.br=K0,s.bs=V0,s.bt=q0,s.bu=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},s.bv=Em,s.bw=AA,s.bx=function(h,c,f,v,E){return g(this,void 0,void 0,function*(){if(ve())try{return yield Xt(h,c,f,v,E)}catch{}return function(M,R,G,K,Z){const oe=M.width,de=M.height;Te&&Ze||(Te=new OffscreenCanvas(oe,de),Ze=Te.getContext("2d",{willReadFrequently:!0})),Te.width=oe,Te.height=de,Ze.drawImage(M,0,0,oe,de);const ye=Ze.getImageData(R,G,K,Z);return Ze.clearRect(0,0,oe,de),ye.data}(h,c,f,v,E)})},s.by=y_,s.bz=b,s.c=Bt,s.d=function(h,c){const f=new Image;f.onload=()=>{c(null,f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Pt})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(h)],{type:"image/png"});f.src=h.byteLength?URL.createObjectURL(v):Pt},s.e=Ne,s.f=function(h,c){return mi(Ne(h,{type:"json"}),c)},s.g=Gt,s.h=pt,s.i=Mt,s.j=ki,s.k=wt,s.l=yi,s.m=mi,s.n=function(h){return new Em(h).readFields(mp,[])},s.o=function(h,c,f){if(!h.length)return f(null,[]);let v=h.length;const E=new Array(h.length);let M=null;h.forEach((R,G)=>{c(R,(K,Z)=>{K&&(M=K),E[G]=Z,--v==0&&f(M,E)})})},s.p=vp,s.q=_c,s.r=rn,s.s=Pi,s.t=ln,s.u=Mi,s.v=ht,s.w=Xe,s.x=Ra,s.y=Jr,s.z=function(h){let[c,f,v]=h;return f+=90,f*=Math.PI/180,v*=Math.PI/180,{x:c*Math.cos(f)*Math.sin(v),y:c*Math.sin(f)*Math.sin(v),z:c*Math.cos(v)}}}),o(["./shared"],function(s){class g{constructor(ie){this.keyCache={},ie&&this.replace(ie)}replace(ie){this._layerConfigs={},this._layers={},this.update(ie,[])}update(ie,ce){for(const be of ie){this._layerConfigs[be.id]=be;const Ee=this._layers[be.id]=s.aC(be);Ee._featureFilter=s.a6(Ee.filter),this.keyCache[be.id]&&delete this.keyCache[be.id]}for(const be of ce)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const me=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const be of me){const Ee=be.map(_t=>this._layers[_t.id]),xe=Ee[0];if(xe.visibility==="none")continue;const Fe=xe.source||"";let Ue=this.familiesBySource[Fe];Ue||(Ue=this.familiesBySource[Fe]={});const je=xe.sourceLayer||"_geojsonTileLayer";let nt=Ue[je];nt||(nt=Ue[je]=[]),nt.push(Ee)}}}class b{constructor(ie){const ce={},me=[];for(const Fe in ie){const Ue=ie[Fe],je=ce[Fe]={};for(const nt in Ue){const _t=Ue[+nt];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const St={x:0,y:0,w:_t.bitmap.width+2,h:_t.bitmap.height+2};me.push(St),je[nt]={rect:St,metrics:_t.metrics}}}const{w:be,h:Ee}=s.p(me),xe=new s.q({width:be||1,height:Ee||1});for(const Fe in ie){const Ue=ie[Fe];for(const je in Ue){const nt=Ue[+je];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const _t=ce[Fe][je].rect;s.q.copy(nt.bitmap,xe,{x:0,y:0},{x:_t.x+1,y:_t.y+1},nt.bitmap)}}this.image=xe,this.positions=ce}}s.bm("GlyphAtlas",b);class S{constructor(ie){this.tileID=new s.O(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.uid=ie.uid,this.zoom=ie.zoom,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.returnDependencies=!!ie.returnDependencies,this.promoteId=ie.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(ie,ce,me,be,Ee){this.status="parsing",this.data=ie,this.collisionBoxArray=new s.a3;const xe=new s.bn(Object.keys(ie.layers).sort()),Fe=new s.bo(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Ue={},je={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},nt=ce.familiesBySource[this.source];for(const Ni in nt){const ot=ie.layers[Ni];if(!ot)continue;ot.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=xe.encode(Ni),Qt=[];for(let Qi=0;Qi<ot.length;Qi++){const Ar=ot.feature(Qi),on=Fe.getId(Ar,Ni);Qt.push({feature:Ar,id:on,index:Qi,sourceLayerIndex:ii})}for(const Qi of nt[Ni]){const Ar=Qi[0];Ar.source!==this.source&&s.w(`layer.source = ${Ar.source} does not equal this.source = ${this.source}`),Ar.minzoom&&this.zoom<Math.floor(Ar.minzoom)||Ar.maxzoom&&this.zoom>=Ar.maxzoom||Ar.visibility!=="none"&&(F(Qi,this.zoom,me),(Ue[Ar.id]=Ar.createBucket({index:Fe.bucketLayerIDs.length,layers:Qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source})).populate(Qt,je,this.tileID.canonical),Fe.bucketLayerIDs.push(Qi.map(on=>on.id)))}}let _t,St,ei,$t;const Wt=s.aH(je.glyphDependencies,Ni=>Object.keys(Ni).map(Number));this.inFlightDependencies.forEach(Ni=>Ni==null?void 0:Ni.cancel()),this.inFlightDependencies=[];const oi=++this.dependencySentinel;Object.keys(Wt).length?this.inFlightDependencies.push(be.send("getGlyphs",{uid:this.uid,stacks:Wt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ni,ot)=>{oi===this.dependencySentinel&&(_t||(_t=Ni,St=ot,Bi.call(this)))})):St={};const Ei=Object.keys(je.iconDependencies);Ei.length?this.inFlightDependencies.push(be.send("getImages",{icons:Ei,source:this.source,tileID:this.tileID,type:"icons"},(Ni,ot)=>{oi===this.dependencySentinel&&(_t||(_t=Ni,ei=ot,Bi.call(this)))})):ei={};const Gi=Object.keys(je.patternDependencies);function Bi(){if(_t)return Ee(_t);if(St&&ei&&$t){const Ni=new b(St),ot=new s.bp(ei,$t);for(const ii in Ue){const Qt=Ue[ii];Qt instanceof s.a4?(F(Qt.layers,this.zoom,me),s.bq({bucket:Qt,glyphMap:St,glyphPositions:Ni.positions,imageMap:ei,imagePositions:ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Qt.hasPattern&&(Qt instanceof s.br||Qt instanceof s.bs||Qt instanceof s.bt)&&(F(Qt.layers,this.zoom,me),Qt.addFeatures(je,this.tileID.canonical,ot.patternPositions))}this.status="done",Ee(null,{buckets:Object.values(Ue).filter(ii=>!ii.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ni.image,imageAtlas:ot,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?ei:null,glyphPositions:this.returnDependencies?Ni.positions:null})}}Gi.length?this.inFlightDependencies.push(be.send("getImages",{icons:Gi,source:this.source,tileID:this.tileID,type:"patterns"},(Ni,ot)=>{oi===this.dependencySentinel&&(_t||(_t=Ni,$t=ot,Bi.call(this)))})):$t={},Bi.call(this)}}function F(ae,ie,ce){const me=new s.a8(ie);for(const be of ae)be.recalculate(me,ce)}function D(ae,ie){const ce=s.l(ae.request,(me,be,Ee,xe)=>{if(me)ie(me);else if(be)try{const Fe=new s.bw.VectorTile(new s.bv(be));ie(null,{vectorTile:Fe,rawData:be,cacheControl:Ee,expires:xe})}catch(Fe){const Ue=new Uint8Array(be);let je=`Unable to parse the tile at ${ae.request.url}, `;je+=Ue[0]===31&&Ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Fe.messge}`,ie(new Error(je))}});return()=>{ce.cancel(),ie()}}class N{constructor(ie,ce,me,be){this.actor=ie,this.layerIndex=ce,this.availableImages=me,this.loadVectorData=be||D,this.fetching={},this.loading={},this.loaded={}}loadTile(ie,ce){const me=ie.uid;this.loading||(this.loading={});const be=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new s.bu(ie.request),Ee=this.loading[me]=new S(ie);Ee.abort=this.loadVectorData(ie,(xe,Fe)=>{if(delete this.loading[me],xe||!Fe)return Ee.status="done",this.loaded[me]=Ee,ce(xe);const Ue=Fe.rawData,je={};Fe.expires&&(je.expires=Fe.expires),Fe.cacheControl&&(je.cacheControl=Fe.cacheControl);const nt={};if(be){const _t=be.finish();_t&&(nt.resourceTiming=JSON.parse(JSON.stringify(_t)))}Ee.vectorTile=Fe.vectorTile,Ee.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(_t,St)=>{if(delete this.fetching[me],_t||!St)return ce(_t);ce(null,s.e({rawTileData:Ue.slice(0)},St,je,nt))}),this.loaded=this.loaded||{},this.loaded[me]=Ee,this.fetching[me]={rawTileData:Ue,cacheControl:je,resourceTiming:nt}})}reloadTile(ie,ce){const me=this.loaded,be=ie.uid;if(me&&me[be]){const Ee=me[be];Ee.showCollisionBoxes=ie.showCollisionBoxes,Ee.status==="parsing"?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,Fe)=>{if(xe||!Fe)return ce(xe,Fe);let Ue;if(this.fetching[be]){const{rawTileData:je,cacheControl:nt,resourceTiming:_t}=this.fetching[be];delete this.fetching[be],Ue=s.e({rawTileData:je.slice(0)},Fe,nt,_t)}else Ue=Fe;ce(null,Ue)}):Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}}abortTile(ie,ce){const me=this.loading,be=ie.uid;me&&me[be]&&me[be].abort&&(me[be].abort(),delete me[be]),ce()}removeTile(ie,ce){const me=this.loaded,be=ie.uid;me&&me[be]&&delete me[be],ce()}}class J{constructor(){this.loaded={}}loadTile(ie,ce){return s._(this,void 0,void 0,function*(){const{uid:me,encoding:be,rawImageData:Ee,redFactor:xe,greenFactor:Fe,blueFactor:Ue,baseShift:je}=ie,nt=Ee.width+2,_t=Ee.height+2,St=s.a(Ee)?new s.R({width:nt,height:_t},yield s.bx(Ee,-1,-1,nt,_t)):Ee,ei=new s.by(me,St,be,xe,Fe,Ue,je);this.loaded=this.loaded||{},this.loaded[me]=ei,ce(null,ei)})}removeTile(ie){const ce=this.loaded,me=ie.uid;ce&&ce[me]&&delete ce[me]}}function te(ae,ie){if(ae.length!==0){he(ae[0],ie);for(var ce=1;ce<ae.length;ce++)he(ae[ce],!ie)}}function he(ae,ie){for(var ce=0,me=0,be=0,Ee=ae.length,xe=Ee-1;be<Ee;xe=be++){var Fe=(ae[be][0]-ae[xe][0])*(ae[xe][1]+ae[be][1]),Ue=ce+Fe;me+=Math.abs(ce)>=Math.abs(Fe)?ce-Ue+Fe:Fe-Ue+ce,ce=Ue}ce+me>=0!=!!ie&&ae.reverse()}var ue=s.bz(function ae(ie,ce){var me,be=ie&&ie.type;if(be==="FeatureCollection")for(me=0;me<ie.features.length;me++)ae(ie.features[me],ce);else if(be==="GeometryCollection")for(me=0;me<ie.geometries.length;me++)ae(ie.geometries[me],ce);else if(be==="Feature")ae(ie.geometry,ce);else if(be==="Polygon")te(ie.coordinates,ce);else if(be==="MultiPolygon")for(me=0;me<ie.coordinates.length;me++)te(ie.coordinates[me],ce);return ie});const fe=s.bw.VectorTileFeature.prototype.toGeoJSON;var ve={exports:{}},Se=s.bA,Ge=s.bw.VectorTileFeature,He=$e;function $e(ae,ie){this.options=ie||{},this.features=ae,this.length=ae.length}function Ne(ae,ie){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=ie||4096}$e.prototype.feature=function(ae){return new Ne(this.features[ae],this.options.extent)},Ne.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var ie=0;ie<ae.length;ie++){for(var ce=ae[ie],me=[],be=0;be<ce.length;be++)me.push(new Se(ce[be][0],ce[be][1]));this.geometry.push(me)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,ie=1/0,ce=-1/0,me=1/0,be=-1/0,Ee=0;Ee<ae.length;Ee++)for(var xe=ae[Ee],Fe=0;Fe<xe.length;Fe++){var Ue=xe[Fe];ie=Math.min(ie,Ue.x),ce=Math.max(ce,Ue.x),me=Math.min(me,Ue.y),be=Math.max(be,Ue.y)}return[ie,me,ce,be]},Ne.prototype.toGeoJSON=Ge.prototype.toGeoJSON;var at=s.bB,rt=He;function Re(ae){var ie=new at;return function(ce,me){for(var be in ce.layers)me.writeMessage(3,Pe,ce.layers[be])}(ae,ie),ie.finish()}function Pe(ae,ie){var ce;ie.writeVarintField(15,ae.version||1),ie.writeStringField(1,ae.name||""),ie.writeVarintField(5,ae.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<ae.length;ce++)me.feature=ae.feature(ce),ie.writeMessage(2,Je,me);var be=me.keys;for(ce=0;ce<be.length;ce++)ie.writeStringField(3,be[ce]);var Ee=me.values;for(ce=0;ce<Ee.length;ce++)ie.writeMessage(4,vt,Ee[ce])}function Je(ae,ie){var ce=ae.feature;ce.id!==void 0&&ie.writeVarintField(1,ce.id),ie.writeMessage(2,Xe,ae),ie.writeVarintField(3,ce.type),ie.writeMessage(4,Mt,ce)}function Xe(ae,ie){var ce=ae.feature,me=ae.keys,be=ae.values,Ee=ae.keycache,xe=ae.valuecache;for(var Fe in ce.properties){var Ue=ce.properties[Fe],je=Ee[Fe];if(Ue!==null){je===void 0&&(me.push(Fe),Ee[Fe]=je=me.length-1),ie.writeVarint(je);var nt=typeof Ue;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Ue=JSON.stringify(Ue));var _t=nt+":"+Ue,St=xe[_t];St===void 0&&(be.push(Ue),xe[_t]=St=be.length-1),ie.writeVarint(St)}}}function Ct(ae,ie){return(ie<<3)+(7&ae)}function Et(ae){return ae<<1^ae>>31}function Mt(ae,ie){for(var ce=ae.loadGeometry(),me=ae.type,be=0,Ee=0,xe=ce.length,Fe=0;Fe<xe;Fe++){var Ue=ce[Fe],je=1;me===1&&(je=Ue.length),ie.writeVarint(Ct(1,je));for(var nt=me===3?Ue.length-1:Ue.length,_t=0;_t<nt;_t++){_t===1&&me!==1&&ie.writeVarint(Ct(2,nt-1));var St=Ue[_t].x-be,ei=Ue[_t].y-Ee;ie.writeVarint(Et(St)),ie.writeVarint(Et(ei)),be+=St,Ee+=ei}me===3&&ie.writeVarint(Ct(7,1))}}function vt(ae,ie){var ce=typeof ae;ce==="string"?ie.writeStringField(1,ae):ce==="boolean"?ie.writeBooleanField(7,ae):ce==="number"&&(ae%1!=0?ie.writeDoubleField(3,ae):ae<0?ie.writeSVarintField(6,ae):ie.writeVarintField(5,ae))}ve.exports=Re,ve.exports.fromVectorTileJs=Re,ve.exports.fromGeojsonVt=function(ae,ie){ie=ie||{};var ce={};for(var me in ae)ce[me]=new rt(ae[me].features,ie),ce[me].name=me,ce[me].version=ie.version,ce[me].extent=ie.extent;return Re({layers:ce})},ve.exports.GeoJSONWrapper=rt;var Dt=s.bz(ve.exports);const Pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},Xt=Math.fround||(Te=new Float32Array(1),ae=>(Te[0]=+ae,Te[0]));var Te;const Ze=3,tt=5,dt=6;class pt{constructor(ie){this.options=Object.assign(Object.create(Pt),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ce,minZoom:me,maxZoom:be}=this.options;ce&&console.time("total time");const Ee=`prepare ${ie.length} points`;ce&&console.time(Ee),this.points=ie;const xe=[];for(let Ue=0;Ue<ie.length;Ue++){const je=ie[Ue];if(!je.geometry)continue;const[nt,_t]=je.geometry.coordinates,St=Xt(Lt(nt)),ei=Xt(Gt(_t));xe.push(St,ei,1/0,Ue,-1,1),this.options.reduce&&xe.push(0)}let Fe=this.trees[be+1]=this._createTree(xe);ce&&console.timeEnd(Ee);for(let Ue=be;Ue>=me;Ue--){const je=+Date.now();Fe=this.trees[Ue]=this._createTree(this._cluster(Fe,Ue)),ce&&console.log("z%d: %d clusters in %dms",Ue,Fe.numItems,+Date.now()-je)}return ce&&console.timeEnd("total time"),this}getClusters(ie,ce){let me=((ie[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,ie[1]));let Ee=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)me=-180,Ee=180;else if(me>Ee){const _t=this.getClusters([me,be,180,xe],ce),St=this.getClusters([-180,be,Ee,xe],ce);return _t.concat(St)}const Fe=this.trees[this._limitZoom(ce)],Ue=Fe.range(Lt(me),Gt(xe),Lt(Ee),Gt(be)),je=Fe.data,nt=[];for(const _t of Ue){const St=this.stride*_t;nt.push(je[St+tt]>1?Bt(je,St,this.clusterProps):this.points[je[St+Ze]])}return nt}getChildren(ie){const ce=this._getOriginId(ie),me=this._getOriginZoom(ie),be="No cluster with the specified id.",Ee=this.trees[me];if(!Ee)throw new Error(be);const xe=Ee.data;if(ce*this.stride>=xe.length)throw new Error(be);const Fe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ue=Ee.within(xe[ce*this.stride],xe[ce*this.stride+1],Fe),je=[];for(const nt of Ue){const _t=nt*this.stride;xe[_t+4]===ie&&je.push(xe[_t+tt]>1?Bt(xe,_t,this.clusterProps):this.points[xe[_t+Ze]])}if(je.length===0)throw new Error(be);return je}getLeaves(ie,ce,me){const be=[];return this._appendLeaves(be,ie,ce=ce||10,me=me||0,0),be}getTile(ie,ce,me){const be=this.trees[this._limitZoom(ie)],Ee=Math.pow(2,ie),{extent:xe,radius:Fe}=this.options,Ue=Fe/xe,je=(me-Ue)/Ee,nt=(me+1+Ue)/Ee,_t={features:[]};return this._addTileFeatures(be.range((ce-Ue)/Ee,je,(ce+1+Ue)/Ee,nt),be.data,ce,me,Ee,_t),ce===0&&this._addTileFeatures(be.range(1-Ue/Ee,je,1,nt),be.data,Ee,me,Ee,_t),ce===Ee-1&&this._addTileFeatures(be.range(0,je,Ue/Ee,nt),be.data,-1,me,Ee,_t),_t.features.length?_t:null}getClusterExpansionZoom(ie){let ce=this._getOriginZoom(ie)-1;for(;ce<=this.options.maxZoom;){const me=this.getChildren(ie);if(ce++,me.length!==1)break;ie=me[0].properties.cluster_id}return ce}_appendLeaves(ie,ce,me,be,Ee){const xe=this.getChildren(ce);for(const Fe of xe){const Ue=Fe.properties;if(Ue&&Ue.cluster?Ee+Ue.point_count<=be?Ee+=Ue.point_count:Ee=this._appendLeaves(ie,Ue.cluster_id,me,be,Ee):Ee<be?Ee++:ie.push(Fe),ie.length===me)break}return Ee}_createTree(ie){const ce=new s.av(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<ie.length;me+=this.stride)ce.add(ie[me],ie[me+1]);return ce.finish(),ce.data=ie,ce}_addTileFeatures(ie,ce,me,be,Ee,xe){for(const Fe of ie){const Ue=Fe*this.stride,je=ce[Ue+tt]>1;let nt,_t,St;if(je)nt=Ft(ce,Ue,this.clusterProps),_t=ce[Ue],St=ce[Ue+1];else{const Wt=this.points[ce[Ue+Ze]];nt=Wt.properties;const[oi,Ei]=Wt.geometry.coordinates;_t=Lt(oi),St=Gt(Ei)}const ei={type:1,geometry:[[Math.round(this.options.extent*(_t*Ee-me)),Math.round(this.options.extent*(St*Ee-be))]],tags:nt};let $t;$t=je||this.options.generateId?ce[Ue+Ze]:this.points[ce[Ue+Ze]].id,$t!==void 0&&(ei.id=$t),xe.features.push(ei)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ce){const{radius:me,extent:be,reduce:Ee,minPoints:xe}=this.options,Fe=me/(be*Math.pow(2,ce)),Ue=ie.data,je=[],nt=this.stride;for(let _t=0;_t<Ue.length;_t+=nt){if(Ue[_t+2]<=ce)continue;Ue[_t+2]=ce;const St=Ue[_t],ei=Ue[_t+1],$t=ie.within(Ue[_t],Ue[_t+1],Fe),Wt=Ue[_t+tt];let oi=Wt;for(const Ei of $t){const Gi=Ei*nt;Ue[Gi+2]>ce&&(oi+=Ue[Gi+tt])}if(oi>Wt&&oi>=xe){let Ei,Gi=St*Wt,Bi=ei*Wt,Ni=-1;const ot=((_t/nt|0)<<5)+(ce+1)+this.points.length;for(const ii of $t){const Qt=ii*nt;if(Ue[Qt+2]<=ce)continue;Ue[Qt+2]=ce;const Qi=Ue[Qt+tt];Gi+=Ue[Qt]*Qi,Bi+=Ue[Qt+1]*Qi,Ue[Qt+4]=ot,Ee&&(Ei||(Ei=this._map(Ue,_t,!0),Ni=this.clusterProps.length,this.clusterProps.push(Ei)),Ee(Ei,this._map(Ue,Qt)))}Ue[_t+4]=ot,je.push(Gi/oi,Bi/oi,1/0,ot,-1,oi),Ee&&je.push(Ni)}else{for(let Ei=0;Ei<nt;Ei++)je.push(Ue[_t+Ei]);if(oi>1)for(const Ei of $t){const Gi=Ei*nt;if(!(Ue[Gi+2]<=ce)){Ue[Gi+2]=ce;for(let Bi=0;Bi<nt;Bi++)je.push(Ue[Gi+Bi])}}}}return je}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ce,me){if(ie[ce+tt]>1){const xe=this.clusterProps[ie[ce+dt]];return me?Object.assign({},xe):xe}const be=this.points[ie[ce+Ze]].properties,Ee=this.options.map(be);return me&&Ee===be?Object.assign({},Ee):Ee}}function Bt(ae,ie,ce){return{type:"Feature",id:ae[ie+Ze],properties:Ft(ae,ie,ce),geometry:{type:"Point",coordinates:[(me=ae[ie],360*(me-.5)),ri(ae[ie+1])]}};var me}function Ft(ae,ie,ce){const me=ae[ie+tt],be=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ee=ae[ie+dt],xe=Ee===-1?{}:Object.assign({},ce[Ee]);return Object.assign(xe,{cluster:!0,cluster_id:ae[ie+Ze],point_count:me,point_count_abbreviated:be})}function Lt(ae){return ae/360+.5}function Gt(ae){const ie=Math.sin(ae*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function ri(ae){const ie=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function mi(ae,ie,ce,me){for(var be,Ee=me,xe=ce-ie>>1,Fe=ce-ie,Ue=ae[ie],je=ae[ie+1],nt=ae[ce],_t=ae[ce+1],St=ie+3;St<ce;St+=3){var ei=yi(ae[St],ae[St+1],Ue,je,nt,_t);if(ei>Ee)be=St,Ee=ei;else if(ei===Ee){var $t=Math.abs(St-xe);$t<Fe&&(be=St,Fe=$t)}}Ee>me&&(be-ie>3&&mi(ae,ie,be,me),ae[be+2]=Ee,ce-be>3&&mi(ae,be,ce,me))}function yi(ae,ie,ce,me,be,Ee){var xe=be-ce,Fe=Ee-me;if(xe!==0||Fe!==0){var Ue=((ae-ce)*xe+(ie-me)*Fe)/(xe*xe+Fe*Fe);Ue>1?(ce=be,me=Ee):Ue>0&&(ce+=xe*Ue,me+=Fe*Ue)}return(xe=ae-ce)*xe+(Fe=ie-me)*Fe}function Pi(ae,ie,ce,me){var be={id:ae===void 0?null:ae,type:ie,geometry:ce,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var xe=Ee.geometry,Fe=Ee.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")Ot(Ee,xe);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var Ue=0;Ue<xe.length;Ue++)Ot(Ee,xe[Ue]);else if(Fe==="MultiPolygon")for(Ue=0;Ue<xe.length;Ue++)for(var je=0;je<xe[Ue].length;je++)Ot(Ee,xe[Ue][je])}(be),be}function Ot(ae,ie){for(var ce=0;ce<ie.length;ce+=3)ae.minX=Math.min(ae.minX,ie[ce]),ae.minY=Math.min(ae.minY,ie[ce+1]),ae.maxX=Math.max(ae.maxX,ie[ce]),ae.maxY=Math.max(ae.maxY,ie[ce+1])}function lt(ae,ie,ce,me){if(ie.geometry){var be=ie.geometry.coordinates,Ee=ie.geometry.type,xe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),Fe=[],Ue=ie.id;if(ce.promoteId?Ue=ie.properties[ce.promoteId]:ce.generateId&&(Ue=me||0),Ee==="Point")wt(be,Fe);else if(Ee==="MultiPoint")for(var je=0;je<be.length;je++)wt(be[je],Fe);else if(Ee==="LineString")ki(be,Fe,xe,!1);else if(Ee==="MultiLineString"){if(ce.lineMetrics){for(je=0;je<be.length;je++)ki(be[je],Fe=[],xe,!1),ae.push(Pi(Ue,"LineString",Fe,ie.properties));return}ti(be,Fe,xe,!1)}else if(Ee==="Polygon")ti(be,Fe,xe,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(je=0;je<ie.geometry.geometries.length;je++)lt(ae,{id:Ue,geometry:ie.geometry.geometries[je],properties:ie.properties},ce,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(je=0;je<be.length;je++){var nt=[];ti(be[je],nt,xe,!0),Fe.push(nt)}}ae.push(Pi(Ue,Ee,Fe,ie.properties))}}function wt(ae,ie){ie.push(ht(ae[0])),ie.push(qt(ae[1])),ie.push(0)}function ki(ae,ie,ce,me){for(var be,Ee,xe=0,Fe=0;Fe<ae.length;Fe++){var Ue=ht(ae[Fe][0]),je=qt(ae[Fe][1]);ie.push(Ue),ie.push(je),ie.push(0),Fe>0&&(xe+=me?(be*je-Ue*Ee)/2:Math.sqrt(Math.pow(Ue-be,2)+Math.pow(je-Ee,2))),be=Ue,Ee=je}var nt=ie.length-3;ie[2]=1,mi(ie,0,nt,ce),ie[nt+2]=1,ie.size=Math.abs(xe),ie.start=0,ie.end=ie.size}function ti(ae,ie,ce,me){for(var be=0;be<ae.length;be++){var Ee=[];ki(ae[be],Ee,ce,me),ie.push(Ee)}}function ht(ae){return ae/360+.5}function qt(ae){var ie=Math.sin(ae*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function si(ae,ie,ce,me,be,Ee,xe,Fe){if(me/=ie,Ee>=(ce/=ie)&&xe<me)return ae;if(xe<ce||Ee>=me)return null;for(var Ue=[],je=0;je<ae.length;je++){var nt=ae[je],_t=nt.geometry,St=nt.type,ei=be===0?nt.minX:nt.minY,$t=be===0?nt.maxX:nt.maxY;if(ei>=ce&&$t<me)Ue.push(nt);else if(!($t<ce||ei>=me)){var Wt=[];if(St==="Point"||St==="MultiPoint")fi(_t,Wt,ce,me,be);else if(St==="LineString")ci(_t,Wt,ce,me,be,!1,Fe.lineMetrics);else if(St==="MultiLineString")ir(_t,Wt,ce,me,be,!1);else if(St==="Polygon")ir(_t,Wt,ce,me,be,!0);else if(St==="MultiPolygon")for(var oi=0;oi<_t.length;oi++){var Ei=[];ir(_t[oi],Ei,ce,me,be,!0),Ei.length&&Wt.push(Ei)}if(Wt.length){if(Fe.lineMetrics&&St==="LineString"){for(oi=0;oi<Wt.length;oi++)Ue.push(Pi(nt.id,St,Wt[oi],nt.tags));continue}St!=="LineString"&&St!=="MultiLineString"||(Wt.length===1?(St="LineString",Wt=Wt[0]):St="MultiLineString"),St!=="Point"&&St!=="MultiPoint"||(St=Wt.length===3?"Point":"MultiPoint"),Ue.push(Pi(nt.id,St,Wt,nt.tags))}}}return Ue.length?Ue:null}function fi(ae,ie,ce,me,be){for(var Ee=0;Ee<ae.length;Ee+=3){var xe=ae[Ee+be];xe>=ce&&xe<=me&&(ie.push(ae[Ee]),ie.push(ae[Ee+1]),ie.push(ae[Ee+2]))}}function ci(ae,ie,ce,me,be,Ee,xe){for(var Fe,Ue,je=Wi(ae),nt=be===0?Sr:zt,_t=ae.start,St=0;St<ae.length-3;St+=3){var ei=ae[St],$t=ae[St+1],Wt=ae[St+2],oi=ae[St+3],Ei=ae[St+4],Gi=be===0?ei:$t,Bi=be===0?oi:Ei,Ni=!1;xe&&(Fe=Math.sqrt(Math.pow(ei-oi,2)+Math.pow($t-Ei,2))),Gi<ce?Bi>ce&&(Ue=nt(je,ei,$t,oi,Ei,ce),xe&&(je.start=_t+Fe*Ue)):Gi>me?Bi<me&&(Ue=nt(je,ei,$t,oi,Ei,me),xe&&(je.start=_t+Fe*Ue)):dr(je,ei,$t,Wt),Bi<ce&&Gi>=ce&&(Ue=nt(je,ei,$t,oi,Ei,ce),Ni=!0),Bi>me&&Gi<=me&&(Ue=nt(je,ei,$t,oi,Ei,me),Ni=!0),!Ee&&Ni&&(xe&&(je.end=_t+Fe*Ue),ie.push(je),je=Wi(ae)),xe&&(_t+=Fe)}var ot=ae.length-3;ei=ae[ot],$t=ae[ot+1],Wt=ae[ot+2],(Gi=be===0?ei:$t)>=ce&&Gi<=me&&dr(je,ei,$t,Wt),ot=je.length-3,Ee&&ot>=3&&(je[ot]!==je[0]||je[ot+1]!==je[1])&&dr(je,je[0],je[1],je[2]),je.length&&ie.push(je)}function Wi(ae){var ie=[];return ie.size=ae.size,ie.start=ae.start,ie.end=ae.end,ie}function ir(ae,ie,ce,me,be,Ee){for(var xe=0;xe<ae.length;xe++)ci(ae[xe],ie,ce,me,be,Ee,!1)}function dr(ae,ie,ce,me){ae.push(ie),ae.push(ce),ae.push(me)}function Sr(ae,ie,ce,me,be,Ee){var xe=(Ee-ie)/(me-ie);return ae.push(Ee),ae.push(ce+(be-ce)*xe),ae.push(1),xe}function zt(ae,ie,ce,me,be,Ee){var xe=(Ee-ce)/(be-ce);return ae.push(ie+(me-ie)*xe),ae.push(Ee),ae.push(1),xe}function Yi(ae,ie){for(var ce=[],me=0;me<ae.length;me++){var be,Ee=ae[me],xe=Ee.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")be=ui(Ee.geometry,ie);else if(xe==="MultiLineString"||xe==="Polygon"){be=[];for(var Fe=0;Fe<Ee.geometry.length;Fe++)be.push(ui(Ee.geometry[Fe],ie))}else if(xe==="MultiPolygon")for(be=[],Fe=0;Fe<Ee.geometry.length;Fe++){for(var Ue=[],je=0;je<Ee.geometry[Fe].length;je++)Ue.push(ui(Ee.geometry[Fe][je],ie));be.push(Ue)}ce.push(Pi(Ee.id,xe,be,Ee.tags))}return ce}function ui(ae,ie){var ce=[];ce.size=ae.size,ae.start!==void 0&&(ce.start=ae.start,ce.end=ae.end);for(var me=0;me<ae.length;me+=3)ce.push(ae[me]+ie,ae[me+1],ae[me+2]);return ce}function Kt(ae,ie){if(ae.transformed)return ae;var ce,me,be,Ee=1<<ae.z,xe=ae.x,Fe=ae.y;for(ce=0;ce<ae.features.length;ce++){var Ue=ae.features[ce],je=Ue.geometry,nt=Ue.type;if(Ue.geometry=[],nt===1)for(me=0;me<je.length;me+=2)Ue.geometry.push(Ji(je[me],je[me+1],ie,Ee,xe,Fe));else for(me=0;me<je.length;me++){var _t=[];for(be=0;be<je[me].length;be+=2)_t.push(Ji(je[me][be],je[me][be+1],ie,Ee,xe,Fe));Ue.geometry.push(_t)}}return ae.transformed=!0,ae}function Ji(ae,ie,ce,me,be,Ee){return[Math.round(ce*(ae*me-be)),Math.round(ce*(ie*me-Ee))]}function Vt(ae,ie,ce,me,be){for(var Ee=ie===be.maxZoom?0:be.tolerance/((1<<ie)*be.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:me,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<ae.length;Fe++){xe.numFeatures++,Ci(xe,ae[Fe],Ee,be);var Ue=ae[Fe].minX,je=ae[Fe].minY,nt=ae[Fe].maxX,_t=ae[Fe].maxY;Ue<xe.minX&&(xe.minX=Ue),je<xe.minY&&(xe.minY=je),nt>xe.maxX&&(xe.maxX=nt),_t>xe.maxY&&(xe.maxY=_t)}return xe}function Ci(ae,ie,ce,me){var be=ie.geometry,Ee=ie.type,xe=[];if(Ee==="Point"||Ee==="MultiPoint")for(var Fe=0;Fe<be.length;Fe+=3)xe.push(be[Fe]),xe.push(be[Fe+1]),ae.numPoints++,ae.numSimplified++;else if(Ee==="LineString")Li(xe,be,ae,ce,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(Fe=0;Fe<be.length;Fe++)Li(xe,be[Fe],ae,ce,Ee==="Polygon",Fe===0);else if(Ee==="MultiPolygon")for(var Ue=0;Ue<be.length;Ue++){var je=be[Ue];for(Fe=0;Fe<je.length;Fe++)Li(xe,je[Fe],ae,ce,!0,Fe===0)}if(xe.length){var nt=ie.tags||null;if(Ee==="LineString"&&me.lineMetrics){for(var _t in nt={},ie.tags)nt[_t]=ie.tags[_t];nt.mapbox_clip_start=be.start/be.size,nt.mapbox_clip_end=be.end/be.size}var St={geometry:xe,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:nt};ie.id!==null&&(St.id=ie.id),ae.features.push(St)}}function Li(ae,ie,ce,me,be,Ee){var xe=me*me;if(me>0&&ie.size<(be?xe:me))ce.numPoints+=ie.length/3;else{for(var Fe=[],Ue=0;Ue<ie.length;Ue+=3)(me===0||ie[Ue+2]>xe)&&(ce.numSimplified++,Fe.push(ie[Ue]),Fe.push(ie[Ue+1])),ce.numPoints++;be&&function(je,nt){for(var _t=0,St=0,ei=je.length,$t=ei-2;St<ei;$t=St,St+=2)_t+=(je[St]-je[$t])*(je[St+1]+je[$t+1]);if(_t>0===nt)for(St=0,ei=je.length;St<ei/2;St+=2){var Wt=je[St],oi=je[St+1];je[St]=je[ei-2-St],je[St+1]=je[ei-1-St],je[ei-2-St]=Wt,je[ei-1-St]=oi}}(Fe,Ee),ae.push(Fe)}}function jt(ae,ie){var ce=(ie=this.options=function(be,Ee){for(var xe in Ee)be[xe]=Ee[xe];return be}(Object.create(this.options),ie)).debug;if(ce&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var me=function(be,Ee){var xe=[];if(be.type==="FeatureCollection")for(var Fe=0;Fe<be.features.length;Fe++)lt(xe,be.features[Fe],Ee,Fe);else lt(xe,be.type==="Feature"?be:{geometry:be},Ee);return xe}(ae,ie);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=function(be,Ee){var xe=Ee.buffer/Ee.extent,Fe=be,Ue=si(be,1,-1-xe,xe,0,-1,2,Ee),je=si(be,1,1-xe,2+xe,0,-1,2,Ee);return(Ue||je)&&(Fe=si(be,1,-xe,1+xe,0,-1,2,Ee)||[],Ue&&(Fe=Yi(Ue,1).concat(Fe)),je&&(Fe=Fe.concat(Yi(je,-1)))),Fe}(me,ie),me.length&&this.splitTile(me,0,0,0),ce&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bi(ae,ie,ce){return 32*((1<<ae)*ce+ie)+ae}function Yt(ae,ie){return ie?ae.properties[ie]:ae.id}function yr(ae,ie){if(ae==null)return!0;if(ae.type==="Feature")return Yt(ae,ie)!=null;if(ae.type==="FeatureCollection"){const ce=new Set;for(const me of ae.features){const be=Yt(me,ie);if(be==null||ce.has(be))return!1;ce.add(be)}return!0}return!1}function Tr(ae,ie){const ce=new Map;if(ae!=null)if(ae.type==="Feature")ce.set(Yt(ae,ie),ae);else for(const me of ae.features)ce.set(Yt(me,ie),me);return ce}jt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jt.prototype.splitTile=function(ae,ie,ce,me,be,Ee,xe){for(var Fe=[ae,ie,ce,me],Ue=this.options,je=Ue.debug;Fe.length;){me=Fe.pop(),ce=Fe.pop(),ie=Fe.pop(),ae=Fe.pop();var nt=1<<ie,_t=bi(ie,ce,me),St=this.tiles[_t];if(!St&&(je>1&&console.time("creation"),St=this.tiles[_t]=Vt(ae,ie,ce,me,Ue),this.tileCoords.push({z:ie,x:ce,y:me}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ce,me,St.numFeatures,St.numPoints,St.numSimplified),console.timeEnd("creation"));var ei="z"+ie;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(St.source=ae,be){if(ie===Ue.maxZoom||ie===be)continue;var $t=1<<be-ie;if(ce!==Math.floor(Ee/$t)||me!==Math.floor(xe/$t))continue}else if(ie===Ue.indexMaxZoom||St.numPoints<=Ue.indexMaxPoints)continue;if(St.source=null,ae.length!==0){je>1&&console.time("clipping");var Wt,oi,Ei,Gi,Bi,Ni,ot=.5*Ue.buffer/Ue.extent,ii=.5-ot,Qt=.5+ot,Qi=1+ot;Wt=oi=Ei=Gi=null,Bi=si(ae,nt,ce-ot,ce+Qt,0,St.minX,St.maxX,Ue),Ni=si(ae,nt,ce+ii,ce+Qi,0,St.minX,St.maxX,Ue),ae=null,Bi&&(Wt=si(Bi,nt,me-ot,me+Qt,1,St.minY,St.maxY,Ue),oi=si(Bi,nt,me+ii,me+Qi,1,St.minY,St.maxY,Ue),Bi=null),Ni&&(Ei=si(Ni,nt,me-ot,me+Qt,1,St.minY,St.maxY,Ue),Gi=si(Ni,nt,me+ii,me+Qi,1,St.minY,St.maxY,Ue),Ni=null),je>1&&console.timeEnd("clipping"),Fe.push(Wt||[],ie+1,2*ce,2*me),Fe.push(oi||[],ie+1,2*ce,2*me+1),Fe.push(Ei||[],ie+1,2*ce+1,2*me),Fe.push(Gi||[],ie+1,2*ce+1,2*me+1)}}},jt.prototype.getTile=function(ae,ie,ce){var me=this.options,be=me.extent,Ee=me.debug;if(ae<0||ae>24)return null;var xe=1<<ae,Fe=bi(ae,ie=(ie%xe+xe)%xe,ce);if(this.tiles[Fe])return Kt(this.tiles[Fe],be);Ee>1&&console.log("drilling down to z%d-%d-%d",ae,ie,ce);for(var Ue,je=ae,nt=ie,_t=ce;!Ue&&je>0;)je--,nt=Math.floor(nt/2),_t=Math.floor(_t/2),Ue=this.tiles[bi(je,nt,_t)];return Ue&&Ue.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",je,nt,_t),Ee>1&&console.time("drilling down"),this.splitTile(Ue.source,je,nt,_t,ae,ie,ce),Ee>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Kt(this.tiles[Fe],be):null):null};class Qe extends N{constructor(ie,ce,me,be){super(ie,ce,me),this._dataUpdateable=new Map,this.loadGeoJSON=(Ee,xe)=>{const{promoteId:Fe}=Ee;if(Ee.request)return s.f(Ee.request,(Ue,je,nt,_t)=>{this._dataUpdateable=yr(je,Fe)?Tr(je,Fe):void 0,xe(Ue,je,nt,_t)});if(typeof Ee.data=="string")try{const Ue=JSON.parse(Ee.data);this._dataUpdateable=yr(Ue,Fe)?Tr(Ue,Fe):void 0,xe(null,Ue)}catch{xe(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}else Ee.dataDiff?this._dataUpdateable?(function(Ue,je,nt){var _t,St,ei,$t;if(je.removeAll&&Ue.clear(),je.remove)for(const Wt of je.remove)Ue.delete(Wt);if(je.add)for(const Wt of je.add){const oi=Yt(Wt,nt);oi!=null&&Ue.set(oi,Wt)}if(je.update)for(const Wt of je.update){let oi=Ue.get(Wt.id);if(oi==null)continue;const Ei=!Wt.removeAllProperties&&(((_t=Wt.removeProperties)===null||_t===void 0?void 0:_t.length)>0||((St=Wt.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0);if((Wt.newGeometry||Wt.removeAllProperties||Ei)&&(oi=Object.assign({},oi),Ue.set(Wt.id,oi),Ei&&(oi.properties=Object.assign({},oi.properties))),Wt.newGeometry&&(oi.geometry=Wt.newGeometry),Wt.removeAllProperties)oi.properties={};else if(((ei=Wt.removeProperties)===null||ei===void 0?void 0:ei.length)>0)for(const Gi of Wt.removeProperties)Object.prototype.hasOwnProperty.call(oi.properties,Gi)&&delete oi.properties[Gi];if((($t=Wt.addOrUpdateProperties)===null||$t===void 0?void 0:$t.length)>0)for(const{key:Gi,value:Bi}of Wt.addOrUpdateProperties)oi.properties[Gi]=Bi}}(this._dataUpdateable,Ee.dataDiff,Fe),xe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):xe(new Error(`Cannot update existing geojson data in ${Ee.source}`)):xe(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,be&&(this.loadGeoJSON=be)}loadGeoJSONTile(ie,ce){const me=ie.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);const be=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!be)return ce(null,null);const Ee=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(Ue){this._feature=Ue,this.extent=s.N,this.type=Ue.type,this.properties=Ue.tags,"id"in Ue&&!isNaN(Ue.id)&&(this.id=parseInt(Ue.id,10))}loadGeometry(){if(this._feature.type===1){const Ue=[];for(const je of this._feature.geometry)Ue.push([new s.P(je[0],je[1])]);return Ue}{const Ue=[];for(const je of this._feature.geometry){const nt=[];for(const _t of je)nt.push(new s.P(_t[0],_t[1]));Ue.push(nt)}return Ue}}toGeoJSON(Ue,je,nt){return fe.call(this,Ue,je,nt)}}(this._features[Fe])}}(be.features);let xe=Dt(Ee);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),ce(null,{vectorTile:Ee,rawData:xe.buffer})}loadData(ie,ce){var me;(me=this._pendingRequest)===null||me===void 0||me.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const be=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new s.bu(ie.request);this._pendingCallback=ce,this._pendingRequest=this.loadGeoJSON(ie,(Ee,xe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ee||!xe)return ce(Ee);if(typeof xe!="object")return ce(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{ue(xe,!0);try{if(ie.filter){const Ue=s.bC(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));xe={type:"FeatureCollection",features:xe.features.filter(nt=>Ue.value.evaluate({zoom:0},nt))}}this._geoJSONIndex=ie.cluster?new pt(function(Ue){let{superclusterOptions:je,clusterProperties:nt}=Ue;if(!nt||!je)return je;const _t={},St={},ei={accumulated:null,zoom:0},$t={properties:null},Wt=Object.keys(nt);for(const oi of Wt){const[Ei,Gi]=nt[oi],Bi=s.bC(Gi),Ni=s.bC(typeof Ei=="string"?[Ei,["accumulated"],["get",oi]]:Ei);_t[oi]=Bi.value,St[oi]=Ni.value}return je.map=oi=>{$t.properties=oi;const Ei={};for(const Gi of Wt)Ei[Gi]=_t[Gi].evaluate(ei,$t);return Ei},je.reduce=(oi,Ei)=>{$t.properties=Ei;for(const Gi of Wt)ei.accumulated=oi[Gi],oi[Gi]=St[Gi].evaluate(ei,$t)},je}(ie)).load(xe.features):function(Ue,je){return new jt(Ue,je)}(xe,ie.geojsonVtOptions)}catch(Ue){return ce(Ue)}this.loaded={};const Fe={};if(be){const Ue=be.finish();Ue&&(Fe.resourceTiming={},Fe.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Ue)))}ce(null,Fe)}})}reloadTile(ie,ce){const me=this.loaded;return me&&me[ie.uid]?super.reloadTile(ie,ce):this.loadTile(ie,ce)}removeSource(ie,ce){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ce()}getClusterExpansionZoom(ie,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(me){ce(me)}}getClusterChildren(ie,ce){try{ce(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(me){ce(me)}}getClusterLeaves(ie,ce){try{ce(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(me){ce(me)}}}class Be{constructor(ie){this.self=ie,this.actor=new s.C(ie,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:N,geojson:Qe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ce,me)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=me},this.self.registerRTLTextPlugin=ce=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=ce.applyArabicShaping,s.bD.processBidirectionalText=ce.processBidirectionalText,s.bD.processStyledBidirectionalText=ce.processStyledBidirectionalText}}setReferrer(ie,ce){this.referrer=ce}setImages(ie,ce,me){this.availableImages[ie]=ce;for(const be in this.workerSources[ie]){const Ee=this.workerSources[ie][be];for(const xe in Ee)Ee[xe].availableImages=ce}me()}setLayers(ie,ce,me){this.getLayerIndex(ie).replace(ce),me()}updateLayers(ie,ce,me){this.getLayerIndex(ie).update(ce.layers,ce.removedIds),me()}loadTile(ie,ce,me){this.getWorkerSource(ie,ce.type,ce.source).loadTile(ce,me)}loadDEMTile(ie,ce,me){this.getDEMWorkerSource(ie,ce.source).loadTile(ce,me)}reloadTile(ie,ce,me){this.getWorkerSource(ie,ce.type,ce.source).reloadTile(ce,me)}abortTile(ie,ce,me){this.getWorkerSource(ie,ce.type,ce.source).abortTile(ce,me)}removeTile(ie,ce,me){this.getWorkerSource(ie,ce.type,ce.source).removeTile(ce,me)}removeDEMTile(ie,ce){this.getDEMWorkerSource(ie,ce.source).removeTile(ce)}removeSource(ie,ce,me){if(!this.workerSources[ie]||!this.workerSources[ie][ce.type]||!this.workerSources[ie][ce.type][ce.source])return;const be=this.workerSources[ie][ce.type][ce.source];delete this.workerSources[ie][ce.type][ce.source],be.removeSource!==void 0?be.removeSource(ce,me):me()}loadWorkerSource(ie,ce,me){try{this.self.importScripts(ce.url),me()}catch(be){me(be.toString())}}syncRTLPluginState(ie,ce,me){try{s.bD.setState(ce);const be=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&be!=null){this.self.importScripts(be);const Ee=s.bD.isParsed();me(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),Ee)}}catch(be){me(be.toString())}}getAvailableImages(ie){let ce=this.availableImages[ie];return ce||(ce=[]),ce}getLayerIndex(ie){let ce=this.layerIndexes[ie];return ce||(ce=this.layerIndexes[ie]=new g),ce}getWorkerSource(ie,ce,me){return this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][ce]||(this.workerSources[ie][ce]={}),this.workerSources[ie][ce][me]||(this.workerSources[ie][ce][me]=new this.workerSourceTypes[ce]({send:(be,Ee,xe)=>{this.actor.send(be,Ee,xe,ie)}},this.getLayerIndex(ie),this.getAvailableImages(ie))),this.workerSources[ie][ce][me]}getDEMWorkerSource(ie,ce){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][ce]||(this.demWorkerSources[ie][ce]=new J),this.demWorkerSources[ie][ce]}}return s.i()&&(self.worker=new Be(self)),Be}),o(["./shared"],function(s){var g="3.6.2";class b{static testProp(A){if(!b.docStyle)return A[0];for(let x=0;x<A.length;x++)if(A[x]in b.docStyle)return A[x];return A[0]}static create(A,x,L){const O=window.document.createElement(A);return x!==void 0&&(O.className=x),L&&L.appendChild(O),O}static createNS(A,x){return window.document.createElementNS(A,x)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(A,x){A.style[b.transformProp]=x}static addEventListener(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.addEventListener(x,L,"passive"in O?O:O.capture)}static removeEventListener(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.removeEventListener(x,L,"passive"in O?O:O.capture)}static suppressClickInternal(A){A.preventDefault(),A.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static mousePos(A,x){const L=A.getBoundingClientRect();return new s.P(x.clientX-L.left-A.clientLeft,x.clientY-L.top-A.clientTop)}static touchPos(A,x){const L=A.getBoundingClientRect(),O=[];for(let y=0;y<x.length;y++)O.push(new s.P(x[y].clientX-L.left-A.clientLeft,x[y].clientY-L.top-A.clientTop));return O}static mouseButton(A){return A.button}static remove(A){A.parentNode&&A.parentNode.removeChild(A)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(z){!N&&D&&(J?te(z):F=z)}};let F,D,N=!1,J=!1;function te(z){const A=z.createTexture();z.bindTexture(z.TEXTURE_2D,A);try{if(z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,D),z.isContextLost())return;S.supported=!0}catch{}z.deleteTexture(A),N=!0}var he,ue;typeof document<"u"&&(D=document.createElement("img"),D.onload=function(){F&&te(F),F=null,J=!0},D.onerror=function(){N=!0,F=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(z){let A,x,L,O;z.resetRequestQueue=()=>{A=[],x=0,L=0,O={}},z.addThrottleControl=B=>{const T=L++;return O[T]=B,T},z.removeThrottleControl=B=>{delete O[B],d()},z.getImage=function(B,T){let U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;S.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*");const H={requestParameters:B,supportImageRefresh:U,callback:T,cancelled:!1,completed:!1,cancel:()=>{H.completed||H.cancelled||(H.cancelled=!0,H.innerRequest&&(H.innerRequest.cancel(),x--),d())}};return A.push(H),d(),H};const y=B=>{const{requestParameters:T,supportImageRefresh:U,callback:H}=B;return s.e(T,{type:"image"}),(U!==!1||s.i()||s.g(T.url)||T.headers&&!Object.keys(T.headers).reduce((q,w)=>q&&w==="accept",!0)?s.m:_)(T,(q,w,I,k)=>{a(B,H,q,w,I,k)})},a=(B,T,U,H,q,w)=>{U?T(U):H instanceof HTMLImageElement||s.a(H)?T(null,H):H&&((I,k)=>{typeof createImageBitmap=="function"?s.b(I,k):s.d(I,k)})(H,(I,k)=>{I!=null?T(I):k!=null&&T(null,k,{cacheControl:q,expires:w})}),B.cancelled||(B.completed=!0,x--,d())},d=()=>{const B=(()=>{const T=Object.keys(O);let U=!1;if(T.length>0){for(const H of T)if(U=O[H](),U)break}return U})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let T=x;T<B&&A.length>0;T++){const U=A.shift();if(U.cancelled){T--;continue}const H=y(U);x++,U.innerRequest=H}},_=(B,T)=>{const U=new Image,H=B.url;let q=!1;const w=B.credentials;return w&&w==="include"?U.crossOrigin="use-credentials":(w&&w==="same-origin"||!s.s(H))&&(U.crossOrigin="anonymous"),U.fetchPriority="high",U.onload=()=>{T(null,U),U.onerror=U.onload=null},U.onerror=()=>{q||T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),U.onerror=U.onload=null},U.src=H,{cancel:()=>{q=!0,U.src=""}}}}(he||(he={})),he.resetRequestQueue(),function(z){z.Glyphs="Glyphs",z.Image="Image",z.Source="Source",z.SpriteImage="SpriteImage",z.SpriteJSON="SpriteJSON",z.Style="Style",z.Tile="Tile",z.Unknown="Unknown"}(ue||(ue={}));class fe{constructor(A){this._transformRequestFn=A}transformRequest(A,x){return this._transformRequestFn&&this._transformRequestFn(A,x)||{url:A}}normalizeSpriteURL(A,x,L){const O=function(y){const a=y.match(ve);if(!a)throw new Error(`Unable to parse URL "${y}"`);return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}(A);return O.path+=`${x}${L}`,function(y){const a=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${a}`}(O)}setTransformRequest(A){this._transformRequestFn=A}}const ve=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Se(z){var A=new s.A(3);return A[0]=z[0],A[1]=z[1],A[2]=z[2],A}var Ge,He=function(z,A,x){return z[0]=A[0]-x[0],z[1]=A[1]-x[1],z[2]=A[2]-x[2],z};Ge=new s.A(3),s.A!=Float32Array&&(Ge[0]=0,Ge[1]=0,Ge[2]=0);var $e=function(z){var A=z[0],x=z[1];return A*A+x*x};function Ne(z){const A=[];if(typeof z=="string")A.push({id:"default",url:z});else if(z&&z.length>0){const x=[];for(const{id:L,url:O}of z){const y=`${L}${O}`;x.indexOf(y)===-1&&(x.push(y),A.push({id:L,url:O}))}}return A}function at(z,A,x,L,O){if(L)return void z(L);if(O!==Object.values(A).length||O!==Object.values(x).length)return;const y={};for(const a in A){y[a]={};const d=s.h.getImageCanvasContext(x[a]),_=A[a];for(const B in _){const{width:T,height:U,x:H,y:q,sdf:w,pixelRatio:I,stretchX:k,stretchY:j,content:Y}=_[B];y[a][B]={data:null,pixelRatio:I,sdf:w,stretchX:k,stretchY:j,content:Y,spriteData:{width:T,height:U,x:H,y:q,context:d}}}}z(null,y)}(function(){var z=new s.A(2);s.A!=Float32Array&&(z[0]=0,z[1]=0)})();class rt{constructor(A,x,L,O){this.context=A,this.format=L,this.texture=A.gl.createTexture(),this.update(x,O)}update(A,x,L){const{width:O,height:y}=A,a=!(this.size&&this.size[0]===O&&this.size[1]===y||L),{context:d}=this,{gl:_}=d;if(this.useMipmap=!!(x&&x.useMipmap),_.bindTexture(_.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!x||x.premultiply!==!1)),a)this.size=[O,y],A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,A):_.texImage2D(_.TEXTURE_2D,0,this.format,O,y,0,this.format,_.UNSIGNED_BYTE,A.data);else{const{x:B,y:T}=L||{x:0,y:0};A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texSubImage2D(_.TEXTURE_2D,0,B,T,_.RGBA,_.UNSIGNED_BYTE,A):_.texSubImage2D(_.TEXTURE_2D,0,B,T,O,y,_.RGBA,_.UNSIGNED_BYTE,A.data)}this.useMipmap&&this.isSizePowerOfTwo()&&_.generateMipmap(_.TEXTURE_2D)}bind(A,x,L){const{context:O}=this,{gl:y}=O;y.bindTexture(y.TEXTURE_2D,this.texture),L!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(L=y.LINEAR),A!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,A),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,L||A),this.filter=A),x!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:A}=this.context;A.deleteTexture(this.texture),this.texture=null}}function Re(z){const{userImage:A}=z;return!!(A&&A.render&&A.render())&&(z.data.replace(new Uint8Array(A.data.buffer)),!0)}class Pe extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(A){if(this.loaded!==A&&(this.loaded=A,A)){for(const{ids:x,callback:L}of this.requestors)this._notify(x,L);this.requestors=[]}}getImage(A){const x=this.images[A];if(x&&!x.data&&x.spriteData){const L=x.spriteData;x.data=new s.R({width:L.width,height:L.height},L.context.getImageData(L.x,L.y,L.width,L.height).data),x.spriteData=null}return x}addImage(A,x){if(this.images[A])throw new Error(`Image id ${A} already exist, use updateImage instead`);this._validate(A,x)&&(this.images[A]=x)}_validate(A,x){let L=!0;const O=x.data||x.spriteData;return this._validateStretch(x.stretchX,O&&O.width)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchX" value`))),L=!1),this._validateStretch(x.stretchY,O&&O.height)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchY" value`))),L=!1),this._validateContent(x.content,x)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "content" value`))),L=!1),L}_validateStretch(A,x){if(!A)return!0;let L=0;for(const O of A){if(O[0]<L||O[1]<O[0]||x<O[1])return!1;L=O[1]}return!0}_validateContent(A,x){if(!A)return!0;if(A.length!==4)return!1;const L=x.spriteData,O=L&&L.width||x.data.width,y=L&&L.height||x.data.height;return!(A[0]<0||O<A[0]||A[1]<0||y<A[1]||A[2]<0||O<A[2]||A[3]<0||y<A[3]||A[2]<A[0]||A[3]<A[1])}updateImage(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const O=this.getImage(A);if(L&&(O.data.width!==x.data.width||O.data.height!==x.data.height))throw new Error(`size mismatch between old image (${O.data.width}x${O.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=O.version+1,this.images[A]=x,this.updatedImages[A]=!0}removeImage(A){const x=this.images[A];delete this.images[A],delete this.patterns[A],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(A,x){let L=!0;if(!this.isLoaded())for(const O of A)this.images[O]||(L=!1);this.isLoaded()||L?this._notify(A,x):this.requestors.push({ids:A,callback:x})}_notify(A,x){const L={};for(const O of A){let y=this.getImage(O);y||(this.fire(new s.k("styleimagemissing",{id:O})),y=this.getImage(O)),y?L[O]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:s.w(`Image "${O}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,L)}getPixelSize(){const{width:A,height:x}=this.atlasImage;return{width:A,height:x}}getPattern(A){const x=this.patterns[A],L=this.getImage(A);if(!L)return null;if(x&&x.position.version===L.version)return x.position;if(x)x.position.version=L.version;else{const O={w:L.data.width+2,h:L.data.height+2,x:0,y:0},y=new s.I(O,L);this.patterns[A]={bin:O,position:y}}return this._updatePatternAtlas(),this.patterns[A].position}bind(A){const x=A.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new rt(A,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){const A=[];for(const y in this.patterns)A.push(this.patterns[y].bin);const{w:x,h:L}=s.p(A),O=this.atlasImage;O.resize({width:x||1,height:L||1});for(const y in this.patterns){const{bin:a}=this.patterns[y],d=a.x+1,_=a.y+1,B=this.getImage(y).data,T=B.width,U=B.height;s.R.copy(B,O,{x:0,y:0},{x:d,y:_},{width:T,height:U}),s.R.copy(B,O,{x:0,y:U-1},{x:d,y:_-1},{width:T,height:1}),s.R.copy(B,O,{x:0,y:0},{x:d,y:_+U},{width:T,height:1}),s.R.copy(B,O,{x:T-1,y:0},{x:d-1,y:_},{width:1,height:U}),s.R.copy(B,O,{x:0,y:0},{x:d+T,y:_},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(A){for(const x of A){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;const L=this.getImage(x);L||s.w(`Image with ID: "${x}" was not found`),Re(L)&&this.updateImage(x,L)}}}const Je=1e20;function Xe(z,A,x,L,O,y,a,d,_){for(let B=A;B<A+L;B++)Ct(z,x*y+B,y,O,a,d,_);for(let B=x;B<x+O;B++)Ct(z,B*y+A,1,L,a,d,_)}function Ct(z,A,x,L,O,y,a){y[0]=0,a[0]=-Je,a[1]=Je,O[0]=z[A];for(let d=1,_=0,B=0;d<L;d++){O[d]=z[A+d*x];const T=d*d;do{const U=y[_];B=(O[d]-O[U]+T-U*U)/(d-U)/2}while(B<=a[_]&&--_>-1);_++,y[_]=d,a[_]=B,a[_+1]=Je}for(let d=0,_=0;d<L;d++){for(;a[_+1]<d;)_++;const B=y[_],T=d-B;z[A+d*x]=O[B]+T*T}}class Et{constructor(A,x){this.requestManager=A,this.localIdeographFontFamily=x,this.entries={}}setURL(A){this.url=A}getGlyphs(A,x){const L=[];for(const O in A)for(const y of A[O])L.push({stack:O,id:y});s.o(L,(O,y)=>{let{stack:a,id:d}=O,_=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return void y(null,{stack:a,id:d,glyph:B});if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,void y(null,{stack:a,id:d,glyph:B});const T=Math.floor(d/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(_.ranges[T])return void y(null,{stack:a,id:d,glyph:B});if(!this.url)return void y(new Error("glyphsUrl is not set"));let U=_.requests[T];U||(U=_.requests[T]=[],Et.loadGlyphRange(a,T,this.url,this.requestManager,(H,q)=>{if(q){for(const w in q)this._doesCharSupportLocalGlyph(+w)||(_.glyphs[+w]=q[+w]);_.ranges[T]=!0}for(const w of U)w(H,q);delete _.requests[T]})),U.push((H,q)=>{H?y(H):q&&y(null,{stack:a,id:d,glyph:q[d]||null})})},(O,y)=>{if(O)x(O);else if(y){const a={};for(const{stack:d,id:_,glyph:B}of y)(a[d]||(a[d]={}))[_]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};x(null,a)}})}_doesCharSupportLocalGlyph(A){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](A)||s.u["Hangul Syllables"](A)||s.u.Hiragana(A)||s.u.Katakana(A))}_tinySDF(A,x,L){const O=this.localIdeographFontFamily;if(!O||!this._doesCharSupportLocalGlyph(L))return;let y=A.tinySDF;if(!y){let d="400";/bold/i.test(x)?d="900":/medium/i.test(x)?d="500":/light/i.test(x)&&(d="200"),y=A.tinySDF=new Et.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:O,fontWeight:d})}const a=y.draw(String.fromCharCode(L));return{id:L,bitmap:new s.q({width:a.width||60,height:a.height||60},a.data),metrics:{width:a.glyphWidth/2||24,height:a.glyphHeight/2||24,left:a.glyphLeft/2+.5||0,top:a.glyphTop/2-27.5||-8,advance:a.glyphAdvance/2||24,isDoubleResolution:!0}}}}Et.loadGlyphRange=function(z,A,x,L,O){const y=256*A,a=y+255,d=L.transformRequest(x.replace("{fontstack}",z).replace("{range}",`${y}-${a}`),ue.Glyphs);s.l(d,(_,B)=>{if(_)O(_);else if(B){const T={};for(const U of s.n(B))T[U.id]=U;O(null,T)}})},Et.TinySDF=class{constructor(){let{fontSize:z=24,buffer:A=3,radius:x=8,cutoff:L=.25,fontFamily:O="sans-serif",fontWeight:y="normal",fontStyle:a="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=A,this.cutoff=L,this.radius=x;const d=this.size=z+4*A,_=this._createCanvas(d),B=this.ctx=_.getContext("2d",{willReadFrequently:!0});B.font=`${a} ${y} ${z}px ${O}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(z){const A=document.createElement("canvas");return A.width=A.height=z,A}draw(z){const{width:A,actualBoundingBoxAscent:x,actualBoundingBoxDescent:L,actualBoundingBoxLeft:O,actualBoundingBoxRight:y}=this.ctx.measureText(z),a=Math.ceil(x),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-O))),_=Math.min(this.size-this.buffer,a+Math.ceil(L)),B=d+2*this.buffer,T=_+2*this.buffer,U=Math.max(B*T,0),H=new Uint8ClampedArray(U),q={data:H,width:B,height:T,glyphWidth:d,glyphHeight:_,glyphTop:a,glyphLeft:0,glyphAdvance:A};if(d===0||_===0)return q;const{ctx:w,buffer:I,gridInner:k,gridOuter:j}=this;w.clearRect(I,I,d,_),w.fillText(z,I,I+a);const Y=w.getImageData(I,I,d,_);j.fill(Je,0,U),k.fill(0,0,U);for(let X=0;X<_;X++)for(let ee=0;ee<d;ee++){const re=Y.data[4*(X*d+ee)+3]/255;if(re===0)continue;const le=(X+I)*B+ee+I;if(re===1)j[le]=0,k[le]=Je;else{const pe=.5-re;j[le]=pe>0?pe*pe:0,k[le]=pe<0?pe*pe:0}}Xe(j,0,0,B,T,B,this.f,this.v,this.z),Xe(k,I,I,d,_,B,this.f,this.v,this.z);for(let X=0;X<U;X++){const ee=Math.sqrt(j[X])-Math.sqrt(k[X]);H[X]=Math.round(255-255*(ee/this.radius+this.cutoff))}return q}};class Mt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(A,x){return s.z(A.expression.evaluate(x))}interpolate(A,x,L){return{x:s.B.number(A.x,x.x,L),y:s.B.number(A.y,x.y,L),z:s.B.number(A.z,x.z,L)}}}let vt;class Dt extends s.E{constructor(A){super(),vt=vt||new s.r({anchor:new s.D(s.v.light.anchor),position:new Mt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(vt),this.setLight(A),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.t,A,x))for(const L in A){const O=A[L];L.endsWith("-transition")?this._transitionable.setTransition(L.slice(0,-11),O):this._transitionable.setValue(L,O)}}updateTransitions(A){this._transitioning=this._transitionable.transitioned(A,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(A){this.properties=this._transitioning.possiblyEvaluate(A)}_validate(A,x,L){return(!L||L.validate!==!1)&&s.x(this,A.call(s.y,s.e({value:x,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Pt{constructor(A,x){this.width=A,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(A,x){const L=A.join(",")+String(x);return this.dashEntry[L]||(this.dashEntry[L]=this.addDash(A,x)),this.dashEntry[L]}getDashRanges(A,x,L){const O=[];let y=A.length%2==1?-A[A.length-1]*L:0,a=A[0]*L,d=!0;O.push({left:y,right:a,isDash:d,zeroLength:A[0]===0});let _=A[0];for(let B=1;B<A.length;B++){d=!d;const T=A[B];y=_*L,_+=T,a=_*L,O.push({left:y,right:a,isDash:d,zeroLength:T===0})}return O}addRoundDash(A,x,L){const O=x/2;for(let y=-L;y<=L;y++){const a=this.width*(this.nextRow+L+y);let d=0,_=A[d];for(let B=0;B<this.width;B++){B/_.right>1&&(_=A[++d]);const T=Math.abs(B-_.left),U=Math.abs(B-_.right),H=Math.min(T,U);let q;const w=y/L*(O+1);if(_.isDash){const I=O-Math.abs(w);q=Math.sqrt(H*H+I*I)}else q=O-Math.sqrt(H*H+w*w);this.data[a+B]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(A){for(let d=A.length-1;d>=0;--d){const _=A[d],B=A[d+1];_.zeroLength?A.splice(d,1):B&&B.isDash===_.isDash&&(B.left=_.left,A.splice(d,1))}const x=A[0],L=A[A.length-1];x.isDash===L.isDash&&(x.left=L.left-this.width,L.right=x.right+this.width);const O=this.width*this.nextRow;let y=0,a=A[y];for(let d=0;d<this.width;d++){d/a.right>1&&(a=A[++y]);const _=Math.abs(d-a.left),B=Math.abs(d-a.right),T=Math.min(_,B);this.data[O+d]=Math.max(0,Math.min(255,(a.isDash?T:-T)+128))}}addDash(A,x){const L=x?7:0,O=2*L+1;if(this.nextRow+O>this.height)return s.w("LineAtlas out of space"),null;let y=0;for(let d=0;d<A.length;d++)y+=A[d];if(y!==0){const d=this.width/y,_=this.getDashRanges(A,this.width,d);x?this.addRoundDash(_,d,L):this.addRegularDash(_)}const a={y:(this.nextRow+L+.5)/this.height,height:2*L/this.height,width:y};return this.nextRow+=O,this.dirty=!0,a}bind(A){const x=A.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}class Xt{constructor(A,x,L){this.workerPool=A,this.actors=[],this.currentActor=0,this.id=L;const O=this.workerPool.acquire(L);for(let y=0;y<O.length;y++){const a=new s.C(O[y],x,L);a.name=`Worker ${y}`,this.actors.push(a)}if(!this.actors.length)throw new Error("No actors found")}broadcast(A,x,L){s.o(this.actors,(O,y)=>{O.send(A,x,y)},L=L||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(x=>{x.remove()}),this.actors=[],A&&this.workerPool.release(this.id)}}function Te(z,A,x){const L=function(O,y){if(O)return x(O);if(y){const a=s.F(s.e(y,z),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(a.vectorLayers=y.vector_layers,a.vectorLayerIds=a.vectorLayers.map(d=>d.id)),x(null,a)}};return z.url?s.f(A.transformRequest(z.url,ue.Source),L):s.h.frame(()=>L(null,z))}class Ze{constructor(A,x){A&&(x?this.setSouthWest(A).setNorthEast(x):Array.isArray(A)&&(A.length===4?this.setSouthWest([A[0],A[1]]).setNorthEast([A[2],A[3]]):this.setSouthWest(A[0]).setNorthEast(A[1])))}setNorthEast(A){return this._ne=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}setSouthWest(A){return this._sw=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}extend(A){const x=this._sw,L=this._ne;let O,y;if(A instanceof s.L)O=A,y=A;else{if(!(A instanceof Ze))return Array.isArray(A)?A.length===4||A.every(Array.isArray)?this.extend(Ze.convert(A)):this.extend(s.L.convert(A)):A&&("lng"in A||"lon"in A)&&"lat"in A?this.extend(s.L.convert(A)):this;if(O=A._sw,y=A._ne,!O||!y)return this}return x||L?(x.lng=Math.min(O.lng,x.lng),x.lat=Math.min(O.lat,x.lat),L.lng=Math.max(y.lng,L.lng),L.lat=Math.max(y.lat,L.lat)):(this._sw=new s.L(O.lng,O.lat),this._ne=new s.L(y.lng,y.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(A){const{lng:x,lat:L}=s.L.convert(A);let O=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(O=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=L&&L<=this._ne.lat&&O}static convert(A){return A instanceof Ze?A:A&&new Ze(A)}static fromLngLat(A){const L=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,O=L/Math.cos(Math.PI/180*A.lat);return new Ze(new s.L(A.lng-O,A.lat-L),new s.L(A.lng+O,A.lat+L))}}class tt{constructor(A,x,L){this.bounds=Ze.convert(this.validateBounds(A)),this.minzoom=x||0,this.maxzoom=L||24}validateBounds(A){return Array.isArray(A)&&A.length===4?[Math.max(-180,A[0]),Math.max(-90,A[1]),Math.min(180,A[2]),Math.min(90,A[3])]:[-180,-90,180,90]}contains(A){const x=Math.pow(2,A.z),L=Math.floor(s.G(this.bounds.getWest())*x),O=Math.floor(s.H(this.bounds.getNorth())*x),y=Math.ceil(s.G(this.bounds.getEast())*x),a=Math.ceil(s.H(this.bounds.getSouth())*x);return A.x>=L&&A.x<y&&A.y>=O&&A.y<a}}class dt extends s.E{constructor(A,x,L,O){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Te(this._options,this.map._requestManager,(y,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new s.j(y)):a&&(s.e(this,a),a.bounds&&(this.tileBounds=new tt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=A,this.dispatcher=L,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(x,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(O)}loaded(){return this._loaded}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}onAdd(A){this.map=A,this.load()}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}setUrl(A){return this.setSourceProperty(()=>{this.url=A,this._options.url=A}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O={request:this.map._requestManager.transformRequest(L,ue.Tile),uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,tileSize:this.tileSize*A.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(a,d){return delete A.request,A.aborted?x(null):a&&a.status!==404?x(a):(d&&d.resourceTiming&&(A.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&A.setExpiryData(d),A.loadVectorData(d,this.map.painter),x(null),void(A.reloadCallback&&(this.loadTile(A,A.reloadCallback),A.reloadCallback=null)))}O.request.collectResourceTiming=this._collectResourceTiming,A.actor&&A.state!=="expired"?A.state==="loading"?A.reloadCallback=x:A.request=A.actor.send("reloadTile",O,y.bind(this)):(A.actor=this.dispatcher.getActor(),A.request=A.actor.send("loadTile",O,y.bind(this)))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.actor&&A.actor.send("abortTile",{uid:A.uid,type:this.type,source:this.id},void 0)}unloadTile(A){A.unloadVectorData(),A.actor&&A.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class pt extends s.E{constructor(A,x,L,O){super(),this.id=A,this.dispatcher=L,this.setEventedParent(O),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},x),s.e(this,s.F(x,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Te(this._options,this.map._requestManager,(A,x)=>{this._tileJSONRequest=null,this._loaded=!0,A?this.fire(new s.j(A)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new tt(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(A){this.map=A,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}serialize(){return s.e({},this._options)}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);A.request=he.getImage(this.map._requestManager.transformRequest(L,ue.Tile),(O,y,a)=>{if(delete A.request,A.aborted)A.state="unloaded",x(null);else if(O)A.state="errored",x(O);else if(y){this.map._refreshExpiredTiles&&a&&A.setExpiryData(a);const d=this.map.painter.context,_=d.gl;A.texture=this.map.painter.getTileTexture(y.width),A.texture?A.texture.update(y,{useMipmap:!0}):(A.texture=new rt(d,y,_.RGBA,{useMipmap:!0}),A.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),d.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax)),A.state="loaded",x(null)}},this.map._refreshExpiredTiles)}abortTile(A,x){A.request&&(A.request.cancel(),delete A.request),x()}unloadTile(A,x){A.texture&&this.map.painter.saveTileTexture(A.texture),x()}hasTransition(){return!1}}class Bt extends pt{constructor(A,x,L,O){super(A,x,L,O),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox",this.redFactor=x.redFactor,this.greenFactor=x.greenFactor,this.blueFactor=x.blueFactor,this.baseShift=x.baseShift}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O=this.map._requestManager.transformRequest(L,ue.Tile);function y(a,d){a&&(A.state="errored",x(a)),d&&(A.dem=d,A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0,A.state="loaded",x(null))}A.neighboringTiles=this._getNeighboringTiles(A.tileID),A.request=he.getImage(O,(a,d,_)=>s._(this,void 0,void 0,function*(){if(delete A.request,A.aborted)A.state="unloaded",x(null);else if(a)A.state="errored",x(a);else if(d){this.map._refreshExpiredTiles&&A.setExpiryData(_);const B=s.a(d)&&s.J()?d:yield function(U){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const H=U.width+2,q=U.height+2;try{return new s.R({width:H,height:q},yield s.M(U,-1,-1,H,q))}catch{}}return s.h.getImageData(U,1)})}(d),T={uid:A.uid,coord:A.tileID,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};A.actor&&A.state!=="expired"||(A.actor=this.dispatcher.getActor(),A.actor.send("loadDEMTile",T,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(A){const x=A.canonical,L=Math.pow(2,x.z),O=(x.x-1+L)%L,y=x.x===0?A.wrap-1:A.wrap,a=(x.x+1+L)%L,d=x.x+1===L?A.wrap+1:A.wrap,_={};return _[new s.O(A.overscaledZ,y,x.z,O,x.y).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y).key]={backfilled:!1},x.y>0&&(_[new s.O(A.overscaledZ,y,x.z,O,x.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y-1).key]={backfilled:!1}),x.y+1<L&&(_[new s.O(A.overscaledZ,y,x.z,O,x.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y+1).key]={backfilled:!1}),_}unloadTile(A){A.demTexture&&this.map.painter.saveTileTexture(A.demTexture),A.fbo&&(A.fbo.destroy(),delete A.fbo),A.dem&&delete A.dem,delete A.neighboringTiles,A.state="unloaded",A.actor&&A.actor.send("removeDEMTile",{uid:A.uid,source:this.id})}}class Ft extends s.E{constructor(A,x,L,O){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=A,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=L.getActor(),this.setEventedParent(O),this._data=x.data,this._options=s.e({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;const y=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*y,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*y,extent:s.N,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:s.N,radius:(x.clusterRadius||50)*y,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(A){this.map=A,this.load()}setData(A){return this._data=A,this._updateWorkerData(),this}updateData(A){return this._updateWorkerData(A),this}setClusterOptions(A){return this.workerOptions.cluster=A.cluster,A&&(A.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=A.clusterRadius),A.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=A.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(A,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:A,source:this.id},x),this}getClusterChildren(A,x){return this.actor.send("geojson.getClusterChildren",{clusterId:A,source:this.id},x),this}getClusterLeaves(A,x,L,O){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:A,limit:x,offset:L},O),this}_updateWorkerData(A){const x=s.e({},this.workerOptions);A?x.dataDiff=A:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ue.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,x,(L,O)=>{if(this._pendingLoads--,this._removed||O&&O.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let y=null;if(O&&O.resourceTiming&&O.resourceTiming[this.id]&&(y=O.resourceTiming[this.id].slice(0)),L)return void this.fire(new s.j(L));const a={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&s.e(a,{resourceTiming:y}),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(A,x){const L=A.actor?"reloadTile":"loadTile";A.actor=this.actor;const O={type:this.type,uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request=this.actor.send(L,O,(y,a)=>(delete A.request,A.unloadVectorData(),A.aborted?x(null):y?x(y):(A.loadVectorData(a,this.map.painter,L==="reloadTile"),x(null))))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.aborted=!0}unloadTile(A){A.unloadVectorData(),this.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Lt=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gt extends s.E{constructor(A,x,L,O){super(),this.load=(y,a)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=he.getImage(this.map._requestManager.transformRequest(this.url,ue.Image),(d,_)=>{this._request=null,this._loaded=!0,d?this.fire(new s.j(d)):_&&(this.image=_,y&&(this.coordinates=y),a&&a(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Lt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new rt(y,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=A,this.dispatcher=L,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(O),this.options=x}loaded(){return this._loaded}updateImage(A){return A.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=A.url,this.load(A.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(A){this.map=A,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(A){this.coordinates=A;const x=A.map(s.U.fromLngLat);this.tileID=function(O){let y=1/0,a=1/0,d=-1/0,_=-1/0;for(const H of O)y=Math.min(y,H.x),a=Math.min(a,H.y),d=Math.max(d,H.x),_=Math.max(_,H.y);const B=Math.max(d-y,_-a),T=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),U=Math.pow(2,T);return new s.W(T,Math.floor((y+d)/2*U),Math.floor((a+_)/2*U))}(x),this.minzoom=this.maxzoom=this.tileID.z;const L=x.map(O=>this.tileID.getTilePoint(O)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.N,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.N),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(A,x){this.tileID&&this.tileID.equals(A.tileID.canonical)?(this.tiles[String(A.tileID.wrap)]=A,A.buckets={},x(null)):(A.state="errored",x(null))}hasTransition(){return!1}}class ri extends Gt{constructor(A,x,L,O){super(A,x,L,O),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,ue.Source).url);s.X(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new s.j(a)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Lt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new rt(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=x}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(A){if(this.video){const x=this.video.seekable;A<x.start(0)||A>x.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=A}}getVideo(){return this.video}onAdd(A){this.map||(this.map=A,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class mi extends Gt{constructor(A,x,L,O){super(A,x,L,O),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Lt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new rt(a,this.canvas,d.RGBA,{premultiply:!0});let _=!1;for(const B in this.tiles){const T=this.tiles[B];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(a=>typeof a!="number"))||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${A}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}getCanvas(){return this.canvas}onAdd(A){this.map=A,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const A of[this.canvas.width,this.canvas.height])if(isNaN(A)||A<=0)return!0;return!1}}const yi={},Pi=z=>{switch(z){case"geojson":return Ft;case"image":return Gt;case"raster":return pt;case"raster-dem":return Bt;case"vector":return dt;case"video":return ri;case"canvas":return mi}return yi[z]};function Ot(z,A){const x=s.Z();return s.$(x,x,[1,1,0]),s.a0(x,x,[.5*z.width,.5*z.height,1]),s.a1(x,x,z.calculatePosMatrix(A.toUnwrapped()))}function lt(z,A,x,L,O,y){const a=function(U,H,q){if(U)for(const w of U){const I=H[w];if(I&&I.source===q&&I.type==="fill-extrusion")return!0}else for(const w in H){const I=H[w];if(I.source===q&&I.type==="fill-extrusion")return!0}return!1}(O&&O.layers,A,z.id),d=y.maxPitchScaleFactor(),_=z.tilesIn(L,d,a);_.sort(wt);const B=[];for(const U of _)B.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(A,x,z._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,O,y,d,Ot(z.transform,U.tileID))});const T=function(U){const H={},q={};for(const w of U){const I=w.queryResults,k=w.wrappedTileID,j=q[k]=q[k]||{};for(const Y in I){const X=I[Y],ee=j[Y]=j[Y]||{},re=H[Y]=H[Y]||[];for(const le of X)ee[le.featureIndex]||(ee[le.featureIndex]=!0,re.push(le))}}return H}(B);for(const U in T)T[U].forEach(H=>{const q=H.feature,w=z.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=w});return T}function wt(z,A){const x=z.tileID,L=A.tileID;return x.overscaledZ-L.overscaledZ||x.canonical.y-L.canonical.y||x.wrap-L.wrap||x.canonical.x-L.canonical.x}class ki{constructor(A,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=A,this.uid=s.a2(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(A){const x=A+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(A){this.demTexture&&A.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(A,x,L){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",A){A.featureIndex&&(this.latestFeatureIndex=A.featureIndex,A.rawTileData?(this.latestRawTileData=A.rawTileData,this.latestFeatureIndex.rawTileData=A.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=A.collisionBoxArray,this.buckets=function(O,y){const a={};if(!y)return a;for(const d of O){const _=d.layerIds.map(B=>y.getLayer(B)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(B=>_.filter(T=>T.id===B)[0]));for(const B of _)a[B.id]=d}}return a}(A.buckets,x.style),this.hasSymbolBuckets=!1;for(const O in this.buckets){const y=this.buckets[O];if(y instanceof s.a4){if(this.hasSymbolBuckets=!0,!L)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const O in this.buckets){const y=this.buckets[O];if(y instanceof s.a4&&y.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const O in this.buckets){const y=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(O).queryRadius(y))}A.imageAtlas&&(this.imageAtlas=A.imageAtlas),A.glyphAtlasImage&&(this.glyphAtlasImage=A.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const A in this.buckets)this.buckets[A].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(A){return this.buckets[A.id]}upload(A){for(const L in this.buckets){const O=this.buckets[L];O.uploadPending()&&O.upload(A)}const x=A.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rt(A,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rt(A,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(A){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(A,this.imageAtlasTexture)}queryRenderedFeatures(A,x,L,O,y,a,d,_,B,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:O,cameraQueryGeometry:y,scale:a,tileSize:this.tileSize,pixelPosMatrix:T,transform:_,params:d,queryPadding:this.queryPadding*B},A,x,L):{}}querySourceFeatures(A,x){const L=this.latestFeatureIndex;if(!L||!L.rawTileData)return;const O=L.loadVTLayers(),y=x&&x.sourceLayer?x.sourceLayer:"",a=O._geojsonTileLayer||O[y];if(!a)return;const d=s.a6(x&&x.filter),{z:_,x:B,y:T}=this.tileID.canonical,U={z:_,x:B,y:T};for(let H=0;H<a.length;H++){const q=a.feature(H);if(d.needGeometry){const k=s.a7(q,!0);if(!d.filter(new s.a8(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!d.filter(new s.a8(this.tileID.overscaledZ),q))continue;const w=L.getId(q,y),I=new s.a9(q,_,B,T,w);I.tile=U,A.push(I)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(A){const x=this.expirationTime;if(A.cacheControl){const L=s.aa(A.cacheControl);L["max-age"]&&(this.expirationTime=Date.now()+1e3*L["max-age"])}else A.expires&&(this.expirationTime=new Date(A.expires).getTime());if(this.expirationTime){const L=Date.now();let O=!1;if(this.expirationTime>L)O=!1;else if(x)if(this.expirationTime<x)O=!0;else{const y=this.expirationTime-x;y?this.expirationTime=L+Math.max(y,3e4):O=!0}else O=!0;O?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(A,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(A).length===0)return;const L=this.latestFeatureIndex.loadVTLayers();for(const O in this.buckets){if(!x.style.hasLayer(O))continue;const y=this.buckets[O],a=y.layers[0].sourceLayer||"_geojsonTileLayer",d=L[a],_=A[a];if(!d||!_||Object.keys(_).length===0)continue;y.update(_,d,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=x&&x.style&&x.style.getLayer(O);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(A){this.symbolFadeHoldUntil=s.h.now()+A}setDependencies(A,x){const L={};for(const O of x)L[O]=!0;this.dependencies[A]=L}hasDependency(A,x){for(const L of A){const O=this.dependencies[L];if(O){for(const y of x)if(O[y])return!0}}return!1}}class ti{constructor(A,x){this.max=A,this.onRemove=x,this.reset()}reset(){for(const A in this.data)for(const x of this.data[A])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(A,x,L){const O=A.wrapped().key;this.data[O]===void 0&&(this.data[O]=[]);const y={value:x,timeout:void 0};if(L!==void 0&&(y.timeout=setTimeout(()=>{this.remove(A,y)},L)),this.data[O].push(y),this.order.push(O),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(A){return A.wrapped().key in this.data}getAndRemove(A){return this.has(A)?this._getAndRemoveByKey(A.wrapped().key):null}_getAndRemoveByKey(A){const x=this.data[A].shift();return x.timeout&&clearTimeout(x.timeout),this.data[A].length===0&&delete this.data[A],this.order.splice(this.order.indexOf(A),1),x.value}getByKey(A){const x=this.data[A];return x?x[0].value:null}get(A){return this.has(A)?this.data[A.wrapped().key][0].value:null}remove(A,x){if(!this.has(A))return this;const L=A.wrapped().key,O=x===void 0?0:this.data[L].indexOf(x),y=this.data[L][O];return this.data[L].splice(O,1),y.timeout&&clearTimeout(y.timeout),this.data[L].length===0&&delete this.data[L],this.onRemove(y.value),this.order.splice(this.order.indexOf(L),1),this}setMaxSize(A){for(this.max=A;this.order.length>this.max;){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(A){const x=[];for(const L in this.data)for(const O of this.data[L])A(O.value)||x.push(O);for(const L of x)this.remove(L.value.tileID,L)}}class ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(A,x,L){const O=String(x);if(this.stateChanges[A]=this.stateChanges[A]||{},this.stateChanges[A][O]=this.stateChanges[A][O]||{},s.e(this.stateChanges[A][O],L),this.deletedStates[A]===null){this.deletedStates[A]={};for(const y in this.state[A])y!==O&&(this.deletedStates[A][y]=null)}else if(this.deletedStates[A]&&this.deletedStates[A][O]===null){this.deletedStates[A][O]={};for(const y in this.state[A][O])L[y]||(this.deletedStates[A][O][y]=null)}else for(const y in L)this.deletedStates[A]&&this.deletedStates[A][O]&&this.deletedStates[A][O][y]===null&&delete this.deletedStates[A][O][y]}removeFeatureState(A,x,L){if(this.deletedStates[A]===null)return;const O=String(x);if(this.deletedStates[A]=this.deletedStates[A]||{},L&&x!==void 0)this.deletedStates[A][O]!==null&&(this.deletedStates[A][O]=this.deletedStates[A][O]||{},this.deletedStates[A][O][L]=null);else if(x!==void 0)if(this.stateChanges[A]&&this.stateChanges[A][O])for(L in this.deletedStates[A][O]={},this.stateChanges[A][O])this.deletedStates[A][O][L]=null;else this.deletedStates[A][O]=null;else this.deletedStates[A]=null}getState(A,x){const L=String(x),O=s.e({},(this.state[A]||{})[L],(this.stateChanges[A]||{})[L]);if(this.deletedStates[A]===null)return{};if(this.deletedStates[A]){const y=this.deletedStates[A][x];if(y===null)return{};for(const a in y)delete O[a]}return O}initializeTileState(A,x){A.setFeatureState(this.state,x)}coalesceChanges(A,x){const L={};for(const O in this.stateChanges){this.state[O]=this.state[O]||{};const y={};for(const a in this.stateChanges[O])this.state[O][a]||(this.state[O][a]={}),s.e(this.state[O][a],this.stateChanges[O][a]),y[a]=this.state[O][a];L[O]=y}for(const O in this.deletedStates){this.state[O]=this.state[O]||{};const y={};if(this.deletedStates[O]===null)for(const a in this.state[O])y[a]={},this.state[O][a]={};else for(const a in this.deletedStates[O]){if(this.deletedStates[O][a]===null)this.state[O][a]={};else for(const d of Object.keys(this.deletedStates[O][a]))delete this.state[O][a][d];y[a]=this.state[O][a]}L[O]=L[O]||{},s.e(L[O],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(L).length!==0)for(const O in A)A[O].setFeatureState(L,x)}}class qt extends s.E{constructor(A,x,L){super(),this.id=A,this.dispatcher=L,this.on("data",O=>{O.dataType==="source"&&O.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((O,y,a,d)=>{const _=new(Pi(y.type))(O,y,a,d);if(_.id!==O)throw new Error(`Expected Source id to be ${O} instead of ${_.id}`);return _})(A,x,L,this),this._tiles={},this._cache=new ti(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ht,this._didEmitContent=!1,this._updated=!1}onAdd(A){this.map=A,this._maxTileCacheSize=A?A._maxTileCacheSize:null,this._maxTileCacheZoomLevels=A?A._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(A)}onRemove(A){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(A)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const A in this._tiles){const x=this._tiles[A];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const A=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,A&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(A,x){return this._source.loadTile(A,x)}_unloadTile(A){if(this._source.unloadTile)return this._source.unloadTile(A,()=>{})}_abortTile(A){this._source.abortTile&&this._source.abortTile(A,()=>{}),this._source.fire(new s.k("dataabort",{tile:A,coord:A.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(A){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const x in this._tiles){const L=this._tiles[x];L.upload(A),L.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(A=>A.tileID).sort(si).map(A=>A.key)}getRenderableIds(A){const x=[];for(const L in this._tiles)this._isIdRenderable(L,A)&&x.push(this._tiles[L]);return A?x.sort((L,O)=>{const y=L.tileID,a=O.tileID,d=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),_=new s.P(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-a.overscaledZ||_.y-d.y||_.x-d.x}).map(L=>L.tileID.key):x.map(L=>L.tileID).sort(si).map(L=>L.key)}hasRenderableParent(A){const x=this.findLoadedParent(A,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(A,x){return this._tiles[A]&&this._tiles[A].hasData()&&!this._coveredTiles[A]&&(x||!this._tiles[A].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const A in this._tiles)this._tiles[A].state!=="errored"&&this._reloadTile(A,"reloading")}}_reloadTile(A,x){const L=this._tiles[A];L&&(L.state!=="loading"&&(L.state=x),this._loadTile(L,this._tileLoaded.bind(this,L,A,x)))}_tileLoaded(A,x,L,O){if(O)return A.state="errored",void(O.status!==404?this._source.fire(new s.j(O,{tile:A})):this.update(this.transform,this.terrain));A.timeAdded=s.h.now(),L==="expired"&&(A.refreshedUponExpiration=!0),this._setTileReloadTimer(x,A),this.getSource().type==="raster-dem"&&A.dem&&this._backfillDEM(A),this._state.initializeTileState(A,this.map?this.map.painter:null),A.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:A,coord:A.tileID}))}_backfillDEM(A){const x=this.getRenderableIds();for(let O=0;O<x.length;O++){const y=x[O];if(A.neighboringTiles&&A.neighboringTiles[y]){const a=this.getTileByID(y);L(A,a),L(a,A)}}function L(O,y){O.needsHillshadePrepare=!0,O.needsTerrainPrepare=!0;let a=y.tileID.canonical.x-O.tileID.canonical.x;const d=y.tileID.canonical.y-O.tileID.canonical.y,_=Math.pow(2,O.tileID.canonical.z),B=y.tileID.key;a===0&&d===0||Math.abs(d)>1||(Math.abs(a)>1&&(Math.abs(a+_)===1?a+=_:Math.abs(a-_)===1&&(a-=_)),y.dem&&O.dem&&(O.dem.backfillBorder(y.dem,a,d),O.neighboringTiles&&O.neighboringTiles[B]&&(O.neighboringTiles[B].backfilled=!0)))}}getTile(A){return this.getTileByID(A.key)}getTileByID(A){return this._tiles[A]}_retainLoadedChildren(A,x,L,O){for(const y in this._tiles){let a=this._tiles[y];if(O[y]||!a.hasData()||a.tileID.overscaledZ<=x||a.tileID.overscaledZ>L)continue;let d=a.tileID;for(;a&&a.tileID.overscaledZ>x+1;){const B=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[B.key],a&&a.hasData()&&(d=B)}let _=d;for(;_.overscaledZ>x;)if(_=_.scaledTo(_.overscaledZ-1),A[_.key]){O[d.key]=d;break}}}findLoadedParent(A,x){if(A.key in this._loadedParentTiles){const L=this._loadedParentTiles[A.key];return L&&L.tileID.overscaledZ>=x?L:null}for(let L=A.overscaledZ-1;L>=x;L--){const O=A.scaledTo(L),y=this._getLoadedTile(O);if(y)return y}}_getLoadedTile(A){const x=this._tiles[A.key];return x&&x.hasData()?x:this._cache.getByKey(A.wrapped().key)}updateCacheSize(A){const x=Math.ceil(A.width/this._source.tileSize)+1,L=Math.ceil(A.height/this._source.tileSize)+1,O=Math.floor(x*L*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(y)}handleWrapJump(A){const x=Math.round((A-(this._prevLng===void 0?A:this._prevLng))/360);if(this._prevLng=A,x){const L={};for(const O in this._tiles){const y=this._tiles[O];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+x),L[y.tileID.key]=y}this._tiles=L;for(const O in this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(const O in this._tiles)this._setTileReloadTimer(O,this._tiles[O])}}update(A,x){if(this.transform=A,this.terrain=x,!this._sourceLoaded||this._paused)return;let L;this.updateCacheSize(A),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?L=A.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new s.O(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(L=A.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(L=L.filter(T=>this._source.hasTile(T)))):L=[];const O=A.coveringZoomLevel(this._source),y=Math.max(O-qt.maxOverzooming,this._source.minzoom),a=Math.max(O+qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const T={};for(const U of L)if(U.canonical.z>this._source.minzoom){const H=U.scaledTo(U.canonical.z-1);T[H.key]=H;const q=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));T[q.key]=q}L=L.concat(Object.values(T))}const d=L.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=this._updateRetainedTiles(L,O);if(fi(this._source.type)){const T={},U={},H=Object.keys(_),q=s.h.now();for(const w of H){const I=_[w],k=this._tiles[w];if(!k||k.fadeEndTime!==0&&k.fadeEndTime<=q)continue;const j=this.findLoadedParent(I,y);j&&(this._addTile(j.tileID),T[j.tileID.key]=j.tileID),U[w]=I}this._retainLoadedChildren(U,O,a,_);for(const w in T)_[w]||(this._coveredTiles[w]=!0,_[w]=T[w]);if(x){const w={},I={};for(const k of L)this._tiles[k.key].hasData()?w[k.key]=k:I[k.key]=k;for(const k in I){const j=I[k].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(w[j[0].key]=_[j[0].key]=j[0],w[j[1].key]=_[j[1].key]=j[1],w[j[2].key]=_[j[2].key]=j[2],w[j[3].key]=_[j[3].key]=j[3],delete I[k])}for(const k in I){const j=this.findLoadedParent(I[k],this._source.minzoom);if(j){w[j.tileID.key]=_[j.tileID.key]=j.tileID;for(const Y in w)w[Y].isChildOf(j.tileID)&&delete w[Y]}}for(const k in this._tiles)w[k]||(this._coveredTiles[k]=!0)}}for(const T in _)this._tiles[T].clearFadeHold();const B=s.ab(this._tiles,_);for(const T of B){const U=this._tiles[T];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const A in this._tiles)this._tiles[A].holdingForFade()&&this._removeTile(A)}_updateRetainedTiles(A,x){const L={},O={},y=Math.max(x-qt.maxOverzooming,this._source.minzoom),a=Math.max(x+qt.maxUnderzooming,this._source.minzoom),d={};for(const _ of A){const B=this._addTile(_);L[_.key]=_,B.hasData()||x<this._source.maxzoom&&(d[_.key]=_)}this._retainLoadedChildren(d,x,a,L);for(const _ of A){let B=this._tiles[_.key];if(B.hasData())continue;if(x+1>this._source.maxzoom){const U=_.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){L[U.key]=U;continue}}else{const U=_.children(this._source.maxzoom);if(L[U[0].key]&&L[U[1].key]&&L[U[2].key]&&L[U[3].key])continue}let T=B.wasRequested();for(let U=_.overscaledZ-1;U>=y;--U){const H=_.scaledTo(U);if(O[H.key])break;if(O[H.key]=!0,B=this.getTile(H),!B&&T&&(B=this._addTile(H)),B){const q=B.hasData();if((T||q)&&(L[H.key]=H),T=B.wasRequested(),q)break}}}return L}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const A in this._tiles){const x=[];let L,O=this._tiles[A].tileID;for(;O.overscaledZ>0;){if(O.key in this._loadedParentTiles){L=this._loadedParentTiles[O.key];break}x.push(O.key);const y=O.scaledTo(O.overscaledZ-1);if(L=this._getLoadedTile(y),L)break;O=y}for(const y of x)this._loadedParentTiles[y]=L}}_addTile(A){let x=this._tiles[A.key];if(x)return x;x=this._cache.getAndRemove(A),x&&(this._setTileReloadTimer(A.key,x),x.tileID=A,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[A.key]&&(clearTimeout(this._cacheTimers[A.key]),delete this._cacheTimers[A.key],this._setTileReloadTimer(A.key,x)));const L=x;return x||(x=new ki(A,this._source.tileSize*A.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,A.key,x.state))),x.uses++,this._tiles[A.key]=x,L||this._source.fire(new s.k("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(A,x){A in this._timers&&(clearTimeout(this._timers[A]),delete this._timers[A]);const L=x.getExpiryTimeout();L&&(this._timers[A]=setTimeout(()=>{this._reloadTile(A,"expired"),delete this._timers[A]},L))}_removeTile(A){const x=this._tiles[A];x&&(x.uses--,delete this._tiles[A],this._timers[A]&&(clearTimeout(this._timers[A]),delete this._timers[A]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const A in this._tiles)this._removeTile(A);this._cache.reset()}tilesIn(A,x,L){const O=[],y=this.transform;if(!y)return O;const a=L?y.getCameraQueryGeometry(A):A,d=A.map(w=>y.pointCoordinate(w,this.terrain)),_=a.map(w=>y.pointCoordinate(w,this.terrain)),B=this.getIds();let T=1/0,U=1/0,H=-1/0,q=-1/0;for(const w of _)T=Math.min(T,w.x),U=Math.min(U,w.y),H=Math.max(H,w.x),q=Math.max(q,w.y);for(let w=0;w<B.length;w++){const I=this._tiles[B[w]];if(I.holdingForFade())continue;const k=I.tileID,j=Math.pow(2,y.zoom-I.tileID.overscaledZ),Y=x*I.queryPadding*s.N/I.tileSize/j,X=[k.getTilePoint(new s.U(T,U)),k.getTilePoint(new s.U(H,q))];if(X[0].x-Y<s.N&&X[0].y-Y<s.N&&X[1].x+Y>=0&&X[1].y+Y>=0){const ee=d.map(le=>k.getTilePoint(le)),re=_.map(le=>k.getTilePoint(le));O.push({tile:I,tileID:k,queryGeometry:ee,cameraQueryGeometry:re,scale:j})}}return O}getVisibleCoordinates(A){const x=this.getRenderableIds(A).map(L=>this._tiles[L].tileID);for(const L of x)L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(fi(this._source.type)){const A=s.h.now();for(const x in this._tiles)if(this._tiles[x].fadeEndTime>=A)return!0}return!1}setFeatureState(A,x,L){this._state.updateState(A=A||"_geojsonTileLayer",x,L)}removeFeatureState(A,x,L){this._state.removeFeatureState(A=A||"_geojsonTileLayer",x,L)}getFeatureState(A,x){return this._state.getState(A=A||"_geojsonTileLayer",x)}setDependencies(A,x,L){const O=this._tiles[A];O&&O.setDependencies(x,L)}reloadTilesForDependencies(A,x){for(const L in this._tiles)this._tiles[L].hasDependency(A,x)&&this._reloadTile(L,"reloading");this._cache.filter(L=>!L.hasDependency(A,x))}}function si(z,A){const x=Math.abs(2*z.wrap)-+(z.wrap<0),L=Math.abs(2*A.wrap)-+(A.wrap<0);return z.overscaledZ-A.overscaledZ||L-x||A.canonical.y-z.canonical.y||A.canonical.x-z.canonical.x}function fi(z){return z==="raster"||z==="image"||z==="video"}qt.maxOverzooming=10,qt.maxUnderzooming=3;const ci="mapboxgl_preloaded_worker_pool";class Wi{constructor(){this.active={}}acquire(A){if(!this.workers)for(this.workers=[];this.workers.length<Wi.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[A]=!0,this.workers.slice()}release(A){delete this.active[A],this.numActive()===0&&(this.workers.forEach(x=>{x.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ci]}numActive(){return Object.keys(this.active).length}}const ir=Math.floor(s.h.hardwareConcurrency/2);let dr;function Sr(){return dr||(dr=new Wi),dr}Wi.workerCount=s.ac(globalThis)?Math.max(Math.min(ir,3),1):1;class zt{constructor(A,x){this.reset(A,x)}reset(A,x){this.points=A||[],this._distances=[0];for(let L=1;L<this.points.length;L++)this._distances[L]=this._distances[L-1]+this.points[L].dist(this.points[L-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(A){if(this.points.length===1)return this.points[0];A=s.ad(A,0,1);let x=1,L=this._distances[x];const O=A*this.paddedLength+this.padding;for(;L<O&&x<this._distances.length;)L=this._distances[++x];const y=x-1,a=this._distances[y],d=L-a,_=d>0?(O-a)/d:0;return this.points[y].mult(1-_).add(this.points[x].mult(_))}}function Yi(z,A){let x=!0;return z==="always"||z!=="never"&&A!=="never"||(x=!1),x}class ui{constructor(A,x,L){const O=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(A/L),this.yCellCount=Math.ceil(x/L);for(let a=0;a<this.xCellCount*this.yCellCount;a++)O.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=A,this.height=x,this.xScale=this.xCellCount/A,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(A,x,L,O,y){this._forEachCell(x,L,O,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(A),this.bboxes.push(x),this.bboxes.push(L),this.bboxes.push(O),this.bboxes.push(y)}insertCircle(A,x,L,O){this._forEachCell(x-O,L-O,x+O,L+O,this._insertCircleCell,this.circleUid++),this.circleKeys.push(A),this.circles.push(x),this.circles.push(L),this.circles.push(O)}_insertBoxCell(A,x,L,O,y,a){this.boxCells[y].push(a)}_insertCircleCell(A,x,L,O,y,a){this.circleCells[y].push(a)}_query(A,x,L,O,y,a,d){if(L<0||A>this.width||O<0||x>this.height)return[];const _=[];if(A<=0&&x<=0&&this.width<=L&&this.height<=O){if(y)return[{key:null,x1:A,y1:x,x2:L,y2:O}];for(let B=0;B<this.boxKeys.length;B++)_.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const T=this.circles[3*B],U=this.circles[3*B+1],H=this.circles[3*B+2];_.push({key:this.circleKeys[B],x1:T-H,y1:U-H,x2:T+H,y2:U+H})}}else this._forEachCell(A,x,L,O,this._queryCell,_,{hitTest:y,overlapMode:a,seenUids:{box:{},circle:{}}},d);return _}query(A,x,L,O){return this._query(A,x,L,O,!1,null)}hitTest(A,x,L,O,y,a){return this._query(A,x,L,O,!0,y,a).length>0}hitTestCircle(A,x,L,O,y){const a=A-L,d=A+L,_=x-L,B=x+L;if(d<0||a>this.width||B<0||_>this.height)return!1;const T=[];return this._forEachCell(a,_,d,B,this._queryCellCircle,T,{hitTest:!0,overlapMode:O,circle:{x:A,y:x,radius:L},seenUids:{box:{},circle:{}}},y),T.length>0}_queryCell(A,x,L,O,y,a,d,_){const{seenUids:B,hitTest:T,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const I of H)if(!B.box[I]){B.box[I]=!0;const k=4*I,j=this.boxKeys[I];if(A<=w[k+2]&&x<=w[k+3]&&L>=w[k+0]&&O>=w[k+1]&&(!_||_(j))&&(!T||!Yi(U,j.overlapMode))&&(a.push({key:j,x1:w[k],y1:w[k+1],x2:w[k+2],y2:w[k+3]}),T))return!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const I of q)if(!B.circle[I]){B.circle[I]=!0;const k=3*I,j=this.circleKeys[I];if(this._circleAndRectCollide(w[k],w[k+1],w[k+2],A,x,L,O)&&(!_||_(j))&&(!T||!Yi(U,j.overlapMode))){const Y=w[k],X=w[k+1],ee=w[k+2];if(a.push({key:j,x1:Y-ee,y1:X-ee,x2:Y+ee,y2:X+ee}),T)return!0}}}return!1}_queryCellCircle(A,x,L,O,y,a,d,_){const{circle:B,seenUids:T,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const I of H)if(!T.box[I]){T.box[I]=!0;const k=4*I,j=this.boxKeys[I];if(this._circleAndRectCollide(B.x,B.y,B.radius,w[k+0],w[k+1],w[k+2],w[k+3])&&(!_||_(j))&&!Yi(U,j.overlapMode))return a.push(!0),!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const I of q)if(!T.circle[I]){T.circle[I]=!0;const k=3*I,j=this.circleKeys[I];if(this._circlesCollide(w[k],w[k+1],w[k+2],B.x,B.y,B.radius)&&(!_||_(j))&&!Yi(U,j.overlapMode))return a.push(!0),!0}}}_forEachCell(A,x,L,O,y,a,d,_){const B=this._convertToXCellCoord(A),T=this._convertToYCellCoord(x),U=this._convertToXCellCoord(L),H=this._convertToYCellCoord(O);for(let q=B;q<=U;q++)for(let w=T;w<=H;w++)if(y.call(this,A,x,L,O,this.xCellCount*w+q,a,d,_))return}_convertToXCellCoord(A){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(A*this.xScale)))}_convertToYCellCoord(A){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(A*this.yScale)))}_circlesCollide(A,x,L,O,y,a){const d=O-A,_=y-x,B=L+a;return B*B>d*d+_*_}_circleAndRectCollide(A,x,L,O,y,a,d){const _=(a-O)/2,B=Math.abs(A-(O+_));if(B>_+L)return!1;const T=(d-y)/2,U=Math.abs(x-(y+T));if(U>T+L)return!1;if(B<=_||U<=T)return!0;const H=B-_,q=U-T;return H*H+q*q<=L*L}}function Kt(z,A,x,L,O){const y=s.Z();return A?(s.a0(y,y,[1/O,1/O,1]),x||s.ae(y,y,L.angle)):s.a1(y,L.labelPlaneMatrix,z),y}function Ji(z,A,x,L,O){if(A){const y=s.af(z);return s.a0(y,y,[O,O,1]),x||s.ae(y,y,-L.angle),y}return L.glCoordMatrix}function Vt(z,A,x){let L;x?(L=[z.x,z.y,x(z.x,z.y),1],s.ag(L,L,A)):(L=[z.x,z.y,0,1],be(L,L,A));const O=L[3];return{point:new s.P(L[0]/O,L[1]/O),signedDistanceFromCamera:O}}function Ci(z,A){return .5+z/A*.5}function Li(z,A){const x=z[0]/z[3],L=z[1]/z[3];return x>=-A[0]&&x<=A[0]&&L>=-A[1]&&L<=A[1]}function jt(z,A,x,L,O,y,a,d,_,B){const T=L?z.textSizeData:z.iconSizeData,U=s.ah(T,x.transform.zoom),H=[256/x.width*2+1,256/x.height*2+1],q=L?z.text.dynamicLayoutVertexArray:z.icon.dynamicLayoutVertexArray;q.clear();const w=z.lineVertexArray,I=L?z.text.placedSymbolArray:z.icon.placedSymbolArray,k=x.transform.width/x.transform.height;let j=!1;for(let Y=0;Y<I.length;Y++){const X=I.get(Y);if(X.hidden||X.writingMode===s.ai.vertical&&!j){me(X.numGlyphs,q);continue}let ee;if(j=!1,B?(ee=[X.anchorX,X.anchorY,B(X.anchorX,X.anchorY),1],s.ag(ee,ee,A)):(ee=[X.anchorX,X.anchorY,0,1],be(ee,ee,A)),!Li(ee,H)){me(X.numGlyphs,q);continue}const re=Ci(x.transform.cameraToCenterDistance,ee[3]),le=s.aj(T,U,X),pe=a?le/re:le*re,ge=new s.P(X.anchorX,X.anchorY),we=Vt(ge,O,B).point,De={projections:{},offsets:{}},Me=yr(X,pe,!1,d,A,O,y,z.glyphOffsetArray,w,q,we,ge,De,k,_,B);j=Me.useVertical,(Me.notEnoughRoom||j||Me.needsFlipping&&yr(X,pe,!0,d,A,O,y,z.glyphOffsetArray,w,q,we,ge,De,k,_,B).notEnoughRoom)&&me(X.numGlyphs,q)}L?z.text.dynamicLayoutVertexBuffer.updateData(q):z.icon.dynamicLayoutVertexBuffer.updateData(q)}function bi(z,A,x,L,O,y,a,d,_,B,T,U,H){const q=d.glyphStartIndex+d.numGlyphs,w=d.lineStartIndex,I=d.lineStartIndex+d.lineLength,k=A.getoffsetX(d.glyphStartIndex),j=A.getoffsetX(q-1),Y=ie(z*k,x,L,O,y,a,d.segment,w,I,_,B,T,U,H);if(!Y)return null;const X=ie(z*j,x,L,O,y,a,d.segment,w,I,_,B,T,U,H);return X?{first:Y,last:X}:null}function Yt(z,A,x,L){return z===s.ai.horizontal&&Math.abs(x.y-A.y)>Math.abs(x.x-A.x)*L?{useVertical:!0}:(z===s.ai.vertical?A.y<x.y:A.x>x.x)?{needsFlipping:!0}:null}function yr(z,A,x,L,O,y,a,d,_,B,T,U,H,q,w,I){const k=A/24,j=z.lineOffsetX*k,Y=z.lineOffsetY*k;let X;if(z.numGlyphs>1){const ee=z.glyphStartIndex+z.numGlyphs,re=z.lineStartIndex,le=z.lineStartIndex+z.lineLength,pe=bi(k,d,j,Y,x,T,U,z,_,y,H,w,I);if(!pe)return{notEnoughRoom:!0};const ge=Vt(pe.first.point,a,I).point,we=Vt(pe.last.point,a,I).point;if(L&&!x){const De=Yt(z.writingMode,ge,we,q);if(De)return De}X=[pe.first];for(let De=z.glyphStartIndex+1;De<ee-1;De++)X.push(ie(k*d.getoffsetX(De),j,Y,x,T,U,z.segment,re,le,_,y,H,w,I));X.push(pe.last)}else{if(L&&!x){const re=Vt(U,O,I).point,le=z.lineStartIndex+z.segment+1,pe=new s.P(_.getx(le),_.gety(le)),ge=Vt(pe,O,I),we=ge.signedDistanceFromCamera>0?ge.point:Tr(U,pe,re,1,O,I),De=Yt(z.writingMode,re,we,q);if(De)return De}const ee=ie(k*d.getoffsetX(z.glyphStartIndex),j,Y,x,T,U,z.segment,z.lineStartIndex,z.lineStartIndex+z.lineLength,_,y,H,w,I);if(!ee)return{notEnoughRoom:!0};X=[ee]}for(const ee of X)s.ak(B,ee.point,ee.angle);return{}}function Tr(z,A,x,L,O,y){const a=Vt(z.add(z.sub(A)._unit()),O,y).point,d=x.sub(a);return x.add(d._mult(L/d.mag()))}function Qe(z,A){const{projectionCache:x,lineVertexArray:L,labelPlaneMatrix:O,tileAnchorPoint:y,distanceFromAnchor:a,getElevation:d,previousVertex:_,direction:B,absOffsetX:T}=A;if(x.projections[z])return x.projections[z];const U=new s.P(L.getx(z),L.gety(z)),H=Vt(U,O,d);if(H.signedDistanceFromCamera>0)return x.projections[z]=H.point,H.point;const q=z-B;return Tr(a===0?y:new s.P(L.getx(q),L.gety(q)),U,_,T-a+1,O,d)}function Be(z,A,x){return z._unit()._perp()._mult(A*x)}function ae(z,A,x,L,O,y,a,d){const{projectionCache:_,direction:B}=d;if(_.offsets[z])return _.offsets[z];const T=x.add(A);if(z+B<L||z+B>=O)return _.offsets[z]=T,T;const U=Qe(z+B,d),H=Be(U.sub(x),a,B),q=x.add(H),w=U.add(H);return _.offsets[z]=s.al(y,T,q,w)||T,_.offsets[z]}function ie(z,A,x,L,O,y,a,d,_,B,T,U,H,q){const w=L?z-A:z+A;let I=w>0?1:-1,k=0;L&&(I*=-1,k=Math.PI),I<0&&(k+=Math.PI);let j,Y,X=I>0?d+a:d+a+1,ee=O,re=O,le=0,pe=0;const ge=Math.abs(w),we=[];let De;for(;le+pe<=ge;){if(X+=I,X<d||X>=_)return null;le+=pe,re=ee,Y=j;const We={projectionCache:U,lineVertexArray:B,labelPlaneMatrix:T,tileAnchorPoint:y,distanceFromAnchor:le,getElevation:q,previousVertex:re,direction:I,absOffsetX:ge};if(ee=Qe(X,We),x===0)we.push(re),De=ee.sub(re);else{let ke;const Ve=ee.sub(re);ke=Ve.mag()===0?Be(Qe(X+I,We).sub(ee),x,I):Be(Ve,x,I),Y||(Y=re.add(ke)),j=ae(X,ke,ee,d,_,Y,x,We),we.push(Y),De=j.sub(Y)}pe=De.mag()}const Me=De._mult((ge-le)/pe)._add(Y||re),st=k+Math.atan2(ee.y-re.y,ee.x-re.x);return we.push(Me),{point:Me,angle:H?st:0,path:we}}const ce=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function me(z,A){for(let x=0;x<z;x++){const L=A.length;A.resize(L+4),A.float32.set(ce,3*L)}}function be(z,A,x){const L=A[0],O=A[1];return z[0]=x[0]*L+x[4]*O+x[12],z[1]=x[1]*L+x[5]*O+x[13],z[3]=x[3]*L+x[7]*O+x[15],z}const Ee=100;class xe{constructor(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ui(A.width+200,A.height+200,25),L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ui(A.width+200,A.height+200,25);this.transform=A,this.grid=x,this.ignoredGrid=L,this.pitchfactor=Math.cos(A._pitch)*A.cameraToCenterDistance,this.screenRightBoundary=A.width+Ee,this.screenBottomBoundary=A.height+Ee,this.gridRightBoundary=A.width+200,this.gridBottomBoundary=A.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(A,x,L,O,y,a){const d=this.projectAndGetPerspectiveRatio(O,A.anchorPointX,A.anchorPointY,a),_=L*d.perspectiveRatio,B=A.x1*_+d.point.x,T=A.y1*_+d.point.y,U=A.x2*_+d.point.x,H=A.y2*_+d.point.y;return!this.isInsideGrid(B,T,U,H)||x!=="always"&&this.grid.hitTest(B,T,U,H,x,y)||d.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[B,T,U,H],offscreen:this.isOffscreen(B,T,U,H)}}placeCollisionCircles(A,x,L,O,y,a,d,_,B,T,U,H,q,w){const I=[],k=new s.P(x.anchorX,x.anchorY),j=Vt(k,a,w),Y=Ci(this.transform.cameraToCenterDistance,j.signedDistanceFromCamera),X=(T?y/Y:y*Y)/s.ap,ee=Vt(k,d,w).point,re=bi(X,O,x.lineOffsetX*X,x.lineOffsetY*X,!1,ee,k,x,L,d,{projections:{},offsets:{}},!1,w);let le=!1,pe=!1,ge=!0;if(re){const we=.5*H*Y+q,De=new s.P(-100,-100),Me=new s.P(this.screenRightBoundary,this.screenBottomBoundary),st=new zt,We=re.first,ke=re.last;let Ve=[];for(let At=We.path.length-1;At>=1;At--)Ve.push(We.path[At]);for(let At=1;At<ke.path.length;At++)Ve.push(ke.path[At]);const gt=2.5*we;if(_){const At=Ve.map(kt=>Vt(kt,_,w));Ve=At.some(kt=>kt.signedDistanceFromCamera<=0)?[]:At.map(kt=>kt.point)}let xt=[];if(Ve.length>0){const At=Ve[0].clone(),kt=Ve[0].clone();for(let Rt=1;Rt<Ve.length;Rt++)At.x=Math.min(At.x,Ve[Rt].x),At.y=Math.min(At.y,Ve[Rt].y),kt.x=Math.max(kt.x,Ve[Rt].x),kt.y=Math.max(kt.y,Ve[Rt].y);xt=At.x>=De.x&&kt.x<=Me.x&&At.y>=De.y&&kt.y<=Me.y?[Ve]:kt.x<De.x||At.x>Me.x||kt.y<De.y||At.y>Me.y?[]:s.am([Ve],De.x,De.y,Me.x,Me.y)}for(const At of xt){st.reset(At,.25*we);let kt=0;kt=st.length<=.5*we?1:Math.ceil(st.paddedLength/gt)+1;for(let Rt=0;Rt<kt;Rt++){const Ai=Rt/Math.max(kt-1,1),Ht=st.lerp(Ai),vi=Ht.x+Ee,Ti=Ht.y+Ee;I.push(vi,Ti,we,0);const er=vi-we,Ii=Ti-we,_r=vi+we,pr=Ti+we;if(ge=ge&&this.isOffscreen(er,Ii,_r,pr),pe=pe||this.isInsideGrid(er,Ii,_r,pr),A!=="always"&&this.grid.hitTestCircle(vi,Ti,we,A,U)&&(le=!0,!B))return{circles:[],offscreen:!1,collisionDetected:le}}}}return{circles:!B&&le||!pe||Y<this.perspectiveRatioCutoff?[]:I,offscreen:ge,collisionDetected:le}}queryRenderedSymbols(A){if(A.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const x=[];let L=1/0,O=1/0,y=-1/0,a=-1/0;for(const T of A){const U=new s.P(T.x+Ee,T.y+Ee);L=Math.min(L,U.x),O=Math.min(O,U.y),y=Math.max(y,U.x),a=Math.max(a,U.y),x.push(U)}const d=this.grid.query(L,O,y,a).concat(this.ignoredGrid.query(L,O,y,a)),_={},B={};for(const T of d){const U=T.key;if(_[U.bucketInstanceId]===void 0&&(_[U.bucketInstanceId]={}),_[U.bucketInstanceId][U.featureIndex])continue;const H=[new s.P(T.x1,T.y1),new s.P(T.x2,T.y1),new s.P(T.x2,T.y2),new s.P(T.x1,T.y2)];s.an(x,H)&&(_[U.bucketInstanceId][U.featureIndex]=!0,B[U.bucketInstanceId]===void 0&&(B[U.bucketInstanceId]=[]),B[U.bucketInstanceId].push(U.featureIndex))}return B}insertCollisionBox(A,x,L,O,y,a){(L?this.ignoredGrid:this.grid).insert({bucketInstanceId:O,featureIndex:y,collisionGroupID:a,overlapMode:x},A[0],A[1],A[2],A[3])}insertCollisionCircles(A,x,L,O,y,a){const d=L?this.ignoredGrid:this.grid,_={bucketInstanceId:O,featureIndex:y,collisionGroupID:a,overlapMode:x};for(let B=0;B<A.length;B+=4)d.insertCircle(_,A[B],A[B+1],A[B+2])}projectAndGetPerspectiveRatio(A,x,L,O){let y;return O?(y=[x,L,O(x,L),1],s.ag(y,y,A)):(y=[x,L,0,1],be(y,y,A)),{point:new s.P((y[0]/y[3]+1)/2*this.transform.width+Ee,(-y[1]/y[3]+1)/2*this.transform.height+Ee),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(A,x,L,O){return L<Ee||A>=this.screenRightBoundary||O<Ee||x>this.screenBottomBoundary}isInsideGrid(A,x,L,O){return L>=0&&A<this.gridRightBoundary&&O>=0&&x<this.gridBottomBoundary}getViewportMatrix(){const A=s.ao([]);return s.$(A,A,[-100,-100,0]),A}}function Fe(z,A,x){return A*(s.N/(z.tileSize*Math.pow(2,x-z.tileID.overscaledZ)))}class Ue{constructor(A,x,L,O){this.opacity=A?Math.max(0,Math.min(1,A.opacity+(A.placed?x:-x))):O&&L?1:0,this.placed=L}isHidden(){return this.opacity===0&&!this.placed}}class je{constructor(A,x,L,O,y){this.text=new Ue(A?A.text:null,x,L,y),this.icon=new Ue(A?A.icon:null,x,O,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nt{constructor(A,x,L){this.text=A,this.icon=x,this.skipFade=L}}class _t{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class St{constructor(A,x,L,O,y){this.bucketInstanceId=A,this.featureIndex=x,this.sourceLayerIndex=L,this.bucketIndex=O,this.tileID=y}}class ei{constructor(A){this.crossSourceCollisions=A,this.maxGroupID=0,this.collisionGroups={}}get(A){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[A]){const x=++this.maxGroupID;this.collisionGroups[A]={ID:x,predicate:L=>L.collisionGroupID===x}}return this.collisionGroups[A]}}function $t(z,A,x,L,O){const{horizontalAlign:y,verticalAlign:a}=s.au(z);return new s.P(-(y-.5)*A+L[0]*O,-(a-.5)*x+L[1]*O)}function Wt(z,A,x,L,O,y){const{x1:a,x2:d,y1:_,y2:B,anchorPointX:T,anchorPointY:U}=z,H=new s.P(A,x);return L&&H._rotate(O?y:-y),{x1:a+H.x,y1:_+H.y,x2:d+H.x,y2:B+H.y,anchorPointX:T,anchorPointY:U}}class oi{constructor(A,x,L,O,y){this.transform=A.clone(),this.terrain=x,this.collisionIndex=new xe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=L,this.retainedQueryData={},this.collisionGroups=new ei(O),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(A,x,L,O){const y=L.getBucket(x),a=L.latestFeatureIndex;if(!y||!a||x.id!==y.layerIds[0])return;const d=L.collisionBoxArray,_=y.layers[0].layout,B=Math.pow(2,this.transform.zoom-L.tileID.overscaledZ),T=L.tileSize/s.N,U=this.transform.calculatePosMatrix(L.tileID.toUnwrapped()),H=_.get("text-pitch-alignment")==="map",q=_.get("text-rotation-alignment")==="map",w=Fe(L,1,this.transform.zoom),I=Kt(U,H,q,this.transform,w);let k=null;if(H){const Y=Ji(U,H,q,this.transform,w);k=s.a1([],this.transform.labelPlaneMatrix,Y)}this.retainedQueryData[y.bucketInstanceId]=new St(y.bucketInstanceId,a,y.sourceLayerIndex,y.index,L.tileID);const j={bucket:y,layout:_,posMatrix:U,textLabelPlaneMatrix:I,labelToScreenMatrix:k,scale:B,textPixelRatio:T,holdingForFade:L.holdingForFade(),collisionBoxArray:d,partiallyEvaluatedTextSize:s.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(O)for(const Y of y.sortKeyRanges){const{sortKey:X,symbolInstanceStart:ee,symbolInstanceEnd:re}=Y;A.push({sortKey:X,symbolInstanceStart:ee,symbolInstanceEnd:re,parameters:j})}else A.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:j})}attemptAnchorPlacement(A,x,L,O,y,a,d,_,B,T,U,H,q,w,I,k){const j=s.aq[A.textAnchor],Y=[A.textOffset0,A.textOffset1],X=$t(j,L,O,Y,y),ee=this.collisionIndex.placeCollisionBox(Wt(x,X.x,X.y,a,d,this.transform.angle),U,_,B,T.predicate,k);if((!I||this.collisionIndex.placeCollisionBox(Wt(I,X.x,X.y,a,d,this.transform.angle),U,_,B,T.predicate,k).box.length!==0)&&ee.box.length>0){let re;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(re=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Y,width:L,height:O,anchor:j,textBoxScale:y,prevAnchor:re},this.markUsedJustification(q,j,H,w),q.allowVerticalPlacement&&(this.markUsedOrientation(q,w,H),this.placedOrientations[H.crossTileID]=w),{shift:X,placedGlyphBoxes:ee}}}placeLayerBucketPart(A,x,L){const{bucket:O,layout:y,posMatrix:a,textLabelPlaneMatrix:d,labelToScreenMatrix:_,textPixelRatio:B,holdingForFade:T,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:q}=A.parameters,w=y.get("text-optional"),I=y.get("icon-optional"),k=s.ar(y,"text-overlap","text-allow-overlap"),j=k==="always",Y=s.ar(y,"icon-overlap","icon-allow-overlap"),X=Y==="always",ee=y.get("text-rotation-alignment")==="map",re=y.get("text-pitch-alignment")==="map",le=y.get("icon-text-fit")!=="none",pe=y.get("symbol-z-order")==="viewport-y",ge=j&&(X||!O.hasIconData()||I),we=X&&(j||!O.hasTextData()||w);!O.collisionArrays&&U&&O.deserializeCollisionBoxes(U);const De=this.retainedQueryData[O.bucketInstanceId].tileID,Me=this.terrain?(We,ke)=>this.terrain.getElevation(De,We,ke):null,st=(We,ke)=>{var Ve,gt;if(x[We.crossTileID])return;if(T)return void(this.placements[We.crossTileID]=new nt(!1,!1,!1));let xt=!1,At=!1,kt=!0,Rt=null,Ai={box:null,offscreen:null},Ht={box:null,offscreen:null},vi=null,Ti=null,er=null,Ii=0,_r=0,pr=0;ke.textFeatureIndex?Ii=ke.textFeatureIndex:We.useRuntimeCollisionCircles&&(Ii=We.featureIndex),ke.verticalTextFeatureIndex&&(_r=ke.verticalTextFeatureIndex);const qi=ke.textBox;if(qi){const Pr=zr=>{let gr=s.ai.horizontal;if(O.allowVerticalPlacement&&!zr&&this.prevPlacement){const vr=this.prevPlacement.placedOrientations[We.crossTileID];vr&&(this.placedOrientations[We.crossTileID]=vr,gr=vr,this.markUsedOrientation(O,gr,We))}return gr},Wr=(zr,gr)=>{if(O.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const vr of O.writingModes)if(vr===s.ai.vertical?(Ai=gr(),Ht=Ai):Ai=zr(),Ai&&Ai.box&&Ai.box.length)break}else Ai=zr()},Er=We.textAnchorOffsetStartIndex,is=We.textAnchorOffsetEndIndex;if(is===Er){const zr=(gr,vr)=>{const ar=this.collisionIndex.placeCollisionBox(gr,k,B,a,q.predicate,Me);return ar&&ar.box&&ar.box.length&&(this.markUsedOrientation(O,vr,We),this.placedOrientations[We.crossTileID]=vr),ar};Wr(()=>zr(qi,s.ai.horizontal),()=>{const gr=ke.verticalTextBox;return O.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&gr?zr(gr,s.ai.vertical):{box:null,offscreen:null}}),Pr(Ai&&Ai.box&&Ai.box.length)}else{let zr=s.aq[(gt=(Ve=this.prevPlacement)===null||Ve===void 0?void 0:Ve.variableOffsets[We.crossTileID])===null||gt===void 0?void 0:gt.anchor];const gr=(ar,cn,$r)=>{const Xr=ar.x2-ar.x1,Fn=ar.y2-ar.y1,Wn=We.textBoxScale,vl=le&&Y==="never"?cn:null;let Kr={box:[],offscreen:!1},vn=k==="never"?1:2,ia="never";zr&&vn++;for(let Us=0;Us<vn;Us++){for(let Xs=Er;Xs<is;Xs++){const Uo=O.textAnchorOffsets.get(Xs);if(zr&&Uo.textAnchor!==zr)continue;const ao=this.attemptAnchorPlacement(Uo,ar,Xr,Fn,Wn,ee,re,B,a,q,ia,We,O,$r,vl,Me);if(ao&&(Kr=ao.placedGlyphBoxes,Kr&&Kr.box&&Kr.box.length))return xt=!0,Rt=ao.shift,Kr}zr?zr=null:ia=k}return Kr};Wr(()=>gr(qi,ke.iconBox,s.ai.horizontal),()=>{const ar=ke.verticalTextBox;return O.allowVerticalPlacement&&!(Ai&&Ai.box&&Ai.box.length)&&We.numVerticalGlyphVertices>0&&ar?gr(ar,ke.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),Ai&&(xt=Ai.box,kt=Ai.offscreen);const vr=Pr(Ai&&Ai.box);if(!xt&&this.prevPlacement){const ar=this.prevPlacement.variableOffsets[We.crossTileID];ar&&(this.variableOffsets[We.crossTileID]=ar,this.markUsedJustification(O,ar.anchor,We,vr))}}}if(vi=Ai,xt=vi&&vi.box&&vi.box.length>0,kt=vi&&vi.offscreen,We.useRuntimeCollisionCircles){const Pr=O.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex),Wr=s.aj(O.textSizeData,H,Pr),Er=y.get("text-padding");Ti=this.collisionIndex.placeCollisionCircles(k,Pr,O.lineVertexArray,O.glyphOffsetArray,Wr,a,d,_,L,re,q.predicate,We.collisionCircleDiameter,Er,Me),Ti.circles.length&&Ti.collisionDetected&&!L&&s.w("Collisions detected, but collision boxes are not shown"),xt=j||Ti.circles.length>0&&!Ti.collisionDetected,kt=kt&&Ti.offscreen}if(ke.iconFeatureIndex&&(pr=ke.iconFeatureIndex),ke.iconBox){const Pr=Wr=>{const Er=le&&Rt?Wt(Wr,Rt.x,Rt.y,ee,re,this.transform.angle):Wr;return this.collisionIndex.placeCollisionBox(Er,Y,B,a,q.predicate,Me)};Ht&&Ht.box&&Ht.box.length&&ke.verticalIconBox?(er=Pr(ke.verticalIconBox),At=er.box.length>0):(er=Pr(ke.iconBox),At=er.box.length>0),kt=kt&&er.offscreen}const Nr=w||We.numHorizontalGlyphVertices===0&&We.numVerticalGlyphVertices===0,nn=I||We.numIconVertices===0;if(Nr||nn?nn?Nr||(At=At&&xt):xt=At&&xt:At=xt=At&&xt,xt&&vi&&vi.box&&this.collisionIndex.insertCollisionBox(vi.box,k,y.get("text-ignore-placement"),O.bucketInstanceId,Ht&&Ht.box&&_r?_r:Ii,q.ID),At&&er&&this.collisionIndex.insertCollisionBox(er.box,Y,y.get("icon-ignore-placement"),O.bucketInstanceId,pr,q.ID),Ti&&(xt&&this.collisionIndex.insertCollisionCircles(Ti.circles,k,y.get("text-ignore-placement"),O.bucketInstanceId,Ii,q.ID),L)){const Pr=O.bucketInstanceId;let Wr=this.collisionCircleArrays[Pr];Wr===void 0&&(Wr=this.collisionCircleArrays[Pr]=new _t);for(let Er=0;Er<Ti.circles.length;Er+=4)Wr.circles.push(Ti.circles[Er+0]),Wr.circles.push(Ti.circles[Er+1]),Wr.circles.push(Ti.circles[Er+2]),Wr.circles.push(Ti.collisionDetected?1:0)}if(We.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(O.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[We.crossTileID]=new nt(xt||ge,At||we,kt||O.justReloaded),x[We.crossTileID]=!0};if(pe){if(A.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const We=O.getSortedSymbolIndexes(this.transform.angle);for(let ke=We.length-1;ke>=0;--ke){const Ve=We[ke];st(O.symbolInstances.get(Ve),O.collisionArrays[Ve])}}else for(let We=A.symbolInstanceStart;We<A.symbolInstanceEnd;We++)st(O.symbolInstances.get(We),O.collisionArrays[We]);if(L&&O.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[O.bucketInstanceId];s.as(We.invProjMatrix,a),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(A,x,L,O){let y;y=O===s.ai.vertical?L.verticalPlacedTextSymbolIndex:{left:L.leftJustifiedTextSymbolIndex,center:L.centerJustifiedTextSymbolIndex,right:L.rightJustifiedTextSymbolIndex}[s.at(x)];const a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex,L.verticalPlacedTextSymbolIndex];for(const d of a)d>=0&&(A.text.placedSymbolArray.get(d).crossTileID=y>=0&&d!==y?0:L.crossTileID)}markUsedOrientation(A,x,L){const O=x===s.ai.horizontal||x===s.ai.horizontalOnly?x:0,y=x===s.ai.vertical?x:0,a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex];for(const d of a)A.text.placedSymbolArray.get(d).placedOrientation=O;L.verticalPlacedTextSymbolIndex&&(A.text.placedSymbolArray.get(L.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(A){this.commitTime=A,this.zoomAtLastRecencyCheck=this.transform.zoom;const x=this.prevPlacement;let L=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;const O=x?x.symbolFadeChange(A):1,y=x?x.opacities:{},a=x?x.variableOffsets:{},d=x?x.placedOrientations:{};for(const _ in this.placements){const B=this.placements[_],T=y[_];T?(this.opacities[_]=new je(T,O,B.text,B.icon),L=L||B.text!==T.text.placed||B.icon!==T.icon.placed):(this.opacities[_]=new je(null,O,B.text,B.icon,B.skipFade),L=L||B.text||B.icon)}for(const _ in y){const B=y[_];if(!this.opacities[_]){const T=new je(B,O,!1,!1);T.isHidden()||(this.opacities[_]=T,L=L||B.text.placed||B.icon.placed)}}for(const _ in a)this.variableOffsets[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.variableOffsets[_]=a[_]);for(const _ in d)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=d[_]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");L?this.lastPlacementChangeTime=A:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:A)}updateLayerOpacities(A,x){const L={};for(const O of x){const y=O.getBucket(A);y&&O.latestFeatureIndex&&A.id===y.layerIds[0]&&this.updateBucketOpacities(y,L,O.collisionBoxArray)}}updateBucketOpacities(A,x,L){A.hasTextData()&&(A.text.opacityVertexArray.clear(),A.text.hasVisibleVertices=!1),A.hasIconData()&&(A.icon.opacityVertexArray.clear(),A.icon.hasVisibleVertices=!1),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexArray.clear(),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexArray.clear();const O=A.layers[0],y=O.layout,a=new je(null,0,!1,!1,!0),d=y.get("text-allow-overlap"),_=y.get("icon-allow-overlap"),B=O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=y.get("text-rotation-alignment")==="map",U=y.get("text-pitch-alignment")==="map",H=y.get("icon-text-fit")!=="none",q=new je(null,0,d&&(_||!A.hasIconData()||y.get("icon-optional")),_&&(d||!A.hasTextData()||y.get("text-optional")),!0);!A.collisionArrays&&L&&(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData())&&A.deserializeCollisionBoxes(L);const w=(I,k,j)=>{for(let Y=0;Y<k/4;Y++)I.opacityVertexArray.emplaceBack(j);I.hasVisibleVertices=I.hasVisibleVertices||j!==on};for(let I=0;I<A.symbolInstances.length;I++){const k=A.symbolInstances.get(I),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:Y,crossTileID:X}=k;let ee=this.opacities[X];x[X]?ee=a:ee||(ee=q,this.opacities[X]=ee),x[X]=!0;const re=k.numIconVertices>0,le=this.placedOrientations[k.crossTileID],pe=le===s.ai.vertical,ge=le===s.ai.horizontal||le===s.ai.horizontalOnly;if(j>0||Y>0){const we=Ar(ee.text);w(A.text,j,pe?on:we),w(A.text,Y,ge?on:we);const De=ee.text.isHidden();[k.rightJustifiedTextSymbolIndex,k.centerJustifiedTextSymbolIndex,k.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(A.text.placedSymbolArray.get(We).hidden=De||pe?1:0)}),k.verticalPlacedTextSymbolIndex>=0&&(A.text.placedSymbolArray.get(k.verticalPlacedTextSymbolIndex).hidden=De||ge?1:0);const Me=this.variableOffsets[k.crossTileID];Me&&this.markUsedJustification(A,Me.anchor,k,le);const st=this.placedOrientations[k.crossTileID];st&&(this.markUsedJustification(A,"left",k,st),this.markUsedOrientation(A,st,k))}if(re){const we=Ar(ee.icon),De=!(H&&k.verticalPlacedIconSymbolIndex&&pe);k.placedIconSymbolIndex>=0&&(w(A.icon,k.numIconVertices,De?we:on),A.icon.placedSymbolArray.get(k.placedIconSymbolIndex).hidden=ee.icon.isHidden()),k.verticalPlacedIconSymbolIndex>=0&&(w(A.icon,k.numVerticalIconVertices,De?on:we),A.icon.placedSymbolArray.get(k.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData()){const we=A.collisionArrays[I];if(we){let De=new s.P(0,0);if(we.textBox||we.verticalTextBox){let st=!0;if(B){const We=this.variableOffsets[X];We?(De=$t(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale),T&&De._rotate(U?this.transform.angle:-this.transform.angle)):st=!1}we.textBox&&Ei(A.textCollisionBox.collisionVertexArray,ee.text.placed,!st||pe,De.x,De.y),we.verticalTextBox&&Ei(A.textCollisionBox.collisionVertexArray,ee.text.placed,!st||ge,De.x,De.y)}const Me=!!(!ge&&we.verticalIconBox);we.iconBox&&Ei(A.iconCollisionBox.collisionVertexArray,ee.icon.placed,Me,H?De.x:0,H?De.y:0),we.verticalIconBox&&Ei(A.iconCollisionBox.collisionVertexArray,ee.icon.placed,!Me,H?De.x:0,H?De.y:0)}}}if(A.sortFeatures(this.transform.angle),this.retainedQueryData[A.bucketInstanceId]&&(this.retainedQueryData[A.bucketInstanceId].featureSortOrder=A.featureSortOrder),A.hasTextData()&&A.text.opacityVertexBuffer&&A.text.opacityVertexBuffer.updateData(A.text.opacityVertexArray),A.hasIconData()&&A.icon.opacityVertexBuffer&&A.icon.opacityVertexBuffer.updateData(A.icon.opacityVertexArray),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexBuffer&&A.iconCollisionBox.collisionVertexBuffer.updateData(A.iconCollisionBox.collisionVertexArray),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexBuffer&&A.textCollisionBox.collisionVertexBuffer.updateData(A.textCollisionBox.collisionVertexArray),A.text.opacityVertexArray.length!==A.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${A.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${A.text.layoutVertexArray.length}) / 4`);if(A.icon.opacityVertexArray.length!==A.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${A.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${A.icon.layoutVertexArray.length}) / 4`);if(A.bucketInstanceId in this.collisionCircleArrays){const I=this.collisionCircleArrays[A.bucketInstanceId];A.placementInvProjMatrix=I.invProjMatrix,A.placementViewportMatrix=I.viewportMatrix,A.collisionCircleArray=I.circles,delete this.collisionCircleArrays[A.bucketInstanceId]}}symbolFadeChange(A){return this.fadeDuration===0?1:(A-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(A){return Math.max(0,(this.transform.zoom-A)/1.5)}hasTransitions(A){return this.stale||A-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(A,x){const L=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*L>A}setStale(){this.stale=!0}}function Ei(z,A,x,L,O){z.emplaceBack(A?1:0,x?1:0,L||0,O||0),z.emplaceBack(A?1:0,x?1:0,L||0,O||0),z.emplaceBack(A?1:0,x?1:0,L||0,O||0),z.emplaceBack(A?1:0,x?1:0,L||0,O||0)}const Gi=Math.pow(2,25),Bi=Math.pow(2,24),Ni=Math.pow(2,17),ot=Math.pow(2,16),ii=Math.pow(2,9),Qt=Math.pow(2,8),Qi=Math.pow(2,1);function Ar(z){if(z.opacity===0&&!z.placed)return 0;if(z.opacity===1&&z.placed)return 4294967295;const A=z.placed?1:0,x=Math.floor(127*z.opacity);return x*Gi+A*Bi+x*Ni+A*ot+x*ii+A*Qt+x*Qi+A}const on=0;class xn{constructor(A){this._sortAcrossTiles=A.layout.get("symbol-z-order")!=="viewport-y"&&!A.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(A,x,L,O,y){const a=this._bucketParts;for(;this._currentTileIndex<A.length;)if(x.getBucketParts(a,O,A[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((d,_)=>d.sortKey-_.sortKey));this._currentPartIndex<a.length;)if(x.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,L),this._currentPartIndex++,y())return!0;return!1}}class hr{constructor(A,x,L,O,y,a,d,_){this.placement=new oi(A,x,a,d,_),this._currentPlacementIndex=L.length-1,this._forceFullPlacement=O,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(A,x,L){const O=s.h.now(),y=()=>!this._forceFullPlacement&&s.h.now()-O>2;for(;this._currentPlacementIndex>=0;){const a=x[A[this._currentPlacementIndex]],d=this.placement.collisionIndex.transform.zoom;if(a.type==="symbol"&&(!a.minzoom||a.minzoom<=d)&&(!a.maxzoom||a.maxzoom>d)){if(this._inProgressLayer||(this._inProgressLayer=new xn(a)),this._inProgressLayer.continuePlacement(L[a.source],this.placement,this._showCollisionBoxes,a,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(A){return this.placement.commit(A),this.placement}}const mn=512/s.N/2;class yn{constructor(A,x,L){this.tileID=A,this.bucketInstanceId=L,this._symbolsByKey={};const O=new Map;for(let y=0;y<x.length;y++){const a=x.get(y),d=a.key,_=O.get(d);_?_.push(a):O.set(d,[a])}for(const[y,a]of O){const d={positions:a.map(_=>({x:Math.floor(_.anchorX*mn),y:Math.floor(_.anchorY*mn)})),crossTileIDs:a.map(_=>_.crossTileID)};if(d.positions.length>128){const _=new s.av(d.positions.length,16,Uint16Array);for(const{x:B,y:T}of d.positions)_.add(B,T);_.finish(),delete d.positions,d.index=_}this._symbolsByKey[y]=d}}getScaledCoordinates(A,x){const{x:L,y:O,z:y}=this.tileID.canonical,{x:a,y:d,z:_}=x.canonical,B=mn/Math.pow(2,_-y),T=(d*s.N+A.anchorY)*B,U=O*s.N*mn;return{x:Math.floor((a*s.N+A.anchorX)*B-L*s.N*mn),y:Math.floor(T-U)}}findMatches(A,x,L){const O=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let y=0;y<A.length;y++){const a=A.get(y);if(a.crossTileID)continue;const d=this._symbolsByKey[a.key];if(!d)continue;const _=this.getScaledCoordinates(a,x);if(d.index){const B=d.index.range(_.x-O,_.y-O,_.x+O,_.y+O).sort();for(const T of B){const U=d.crossTileIDs[T];if(!L[U]){L[U]=!0,a.crossTileID=U;break}}}else if(d.positions)for(let B=0;B<d.positions.length;B++){const T=d.positions[B],U=d.crossTileIDs[B];if(Math.abs(T.x-_.x)<=O&&Math.abs(T.y-_.y)<=O&&!L[U]){L[U]=!0,a.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(A=>{let{crossTileIDs:x}=A;return x})}}class cr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class On{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(A){const x=Math.round((A-this.lng)/360);if(x!==0)for(const L in this.indexes){const O=this.indexes[L],y={};for(const a in O){const d=O[a];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+x),y[d.tileID.key]=d}this.indexes[L]=y}this.lng=A}addBucket(A,x,L){if(this.indexes[A.overscaledZ]&&this.indexes[A.overscaledZ][A.key]){if(this.indexes[A.overscaledZ][A.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(A.overscaledZ,this.indexes[A.overscaledZ][A.key])}for(let y=0;y<x.symbolInstances.length;y++)x.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[A.overscaledZ]||(this.usedCrossTileIDs[A.overscaledZ]={});const O=this.usedCrossTileIDs[A.overscaledZ];for(const y in this.indexes){const a=this.indexes[y];if(Number(y)>A.overscaledZ)for(const d in a){const _=a[d];_.tileID.isChildOf(A)&&_.findMatches(x.symbolInstances,A,O)}else{const d=a[A.scaledTo(Number(y)).key];d&&d.findMatches(x.symbolInstances,A,O)}}for(let y=0;y<x.symbolInstances.length;y++){const a=x.symbolInstances.get(y);a.crossTileID||(a.crossTileID=L.generate(),O[a.crossTileID]=!0)}return this.indexes[A.overscaledZ]===void 0&&(this.indexes[A.overscaledZ]={}),this.indexes[A.overscaledZ][A.key]=new yn(A,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(A,x){for(const L of x.getCrossTileIDsLists())for(const O of L)delete this.usedCrossTileIDs[A][O]}removeStaleBuckets(A){let x=!1;for(const L in this.indexes){const O=this.indexes[L];for(const y in O)A[O[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(L,O[y]),delete O[y],x=!0)}return x}}class ms{constructor(){this.layerIndexes={},this.crossTileIDs=new cr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(A,x,L){let O=this.layerIndexes[A.id];O===void 0&&(O=this.layerIndexes[A.id]=new On);let y=!1;const a={};O.handleWrapJump(L);for(const d of x){const _=d.getBucket(A);_&&A.id===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),O.addBucket(d.tileID,_,this.crossTileIDs)&&(y=!0),a[_.bucketInstanceId]=!0)}return O.removeStaleBuckets(a)&&(y=!0),y}pruneUnusedLayers(A){const x={};A.forEach(L=>{x[L]=!0});for(const L in this.layerIndexes)x[L]||delete this.layerIndexes[L]}}const Vr=(z,A)=>s.x(z,A&&A.filter(x=>x.identifier!=="source.canvas")),wn=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),To=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),hs=s.aw();class Xi extends s.E{constructor(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=A,this.dispatcher=new Xt(Sr(),this,A._getMapId()),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new Et(A._requestManager,x.localIdeographFontFamily),this.lineAtlas=new Pt(256,512),this.crossTileSymbolIndex=new ms,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const L=this;this._rtlTextPluginCallback=Xi.registerForPluginStateChange(O=>{L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},(y,a)=>{if(s.aA(y),a&&a.every(d=>d))for(const d in L.sourceCaches){const _=L.sourceCaches[d].getSource().type;_!=="vector"&&_!=="geojson"||L.sourceCaches[d].reload()}})}),this.on("data",O=>{if(O.dataType!=="source"||O.sourceDataType!=="metadata")return;const y=this.sourceCaches[O.sourceId];if(!y)return;const a=y.getSource();if(a&&a.vectorLayerIds)for(const d in this._layers){const _=this._layers[d];_.source===a.id&&this._validateLayer(_)}})}loadURL(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;const O=this.map._requestManager.transformRequest(A,ue.Style);this._request=s.f(O,(y,a)=>{this._request=null,y?this.fire(new s.j(y)):a&&this._load(a,x,L)})}loadJSON(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,x.validate=x.validate!==!1,this._load(A,x,L)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(hs,{validate:!1})}_load(A,x,L){var O;const y=x.transformStyle?x.transformStyle(L,A):A;if(!x.validate||!Vr(this,s.y(y))){this._loaded=!0,this.stylesheet=y;for(const a in y.sources)this.addSource(a,y.sources[a],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Dt(this.stylesheet.light),this.map.setTerrain((O=this.stylesheet.terrain)!==null&&O!==void 0?O:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const A=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",A),this._order=A.map(x=>x.id),this._layers={},this._serializedLayers=null;for(const x of A){const L=s.aC(x);L.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=L}}_loadSprite(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(O,y,a,d){const _=Ne(O),B=_.length,T=a>1?"@2x":"",U={},H={},q={};for(const{id:w,url:I}of _){const k=y.transformRequest(y.normalizeSpriteURL(I,T,".json"),ue.SpriteJSON),j=`${w}_${k.url}`;U[j]=s.f(k,(ee,re)=>{delete U[j],H[w]=re,at(d,H,q,ee,B)});const Y=y.transformRequest(y.normalizeSpriteURL(I,T,".png"),ue.SpriteImage),X=`${w}_${Y.url}`;U[X]=he.getImage(Y,(ee,re)=>{delete U[X],q[w]=re,at(d,H,q,ee,B)})}return{cancel(){for(const w of Object.values(U))w.cancel()}}}(A,this.map._requestManager,this.map.getPixelRatio(),(O,y)=>{if(this._spriteRequest=null,O)this.fire(new s.j(O));else if(y)for(const a in y){this._spritesImagesIds[a]=[];const d=this._spritesImagesIds[a]?this._spritesImagesIds[a].filter(_=>!(_ in y)):[];for(const _ of d)this.imageManager.removeImage(_),this._changedImages[_]=!0;for(const _ in y[a]){const B=a==="default"?_:`${a}:${_}`;this._spritesImagesIds[a].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,y[a][_],!1):this.imageManager.addImage(B,y[a][_]),x&&(this._changedImages[B]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),L&&L(O)})}_unloadSprite(){for(const A of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(A),this._changedImages[A]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(A){const x=this.sourceCaches[A.source];if(!x)return;const L=A.sourceLayer;if(!L)return;const O=x.getSource();(O.type==="geojson"||O.vectorLayerIds&&O.vectorLayerIds.indexOf(L)===-1)&&this.fire(new s.j(new Error(`Source layer "${L}" does not exist on source "${O.id}" as specified by style layer "${A.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const A in this.sourceCaches)if(!this.sourceCaches[A].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(A){const x=this._serializedAllLayers();if(!A||A.length===0)return Object.values(x);const L=[];for(const O of A)x[O]&&L.push(x[O]);return L}_serializedAllLayers(){let A=this._serializedLayers;if(A)return A;A=this._serializedLayers={};const x=Object.keys(this._layers);for(const L of x){const O=this._layers[L];O.type!=="custom"&&(A[L]=O.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(A){if(!this._loaded)return;const x=this._changed;if(this._changed){const O=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(O.length||y.length)&&this._updateWorkerLayers(O,y);for(const a in this._updatedSources){const d=this._updatedSources[a];if(d==="reload")this._reloadSource(a);else{if(d!=="clear")throw new Error(`Invalid action ${d}`);this._clearSource(a)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const a in this._updatedPaintProps)this._layers[a].updateTransitions(A);this.light.updateTransitions(A),this._resetUpdates()}const L={};for(const O in this.sourceCaches){const y=this.sourceCaches[O];L[O]=y.used,y.used=!1}for(const O of this._order){const y=this._layers[O];y.recalculate(A,this._availableImages),!y.isHidden(A.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const O in L){const y=this.sourceCaches[O];L[O]!==y.used&&y.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:O}))}this.light.recalculate(A),this.z=A.zoom,x&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const A=Object.keys(this._changedImages);if(A.length){for(const x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],A);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(A,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(A),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.serialize();if(A=x.transformStyle?x.transformStyle(L,A):A,Vr(this,s.y(A)))return!1;(A=s.aD(A)).layers=s.aB(A.layers);const O=s.aE(L,A).filter(a=>!(a.command in To));if(O.length===0)return!1;const y=O.filter(a=>!(a.command in wn));if(y.length>0)throw new Error(`Unimplemented: ${y.map(a=>a.command).join(", ")}.`);for(const a of O)a.command!=="setTransition"&&this[a.command].apply(this,a.args);return this.stylesheet=A,this._serializedLayers=null,!0}addImage(A,x){if(this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" already exists.`)));this.imageManager.addImage(A,x),this._afterImageUpdated(A)}updateImage(A,x){this.imageManager.updateImage(A,x)}getImage(A){return this.imageManager.getImage(A)}removeImage(A){if(!this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" does not exist.`)));this.imageManager.removeImage(A),this._afterImageUpdated(A)}_afterImageUpdated(A){this._availableImages=this.imageManager.listImages(),this._changedImages[A]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[A]!==void 0)throw new Error(`Source "${A}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(s.y.source,`sources.${A}`,x,null,L))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);const O=this.sourceCaches[A]=new qt(A,x,this.dispatcher);O.style=this,O.setEventedParent(this,()=>({isSourceLoaded:O.loaded(),source:O.serialize(),sourceId:A})),O.onAdd(this.map),this._changed=!0}removeSource(A){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error("There is no source with this ID");for(const L in this._layers)if(this._layers[L].source===A)return this.fire(new s.j(new Error(`Source "${A}" cannot be removed while layer "${L}" is using it.`)));const x=this.sourceCaches[A];delete this.sourceCaches[A],delete this._updatedSources[A],x.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:A})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(A,x){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error(`There is no source with this ID=${A}`);const L=this.sourceCaches[A].getSource();if(L.type!=="geojson")throw new Error(`geojsonSource.type is ${L.type}, which is !== 'geojson`);L.setData(x),this._changed=!0}getSource(A){return this.sourceCaches[A]&&this.sourceCaches[A].getSource()}addLayer(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=A.id;if(this.getLayer(O))return void this.fire(new s.j(new Error(`Layer "${O}" already exists on this map.`)));let y;if(A.type==="custom"){if(Vr(this,s.aF(A)))return;y=s.aC(A)}else{if("source"in A&&typeof A.source=="object"&&(this.addSource(O,A.source),A=s.aD(A),A=s.e(A,{source:O})),this._validate(s.y.layer,`layers.${O}`,A,{arrayIndex:-1},L))return;y=s.aC(A),this._validateLayer(y),y.setEventedParent(this,{layer:{id:O}})}const a=x?this._order.indexOf(x):this._order.length;if(x&&a===-1)this.fire(new s.j(new Error(`Cannot add layer "${O}" before non-existing layer "${x}".`)));else{if(this._order.splice(a,0,O),this._layerOrderChanged=!0,this._layers[O]=y,this._removedLayers[O]&&y.source&&y.type!=="custom"){const d=this._removedLayers[O];delete this._removedLayers[O],d.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(A,x){if(this._checkLoaded(),this._changed=!0,!this._layers[A])return void this.fire(new s.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be moved.`)));if(A===x)return;const L=this._order.indexOf(A);this._order.splice(L,1);const O=x?this._order.indexOf(x):this._order.length;x&&O===-1?this.fire(new s.j(new Error(`Cannot move layer "${A}" before non-existing layer "${x}".`))):(this._order.splice(O,0,A),this._layerOrderChanged=!0)}removeLayer(A){this._checkLoaded();const x=this._layers[A];if(!x)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${A}".`)));x.setEventedParent(null);const L=this._order.indexOf(A);this._order.splice(L,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[A]=x,delete this._layers[A],this._serializedLayers&&delete this._serializedLayers[A],delete this._updatedLayers[A],delete this._updatedPaintProps[A],x.onRemove&&x.onRemove(this.map)}getLayer(A){return this._layers[A]}getLayersOrder(){return[...this._order]}hasLayer(A){return A in this._layers}setLayerZoomRange(A,x,L){this._checkLoaded();const O=this.getLayer(A);O?O.minzoom===x&&O.maxzoom===L||(x!=null&&(O.minzoom=x),L!=null&&(O.maxzoom=L),this._updateLayer(O)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${A}".`)))}setFilter(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=this.getLayer(A);if(O){if(!s.aG(O.filter,x))return x==null?(O.filter=void 0,void this._updateLayer(O)):void(this._validate(s.y.filter,`layers.${O.id}.filter`,x,null,L)||(O.filter=s.aD(x),this._updateLayer(O)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${A}".`)))}getFilter(A){return s.aD(this.getLayer(A).filter)}setLayoutProperty(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getLayoutProperty(x),L)||(y.setLayoutProperty(x,L,O),this._updateLayer(y)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getLayoutProperty(A,x){const L=this.getLayer(A);if(L)return L.getLayoutProperty(x);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${A}".`)))}setPaintProperty(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getPaintProperty(x),L)||(y.setPaintProperty(x,L,O)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[A]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getPaintProperty(A,x){return this.getLayer(A).getPaintProperty(x)}setFeatureState(A,x){this._checkLoaded();const L=A.source,O=A.sourceLayer,y=this.sourceCaches[L];if(y===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const a=y.getSource().type;a==="geojson"&&O?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):a!=="vector"||O?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(O,A.id,x)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(A,x){this._checkLoaded();const L=A.source,O=this.sourceCaches[L];if(O===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const y=O.getSource().type,a=y==="vector"?A.sourceLayer:void 0;y!=="vector"||a?x&&typeof A.id!="string"&&typeof A.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):O.removeFeatureState(a,A.id,x):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(A){this._checkLoaded();const x=A.source,L=A.sourceLayer,O=this.sourceCaches[x];if(O!==void 0)return O.getSource().type!=="vector"||L?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),O.getFeatureState(L,A.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const A=s.aH(this.sourceCaches,y=>y.serialize()),x=this._serializeByIds(this._order),L=this.map.getTerrain()||void 0,O=this.stylesheet;return s.aI({version:O.version,name:O.name,metadata:O.metadata,light:O.light,center:O.center,zoom:O.zoom,bearing:O.bearing,pitch:O.pitch,sprite:O.sprite,glyphs:O.glyphs,transition:O.transition,sources:A,layers:x,terrain:L},y=>y!==void 0)}_updateLayer(A){this._updatedLayers[A.id]=!0,A.source&&!this._updatedSources[A.source]&&this.sourceCaches[A.source].getSource().type!=="raster"&&(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(A){const x=a=>this._layers[a].type==="fill-extrusion",L={},O=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(x(d)){L[d]=a;for(const _ of A){const B=_[d];if(B)for(const T of B)O.push(T)}}}O.sort((a,d)=>d.intersectionZ-a.intersectionZ);const y=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(x(d))for(let _=O.length-1;_>=0;_--){const B=O[_].feature;if(L[B.layer.id]<a)break;y.push(B),O.pop()}else for(const _ of A){const B=_[d];if(B)for(const T of B)y.push(T.feature)}}return y}queryRenderedFeatures(A,x,L){x&&x.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",x.filter,null,x);const O={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const d of x.layers){const _=this._layers[d];if(!_)return this.fire(new s.j(new Error(`The layer '${d}' does not exist in the map's style and cannot be queried for features.`))),[];O[_.source]=!0}}const y=[];x.availableImages=this._availableImages;const a=this._serializedAllLayers();for(const d in this.sourceCaches)x.layers&&!O[d]||y.push(lt(this.sourceCaches[d],this._layers,a,A,x,L));return this.placement&&y.push(function(d,_,B,T,U,H,q){const w={},I=H.queryRenderedSymbols(T),k=[];for(const j of Object.keys(I).map(Number))k.push(q[j]);k.sort(wt);for(const j of k){const Y=j.featureIndex.lookupSymbolFeatures(I[j.bucketInstanceId],_,j.bucketIndex,j.sourceLayerIndex,U.filter,U.layers,U.availableImages,d);for(const X in Y){const ee=w[X]=w[X]||[],re=Y[X];re.sort((le,pe)=>{const ge=j.featureSortOrder;if(ge){const we=ge.indexOf(le.featureIndex);return ge.indexOf(pe.featureIndex)-we}return pe.featureIndex-le.featureIndex});for(const le of re)ee.push(le)}}for(const j in w)w[j].forEach(Y=>{const X=Y.feature,ee=B[d[j].source].getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=ee});return w}(this._layers,a,this.sourceCaches,A,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(A,x){x&&x.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",x.filter,null,x);const L=this.sourceCaches[A];return L?function(O,y){const a=O.getRenderableIds().map(B=>O.getTileByID(B)),d=[],_={};for(let B=0;B<a.length;B++){const T=a[B],U=T.tileID.canonical.key;_[U]||(_[U]=!0,T.querySourceFeatures(d,y))}return d}(L,x):[]}addSourceType(A,x,L){return Pi(A)?L(new Error(`A source type called "${A}" already exists.`)):(((O,y)=>{yi[O]=y})(A,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:A,url:x.workerSourceURL},L):L(null,null))}getLight(){return this.light.getLight()}setLight(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.light.getLight();let O=!1;for(const a in A)if(!s.aG(A[a],L[a])){O=!0;break}if(!O)return;const y={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(A,x),this.light.updateTransitions(y)}_validate(A,x,L,O){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!y||y.validate!==!1)&&Vr(this,A.call(s.y,s.e({key:x,style:this.serialize(),value:L,styleSpec:s.v},O)))}_remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const x in this._layers)this._layers[x].setEventedParent(null);for(const x in this.sourceCaches){const L=this.sourceCaches[x];L.setEventedParent(null),L.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(A)}_clearSource(A){this.sourceCaches[A].clearTiles()}_reloadSource(A){this.sourceCaches[A].resume(),this.sourceCaches[A].reload()}_updateSources(A){for(const x in this.sourceCaches)this.sourceCaches[x].update(A,this.map.terrain)}_generateCollisionBoxes(){for(const A in this.sourceCaches)this._reloadSource(A)}_updatePlacement(A,x,L,O){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,a=!1,d=!1;const _={};for(const B of this._order){const T=this._layers[B];if(T.type!=="symbol")continue;if(!_[T.source]){const H=this.sourceCaches[T.source];_[T.source]=H.getRenderableIds(!0).map(q=>H.getTileByID(q)).sort((q,w)=>w.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(w.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(T,_[T.source],A.center.lng);a=a||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||L===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),A.zoom))&&(this.pauseablePlacement=new hr(A,this.map.terrain,this._order,y,x,L,O,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),d=!0),a&&this.pauseablePlacement.placement.setStale()),d||a)for(const B of this._order){const T=this._layers[B];T.type==="symbol"&&this.placement.updateLayerOpacities(T,_[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const A in this.sourceCaches)this.sourceCaches[A].releaseSymbolFadeTiles()}getImages(A,x,L){this.imageManager.getImages(x.icons,L),this._updateTilesForChangedImages();const O=this.sourceCaches[x.source];O&&O.setDependencies(x.tileID.key,x.type,x.icons)}getGlyphs(A,x,L){this.glyphManager.getGlyphs(x.stacks,L);const O=this.sourceCaches[x.source];O&&O.setDependencies(x.tileID.key,x.type,[""])}getResource(A,x,L){return s.m(x,L)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),A&&this._validate(s.y.glyphs,"glyphs",A,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=A,this.glyphManager.entries={},this.glyphManager.setURL(A))}addSprite(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const y=[{id:A,url:x}],a=[...Ne(this.stylesheet.sprite),...y];this._validate(s.y.sprite,"sprite",a,null,L)||(this.stylesheet.sprite=a,this._loadSprite(y,!0,O))}removeSprite(A){this._checkLoaded();const x=Ne(this.stylesheet.sprite);if(x.find(L=>L.id===A)){if(this._spritesImagesIds[A])for(const L of this._spritesImagesIds[A])this.imageManager.removeImage(L),this._changedImages[L]=!0;x.splice(x.findIndex(L=>L.id===A),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[A],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${A}" doesn't exists on this map.`)))}getSprite(){return Ne(this.stylesheet.sprite)}setSprite(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),A&&this._validate(s.y.sprite,"sprite",A,null,x)||(this.stylesheet.sprite=A,A?this._loadSprite(A,!0,L):(this._unloadSprite(),L&&L(null)))}}Xi.registerForPluginStateChange=s.aK;var eo=s.Q([{name:"a_pos",type:"Int16",components:2}]),Cs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const fr={prelude:Dr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Dr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Dr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Dr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Dr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Dr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Dr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Dr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Dr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Dr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Dr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Dr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Dr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Dr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Dr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Dr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Dr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Dr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Dr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Dr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Dr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Dr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cs),terrainDepth:Dr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cs),terrainCoords:Dr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cs)};function Dr(z,A){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,L=A.match(/attribute ([\w]+) ([\w]+)/g),O=z.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=y?y.concat(O):O,d={};return{fragmentSource:z=z.replace(x,(_,B,T,U,H)=>(d[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${T} ${U} ${H};
#else
uniform ${T} ${U} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${T} ${U} ${H} = u_${H};
#endif
`)),vertexSource:A=A.replace(x,(_,B,T,U,H)=>{const q=U==="float"?"vec2":"vec4",w=H.match(/color/)?"color":q;return d[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${T} ${q} a_${H};
varying ${T} ${U} ${H};
#else
uniform ${T} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${T} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${T} ${U} ${H} = u_${H};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${T} ${q} a_${H};
#else
uniform ${T} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${T} ${U} ${H} = a_${H};
#else
    ${T} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${T} ${U} ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${T} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:L,staticUniforms:a}}class Gn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(A,x,L,O,y,a,d,_,B){this.context=A;let T=this.boundPaintVertexBuffers.length!==O.length;for(let U=0;!T&&U<O.length;U++)this.boundPaintVertexBuffers[U]!==O[U]&&(T=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==L||T||this.boundIndexBuffer!==y||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==d||this.boundDynamicVertexBuffer2!==_||this.boundDynamicVertexBuffer3!==B?this.freshBind(x,L,O,y,a,d,_,B):(A.bindVertexArray.set(this.vao),d&&d.bind(),y&&y.dynamicDraw&&y.bind(),_&&_.bind(),B&&B.bind())}freshBind(A,x,L,O,y,a,d,_){const B=A.numAttributes,T=this.context,U=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=A,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=L,this.boundIndexBuffer=O,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=d,this.boundDynamicVertexBuffer3=_,x.enableAttributes(U,A);for(const H of L)H.enableAttributes(U,A);a&&a.enableAttributes(U,A),d&&d.enableAttributes(U,A),_&&_.enableAttributes(U,A),x.bind(),x.setVertexAttribPointers(U,A,y);for(const H of L)H.bind(),H.setVertexAttribPointers(U,A,y);a&&(a.bind(),a.setVertexAttribPointers(U,A,y)),O&&O.bind(),d&&(d.bind(),d.setVertexAttribPointers(U,A,y)),_&&(_.bind(),_.setVertexAttribPointers(U,A,y)),T.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ur(z){const A=[];for(let x=0;x<z.length;x++){if(z[x]===null)continue;const L=z[x].split(" ");A.push(L.pop())}return A}class Sn{constructor(A,x,L,O,y,a){const d=A.gl;this.program=d.createProgram();const _=Ur(x.staticAttributes),B=L?L.getBinderAttributes():[],T=_.concat(B),U=fr.prelude.staticUniforms?Ur(fr.prelude.staticUniforms):[],H=x.staticUniforms?Ur(x.staticUniforms):[],q=L?L.getBinderUniforms():[],w=U.concat(H).concat(q),I=[];for(const le of w)I.indexOf(le)<0&&I.push(le);const k=L?L.defines():[];y&&k.push("#define OVERDRAW_INSPECTOR;"),a&&k.push("#define TERRAIN3D;");const j=k.concat(fr.prelude.fragmentSource,x.fragmentSource).join(`
`),Y=k.concat(fr.prelude.vertexSource,x.vertexSource).join(`
`),X=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(X,j),d.compileShader(X),!d.getShaderParameter(X,d.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${d.getShaderInfoLog(X)}`);d.attachShader(this.program,X);const ee=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(ee,Y),d.compileShader(ee),!d.getShaderParameter(ee,d.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${d.getShaderInfoLog(ee)}`);d.attachShader(this.program,ee),this.attributes={};const re={};this.numAttributes=T.length;for(let le=0;le<this.numAttributes;le++)T[le]&&(d.bindAttribLocation(this.program,le,T[le]),this.attributes[T[le]]=le);if(d.linkProgram(this.program),!d.getProgramParameter(this.program,d.LINK_STATUS))throw new Error(`Program failed to link: ${d.getProgramInfoLog(this.program)}`);d.deleteShader(ee),d.deleteShader(X);for(let le=0;le<I.length;le++){const pe=I[le];if(pe&&!re[pe]){const ge=d.getUniformLocation(this.program,pe);ge&&(re[pe]=ge)}}this.fixedUniforms=O(A,re),this.terrainUniforms=((le,pe)=>({u_depth:new s.aL(le,pe.u_depth),u_terrain:new s.aL(le,pe.u_terrain),u_terrain_dim:new s.aM(le,pe.u_terrain_dim),u_terrain_matrix:new s.aN(le,pe.u_terrain_matrix),u_terrain_unpack:new s.aO(le,pe.u_terrain_unpack),u_terrain_exaggeration:new s.aM(le,pe.u_terrain_exaggeration)}))(A,re),this.binderUniforms=L?L.getUniforms(A,re):[]}draw(A,x,L,O,y,a,d,_,B,T,U,H,q,w,I,k,j,Y){const X=A.gl;if(this.failedToCreate)return;if(A.program.set(this.program),A.setDepthMode(L),A.setStencilMode(O),A.setColorMode(y),A.setCullFace(a),_){A.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,_.depthTexture),A.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,_.texture);for(const re in this.terrainUniforms)this.terrainUniforms[re].set(_[re])}for(const re in this.fixedUniforms)this.fixedUniforms[re].set(d[re]);I&&I.setUniforms(A,this.binderUniforms,q,{zoom:w});let ee=0;switch(x){case X.LINES:ee=2;break;case X.TRIANGLES:ee=3;break;case X.LINE_STRIP:ee=1}for(const re of H.get()){const le=re.vaos||(re.vaos={});(le[B]||(le[B]=new Gn)).bind(A,this,T,I?I.getPaintVertexBuffers():[],U,re.vertexOffset,k,j,Y),X.drawElements(x,re.primitiveLength*ee,X.UNSIGNED_SHORT,re.primitiveOffset*ee*2)}}}function dn(z,A,x){const L=1/Fe(x,1,A.transform.tileZoom),O=Math.pow(2,x.tileID.overscaledZ),y=x.tileSize*Math.pow(2,A.transform.tileZoom)/O,a=y*(x.tileID.canonical.x+x.tileID.wrap*O),d=y*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[L,z.fromScale,z.toScale],u_fade:z.t,u_pixel_coord_upper:[a>>16,d>>16],u_pixel_coord_lower:[65535&a,65535&d]}}const Gr=(z,A,x,L)=>{const O=A.style.light,y=O.properties.get("position"),a=[y.x,y.y,y.z],d=function(){var B=new s.A(9);return s.A!=Float32Array&&(B[1]=0,B[2]=0,B[3]=0,B[5]=0,B[6]=0,B[7]=0),B[0]=1,B[4]=1,B[8]=1,B}();O.properties.get("anchor")==="viewport"&&function(B,T){var U=Math.sin(T),H=Math.cos(T);B[0]=H,B[1]=U,B[2]=0,B[3]=-U,B[4]=H,B[5]=0,B[6]=0,B[7]=0,B[8]=1}(d,-A.transform.angle),function(B,T,U){var H=T[0],q=T[1],w=T[2];B[0]=H*U[0]+q*U[3]+w*U[6],B[1]=H*U[1]+q*U[4]+w*U[7],B[2]=H*U[2]+q*U[5]+w*U[8]}(a,a,d);const _=O.properties.get("color");return{u_matrix:z,u_lightpos:a,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+x,u_opacity:L}},js=(z,A,x,L,O,y,a)=>s.e(Gr(z,A,x,L),dn(y,A,a),{u_height_factor:-Math.pow(2,O.overscaledZ)/a.tileSize/8}),ha=z=>({u_matrix:z}),ho=(z,A,x,L)=>s.e(ha(z),dn(x,A,L)),Ta=(z,A)=>({u_matrix:z,u_world:A}),ze=(z,A,x,L,O)=>s.e(ho(z,A,x,L),{u_world:O}),Ye=(z,A,x,L)=>{const O=z.transform;let y,a;if(L.paint.get("circle-pitch-alignment")==="map"){const d=Fe(x,1,O.zoom);y=!0,a=[d,d]}else y=!1,a=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(L.paint.get("circle-pitch-scale")==="map"),u_matrix:z.translatePosMatrix(A.posMatrix,x,L.paint.get("circle-translate"),L.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:z.pixelRatio,u_extrude_scale:a}},ft=(z,A,x)=>{const L=Fe(x,1,A.zoom),O=Math.pow(2,A.zoom-x.tileID.overscaledZ),y=x.tileID.overscaleFactor();return{u_matrix:z,u_camera_to_center_distance:A.cameraToCenterDistance,u_pixels_to_tile_units:L,u_extrude_scale:[A.pixelsToGLUnits[0]/(L*O),A.pixelsToGLUnits[1]/(L*O)],u_overscale_factor:y}},Ut=function(z,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:z,u_color:A,u_overlay:0,u_overlay_scale:x}},hi=z=>({u_matrix:z}),ji=(z,A,x,L)=>({u_matrix:z,u_extrude_scale:Fe(A,1,x),u_intensity:L});function xr(z,A){const x=Math.pow(2,A.canonical.z),L=A.canonical.y;return[new s.U(0,L/x).toLngLat().lat,new s.U(0,(L+1)/x).toLngLat().lat]}const Tn=(z,A,x,L)=>{const O=z.transform;return{u_matrix:Ka(z,A,x,L),u_ratio:1/Fe(A,1,O.zoom),u_device_pixel_ratio:z.pixelRatio,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},Un=(z,A,x,L,O)=>s.e(Tn(z,A,x,O),{u_image:0,u_image_height:L}),ns=(z,A,x,L,O)=>{const y=z.transform,a=lu(A,y);return{u_matrix:Ka(z,A,x,O),u_texsize:A.imageAtlasTexture.size,u_ratio:1/Fe(A,1,y.zoom),u_device_pixel_ratio:z.pixelRatio,u_image:0,u_scale:[a,L.fromScale,L.toScale],u_fade:L.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Bn=(z,A,x,L,O,y)=>{const a=z.lineAtlas,d=lu(A,z.transform),_=x.layout.get("line-cap")==="round",B=a.getDash(L.from,_),T=a.getDash(L.to,_),U=B.width*O.fromScale,H=T.width*O.toScale;return s.e(Tn(z,A,x,y),{u_patternscale_a:[d/U,-B.height/2],u_patternscale_b:[d/H,-T.height/2],u_sdfgamma:a.width/(256*Math.min(U,H)*z.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:T.y,u_mix:O.t})};function lu(z,A){return 1/Fe(z,1,A.tileZoom)}function Ka(z,A,x,L){return z.translatePosMatrix(L?L.posMatrix:A.tileID.posMatrix,A,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}const Ir=(z,A,x,L,O)=>{return{u_matrix:z,u_tl_parent:A,u_scale_parent:x,u_buffer_scale:1,u_fade_t:L.mix,u_opacity:L.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(a=O.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(y=O.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Wa(O.paint.get("raster-hue-rotate"))};var y,a};function Wa(z){z*=Math.PI/180;const A=Math.sin(z),x=Math.cos(z);return[(2*x+1)/3,(-Math.sqrt(3)*A-x+1)/3,(Math.sqrt(3)*A-x+1)/3]}const Nl=(z,A,x,L,O,y,a,d,_,B)=>{const T=O.transform;return{u_is_size_zoom_constant:+(z==="constant"||z==="source"),u_is_size_feature_constant:+(z==="constant"||z==="camera"),u_size_t:A?A.uSizeT:0,u_size:A?A.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:T.width/T.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:a,u_coord_matrix:d,u_is_text:+_,u_pitch_with_map:+L,u_texsize:B,u_texture:0}},es=(z,A,x,L,O,y,a,d,_,B,T)=>{const U=O.transform;return s.e(Nl(z,A,x,L,O,y,a,d,_,B),{u_gamma_scale:L?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:+T})},Io=(z,A,x,L,O,y,a,d,_,B)=>s.e(es(z,A,x,L,O,y,a,d,!0,_,!0),{u_texsize_icon:B,u_texture_icon:1}),Xa=(z,A,x)=>({u_matrix:z,u_opacity:A,u_color:x}),ys=(z,A,x,L,O,y)=>s.e(function(a,d,_,B){const T=_.imageManager.getPattern(a.from.toString()),U=_.imageManager.getPattern(a.to.toString()),{width:H,height:q}=_.imageManager.getPixelSize(),w=Math.pow(2,B.tileID.overscaledZ),I=B.tileSize*Math.pow(2,_.transform.tileZoom)/w,k=I*(B.tileID.canonical.x+B.tileID.wrap*w),j=I*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[H,q],u_mix:d.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:d.fromScale,u_scale_b:d.toScale,u_tile_units_to_pixels:1/Fe(B,1,_.transform.tileZoom),u_pixel_coord_upper:[k>>16,j>>16],u_pixel_coord_lower:[65535&k,65535&j]}}(L,y,x,O),{u_matrix:z,u_opacity:A}),Aa={fillExtrusion:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_lightpos:new s.aP(z,A.u_lightpos),u_lightintensity:new s.aM(z,A.u_lightintensity),u_lightcolor:new s.aP(z,A.u_lightcolor),u_vertical_gradient:new s.aM(z,A.u_vertical_gradient),u_opacity:new s.aM(z,A.u_opacity)}),fillExtrusionPattern:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_lightpos:new s.aP(z,A.u_lightpos),u_lightintensity:new s.aM(z,A.u_lightintensity),u_lightcolor:new s.aP(z,A.u_lightcolor),u_vertical_gradient:new s.aM(z,A.u_vertical_gradient),u_height_factor:new s.aM(z,A.u_height_factor),u_image:new s.aL(z,A.u_image),u_texsize:new s.aQ(z,A.u_texsize),u_pixel_coord_upper:new s.aQ(z,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(z,A.u_pixel_coord_lower),u_scale:new s.aP(z,A.u_scale),u_fade:new s.aM(z,A.u_fade),u_opacity:new s.aM(z,A.u_opacity)}),fill:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix)}),fillPattern:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_image:new s.aL(z,A.u_image),u_texsize:new s.aQ(z,A.u_texsize),u_pixel_coord_upper:new s.aQ(z,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(z,A.u_pixel_coord_lower),u_scale:new s.aP(z,A.u_scale),u_fade:new s.aM(z,A.u_fade)}),fillOutline:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_world:new s.aQ(z,A.u_world)}),fillOutlinePattern:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_world:new s.aQ(z,A.u_world),u_image:new s.aL(z,A.u_image),u_texsize:new s.aQ(z,A.u_texsize),u_pixel_coord_upper:new s.aQ(z,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(z,A.u_pixel_coord_lower),u_scale:new s.aP(z,A.u_scale),u_fade:new s.aM(z,A.u_fade)}),circle:(z,A)=>({u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_scale_with_map:new s.aL(z,A.u_scale_with_map),u_pitch_with_map:new s.aL(z,A.u_pitch_with_map),u_extrude_scale:new s.aQ(z,A.u_extrude_scale),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_matrix:new s.aN(z,A.u_matrix)}),collisionBox:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(z,A.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(z,A.u_extrude_scale),u_overscale_factor:new s.aM(z,A.u_overscale_factor)}),collisionCircle:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_inv_matrix:new s.aN(z,A.u_inv_matrix),u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_viewport_size:new s.aQ(z,A.u_viewport_size)}),debug:(z,A)=>({u_color:new s.aR(z,A.u_color),u_matrix:new s.aN(z,A.u_matrix),u_overlay:new s.aL(z,A.u_overlay),u_overlay_scale:new s.aM(z,A.u_overlay_scale)}),clippingMask:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix)}),heatmap:(z,A)=>({u_extrude_scale:new s.aM(z,A.u_extrude_scale),u_intensity:new s.aM(z,A.u_intensity),u_matrix:new s.aN(z,A.u_matrix)}),heatmapTexture:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_world:new s.aQ(z,A.u_world),u_image:new s.aL(z,A.u_image),u_color_ramp:new s.aL(z,A.u_color_ramp),u_opacity:new s.aM(z,A.u_opacity)}),hillshade:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_image:new s.aL(z,A.u_image),u_latrange:new s.aQ(z,A.u_latrange),u_light:new s.aQ(z,A.u_light),u_shadow:new s.aR(z,A.u_shadow),u_highlight:new s.aR(z,A.u_highlight),u_accent:new s.aR(z,A.u_accent)}),hillshadePrepare:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_image:new s.aL(z,A.u_image),u_dimension:new s.aQ(z,A.u_dimension),u_zoom:new s.aM(z,A.u_zoom),u_unpack:new s.aO(z,A.u_unpack)}),line:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_ratio:new s.aM(z,A.u_ratio),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(z,A.u_units_to_pixels)}),lineGradient:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_ratio:new s.aM(z,A.u_ratio),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(z,A.u_units_to_pixels),u_image:new s.aL(z,A.u_image),u_image_height:new s.aM(z,A.u_image_height)}),linePattern:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_texsize:new s.aQ(z,A.u_texsize),u_ratio:new s.aM(z,A.u_ratio),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_image:new s.aL(z,A.u_image),u_units_to_pixels:new s.aQ(z,A.u_units_to_pixels),u_scale:new s.aP(z,A.u_scale),u_fade:new s.aM(z,A.u_fade)}),lineSDF:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_ratio:new s.aM(z,A.u_ratio),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(z,A.u_units_to_pixels),u_patternscale_a:new s.aQ(z,A.u_patternscale_a),u_patternscale_b:new s.aQ(z,A.u_patternscale_b),u_sdfgamma:new s.aM(z,A.u_sdfgamma),u_image:new s.aL(z,A.u_image),u_tex_y_a:new s.aM(z,A.u_tex_y_a),u_tex_y_b:new s.aM(z,A.u_tex_y_b),u_mix:new s.aM(z,A.u_mix)}),raster:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_tl_parent:new s.aQ(z,A.u_tl_parent),u_scale_parent:new s.aM(z,A.u_scale_parent),u_buffer_scale:new s.aM(z,A.u_buffer_scale),u_fade_t:new s.aM(z,A.u_fade_t),u_opacity:new s.aM(z,A.u_opacity),u_image0:new s.aL(z,A.u_image0),u_image1:new s.aL(z,A.u_image1),u_brightness_low:new s.aM(z,A.u_brightness_low),u_brightness_high:new s.aM(z,A.u_brightness_high),u_saturation_factor:new s.aM(z,A.u_saturation_factor),u_contrast_factor:new s.aM(z,A.u_contrast_factor),u_spin_weights:new s.aP(z,A.u_spin_weights)}),symbolIcon:(z,A)=>({u_is_size_zoom_constant:new s.aL(z,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(z,A.u_is_size_feature_constant),u_size_t:new s.aM(z,A.u_size_t),u_size:new s.aM(z,A.u_size),u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_pitch:new s.aM(z,A.u_pitch),u_rotate_symbol:new s.aL(z,A.u_rotate_symbol),u_aspect_ratio:new s.aM(z,A.u_aspect_ratio),u_fade_change:new s.aM(z,A.u_fade_change),u_matrix:new s.aN(z,A.u_matrix),u_label_plane_matrix:new s.aN(z,A.u_label_plane_matrix),u_coord_matrix:new s.aN(z,A.u_coord_matrix),u_is_text:new s.aL(z,A.u_is_text),u_pitch_with_map:new s.aL(z,A.u_pitch_with_map),u_texsize:new s.aQ(z,A.u_texsize),u_texture:new s.aL(z,A.u_texture)}),symbolSDF:(z,A)=>({u_is_size_zoom_constant:new s.aL(z,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(z,A.u_is_size_feature_constant),u_size_t:new s.aM(z,A.u_size_t),u_size:new s.aM(z,A.u_size),u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_pitch:new s.aM(z,A.u_pitch),u_rotate_symbol:new s.aL(z,A.u_rotate_symbol),u_aspect_ratio:new s.aM(z,A.u_aspect_ratio),u_fade_change:new s.aM(z,A.u_fade_change),u_matrix:new s.aN(z,A.u_matrix),u_label_plane_matrix:new s.aN(z,A.u_label_plane_matrix),u_coord_matrix:new s.aN(z,A.u_coord_matrix),u_is_text:new s.aL(z,A.u_is_text),u_pitch_with_map:new s.aL(z,A.u_pitch_with_map),u_texsize:new s.aQ(z,A.u_texsize),u_texture:new s.aL(z,A.u_texture),u_gamma_scale:new s.aM(z,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_is_halo:new s.aL(z,A.u_is_halo)}),symbolTextAndIcon:(z,A)=>({u_is_size_zoom_constant:new s.aL(z,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(z,A.u_is_size_feature_constant),u_size_t:new s.aM(z,A.u_size_t),u_size:new s.aM(z,A.u_size),u_camera_to_center_distance:new s.aM(z,A.u_camera_to_center_distance),u_pitch:new s.aM(z,A.u_pitch),u_rotate_symbol:new s.aL(z,A.u_rotate_symbol),u_aspect_ratio:new s.aM(z,A.u_aspect_ratio),u_fade_change:new s.aM(z,A.u_fade_change),u_matrix:new s.aN(z,A.u_matrix),u_label_plane_matrix:new s.aN(z,A.u_label_plane_matrix),u_coord_matrix:new s.aN(z,A.u_coord_matrix),u_is_text:new s.aL(z,A.u_is_text),u_pitch_with_map:new s.aL(z,A.u_pitch_with_map),u_texsize:new s.aQ(z,A.u_texsize),u_texsize_icon:new s.aQ(z,A.u_texsize_icon),u_texture:new s.aL(z,A.u_texture),u_texture_icon:new s.aL(z,A.u_texture_icon),u_gamma_scale:new s.aM(z,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(z,A.u_device_pixel_ratio),u_is_halo:new s.aL(z,A.u_is_halo)}),background:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_opacity:new s.aM(z,A.u_opacity),u_color:new s.aR(z,A.u_color)}),backgroundPattern:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_opacity:new s.aM(z,A.u_opacity),u_image:new s.aL(z,A.u_image),u_pattern_tl_a:new s.aQ(z,A.u_pattern_tl_a),u_pattern_br_a:new s.aQ(z,A.u_pattern_br_a),u_pattern_tl_b:new s.aQ(z,A.u_pattern_tl_b),u_pattern_br_b:new s.aQ(z,A.u_pattern_br_b),u_texsize:new s.aQ(z,A.u_texsize),u_mix:new s.aM(z,A.u_mix),u_pattern_size_a:new s.aQ(z,A.u_pattern_size_a),u_pattern_size_b:new s.aQ(z,A.u_pattern_size_b),u_scale_a:new s.aM(z,A.u_scale_a),u_scale_b:new s.aM(z,A.u_scale_b),u_pixel_coord_upper:new s.aQ(z,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(z,A.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(z,A.u_tile_units_to_pixels)}),terrain:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_texture:new s.aL(z,A.u_texture),u_ele_delta:new s.aM(z,A.u_ele_delta)}),terrainDepth:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_ele_delta:new s.aM(z,A.u_ele_delta)}),terrainCoords:(z,A)=>({u_matrix:new s.aN(z,A.u_matrix),u_texture:new s.aL(z,A.u_texture),u_terrain_coords_id:new s.aM(z,A.u_terrain_coords_id),u_ele_delta:new s.aM(z,A.u_ele_delta)})};class Za{constructor(A,x,L){this.context=A;const O=A.gl;this.buffer=O.createBuffer(),this.dynamicDraw=!!L,this.context.unbindVAO(),A.bindElementBuffer.set(this.buffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(A){const x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,A.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dc{constructor(A,x,L,O){this.length=x.length,this.attributes=L,this.itemSize=x.bytesPerElement,this.dynamicDraw=O,this.context=A;const y=A.gl;this.buffer=y.createBuffer(),A.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(A){if(A.length!==this.length)throw new Error(`Length of new data is ${A.length}, which doesn't match current length of ${this.length}`);const x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,A.arrayBuffer)}enableAttributes(A,x){for(let L=0;L<this.attributes.length;L++){const O=x.attributes[this.attributes[L].name];O!==void 0&&A.enableVertexAttribArray(O)}}setVertexAttribPointers(A,x,L){for(let O=0;O<this.attributes.length;O++){const y=this.attributes[O],a=x.attributes[y.name];a!==void 0&&A.vertexAttribPointer(a,y.components,A[Ia[y.type]],!1,this.itemSize,y.offset+this.itemSize*(L||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ja=new WeakMap;function Ao(z){var A;if(Ja.has(z))return Ja.get(z);{const x=(A=z.getParameter(z.VERSION))===null||A===void 0?void 0:A.startsWith("WebGL 2.0");return Ja.set(z,x),x}}class Fr{constructor(A){this.gl=A.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(A){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class da extends Fr{getDefault(){return s.aT.transparent}set(A){const x=this.current;(A.r!==x.r||A.g!==x.g||A.b!==x.b||A.a!==x.a||this.dirty)&&(this.gl.clearColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class As extends Fr{getDefault(){return 1}set(A){(A!==this.current||this.dirty)&&(this.gl.clearDepth(A),this.current=A,this.dirty=!1)}}class fn extends Fr{getDefault(){return 0}set(A){(A!==this.current||this.dirty)&&(this.gl.clearStencil(A),this.current=A,this.dirty=!1)}}class ss extends Fr{getDefault(){return[!0,!0,!0,!0]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||A[3]!==x[3]||this.dirty)&&(this.gl.colorMask(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Hr extends Fr{getDefault(){return!0}set(A){(A!==this.current||this.dirty)&&(this.gl.depthMask(A),this.current=A,this.dirty=!1)}}class Ya extends Fr{getDefault(){return 255}set(A){(A!==this.current||this.dirty)&&(this.gl.stencilMask(A),this.current=A,this.dirty=!1)}}class ul extends Fr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(A){const x=this.current;(A.func!==x.func||A.ref!==x.ref||A.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(A.func,A.ref,A.mask),this.current=A,this.dirty=!1)}}class zl extends Fr{getDefault(){const A=this.gl;return[A.KEEP,A.KEEP,A.KEEP]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(A[0],A[1],A[2]),this.current=A,this.dirty=!1)}}class Lo extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=A,this.dirty=!1}}class Xo extends Fr{getDefault(){return[0,1]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||this.dirty)&&(this.gl.depthRange(A[0],A[1]),this.current=A,this.dirty=!1)}}class fc extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=A,this.dirty=!1}}class Zo extends Fr{getDefault(){return this.gl.LESS}set(A){(A!==this.current||this.dirty)&&(this.gl.depthFunc(A),this.current=A,this.dirty=!1)}}class fo extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.BLEND):x.disable(x.BLEND),this.current=A,this.dirty=!1}}class pc extends Fr{getDefault(){const A=this.gl;return[A.ONE,A.ZERO]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(A[0],A[1]),this.current=A,this.dirty=!1)}}class Jo extends Fr{getDefault(){return s.aT.transparent}set(A){const x=this.current;(A.r!==x.r||A.g!==x.g||A.b!==x.b||A.a!==x.a||this.dirty)&&(this.gl.blendColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class Ql extends Fr{getDefault(){return this.gl.FUNC_ADD}set(A){(A!==this.current||this.dirty)&&(this.gl.blendEquation(A),this.current=A,this.dirty=!1)}}class Rc extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=A,this.dirty=!1}}class bh extends Fr{getDefault(){return this.gl.BACK}set(A){(A!==this.current||this.dirty)&&(this.gl.cullFace(A),this.current=A,this.dirty=!1)}}class cu extends Fr{getDefault(){return this.gl.CCW}set(A){(A!==this.current||this.dirty)&&(this.gl.frontFace(A),this.current=A,this.dirty=!1)}}class uu extends Fr{getDefault(){return null}set(A){(A!==this.current||this.dirty)&&(this.gl.useProgram(A),this.current=A,this.dirty=!1)}}class ku extends Fr{getDefault(){return this.gl.TEXTURE0}set(A){(A!==this.current||this.dirty)&&(this.gl.activeTexture(A),this.current=A,this.dirty=!1)}}class Vl extends Fr{getDefault(){const A=this.gl;return[0,0,A.drawingBufferWidth,A.drawingBufferHeight]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||A[3]!==x[3]||this.dirty)&&(this.gl.viewport(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class el extends Fr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,A),this.current=A,this.dirty=!1}}class tl extends Fr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class Hl extends Fr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindTexture(x.TEXTURE_2D,A),this.current=A,this.dirty=!1}}class il extends Fr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class fa extends Fr{getDefault(){return null}set(A){const x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class hl extends Fr{getDefault(){return null}set(A){var x;if(A===this.current&&!this.dirty)return;const L=this.gl;Ao(L)?L.bindVertexArray(A):(x=L.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(A),this.current=A,this.dirty=!1}}class Gl extends Fr{getDefault(){return 4}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,A),this.current=A,this.dirty=!1}}class to extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),this.current=A,this.dirty=!1}}class pa extends Fr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,A),this.current=A,this.dirty=!1}}class se extends Fr{constructor(A,x){super(A),this.context=A,this.parent=x}getDefault(){return null}}class Le extends se{setDirty(){this.dirty=!0}set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,A,0),this.current=A,this.dirty=!1}}class ct extends se{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class yt extends se{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class bt{constructor(A,x,L,O,y){this.context=A,this.width=x,this.height=L;const a=A.gl,d=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Le(A,d),O)this.depthAttachment=y?new yt(A,d):new ct(A,d);else if(y)throw new Error("Stencil cannot be setted without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const A=this.context.gl,x=this.colorAttachment.get();if(x&&A.deleteTexture(x),this.depthAttachment){const L=this.depthAttachment.get();L&&A.deleteRenderbuffer(L)}A.deleteFramebuffer(this.framebuffer)}}class It{constructor(A,x,L){this.blendFunction=A,this.blendColor=x,this.mask=L}}It.Replace=[1,0],It.disabled=new It(It.Replace,s.aT.transparent,[!1,!1,!1,!1]),It.unblended=new It(It.Replace,s.aT.transparent,[!0,!0,!0,!0]),It.alphaBlended=new It([1,771],s.aT.transparent,[!0,!0,!0,!0]);class gi{constructor(A){var x,L;if(this.gl=A,this.clearColor=new da(this),this.clearDepth=new As(this),this.clearStencil=new fn(this),this.colorMask=new ss(this),this.depthMask=new Hr(this),this.stencilMask=new Ya(this),this.stencilFunc=new ul(this),this.stencilOp=new zl(this),this.stencilTest=new Lo(this),this.depthRange=new Xo(this),this.depthTest=new fc(this),this.depthFunc=new Zo(this),this.blend=new fo(this),this.blendFunc=new pc(this),this.blendColor=new Jo(this),this.blendEquation=new Ql(this),this.cullFace=new Rc(this),this.cullFaceSide=new bh(this),this.frontFace=new cu(this),this.program=new uu(this),this.activeTexture=new ku(this),this.viewport=new Vl(this),this.bindFramebuffer=new el(this),this.bindRenderbuffer=new tl(this),this.bindTexture=new Hl(this),this.bindVertexBuffer=new il(this),this.bindElementBuffer=new fa(this),this.bindVertexArray=new hl(this),this.pixelStoreUnpack=new Gl(this),this.pixelStoreUnpackPremultiplyAlpha=new to(this),this.pixelStoreUnpackFlipY=new pa(this),this.extTextureFilterAnisotropic=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=A.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),Ao(A)){this.HALF_FLOAT=A.HALF_FLOAT;const O=A.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=A.RGBA16F)!==null&&x!==void 0?x:O==null?void 0:O.RGBA16F_EXT,this.RGB16F=(L=A.RGB16F)!==null&&L!==void 0?L:O==null?void 0:O.RGB16F_EXT,A.getExtension("EXT_color_buffer_float")}else{A.getExtension("EXT_color_buffer_half_float"),A.getExtension("OES_texture_half_float_linear");const O=A.getExtension("OES_texture_half_float");this.HALF_FLOAT=O==null?void 0:O.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(A,x){return new Za(this,A,x)}createVertexBuffer(A,x,L){return new Dc(this,A,x,L)}createRenderbuffer(A,x,L){const O=this.gl,y=O.createRenderbuffer();return this.bindRenderbuffer.set(y),O.renderbufferStorage(O.RENDERBUFFER,A,x,L),this.bindRenderbuffer.set(null),y}createFramebuffer(A,x,L,O){return new bt(this,A,x,L,O)}clear(A){let{color:x,depth:L,stencil:O}=A;const y=this.gl;let a=0;x&&(a|=y.COLOR_BUFFER_BIT,this.clearColor.set(x),this.colorMask.set([!0,!0,!0,!0])),L!==void 0&&(a|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(L),this.depthMask.set(!0)),O!==void 0&&(a|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(O),this.stencilMask.set(255)),y.clear(a)}setCullFace(A){A.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(A.mode),this.frontFace.set(A.frontFace))}setDepthMode(A){A.func!==this.gl.ALWAYS||A.mask?(this.depthTest.set(!0),this.depthFunc.set(A.func),this.depthMask.set(A.mask),this.depthRange.set(A.range)):this.depthTest.set(!1)}setStencilMode(A){A.test.func!==this.gl.ALWAYS||A.mask?(this.stencilTest.set(!0),this.stencilMask.set(A.mask),this.stencilOp.set([A.fail,A.depthFail,A.pass]),this.stencilFunc.set({func:A.test.func,ref:A.ref,mask:A.test.mask})):this.stencilTest.set(!1)}setColorMode(A){s.aG(A.blendFunction,It.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(A.blendFunction),this.blendColor.set(A.blendColor)),this.colorMask.set(A.mask)}createVertexArray(){var A;return Ao(this.gl)?this.gl.createVertexArray():(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.createVertexArrayOES()}deleteVertexArray(A){var x;return Ao(this.gl)?this.gl.deleteVertexArray(A):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(A)}unbindVAO(){this.bindVertexArray.set(null)}}class ni{constructor(A,x,L){this.func=A,this.mask=x,this.range=L}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const nr=7680;class $i{constructor(A,x,L,O,y,a){this.test=A,this.ref=x,this.mask=L,this.fail=O,this.depthFail=y,this.pass=a}}$i.disabled=new $i({func:519,mask:0},0,0,nr,nr,nr);class Oi{constructor(A,x,L){this.enable=A,this.mode=x,this.frontFace=L}}let qr;function sr(z,A,x,L,O,y,a){const d=z.context,_=d.gl,B=z.useProgram("collisionBox"),T=[];let U=0,H=0;for(let X=0;X<L.length;X++){const ee=L[X],re=A.getTile(ee),le=re.getBucket(x);if(!le)continue;let pe=ee.posMatrix;O[0]===0&&O[1]===0||(pe=z.translatePosMatrix(ee.posMatrix,re,O,y));const ge=a?le.textCollisionBox:le.iconCollisionBox,we=le.collisionCircleArray;if(we.length>0){const De=s.Z(),Me=pe;s.aU(De,le.placementInvProjMatrix,z.transform.glCoordMatrix),s.aU(De,De,le.placementViewportMatrix),T.push({circleArray:we,circleOffset:H,transform:Me,invTransform:De,coord:ee}),U+=we.length/4,H=U}ge&&B.draw(d,_.LINES,ni.disabled,$i.disabled,z.colorModeForRenderPass(),Oi.disabled,ft(pe,z.transform,re),z.style.map.terrain&&z.style.map.terrain.getTerrainData(ee),x.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,z.transform.zoom,null,null,ge.collisionVertexBuffer)}if(!a||!T.length)return;const q=z.useProgram("collisionCircle"),w=new s.aV;w.resize(4*U),w._trim();let I=0;for(const X of T)for(let ee=0;ee<X.circleArray.length/4;ee++){const re=4*ee,le=X.circleArray[re+0],pe=X.circleArray[re+1],ge=X.circleArray[re+2],we=X.circleArray[re+3];w.emplace(I++,le,pe,ge,we,0),w.emplace(I++,le,pe,ge,we,1),w.emplace(I++,le,pe,ge,we,2),w.emplace(I++,le,pe,ge,we,3)}(!qr||qr.length<2*U)&&(qr=function(X){const ee=2*X,re=new s.aX;re.resize(ee),re._trim();for(let le=0;le<ee;le++){const pe=6*le;re.uint16[pe+0]=4*le+0,re.uint16[pe+1]=4*le+1,re.uint16[pe+2]=4*le+2,re.uint16[pe+3]=4*le+2,re.uint16[pe+4]=4*le+3,re.uint16[pe+5]=4*le+0}return re}(U));const k=d.createIndexBuffer(qr,!0),j=d.createVertexBuffer(w,s.aW.members,!0);for(const X of T){const ee={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(Y=z.transform).cameraToCenterDistance,u_viewport_size:[Y.width,Y.height]};q.draw(d,_.TRIANGLES,ni.disabled,$i.disabled,z.colorModeForRenderPass(),Oi.disabled,ee,z.style.map.terrain&&z.style.map.terrain.getTerrainData(X.coord),x.id,j,k,s.S.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,z.transform.zoom,null,null,null)}var Y;j.destroy(),k.destroy()}Oi.disabled=new Oi(!1,1029,2305),Oi.backCCW=new Oi(!0,1029,2305);const jn=s.ao(new Float32Array(16));function Cr(z,A,x,L,O,y){const{horizontalAlign:a,verticalAlign:d}=s.au(z);return new s.P((-(a-.5)*A/O+L[0])*y,(-(d-.5)*x/O+L[1])*y)}function Mr(z,A,x,L,O,y,a,d,_,B,T){const U=z.text.placedSymbolArray,H=z.text.dynamicLayoutVertexArray,q=z.icon.dynamicLayoutVertexArray,w={};H.clear();for(let I=0;I<U.length;I++){const k=U.get(I),j=k.hidden||!k.crossTileID||z.allowVerticalPlacement&&!k.placedOrientation?null:L[k.crossTileID];if(j){const Y=new s.P(k.anchorX,k.anchorY),X=Vt(Y,x?a:y,T),ee=Ci(O.cameraToCenterDistance,X.signedDistanceFromCamera);let re=s.aj(z.textSizeData,_,k)*ee/s.ap;x&&(re*=z.tilePixelRatio/d);const{width:le,height:pe,anchor:ge,textOffset:we,textBoxScale:De}=j,Me=Cr(ge,le,pe,we,De,re),st=x?Vt(Y.add(Me),y,T).point:X.point.add(A?Me.rotate(-O.angle):Me),We=z.allowVerticalPlacement&&k.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let ke=0;ke<k.numGlyphs;ke++)s.ak(H,st,We);B&&k.associatedIconIndex>=0&&(w[k.associatedIconIndex]={shiftedAnchor:st,angle:We})}else me(k.numGlyphs,H)}if(B){q.clear();const I=z.icon.placedSymbolArray;for(let k=0;k<I.length;k++){const j=I.get(k);if(j.hidden)me(j.numGlyphs,q);else{const Y=w[k];if(Y)for(let X=0;X<j.numGlyphs;X++)s.ak(q,Y.shiftedAnchor,Y.angle);else me(j.numGlyphs,q)}}z.icon.dynamicLayoutVertexBuffer.updateData(q)}z.text.dynamicLayoutVertexBuffer.updateData(H)}function Nn(z,A,x){return x.iconsInText&&A?"symbolTextAndIcon":z?"symbolSDF":"symbolIcon"}function Ks(z,A,x,L,O,y,a,d,_,B,T,U){const H=z.context,q=H.gl,w=z.transform,I=d==="map",k=_==="map",j=d!=="viewport"&&x.layout.get("symbol-placement")!=="point",Y=I&&!k&&!j,X=!x.layout.get("symbol-sort-key").isConstant();let ee=!1;const re=z.depthModeForSublayer(0,ni.ReadOnly),le=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),pe=[];for(const ge of L){const we=A.getTile(ge),De=we.getBucket(x);if(!De)continue;const Me=O?De.text:De.icon;if(!Me||!Me.segments.get().length||!Me.hasVisibleVertices)continue;const st=Me.programConfigurations.get(x.id),We=O||De.sdfIcons,ke=O?De.textSizeData:De.iconSizeData,Ve=k||w.pitch!==0,gt=z.useProgram(Nn(We,O,De),st),xt=s.ah(ke,w.zoom),At=z.style.map.terrain&&z.style.map.terrain.getTerrainData(ge);let kt,Rt,Ai,Ht,vi=[0,0],Ti=null;if(O)Rt=we.glyphAtlasTexture,Ai=q.LINEAR,kt=we.glyphAtlasTexture.size,De.iconsInText&&(vi=we.imageAtlasTexture.size,Ti=we.imageAtlasTexture,Ht=Ve||z.options.rotating||z.options.zooming||ke.kind==="composite"||ke.kind==="camera"?q.LINEAR:q.NEAREST);else{const zr=x.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;Rt=we.imageAtlasTexture,Ai=We||z.options.rotating||z.options.zooming||zr||Ve?q.LINEAR:q.NEAREST,kt=we.imageAtlasTexture.size}const er=Fe(we,1,z.transform.zoom),Ii=Kt(ge.posMatrix,k,I,z.transform,er),_r=Ji(ge.posMatrix,k,I,z.transform,er),pr=le&&De.hasTextData(),qi=x.layout.get("icon-text-fit")!=="none"&&pr&&De.hasIconData();if(j){const zr=z.style.map.terrain?(vr,ar)=>z.style.map.terrain.getElevation(ge,vr,ar):null,gr=x.layout.get("text-rotation-alignment")==="map";jt(De,ge.posMatrix,z,O,Ii,_r,k,B,gr,zr)}const Nr=z.translatePosMatrix(ge.posMatrix,we,y,a),nn=j||O&&le||qi?jn:Ii,Pr=z.translatePosMatrix(_r,we,y,a,!0),Wr=We&&x.paint.get(O?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Er;Er=We?De.iconsInText?Io(ke.kind,xt,Y,k,z,Nr,nn,Pr,kt,vi):es(ke.kind,xt,Y,k,z,Nr,nn,Pr,O,kt,!0):Nl(ke.kind,xt,Y,k,z,Nr,nn,Pr,O,kt);const is={program:gt,buffers:Me,uniformValues:Er,atlasTexture:Rt,atlasTextureIcon:Ti,atlasInterpolation:Ai,atlasInterpolationIcon:Ht,isSDF:We,hasHalo:Wr};if(X&&De.canOverlap){ee=!0;const zr=Me.segments.get();for(const gr of zr)pe.push({segments:new s.S([gr]),sortKey:gr.sortKey,state:is,terrainData:At})}else pe.push({segments:Me.segments,sortKey:0,state:is,terrainData:At})}ee&&pe.sort((ge,we)=>ge.sortKey-we.sortKey);for(const ge of pe){const we=ge.state;if(H.activeTexture.set(q.TEXTURE0),we.atlasTexture.bind(we.atlasInterpolation,q.CLAMP_TO_EDGE),we.atlasTextureIcon&&(H.activeTexture.set(q.TEXTURE1),we.atlasTextureIcon&&we.atlasTextureIcon.bind(we.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),we.isSDF){const De=we.uniformValues;we.hasHalo&&(De.u_is_halo=1,io(we.buffers,ge.segments,x,z,we.program,re,T,U,De,ge.terrainData)),De.u_is_halo=0}io(we.buffers,ge.segments,x,z,we.program,re,T,U,we.uniformValues,ge.terrainData)}}function io(z,A,x,L,O,y,a,d,_,B){const T=L.context;O.draw(T,T.gl.TRIANGLES,y,a,d,Oi.disabled,_,B,x.id,z.layoutVertexBuffer,z.indexBuffer,A,x.paint,L.transform.zoom,z.programConfigurations.get(x.id),z.dynamicLayoutVertexBuffer,z.opacityVertexBuffer)}function Mo(z,A,x,L,O){if(!x||!L||!L.imageAtlas)return;const y=L.imageAtlas.patternPositions;let a=y[x.to.toString()],d=y[x.from.toString()];if(!a&&d&&(a=d),!d&&a&&(d=a),!a||!d){const _=O.getPaintProperty(A);a=y[_],d=y[_]}a&&d&&z.setConstantPatternPositions(a,d)}function La(z,A,x,L,O,y,a){const d=z.context.gl,_="fill-pattern",B=x.paint.get(_),T=B&&B.constantOr(1),U=x.getCrossfadeParameters();let H,q,w,I,k;a?(q=T&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=d.LINES):(q=T?"fillPattern":"fill",H=d.TRIANGLES);const j=B.constantOr(null);for(const Y of L){const X=A.getTile(Y);if(T&&!X.patternsLoaded())continue;const ee=X.getBucket(x);if(!ee)continue;const re=ee.programConfigurations.get(x.id),le=z.useProgram(q,re),pe=z.style.map.terrain&&z.style.map.terrain.getTerrainData(Y);T&&(z.context.activeTexture.set(d.TEXTURE0),X.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),re.updatePaintBuffers(U)),Mo(re,_,j,X,x);const ge=pe?Y:null,we=z.translatePosMatrix(ge?ge.posMatrix:Y.posMatrix,X,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if(a){I=ee.indexBuffer2,k=ee.segments2;const De=[d.drawingBufferWidth,d.drawingBufferHeight];w=q==="fillOutlinePattern"&&T?ze(we,z,U,X,De):Ta(we,De)}else I=ee.indexBuffer,k=ee.segments,w=T?ho(we,z,U,X):ha(we);le.draw(z.context,H,O,z.stencilModeForClipping(Y),y,Oi.disabled,w,pe,x.id,ee.layoutVertexBuffer,I,k,x.paint,z.transform.zoom,re)}}function ga(z,A,x,L,O,y,a){const d=z.context,_=d.gl,B="fill-extrusion-pattern",T=x.paint.get(B),U=T.constantOr(1),H=x.getCrossfadeParameters(),q=x.paint.get("fill-extrusion-opacity"),w=T.constantOr(null);for(const I of L){const k=A.getTile(I),j=k.getBucket(x);if(!j)continue;const Y=z.style.map.terrain&&z.style.map.terrain.getTerrainData(I),X=j.programConfigurations.get(x.id),ee=z.useProgram(U?"fillExtrusionPattern":"fillExtrusion",X);U&&(z.context.activeTexture.set(_.TEXTURE0),k.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),X.updatePaintBuffers(H)),Mo(X,B,w,k,x);const re=z.translatePosMatrix(I.posMatrix,k,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),le=x.paint.get("fill-extrusion-vertical-gradient"),pe=U?js(re,z,le,q,I,H,k):Gr(re,z,le,q);ee.draw(d,d.gl.TRIANGLES,O,y,a,Oi.backCCW,pe,Y,x.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,x.paint,z.transform.zoom,X,z.style.map.terrain&&j.centroidVertexBuffer)}}function jl(z,A,x,L,O,y,a){const d=z.context,_=d.gl,B=x.fbo;if(!B)return;const T=z.useProgram("hillshade"),U=z.style.map.terrain&&z.style.map.terrain.getTerrainData(A);d.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,B.colorAttachment.get()),T.draw(d,_.TRIANGLES,O,y,a,Oi.disabled,((H,q,w,I)=>{const k=w.paint.get("hillshade-shadow-color"),j=w.paint.get("hillshade-highlight-color"),Y=w.paint.get("hillshade-accent-color");let X=w.paint.get("hillshade-illumination-direction")*(Math.PI/180);w.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=H.transform.angle);const ee=!H.options.moving;return{u_matrix:I?I.posMatrix:H.transform.calculatePosMatrix(q.tileID.toUnwrapped(),ee),u_image:0,u_latrange:xr(0,q.tileID),u_light:[w.paint.get("hillshade-exaggeration"),X],u_shadow:k,u_highlight:j,u_accent:Y}})(z,x,L,U?A:null),U,L.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}function Al(z,A,x,L,O,y){const a=z.context,d=a.gl,_=A.dem;if(_&&_.data){const B=_.dim,T=_.stride,U=_.getPixels();if(a.activeTexture.set(d.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),A.demTexture=A.demTexture||z.getTileTexture(T),A.demTexture){const q=A.demTexture;q.update(U,{premultiply:!1}),q.bind(d.NEAREST,d.CLAMP_TO_EDGE)}else A.demTexture=new rt(a,U,d.RGBA,{premultiply:!1}),A.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);a.activeTexture.set(d.TEXTURE0);let H=A.fbo;if(!H){const q=new rt(a,{width:B,height:B,data:null},d.RGBA);q.bind(d.LINEAR,d.CLAMP_TO_EDGE),H=A.fbo=a.createFramebuffer(B,B,!0,!1),H.colorAttachment.set(q.texture)}a.bindFramebuffer.set(H.framebuffer),a.viewport.set([0,0,B,B]),z.useProgram("hillshadePrepare").draw(a,d.TRIANGLES,L,O,y,Oi.disabled,((q,w)=>{const I=w.stride,k=s.Z();return s.aS(k,0,s.N,-s.N,0,0,1),s.$(k,k,[0,-s.N,0]),{u_matrix:k,u_image:1,u_dimension:[I,I],u_zoom:q.overscaledZ,u_unpack:w.getUnpackVector()}})(A.tileID,_),null,x.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments),A.needsHillshadePrepare=!1}}function ql(z,A,x,L,O,y){const a=L.paint.get("raster-fade-duration");if(!y&&a>0){const d=s.h.now(),_=(d-z.timeAdded)/a,B=A?(d-A.timeAdded)/a:-1,T=x.getSource(),U=O.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),H=!A||Math.abs(A.tileID.overscaledZ-U)>Math.abs(z.tileID.overscaledZ-U),q=H&&z.refreshedUponExpiration?1:s.ad(H?_:1-B,0,1);return z.refreshedUponExpiration&&_>=1&&(z.refreshedUponExpiration=!1),A?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const gc=new s.aT(1,0,0,1),ma=new s.aT(0,1,0,1),Ds=new s.aT(0,0,1,1),dl=new s.aT(1,0,1,1),$l=new s.aT(0,1,1,1);function Ma(z,A,x,L){Rs(z,0,A+x/2,z.transform.width,x,L)}function Pa(z,A,x,L){Rs(z,A-x/2,0,x,z.transform.height,L)}function Rs(z,A,x,L,O,y){const a=z.context,d=a.gl;d.enable(d.SCISSOR_TEST),d.scissor(A*z.pixelRatio,x*z.pixelRatio,L*z.pixelRatio,O*z.pixelRatio),a.clear({color:y}),d.disable(d.SCISSOR_TEST)}function Ou(z,A,x){const L=z.context,O=L.gl,y=x.posMatrix,a=z.useProgram("debug"),d=ni.disabled,_=$i.disabled,B=z.colorModeForRenderPass(),T="$debug",U=z.style.map.terrain&&z.style.map.terrain.getTerrainData(x);L.activeTexture.set(O.TEXTURE0);const H=A.getTileByID(x.key).latestRawTileData,q=Math.floor((H&&H.byteLength||0)/1024),w=A.getTile(x).tileSize,I=512/Math.min(w,512)*(x.overscaledZ/z.transform.zoom)*.5;let k=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(k+=` => ${x.overscaledZ}`),function(j,Y){j.initDebugOverlayCanvas();const X=j.debugOverlayCanvas,ee=j.context.gl,re=j.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,X.width,X.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(Y,5,5),re.strokeText(Y,5,5),j.debugOverlayTexture.update(X),j.debugOverlayTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}(z,`${k} ${q}kB`),a.draw(L,O.TRIANGLES,d,_,It.alphaBlended,Oi.disabled,Ut(y,s.aT.transparent,I),null,T,z.debugBuffer,z.quadTriangleIndexBuffer,z.debugSegments),a.draw(L,O.LINE_STRIP,d,_,B,Oi.disabled,Ut(y,s.aT.red),U,T,z.debugBuffer,z.tileBorderIndexBuffer,z.debugSegments)}function In(z,A,x){const L=z.context,O=L.gl,y=z.colorModeForRenderPass(),a=new ni(O.LEQUAL,ni.ReadWrite,z.depthRangeFor3D),d=z.useProgram("terrain"),_=A.getTerrainMesh();L.bindFramebuffer.set(null),L.viewport.set([0,0,z.width,z.height]);for(const B of x){const T=z.renderToTexture.getTexture(B),U=A.getTerrainData(B.tileID);L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,T.texture);const H={u_matrix:z.transform.calculatePosMatrix(B.tileID.toUnwrapped()),u_texture:0,u_ele_delta:A.getMeshFrameDelta(z.transform.zoom)};d.draw(L,O.TRIANGLES,a,$i.disabled,y,Oi.backCCW,H,U,"terrain",_.vertexBuffer,_.indexBuffer,_.segments)}}class an{constructor(A,x){this.context=new gi(A),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=qt.maxUnderzooming+qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ms}resize(A,x,L){if(this.width=Math.floor(A*L),this.height=Math.floor(x*L),this.pixelRatio=L,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const O of this.style._order)this.style._layers[O].resize()}setup(){const A=this.context,x=new s.a_;x.emplaceBack(0,0),x.emplaceBack(s.N,0),x.emplaceBack(0,s.N),x.emplaceBack(s.N,s.N),this.tileExtentBuffer=A.createVertexBuffer(x,eo.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const L=new s.a_;L.emplaceBack(0,0),L.emplaceBack(s.N,0),L.emplaceBack(0,s.N),L.emplaceBack(s.N,s.N),this.debugBuffer=A.createVertexBuffer(L,eo.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const O=new s.V;O.emplaceBack(0,0,0,0),O.emplaceBack(s.N,0,s.N,0),O.emplaceBack(0,s.N,0,s.N),O.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=A.createVertexBuffer(O,Lt.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const y=new s.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=A.createVertexBuffer(y,eo.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const a=new s.a$;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=A.createIndexBuffer(a);const d=new s.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=A.createIndexBuffer(d);const _=this.context.gl;this.stencilClearMode=new $i({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)}clearStencil(){const A=this.context,x=A.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const L=s.Z();s.aS(L,0,this.width,this.height,0,0,1),s.a0(L,L,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(A,x.TRIANGLES,ni.disabled,this.stencilClearMode,It.disabled,Oi.disabled,hi(L),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(A,x){if(this.currentStencilSource===A.source||!A.isTileClipped()||!x||!x.length)return;this.currentStencilSource=A.source;const L=this.context,O=L.gl;this.nextStencilID+x.length>256&&this.clearStencil(),L.setColorMode(It.disabled),L.setDepthMode(ni.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of x){const d=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,_=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a);y.draw(L,O.TRIANGLES,ni.disabled,new $i({func:O.ALWAYS,mask:0},d,255,O.KEEP,O.KEEP,O.REPLACE),It.disabled,Oi.disabled,hi(a.posMatrix),_,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const A=this.nextStencilID++,x=this.context.gl;return new $i({func:x.NOTEQUAL,mask:255},A,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(A){const x=this.context.gl;return new $i({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[A.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(A){const x=this.context.gl,L=A.sort((a,d)=>d.overscaledZ-a.overscaledZ),O=L[L.length-1].overscaledZ,y=L[0].overscaledZ-O+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const a={};for(let d=0;d<y;d++)a[d+O]=new $i({func:x.GEQUAL,mask:255},d+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=y,[a,L]}return[{[O]:$i.disabled},L]}colorModeForRenderPass(){const A=this.context.gl;return this._showOverdrawInspector?new It([A.CONSTANT_COLOR,A.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?It.unblended:It.alphaBlended}depthModeForSublayer(A,x,L){if(!this.opaquePassEnabledForLayer())return ni.disabled;const O=1-((1+this.currentLayer)*this.numSublayers+A)*this.depthEpsilon;return new ni(L||this.context.gl.LEQUAL,x,[O,O])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(A,x){this.style=A,this.options=x,this.lineAtlas=A.lineAtlas,this.imageManager=A.imageManager,this.glyphManager=A.glyphManager,this.symbolFadeChange=A.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const L=this.style._order,O=this.style.sourceCaches,y={},a={},d={};for(const _ in O){const B=O[_];B.used&&B.prepare(this.context),y[_]=B.getVisibleCoordinates(),a[_]=y[_].slice().reverse(),d[_]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let _=0;_<L.length;_++)if(this.style._layers[L[_]].is3D()){this.opaquePassCutoff=_;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const _=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||_.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,T){const U=B.context,H=U.gl,q=It.unblended,w=new ni(H.LEQUAL,ni.ReadWrite,[0,1]),I=T.getTerrainMesh(),k=T.sourceCache.getRenderableTiles(),j=B.useProgram("terrainDepth");U.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1});for(const Y of k){const X=T.getTerrainData(Y.tileID),ee={u_matrix:B.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(B.transform.zoom)};j.draw(U,H.TRIANGLES,w,$i.disabled,q,Oi.backCCW,ee,X,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain),function(B,T){const U=B.context,H=U.gl,q=It.unblended,w=new ni(H.LEQUAL,ni.ReadWrite,[0,1]),I=T.getTerrainMesh(),k=T.getCoordsTexture(),j=T.sourceCache.getRenderableTiles(),Y=B.useProgram("terrainCoords");U.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1}),T.coordsIndex=[];for(const X of j){const ee=T.getTerrainData(X.tileID);U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,k.texture);const re={u_matrix:B.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(B.transform.zoom)};Y.draw(U,H.TRIANGLES,w,$i.disabled,q,Oi.backCCW,re,ee,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),T.coordsIndex.push(X.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const _ of L){const B=this.style._layers[_];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const T=a[B.source];(B.type==="custom"||T.length)&&this.renderLayer(this,O[B.source],B,T)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(A._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const _=this.style._layers[L[this.currentLayer]],B=O[_.source],T=y[_.source];this._renderTileClippingMasks(_,T),this.renderLayer(this,B,_,T)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const _=this.style._layers[L[this.currentLayer]],B=O[_.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(_))continue;const T=(_.type==="symbol"?d:a)[_.source];this._renderTileClippingMasks(_,y[_.source]),this.renderLayer(this,B,_,T)}if(this.options.showTileBoundaries){const _=function(B,T){let U=null;const H=Object.values(B._layers).flatMap(k=>k.source&&!k.isHidden(T)?[B.sourceCaches[k.source]]:[]),q=H.filter(k=>k.getSource().type==="vector"),w=H.filter(k=>k.getSource().type!=="vector"),I=k=>{(!U||U.getSource().maxzoom<k.getSource().maxzoom)&&(U=k)};return q.forEach(k=>I(k)),U||w.forEach(k=>I(k)),U}(this.style,this.transform.zoom);_&&function(B,T,U){for(let H=0;H<U.length;H++)Ou(B,T,U[H])}(this,_,_.getVisibleCoordinates())}this.options.showPadding&&function(_){const B=_.transform.padding;Ma(_,_.transform.height-(B.top||0),3,gc),Ma(_,B.bottom||0,3,ma),Pa(_,B.left||0,3,Ds),Pa(_,_.transform.width-(B.right||0),3,dl);const T=_.transform.centerPoint;(function(U,H,q,w){Rs(U,H-1,q-10,2,20,w),Rs(U,H-10,q-1,20,2,w)})(_,T.x,_.transform.height-T.y,$l)}(this),this.context.setDefault()}renderLayer(A,x,L,O){if(!L.isHidden(this.transform.zoom)&&(L.type==="background"||L.type==="custom"||(O||[]).length))switch(this.id=L.id,L.type){case"symbol":(function(y,a,d,_,B){if(y.renderPass!=="translucent")return;const T=$i.disabled,U=y.colorModeForRenderPass();(d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,q,w,I,k,j,Y){const X=q.transform,ee=k==="map",re=j==="map";for(const le of H){const pe=I.getTile(le),ge=pe.getBucket(w);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const we=s.ah(ge.textSizeData,X.zoom),De=Fe(pe,1,q.transform.zoom),Me=Kt(le.posMatrix,re,ee,q.transform,De),st=w.layout.get("icon-text-fit")!=="none"&&ge.hasIconData();if(we){const We=Math.pow(2,X.zoom-pe.tileID.overscaledZ);Mr(ge,ee,re,Y,X,Me,le.posMatrix,We,we,st,q.style.map.terrain?(ke,Ve)=>q.style.map.terrain.getElevation(le,ke,Ve):null)}}}(_,y,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),B),d.paint.get("icon-opacity").constantOr(1)!==0&&Ks(y,a,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),T,U),d.paint.get("text-opacity").constantOr(1)!==0&&Ks(y,a,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),T,U),a.map.showCollisionBoxes&&(sr(y,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),sr(y,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))})(A,x,L,O,this.style.placement.variableOffsets);break;case"circle":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),U=d.paint.get("circle-stroke-opacity"),H=!d.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(T.constantOr(1)===0||U.constantOr(1)===0))return;const q=y.context,w=q.gl,I=y.depthModeForSublayer(0,ni.ReadOnly),k=$i.disabled,j=y.colorModeForRenderPass(),Y=[];for(let X=0;X<_.length;X++){const ee=_[X],re=a.getTile(ee),le=re.getBucket(d);if(!le)continue;const pe=le.programConfigurations.get(d.id),ge=y.useProgram("circle",pe),we=le.layoutVertexBuffer,De=le.indexBuffer,Me=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ee),st={programConfiguration:pe,program:ge,layoutVertexBuffer:we,indexBuffer:De,uniformValues:Ye(y,ee,re,d),terrainData:Me};if(H){const We=le.segments.get();for(const ke of We)Y.push({segments:new s.S([ke]),sortKey:ke.sortKey,state:st})}else Y.push({segments:le.segments,sortKey:0,state:st})}H&&Y.sort((X,ee)=>X.sortKey-ee.sortKey);for(const X of Y){const{programConfiguration:ee,program:re,layoutVertexBuffer:le,indexBuffer:pe,uniformValues:ge,terrainData:we}=X.state;re.draw(q,w.TRIANGLES,I,k,j,Oi.disabled,ge,we,d.id,le,pe,X.segments,d.paint,y.transform.zoom,ee)}})(A,x,L,O);break;case"heatmap":(function(y,a,d,_){if(d.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const B=y.context,T=B.gl,U=$i.disabled,H=new It([T.ONE,T.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(q,w,I){const k=q.gl;q.activeTexture.set(k.TEXTURE1),q.viewport.set([0,0,w.width/4,w.height/4]);let j=I.heatmapFbo;if(j)k.bindTexture(k.TEXTURE_2D,j.colorAttachment.get()),q.bindFramebuffer.set(j.framebuffer);else{const Y=k.createTexture();k.bindTexture(k.TEXTURE_2D,Y),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR),j=I.heatmapFbo=q.createFramebuffer(w.width/4,w.height/4,!1,!1),function(X,ee,re,le){var pe,ge;const we=X.gl,De=(pe=X.HALF_FLOAT)!==null&&pe!==void 0?pe:we.UNSIGNED_BYTE,Me=(ge=X.RGBA16F)!==null&&ge!==void 0?ge:we.RGBA;we.texImage2D(we.TEXTURE_2D,0,Me,ee.width/4,ee.height/4,0,we.RGBA,De,null),le.colorAttachment.set(re)}(q,w,Y,j)}})(B,y,d),B.clear({color:s.aT.transparent});for(let q=0;q<_.length;q++){const w=_[q];if(a.hasRenderableParent(w))continue;const I=a.getTile(w),k=I.getBucket(d);if(!k)continue;const j=k.programConfigurations.get(d.id),Y=y.useProgram("heatmap",j),{zoom:X}=y.transform;Y.draw(B,T.TRIANGLES,ni.disabled,U,H,Oi.disabled,ji(w.posMatrix,I,X,d.paint.get("heatmap-intensity")),null,d.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,d.paint,y.transform.zoom,j)}B.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(B,T){const U=B.context,H=U.gl,q=T.heatmapFbo;if(!q)return;U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,q.colorAttachment.get()),U.activeTexture.set(H.TEXTURE1);let w=T.colorRampTexture;w||(w=T.colorRampTexture=new rt(U,T.colorRamp,H.RGBA)),w.bind(H.LINEAR,H.CLAMP_TO_EDGE),B.useProgram("heatmapTexture").draw(U,H.TRIANGLES,ni.disabled,$i.disabled,B.colorModeForRenderPass(),Oi.disabled,((I,k,j,Y)=>{const X=s.Z();s.aS(X,0,I.width,I.height,0,0,1);const ee=I.context.gl;return{u_matrix:X,u_world:[ee.drawingBufferWidth,ee.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}})(B,T),null,T.id,B.viewportBuffer,B.quadTriangleIndexBuffer,B.viewportSegments,T.paint,B.transform.zoom)}(y,d))})(A,x,L,O);break;case"line":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(B.constantOr(1)===0||T.constantOr(1)===0)return;const U=y.depthModeForSublayer(0,ni.ReadOnly),H=y.colorModeForRenderPass(),q=d.paint.get("line-dasharray"),w=d.paint.get("line-pattern"),I=w.constantOr(1),k=d.paint.get("line-gradient"),j=d.getCrossfadeParameters(),Y=I?"linePattern":q?"lineSDF":k?"lineGradient":"line",X=y.context,ee=X.gl;let re=!0;for(const le of _){const pe=a.getTile(le);if(I&&!pe.patternsLoaded())continue;const ge=pe.getBucket(d);if(!ge)continue;const we=ge.programConfigurations.get(d.id),De=y.context.program.get(),Me=y.useProgram(Y,we),st=re||Me.program!==De,We=y.style.map.terrain&&y.style.map.terrain.getTerrainData(le),ke=w.constantOr(null);if(ke&&pe.imageAtlas){const xt=pe.imageAtlas,At=xt.patternPositions[ke.to.toString()],kt=xt.patternPositions[ke.from.toString()];At&&kt&&we.setConstantPatternPositions(At,kt)}const Ve=We?le:null,gt=I?ns(y,pe,d,j,Ve):q?Bn(y,pe,d,q,j,Ve):k?Un(y,pe,d,ge.lineClipsArray.length,Ve):Tn(y,pe,d,Ve);if(I)X.activeTexture.set(ee.TEXTURE0),pe.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),we.updatePaintBuffers(j);else if(q&&(st||y.lineAtlas.dirty))X.activeTexture.set(ee.TEXTURE0),y.lineAtlas.bind(X);else if(k){const xt=ge.gradients[d.id];let At=xt.texture;if(d.gradientVersion!==xt.version){let kt=256;if(d.stepInterpolant){const Rt=a.getSource().maxzoom,Ai=le.canonical.z===Rt?Math.ceil(1<<y.transform.maxZoom-le.canonical.z):1;kt=s.ad(s.aY(ge.maxLineLength/s.N*1024*Ai),256,X.maxTextureSize)}xt.gradient=s.aZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:xt.gradient||void 0,clips:ge.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new rt(X,xt.gradient,ee.RGBA),xt.version=d.gradientVersion,At=xt.texture}X.activeTexture.set(ee.TEXTURE0),At.bind(d.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}Me.draw(X,ee.TRIANGLES,U,y.stencilModeForClipping(le),H,Oi.disabled,gt,We,d.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,d.paint,y.transform.zoom,we,ge.layoutVertexBuffer2),re=!1}})(A,x,L,O);break;case"fill":(function(y,a,d,_){const B=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const U=y.colorModeForRenderPass(),H=d.paint.get("fill-pattern"),q=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&B.constantOr(s.aT.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===q){const w=y.depthModeForSublayer(1,y.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly);La(y,a,d,_,w,U,!1)}if(y.renderPass==="translucent"&&d.paint.get("fill-antialias")){const w=y.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly);La(y,a,d,_,w,U,!0)}})(A,x,L,O);break;case"fill-extrusion":(function(y,a,d,_){const B=d.paint.get("fill-extrusion-opacity");if(B!==0&&y.renderPass==="translucent"){const T=new ni(y.context.gl.LEQUAL,ni.ReadWrite,y.depthRangeFor3D);if(B!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))ga(y,a,d,_,T,$i.disabled,It.disabled),ga(y,a,d,_,T,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const U=y.colorModeForRenderPass();ga(y,a,d,_,T,$i.disabled,U)}}})(A,x,L,O);break;case"hillshade":(function(y,a,d,_){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const B=y.context,T=y.depthModeForSublayer(0,ni.ReadOnly),U=y.colorModeForRenderPass(),[H,q]=y.renderPass==="translucent"?y.stencilConfigForOverlap(_):[{},_];for(const w of q){const I=a.getTile(w);I.needsHillshadePrepare!==void 0&&I.needsHillshadePrepare&&y.renderPass==="offscreen"?Al(y,I,d,T,$i.disabled,U):y.renderPass==="translucent"&&jl(y,w,I,d,T,H[w.overscaledZ],U)}B.viewport.set([0,0,y.width,y.height])})(A,x,L,O);break;case"raster":(function(y,a,d,_){if(y.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;const B=y.context,T=B.gl,U=a.getSource(),H=y.useProgram("raster"),q=y.colorModeForRenderPass(),[w,I]=U instanceof Gt?[{},_]:y.stencilConfigForOverlap(_),k=I[I.length-1].overscaledZ,j=!y.options.moving;for(const Y of I){const X=y.depthModeForSublayer(Y.overscaledZ-k,d.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,T.LESS),ee=a.getTile(Y);ee.registerFadeDuration(d.paint.get("raster-fade-duration"));const re=a.findLoadedParent(Y,0),le=ql(ee,re,a,d,y.transform,y.style.map.terrain);let pe,ge;const we=d.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;B.activeTexture.set(T.TEXTURE0),ee.texture.bind(we,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(T.TEXTURE1),re?(re.texture.bind(we,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),pe=Math.pow(2,re.tileID.overscaledZ-ee.tileID.overscaledZ),ge=[ee.tileID.canonical.x*pe%1,ee.tileID.canonical.y*pe%1]):ee.texture.bind(we,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);const De=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Y),Me=De?Y:null,st=Me?Me.posMatrix:y.transform.calculatePosMatrix(Y.toUnwrapped(),j),We=Ir(st,ge||[0,0],pe||1,le,d);U instanceof Gt?H.draw(B,T.TRIANGLES,X,$i.disabled,q,Oi.disabled,We,De,d.id,U.boundsBuffer,y.quadTriangleIndexBuffer,U.boundsSegments):H.draw(B,T.TRIANGLES,X,w[Y.overscaledZ],q,Oi.disabled,We,De,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(A,x,L,O);break;case"background":(function(y,a,d,_){const B=d.paint.get("background-color"),T=d.paint.get("background-opacity");if(T===0)return;const U=y.context,H=U.gl,q=y.transform,w=q.tileSize,I=d.paint.get("background-pattern");if(y.isPatternMissing(I))return;const k=!I&&B.a===1&&T===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==k)return;const j=$i.disabled,Y=y.depthModeForSublayer(0,k==="opaque"?ni.ReadWrite:ni.ReadOnly),X=y.colorModeForRenderPass(),ee=y.useProgram(I?"backgroundPattern":"background"),re=_||q.coveringTiles({tileSize:w,terrain:y.style.map.terrain});I&&(U.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context));const le=d.getCrossfadeParameters();for(const pe of re){const ge=_?pe.posMatrix:y.transform.calculatePosMatrix(pe.toUnwrapped()),we=I?ys(ge,T,y,I,{tileID:pe,tileSize:w},le):Xa(ge,T,B),De=y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe);ee.draw(U,H.TRIANGLES,Y,j,X,Oi.disabled,we,De,d.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(A,0,L,O);break;case"custom":(function(y,a,d){const _=y.context,B=d.implementation;if(y.renderPass==="offscreen"){const T=B.prerender;T&&(y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),T.call(B,_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),_.setStencilMode($i.disabled);const T=B.renderingMode==="3d"?new ni(y.context.gl.LEQUAL,ni.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,ni.ReadOnly);_.setDepthMode(T),B.render(_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState(),_.bindFramebuffer.set(null)}})(A,0,L)}}translatePosMatrix(A,x,L,O,y){if(!L[0]&&!L[1])return A;const a=y?O==="map"?this.transform.angle:0:O==="viewport"?-this.transform.angle:0;if(a){const B=Math.sin(a),T=Math.cos(a);L=[L[0]*T-L[1]*B,L[0]*B+L[1]*T]}const d=[y?L[0]:Fe(x,L[0],this.transform.zoom),y?L[1]:Fe(x,L[1],this.transform.zoom),0],_=new Float32Array(16);return s.$(_,A,d),_}saveTileTexture(A){const x=this._tileTextures[A.size[0]];x?x.push(A):this._tileTextures[A.size[0]]=[A]}getTileTexture(A){const x=this._tileTextures[A];return x&&x.length>0?x.pop():null}isPatternMissing(A){if(!A)return!1;if(!A.from||!A.to)return!0;const x=this.imageManager.getPattern(A.from.toString()),L=this.imageManager.getPattern(A.to.toString());return!x||!L}useProgram(A,x){this.cache=this.cache||{};const L=A+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[L]||(this.cache[L]=new Sn(this.context,fr[A],x,Aa[A],this._showOverdrawInspector,this.style.map.terrain)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const A=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(A.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new rt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:A,drawingBufferHeight:x}=this.context.gl;return this.width!==A||this.height!==x}}class pn{constructor(A,x){this.points=A,this.planes=x}static fromInvProjectionMatrix(A,x,L){const O=Math.pow(2,L),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(d=>{const _=1/(d=s.ag([],d,A))[3]/x*O;return s.b3(d,d,[_,_,1/d[3],_])}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(d=>{const _=function(H,q){var w=q[0],I=q[1],k=q[2],j=w*w+I*I+k*k;return j>0&&(j=1/Math.sqrt(j)),H[0]=q[0]*j,H[1]=q[1]*j,H[2]=q[2]*j,H}([],function(H,q,w){var I=q[0],k=q[1],j=q[2],Y=w[0],X=w[1],ee=w[2];return H[0]=k*ee-j*X,H[1]=j*Y-I*ee,H[2]=I*X-k*Y,H}([],He([],y[d[0]],y[d[1]]),He([],y[d[2]],y[d[1]]))),B=-((T=_)[0]*(U=y[d[1]])[0]+T[1]*U[1]+T[2]*U[2]);var T,U;return _.concat(B)});return new pn(y,a)}}class ts{constructor(A,x){this.min=A,this.max=x,this.center=function(L,O,y){return L[0]=.5*O[0],L[1]=.5*O[1],L[2]=.5*O[2],L}([],function(L,O,y){return L[0]=O[0]+y[0],L[1]=O[1]+y[1],L[2]=O[2]+y[2],L}([],this.min,this.max))}quadrant(A){const x=[A%2==0,A<2],L=Se(this.min),O=Se(this.max);for(let y=0;y<x.length;y++)L[y]=x[y]?this.min[y]:this.center[y],O[y]=x[y]?this.center[y]:this.max[y];return O[2]=this.max[2],new ts(L,O)}distanceX(A){return Math.max(Math.min(this.max[0],A[0]),this.min[0])-A[0]}distanceY(A){return Math.max(Math.min(this.max[1],A[1]),this.min[1])-A[1]}intersects(A){const x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let L=!0;for(let O=0;O<A.planes.length;O++){const y=A.planes[O];let a=0;for(let d=0;d<x.length;d++)s.b4(y,x[d])>=0&&a++;if(a===0)return 0;a!==x.length&&(L=!1)}if(L)return 2;for(let O=0;O<3;O++){let y=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let d=0;d<A.points.length;d++){const _=A.points[d][O]-this.min[O];y=Math.min(y,_),a=Math.max(a,_)}if(a<0||y>this.max[O]-this.min[O])return 0}return 1}}class fl{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(A)||A<0||isNaN(x)||x<0||isNaN(L)||L<0||isNaN(O)||O<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=A,this.bottom=x,this.left=L,this.right=O}interpolate(A,x,L){return x.top!=null&&A.top!=null&&(this.top=s.B.number(A.top,x.top,L)),x.bottom!=null&&A.bottom!=null&&(this.bottom=s.B.number(A.bottom,x.bottom,L)),x.left!=null&&A.left!=null&&(this.left=s.B.number(A.left,x.left,L)),x.right!=null&&A.right!=null&&(this.right=s.B.number(A.right,x.right,L)),this}getCenter(A,x){const L=s.ad((this.left+A-this.right)/2,0,A),O=s.ad((this.top+x-this.bottom)/2,0,x);return new s.P(L,O)}equals(A){return this.top===A.top&&this.bottom===A.bottom&&this.left===A.left&&this.right===A.right}clone(){return new fl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class pl{constructor(A,x,L,O,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=A||0,this._maxZoom=x||22,this._minPitch=L??0,this._maxPitch=O??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const A=new pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return A.apply(this),A}apply(A){this.tileSize=A.tileSize,this.latRange=A.latRange,this.width=A.width,this.height=A.height,this._center=A._center,this._elevation=A._elevation,this._minEleveationForCurrentTile=A._minEleveationForCurrentTile,this.zoom=A.zoom,this.angle=A.angle,this._fov=A._fov,this._pitch=A._pitch,this._unmodified=A._unmodified,this._edgeInsets=A._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(A){this._minZoom!==A&&(this._minZoom=A,this.zoom=Math.max(this.zoom,A))}get maxZoom(){return this._maxZoom}set maxZoom(A){this._maxZoom!==A&&(this._maxZoom=A,this.zoom=Math.min(this.zoom,A))}get minPitch(){return this._minPitch}set minPitch(A){this._minPitch!==A&&(this._minPitch=A,this.pitch=Math.max(this.pitch,A))}get maxPitch(){return this._maxPitch}set maxPitch(A){this._maxPitch!==A&&(this._maxPitch=A,this.pitch=Math.min(this.pitch,A))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(A){A===void 0?A=!0:A===null&&(A=!1),this._renderWorldCopies=A}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(A){const x=-s.b5(A,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=function(){var L=new s.A(4);return s.A!=Float32Array&&(L[1]=0,L[2]=0),L[0]=1,L[3]=1,L}(),function(L,O,y){var a=O[0],d=O[1],_=O[2],B=O[3],T=Math.sin(y),U=Math.cos(y);L[0]=a*U+_*T,L[1]=d*U+B*T,L[2]=a*-T+_*U,L[3]=d*-T+B*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(A){const x=s.ad(A,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(A){A=Math.max(.01,Math.min(60,A)),this._fov!==A&&(this._unmodified=!1,this._fov=A/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(A){const x=Math.min(Math.max(A,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(A){A.lat===this._center.lat&&A.lng===this._center.lng||(this._unmodified=!1,this._center=A,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(A){A!==this._elevation&&(this._elevation=A,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(A){this._edgeInsets.equals(A)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,A,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(A){return this._edgeInsets.equals(A)}interpolatePadding(A,x,L){this._unmodified=!1,this._edgeInsets.interpolate(A,x,L),this._constrain(),this._calcMatrices()}coveringZoomLevel(A){const x=(A.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/A.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(A){const x=[new s.b6(0,A)];if(this._renderWorldCopies){const L=this.pointCoordinate(new s.P(0,0)),O=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),a=this.pointCoordinate(new s.P(0,this.height)),d=Math.floor(Math.min(L.x,O.x,y.x,a.x)),_=Math.floor(Math.max(L.x,O.x,y.x,a.x)),B=1;for(let T=d-B;T<=_+B;T++)T!==0&&x.push(new s.b6(T,A))}return x}coveringTiles(A){var x,L;let O=this.coveringZoomLevel(A);const y=O;if(A.minzoom!==void 0&&O<A.minzoom)return[];A.maxzoom!==void 0&&O>A.maxzoom&&(O=A.maxzoom);const a=this.pointCoordinate(this.getCameraPoint()),d=s.U.fromLngLat(this.center),_=Math.pow(2,O),B=[_*a.x,_*a.y,0],T=[_*d.x,_*d.y,0],U=pn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,O);let H=A.minzoom||0;!A.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=O);const q=A.terrain?2/Math.min(this.tileSize,A.tileSize)*this.tileSize:3,w=X=>({aabb:new ts([X*_,0,0],[(X+1)*_,_,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),I=[],k=[],j=O,Y=A.reparseOverscaled?y:O;if(this._renderWorldCopies)for(let X=1;X<=3;X++)I.push(w(-X)),I.push(w(X));for(I.push(w(0));I.length>0;){const X=I.pop(),ee=X.x,re=X.y;let le=X.fullyVisible;if(!le){const Me=X.aabb.intersects(U);if(Me===0)continue;le=Me===2}const pe=A.terrain?B:T,ge=X.aabb.distanceX(pe),we=X.aabb.distanceY(pe),De=Math.max(Math.abs(ge),Math.abs(we));if(X.zoom===j||De>q+(1<<j-X.zoom)-2&&X.zoom>=H){const Me=j-X.zoom,st=B[0]-.5-(ee<<Me),We=B[1]-.5-(re<<Me);k.push({tileID:new s.O(X.zoom===j?Y:X.zoom,X.wrap,X.zoom,ee,re),distanceSq:$e([T[0]-.5-ee,T[1]-.5-re]),tileDistanceToCamera:Math.sqrt(st*st+We*We)})}else for(let Me=0;Me<4;Me++){const st=(ee<<1)+Me%2,We=(re<<1)+(Me>>1),ke=X.zoom+1;let Ve=X.aabb.quadrant(Me);if(A.terrain){const gt=new s.O(ke,X.wrap,ke,st,We),xt=A.terrain.getMinMaxElevation(gt),At=(x=xt.minElevation)!==null&&x!==void 0?x:this.elevation,kt=(L=xt.maxElevation)!==null&&L!==void 0?L:this.elevation;Ve=new ts([Ve.min[0],Ve.min[1],At],[Ve.max[0],Ve.max[1],kt])}I.push({aabb:Ve,zoom:ke,x:st,y:We,wrap:X.wrap,fullyVisible:le})}}return k.sort((X,ee)=>X.distanceSq-ee.distanceSq).map(X=>X.tileID)}resize(A,x){this.width=A,this.height=x,this.pixelsToGLUnits=[2/A,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(A){return Math.pow(2,A)}scaleZoom(A){return Math.log(A)/Math.LN2}project(A){const x=s.ad(A.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(A.lng)*this.worldSize,s.H(x)*this.worldSize)}unproject(A){return new s.U(A.x/this.worldSize,A.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(A){const x=this.pointLocation(this.centerPoint,A),L=A.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-L))return;const O=this.getCameraPosition(),y=s.U.fromLngLat(O.lngLat,O.altitude),a=s.U.fromLngLat(x,L),d=y.x-a.x,_=y.y-a.y,B=y.z-a.z,T=Math.sqrt(d*d+_*_+B*B),U=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=L,this._center=x,this.zoom=U}setLocationAtPoint(A,x){const L=this.pointCoordinate(x),O=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(A),a=new s.U(y.x-(L.x-O.x),y.y-(L.y-O.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(A,x){return x?this.coordinatePoint(this.locationCoordinate(A),x.getElevationForLngLatZoom(A,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(A))}pointLocation(A,x){return this.coordinateLocation(this.pointCoordinate(A,x))}locationCoordinate(A){return s.U.fromLngLat(A)}coordinateLocation(A){return A&&A.toLngLat()}pointCoordinate(A,x){if(x){const H=x.pointCoordinate(A);if(H!=null)return H}const L=[A.x,A.y,0,1],O=[A.x,A.y,1,1];s.ag(L,L,this.pixelMatrixInverse),s.ag(O,O,this.pixelMatrixInverse);const y=L[3],a=O[3],d=L[1]/y,_=O[1]/a,B=L[2]/y,T=O[2]/a,U=B===T?0:(0-B)/(T-B);return new s.U(s.B.number(L[0]/y,O[0]/a,U)/this.worldSize,s.B.number(d,_,U)/this.worldSize)}coordinatePoint(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const O=[A.x*this.worldSize,A.y*this.worldSize,x,1];return s.ag(O,O,L),new s.P(O[0]/O[3],O[1]/O[3])}getBounds(){const A=Math.max(0,this.height/2-this.getHorizon());return new Ze().extend(this.pointLocation(new s.P(0,A))).extend(this.pointLocation(new s.P(this.width,A))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(A){A?(this.lngRange=[A.getWest(),A.getEast()],this.latRange=[A.getSouth(),A.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const L=A.key,O=x?this._alignedPosMatrixCache:this._posMatrixCache;if(O[L])return O[L];const y=A.canonical,a=this.worldSize/this.zoomScale(y.z),d=y.x+Math.pow(2,y.z)*A.wrap,_=s.ao(new Float64Array(16));return s.$(_,_,[d*a,y.y*a,0]),s.a0(_,_,[a/s.N,a/s.N,1]),s.a1(_,x?this.alignedProjMatrix:this.projMatrix,_),O[L]=new Float32Array(_),O[L]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let A,x,L,O,y=-90,a=90,d=-180,_=180;const B=this.size,T=this._unmodified;if(this.latRange){const q=this.latRange;y=s.H(q[1])*this.worldSize,a=s.H(q[0])*this.worldSize,A=a-y<B.y?B.y/(a-y):0}if(this.lngRange){const q=this.lngRange;d=s.b5(s.G(q[0])*this.worldSize,0,this.worldSize),_=s.b5(s.G(q[1])*this.worldSize,0,this.worldSize),_<d&&(_+=this.worldSize),x=_-d<B.x?B.x/(_-d):0}const U=this.point,H=Math.max(x||0,A||0);if(H)return this.center=this.unproject(new s.P(x?(_+d)/2:U.x,A?(a+y)/2:U.y)),this.zoom+=this.scaleZoom(H),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const q=U.y,w=B.y/2;q-w<y&&(O=y+w),q+w>a&&(O=a-w)}if(this.lngRange){const q=(d+_)/2,w=s.b5(U.x,q-this.worldSize/2,q+this.worldSize/2),I=B.x/2;w-I<d&&(L=d+I),w+I>_&&(L=_-I)}L===void 0&&O===void 0||(this.center=this.unproject(new s.P(L!==void 0?L:U.x,O!==void 0?O:U.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const A=this.centerOffset,x=this.point.x,L=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let O=s.ao(new Float64Array(16));s.a0(O,O,[this.width/2,-this.height/2,1]),s.$(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.ao(new Float64Array(16)),s.a0(O,O,[1,-1,1]),s.$(O,O,[-1,-1,0]),s.a0(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),a=Math.min(this.elevation,this._minEleveationForCurrentTile),d=y-a*this._pixelPerMeter/Math.cos(this._pitch),_=a<0?d:y,B=Math.PI/2+this._pitch,T=this._fov*(.5+A.y/this.height),U=Math.sin(T)*_/Math.sin(s.ad(Math.PI-B-T,.01,Math.PI-.01)),H=this.getHorizon(),q=2*Math.atan(H/this.cameraToCenterDistance)*(.5+A.y/(2*H)),w=Math.sin(q)*_/Math.sin(s.ad(Math.PI-B-q,.01,Math.PI-.01)),I=Math.min(U,w),k=1.01*(Math.cos(Math.PI/2-this._pitch)*I+_),j=this.height/50;O=new Float64Array(16),s.b8(O,this._fov,this.width/this.height,j,k),O[8]=2*-A.x/this.width,O[9]=2*A.y/this.height,s.a0(O,O,[1,-1,1]),s.$(O,O,[0,0,-this.cameraToCenterDistance]),s.b9(O,O,this._pitch),s.ae(O,O,this.angle),s.$(O,O,[-x,-L,0]),this.mercatorMatrix=s.a0([],O,[this.worldSize,this.worldSize,this.worldSize]),s.a0(O,O,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,O),s.$(O,O,[0,0,-this.elevation]),this.projMatrix=O,this.invProjMatrix=s.as([],O),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,O);const Y=this.width%2/2,X=this.height%2/2,ee=Math.cos(this.angle),re=Math.sin(this.angle),le=x-Math.round(x)+ee*Y+re*X,pe=L-Math.round(L)+ee*X+re*Y,ge=new Float64Array(O);if(s.$(ge,ge,[le>.5?le-1:le,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=ge,O=s.as(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");this.pixelMatrixInverse=O,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const A=this.pointCoordinate(new s.P(0,0)),x=[A.x*this.worldSize,A.y*this.worldSize,0,1];return s.ag(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const A=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,A))}getCameraQueryGeometry(A){const x=this.getCameraPoint();if(A.length===1)return[A[0],x];{let L=x.x,O=x.y,y=x.x,a=x.y;for(const d of A)L=Math.min(L,d.x),O=Math.min(O,d.y),y=Math.max(y,d.x),a=Math.max(a,d.y);return[new s.P(L,O),new s.P(y,O),new s.P(y,a),new s.P(L,a),new s.P(L,O)]}}}function po(z,A){var x=this;let L,O=!1,y=null,a=null;const d=()=>{y=null,O&&(z.apply(a,L),y=setTimeout(d,A),O=!1)};return function(){for(var _=arguments.length,B=new Array(_),T=0;T<_;T++)B[T]=arguments[T];return O=!0,a=x,L=B,y||d(),y}}class os{constructor(A){this._getCurrentHash=()=>{const x=window.location.hash.replace("#","");if(this._hashName){let L;return x.split("&").map(O=>O.split("=")).forEach(O=>{O[0]===this._hashName&&(L=O)}),(L&&L[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{const x=this._getCurrentHash();if(x.length>=3&&!x.some(L=>isNaN(L))){const L=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:L,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const x=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,x)}catch{}},this._updateHash=po(this._updateHashUnthrottled,300),this._hashName=A&&encodeURIComponent(A)}addTo(A){return this._map=A,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(A){const x=this._map.getCenter(),L=Math.round(100*this._map.getZoom())/100,O=Math.ceil((L*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,O),a=Math.round(x.lng*y)/y,d=Math.round(x.lat*y)/y,_=this._map.getBearing(),B=this._map.getPitch();let T="";if(T+=A?`/${a}/${d}/${L}`:`${L}/${d}/${a}`,(_||B)&&(T+="/"+Math.round(10*_)/10),B&&(T+=`/${Math.round(B)}`),this._hashName){const U=this._hashName;let H=!1;const q=window.location.hash.slice(1).split("&").map(w=>{const I=w.split("=")[0];return I===U?(H=!0,`${I}=${T}`):w}).filter(w=>w);return H||q.push(`${U}=${T}`),`#${q.join("&")}`}return`#${T}`}}const as={linearity:.3,easing:s.ba(0,0,.3,1)},Po=s.e({deceleration:2500,maxSpeed:1400},as),Fo=s.e({deceleration:20,maxSpeed:1400},as),ya=s.e({deceleration:1e3,maxSpeed:360},as),gl=s.e({deceleration:1e3,maxSpeed:90},as);class ro{constructor(A){this._map=A,this.clear()}clear(){this._inertiaBuffer=[]}record(A){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:A})}_drainInertiaBuffer(){const A=this._inertiaBuffer,x=s.h.now();for(;A.length>0&&x-A[0].time>160;)A.shift()}_onMoveEnd(A){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const x={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)x.zoom+=y.zoomDelta||0,x.bearing+=y.bearingDelta||0,x.pitch+=y.pitchDelta||0,y.panDelta&&x.pan._add(y.panDelta),y.around&&(x.around=y.around),y.pinchAround&&(x.pinchAround=y.pinchAround);const L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(x.pan.mag()){const y=go(x.pan.mag(),L,s.e({},Po,A||{}));O.offset=x.pan.mult(y.amount/x.pan.mag()),O.center=this._map.transform.center,no(O,y)}if(x.zoom){const y=go(x.zoom,L,Fo);O.zoom=this._map.transform.zoom+y.amount,no(O,y)}if(x.bearing){const y=go(x.bearing,L,ya);O.bearing=this._map.transform.bearing+s.ad(y.amount,-179,179),no(O,y)}if(x.pitch){const y=go(x.pitch,L,gl);O.pitch=this._map.transform.pitch+y.amount,no(O,y)}if(O.zoom||O.bearing){const y=x.pinchAround===void 0?x.around:x.pinchAround;O.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.e(O,{noMoveStart:!0})}}function no(z,A){(!z.duration||z.duration<A.duration)&&(z.duration=A.duration,z.easing=A.easing)}function go(z,A,x){const{maxSpeed:L,linearity:O,deceleration:y}=x,a=s.ad(z*O/(A/1e3),-L,L),d=Math.abs(a)/(y*O);return{easing:x.easing,duration:1e3*d,amount:a*(d/2)}}class _s extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const y=b.mousePos(x.getCanvasContainer(),L),a=x.unproject(y);super(A,s.e({point:y,lngLat:a,originalEvent:L},O)),this._defaultPrevented=!1,this.target=x}}class so extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){const O=A==="touchend"?L.changedTouches:L.touches,y=b.touchPos(x.getCanvasContainer(),O),a=y.map(_=>x.unproject(_)),d=y.reduce((_,B,T,U)=>_.add(B.div(U.length)),new s.P(0,0));super(A,{points:y,point:d,lngLats:a,lngLat:x.unproject(d),originalEvent:L}),this._defaultPrevented=!1}}class Fa extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){super(A,{originalEvent:L}),this._defaultPrevented=!1}}class _a{constructor(A,x){this._map=A,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(A){return this._firePreventable(new Fa(A.type,this._map,A))}mousedown(A,x){return this._mousedownPos=x,this._firePreventable(new _s(A.type,this._map,A))}mouseup(A){this._map.fire(new _s(A.type,this._map,A))}click(A,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new _s(A.type,this._map,A))}dblclick(A){return this._firePreventable(new _s(A.type,this._map,A))}mouseover(A){this._map.fire(new _s(A.type,this._map,A))}mouseout(A){this._map.fire(new _s(A.type,this._map,A))}touchstart(A){return this._firePreventable(new so(A.type,this._map,A))}touchmove(A){this._map.fire(new so(A.type,this._map,A))}touchend(A){this._map.fire(new so(A.type,this._map,A))}touchcancel(A){this._map.fire(new so(A.type,this._map,A))}_firePreventable(A){if(this._map.fire(A),A.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Da{constructor(A){this._map=A}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(A){this._map.fire(new _s(A.type,this._map,A))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(A){this._delayContextMenu?this._contextMenuEvent=A:this._ignoreContextMenu||this._map.fire(new _s(A.type,this._map,A)),this._map.listens("contextmenu")&&A.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ln{constructor(A){this._map=A}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(A){return this.transform.pointLocation(s.P.convert(A),this._map.terrain)}}class Do{constructor(A,x){this._map=A,this._tr=new Ln(A),this._el=A.getCanvasContainer(),this._container=A.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(A,x){this.isEnabled()&&A.shiftKey&&A.button===0&&(b.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(A,x){if(!this._active)return;const L=x;if(this._lastPos.equals(L)||!this._box&&L.dist(this._startPos)<this._clickTolerance)return;const O=this._startPos;this._lastPos=L,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",A));const y=Math.min(O.x,L.x),a=Math.max(O.x,L.x),d=Math.min(O.y,L.y),_=Math.max(O.y,L.y);b.setTransform(this._box,`translate(${y}px,${d}px)`),this._box.style.width=a-y+"px",this._box.style.height=_-d+"px"}mouseupWindow(A,x){if(!this._active||A.button!==0)return;const L=this._startPos,O=x;if(this.reset(),b.suppressClick(),L.x!==O.x||L.y!==O.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:A})),{cameraAnimation:y=>y.fitScreenCoordinates(L,O,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",A)}keydown(A){this._active&&A.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",A))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(A,x){return this._map.fire(new s.k(A,{originalEvent:x}))}}function ds(z,A){if(z.length!==A.length)throw new Error(`The number of touches and points are not equal - touches ${z.length}, points ${A.length}`);const x={};for(let L=0;L<z.length;L++)x[z[L].identifier]=A[L];return x}class vs{constructor(A){this.reset(),this.numTouches=A.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(A,x,L){(this.centroid||L.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=A.timeStamp),L.length===this.numTouches&&(this.centroid=function(O){const y=new s.P(0,0);for(const a of O)y._add(a);return y.div(O.length)}(x),this.touches=ds(L,x)))}touchmove(A,x,L){if(this.aborted||!this.centroid)return;const O=ds(L,x);for(const y in this.touches){const a=O[y];(!a||a.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(A,x,L){if((!this.centroid||A.timeStamp-this.startTime>500)&&(this.aborted=!0),L.length===0){const O=!this.aborted&&this.centroid;if(this.reset(),O)return O}}}class fs{constructor(A){this.singleTap=new vs(A),this.numTaps=A.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(A,x,L){this.singleTap.touchstart(A,x,L)}touchmove(A,x,L){this.singleTap.touchmove(A,x,L)}touchend(A,x,L){const O=this.singleTap.touchend(A,x,L);if(O){const y=A.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(O)<30;if(y&&a||this.reset(),this.count++,this.lastTime=A.timeStamp,this.lastTap=O,this.count===this.numTaps)return this.reset(),O}}}class Lr{constructor(A){this._tr=new Ln(A),this._zoomIn=new fs({numTouches:1,numTaps:2}),this._zoomOut=new fs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(A,x,L){this._zoomIn.touchstart(A,x,L),this._zoomOut.touchstart(A,x,L)}touchmove(A,x,L){this._zoomIn.touchmove(A,x,L),this._zoomOut.touchmove(A,x,L)}touchend(A,x,L){const O=this._zoomIn.touchend(A,x,L),y=this._zoomOut.touchend(A,x,L),a=this._tr;return O?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(O)},{originalEvent:A})}):y?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(y)},{originalEvent:A})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jr{constructor(A){this._enabled=!!A.enable,this._moveStateManager=A.moveStateManager,this._clickTolerance=A.clickTolerance||1,this._moveFunction=A.move,this._activateOnStart=!!A.activateOnStart,A.assignEvents(this),this.reset()}reset(A){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(A)}_move(){const A=this._moveFunction(...arguments);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(A,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(A)&&(this._moveStateManager.startMove(A),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(A,x){if(!this.isEnabled())return;const L=this._lastPoint;if(!L)return;if(A.preventDefault(),!this._moveStateManager.isValidMoveEvent(A))return void this.reset(A);const O=x.length?x[0]:x;return!this._moved&&O.dist(L)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=O,this._move(L,O))}dragEnd(A){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(A)&&(this._moved&&b.suppressClick(),this.reset(A))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ln={0:1,2:2};class qn{constructor(A){this._correctEvent=A.checkCorrectEvent}startMove(A){const x=b.mouseButton(A);this._eventButton=x}endMove(A){delete this._eventButton}isValidStartEvent(A){return this._correctEvent(A)}isValidMoveEvent(A){return!function(x,L){const O=ln[L];return x.buttons===void 0||(x.buttons&O)!==O}(A,this._eventButton)}isValidEndEvent(A){return b.mouseButton(A)===this._eventButton}}class va{constructor(){this._firstTouch=void 0}_isOneFingerTouch(A){return A.targetTouches.length===1}_isSameTouchEvent(A){return A.targetTouches[0].identifier===this._firstTouch}startMove(A){this._firstTouch=A.targetTouches[0].identifier}endMove(A){delete this._firstTouch}isValidStartEvent(A){return this._isOneFingerTouch(A)}isValidMoveEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}isValidEndEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}}const Ra=z=>{z.mousedown=z.dragStart,z.mousemoveWindow=z.dragMove,z.mouseup=z.dragEnd,z.contextmenu=function(A){A.preventDefault()}},mo=z=>{let{enable:A,clickTolerance:x,bearingDegreesPerPixelMoved:L=.8}=z;const O=new qn({checkCorrectEvent:y=>b.mouseButton(y)===0&&y.ctrlKey||b.mouseButton(y)===2});return new Jr({clickTolerance:x,move:(y,a)=>({bearingDelta:(a.x-y.x)*L}),moveStateManager:O,enable:A,assignEvents:Ra})},Yo=z=>{let{enable:A,clickTolerance:x,pitchDegreesPerPixelMoved:L=-.5}=z;const O=new qn({checkCorrectEvent:y=>b.mouseButton(y)===0&&y.ctrlKey||b.mouseButton(y)===2});return new Jr({clickTolerance:x,move:(y,a)=>({pitchDelta:(a.y-y.y)*L}),moveStateManager:O,enable:A,assignEvents:Ra})};class Ui{constructor(A,x){this._minTouches=A.cooperativeGestures?2:1,this._clickTolerance=A.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(A,x,L){return this._calculateTransform(A,x,L)}touchmove(A,x,L){if(this._map._cooperativeGestures&&(this._minTouches===2&&L.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(A,!1,L.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(L.length<this._minTouches))return A.preventDefault(),this._calculateTransform(A,x,L)}touchend(A,x,L){this._calculateTransform(A,x,L),this._active&&L.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(A,x,L){L.length>0&&(this._active=!0);const O=ds(L,x),y=new s.P(0,0),a=new s.P(0,0);let d=0;for(const B in O){const T=O[B],U=this._touches[B];U&&(y._add(T),a._add(T.sub(U)),d++,O[B]=T)}if(this._touches=O,d<this._minTouches||!a.mag())return;const _=a.div(d);return this._sum._add(_),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(d),panDelta:_}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(A,x,L){this._firstTwoTouches||L.length<2||(this._firstTwoTouches=[L[0].identifier,L[1].identifier],this._start([x[0],x[1]]))}touchmove(A,x,L){if(!this._firstTwoTouches)return;A.preventDefault();const[O,y]=this._firstTwoTouches,a=Fi(L,x,O),d=Fi(L,x,y);if(!a||!d)return;const _=this._aroundCenter?null:a.add(d).div(2);return this._move([a,d],_,A)}touchend(A,x,L){if(!this._firstTwoTouches)return;const[O,y]=this._firstTwoTouches,a=Fi(L,x,O),d=Fi(L,x,y);a&&d||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(A){this._enabled=!0,this._aroundCenter=!!A&&A.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fi(z,A,x){for(let L=0;L<z.length;L++)if(z[L].identifier===x)return A[L]}function ml(z,A){return Math.log(z/A)/Math.LN2}class Kl extends ea{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(A){this._startDistance=this._distance=A[0].dist(A[1])}_move(A,x){const L=this._distance;if(this._distance=A[0].dist(A[1]),this._active||!(Math.abs(ml(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ml(this._distance,L),pinchAround:x}}}function Mi(z,A){return 180*z.angleWith(A)/Math.PI}class Wl extends ea{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(A){this._startVector=this._vector=A[0].sub(A[1]),this._minDiameter=A[0].dist(A[1])}_move(A,x){const L=this._vector;if(this._vector=A[0].sub(A[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mi(this._vector,L),pinchAround:x}}_isBelowThreshold(A){this._minDiameter=Math.min(this._minDiameter,A.mag());const x=25/(Math.PI*this._minDiameter)*360,L=Mi(A,this._startVector);return Math.abs(L)<x}}function Si(z){return Math.abs(z.y)>Math.abs(z.x)}class oo extends ea{constructor(A){super(),this._map=A}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(A,x,L){super.touchstart(A,x,L),this._currentTouchCount=L.length}_start(A){this._lastPoints=A,Si(A[0].sub(A[1]))&&(this._valid=!1)}_move(A,x,L){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const O=A[0].sub(this._lastPoints[0]),y=A[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(O,y,L.timeStamp),this._valid?(this._lastPoints=A,this._active=!0,{pitchDelta:(O.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(A,x,L){if(this._valid!==void 0)return this._valid;const O=A.mag()>=2,y=x.mag()>=2;if(!O&&!y)return;if(!O||!y)return this._firstMove===void 0&&(this._firstMove=L),L-this._firstMove<100&&void 0;const a=A.y>0==x.y>0;return Si(A)&&Si(x)&&a}}const yo={panStep:100,bearingStep:15,pitchStep:10};class kc{constructor(A){this._tr=new Ln(A);const x=yo;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(A){if(A.altKey||A.ctrlKey||A.metaKey)return;let x=0,L=0,O=0,y=0,a=0;switch(A.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:A.shiftKey?L=-1:(A.preventDefault(),y=-1);break;case 39:A.shiftKey?L=1:(A.preventDefault(),y=1);break;case 38:A.shiftKey?O=1:(A.preventDefault(),a=-1);break;case 40:A.shiftKey?O=-1:(A.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(L=0,O=0),{cameraAnimation:d=>{const _=this._tr;d.easeTo({duration:300,easeId:"keyboardHandler",easing:Xl,zoom:x?Math.round(_.zoom)+x*(A.shiftKey?2:1):_.zoom,bearing:_.bearing+L*this._bearingStep,pitch:_.pitch+O*this._pitchStep,offset:[-y*this._panStep,-a*this._panStep],center:_.center},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xl(z){return z*(2-z)}const Oc=4.000244140625;class Uc{constructor(A,x){this._onTimeout=L=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(L)},this._map=A,this._tr=new Ln(A),this._el=A.getCanvasContainer(),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(A){this._defaultZoomRate=A}setWheelZoomRate(A){this._wheelZoomRate=A}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(A){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!A&&A.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(A){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!A[this._map._metaKey])return;A.preventDefault()}let x=A.deltaMode===WheelEvent.DOM_DELTA_LINE?40*A.deltaY:A.deltaY;const L=s.h.now(),O=L-(this._lastWheelEventTime||0);this._lastWheelEventTime=L,x!==0&&x%Oc==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":O>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,A)):this._type||(this._type=Math.abs(O*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),A.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=A,this._delta-=x,this._active||this._start(A)),A.preventDefault()}_start(A){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const x=b.mousePos(this._el,A),L=this._tr;this._around=s.L.convert(this._aroundCenter?L.center:L.unproject(x)),this._aroundPoint=L.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const A=this._tr.transform;if(this._delta!==0){const d=this._type==="wheel"&&Math.abs(this._delta)>Oc?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&_!==0&&(_=1/_);const B=typeof this._targetZoom=="number"?A.zoomScale(this._targetZoom):A.scale;this._targetZoom=Math.min(A.maxZoom,Math.max(A.minZoom,A.scaleZoom(B*_))),this._type==="wheel"&&(this._startZoom=A.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:A.zoom,L=this._startZoom,O=this._easing;let y,a=!1;if(this._type==="wheel"&&L&&O){const d=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),_=O(d);y=s.B.number(L,x,_),d<1?this._frameId||(this._frameId=!0):a=!0}else y=x,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:y-A.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(A){let x=s.bb;if(this._prevEase){const L=this._prevEase,O=(s.h.now()-L.start)/L.duration,y=L.easing(O+.01)-L.easing(O),a=.27/Math.sqrt(y*y+1e-4)*.01,d=Math.sqrt(.0729-a*a);x=s.ba(a,d,.25,1)}return this._prevEase={start:s.h.now(),duration:A,easing:x},x}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Nc{constructor(A,x){this._clickZoom=A,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zc{constructor(A){this._tr=new Ln(A),this.reset()}reset(){this._active=!1}dblclick(A,x){return A.preventDefault(),{cameraAnimation:L=>{L.easeTo({duration:300,zoom:this._tr.zoom+(A.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rl{constructor(){this._tap=new fs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(A,x,L){if(!this._swipePoint)if(this._tapTime){const O=x[0],y=A.timeStamp-this._tapTime<500,a=this._tapPoint.dist(O)<30;y&&a?L.length>0&&(this._swipePoint=O,this._swipeTouch=L[0].identifier):this.reset()}else this._tap.touchstart(A,x,L)}touchmove(A,x,L){if(this._tapTime){if(this._swipePoint){if(L[0].identifier!==this._swipeTouch)return;const O=x[0],y=O.y-this._swipePoint.y;return this._swipePoint=O,A.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(A,x,L)}touchend(A,x,L){if(this._tapTime)this._swipePoint&&L.length===0&&this.reset();else{const O=this._tap.touchend(A,x,L);O&&(this._tapTime=A.timeStamp,this._tapPoint=O)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _n{constructor(A,x,L){this._el=A,this._mousePan=x,this._touchPan=L}enable(A){this._inertiaOptions=A||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Es{constructor(A,x,L){this._pitchWithRotate=A.pitchWithRotate,this._mouseRotate=x,this._mousePitch=L}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ro{constructor(A,x,L,O){this._el=A,this._touchZoom=x,this._touchRotate=L,this._tapDragZoom=O,this._rotationDisabled=!1,this._enabled=!0}enable(A){this._touchZoom.enable(A),this._rotationDisabled||this._touchRotate.enable(A),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zl=z=>z.zoom||z.drag||z.pitch||z.rotate;class Uu extends s.k{}function mc(z){return z.panDelta&&z.panDelta.mag()||z.zoomDelta||z.bearingDelta||z.pitchDelta}class hu{constructor(A,x){this.handleWindowEvent=O=>{this.handleEvent(O,`${O.type}Window`)},this.handleEvent=(O,y)=>{if(O.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=O.type==="renderFrame"?void 0:O,d={needsRenderFrame:!1},_={},B={},T=O.touches,U=T?this._getMapTouches(T):void 0,H=U?b.touchPos(this._el,U):b.mousePos(this._el,O);for(const{handlerName:I,handler:k,allowed:j}of this._handlers){if(!k.isEnabled())continue;let Y;this._blockedByActive(B,j,I)?k.reset():k[y||O.type]&&(Y=k[y||O.type](O,H,U),this.mergeHandlerResult(d,_,Y,I,a),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||k.isActive())&&(B[I]=k)}const q={};for(const I in this._previousActiveHandlers)B[I]||(q[I]=a);this._previousActiveHandlers=B,(Object.keys(q).length||mc(d))&&(this._changes.push([d,_,q]),this._triggerRenderFrame()),(Object.keys(B).length||mc(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:w}=d;w&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],w(this._map))},this._map=A,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ro(A),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);const L=this._el;this._listeners=[[L,"touchstart",{passive:!0}],[L,"touchmove",{passive:!1}],[L,"touchend",void 0],[L,"touchcancel",void 0],[L,"mousedown",void 0],[L,"mousemove",void 0],[L,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[L,"mouseover",void 0],[L,"mouseout",void 0],[L,"dblclick",void 0],[L,"click",void 0],[L,"keydown",{capture:!1}],[L,"keyup",void 0],[L,"wheel",{passive:!1}],[L,"contextmenu",void 0],[window,"blur",void 0]];for(const[O,y,a]of this._listeners)b.addEventListener(O,y,O===document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[A,x,L]of this._listeners)b.removeEventListener(A,x,A===document?this.handleWindowEvent:this.handleEvent,L)}_addDefaultHandlers(A){const x=this._map,L=x.getCanvasContainer();this._add("mapEvent",new _a(x,A));const O=x.boxZoom=new Do(x,A);this._add("boxZoom",O),A.interactive&&A.boxZoom&&O.enable();const y=new Lr(x),a=new zc(x);x.doubleClickZoom=new Nc(a,y),this._add("tapZoom",y),this._add("clickZoom",a),A.interactive&&A.doubleClickZoom&&x.doubleClickZoom.enable();const d=new rl;this._add("tapDragZoom",d);const _=x.touchPitch=new oo(x);this._add("touchPitch",_),A.interactive&&A.touchPitch&&x.touchPitch.enable(A.touchPitch);const B=mo(A),T=Yo(A);x.dragRotate=new Es(A,B,T),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]),A.interactive&&A.dragRotate&&x.dragRotate.enable();const U=(j=>{let{enable:Y,clickTolerance:X}=j;const ee=new qn({checkCorrectEvent:re=>b.mouseButton(re)===0&&!re.ctrlKey});return new Jr({clickTolerance:X,move:(re,le)=>({around:le,panDelta:le.sub(re)}),activateOnStart:!0,moveStateManager:ee,enable:Y,assignEvents:Ra})})(A),H=new Ui(A,x);x.dragPan=new _n(L,U,H),this._add("mousePan",U),this._add("touchPan",H,["touchZoom","touchRotate"]),A.interactive&&A.dragPan&&x.dragPan.enable(A.dragPan);const q=new Wl,w=new Kl;x.touchZoomRotate=new Ro(L,w,q,d),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",w,["touchPan","touchRotate"]),A.interactive&&A.touchZoomRotate&&x.touchZoomRotate.enable(A.touchZoomRotate);const I=x.scrollZoom=new Uc(x,()=>this._triggerRenderFrame());this._add("scrollZoom",I,["mousePan"]),A.interactive&&A.scrollZoom&&x.scrollZoom.enable(A.scrollZoom);const k=x.keyboard=new kc(x);this._add("keyboard",k),A.interactive&&A.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new Da(x))}_add(A,x,L){this._handlers.push({handlerName:A,handler:x,allowed:L}),this._handlersById[A]=x}stop(A){if(!this._updatingCamera){for(const{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},A),this._changes=[]}}isActive(){for(const{handler:A}of this._handlers)if(A.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zl(this._eventsInProgress)||this.isZooming()}_blockedByActive(A,x,L){for(const O in A)if(O!==L&&(!x||x.indexOf(O)<0))return!0;return!1}_getMapTouches(A){const x=[];for(const L of A)this._el.contains(L.target)&&x.push(L);return x}mergeHandlerResult(A,x,L,O,y){if(!L)return;s.e(A,L);const a={handlerName:O,originalEvent:L.originalEvent||y};L.zoomDelta!==void 0&&(x.zoom=a),L.panDelta!==void 0&&(x.drag=a),L.pitchDelta!==void 0&&(x.pitch=a),L.bearingDelta!==void 0&&(x.rotate=a)}_applyChanges(){const A={},x={},L={};for(const[O,y,a]of this._changes)O.panDelta&&(A.panDelta=(A.panDelta||new s.P(0,0))._add(O.panDelta)),O.zoomDelta&&(A.zoomDelta=(A.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(A.bearingDelta=(A.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(A.pitchDelta=(A.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(A.around=O.around),O.pinchAround!==void 0&&(A.pinchAround=O.pinchAround),O.noInertia&&(A.noInertia=O.noInertia),s.e(x,y),s.e(L,a);this._updateMapTransform(A,x,L),this._changes=[]}_updateMapTransform(A,x,L){const O=this._map,y=O._getTransformForUpdate(),a=O.terrain;if(!(mc(A)||a&&this._terrainMovement))return this._fireEvents(x,L,!0);let{panDelta:d,zoomDelta:_,bearingDelta:B,pitchDelta:T,around:U,pinchAround:H}=A;H!==void 0&&(U=H),O._stop(!0),U=U||O.transform.centerPoint;const q=y.pointLocation(d?U.sub(d):U);B&&(y.bearing+=B),T&&(y.pitch+=T),_&&(y.zoom+=_),a?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(d)):y.setLocationAtPoint(q,U):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(q,U),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(O.terrain)})):y.setLocationAtPoint(q,U),O._applyUpdatedTransform(y),this._map._update(),A.noInertia||this._inertia.record(A),this._fireEvents(x,L,!0)}_fireEvents(A,x,L){const O=Zl(this._eventsInProgress),y=Zl(A),a={};for(const T in A){const{originalEvent:U}=A[T];this._eventsInProgress[T]||(a[`${T}start`]=U),this._eventsInProgress[T]=A[T]}!O&&y&&this._fireEvent("movestart",y.originalEvent);for(const T in a)this._fireEvent(T,a[T]);y&&this._fireEvent("move",y.originalEvent);for(const T in A){const{originalEvent:U}=A[T];this._fireEvent(T,U)}const d={};let _;for(const T in this._eventsInProgress){const{handlerName:U,originalEvent:H}=this._eventsInProgress[T];this._handlersById[U].isActive()||(delete this._eventsInProgress[T],_=x[U]||H,d[`${T}end`]=_)}for(const T in d)this._fireEvent(T,d[T]);const B=Zl(this._eventsInProgress);if(L&&(O||y)&&!B){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!T||!T.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:_})),U(this._map.getBearing())&&this._map.resetNorth()):(U(T.bearing||this._map.getBearing())&&(T.bearing=0),T.freezeElevation=!0,this._map.easeTo(T,{originalEvent:_})),this._updatingCamera=!1}}_fireEvent(A,x){this._map.fire(new s.k(A,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(A=>{delete this._frameId,this.handleEvent(new Uu("renderFrame",{timeStamp:A})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ba extends s.E{constructor(A,x){super(),this._renderFrameCallback=()=>{const L=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(L)),L<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=A,this._bearingSnap=x.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(A,x){return this.jumpTo({center:A},x)}panBy(A,x,L){return A=s.P.convert(A).mult(-1),this.panTo(this.transform.center,s.e({offset:A},x),L)}panTo(A,x,L){return this.easeTo(s.e({center:A},x),L)}getZoom(){return this.transform.zoom}setZoom(A,x){return this.jumpTo({zoom:A},x),this}zoomTo(A,x,L){return this.easeTo(s.e({zoom:A},x),L)}zoomIn(A,x){return this.zoomTo(this.getZoom()+1,A,x),this}zoomOut(A,x){return this.zoomTo(this.getZoom()-1,A,x),this}getBearing(){return this.transform.bearing}setBearing(A,x){return this.jumpTo({bearing:A},x),this}getPadding(){return this.transform.padding}setPadding(A,x){return this.jumpTo({padding:A},x),this}rotateTo(A,x,L){return this.easeTo(s.e({bearing:A},x),L)}resetNorth(A,x){return this.rotateTo(0,s.e({duration:1e3},A),x),this}resetNorthPitch(A,x){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},A),x),this}snapToNorth(A,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(A,x):this}getPitch(){return this.transform.pitch}setPitch(A,x){return this.jumpTo({pitch:A},x),this}cameraForBounds(A,x){A=Ze.convert(A);const L=x&&x.bearing||0;return this._cameraForBoxAndBearing(A.getNorthWest(),A.getSouthEast(),L,x)}_cameraForBoxAndBearing(A,x,L,O){const y={top:0,bottom:0,right:0,left:0};if(typeof(O=s.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},O)).padding=="number"){const re=O.padding;O.padding={top:re,bottom:re,right:re,left:re}}O.padding=s.e(y,O.padding);const a=this.transform,d=a.padding,_=a.project(s.L.convert(A)),B=a.project(s.L.convert(x)),T=_.rotate(-L*Math.PI/180),U=B.rotate(-L*Math.PI/180),H=new s.P(Math.max(T.x,U.x),Math.max(T.y,U.y)),q=new s.P(Math.min(T.x,U.x),Math.min(T.y,U.y)),w=H.sub(q),I=(a.width-(d.left+d.right+O.padding.left+O.padding.right))/w.x,k=(a.height-(d.top+d.bottom+O.padding.top+O.padding.bottom))/w.y;if(k<0||I<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const j=Math.min(a.scaleZoom(a.scale*Math.min(I,k)),O.maxZoom),Y=s.P.convert(O.offset),X=new s.P((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(L*Math.PI/180),ee=Y.add(X).mult(a.scale/a.zoomScale(j));return{center:a.unproject(_.add(B).div(2).sub(ee)),zoom:j,bearing:L}}fitBounds(A,x,L){return this._fitInternal(this.cameraForBounds(A,x),x,L)}fitScreenCoordinates(A,x,L,O,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(A)),this.transform.pointLocation(s.P.convert(x)),L,O),O,y)}_fitInternal(A,x,L){return A?(delete(x=s.e(A,x)).padding,x.linear?this.easeTo(x,L):this.flyTo(x,L)):this}jumpTo(A,x){this.stop();const L=this._getTransformForUpdate();let O=!1,y=!1,a=!1;return"zoom"in A&&L.zoom!==+A.zoom&&(O=!0,L.zoom=+A.zoom),A.center!==void 0&&(L.center=s.L.convert(A.center)),"bearing"in A&&L.bearing!==+A.bearing&&(y=!0,L.bearing=+A.bearing),"pitch"in A&&L.pitch!==+A.pitch&&(a=!0,L.pitch=+A.pitch),A.padding==null||L.isPaddingEqual(A.padding)||(L.padding=A.padding),this._applyUpdatedTransform(L),this.fire(new s.k("movestart",x)).fire(new s.k("move",x)),O&&this.fire(new s.k("zoomstart",x)).fire(new s.k("zoom",x)).fire(new s.k("zoomend",x)),y&&this.fire(new s.k("rotatestart",x)).fire(new s.k("rotate",x)).fire(new s.k("rotateend",x)),a&&this.fire(new s.k("pitchstart",x)).fire(new s.k("pitch",x)).fire(new s.k("pitchend",x)),this.fire(new s.k("moveend",x))}calculateCameraOptionsFromTo(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const y=s.U.fromLngLat(A,x),a=s.U.fromLngLat(L,O),d=a.x-y.x,_=a.y-y.y,B=a.z-y.z,T=Math.hypot(d,_,B);if(T===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(d,_),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),q=180*Math.atan2(d,-_)/Math.PI;let w=180*Math.acos(U/T)/Math.PI;return w=B<0?90-w:90+w,{center:a.toLngLat(),zoom:H,pitch:w,bearing:q}}easeTo(A,x){this._stop(!1,A.easeId),((A=s.e({offset:[0,0],duration:500,easing:s.bb},A)).animate===!1||!A.essential&&s.h.prefersReducedMotion)&&(A.duration=0);const L=this._getTransformForUpdate(),O=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?+A.zoom:O,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,T="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=s.P.convert(A.offset);let q=L.centerPoint.add(H);const w=L.pointLocation(q),I=s.L.convert(A.center||w);this._normalizeCenter(I);const k=L.project(w),j=L.project(I).sub(k),Y=L.zoomScale(_-O);let X,ee;A.around&&(X=s.L.convert(A.around),ee=L.locationPoint(X));const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_!==O,this._rotating=this._rotating||y!==B,this._pitching=this._pitching||T!==a,this._padding=!L.isPaddingEqual(U),this._easeId=A.easeId,this._prepareEase(x,A.noMoveStart,re),this.terrain&&this._prepareElevation(I),this._ease(le=>{if(this._zooming&&(L.zoom=s.B.number(O,_,le)),this._rotating&&(L.bearing=s.B.number(y,B,le)),this._pitching&&(L.pitch=s.B.number(a,T,le)),this._padding&&(L.interpolatePadding(d,U,le),q=L.centerPoint.add(H)),this.terrain&&!A.freezeElevation&&this._updateElevation(le),X)L.setLocationAtPoint(X,ee);else{const pe=L.zoomScale(L.zoom-O),ge=_>O?Math.min(2,Y):Math.max(.5,Y),we=Math.pow(ge,1-le),De=L.unproject(k.add(j.mult(le*we)).mult(pe));L.setLocationAtPoint(L.renderWorldCopies?De.wrap():De,q)}this._applyUpdatedTransform(L),this._fireMoveEvents(x)},le=>{this.terrain&&this._finalizeElevation(),this._afterEase(x,le)},A),this}_prepareEase(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,x||L.moving||this.fire(new s.k("movestart",A)),this._zooming&&!L.zooming&&this.fire(new s.k("zoomstart",A)),this._rotating&&!L.rotating&&this.fire(new s.k("rotatestart",A)),this._pitching&&!L.pitching&&this.fire(new s.k("pitchstart",A))}_prepareElevation(A){this._elevationCenter=A,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(A,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(A){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(A<1&&x!==this._elevationTarget){const L=this._elevationTarget-this._elevationStart;this._elevationStart+=A*(L-(x-(L*A+this._elevationStart))/(1-A)),this._elevationTarget=x}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,A)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(A){if(!this.transformCameraUpdate)return;const x=A.clone(),{center:L,zoom:O,pitch:y,bearing:a,elevation:d}=this.transformCameraUpdate(x);L&&(x.center=L),O!==void 0&&(x.zoom=O),y!==void 0&&(x.pitch=y),a!==void 0&&(x.bearing=a),d!==void 0&&(x.elevation=d),this.transform.apply(x)}_fireMoveEvents(A){this.fire(new s.k("move",A)),this._zooming&&this.fire(new s.k("zoom",A)),this._rotating&&this.fire(new s.k("rotate",A)),this._pitching&&this.fire(new s.k("pitch",A))}_afterEase(A,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;const L=this._zooming,O=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,L&&this.fire(new s.k("zoomend",A)),O&&this.fire(new s.k("rotateend",A)),y&&this.fire(new s.k("pitchend",A)),this.fire(new s.k("moveend",A))}flyTo(A,x){if(!A.essential&&s.h.prefersReducedMotion){const Ve=s.F(A,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,x)}this.stop(),A=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},A);const L=this._getTransformForUpdate(),O=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?s.ad(+A.zoom,L.minZoom,L.maxZoom):O,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,T="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=L.zoomScale(_-O),q=s.P.convert(A.offset);let w=L.centerPoint.add(q);const I=L.pointLocation(w),k=s.L.convert(A.center||I);this._normalizeCenter(k);const j=L.project(I),Y=L.project(k).sub(j);let X=A.curve;const ee=Math.max(L.width,L.height),re=ee/H,le=Y.mag();if("minZoom"in A){const Ve=s.ad(Math.min(A.minZoom,O,_),L.minZoom,L.maxZoom),gt=ee/L.zoomScale(Ve-O);X=Math.sqrt(gt/le*2)}const pe=X*X;function ge(Ve){const gt=(re*re-ee*ee+(Ve?-1:1)*pe*pe*le*le)/(2*(Ve?re:ee)*pe*le);return Math.log(Math.sqrt(gt*gt+1)-gt)}function we(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function De(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Me=ge(!1);let st=function(Ve){return De(Me)/De(Me+X*Ve)},We=function(Ve){return ee*((De(Me)*(we(gt=Me+X*Ve)/De(gt))-we(Me))/pe)/le;var gt},ke=(ge(!0)-Me)/X;if(Math.abs(le)<1e-6||!isFinite(ke)){if(Math.abs(ee-re)<1e-6)return this.easeTo(A,x);const Ve=re<ee?-1:1;ke=Math.abs(Math.log(re/ee))/X,We=function(){return 0},st=function(gt){return Math.exp(Ve*X*gt)}}return A.duration="duration"in A?+A.duration:1e3*ke/("screenSpeed"in A?+A.screenSpeed/X:+A.speed),A.maxDuration&&A.duration>A.maxDuration&&(A.duration=0),this._zooming=!0,this._rotating=y!==B,this._pitching=T!==a,this._padding=!L.isPaddingEqual(U),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(k),this._ease(Ve=>{const gt=Ve*ke,xt=1/st(gt);L.zoom=Ve===1?_:O+L.scaleZoom(xt),this._rotating&&(L.bearing=s.B.number(y,B,Ve)),this._pitching&&(L.pitch=s.B.number(a,T,Ve)),this._padding&&(L.interpolatePadding(d,U,Ve),w=L.centerPoint.add(q)),this.terrain&&!A.freezeElevation&&this._updateElevation(Ve);const At=Ve===1?k:L.unproject(j.add(Y.mult(We(gt))).mult(xt));L.setLocationAtPoint(L.renderWorldCopies?At.wrap():At,w),this._applyUpdatedTransform(L),this._fireMoveEvents(x)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(x)},A),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(A,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const L=this._onEaseEnd;delete this._onEaseEnd,L.call(this,x)}if(!A){const L=this.handlers;L&&L.stop(!1)}return this}_ease(A,x,L){L.animate===!1||L.duration===0?(A(1),x()):(this._easeStart=s.h.now(),this._easeOptions=L,this._onEaseFrame=A,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(A,x){A=s.b5(A,-180,180);const L=Math.abs(A-x);return Math.abs(A-360-x)<L&&(A-=360),Math.abs(A+360-x)<L&&(A+=360),A}_normalizeCenter(A){const x=this.transform;if(!x.renderWorldCopies||x.lngRange)return;const L=A.lng-x.center.lng;A.lng+=L>180?-360:L<-180?360:0}queryTerrainElevation(A){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(A),this.transform.tileZoom)-this.transform.elevation:null}}class Ws{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=A}getDefaultPosition(){return"bottom-right"}onAdd(A){return this._map=A,this._compact=this.options&&this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(A,x){const L=this._map._getUIString(`AttributionControl.${x}`);A.title=L,A.setAttribute("aria-label",L)}_updateAttributions(){if(!this._map.style)return;let A=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?A=A.concat(this.options.customAttribution.map(O=>typeof O!="string"?"":O)):typeof this.options.customAttribution=="string"&&A.push(this.options.customAttribution)),this._map.style.stylesheet){const O=this._map.style.stylesheet;this.styleOwner=O.owner,this.styleId=O.id}const x=this._map.style.sourceCaches;for(const O in x){const y=x[O];if(y.used||y.usedForTerrain){const a=y.getSource();a.attribution&&A.indexOf(a.attribution)<0&&A.push(a.attribution)}}A=A.filter(O=>String(O).trim()),A.sort((O,y)=>O.length-y.length),A=A.filter((O,y)=>{for(let a=y+1;a<A.length;a++)if(A[a].indexOf(O)>=0)return!1;return!0});const L=A.join(" | ");L!==this._attribHTML&&(this._attribHTML=L,A.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class xi{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const x=this._container.children;if(x.length){const L=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&L.classList.add("maplibregl-compact"):L.classList.remove("maplibregl-compact")}},this.options=A}getDefaultPosition(){return"bottom-left"}onAdd(A){this._map=A,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const x=b.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class or{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(A){const x=++this._id;return this._queue.push({callback:A,id:x,cancelled:!1}),x}remove(A){const x=this._currentlyRunning,L=x?this._queue.concat(x):this._queue;for(const O of L)if(O.id===A)return void(O.cancelled=!0)}run(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const x=this._currentlyRunning=this._queue;this._queue=[];for(const L of x)if(!L.cancelled&&(L.callback(A),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Jl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Qc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Vc extends s.E{constructor(A){super(),this.sourceCache=A,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,A.usedForTerrain=!0,A.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(A,x){this.sourceCache.update(A,x),this._renderableTilesKeys=[];const L={};for(const O of A.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))L[O.key]=!0,this._renderableTilesKeys.push(O.key),this._tiles[O.key]||(O.posMatrix=new Float64Array(16),s.aS(O.posMatrix,0,s.N,0,s.N,0,1),this._tiles[O.key]=new ki(O,this.tileSize));for(const O in this._tiles)L[O]||delete this._tiles[O]}freeRtt(A){for(const x in this._tiles){const L=this._tiles[x];(!A||L.tileID.equals(A)||L.tileID.isChildOf(A)||A.isChildOf(L.tileID))&&(L.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(A=>this.getTileByID(A))}getTileByID(A){return this._tiles[A]}getTerrainCoords(A){const x={};for(const L of this._renderableTilesKeys){const O=this._tiles[L].tileID;if(O.canonical.equals(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16),s.aS(y.posMatrix,0,s.N,0,s.N,0,1),x[L]=y}else if(O.canonical.isChildOf(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=O.canonical.z-A.canonical.z,d=O.canonical.x-(O.canonical.x>>a<<a),_=O.canonical.y-(O.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,B,0,B,0,1),s.$(y.posMatrix,y.posMatrix,[-d*B,-_*B,0]),x[L]=y}else if(A.canonical.isChildOf(O.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=A.canonical.z-O.canonical.z,d=A.canonical.x-(A.canonical.x>>a<<a),_=A.canonical.y-(A.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,s.N,0,s.N,0,1),s.$(y.posMatrix,y.posMatrix,[d*B,_*B,0]),s.a0(y.posMatrix,y.posMatrix,[1/2**a,1/2**a,0]),x[L]=y}}return x}getSourceTile(A,x){const L=this.sourceCache._source;let O=A.overscaledZ-this.deltaZoom;if(O>L.maxzoom&&(O=L.maxzoom),O<L.minzoom)return null;this._sourceTileCache[A.key]||(this._sourceTileCache[A.key]=A.scaledTo(O).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[A.key]);if((!y||!y.dem)&&x)for(;O>=L.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(A.scaledTo(O--).key);return y}tilesAfterTime(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(x=>x.timeAdded>=A)}}class Ss{constructor(A,x,L){this.painter=A,this.sourceCache=new Vc(x),this.options=L,this.exaggeration=typeof L.exaggeration=="number"?L.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;var y;if(!(x>=0&&x<O&&L>=0&&L<O))return 0;const a=this.getTerrainData(A),d=(y=a.tile)===null||y===void 0?void 0:y.dem;if(!d)return 0;const _=function(w,I,k){var j=I[0],Y=I[1];return w[0]=k[0]*j+k[4]*Y+k[12],w[1]=k[1]*j+k[5]*Y+k[13],w}([],[x/O*s.N,L/O*s.N],a.u_terrain_matrix),B=[_[0]*d.dim,_[1]*d.dim],T=Math.floor(B[0]),U=Math.floor(B[1]),H=B[0]-T,q=B[1]-U;return d.get(T,U)*(1-H)*(1-q)+d.get(T+1,U)*H*(1-q)+d.get(T,U+1)*(1-H)*q+d.get(T+1,U+1)*H*q}getElevationForLngLatZoom(A,x){const{tileID:L,mercatorX:O,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(A,x);return this.getElevation(L,O%s.N,y%s.N,s.N)}getElevation(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;return this.getDEMElevation(A,x,L,O)*this.exaggeration}getTerrainData(A){if(!this._emptyDemTexture){const O=this.painter.context,y=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new rt(O,y,O.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new rt(O,new s.R({width:1,height:1}),O.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const x=this.sourceCache.getSourceTile(A,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){const O=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new rt(O,x.dem.getPixels(),O.gl.RGBA,{premultiply:!1}),x.demTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}const L=x&&x+x.tileID.key+A.key;if(L&&!this._demMatrixCache[L]){const O=this.sourceCache.sourceCache._source.maxzoom;let y=A.canonical.z-x.tileID.canonical.z;A.overscaledZ>A.canonical.z&&(A.canonical.z>=O?y=A.canonical.z-O:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=A.canonical.x-(A.canonical.x>>y<<y),d=A.canonical.y-(A.canonical.y>>y<<y),_=s.bc(new Float64Array(16),[1/(s.N<<y),1/(s.N<<y),0]);s.$(_,_,[a*s.N,d*s.N,0]),this._demMatrixCache[A.key]={matrix:_,coord:A}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:L?this._demMatrixCache[A.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(A){const x=this.painter,L=x.width/devicePixelRatio,O=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===L&&this._fbo.height===O||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new rt(x.context,{width:L,height:O,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new rt(x.context,{width:L,height:O,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(L,O,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,L,O))),this._fbo.colorAttachment.set(A==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const A=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,a=0;y<this._coordsTextureSize;y++)for(let d=0;d<this._coordsTextureSize;d++,a+=4)x[a+0]=255&d,x[a+1]=255&y,x[a+2]=d>>8<<4|y>>8,x[a+3]=0;const L=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),O=new rt(A,L,A.gl.RGBA,{premultiply:!1});return O.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._coordsTexture=O,O}pointCoordinate(A){const x=new Uint8Array(4),L=this.painter.context,O=L.gl;L.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),O.readPixels(A.x,this.painter.height/devicePixelRatio-A.y-1,1,1,O.RGBA,O.UNSIGNED_BYTE,x),L.bindFramebuffer.set(null);const y=x[0]+(x[2]>>4<<8),a=x[1]+((15&x[2])<<8),d=this.coordsIndex[255-x[3]],_=d&&this.sourceCache.getTileByID(d);if(!_)return null;const B=this._coordsTextureSize,T=(1<<_.tileID.canonical.z)*B;return new s.U(this._allowMercatorOverflow(A,(_.tileID.canonical.x*B+y)/T),(_.tileID.canonical.y*B+a)/T,this.getElevation(_.tileID,y,a,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const A=this.painter.context,x=new s.bd,L=new s.b0,O=this.meshSize,y=s.N/O,a=O*O;for(let U=0;U<=O;U++)for(let H=0;H<=O;H++)x.emplaceBack(H*y,U*y,0);for(let U=0;U<a;U+=O+1)for(let H=0;H<O;H++)L.emplaceBack(H+U,O+H+U+1,O+H+U+2),L.emplaceBack(H+U,O+H+U+2,H+U+1);const d=x.length,_=d+2*(O+1);for(const U of[0,1])for(let H=0;H<=O;H++)for(const q of[0,1])x.emplaceBack(H*y,U*s.N,q);for(let U=0;U<2*O;U+=2)L.emplaceBack(_+U,_+U+1,_+U+3),L.emplaceBack(_+U,_+U+3,_+U+2),L.emplaceBack(d+U,d+U+3,d+U+1),L.emplaceBack(d+U,d+U+2,d+U+3);const B=x.length,T=B+2*(O+1);for(const U of[0,1])for(let H=0;H<=O;H++)for(const q of[0,1])x.emplaceBack(U*s.N,H*y,q);for(let U=0;U<2*O;U+=2)L.emplaceBack(B+U,B+U+1,B+U+3),L.emplaceBack(B+U,B+U+3,B+U+2),L.emplaceBack(T+U,T+U+3,T+U+1),L.emplaceBack(T+U,T+U+2,T+U+3);return this._mesh={indexBuffer:A.createIndexBuffer(L),vertexBuffer:A.createVertexBuffer(x,Qc.members),segments:s.S.simpleSegment(0,0,x.length,L.length)},this._mesh}getMeshFrameDelta(A){return 2*Math.PI*s.be/Math.pow(2,A)/5}getMinTileElevationForLngLatZoom(A,x){var L;const{tileID:O}=this._getOverscaledTileIDFromLngLatZoom(A,x);return(L=this.getMinMaxElevation(O).minElevation)!==null&&L!==void 0?L:0}getMinMaxElevation(A){const x=this.getTerrainData(A).tile,L={minElevation:null,maxElevation:null};return x&&x.dem&&(L.minElevation=x.dem.min*this.exaggeration,L.maxElevation=x.dem.max*this.exaggeration),L}_getOverscaledTileIDFromLngLatZoom(A,x){const L=s.U.fromLngLat(A.wrap()),O=(1<<x)*s.N,y=L.x*O,a=L.y*O,d=Math.floor(y/s.N),_=Math.floor(a/s.N);return{tileID:new s.O(x,0,x,d,_),mercatorX:y,mercatorY:a}}_allowMercatorOverflow(A,x){const L=A.x<this.painter.width/2;let O=s.bf(x);const y=this.painter.transform.center.lng;return L&&Math.sign(O)>0&&Math.sign(y)<0||!L&&Math.sign(O)<0&&Math.sign(y)>0?(O=360*Math.sign(y)+O,s.G(O)):x}}class xh{constructor(A,x,L){this._context=A,this._size=x,this._tileSize=L,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const A of this._objects)A.texture.destroy(),A.fbo.destroy()}_createObject(A){const x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),L=new rt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return L.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(L.texture),{id:A,fbo:x,texture:L,stamp:-1,inUse:!1}}getObjectForId(A){return this._objects[A]}useObject(A){A.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(x=>A.id!==x),this._recentlyUsed.push(A.id)}stampObject(A){A.stamp=++this._stamp}getOrCreateFreeObject(){for(const x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const A=this._createObject(this._objects.length);return this._objects.push(A),A}freeObject(A){A.inUse=!1}freeAllObjects(){for(const A of this._objects)this.freeObject(A)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(A=>!A.inUse)===!1}}const $n={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Au{constructor(A,x){this.painter=A,this.terrain=x,this.pool=new xh(A.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(A){return this.pool.getObjectForId(A.rtt[this._stacks.length-1].id).texture}prepareForRender(A,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=A._order.filter(L=>!A._layers[L].isHidden(x)),this._coordsDescendingInv={};for(const L in A.sourceCaches){this._coordsDescendingInv[L]={};const O=A.sourceCaches[L].getVisibleCoordinates();for(const y of O){const a=this.terrain.sourceCache.getTerrainCoords(y);for(const d in a)this._coordsDescendingInv[L][d]||(this._coordsDescendingInv[L][d]=[]),this._coordsDescendingInv[L][d].push(a[d])}}this._coordsDescendingInvStr={};for(const L of A._order){const O=A._layers[L],y=O.source;if($n[O.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const a in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][a]=this._coordsDescendingInv[y][a].map(d=>d.key).sort().join()}}for(const L of this._renderableTiles)for(const O in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[O][L.tileID.key];y&&y!==L.rttCoords[O]&&(L.rtt=[])}}renderLayer(A){if(A.isHidden(this.painter.transform.zoom))return!1;const x=A.type,L=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===A.id;if($n[x]&&(this._prevType&&$n[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(A.id),!O))return!0;if($n[this._prevType]||$n[x]&&O){this._prevType=x;const y=this._stacks.length-1,a=this._stacks[y]||[];for(const d of this._renderableTiles){if(this.pool.isFull()&&(In(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(d),d.rtt[y]){const B=this.pool.getObjectForId(d.rtt[y].id);if(B.stamp===d.rtt[y].stamp){this.pool.useObject(B);continue}}const _=this.pool.getOrCreateFreeObject();this.pool.useObject(_),this.pool.stampObject(_),d.rtt[y]={id:_.id,stamp:_.stamp},L.context.bindFramebuffer.set(_.fbo.framebuffer),L.context.clear({color:s.aT.transparent,stencil:0}),L.currentStencilSource=void 0;for(let B=0;B<a.length;B++){const T=L.style._layers[a[B]],U=T.source?this._coordsDescendingInv[T.source][d.tileID.key]:[d.tileID];L.context.viewport.set([0,0,_.fbo.width,_.fbo.height]),L._renderTileClippingMasks(T,U),L.renderLayer(L,L.style.sourceCaches[T.source],T,U),T.source&&(d.rttCoords[T.source]=this._coordsDescendingInvStr[T.source][d.tileID.key])}}return In(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$n[x]}return!1}}const Ki=g,zi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Kn=z=>{z.touchstart=z.dragStart,z.touchmoveWindow=z.dragMove,z.touchend=z.dragEnd},Nu={showCompass:!0,showZoom:!0,visualizePitch:!1};class ks{constructor(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=a=>{this.startMouse(s.e({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),b.mousePos(this.element,a)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=a=>{this.moveMouse(a,b.mousePos(this.element,a))},this.mouseup=a=>{this.mouseRotate.dragEnd(a),this.mousePitch&&this.mousePitch.dragEnd(a),this.offTemp()},this.touchstart=a=>{a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,a.targetTouches)[0],this.startTouch(a,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=a=>{a.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,a.targetTouches)[0],this.moveTouch(a,this._lastPos))},this.touchend=a=>{a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const O=A.dragRotate._mouseRotate.getClickTolerance(),y=A.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=mo({clickTolerance:O,enable:!0}),this.touchRotate=(a=>{let{enable:d,clickTolerance:_,bearingDegreesPerPixelMoved:B=.8}=a;const T=new va;return new Jr({clickTolerance:_,move:(U,H)=>({bearingDelta:(H.x-U.x)*B}),moveStateManager:T,enable:d,assignEvents:Kn})})({clickTolerance:O,enable:!0}),this.map=A,L&&(this.mousePitch=Yo({clickTolerance:y,enable:!0}),this.touchPitch=(a=>{let{enable:d,clickTolerance:_,pitchDegreesPerPixelMoved:B=-.5}=a;const T=new va;return new Jr({clickTolerance:_,move:(U,H)=>({pitchDelta:(H.y-U.y)*B}),moveStateManager:T,enable:d,assignEvents:Kn})})({clickTolerance:y,enable:!0})),b.addEventListener(x,"mousedown",this.mousedown),b.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(x,"touchcancel",this.reset)}startMouse(A,x){this.mouseRotate.dragStart(A,x),this.mousePitch&&this.mousePitch.dragStart(A,x),b.disableDrag()}startTouch(A,x){this.touchRotate.dragStart(A,x),this.touchPitch&&this.touchPitch.dragStart(A,x),b.disableDrag()}moveMouse(A,x){const L=this.map,{bearingDelta:O}=this.mouseRotate.dragMove(A,x)||{};if(O&&L.setBearing(L.getBearing()+O),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(A,x)||{};y&&L.setPitch(L.getPitch()+y)}}moveTouch(A,x){const L=this.map,{bearingDelta:O}=this.touchRotate.dragMove(A,x)||{};if(O&&L.setBearing(L.getBearing()+O),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(A,x)||{};y&&L.setPitch(L.getPitch()+y)}}off(){const A=this.element;b.removeEventListener(A,"mousedown",this.mousedown),b.removeEventListener(A,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(A,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let rn;function ta(z,A,x){if(z=new s.L(z.lng,z.lat),A){const L=new s.L(z.lng-360,z.lat),O=new s.L(z.lng+360,z.lat),y=x.locationPoint(z).distSqr(A);x.locationPoint(L).distSqr(A)<y?z=L:x.locationPoint(O).distSqr(A)<y&&(z=O)}for(;Math.abs(z.lng-x.center.lng)>180;){const L=x.locationPoint(z);if(L.x>=0&&L.y>=0&&L.x<=x.width&&L.y<=x.height)break;z.lng>x.center.lng?z.lng-=360:z.lng+=360}return z}const ko={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function du(z,A,x){const L=z.classList;for(const O in ko)L.remove(`maplibregl-${x}-anchor-${O}`);L.add(`maplibregl-${x}-anchor-${A}`)}class Os extends s.E{constructor(A){if(super(),this._onKeyPress=x=>{const L=x.code,O=x.charCode||x.keyCode;L!=="Space"&&L!=="Enter"&&O!==32&&O!==13||this.togglePopup()},this._onMapClick=x=>{const L=x.originalEvent.target,O=this._element;this._popup&&(L===O||O.contains(L))&&this.togglePopup()},this._update=x=>{if(!this._map)return;const L=this._map.loaded()&&!this._map.isMoving();((x==null?void 0:x.type)==="terrain"||(x==null?void 0:x.type)==="render"&&!L)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let O="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?O=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(O=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),x&&x.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${ko[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${O}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const a=this._map.unproject(this._pos),d=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=a.distanceTo(this._lngLat)>20*d?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=x=>{if(!this._isDragging){const L=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=L}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=A&&A.anchor||"center",this._color=A&&A.color||"#3FB1CE",this._scale=A&&A.scale||1,this._draggable=A&&A.draggable||!1,this._clickTolerance=A&&A.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=A&&A.rotation||0,this._rotationAlignment=A&&A.rotationAlignment||"auto",this._pitchAlignment=A&&A.pitchAlignment&&A.pitchAlignment!=="auto"?A.pitchAlignment:this._rotationAlignment,A&&A.element)this._element=A.element,this._offset=s.P.convert(A&&A.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div"),this._element.setAttribute("aria-label","Map marker");const x=b.createNS("http://www.w3.org/2000/svg","svg"),L=41,O=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${L}px`),x.setAttributeNS(null,"width",`${O}px`),x.setAttributeNS(null,"viewBox",`0 0 ${O} ${L}`);const y=b.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const a=b.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const d=b.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(3.0, 29.0)"),d.setAttributeNS(null,"fill","#000000");const _=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const j of _){const Y=b.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",j.rx),Y.setAttributeNS(null,"ry",j.ry),d.appendChild(Y)}const B=b.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const T=b.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(T);const U=b.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const H=b.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(H);const q=b.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const w=b.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(8.0, 8.0)");const I=b.createNS("http://www.w3.org/2000/svg","circle");I.setAttributeNS(null,"fill","#000000"),I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"cx","5.5"),I.setAttributeNS(null,"cy","5.5"),I.setAttributeNS(null,"r","5.4999962");const k=b.createNS("http://www.w3.org/2000/svg","circle");k.setAttributeNS(null,"fill","#FFFFFF"),k.setAttributeNS(null,"cx","5.5"),k.setAttributeNS(null,"cy","5.5"),k.setAttributeNS(null,"r","5.4999962"),w.appendChild(I),w.appendChild(k),a.appendChild(d),a.appendChild(B),a.appendChild(U),a.appendChild(q),a.appendChild(w),x.appendChild(a),x.setAttributeNS(null,"height",L*this._scale+"px"),x.setAttributeNS(null,"width",O*this._scale+"px"),this._element.appendChild(x),this._offset=s.P.convert(A&&A.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),du(this._element,this._anchor,"marker"),A&&A.className)for(const x of A.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(A){return this.remove(),this._map=A,A.getCanvasContainer().appendChild(this._element),A.on("move",this._update),A.on("moveend",this._update),A.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.L.convert(A),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(A){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),A){if(!("offset"in A.options)){const O=Math.abs(13.5)/Math.SQRT2;A.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[O,-1*(38.1-13.5+O)],"bottom-right":[-O,-1*(38.1-13.5+O)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=A,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const A=this._popup;return A?(A.isOpen()?A.remove():A.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(A){return this._offset=s.P.convert(A),this._update(),this}addClassName(A){this._element.classList.add(A)}removeClassName(A){this._element.classList.remove(A)}toggleClassName(A){return this._element.classList.toggle(A)}setDraggable(A){return this._draggable=!!A,this._map&&(A?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(A){return this._rotation=A||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(A){return this._rotationAlignment=A||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(A){return this._pitchAlignment=A&&A!=="auto"?A:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zn=0,Oo=!1;const yl={maxWidth:100,unit:"metric"};function nl(z,A,x){const L=x&&x.maxWidth||100,O=z._container.clientHeight/2,y=z.unproject([0,O]),a=z.unproject([L,O]),d=y.distanceTo(a);if(x&&x.unit==="imperial"){const _=3.2808*d;_>5280?ka(A,L,_/5280,z._getUIString("ScaleControl.Miles")):ka(A,L,_,z._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?ka(A,L,d/1852,z._getUIString("ScaleControl.NauticalMiles")):d>=1e3?ka(A,L,d/1e3,z._getUIString("ScaleControl.Kilometers")):ka(A,L,d,z._getUIString("ScaleControl.Meters"))}function ka(z,A,x,L){const O=function(y){const a=Math.pow(10,`${Math.floor(y)}`.length-1);let d=y/a;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){const B=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*B)/B}(d),a*d}(x);z.style.width=A*(O/x)+"px",z.innerHTML=`${O}&nbsp;${L}`}const Yl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _o(z){if(z){if(typeof z=="number"){const A=Math.round(Math.abs(z)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,z),"top-left":new s.P(A,A),"top-right":new s.P(-A,A),bottom:new s.P(0,-z),"bottom-left":new s.P(A,-A),"bottom-right":new s.P(-A,-A),left:new s.P(z,0),right:new s.P(-z,0)}}if(z instanceof s.P||Array.isArray(z)){const A=s.P.convert(z);return{center:A,top:A,"top-left":A,"top-right":A,bottom:A,"bottom-left":A,"bottom-right":A,left:A,right:A}}return{center:s.P.convert(z.center||[0,0]),top:s.P.convert(z.top||[0,0]),"top-left":s.P.convert(z["top-left"]||[0,0]),"top-right":s.P.convert(z["top-right"]||[0,0]),bottom:s.P.convert(z.bottom||[0,0]),"bottom-left":s.P.convert(z["bottom-left"]||[0,0]),"bottom-right":s.P.convert(z["bottom-right"]||[0,0]),left:s.P.convert(z.left||[0,0]),right:s.P.convert(z.right||[0,0])}}return _o(new s.P(0,0))}const xa={extend:function(z){for(var A=arguments.length,x=new Array(A>1?A-1:0),L=1;L<A;L++)x[L-1]=arguments[L];return s.e(z,...x)},run(z){z()},logToElement(z){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const L=window.document.getElementById(x);L&&(A&&(L.innerHTML=""),L.innerHTML+=`<br>${z}`)}},_l=g;class jr{static get version(){return _l}static get workerCount(){return Wi.workerCount}static set workerCount(A){Wi.workerCount=A}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(A){s.c.WORKER_URL=A}static addProtocol(A,x){s.c.REGISTERED_PROTOCOLS[A]=x}static removeProtocol(A){delete s.c.REGISTERED_PROTOCOLS[A]}}return jr.Map=class extends ba{constructor(z){if(s.bg.mark(s.bh.create),(z=s.e({},zi,z)).minZoom!=null&&z.maxZoom!=null&&z.minZoom>z.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(z.minPitch!=null&&z.maxPitch!=null&&z.minPitch>z.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(z.minPitch!=null&&z.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(z.maxPitch!=null&&z.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pl(z.minZoom,z.maxZoom,z.minPitch,z.maxPitch,z.renderWorldCopies),{bearingSnap:z.bearingSnap}),this._cooperativeGesturesOnWheel=A=>{this._onCooperativeGesture(A,A[this._metaKey],1)},this._contextLost=A=>{A.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=z.interactive,this._cooperativeGestures=z.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=z.maxTileCacheSize,this._maxTileCacheZoomLevels=z.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=z.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=z.preserveDrawingBuffer,this._antialias=z.antialias,this._trackResize=z.trackResize,this._bearingSnap=z.bearingSnap,this._refreshExpiredTiles=z.refreshExpiredTiles,this._fadeDuration=z.fadeDuration,this._crossSourceCollisions=z.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=z.collectResourceTiming,this._renderTaskQueue=new or,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},Jl,z.locale),this._clickTolerance=z.clickTolerance,this._overridePixelRatio=z.pixelRatio,this._maxCanvasSize=z.maxCanvasSize,this.transformCameraUpdate=z.transformCameraUpdate,this._imageQueueHandle=he.addThrottleControl(()=>this.isMoving()),this._requestManager=new fe(z.transformRequest),typeof z.container=="string"){if(this._container=document.getElementById(z.container),!this._container)throw new Error(`Container '${z.container}' not found.`)}else{if(!(z.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=z.container}if(z.maxBounds&&this.setMaxBounds(z.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const x=po(L=>{this._trackResize&&!this._removed&&this.resize(L)._update()},50);this._resizeObserver=new ResizeObserver(L=>{A?x(L):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new hu(this,z),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=z.hash&&new os(typeof z.hash=="string"&&z.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:z.center,zoom:z.zoom,bearing:z.bearing,pitch:z.pitch}),z.bounds&&(this.resize(),this.fitBounds(z.bounds,s.e({},z.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=z.localIdeographFontFamily,this._validateStyle=z.validateStyle,z.style&&this.setStyle(z.style,{localIdeographFontFamily:z.localIdeographFontFamily}),z.attributionControl&&this.addControl(new Ws({customAttribution:z.customAttribution})),z.maplibreLogo&&this.addControl(new xi,z.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.k(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.k(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.k("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(z,A){if(A===void 0&&(A=z.getDefaultPosition?z.getDefaultPosition():"top-right"),!z||!z.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const x=z.onAdd(this);this._controls.push(z);const L=this._controlPositions[A];return A.indexOf("bottom")!==-1?L.insertBefore(x,L.firstChild):L.appendChild(x),this}removeControl(z){if(!z||!z.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const A=this._controls.indexOf(z);return A>-1&&this._controls.splice(A,1),z.onRemove(this),this}hasControl(z){return this._controls.indexOf(z)>-1}calculateCameraOptionsFromTo(z,A,x,L){return L==null&&this.terrain&&(L=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(z,A,x,L)}resize(z){var A;const x=this._containerDimensions(),L=x[0],O=x[1],y=this._getClampedPixelRatio(L,O);if(this._resizeCanvas(L,O,y),this.painter.resize(L,O,y),this.painter.overLimit()){const d=this.painter.context.gl;this._maxCanvasSize=[d.drawingBufferWidth,d.drawingBufferHeight];const _=this._getClampedPixelRatio(L,O);this._resizeCanvas(L,O,_),this.painter.resize(L,O,_)}this.transform.resize(L,O),(A=this._requestedCameraState)===null||A===void 0||A.resize(L,O);const a=!this._moving;return a&&(this.stop(),this.fire(new s.k("movestart",z)).fire(new s.k("move",z))),this.fire(new s.k("resize",z)),a&&this.fire(new s.k("moveend",z)),this}_getClampedPixelRatio(z,A){const{0:x,1:L}=this._maxCanvasSize,O=this.getPixelRatio(),y=z*O,a=A*O;return Math.min(y>x?x/y:1,a>L?L/a:1)*O}getPixelRatio(){var z;return(z=this._overridePixelRatio)!==null&&z!==void 0?z:devicePixelRatio}setPixelRatio(z){this._overridePixelRatio=z,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(z){return this.transform.setMaxBounds(Ze.convert(z)),this._update()}setMinZoom(z){if((z=z??-2)>=-2&&z<=this.transform.maxZoom)return this.transform.minZoom=z,this._update(),this.getZoom()<z&&this.setZoom(z),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(z){if((z=z??22)>=this.transform.minZoom)return this.transform.maxZoom=z,this._update(),this.getZoom()>z&&this.setZoom(z),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(z){if((z=z??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(z>=0&&z<=this.transform.maxPitch)return this.transform.minPitch=z,this._update(),this.getPitch()<z&&this.setPitch(z),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(z){if((z=z??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(z>=this.transform.minPitch)return this.transform.maxPitch=z,this._update(),this.getPitch()>z&&this.setPitch(z),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(z){return this.transform.renderWorldCopies=z,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(z){return this._cooperativeGestures=z,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(z){return this.transform.locationPoint(s.L.convert(z),this.style&&this.terrain)}unproject(z){return this.transform.pointLocation(s.P.convert(z),this.terrain)}isMoving(){var z;return this._moving||((z=this.handlers)===null||z===void 0?void 0:z.isMoving())}isZooming(){var z;return this._zooming||((z=this.handlers)===null||z===void 0?void 0:z.isZooming())}isRotating(){var z;return this._rotating||((z=this.handlers)===null||z===void 0?void 0:z.isRotating())}_createDelegatedListener(z,A,x){if(z==="mouseenter"||z==="mouseover"){let L=!1;return{layer:A,listener:x,delegates:{mousemove:y=>{const a=this.getLayer(A)?this.queryRenderedFeatures(y.point,{layers:[A]}):[];a.length?L||(L=!0,x.call(this,new _s(z,this,y.originalEvent,{features:a}))):L=!1},mouseout:()=>{L=!1}}}}if(z==="mouseleave"||z==="mouseout"){let L=!1;return{layer:A,listener:x,delegates:{mousemove:a=>{(this.getLayer(A)?this.queryRenderedFeatures(a.point,{layers:[A]}):[]).length?L=!0:L&&(L=!1,x.call(this,new _s(z,this,a.originalEvent)))},mouseout:a=>{L&&(L=!1,x.call(this,new _s(z,this,a.originalEvent)))}}}}{const L=O=>{const y=this.getLayer(A)?this.queryRenderedFeatures(O.point,{layers:[A]}):[];y.length&&(O.features=y,x.call(this,O),delete O.features)};return{layer:A,listener:x,delegates:{[z]:L}}}}on(z,A,x){if(x===void 0)return super.on(z,A);const L=this._createDelegatedListener(z,A,x);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[z]=this._delegatedListeners[z]||[],this._delegatedListeners[z].push(L);for(const O in L.delegates)this.on(O,L.delegates[O]);return this}once(z,A,x){if(x===void 0)return super.once(z,A);const L=this._createDelegatedListener(z,A,x);for(const O in L.delegates)this.once(O,L.delegates[O]);return this}off(z,A,x){return x===void 0?super.off(z,A):(this._delegatedListeners&&this._delegatedListeners[z]&&(L=>{const O=this._delegatedListeners[z];for(let y=0;y<O.length;y++){const a=O[y];if(a.layer===A&&a.listener===x){for(const d in a.delegates)this.off(d,a.delegates[d]);return O.splice(y,1),this}}})(),this)}queryRenderedFeatures(z,A){if(!this.style)return[];let x;const L=z instanceof s.P||Array.isArray(z),O=L?z:[[0,0],[this.transform.width,this.transform.height]];if(A=A||(L?{}:z)||{},O instanceof s.P||typeof O[0]=="number")x=[s.P.convert(O)];else{const y=s.P.convert(O[0]),a=s.P.convert(O[1]);x=[y,new s.P(a.x,y.y),a,new s.P(y.x,a.y),y]}return this.style.queryRenderedFeatures(x,A,this.transform)}querySourceFeatures(z,A){return this.style.querySourceFeatures(z,A)}setStyle(z,A){return(A=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&z?(this._diffStyle(z,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(z,A))}setTransformRequest(z){return this._requestManager.setTransformRequest(z),this}_getUIString(z){const A=this._locale[z];if(A==null)throw new Error(`Missing UI string '${z}'`);return A}_updateStyle(z,A){if(A.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(z,A));const x=this.style&&A.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!z)),z?(this.style=new Xi(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof z=="string"?this.style.loadURL(z,A,x):this.style.loadJSON(z,A,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(z,A){if(typeof z=="string"){const x=this._requestManager.transformRequest(z,ue.Style);s.f(x,(L,O)=>{L?this.fire(new s.j(L)):O&&this._updateDiff(O,A)})}else typeof z=="object"&&this._updateDiff(z,A)}_updateDiff(z,A){try{this.style.setState(z,A)&&this._update(!0)}catch(x){s.w(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(z,A)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(z,A){return this._lazyInitEmptyStyle(),this.style.addSource(z,A),this._update(!0)}isSourceLoaded(z){const A=this.style&&this.style.sourceCaches[z];if(A!==void 0)return A.loaded();this.fire(new s.j(new Error(`There is no source with ID '${z}'`)))}setTerrain(z){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),z){const A=this.style.sourceCaches[z.source];if(!A)throw new Error(`cannot load terrain, because there exists no source with ID: ${z.source}`);for(const x in this.style._layers){const L=this.style._layers[x];L.type==="hillshade"&&L.source===z.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ss(this.painter,A,z),this.painter.renderToTexture=new Au(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==z.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:z})),this}getTerrain(){var z,A;return(A=(z=this.terrain)===null||z===void 0?void 0:z.options)!==null&&A!==void 0?A:null}areTilesLoaded(){const z=this.style&&this.style.sourceCaches;for(const A in z){const x=z[A]._tiles;for(const L in x){const O=x[L];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0}addSourceType(z,A,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(z,A,x)}removeSource(z){return this.style.removeSource(z),this._update(!0)}getSource(z){return this.style.getSource(z)}addImage(z,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:L=1,sdf:O=!1,stretchX:y,stretchY:a,content:d}=x;if(this._lazyInitEmptyStyle(),!(A instanceof HTMLImageElement||s.a(A))){if(A.width===void 0||A.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:_,height:B,data:T}=A,U=A;return this.style.addImage(z,{data:new s.R({width:_,height:B},new Uint8Array(T)),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:O,version:0,userImage:U}),U.onAdd&&U.onAdd(this,z),this}}{const{width:_,height:B,data:T}=s.h.getImageData(A);this.style.addImage(z,{data:new s.R({width:_,height:B},T),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:O,version:0})}}updateImage(z,A){const x=this.style.getImage(z);if(!x)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const L=A instanceof HTMLImageElement||s.a(A)?s.h.getImageData(A):A,{width:O,height:y,data:a}=L;if(O===void 0||y===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(O!==x.data.width||y!==x.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const d=!(A instanceof HTMLImageElement||s.a(A));return x.data.replace(a,d),this.style.updateImage(z,x),this}getImage(z){return this.style.getImage(z)}hasImage(z){return z?!!this.style.getImage(z):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(z){this.style.removeImage(z)}loadImage(z,A){he.getImage(this._requestManager.transformRequest(z,ue.Image),A)}listImages(){return this.style.listImages()}addLayer(z,A){return this._lazyInitEmptyStyle(),this.style.addLayer(z,A),this._update(!0)}moveLayer(z,A){return this.style.moveLayer(z,A),this._update(!0)}removeLayer(z){return this.style.removeLayer(z),this._update(!0)}getLayer(z){return this.style.getLayer(z)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(z,A,x){return this.style.setLayerZoomRange(z,A,x),this._update(!0)}setFilter(z,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(z,A,x),this._update(!0)}getFilter(z){return this.style.getFilter(z)}setPaintProperty(z,A,x){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(z,A,x,L),this._update(!0)}getPaintProperty(z,A){return this.style.getPaintProperty(z,A)}setLayoutProperty(z,A,x){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(z,A,x,L),this._update(!0)}getLayoutProperty(z,A){return this.style.getLayoutProperty(z,A)}setGlyphs(z){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(z,A),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(z,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(z,A,x,L=>{L||this._update(!0)}),this}removeSprite(z){return this._lazyInitEmptyStyle(),this.style.removeSprite(z),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(z){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(z,A,x=>{x||this._update(!0)}),this}setLight(z){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(z,A),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(z,A){return this.style.setFeatureState(z,A),this._update()}removeFeatureState(z,A){return this.style.removeFeatureState(z,A),this._update()}getFeatureState(z){return this.style.getFeatureState(z)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let z=0,A=0;return this._container&&(z=this._container.clientWidth||400,A=this._container.clientHeight||300),[z,A]}_setupContainer(){const z=this._container;z.classList.add("maplibregl-map");const A=this._canvasContainer=b.create("div","maplibregl-canvas-container",z);this._interactive&&A.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const x=this._containerDimensions(),L=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],L);const O=this._controlContainer=b.create("div","maplibregl-control-container",z),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{y[a]=b.create("div",`maplibregl-ctrl-${a} `,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=b.create("div","maplibregl-cooperative-gesture-screen",this._container);let z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(z=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${z}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){b.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(z,A,x){this._canvas.width=Math.floor(x*z),this._canvas.height=Math.floor(x*A),this._canvas.style.width=`${z}px`,this._canvas.style.height=`${A}px`}_setupPainter(){const z={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let A=null;this._canvas.addEventListener("webglcontextcreationerror",L=>{A={requestedAttributes:z},L&&(A.statusMessage=L.statusMessage,A.type=L.type)},{once:!0});const x=this._canvas.getContext("webgl2",z)||this._canvas.getContext("webgl",z);if(!x){const L="Failed to initialize WebGL";throw A?(A.message=L,new Error(JSON.stringify(A))):new Error(L)}this.painter=new an(x,this.transform),S.testSupport(x)}_onCooperativeGesture(z,A,x){return!A&&x<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(z){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||z,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(z){return this._update(),this._renderTaskQueue.add(z)}_cancelRenderFrame(z){this._renderTaskQueue.remove(z)}_render(z){const A=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(z),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,y=s.h.now();this.style.zoomHistory.update(O,y);const a=new s.a8(O,{now:y,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),d=a.crossFadingFactor();d===1&&d===this._crossFadingFactor||(x=!0,this._crossFadingFactor=d),this.style.update(a)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var z;this._hash&&this._hash.remove();for(const x of this._controls)x.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(z=this._resizeObserver)===null||z===void 0||z.disconnect();const A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(z=>{s.bg.frame(z),this._frame=null,this._render(z)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(z){this._showTileBoundaries!==z&&(this._showTileBoundaries=z,this._update())}get showPadding(){return!!this._showPadding}set showPadding(z){this._showPadding!==z&&(this._showPadding=z,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(z){this._showCollisionBoxes!==z&&(this._showCollisionBoxes=z,z?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(z){this._showOverdrawInspector!==z&&(this._showOverdrawInspector=z,this._update())}get repaint(){return!!this._repaint}set repaint(z){this._repaint!==z&&(this._repaint=z,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(z){this._vertices=z,this._update()}get version(){return Ki}getCameraTargetElevation(){return this.transform.elevation}},jr.NavigationControl=class{constructor(z){this._updateZoomButtons=()=>{const A=this._map.getZoom(),x=A===this._map.getMaxZoom(),L=A===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=L,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",L.toString())},this._rotateCompassArrow=()=>{const A=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=A},this._setButtonTitle=(A,x)=>{const L=this._map._getUIString(`NavigationControl.${x}`);A.title=L,A.setAttribute("aria-label",L)},this.options=s.e({},Nu,z),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",A=>A.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",A=>this._map.zoomIn({},{originalEvent:A})),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",A=>this._map.zoomOut({},{originalEvent:A})),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",A=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:A}):this._map.resetNorth({},{originalEvent:A})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(z){return this._map=z,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ks(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(z,A){const x=b.create("button",z,this._container);return x.type="button",x.addEventListener("click",A),x}},jr.GeolocateControl=class extends s.E{constructor(z){super(),this._onSuccess=A=>{if(this._map){if(this._isOutOfMapMaxBounds(A))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",A)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=A,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(A),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(A),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",A)),this._finish()}},this._updateCamera=A=>{const x=new s.L(A.coords.longitude,A.coords.latitude),L=A.coords.accuracy,O=this._map.getBearing(),y=s.e({bearing:O},this.options.fitBoundsOptions),a=Ze.fromLngLat(x,L);this._map.fitBounds(a,y,{geolocateSource:!0})},this._updateMarker=A=>{if(A){const x=new s.L(A.coords.longitude,A.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=A.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=A=>{if(this._map){if(this.options.trackUserLocation)if(A.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(A.code===3&&Oo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",A)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=A=>{if(this._map){if(this._container.addEventListener("contextmenu",x=>x.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",A===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{const x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Os({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Os({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Yr,z)}onAdd(z){return this._map=z,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;rn===void 0||x?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(L=>{rn=L.state!=="denied",A(rn)}).catch(()=>{rn=!!window.navigator.geolocation,A(rn)}):(rn=!!window.navigator.geolocation,A(rn)):A(rn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zn=0,Oo=!1}_isOutOfMapMaxBounds(z){const A=this._map.getMaxBounds(),x=z.coords;return A&&(x.longitude<A.getWest()||x.longitude>A.getEast()||x.latitude<A.getSouth()||x.latitude>A.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const z=this._map.getBounds(),A=z.getSouthEast(),x=z.getNorthEast(),L=A.distanceTo(x),O=Math.ceil(this._accuracy/(L/this._map._container.clientHeight)*2);this._circleElement.style.width=`${O}px`,this._circleElement.style.height=`${O}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zn--,Oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let z;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zn++,zn>1?(z={maximumAge:6e5,timeout:0},Oo=!0):(z=this.options.positionOptions,Oo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,z)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},jr.AttributionControl=Ws,jr.LogoControl=xi,jr.ScaleControl=class{constructor(z){this._onMove=()=>{nl(this._map,this._container,this.options)},this.setUnit=A=>{this.options.unit=A,nl(this._map,this._container,this.options)},this.options=s.e({},yl,z)}getDefaultPosition(){return"bottom-left"}onAdd(z){return this._map=z,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",z.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},jr.FullscreenControl=class extends s.E{constructor(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,z&&z.container&&(z.container instanceof HTMLElement?this._container=z.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(z){return this._map=z,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const z=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",z).setAttribute("aria-hidden","true"),z.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const z=this._getTitle();this._fullscreenButton.setAttribute("aria-label",z),this._fullscreenButton.title=z}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},jr.TerrainControl=class{constructor(z){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=z}onAdd(z){return this._map=z,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},jr.Popup=class extends s.E{constructor(z){super(),this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=A=>{this._update(A.point)},this._onMouseMove=A=>{this._update(A.point)},this._onDrag=A=>{this._update(A.point)},this._update=A=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const a of this.options.className.split(" "))this._container.classList.add(a);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!A)return;const x=this._pos=this._trackPointer&&A?A:this._map.project(this._lngLat);let L=this.options.anchor;const O=_o(this.options.offset);if(!L){const a=this._container.offsetWidth,d=this._container.offsetHeight;let _;_=x.y+O.bottom.y<d?["top"]:x.y>this._map.transform.height-d?["bottom"]:[],x.x<a/2?_.push("left"):x.x>this._map.transform.width-a/2&&_.push("right"),L=_.length===0?"bottom":_.join("-")}const y=x.add(O[L]).round();b.setTransform(this._container,`${ko[L]} translate(${y.x}px,${y.y}px)`),du(this._container,L,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Yl),z)}addTo(z){return this._map&&this.remove(),this._map=z,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(z){return this._lngLat=s.L.convert(z),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(z){return this.setDOMContent(document.createTextNode(z))}setHTML(z){const A=document.createDocumentFragment(),x=document.createElement("body");let L;for(x.innerHTML=z;L=x.firstChild,L;)A.appendChild(L);return this.setDOMContent(A)}getMaxWidth(){var z;return(z=this._container)===null||z===void 0?void 0:z.style.maxWidth}setMaxWidth(z){return this.options.maxWidth=z,this._update(),this}setDOMContent(z){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(z),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(z){this._container&&this._container.classList.add(z)}removeClassName(z){this._container&&this._container.classList.remove(z)}setOffset(z){return this.options.offset=z,this._update(),this}toggleClassName(z){if(this._container)return this._container.classList.toggle(z)}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const z=this._container.querySelector(fu);z&&z.focus()}},jr.Marker=Os,jr.Style=Xi,jr.LngLat=s.L,jr.LngLatBounds=Ze,jr.Point=s.P,jr.MercatorCoordinate=s.U,jr.Evented=s.E,jr.AJAXError=s.bi,jr.config=s.c,jr.CanvasSource=mi,jr.GeoJSONSource=Ft,jr.ImageSource=Gt,jr.RasterDEMTileSource=Bt,jr.RasterTileSource=pt,jr.VectorTileSource=dt,jr.VideoSource=ri,jr.setRTLTextPlugin=s.bj,jr.getRTLTextPluginStatus=s.bk,jr.prewarm=function(){Sr().acquire(ci)},jr.clearPrewarmedResources=function(){const z=dr;z&&(z.isPreloaded()&&z.numActive()===1?(z.release(ci),dr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},xa.extend(jr,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),jr});var l=n;return l})})(A4);var Sie=A4.exports,Tie=Object.defineProperty,Iie=(i,e,t)=>e in i?Tie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ps=(i,e,t)=>(Iie(i,typeof e!="symbol"?e+"":e,t),t);let Lie=class{constructor(e){Ps(this,"map"),Ps(this,"width"),Ps(this,"height"),Ps(this,"svgCanvas"),Ps(this,"xLine"),Ps(this,"yLine"),Ps(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const r=this.width/2,n=this.height/2;this.yLine=t.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,r,n,o,l){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",r),s.setAttribute("y2",n),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",o),s.setAttribute("stroke-width",l),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function Yn(i){"@babel/helpers - typeof";return Yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(i)}var oc=Uint8Array,ac=Uint16Array,Uy=Uint32Array,W1=new oc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),X1=new oc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fC=new oc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d4=function(i,e){for(var t=new ac(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Uy(t[30]),r=1;r<30;++r)for(var o=t[r];o<t[r+1];++o)n[o]=o-t[r]<<5|r;return[t,n]},f4=d4(W1,2),p4=f4[0],pC=f4[1];p4[28]=258,pC[258]=28;for(var g4=d4(X1,0),Mie=g4[0],m4=g4[1],gC=new ac(32768),$s=0;$s<32768;++$s){var gd=($s&43690)>>>1|($s&21845)<<1;gd=(gd&52428)>>>2|(gd&13107)<<2,gd=(gd&61680)>>>4|(gd&3855)<<4,gC[$s]=((gd&65280)>>>8|(gd&255)<<8)>>>1}for(var $h=function(i,e,t){for(var r=i.length,n=0,o=new ac(e);n<r;++n)++o[i[n]-1];var l=new ac(e);for(n=0;n<e;++n)l[n]=l[n-1]+o[n-1]<<1;var s;if(t){s=new ac(1<<e);var g=15-e;for(n=0;n<r;++n)if(i[n])for(var b=n<<4|i[n],S=e-i[n],F=l[i[n]-1]++<<S,D=F|(1<<S)-1;F<=D;++F)s[gC[F]>>>g]=b}else for(s=new ac(r),n=0;n<r;++n)s[n]=gC[l[i[n]-1]++]>>>15-i[n];return s},md=new oc(288),$s=0;$s<144;++$s)md[$s]=8;for(var $s=144;$s<256;++$s)md[$s]=9;for(var $s=256;$s<280;++$s)md[$s]=7;for(var $s=280;$s<288;++$s)md[$s]=8;for(var Ny=new oc(32),$s=0;$s<32;++$s)Ny[$s]=5;var Pie=$h(md,9,0),Fie=$h(md,9,1),Die=$h(Ny,5,0),Rie=$h(Ny,5,1),mC=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},lh=function(i,e,t){var r=e/8>>0;return(i[r]|i[r+1]<<8)>>>(e&7)&t},yC=function(i,e){var t=e/8>>0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>>(e&7)},_C=function(i){return(i/8>>0)+(i&7&&1)},y4=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i instanceof ac?ac:i instanceof Uy?Uy:oc)(t-e);return r.set(i.subarray(e,t)),r},kie=function(i,e,t){var r=i.length,n=!e||t,o=!t||t.i;t||(t={}),e||(e=new oc(r*3));var l=function(pt){var Bt=e.length;if(pt>Bt){var Ft=new oc(Math.max(Bt*2,pt));Ft.set(e),e=Ft}},s=t.f||0,g=t.p||0,b=t.b||0,S=t.l,F=t.d,D=t.m,N=t.n,J=r*8;do{if(!S){t.f=s=lh(i,g,1);var te=lh(i,g+1,3);if(g+=3,te)if(te==1)S=Fie,F=Rie,D=9,N=5;else if(te==2){var he=lh(i,g,31)+257,ue=lh(i,g+10,15)+4,fe=he+lh(i,g+5,31)+1;g+=14;for(var ve=new oc(fe),Se=new oc(19),Ge=0;Ge<ue;++Ge)Se[fC[Ge]]=lh(i,g+Ge*3,7);g+=ue*3;var He=mC(Se),$e=(1<<He)-1;if(!o&&g+fe*(He+7)>J)break;for(var Ne=$h(Se,He,1),Ge=0;Ge<fe;){var at=Ne[lh(i,g,$e)];g+=at&15;var rt=at>>>4;if(rt<16)ve[Ge++]=rt;else{var Re=0,Pe=0;for(rt==16?(Pe=3+lh(i,g,3),g+=2,Re=ve[Ge-1]):rt==17?(Pe=3+lh(i,g,7),g+=3):rt==18&&(Pe=11+lh(i,g,127),g+=7);Pe--;)ve[Ge++]=Re}}var Je=ve.subarray(0,he),Xe=ve.subarray(he);D=mC(Je),N=mC(Xe),S=$h(Je,D,1),F=$h(Xe,N,1)}else throw"invalid block type";else{var rt=_C(g)+4,Ct=i[rt-4]|i[rt-3]<<8,Et=rt+Ct;if(Et>r){if(o)throw"unexpected EOF";break}n&&l(b+Ct),e.set(i.subarray(rt,Et),b),t.b=b+=Ct,t.p=g=Et*8;continue}if(g>J)throw"unexpected EOF"}n&&l(b+131072);for(var Mt=(1<<D)-1,vt=(1<<N)-1,Dt=D+N+18;o||g+Dt<J;){var Re=S[yC(i,g)&Mt],Pt=Re>>>4;if(g+=Re&15,g>J)throw"unexpected EOF";if(!Re)throw"invalid length/literal";if(Pt<256)e[b++]=Pt;else if(Pt==256){S=null;break}else{var Xt=Pt-254;if(Pt>264){var Ge=Pt-257,Te=W1[Ge];Xt=lh(i,g,(1<<Te)-1)+p4[Ge],g+=Te}var Ze=F[yC(i,g)&vt],tt=Ze>>>4;if(!Ze)throw"invalid distance";g+=Ze&15;var Xe=Mie[tt];if(tt>3){var Te=X1[tt];Xe+=yC(i,g)&(1<<Te)-1,g+=Te}if(g>J)throw"unexpected EOF";n&&l(b+131072);for(var dt=b+Xt;b<dt;b+=4)e[b]=e[b-Xe],e[b+1]=e[b+1-Xe],e[b+2]=e[b+2-Xe],e[b+3]=e[b+3-Xe];b=dt}}t.l=S,t.p=g,t.b=b,S&&(s=1,t.m=D,t.d=F,t.n=N)}while(!s);return b==e.length?e:y4(e,0,b)},PA=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8},zy=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8,i[r+2]|=t>>>16},vC=function(i,e){for(var t=[],r=0;r<i.length;++r)i[r]&&t.push({s:r,f:i[r]});var n=t.length,o=t.slice();if(!n)return[new oc(0),0];if(n==1){var l=new oc(t[0].s+1);return l[t[0].s]=1,[l,1]}t.sort(function(Ge,He){return Ge.f-He.f}),t.push({s:-1,f:25001});var s=t[0],g=t[1],b=0,S=1,F=2;for(t[0]={s:-1,f:s.f+g.f,l:s,r:g};S!=n-1;)s=t[t[b].f<t[F].f?b++:F++],g=t[b!=S&&t[b].f<t[F].f?b++:F++],t[S++]={s:-1,f:s.f+g.f,l:s,r:g};for(var D=o[0].s,r=1;r<n;++r)o[r].s>D&&(D=o[r].s);var N=new ac(D+1),J=bC(t[S-1],N,0);if(J>e){var r=0,te=0,he=J-e,ue=1<<he;for(o.sort(function(He,$e){return N[$e.s]-N[He.s]||He.f-$e.f});r<n;++r){var fe=o[r].s;if(N[fe]>e)te+=ue-(1<<J-N[fe]),N[fe]=e;else break}for(te>>>=he;te>0;){var ve=o[r].s;N[ve]<e?te-=1<<e-N[ve]++-1:++r}for(;r>=0&&te;--r){var Se=o[r].s;N[Se]==e&&(--N[Se],++te)}J=e}return[new oc(N),J]},bC=function(i,e,t){return i.s==-1?Math.max(bC(i.l,e,t+1),bC(i.r,e,t+1)):e[i.s]=t},_4=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new ac(++e),r=0,n=i[0],o=1,l=function(g){t[r++]=g},s=1;s<=e;++s)if(i[s]==n&&s!=e)++o;else{if(!n&&o>2){for(;o>138;o-=138)l(32754);o>2&&(l(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(l(n),--o;o>6;o-=6)l(8304);o>2&&(l(o-3<<5|8208),o=0)}for(;o--;)l(n);o=1,n=i[s]}return[t.subarray(0,r),e]},Qy=function(i,e){for(var t=0,r=0;r<e.length;++r)t+=i[r]*e[r];return t},Z1=function(i,e,t){var r=t.length,n=_C(e+2);i[n]=r&255,i[n+1]=r>>>8,i[n+2]=i[n]^255,i[n+3]=i[n+1]^255;for(var o=0;o<r;++o)i[n+o+4]=t[o];return(n+4+r)*8},v4=function(i,e,t,r,n,o,l,s,g,b,S){PA(e,S++,t),++n[256];for(var F=vC(n,15),D=F[0],N=F[1],J=vC(o,15),te=J[0],he=J[1],ue=_4(D),fe=ue[0],ve=ue[1],Se=_4(te),Ge=Se[0],He=Se[1],$e=new ac(19),Ne=0;Ne<fe.length;++Ne)$e[fe[Ne]&31]++;for(var Ne=0;Ne<Ge.length;++Ne)$e[Ge[Ne]&31]++;for(var at=vC($e,7),rt=at[0],Re=at[1],Pe=19;Pe>4&&!rt[fC[Pe-1]];--Pe);var Je=b+5<<3,Xe=Qy(n,md)+Qy(o,Ny)+l,Ct=Qy(n,D)+Qy(o,te)+l+14+3*Pe+Qy($e,rt)+(2*$e[16]+3*$e[17]+7*$e[18]);if(Je<=Xe&&Je<=Ct)return Z1(e,S,i.subarray(g,g+b));var Et,Mt,vt,Dt;if(PA(e,S,1+(Ct<Xe)),S+=2,Ct<Xe){Et=$h(D,N,0),Mt=D,vt=$h(te,he,0),Dt=te;var Pt=$h(rt,Re,0);PA(e,S,ve-257),PA(e,S+5,He-1),PA(e,S+10,Pe-4),S+=14;for(var Ne=0;Ne<Pe;++Ne)PA(e,S+3*Ne,rt[fC[Ne]]);S+=3*Pe;for(var Xt=[fe,Ge],Te=0;Te<2;++Te)for(var Ze=Xt[Te],Ne=0;Ne<Ze.length;++Ne){var tt=Ze[Ne]&31;PA(e,S,Pt[tt]),S+=rt[tt],tt>15&&(PA(e,S,Ze[Ne]>>>5&127),S+=Ze[Ne]>>>12)}}else Et=Pie,Mt=md,vt=Die,Dt=Ny;for(var Ne=0;Ne<s;++Ne)if(r[Ne]>255){var tt=r[Ne]>>>18&31;zy(e,S,Et[tt+257]),S+=Mt[tt+257],tt>7&&(PA(e,S,r[Ne]>>>23&31),S+=W1[tt]);var dt=r[Ne]&31;zy(e,S,vt[dt]),S+=Dt[dt],dt>3&&(zy(e,S,r[Ne]>>>5&8191),S+=X1[dt])}else zy(e,S,Et[r[Ne]]),S+=Mt[r[Ne]];return zy(e,S,Et[256]),S+Mt[256]},Oie=new Uy([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Uie=new oc(0),Nie=function(i,e,t,r,n,o){var l=i.length,s=new oc(r+l+5*(1+Math.floor(l/7e3))+n),g=s.subarray(r,s.length-n),b=0;if(!e||l<8)for(var S=0;S<=l;S+=65535){var F=S+65535;F<l?b=Z1(g,b,i.subarray(S,F)):(g[S]=o,b=Z1(g,b,i.subarray(S,l)))}else{for(var D=Oie[e-1],N=D>>>13,J=D&8191,te=(1<<t)-1,he=new ac(32768),ue=new ac(te+1),fe=Math.ceil(t/3),ve=2*fe,Se=function(Pi){return(i[Pi]^i[Pi+1]<<fe^i[Pi+2]<<ve)&te},Ge=new Uy(25e3),He=new ac(288),$e=new ac(32),Ne=0,at=0,S=0,rt=0,Re=0,Pe=0;S<l;++S){var Je=Se(S),Xe=S&32767,Ct=ue[Je];if(he[Xe]=Ct,ue[Je]=Xe,Re<=S){var Et=l-S;if((Ne>7e3||rt>24576)&&Et>423){b=v4(i,g,0,Ge,He,$e,at,rt,Pe,S-Pe,b),rt=Ne=at=0,Pe=S;for(var Mt=0;Mt<286;++Mt)He[Mt]=0;for(var Mt=0;Mt<30;++Mt)$e[Mt]=0}var vt=2,Dt=0,Pt=J,Xt=Xe-Ct&32767;if(Et>2&&Je==Se(S-Xt))for(var Te=Math.min(N,Et)-1,Ze=Math.min(32767,S),tt=Math.min(258,Et);Xt<=Ze&&--Pt&&Xe!=Ct;){if(i[S+vt]==i[S+vt-Xt]){for(var dt=0;dt<tt&&i[S+dt]==i[S+dt-Xt];++dt);if(dt>vt){if(vt=dt,Dt=Xt,dt>Te)break;for(var pt=Math.min(Xt,dt-2),Bt=0,Mt=0;Mt<pt;++Mt){var Ft=S-Xt+Mt+32768&32767,Lt=he[Ft],Gt=Ft-Lt+32768&32767;Gt>Bt&&(Bt=Gt,Ct=Ft)}}}Xe=Ct,Ct=he[Xe],Xt+=Xe-Ct+32768&32767}if(Dt){Ge[rt++]=268435456|pC[vt]<<18|m4[Dt];var ri=pC[vt]&31,mi=m4[Dt]&31;at+=W1[ri]+X1[mi],++He[257+ri],++$e[mi],Re=S+vt,++Ne}else Ge[rt++]=i[S],++He[i[S]]}}b=v4(i,g,o,Ge,He,$e,at,rt,Pe,S-Pe,b),o||(b=Z1(g,b,Uie))}return y4(s,0,r+_C(b)+n)},zie=function(){var i=1,e=0;return{p:function(t){for(var r=i,n=e,o=t.length,l=0;l!=o;){for(var s=Math.min(l+5552,o);l<s;++l)r+=t[l],n+=r;r%=65521,n%=65521}i=r,e=n},d:function(){return(i>>>8<<16|(e&255)<<8|e>>>8)+((i&255)<<23)*2}}},Qie=function(i,e,t,r,n){return Nie(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,r,!n)},Vie=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},Hie=function(i,e){var t=e.level,r=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},Gie=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function xC(i,e){e===void 0&&(e={});var t=zie();t.p(i);var r=Qie(i,e,2,4);return Hie(r,e),Vie(r,r.length-4,t.d()),r}function jie(i,e){return kie((Gie(i),i.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var kr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function wC(){kr.console&&typeof kr.console.log=="function"&&kr.console.log.apply(kr.console,arguments)}var Fs={log:wC,warn:function(i){kr.console&&(typeof kr.console.warn=="function"?kr.console.warn.apply(kr.console,arguments):wC.call(null,arguments))},error:function(i){kr.console&&(typeof kr.console.error=="function"?kr.console.error.apply(kr.console,arguments):wC(i))}};function BC(i,e,t){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){If(r.response,e,t)},r.onerror=function(){Fs.error("could not download file")},r.send()}function b4(i){var e=new XMLHttpRequest;e.open("HEAD",i,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function J1(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}var Vy,CC,If=kr.saveAs||((typeof window>"u"?"undefined":Yn(window))!=="object"||window!==kr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,e,t){var r=kr.URL||kr.webkitURL,n=document.createElement("a");e=e||i.name||"download",n.download=e,n.rel="noopener",typeof i=="string"?(n.href=i,n.origin!==location.origin?b4(n.href)?BC(i,e,t):J1(n,n.target="_blank"):J1(n)):(n.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){J1(n)},0))}:"msSaveOrOpenBlob"in navigator?function(i,e,t){if(e=e||i.name||"download",typeof i=="string")if(b4(i))BC(i,e,t);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){J1(r)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:Yn(o)!=="object"&&(Fs.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(i,t),e)}:function(i,e,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return BC(i,e,t);var n=i.type==="application/octet-stream",o=/constructor/i.test(kr.HTMLElement)||kr.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||n&&o)&&(typeof FileReader>"u"?"undefined":Yn(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var S=s.result;S=l?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=S:location=S,r=null},s.readAsDataURL(i)}else{var g=kr.URL||kr.webkitURL,b=g.createObjectURL(i);r?r.location=b:location.href=b,r=null,setTimeout(function(){g.revokeObjectURL(b)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function x4(i){var e;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);l&&(e=o(l),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return s.length==1&&(s="0"+s),g.length==1&&(g="0"+g),b.length==1&&(b="0"+b),"#"+s+g+b}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function EC(i,e){var t=i[0],r=i[1],n=i[2],o=i[3];t=Ml(t,r,n,o,e[0],7,-680876936),o=Ml(o,t,r,n,e[1],12,-389564586),n=Ml(n,o,t,r,e[2],17,606105819),r=Ml(r,n,o,t,e[3],22,-1044525330),t=Ml(t,r,n,o,e[4],7,-176418897),o=Ml(o,t,r,n,e[5],12,1200080426),n=Ml(n,o,t,r,e[6],17,-1473231341),r=Ml(r,n,o,t,e[7],22,-45705983),t=Ml(t,r,n,o,e[8],7,1770035416),o=Ml(o,t,r,n,e[9],12,-1958414417),n=Ml(n,o,t,r,e[10],17,-42063),r=Ml(r,n,o,t,e[11],22,-1990404162),t=Ml(t,r,n,o,e[12],7,1804603682),o=Ml(o,t,r,n,e[13],12,-40341101),n=Ml(n,o,t,r,e[14],17,-1502002290),t=Pl(t,r=Ml(r,n,o,t,e[15],22,1236535329),n,o,e[1],5,-165796510),o=Pl(o,t,r,n,e[6],9,-1069501632),n=Pl(n,o,t,r,e[11],14,643717713),r=Pl(r,n,o,t,e[0],20,-373897302),t=Pl(t,r,n,o,e[5],5,-701558691),o=Pl(o,t,r,n,e[10],9,38016083),n=Pl(n,o,t,r,e[15],14,-660478335),r=Pl(r,n,o,t,e[4],20,-405537848),t=Pl(t,r,n,o,e[9],5,568446438),o=Pl(o,t,r,n,e[14],9,-1019803690),n=Pl(n,o,t,r,e[3],14,-187363961),r=Pl(r,n,o,t,e[8],20,1163531501),t=Pl(t,r,n,o,e[13],5,-1444681467),o=Pl(o,t,r,n,e[2],9,-51403784),n=Pl(n,o,t,r,e[7],14,1735328473),t=Fl(t,r=Pl(r,n,o,t,e[12],20,-1926607734),n,o,e[5],4,-378558),o=Fl(o,t,r,n,e[8],11,-2022574463),n=Fl(n,o,t,r,e[11],16,1839030562),r=Fl(r,n,o,t,e[14],23,-35309556),t=Fl(t,r,n,o,e[1],4,-1530992060),o=Fl(o,t,r,n,e[4],11,1272893353),n=Fl(n,o,t,r,e[7],16,-155497632),r=Fl(r,n,o,t,e[10],23,-1094730640),t=Fl(t,r,n,o,e[13],4,681279174),o=Fl(o,t,r,n,e[0],11,-358537222),n=Fl(n,o,t,r,e[3],16,-722521979),r=Fl(r,n,o,t,e[6],23,76029189),t=Fl(t,r,n,o,e[9],4,-640364487),o=Fl(o,t,r,n,e[12],11,-421815835),n=Fl(n,o,t,r,e[15],16,530742520),t=Dl(t,r=Fl(r,n,o,t,e[2],23,-995338651),n,o,e[0],6,-198630844),o=Dl(o,t,r,n,e[7],10,1126891415),n=Dl(n,o,t,r,e[14],15,-1416354905),r=Dl(r,n,o,t,e[5],21,-57434055),t=Dl(t,r,n,o,e[12],6,1700485571),o=Dl(o,t,r,n,e[3],10,-1894986606),n=Dl(n,o,t,r,e[10],15,-1051523),r=Dl(r,n,o,t,e[1],21,-2054922799),t=Dl(t,r,n,o,e[8],6,1873313359),o=Dl(o,t,r,n,e[15],10,-30611744),n=Dl(n,o,t,r,e[6],15,-1560198380),r=Dl(r,n,o,t,e[13],21,1309151649),t=Dl(t,r,n,o,e[4],6,-145523070),o=Dl(o,t,r,n,e[11],10,-1120210379),n=Dl(n,o,t,r,e[2],15,718787259),r=Dl(r,n,o,t,e[9],21,-343485551),i[0]=yd(t,i[0]),i[1]=yd(r,i[1]),i[2]=yd(n,i[2]),i[3]=yd(o,i[3])}function Y1(i,e,t,r,n,o){return e=yd(yd(e,i),yd(r,o)),yd(e<<n|e>>>32-n,t)}function Ml(i,e,t,r,n,o,l){return Y1(e&t|~e&r,i,e,n,o,l)}function Pl(i,e,t,r,n,o,l){return Y1(e&r|t&~r,i,e,n,o,l)}function Fl(i,e,t,r,n,o,l){return Y1(e^t^r,i,e,n,o,l)}function Dl(i,e,t,r,n,o,l){return Y1(t^(e|~r),i,e,n,o,l)}function w4(i){var e,t=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=i.length;e+=64)EC(r,qie(i.substring(e-64,e)));i=i.substring(e-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i.length;e++)n[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(EC(r,n),e=0;e<16;e++)n[e]=0;return n[14]=8*t,EC(r,n),r}function qie(i){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return t}Vy=kr.atob.bind(kr),CC=kr.btoa.bind(kr);var B4="0123456789abcdef".split("");function $ie(i){for(var e="",t=0;t<4;t++)e+=B4[i>>8*t+4&15]+B4[i>>8*t&15];return e}function Kie(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function SC(i){return w4(i).map(Kie).join("")}var Wie=function(i){for(var e=0;e<i.length;e++)i[e]=$ie(i[e]);return i.join("")}(w4("hello"))!="5d41402abc4b2a76b9719d911017c592";function yd(i,e){if(Wie){var t=(65535&i)+(65535&e);return(i>>16)+(e>>16)+(t>>16)<<16|65535&t}return i+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function TC(i,e){var t,r,n,o;if(i!==t){for(var l=(n=i,o=1+(256/i.length>>0),new Array(o+1).join(n)),s=[],g=0;g<256;g++)s[g]=g;var b=0;for(g=0;g<256;g++){var S=s[g];b=(b+S+l.charCodeAt(g))%256,s[g]=s[b],s[b]=S}t=i,r=s}else s=r;var F=e.length,D=0,N=0,J="";for(g=0;g<F;g++)N=(N+(S=s[D=(D+1)%256]))%256,s[D]=s[N],s[N]=S,l=s[(s[D]+s[N])%256],J+=String.fromCharCode(e.charCodeAt(g)^l);return J}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var C4={print:4,modify:8,copy:16,"annot-forms":32};function xg(i,e,t,r){this.v=1,this.r=2;var n=192;i.forEach(function(s){if(C4.perm!==void 0)throw new Error("Invalid permission: "+s);n+=C4[s]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(e+this.padding).substr(0,32),l=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,l),this.P=-(1+(255^n)),this.encryptionKey=SC(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=TC(this.encryptionKey,this.padding)}function wg(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var e="",t=i.length,r=0;r<t;r++){var n=i.charCodeAt(r);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?e+="#"+("0"+n.toString(16)).slice(-2):e+=i[r]}return e}function E4(i){if(Yn(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,r,n){if(n=n||!1,typeof t!="string"||typeof r!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[r,!!n],o},this.unsubscribe=function(t){for(var r in e)if(e[r][t])return delete e[r][t],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var r=Array.prototype.slice.call(arguments,1),n=[];for(var o in e[t]){var l=e[t][o];try{l[0].apply(i,r)}catch(s){kr.console&&Fs.error("jsPDF PubSub Error",s.message,s)}l[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function ev(i){if(!(this instanceof ev))return new ev(i);var e="opacity,stroke-opacity".split(",");for(var t in i)i.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=i[t]);this.id="",this.objectNumber=-1}function S4(i,e){this.gState=i,this.matrix=e,this.id="",this.objectNumber=-1}function Lf(i,e,t,r,n){if(!(this instanceof Lf))return new Lf(i,e,t,r,n);this.type=i==="axial"?2:3,this.coords=e,this.colors=t,S4.call(this,r,n)}function Bg(i,e,t,r,n){if(!(this instanceof Bg))return new Bg(i,e,t,r,n);this.boundingBox=i,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,S4.call(this,r,n)}function Or(i){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],n=arguments[2],o=arguments[3],l=[],s=1,g=16,b="S",S=null;Yn(i=i||{})==="object"&&(t=i.orientation,r=i.unit||r,n=i.format||n,o=i.compress||i.compressPdf||o,(S=i.encryption||null)!==null&&(S.userPassword=S.userPassword||"",S.ownerPassword=S.ownerPassword||"",S.userPermissions=S.userPermissions||[]),s=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(e=i.precision),i.floatPrecision!==void 0&&(g=i.floatPrecision),b=i.defaultPathOperation||"S"),l=i.filters||(o===!0?["FlateEncode"]:l),r=r||"mm",t=(""+(t||"P")).toLowerCase();var F=i.putOnlyUsedFonts||!1,D={},N={internal:{},__private__:{}};N.__private__.PubSub=E4;var J="1.3",te=N.__private__.getPdfVersion=function(){return J};N.__private__.setPdfVersion=function(se){J=se};var he={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};N.__private__.getPageFormats=function(){return he};var ue=N.__private__.getPageFormat=function(se){return he[se]};n=n||"a4";var fe={COMPAT:"compat",ADVANCED:"advanced"},ve=fe.COMPAT;function Se(){this.saveGraphicsState(),lt(new xe(ui,0,0,-ui,0,to()*ui).toString()+" cm"),this.setFontSize(this.getFontSize()/ui),b="n",ve=fe.ADVANCED}function Ge(){this.restoreGraphicsState(),b="S",ve=fe.COMPAT}var He=N.__private__.combineFontStyleAndFontWeight=function(se,Le){if(se=="bold"&&Le=="normal"||se=="bold"&&Le==400||se=="normal"&&Le=="italic"||se=="bold"&&Le=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Le&&(se=Le==400||Le==="normal"?se==="italic"?"italic":"normal":Le!=700&&Le!=="bold"||se!=="normal"?(Le==700?"bold":Le)+""+se:"bold"),se};N.advancedAPI=function(se){var Le=ve===fe.COMPAT;return Le&&Se.call(this),typeof se!="function"||(se(this),Le&&Ge.call(this)),this},N.compatAPI=function(se){var Le=ve===fe.ADVANCED;return Le&&Ge.call(this),typeof se!="function"||(se(this),Le&&Se.call(this)),this},N.isAdvancedAPI=function(){return ve===fe.ADVANCED};var $e,Ne=function(se){if(ve!==fe.ADVANCED)throw new Error(se+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},at=N.roundToPrecision=N.__private__.roundToPrecision=function(se,Le){var ct=e||Le;if(isNaN(se)||isNaN(ct))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return se.toFixed(ct).replace(/0+$/,"")};$e=N.hpf=N.__private__.hpf=typeof g=="number"?function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return at(se,g)}:g==="smart"?function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return at(se,se>-1&&se<1?16:5)}:function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return at(se,16)};var rt=N.f2=N.__private__.f2=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.f2");return at(se,2)},Re=N.__private__.f3=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.f3");return at(se,3)},Pe=N.scale=N.__private__.scale=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.scale");return ve===fe.COMPAT?se*ui:ve===fe.ADVANCED?se:void 0},Je=function(se){return ve===fe.COMPAT?to()-se:ve===fe.ADVANCED?se:void 0},Xe=function(se){return Pe(Je(se))};N.__private__.setPrecision=N.setPrecision=function(se){typeof parseInt(se,10)=="number"&&(e=parseInt(se,10))};var Ct,Et="00000000000000000000000000000000",Mt=N.__private__.getFileId=function(){return Et},vt=N.__private__.setFileId=function(se){return Et=se!==void 0&&/^[a-fA-F0-9]{32}$/.test(se)?se.toUpperCase():Et.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),S!==null&&(Bn=new xg(S.userPermissions,S.userPassword,S.ownerPassword,Et)),Et};N.setFileId=function(se){return vt(se),this},N.getFileId=function(){return Mt()};var Dt=N.__private__.convertDateToPDFDate=function(se){var Le=se.getTimezoneOffset(),ct=Le<0?"+":"-",yt=Math.floor(Math.abs(Le/60)),bt=Math.abs(Le%60),It=[ct,tt(yt),"'",tt(bt),"'"].join("");return["D:",se.getFullYear(),tt(se.getMonth()+1),tt(se.getDate()),tt(se.getHours()),tt(se.getMinutes()),tt(se.getSeconds()),It].join("")},Pt=N.__private__.convertPDFDateToDate=function(se){var Le=parseInt(se.substr(2,4),10),ct=parseInt(se.substr(6,2),10)-1,yt=parseInt(se.substr(8,2),10),bt=parseInt(se.substr(10,2),10),It=parseInt(se.substr(12,2),10),gi=parseInt(se.substr(14,2),10);return new Date(Le,ct,yt,bt,It,gi,0)},Xt=N.__private__.setCreationDate=function(se){var Le;if(se===void 0&&(se=new Date),se instanceof Date)Le=Dt(se);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(se))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Le=se}return Ct=Le},Te=N.__private__.getCreationDate=function(se){var Le=Ct;return se==="jsDate"&&(Le=Pt(Ct)),Le};N.setCreationDate=function(se){return Xt(se),this},N.getCreationDate=function(se){return Te(se)};var Ze,tt=N.__private__.padd2=function(se){return("0"+parseInt(se)).slice(-2)},dt=N.__private__.padd2Hex=function(se){return("00"+(se=se.toString())).substr(se.length)},pt=0,Bt=[],Ft=[],Lt=0,Gt=[],ri=[],mi=!1,yi=Ft,Pi=function(){pt=0,Lt=0,Ft=[],Bt=[],Gt=[],$t=_t(),Wt=_t()};N.__private__.setCustomOutputDestination=function(se){mi=!0,yi=se};var Ot=function(se){mi||(yi=se)};N.__private__.resetCustomOutputDestination=function(){mi=!1,yi=Ft};var lt=N.__private__.out=function(se){return se=se.toString(),Lt+=se.length+1,yi.push(se),yi},wt=N.__private__.write=function(se){return lt(arguments.length===1?se.toString():Array.prototype.join.call(arguments," "))},ki=N.__private__.getArrayBuffer=function(se){for(var Le=se.length,ct=new ArrayBuffer(Le),yt=new Uint8Array(ct);Le--;)yt[Le]=se.charCodeAt(Le);return ct},ti=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];N.__private__.getStandardFonts=function(){return ti};var ht=i.fontSize||16;N.__private__.setFontSize=N.setFontSize=function(se){return ht=ve===fe.ADVANCED?se/ui:se,this};var qt,si=N.__private__.getFontSize=N.getFontSize=function(){return ve===fe.COMPAT?ht:ht*ui},fi=i.R2L||!1;N.__private__.setR2L=N.setR2L=function(se){return fi=se,this},N.__private__.getR2L=N.getR2L=function(){return fi};var ci,Wi=N.__private__.setZoomMode=function(se){var Le=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(se))qt=se;else if(isNaN(se)){if(Le.indexOf(se)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+se+'" is not recognized.');qt=se}else qt=parseInt(se,10)};N.__private__.getZoomMode=function(){return qt};var ir,dr=N.__private__.setPageMode=function(se){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(se)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+se+'" is not recognized.');ci=se};N.__private__.getPageMode=function(){return ci};var Sr=N.__private__.setLayoutMode=function(se){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(se)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+se+'" is not recognized.');ir=se};N.__private__.getLayoutMode=function(){return ir},N.__private__.setDisplayMode=N.setDisplayMode=function(se,Le,ct){return Wi(se),Sr(Le),dr(ct),this};var zt={title:"",subject:"",author:"",keywords:"",creator:""};N.__private__.getDocumentProperty=function(se){if(Object.keys(zt).indexOf(se)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return zt[se]},N.__private__.getDocumentProperties=function(){return zt},N.__private__.setDocumentProperties=N.setProperties=N.setDocumentProperties=function(se){for(var Le in zt)zt.hasOwnProperty(Le)&&se[Le]&&(zt[Le]=se[Le]);return this},N.__private__.setDocumentProperty=function(se,Le){if(Object.keys(zt).indexOf(se)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return zt[se]=Le};var Yi,ui,Kt,Ji,Vt,Ci={},Li={},jt=[],bi={},Yt={},yr={},Tr={},Qe=null,Be=0,ae=[],ie=new E4(N),ce=i.hotfixes||[],me={},be={},Ee=[],xe=function se(Le,ct,yt,bt,It,gi){if(!(this instanceof se))return new se(Le,ct,yt,bt,It,gi);isNaN(Le)&&(Le=1),isNaN(ct)&&(ct=0),isNaN(yt)&&(yt=0),isNaN(bt)&&(bt=1),isNaN(It)&&(It=0),isNaN(gi)&&(gi=0),this._matrix=[Le,ct,yt,bt,It,gi]};Object.defineProperty(xe.prototype,"sx",{get:function(){return this._matrix[0]},set:function(se){this._matrix[0]=se}}),Object.defineProperty(xe.prototype,"shy",{get:function(){return this._matrix[1]},set:function(se){this._matrix[1]=se}}),Object.defineProperty(xe.prototype,"shx",{get:function(){return this._matrix[2]},set:function(se){this._matrix[2]=se}}),Object.defineProperty(xe.prototype,"sy",{get:function(){return this._matrix[3]},set:function(se){this._matrix[3]=se}}),Object.defineProperty(xe.prototype,"tx",{get:function(){return this._matrix[4]},set:function(se){this._matrix[4]=se}}),Object.defineProperty(xe.prototype,"ty",{get:function(){return this._matrix[5]},set:function(se){this._matrix[5]=se}}),Object.defineProperty(xe.prototype,"a",{get:function(){return this._matrix[0]},set:function(se){this._matrix[0]=se}}),Object.defineProperty(xe.prototype,"b",{get:function(){return this._matrix[1]},set:function(se){this._matrix[1]=se}}),Object.defineProperty(xe.prototype,"c",{get:function(){return this._matrix[2]},set:function(se){this._matrix[2]=se}}),Object.defineProperty(xe.prototype,"d",{get:function(){return this._matrix[3]},set:function(se){this._matrix[3]=se}}),Object.defineProperty(xe.prototype,"e",{get:function(){return this._matrix[4]},set:function(se){this._matrix[4]=se}}),Object.defineProperty(xe.prototype,"f",{get:function(){return this._matrix[5]},set:function(se){this._matrix[5]=se}}),Object.defineProperty(xe.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(xe.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(xe.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(xe.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),xe.prototype.join=function(se){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map($e).join(se)},xe.prototype.multiply=function(se){var Le=se.sx*this.sx+se.shy*this.shx,ct=se.sx*this.shy+se.shy*this.sy,yt=se.shx*this.sx+se.sy*this.shx,bt=se.shx*this.shy+se.sy*this.sy,It=se.tx*this.sx+se.ty*this.shx+this.tx,gi=se.tx*this.shy+se.ty*this.sy+this.ty;return new xe(Le,ct,yt,bt,It,gi)},xe.prototype.decompose=function(){var se=this.sx,Le=this.shy,ct=this.shx,yt=this.sy,bt=this.tx,It=this.ty,gi=Math.sqrt(se*se+Le*Le),ni=(se/=gi)*ct+(Le/=gi)*yt;ct-=se*ni,yt-=Le*ni;var nr=Math.sqrt(ct*ct+yt*yt);return ni/=nr,se*(yt/=nr)<Le*(ct/=nr)&&(se=-se,Le=-Le,ni=-ni,gi=-gi),{scale:new xe(gi,0,0,nr,0,0),translate:new xe(1,0,0,1,bt,It),rotate:new xe(se,Le,-Le,se,0,0),skew:new xe(1,0,ni,1,0,0)}},xe.prototype.toString=function(se){return this.join(" ")},xe.prototype.inversed=function(){var se=this.sx,Le=this.shy,ct=this.shx,yt=this.sy,bt=this.tx,It=this.ty,gi=1/(se*yt-Le*ct),ni=yt*gi,nr=-Le*gi,$i=-ct*gi,Oi=se*gi;return new xe(ni,nr,$i,Oi,-ni*bt-$i*It,-nr*bt-Oi*It)},xe.prototype.applyToPoint=function(se){var Le=se.x*this.sx+se.y*this.shx+this.tx,ct=se.x*this.shy+se.y*this.sy+this.ty;return new Vl(Le,ct)},xe.prototype.applyToRectangle=function(se){var Le=this.applyToPoint(se),ct=this.applyToPoint(new Vl(se.x+se.w,se.y+se.h));return new el(Le.x,Le.y,ct.x-Le.x,ct.y-Le.y)},xe.prototype.clone=function(){var se=this.sx,Le=this.shy,ct=this.shx,yt=this.sy,bt=this.tx,It=this.ty;return new xe(se,Le,ct,yt,bt,It)},N.Matrix=xe;var Fe=N.matrixMult=function(se,Le){return Le.multiply(se)},Ue=new xe(1,0,0,1,0,0);N.unitMatrix=N.identityMatrix=Ue;var je=function(se,Le){if(!Yt[se]){var ct=(Le instanceof Lf?"Sh":"P")+(Object.keys(bi).length+1).toString(10);Le.id=ct,Yt[se]=ct,bi[ct]=Le,ie.publish("addPattern",Le)}};N.ShadingPattern=Lf,N.TilingPattern=Bg,N.addShadingPattern=function(se,Le){return Ne("addShadingPattern()"),je(se,Le),this},N.beginTilingPattern=function(se){Ne("beginTilingPattern()"),Hl(se.boundingBox[0],se.boundingBox[1],se.boundingBox[2]-se.boundingBox[0],se.boundingBox[3]-se.boundingBox[1],se.matrix)},N.endTilingPattern=function(se,Le){Ne("endTilingPattern()"),Le.stream=ri[Ze].join(`
`),je(se,Le),ie.publish("endTilingPattern",Le),Ee.pop().restore()};var nt=N.__private__.newObject=function(){var se=_t();return St(se,!0),se},_t=N.__private__.newObjectDeferred=function(){return pt++,Bt[pt]=function(){return Lt},pt},St=function(se,Le){return Le=typeof Le=="boolean"&&Le,Bt[se]=Lt,Le&&lt(se+" 0 obj"),se},ei=N.__private__.newAdditionalObject=function(){var se={objId:_t(),content:""};return Gt.push(se),se},$t=_t(),Wt=_t(),oi=N.__private__.decodeColorString=function(se){var Le=se.split(" ");if(Le.length!==2||Le[1]!=="g"&&Le[1]!=="G")Le.length===5&&(Le[4]==="k"||Le[4]==="K")&&(Le=[(1-Le[0])*(1-Le[3]),(1-Le[1])*(1-Le[3]),(1-Le[2])*(1-Le[3]),"r"]);else{var ct=parseFloat(Le[0]);Le=[ct,ct,ct,"r"]}for(var yt="#",bt=0;bt<3;bt++)yt+=("0"+Math.floor(255*parseFloat(Le[bt])).toString(16)).slice(-2);return yt},Ei=N.__private__.encodeColorString=function(se){var Le;typeof se=="string"&&(se={ch1:se});var ct=se.ch1,yt=se.ch2,bt=se.ch3,It=se.ch4,gi=se.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ct=="string"&&ct.charAt(0)!=="#"){var ni=new x4(ct);if(ni.ok)ct=ni.toHex();else if(!/^\d*\.?\d*$/.test(ct))throw new Error('Invalid color "'+ct+'" passed to jsPDF.encodeColorString.')}if(typeof ct=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ct)&&(ct="#"+ct[1]+ct[1]+ct[2]+ct[2]+ct[3]+ct[3]),typeof ct=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ct)){var nr=parseInt(ct.substr(1),16);ct=nr>>16&255,yt=nr>>8&255,bt=255&nr}if(yt===void 0||It===void 0&&ct===yt&&yt===bt)if(typeof ct=="string")Le=ct+" "+gi[0];else switch(se.precision){case 2:Le=rt(ct/255)+" "+gi[0];break;case 3:default:Le=Re(ct/255)+" "+gi[0]}else if(It===void 0||Yn(It)==="object"){if(It&&!isNaN(It.a)&&It.a===0)return Le=["1.","1.","1.",gi[1]].join(" ");if(typeof ct=="string")Le=[ct,yt,bt,gi[1]].join(" ");else switch(se.precision){case 2:Le=[rt(ct/255),rt(yt/255),rt(bt/255),gi[1]].join(" ");break;default:case 3:Le=[Re(ct/255),Re(yt/255),Re(bt/255),gi[1]].join(" ")}}else if(typeof ct=="string")Le=[ct,yt,bt,It,gi[2]].join(" ");else switch(se.precision){case 2:Le=[rt(ct),rt(yt),rt(bt),rt(It),gi[2]].join(" ");break;case 3:default:Le=[Re(ct),Re(yt),Re(bt),Re(It),gi[2]].join(" ")}return Le},Gi=N.__private__.getFilters=function(){return l},Bi=N.__private__.putStream=function(se){var Le=(se=se||{}).data||"",ct=se.filters||Gi(),yt=se.alreadyAppliedFilters||[],bt=se.addLength1||!1,It=Le.length,gi=se.objectId,ni=function(Mr){return Mr};if(S!==null&&gi===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");S!==null&&(ni=Bn.encryptor(gi,0));var nr={};ct===!0&&(ct=["FlateEncode"]);var $i=se.additionalKeyValues||[],Oi=(nr=Or.API.processDataByFilters!==void 0?Or.API.processDataByFilters(Le,ct):{data:Le,reverseChain:[]}).reverseChain+(Array.isArray(yt)?yt.join(" "):yt.toString());if(nr.data.length!==0&&($i.push({key:"Length",value:nr.data.length}),bt===!0&&$i.push({key:"Length1",value:It})),Oi.length!=0)if(Oi.split("/").length-1==1)$i.push({key:"Filter",value:Oi});else{$i.push({key:"Filter",value:"["+Oi+"]"});for(var qr=0;qr<$i.length;qr+=1)if($i[qr].key==="DecodeParms"){for(var sr=[],jn=0;jn<nr.reverseChain.split("/").length-1;jn+=1)sr.push("null");sr.push($i[qr].value),$i[qr].value="["+sr.join(" ")+"]"}}lt("<<");for(var Cr=0;Cr<$i.length;Cr++)lt("/"+$i[Cr].key+" "+$i[Cr].value);lt(">>"),nr.data.length!==0&&(lt("stream"),lt(ni(nr.data)),lt("endstream"))},Ni=N.__private__.putPage=function(se){var Le=se.number,ct=se.data,yt=se.objId,bt=se.contentsObjId;St(yt,!0),lt("<</Type /Page"),lt("/Parent "+se.rootDictionaryObjId+" 0 R"),lt("/Resources "+se.resourceDictionaryObjId+" 0 R"),lt("/MediaBox ["+parseFloat($e(se.mediaBox.bottomLeftX))+" "+parseFloat($e(se.mediaBox.bottomLeftY))+" "+$e(se.mediaBox.topRightX)+" "+$e(se.mediaBox.topRightY)+"]"),se.cropBox!==null&&lt("/CropBox ["+$e(se.cropBox.bottomLeftX)+" "+$e(se.cropBox.bottomLeftY)+" "+$e(se.cropBox.topRightX)+" "+$e(se.cropBox.topRightY)+"]"),se.bleedBox!==null&&lt("/BleedBox ["+$e(se.bleedBox.bottomLeftX)+" "+$e(se.bleedBox.bottomLeftY)+" "+$e(se.bleedBox.topRightX)+" "+$e(se.bleedBox.topRightY)+"]"),se.trimBox!==null&&lt("/TrimBox ["+$e(se.trimBox.bottomLeftX)+" "+$e(se.trimBox.bottomLeftY)+" "+$e(se.trimBox.topRightX)+" "+$e(se.trimBox.topRightY)+"]"),se.artBox!==null&&lt("/ArtBox ["+$e(se.artBox.bottomLeftX)+" "+$e(se.artBox.bottomLeftY)+" "+$e(se.artBox.topRightX)+" "+$e(se.artBox.topRightY)+"]"),typeof se.userUnit=="number"&&se.userUnit!==1&&lt("/UserUnit "+se.userUnit),ie.publish("putPage",{objId:yt,pageContext:ae[Le],pageNumber:Le,page:ct}),lt("/Contents "+bt+" 0 R"),lt(">>"),lt("endobj");var It=ct.join(`
`);return ve===fe.ADVANCED&&(It+=`
Q`),St(bt,!0),Bi({data:It,filters:Gi(),objectId:bt}),lt("endobj"),yt},ot=N.__private__.putPages=function(){var se,Le,ct=[];for(se=1;se<=Be;se++)ae[se].objId=_t(),ae[se].contentsObjId=_t();for(se=1;se<=Be;se++)ct.push(Ni({number:se,data:ri[se],objId:ae[se].objId,contentsObjId:ae[se].contentsObjId,mediaBox:ae[se].mediaBox,cropBox:ae[se].cropBox,bleedBox:ae[se].bleedBox,trimBox:ae[se].trimBox,artBox:ae[se].artBox,userUnit:ae[se].userUnit,rootDictionaryObjId:$t,resourceDictionaryObjId:Wt}));St($t,!0),lt("<</Type /Pages");var yt="/Kids [";for(Le=0;Le<Be;Le++)yt+=ct[Le]+" 0 R ";lt(yt+"]"),lt("/Count "+Be),lt(">>"),lt("endobj"),ie.publish("postPutPages")},ii=function(se){ie.publish("putFont",{font:se,out:lt,newObject:nt,putStream:Bi}),se.isAlreadyPutted!==!0&&(se.objectNumber=nt(),lt("<<"),lt("/Type /Font"),lt("/BaseFont /"+wg(se.postScriptName)),lt("/Subtype /Type1"),typeof se.encoding=="string"&&lt("/Encoding /"+se.encoding),lt("/FirstChar 32"),lt("/LastChar 255"),lt(">>"),lt("endobj"))},Qt=function(){for(var se in Ci)Ci.hasOwnProperty(se)&&(F===!1||F===!0&&D.hasOwnProperty(se))&&ii(Ci[se])},Qi=function(se){se.objectNumber=nt();var Le=[];Le.push({key:"Type",value:"/XObject"}),Le.push({key:"Subtype",value:"/Form"}),Le.push({key:"BBox",value:"["+[$e(se.x),$e(se.y),$e(se.x+se.width),$e(se.y+se.height)].join(" ")+"]"}),Le.push({key:"Matrix",value:"["+se.matrix.toString()+"]"});var ct=se.pages[1].join(`
`);Bi({data:ct,additionalKeyValues:Le,objectId:se.objectNumber}),lt("endobj")},Ar=function(){for(var se in me)me.hasOwnProperty(se)&&Qi(me[se])},on=function(se,Le){var ct,yt=[],bt=1/(Le-1);for(ct=0;ct<1;ct+=bt)yt.push(ct);if(yt.push(1),se[0].offset!=0){var It={offset:0,color:se[0].color};se.unshift(It)}if(se[se.length-1].offset!=1){var gi={offset:1,color:se[se.length-1].color};se.push(gi)}for(var ni="",nr=0,$i=0;$i<yt.length;$i++){for(ct=yt[$i];ct>se[nr+1].offset;)nr++;var Oi=se[nr].offset,qr=(ct-Oi)/(se[nr+1].offset-Oi),sr=se[nr].color,jn=se[nr+1].color;ni+=dt(Math.round((1-qr)*sr[0]+qr*jn[0]).toString(16))+dt(Math.round((1-qr)*sr[1]+qr*jn[1]).toString(16))+dt(Math.round((1-qr)*sr[2]+qr*jn[2]).toString(16))}return ni.trim()},xn=function(se,Le){Le||(Le=21);var ct=nt(),yt=on(se.colors,Le),bt=[];bt.push({key:"FunctionType",value:"0"}),bt.push({key:"Domain",value:"[0.0 1.0]"}),bt.push({key:"Size",value:"["+Le+"]"}),bt.push({key:"BitsPerSample",value:"8"}),bt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),bt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Bi({data:yt,additionalKeyValues:bt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ct}),lt("endobj"),se.objectNumber=nt(),lt("<< /ShadingType "+se.type),lt("/ColorSpace /DeviceRGB");var It="/Coords ["+$e(parseFloat(se.coords[0]))+" "+$e(parseFloat(se.coords[1]))+" ";se.type===2?It+=$e(parseFloat(se.coords[2]))+" "+$e(parseFloat(se.coords[3])):It+=$e(parseFloat(se.coords[2]))+" "+$e(parseFloat(se.coords[3]))+" "+$e(parseFloat(se.coords[4]))+" "+$e(parseFloat(se.coords[5])),lt(It+="]"),se.matrix&&lt("/Matrix ["+se.matrix.toString()+"]"),lt("/Function "+ct+" 0 R"),lt("/Extend [true true]"),lt(">>"),lt("endobj")},hr=function(se,Le){var ct=_t(),yt=nt();Le.push({resourcesOid:ct,objectOid:yt}),se.objectNumber=yt;var bt=[];bt.push({key:"Type",value:"/Pattern"}),bt.push({key:"PatternType",value:"1"}),bt.push({key:"PaintType",value:"1"}),bt.push({key:"TilingType",value:"1"}),bt.push({key:"BBox",value:"["+se.boundingBox.map($e).join(" ")+"]"}),bt.push({key:"XStep",value:$e(se.xStep)}),bt.push({key:"YStep",value:$e(se.yStep)}),bt.push({key:"Resources",value:ct+" 0 R"}),se.matrix&&bt.push({key:"Matrix",value:"["+se.matrix.toString()+"]"}),Bi({data:se.stream,additionalKeyValues:bt,objectId:se.objectNumber}),lt("endobj")},mn=function(se){var Le;for(Le in bi)bi.hasOwnProperty(Le)&&(bi[Le]instanceof Lf?xn(bi[Le]):bi[Le]instanceof Bg&&hr(bi[Le],se))},yn=function(se){for(var Le in se.objectNumber=nt(),lt("<<"),se)switch(Le){case"opacity":lt("/ca "+rt(se[Le]));break;case"stroke-opacity":lt("/CA "+rt(se[Le]))}lt(">>"),lt("endobj")},cr=function(){var se;for(se in yr)yr.hasOwnProperty(se)&&yn(yr[se])},On=function(){for(var se in lt("/XObject <<"),me)me.hasOwnProperty(se)&&me[se].objectNumber>=0&&lt("/"+se+" "+me[se].objectNumber+" 0 R");ie.publish("putXobjectDict"),lt(">>")},ms=function(){Bn.oid=nt(),lt("<<"),lt("/Filter /Standard"),lt("/V "+Bn.v),lt("/R "+Bn.r),lt("/U <"+Bn.toHexString(Bn.U)+">"),lt("/O <"+Bn.toHexString(Bn.O)+">"),lt("/P "+Bn.P),lt(">>"),lt("endobj")},Vr=function(){for(var se in lt("/Font <<"),Ci)Ci.hasOwnProperty(se)&&(F===!1||F===!0&&D.hasOwnProperty(se))&&lt("/"+se+" "+Ci[se].objectNumber+" 0 R");lt(">>")},wn=function(){if(Object.keys(bi).length>0){for(var se in lt("/Shading <<"),bi)bi.hasOwnProperty(se)&&bi[se]instanceof Lf&&bi[se].objectNumber>=0&&lt("/"+se+" "+bi[se].objectNumber+" 0 R");ie.publish("putShadingPatternDict"),lt(">>")}},To=function(se){if(Object.keys(bi).length>0){for(var Le in lt("/Pattern <<"),bi)bi.hasOwnProperty(Le)&&bi[Le]instanceof N.TilingPattern&&bi[Le].objectNumber>=0&&bi[Le].objectNumber<se&&lt("/"+Le+" "+bi[Le].objectNumber+" 0 R");ie.publish("putTilingPatternDict"),lt(">>")}},hs=function(){if(Object.keys(yr).length>0){var se;for(se in lt("/ExtGState <<"),yr)yr.hasOwnProperty(se)&&yr[se].objectNumber>=0&&lt("/"+se+" "+yr[se].objectNumber+" 0 R");ie.publish("putGStateDict"),lt(">>")}},Xi=function(se){St(se.resourcesOid,!0),lt("<<"),lt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Vr(),wn(),To(se.objectOid),hs(),On(),lt(">>"),lt("endobj")},eo=function(){var se=[];Qt(),cr(),Ar(),mn(se),ie.publish("putResources"),se.forEach(Xi),Xi({resourcesOid:Wt,objectOid:Number.MAX_SAFE_INTEGER}),ie.publish("postPutResources")},Cs=function(){ie.publish("putAdditionalObjects");for(var se=0;se<Gt.length;se++){var Le=Gt[se];St(Le.objId,!0),lt(Le.content),lt("endobj")}ie.publish("postPutAdditionalObjects")},fr=function(se){Li[se.fontName]=Li[se.fontName]||{},Li[se.fontName][se.fontStyle]=se.id},Dr=function(se,Le,ct,yt,bt){var It={id:"F"+(Object.keys(Ci).length+1).toString(10),postScriptName:se,fontName:Le,fontStyle:ct,encoding:yt,isStandardFont:bt||!1,metadata:{}};return ie.publish("addFont",{font:It,instance:this}),Ci[It.id]=It,fr(It),It.id},Gn=function(se){for(var Le=0,ct=ti.length;Le<ct;Le++){var yt=Dr.call(this,se[Le][0],se[Le][1],se[Le][2],ti[Le][3],!0);F===!1&&(D[yt]=!0);var bt=se[Le][0].split("-");fr({id:yt,fontName:bt[0],fontStyle:bt[1]||""})}ie.publish("addFonts",{fonts:Ci,dictionary:Li})},Ur=function(se){return se.foo=function(){try{return se.apply(this,arguments)}catch(yt){var Le=yt.stack||"";~Le.indexOf(" at ")&&(Le=Le.split(" at ")[1]);var ct="Error in function "+Le.split(`
`)[0].split("<")[0]+": "+yt.message;if(!kr.console)throw new Error(ct);kr.console.error(ct,yt),kr.alert&&alert(ct)}},se.foo.bar=se,se.foo},Sn=function(se,Le){var ct,yt,bt,It,gi,ni,nr,$i,Oi;if(bt=(Le=Le||{}).sourceEncoding||"Unicode",gi=Le.outputEncoding,(Le.autoencode||gi)&&Ci[Yi].metadata&&Ci[Yi].metadata[bt]&&Ci[Yi].metadata[bt].encoding&&(It=Ci[Yi].metadata[bt].encoding,!gi&&Ci[Yi].encoding&&(gi=Ci[Yi].encoding),!gi&&It.codePages&&(gi=It.codePages[0]),typeof gi=="string"&&(gi=It[gi]),gi)){for(nr=!1,ni=[],ct=0,yt=se.length;ct<yt;ct++)($i=gi[se.charCodeAt(ct)])?ni.push(String.fromCharCode($i)):ni.push(se[ct]),ni[ct].charCodeAt(0)>>8&&(nr=!0);se=ni.join("")}for(ct=se.length;nr===void 0&&ct!==0;)se.charCodeAt(ct-1)>>8&&(nr=!0),ct--;if(!nr)return se;for(ni=Le.noBOM?[]:[254,255],ct=0,yt=se.length;ct<yt;ct++){if((Oi=($i=se.charCodeAt(ct))>>8)>>8)throw new Error("Character at position "+ct+" of string '"+se+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");ni.push(Oi),ni.push($i-(Oi<<8))}return String.fromCharCode.apply(void 0,ni)},dn=N.__private__.pdfEscape=N.pdfEscape=function(se,Le){return Sn(se,Le).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Gr=N.__private__.beginPage=function(se){ri[++Be]=[],ae[Be]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(se[0]),topRightY:Number(se[1])}},ho(Be),Ot(ri[Ze])},js=function(se,Le){var ct,yt,bt;switch(t=Le||t,typeof se=="string"&&(ct=ue(se.toLowerCase()),Array.isArray(ct)&&(yt=ct[0],bt=ct[1])),Array.isArray(se)&&(yt=se[0]*ui,bt=se[1]*ui),isNaN(yt)&&(yt=n[0],bt=n[1]),(yt>14400||bt>14400)&&(Fs.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),yt=Math.min(14400,yt),bt=Math.min(14400,bt)),n=[yt,bt],t.substr(0,1)){case"l":bt>yt&&(n=[bt,yt]);break;case"p":yt>bt&&(n=[bt,yt])}Gr(n),Hr(fn),lt(fo),cu!==0&&lt(cu+" J"),uu!==0&&lt(uu+" j"),ie.publish("addPage",{pageNumber:Be})},ha=function(se){se>0&&se<=Be&&(ri.splice(se,1),ae.splice(se,1),Be--,Ze>Be&&(Ze=Be),this.setPage(Ze))},ho=function(se){se>0&&se<=Be&&(Ze=se)},Ta=N.__private__.getNumberOfPages=N.getNumberOfPages=function(){return ri.length-1},ze=function(se,Le,ct){var yt,bt=void 0;return ct=ct||{},se=se!==void 0?se:Ci[Yi].fontName,Le=Le!==void 0?Le:Ci[Yi].fontStyle,yt=se.toLowerCase(),Li[yt]!==void 0&&Li[yt][Le]!==void 0?bt=Li[yt][Le]:Li[se]!==void 0&&Li[se][Le]!==void 0?bt=Li[se][Le]:ct.disableWarning===!1&&Fs.warn("Unable to look up font label for font '"+se+"', '"+Le+"'. Refer to getFontList() for available fonts."),bt||ct.noFallback||(bt=Li.times[Le])==null&&(bt=Li.times.normal),bt},Ye=N.__private__.putInfo=function(){var se=nt(),Le=function(yt){return yt};for(var ct in S!==null&&(Le=Bn.encryptor(se,0)),lt("<<"),lt("/Producer ("+dn(Le("jsPDF "+Or.version))+")"),zt)zt.hasOwnProperty(ct)&&zt[ct]&&lt("/"+ct.substr(0,1).toUpperCase()+ct.substr(1)+" ("+dn(Le(zt[ct]))+")");lt("/CreationDate ("+dn(Le(Ct))+")"),lt(">>"),lt("endobj")},ft=N.__private__.putCatalog=function(se){var Le=(se=se||{}).rootDictionaryObjId||$t;switch(nt(),lt("<<"),lt("/Type /Catalog"),lt("/Pages "+Le+" 0 R"),qt||(qt="fullwidth"),qt){case"fullwidth":lt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":lt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":lt("/OpenAction [3 0 R /Fit]");break;case"original":lt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ct=""+qt;ct.substr(ct.length-1)==="%"&&(qt=parseInt(qt)/100),typeof qt=="number"&&lt("/OpenAction [3 0 R /XYZ null null "+rt(qt)+"]")}switch(ir||(ir="continuous"),ir){case"continuous":lt("/PageLayout /OneColumn");break;case"single":lt("/PageLayout /SinglePage");break;case"two":case"twoleft":lt("/PageLayout /TwoColumnLeft");break;case"tworight":lt("/PageLayout /TwoColumnRight")}ci&&lt("/PageMode /"+ci),ie.publish("putCatalog"),lt(">>"),lt("endobj")},Ut=N.__private__.putTrailer=function(){lt("trailer"),lt("<<"),lt("/Size "+(pt+1)),lt("/Root "+pt+" 0 R"),lt("/Info "+(pt-1)+" 0 R"),S!==null&&lt("/Encrypt "+Bn.oid+" 0 R"),lt("/ID [ <"+Et+"> <"+Et+"> ]"),lt(">>")},hi=N.__private__.putHeader=function(){lt("%PDF-"+J),lt("%")},ji=N.__private__.putXRef=function(){var se="0000000000";lt("xref"),lt("0 "+(pt+1)),lt("0000000000 65535 f ");for(var Le=1;Le<=pt;Le++)typeof Bt[Le]=="function"?lt((se+Bt[Le]()).slice(-10)+" 00000 n "):Bt[Le]!==void 0?lt((se+Bt[Le]).slice(-10)+" 00000 n "):lt("0000000000 00000 n ")},xr=N.__private__.buildDocument=function(){Pi(),Ot(Ft),ie.publish("buildDocument"),hi(),ot(),Cs(),eo(),S!==null&&ms(),Ye(),ft();var se=Lt;return ji(),Ut(),lt("startxref"),lt(""+se),lt("%%EOF"),Ot(ri[Ze]),Ft.join(`
`)},Tn=N.__private__.getBlob=function(se){return new Blob([ki(se)],{type:"application/pdf"})},Un=N.output=N.__private__.output=Ur(function(se,Le){switch(typeof(Le=Le||{})=="string"?Le={filename:Le}:Le.filename=Le.filename||"generated.pdf",se){case void 0:return xr();case"save":N.save(Le.filename);break;case"arraybuffer":return ki(xr());case"blob":return Tn(xr());case"bloburi":case"bloburl":if(kr.URL!==void 0&&typeof kr.URL.createObjectURL=="function")return kr.URL&&kr.URL.createObjectURL(Tn(xr()))||void 0;Fs.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ct="",yt=xr();try{ct=CC(yt)}catch{ct=CC(unescape(encodeURIComponent(yt)))}return"data:application/pdf;filename="+Le.filename+";base64,"+ct;case"pdfobjectnewwindow":if(Object.prototype.toString.call(kr)==="[object Window]"){var bt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",It=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Le.pdfObjectUrl&&(bt=Le.pdfObjectUrl,It="");var gi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+bt+'"'+It+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Le)+");<\/script></body></html>",ni=kr.open();return ni!==null&&ni.document.write(gi),ni}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(kr)==="[object Window]"){var nr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Le.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Le.filename+'" width="500px" height="400px" /></body></html>',$i=kr.open();if($i!==null){$i.document.write(nr);var Oi=this;$i.document.documentElement.querySelector("#pdfViewer").onload=function(){$i.document.title=Le.filename,$i.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Oi.output("bloburl"))}}return $i}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(kr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var qr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Le)+'"></iframe></body></html>',sr=kr.open();if(sr!==null&&(sr.document.write(qr),sr.document.title=Le.filename),sr||typeof safari>"u")return sr;break;case"datauri":case"dataurl":return kr.document.location.href=this.output("datauristring",Le);default:return null}}),ns=function(se){return Array.isArray(ce)===!0&&ce.indexOf(se)>-1};switch(r){case"pt":ui=1;break;case"mm":ui=72/25.4;break;case"cm":ui=72/2.54;break;case"in":ui=72;break;case"px":ui=ns("px_scaling")==1?.75:96/72;break;case"pc":case"em":ui=12;break;case"ex":ui=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);ui=r}var Bn=null;Xt(),vt();var lu=function(se){return S!==null?Bn.encryptor(se,0):function(Le){return Le}},Ka=N.__private__.getPageInfo=N.getPageInfo=function(se){if(isNaN(se)||se%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ae[se].objId,pageNumber:se,pageContext:ae[se]}},Ir=N.__private__.getPageInfoByObjId=function(se){if(isNaN(se)||se%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Le in ae)if(ae[Le].objId===se)break;return Ka(Le)},Wa=N.__private__.getCurrentPageInfo=N.getCurrentPageInfo=function(){return{objId:ae[Ze].objId,pageNumber:Ze,pageContext:ae[Ze]}};N.addPage=function(){return js.apply(this,arguments),this},N.setPage=function(){return ho.apply(this,arguments),Ot.call(this,ri[Ze]),this},N.insertPage=function(se){return this.addPage(),this.movePage(Ze,se),this},N.movePage=function(se,Le){var ct,yt;if(se>Le){ct=ri[se],yt=ae[se];for(var bt=se;bt>Le;bt--)ri[bt]=ri[bt-1],ae[bt]=ae[bt-1];ri[Le]=ct,ae[Le]=yt,this.setPage(Le)}else if(se<Le){ct=ri[se],yt=ae[se];for(var It=se;It<Le;It++)ri[It]=ri[It+1],ae[It]=ae[It+1];ri[Le]=ct,ae[Le]=yt,this.setPage(Le)}return this},N.deletePage=function(){return ha.apply(this,arguments),this},N.__private__.text=N.text=function(se,Le,ct,yt,bt){var It,gi,ni,nr,$i,Oi,qr,sr,jn,Cr=(yt=yt||{}).scope||this;if(typeof se=="number"&&typeof Le=="number"&&(typeof ct=="string"||Array.isArray(ct))){var Mr=ct;ct=Le,Le=se,se=Mr}if(arguments[3]instanceof xe?(Ne("The transform parameter of text() with a Matrix value"),jn=bt):(ni=arguments[4],nr=arguments[5],Yn(qr=arguments[3])==="object"&&qr!==null||(typeof ni=="string"&&(nr=ni,ni=null),typeof qr=="string"&&(nr=qr,qr=null),typeof qr=="number"&&(ni=qr,qr=null),yt={flags:qr,angle:ni,align:nr})),isNaN(Le)||isNaN(ct)||se==null)throw new Error("Invalid arguments passed to jsPDF.text");if(se.length===0)return Cr;var Nn="",Ks=!1,io=typeof yt.lineHeightFactor=="number"?yt.lineHeightFactor:As,Mo=Cr.internal.scaleFactor;function La(Lr){return Lr=Lr.split("	").join(Array(yt.TabLen||9).join(" ")),dn(Lr,qr)}function ga(Lr){for(var Jr,ln=Lr.concat(),qn=[],va=ln.length;va--;)typeof(Jr=ln.shift())=="string"?qn.push(Jr):Array.isArray(Lr)&&(Jr.length===1||Jr[1]===void 0&&Jr[2]===void 0)?qn.push(Jr[0]):qn.push([Jr[0],Jr[1],Jr[2]]);return qn}function jl(Lr,Jr){var ln;if(typeof Lr=="string")ln=Jr(Lr)[0];else if(Array.isArray(Lr)){for(var qn,va,Ra=Lr.concat(),mo=[],Yo=Ra.length;Yo--;)typeof(qn=Ra.shift())=="string"?mo.push(Jr(qn)[0]):Array.isArray(qn)&&typeof qn[0]=="string"&&(va=Jr(qn[0],qn[1],qn[2]),mo.push([va[0],va[1],va[2]]));ln=mo}return ln}var Al=!1,ql=!0;if(typeof se=="string")Al=!0;else if(Array.isArray(se)){var gc=se.concat();gi=[];for(var ma,Ds=gc.length;Ds--;)(typeof(ma=gc.shift())!="string"||Array.isArray(ma)&&typeof ma[0]!="string")&&(ql=!1);Al=ql}if(Al===!1)throw new Error('Type of text must be string or Array. "'+se+'" is not recognized.');typeof se=="string"&&(se=se.match(/[\r?\n]/)?se.split(/\r\n|\r|\n/g):[se]);var dl=ht/Cr.internal.scaleFactor,$l=dl*(io-1);switch(yt.baseline){case"bottom":ct-=$l;break;case"top":ct+=dl-$l;break;case"hanging":ct+=dl-2*$l;break;case"middle":ct+=dl/2-$l}if((Oi=yt.maxWidth||0)>0&&(typeof se=="string"?se=Cr.splitTextToSize(se,Oi):Object.prototype.toString.call(se)==="[object Array]"&&(se=se.reduce(function(Lr,Jr){return Lr.concat(Cr.splitTextToSize(Jr,Oi))},[]))),It={text:se,x:Le,y:ct,options:yt,mutex:{pdfEscape:dn,activeFontKey:Yi,fonts:Ci,activeFontSize:ht}},ie.publish("preProcessText",It),se=It.text,ni=(yt=It.options).angle,!(jn instanceof xe)&&ni&&typeof ni=="number"){ni*=Math.PI/180,yt.rotationDirection===0&&(ni=-ni),ve===fe.ADVANCED&&(ni=-ni);var Ma=Math.cos(ni),Pa=Math.sin(ni);jn=new xe(Ma,Pa,-Pa,Ma,0,0)}else ni&&ni instanceof xe&&(jn=ni);ve!==fe.ADVANCED||jn||(jn=Ue),($i=yt.charSpace||Rc)!==void 0&&(Nn+=$e(Pe($i))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(sr=yt.horizontalScale)!==void 0&&(Nn+=$e(100*sr)+` Tz
`),yt.lang;var Rs=-1,Ou=yt.renderingMode!==void 0?yt.renderingMode:yt.stroke,In=Cr.internal.getCurrentPageInfo().pageContext;switch(Ou){case 0:case!1:case"fill":Rs=0;break;case 1:case!0:case"stroke":Rs=1;break;case 2:case"fillThenStroke":Rs=2;break;case 3:case"invisible":Rs=3;break;case 4:case"fillAndAddForClipping":Rs=4;break;case 5:case"strokeAndAddPathForClipping":Rs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Rs=6;break;case 7:case"addToPathForClipping":Rs=7}var an=In.usedRenderingMode!==void 0?In.usedRenderingMode:-1;Rs!==-1?Nn+=Rs+` Tr
`:an!==-1&&(Nn+=`0 Tr
`),Rs!==-1&&(In.usedRenderingMode=Rs),nr=yt.align||"left";var pn,ts=ht*io,fl=Cr.internal.pageSize.getWidth(),pl=Ci[Yi];$i=yt.charSpace||Rc,Oi=yt.maxWidth||0,qr=Object.assign({autoencode:!0,noBOM:!0},yt.flags);var po=[];if(Object.prototype.toString.call(se)==="[object Array]"){var os;gi=ga(se),nr!=="left"&&(pn=gi.map(function(Lr){return Cr.getStringUnitWidth(Lr,{font:pl,charSpace:$i,fontSize:ht,doKerning:!1})*ht/Mo}));var as,Po=0;if(nr==="right"){Le-=pn[0],se=[],Ds=gi.length;for(var Fo=0;Fo<Ds;Fo++)Fo===0?(as=Lo(Le),os=Xo(ct)):(as=Pe(Po-pn[Fo]),os=-ts),se.push([gi[Fo],as,os]),Po=pn[Fo]}else if(nr==="center"){Le-=pn[0]/2,se=[],Ds=gi.length;for(var ya=0;ya<Ds;ya++)ya===0?(as=Lo(Le),os=Xo(ct)):(as=Pe((Po-pn[ya])/2),os=-ts),se.push([gi[ya],as,os]),Po=pn[ya]}else if(nr==="left"){se=[],Ds=gi.length;for(var gl=0;gl<Ds;gl++)se.push(gi[gl])}else{if(nr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');se=[],Ds=gi.length,Oi=Oi!==0?Oi:fl;for(var ro=0;ro<Ds;ro++)os=ro===0?Xo(ct):-ts,as=ro===0?Lo(Le):0,ro<Ds-1?po.push($e(Pe((Oi-pn[ro])/(gi[ro].split(" ").length-1)))):po.push(0),se.push([gi[ro],as,os])}}var no=typeof yt.R2L=="boolean"?yt.R2L:fi;no===!0&&(se=jl(se,function(Lr,Jr,ln){return[Lr.split("").reverse().join(""),Jr,ln]})),It={text:se,x:Le,y:ct,options:yt,mutex:{pdfEscape:dn,activeFontKey:Yi,fonts:Ci,activeFontSize:ht}},ie.publish("postProcessText",It),se=It.text,Ks=It.mutex.isHex||!1;var go=Ci[Yi].encoding;go!=="WinAnsiEncoding"&&go!=="StandardEncoding"||(se=jl(se,function(Lr,Jr,ln){return[La(Lr),Jr,ln]})),gi=ga(se),se=[];for(var _s,so,Fa,_a=0,Da=1,Ln=Array.isArray(gi[0])?Da:_a,Do="",ds=function(Lr,Jr,ln){var qn="";return ln instanceof xe?(ln=typeof yt.angle=="number"?Fe(ln,new xe(1,0,0,1,Lr,Jr)):Fe(new xe(1,0,0,1,Lr,Jr),ln),ve===fe.ADVANCED&&(ln=Fe(new xe(1,0,0,-1,0,0),ln)),qn=ln.join(" ")+` Tm
`):qn=$e(Lr)+" "+$e(Jr)+` Td
`,qn},vs=0;vs<gi.length;vs++){switch(Do="",Ln){case Da:Fa=(Ks?"<":"(")+gi[vs][0]+(Ks?">":")"),_s=parseFloat(gi[vs][1]),so=parseFloat(gi[vs][2]);break;case _a:Fa=(Ks?"<":"(")+gi[vs]+(Ks?">":")"),_s=Lo(Le),so=Xo(ct)}po!==void 0&&po[vs]!==void 0&&(Do=po[vs]+` Tw
`),vs===0?se.push(Do+ds(_s,so,jn)+Fa):Ln===_a?se.push(Do+Fa):Ln===Da&&se.push(Do+ds(_s,so,jn)+Fa)}se=Ln===_a?se.join(` Tj
T* `):se.join(` Tj
`),se+=` Tj
`;var fs=`BT
/`;return fs+=Yi+" "+ht+` Tf
`,fs+=$e(ht*io)+` TL
`,fs+=Jo+`
`,fs+=Nn,fs+=se,lt(fs+="ET"),D[Yi]=!0,Cr};var Nl=N.__private__.clip=N.clip=function(se){return lt(se==="evenodd"?"W*":"W"),this};N.clipEvenOdd=function(){return Nl("evenodd")},N.__private__.discardPath=N.discardPath=function(){return lt("n"),this};var es=N.__private__.isValidStyle=function(se){var Le=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(se)!==-1&&(Le=!0),Le};N.__private__.setDefaultPathOperation=N.setDefaultPathOperation=function(se){return es(se)&&(b=se),this};var Io=N.__private__.getStyle=N.getStyle=function(se){var Le=b;switch(se){case"D":case"S":Le="S";break;case"F":Le="f";break;case"FD":case"DF":Le="B";break;case"f":case"f*":case"B":case"B*":Le=se}return Le},Xa=N.close=function(){return lt("h"),this};N.stroke=function(){return lt("S"),this},N.fill=function(se){return ys("f",se),this},N.fillEvenOdd=function(se){return ys("f*",se),this},N.fillStroke=function(se){return ys("B",se),this},N.fillStrokeEvenOdd=function(se){return ys("B*",se),this};var ys=function(se,Le){Yn(Le)==="object"?Ia(Le,se):lt(se)},Aa=function(se){se===null||ve===fe.ADVANCED&&se===void 0||(se=Io(se),lt(se))};function Za(se,Le,ct,yt,bt){var It=new Bg(Le||this.boundingBox,ct||this.xStep,yt||this.yStep,this.gState,bt||this.matrix);It.stream=this.stream;var gi=se+"$$"+this.cloneIndex+++"$$";return je(gi,It),It}var Ia=function(se,Le){var ct=Yt[se.key],yt=bi[ct];if(yt instanceof Lf)lt("q"),lt(Dc(Le)),yt.gState&&N.setGState(yt.gState),lt(se.matrix.toString()+" cm"),lt("/"+ct+" sh"),lt("Q");else if(yt instanceof Bg){var bt=new xe(1,0,0,-1,0,to());se.matrix&&(bt=bt.multiply(se.matrix||Ue),ct=Za.call(yt,se.key,se.boundingBox,se.xStep,se.yStep,bt).id),lt("q"),lt("/Pattern cs"),lt("/"+ct+" scn"),yt.gState&&N.setGState(yt.gState),lt(Le),lt("Q")}},Dc=function(se){switch(se){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Ja=N.moveTo=function(se,Le){return lt($e(Pe(se))+" "+$e(Xe(Le))+" m"),this},Ao=N.lineTo=function(se,Le){return lt($e(Pe(se))+" "+$e(Xe(Le))+" l"),this},Fr=N.curveTo=function(se,Le,ct,yt,bt,It){return lt([$e(Pe(se)),$e(Xe(Le)),$e(Pe(ct)),$e(Xe(yt)),$e(Pe(bt)),$e(Xe(It)),"c"].join(" ")),this};N.__private__.line=N.line=function(se,Le,ct,yt,bt){if(isNaN(se)||isNaN(Le)||isNaN(ct)||isNaN(yt)||!es(bt))throw new Error("Invalid arguments passed to jsPDF.line");return ve===fe.COMPAT?this.lines([[ct-se,yt-Le]],se,Le,[1,1],bt||"S"):this.lines([[ct-se,yt-Le]],se,Le,[1,1]).stroke()},N.__private__.lines=N.lines=function(se,Le,ct,yt,bt,It){var gi,ni,nr,$i,Oi,qr,sr,jn,Cr,Mr,Nn,Ks;if(typeof se=="number"&&(Ks=ct,ct=Le,Le=se,se=Ks),yt=yt||[1,1],It=It||!1,isNaN(Le)||isNaN(ct)||!Array.isArray(se)||!Array.isArray(yt)||!es(bt)||typeof It!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ja(Le,ct),gi=yt[0],ni=yt[1],$i=se.length,Mr=Le,Nn=ct,nr=0;nr<$i;nr++)(Oi=se[nr]).length===2?(Mr=Oi[0]*gi+Mr,Nn=Oi[1]*ni+Nn,Ao(Mr,Nn)):(qr=Oi[0]*gi+Mr,sr=Oi[1]*ni+Nn,jn=Oi[2]*gi+Mr,Cr=Oi[3]*ni+Nn,Mr=Oi[4]*gi+Mr,Nn=Oi[5]*ni+Nn,Fr(qr,sr,jn,Cr,Mr,Nn));return It&&Xa(),Aa(bt),this},N.path=function(se){for(var Le=0;Le<se.length;Le++){var ct=se[Le],yt=ct.c;switch(ct.op){case"m":Ja(yt[0],yt[1]);break;case"l":Ao(yt[0],yt[1]);break;case"c":Fr.apply(this,yt);break;case"h":Xa()}}return this},N.__private__.rect=N.rect=function(se,Le,ct,yt,bt){if(isNaN(se)||isNaN(Le)||isNaN(ct)||isNaN(yt)||!es(bt))throw new Error("Invalid arguments passed to jsPDF.rect");return ve===fe.COMPAT&&(yt=-yt),lt([$e(Pe(se)),$e(Xe(Le)),$e(Pe(ct)),$e(Pe(yt)),"re"].join(" ")),Aa(bt),this},N.__private__.triangle=N.triangle=function(se,Le,ct,yt,bt,It,gi){if(isNaN(se)||isNaN(Le)||isNaN(ct)||isNaN(yt)||isNaN(bt)||isNaN(It)||!es(gi))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ct-se,yt-Le],[bt-ct,It-yt],[se-bt,Le-It]],se,Le,[1,1],gi,!0),this},N.__private__.roundedRect=N.roundedRect=function(se,Le,ct,yt,bt,It,gi){if(isNaN(se)||isNaN(Le)||isNaN(ct)||isNaN(yt)||isNaN(bt)||isNaN(It)||!es(gi))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ni=4/3*(Math.SQRT2-1);return bt=Math.min(bt,.5*ct),It=Math.min(It,.5*yt),this.lines([[ct-2*bt,0],[bt*ni,0,bt,It-It*ni,bt,It],[0,yt-2*It],[0,It*ni,-bt*ni,It,-bt,It],[2*bt-ct,0],[-bt*ni,0,-bt,-It*ni,-bt,-It],[0,2*It-yt],[0,-It*ni,bt*ni,-It,bt,-It]],se+bt,Le,[1,1],gi,!0),this},N.__private__.ellipse=N.ellipse=function(se,Le,ct,yt,bt){if(isNaN(se)||isNaN(Le)||isNaN(ct)||isNaN(yt)||!es(bt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var It=4/3*(Math.SQRT2-1)*ct,gi=4/3*(Math.SQRT2-1)*yt;return Ja(se+ct,Le),Fr(se+ct,Le-gi,se+It,Le-yt,se,Le-yt),Fr(se-It,Le-yt,se-ct,Le-gi,se-ct,Le),Fr(se-ct,Le+gi,se-It,Le+yt,se,Le+yt),Fr(se+It,Le+yt,se+ct,Le+gi,se+ct,Le),Aa(bt),this},N.__private__.circle=N.circle=function(se,Le,ct,yt){if(isNaN(se)||isNaN(Le)||isNaN(ct)||!es(yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(se,Le,ct,ct,yt)},N.setFont=function(se,Le,ct){return ct&&(Le=He(Le,ct)),Yi=ze(se,Le,{disableWarning:!1}),this};var da=N.__private__.getFont=N.getFont=function(){return Ci[ze.apply(N,arguments)]};N.__private__.getFontList=N.getFontList=function(){var se,Le,ct={};for(se in Li)if(Li.hasOwnProperty(se))for(Le in ct[se]=[],Li[se])Li[se].hasOwnProperty(Le)&&ct[se].push(Le);return ct},N.addFont=function(se,Le,ct,yt,bt){var It=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&It.indexOf(arguments[3])!==-1?bt=arguments[3]:arguments[3]&&It.indexOf(arguments[3])==-1&&(ct=He(ct,yt)),bt=bt||"Identity-H",Dr.call(this,se,Le,ct,bt)};var As,fn=i.lineWidth||.200025,ss=N.__private__.getLineWidth=N.getLineWidth=function(){return fn},Hr=N.__private__.setLineWidth=N.setLineWidth=function(se){return fn=se,lt($e(Pe(se))+" w"),this};N.__private__.setLineDash=Or.API.setLineDash=Or.API.setLineDashPattern=function(se,Le){if(se=se||[],Le=Le||0,isNaN(Le)||!Array.isArray(se))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return se=se.map(function(ct){return $e(Pe(ct))}).join(" "),Le=$e(Pe(Le)),lt("["+se+"] "+Le+" d"),this};var Ya=N.__private__.getLineHeight=N.getLineHeight=function(){return ht*As};N.__private__.getLineHeight=N.getLineHeight=function(){return ht*As};var ul=N.__private__.setLineHeightFactor=N.setLineHeightFactor=function(se){return typeof(se=se||1.15)=="number"&&(As=se),this},zl=N.__private__.getLineHeightFactor=N.getLineHeightFactor=function(){return As};ul(i.lineHeight);var Lo=N.__private__.getHorizontalCoordinate=function(se){return Pe(se)},Xo=N.__private__.getVerticalCoordinate=function(se){return ve===fe.ADVANCED?se:ae[Ze].mediaBox.topRightY-ae[Ze].mediaBox.bottomLeftY-Pe(se)},fc=N.__private__.getHorizontalCoordinateString=N.getHorizontalCoordinateString=function(se){return $e(Lo(se))},Zo=N.__private__.getVerticalCoordinateString=N.getVerticalCoordinateString=function(se){return $e(Xo(se))},fo=i.strokeColor||"0 G";N.__private__.getStrokeColor=N.getDrawColor=function(){return oi(fo)},N.__private__.setStrokeColor=N.setDrawColor=function(se,Le,ct,yt){return fo=Ei({ch1:se,ch2:Le,ch3:ct,ch4:yt,pdfColorType:"draw",precision:2}),lt(fo),this};var pc=i.fillColor||"0 g";N.__private__.getFillColor=N.getFillColor=function(){return oi(pc)},N.__private__.setFillColor=N.setFillColor=function(se,Le,ct,yt){return pc=Ei({ch1:se,ch2:Le,ch3:ct,ch4:yt,pdfColorType:"fill",precision:2}),lt(pc),this};var Jo=i.textColor||"0 g",Ql=N.__private__.getTextColor=N.getTextColor=function(){return oi(Jo)};N.__private__.setTextColor=N.setTextColor=function(se,Le,ct,yt){return Jo=Ei({ch1:se,ch2:Le,ch3:ct,ch4:yt,pdfColorType:"text",precision:3}),this};var Rc=i.charSpace,bh=N.__private__.getCharSpace=N.getCharSpace=function(){return parseFloat(Rc||0)};N.__private__.setCharSpace=N.setCharSpace=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Rc=se,this};var cu=0;N.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},N.__private__.setLineCap=N.setLineCap=function(se){var Le=N.CapJoinStyles[se];if(Le===void 0)throw new Error("Line cap style of '"+se+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return cu=Le,lt(Le+" J"),this};var uu=0;N.__private__.setLineJoin=N.setLineJoin=function(se){var Le=N.CapJoinStyles[se];if(Le===void 0)throw new Error("Line join style of '"+se+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return uu=Le,lt(Le+" j"),this},N.__private__.setLineMiterLimit=N.__private__.setMiterLimit=N.setLineMiterLimit=N.setMiterLimit=function(se){if(se=se||0,isNaN(se))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return lt($e(Pe(se))+" M"),this},N.GState=ev,N.setGState=function(se){(se=typeof se=="string"?yr[Tr[se]]:ku(null,se)).equals(Qe)||(lt("/"+se.id+" gs"),Qe=se)};var ku=function(se,Le){if(!se||!Tr[se]){var ct=!1;for(var yt in yr)if(yr.hasOwnProperty(yt)&&yr[yt].equals(Le)){ct=!0;break}if(ct)Le=yr[yt];else{var bt="GS"+(Object.keys(yr).length+1).toString(10);yr[bt]=Le,Le.id=bt}return se&&(Tr[se]=Le.id),ie.publish("addGState",Le),Le}};N.addGState=function(se,Le){return ku(se,Le),this},N.saveGraphicsState=function(){return lt("q"),jt.push({key:Yi,size:ht,color:Jo}),this},N.restoreGraphicsState=function(){lt("Q");var se=jt.pop();return Yi=se.key,ht=se.size,Jo=se.color,Qe=null,this},N.setCurrentTransformationMatrix=function(se){return lt(se.toString()+" cm"),this},N.comment=function(se){return lt("#"+se),this};var Vl=function(se,Le){var ct=se||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ct},set:function(It){isNaN(It)||(ct=parseFloat(It))}});var yt=Le||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return yt},set:function(It){isNaN(It)||(yt=parseFloat(It))}});var bt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return bt},set:function(It){bt=It.toString()}}),this},el=function(se,Le,ct,yt){Vl.call(this,se,Le),this.type="rect";var bt=ct||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return bt},set:function(gi){isNaN(gi)||(bt=parseFloat(gi))}});var It=yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return It},set:function(gi){isNaN(gi)||(It=parseFloat(gi))}}),this},tl=function(){this.page=Be,this.currentPage=Ze,this.pages=ri.slice(0),this.pagesContext=ae.slice(0),this.x=Kt,this.y=Ji,this.matrix=Vt,this.width=hl(Ze),this.height=to(Ze),this.outputDestination=yi,this.id="",this.objectNumber=-1};tl.prototype.restore=function(){Be=this.page,Ze=this.currentPage,ae=this.pagesContext,ri=this.pages,Kt=this.x,Ji=this.y,Vt=this.matrix,Gl(Ze,this.width),pa(Ze,this.height),yi=this.outputDestination};var Hl=function(se,Le,ct,yt,bt){Ee.push(new tl),Be=Ze=0,ri=[],Kt=se,Ji=Le,Vt=bt,Gr([ct,yt])},il=function(se){if(be[se])Ee.pop().restore();else{var Le=new tl,ct="Xo"+(Object.keys(me).length+1).toString(10);Le.id=ct,be[se]=ct,me[ct]=Le,ie.publish("addFormObject",Le),Ee.pop().restore()}};for(var fa in N.beginFormObject=function(se,Le,ct,yt,bt){return Hl(se,Le,ct,yt,bt),this},N.endFormObject=function(se){return il(se),this},N.doFormObject=function(se,Le){var ct=me[be[se]];return lt("q"),lt(Le.toString()+" cm"),lt("/"+ct.id+" Do"),lt("Q"),this},N.getFormObject=function(se){var Le=me[be[se]];return{x:Le.x,y:Le.y,width:Le.width,height:Le.height,matrix:Le.matrix}},N.save=function(se,Le){return se=se||"generated.pdf",(Le=Le||{}).returnPromise=Le.returnPromise||!1,Le.returnPromise===!1?(If(Tn(xr()),se),typeof If.unload=="function"&&kr.setTimeout&&setTimeout(If.unload,911),this):new Promise(function(ct,yt){try{var bt=If(Tn(xr()),se);typeof If.unload=="function"&&kr.setTimeout&&setTimeout(If.unload,911),ct(bt)}catch(It){yt(It.message)}})},Or.API)Or.API.hasOwnProperty(fa)&&(fa==="events"&&Or.API.events.length?function(se,Le){var ct,yt,bt;for(bt=Le.length-1;bt!==-1;bt--)ct=Le[bt][0],yt=Le[bt][1],se.subscribe.apply(se,[ct].concat(typeof yt=="function"?[yt]:yt))}(ie,Or.API.events):N[fa]=Or.API[fa]);var hl=N.getPageWidth=function(se){return(ae[se=se||Ze].mediaBox.topRightX-ae[se].mediaBox.bottomLeftX)/ui},Gl=N.setPageWidth=function(se,Le){ae[se].mediaBox.topRightX=Le*ui+ae[se].mediaBox.bottomLeftX},to=N.getPageHeight=function(se){return(ae[se=se||Ze].mediaBox.topRightY-ae[se].mediaBox.bottomLeftY)/ui},pa=N.setPageHeight=function(se,Le){ae[se].mediaBox.topRightY=Le*ui+ae[se].mediaBox.bottomLeftY};return N.internal={pdfEscape:dn,getStyle:Io,getFont:da,getFontSize:si,getCharSpace:bh,getTextColor:Ql,getLineHeight:Ya,getLineHeightFactor:zl,getLineWidth:ss,write:wt,getHorizontalCoordinate:Lo,getVerticalCoordinate:Xo,getCoordinateString:fc,getVerticalCoordinateString:Zo,collections:{},newObject:nt,newAdditionalObject:ei,newObjectDeferred:_t,newObjectDeferredBegin:St,getFilters:Gi,putStream:Bi,events:ie,scaleFactor:ui,pageSize:{getWidth:function(){return hl(Ze)},setWidth:function(se){Gl(Ze,se)},getHeight:function(){return to(Ze)},setHeight:function(se){pa(Ze,se)}},encryptionOptions:S,encryption:Bn,getEncryptor:lu,output:Un,getNumberOfPages:Ta,pages:ri,out:lt,f2:rt,f3:Re,getPageInfo:Ka,getPageInfoByObjId:Ir,getCurrentPageInfo:Wa,getPDFVersion:te,Point:Vl,Rectangle:el,Matrix:xe,hasHotfix:ns},Object.defineProperty(N.internal.pageSize,"width",{get:function(){return hl(Ze)},set:function(se){Gl(Ze,se)},enumerable:!0,configurable:!0}),Object.defineProperty(N.internal.pageSize,"height",{get:function(){return to(Ze)},set:function(se){pa(Ze,se)},enumerable:!0,configurable:!0}),Gn.call(N,ti),Yi="F1",js(n,t),ie.publish("initialized"),N}xg.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},xg.prototype.toHexString=function(i){return i.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},xg.prototype.hexToBytes=function(i){for(var e=[],t=0;t<i.length;t+=2)e.push(String.fromCharCode(parseInt(i.substr(t,2),16)));return e.join("")},xg.prototype.processOwnerPassword=function(i,e){return TC(SC(e).substr(0,5),i)},xg.prototype.encryptor=function(i,e){var t=SC(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return TC(t,r)}},ev.prototype.equals=function(i){var e,t="id,objectNumber,equals";if(!i||Yn(i)!==Yn(this))return!1;var r=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!i.hasOwnProperty(e)||this[e]!==i[e])return!1;r++}for(e in i)i.hasOwnProperty(e)&&t.indexOf(e)<0&&r--;return r===0},Or.API={events:[]},Or.version="2.5.1";var Co=Or.API,IC=1,Mf=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Cg=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Zr=function(i){return i.toFixed(2)},_d=function(i){return i.toFixed(5)};Co.__acroform__={};var Lc=function(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i},T4=function(i){return i*IC},Kh=function(i){var e=new L4,t=ur.internal.getHeight(i)||0,r=ur.internal.getWidth(i)||0;return e.BBox=[0,0,Number(Zr(r)),Number(Zr(t))],e},Xie=Co.__acroform__.setBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<e},Zie=Co.__acroform__.clearBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<e)},Jie=Co.__acroform__.getBit=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<e?1:0},Vo=Co.__acroform__.getBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Jie(i,e-1)},Ho=Co.__acroform__.setBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Xie(i,e-1)},Go=Co.__acroform__.clearBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Zie(i,e-1)},Yie=Co.__acroform__.calculateCoordinates=function(i,e){var t=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,n=i[0],o=i[1],l=i[2],s=i[3],g={};return g.lowerLeft_X=t(n)||0,g.lowerLeft_Y=r(o+s)||0,g.upperRight_X=t(n+l)||0,g.upperRight_Y=r(o)||0,[Number(Zr(g.lowerLeft_X)),Number(Zr(g.lowerLeft_Y)),Number(Zr(g.upperRight_X)),Number(Zr(g.upperRight_Y))]},ere=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var e=[],t=i._V||i.DV,r=LC(i,t),n=i.scope.internal.getFont(i.fontName,i.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(i.scope.__private__.encodeColorString(i.color)),e.push("/"+n+" "+Zr(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=Kh(i);return o.scope=i.scope,o.stream=e.join(`
`),o}},LC=function(i,e){var t=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},n=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");n=i.multiline?n.map(function(Re){return Re.split(`
`)}):n.map(function(Re){return[Re]});var o=t,l=ur.internal.getHeight(i)||0;l=l<0?-l:l;var s=ur.internal.getWidth(i)||0;s=s<0?-s:s;var g=function(Re,Pe,Je){if(Re+1<n.length){var Xe=Pe+" "+n[Re+1][0];return tv(Xe,i,Je).width<=s-4}return!1};o++;e:for(;o>0;){e="",o--;var b,S,F=tv("3",i,o).height,D=i.multiline?l-o:(l-F)/2,N=D+=2,J=0,te=0,he=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+tv(e,i,o=12).width+", FieldWidth:"+s+`
`;break}for(var ue="",fe=0,ve=0;ve<n.length;ve++)if(n.hasOwnProperty(ve)){var Se=!1;if(n[ve].length!==1&&he!==n[ve].length-1){if((F+2)*(fe+2)+2>l)continue e;ue+=n[ve][he],Se=!0,te=ve,ve--}else{ue=(ue+=n[ve][he]+" ").substr(ue.length-1)==" "?ue.substr(0,ue.length-1):ue;var Ge=parseInt(ve),He=g(Ge,ue,o),$e=ve>=n.length-1;if(He&&!$e){ue+=" ",he=0;continue}if(He||$e){if($e)te=Ge;else if(i.multiline&&(F+2)*(fe+2)+2>l)continue e}else{if(!i.multiline||(F+2)*(fe+2)+2>l)continue e;te=Ge}}for(var Ne="",at=J;at<=te;at++){var rt=n[at];if(i.multiline){if(at===te){Ne+=rt[he]+" ",he=(he+1)%rt.length;continue}if(at===J){Ne+=rt[rt.length-1]+" ";continue}}Ne+=rt[0]+" "}switch(Ne=Ne.substr(Ne.length-1)==" "?Ne.substr(0,Ne.length-1):Ne,S=tv(Ne,i,o).width,i.textAlign){case"right":b=s-S-2;break;case"center":b=(s-S)/2;break;case"left":default:b=2}e+=Zr(b)+" "+Zr(N)+` Td
`,e+="("+Mf(Ne)+`) Tj
`,e+=-Zr(b)+` 0 Td
`,N=-(o+2),S=0,J=Se?te:te+1,fe++,ue=""}break}return r.text=e,r.fontSize=o,r},tv=function(i,e,t){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),n=e.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:n}},tre={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},ire=function(i,e){var t={type:"reference",object:i};e.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===t.type&&r.object===t.object})===void 0&&e.internal.getPageInfo(i.page).pageContext.annotations.push(t)},rre=function(i,e){for(var t in i)if(i.hasOwnProperty(t)){var r=t,n=i[t];e.internal.newObjectDeferredBegin(n.objId,!0),Yn(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete i[r]}},nre=function(i,e){if(e.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(ch.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(tre)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");IC=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new M4,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o.objId=void 0,o.hasAnnotation&&ire(o,t)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(t){(function(r,n){var o=!r;for(var l in r||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(l)){var s=r[l],g=[],b=s.Rect;if(s.Rect&&(s.Rect=Yie(s.Rect,n)),n.internal.newObjectDeferredBegin(s.objId,!0),s.DA=ur.createDefaultAppearanceStream(s),Yn(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(g=s.getKeyValueListForStream()),s.Rect=b,s.hasAppearanceStream&&!s.appearanceStreamContent){var S=ere(s);g.push({key:"AP",value:"<</N "+S+">>"}),n.internal.acroformPlugin.xForms.push(S)}if(s.appearanceStreamContent){var F="";for(var D in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(D)){var N=s.appearanceStreamContent[D];if(F+="/"+D+" ",F+="<<",Object.keys(N).length>=1||Array.isArray(N)){for(var l in N)if(N.hasOwnProperty(l)){var J=N[l];typeof J=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J+" ",n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J)}}else typeof(J=N)=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J,n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J);F+=">>"}g.push({key:"AP",value:`<<
`+F+">>"})}n.internal.putStream({additionalKeyValues:g,objectId:s.objId}),n.internal.out("endobj")}o&&rre(n.internal.acroformPlugin.xForms,n)})(t,i)}),i.internal.acroformPlugin.isInitialized=!0}},I4=Co.__acroform__.arrayToPdfArray=function(i,e,t){var r=function(l){return l};if(Array.isArray(i)){for(var n="[",o=0;o<i.length;o++)switch(o!==0&&(n+=" "),Yn(i[o])){case"boolean":case"number":case"object":n+=i[o].toString();break;case"string":i[o].substr(0,1)!=="/"?(e!==void 0&&t&&(r=t.internal.getEncryptor(e)),n+="("+Mf(r(i[o].toString()))+")"):n+=i[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},MC=function(i,e,t){var r=function(n){return n};return e!==void 0&&t&&(r=t.internal.getEncryptor(e)),(i=i||"").toString(),i="("+Mf(r(i))+")"},Wh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Wh.prototype.toString=function(){return this.objId+" 0 R"},Wh.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},Wh.prototype.getKeyValueListForStream=function(){var i=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var r=e[t],n=this[r];n&&(Array.isArray(n)?i.push({key:r,value:I4(n,this.objId,this.scope)}):n instanceof Wh?(n.scope=this.scope,i.push({key:r,value:n.objId+" 0 R"})):typeof n!="function"&&i.push({key:r,value:n}))}return i};var L4=function(){Wh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){i=t.trim()},get:function(){return i||null}})};Lc(L4,Wh);var M4=function(){Wh.call(this);var i,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var t=function(r){return r};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Mf(t(i))+")"}},set:function(t){i=t}})};Lc(M4,Wh);var ch=function i(){Wh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ue){if(isNaN(ue))throw new Error('Invalid value "'+ue+'" for attribute F supplied.');e=ue}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Vo(e,3)},set:function(ue){ue?this.F=Ho(e,3):this.F=Go(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ue){if(isNaN(ue))throw new Error('Invalid value "'+ue+'" for attribute Ff supplied.');t=ue}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(ue){r=ue!==void 0?ue:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(ue){r[0]=ue}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(ue){r[1]=ue}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(ue){r[2]=ue}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(ue){r[3]=ue}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(ue){switch(ue){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=ue;break;default:throw new Error('Invalid value "'+ue+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof nv)return;o="FieldObject"+i.FieldNum++}var ue=function(fe){return fe};return this.scope&&(ue=this.scope.internal.getEncryptor(this.objId)),"("+Mf(ue(o))+")"},set:function(ue){o=ue.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(ue){o=ue}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(ue){l=ue}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ue){s=ue}});var g=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return g},set:function(ue){g=ue}});var b=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return b===void 0?50/IC:b},set:function(ue){b=ue}});var S="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return S},set:function(ue){S=ue}});var F="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!F||this instanceof nv||this instanceof Pf))return MC(F,this.objId,this.scope)},set:function(ue){ue=ue.toString(),F=ue}});var D=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(D)return this instanceof ja?D:MC(D,this.objId,this.scope)},set:function(ue){ue=ue.toString(),D=this instanceof ja?ue:ue.substr(0,1)==="("?Cg(ue.substr(1,ue.length-2)):Cg(ue)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ja?Cg(D.substr(1,D.length-1)):D},set:function(ue){ue=ue.toString(),D=this instanceof ja?"/"+ue:ue}});var N=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(N)return N},set:function(ue){this.V=ue}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(N)return this instanceof ja?N:MC(N,this.objId,this.scope)},set:function(ue){ue=ue.toString(),N=this instanceof ja?ue:ue.substr(0,1)==="("?Cg(ue.substr(1,ue.length-2)):Cg(ue)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ja?Cg(N.substr(1,N.length-1)):N},set:function(ue){ue=ue.toString(),N=this instanceof ja?"/"+ue:ue}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var J,te=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return te},set:function(ue){ue=!!ue,te=ue}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(J)return J},set:function(ue){J=ue}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,1)},set:function(ue){ue?this.Ff=Ho(this.Ff,1):this.Ff=Go(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,2)},set:function(ue){ue?this.Ff=Ho(this.Ff,2):this.Ff=Go(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,3)},set:function(ue){ue?this.Ff=Ho(this.Ff,3):this.Ff=Go(this.Ff,3)}});var he=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(he!==null)return he},set:function(ue){if([0,1,2].indexOf(ue)===-1)throw new Error('Invalid value "'+ue+'" for attribute Q supplied.');he=ue}}),Object.defineProperty(this,"textAlign",{get:function(){var ue;switch(he){case 0:default:ue="left";break;case 1:ue="center";break;case 2:ue="right"}return ue},configurable:!0,enumerable:!0,set:function(ue){switch(ue){case"right":case 2:he=2;break;case"center":case 1:he=1;break;case"left":case 0:default:he=0}}})};Lc(ch,Wh);var Eg=function(){ch.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return I4(e,this.objId,this.scope)},set:function(t){var r,n;n=[],typeof(r=t)=="string"&&(n=function(o,l,s){s||(s=1);for(var g,b=[];g=l.exec(o);)b.push(g[s]);return b}(r,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,18)},set:function(t){t?this.Ff=Ho(this.Ff,18):this.Ff=Go(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Ho(this.Ff,19):this.Ff=Go(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,20)},set:function(t){t?(this.Ff=Ho(this.Ff,20),e.sort()):this.Ff=Go(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,22)},set:function(t){t?this.Ff=Ho(this.Ff,22):this.Ff=Go(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,23)},set:function(t){t?this.Ff=Ho(this.Ff,23):this.Ff=Go(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,27)},set:function(t){t?this.Ff=Ho(this.Ff,27):this.Ff=Go(this.Ff,27)}}),this.hasAppearanceStream=!1};Lc(Eg,ch);var Sg=function(){Eg.call(this),this.fontName="helvetica",this.combo=!1};Lc(Sg,Eg);var Tg=function(){Sg.call(this),this.combo=!0};Lc(Tg,Sg);var iv=function(){Tg.call(this),this.edit=!0};Lc(iv,Tg);var ja=function(){ch.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,15)},set:function(t){t?this.Ff=Ho(this.Ff,15):this.Ff=Go(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,16)},set:function(t){t?this.Ff=Ho(this.Ff,16):this.Ff=Go(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,17)},set:function(t){t?this.Ff=Ho(this.Ff,17):this.Ff=Go(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,26)},set:function(t){t?this.Ff=Ho(this.Ff,26):this.Ff=Go(this.Ff,26)}});var i,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,n=[];for(r in n.push("<<"),e)n.push("/"+r+" ("+Mf(t(e[r]))+")");return n.push(">>"),n.join(`
`)}},set:function(t){Yn(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}})};Lc(ja,ch);var rv=function(){ja.call(this),this.pushButton=!0};Lc(rv,ja);var Ig=function(){ja.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e!==void 0?e:[]}})};Lc(Ig,ja);var nv=function(){var i,e;ch.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){i=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(n){e=n}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(s){return s};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,l=[];for(o in l.push("<<"),r)l.push("/"+o+" ("+Mf(n(r[o]))+")");return l.push(">>"),l.join(`
`)},set:function(n){Yn(n)==="object"&&(r=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(n){typeof n=="string"&&(r.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=ur.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Lc(nv,ch),Ig.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=i.createAppearanceStream(t.optionName),t.caption=i.getCA()}},Ig.prototype.createOption=function(i){var e=new nv;return e.Parent=this,e.optionName=i,this.Kids.push(e),sre.call(this.scope,e),e};var sv=function(){ja.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=ur.CheckBox.createAppearanceStream()};Lc(sv,ja);var Pf=function(){ch.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,13)},set:function(e){e?this.Ff=Ho(this.Ff,13):this.Ff=Go(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,21)},set:function(e){e?this.Ff=Ho(this.Ff,21):this.Ff=Go(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,23)},set:function(e){e?this.Ff=Ho(this.Ff,23):this.Ff=Go(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,24)},set:function(e){e?this.Ff=Ho(this.Ff,24):this.Ff=Go(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,25)},set:function(e){e?this.Ff=Ho(this.Ff,25):this.Ff=Go(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,26)},set:function(e){e?this.Ff=Ho(this.Ff,26):this.Ff=Go(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){Number.isInteger(e)&&(i=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Lc(Pf,ch);var ov=function(){Pf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Vo(this.Ff,14)},set:function(i){i?this.Ff=Ho(this.Ff,14):this.Ff=Go(this.Ff,14)}}),this.password=!0};Lc(ov,Pf);var ur={CheckBox:{createAppearanceStream:function(){return{N:{On:ur.CheckBox.YesNormal},D:{On:ur.CheckBox.YesPushDown,Off:ur.CheckBox.OffPushDown}}},YesPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),o=LC(i,i.caption);return t.push("0.749023 g"),t.push("0 0 "+Zr(ur.internal.getWidth(i))+" "+Zr(ur.internal.getHeight(i))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+r+" "+Zr(o.fontSize)+" Tf "+n),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(i){var e=Kh(i);e.scope=i.scope;var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),n=[],o=ur.internal.getHeight(i),l=ur.internal.getWidth(i),s=LC(i,i.caption);return n.push("1 g"),n.push("0 0 "+Zr(l)+" "+Zr(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Zr(l-1)+" "+Zr(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+t+" "+Zr(s.fontSize)+" Tf "+r),n.push(s.text),n.push("ET"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Zr(ur.internal.getWidth(i))+" "+Zr(ur.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(i){var e={D:{Off:ur.RadioButton.Circle.OffPushDown},N:{}};return e.N[i]=ur.RadioButton.Circle.YesNormal,e.D[i]=ur.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(i){var e=Kh(i);e.scope=i.scope;var t=[],r=ur.internal.getWidth(i)<=ur.internal.getHeight(i)?ur.internal.getWidth(i)/4:ur.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=ur.internal.Bezier_C,o=Number((r*n).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+_d(ur.internal.getWidth(i)/2)+" "+_d(ur.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=[],r=ur.internal.getWidth(i)<=ur.internal.getHeight(i)?ur.internal.getWidth(i)/4:ur.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*ur.internal.Bezier_C).toFixed(5)),l=Number((r*ur.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+_d(ur.internal.getWidth(i)/2)+" "+_d(ur.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+_d(ur.internal.getWidth(i)/2)+" "+_d(ur.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+l+" "+l+" "+r+" 0 "+r+" c"),t.push("-"+l+" "+r+" -"+r+" "+l+" -"+r+" 0 c"),t.push("-"+r+" -"+l+" -"+l+" -"+r+" 0 -"+r+" c"),t.push(l+" -"+r+" "+r+" -"+l+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=[],r=ur.internal.getWidth(i)<=ur.internal.getHeight(i)?ur.internal.getWidth(i)/4:ur.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*ur.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+_d(ur.internal.getWidth(i)/2)+" "+_d(ur.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(i){var e={D:{Off:ur.RadioButton.Cross.OffPushDown},N:{}};return e.N[i]=ur.RadioButton.Cross.YesNormal,e.D[i]=ur.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(i){var e=Kh(i);e.scope=i.scope;var t=[],r=ur.internal.calculateCross(i);return t.push("q"),t.push("1 1 "+Zr(ur.internal.getWidth(i)-2)+" "+Zr(ur.internal.getHeight(i)-2)+" re"),t.push("W"),t.push("n"),t.push(Zr(r.x1.x)+" "+Zr(r.x1.y)+" m"),t.push(Zr(r.x2.x)+" "+Zr(r.x2.y)+" l"),t.push(Zr(r.x4.x)+" "+Zr(r.x4.y)+" m"),t.push(Zr(r.x3.x)+" "+Zr(r.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=ur.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Zr(ur.internal.getWidth(i))+" "+Zr(ur.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Zr(ur.internal.getWidth(i)-2)+" "+Zr(ur.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Zr(t.x1.x)+" "+Zr(t.x1.y)+" m"),r.push(Zr(t.x2.x)+" "+Zr(t.x2.y)+" l"),r.push(Zr(t.x4.x)+" "+Zr(t.x4.y)+" m"),r.push(Zr(t.x3.x)+" "+Zr(t.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(i){var e=Kh(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Zr(ur.internal.getWidth(i))+" "+Zr(ur.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(i){var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,t=i.scope.__private__.encodeColorString(i.color);return"/"+e+" "+i.fontSize+" Tf "+t}};ur.internal={Bezier_C:.551915024494,calculateCross:function(i){var e=ur.internal.getWidth(i),t=ur.internal.getHeight(i),r=Math.min(e,t);return{x1:{x:(e-r)/2,y:(t-r)/2+r},x2:{x:(e-r)/2+r,y:(t-r)/2},x3:{x:(e-r)/2,y:(t-r)/2},x4:{x:(e-r)/2+r,y:(t-r)/2+r}}}},ur.internal.getWidth=function(i){var e=0;return Yn(i)==="object"&&(e=T4(i.Rect[2])),e},ur.internal.getHeight=function(i){var e=0;return Yn(i)==="object"&&(e=T4(i.Rect[3])),e};var sre=Co.addField=function(i){if(nre(this,i),!(i instanceof ch))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=i).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Co.AcroFormChoiceField=Eg,Co.AcroFormListBox=Sg,Co.AcroFormComboBox=Tg,Co.AcroFormEditBox=iv,Co.AcroFormButton=ja,Co.AcroFormPushButton=rv,Co.AcroFormRadioButton=Ig,Co.AcroFormCheckBox=sv,Co.AcroFormTextField=Pf,Co.AcroFormPasswordField=ov,Co.AcroFormAppearance=ur,Co.AcroForm={ChoiceField:Eg,ListBox:Sg,ComboBox:Tg,EditBox:iv,Button:ja,PushButton:rv,RadioButton:Ig,CheckBox:sv,TextField:Pf,PasswordField:ov,Appearance:ur},Or.AcroForm={ChoiceField:Eg,ListBox:Sg,ComboBox:Tg,EditBox:iv,Button:ja,PushButton:rv,RadioButton:Ig,CheckBox:sv,TextField:Pf,PasswordField:ov,Appearance:ur};function P4(i){return i.reduce(function(e,t,r){return e[t]=r,e},{})}(function(i){i.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(Re,Pe){var Je,Xe,Ct,Et,Mt,vt=e;if((Pe=Pe||e)==="RGBA"||Re.data!==void 0&&Re.data instanceof Uint8ClampedArray&&"height"in Re&&"width"in Re)return"RGBA";if(He(Re))for(Mt in t)for(Ct=t[Mt],Je=0;Je<Ct.length;Je+=1){for(Et=!0,Xe=0;Xe<Ct[Je].length;Xe+=1)if(Ct[Je][Xe]!==void 0&&Ct[Je][Xe]!==Re[Xe]){Et=!1;break}if(Et===!0){vt=Mt;break}}else for(Mt in t)for(Ct=t[Mt],Je=0;Je<Ct.length;Je+=1){for(Et=!0,Xe=0;Xe<Ct[Je].length;Xe+=1)if(Ct[Je][Xe]!==void 0&&Ct[Je][Xe]!==Re.charCodeAt(Xe)){Et=!1;break}if(Et===!0){vt=Mt;break}}return vt===e&&Pe!==e&&(vt=Pe),vt},n=function Re(Pe){for(var Je=this.internal.write,Xe=this.internal.putStream,Ct=(0,this.internal.getFilters)();Ct.indexOf("FlateEncode")!==-1;)Ct.splice(Ct.indexOf("FlateEncode"),1);Pe.objectId=this.internal.newObject();var Et=[];if(Et.push({key:"Type",value:"/XObject"}),Et.push({key:"Subtype",value:"/Image"}),Et.push({key:"Width",value:Pe.width}),Et.push({key:"Height",value:Pe.height}),Pe.colorSpace===he.INDEXED?Et.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(Pe.palette.length/3-1)+" "+("sMask"in Pe&&Pe.sMask!==void 0?Pe.objectId+2:Pe.objectId+1)+" 0 R]"}):(Et.push({key:"ColorSpace",value:"/"+Pe.colorSpace}),Pe.colorSpace===he.DEVICE_CMYK&&Et.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Et.push({key:"BitsPerComponent",value:Pe.bitsPerComponent}),"decodeParameters"in Pe&&Pe.decodeParameters!==void 0&&Et.push({key:"DecodeParms",value:"<<"+Pe.decodeParameters+">>"}),"transparency"in Pe&&Array.isArray(Pe.transparency)){for(var Mt="",vt=0,Dt=Pe.transparency.length;vt<Dt;vt++)Mt+=Pe.transparency[vt]+" "+Pe.transparency[vt]+" ";Et.push({key:"Mask",value:"["+Mt+"]"})}Pe.sMask!==void 0&&Et.push({key:"SMask",value:Pe.objectId+1+" 0 R"});var Pt=Pe.filter!==void 0?["/"+Pe.filter]:void 0;if(Xe({data:Pe.data,additionalKeyValues:Et,alreadyAppliedFilters:Pt,objectId:Pe.objectId}),Je("endobj"),"sMask"in Pe&&Pe.sMask!==void 0){var Xt="/Predictor "+Pe.predictor+" /Colors 1 /BitsPerComponent "+Pe.bitsPerComponent+" /Columns "+Pe.width,Te={width:Pe.width,height:Pe.height,colorSpace:"DeviceGray",bitsPerComponent:Pe.bitsPerComponent,decodeParameters:Xt,data:Pe.sMask};"filter"in Pe&&(Te.filter=Pe.filter),Re.call(this,Te)}if(Pe.colorSpace===he.INDEXED){var Ze=this.internal.newObject();Xe({data:Ne(new Uint8Array(Pe.palette)),objectId:Ze}),Je("endobj")}},o=function(){var Re=this.internal.collections.addImage_images;for(var Pe in Re)n.call(this,Re[Pe])},l=function(){var Re,Pe=this.internal.collections.addImage_images,Je=this.internal.write;for(var Xe in Pe)Je("/I"+(Re=Pe[Xe]).index,Re.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},g=function(){var Re=this.internal.collections.addImage_images;return s.call(this),Re},b=function(){return Object.keys(this.internal.collections.addImage_images).length},S=function(Re){return typeof i["process"+Re.toUpperCase()]=="function"},F=function(Re){return Yn(Re)==="object"&&Re.nodeType===1},D=function(Re,Pe){if(Re.nodeName==="IMG"&&Re.hasAttribute("src")){var Je=""+Re.getAttribute("src");if(Je.indexOf("data:image/")===0)return Vy(unescape(Je).split("base64,").pop());var Xe=i.loadFile(Je,!0);if(Xe!==void 0)return Xe}if(Re.nodeName==="CANVAS"){if(Re.width===0||Re.height===0)throw new Error("Given canvas must have data. Canvas width: "+Re.width+", height: "+Re.height);var Ct;switch(Pe){case"PNG":Ct="image/png";break;case"WEBP":Ct="image/webp";break;case"JPEG":case"JPG":default:Ct="image/jpeg"}return Vy(Re.toDataURL(Ct,1).split("base64,").pop())}},N=function(Re){var Pe=this.internal.collections.addImage_images;if(Pe){for(var Je in Pe)if(Re===Pe[Je].alias)return Pe[Je]}},J=function(Re,Pe,Je){return Re||Pe||(Re=-96,Pe=-96),Re<0&&(Re=-1*Je.width*72/Re/this.internal.scaleFactor),Pe<0&&(Pe=-1*Je.height*72/Pe/this.internal.scaleFactor),Re===0&&(Re=Pe*Je.width/Je.height),Pe===0&&(Pe=Re*Je.height/Je.width),[Re,Pe]},te=function(Re,Pe,Je,Xe,Ct,Et){var Mt=J.call(this,Je,Xe,Ct),vt=this.internal.getCoordinateString,Dt=this.internal.getVerticalCoordinateString,Pt=g.call(this);if(Je=Mt[0],Xe=Mt[1],Pt[Ct.index]=Ct,Et){Et*=Math.PI/180;var Xt=Math.cos(Et),Te=Math.sin(Et),Ze=function(dt){return dt.toFixed(4)},tt=[Ze(Xt),Ze(Te),Ze(-1*Te),Ze(Xt),0,0,"cm"]}this.internal.write("q"),Et?(this.internal.write([1,"0","0",1,vt(Re),Dt(Pe+Xe),"cm"].join(" ")),this.internal.write(tt.join(" ")),this.internal.write([vt(Je),"0","0",vt(Xe),"0","0","cm"].join(" "))):this.internal.write([vt(Je),"0","0",vt(Xe),vt(Re),Dt(Pe+Xe),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ct.index+" Do"),this.internal.write("Q")},he=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ue=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},fe=i.__addimage__.sHashCode=function(Re){var Pe,Je,Xe=0;if(typeof Re=="string")for(Je=Re.length,Pe=0;Pe<Je;Pe++)Xe=(Xe<<5)-Xe+Re.charCodeAt(Pe),Xe|=0;else if(He(Re))for(Je=Re.byteLength/2,Pe=0;Pe<Je;Pe++)Xe=(Xe<<5)-Xe+Re[Pe],Xe|=0;return Xe},ve=i.__addimage__.validateStringAsBase64=function(Re){(Re=Re||"").toString().trim();var Pe=!0;return Re.length===0&&(Pe=!1),Re.length%4!=0&&(Pe=!1),/^[A-Za-z0-9+/]+$/.test(Re.substr(0,Re.length-2))===!1&&(Pe=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(Re.substr(-2))===!1&&(Pe=!1),Pe},Se=i.__addimage__.extractImageFromDataUrl=function(Re){var Pe=(Re=Re||"").split("base64,"),Je=null;if(Pe.length===2){var Xe=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(Pe[0]);Array.isArray(Xe)&&(Je={mimeType:Xe[1],charset:Xe[2],data:Pe[1]})}return Je},Ge=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(Re){return Ge()&&Re instanceof ArrayBuffer};var He=i.__addimage__.isArrayBufferView=function(Re){return Ge()&&typeof Uint32Array<"u"&&(Re instanceof Int8Array||Re instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&Re instanceof Uint8ClampedArray||Re instanceof Int16Array||Re instanceof Uint16Array||Re instanceof Int32Array||Re instanceof Uint32Array||Re instanceof Float32Array||Re instanceof Float64Array)},$e=i.__addimage__.binaryStringToUint8Array=function(Re){for(var Pe=Re.length,Je=new Uint8Array(Pe),Xe=0;Xe<Pe;Xe++)Je[Xe]=Re.charCodeAt(Xe);return Je},Ne=i.__addimage__.arrayBufferToBinaryString=function(Re){for(var Pe="",Je=He(Re)?Re:new Uint8Array(Re),Xe=0;Xe<Je.length;Xe+=8192)Pe+=String.fromCharCode.apply(null,Je.subarray(Xe,Xe+8192));return Pe};i.addImage=function(){var Re,Pe,Je,Xe,Ct,Et,Mt,vt,Dt;if(typeof arguments[1]=="number"?(Pe=e,Je=arguments[1],Xe=arguments[2],Ct=arguments[3],Et=arguments[4],Mt=arguments[5],vt=arguments[6],Dt=arguments[7]):(Pe=arguments[1],Je=arguments[2],Xe=arguments[3],Ct=arguments[4],Et=arguments[5],Mt=arguments[6],vt=arguments[7],Dt=arguments[8]),Yn(Re=arguments[0])==="object"&&!F(Re)&&"imageData"in Re){var Pt=Re;Re=Pt.imageData,Pe=Pt.format||Pe||e,Je=Pt.x||Je||0,Xe=Pt.y||Xe||0,Ct=Pt.w||Pt.width||Ct,Et=Pt.h||Pt.height||Et,Mt=Pt.alias||Mt,vt=Pt.compression||vt,Dt=Pt.rotation||Pt.angle||Dt}var Xt=this.internal.getFilters();if(vt===void 0&&Xt.indexOf("FlateEncode")!==-1&&(vt="SLOW"),isNaN(Je)||isNaN(Xe))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var Te=at.call(this,Re,Pe,Mt,vt);return te.call(this,Je,Xe,Ct,Et,Te,Dt),this};var at=function(Re,Pe,Je,Xe){var Ct,Et,Mt;if(typeof Re=="string"&&r(Re)===e){Re=unescape(Re);var vt=rt(Re,!1);(vt!==""||(vt=i.loadFile(Re,!0))!==void 0)&&(Re=vt)}if(F(Re)&&(Re=D(Re,Pe)),Pe=r(Re,Pe),!S(Pe))throw new Error("addImage does not support files of type '"+Pe+"', please ensure that a plugin for '"+Pe+"' support is added.");if(((Mt=Je)==null||Mt.length===0)&&(Je=function(Dt){return typeof Dt=="string"||He(Dt)?fe(Dt):He(Dt.data)?fe(Dt.data):null}(Re)),(Ct=N.call(this,Je))||(Ge()&&(Re instanceof Uint8Array||Pe==="RGBA"||(Et=Re,Re=$e(Re))),Ct=this["process"+Pe.toUpperCase()](Re,b.call(this),Je,function(Dt){return Dt&&typeof Dt=="string"&&(Dt=Dt.toUpperCase()),Dt in i.image_compression?Dt:ue.NONE}(Xe),Et)),!Ct)throw new Error("An unknown error occurred whilst processing the image.");return Ct},rt=i.__addimage__.convertBase64ToBinaryString=function(Re,Pe){var Je;Pe=typeof Pe!="boolean"||Pe;var Xe,Ct="";if(typeof Re=="string"){Xe=(Je=Se(Re))!==null?Je.data:Re;try{Ct=Vy(Xe)}catch(Et){if(Pe)throw ve(Xe)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Et.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ct};i.getImageProperties=function(Re){var Pe,Je,Xe="";if(F(Re)&&(Re=D(Re)),typeof Re=="string"&&r(Re)===e&&((Xe=rt(Re,!1))===""&&(Xe=i.loadFile(Re)||""),Re=Xe),Je=r(Re),!S(Je))throw new Error("addImage does not support files of type '"+Je+"', please ensure that a plugin for '"+Je+"' support is added.");if(!Ge()||Re instanceof Uint8Array||(Re=$e(Re)),!(Pe=this["process"+Je.toUpperCase()](Re)))throw new Error("An unknown error occurred whilst processing the image");return Pe.fileType=Je,Pe}})(Or.API),function(i){var e=function(t){if(t!==void 0&&t!="")return!0};Or.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(t){for(var r,n,o,l=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,g=this.internal.getPageInfoByObjId(t.objId),b=t.pageContext.annotations,S=!1,F=0;F<b.length&&!S;F++)switch((r=b[F]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(S=!0);break;case"reference":case"text":case"freetext":S=!0}if(S!=0){this.internal.write("/Annots [");for(var D=0;D<b.length;D++){r=b[D];var N=this.internal.pdfEscape,J=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var te=this.internal.newAdditionalObject(),he=this.internal.newAdditionalObject(),ue=this.internal.getEncryptor(te.objId),fe=r.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y)+"] ")+"/Contents ("+N(ue(r.contents))+")",o+=" /Popup "+he.objId+" 0 R",o+=" /P "+g.objId+" 0 R",o+=" /T ("+N(ue(fe))+") >>",te.content=o;var ve=te.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+l(r.bounds.x+30)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w+30)+" "+s(r.bounds.y)+"] ")+" /Parent "+ve,r.open&&(o+=" /Open true"),o+=" >>",he.content=o,this.internal.write(te.objId,"0 R",he.objId,"0 R");break;case"freetext":n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y+r.bounds.h)+"] ";var Se=r.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+N(J(r.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Se+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(r.options.name){var Ge=this.annotations._nameMap[r.options.name];r.options.pageNumber=Ge.page,r.options.top=Ge.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",o="",r.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+N(J(r.options.url))+") >>";else if(r.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,o+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var He=s(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),o+=" /XYZ "+r.options.left+" "+He+" "+r.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),i.createAnnotation=function(t){var r=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":r.pageContext.annotations.push(t)}},i.link=function(t,r,n,o,l){var s=this.internal.getCurrentPageInfo(),g=this.internal.getCoordinateString,b=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:g(t),y:b(r),w:g(t+n),h:b(r+o)},options:l,type:"link"})},i.textWithLink=function(t,r,n,o){var l,s,g=this.getTextWidth(t),b=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){s=o.maxWidth;var S=this.splitTextToSize(t,s).length;l=Math.ceil(b*S)}else s=g,l=b;return this.text(t,r,n,o),n+=.2*b,o.align==="center"&&(r-=g/2),o.align==="right"&&(r-=g),this.link(r,n-b,s,l,o),g},i.getTextWidth=function(t){var r=this.internal.getFontSize();return this.getStringUnitWidth(t)*r/this.internal.scaleFactor}}(Or.API),function(i){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];i.__arabicParser__={};var o=i.__arabicParser__.isInArabicSubstitutionA=function(te){return e[te.charCodeAt(0)]!==void 0},l=i.__arabicParser__.isArabicLetter=function(te){return typeof te=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(te)},s=i.__arabicParser__.isArabicEndLetter=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length<=2},g=i.__arabicParser__.isArabicAlfLetter=function(te){return l(te)&&n.indexOf(te.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=1};var b=i.__arabicParser__.arabicLetterHasFinalForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=3};var S=i.__arabicParser__.arabicLetterHasMedialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length==4},F=i.__arabicParser__.resolveLigatures=function(te){var he=0,ue=t,fe="",ve=0;for(he=0;he<te.length;he+=1)ue[te.charCodeAt(he)]!==void 0?(ve++,typeof(ue=ue[te.charCodeAt(he)])=="number"&&(fe+=String.fromCharCode(ue),ue=t,ve=0),he===te.length-1&&(ue=t,fe+=te.charAt(he-(ve-1)),he-=ve-1,ve=0)):(ue=t,fe+=te.charAt(he-ve),he-=ve,ve=0);return fe};i.__arabicParser__.isArabicDiacritic=function(te){return te!==void 0&&r[te.charCodeAt(0)]!==void 0};var D=i.__arabicParser__.getCorrectForm=function(te,he,ue){return l(te)?o(te)===!1?-1:!b(te)||!l(he)&&!l(ue)||!l(ue)&&s(he)||s(te)&&!l(he)||s(te)&&g(he)||s(te)&&s(he)?0:S(te)&&l(he)&&!s(he)&&l(ue)&&b(ue)?3:s(te)||!l(ue)?1:2:-1},N=function(te){var he=0,ue=0,fe=0,ve="",Se="",Ge="",He=(te=te||"").split("\\s+"),$e=[];for(he=0;he<He.length;he+=1){for($e.push(""),ue=0;ue<He[he].length;ue+=1)ve=He[he][ue],Se=He[he][ue-1],Ge=He[he][ue+1],l(ve)?(fe=D(ve,Se,Ge),$e[he]+=fe!==-1?String.fromCharCode(e[ve.charCodeAt(0)][fe]):ve):$e[he]+=ve;$e[he]=F($e[he])}return $e.join(" ")},J=i.__arabicParser__.processArabic=i.processArabic=function(){var te,he=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ue=[];if(Array.isArray(he)){var fe=0;for(ue=[],fe=0;fe<he.length;fe+=1)Array.isArray(he[fe])?ue.push([N(he[fe][0]),he[fe][1],he[fe][2]]):ue.push([N(he[fe])]);te=ue}else te=N(he);return typeof arguments[0]=="string"?te:(arguments[0].text=te,arguments[0])};i.events.push(["preProcessText",J])}(Or.API),Or.API.autoPrint=function(i){var e;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(i){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(s){t=s}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(s){r=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(s){n=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(s){o=s}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(s){l=s}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,r){var n;if((t=t||"2d")!=="2d")return null;for(n in r)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=r[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Or.API),function(i){var e={left:0,top:0,bottom:0,right:0},t=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var g=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return g},set:function(te){g=te}});var b=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return b},set:function(te){b=te}});var S=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return S},set:function(te){S=te}});var F=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return F},set:function(te){F=te}});var D=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return D},set:function(te){D=te}});var N=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return N},set:function(te){N=te}});var J=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return J},set:function(te){J=te}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(g){return r.call(this),this.internal.__cell__.headerFunction=typeof g=="function"?g:void 0,this},i.getTextDimensions=function(g,b){r.call(this);var S=(b=b||{}).fontSize||this.getFontSize(),F=b.font||this.getFont(),D=b.scaleFactor||this.internal.scaleFactor,N=0,J=0,te=0,he=this;if(!Array.isArray(g)&&typeof g!="string"){if(typeof g!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");g=String(g)}var ue=b.maxWidth;ue>0?typeof g=="string"?g=this.splitTextToSize(g,ue):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(ve,Se){return ve.concat(he.splitTextToSize(Se,ue))},[])):g=Array.isArray(g)?g:[g];for(var fe=0;fe<g.length;fe++)N<(te=this.getStringUnitWidth(g[fe],{font:F})*S)&&(N=te);return N!==0&&(J=g.length),{w:N/=D,h:Math.max((J*S*this.getLineHeightFactor()-S*(this.getLineHeightFactor()-1))/D,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var g=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(g.left,g.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=i.cell=function(){var g;g=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var b=this.internal.__cell__.lastCell,S=this.internal.__cell__.padding,F=this.internal.__cell__.margins||e,D=this.internal.__cell__.tableHeaderRow,N=this.internal.__cell__.printHeaders;return b.lineNumber!==void 0&&(b.lineNumber===g.lineNumber?(g.x=(b.x||0)+(b.width||0),g.y=b.y||0):b.y+b.height+g.height+F.bottom>this.getPageHeight()?(this.cellAddPage(),g.y=F.top,N&&D&&(this.printHeaderRow(g.lineNumber,!0),g.y+=D[0].height)):g.y=b.y+b.height||g.y),g.text[0]!==void 0&&(this.rect(g.x,g.y,g.width,g.height,t===!0?"FD":void 0),g.align==="right"?this.text(g.text,g.x+g.width-S,g.y+S,{align:"right",baseline:"top"}):g.align==="center"?this.text(g.text,g.x+g.width/2,g.y+S,{align:"center",baseline:"top",maxWidth:g.width-S-S}):this.text(g.text,g.x+S,g.y+S,{align:"left",baseline:"top",maxWidth:g.width-S-S})),this.internal.__cell__.lastCell=g,this};i.table=function(g,b,S,F,D){if(r.call(this),!S)throw new Error("No data for PDF table.");var N,J,te,he,ue=[],fe=[],ve=[],Se={},Ge={},He=[],$e=[],Ne=(D=D||{}).autoSize||!1,at=D.printHeaders!==!1,rt=D.css&&D.css["font-size"]!==void 0?16*D.css["font-size"]:D.fontSize||12,Re=D.margins||Object.assign({width:this.getPageWidth()},e),Pe=typeof D.padding=="number"?D.padding:3,Je=D.headerBackgroundColor||"#c8c8c8",Xe=D.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=at,this.internal.__cell__.margins=Re,this.internal.__cell__.table_font_size=rt,this.internal.__cell__.padding=Pe,this.internal.__cell__.headerBackgroundColor=Je,this.internal.__cell__.headerTextColor=Xe,this.setFontSize(rt),F==null)fe=ue=Object.keys(S[0]),ve=ue.map(function(){return"left"});else if(Array.isArray(F)&&Yn(F[0])==="object")for(ue=F.map(function(Pt){return Pt.name}),fe=F.map(function(Pt){return Pt.prompt||Pt.name||""}),ve=F.map(function(Pt){return Pt.align||"left"}),N=0;N<F.length;N+=1)Ge[F[N].name]=F[N].width*(19.049976/25.4);else Array.isArray(F)&&typeof F[0]=="string"&&(fe=ue=F,ve=ue.map(function(){return"left"}));if(Ne||Array.isArray(F)&&typeof F[0]=="string")for(N=0;N<ue.length;N+=1){for(Se[he=ue[N]]=S.map(function(Pt){return Pt[he]}),this.setFont(void 0,"bold"),He.push(this.getTextDimensions(fe[N],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),J=Se[he],this.setFont(void 0,"normal"),te=0;te<J.length;te+=1)He.push(this.getTextDimensions(J[te],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ge[he]=Math.max.apply(null,He)+Pe+Pe,He=[]}if(at){var Ct={};for(N=0;N<ue.length;N+=1)Ct[ue[N]]={},Ct[ue[N]].text=fe[N],Ct[ue[N]].align=ve[N];var Et=s.call(this,Ct,Ge);$e=ue.map(function(Pt){return new o(g,b,Ge[Pt],Et,Ct[Pt].text,void 0,Ct[Pt].align)}),this.setTableHeaderRow($e),this.printHeaderRow(1,!1)}var Mt=F.reduce(function(Pt,Xt){return Pt[Xt.name]=Xt.align,Pt},{});for(N=0;N<S.length;N+=1){"rowStart"in D&&D.rowStart instanceof Function&&D.rowStart({row:N,data:S[N]},this);var vt=s.call(this,S[N],Ge);for(te=0;te<ue.length;te+=1){var Dt=S[N][ue[te]];"cellStart"in D&&D.cellStart instanceof Function&&D.cellStart({row:N,col:te,data:Dt},this),l.call(this,new o(g,b,Ge[ue[te]],vt,Dt,N+2,Mt[ue[te]]))}}return this.internal.__cell__.table_x=g,this.internal.__cell__.table_y=b,this};var s=function(g,b){var S=this.internal.__cell__.padding,F=this.internal.__cell__.table_font_size,D=this.internal.scaleFactor;return Object.keys(g).map(function(N){var J=g[N];return this.splitTextToSize(J.hasOwnProperty("text")?J.text:J,b[N]-S-S)},this).map(function(N){return this.getLineHeightFactor()*N.length*F/D+S+S},this).reduce(function(N,J){return Math.max(N,J)},0)};i.setTableHeaderRow=function(g){r.call(this),this.internal.__cell__.tableHeaderRow=g},i.printHeaderRow=function(g,b){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var S;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var F=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(F[0],F[1],F[2],F[3],void 0,-1)}this.setFont(void 0,"bold");for(var D=[],N=0;N<this.internal.__cell__.tableHeaderRow.length;N+=1){S=this.internal.__cell__.tableHeaderRow[N].clone(),b&&(S.y=this.internal.__cell__.margins.top||0,D.push(S)),S.lineNumber=g;var J=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,S),this.setTextColor(J)}D.length>0&&this.setTableHeaderRow(D),this.setFont(void 0,"normal"),t=!1}}(Or.API);var F4={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},D4=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],PC=P4(D4),R4=[100,200,300,400,500,600,700,800,900],ore=P4(R4);function FC(i){var e=i.family.replace(/"|'/g,"").toLowerCase(),t=function(o){return F4[o=o||"normal"]?o:"normal"}(i.style),r=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(i.weight),n=function(o){return typeof PC[o=o||"normal"]=="number"?o:"normal"}(i.stretch);return{family:e,style:t,weight:r,stretch:n,src:i.src||[],ref:i.ref||{name:e,style:[n,t,r].join(" ")}}}function k4(i,e,t,r){var n;for(n=t;n>=0&&n<e.length;n+=r)if(i[e[n]])return i[e[n]];for(n=t;n>=0&&n<e.length;n-=r)if(i[e[n]])return i[e[n]]}var are={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},O4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function U4(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function lre(i,e,t){for(var r=(t=t||{}).defaultFontFamily||"times",n=Object.assign({},are,t.genericFontFamilies||{}),o=null,l=null,s=0;s<e.length;++s)if(n[(o=FC(e[s])).family]&&(o.family=n[o.family]),i.hasOwnProperty(o.family)){l=i[o.family];break}if(!(l=l||i[r]))throw new Error("Could not find a font-family for the rule '"+U4(o)+"' and default family '"+r+"'.");if(l=function(g,b){if(b[g])return b[g];var S=PC[g],F=S<=PC.normal?-1:1,D=k4(b,D4,S,F);if(!D)throw new Error("Could not find a matching font-stretch value for "+g);return D}(o.stretch,l),l=function(g,b){if(b[g])return b[g];for(var S=F4[g],F=0;F<S.length;++F)if(b[S[F]])return b[S[F]];throw new Error("Could not find a matching font-style for "+g)}(o.style,l),!(l=function(g,b){if(b[g])return b[g];if(g===400&&b[500])return b[500];if(g===500&&b[400])return b[400];var S=ore[g],F=k4(b,R4,S,g<400?-1:1);if(!F)throw new Error("Could not find a matching font-weight for value "+g);return F}(o.weight,l)))throw new Error("Failed to resolve a font for the rule '"+U4(o)+"'.");return l}function N4(i){return i.trimLeft()}function cre(i,e){for(var t=0;t<i.length;){if(i.charAt(t)===e)return[i.substring(0,t),i.substring(t+1)];t+=1}return null}function ure(i){var e=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],i.substring(e[0].length)]}var av,z4,Q4,V4=["times"];(function(i){var e,t,r,n,o,l,s,g,b,S=function(Te){return Te=Te||{},this.isStrokeTransparent=Te.isStrokeTransparent||!1,this.strokeOpacity=Te.strokeOpacity||1,this.strokeStyle=Te.strokeStyle||"#000000",this.fillStyle=Te.fillStyle||"#000000",this.isFillTransparent=Te.isFillTransparent||!1,this.fillOpacity=Te.fillOpacity||1,this.font=Te.font||"10px sans-serif",this.textBaseline=Te.textBaseline||"alphabetic",this.textAlign=Te.textAlign||"left",this.lineWidth=Te.lineWidth||1,this.lineJoin=Te.lineJoin||"miter",this.lineCap=Te.lineCap||"butt",this.path=Te.path||[],this.transform=Te.transform!==void 0?Te.transform.clone():new g,this.globalCompositeOperation=Te.globalCompositeOperation||"normal",this.globalAlpha=Te.globalAlpha||1,this.clip_path=Te.clip_path||[],this.currentPoint=Te.currentPoint||new l,this.miterLimit=Te.miterLimit||10,this.lastPoint=Te.lastPoint||new l,this.lineDashOffset=Te.lineDashOffset||0,this.lineDash=Te.lineDash||[],this.margin=Te.margin||[0,0,0,0],this.prevPageLastElemOffset=Te.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Te.ignoreClearRect!="boolean"||Te.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new F(this),e=this.internal.f2,t=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,l=this.internal.Point,s=this.internal.Rectangle,g=this.internal.Matrix,b=new S}]);var F=function(Te){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ze=Te;Object.defineProperty(this,"pdf",{get:function(){return Ze}});var tt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return tt},set:function(Ot){tt=!!Ot}});var dt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return dt},set:function(Ot){dt=!!Ot}});var pt=0;Object.defineProperty(this,"posX",{get:function(){return pt},set:function(Ot){isNaN(Ot)||(pt=Ot)}});var Bt=0;Object.defineProperty(this,"posY",{get:function(){return Bt},set:function(Ot){isNaN(Ot)||(Bt=Ot)}}),Object.defineProperty(this,"margin",{get:function(){return b.margin},set:function(Ot){var lt;typeof Ot=="number"?lt=[Ot,Ot,Ot,Ot]:((lt=new Array(4))[0]=Ot[0],lt[1]=Ot.length>=2?Ot[1]:lt[0],lt[2]=Ot.length>=3?Ot[2]:lt[0],lt[3]=Ot.length>=4?Ot[3]:lt[1]),b.margin=lt}});var Ft=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Ft},set:function(Ot){Ft=Ot}});var Lt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Lt},set:function(Ot){Lt=Ot}});var Gt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Gt},set:function(Ot){Gt=Ot}}),Object.defineProperty(this,"ctx",{get:function(){return b},set:function(Ot){Ot instanceof S&&(b=Ot)}}),Object.defineProperty(this,"path",{get:function(){return b.path},set:function(Ot){b.path=Ot}});var ri=[];Object.defineProperty(this,"ctxStack",{get:function(){return ri},set:function(Ot){ri=Ot}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Ot){var lt;lt=D(Ot),this.ctx.fillStyle=lt.style,this.ctx.isFillTransparent=lt.a===0,this.ctx.fillOpacity=lt.a,this.pdf.setFillColor(lt.r,lt.g,lt.b,{a:lt.a}),this.pdf.setTextColor(lt.r,lt.g,lt.b,{a:lt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Ot){var lt=D(Ot);this.ctx.strokeStyle=lt.style,this.ctx.isStrokeTransparent=lt.a===0,this.ctx.strokeOpacity=lt.a,lt.a===0?this.pdf.setDrawColor(255,255,255):(lt.a,this.pdf.setDrawColor(lt.r,lt.g,lt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Ot){["butt","round","square"].indexOf(Ot)!==-1&&(this.ctx.lineCap=Ot,this.pdf.setLineCap(Ot))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Ot){isNaN(Ot)||(this.ctx.lineWidth=Ot,this.pdf.setLineWidth(Ot))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Ot){["bevel","round","miter"].indexOf(Ot)!==-1&&(this.ctx.lineJoin=Ot,this.pdf.setLineJoin(Ot))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Ot){isNaN(Ot)||(this.ctx.miterLimit=Ot,this.pdf.setMiterLimit(Ot))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Ot){this.ctx.textBaseline=Ot}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Ot){["right","end","center","left","start"].indexOf(Ot)!==-1&&(this.ctx.textAlign=Ot)}});var mi=null;function yi(Ot,lt){if(mi===null){var wt=function(ki){var ti=[];return Object.keys(ki).forEach(function(ht){ki[ht].forEach(function(qt){var si=null;switch(qt){case"bold":si={family:ht,weight:"bold"};break;case"italic":si={family:ht,style:"italic"};break;case"bolditalic":si={family:ht,weight:"bold",style:"italic"};break;case"":case"normal":si={family:ht}}si!==null&&(si.ref={name:ht,style:qt},ti.push(si))})}),ti}(Ot.getFontList());mi=function(ki){for(var ti={},ht=0;ht<ki.length;++ht){var qt=FC(ki[ht]),si=qt.family,fi=qt.stretch,ci=qt.style,Wi=qt.weight;ti[si]=ti[si]||{},ti[si][fi]=ti[si][fi]||{},ti[si][fi][ci]=ti[si][fi][ci]||{},ti[si][fi][ci][Wi]=qt}return ti}(wt.concat(lt))}return mi}var Pi=null;Object.defineProperty(this,"fontFaces",{get:function(){return Pi},set:function(Ot){mi=null,Pi=Ot}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Ot){var lt;if(this.ctx.font=Ot,(lt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Ot))!==null){var wt=lt[1],ki=(lt[2],lt[3]),ti=lt[4],ht=(lt[5],lt[6]),qt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ti)[2];ti=Math.floor(qt==="px"?parseFloat(ti)*this.pdf.internal.scaleFactor:qt==="em"?parseFloat(ti)*this.pdf.getFontSize():parseFloat(ti)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ti);var si=function(zt){var Yi,ui,Kt=[],Ji=zt.trim();if(Ji==="")return V4;if(Ji in O4)return[O4[Ji]];for(;Ji!=="";){switch(ui=null,Yi=(Ji=N4(Ji)).charAt(0)){case'"':case"'":ui=cre(Ji.substring(1),Yi);break;default:ui=ure(Ji)}if(ui===null||(Kt.push(ui[0]),(Ji=N4(ui[1]))!==""&&Ji.charAt(0)!==","))return V4;Ji=Ji.replace(/^,/,"")}return Kt}(ht);if(this.fontFaces){var fi=lre(yi(this.pdf,this.fontFaces),si.map(function(zt){return{family:zt,stretch:"normal",weight:ki,style:wt}}));this.pdf.setFont(fi.ref.name,fi.ref.style)}else{var ci="";(ki==="bold"||parseInt(ki,10)>=700||wt==="bold")&&(ci="bold"),wt==="italic"&&(ci+="italic"),ci.length===0&&(ci="normal");for(var Wi="",ir={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},dr=0;dr<si.length;dr++){if(this.pdf.internal.getFont(si[dr],ci,{noFallback:!0,disableWarning:!0})!==void 0){Wi=si[dr];break}if(ci==="bolditalic"&&this.pdf.internal.getFont(si[dr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Wi=si[dr],ci="bold";else if(this.pdf.internal.getFont(si[dr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Wi=si[dr],ci="normal";break}}if(Wi===""){for(var Sr=0;Sr<si.length;Sr++)if(ir[si[Sr]]){Wi=ir[si[Sr]];break}}Wi=Wi===""?"Times":Wi,this.pdf.setFont(Wi,ci)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Ot){this.ctx.globalCompositeOperation=Ot}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Ot){this.ctx.globalAlpha=Ot}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Ot){this.ctx.lineDashOffset=Ot,Xt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Ot){this.ctx.lineDash=Ot,Xt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Ot){this.ctx.ignoreClearRect=!!Ot}})};F.prototype.setLineDash=function(Te){this.lineDash=Te},F.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},F.prototype.fill=function(){Se.call(this,"fill",!1)},F.prototype.stroke=function(){Se.call(this,"stroke",!1)},F.prototype.beginPath=function(){this.path=[{type:"begin"}]},F.prototype.moveTo=function(Te,Ze){if(isNaN(Te)||isNaN(Ze))throw Fs.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var tt=this.ctx.transform.applyToPoint(new l(Te,Ze));this.path.push({type:"mt",x:tt.x,y:tt.y}),this.ctx.lastPoint=new l(Te,Ze)},F.prototype.closePath=function(){var Te=new l(0,0),Ze=0;for(Ze=this.path.length-1;Ze!==-1;Ze--)if(this.path[Ze].type==="begin"&&Yn(this.path[Ze+1])==="object"&&typeof this.path[Ze+1].x=="number"){Te=new l(this.path[Ze+1].x,this.path[Ze+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(Te.x,Te.y)},F.prototype.lineTo=function(Te,Ze){if(isNaN(Te)||isNaN(Ze))throw Fs.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var tt=this.ctx.transform.applyToPoint(new l(Te,Ze));this.path.push({type:"lt",x:tt.x,y:tt.y}),this.ctx.lastPoint=new l(tt.x,tt.y)},F.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Se.call(this,null,!0)},F.prototype.quadraticCurveTo=function(Te,Ze,tt,dt){if(isNaN(tt)||isNaN(dt)||isNaN(Te)||isNaN(Ze))throw Fs.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var pt=this.ctx.transform.applyToPoint(new l(tt,dt)),Bt=this.ctx.transform.applyToPoint(new l(Te,Ze));this.path.push({type:"qct",x1:Bt.x,y1:Bt.y,x:pt.x,y:pt.y}),this.ctx.lastPoint=new l(pt.x,pt.y)},F.prototype.bezierCurveTo=function(Te,Ze,tt,dt,pt,Bt){if(isNaN(pt)||isNaN(Bt)||isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt))throw Fs.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Ft=this.ctx.transform.applyToPoint(new l(pt,Bt)),Lt=this.ctx.transform.applyToPoint(new l(Te,Ze)),Gt=this.ctx.transform.applyToPoint(new l(tt,dt));this.path.push({type:"bct",x1:Lt.x,y1:Lt.y,x2:Gt.x,y2:Gt.y,x:Ft.x,y:Ft.y}),this.ctx.lastPoint=new l(Ft.x,Ft.y)},F.prototype.arc=function(Te,Ze,tt,dt,pt,Bt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt)||isNaN(pt))throw Fs.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Bt=!!Bt,!this.ctx.transform.isIdentity){var Ft=this.ctx.transform.applyToPoint(new l(Te,Ze));Te=Ft.x,Ze=Ft.y;var Lt=this.ctx.transform.applyToPoint(new l(0,tt)),Gt=this.ctx.transform.applyToPoint(new l(0,0));tt=Math.sqrt(Math.pow(Lt.x-Gt.x,2)+Math.pow(Lt.y-Gt.y,2))}Math.abs(pt-dt)>=2*Math.PI&&(dt=0,pt=2*Math.PI),this.path.push({type:"arc",x:Te,y:Ze,radius:tt,startAngle:dt,endAngle:pt,counterclockwise:Bt})},F.prototype.arcTo=function(Te,Ze,tt,dt,pt){throw new Error("arcTo not implemented.")},F.prototype.rect=function(Te,Ze,tt,dt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt))throw Fs.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Te,Ze),this.lineTo(Te+tt,Ze),this.lineTo(Te+tt,Ze+dt),this.lineTo(Te,Ze+dt),this.lineTo(Te,Ze),this.lineTo(Te+tt,Ze),this.lineTo(Te,Ze)},F.prototype.fillRect=function(Te,Ze,tt,dt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt))throw Fs.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!N.call(this)){var pt={};this.lineCap!=="butt"&&(pt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(pt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Te,Ze,tt,dt),this.fill(),pt.hasOwnProperty("lineCap")&&(this.lineCap=pt.lineCap),pt.hasOwnProperty("lineJoin")&&(this.lineJoin=pt.lineJoin)}},F.prototype.strokeRect=function(Te,Ze,tt,dt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt))throw Fs.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");J.call(this)||(this.beginPath(),this.rect(Te,Ze,tt,dt),this.stroke())},F.prototype.clearRect=function(Te,Ze,tt,dt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt))throw Fs.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Te,Ze,tt,dt))},F.prototype.save=function(Te){Te=typeof Te!="boolean"||Te;for(var Ze=this.pdf.internal.getCurrentPageInfo().pageNumber,tt=0;tt<this.pdf.internal.getNumberOfPages();tt++)this.pdf.setPage(tt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ze),Te){this.ctx.fontSize=this.pdf.internal.getFontSize();var dt=new S(this.ctx);this.ctxStack.push(this.ctx),this.ctx=dt}},F.prototype.restore=function(Te){Te=typeof Te!="boolean"||Te;for(var Ze=this.pdf.internal.getCurrentPageInfo().pageNumber,tt=0;tt<this.pdf.internal.getNumberOfPages();tt++)this.pdf.setPage(tt+1),this.pdf.internal.out("Q");this.pdf.setPage(Ze),Te&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},F.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var D=function(Te){var Ze,tt,dt,pt;if(Te.isCanvasGradient===!0&&(Te=Te.getColor()),!Te)return{r:0,g:0,b:0,a:0,style:Te};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Te))Ze=0,tt=0,dt=0,pt=0;else{var Bt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Te);if(Bt!==null)Ze=parseInt(Bt[1]),tt=parseInt(Bt[2]),dt=parseInt(Bt[3]),pt=1;else if((Bt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Te))!==null)Ze=parseInt(Bt[1]),tt=parseInt(Bt[2]),dt=parseInt(Bt[3]),pt=parseFloat(Bt[4]);else{if(pt=1,typeof Te=="string"&&Te.charAt(0)!=="#"){var Ft=new x4(Te);Te=Ft.ok?Ft.toHex():"#000000"}Te.length===4?(Ze=Te.substring(1,2),Ze+=Ze,tt=Te.substring(2,3),tt+=tt,dt=Te.substring(3,4),dt+=dt):(Ze=Te.substring(1,3),tt=Te.substring(3,5),dt=Te.substring(5,7)),Ze=parseInt(Ze,16),tt=parseInt(tt,16),dt=parseInt(dt,16)}}return{r:Ze,g:tt,b:dt,a:pt,style:Te}},N=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},J=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};F.prototype.fillText=function(Te,Ze,tt,dt){if(isNaN(Ze)||isNaN(tt)||typeof Te!="string")throw Fs.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(dt=isNaN(dt)?void 0:dt,!N.call(this)){var pt=vt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;Pe.call(this,{text:Te,x:Ze,y:tt,scale:Bt,angle:pt,align:this.textAlign,maxWidth:dt})}},F.prototype.strokeText=function(Te,Ze,tt,dt){if(isNaN(Ze)||isNaN(tt)||typeof Te!="string")throw Fs.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!J.call(this)){dt=isNaN(dt)?void 0:dt;var pt=vt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;Pe.call(this,{text:Te,x:Ze,y:tt,scale:Bt,renderingMode:"stroke",angle:pt,align:this.textAlign,maxWidth:dt})}},F.prototype.measureText=function(Te){if(typeof Te!="string")throw Fs.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ze=this.pdf,tt=this.pdf.internal.scaleFactor,dt=Ze.internal.getFontSize(),pt=Ze.getStringUnitWidth(Te)*dt/Ze.internal.scaleFactor,Bt=function(Ft){var Lt=(Ft=Ft||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Lt}}),this};return new Bt({width:pt*=Math.round(96*tt/72*1e4)/1e4})},F.prototype.scale=function(Te,Ze){if(isNaN(Te)||isNaN(Ze))throw Fs.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var tt=new g(Te,0,0,Ze,0,0);this.ctx.transform=this.ctx.transform.multiply(tt)},F.prototype.rotate=function(Te){if(isNaN(Te))throw Fs.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ze=new g(Math.cos(Te),Math.sin(Te),-Math.sin(Te),Math.cos(Te),0,0);this.ctx.transform=this.ctx.transform.multiply(Ze)},F.prototype.translate=function(Te,Ze){if(isNaN(Te)||isNaN(Ze))throw Fs.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var tt=new g(1,0,0,1,Te,Ze);this.ctx.transform=this.ctx.transform.multiply(tt)},F.prototype.transform=function(Te,Ze,tt,dt,pt,Bt){if(isNaN(Te)||isNaN(Ze)||isNaN(tt)||isNaN(dt)||isNaN(pt)||isNaN(Bt))throw Fs.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Ft=new g(Te,Ze,tt,dt,pt,Bt);this.ctx.transform=this.ctx.transform.multiply(Ft)},F.prototype.setTransform=function(Te,Ze,tt,dt,pt,Bt){Te=isNaN(Te)?1:Te,Ze=isNaN(Ze)?0:Ze,tt=isNaN(tt)?0:tt,dt=isNaN(dt)?1:dt,pt=isNaN(pt)?0:pt,Bt=isNaN(Bt)?0:Bt,this.ctx.transform=new g(Te,Ze,tt,dt,pt,Bt)};var te=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};F.prototype.drawImage=function(Te,Ze,tt,dt,pt,Bt,Ft,Lt,Gt){var ri=this.pdf.getImageProperties(Te),mi=1,yi=1,Pi=1,Ot=1;dt!==void 0&&Lt!==void 0&&(Pi=Lt/dt,Ot=Gt/pt,mi=ri.width/dt*Lt/dt,yi=ri.height/pt*Gt/pt),Bt===void 0&&(Bt=Ze,Ft=tt,Ze=0,tt=0),dt!==void 0&&Lt===void 0&&(Lt=dt,Gt=pt),dt===void 0&&Lt===void 0&&(Lt=ri.width,Gt=ri.height);for(var lt,wt=this.ctx.transform.decompose(),ki=vt(wt.rotate.shx),ti=new g,ht=(ti=(ti=(ti=ti.multiply(wt.translate)).multiply(wt.skew)).multiply(wt.scale)).applyToRectangle(new s(Bt-Ze*Pi,Ft-tt*Ot,dt*mi,pt*yi)),qt=he.call(this,ht),si=[],fi=0;fi<qt.length;fi+=1)si.indexOf(qt[fi])===-1&&si.push(qt[fi]);if(ve(si),this.autoPaging)for(var ci=si[0],Wi=si[si.length-1],ir=ci;ir<Wi+1;ir++){this.pdf.setPage(ir);var dr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Sr=ir===1?this.posY+this.margin[0]:this.margin[0],zt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Yi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ui=ir===1?0:zt+(ir-2)*Yi;if(this.ctx.clip_path.length!==0){var Kt=this.path;lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=fe(lt,this.posX+this.margin[3],-ui+Sr+this.ctx.prevPageLastElemOffset),Ge.call(this,"fill",!0),this.path=Kt}var Ji=JSON.parse(JSON.stringify(ht));Ji=fe([Ji],this.posX+this.margin[3],-ui+Sr+this.ctx.prevPageLastElemOffset)[0];var Vt=(ir>ci||ir<Wi)&&te.call(this);Vt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],dr,Yi,null).clip().discardPath()),this.pdf.addImage(Te,"JPEG",Ji.x,Ji.y,Ji.w,Ji.h,null,null,ki),Vt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Te,"JPEG",ht.x,ht.y,ht.w,ht.h,null,null,ki)};var he=function(Te,Ze,tt){var dt=[];Ze=Ze||this.pdf.internal.pageSize.width,tt=tt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var pt=this.posY+this.ctx.prevPageLastElemOffset;switch(Te.type){default:case"mt":case"lt":dt.push(Math.floor((Te.y+pt)/tt)+1);break;case"arc":dt.push(Math.floor((Te.y+pt-Te.radius)/tt)+1),dt.push(Math.floor((Te.y+pt+Te.radius)/tt)+1);break;case"qct":var Bt=Dt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Te.x1,Te.y1,Te.x,Te.y);dt.push(Math.floor((Bt.y+pt)/tt)+1),dt.push(Math.floor((Bt.y+Bt.h+pt)/tt)+1);break;case"bct":var Ft=Pt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Te.x1,Te.y1,Te.x2,Te.y2,Te.x,Te.y);dt.push(Math.floor((Ft.y+pt)/tt)+1),dt.push(Math.floor((Ft.y+Ft.h+pt)/tt)+1);break;case"rect":dt.push(Math.floor((Te.y+pt)/tt)+1),dt.push(Math.floor((Te.y+Te.h+pt)/tt)+1)}for(var Lt=0;Lt<dt.length;Lt+=1)for(;this.pdf.internal.getNumberOfPages()<dt[Lt];)ue.call(this);return dt},ue=function(){var Te=this.fillStyle,Ze=this.strokeStyle,tt=this.font,dt=this.lineCap,pt=this.lineWidth,Bt=this.lineJoin;this.pdf.addPage(),this.fillStyle=Te,this.strokeStyle=Ze,this.font=tt,this.lineCap=dt,this.lineWidth=pt,this.lineJoin=Bt},fe=function(Te,Ze,tt){for(var dt=0;dt<Te.length;dt++)switch(Te[dt].type){case"bct":Te[dt].x2+=Ze,Te[dt].y2+=tt;case"qct":Te[dt].x1+=Ze,Te[dt].y1+=tt;case"mt":case"lt":case"arc":default:Te[dt].x+=Ze,Te[dt].y+=tt}return Te},ve=function(Te){return Te.sort(function(Ze,tt){return Ze-tt})},Se=function(Te,Ze){for(var tt,dt,pt=this.fillStyle,Bt=this.strokeStyle,Ft=this.lineCap,Lt=this.lineWidth,Gt=Math.abs(Lt*this.ctx.transform.scaleX),ri=this.lineJoin,mi=JSON.parse(JSON.stringify(this.path)),yi=JSON.parse(JSON.stringify(this.path)),Pi=[],Ot=0;Ot<yi.length;Ot++)if(yi[Ot].x!==void 0)for(var lt=he.call(this,yi[Ot]),wt=0;wt<lt.length;wt+=1)Pi.indexOf(lt[wt])===-1&&Pi.push(lt[wt]);for(var ki=0;ki<Pi.length;ki++)for(;this.pdf.internal.getNumberOfPages()<Pi[ki];)ue.call(this);if(ve(Pi),this.autoPaging)for(var ti=Pi[0],ht=Pi[Pi.length-1],qt=ti;qt<ht+1;qt++){this.pdf.setPage(qt),this.fillStyle=pt,this.strokeStyle=Bt,this.lineCap=Ft,this.lineWidth=Gt,this.lineJoin=ri;var si=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],fi=qt===1?this.posY+this.margin[0]:this.margin[0],ci=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ir=qt===1?0:ci+(qt-2)*Wi;if(this.ctx.clip_path.length!==0){var dr=this.path;tt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=fe(tt,this.posX+this.margin[3],-ir+fi+this.ctx.prevPageLastElemOffset),Ge.call(this,Te,!0),this.path=dr}if(dt=JSON.parse(JSON.stringify(mi)),this.path=fe(dt,this.posX+this.margin[3],-ir+fi+this.ctx.prevPageLastElemOffset),Ze===!1||qt===0){var Sr=(qt>ti||qt<ht)&&te.call(this);Sr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],si,Wi,null).clip().discardPath()),Ge.call(this,Te,Ze),Sr&&this.pdf.restoreGraphicsState()}this.lineWidth=Lt}else this.lineWidth=Gt,Ge.call(this,Te,Ze),this.lineWidth=Lt;this.path=mi},Ge=function(Te,Ze){if((Te!=="stroke"||Ze||!J.call(this))&&(Te==="stroke"||Ze||!N.call(this))){for(var tt,dt,pt=[],Bt=this.path,Ft=0;Ft<Bt.length;Ft++){var Lt=Bt[Ft];switch(Lt.type){case"begin":pt.push({begin:!0});break;case"close":pt.push({close:!0});break;case"mt":pt.push({start:Lt,deltas:[],abs:[]});break;case"lt":var Gt=pt.length;if(Bt[Ft-1]&&!isNaN(Bt[Ft-1].x)&&(tt=[Lt.x-Bt[Ft-1].x,Lt.y-Bt[Ft-1].y],Gt>0)){for(;Gt>=0;Gt--)if(pt[Gt-1].close!==!0&&pt[Gt-1].begin!==!0){pt[Gt-1].deltas.push(tt),pt[Gt-1].abs.push(Lt);break}}break;case"bct":tt=[Lt.x1-Bt[Ft-1].x,Lt.y1-Bt[Ft-1].y,Lt.x2-Bt[Ft-1].x,Lt.y2-Bt[Ft-1].y,Lt.x-Bt[Ft-1].x,Lt.y-Bt[Ft-1].y],pt[pt.length-1].deltas.push(tt);break;case"qct":var ri=Bt[Ft-1].x+2/3*(Lt.x1-Bt[Ft-1].x),mi=Bt[Ft-1].y+2/3*(Lt.y1-Bt[Ft-1].y),yi=Lt.x+2/3*(Lt.x1-Lt.x),Pi=Lt.y+2/3*(Lt.y1-Lt.y),Ot=Lt.x,lt=Lt.y;tt=[ri-Bt[Ft-1].x,mi-Bt[Ft-1].y,yi-Bt[Ft-1].x,Pi-Bt[Ft-1].y,Ot-Bt[Ft-1].x,lt-Bt[Ft-1].y],pt[pt.length-1].deltas.push(tt);break;case"arc":pt.push({deltas:[],abs:[],arc:!0}),Array.isArray(pt[pt.length-1].abs)&&pt[pt.length-1].abs.push(Lt)}}dt=Ze?null:Te==="stroke"?"stroke":"fill";for(var wt=!1,ki=0;ki<pt.length;ki++)if(pt[ki].arc)for(var ti=pt[ki].abs,ht=0;ht<ti.length;ht++){var qt=ti[ht];qt.type==="arc"?Ne.call(this,qt.x,qt.y,qt.radius,qt.startAngle,qt.endAngle,qt.counterclockwise,void 0,Ze,!wt):Je.call(this,qt.x,qt.y),wt=!0}else if(pt[ki].close===!0)this.pdf.internal.out("h"),wt=!1;else if(pt[ki].begin!==!0){var si=pt[ki].start.x,fi=pt[ki].start.y;Xe.call(this,pt[ki].deltas,si,fi),wt=!0}dt&&at.call(this,dt),Ze&&rt.call(this)}},He=function(Te){var Ze=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,tt=Ze*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Te-tt;case"top":return Te+Ze-tt;case"hanging":return Te+Ze-2*tt;case"middle":return Te+Ze/2-tt;case"ideographic":return Te;case"alphabetic":default:return Te}},$e=function(Te){return Te+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};F.prototype.createLinearGradient=function(){var Te=function(){};return Te.colorStops=[],Te.addColorStop=function(Ze,tt){this.colorStops.push([Ze,tt])},Te.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Te.isCanvasGradient=!0,Te},F.prototype.createPattern=function(){return this.createLinearGradient()},F.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ne=function(Te,Ze,tt,dt,pt,Bt,Ft,Lt,Gt){for(var ri=Et.call(this,tt,dt,pt,Bt),mi=0;mi<ri.length;mi++){var yi=ri[mi];mi===0&&(Gt?Re.call(this,yi.x1+Te,yi.y1+Ze):Je.call(this,yi.x1+Te,yi.y1+Ze)),Ct.call(this,Te,Ze,yi.x2,yi.y2,yi.x3,yi.y3,yi.x4,yi.y4)}Lt?rt.call(this):at.call(this,Ft)},at=function(Te){switch(Te){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},rt=function(){this.pdf.clip(),this.pdf.discardPath()},Re=function(Te,Ze){this.pdf.internal.out(t(Te)+" "+r(Ze)+" m")},Pe=function(Te){var Ze;switch(Te.align){case"right":case"end":Ze="right";break;case"center":Ze="center";break;case"left":case"start":default:Ze="left"}var tt=this.pdf.getTextDimensions(Te.text),dt=He.call(this,Te.y),pt=$e.call(this,dt)-tt.h,Bt=this.ctx.transform.applyToPoint(new l(Te.x,dt)),Ft=this.ctx.transform.decompose(),Lt=new g;Lt=(Lt=(Lt=Lt.multiply(Ft.translate)).multiply(Ft.skew)).multiply(Ft.scale);for(var Gt,ri,mi,yi=this.ctx.transform.applyToRectangle(new s(Te.x,dt,tt.w,tt.h)),Pi=Lt.applyToRectangle(new s(Te.x,pt,tt.w,tt.h)),Ot=he.call(this,Pi),lt=[],wt=0;wt<Ot.length;wt+=1)lt.indexOf(Ot[wt])===-1&&lt.push(Ot[wt]);if(ve(lt),this.autoPaging)for(var ki=lt[0],ti=lt[lt.length-1],ht=ki;ht<ti+1;ht++){this.pdf.setPage(ht);var qt=ht===1?this.posY+this.margin[0]:this.margin[0],si=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],fi=this.pdf.internal.pageSize.height-this.margin[2],ci=fi-this.margin[0],Wi=this.pdf.internal.pageSize.width-this.margin[1],ir=Wi-this.margin[3],dr=ht===1?0:si+(ht-2)*ci;if(this.ctx.clip_path.length!==0){var Sr=this.path;Gt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=fe(Gt,this.posX+this.margin[3],-1*dr+qt),Ge.call(this,"fill",!0),this.path=Sr}var zt=fe([JSON.parse(JSON.stringify(Pi))],this.posX+this.margin[3],-dr+qt+this.ctx.prevPageLastElemOffset)[0];Te.scale>=.01&&(ri=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ri*Te.scale),mi=this.lineWidth,this.lineWidth=mi*Te.scale);var Yi=this.autoPaging!=="text";if(Yi||zt.y+zt.h<=fi){if(Yi||zt.y>=qt&&zt.x<=Wi){var ui=Yi?Te.text:this.pdf.splitTextToSize(Te.text,Te.maxWidth||Wi-zt.x)[0],Kt=fe([JSON.parse(JSON.stringify(yi))],this.posX+this.margin[3],-dr+qt+this.ctx.prevPageLastElemOffset)[0],Ji=Yi&&(ht>ki||ht<ti)&&te.call(this);Ji&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ir,ci,null).clip().discardPath()),this.pdf.text(ui,Kt.x,Kt.y,{angle:Te.angle,align:Ze,renderingMode:Te.renderingMode}),Ji&&this.pdf.restoreGraphicsState()}}else zt.y<fi&&(this.ctx.prevPageLastElemOffset+=fi-zt.y);Te.scale>=.01&&(this.pdf.setFontSize(ri),this.lineWidth=mi)}else Te.scale>=.01&&(ri=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ri*Te.scale),mi=this.lineWidth,this.lineWidth=mi*Te.scale),this.pdf.text(Te.text,Bt.x+this.posX,Bt.y+this.posY,{angle:Te.angle,align:Ze,renderingMode:Te.renderingMode,maxWidth:Te.maxWidth}),Te.scale>=.01&&(this.pdf.setFontSize(ri),this.lineWidth=mi)},Je=function(Te,Ze,tt,dt){tt=tt||0,dt=dt||0,this.pdf.internal.out(t(Te+tt)+" "+r(Ze+dt)+" l")},Xe=function(Te,Ze,tt){return this.pdf.lines(Te,Ze,tt,null,null)},Ct=function(Te,Ze,tt,dt,pt,Bt,Ft,Lt){this.pdf.internal.out([e(n(tt+Te)),e(o(dt+Ze)),e(n(pt+Te)),e(o(Bt+Ze)),e(n(Ft+Te)),e(o(Lt+Ze)),"c"].join(" "))},Et=function(Te,Ze,tt,dt){for(var pt=2*Math.PI,Bt=Math.PI/2;Ze>tt;)Ze-=pt;var Ft=Math.abs(tt-Ze);Ft<pt&&dt&&(Ft=pt-Ft);for(var Lt=[],Gt=dt?-1:1,ri=Ze;Ft>1e-5;){var mi=ri+Gt*Math.min(Ft,Bt);Lt.push(Mt.call(this,Te,ri,mi)),Ft-=Math.abs(mi-ri),ri=mi}return Lt},Mt=function(Te,Ze,tt){var dt=(tt-Ze)/2,pt=Te*Math.cos(dt),Bt=Te*Math.sin(dt),Ft=pt,Lt=-Bt,Gt=Ft*Ft+Lt*Lt,ri=Gt+Ft*pt+Lt*Bt,mi=4/3*(Math.sqrt(2*Gt*ri)-ri)/(Ft*Bt-Lt*pt),yi=Ft-mi*Lt,Pi=Lt+mi*Ft,Ot=yi,lt=-Pi,wt=dt+Ze,ki=Math.cos(wt),ti=Math.sin(wt);return{x1:Te*Math.cos(Ze),y1:Te*Math.sin(Ze),x2:yi*ki-Pi*ti,y2:yi*ti+Pi*ki,x3:Ot*ki-lt*ti,y3:Ot*ti+lt*ki,x4:Te*Math.cos(tt),y4:Te*Math.sin(tt)}},vt=function(Te){return 180*Te/Math.PI},Dt=function(Te,Ze,tt,dt,pt,Bt){var Ft=Te+.5*(tt-Te),Lt=Ze+.5*(dt-Ze),Gt=pt+.5*(tt-pt),ri=Bt+.5*(dt-Bt),mi=Math.min(Te,pt,Ft,Gt),yi=Math.max(Te,pt,Ft,Gt),Pi=Math.min(Ze,Bt,Lt,ri),Ot=Math.max(Ze,Bt,Lt,ri);return new s(mi,Pi,yi-mi,Ot-Pi)},Pt=function(Te,Ze,tt,dt,pt,Bt,Ft,Lt){var Gt,ri,mi,yi,Pi,Ot,lt,wt,ki,ti,ht,qt,si,fi,ci=tt-Te,Wi=dt-Ze,ir=pt-tt,dr=Bt-dt,Sr=Ft-pt,zt=Lt-Bt;for(ri=0;ri<41;ri++)ki=(lt=(mi=Te+(Gt=ri/40)*ci)+Gt*((Pi=tt+Gt*ir)-mi))+Gt*(Pi+Gt*(pt+Gt*Sr-Pi)-lt),ti=(wt=(yi=Ze+Gt*Wi)+Gt*((Ot=dt+Gt*dr)-yi))+Gt*(Ot+Gt*(Bt+Gt*zt-Ot)-wt),ri==0?(ht=ki,qt=ti,si=ki,fi=ti):(ht=Math.min(ht,ki),qt=Math.min(qt,ti),si=Math.max(si,ki),fi=Math.max(fi,ti));return new s(Math.round(ht),Math.round(qt),Math.round(si-ht),Math.round(fi-qt))},Xt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Te,Ze,tt=(Te=this.ctx.lineDash,Ze=this.ctx.lineDashOffset,JSON.stringify({lineDash:Te,lineDashOffset:Ze}));this.prevLineDash!==tt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=tt)}}})(Or.API),function(i){var e=function(o){var l,s,g,b,S,F,D,N,J,te;for(s=[],g=0,b=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;b>g;g+=4)(S=(o.charCodeAt(g)<<24)+(o.charCodeAt(g+1)<<16)+(o.charCodeAt(g+2)<<8)+o.charCodeAt(g+3))!==0?(F=(S=((S=((S=((S=(S-(te=S%85))/85)-(J=S%85))/85)-(N=S%85))/85)-(D=S%85))/85)%85,s.push(F+33,D+33,N+33,J+33,te+33)):s.push(122);return function(he,ue){for(var fe=ue;fe>0;fe--)he.pop()}(s,l.length),String.fromCharCode.apply(String,s)+"~>"},t=function(o){var l,s,g,b,S,F=String,D="length",N=255,J="charCodeAt",te="slice",he="replace";for(o[te](-2),o=o[te](0,-2)[he](/\s/g,"")[he]("z","!!!!!"),g=[],b=0,S=(o+=l="uuuuu"[te](o[D]%5||5))[D];S>b;b+=5)s=52200625*(o[J](b)-33)+614125*(o[J](b+1)-33)+7225*(o[J](b+2)-33)+85*(o[J](b+3)-33)+(o[J](b+4)-33),g.push(N&s>>24,N&s>>16,N&s>>8,N&s);return function(ue,fe){for(var ve=fe;ve>0;ve--)ue.pop()}(g,l[D]),F.fromCharCode.apply(F,g)},r=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var s="",g=0;g<o.length;g+=2)s+=String.fromCharCode("0x"+(o[g]+o[g+1]));return s},n=function(o){for(var l=new Uint8Array(o.length),s=o.length;s--;)l[s]=o.charCodeAt(s);return o=(l=xC(l)).reduce(function(g,b){return g+String.fromCharCode(b)},"")};i.processDataByFilters=function(o,l){var s=0,g=o||"",b=[];for(typeof(l=l||[])=="string"&&(l=[l]),s=0;s<l.length;s+=1)switch(l[s]){case"ASCII85Decode":case"/ASCII85Decode":g=t(g),b.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":g=e(g),b.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":g=r(g),b.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":g=g.split("").map(function(S){return("0"+S.charCodeAt().toString(16)).slice(-2)}).join("")+">",b.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":g=n(g),b.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[s]+'" is not implemented')}return{data:g,reverseChain:b.reverse().join(" ")}}}(Or.API),function(i){i.loadFile=function(e,t,r){return function(n,o,l){o=o!==!1,l=typeof l=="function"?l:function(){};var s=void 0;try{s=function(g,b,S){var F=new XMLHttpRequest,D=0,N=function(J){var te=J.length,he=[],ue=String.fromCharCode;for(D=0;D<te;D+=1)he.push(ue(255&J.charCodeAt(D)));return he.join("")};if(F.open("GET",g,!b),F.overrideMimeType("text/plain; charset=x-user-defined"),b===!1&&(F.onload=function(){F.status===200?S(N(this.responseText)):S(void 0)}),F.send(null),b&&F.status===200)return N(F.responseText)}(n,o,l)}catch{}return s}(e,t,r)},i.loadImageFile=i.loadFile}(Or.API),function(i){function e(){return(kr.html2canvas?Promise.resolve(kr.html2canvas):Promise.resolve().then(()=>due)).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function t(){return(kr.DOMPurify?Promise.resolve(kr.DOMPurify):Promise.resolve().then(()=>Hue)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var s=Yn(l);return s==="undefined"?"undefined":s==="string"||l instanceof String?"string":s==="number"||l instanceof Number?"number":s==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":s==="object"?"object":"unknown"},n=function(l,s){var g=document.createElement(l);for(var b in s.className&&(g.className=s.className),s.innerHTML&&s.dompurify&&(g.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)g.style[b]=s.style[b];return g},o=function l(s){var g=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),b=l.convert(Promise.resolve(),g);return b=(b=b.setProgress(1,l,1,[l])).set(s)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,s){return l.__proto__=s||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,s){return this.then(function(){switch(s=s||function(g){switch(r(g)){case"string":return"string";case"element":return g.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l)){case"string":return this.then(t).then(function(g){return this.set({src:n("div",{innerHTML:l,dompurify:g})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function g(b,S){for(var F=b.nodeType===3?document.createTextNode(b.nodeValue):b.cloneNode(!1),D=b.firstChild;D;D=D.nextSibling)S!==!0&&D.nodeType===1&&D.nodeName==="SCRIPT"||F.appendChild(g(D,S));return b.nodeType===1&&(b.nodeName==="CANVAS"?(F.width=b.width,F.height=b.height,F.getContext("2d").drawImage(b,0,0)):b.nodeName!=="TEXTAREA"&&b.nodeName!=="SELECT"||(F.value=b.value),F.addEventListener("load",function(){F.scrollTop=b.scrollTop,F.scrollLeft=b.scrollLeft},!0)),F}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=Object.assign({},this.opt.html2canvas);return delete g.onrendered,s(this.prop.container,g)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=this.opt.jsPDF,b=this.opt.fontFaces,S=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,F=Object.assign({async:!0,allowTaint:!0,scale:S,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete F.onrendered,g.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,g.context2d.posX=this.opt.x,g.context2d.posY=this.opt.y,g.context2d.margin=this.opt.margin,g.context2d.fontFaces=b,b)for(var D=0;D<b.length;++D){var N=b[D],J=N.src.find(function(te){return te.format==="truetype"});J&&g.addFont(J.url,N.ref.name,N.ref.style)}return F.windowHeight=F.windowHeight||0,F.windowHeight=F.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):F.windowHeight,g.context2d.save(!0),s(this.prop.container,F)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,s,g){return(g=g||"pdf").toLowerCase()==="img"||g.toLowerCase()==="image"?this.outputImg(l,s):this.outputPdf(l,s)},o.prototype.outputPdf=function(l,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,s)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var s=Object.keys(l||{}).map(function(g){if(g in o.template.prop)return function(){this.prop[g]=l[g]};switch(g){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[g]=l[g]}}},this);return this.then(function(){return this.thenList(s)})},o.prototype.get=function(l,s){return this.then(function(){var g=l in o.template.prop?this.prop[l]:this.opt[l];return s?s(g):g})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function s(g,b){return Math.floor(g*b/72*96)}return this.then(function(){(l=l||Or.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:s(l.inner.width,l.k),height:s(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,s,g,b){return l!=null&&(this.progress.val=l),s!=null&&(this.progress.state=s),g!=null&&(this.progress.n=g),b!=null&&(this.progress.stack=b),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,s,g,b){return this.setProgress(l?this.progress.val+l:null,s||null,g?this.progress.n+g:null,b?this.progress.stack.concat(b):null)},o.prototype.then=function(l,s){var g=this;return this.thenCore(l,s,function(b,S){return g.updateProgress(null,null,1,[b]),Promise.prototype.then.call(this,function(F){return g.updateProgress(null,b),F}).then(b,S).then(function(F){return g.updateProgress(1),F})})},o.prototype.thenCore=function(l,s,g){g=g||Promise.prototype.then,l&&(l=l.bind(this)),s&&(s=s.bind(this));var b=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),S=g.call(b,l,s);return o.convert(S,this.__proto__)},o.prototype.thenExternal=function(l,s){return Promise.prototype.then.call(this,l,s)},o.prototype.thenList=function(l){var s=this;return l.forEach(function(g){s=s.thenCore(g)}),s},o.prototype.catch=function(l){l&&(l=l.bind(this));var s=Promise.prototype.catch.call(this,l);return o.convert(s,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Or.getPageSize=function(l,s,g){if(Yn(l)==="object"){var b=l;l=b.orientation,s=b.unit||s,g=b.format||g}s=s||"mm",g=g||"a4",l=(""+(l||"P")).toLowerCase();var S,F=(""+g).toLowerCase(),D={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":S=1;break;case"mm":S=72/25.4;break;case"cm":S=72/2.54;break;case"in":S=72;break;case"px":S=.75;break;case"pc":case"em":S=12;break;case"ex":S=6;break;default:throw"Invalid unit: "+s}var N,J=0,te=0;if(D.hasOwnProperty(F))J=D[F][1]/S,te=D[F][0]/S;else try{J=g[1],te=g[0]}catch{throw new Error("Invalid format: "+g)}if(l==="p"||l==="portrait")l="p",te>J&&(N=te,te=J,J=N);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",J>te&&(N=te,te=J,J=N)}return{width:te,height:J,unit:s,k:S,orientation:l}},i.html=function(l,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(FC):null;var g=new o(s);return s.worker?g:g.from(l).doCallback()}}(Or.API),Or.API.addJS=function(i){return Q4=i,this.internal.events.subscribe("postPutResources",function(){av=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(av+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),z4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Q4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){av!==void 0&&z4!==void 0&&this.internal.out("/Names <</JavaScript "+av+" 0 R>>")}),this},function(i){var e;i.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),o=0;o<n.length;o++){var l=n[o],s=r.exec(l);if(s!=null){var g=s[1];t.internal.newObjectDeferredBegin(g,!1)}t.internal.write(l)}if(this.outline.createNamedDestinations){var b=this.internal.pages.length,S=[];for(o=0;o<b;o++){var F=t.internal.newObject();S.push(F);var D=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+D.objId+" 0 R /XYZ null null null]>> endobj")}var N=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<S.length;o++)t.internal.write("(page_"+(o+1)+")"+S[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+N+" 0 R"),t.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),i.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(r,n,o){var l={title:n,options:o,children:[]};return r==null&&(r=this.root),r.children.push(l),l},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(r){r.id=t.internal.newObjectDeferred();for(var n=0;n<r.children.length;n++)this.genIds_r(r.children[n])},t.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},t.outline.renderItems=function(r){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<r.children.length;o++){var l=r.children[o];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(r)),o>0&&this.line("/Prev "+this.makeRef(r.children[o-1])),o<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[o+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var s=this.count=this.count_r({count:0},l);if(s>0&&this.line("/Count "+s),l.options&&l.options.pageNumber){var g=t.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+g.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var b=0;b<r.children.length;b++)this.renderItems(r.children[b])},t.outline.line=function(r){this.ctx.val+=r+`\r
`},t.outline.makeRef=function(r){return r.id+" 0 R"},t.outline.makeString=function(r){return"("+t.internal.pdfEscape(r)+")"},t.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(r,n){for(var o=0;o<n.children.length;o++)r.count++,this.count_r(r,n.children[o]);return r.count}}])}(Or.API),function(i){var e=[192,193,194,195,196,197,198,199];i.processJPEG=function(t,r,n,o,l,s){var g,b=this.decode.DCT_DECODE,S=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=l||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(g=function(F){for(var D,N=256*F.charCodeAt(4)+F.charCodeAt(5),J=F.length,te={width:0,height:0,numcomponents:1},he=4;he<J;he+=2){if(he+=N,e.indexOf(F.charCodeAt(he+1))!==-1){D=256*F.charCodeAt(he+5)+F.charCodeAt(he+6),te={width:256*F.charCodeAt(he+7)+F.charCodeAt(he+8),height:D,numcomponents:F.charCodeAt(he+9)};break}N=256*F.charCodeAt(he+2)+F.charCodeAt(he+3)}return te}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}S={data:t,width:g.width,height:g.height,colorSpace:s,bitsPerComponent:8,filter:b,index:r,alias:n}}return S}}(Or.API);var Lg,lv,H4,G4,j4,hre=function(){var i,e,t;function r(o){var l,s,g,b,S,F,D,N,J,te,he,ue,fe,ve;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},F=null;;){switch(l=this.readUInt32(),J=(function(){var Se,Ge;for(Ge=[],Se=0;Se<4;++Se)Ge.push(String.fromCharCode(this.data[this.pos++]));return Ge}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":F&&this.animation.frames.push(F),this.pos+=4,F={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},S=this.readUInt16(),b=this.readUInt16()||100,F.delay=1e3*S/b,F.disposeOp=this.data[this.pos++],F.blendOp=this.data[this.pos++],F.data=[];break;case"IDAT":case"fdAT":for(J==="fdAT"&&(this.pos+=4,l-=4),o=(F!=null?F.data:void 0)||this.imgData,ue=0;0<=l?ue<l:ue>l;0<=l?++ue:--ue)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(g=this.palette.length/3,this.transparency.indexed=this.read(l),this.transparency.indexed.length>g)throw new Error("More transparent colors than palette size");if((te=g-this.transparency.indexed.length)>0)for(fe=0;0<=te?fe<te:fe>te;0<=te?++fe:--fe)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":D=(he=this.read(l)).indexOf(0),N=String.fromCharCode.apply(String,he.slice(0,D)),this.text[N]=String.fromCharCode.apply(String,he.slice(D+1));break;case"IEND":return F&&this.animation.frames.push(F),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ve=this.colorType)===4||ve===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(o){var l,s;for(s=[],l=0;0<=o?l<o:l>o;0<=o?++l:--l)s.push(this.data[this.pos++]);return s},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(o){var l=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*l),g=0,b=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function S(F,D,N,J){var te,he,ue,fe,ve,Se,Ge,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct,Et,Mt,vt,Dt,Pt=Math.ceil((b.width-F)/N),Xt=Math.ceil((b.height-D)/J),Te=b.width==Pt&&b.height==Xt;for(Pe=l*Pt,rt=Te?s:new Uint8Array(Pe*Xt),Se=o.length,Re=0,he=0;Re<Xt&&g<Se;){switch(o[g++]){case 0:for(fe=Ct=0;Ct<Pe;fe=Ct+=1)rt[he++]=o[g++];break;case 1:for(fe=Et=0;Et<Pe;fe=Et+=1)te=o[g++],ve=fe<l?0:rt[he-l],rt[he++]=(te+ve)%256;break;case 2:for(fe=Mt=0;Mt<Pe;fe=Mt+=1)te=o[g++],ue=(fe-fe%l)/l,Je=Re&&rt[(Re-1)*Pe+ue*l+fe%l],rt[he++]=(Je+te)%256;break;case 3:for(fe=vt=0;vt<Pe;fe=vt+=1)te=o[g++],ue=(fe-fe%l)/l,ve=fe<l?0:rt[he-l],Je=Re&&rt[(Re-1)*Pe+ue*l+fe%l],rt[he++]=(te+Math.floor((ve+Je)/2))%256;break;case 4:for(fe=Dt=0;Dt<Pe;fe=Dt+=1)te=o[g++],ue=(fe-fe%l)/l,ve=fe<l?0:rt[he-l],Re===0?Je=Xe=0:(Je=rt[(Re-1)*Pe+ue*l+fe%l],Xe=ue&&rt[(Re-1)*Pe+(ue-1)*l+fe%l]),Ge=ve+Je-Xe,He=Math.abs(Ge-ve),Ne=Math.abs(Ge-Je),at=Math.abs(Ge-Xe),$e=He<=Ne&&He<=at?ve:Ne<=at?Je:Xe,rt[he++]=(te+$e)%256;break;default:throw new Error("Invalid filter algorithm: "+o[g-1])}if(!Te){var Ze=((D+Re*J)*b.width+F)*l,tt=Re*Pe;for(fe=0;fe<Pt;fe+=1){for(var dt=0;dt<l;dt+=1)s[Ze++]=rt[tt++];Ze+=(N-1)*l}}Re++}}return o=jie(o),b.interlaceMethod==1?(S(0,0,8,8),S(4,0,8,8),S(0,4,4,8),S(2,0,4,4),S(0,2,2,4),S(1,0,2,2),S(0,1,1,2)):S(0,0,1,1),s},r.prototype.decodePalette=function(){var o,l,s,g,b,S,F,D,N;for(s=this.palette,S=this.transparency.indexed||[],b=new Uint8Array((S.length||0)+s.length),g=0,o=0,l=F=0,D=s.length;F<D;l=F+=3)b[g++]=s[l],b[g++]=s[l+1],b[g++]=s[l+2],b[g++]=(N=S[o++])!=null?N:255;return b},r.prototype.copyToImageData=function(o,l){var s,g,b,S,F,D,N,J,te,he,ue;if(g=this.colors,te=null,s=this.hasAlphaChannel,this.palette.length&&(te=(ue=this._decodedPalette)!=null?ue:this._decodedPalette=this.decodePalette(),g=4,s=!0),J=(b=o.data||o).length,F=te||l,S=D=0,g===1)for(;S<J;)N=te?4*l[S/4]:D,he=F[N++],b[S++]=he,b[S++]=he,b[S++]=he,b[S++]=s?F[N++]:255,D=N;else for(;S<J;)N=te?4*l[S/4]:D,b[S++]=F[N++],b[S++]=F[N++],b[S++]=F[N++],b[S++]=s?F[N++]:255,D=N},r.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(kr)==="[object Window]"){try{e=kr.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return n(),i=function(o){var l;if(n()===!0)return t.width=o.width,t.height=o.height,t.clearRect(0,0,o.width,o.height),t.putImageData(o,0,0),(l=new Image).src=e.toDataURL(),l;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(o){var l,s,g,b,S,F,D,N;if(this.animation){for(N=[],s=S=0,F=(D=this.animation.frames).length;S<F;s=++S)l=D[s],g=o.createImageData(l.width,l.height),b=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(g,b),l.imageData=g,N.push(l.image=i(g));return N}},r.prototype.renderFrame=function(o,l){var s,g,b;return s=(g=this.animation.frames)[l],b=g[l-1],l===0&&o.clearRect(0,0,this.width,this.height),(b!=null?b.disposeOp:void 0)===1?o.clearRect(b.xOffset,b.yOffset,b.width,b.height):(b!=null?b.disposeOp:void 0)===2&&o.putImageData(b.imageData,b.xOffset,b.yOffset),s.blendOp===0&&o.clearRect(s.xOffset,s.yOffset,s.width,s.height),o.drawImage(s.image,s.xOffset,s.yOffset)},r.prototype.animate=function(o){var l,s,g,b,S,F,D=this;return s=0,F=this.animation,b=F.numFrames,g=F.frames,S=F.numPlays,(l=function(){var N,J;if(N=s++%b,J=g[N],D.renderFrame(o,N),b>1&&s/b<S)return D.animation._timeout=setTimeout(l,J.delay)})()},r.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},r.prototype.render=function(o){var l,s;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,l=o.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(s=l.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),l.putImageData(s,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Are(i){var e=0;if(i[e++]!==71||i[e++]!==73||i[e++]!==70||i[e++]!==56||(i[e++]+1&253)!=56||i[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=i[e++]|i[e++]<<8,r=i[e++]|i[e++]<<8,n=i[e++],o=n>>7,l=1<<(7&n)+1;i[e++],i[e++];var s=null,g=null;o&&(s=e,g=l,e+=3*l);var b=!0,S=[],F=0,D=null,N=0,J=null;for(this.width=t,this.height=r;b&&e<i.length;)switch(i[e++]){case 33:switch(i[e++]){case 255:if(i[e]!==11||i[e+1]==78&&i[e+2]==69&&i[e+3]==84&&i[e+4]==83&&i[e+5]==67&&i[e+6]==65&&i[e+7]==80&&i[e+8]==69&&i[e+9]==50&&i[e+10]==46&&i[e+11]==48&&i[e+12]==3&&i[e+13]==1&&i[e+16]==0)e+=14,J=i[e++]|i[e++]<<8,e++;else for(e+=12;;){if(!((Re=i[e++])>=0))throw Error("Invalid block size");if(Re===0)break;e+=Re}break;case 249:if(i[e++]!==4||i[e+4]!==0)throw new Error("Invalid graphics extension block.");var te=i[e++];F=i[e++]|i[e++]<<8,D=i[e++],!(1&te)&&(D=null),N=te>>2&7,e++;break;case 254:for(;;){if(!((Re=i[e++])>=0))throw Error("Invalid block size");if(Re===0)break;e+=Re}break;default:throw new Error("Unknown graphic control label: 0x"+i[e-1].toString(16))}break;case 44:var he=i[e++]|i[e++]<<8,ue=i[e++]|i[e++]<<8,fe=i[e++]|i[e++]<<8,ve=i[e++]|i[e++]<<8,Se=i[e++],Ge=Se>>6&1,He=1<<(7&Se)+1,$e=s,Ne=g,at=!1;Se>>7&&(at=!0,$e=e,Ne=He,e+=3*He);var rt=e;for(e++;;){var Re;if(!((Re=i[e++])>=0))throw Error("Invalid block size");if(Re===0)break;e+=Re}S.push({x:he,y:ue,width:fe,height:ve,has_local_palette:at,palette_offset:$e,palette_size:Ne,data_offset:rt,data_length:e-rt,transparent_index:D,interlaced:!!Ge,delay:F,disposal:N});break;case 59:b=!1;break;default:throw new Error("Unknown gif block: 0x"+i[e-1].toString(16))}this.numFrames=function(){return S.length},this.loopCount=function(){return J},this.frameInfo=function(Pe){if(Pe<0||Pe>=S.length)throw new Error("Frame index out of range.");return S[Pe]},this.decodeAndBlitFrameBGRA=function(Pe,Je){var Xe=this.frameInfo(Pe),Ct=Xe.width*Xe.height,Et=new Uint8Array(Ct);q4(i,Xe.data_offset,Et,Ct);var Mt=Xe.palette_offset,vt=Xe.transparent_index;vt===null&&(vt=256);var Dt=Xe.width,Pt=t-Dt,Xt=Dt,Te=4*(Xe.y*t+Xe.x),Ze=4*((Xe.y+Xe.height)*t+Xe.x),tt=Te,dt=4*Pt;Xe.interlaced===!0&&(dt+=4*t*7);for(var pt=8,Bt=0,Ft=Et.length;Bt<Ft;++Bt){var Lt=Et[Bt];if(Xt===0&&(Xt=Dt,(tt+=dt)>=Ze&&(dt=4*Pt+4*t*(pt-1),tt=Te+(Dt+Pt)*(pt<<1),pt>>=1)),Lt===vt)tt+=4;else{var Gt=i[Mt+3*Lt],ri=i[Mt+3*Lt+1],mi=i[Mt+3*Lt+2];Je[tt++]=mi,Je[tt++]=ri,Je[tt++]=Gt,Je[tt++]=255}--Xt}},this.decodeAndBlitFrameRGBA=function(Pe,Je){var Xe=this.frameInfo(Pe),Ct=Xe.width*Xe.height,Et=new Uint8Array(Ct);q4(i,Xe.data_offset,Et,Ct);var Mt=Xe.palette_offset,vt=Xe.transparent_index;vt===null&&(vt=256);var Dt=Xe.width,Pt=t-Dt,Xt=Dt,Te=4*(Xe.y*t+Xe.x),Ze=4*((Xe.y+Xe.height)*t+Xe.x),tt=Te,dt=4*Pt;Xe.interlaced===!0&&(dt+=4*t*7);for(var pt=8,Bt=0,Ft=Et.length;Bt<Ft;++Bt){var Lt=Et[Bt];if(Xt===0&&(Xt=Dt,(tt+=dt)>=Ze&&(dt=4*Pt+4*t*(pt-1),tt=Te+(Dt+Pt)*(pt<<1),pt>>=1)),Lt===vt)tt+=4;else{var Gt=i[Mt+3*Lt],ri=i[Mt+3*Lt+1],mi=i[Mt+3*Lt+2];Je[tt++]=Gt,Je[tt++]=ri,Je[tt++]=mi,Je[tt++]=255}--Xt}}}function q4(i,e,t,r){for(var n=i[e++],o=1<<n,l=o+1,s=l+1,g=n+1,b=(1<<g)-1,S=0,F=0,D=0,N=i[e++],J=new Int32Array(4096),te=null;;){for(;S<16&&N!==0;)F|=i[e++]<<S,S+=8,N===1?N=i[e++]:--N;if(S<g)break;var he=F&b;if(F>>=g,S-=g,he!==o){if(he===l)break;for(var ue=he<s?he:te,fe=0,ve=ue;ve>o;)ve=J[ve]>>8,++fe;var Se=ve;if(D+fe+(ue!==he?1:0)>r)return void Fs.log("Warning, gif stream longer than expected.");t[D++]=Se;var Ge=D+=fe;for(ue!==he&&(t[D++]=Se),ve=ue;fe--;)ve=J[ve],t[--Ge]=255&ve,ve>>=8;te!==null&&s<4096&&(J[s++]=te<<8|Se,s>=b+1&&g<12&&(++g,b=b<<1|1)),te=he}else s=l+1,b=(1<<(g=n+1))-1,te=null}return D!==r&&Fs.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function DC(i){var e,t,r,n,o,l=Math.floor,s=new Array(64),g=new Array(64),b=new Array(64),S=new Array(64),F=new Array(65535),D=new Array(65535),N=new Array(64),J=new Array(64),te=[],he=0,ue=7,fe=new Array(64),ve=new Array(64),Se=new Array(64),Ge=new Array(256),He=new Array(2048),$e=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ne=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],at=[0,1,2,3,4,5,6,7,8,9,10,11],rt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Re=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Pe=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Je=[0,1,2,3,4,5,6,7,8,9,10,11],Xe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ct=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Et(Te,Ze){for(var tt=0,dt=0,pt=new Array,Bt=1;Bt<=16;Bt++){for(var Ft=1;Ft<=Te[Bt];Ft++)pt[Ze[dt]]=[],pt[Ze[dt]][0]=tt,pt[Ze[dt]][1]=Bt,dt++,tt++;tt*=2}return pt}function Mt(Te){for(var Ze=Te[0],tt=Te[1]-1;tt>=0;)Ze&1<<tt&&(he|=1<<ue),tt--,--ue<0&&(he==255?(vt(255),vt(0)):vt(he),ue=7,he=0)}function vt(Te){te.push(Te)}function Dt(Te){vt(Te>>8&255),vt(255&Te)}function Pt(Te,Ze,tt,dt,pt){for(var Bt,Ft=pt[0],Lt=pt[240],Gt=function(ti,ht){var qt,si,fi,ci,Wi,ir,dr,Sr,zt,Yi,ui=0;for(zt=0;zt<8;++zt){qt=ti[ui],si=ti[ui+1],fi=ti[ui+2],ci=ti[ui+3],Wi=ti[ui+4],ir=ti[ui+5],dr=ti[ui+6];var Kt=qt+(Sr=ti[ui+7]),Ji=qt-Sr,Vt=si+dr,Ci=si-dr,Li=fi+ir,jt=fi-ir,bi=ci+Wi,Yt=ci-Wi,yr=Kt+bi,Tr=Kt-bi,Qe=Vt+Li,Be=Vt-Li;ti[ui]=yr+Qe,ti[ui+4]=yr-Qe;var ae=.707106781*(Be+Tr);ti[ui+2]=Tr+ae,ti[ui+6]=Tr-ae;var ie=.382683433*((yr=Yt+jt)-(Be=Ci+Ji)),ce=.5411961*yr+ie,me=1.306562965*Be+ie,be=.707106781*(Qe=jt+Ci),Ee=Ji+be,xe=Ji-be;ti[ui+5]=xe+ce,ti[ui+3]=xe-ce,ti[ui+1]=Ee+me,ti[ui+7]=Ee-me,ui+=8}for(ui=0,zt=0;zt<8;++zt){qt=ti[ui],si=ti[ui+8],fi=ti[ui+16],ci=ti[ui+24],Wi=ti[ui+32],ir=ti[ui+40],dr=ti[ui+48];var Fe=qt+(Sr=ti[ui+56]),Ue=qt-Sr,je=si+dr,nt=si-dr,_t=fi+ir,St=fi-ir,ei=ci+Wi,$t=ci-Wi,Wt=Fe+ei,oi=Fe-ei,Ei=je+_t,Gi=je-_t;ti[ui]=Wt+Ei,ti[ui+32]=Wt-Ei;var Bi=.707106781*(Gi+oi);ti[ui+16]=oi+Bi,ti[ui+48]=oi-Bi;var Ni=.382683433*((Wt=$t+St)-(Gi=nt+Ue)),ot=.5411961*Wt+Ni,ii=1.306562965*Gi+Ni,Qt=.707106781*(Ei=St+nt),Qi=Ue+Qt,Ar=Ue-Qt;ti[ui+40]=Ar+ot,ti[ui+24]=Ar-ot,ti[ui+8]=Qi+ii,ti[ui+56]=Qi-ii,ui++}for(zt=0;zt<64;++zt)Yi=ti[zt]*ht[zt],N[zt]=Yi>0?Yi+.5|0:Yi-.5|0;return N}(Te,Ze),ri=0;ri<64;++ri)J[$e[ri]]=Gt[ri];var mi=J[0]-tt;tt=J[0],mi==0?Mt(dt[0]):(Mt(dt[D[Bt=32767+mi]]),Mt(F[Bt]));for(var yi=63;yi>0&&J[yi]==0;)yi--;if(yi==0)return Mt(Ft),tt;for(var Pi,Ot=1;Ot<=yi;){for(var lt=Ot;J[Ot]==0&&Ot<=yi;)++Ot;var wt=Ot-lt;if(wt>=16){Pi=wt>>4;for(var ki=1;ki<=Pi;++ki)Mt(Lt);wt&=15}Bt=32767+J[Ot],Mt(pt[(wt<<4)+D[Bt]]),Mt(F[Bt]),Ot++}return yi!=63&&Mt(Ft),tt}function Xt(Te){Te=Math.min(Math.max(Te,1),100),o!=Te&&(function(Ze){for(var tt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],dt=0;dt<64;dt++){var pt=l((tt[dt]*Ze+50)/100);pt=Math.min(Math.max(pt,1),255),s[$e[dt]]=pt}for(var Bt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ft=0;Ft<64;Ft++){var Lt=l((Bt[Ft]*Ze+50)/100);Lt=Math.min(Math.max(Lt,1),255),g[$e[Ft]]=Lt}for(var Gt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ri=0,mi=0;mi<8;mi++)for(var yi=0;yi<8;yi++)b[ri]=1/(s[$e[ri]]*Gt[mi]*Gt[yi]*8),S[ri]=1/(g[$e[ri]]*Gt[mi]*Gt[yi]*8),ri++}(Te<50?Math.floor(5e3/Te):Math.floor(200-2*Te)),o=Te)}this.encode=function(Te,Ze){Ze&&Xt(Ze),te=new Array,he=0,ue=7,Dt(65496),Dt(65504),Dt(16),vt(74),vt(70),vt(73),vt(70),vt(0),vt(1),vt(1),vt(0),Dt(1),Dt(1),vt(0),vt(0),function(){Dt(65499),Dt(132),vt(0);for(var si=0;si<64;si++)vt(s[si]);vt(1);for(var fi=0;fi<64;fi++)vt(g[fi])}(),function(si,fi){Dt(65472),Dt(17),vt(8),Dt(fi),Dt(si),vt(3),vt(1),vt(17),vt(0),vt(2),vt(17),vt(1),vt(3),vt(17),vt(1)}(Te.width,Te.height),function(){Dt(65476),Dt(418),vt(0);for(var si=0;si<16;si++)vt(Ne[si+1]);for(var fi=0;fi<=11;fi++)vt(at[fi]);vt(16);for(var ci=0;ci<16;ci++)vt(rt[ci+1]);for(var Wi=0;Wi<=161;Wi++)vt(Re[Wi]);vt(1);for(var ir=0;ir<16;ir++)vt(Pe[ir+1]);for(var dr=0;dr<=11;dr++)vt(Je[dr]);vt(17);for(var Sr=0;Sr<16;Sr++)vt(Xe[Sr+1]);for(var zt=0;zt<=161;zt++)vt(Ct[zt])}(),Dt(65498),Dt(12),vt(3),vt(1),vt(0),vt(2),vt(17),vt(3),vt(17),vt(0),vt(63),vt(0);var tt=0,dt=0,pt=0;he=0,ue=7,this.encode.displayName="_encode_";for(var Bt,Ft,Lt,Gt,ri,mi,yi,Pi,Ot,lt=Te.data,wt=Te.width,ki=Te.height,ti=4*wt,ht=0;ht<ki;){for(Bt=0;Bt<ti;){for(ri=ti*ht+Bt,yi=-1,Pi=0,Ot=0;Ot<64;Ot++)mi=ri+(Pi=Ot>>3)*ti+(yi=4*(7&Ot)),ht+Pi>=ki&&(mi-=ti*(ht+1+Pi-ki)),Bt+yi>=ti&&(mi-=Bt+yi-ti+4),Ft=lt[mi++],Lt=lt[mi++],Gt=lt[mi++],fe[Ot]=(He[Ft]+He[Lt+256>>0]+He[Gt+512>>0]>>16)-128,ve[Ot]=(He[Ft+768>>0]+He[Lt+1024>>0]+He[Gt+1280>>0]>>16)-128,Se[Ot]=(He[Ft+1280>>0]+He[Lt+1536>>0]+He[Gt+1792>>0]>>16)-128;tt=Pt(fe,b,tt,e,r),dt=Pt(ve,S,dt,t,n),pt=Pt(Se,S,pt,t,n),Bt+=32}ht+=8}if(ue>=0){var qt=[];qt[1]=ue+1,qt[0]=(1<<ue+1)-1,Mt(qt)}return Dt(65497),new Uint8Array(te)},i=i||50,function(){for(var Te=String.fromCharCode,Ze=0;Ze<256;Ze++)Ge[Ze]=Te(Ze)}(),e=Et(Ne,at),t=Et(Pe,Je),r=Et(rt,Re),n=Et(Xe,Ct),function(){for(var Te=1,Ze=2,tt=1;tt<=15;tt++){for(var dt=Te;dt<Ze;dt++)D[32767+dt]=tt,F[32767+dt]=[],F[32767+dt][1]=tt,F[32767+dt][0]=dt;for(var pt=-(Ze-1);pt<=-Te;pt++)D[32767+pt]=tt,F[32767+pt]=[],F[32767+pt][1]=tt,F[32767+pt][0]=Ze-1+pt;Te<<=1,Ze<<=1}}(),function(){for(var Te=0;Te<256;Te++)He[Te]=19595*Te,He[Te+256>>0]=38470*Te,He[Te+512>>0]=7471*Te+32768,He[Te+768>>0]=-11059*Te,He[Te+1024>>0]=-21709*Te,He[Te+1280>>0]=32768*Te+8421375,He[Te+1536>>0]=-27439*Te,He[Te+1792>>0]=-5329*Te}(),Xt(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function uh(i,e){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function $4(i){function e(Ne){if(!Ne)throw Error("assert :P")}function t(Ne,at,rt){for(var Re=0;4>Re;Re++)if(Ne[at+Re]!=rt.charCodeAt(Re))return!0;return!1}function r(Ne,at,rt,Re,Pe){for(var Je=0;Je<Pe;Je++)Ne[at+Je]=rt[Re+Je]}function n(Ne,at,rt,Re){for(var Pe=0;Pe<Re;Pe++)Ne[at+Pe]=rt}function o(Ne){return new Int32Array(Ne)}function l(Ne,at){for(var rt=[],Re=0;Re<Ne;Re++)rt.push(new at);return rt}function s(Ne,at){var rt=[];return function Re(Pe,Je,Xe){for(var Ct=Xe[Je],Et=0;Et<Ct&&(Pe.push(Xe.length>Je+1?[]:new at),!(Xe.length<Je+1));Et++)Re(Pe[Et],Je+1,Xe)}(rt,0,Ne),rt}var g=function(){var Ne=this;function at(w,I){for(var k=1<<I-1>>>0;w&k;)k>>>=1;return k?(w&k-1)+k:w}function rt(w,I,k,j,Y){e(!(j%k));do w[I+(j-=k)]=Y;while(0<j)}function Re(w,I,k,j,Y){if(e(2328>=Y),512>=Y)var X=o(512);else if((X=o(Y))==null)return 0;return function(ee,re,le,pe,ge,we){var De,Me,st=re,We=1<<le,ke=o(16),Ve=o(16);for(e(ge!=0),e(pe!=null),e(ee!=null),e(0<le),Me=0;Me<ge;++Me){if(15<pe[Me])return 0;++ke[pe[Me]]}if(ke[0]==ge)return 0;for(Ve[1]=0,De=1;15>De;++De){if(ke[De]>1<<De)return 0;Ve[De+1]=Ve[De]+ke[De]}for(Me=0;Me<ge;++Me)De=pe[Me],0<pe[Me]&&(we[Ve[De]++]=Me);if(Ve[15]==1)return(pe=new Pe).g=0,pe.value=we[0],rt(ee,st,1,We,pe),We;var gt,xt=-1,At=We-1,kt=0,Rt=1,Ai=1,Ht=1<<le;for(Me=0,De=1,ge=2;De<=le;++De,ge<<=1){if(Rt+=Ai<<=1,0>(Ai-=ke[De]))return 0;for(;0<ke[De];--ke[De])(pe=new Pe).g=De,pe.value=we[Me++],rt(ee,st+kt,ge,Ht,pe),kt=at(kt,De)}for(De=le+1,ge=2;15>=De;++De,ge<<=1){if(Rt+=Ai<<=1,0>(Ai-=ke[De]))return 0;for(;0<ke[De];--ke[De]){if(pe=new Pe,(kt&At)!=xt){for(st+=Ht,gt=1<<(xt=De)-le;15>xt&&!(0>=(gt-=ke[xt]));)++xt,gt<<=1;We+=Ht=1<<(gt=xt-le),ee[re+(xt=kt&At)].g=gt+le,ee[re+xt].value=st-re-xt}pe.g=De-le,pe.value=we[Me++],rt(ee,st+(kt>>le),ge,Ht,pe),kt=at(kt,De)}}return Rt!=2*Ve[15]-1?0:We}(w,I,k,j,Y,X)}function Pe(){this.value=this.g=0}function Je(){this.value=this.g=0}function Xe(){this.G=l(5,Pe),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(Ds,Je)}function Ct(w,I,k,j){e(w!=null),e(I!=null),e(2147483648>j),w.Ca=254,w.I=0,w.b=-8,w.Ka=0,w.oa=I,w.pa=k,w.Jd=I,w.Yc=k+j,w.Zc=4<=j?k+j-4+1:k,Bt(w)}function Et(w,I){for(var k=0;0<I--;)k|=Lt(w,128)<<I;return k}function Mt(w,I){var k=Et(w,I);return Ft(w)?-k:k}function vt(w,I,k,j){var Y,X=0;for(e(w!=null),e(I!=null),e(4294967288>j),w.Sb=j,w.Ra=0,w.u=0,w.h=0,4<j&&(j=4),Y=0;Y<j;++Y)X+=I[k+Y]<<8*Y;w.Ra=X,w.bb=j,w.oa=I,w.pa=k}function Dt(w){for(;8<=w.u&&w.bb<w.Sb;)w.Ra>>>=8,w.Ra+=w.oa[w.pa+w.bb]<<Ma-8>>>0,++w.bb,w.u-=8;tt(w)&&(w.h=1,w.u=0)}function Pt(w,I){if(e(0<=I),!w.h&&I<=$l){var k=Ze(w)&dl[I];return w.u+=I,Dt(w),k}return w.h=1,w.u=0}function Xt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Te(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Ze(w){return w.Ra>>>(w.u&Ma-1)>>>0}function tt(w){return e(w.bb<=w.Sb),w.h||w.bb==w.Sb&&w.u>Ma}function dt(w,I){w.u=I,w.h=tt(w)}function pt(w){w.u>=Pa&&(e(w.u>=Pa),Dt(w))}function Bt(w){e(w!=null&&w.oa!=null),w.pa<w.Zc?(w.I=(w.oa[w.pa++]|w.I<<8)>>>0,w.b+=8):(e(w!=null&&w.oa!=null),w.pa<w.Yc?(w.b+=8,w.I=w.oa[w.pa++]|w.I<<8):w.Ka?w.b=0:(w.I<<=8,w.b+=8,w.Ka=1))}function Ft(w){return Et(w,1)}function Lt(w,I){var k=w.Ca;0>w.b&&Bt(w);var j=w.b,Y=k*I>>>8,X=(w.I>>>j>Y)+0;for(X?(k-=Y,w.I-=Y+1<<j>>>0):k=Y+1,j=k,Y=0;256<=j;)Y+=8,j>>=8;return j=7^Y+Rs[j],w.b-=j,w.Ca=(k<<j)-1,X}function Gt(w,I,k){w[I+0]=k>>24&255,w[I+1]=k>>16&255,w[I+2]=k>>8&255,w[I+3]=k>>0&255}function ri(w,I){return w[I+0]<<0|w[I+1]<<8}function mi(w,I){return ri(w,I)|w[I+2]<<16}function yi(w,I){return ri(w,I)|ri(w,I+2)<<16}function Pi(w,I){var k=1<<I;return e(w!=null),e(0<I),w.X=o(k),w.X==null?0:(w.Mb=32-I,w.Xa=I,1)}function Ot(w,I){e(w!=null),e(I!=null),e(w.Xa==I.Xa),r(I.X,0,w.X,0,1<<I.Xa)}function lt(){this.X=[],this.Xa=this.Mb=0}function wt(w,I,k,j){e(k!=null),e(j!=null);var Y=k[0],X=j[0];return Y==0&&(Y=(w*X+I/2)/I),X==0&&(X=(I*Y+w/2)/w),0>=Y||0>=X?0:(k[0]=Y,j[0]=X,1)}function ki(w,I){return w+(1<<I)-1>>>I}function ti(w,I){return((4278255360&w)+(4278255360&I)>>>0&4278255360)+((16711935&w)+(16711935&I)>>>0&16711935)>>>0}function ht(w,I){Ne[I]=function(k,j,Y,X,ee,re,le){var pe;for(pe=0;pe<ee;++pe){var ge=Ne[w](re[le+pe-1],Y,X+pe);re[le+pe]=ti(k[j+pe],ge)}}}function qt(){this.ud=this.hd=this.jd=0}function si(w,I){return((4278124286&(w^I))>>>1)+(w&I)>>>0}function fi(w){return 0<=w&&256>w?w:0>w?0:255<w?255:void 0}function ci(w,I){return fi(w+(w-I+.5>>1))}function Wi(w,I,k){return Math.abs(I-k)-Math.abs(w-k)}function ir(w,I,k,j,Y,X,ee){for(j=X[ee-1],k=0;k<Y;++k)X[ee+k]=j=ti(w[I+k],j)}function dr(w,I,k,j,Y){var X;for(X=0;X<k;++X){var ee=w[I+X],re=ee>>8&255,le=16711935&(le=(le=16711935&ee)+((re<<16)+re));j[Y+X]=(4278255360&ee)+le>>>0}}function Sr(w,I){I.jd=w>>0&255,I.hd=w>>8&255,I.ud=w>>16&255}function zt(w,I,k,j,Y,X){var ee;for(ee=0;ee<j;++ee){var re=I[k+ee],le=re>>>8,pe=re,ge=255&(ge=(ge=re>>>16)+((w.jd<<24>>24)*(le<<24>>24)>>>5));pe=255&(pe=(pe=pe+((w.hd<<24>>24)*(le<<24>>24)>>>5))+((w.ud<<24>>24)*(ge<<24>>24)>>>5)),Y[X+ee]=(4278255360&re)+(ge<<16)+pe}}function Yi(w,I,k,j,Y){Ne[I]=function(X,ee,re,le,pe,ge,we,De,Me){for(le=we;le<De;++le)for(we=0;we<Me;++we)pe[ge++]=Y(re[j(X[ee++])])},Ne[w]=function(X,ee,re,le,pe,ge,we){var De=8>>X.b,Me=X.Ea,st=X.K[0],We=X.w;if(8>De)for(X=(1<<X.b)-1,We=(1<<De)-1;ee<re;++ee){var ke,Ve=0;for(ke=0;ke<Me;++ke)ke&X||(Ve=j(le[pe++])),ge[we++]=Y(st[Ve&We]),Ve>>=De}else Ne["VP8LMapColor"+k](le,pe,st,We,ge,we,ee,re,Me)}}function ui(w,I,k,j,Y){for(k=I+k;I<k;){var X=w[I++];j[Y++]=X>>16&255,j[Y++]=X>>8&255,j[Y++]=X>>0&255}}function Kt(w,I,k,j,Y){for(k=I+k;I<k;){var X=w[I++];j[Y++]=X>>16&255,j[Y++]=X>>8&255,j[Y++]=X>>0&255,j[Y++]=X>>24&255}}function Ji(w,I,k,j,Y){for(k=I+k;I<k;){var X=(ee=w[I++])>>16&240|ee>>12&15,ee=ee>>0&240|ee>>28&15;j[Y++]=X,j[Y++]=ee}}function Vt(w,I,k,j,Y){for(k=I+k;I<k;){var X=(ee=w[I++])>>16&248|ee>>13&7,ee=ee>>5&224|ee>>3&31;j[Y++]=X,j[Y++]=ee}}function Ci(w,I,k,j,Y){for(k=I+k;I<k;){var X=w[I++];j[Y++]=X>>0&255,j[Y++]=X>>8&255,j[Y++]=X>>16&255}}function Li(w,I,k,j,Y,X){if(X==0)for(k=I+k;I<k;)Gt(j,((X=w[I++])[0]>>24|X[1]>>8&65280|X[2]<<8&16711680|X[3]<<24)>>>0),Y+=32;else r(j,Y,w,I,k)}function jt(w,I){Ne[I][0]=Ne[w+"0"],Ne[I][1]=Ne[w+"1"],Ne[I][2]=Ne[w+"2"],Ne[I][3]=Ne[w+"3"],Ne[I][4]=Ne[w+"4"],Ne[I][5]=Ne[w+"5"],Ne[I][6]=Ne[w+"6"],Ne[I][7]=Ne[w+"7"],Ne[I][8]=Ne[w+"8"],Ne[I][9]=Ne[w+"9"],Ne[I][10]=Ne[w+"10"],Ne[I][11]=Ne[w+"11"],Ne[I][12]=Ne[w+"12"],Ne[I][13]=Ne[w+"13"],Ne[I][14]=Ne[w+"0"],Ne[I][15]=Ne[w+"0"]}function bi(w){return w==_n||w==Es||w==Ro||w==Zl}function Yt(){this.eb=[],this.size=this.A=this.fb=0}function yr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Tr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Yt,this.f.kb=new yr,this.sd=null}function Qe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Be(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ae(w){return alert("todo:WebPSamplerProcessPlane"),w.T}function ie(w,I){var k=w.T,j=I.ba.f.RGBA,Y=j.eb,X=j.fb+w.ka*j.A,ee=Yr[I.ba.S],re=w.y,le=w.O,pe=w.f,ge=w.N,we=w.ea,De=w.W,Me=I.cc,st=I.dc,We=I.Mc,ke=I.Nc,Ve=w.ka,gt=w.ka+w.T,xt=w.U,At=xt+1>>1;for(Ve==0?ee(re,le,null,null,pe,ge,we,De,pe,ge,we,De,Y,X,null,null,xt):(ee(I.ec,I.fc,re,le,Me,st,We,ke,pe,ge,we,De,Y,X-j.A,Y,X,xt),++k);Ve+2<gt;Ve+=2)Me=pe,st=ge,We=we,ke=De,ge+=w.Rc,De+=w.Rc,X+=2*j.A,ee(re,(le+=2*w.fa)-w.fa,re,le,Me,st,We,ke,pe,ge,we,De,Y,X-j.A,Y,X,xt);return le+=w.fa,w.j+gt<w.o?(r(I.ec,I.fc,re,le,xt),r(I.cc,I.dc,pe,ge,At),r(I.Mc,I.Nc,we,De,At),k--):1&gt||ee(re,le,null,null,pe,ge,we,De,pe,ge,we,De,Y,X+j.A,null,null,xt),k}function ce(w,I,k){var j=w.F,Y=[w.J];if(j!=null){var X=w.U,ee=I.ba.S,re=ee==Nc||ee==Ro;I=I.ba.f.RGBA;var le=[0],pe=w.ka;le[0]=w.T,w.Kb&&(pe==0?--le[0]:(--pe,Y[0]-=w.width),w.j+w.ka+w.T==w.o&&(le[0]=w.o-w.j-pe));var ge=I.eb;pe=I.fb+pe*I.A,w=Yo(j,Y[0],w.width,X,le,ge,pe+(re?0:3),I.A),e(k==le),w&&bi(ee)&&Ra(ge,pe,re,X,le,I.A)}return 0}function me(w){var I=w.ma,k=I.ba.S,j=11>k,Y=k==Xl||k==Uc||k==Nc||k==zc||k==12||bi(k);if(I.memory=null,I.Ib=null,I.Jb=null,I.Nd=null,!ql(I.Oa,w,Y?11:12))return 0;if(Y&&bi(k)&&gi(),w.da)alert("todo:use_scaling");else{if(j){if(I.Ib=ae,w.Kb){if(k=w.U+1>>1,I.memory=o(w.U+2*k),I.memory==null)return 0;I.ec=I.memory,I.fc=0,I.cc=I.ec,I.dc=I.fc+w.U,I.Mc=I.cc,I.Nc=I.dc+k,I.Ib=ie,gi()}}else alert("todo:EmitYUV");Y&&(I.Jb=ce,j&&bt())}if(j&&!x){for(w=0;256>w;++w)L[w]=89858*(w-128)+xa>>_o,a[w]=-22014*(w-128)+xa,y[w]=-45773*(w-128),O[w]=113618*(w-128)+xa>>_o;for(w=_l;w<jr;++w)I=76283*(w-16)+xa>>_o,d[w-_l]=io(I,255),_[w-_l]=io(I+8>>4,15);x=1}return 1}function be(w){var I=w.ma,k=w.U,j=w.T;return e(!(1&w.ka)),0>=k||0>=j?0:(k=I.Ib(w,I),I.Jb!=null&&I.Jb(w,I,k),I.Dc+=k,1)}function Ee(w){w.ma.memory=null}function xe(w,I,k,j){return Pt(w,8)!=47?0:(I[0]=Pt(w,14)+1,k[0]=Pt(w,14)+1,j[0]=Pt(w,1),Pt(w,3)!=0?0:!w.h)}function Fe(w,I){if(4>w)return w+1;var k=w-2>>1;return(2+(1&w)<<k)+Pt(I,k)+1}function Ue(w,I){return 120<I?I-120:1<=(k=((k=xi[I-1])>>4)*w+(8-(15&k)))?k:1;var k}function je(w,I,k){var j=Ze(k),Y=w[I+=255&j].g-8;return 0<Y&&(dt(k,k.u+8),j=Ze(k),I+=w[I].value,I+=j&(1<<Y)-1),dt(k,k.u+w[I].g),w[I].value}function nt(w,I,k){return k.g+=w.g,k.value+=w.value<<I>>>0,e(8>=k.g),w.g}function _t(w,I,k){var j=w.xc;return e((I=j==0?0:w.vc[w.md*(k>>j)+(I>>j)])<w.Wb),w.Ya[I]}function St(w,I,k,j){var Y=w.ab,X=w.c*I,ee=w.C;I=ee+I;var re=k,le=j;for(j=w.Ta,k=w.Ua;0<Y--;){var pe=w.gc[Y],ge=ee,we=I,De=re,Me=le,st=(le=j,re=k,pe.Ea);switch(e(ge<we),e(we<=pe.nc),pe.hc){case 2:an(De,Me,(we-ge)*st,le,re);break;case 0:var We=ge,ke=we,Ve=le,gt=re,xt=(Ht=pe).Ea;We==0&&(Ou(De,Me,null,null,1,Ve,gt),ir(De,Me+1,0,0,xt-1,Ve,gt+1),Me+=xt,gt+=xt,++We);for(var At=1<<Ht.b,kt=At-1,Rt=ki(xt,Ht.b),Ai=Ht.K,Ht=Ht.w+(We>>Ht.b)*Rt;We<ke;){var vi=Ai,Ti=Ht,er=1;for(In(De,Me,Ve,gt-xt,1,Ve,gt);er<xt;){var Ii=(er&~kt)+At;Ii>xt&&(Ii=xt),(0,po[vi[Ti++]>>8&15])(De,Me+ +er,Ve,gt+er-xt,Ii-er,Ve,gt+er),er=Ii}Me+=xt,gt+=xt,++We&kt||(Ht+=Rt)}we!=pe.nc&&r(le,re-st,le,re+(we-ge-1)*st,st);break;case 1:for(st=De,ke=Me,xt=(De=pe.Ea)-(gt=De&~(Ve=(Me=1<<pe.b)-1)),We=ki(De,pe.b),At=pe.K,pe=pe.w+(ge>>pe.b)*We;ge<we;){for(kt=At,Rt=pe,Ai=new qt,Ht=ke+gt,vi=ke+De;ke<Ht;)Sr(kt[Rt++],Ai),os(Ai,st,ke,Me,le,re),ke+=Me,re+=Me;ke<vi&&(Sr(kt[Rt++],Ai),os(Ai,st,ke,xt,le,re),ke+=xt,re+=xt),++ge&Ve||(pe+=We)}break;case 3:if(De==le&&Me==re&&0<pe.b){for(ke=le,De=st=re+(we-ge)*st-(gt=(we-ge)*ki(pe.Ea,pe.b)),Me=le,Ve=re,We=[],gt=(xt=gt)-1;0<=gt;--gt)We[gt]=Me[Ve+gt];for(gt=xt-1;0<=gt;--gt)ke[De+gt]=We[gt];pn(pe,ge,we,le,st,le,re)}else pn(pe,ge,we,De,Me,le,re)}re=j,le=k}le!=k&&r(j,k,re,le,X)}function ei(w,I){var k=w.V,j=w.Ba+w.c*w.C,Y=I-w.C;if(e(I<=w.l.o),e(16>=Y),0<Y){var X=w.l,ee=w.Ta,re=w.Ua,le=X.width;if(St(w,Y,k,j),Y=re=[re],e((k=w.C)<(j=I)),e(X.v<X.va),j>X.o&&(j=X.o),k<X.j){var pe=X.j-k;k=X.j,Y[0]+=pe*le}if(k>=j?k=0:(Y[0]+=4*X.v,X.ka=k-X.j,X.U=X.va-X.v,X.T=j-k,k=1),k){if(re=re[0],11>(k=w.ca).S){var ge=k.f.RGBA,we=(j=k.S,Y=X.U,X=X.T,pe=ge.eb,ge.A),De=X;for(ge=ge.fb+w.Ma*ge.A;0<De--;){var Me=ee,st=re,We=Y,ke=pe,Ve=ge;switch(j){case kc:as(Me,st,We,ke,Ve);break;case Xl:Po(Me,st,We,ke,Ve);break;case _n:Po(Me,st,We,ke,Ve),Ra(ke,Ve,0,We,1,0);break;case Oc:gl(Me,st,We,ke,Ve);break;case Uc:Li(Me,st,We,ke,Ve,1);break;case Es:Li(Me,st,We,ke,Ve,1),Ra(ke,Ve,0,We,1,0);break;case Nc:Li(Me,st,We,ke,Ve,0);break;case Ro:Li(Me,st,We,ke,Ve,0),Ra(ke,Ve,1,We,1,0);break;case zc:Fo(Me,st,We,ke,Ve);break;case Zl:Fo(Me,st,We,ke,Ve),mo(ke,Ve,We,1,0);break;case rl:ya(Me,st,We,ke,Ve);break;default:e(0)}re+=le,ge+=we}w.Ma+=X}else alert("todo:EmitRescaledRowsYUVA");e(w.Ma<=k.height)}}w.C=I,e(w.C<=w.i)}function $t(w){var I;if(0<w.ua)return 0;for(I=0;I<w.Wb;++I){var k=w.Ya[I].G,j=w.Ya[I].H;if(0<k[1][j[1]+0].g||0<k[2][j[2]+0].g||0<k[3][j[3]+0].g)return 0}return 1}function Wt(w,I,k,j,Y,X){if(w.Z!=0){var ee=w.qd,re=w.rd;for(e(Os[w.Z]!=null);I<k;++I)Os[w.Z](ee,re,j,Y,j,Y,X),ee=j,re=Y,Y+=X;w.qd=ee,w.rd=re}}function oi(w,I){var k=w.l.ma,j=k.Z==0||k.Z==1?w.l.j:w.C;if(j=w.C<j?j:w.C,e(I<=w.l.o),I>j){var Y=w.l.width,X=k.ca,ee=k.tb+Y*j,re=w.V,le=w.Ba+w.c*j,pe=w.gc;e(w.ab==1),e(pe[0].hc==3),fl(pe[0],j,I,re,le,X,ee),Wt(k,j,I,X,ee,Y)}w.C=w.Ma=I}function Ei(w,I,k,j,Y,X,ee){var re=w.$/j,le=w.$%j,pe=w.m,ge=w.s,we=k+w.$,De=we;Y=k+j*Y;var Me=k+j*X,st=280+ge.ua,We=w.Pb?re:16777216,ke=0<ge.ua?ge.Wa:null,Ve=ge.wc,gt=we<Me?_t(ge,le,re):null;e(w.C<X),e(Me<=Y);var xt=!1;e:for(;;){for(;xt||we<Me;){var At=0;if(re>=We){var kt=we-k;e((We=w).Pb),We.wd=We.m,We.xd=kt,0<We.s.ua&&Ot(We.s.Wa,We.s.vb),We=re+Jl}if(le&Ve||(gt=_t(ge,le,re)),e(gt!=null),gt.Qb&&(I[we]=gt.qb,xt=!0),!xt)if(pt(pe),gt.jc){At=pe,kt=I;var Rt=we,Ai=gt.pd[Ze(At)&Ds-1];e(gt.jc),256>Ai.g?(dt(At,At.u+Ai.g),kt[Rt]=Ai.value,At=0):(dt(At,At.u+Ai.g-256),e(256<=Ai.value),At=Ai.value),At==0&&(xt=!0)}else At=je(gt.G[0],gt.H[0],pe);if(pe.h)break;if(xt||256>At){if(!xt)if(gt.nd)I[we]=(gt.qb|At<<8)>>>0;else{if(pt(pe),xt=je(gt.G[1],gt.H[1],pe),pt(pe),kt=je(gt.G[2],gt.H[2],pe),Rt=je(gt.G[3],gt.H[3],pe),pe.h)break;I[we]=(Rt<<24|xt<<16|At<<8|kt)>>>0}if(xt=!1,++we,++le>=j&&(le=0,++re,ee!=null&&re<=X&&!(re%16)&&ee(w,re),ke!=null))for(;De<we;)At=I[De++],ke.X[(506832829*At&4294967295)>>>ke.Mb]=At}else if(280>At){if(At=Fe(At-256,pe),kt=je(gt.G[4],gt.H[4],pe),pt(pe),kt=Ue(j,kt=Fe(kt,pe)),pe.h)break;if(we-k<kt||Y-we<At)break e;for(Rt=0;Rt<At;++Rt)I[we+Rt]=I[we+Rt-kt];for(we+=At,le+=At;le>=j;)le-=j,++re,ee!=null&&re<=X&&!(re%16)&&ee(w,re);if(e(we<=Y),le&Ve&&(gt=_t(ge,le,re)),ke!=null)for(;De<we;)At=I[De++],ke.X[(506832829*At&4294967295)>>>ke.Mb]=At}else{if(!(At<st))break e;for(xt=At-280,e(ke!=null);De<we;)At=I[De++],ke.X[(506832829*At&4294967295)>>>ke.Mb]=At;At=we,e(!(xt>>>(kt=ke).Xa)),I[At]=kt.X[xt],xt=!0}xt||e(pe.h==tt(pe))}if(w.Pb&&pe.h&&we<Y)e(w.m.h),w.a=5,w.m=w.wd,w.$=w.xd,0<w.s.ua&&Ot(w.s.vb,w.s.Wa);else{if(pe.h)break e;ee!=null&&ee(w,re>X?X:re),w.a=0,w.$=we-k}return 1}return w.a=3,0}function Gi(w){e(w!=null),w.vc=null,w.yc=null,w.Ya=null;var I=w.Wa;I!=null&&(I.X=null),w.vb=null,e(w!=null)}function Bi(){var w=new il;return w==null?null:(w.a=0,w.xb=du,jt("Predictor","VP8LPredictors"),jt("Predictor","VP8LPredictors_C"),jt("PredictorAdd","VP8LPredictorsAdd"),jt("PredictorAdd","VP8LPredictorsAdd_C"),an=dr,os=zt,as=ui,Po=Kt,Fo=Ji,ya=Vt,gl=Ci,Ne.VP8LMapColor32b=ts,Ne.VP8LMapColor8b=pl,w)}function Ni(w,I,k,j,Y){var X=1,ee=[w],re=[I],le=j.m,pe=j.s,ge=null,we=0;e:for(;;){if(k)for(;X&&Pt(le,1);){var De=ee,Me=re,st=j,We=1,ke=st.m,Ve=st.gc[st.ab],gt=Pt(ke,2);if(st.Oc&1<<gt)X=0;else{switch(st.Oc|=1<<gt,Ve.hc=gt,Ve.Ea=De[0],Ve.nc=Me[0],Ve.K=[null],++st.ab,e(4>=st.ab),gt){case 0:case 1:Ve.b=Pt(ke,3)+2,We=Ni(ki(Ve.Ea,Ve.b),ki(Ve.nc,Ve.b),0,st,Ve.K),Ve.K=Ve.K[0];break;case 3:var xt,At=Pt(ke,8)+1,kt=16<At?0:4<At?1:2<At?2:3;if(De[0]=ki(Ve.Ea,kt),Ve.b=kt,xt=We=Ni(At,1,0,st,Ve.K)){var Rt,Ai=At,Ht=Ve,vi=1<<(8>>Ht.b),Ti=o(vi);if(Ti==null)xt=0;else{var er=Ht.K[0],Ii=Ht.w;for(Ti[0]=Ht.K[0][0],Rt=1;Rt<1*Ai;++Rt)Ti[Rt]=ti(er[Ii+Rt],Ti[Rt-1]);for(;Rt<4*vi;++Rt)Ti[Rt]=0;Ht.K[0]=null,Ht.K[0]=Ti,xt=1}}We=xt;break;case 2:break;default:e(0)}X=We}}if(ee=ee[0],re=re[0],X&&Pt(le,1)&&!(X=1<=(we=Pt(le,4))&&11>=we)){j.a=3;break e}var _r;if(_r=X)t:{var pr,qi,Nr,nn=j,Pr=ee,Wr=re,Er=we,is=k,zr=nn.m,gr=nn.s,vr=[null],ar=1,cn=0,$r=or[Er];i:for(;;){if(is&&Pt(zr,1)){var Xr=Pt(zr,3)+2,Fn=ki(Pr,Xr),Wn=ki(Wr,Xr),vl=Fn*Wn;if(!Ni(Fn,Wn,0,nn,vr))break i;for(vr=vr[0],gr.xc=Xr,pr=0;pr<vl;++pr){var Kr=vr[pr]>>8&65535;vr[pr]=Kr,Kr>=ar&&(ar=Kr+1)}}if(zr.h)break i;for(qi=0;5>qi;++qi){var vn=hu[qi];!qi&&0<Er&&(vn+=1<<Er),cn<vn&&(cn=vn)}var ia=l(ar*$r,Pe),Us=ar,Xs=l(Us,Xe);if(Xs==null)var Uo=null;else e(65536>=Us),Uo=Xs;var ao=o(cn);if(Uo==null||ao==null||ia==null){nn.a=1;break i}var zu=ia;for(pr=Nr=0;pr<ar;++pr){var Oa=Uo[pr],Mn=Oa.G,yc=Oa.H,pu=0,Hc=1,Gc=0;for(qi=0;5>qi;++qi){vn=hu[qi],Mn[qi]=zu,yc[qi]=Nr,!qi&&0<Er&&(vn+=1<<Er);n:{var Qu,sA=vn,jc=nn,jA=ao,oA=zu,kd=Nr,Vu=0,gu=jc.m,Od=Pt(gu,1);if(n(jA,0,0,sA),Od){var Am=Pt(gu,1)+1,ra=Pt(gu,1),ec=Pt(gu,ra==0?1:8);jA[ec]=1,Am==2&&(jA[ec=Pt(gu,8)]=1);var aA=1}else{var wh=o(19),mu=Pt(gu,4)+4;if(19<mu){jc.a=3;var Bh=0;break n}for(Qu=0;Qu<mu;++Qu)wh[Ws[Qu]]=Pt(gu,3);var Ch=void 0,lA=void 0,Yf=jc,na=wh,qc=sA,Ud=jA,cA=0,bl=Yf.m,Nd=8,yu=l(128,Pe);r:for(;Re(yu,0,7,na,19);){if(Pt(bl,1)){var xl=2+2*Pt(bl,3);if((Ch=2+Pt(bl,xl))>qc)break r}else Ch=qc;for(lA=0;lA<qc&&Ch--;){pt(bl);var zd=yu[0+(127&Ze(bl))];dt(bl,bl.u+zd.g);var Eh=zd.value;if(16>Eh)Ud[lA++]=Eh,Eh!=0&&(Nd=Eh);else{var ep=Eh==16,dm=Eh-16,tp=mc[dm],ip=Pt(bl,Uu[dm])+tp;if(lA+ip>qc)break r;for(var rp=ep?Nd:0;0<ip--;)Ud[lA++]=rp}}cA=1;break r}cA||(Yf.a=3),aA=cA}(aA=aA&&!gu.h)&&(Vu=Re(oA,kd,8,jA,sA)),aA&&Vu!=0?Bh=Vu:(jc.a=3,Bh=0)}if(Bh==0)break i;if(Hc&&ba[qi]==1&&(Hc=zu[Nr].g==0),pu+=zu[Nr].g,Nr+=Bh,3>=qi){var _c,No=ao[0];for(_c=1;_c<vn;++_c)ao[_c]>No&&(No=ao[_c]);Gc+=No}}if(Oa.nd=Hc,Oa.Qb=0,Hc&&(Oa.qb=(Mn[3][yc[3]+0].value<<24|Mn[1][yc[1]+0].value<<16|Mn[2][yc[2]+0].value)>>>0,pu==0&&256>Mn[0][yc[0]+0].value&&(Oa.Qb=1,Oa.qb+=Mn[0][yc[0]+0].value<<8)),Oa.jc=!Oa.Qb&&6>Gc,Oa.jc){var uA,Ua=Oa;for(uA=0;uA<Ds;++uA){var wl=uA,Hu=Ua.pd[wl],Qd=Ua.G[0][Ua.H[0]+wl];256<=Qd.value?(Hu.g=Qd.g+256,Hu.value=Qd.value):(Hu.g=0,Hu.value=0,wl>>=nt(Qd,8,Hu),wl>>=nt(Ua.G[1][Ua.H[1]+wl],16,Hu),wl>>=nt(Ua.G[2][Ua.H[2]+wl],0,Hu),nt(Ua.G[3][Ua.H[3]+wl],24,Hu))}}}gr.vc=vr,gr.Wb=ar,gr.Ya=Uo,gr.yc=ia,_r=1;break t}_r=0}if(!(X=_r)){j.a=3;break e}if(0<we){if(pe.ua=1<<we,!Pi(pe.Wa,we)){j.a=1,X=0;break e}}else pe.ua=0;var np=j,fm=ee,sp=re,hA=np.s,Vd=hA.xc;if(np.c=fm,np.i=sp,hA.md=ki(fm,Vd),hA.wc=Vd==0?-1:(1<<Vd)-1,k){j.xb=ko;break e}if((ge=o(ee*re))==null){j.a=1,X=0;break e}X=(X=Ei(j,ge,0,ee,re,re,null))&&!le.h;break e}return X?(Y!=null?Y[0]=ge:(e(ge==null),e(k)),j.$=0,k||Gi(pe)):Gi(pe),X}function ot(w,I){var k=w.c*w.i,j=k+I+16*I;return e(w.c<=I),w.V=o(j),w.V==null?(w.Ta=null,w.Ua=0,w.a=1,0):(w.Ta=w.V,w.Ua=w.Ba+k+I,1)}function ii(w,I){var k=w.C,j=I-k,Y=w.V,X=w.Ba+w.c*k;for(e(I<=w.l.o);0<j;){var ee=16<j?16:j,re=w.l.ma,le=w.l.width,pe=le*ee,ge=re.ca,we=re.tb+le*k,De=w.Ta,Me=w.Ua;St(w,ee,Y,X),Ui(De,Me,ge,we,pe),Wt(re,k,k+ee,ge,we,le),j-=ee,Y+=ee*w.c,k+=ee}e(k==I),w.C=w.Ma=I}function Qt(){this.ub=this.yd=this.td=this.Rb=0}function Qi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Ar(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function on(){this.Yb=function(){var w=[];return function I(k,j,Y){for(var X=Y[j],ee=0;ee<X&&(k.push(Y.length>j+1?[]:0),!(Y.length<j+1));ee++)I(k[ee],j+1,Y)}(w,0,[3,11]),w}()}function xn(){this.jb=o(3),this.Wc=s([4,8],on),this.Xc=s([4,17],on)}function hr(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function mn(){this.ld=this.La=this.dd=this.tc=0}function yn(){this.Na=this.la=0}function cr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function On(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ms(){this.uc=this.M=this.Nb=0,this.wa=Array(new mn),this.Y=0,this.ya=Array(new On),this.aa=0,this.l=new To}function Vr(){this.y=o(16),this.f=o(8),this.ea=o(8)}function wn(){this.cb=this.a=0,this.sc="",this.m=new Xt,this.Od=new Qt,this.Kc=new Qi,this.ed=new hr,this.Qa=new Ar,this.Ic=this.$c=this.Aa=0,this.D=new ms,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,Xt),this.ia=0,this.pb=l(4,cr),this.Pa=new xn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Vr),this.Hd=0,this.rb=Array(new yn),this.sb=0,this.wa=Array(new mn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new On),this.L=this.aa=0,this.gd=s([4,2],mn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function To(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function hs(){var w=new wn;return w!=null&&(w.a=0,w.sc="OK",w.cb=0,w.Xb=0,Ss||(Ss=fr)),w}function Xi(w,I,k){return w.a==0&&(w.a=I,w.sc=k,w.cb=0),0}function eo(w,I,k){return 3<=k&&w[I+0]==157&&w[I+1]==1&&w[I+2]==42}function Cs(w,I){if(w==null)return 0;if(w.a=0,w.sc="OK",I==null)return Xi(w,2,"null VP8Io passed to VP8GetHeaders()");var k=I.data,j=I.w,Y=I.ha;if(4>Y)return Xi(w,7,"Truncated header.");var X=k[j+0]|k[j+1]<<8|k[j+2]<<16,ee=w.Od;if(ee.Rb=!(1&X),ee.td=X>>1&7,ee.yd=X>>4&1,ee.ub=X>>5,3<ee.td)return Xi(w,3,"Incorrect keyframe parameters.");if(!ee.yd)return Xi(w,4,"Frame not displayable.");j+=3,Y-=3;var re=w.Kc;if(ee.Rb){if(7>Y)return Xi(w,7,"cannot parse picture header");if(!eo(k,j,Y))return Xi(w,3,"Bad code word");re.c=16383&(k[j+4]<<8|k[j+3]),re.Td=k[j+4]>>6,re.i=16383&(k[j+6]<<8|k[j+5]),re.Ud=k[j+6]>>6,j+=7,Y-=7,w.za=re.c+15>>4,w.Ub=re.i+15>>4,I.width=re.c,I.height=re.i,I.Da=0,I.j=0,I.v=0,I.va=I.width,I.o=I.height,I.da=0,I.ib=I.width,I.hb=I.height,I.U=I.width,I.T=I.height,n((X=w.Pa).jb,0,255,X.jb.length),e((X=w.Qa)!=null),X.Cb=0,X.Bb=0,X.Fb=1,n(X.Zb,0,0,X.Zb.length),n(X.Lb,0,0,X.Lb)}if(ee.ub>Y)return Xi(w,7,"bad partition length");Ct(X=w.m,k,j,ee.ub),j+=ee.ub,Y-=ee.ub,ee.Rb&&(re.Ld=Ft(X),re.Kd=Ft(X)),re=w.Qa;var le,pe=w.Pa;if(e(X!=null),e(re!=null),re.Cb=Ft(X),re.Cb){if(re.Bb=Ft(X),Ft(X)){for(re.Fb=Ft(X),le=0;4>le;++le)re.Zb[le]=Ft(X)?Mt(X,7):0;for(le=0;4>le;++le)re.Lb[le]=Ft(X)?Mt(X,6):0}if(re.Bb)for(le=0;3>le;++le)pe.jb[le]=Ft(X)?Et(X,8):255}else re.Bb=0;if(X.Ka)return Xi(w,3,"cannot parse segment header");if((re=w.ed).zd=Ft(X),re.Tb=Et(X,6),re.wb=Et(X,3),re.Pc=Ft(X),re.Pc&&Ft(X)){for(pe=0;4>pe;++pe)Ft(X)&&(re.vd[pe]=Mt(X,6));for(pe=0;4>pe;++pe)Ft(X)&&(re.od[pe]=Mt(X,6))}if(w.L=re.Tb==0?0:re.zd?1:2,X.Ka)return Xi(w,3,"cannot parse filter header");var ge=Y;if(Y=le=j,j=le+ge,re=ge,w.Xb=(1<<Et(w.m,2))-1,ge<3*(pe=w.Xb))k=7;else{for(le+=3*pe,re-=3*pe,ge=0;ge<pe;++ge){var we=k[Y+0]|k[Y+1]<<8|k[Y+2]<<16;we>re&&(we=re),Ct(w.Jc[+ge],k,le,we),le+=we,re-=we,Y+=3}Ct(w.Jc[+pe],k,le,re),k=le<j?0:5}if(k!=0)return Xi(w,k,"cannot parse partitions");for(k=Et(le=w.m,7),Y=Ft(le)?Mt(le,4):0,j=Ft(le)?Mt(le,4):0,re=Ft(le)?Mt(le,4):0,pe=Ft(le)?Mt(le,4):0,le=Ft(le)?Mt(le,4):0,ge=w.Qa,we=0;4>we;++we){if(ge.Cb){var De=ge.Zb[we];ge.Fb||(De+=k)}else{if(0<we){w.pb[we]=w.pb[0];continue}De=k}var Me=w.pb[we];Me.Sc[0]=Qc[io(De+Y,127)],Me.Sc[1]=Vc[io(De+0,127)],Me.Eb[0]=2*Qc[io(De+j,127)],Me.Eb[1]=101581*Vc[io(De+re,127)]>>16,8>Me.Eb[1]&&(Me.Eb[1]=8),Me.Qc[0]=Qc[io(De+pe,117)],Me.Qc[1]=Vc[io(De+le,127)],Me.lc=De+le}if(!ee.Rb)return Xi(w,4,"Not a key frame.");for(Ft(X),ee=w.Pa,k=0;4>k;++k){for(Y=0;8>Y;++Y)for(j=0;3>j;++j)for(re=0;11>re;++re)pe=Lt(X,Kn[k][Y][j][re])?Et(X,8):Ki[k][Y][j][re],ee.Wc[k][Y].Yb[j][re]=pe;for(Y=0;17>Y;++Y)ee.Xc[k][Y]=ee.Wc[k][Nu[Y]]}return w.kc=Ft(X),w.kc&&(w.Bd=Et(X,8)),w.cb=1}function fr(w,I,k,j,Y,X,ee){var re=I[Y].Yb[k];for(k=0;16>Y;++Y){if(!Lt(w,re[k+0]))return Y;for(;!Lt(w,re[k+1]);)if(re=I[++Y].Yb[0],k=0,Y==16)return 16;var le=I[Y+1].Yb;if(Lt(w,re[k+2])){var pe=w,ge=0;if(Lt(pe,(De=re)[(we=k)+3]))if(Lt(pe,De[we+6])){for(re=0,we=2*(ge=Lt(pe,De[we+8]))+(De=Lt(pe,De[we+9+ge])),ge=0,De=xh[we];De[re];++re)ge+=ge+Lt(pe,De[re]);ge+=3+(8<<we)}else Lt(pe,De[we+7])?(ge=7+2*Lt(pe,165),ge+=Lt(pe,145)):ge=5+Lt(pe,159);else ge=Lt(pe,De[we+4])?3+Lt(pe,De[we+5]):2;re=le[2]}else ge=1,re=le[1];le=ee+$n[Y],0>(pe=w).b&&Bt(pe);var we,De=pe.b,Me=(we=pe.Ca>>1)-(pe.I>>De)>>31;--pe.b,pe.Ca+=Me,pe.Ca|=1,pe.I-=(we+1&Me)<<De,X[le]=((ge^Me)-Me)*j[(0<Y)+0]}return 16}function Dr(w){var I=w.rb[w.sb-1];I.la=0,I.Na=0,n(w.zc,0,0,w.zc.length),w.ja=0}function Gn(w,I){if(w==null)return 0;if(I==null)return Xi(w,2,"NULL VP8Io parameter in VP8Decode().");if(!w.cb&&!Cs(w,I))return 0;if(e(w.cb),I.ac==null||I.ac(I)){I.ob&&(w.L=0);var k=T[w.L];if(w.L==2?(w.yb=0,w.zb=0):(w.yb=I.v-k>>4,w.zb=I.j-k>>4,0>w.yb&&(w.yb=0),0>w.zb&&(w.zb=0)),w.Va=I.o+15+k>>4,w.Hb=I.va+15+k>>4,w.Hb>w.za&&(w.Hb=w.za),w.Va>w.Ub&&(w.Va=w.Ub),0<w.L){var j=w.ed;for(k=0;4>k;++k){var Y;if(w.Qa.Cb){var X=w.Qa.Lb[k];w.Qa.Fb||(X+=j.Tb)}else X=j.Tb;for(Y=0;1>=Y;++Y){var ee=w.gd[k][Y],re=X;if(j.Pc&&(re+=j.vd[0],Y&&(re+=j.od[0])),0<(re=0>re?0:63<re?63:re)){var le=re;0<j.wb&&(le=4<j.wb?le>>2:le>>1)>9-j.wb&&(le=9-j.wb),1>le&&(le=1),ee.dd=le,ee.tc=2*re+le,ee.ld=40<=re?2:15<=re?1:0}else ee.tc=0;ee.La=Y}}}k=0}else Xi(w,6,"Frame setup failed"),k=w.a;if(k=k==0){if(k){w.$c=0,0<w.Aa||(w.Ic=H);e:{k=w.Ic,j=4*(le=w.za);var pe=32*le,ge=le+1,we=0<w.L?le*(0<w.Aa?2:1):0,De=(w.Aa==2?2:1)*le;if((ee=j+832+(Y=3*(16*k+T[w.L])/2*pe)+(X=w.Fa!=null&&0<w.Fa.length?w.Kc.c*w.Kc.i:0))!=ee)k=0;else{if(ee>w.Vb){if(w.Vb=0,w.Ec=o(ee),w.Fc=0,w.Ec==null){k=Xi(w,1,"no memory during frame initialization.");break e}w.Vb=ee}ee=w.Ec,re=w.Fc,w.Ac=ee,w.Bc=re,re+=j,w.Gd=l(pe,Vr),w.Hd=0,w.rb=l(ge+1,yn),w.sb=1,w.wa=we?l(we,mn):null,w.Y=0,w.D.Nb=0,w.D.wa=w.wa,w.D.Y=w.Y,0<w.Aa&&(w.D.Y+=le),e(!0),w.oc=ee,w.pc=re,re+=832,w.ya=l(De,On),w.aa=0,w.D.ya=w.ya,w.D.aa=w.aa,w.Aa==2&&(w.D.aa+=le),w.R=16*le,w.B=8*le,le=(pe=T[w.L])*w.R,pe=pe/2*w.B,w.sa=ee,w.ta=re+le,w.qa=w.sa,w.ra=w.ta+16*k*w.R+pe,w.Ha=w.qa,w.Ia=w.ra+8*k*w.B+pe,w.$c=0,re+=Y,w.mb=X?ee:null,w.nb=X?re:null,e(re+X<=w.Fc+w.Vb),Dr(w),n(w.Ac,w.Bc,0,j),k=1}}if(k){if(I.ka=0,I.y=w.sa,I.O=w.ta,I.f=w.qa,I.N=w.ra,I.ea=w.Ha,I.Vd=w.Ia,I.fa=w.R,I.Rc=w.B,I.F=null,I.J=0,!Mi){for(k=-255;255>=k;++k)ea[255+k]=0>k?-k:k;for(k=-1020;1020>=k;++k)Fi[1020+k]=-128>k?-128:127<k?127:k;for(k=-112;112>=k;++k)ml[112+k]=-16>k?-16:15<k?15:k;for(k=-255;510>=k;++k)Kl[255+k]=0>k?0:255<k?255:k;Mi=1}ro=Ye,no=ha,_s=ho,so=Ta,Fa=ze,go=js,_a=pc,Da=Jo,Ln=bh,Do=cu,ds=Ql,vs=Rc,fs=uu,Lr=ku,Jr=zl,ln=Lo,qn=Xo,va=fc,rn[0]=es,rn[1]=Ut,rn[2]=Wa,rn[3]=Nl,rn[4]=Io,rn[5]=ys,rn[6]=Xa,rn[7]=Aa,rn[8]=Ia,rn[9]=Za,ks[0]=ns,ks[1]=ji,ks[2]=xr,ks[3]=Tn,ks[4]=Bn,ks[5]=lu,ks[6]=Ka,ta[0]=Fr,ta[1]=hi,ta[2]=Dc,ta[3]=Ja,ta[4]=As,ta[5]=da,ta[6]=fn,k=1}else k=0}k&&(k=function(Me,st){for(Me.M=0;Me.M<Me.Va;++Me.M){var We,ke=Me.Jc[Me.M&Me.Xb],Ve=Me.m,gt=Me;for(We=0;We<gt.za;++We){var xt=Ve,At=gt,kt=At.Ac,Rt=At.Bc+4*We,Ai=At.zc,Ht=At.ya[At.aa+We];if(At.Qa.Bb?Ht.$b=Lt(xt,At.Pa.jb[0])?2+Lt(xt,At.Pa.jb[2]):Lt(xt,At.Pa.jb[1]):Ht.$b=0,At.kc&&(Ht.Ad=Lt(xt,At.Bd)),Ht.Za=!Lt(xt,145)+0,Ht.Za){var vi=Ht.Ob,Ti=0;for(At=0;4>At;++At){var er,Ii=Ai[0+At];for(er=0;4>er;++er){Ii=zi[kt[Rt+er]][Ii];for(var _r=Au[Lt(xt,Ii[0])];0<_r;)_r=Au[2*_r+Lt(xt,Ii[_r])];Ii=-_r,kt[Rt+er]=Ii}r(vi,Ti,kt,Rt,4),Ti+=4,Ai[0+At]=Ii}}else Ii=Lt(xt,156)?Lt(xt,128)?1:3:Lt(xt,163)?2:0,Ht.Ob[0]=Ii,n(kt,Rt,Ii,4),n(Ai,0,Ii,4);Ht.Dd=Lt(xt,142)?Lt(xt,114)?Lt(xt,183)?1:3:2:0}if(gt.m.Ka)return Xi(Me,7,"Premature end-of-partition0 encountered.");for(;Me.ja<Me.za;++Me.ja){if(gt=ke,xt=(Ve=Me).rb[Ve.sb-1],kt=Ve.rb[Ve.sb+Ve.ja],We=Ve.ya[Ve.aa+Ve.ja],Rt=Ve.kc?We.Ad:0)xt.la=kt.la=0,We.Za||(xt.Na=kt.Na=0),We.Hc=0,We.Gc=0,We.ia=0;else{var pr,qi;if(xt=kt,kt=gt,Rt=Ve.Pa.Xc,Ai=Ve.ya[Ve.aa+Ve.ja],Ht=Ve.pb[Ai.$b],At=Ai.ad,vi=0,Ti=Ve.rb[Ve.sb-1],Ii=er=0,n(At,vi,0,384),Ai.Za)var Nr=0,nn=Rt[3];else{_r=o(16);var Pr=xt.Na+Ti.Na;if(Pr=Ss(kt,Rt[1],Pr,Ht.Eb,0,_r,0),xt.Na=Ti.Na=(0<Pr)+0,1<Pr)ro(_r,0,At,vi);else{var Wr=_r[0]+3>>3;for(_r=0;256>_r;_r+=16)At[vi+_r]=Wr}Nr=1,nn=Rt[0]}var Er=15&xt.la,is=15&Ti.la;for(_r=0;4>_r;++_r){var zr=1&is;for(Wr=qi=0;4>Wr;++Wr)Er=Er>>1|(zr=(Pr=Ss(kt,nn,Pr=zr+(1&Er),Ht.Sc,Nr,At,vi))>Nr)<<7,qi=qi<<2|(3<Pr?3:1<Pr?2:At[vi+0]!=0),vi+=16;Er>>=4,is=is>>1|zr<<7,er=(er<<8|qi)>>>0}for(nn=Er,Nr=is>>4,pr=0;4>pr;pr+=2){for(qi=0,Er=xt.la>>4+pr,is=Ti.la>>4+pr,_r=0;2>_r;++_r){for(zr=1&is,Wr=0;2>Wr;++Wr)Pr=zr+(1&Er),Er=Er>>1|(zr=0<(Pr=Ss(kt,Rt[2],Pr,Ht.Qc,0,At,vi)))<<3,qi=qi<<2|(3<Pr?3:1<Pr?2:At[vi+0]!=0),vi+=16;Er>>=2,is=is>>1|zr<<5}Ii|=qi<<4*pr,nn|=Er<<4<<pr,Nr|=(240&is)<<pr}xt.la=nn,Ti.la=Nr,Ai.Hc=er,Ai.Gc=Ii,Ai.ia=43690&Ii?0:Ht.ia,Rt=!(er|Ii)}if(0<Ve.L&&(Ve.wa[Ve.Y+Ve.ja]=Ve.gd[We.$b][We.Za],Ve.wa[Ve.Y+Ve.ja].La|=!Rt),gt.Ka)return Xi(Me,7,"Premature end-of-file encountered.")}if(Dr(Me),Ve=st,gt=1,We=(ke=Me).D,xt=0<ke.L&&ke.M>=ke.zb&&ke.M<=ke.Va,ke.Aa==0)e:{if(We.M=ke.M,We.uc=xt,jl(ke,We),gt=1,We=(qi=ke.D).Nb,xt=(Ii=T[ke.L])*ke.R,kt=Ii/2*ke.B,_r=16*We*ke.R,Wr=8*We*ke.B,Rt=ke.sa,Ai=ke.ta-xt+_r,Ht=ke.qa,At=ke.ra-kt+Wr,vi=ke.Ha,Ti=ke.Ia-kt+Wr,is=(Er=qi.M)==0,er=Er>=ke.Va-1,ke.Aa==2&&jl(ke,qi),qi.uc)for(zr=(Pr=ke).D.M,e(Pr.D.uc),qi=Pr.yb;qi<Pr.Hb;++qi){Nr=qi,nn=zr;var gr=(vr=(vn=Pr).D).Nb;pr=vn.R;var vr=vr.wa[vr.Y+Nr],ar=vn.sa,cn=vn.ta+16*gr*pr+16*Nr,$r=vr.dd,Xr=vr.tc;if(Xr!=0)if(e(3<=Xr),vn.L==1)0<Nr&&ln(ar,cn,pr,Xr+4),vr.La&&va(ar,cn,pr,Xr),0<nn&&Jr(ar,cn,pr,Xr+4),vr.La&&qn(ar,cn,pr,Xr);else{var Fn=vn.B,Wn=vn.qa,vl=vn.ra+8*gr*Fn+8*Nr,Kr=vn.Ha,vn=vn.Ia+8*gr*Fn+8*Nr;gr=vr.ld,0<Nr&&(Da(ar,cn,pr,Xr+4,$r,gr),Do(Wn,vl,Kr,vn,Fn,Xr+4,$r,gr)),vr.La&&(vs(ar,cn,pr,Xr,$r,gr),Lr(Wn,vl,Kr,vn,Fn,Xr,$r,gr)),0<nn&&(_a(ar,cn,pr,Xr+4,$r,gr),Ln(Wn,vl,Kr,vn,Fn,Xr+4,$r,gr)),vr.La&&(ds(ar,cn,pr,Xr,$r,gr),fs(Wn,vl,Kr,vn,Fn,Xr,$r,gr))}}if(ke.ia&&alert("todo:DitherRow"),Ve.put!=null){if(qi=16*Er,Er=16*(Er+1),is?(Ve.y=ke.sa,Ve.O=ke.ta+_r,Ve.f=ke.qa,Ve.N=ke.ra+Wr,Ve.ea=ke.Ha,Ve.W=ke.Ia+Wr):(qi-=Ii,Ve.y=Rt,Ve.O=Ai,Ve.f=Ht,Ve.N=At,Ve.ea=vi,Ve.W=Ti),er||(Er-=Ii),Er>Ve.o&&(Er=Ve.o),Ve.F=null,Ve.J=null,ke.Fa!=null&&0<ke.Fa.length&&qi<Er&&(Ve.J=pa(ke,Ve,qi,Er-qi),Ve.F=ke.mb,Ve.F==null&&Ve.F.length==0)){gt=Xi(ke,3,"Could not decode alpha data.");break e}qi<Ve.j&&(Ii=Ve.j-qi,qi=Ve.j,e(!(1&Ii)),Ve.O+=ke.R*Ii,Ve.N+=ke.B*(Ii>>1),Ve.W+=ke.B*(Ii>>1),Ve.F!=null&&(Ve.J+=Ve.width*Ii)),qi<Er&&(Ve.O+=Ve.v,Ve.N+=Ve.v>>1,Ve.W+=Ve.v>>1,Ve.F!=null&&(Ve.J+=Ve.v),Ve.ka=qi-Ve.j,Ve.U=Ve.va-Ve.v,Ve.T=Er-qi,gt=Ve.put(Ve))}We+1!=ke.Ic||er||(r(ke.sa,ke.ta-xt,Rt,Ai+16*ke.R,xt),r(ke.qa,ke.ra-kt,Ht,At+8*ke.B,kt),r(ke.Ha,ke.Ia-kt,vi,Ti+8*ke.B,kt))}if(!gt)return Xi(Me,6,"Output aborted.")}return 1}(w,I)),I.bc!=null&&I.bc(I),k&=1}return k?(w.cb=0,k):0}function Ur(w,I,k,j,Y){Y=w[I+k+32*j]+(Y>>3),w[I+k+32*j]=-256&Y?0>Y?0:255:Y}function Sn(w,I,k,j,Y,X){Ur(w,I,0,k,j+Y),Ur(w,I,1,k,j+X),Ur(w,I,2,k,j-X),Ur(w,I,3,k,j-Y)}function dn(w){return(20091*w>>16)+w}function Gr(w,I,k,j){var Y,X=0,ee=o(16);for(Y=0;4>Y;++Y){var re=w[I+0]+w[I+8],le=w[I+0]-w[I+8],pe=(35468*w[I+4]>>16)-dn(w[I+12]),ge=dn(w[I+4])+(35468*w[I+12]>>16);ee[X+0]=re+ge,ee[X+1]=le+pe,ee[X+2]=le-pe,ee[X+3]=re-ge,X+=4,I++}for(Y=X=0;4>Y;++Y)re=(w=ee[X+0]+4)+ee[X+8],le=w-ee[X+8],pe=(35468*ee[X+4]>>16)-dn(ee[X+12]),Ur(k,j,0,0,re+(ge=dn(ee[X+4])+(35468*ee[X+12]>>16))),Ur(k,j,1,0,le+pe),Ur(k,j,2,0,le-pe),Ur(k,j,3,0,re-ge),X++,j+=32}function js(w,I,k,j){var Y=w[I+0]+4,X=35468*w[I+4]>>16,ee=dn(w[I+4]),re=35468*w[I+1]>>16;Sn(k,j,0,Y+ee,w=dn(w[I+1]),re),Sn(k,j,1,Y+X,w,re),Sn(k,j,2,Y-X,w,re),Sn(k,j,3,Y-ee,w,re)}function ha(w,I,k,j,Y){Gr(w,I,k,j),Y&&Gr(w,I+16,k,j+4)}function ho(w,I,k,j){no(w,I+0,k,j,1),no(w,I+32,k,j+128,1)}function Ta(w,I,k,j){var Y;for(w=w[I+0]+4,Y=0;4>Y;++Y)for(I=0;4>I;++I)Ur(k,j,I,Y,w)}function ze(w,I,k,j){w[I+0]&&so(w,I+0,k,j),w[I+16]&&so(w,I+16,k,j+4),w[I+32]&&so(w,I+32,k,j+128),w[I+48]&&so(w,I+48,k,j+128+4)}function Ye(w,I,k,j){var Y,X=o(16);for(Y=0;4>Y;++Y){var ee=w[I+0+Y]+w[I+12+Y],re=w[I+4+Y]+w[I+8+Y],le=w[I+4+Y]-w[I+8+Y],pe=w[I+0+Y]-w[I+12+Y];X[0+Y]=ee+re,X[8+Y]=ee-re,X[4+Y]=pe+le,X[12+Y]=pe-le}for(Y=0;4>Y;++Y)ee=(w=X[0+4*Y]+3)+X[3+4*Y],re=X[1+4*Y]+X[2+4*Y],le=X[1+4*Y]-X[2+4*Y],pe=w-X[3+4*Y],k[j+0]=ee+re>>3,k[j+16]=pe+le>>3,k[j+32]=ee-re>>3,k[j+48]=pe-le>>3,j+=64}function ft(w,I,k){var j,Y=I-32,X=oo,ee=255-w[Y-1];for(j=0;j<k;++j){var re,le=X,pe=ee+w[I-1];for(re=0;re<k;++re)w[I+re]=le[pe+w[Y+re]];I+=32}}function Ut(w,I){ft(w,I,4)}function hi(w,I){ft(w,I,8)}function ji(w,I){ft(w,I,16)}function xr(w,I){var k;for(k=0;16>k;++k)r(w,I+32*k,w,I-32,16)}function Tn(w,I){var k;for(k=16;0<k;--k)n(w,I,w[I-1],16),I+=32}function Un(w,I,k){var j;for(j=0;16>j;++j)n(I,k+32*j,w,16)}function ns(w,I){var k,j=16;for(k=0;16>k;++k)j+=w[I-1+32*k]+w[I+k-32];Un(j>>5,w,I)}function Bn(w,I){var k,j=8;for(k=0;16>k;++k)j+=w[I-1+32*k];Un(j>>4,w,I)}function lu(w,I){var k,j=8;for(k=0;16>k;++k)j+=w[I+k-32];Un(j>>4,w,I)}function Ka(w,I){Un(128,w,I)}function Ir(w,I,k){return w+2*I+k+2>>2}function Wa(w,I){var k,j=I-32;for(j=new Uint8Array([Ir(w[j-1],w[j+0],w[j+1]),Ir(w[j+0],w[j+1],w[j+2]),Ir(w[j+1],w[j+2],w[j+3]),Ir(w[j+2],w[j+3],w[j+4])]),k=0;4>k;++k)r(w,I+32*k,j,0,j.length)}function Nl(w,I){var k=w[I-1],j=w[I-1+32],Y=w[I-1+64],X=w[I-1+96];Gt(w,I+0,16843009*Ir(w[I-1-32],k,j)),Gt(w,I+32,16843009*Ir(k,j,Y)),Gt(w,I+64,16843009*Ir(j,Y,X)),Gt(w,I+96,16843009*Ir(Y,X,X))}function es(w,I){var k,j=4;for(k=0;4>k;++k)j+=w[I+k-32]+w[I-1+32*k];for(j>>=3,k=0;4>k;++k)n(w,I+32*k,j,4)}function Io(w,I){var k=w[I-1+0],j=w[I-1+32],Y=w[I-1+64],X=w[I-1-32],ee=w[I+0-32],re=w[I+1-32],le=w[I+2-32],pe=w[I+3-32];w[I+0+96]=Ir(j,Y,w[I-1+96]),w[I+1+96]=w[I+0+64]=Ir(k,j,Y),w[I+2+96]=w[I+1+64]=w[I+0+32]=Ir(X,k,j),w[I+3+96]=w[I+2+64]=w[I+1+32]=w[I+0+0]=Ir(ee,X,k),w[I+3+64]=w[I+2+32]=w[I+1+0]=Ir(re,ee,X),w[I+3+32]=w[I+2+0]=Ir(le,re,ee),w[I+3+0]=Ir(pe,le,re)}function Xa(w,I){var k=w[I+1-32],j=w[I+2-32],Y=w[I+3-32],X=w[I+4-32],ee=w[I+5-32],re=w[I+6-32],le=w[I+7-32];w[I+0+0]=Ir(w[I+0-32],k,j),w[I+1+0]=w[I+0+32]=Ir(k,j,Y),w[I+2+0]=w[I+1+32]=w[I+0+64]=Ir(j,Y,X),w[I+3+0]=w[I+2+32]=w[I+1+64]=w[I+0+96]=Ir(Y,X,ee),w[I+3+32]=w[I+2+64]=w[I+1+96]=Ir(X,ee,re),w[I+3+64]=w[I+2+96]=Ir(ee,re,le),w[I+3+96]=Ir(re,le,le)}function ys(w,I){var k=w[I-1+0],j=w[I-1+32],Y=w[I-1+64],X=w[I-1-32],ee=w[I+0-32],re=w[I+1-32],le=w[I+2-32],pe=w[I+3-32];w[I+0+0]=w[I+1+64]=X+ee+1>>1,w[I+1+0]=w[I+2+64]=ee+re+1>>1,w[I+2+0]=w[I+3+64]=re+le+1>>1,w[I+3+0]=le+pe+1>>1,w[I+0+96]=Ir(Y,j,k),w[I+0+64]=Ir(j,k,X),w[I+0+32]=w[I+1+96]=Ir(k,X,ee),w[I+1+32]=w[I+2+96]=Ir(X,ee,re),w[I+2+32]=w[I+3+96]=Ir(ee,re,le),w[I+3+32]=Ir(re,le,pe)}function Aa(w,I){var k=w[I+0-32],j=w[I+1-32],Y=w[I+2-32],X=w[I+3-32],ee=w[I+4-32],re=w[I+5-32],le=w[I+6-32],pe=w[I+7-32];w[I+0+0]=k+j+1>>1,w[I+1+0]=w[I+0+64]=j+Y+1>>1,w[I+2+0]=w[I+1+64]=Y+X+1>>1,w[I+3+0]=w[I+2+64]=X+ee+1>>1,w[I+0+32]=Ir(k,j,Y),w[I+1+32]=w[I+0+96]=Ir(j,Y,X),w[I+2+32]=w[I+1+96]=Ir(Y,X,ee),w[I+3+32]=w[I+2+96]=Ir(X,ee,re),w[I+3+64]=Ir(ee,re,le),w[I+3+96]=Ir(re,le,pe)}function Za(w,I){var k=w[I-1+0],j=w[I-1+32],Y=w[I-1+64],X=w[I-1+96];w[I+0+0]=k+j+1>>1,w[I+2+0]=w[I+0+32]=j+Y+1>>1,w[I+2+32]=w[I+0+64]=Y+X+1>>1,w[I+1+0]=Ir(k,j,Y),w[I+3+0]=w[I+1+32]=Ir(j,Y,X),w[I+3+32]=w[I+1+64]=Ir(Y,X,X),w[I+3+64]=w[I+2+64]=w[I+0+96]=w[I+1+96]=w[I+2+96]=w[I+3+96]=X}function Ia(w,I){var k=w[I-1+0],j=w[I-1+32],Y=w[I-1+64],X=w[I-1+96],ee=w[I-1-32],re=w[I+0-32],le=w[I+1-32],pe=w[I+2-32];w[I+0+0]=w[I+2+32]=k+ee+1>>1,w[I+0+32]=w[I+2+64]=j+k+1>>1,w[I+0+64]=w[I+2+96]=Y+j+1>>1,w[I+0+96]=X+Y+1>>1,w[I+3+0]=Ir(re,le,pe),w[I+2+0]=Ir(ee,re,le),w[I+1+0]=w[I+3+32]=Ir(k,ee,re),w[I+1+32]=w[I+3+64]=Ir(j,k,ee),w[I+1+64]=w[I+3+96]=Ir(Y,j,k),w[I+1+96]=Ir(X,Y,j)}function Dc(w,I){var k;for(k=0;8>k;++k)r(w,I+32*k,w,I-32,8)}function Ja(w,I){var k;for(k=0;8>k;++k)n(w,I,w[I-1],8),I+=32}function Ao(w,I,k){var j;for(j=0;8>j;++j)n(I,k+32*j,w,8)}function Fr(w,I){var k,j=8;for(k=0;8>k;++k)j+=w[I+k-32]+w[I-1+32*k];Ao(j>>4,w,I)}function da(w,I){var k,j=4;for(k=0;8>k;++k)j+=w[I+k-32];Ao(j>>3,w,I)}function As(w,I){var k,j=4;for(k=0;8>k;++k)j+=w[I-1+32*k];Ao(j>>3,w,I)}function fn(w,I){Ao(128,w,I)}function ss(w,I,k){var j=w[I-k],Y=w[I+0],X=3*(Y-j)+Wl[1020+w[I-2*k]-w[I+k]],ee=Si[112+(X+4>>3)];w[I-k]=oo[255+j+Si[112+(X+3>>3)]],w[I+0]=oo[255+Y-ee]}function Hr(w,I,k,j){var Y=w[I+0],X=w[I+k];return yo[255+w[I-2*k]-w[I-k]]>j||yo[255+X-Y]>j}function Ya(w,I,k,j){return 4*yo[255+w[I-k]-w[I+0]]+yo[255+w[I-2*k]-w[I+k]]<=j}function ul(w,I,k,j,Y){var X=w[I-3*k],ee=w[I-2*k],re=w[I-k],le=w[I+0],pe=w[I+k],ge=w[I+2*k],we=w[I+3*k];return 4*yo[255+re-le]+yo[255+ee-pe]>j?0:yo[255+w[I-4*k]-X]<=Y&&yo[255+X-ee]<=Y&&yo[255+ee-re]<=Y&&yo[255+we-ge]<=Y&&yo[255+ge-pe]<=Y&&yo[255+pe-le]<=Y}function zl(w,I,k,j){var Y=2*j+1;for(j=0;16>j;++j)Ya(w,I+j,k,Y)&&ss(w,I+j,k)}function Lo(w,I,k,j){var Y=2*j+1;for(j=0;16>j;++j)Ya(w,I+j*k,1,Y)&&ss(w,I+j*k,1)}function Xo(w,I,k,j){var Y;for(Y=3;0<Y;--Y)zl(w,I+=4*k,k,j)}function fc(w,I,k,j){var Y;for(Y=3;0<Y;--Y)Lo(w,I+=4,k,j)}function Zo(w,I,k,j,Y,X,ee,re){for(X=2*X+1;0<Y--;){if(ul(w,I,k,X,ee))if(Hr(w,I,k,re))ss(w,I,k);else{var le=w,pe=I,ge=k,we=le[pe-2*ge],De=le[pe-ge],Me=le[pe+0],st=le[pe+ge],We=le[pe+2*ge],ke=27*(gt=Wl[1020+3*(Me-De)+Wl[1020+we-st]])+63>>7,Ve=18*gt+63>>7,gt=9*gt+63>>7;le[pe-3*ge]=oo[255+le[pe-3*ge]+gt],le[pe-2*ge]=oo[255+we+Ve],le[pe-ge]=oo[255+De+ke],le[pe+0]=oo[255+Me-ke],le[pe+ge]=oo[255+st-Ve],le[pe+2*ge]=oo[255+We-gt]}I+=j}}function fo(w,I,k,j,Y,X,ee,re){for(X=2*X+1;0<Y--;){if(ul(w,I,k,X,ee))if(Hr(w,I,k,re))ss(w,I,k);else{var le=w,pe=I,ge=k,we=le[pe-ge],De=le[pe+0],Me=le[pe+ge],st=Si[112+((We=3*(De-we))+4>>3)],We=Si[112+(We+3>>3)],ke=st+1>>1;le[pe-2*ge]=oo[255+le[pe-2*ge]+ke],le[pe-ge]=oo[255+we+We],le[pe+0]=oo[255+De-st],le[pe+ge]=oo[255+Me-ke]}I+=j}}function pc(w,I,k,j,Y,X){Zo(w,I,k,1,16,j,Y,X)}function Jo(w,I,k,j,Y,X){Zo(w,I,1,k,16,j,Y,X)}function Ql(w,I,k,j,Y,X){var ee;for(ee=3;0<ee;--ee)fo(w,I+=4*k,k,1,16,j,Y,X)}function Rc(w,I,k,j,Y,X){var ee;for(ee=3;0<ee;--ee)fo(w,I+=4,1,k,16,j,Y,X)}function bh(w,I,k,j,Y,X,ee,re){Zo(w,I,Y,1,8,X,ee,re),Zo(k,j,Y,1,8,X,ee,re)}function cu(w,I,k,j,Y,X,ee,re){Zo(w,I,1,Y,8,X,ee,re),Zo(k,j,1,Y,8,X,ee,re)}function uu(w,I,k,j,Y,X,ee,re){fo(w,I+4*Y,Y,1,8,X,ee,re),fo(k,j+4*Y,Y,1,8,X,ee,re)}function ku(w,I,k,j,Y,X,ee,re){fo(w,I+4,1,Y,8,X,ee,re),fo(k,j+4,1,Y,8,X,ee,re)}function Vl(){this.ba=new Tr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Be,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function el(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function tl(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Hl(){this.ua=0,this.Wa=new lt,this.vb=new lt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Xe,this.yc=new Pe}function il(){this.xb=this.a=0,this.l=new To,this.ca=new Tr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Te,this.Pb=0,this.wd=new Te,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Hl,this.ab=0,this.gc=l(4,tl),this.Oc=0}function fa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new To,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function hl(w,I,k,j,Y,X,ee){for(w=w==null?0:w[I+0],I=0;I<ee;++I)Y[X+I]=w+k[j+I]&255,w=Y[X+I]}function Gl(w,I,k,j,Y,X,ee){var re;if(w==null)hl(null,null,k,j,Y,X,ee);else for(re=0;re<ee;++re)Y[X+re]=w[I+re]+k[j+re]&255}function to(w,I,k,j,Y,X,ee){if(w==null)hl(null,null,k,j,Y,X,ee);else{var re,le=w[I+0],pe=le,ge=le;for(re=0;re<ee;++re)pe=ge+(le=w[I+re])-pe,ge=k[j+re]+(-256&pe?0>pe?0:255:pe)&255,pe=le,Y[X+re]=ge}}function pa(w,I,k,j){var Y=I.width,X=I.o;if(e(w!=null&&I!=null),0>k||0>=j||k+j>X)return null;if(!w.Cc){if(w.ga==null){var ee;if(w.ga=new fa,(ee=w.ga==null)||(ee=I.width*I.o,e(w.Gb.length==0),w.Gb=o(ee),w.Uc=0,w.Gb==null?ee=0:(w.mb=w.Gb,w.nb=w.Uc,w.rc=null,ee=1),ee=!ee),!ee){ee=w.ga;var re=w.Fa,le=w.P,pe=w.qc,ge=w.mb,we=w.nb,De=le+1,Me=pe-1,st=ee.l;if(e(re!=null&&ge!=null&&I!=null),Os[0]=null,Os[1]=hl,Os[2]=Gl,Os[3]=to,ee.ca=ge,ee.tb=we,ee.c=I.width,ee.i=I.height,e(0<ee.c&&0<ee.i),1>=pe)I=0;else if(ee.$a=re[le+0]>>0&3,ee.Z=re[le+0]>>2&3,ee.Lc=re[le+0]>>4&3,le=re[le+0]>>6&3,0>ee.$a||1<ee.$a||4<=ee.Z||1<ee.Lc||le)I=0;else if(st.put=be,st.ac=me,st.bc=Ee,st.ma=ee,st.width=I.width,st.height=I.height,st.Da=I.Da,st.v=I.v,st.va=I.va,st.j=I.j,st.o=I.o,ee.$a)e:{e(ee.$a==1),I=Bi();t:for(;;){if(I==null){I=0;break e}if(e(ee!=null),ee.mc=I,I.c=ee.c,I.i=ee.i,I.l=ee.l,I.l.ma=ee,I.l.width=ee.c,I.l.height=ee.i,I.a=0,vt(I.m,re,De,Me),!Ni(ee.c,ee.i,1,I,null)||(I.ab==1&&I.gc[0].hc==3&&$t(I.s)?(ee.ic=1,re=I.c*I.i,I.Ta=null,I.Ua=0,I.V=o(re),I.Ba=0,I.V==null?(I.a=1,I=0):I=1):(ee.ic=0,I=ot(I,ee.c)),!I))break t;I=1;break e}ee.mc=null,I=0}else I=Me>=ee.c*ee.i;ee=!I}if(ee)return null;w.ga.Lc!=1?w.Ga=0:j=X-k}e(w.ga!=null),e(k+j<=X);e:{if(I=(re=w.ga).c,X=re.l.o,re.$a==0){if(De=w.rc,Me=w.Vc,st=w.Fa,le=w.P+1+k*I,pe=w.mb,ge=w.nb+k*I,e(le<=w.P+w.qc),re.Z!=0)for(e(Os[re.Z]!=null),ee=0;ee<j;++ee)Os[re.Z](De,Me,st,le,pe,ge,I),De=pe,Me=ge,ge+=I,le+=I;else for(ee=0;ee<j;++ee)r(pe,ge,st,le,I),De=pe,Me=ge,ge+=I,le+=I;w.rc=De,w.Vc=Me}else{if(e(re.mc!=null),I=k+j,e((ee=re.mc)!=null),e(I<=ee.i),ee.C>=I)I=1;else if(re.ic||bt(),re.ic){re=ee.V,De=ee.Ba,Me=ee.c;var We=ee.i,ke=(st=1,le=ee.$/Me,pe=ee.$%Me,ge=ee.m,we=ee.s,ee.$),Ve=Me*We,gt=Me*I,xt=we.wc,At=ke<gt?_t(we,pe,le):null;e(ke<=Ve),e(I<=We),e($t(we));t:for(;;){for(;!ge.h&&ke<gt;){if(pe&xt||(At=_t(we,pe,le)),e(At!=null),pt(ge),256>(We=je(At.G[0],At.H[0],ge)))re[De+ke]=We,++ke,++pe>=Me&&(pe=0,++le<=I&&!(le%16)&&oi(ee,le));else{if(!(280>We)){st=0;break t}We=Fe(We-256,ge);var kt,Rt=je(At.G[4],At.H[4],ge);if(pt(ge),!(ke>=(Rt=Ue(Me,Rt=Fe(Rt,ge)))&&Ve-ke>=We)){st=0;break t}for(kt=0;kt<We;++kt)re[De+ke+kt]=re[De+ke+kt-Rt];for(ke+=We,pe+=We;pe>=Me;)pe-=Me,++le<=I&&!(le%16)&&oi(ee,le);ke<gt&&pe&xt&&(At=_t(we,pe,le))}e(ge.h==tt(ge))}oi(ee,le>I?I:le);break t}!st||ge.h&&ke<Ve?(st=0,ee.a=ge.h?5:3):ee.$=ke,I=st}else I=Ei(ee,ee.V,ee.Ba,ee.c,ee.i,I,ii);if(!I){j=0;break e}}k+j>=X&&(w.Cc=1),j=1}if(!j)return null;if(w.Cc&&((j=w.ga)!=null&&(j.mc=null),w.ga=null,0<w.Ga))return alert("todo:WebPDequantizeLevels"),null}return w.nb+k*Y}function se(w,I,k,j,Y,X){for(;0<Y--;){var ee,re=w,le=I+(k?1:0),pe=w,ge=I+(k?0:3);for(ee=0;ee<j;++ee){var we=pe[ge+4*ee];we!=255&&(we*=32897,re[le+4*ee+0]=re[le+4*ee+0]*we>>23,re[le+4*ee+1]=re[le+4*ee+1]*we>>23,re[le+4*ee+2]=re[le+4*ee+2]*we>>23)}I+=X}}function Le(w,I,k,j,Y){for(;0<j--;){var X;for(X=0;X<k;++X){var ee=w[I+2*X+0],re=15&(pe=w[I+2*X+1]),le=4369*re,pe=(240&pe|pe>>4)*le>>16;w[I+2*X+0]=(240&ee|ee>>4)*le>>16&240|(15&ee|ee<<4)*le>>16>>4&15,w[I+2*X+1]=240&pe|re}I+=Y}}function ct(w,I,k,j,Y,X,ee,re){var le,pe,ge=255;for(pe=0;pe<Y;++pe){for(le=0;le<j;++le){var we=w[I+le];X[ee+4*le]=we,ge&=we}I+=k,ee+=re}return ge!=255}function yt(w,I,k,j,Y){var X;for(X=0;X<Y;++X)k[j+X]=w[I+X]>>8}function bt(){Ra=se,mo=Le,Yo=ct,Ui=yt}function It(w,I,k){Ne[w]=function(j,Y,X,ee,re,le,pe,ge,we,De,Me,st,We,ke,Ve,gt,xt){var At,kt=xt-1>>1,Rt=re[le+0]|pe[ge+0]<<16,Ai=we[De+0]|Me[st+0]<<16;e(j!=null);var Ht=3*Rt+Ai+131074>>2;for(I(j[Y+0],255&Ht,Ht>>16,We,ke),X!=null&&(Ht=3*Ai+Rt+131074>>2,I(X[ee+0],255&Ht,Ht>>16,Ve,gt)),At=1;At<=kt;++At){var vi=re[le+At]|pe[ge+At]<<16,Ti=we[De+At]|Me[st+At]<<16,er=Rt+vi+Ai+Ti+524296,Ii=er+2*(vi+Ai)>>3;Ht=Ii+Rt>>1,Rt=(er=er+2*(Rt+Ti)>>3)+vi>>1,I(j[Y+2*At-1],255&Ht,Ht>>16,We,ke+(2*At-1)*k),I(j[Y+2*At-0],255&Rt,Rt>>16,We,ke+(2*At-0)*k),X!=null&&(Ht=er+Ai>>1,Rt=Ii+Ti>>1,I(X[ee+2*At-1],255&Ht,Ht>>16,Ve,gt+(2*At-1)*k),I(X[ee+2*At+0],255&Rt,Rt>>16,Ve,gt+(2*At+0)*k)),Rt=vi,Ai=Ti}1&xt||(Ht=3*Rt+Ai+131074>>2,I(j[Y+xt-1],255&Ht,Ht>>16,We,ke+(xt-1)*k),X!=null&&(Ht=3*Ai+Rt+131074>>2,I(X[ee+xt-1],255&Ht,Ht>>16,Ve,gt+(xt-1)*k)))}}function gi(){Yr[kc]=zn,Yr[Xl]=yl,Yr[Oc]=Oo,Yr[Uc]=nl,Yr[Nc]=ka,Yr[zc]=Yl,Yr[rl]=fu,Yr[_n]=yl,Yr[Es]=nl,Yr[Ro]=ka,Yr[Zl]=Yl}function ni(w){return w&~A?0>w?0:255:w>>z}function nr(w,I){return ni((19077*w>>8)+(26149*I>>8)-14234)}function $i(w,I,k){return ni((19077*w>>8)-(6419*I>>8)-(13320*k>>8)+8708)}function Oi(w,I){return ni((19077*w>>8)+(33050*I>>8)-17685)}function qr(w,I,k,j,Y){j[Y+0]=nr(w,k),j[Y+1]=$i(w,I,k),j[Y+2]=Oi(w,I)}function sr(w,I,k,j,Y){j[Y+0]=Oi(w,I),j[Y+1]=$i(w,I,k),j[Y+2]=nr(w,k)}function jn(w,I,k,j,Y){var X=$i(w,I,k);I=X<<3&224|Oi(w,I)>>3,j[Y+0]=248&nr(w,k)|X>>5,j[Y+1]=I}function Cr(w,I,k,j,Y){var X=240&Oi(w,I)|15;j[Y+0]=240&nr(w,k)|$i(w,I,k)>>4,j[Y+1]=X}function Mr(w,I,k,j,Y){j[Y+0]=255,qr(w,I,k,j,Y+1)}function Nn(w,I,k,j,Y){sr(w,I,k,j,Y),j[Y+3]=255}function Ks(w,I,k,j,Y){qr(w,I,k,j,Y),j[Y+3]=255}function io(w,I){return 0>w?0:w>I?I:w}function Mo(w,I,k){Ne[w]=function(j,Y,X,ee,re,le,pe,ge,we){for(var De=ge+(-2&we)*k;ge!=De;)I(j[Y+0],X[ee+0],re[le+0],pe,ge),I(j[Y+1],X[ee+0],re[le+0],pe,ge+k),Y+=2,++ee,++le,ge+=2*k;1&we&&I(j[Y+0],X[ee+0],re[le+0],pe,ge)}}function La(w,I,k){return k==0?w==0?I==0?6:5:I==0?4:0:k}function ga(w,I,k,j,Y){switch(w>>>30){case 3:no(I,k,j,Y,0);break;case 2:go(I,k,j,Y);break;case 1:so(I,k,j,Y)}}function jl(w,I){var k,j,Y=I.M,X=I.Nb,ee=w.oc,re=w.pc+40,le=w.oc,pe=w.pc+584,ge=w.oc,we=w.pc+600;for(k=0;16>k;++k)ee[re+32*k-1]=129;for(k=0;8>k;++k)le[pe+32*k-1]=129,ge[we+32*k-1]=129;for(0<Y?ee[re-1-32]=le[pe-1-32]=ge[we-1-32]=129:(n(ee,re-32-1,127,21),n(le,pe-32-1,127,9),n(ge,we-32-1,127,9)),j=0;j<w.za;++j){var De=I.ya[I.aa+j];if(0<j){for(k=-1;16>k;++k)r(ee,re+32*k-4,ee,re+32*k+12,4);for(k=-1;8>k;++k)r(le,pe+32*k-4,le,pe+32*k+4,4),r(ge,we+32*k-4,ge,we+32*k+4,4)}var Me=w.Gd,st=w.Hd+j,We=De.ad,ke=De.Hc;if(0<Y&&(r(ee,re-32,Me[st].y,0,16),r(le,pe-32,Me[st].f,0,8),r(ge,we-32,Me[st].ea,0,8)),De.Za){var Ve=ee,gt=re-32+16;for(0<Y&&(j>=w.za-1?n(Ve,gt,Me[st].y[15],4):r(Ve,gt,Me[st+1].y,0,4)),k=0;4>k;k++)Ve[gt+128+k]=Ve[gt+256+k]=Ve[gt+384+k]=Ve[gt+0+k];for(k=0;16>k;++k,ke<<=2)Ve=ee,gt=re+B[k],rn[De.Ob[k]](Ve,gt),ga(ke,We,16*+k,Ve,gt)}else if(Ve=La(j,Y,De.Ob[0]),ks[Ve](ee,re),ke!=0)for(k=0;16>k;++k,ke<<=2)ga(ke,We,16*+k,ee,re+B[k]);for(k=De.Gc,Ve=La(j,Y,De.Dd),ta[Ve](le,pe),ta[Ve](ge,we),ke=We,Ve=le,gt=pe,255&(De=k>>0)&&(170&De?_s(ke,256,Ve,gt):Fa(ke,256,Ve,gt)),De=ge,ke=we,255&(k>>=8)&&(170&k?_s(We,320,De,ke):Fa(We,320,De,ke)),Y<w.Ub-1&&(r(Me[st].y,0,ee,re+480,16),r(Me[st].f,0,le,pe+224,8),r(Me[st].ea,0,ge,we+224,8)),k=8*X*w.B,Me=w.sa,st=w.ta+16*j+16*X*w.R,We=w.qa,De=w.ra+8*j+k,ke=w.Ha,Ve=w.Ia+8*j+k,k=0;16>k;++k)r(Me,st+k*w.R,ee,re+32*k,16);for(k=0;8>k;++k)r(We,De+k*w.B,le,pe+32*k,8),r(ke,Ve+k*w.B,ge,we+32*k,8)}}function Al(w,I,k,j,Y,X,ee,re,le){var pe=[0],ge=[0],we=0,De=le!=null?le.kd:0,Me=le??new el;if(w==null||12>k)return 7;Me.data=w,Me.w=I,Me.ha=k,I=[I],k=[k],Me.gb=[Me.gb];e:{var st=I,We=k,ke=Me.gb;if(e(w!=null),e(We!=null),e(ke!=null),ke[0]=0,12<=We[0]&&!t(w,st[0],"RIFF")){if(t(w,st[0]+8,"WEBP")){ke=3;break e}var Ve=yi(w,st[0]+4);if(12>Ve||4294967286<Ve){ke=3;break e}if(De&&Ve>We[0]-8){ke=7;break e}ke[0]=Ve,st[0]+=12,We[0]-=12}ke=0}if(ke!=0)return ke;for(Ve=0<Me.gb[0],k=k[0];;){e:{var gt=w;We=I,ke=k;var xt=pe,At=ge,kt=st=[0];if((Ht=we=[we])[0]=0,8>ke[0])ke=7;else{if(!t(gt,We[0],"VP8X")){if(yi(gt,We[0]+4)!=10){ke=3;break e}if(18>ke[0]){ke=7;break e}var Rt=yi(gt,We[0]+8),Ai=1+mi(gt,We[0]+12);if(2147483648<=Ai*(gt=1+mi(gt,We[0]+15))){ke=3;break e}kt!=null&&(kt[0]=Rt),xt!=null&&(xt[0]=Ai),At!=null&&(At[0]=gt),We[0]+=18,ke[0]-=18,Ht[0]=1}ke=0}}if(we=we[0],st=st[0],ke!=0)return ke;if(We=!!(2&st),!Ve&&we)return 3;if(X!=null&&(X[0]=!!(16&st)),ee!=null&&(ee[0]=We),re!=null&&(re[0]=0),ee=pe[0],st=ge[0],we&&We&&le==null){ke=0;break}if(4>k){ke=7;break}if(Ve&&we||!Ve&&!we&&!t(w,I[0],"ALPH")){k=[k],Me.na=[Me.na],Me.P=[Me.P],Me.Sa=[Me.Sa];e:{Rt=w,ke=I,Ve=k;var Ht=Me.gb;xt=Me.na,At=Me.P,kt=Me.Sa,Ai=22,e(Rt!=null),e(Ve!=null),gt=ke[0];var vi=Ve[0];for(e(xt!=null),e(kt!=null),xt[0]=null,At[0]=null,kt[0]=0;;){if(ke[0]=gt,Ve[0]=vi,8>vi){ke=7;break e}var Ti=yi(Rt,gt+4);if(4294967286<Ti){ke=3;break e}var er=8+Ti+1&-2;if(Ai+=er,0<Ht&&Ai>Ht){ke=3;break e}if(!t(Rt,gt,"VP8 ")||!t(Rt,gt,"VP8L")){ke=0;break e}if(vi[0]<er){ke=7;break e}t(Rt,gt,"ALPH")||(xt[0]=Rt,At[0]=gt+8,kt[0]=Ti),gt+=er,vi-=er}}if(k=k[0],Me.na=Me.na[0],Me.P=Me.P[0],Me.Sa=Me.Sa[0],ke!=0)break}k=[k],Me.Ja=[Me.Ja],Me.xa=[Me.xa];e:if(Ht=w,ke=I,Ve=k,xt=Me.gb[0],At=Me.Ja,kt=Me.xa,Rt=ke[0],gt=!t(Ht,Rt,"VP8 "),Ai=!t(Ht,Rt,"VP8L"),e(Ht!=null),e(Ve!=null),e(At!=null),e(kt!=null),8>Ve[0])ke=7;else{if(gt||Ai){if(Ht=yi(Ht,Rt+4),12<=xt&&Ht>xt-12){ke=3;break e}if(De&&Ht>Ve[0]-8){ke=7;break e}At[0]=Ht,ke[0]+=8,Ve[0]-=8,kt[0]=Ai}else kt[0]=5<=Ve[0]&&Ht[Rt+0]==47&&!(Ht[Rt+4]>>5),At[0]=Ve[0];ke=0}if(k=k[0],Me.Ja=Me.Ja[0],Me.xa=Me.xa[0],I=I[0],ke!=0)break;if(4294967286<Me.Ja)return 3;if(re==null||We||(re[0]=Me.xa?2:1),ee=[ee],st=[st],Me.xa){if(5>k){ke=7;break}re=ee,De=st,We=X,w==null||5>k?w=0:5<=k&&w[I+0]==47&&!(w[I+4]>>5)?(Ve=[0],Ht=[0],xt=[0],vt(At=new Te,w,I,k),xe(At,Ve,Ht,xt)?(re!=null&&(re[0]=Ve[0]),De!=null&&(De[0]=Ht[0]),We!=null&&(We[0]=xt[0]),w=1):w=0):w=0}else{if(10>k){ke=7;break}re=st,w==null||10>k||!eo(w,I+3,k-3)?w=0:(De=w[I+0]|w[I+1]<<8|w[I+2]<<16,We=16383&(w[I+7]<<8|w[I+6]),w=16383&(w[I+9]<<8|w[I+8]),1&De||3<(De>>1&7)||!(De>>4&1)||De>>5>=Me.Ja||!We||!w?w=0:(ee&&(ee[0]=We),re&&(re[0]=w),w=1))}if(!w||(ee=ee[0],st=st[0],we&&(pe[0]!=ee||ge[0]!=st)))return 3;le!=null&&(le[0]=Me,le.offset=I-le.w,e(4294967286>I-le.w),e(le.offset==le.ha-k));break}return ke==0||ke==7&&we&&le==null?(X!=null&&(X[0]|=Me.na!=null&&0<Me.na.length),j!=null&&(j[0]=ee),Y!=null&&(Y[0]=st),0):ke}function ql(w,I,k){var j=I.width,Y=I.height,X=0,ee=0,re=j,le=Y;if(I.Da=w!=null&&0<w.Da,I.Da&&(re=w.cd,le=w.bd,X=w.v,ee=w.j,11>k||(X&=-2,ee&=-2),0>X||0>ee||0>=re||0>=le||X+re>j||ee+le>Y))return 0;if(I.v=X,I.j=ee,I.va=X+re,I.o=ee+le,I.U=re,I.T=le,I.da=w!=null&&0<w.da,I.da){if(!wt(re,le,k=[w.ib],X=[w.hb]))return 0;I.ib=k[0],I.hb=X[0]}return I.ob=w!=null&&w.ob,I.Kb=w==null||!w.Sd,I.da&&(I.ob=I.ib<3*j/4&&I.hb<3*Y/4,I.Kb=0),1}function gc(w){if(w==null)return 2;if(11>w.S){var I=w.f.RGBA;I.fb+=(w.height-1)*I.A,I.A=-I.A}else I=w.f.kb,w=w.height,I.O+=(w-1)*I.fa,I.fa=-I.fa,I.N+=(w-1>>1)*I.Ab,I.Ab=-I.Ab,I.W+=(w-1>>1)*I.Db,I.Db=-I.Db,I.F!=null&&(I.J+=(w-1)*I.lb,I.lb=-I.lb);return 0}function ma(w,I,k,j){if(j==null||0>=w||0>=I)return 2;if(k!=null){if(k.Da){var Y=k.cd,X=k.bd,ee=-2&k.v,re=-2&k.j;if(0>ee||0>re||0>=Y||0>=X||ee+Y>w||re+X>I)return 2;w=Y,I=X}if(k.da){if(!wt(w,I,Y=[k.ib],X=[k.hb]))return 2;w=Y[0],I=X[0]}}j.width=w,j.height=I;e:{var le=j.width,pe=j.height;if(w=j.S,0>=le||0>=pe||!(w>=kc&&13>w))w=2;else{if(0>=j.Rd&&j.sd==null){ee=X=Y=I=0;var ge=(re=le*q[w])*pe;if(11>w||(X=(pe+1)/2*(I=(le+1)/2),w==12&&(ee=(Y=le)*pe)),(pe=o(ge+2*X+ee))==null){w=1;break e}j.sd=pe,11>w?((le=j.f.RGBA).eb=pe,le.fb=0,le.A=re,le.size=ge):((le=j.f.kb).y=pe,le.O=0,le.fa=re,le.Fd=ge,le.f=pe,le.N=0+ge,le.Ab=I,le.Cd=X,le.ea=pe,le.W=0+ge+X,le.Db=I,le.Ed=X,w==12&&(le.F=pe,le.J=0+ge+2*X),le.Tc=ee,le.lb=Y)}if(I=1,Y=j.S,X=j.width,ee=j.height,Y>=kc&&13>Y)if(11>Y)w=j.f.RGBA,I&=(re=Math.abs(w.A))*(ee-1)+X<=w.size,I&=re>=X*q[Y],I&=w.eb!=null;else{w=j.f.kb,re=(X+1)/2,ge=(ee+1)/2,le=Math.abs(w.fa),pe=Math.abs(w.Ab);var we=Math.abs(w.Db),De=Math.abs(w.lb),Me=De*(ee-1)+X;I&=le*(ee-1)+X<=w.Fd,I&=pe*(ge-1)+re<=w.Cd,I=(I&=we*(ge-1)+re<=w.Ed)&le>=X&pe>=re&we>=re,I&=w.y!=null,I&=w.f!=null,I&=w.ea!=null,Y==12&&(I&=De>=X,I&=Me<=w.Tc,I&=w.F!=null)}else I=0;w=I?0:2}}return w!=0||k!=null&&k.fd&&(w=gc(j)),w}var Ds=64,dl=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],$l=24,Ma=32,Pa=8,Rs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ht("Predictor0","PredictorAdd0"),Ne.Predictor0=function(){return 4278190080},Ne.Predictor1=function(w){return w},Ne.Predictor2=function(w,I,k){return I[k+0]},Ne.Predictor3=function(w,I,k){return I[k+1]},Ne.Predictor4=function(w,I,k){return I[k-1]},Ne.Predictor5=function(w,I,k){return si(si(w,I[k+1]),I[k+0])},Ne.Predictor6=function(w,I,k){return si(w,I[k-1])},Ne.Predictor7=function(w,I,k){return si(w,I[k+0])},Ne.Predictor8=function(w,I,k){return si(I[k-1],I[k+0])},Ne.Predictor9=function(w,I,k){return si(I[k+0],I[k+1])},Ne.Predictor10=function(w,I,k){return si(si(w,I[k-1]),si(I[k+0],I[k+1]))},Ne.Predictor11=function(w,I,k){var j=I[k+0];return 0>=Wi(j>>24&255,w>>24&255,(I=I[k-1])>>24&255)+Wi(j>>16&255,w>>16&255,I>>16&255)+Wi(j>>8&255,w>>8&255,I>>8&255)+Wi(255&j,255&w,255&I)?j:w},Ne.Predictor12=function(w,I,k){var j=I[k+0];return(fi((w>>24&255)+(j>>24&255)-((I=I[k-1])>>24&255))<<24|fi((w>>16&255)+(j>>16&255)-(I>>16&255))<<16|fi((w>>8&255)+(j>>8&255)-(I>>8&255))<<8|fi((255&w)+(255&j)-(255&I)))>>>0},Ne.Predictor13=function(w,I,k){var j=I[k-1];return(ci((w=si(w,I[k+0]))>>24&255,j>>24&255)<<24|ci(w>>16&255,j>>16&255)<<16|ci(w>>8&255,j>>8&255)<<8|ci(w>>0&255,j>>0&255))>>>0};var Ou=Ne.PredictorAdd0;Ne.PredictorAdd1=ir,ht("Predictor2","PredictorAdd2"),ht("Predictor3","PredictorAdd3"),ht("Predictor4","PredictorAdd4"),ht("Predictor5","PredictorAdd5"),ht("Predictor6","PredictorAdd6"),ht("Predictor7","PredictorAdd7"),ht("Predictor8","PredictorAdd8"),ht("Predictor9","PredictorAdd9"),ht("Predictor10","PredictorAdd10"),ht("Predictor11","PredictorAdd11"),ht("Predictor12","PredictorAdd12"),ht("Predictor13","PredictorAdd13");var In=Ne.PredictorAdd2;Yi("ColorIndexInverseTransform","MapARGB","32b",function(w){return w>>8&255},function(w){return w}),Yi("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(w){return w},function(w){return w>>8&255});var an,pn=Ne.ColorIndexInverseTransform,ts=Ne.MapARGB,fl=Ne.VP8LColorIndexInverseTransformAlpha,pl=Ne.MapAlpha,po=Ne.VP8LPredictorsAdd=[];po.length=16,(Ne.VP8LPredictors=[]).length=16,(Ne.VP8LPredictorsAdd_C=[]).length=16,(Ne.VP8LPredictors_C=[]).length=16;var os,as,Po,Fo,ya,gl,ro,no,go,_s,so,Fa,_a,Da,Ln,Do,ds,vs,fs,Lr,Jr,ln,qn,va,Ra,mo,Yo,Ui,ea=o(511),Fi=o(2041),ml=o(225),Kl=o(767),Mi=0,Wl=Fi,Si=ml,oo=Kl,yo=ea,kc=0,Xl=1,Oc=2,Uc=3,Nc=4,zc=5,rl=6,_n=7,Es=8,Ro=9,Zl=10,Uu=[2,3,7],mc=[3,3,11],hu=[280,256,256,256,40],ba=[0,1,1,1,0],Ws=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],xi=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],or=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Jl=8,Qc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Vc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ss=null,xh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],$n=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Au=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Ki=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],zi=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Kn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Nu=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ks=[],rn=[],ta=[],ko=1,du=2,Os=[],Yr=[];It("UpsampleRgbLinePair",qr,3),It("UpsampleBgrLinePair",sr,3),It("UpsampleRgbaLinePair",Ks,4),It("UpsampleBgraLinePair",Nn,4),It("UpsampleArgbLinePair",Mr,4),It("UpsampleRgba4444LinePair",Cr,2),It("UpsampleRgb565LinePair",jn,2);var zn=Ne.UpsampleRgbLinePair,Oo=Ne.UpsampleBgrLinePair,yl=Ne.UpsampleRgbaLinePair,nl=Ne.UpsampleBgraLinePair,ka=Ne.UpsampleArgbLinePair,Yl=Ne.UpsampleRgba4444LinePair,fu=Ne.UpsampleRgb565LinePair,_o=16,xa=1<<_o-1,_l=-227,jr=482,z=6,A=(256<<z)-1,x=0,L=o(256),O=o(256),y=o(256),a=o(256),d=o(jr-_l),_=o(jr-_l);Mo("YuvToRgbRow",qr,3),Mo("YuvToBgrRow",sr,3),Mo("YuvToRgbaRow",Ks,4),Mo("YuvToBgraRow",Nn,4),Mo("YuvToArgbRow",Mr,4),Mo("YuvToRgba4444Row",Cr,2),Mo("YuvToRgb565Row",jn,2);var B=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],T=[0,2,8],U=[8,7,6,4,4,2,2,2,1,1,1,1],H=1;this.WebPDecodeRGBA=function(w,I,k,j,Y){var X=Xl,ee=new Vl,re=new Tr;ee.ba=re,re.S=X,re.width=[re.width],re.height=[re.height];var le=re.width,pe=re.height,ge=new Qe;if(ge==null||w==null)var we=2;else e(ge!=null),we=Al(w,I,k,ge.width,ge.height,ge.Pd,ge.Qd,ge.format,null);if(we!=0?le=0:(le!=null&&(le[0]=ge.width[0]),pe!=null&&(pe[0]=ge.height[0]),le=1),le){re.width=re.width[0],re.height=re.height[0],j!=null&&(j[0]=re.width),Y!=null&&(Y[0]=re.height);e:{if(j=new To,(Y=new el).data=w,Y.w=I,Y.ha=k,Y.kd=1,I=[0],e(Y!=null),((w=Al(Y.data,Y.w,Y.ha,null,null,null,I,null,Y))==0||w==7)&&I[0]&&(w=4),(I=w)==0){if(e(ee!=null),j.data=Y.data,j.w=Y.w+Y.offset,j.ha=Y.ha-Y.offset,j.put=be,j.ac=me,j.bc=Ee,j.ma=ee,Y.xa){if((w=Bi())==null){ee=1;break e}if(function(De,Me){var st=[0],We=[0],ke=[0];t:for(;;){if(De==null)return 0;if(Me==null)return De.a=2,0;if(De.l=Me,De.a=0,vt(De.m,Me.data,Me.w,Me.ha),!xe(De.m,st,We,ke)){De.a=3;break t}if(De.xb=du,Me.width=st[0],Me.height=We[0],!Ni(st[0],We[0],1,De,null))break t;return 1}return e(De.a!=0),0}(w,j)){if(j=(I=ma(j.width,j.height,ee.Oa,ee.ba))==0){t:{j=w;i:for(;;){if(j==null){j=0;break t}if(e(j.s.yc!=null),e(j.s.Ya!=null),e(0<j.s.Wb),e((k=j.l)!=null),e((Y=k.ma)!=null),j.xb!=0){if(j.ca=Y.ba,j.tb=Y.tb,e(j.ca!=null),!ql(Y.Oa,k,Uc)){j.a=2;break i}if(!ot(j,k.width)||k.da)break i;if((k.da||bi(j.ca.S))&&bt(),11>j.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),j.ca.f.kb.F!=null&&bt()),j.Pb&&0<j.s.ua&&j.s.vb.X==null&&!Pi(j.s.vb,j.s.Wa.Xa)){j.a=1;break i}j.xb=0}if(!Ei(j,j.V,j.Ba,j.c,j.i,k.o,ei))break i;Y.Dc=j.Ma,j=1;break t}e(j.a!=0),j=0}j=!j}j&&(I=w.a)}else I=w.a}else{if((w=new hs)==null){ee=1;break e}if(w.Fa=Y.na,w.P=Y.P,w.qc=Y.Sa,Cs(w,j)){if((I=ma(j.width,j.height,ee.Oa,ee.ba))==0){if(w.Aa=0,k=ee.Oa,e((Y=w)!=null),k!=null){if(0<(le=0>(le=k.Md)?0:100<le?255:255*le/100)){for(pe=ge=0;4>pe;++pe)12>(we=Y.pb[pe]).lc&&(we.ia=le*U[0>we.lc?0:we.lc]>>3),ge|=we.ia;ge&&(alert("todo:VP8InitRandom"),Y.ia=1)}Y.Ga=k.Id,100<Y.Ga?Y.Ga=100:0>Y.Ga&&(Y.Ga=0)}Gn(w,j)||(I=w.a)}}else I=w.a}I==0&&ee.Oa!=null&&ee.Oa.fd&&(I=gc(ee.ba))}ee=I}X=ee!=0?null:11>X?re.f.RGBA.eb:re.f.kb.y}else X=null;return X};var q=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function b(Ne,at){for(var rt="",Re=0;Re<4;Re++)rt+=String.fromCharCode(Ne[at++]);return rt}function S(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16)>>>0}function F(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16|Ne[at+3]<<24)>>>0}new g;var D=[0],N=[0],J=[],te=new g,he=i,ue=function(Ne,at){var rt={},Re=0,Pe=!1,Je=0,Xe=0;if(rt.frames=[],!function(Ze,tt,dt,pt){for(var Bt=0;Bt<pt;Bt++)if(Ze[tt+Bt]!=dt.charCodeAt(Bt))return!0;return!1}(Ne,at,"RIFF",4)){var Ct,Et;for(F(Ne,at+=4),at+=8;at<Ne.length;){var Mt=b(Ne,at),vt=F(Ne,at+=4);at+=4;var Dt=vt+(1&vt);switch(Mt){case"VP8 ":case"VP8L":rt.frames[Re]===void 0&&(rt.frames[Re]={}),(Te=rt.frames[Re]).src_off=Pe?Xe:at-8,Te.src_size=Je+vt+8,Re++,Pe&&(Pe=!1,Je=0,Xe=0);break;case"VP8X":(Te=rt.header={}).feature_flags=Ne[at];var Pt=at+4;Te.canvas_width=1+S(Ne,Pt),Pt+=3,Te.canvas_height=1+S(Ne,Pt),Pt+=3;break;case"ALPH":Pe=!0,Je=Dt+8,Xe=at-8;break;case"ANIM":(Te=rt.header).bgcolor=F(Ne,at),Pt=at+4,Te.loop_count=(Ct=Ne)[(Et=Pt)+0]<<0|Ct[Et+1]<<8,Pt+=2;break;case"ANMF":var Xt,Te;(Te=rt.frames[Re]={}).offset_x=2*S(Ne,at),at+=3,Te.offset_y=2*S(Ne,at),at+=3,Te.width=1+S(Ne,at),at+=3,Te.height=1+S(Ne,at),at+=3,Te.duration=S(Ne,at),at+=3,Xt=Ne[at++],Te.dispose=1&Xt,Te.blend=Xt>>1&1}Mt!="ANMF"&&(at+=Dt)}return rt}}(he,0);ue.response=he,ue.rgbaoutput=!0,ue.dataurl=!1;var fe=ue.header?ue.header:null,ve=ue.frames?ue.frames:null;if(fe){fe.loop_counter=fe.loop_count,D=[fe.canvas_height],N=[fe.canvas_width];for(var Se=0;Se<ve.length&&ve[Se].blend!=0;Se++);}var Ge=ve[0],He=te.WebPDecodeRGBA(he,Ge.src_off,Ge.src_size,N,D);Ge.rgba=He,Ge.imgwidth=N[0],Ge.imgheight=D[0];for(var $e=0;$e<N[0]*D[0]*4;$e++)J[$e]=He[$e];return this.width=N,this.height=D,this.data=J,this}(function(i){var e=function(){return typeof xC=="function"},t=function(D,N,J,te){var he=4,ue=l;switch(te){case i.image_compression.FAST:he=1,ue=o;break;case i.image_compression.MEDIUM:he=6,ue=s;break;case i.image_compression.SLOW:he=9,ue=g}D=r(D,N,J,ue);var fe=xC(D,{level:he});return i.__addimage__.arrayBufferToBinaryString(fe)},r=function(D,N,J,te){for(var he,ue,fe,ve=D.length/N,Se=new Uint8Array(D.length+ve),Ge=S(),He=0;He<ve;He+=1){if(fe=He*N,he=D.subarray(fe,fe+N),te)Se.set(te(he,J,ue),fe+He);else{for(var $e,Ne=Ge.length,at=[];$e<Ne;$e+=1)at[$e]=Ge[$e](he,J,ue);var rt=F(at.concat());Se.set(at[rt],fe+He)}ue=he}return Se},n=function(D){var N=Array.apply([],D);return N.unshift(0),N},o=function(D,N){var J,te=[],he=D.length;te[0]=1;for(var ue=0;ue<he;ue+=1)J=D[ue-N]||0,te[ue+1]=D[ue]-J+256&255;return te},l=function(D,N,J){var te,he=[],ue=D.length;he[0]=2;for(var fe=0;fe<ue;fe+=1)te=J&&J[fe]||0,he[fe+1]=D[fe]-te+256&255;return he},s=function(D,N,J){var te,he,ue=[],fe=D.length;ue[0]=3;for(var ve=0;ve<fe;ve+=1)te=D[ve-N]||0,he=J&&J[ve]||0,ue[ve+1]=D[ve]+256-(te+he>>>1)&255;return ue},g=function(D,N,J){var te,he,ue,fe,ve=[],Se=D.length;ve[0]=4;for(var Ge=0;Ge<Se;Ge+=1)te=D[Ge-N]||0,he=J&&J[Ge]||0,ue=J&&J[Ge-N]||0,fe=b(te,he,ue),ve[Ge+1]=D[Ge]-fe+256&255;return ve},b=function(D,N,J){if(D===N&&N===J)return D;var te=Math.abs(N-J),he=Math.abs(D-J),ue=Math.abs(D+N-J-J);return te<=he&&te<=ue?D:he<=ue?N:J},S=function(){return[n,o,l,s,g]},F=function(D){var N=D.map(function(J){return J.reduce(function(te,he){return te+Math.abs(he)},0)});return N.indexOf(Math.min.apply(null,N))};i.processPNG=function(D,N,J,te){var he,ue,fe,ve,Se,Ge,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct=this.decode.FLATE_DECODE,Et="";if(this.__addimage__.isArrayBuffer(D)&&(D=new Uint8Array(D)),this.__addimage__.isArrayBufferView(D)){if(D=(fe=new hre(D)).imgData,ue=fe.bits,he=fe.colorSpace,Se=fe.colors,[4,6].indexOf(fe.colorType)!==-1){if(fe.bits===8){Ne=($e=fe.pixelBitlength==32?new Uint32Array(fe.decodePixels().buffer):fe.pixelBitlength==16?new Uint16Array(fe.decodePixels().buffer):new Uint8Array(fe.decodePixels().buffer)).length,rt=new Uint8Array(Ne*fe.colors),at=new Uint8Array(Ne);var Mt,vt=fe.pixelBitlength-fe.bits;for(Je=0,Xe=0;Je<Ne;Je++){for(Pe=$e[Je],Mt=0;Mt<vt;)rt[Xe++]=Pe>>>Mt&255,Mt+=fe.bits;at[Je]=Pe>>>Mt&255}}if(fe.bits===16){Ne=($e=new Uint32Array(fe.decodePixels().buffer)).length,rt=new Uint8Array(Ne*(32/fe.pixelBitlength)*fe.colors),at=new Uint8Array(Ne*(32/fe.pixelBitlength)),Re=fe.colors>1,Je=0,Xe=0;for(var Dt=0;Je<Ne;)Pe=$e[Je++],rt[Xe++]=Pe>>>0&255,Re&&(rt[Xe++]=Pe>>>16&255,Pe=$e[Je++],rt[Xe++]=Pe>>>0&255),at[Dt++]=Pe>>>16&255;ue=8}te!==i.image_compression.NONE&&e()?(D=t(rt,fe.width*fe.colors,fe.colors,te),He=t(at,fe.width,1,te)):(D=rt,He=at,Ct=void 0)}if(fe.colorType===3&&(he=this.color_spaces.INDEXED,Ge=fe.palette,fe.transparency.indexed)){var Pt=fe.transparency.indexed,Xt=0;for(Je=0,Ne=Pt.length;Je<Ne;++Je)Xt+=Pt[Je];if((Xt/=255)===Ne-1&&Pt.indexOf(0)!==-1)ve=[Pt.indexOf(0)];else if(Xt!==Ne){for($e=fe.decodePixels(),at=new Uint8Array($e.length),Je=0,Ne=$e.length;Je<Ne;Je++)at[Je]=Pt[$e[Je]];He=t(at,fe.width,1)}}var Te=function(Ze){var tt;switch(Ze){case i.image_compression.FAST:tt=11;break;case i.image_compression.MEDIUM:tt=13;break;case i.image_compression.SLOW:tt=14;break;default:tt=12}return tt}(te);return Ct===this.decode.FLATE_DECODE&&(Et="/Predictor "+Te+" "),Et+="/Colors "+Se+" /BitsPerComponent "+ue+" /Columns "+fe.width,(this.__addimage__.isArrayBuffer(D)||this.__addimage__.isArrayBufferView(D))&&(D=this.__addimage__.arrayBufferToBinaryString(D)),(He&&this.__addimage__.isArrayBuffer(He)||this.__addimage__.isArrayBufferView(He))&&(He=this.__addimage__.arrayBufferToBinaryString(He)),{alias:J,data:D,index:N,filter:Ct,decodeParameters:Et,transparency:ve,palette:Ge,sMask:He,predictor:Te,width:fe.width,height:fe.height,bitsPerComponent:ue,colorSpace:he}}}})(Or.API),function(i){i.processGIF89A=function(e,t,r,n){var o=new Are(e),l=o.width,s=o.height,g=[];o.decodeAndBlitFrameRGBA(0,g);var b={data:g,width:l,height:s},S=new DC(100).encode(b,100);return i.processJPEG.call(this,S,t,r,n)},i.processGIF87A=i.processGIF89A}(Or.API),uh.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var e=0;e<i;e++){var t=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:n,green:r,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},uh.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[i]()}catch(t){Fs.log("bit decode error:"+t)}},uh.prototype.bit1=function(){var i,e=Math.ceil(this.width/8),t=e%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,n=0;n<e;n++)for(var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+8*n*4,s=0;s<8&&8*n+s<this.width;s++){var g=this.palette[o>>7-s&1];this.data[l+4*s]=g.blue,this.data[l+4*s+1]=g.green,this.data[l+4*s+2]=g.red,this.data[l+4*s+3]=255}t!==0&&(this.pos+=4-t)}},uh.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),e=i%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<i;n++){var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+2*n*4,s=o>>4,g=15&o,b=this.palette[s];if(this.data[l]=b.blue,this.data[l+1]=b.green,this.data[l+2]=b.red,this.data[l+3]=255,2*n+1>=this.width)break;b=this.palette[g],this.data[l+4]=b.blue,this.data[l+4+1]=b.green,this.data[l+4+2]=b.red,this.data[l+4+3]=255}e!==0&&(this.pos+=4-e)}},uh.prototype.bit8=function(){for(var i=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;if(n<this.palette.length){var l=this.palette[n];this.data[o]=l.red,this.data[o+1]=l.green,this.data[o+2]=l.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}i!==0&&(this.pos+=4-i)}},uh.prototype.bit15=function(){for(var i=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,g=(o>>10&e)/e*255|0,b=o>>15?255:0,S=r*this.width*4+4*n;this.data[S]=g,this.data[S+1]=s,this.data[S+2]=l,this.data[S+3]=b}this.pos+=i}},uh.prototype.bit16=function(){for(var i=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(l&e)/e*255|0,g=(l>>5&t)/t*255|0,b=(l>>11)/e*255|0,S=n*this.width*4+4*o;this.data[S]=b,this.data[S+1]=g,this.data[S+2]=s,this.data[S+3]=255}this.pos+=i}},uh.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=o,this.data[l+1]=n,this.data[l+2]=r,this.data[l+3]=255}this.pos+=this.width%4}},uh.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*t;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=r,this.data[s+3]=l}},uh.prototype.getData=function(){return this.data},function(i){i.processBMP=function(e,t,r,n){var o=new uh(e,!1),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},b=new DC(100).encode(g,100);return i.processJPEG.call(this,b,t,r,n)}}(Or.API),$4.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(e,t,r,n){var o=new $4(e),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},b=new DC(100).encode(g,100);return i.processJPEG.call(this,b,t,r,n)}}(Or.API),Or.API.processRGBA=function(i,e,t){for(var r=i.data,n=r.length,o=new Uint8Array(n/4*3),l=new Uint8Array(n/4),s=0,g=0,b=0;b<n;b+=4){var S=r[b],F=r[b+1],D=r[b+2],N=r[b+3];o[s++]=S,o[s++]=F,o[s++]=D,l[g++]=N}var J=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:J,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},Or.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Lg=Or.API,lv=Lg.getCharWidthsArray=function(i,e){var t,r,n=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),l=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:n.metadata.Unicode.widths,g=s.fof?s.fof:1,b=e.kerning?e.kerning:n.metadata.Unicode.kerning,S=b.fof?b.fof:1,F=e.doKerning!==!1,D=0,N=i.length,J=0,te=s[0]||g,he=[];for(t=0;t<N;t++)r=i.charCodeAt(t),typeof n.metadata.widthOfString=="function"?he.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(r))+l*(1e3/o)||0)/1e3):(D=F&&Yn(b[r])==="object"&&!isNaN(parseInt(b[r][J],10))?b[r][J]/S:0,he.push((s[r]||te)/g+D)),J=r;return he},H4=Lg.getStringUnitWidth=function(i,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),n=e.charSpace||this.internal.getCharSpace();return Lg.processArabic&&(i=Lg.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,t,n)/t:lv.apply(this,arguments).reduce(function(o,l){return o+l},0)},G4=function(i,e,t,r){for(var n=[],o=0,l=i.length,s=0;o!==l&&s+e[o]<t;)s+=e[o],o++;n.push(i.slice(0,o));var g=o;for(s=0;o!==l;)s+e[o]>r&&(n.push(i.slice(g,o)),s=0,g=o),s+=e[o],o++;return g!==o&&n.push(i.slice(g,o)),n},j4=function(i,e,t){t||(t={});var r,n,o,l,s,g,b,S=[],F=[S],D=t.textIndent||0,N=0,J=0,te=i.split(" "),he=lv.apply(this,[" ",t])[0];if(g=t.lineIndent===-1?te[0].length+2:t.lineIndent||0){var ue=Array(g).join(" "),fe=[];te.map(function(Se){(Se=Se.split(/\s*\n/)).length>1?fe=fe.concat(Se.map(function(Ge,He){return(He&&Ge.length?`
`:"")+Ge})):fe.push(Se[0])}),te=fe,g=H4.apply(this,[ue,t])}for(o=0,l=te.length;o<l;o++){var ve=0;if(r=te[o],g&&r[0]==`
`&&(r=r.substr(1),ve=1),D+N+(J=(n=lv.apply(this,[r,t])).reduce(function(Se,Ge){return Se+Ge},0))>e||ve){if(J>e){for(s=G4.apply(this,[r,n,e-(D+N),e]),S.push(s.shift()),S=[s.pop()];s.length;)F.push([s.shift()]);J=n.slice(r.length-(S[0]?S[0].length:0)).reduce(function(Se,Ge){return Se+Ge},0)}else S=[r];F.push(S),D=J+g,N=he}else S.push(r),D+=N+J,N=he}return b=g?function(Se,Ge){return(Ge?ue:"")+Se.join(" ")}:function(Se){return Se.join(" ")},F.map(b)},Lg.splitTextToSize=function(i,e,t){var r,n=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(S){if(S.widths&&S.kerning)return{widths:S.widths,kerning:S.kerning};var F=this.internal.getFont(S.fontName,S.fontStyle);return F.metadata.Unicode?{widths:F.metadata.Unicode.widths||{0:1},kerning:F.metadata.Unicode.kerning||{}}:{font:F.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var l=1*this.internal.scaleFactor*e/n;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=t.lineIndent;var s,g,b=[];for(s=0,g=r.length;s<g;s++)b=b.concat(j4.apply(this,[r[s],l,o]));return b},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},r={},n=0;n<e.length;n++)t[e[n]]="0123456789abcdef"[n],r["0123456789abcdef"[n]]=e[n];var o=function(F){return"0x"+parseInt(F,10).toString(16)},l=i.__fontmetrics__.compress=function(F){var D,N,J,te,he=["{"];for(var ue in F){if(D=F[ue],isNaN(parseInt(ue,10))?N="'"+ue+"'":(ue=parseInt(ue,10),N=(N=o(ue).slice(2)).slice(0,-1)+r[N.slice(-1)]),typeof D=="number")D<0?(J=o(D).slice(3),te="-"):(J=o(D).slice(2),te=""),J=te+J.slice(0,-1)+r[J.slice(-1)];else{if(Yn(D)!=="object")throw new Error("Don't know what to do with value type "+Yn(D)+".");J=l(D)}he.push(N+J)}return he.push("}"),he.join("")},s=i.__fontmetrics__.uncompress=function(F){if(typeof F!="string")throw new Error("Invalid argument passed to uncompress.");for(var D,N,J,te,he={},ue=1,fe=he,ve=[],Se="",Ge="",He=F.length-1,$e=1;$e<He;$e+=1)(te=F[$e])=="'"?D?(J=D.join(""),D=void 0):D=[]:D?D.push(te):te=="{"?(ve.push([fe,J]),fe={},J=void 0):te=="}"?((N=ve.pop())[0][N[1]]=fe,J=void 0,fe=N[0]):te=="-"?ue=-1:J===void 0?t.hasOwnProperty(te)?(Se+=t[te],J=parseInt(Se,16)*ue,ue=1,Se=""):Se+=te:t.hasOwnProperty(te)?(Ge+=t[te],fe[J]=parseInt(Ge,16)*ue,ue=1,J=void 0,Ge=""):Ge+=te;return he},g={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},b={Unicode:{Courier:g,"Courier-Bold":g,"Courier-BoldOblique":g,"Courier-Oblique":g,Helvetica:g,"Helvetica-Bold":g,"Helvetica-BoldOblique":g,"Helvetica-Oblique":g,"Times-Roman":g,"Times-Bold":g,"Times-BoldItalic":g,"Times-Italic":g}},S={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(F){var D=F.font,N=S.Unicode[D.postScriptName];N&&(D.metadata.Unicode={},D.metadata.Unicode.widths=N.widths,D.metadata.Unicode.kerning=N.kerning);var J=b.Unicode[D.postScriptName];J&&(D.metadata.Unicode.encoding=J,D.encoding=J.codePages[0])}])}(Or.API),function(i){var e=function(t){for(var r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return n};i.API.events.push(["addFont",function(t){var r=void 0,n=t.font,o=t.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(r=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(l,s){s=/^\x00\x01\x00\x00/.test(s)?e(s):e(Vy(s)),l.metadata=i.API.TTFFont.open(s),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(n,r)}}])}(Or),function(i){function e(){return(kr.canvg?Promise.resolve(kr.canvg):Promise.resolve().then(()=>Vve)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}Or.API.addSvgAsImage=function(t,r,n,o,l,s,g,b){if(isNaN(r)||isNaN(n))throw Fs.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(l))throw Fs.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var S=document.createElement("canvas");S.width=o,S.height=l;var F=S.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,S.width,S.height);var D={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},N=this;return e().then(function(J){return J.fromString(F,t,D)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(J){return J.render(D)}).then(function(){N.addImage(S.toDataURL("image/jpeg",1),r,n,o,l,g,b)})}}(),Or.API.putTotalPages=function(i){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(i,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(e,t);return this},Or.API.viewerPreferences=function(i,e){var t;i=i||{},e=e||!1;var r,n,o,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(l),g=[],b=0,S=0,F=0;function D(J,te){var he,ue=!1;for(he=0;he<J.length;he+=1)J[he]===te&&(ue=!0);return ue}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,i==="reset"||e===!0){var N=s.length;for(F=0;F<N;F+=1)t[s[F]].value=t[s[F]].defaultValue,t[s[F]].explicitSet=!1}if(Yn(i)==="object"){for(n in i)if(o=i[n],D(s,n)&&o!==void 0){if(t[n].type==="boolean"&&typeof o=="boolean")t[n].value=o;else if(t[n].type==="name"&&D(t[n].valueSet,o))t[n].value=o;else if(t[n].type==="integer"&&Number.isInteger(o))t[n].value=o;else if(t[n].type==="array"){for(b=0;b<o.length;b+=1)if(r=!0,o[b].length===1&&typeof o[b][0]=="number")g.push(String(o[b]-1));else if(o[b].length>1){for(S=0;S<o[b].length;S+=1)typeof o[b][S]!="number"&&(r=!1);r===!0&&g.push([o[b][0]-1,o[b][1]-1].join(" "))}t[n].value="["+g.join(" ")+"]"}else t[n].value=t[n].defaultValue;t[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var J,te=[];for(J in t)t[J].explicitSet===!0&&(t[J].type==="name"?te.push("/"+J+" /"+t[J].value):te.push("/"+J+" "+t[J].value));te.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+te.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(i){var e=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(r)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),g=unescape(encodeURIComponent("</x:xmpmeta>")),b=o.length+l.length+s.length+n.length+g.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+b+" >>"),this.internal.write("stream"),this.internal.write(n+o+l+s+g),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(Or.API),function(i){var e=i.API,t=e.pdfEscape16=function(o,l){for(var s,g=l.metadata.Unicode.widths,b=["","0","00","000","0000"],S=[""],F=0,D=o.length;F<D;++F){if(s=l.metadata.characterToGlyph(o.charCodeAt(F)),l.metadata.glyIdsUsed.push(s),l.metadata.toUnicode[s]=o.charCodeAt(F),g.indexOf(s)==-1&&(g.push(s),g.push([parseInt(l.metadata.widthOfGlyph(s),10)])),s=="0")return S.join("");s=s.toString(16),S.push(b[4-s.length],s)}return S.join("")},r=function(o){var l,s,g,b,S,F,D;for(S=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,g=[],F=0,D=(s=Object.keys(o).sort(function(N,J){return N-J})).length;F<D;F++)l=s[F],g.length>=100&&(S+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar`,g=[]),o[l]!==void 0&&o[l]!==null&&typeof o[l].toString=="function"&&(b=("0000"+o[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),g.push("<"+l+"><"+b+">"));return g.length&&(S+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar
`),S+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,b=l.newObject,S=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="Identity-H"){for(var F=s.metadata.Unicode.widths,D=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),N="",J=0;J<D.length;J++)N+=String.fromCharCode(D[J]);var te=b();S({data:N,addLength1:!0,objectId:te}),g("endobj");var he=b();S({data:r(s.metadata.toUnicode),addLength1:!0,objectId:he}),g("endobj");var ue=b();g("<<"),g("/Type /FontDescriptor"),g("/FontName /"+wg(s.fontName)),g("/FontFile2 "+te+" 0 R"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/Flags "+s.metadata.flags),g("/StemV "+s.metadata.stemV),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g(">>"),g("endobj");var fe=b();g("<<"),g("/Type /Font"),g("/BaseFont /"+wg(s.fontName)),g("/FontDescriptor "+ue+" 0 R"),g("/W "+i.API.PDFObject.convert(F)),g("/CIDToGIDMap /Identity"),g("/DW 1000"),g("/Subtype /CIDFontType2"),g("/CIDSystemInfo"),g("<<"),g("/Supplement 0"),g("/Registry (Adobe)"),g("/Ordering ("+s.encoding+")"),g(">>"),g(">>"),g("endobj"),s.objectNumber=b(),g("<<"),g("/Type /Font"),g("/Subtype /Type0"),g("/ToUnicode "+he+" 0 R"),g("/BaseFont /"+wg(s.fontName)),g("/Encoding /"+s.encoding),g("/DescendantFonts ["+fe+" 0 R]"),g(">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,b=l.newObject,S=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var F=s.metadata.rawData,D="",N=0;N<F.length;N++)D+=String.fromCharCode(F[N]);var J=b();S({data:D,addLength1:!0,objectId:J}),g("endobj");var te=b();S({data:r(s.metadata.toUnicode),addLength1:!0,objectId:te}),g("endobj");var he=b();g("<<"),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g("/StemV "+s.metadata.stemV),g("/Type /FontDescriptor"),g("/FontFile2 "+J+" 0 R"),g("/Flags 96"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/FontName /"+wg(s.fontName)),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g(">>"),g("endobj"),s.objectNumber=b();for(var ue=0;ue<s.metadata.hmtx.widths.length;ue++)s.metadata.hmtx.widths[ue]=parseInt(s.metadata.hmtx.widths[ue]*(1e3/s.metadata.head.unitsPerEm));g("<</Subtype/TrueType/Type/Font/ToUnicode "+te+" 0 R/BaseFont/"+wg(s.fontName)+"/FontDescriptor "+he+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]);var n=function(o){var l,s=o.text||"",g=o.x,b=o.y,S=o.options||{},F=o.mutex||{},D=F.pdfEscape,N=F.activeFontKey,J=F.fonts,te=N,he="",ue=0,fe="",ve=J[te].encoding;if(J[te].encoding!=="Identity-H")return{text:s,x:g,y:b,options:S,mutex:F};for(fe=s,te=N,Array.isArray(s)&&(fe=s[0]),ue=0;ue<fe.length;ue+=1)J[te].metadata.hasOwnProperty("cmap")&&(l=J[te].metadata.cmap.unicode.codeMap[fe[ue].charCodeAt(0)]),l||fe[ue].charCodeAt(0)<256&&J[te].metadata.hasOwnProperty("Unicode")?he+=fe[ue]:he+="";var Se="";return parseInt(te.slice(1))<14||ve==="WinAnsiEncoding"?Se=D(he,te).split("").map(function(Ge){return Ge.charCodeAt(0).toString(16)}).join(""):ve==="Identity-H"&&(Se=t(he,J[te])),F.isHex=!0,{text:Se,x:g,y:b,options:S,mutex:F}};e.events.push(["postProcessText",function(o){var l=o.text||"",s=[],g={text:l,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(l)){var b=0;for(b=0;b<l.length;b+=1)Array.isArray(l[b])&&l[b].length===3?s.push([n(Object.assign({},g,{text:l[b][0]})).text,l[b][1],l[b][2]]):s.push(n(Object.assign({},g,{text:l[b]})).text);o.text=s}else o.text=n(Object.assign({},g,{text:l})).text}])}(Or),function(i){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},i.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},i.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(Or.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var n,o,l,s,g,b,S,F=e,D=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],N=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],J={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},te={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},he=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ue=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),fe=!1,ve=0;this.__bidiEngine__={};var Se=function(Re){var Pe=Re.charCodeAt(),Je=Pe>>8,Xe=te[Je];return Xe!==void 0?F[256*Xe+(255&Pe)]:Je===252||Je===253?"AL":ue.test(Je)?"L":Je===8?"R":"N"},Ge=function(Re){for(var Pe,Je=0;Je<Re.length;Je++){if((Pe=Se(Re.charAt(Je)))==="L")return!1;if(Pe==="R")return!0}return!1},He=function(Re,Pe,Je,Xe){var Ct,Et,Mt,vt,Dt=Pe[Xe];switch(Dt){case"L":case"R":fe=!1;break;case"N":case"AN":break;case"EN":fe&&(Dt="AN");break;case"AL":fe=!0,Dt="R";break;case"WS":Dt="N";break;case"CS":Xe<1||Xe+1>=Pe.length||(Ct=Je[Xe-1])!=="EN"&&Ct!=="AN"||(Et=Pe[Xe+1])!=="EN"&&Et!=="AN"?Dt="N":fe&&(Et="AN"),Dt=Et===Ct?Et:"N";break;case"ES":Dt=(Ct=Xe>0?Je[Xe-1]:"B")==="EN"&&Xe+1<Pe.length&&Pe[Xe+1]==="EN"?"EN":"N";break;case"ET":if(Xe>0&&Je[Xe-1]==="EN"){Dt="EN";break}if(fe){Dt="N";break}for(Mt=Xe+1,vt=Pe.length;Mt<vt&&Pe[Mt]==="ET";)Mt++;Dt=Mt<vt&&Pe[Mt]==="EN"?"EN":"N";break;case"NSM":if(l&&!s){for(vt=Pe.length,Mt=Xe+1;Mt<vt&&Pe[Mt]==="NSM";)Mt++;if(Mt<vt){var Pt=Re[Xe],Xt=Pt>=1425&&Pt<=2303||Pt===64286;if(Ct=Pe[Mt],Xt&&(Ct==="R"||Ct==="AL")){Dt="R";break}}}Dt=Xe<1||(Ct=Pe[Xe-1])==="B"?"N":Je[Xe-1];break;case"B":fe=!1,n=!0,Dt=ve;break;case"S":o=!0,Dt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":fe=!1;break;case"BN":Dt="N"}return Dt},$e=function(Re,Pe,Je){var Xe=Re.split("");return Je&&Ne(Xe,Je,{hiLevel:ve}),Xe.reverse(),Pe&&Pe.reverse(),Xe.join("")},Ne=function(Re,Pe,Je){var Xe,Ct,Et,Mt,vt,Dt=-1,Pt=Re.length,Xt=0,Te=[],Ze=ve?N:D,tt=[];for(fe=!1,n=!1,o=!1,Ct=0;Ct<Pt;Ct++)tt[Ct]=Se(Re[Ct]);for(Et=0;Et<Pt;Et++){if(vt=Xt,Te[Et]=He(Re,tt,Te,Et),Xe=240&(Xt=Ze[vt][J[Te[Et]]]),Xt&=15,Pe[Et]=Mt=Ze[Xt][5],Xe>0)if(Xe===16){for(Ct=Dt;Ct<Et;Ct++)Pe[Ct]=1;Dt=-1}else Dt=-1;if(Ze[Xt][6])Dt===-1&&(Dt=Et);else if(Dt>-1){for(Ct=Dt;Ct<Et;Ct++)Pe[Ct]=Mt;Dt=-1}tt[Et]==="B"&&(Pe[Et]=0),Je.hiLevel|=Mt}o&&function(dt,pt,Bt){for(var Ft=0;Ft<Bt;Ft++)if(dt[Ft]==="S"){pt[Ft]=ve;for(var Lt=Ft-1;Lt>=0&&dt[Lt]==="WS";Lt--)pt[Lt]=ve}}(tt,Pe,Pt)},at=function(Re,Pe,Je,Xe,Ct){if(!(Ct.hiLevel<Re)){if(Re===1&&ve===1&&!n)return Pe.reverse(),void(Je&&Je.reverse());for(var Et,Mt,vt,Dt,Pt=Pe.length,Xt=0;Xt<Pt;){if(Xe[Xt]>=Re){for(vt=Xt+1;vt<Pt&&Xe[vt]>=Re;)vt++;for(Dt=Xt,Mt=vt-1;Dt<Mt;Dt++,Mt--)Et=Pe[Dt],Pe[Dt]=Pe[Mt],Pe[Mt]=Et,Je&&(Et=Je[Dt],Je[Dt]=Je[Mt],Je[Mt]=Et);Xt=vt}Xt++}}},rt=function(Re,Pe,Je){var Xe=Re.split(""),Ct={hiLevel:ve};return Je||(Je=[]),Ne(Xe,Je,Ct),function(Et,Mt,vt){if(vt.hiLevel!==0&&S)for(var Dt,Pt=0;Pt<Et.length;Pt++)Mt[Pt]===1&&(Dt=he.indexOf(Et[Pt]))>=0&&(Et[Pt]=he[Dt+1])}(Xe,Je,Ct),at(2,Xe,Pe,Je,Ct),at(1,Xe,Pe,Je,Ct),Xe.join("")};return this.__bidiEngine__.doBidiReorder=function(Re,Pe,Je){if(function(Ct,Et){if(Et)for(var Mt=0;Mt<Ct.length;Mt++)Et[Mt]=Mt;s===void 0&&(s=Ge(Ct)),b===void 0&&(b=Ge(Ct))}(Re,Pe),l||!g||b)if(l&&g&&s^b)ve=s?1:0,Re=$e(Re,Pe,Je);else if(!l&&g&&b)ve=s?1:0,Re=rt(Re,Pe,Je),Re=$e(Re,Pe);else if(!l||s||g||b){if(l&&!g&&s^b)Re=$e(Re,Pe),s?(ve=0,Re=rt(Re,Pe,Je)):(ve=1,Re=rt(Re,Pe,Je),Re=$e(Re,Pe));else if(l&&s&&!g&&b)ve=1,Re=rt(Re,Pe,Je),Re=$e(Re,Pe);else if(!l&&!g&&s^b){var Xe=S;s?(ve=1,Re=rt(Re,Pe,Je),ve=0,S=!1,Re=rt(Re,Pe,Je),S=Xe):(ve=0,Re=rt(Re,Pe,Je),Re=$e(Re,Pe),ve=1,S=!1,Re=rt(Re,Pe,Je),S=Xe,Re=$e(Re,Pe))}}else ve=0,Re=rt(Re,Pe,Je);else ve=s?1:0,Re=rt(Re,Pe,Je);return Re},this.__bidiEngine__.setOptions=function(Re){Re&&(l=Re.isInputVisual,g=Re.isOutputVisual,s=Re.isInputRtl,b=Re.isOutputRtl,S=Re.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var n=r.text,o=(r.x,r.y,r.options||{}),l=(r.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var s=0;for(l=[],s=0;s<n.length;s+=1)Object.prototype.toString.call(n[s])==="[object Array]"?l.push([t.doBidiReorder(n[s][0]),n[s][1],n[s][2]]):l.push([t.doBidiReorder(n[s])]);r.text=l}else r.text=t.doBidiReorder(n);t.setOptions({isInputVisual:!0})}])}(Or),Or.API.TTFFont=function(){function i(e){var t;if(this.rawData=e,t=this.contents=new vd(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Sre(this),this.registerTTF()}return i.open=function(e){return new i(e)},i.prototype.parse=function(){return this.directory=new dre(this.contents),this.head=new pre(this),this.name=new vre(this),this.cmap=new W4(this),this.toUnicode={},this.hhea=new gre(this),this.maxp=new bre(this),this.hmtx=new xre(this),this.post=new yre(this),this.os2=new mre(this),this.loca=new Ere(this),this.glyf=new wre(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var e,t,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var l,s,g,b;for(b=[],l=0,s=(g=this.bbox).length;l<s;l++)e=g[l],b.push(Math.round(e*this.scaleFactor));return b}).call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},i.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},i.prototype.widthOfString=function(e,t,r){var n,o,l,s;for(l=0,o=0,s=(e=""+e).length;0<=s?o<s:o>s;o=0<=s?++o:--o)n=e.charCodeAt(o),l+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return l*(t/1e3)},i.prototype.lineHeight=function(e,t){var r;return t==null&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},i}();var hh,vd=function(){function i(e){this.data=e??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(e){return this.data[this.pos++]=e},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},i.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},i.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},i.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(e){return this.writeInt16(e)},i.prototype.readLongLong=function(){var e,t,r,n,o,l,s,g;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),l=this.readByte(),s=this.readByte(),g=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^l)+256*(255^s)+(255^g)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*o+65536*l+256*s+g},i.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(e){return this.writeInt32(e)},i.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},i.prototype.write=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(this.writeByte(t));return o},i}(),dre=function(){var i;function e(t){var r,n,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)r={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(t){var r,n,o,l,s,g,b,S,F,D,N,J,te;for(te in N=Object.keys(t).length,g=Math.log(2),F=16*Math.floor(Math.log(N)/g),l=Math.floor(F/g),S=16*N-F,(n=new vd).writeInt(this.scalarType),n.writeShort(N),n.writeShort(F),n.writeShort(l),n.writeShort(S),o=16*N,b=n.pos+o,s=null,J=[],t)for(D=t[te],n.writeString(te),n.writeInt(i(D)),n.writeInt(b),n.writeInt(D.length),J=J.concat(D),te==="head"&&(s=b),b+=D.length;b%4;)J.push(0),b++;return n.write(J),r=2981146554-i(n.data),n.pos=s+8,n.writeUInt32(r),n.data},i=function(t){var r,n,o,l;for(t=X4.call(t);t.length%4;)t.push(0);for(o=new vd(t),n=0,r=0,l=t.length;r<l;r=r+=4)n+=o.readUInt32();return 4294967295&n},e}(),fre={}.hasOwnProperty,Xh=function(i,e){for(var t in e)fre.call(e,t)&&(i[t]=e[t]);function r(){this.constructor=i}return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};hh=function(){function i(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var pre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new vd).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),K4=function(){function i(e,t){var r,n,o,l,s,g,b,S,F,D,N,J,te,he,ue,fe,ve;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),F=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(g=0;g<256;++g)this.codeMap[g]=e.readByte();break;case 4:for(N=e.readUInt16(),D=N/2,e.pos+=6,o=function(){var Se,Ge;for(Ge=[],g=Se=0;0<=D?Se<D:Se>D;g=0<=D?++Se:--Se)Ge.push(e.readUInt16());return Ge}(),e.pos+=2,te=function(){var Se,Ge;for(Ge=[],g=Se=0;0<=D?Se<D:Se>D;g=0<=D?++Se:--Se)Ge.push(e.readUInt16());return Ge}(),b=function(){var Se,Ge;for(Ge=[],g=Se=0;0<=D?Se<D:Se>D;g=0<=D?++Se:--Se)Ge.push(e.readUInt16());return Ge}(),S=function(){var Se,Ge;for(Ge=[],g=Se=0;0<=D?Se<D:Se>D;g=0<=D?++Se:--Se)Ge.push(e.readUInt16());return Ge}(),n=(this.length-e.pos+this.offset)/2,s=function(){var Se,Ge;for(Ge=[],g=Se=0;0<=n?Se<n:Se>n;g=0<=n?++Se:--Se)Ge.push(e.readUInt16());return Ge}(),g=ue=0,ve=o.length;ue<ve;g=++ue)for(he=o[g],r=fe=J=te[g];J<=he?fe<=he:fe>=he;r=J<=he?++fe:--fe)S[g]===0?l=r+b[g]:(l=s[S[g]/2+(r-J)-(D-g)]||0)!==0&&(l+=b[g]),this.codeMap[r]=65535&l}e.pos=F}return i.encode=function(e,t){var r,n,o,l,s,g,b,S,F,D,N,J,te,he,ue,fe,ve,Se,Ge,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct,Et,Mt,vt,Dt,Pt,Xt,Te,Ze,tt,dt,pt,Bt,Ft,Lt,Gt,ri,mi;switch(Xe=new vd,l=Object.keys(e).sort(function(yi,Pi){return yi-Pi}),t){case"macroman":for(te=0,he=function(){var yi=[];for(J=0;J<256;++J)yi.push(0);return yi}(),fe={0:0},o={},Ct=0,Dt=l.length;Ct<Dt;Ct++)fe[Lt=e[n=l[Ct]]]==null&&(fe[Lt]=++te),o[n]={old:e[n],new:fe[e[n]]},he[n]=fe[e[n]];return Xe.writeUInt16(1),Xe.writeUInt16(0),Xe.writeUInt32(12),Xe.writeUInt16(0),Xe.writeUInt16(262),Xe.writeUInt16(0),Xe.write(he),{charMap:o,subtable:Xe.data,maxGlyphID:te+1};case"unicode":for(Pe=[],F=[],ve=0,fe={},r={},ue=b=null,Et=0,Pt=l.length;Et<Pt;Et++)fe[Ge=e[n=l[Et]]]==null&&(fe[Ge]=++ve),r[n]={old:Ge,new:fe[Ge]},s=fe[Ge]-n,ue!=null&&s===b||(ue&&F.push(ue),Pe.push(n),b=s),ue=n;for(ue&&F.push(ue),F.push(65535),Pe.push(65535),rt=2*(at=Pe.length),Ne=2*Math.pow(Math.log(at)/Math.LN2,2),D=Math.log(Ne/2)/Math.LN2,$e=2*at-Ne,g=[],He=[],N=[],J=Mt=0,Xt=Pe.length;Mt<Xt;J=++Mt){if(Re=Pe[J],S=F[J],Re===65535){g.push(0),He.push(0);break}if(Re-(Je=r[Re].new)>=32768)for(g.push(0),He.push(2*(N.length+at-J)),n=vt=Re;Re<=S?vt<=S:vt>=S;n=Re<=S?++vt:--vt)N.push(r[n].new);else g.push(Je-Re),He.push(0)}for(Xe.writeUInt16(3),Xe.writeUInt16(1),Xe.writeUInt32(12),Xe.writeUInt16(4),Xe.writeUInt16(16+8*at+2*N.length),Xe.writeUInt16(0),Xe.writeUInt16(rt),Xe.writeUInt16(Ne),Xe.writeUInt16(D),Xe.writeUInt16($e),Bt=0,Te=F.length;Bt<Te;Bt++)n=F[Bt],Xe.writeUInt16(n);for(Xe.writeUInt16(0),Ft=0,Ze=Pe.length;Ft<Ze;Ft++)n=Pe[Ft],Xe.writeUInt16(n);for(Gt=0,tt=g.length;Gt<tt;Gt++)s=g[Gt],Xe.writeUInt16(s);for(ri=0,dt=He.length;ri<dt;ri++)Se=He[ri],Xe.writeUInt16(Se);for(mi=0,pt=N.length;mi<pt;mi++)te=N[mi],Xe.writeUInt16(te);return{charMap:r,subtable:Xe.data,maxGlyphID:ve+1}}},i}(),W4=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,o;for(t.pos=this.offset,this.version=t.readUInt16(),o=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)r=new K4(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,o;return r==null&&(r="macroman"),n=K4.encode(t,r),(o=new vd).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},e}(),gre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),mre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),yre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,o;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var l;for(n=t.readUInt16(),this.glyphNameIndex=[],l=0;0<=n?l<n:l>n;l=0<=n?++l:--l)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],o=[];t.pos<this.offset+this.length;)r=t.readByte(),o.push(this.names.push(t.readString(r)));return o;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 196608:break;case 262144:return this.map=(function(){var s,g,b;for(b=[],l=s=0,g=this.file.maxp.numGlyphs;0<=g?s<g:s>g;l=0<=g?++s:--s)b.push(t.readUInt32());return b}).call(this)}},e}(),_re=function(i,e){this.raw=i,this.length=i.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},vre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,o,l,s,g,b,S,F,D,N;for(t.pos=this.offset,t.readShort(),r=t.readShort(),g=t.readShort(),n=[],l=0;0<=r?l<r:l>r;l=0<=r?++l:--l)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+g+t.readShort()});for(b={},l=F=0,D=n.length;F<D;l=++F)o=n[l],t.pos=o.offset,S=t.readString(o.length),s=new _re(S,o),b[N=o.nameID]==null&&(b[N]=[]),b[o.nameID].push(s);this.strings=b,this.copyright=b[0],this.fontFamily=b[1],this.fontSubfamily=b[2],this.uniqueSubfamily=b[3],this.fontName=b[4],this.version=b[5];try{this.postscriptName=b[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=b[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=b[7],this.manufacturer=b[8],this.designer=b[9],this.description=b[10],this.vendorUrl=b[11],this.designerUrl=b[12],this.license=b[13],this.licenseUrl=b[14],this.preferredFamily=b[15],this.preferredSubfamily=b[17],this.compatibleFull=b[18],this.sampleText=b[19]},e}(),bre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),xre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,o,l,s,g,b;for(t.pos=this.offset,this.metrics=[],r=0,g=this.file.hhea.numberOfMetrics;0<=g?r<g:r>g;r=0<=g?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var S,F;for(F=[],r=S=0;0<=o?S<o:S>o;r=0<=o?++S:--S)F.push(t.readInt16());return F}(),this.widths=(function(){var S,F,D,N;for(N=[],S=0,F=(D=this.metrics).length;S<F;S++)l=D[S],N.push(l.advance);return N}).call(this),n=this.widths[this.widths.length-1],b=[],r=s=0;0<=o?s<o:s>o;r=0<=o?++s:--s)b.push(this.widths.push(n));return b},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),X4=[].slice,wre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,o,l,s,g,b,S,F,D;return t in this.cache?this.cache[t]:(l=this.file.loca,r=this.file.contents,n=l.indexOf(t),(o=l.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,s=(g=new vd(r.read(o))).readShort(),S=g.readShort(),D=g.readShort(),b=g.readShort(),F=g.readShort(),this.cache[t]=s===-1?new Cre(g,S,D,b,F):new Bre(g,s,S,D,b,F),this.cache[t]))},e.prototype.encode=function(t,r,n){var o,l,s,g,b;for(s=[],l=[],g=0,b=r.length;g<b;g++)o=t[r[g]],l.push(s.length),o&&(s=s.concat(o.encode(n)));return l.push(s.length),{table:s,offsets:l}},e}(),Bre=function(){function i(e,t,r,n,o,l){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=l,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),Cre=function(){function i(e,t,r,n,o){var l,s;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;s=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&s;)l.pos+=1&s?4:2,128&s?l.pos+=8:64&s?l.pos+=4:8&s&&(l.pos+=2)}return i.prototype.encode=function(){var e,t,r;for(t=new vd(X4.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},i}(),Ere=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Xh(e,hh),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=2)l.push(2*t.readUInt16());return l}).call(this):(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=4)l.push(t.readUInt32());return l}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),o=0,l=0,s=0;s<n.length;++s)if(n[s]=o,l<r.length&&r[l]==s){++l,n[s]=o;var g=this.offsets[s],b=this.offsets[s+1]-g;b>0&&(o+=b)}for(var S=new Array(4*n.length),F=0;F<n.length;++F)S[4*F+3]=255&n[F],S[4*F+2]=(65280&n[F])>>8,S[4*F+1]=(16711680&n[F])>>16,S[4*F]=(4278190080&n[F])>>24;return S},e}(),Sre=function(){function i(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var e,t,r,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)r=o[t],e[t]=n[r];return e},i.prototype.glyphsFor=function(e){var t,r,n,o,l,s,g;for(n={},l=0,s=e.length;l<s;l++)n[o=e[l]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(r=n[o])!=null&&r.compound&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(o in g=this.glyphsFor(t))r=g[o],n[o]=r;return n},i.prototype.encode=function(e,t){var r,n,o,l,s,g,b,S,F,D,N,J,te,he,ue;for(n in r=W4.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(e),N={0:0},ue=r.charMap)N[(g=ue[n]).old]=g.new;for(J in D=r.maxGlyphID,l)J in N||(N[J]=D++);return S=function(fe){var ve,Se;for(ve in Se={},fe)Se[fe[ve]]=ve;return Se}(N),F=Object.keys(S).sort(function(fe,ve){return fe-ve}),te=function(){var fe,ve,Se;for(Se=[],fe=0,ve=F.length;fe<ve;fe++)s=F[fe],Se.push(S[s]);return Se}(),o=this.font.glyf.encode(l,te,N),b=this.font.loca.encode(o.offsets,te),he={cmap:this.font.cmap.raw(),glyf:o.table,loca:b,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(he["OS/2"]=this.font.os2.raw()),this.font.directory.encode(he)},i}();Or.API.PDFObject=function(){var i;function e(){}return i=function(t,r){return(Array(r+1).join("0")+t).slice(-r)},e.convert=function(t){var r,n,o,l;if(Array.isArray(t))return"["+function(){var s,g,b;for(b=[],s=0,g=t.length;s<g;s++)r=t[s],b.push(e.convert(r));return b}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+i(t.getUTCFullYear(),4)+i(t.getUTCMonth(),2)+i(t.getUTCDate(),2)+i(t.getUTCHours(),2)+i(t.getUTCMinutes(),2)+i(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(n in o=["<<"],t)l=t[n],o.push("/"+n+" "+e.convert(l));return o.push(">>"),o.join(`
`)}return""+t},e}(),function(i){var e={};function t(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=i,t.c=e,t.d=function(r,n,o){t.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},t.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,n){if(1&n&&(r=t(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var l in r)t.d(o,l,(function(s){return r[s]}).bind(null,l));return o},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="",t(t.s=0)}([function(i,e,t){i.exports=t(1)},function(i,e){function t(n,o){for(var l=0;l<o.length;l++){var s=o[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}var r=function(){function n(){(function(s,g){if(!(s instanceof g))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,l;return o=n,(l=[{key:"show",value:function(s){this.setOptions(s),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var s=document.getElementById("loading-overlay-stylesheet");s&&(s.disabled=!0,s.parentNode.removeChild(s),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(s){if(s!==void 0)for(var g in s)this.options[g]=s[g]}},{key:"generateAndAddOverlayElement",value:function(){var s="50%";this.options.offsetX!==0&&(s="calc(50% + "+this.options.offsetX+")");var g="50%";if(this.options.offsetY!==0&&(g="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var b='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(g,"; left: ").concat(s,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),S=document.getElementById(this.options.containerID);return S.style.position="relative",void S.insertAdjacentHTML("beforeend",b)}var F='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(g,"; left: ").concat(s,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",F)}},{key:"generateSpinnerElement",value:function(){var s=this,g=Object.keys(this.numberOfEmptyDivForSpinner).find(function(S){return S===s.options.spinnerIcon}),b=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[g]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(b,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var s=document.createElement("link");s.setAttribute("id","loading-overlay-stylesheet"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(s)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(s){for(var g="",b=1;b<=s;b++)g+="<div></div>";return g}}])&&t(o.prototype,l),n}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);const bd={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Hy={in:"in",mm:"mm"},Mg={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Gy={Landscape:"landscape",Portrait:"portrait"},RC={72:72,96:96,200:200,300:300,400:400};let Tre=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mg.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:bd.PNG.toString(),o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hy.mm,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Ps(this,"map"),Ps(this,"width"),Ps(this,"height"),Ps(this,"dpi"),Ps(this,"format"),Ps(this,"unit"),Ps(this,"fileName"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=r,this.format=n,this.unit=o,this.fileName=l}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),r.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const s=o.sources;Object.keys(s).forEach(g=>{const b=s[g];Object.keys(b).forEach(S=>{b[S]||delete b[S]})})}const l=new Sie.Map({container:n,style:o,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});l.once("idle",()=>{var s;const g=l.getCanvas(),b=`${this.fileName}.${e.format}`;switch(e.format){case bd.PNG:e.toPNG(g,b);break;case bd.JPEG:e.toJPEG(g,b);break;case bd.PDF:e.toPDF(l,b);break;case bd.SVG:e.toSVG(g,b);break;default:console.error(`Invalid file format: ${e.format}`);break}l.remove(),(s=r.parentNode)==null||s.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return t}}),r.remove(),JsLoadingOverlay.hide()})}toPNG(e,t){const r=document.createElement("a");r.href=e.toDataURL(),r.download=t,r.click(),r.remove()}toJPEG(e,t){const r=e.toDataURL("image/jpeg",.85);if(e.msToBlob){const n=this.toBlob(r);window.navigator.msSaveBlob(n,t)}else{const n=document.createElement("a");n.href=r,n.download=t,n.click(),n.remove()}}toPDF(e,t){const r=e.getCanvas(),n=new Or({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:l}=e.getCenter();n.setProperties({title:e.getStyle().name,subject:`center: [${o}, ${l}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(t)}toSVG(e,t){const r=e.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),l=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${n}" height="${o}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(l)}`,s.download=t,s.click(),s.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hy.mm&&(t/=25.4),`${t*e}px`}toBlob(e){const t=atob(e.replace(/^.*,/,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return new Blob([r.buffer],{type:"image/png"})}},Ire=class{constructor(e){Ps(this,"map"),Ps(this,"width"),Ps(this,"height"),Ps(this,"unit"),Ps(this,"svgCanvas"),Ps(this,"svgPath");var t,r,n;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,l=(r=this.map)==null?void 0:r.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${o}px`),s.setAttribute("height",`${l}px`);const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill:#888888;stroke-width:0"),g.setAttribute("fill-opacity","0.5"),s.append(g),(n=this.map)==null||n.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=g}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=Hy.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),n=this.toPixels(this.height),o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,l=(t=this.map)==null?void 0:t.getCanvas().clientHeight,s=o/2-r/2,g=s+r,b=l/2-n/2,S=b+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${l}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${l} L 0 ${l} M ${s} ${b} L ${s} ${S} L ${g} ${S} L ${g} ${b}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hy.mm&&(t/=25.4),t*e}};const Z4={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},Lre={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer"},Mre={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Pre={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen"},Fre={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},Dre={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar"},Rre={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To"},kre={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:""},Ore={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},Ure={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},Nre={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:""};let zre=class{constructor(e){Ps(this,"controlContainer"),Ps(this,"exportContainer"),Ps(this,"crosshair"),Ps(this,"printableArea"),Ps(this,"map"),Ps(this,"exportButton"),Ps(this,"options",{PageSize:Mg.A4,PageOrientation:Gy.Landscape,Format:bd.PDF,DPI:RC[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Mg),Filename:"map"}),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Pre;case"en":return Z4;case"fr":return Lre;case"fi":return Mre;case"sv":return Fre;case"es":return Dre;case"vi":return Rre;case"uk":return kre;case"zhHans":return Ore;case"zhHant":return Ure;case"ja":return Nre;default:return Z4}}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const n={};(t=this.options.AllowedSizes)==null||t.forEach(S=>{Mg[S]&&(n[S]=Mg[S])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(S,F)=>JSON.stringify(S[F]));r.appendChild(o);const l=this.createSelection(Gy,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(S,F)=>S[F]);r.appendChild(l);const s=this.createSelection(bd,this.getTranslation().Format,"format-type",this.options.Format,(S,F)=>S[F]);r.appendChild(s);const g=this.createSelection(RC,this.getTranslation().DPI,"dpi-type",this.options.DPI,(S,F)=>S[F]);r.appendChild(g),this.exportContainer.appendChild(r);const b=document.createElement("button");return b.type="button",b.textContent=this.getTranslation().Generate,b.classList.add("generate-button"),b.addEventListener("click",()=>{const S=document.getElementById("mapbox-gl-export-page-size"),F=document.getElementById("mapbox-gl-export-page-orientation"),D=document.getElementById("mapbox-gl-export-format-type"),N=document.getElementById("mapbox-gl-export-dpi-type"),J=F.value;let te=JSON.parse(S.value);J===Gy.Portrait&&(te=te.reverse()),new Tre(e,te,Number(N.value),D.value,Hy.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(b),this.controlContainer}createSelection(e,t,r,n,o){const l=document.createElement("label");l.textContent=t;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${r}`),s.style.width="100%",Object.keys(e).forEach(F=>{const D=document.createElement("option");D.setAttribute("value",o(e,F)),D.appendChild(document.createTextNode(F)),D.setAttribute("name",r),n===e[F]&&(D.selected=!0),s.appendChild(D)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const g=document.createElement("TR"),b=document.createElement("TD"),S=document.createElement("TD");return b.appendChild(l),S.appendChild(s),g.appendChild(b),g.appendChild(S),g}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Lie(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Ire(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(e.value);t===Gy.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}};var J4=Vre,Qre=Object.prototype.hasOwnProperty;function Vre(){for(var i={},e=0;e<arguments.length;e++){var t=arguments[e];for(var r in t)Qre.call(t,r)&&(i[r]=t[r])}return i}var Y4={exports:{}};(function(i,e){(function(){var t={};i.exports=t,t.simpleFilter=function(r,n){return n.filter(function(o){return t.test(r,o)})},t.test=function(r,n){return t.match(r,n)!==null},t.match=function(r,n,o){o=o||{};var l=0,s=[],g=n.length,b=0,S=0,F=o.pre||"",D=o.post||"",N=o.caseSensitive&&n||n.toLowerCase(),J;r=o.caseSensitive&&r||r.toLowerCase();for(var te=0;te<g;te++)J=n[te],N[te]===r[l]?(J=F+J+D,l+=1,S+=1+S):S=0,b+=S,s[s.length]=J;return l===r.length?(b=N===r?1/0:b,{rendered:s.join(""),score:b}):null},t.filter=function(r,n,o){return!n||n.length===0?[]:typeof r!="string"?n:(o=o||{},n.reduce(function(l,s,g,b){var S=s;o.extract&&(S=o.extract(s));var F=t.match(r,S,o);return F!=null&&(l[l.length]={string:F.rendered,score:F.score,index:g,original:s}),l},[]).sort(function(l,s){var g=s.score-l.score;return g||l.index-s.index}))}})()})(Y4);var Hre=Y4.exports,Mc=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Mc.prototype.show=function(){this.element.style.display="block"},Mc.prototype.hide=function(){this.element.style.display="none"},Mc.prototype.add=function(i){this.items.push(i)},Mc.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},Mc.prototype.isEmpty=function(){return!this.items.length},Mc.prototype.isVisible=function(){return this.element.style.display==="block"},Mc.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()},Mc.prototype.drawItem=function(i,e){var t=document.createElement("li"),r=document.createElement("a");e&&(t.className+=" active"),r.innerHTML=i.string,t.appendChild(r),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))},Mc.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()},Mc.prototype.move=function(i){this.active=i,this.draw()},Mc.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},Mc.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},Mc.prototype.drawError=function(i){var e=document.createElement("li");e.innerHTML=i,this.element.appendChild(e),this.show()};var Gre=Mc,jre=J4,qre=Hre,$re=Gre,Rl=function(i,e,t){return t=t||{},this.options=jre({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=i,this.data=e||[],this.list=new $re(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Rl.prototype.handleKeyUp=function(i,e){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},Rl.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},Rl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},Rl.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(i.target.value)},100)}},Rl.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},Rl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},Rl.prototype.update=function(i){this.data=i,this.handleKeyUp()},Rl.prototype.clear=function(){this.data=[],this.list.clear()},Rl.prototype.normalize=function(i){return i=i.toLowerCase(),i},Rl.prototype.match=function(i,e){return i.indexOf(e)>-1},Rl.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},Rl.prototype.getCandidates=function(i){var e={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},t;this.options.filter?(t=qre.filter(this.query,this.data,e),t=t.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):t=this.data.map((function(r){var n=this.render(r);return{original:r,string:n}}).bind(this)),i(t)},Rl.prototype.getItemValue=function(i){return i},Rl.prototype.render=function(i,e){if(e)return e;for(var t=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(t),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;t=t.slice(0,n)+"<strong>"+t.slice(n,o)+"</strong>"+t.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return t},Rl.prototype.renderError=function(i){this.list.drawError(i)};var Kre=Rl,eD=Kre,Wre=eD;typeof window<"u"&&(window.Suggestions=eD);var Xre="Expected a function",tD=NaN,Zre="[object Symbol]",Jre=/^\s+|\s+$/g,Yre=/^[-+]0x[0-9a-f]+$/i,ene=/^0b[01]+$/i,tne=/^0o[0-7]+$/i,ine=parseInt,rne=typeof cf=="object"&&cf&&cf.Object===Object&&cf,nne=typeof self=="object"&&self&&self.Object===Object&&self,sne=rne||nne||Function("return this")(),one=Object.prototype,ane=one.toString,lne=Math.max,cne=Math.min,kC=function(){return sne.Date.now()};function une(i,e,t){var r,n,o,l,s,g,b=0,S=!1,F=!1,D=!0;if(typeof i!="function")throw new TypeError(Xre);e=iD(e)||0,OC(t)&&(S=!!t.leading,F="maxWait"in t,o=F?lne(iD(t.maxWait)||0,e):o,D="trailing"in t?!!t.trailing:D);function N(He){var $e=r,Ne=n;return r=n=void 0,b=He,l=i.apply(Ne,$e),l}function J(He){return b=He,s=setTimeout(ue,e),S?N(He):l}function te(He){var $e=He-g,Ne=He-b,at=e-$e;return F?cne(at,o-Ne):at}function he(He){var $e=He-g,Ne=He-b;return g===void 0||$e>=e||$e<0||F&&Ne>=o}function ue(){var He=kC();if(he(He))return fe(He);s=setTimeout(ue,te(He))}function fe(He){return s=void 0,D&&r?N(He):(r=n=void 0,l)}function ve(){s!==void 0&&clearTimeout(s),b=0,r=g=n=s=void 0}function Se(){return s===void 0?l:fe(kC())}function Ge(){var He=kC(),$e=he(He);if(r=arguments,n=this,g=He,$e){if(s===void 0)return J(g);if(F)return s=setTimeout(ue,e),N(g)}return s===void 0&&(s=setTimeout(ue,e)),l}return Ge.cancel=ve,Ge.flush=Se,Ge}function OC(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function hne(i){return!!i&&typeof i=="object"}function Ane(i){return typeof i=="symbol"||hne(i)&&ane.call(i)==Zre}function iD(i){if(typeof i=="number")return i;if(Ane(i))return tD;if(OC(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=OC(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=i.replace(Jre,"");var t=ene.test(i);return t||tne.test(i)?ine(i.slice(2),t?2:8):Yre.test(i)?tD:+i}var dne=une,UC={exports:{}},Pg=typeof Reflect=="object"?Reflect:null,rD=Pg&&typeof Pg.apply=="function"?Pg.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},cv;Pg&&typeof Pg.ownKeys=="function"?cv=Pg.ownKeys:Object.getOwnPropertySymbols?cv=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:cv=function(e){return Object.getOwnPropertyNames(e)};function fne(i){console&&console.warn&&console.warn(i)}var nD=Number.isNaN||function(e){return e!==e};function ws(){ws.init.call(this)}UC.exports=ws,UC.exports.once=yne,ws.EventEmitter=ws,ws.prototype._events=void 0,ws.prototype._eventsCount=0,ws.prototype._maxListeners=void 0;var sD=10;function uv(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(ws,"defaultMaxListeners",{enumerable:!0,get:function(){return sD},set:function(i){if(typeof i!="number"||i<0||nD(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");sD=i}}),ws.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ws.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||nD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function oD(i){return i._maxListeners===void 0?ws.defaultMaxListeners:i._maxListeners}ws.prototype.getMaxListeners=function(){return oD(this)},ws.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var s=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw s.context=l,s}var g=o[e];if(g===void 0)return!1;if(typeof g=="function")rD(g,this,t);else for(var b=g.length,S=hD(g,b),r=0;r<b;++r)rD(S[r],this,t);return!0};function aD(i,e,t,r){var n,o,l;if(uv(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),l=o[e]),l===void 0)l=o[e]=t,++i._eventsCount;else if(typeof l=="function"?l=o[e]=r?[t,l]:[l,t]:r?l.unshift(t):l.push(t),n=oD(i),n>0&&l.length>n&&!l.warned){l.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=i,s.type=e,s.count=l.length,fne(s)}return i}ws.prototype.addListener=function(e,t){return aD(this,e,t,!1)},ws.prototype.on=ws.prototype.addListener,ws.prototype.prependListener=function(e,t){return aD(this,e,t,!0)};function pne(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function lD(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=pne.bind(r);return n.listener=t,r.wrapFn=n,n}ws.prototype.once=function(e,t){return uv(t),this.on(e,lD(this,e,t)),this},ws.prototype.prependOnceListener=function(e,t){return uv(t),this.prependListener(e,lD(this,e,t)),this},ws.prototype.removeListener=function(e,t){var r,n,o,l,s;if(uv(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,l=r.length-1;l>=0;l--)if(r[l]===t||r[l].listener===t){s=r[l].listener,o=l;break}if(o<0)return this;o===0?r.shift():gne(r,o),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},ws.prototype.off=ws.prototype.removeListener,ws.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),l;for(n=0;n<o.length;++n)l=o[n],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function cD(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?mne(n):hD(n,n.length)}ws.prototype.listeners=function(e){return cD(this,e,!0)},ws.prototype.rawListeners=function(e){return cD(this,e,!1)},ws.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):uD.call(i,e)},ws.prototype.listenerCount=uD;function uD(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}ws.prototype.eventNames=function(){return this._eventsCount>0?cv(this._events):[]};function hD(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function gne(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function mne(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function yne(i,e){return new Promise(function(t,r){function n(l){i.removeListener(e,o),r(l)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}AD(i,e,o,{once:!0}),e!=="error"&&_ne(i,n,{once:!0})})}function _ne(i,e,t){typeof i.on=="function"&&AD(i,"error",e,t)}function AD(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(o){r.once&&i.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var dD=UC.exports,vne={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},bne={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},xne={placeholder:bne},fD={exports:{}};(function(i){(function(e,t,r){i.exports?i.exports=r():e[t]=r()})(cf,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(g){return g.match(t)||[]}function n(g){return r(g).filter(function(b,S){return b&&S})}function o(g){return g=r(g),{language:g[1]||e,extlang:g[2]||e,script:g[3]||e,region:g[4]||e}}function l(g,b,S){Object.defineProperty(g,b,{value:S,enumerable:!0})}function s(g,b,S){function F(D){return r(D)[g]||e}l(F,"pattern",b),l(o,S,F)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),l(o,"split",n),o})})(fD);var wne=fD.exports,Bne=Wre,Cne=dne,su=J4,Ene=dD.EventEmitter,pD=vne,Sne=xne,Tne=wne;function gD(i,e){this._eventEmitter=new Ene,this.options=su({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}gD.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var s=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+s.splice(1,s.length).join(",")+"</div></div></div>"}else{var e=i.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),r=this.query.length,n=e.substring(0,t),o=e.substring(t,t+r),l=e.substring(t+r);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+o+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var e=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function e(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=r.onAdd();n.appendChild(o)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)e(this,i);else if(typeof i=="string"){var t=document.querySelectorAll(i);if(t.length===0)throw new Error("Element ",i,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Cne(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(r),this._typeahead=new Bne(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(i,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var r=document.createElement("div");r.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var n=r.firstChild,o=n.firstChild;t.appendChild(o)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var e=(i.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(i){var e=27,t=9;if(i.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,n=r?r.value:"";if(!n)return this.fresh=!0,i.keyCode!==t&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[t,e,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),i.properties&&pD[i.properties.short_code])e=su({},this.options.flyTo),this._map&&this._map.fitBounds(pD[i.properties.short_code].bbox,e);else if(i.bbox){var t=i.bbox;e=su({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var r={zoom:this.options.zoom};e=su({},r,this.options.flyTo),i.center?e.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(e.center=i.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=i.reduce(function(r,n){return e.options[n]&&(["countries","types","language"].indexOf(n)>-1?r[n]=e.options[n].split(/[\s,]+/):r[n]=e.options[n],n==="proximity"&&e.options[n]&&typeof e.options[n].longitude=="number"&&typeof e.options[n].latitude=="number"&&(r[n]=[e.options[n].longitude,e.options[n].latitude])),r},{});return t},_geocode:function(i,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var l=i.split(/[\s(,)?]+/).map(function(b){return parseFloat(b,10)}).reverse();n.types&&n.types[0],n=su(n,{query:l,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=su(n,{query:i}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var s=[];this.options.localGeocoder&&(s=this.options.localGeocoder(i),s||(s=[]));var g=[];return o.catch((function(b){r=b}).bind(this)).then((function(b){this._loadingEl.style.display="none";var S={};return b?S=b:S={type:"FeatureCollection",features:[]},S.config=n,this.fresh&&(this.fresh=!1),S.features=S.features?s.concat(S.features):s,this.options.externalGeocoder?(g=this.options.externalGeocoder(i,S.features,n)||[],g.then(function(F){return S.features=S.features?F.concat(S.features):F,S},function(){return S})):S}).bind(this)).then((function(b){if(r)throw r;this.options.filter&&b.features.length&&(b.features=b.features.filter(this.options.filter));var S=[];b.suggestions?S=b.suggestions:b.place?S=[b.place]:S=b.features,S.length?(this._clearEl.style.display="block",this._typeahead.update(S),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(b.features.length>0||b.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",b)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",b))}).bind(this)).catch((function(b){this._loadingEl.style.display="none",s.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(s)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:b})}).bind(this)),o},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var e=this;i.relatedTarget&&e._clear(i)},_onQueryResult:function(i){var e=i;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],e=Tne.language(i),t=Sne.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=su({},e,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(n){r.extend(n.geometry.coordinates)}),this._map.fitBounds(r.toArray(),t)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=su({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var r;if(this.options.popup){var n={},o=su({},n,this.options.popup);r=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=su({},e,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);t=su(t,{element:n})}var o=new this._maplibregl.Marker(su({},t,{element:n})),l;if(this.options.popup){var s={},g=su({},s,this.options.popup);l=new this._maplibregl.Popup(g).setHTML(this.options.popupRender(r))}r.center?(o.setLngLat(r.center).addTo(this._map),this.options.popup&&o.setPopup(l)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(o.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(l)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,e){return this._eventEmitter.on(i,e),this},off:function(i,e){return this._eventEmitter.removeListener(i,e),this}};var Ine=gD;const Lne=Um(Ine),En={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/ICGC_color_norma.svg",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/ICGC_white_norma.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:{0:{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},1:{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},2:{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},3:{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},4:{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},5:{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},6:{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}},urlTerrainICGC:{0:{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},1:{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}},ortoLayersICGC:{0:{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},1:{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},2:{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},3:{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},4:{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},5:{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},6:{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},7:{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},8:{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},9:{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},10:{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},11:{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},12:{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},13:{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},14:{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},15:{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},16:{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},17:{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},18:{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},19:{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},20:{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},21:{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},22:{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},23:{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},24:{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},25:{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},26:{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},27:{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},28:{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},29:{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},30:{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},31:{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},32:{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},33:{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},34:{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},35:{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},36:{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},37:{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},38:{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},39:{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},40:{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},41:{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},42:{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},43:{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},44:{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},45:{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}},vectorLayersICGC:{0:{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},1:{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},2:{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},3:{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},4:{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},5:{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},6:{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},7:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},8:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},9:{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},10:{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},11:{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},12:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},13:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},14:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},15:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},16:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},17:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},18:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},19:{name:"catalunyaVigent",key:"catalunya_vigent"},20:{name:"catalunyaVigentText",key:"catalunya_vigent_text"},21:{name:"comarques2022",key:"comarques_2022"},22:{name:"comarquesVigent",key:"comarques_vigent"},23:{name:"comarquesVigentText",key:"comarques_vigent_text"},24:{name:"districtesCensals2002",key:"districtes_censals_2002"},25:{name:"districtesCensals2003",key:"districtes_censals_2003"},26:{name:"districtesCensals2004",key:"districtes_censals_2004"},27:{name:"districtesCensals2005",key:"districtes_censals_2005"},28:{name:"districtesCensals2006",key:"districtes_censals_2006"},29:{name:"districtesCensals2007",key:"districtes_censals_2007"},30:{name:"districtesCensals2008",key:"districtes_censals_2008"},31:{name:"districtesCensals2009",key:"districtes_censals_2009"},32:{name:"districtesCensals2010",key:"districtes_censals_2010"},33:{name:"districtesCensals2011",key:"districtes_censals_2011"},34:{name:"districtesCensals2012",key:"districtes_censals_2012"},35:{name:"districtesCensals2013",key:"districtes_censals_2013"},36:{name:"districtesCensals2014",key:"districtes_censals_2014"},37:{name:"districtesCensals2015",key:"districtes_censals_2015"},38:{name:"districtesCensals2016",key:"districtes_censals_2016"},39:{name:"districtesCensals2017",key:"districtes_censals_2017"},40:{name:"districtesCensals2018",key:"districtes_censals_2018"},41:{name:"districtesCensals2019",key:"districtes_censals_2019"},42:{name:"districtesCensals2020",key:"districtes_censals_2020"},43:{name:"districtesCensals2021",key:"districtes_censals_2021"},44:{name:"districtesCensals2022",key:"districtes_censals_2022"},45:{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},46:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},47:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},48:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},49:{name:"municipis2022",key:"municipis_2022"},50:{name:"municipis2022Text",key:"municipis_2022_text"},51:{name:"municipisVigent",key:"municipis_vigent"},52:{name:"municipisVigentText",key:"municipis_vigent_text"},53:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},54:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},55:{name:"plaTerritorial2015",key:"pla_territorial_2015"},56:{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},57:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},58:{name:"provinciesVigent",key:"provincies_vigent"},59:{name:"provinciesVigentText",key:"provincies_vigent_text"},60:{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},61:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},62:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},63:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},64:{name:"seccionsCensals2002",key:"seccions_censals_2002"},65:{name:"seccionsCensals2003",key:"seccions_censals_2003"},66:{name:"seccionsCensals2004",key:"seccions_censals_2004"},67:{name:"seccionsCensals2005",key:"seccions_censals_2005"},68:{name:"seccionsCensals2006",key:"seccions_censals_2006"},69:{name:"seccionsCensals2007",key:"seccions_censals_2007"},70:{name:"seccionsCensals2008",key:"seccions_censals_2008"},71:{name:"seccionsCensals2009",key:"seccions_censals_2009"},72:{name:"seccionsCensals2010",key:"seccions_censals_2010"},73:{name:"seccionsCensals2011",key:"seccions_censals_2011"},74:{name:"seccionsCensals2012",key:"seccions_censals_2012"},75:{name:"seccionsCensals2013",key:"seccions_censals_2013"},76:{name:"seccionsCensals2014",key:"seccions_censals_2014"},77:{name:"seccionsCensals2015",key:"seccions_censals_2015"},78:{name:"seccionsCensals2016",key:"seccions_censals_2016"},79:{name:"seccionsCensals2017",key:"seccions_censals_2017"},80:{name:"seccionsCensals2018",key:"seccions_censals_2018"},81:{name:"seccionsCensals2019",key:"seccions_censals_2019"},82:{name:"seccionsCensals2020",key:"seccions_censals_2020"},83:{name:"seccionsCensals2021",key:"seccions_censals_2021"},84:{name:"seccionsCensals2022",key:"seccions_censals_2022"},85:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},86:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},87:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},88:{name:"vegueriesVigent",key:"vegueries_vigent"},89:{name:"vegueriesVigentText",key:"vegueries_vigent_text"}},vectorLayers:{0:{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}},wmsLayers:{0:{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},1:{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},2:{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},3:{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},4:{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},5:{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},6:{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},fgbLayers:{0:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},1:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},2:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},3:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},4:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},5:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},6:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},7:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},8:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},9:{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},10:{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},11:{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},12:{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},13:{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},14:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},15:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},16:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},17:{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},18:{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},19:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},20:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},21:{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},22:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},23:{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},24:{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},25:{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},26:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},27:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},28:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},29:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},30:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},31:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},32:{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},33:{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}}};class Mne{constructor(e){this.options=e}onAdd(e){return this._map=e,this._img=document.createElement("img"),this._img.className="maplibregl-ctrl",this._img.src=this.options.color?En.logoOptions.logoUrlColor:En.logoOptions.logoUrlWhite,this._img.width=En.logoOptions.logoWidth,this._img.title=En.logoOptions.logoTitle,this.link=document.createElement("a"),this.link.href=En.logoOptions.logoLink,this.link.target="_blank",this.link.appendChild(this._img),this._container=document.createElement("div"),this._container.className="maplibregl-ctrl",this._container.style=`width:${En.logoOptions.logoWidth}px`,this._container.appendChild(this.link),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}var Fg=mD.prototype,NC="WGS 84";function mD(i){i!==void 0&&(NC=i),this.setEllipsoid(NC)}Fg.convertLatLngToUtm=function(i,e,t){var r;if(this.status)return"No ecclipsoid data associated with unknown datum: "+NC;if(!Number.isInteger(t))return"Precision is not integer number.";i=parseFloat(i),e=parseFloat(e);var n=e,o=this.toRadians(i),l=this.toRadians(n);n>=8&&n<=13&&i>54.5&&i<58||i>=56&&i<64&&n>=3&&n<12?r=32:(r=(n+180)/6+1,i>=72&&i<84&&(n>=0&&n<9?r=31:n>=9&&n<21?r=33:n>=21&&n<33?r=35:n>=33&&n<42&&(r=37))),r=parseInt(r);var s=(r-1)*6-180+3,g=this.toRadians(s),b=this.getUtmLetterDesignator(i),S=this.eccSquared/(1-this.eccSquared),F=this.a/Math.sqrt(1-this.eccSquared*Math.sin(o)*Math.sin(o)),D=Math.tan(o)*Math.tan(o),N=S*Math.cos(o)*Math.cos(o),J=Math.cos(o)*(l-g),te=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*o-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*o)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*o)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*o)),he=parseFloat(.9996*F*(J+(1-D+N)*J*J*J/6+(5-18*D+D*D+72*N-58*S)*J*J*J*J*J/120)+5e5),ue=parseFloat(.9996*(te+F*Math.tan(o)*(J*J/2+(5-D+9*N+4*N*N)*J*J*J*J/24+(61-58*D+D*D+600*N-330*S)*J*J*J*J*J*J/720)));return i<0&&(ue+=1e7),ue=yD(ue,t),he=yD(he,t),{Easting:he,Northing:ue,ZoneNumber:parseInt(r),ZoneLetter:b}},Fg.convertUtmToLatLng=function(i,e,t,r){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),o=i-5e5,l=e,s=t,g=r;if(i===void 0)return"Please pass the UTMEasting!";if(e===void 0)return"Please pass the UTMNorthing!";if(t===void 0)return"Please pass the UTMZoneNumber!";if(r===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(g)!==-1||(l-=1e7);var b=(s-1)*6-180+3,S=this.eccSquared/(1-this.eccSquared),F=l/.9996,D=F/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),N=D+(3*n/2-27*n*n*n/32)*Math.sin(2*D)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*D)+151*n*n*n/96*Math.sin(6*D);this.toDegrees(N);var J=this.a/Math.sqrt(1-this.eccSquared*Math.sin(N)*Math.sin(N)),te=Math.tan(N)*Math.tan(N),he=S*Math.cos(N)*Math.cos(N),ue=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(N)*Math.sin(N),1.5),fe=o/(J*.9996),ve=N-J*Math.tan(N)/ue*(fe*fe/2-(5+3*te+10*he-4*he*he-9*S)*fe*fe*fe*fe/24+(61+90*te+298*he+45*te*te-252*S-3*he*he)*fe*fe*fe*fe*fe*fe/720);ve=this.toDegrees(ve);var Se=(fe-(1+2*te+he)*fe*fe*fe/6+(5-2*he+28*te-3*he*he+8*S+24*te*te)*fe*fe*fe*fe*fe/120)/Math.cos(N);return Se=b+this.toDegrees(Se),{lat:ve,lng:Se}},Fg.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"},Fg.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},Fg.toDegrees=function(i){return i/Math.PI*180},Fg.toRadians=function(i){return i*Math.PI/180};function yD(i,e){var t=Math.pow(10,e);return Math.round(i*t)/t}var Pne=mD;const Fne=Um(Pne);class Dne{constructor(e){this.options=e||{}}onAdd(e){const t=new Fne;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",r=>{const n=r.lngLat.lat,o=r.lngLat.lng;let l="";if(this._lookUTM31(o,n)){const g=t.convertLatLngToUtm(n,o,2);l=`ETRS89 UTM 31N X:<b> ${g.Easting}</b> Y:<b> ${g.Northing}</b> <br>`}const s=`${l}WGS 84 Lon:<b> ${o.toFixed(6)}</b>  Lat:<b> ${n.toFixed(6)}</b>`;this._container.innerHTML=s}),this._container}_lookUTM31(e,t){var r=0,n=0,o=6,l=84;return e>=r&&e<=o&&t>=n&&t<=l}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const hv={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Dg={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},jo={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2002:"districtes_censals_2002",districtesCensals2003:"districtes_censals_2003",districtesCensals2004:"districtes_censals_2004",districtesCensals2005:"districtes_censals_2005",districtesCensals2006:"districtes_censals_2006",districtesCensals2007:"districtes_censals_2007",districtesCensals2008:"districtes_censals_2008",districtesCensals2009:"districtes_censals_2009",districtesCensals2010:"districtes_censals_2010",districtesCensals2011:"districtes_censals_2011",districtesCensals2012:"districtes_censals_2012",districtesCensals2013:"districtes_censals_2013",districtesCensals2014:"districtes_censals_2014",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2002:"seccions_censals_2002",seccionsCensals2003:"seccions_censals_2003",seccionsCensals2004:"seccions_censals_2004",seccionsCensals2005:"seccions_censals_2005",seccionsCensals2006:"seccions_censals_2006",seccionsCensals2007:"seccions_censals_2007",seccionsCensals2008:"seccions_censals_2008",seccionsCensals2009:"seccions_censals_2009",seccionsCensals2010:"seccions_censals_2010",seccionsCensals2011:"seccions_censals_2011",seccionsCensals2012:"seccions_censals_2012",seccionsCensals2013:"seccions_censals_2013",seccionsCensals2014:"seccions_censals_2014",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"}};let Rne=class{constructor(e){if(!e)e=En.mapOptions;else for(const t in En.mapOptions){let r=[En.mapOptions.center[0],En.mapOptions.center[1]];En.mapOptions.center=r,e.hasOwnProperty(t)||(e[t]=En.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new rc.Map(e),this.map.options=e,this.map.addControl(new rc.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name;if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this.map.addControl(new Mne({color:t.indexOf("orto")===-1}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(e){try{e===void 0&&(e="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:rc,showResultsWhileTyping:!0,minLength:2};const r={forwardGeocode:async o=>{const l=[];try{const s=En.geocoder.peliasUrl1+encodeURIComponent(o.query)+En.geocoder.peliasUrl2,b=await(await fetch(s)).json();for(const S of b.features){const F=S.geometry.coordinates,D={type:"Feature",geometry:{type:"Point",coordinates:F},place_name:S.properties.label,properties:S.properties,text:S.properties.label,place_type:["place"],center:F};l.push(D)}}catch(s){console.error(`Failed to forwardGeocode with error: ${s}`)}return{features:l}}};this.map.addControl(new Lne(r,t),e);let n=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");n[0].attributes[2].nodeValue="Cerca...",n[0].addEventListener("input",function(o){o.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(r){console.error(`Error getting addImage: ${r.message}`)}}getConfigStyles(){try{let e=[];for(const t of Dg)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in jo.WMS)jo.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in jo.Orto)jo.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in jo.Vector)jo.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in jo.VectorAdmin)jo.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in jo.FGBAdmin)jo.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,r){try{const o=await(await fetch(e)).json();let l=o.features[0].geometry.type;l.includes("ine")&&(r!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r},this._firstSymbolLayer()):map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},this._firstSymbolLayer())),l.includes("olygon")&&(r!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r},this._firstSymbolLayer()):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},this._firstSymbolLayer())),l.includes("oint")&&(r!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r},this._firstSymbolLayer()):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},this._firstSymbolLayer()))}catch(n){console.error(`Error fetching data: ${n.message}`)}}async fetchDataAndMenu(e,t,r,n){try{const l=await(await fetch(e)).json(),s=document.getElementById("menu-group");if(r!=="all"){const b=document.createElement("div");b.id="titleDivMenu",b.textContent=t,s.appendChild(b);const S=document.createElement("div");S.id="titleDivMenuSub",S.textContent=` ${r}`,s.appendChild(S)}let g=l.features[0].geometry.type;if(r==="all")g.includes("ine")&&(n!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},this._firstSymbolLayer()):map.addLayer({id:t,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},this._firstSymbolLayer())),g.includes("olygon")&&(n!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},this._firstSymbolLayer()):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},this._firstSymbolLayer())),g.includes("oint")&&(n!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n},this._firstSymbolLayer()):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},this._firstSymbolLayer())),map.addMenuItem(t);else{let b=r;const S={};l.features.forEach(F=>{const D=F.properties[b];D!==null&&(S[D]||(g.includes("ine")&&(n!==void 0?map.addLayer({id:D,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:n},this._firstSymbolLayer()):map.addLayer({id:D,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:{"line-color":"black","line-width":2,"line-opacity":1}},this._firstSymbolLayer())),g.includes("olygon")&&(n!==void 0?map.addLayer({id:D,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:n},this._firstSymbolLayer()):map.addLayer({id:D,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:{"fill-color":"blue","fill-opacity":.6}},this._firstSymbolLayer())),g.includes("oint")&&(n!==void 0?map.addLayer({id:D,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:n},this._firstSymbolLayer()):map.addLayer({id:D,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,D],paint:{"circle-color":"red","circle-opacity":.85}},this._firstSymbolLayer())),S[D]=!0,map.addMenuItem(D)))})}}catch(o){console.error(`Error fetching data: ${o.message}`)}}on(e,t){try{this.map.on(e,t)}catch(r){console.error(`Error adding event listener: ${r.message}`)}}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,r){try{return this.map.setFilter(e,t,r)}catch(n){console.error(`Error setting filter: ${n.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,r){try{this.map.setLayoutProperty(e,t,r)}catch(n){console.error(`Error setting layout property: ${n.message}`)}}setPaintProperty(e,t,r){try{this.map.setPaintProperty(e,t,r)}catch(n){console.error(`Error setting paint property: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Dne(e),t)}catch(r){console.error(`Error adding mouse coordinate control: ${r.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new rc.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new rc.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,r){try{return this.map.setLayerZoomRange(e,t,r)}catch(n){console.error(`Error setting terrain: ${n.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addLayerGeoJSON(e){try{this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}-sourceIcgcMap`,layout:e.layout,paint:e.paint},this._firstSymbolLayer())}catch(t){console.error(`Error adding GeoJSON layer: ${t.message}`)}}addLayerWMS(e){try{console.log("holaaddlayerwms",e),this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"raster",tiles:[e.tiles],tileSize:256},this._firstSymbolLayer()),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:"raster",source:`${e.id}-sourceIcgcMap`,paint:{}},this._firstSymbolLayer())}catch(t){console.error(`Error adding WMS layer: ${t.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e){try{const t=document.createElement("img");t.src=e.url,t.style.height="62px";const r=document.getElementById("logos"),n=document.createElement("a");n.id=e.id,n.href=e.href,n.target="_blank",n.style.position="relative",n.style.bottom="1px",n.appendChild(t),r.appendChild(n)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=n=>{this.map.setStyle(n)},r=document.getElementById("basemap-group");for(const n of e)for(const o of Object.keys(En.baseStyles)){const l=En.baseStyles[o];if(n===l.url){const s=document.createElement("div");s.className="basemap-item",s.title=l.key,s.style.backgroundImage=`url('${l.image}')`,r.appendChild(s),s.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=n=>{console.log("base",n),this.map.setStyle(n.url)},r=document.getElementById("basemap-group");e.forEach(n=>{const o=document.createElement("div");o.className="basemap-item",o.title=n.label,o.style.backgroundImage=`url('${n.image}')`,r.appendChild(o),o.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t){try{let r;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let o=this.map.queryRenderedFeatures(n.point);if(o&&o[0].source===e){let l=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0){if(t!==null){let s="";t.forEach(g=>{let b=o[0].properties[g];s=s+`<h4>${b}</h4>`}),r=s,map.addPopup(l,r)}}else{let s="";for(const g in o[0].properties)s+="<b>"+g+"</b>:"+o[0].properties[g]+"<br>";r=s,map.addPopup(l,r)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(e,t){try{var r=new rc.ScaleControl(e);this.map.addControl(r,t)}catch(n){console.error(`Error adding scale: ${n.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:Mg.A4,PageOrientation:Gy.Landscape,Format:bd.PNG,DPI:RC[300],Crosshair:!0,PrintableArea:!0},t="top-right"),map.addControl(new zre(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addPopup(e,t){try{new rc.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,r;return e.text===void 0?t=new rc.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new rc.Popup({offset:e.textOffset}).setText(e.text),t=new rc.Marker().setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t){try{return new rc.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new rc.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{if(e.length>0){const t=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=e,r.checked=!0,t.appendChild(r);const n=document.createElement("label");n.setAttribute("for",e),n.textContent=e,t.appendChild(n),r.addEventListener("change",o=>{this.map.setLayoutProperty(e,"visibility",o.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const r=document.getElementById("filter-group");this.map.addSource(`${e.id}-source`,{type:e.type,data:t}),t.features.forEach(n=>{const o=n.properties.icon,l=`poi-${o}`;if(!this.map.getLayer(l)){this.map.addLayer({id:l,type:"circle",source:`${e.id}-source`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const s=document.createElement("input");s.type="checkbox",s.id=l,s.checked=!0,r.appendChild(s);const g=document.createElement("label");g.setAttribute("for",l),g.textContent=o,r.appendChild(g),s.addEventListener("change",b=>{this.map.setLayoutProperty(l,"visibility",b.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new rc.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new rc.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e){try{this.map.addControl(new rc.AttributionControl(e.options),e.position)}catch(t){console.error(`Error adding attribution control: ${t.message}`)}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Dg)if(Dg.hasOwnProperty(t)){const r=Dg[t];if(t===e)return r}return Dg[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}addImageLayerICGC(e){try{let r=function(o,l,s,g,b){console.log("hola",e);const S=[l,s,g,b];for(const F of S)for(const[D,N]of Object.entries(F))if(N===o)return D;return null};console.log("name",e);let t=null;t=r(e,jo.Orto,jo.VectorAdmin,jo.WMS,jo.Vector),console.log("op",t),t||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let n={id:t,tiles:e};console.log("source",n),this.addLayerWMS(n)}catch(t){console.error(`Error adding ICGC image layer: ${t.message}`)}}async addVectorLayerICGC(e,t){try{console.log("layerUrl",e);let r=e;if(r===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",r,"font-weight: bold; font-style: italic;");else if(e.includes("https")){let n=function(g){for(const b in jo.Vector)if(jo.Vector.hasOwnProperty(b)&&jo.Vector[b]===g)return b;return null},l=function(g){for(const b in En.vectorLayers){const S=En.vectorLayers[b];if(S.key===g)return S.legend}return null},o=n(e);this.map.addSource(o,{type:"vector",url:e}),o==="cobertes2018"&&map.addLayer({id:o,type:"fill",source:o,"source-layer":"cobertes",maxzoom:18,paint:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},this._firstSymbolLayer());let s=l(o);map.addLegend(o,s)}else{let n="limitsSource";this.map.addSource(n,{type:"vector",url:En.limitsUrl}),this.map.addLayer({id:r+"-fill",type:"fill",source:n,"source-layer":r,paint:{"fill-color":"#0000FF","fill-opacity":0}},this._firstSymbolLayer()),this.map.addLayer({id:r+"-underline",type:"line",source:n,"source-layer":r,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},this._firstSymbolLayer()),t?this.map.addLayer({id:r+"-line",type:"line",source:n,"source-layer":r,paint:t},this._firstSymbolLayer()):this.map.addLayer({id:r+"-line",type:"line",source:n,"source-layer":r,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},this._firstSymbolLayer())}}catch(r){console.error(`Error adding ICGC vector layer: ${r.message}`)}}async addFGBLayerICGC(e,t,r){try{let o=function(l){for(const s in jo.FGBAdmin)if(jo.FGBAdmin.hasOwnProperty(s)&&jo.FGBAdmin[s]===l)return s;return null}(e);if(o===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",o,"font-weight: bold; font-style: italic;");else{const l=await fetch(e),s={type:"FeatureCollection",features:[]};for await(const b of j8(l.body))s.features.push(b);let g=o+"-source";if(this.map.addSource(g,{type:"geojson",data:s}),e.includes("text"))this.map.addLayer({id:o,type:"symbol",source:g,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:t,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},this._firstSymbolLayer());else{this.map.addLayer({id:o+"-fill",type:"fill",source:g,paint:{"fill-color":"#0000FF","fill-opacity":0}},this._firstSymbolLayer()),this.map.addLayer({id:o+"-underline",type:"line",source:g,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},this._firstSymbolLayer()),r?this.map.addLayer({id:o+"-line",type:"line",source:g,paint:r},this._firstSymbolLayer()):this.map.addLayer({id:o+"-line",type:"line",source:g,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},this._firstSymbolLayer());let b=o+"Text";this.map.addLayer({id:b,type:"symbol",source:g,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:t,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},this._firstSymbolLayer())}}}catch(n){console.error(`Error adding ICGC vector layer: ${n.message}`)}}addTerrainICGC(e,t){try{let r;for(const o in hv)if(hv.hasOwnProperty(o)){const l=hv[o];l===e&&(r=l)}let n=r;e.includes("terrarium")?this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,maxzoom:16}),this.map.setTerrain({source:"terrainICGC-src",exaggeration:1.5}),t===void 0&&(t="top-right"),this.map.addControl(new q8({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}addLegend(e,t){try{console.log("namelegend",e,t);const r=document.createElement("div");r.id="legendContainer",r.innerHTML=`<img src=${t} alt="Legend" >`,r.style.display="block",document.body.appendChild(r),$(function(){$("#legendContainer").draggable(),$("#legendContainer").resizable()});const n=document.createElement("div");n.id="toggleLegend",n.innerHTML="<span>&#x2630;</span>",document.body.appendChild(n),n.addEventListener("click",function(){r.style.display==="none"?r.style.display="block":r.style.display="none"})}catch(r){console.error(`Error adding legend: ${r.message}`)}}async _raiseText3DStyle(){try{const e=await this.map.loadImage(En.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===En.map3dOptions.sourceLayerFilterId&&t.minzoom>=En.map3dOptions.minZoomFilter&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-9]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","bottom"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setPaintProperty(r,"text-color","#ffffff"),this.map.setPaintProperty(r,"text-halo-color","#000000"),this.map.setPaintProperty(r,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new NL({intensity:4}),r=new H2({ambientLight:t});this.map.setTerrain({source:En.map3dOptions.terrainSource,exaggeration:En.map3dOptions.exaggeration});const n=this._createCitiesMapboxLayer();this.map.getLayer(En.map3dOptions.layerId3d)||(this.map.addLayer(n,En.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(En.map3dOptions.layerId3d,En.map3dOptions.minZoomRange,En.map3dOptions.maxZoomRange),n.deck.setProps({effects:[r]}),this._raiseText3DStyle())}else this.map.getLayer(En.map3dOptions.layerId3d)&&(this.map.removeLayer(En.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="symbol"){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new wX({id:En.map3dOptions.layerId3d,type:dC,data:En.map3dOptions.urlTilesetCities,loader:AC,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:En.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=En.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=En.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var _D={exports:{}};function kne(i,e){var t=i.getCenter(),r=i.getZoom(),n=i.getBearing(),o=i.getPitch();e.forEach(function(l){l.jumpTo({center:t,zoom:r,bearing:n,pitch:o})})}function One(){var i,e=arguments.length;if(e===1)i=arguments[0];else{i=[];for(var t=0;t<e;t++)i.push(arguments[t])}var r=[];i.forEach(function(s,g){r[g]=l.bind(null,s,i.filter(function(b,S){return S!==g}))});function n(){i.forEach(function(s,g){s.on("move",r[g])})}function o(){i.forEach(function(s,g){s.off("move",r[g])})}function l(s,g){o(),kne(s,g),n()}return n(),function(){o(),r=[],i=[]}}var Une=One;(function(i){var e=Une,t=dD.EventEmitter;function r(n,o,l,s){if(this.options=s||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof l=="string"&&document.body.querySelectorAll){var g=document.body.querySelectorAll(l)[0];if(!g)throw new Error("Cannot find element with specified container selector.");g.appendChild(this._controlContainer)}else if(l instanceof Element&&l.appendChild)l.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var b=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(b),this._clearSync=e(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var l=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",s=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=l,this._mapB.getContainer().style.clip=s,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(_D);var Nne=_D.exports;const zne=Um(Nne);class Qne{constructor(e,t,r,n){this.mapCompare=new zne(e.map,t.map,r,{})}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var zC=function(i,e){return zC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},zC(i,e)};function Ah(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zC(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var QC=function(){return QC=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},QC.apply(this,arguments)};function lc(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(S){try{b(r.next(S))}catch(F){l(F)}}function g(S){try{b(r.throw(S))}catch(F){l(F)}}function b(S){S.done?o(S.value):n(S.value).then(s,g)}b((r=r.apply(i,e||[])).next())})}function kl(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(b){return function(S){return g([b,S])}}function g(b){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=b[0]&2?n.return:b[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,b[1])).done)return o;switch(n=0,o&&(b=[b[0]&2,o.value]),b[0]){case 0:case 1:o=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,n=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!o||b[1]>o[0]&&b[1]<o[3])){t.label=b[1];break}if(b[0]===6&&t.label<o[1]){t.label=o[1],o=b;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(b);break}o[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(i,t)}catch(S){b=[6,S],n=0}finally{r=o=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Av(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,o;r<n;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||e)}for(var FA=function(){function i(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return i.prototype.add=function(e,t,r,n){return new i(this.left+e,this.top+t,this.width+r,this.height+n)},i.fromClientRect=function(e,t){return new i(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},i.fromDOMRectList=function(e,t){var r=Array.from(t).find(function(n){return n.width!==0});return r?new i(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):i.EMPTY},i.EMPTY=new i(0,0,0,0),i}(),dv=function(i,e){return FA.fromClientRect(i,e.getBoundingClientRect())},Vne=function(i){var e=i.body,t=i.documentElement;if(!e||!t)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new FA(0,0,r,n)},fv=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},qo=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},vD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hne=typeof Uint8Array>"u"?[]:new Uint8Array(256),pv=0;pv<vD.length;pv++)Hne[vD.charCodeAt(pv)]=pv;for(var bD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jy=typeof Uint8Array>"u"?[]:new Uint8Array(256),gv=0;gv<bD.length;gv++)jy[bD.charCodeAt(gv)]=gv;for(var Gne=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),S=Array.isArray(b)?b:new Uint8Array(b);for(r=0;r<t;r+=4)o=jy[i.charCodeAt(r)],l=jy[i.charCodeAt(r+1)],s=jy[i.charCodeAt(r+2)],g=jy[i.charCodeAt(r+3)],S[n++]=o<<2|l>>4,S[n++]=(l&15)<<4|s>>2,S[n++]=(s&3)<<6|g&63;return b},jne=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},qne=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Ff=5,VC=11,HC=2,$ne=VC-Ff,xD=65536>>Ff,Kne=1<<Ff,GC=Kne-1,Wne=1024>>Ff,Xne=xD+Wne,Zne=Xne,Jne=32,Yne=Zne+Jne,ese=65536>>VC,tse=1<<$ne,ise=tse-1,wD=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},rse=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},nse=function(i,e){var t=Gne(i),r=Array.isArray(t)?qne(t):new Uint32Array(t),n=Array.isArray(t)?jne(t):new Uint16Array(t),o=24,l=wD(n,o/2,r[4]/2),s=r[5]===2?wD(n,(o+r[4])/2):rse(r,Math.ceil((o+r[4])/4));return new sse(r[0],r[1],r[2],r[3],l,s)},sse=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Ff],t=(t<<HC)+(e&GC),this.data[t];if(e<=65535)return t=this.index[xD+(e-55296>>Ff)],t=(t<<HC)+(e&GC),this.data[t];if(e<this.highStart)return t=Yne-ese+(e>>VC),t=this.index[t],t+=e>>Ff&ise,t=this.index[t],t=(t<<HC)+(e&GC),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),BD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ose=typeof Uint8Array>"u"?[]:new Uint8Array(256),mv=0;mv<BD.length;mv++)ose[BD.charCodeAt(mv)]=mv;var ase="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",CD=50,lse=1,ED=2,SD=3,cse=4,use=5,TD=7,ID=8,LD=9,xd=10,jC=11,MD=12,qC=13,hse=14,qy=15,$C=16,yv=17,$y=18,Ase=19,PD=20,KC=21,Ky=22,WC=23,Rg=24,ou=25,Wy=26,Xy=27,kg=28,dse=29,Og=30,fse=31,_v=32,vv=33,XC=34,ZC=35,JC=36,Zy=37,YC=38,bv=39,xv=40,eE=41,FD=42,pse=43,gse=[9001,65288],DD="!",cc="",wv="",tE=nse(ase),DA=[Og,JC],iE=[lse,ED,SD,use],RD=[xd,ID],kD=[Xy,Wy],mse=iE.concat(RD),OD=[YC,bv,xv,XC,ZC],yse=[qy,qC],_se=function(i,e){e===void 0&&(e="strict");var t=[],r=[],n=[];return i.forEach(function(o,l){var s=tE.get(o);if(s>CD?(n.push(!0),s-=CD):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(o)!==-1)return r.push(l),t.push($C);if(s===cse||s===jC){if(l===0)return r.push(l),t.push(Og);var g=t[l-1];return mse.indexOf(g)===-1?(r.push(r[l-1]),t.push(g)):(r.push(l),t.push(Og))}if(r.push(l),s===fse)return t.push(e==="strict"?KC:Zy);if(s===FD||s===dse)return t.push(Og);if(s===pse)return o>=131072&&o<=196605||o>=196608&&o<=262141?t.push(Zy):t.push(Og);t.push(s)}),[r,t,n]},rE=function(i,e,t,r){var n=r[t];if(Array.isArray(i)?i.indexOf(n)!==-1:i===n)for(var o=t;o<=r.length;){o++;var l=r[o];if(l===e)return!0;if(l!==xd)break}if(n===xd)for(var o=t;o>0;){o--;var s=r[o];if(Array.isArray(i)?i.indexOf(s)!==-1:i===s)for(var g=t;g<=r.length;){g++;var l=r[g];if(l===e)return!0;if(l!==xd)break}if(s!==xd)break}return!1},UD=function(i,e){for(var t=i;t>=0;){var r=e[t];if(r===xd)t--;else return r}return 0},vse=function(i,e,t,r,n){if(t[r]===0)return cc;var o=r-1;if(Array.isArray(n)&&n[o]===!0)return cc;var l=o-1,s=o+1,g=e[o],b=l>=0?e[l]:0,S=e[s];if(g===ED&&S===SD)return cc;if(iE.indexOf(g)!==-1)return DD;if(iE.indexOf(S)!==-1||RD.indexOf(S)!==-1)return cc;if(UD(o,e)===ID)return wv;if(tE.get(i[o])===jC||(g===_v||g===vv)&&tE.get(i[s])===jC||g===TD||S===TD||g===LD||[xd,qC,qy].indexOf(g)===-1&&S===LD||[yv,$y,Ase,Rg,kg].indexOf(S)!==-1||UD(o,e)===Ky||rE(WC,Ky,o,e)||rE([yv,$y],KC,o,e)||rE(MD,MD,o,e))return cc;if(g===xd)return wv;if(g===WC||S===WC)return cc;if(S===$C||g===$C)return wv;if([qC,qy,KC].indexOf(S)!==-1||g===hse||b===JC&&yse.indexOf(g)!==-1||g===kg&&S===JC||S===PD||DA.indexOf(S)!==-1&&g===ou||DA.indexOf(g)!==-1&&S===ou||g===Xy&&[Zy,_v,vv].indexOf(S)!==-1||[Zy,_v,vv].indexOf(g)!==-1&&S===Wy||DA.indexOf(g)!==-1&&kD.indexOf(S)!==-1||kD.indexOf(g)!==-1&&DA.indexOf(S)!==-1||[Xy,Wy].indexOf(g)!==-1&&(S===ou||[Ky,qy].indexOf(S)!==-1&&e[s+1]===ou)||[Ky,qy].indexOf(g)!==-1&&S===ou||g===ou&&[ou,kg,Rg].indexOf(S)!==-1)return cc;if([ou,kg,Rg,yv,$y].indexOf(S)!==-1)for(var F=o;F>=0;){var D=e[F];if(D===ou)return cc;if([kg,Rg].indexOf(D)!==-1)F--;else break}if([Xy,Wy].indexOf(S)!==-1)for(var F=[yv,$y].indexOf(g)!==-1?l:o;F>=0;){var D=e[F];if(D===ou)return cc;if([kg,Rg].indexOf(D)!==-1)F--;else break}if(YC===g&&[YC,bv,XC,ZC].indexOf(S)!==-1||[bv,XC].indexOf(g)!==-1&&[bv,xv].indexOf(S)!==-1||[xv,ZC].indexOf(g)!==-1&&S===xv||OD.indexOf(g)!==-1&&[PD,Wy].indexOf(S)!==-1||OD.indexOf(S)!==-1&&g===Xy||DA.indexOf(g)!==-1&&DA.indexOf(S)!==-1||g===Rg&&DA.indexOf(S)!==-1||DA.concat(ou).indexOf(g)!==-1&&S===Ky&&gse.indexOf(i[s])===-1||DA.concat(ou).indexOf(S)!==-1&&g===$y)return cc;if(g===eE&&S===eE){for(var N=t[o],J=1;N>0&&(N--,e[N]===eE);)J++;if(J%2!==0)return cc}return g===_v&&S===vv?cc:wv},bse=function(i,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=_se(i,e.lineBreak),r=t[0],n=t[1],o=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(s){return[ou,Og,FD].indexOf(s)!==-1?Zy:s}));var l=e.wordBreak==="keep-all"?o.map(function(s,g){return s&&i[g]>=19968&&i[g]<=40959}):void 0;return[r,n,l]},xse=function(){function i(e,t,r,n){this.codePoints=e,this.required=t===DD,this.start=r,this.end=n}return i.prototype.slice=function(){return qo.apply(void 0,this.codePoints.slice(this.start,this.end))},i}(),wse=function(i,e){var t=fv(i),r=bse(t,e),n=r[0],o=r[1],l=r[2],s=t.length,g=0,b=0;return{next:function(){if(b>=s)return{done:!0,value:null};for(var S=cc;b<s&&(S=vse(t,o,n,++b,l))===cc;);if(S!==cc||b===s){var F=new xse(t,S,g,b);return g=b,{value:F,done:!1}}return{done:!0,value:null}}}},Bse=1,Cse=2,Jy=4,ND=8,Bv=10,zD=47,Yy=92,Ese=9,Sse=32,Cv=34,e0=61,Tse=35,Ise=36,Lse=37,Ev=39,Sv=40,t0=41,Mse=95,Pc=45,Pse=33,Fse=60,Dse=62,Rse=64,kse=91,Ose=93,Use=61,Nse=123,Tv=63,zse=125,QD=124,Qse=126,Vse=128,VD=65533,nE=42,Df=43,Hse=44,Gse=58,jse=59,i0=46,qse=0,$se=8,Kse=11,Wse=14,Xse=31,Zse=127,Zh=-1,HD=48,GD=97,jD=101,Jse=102,Yse=117,eoe=122,qD=65,$D=69,KD=70,toe=85,ioe=90,uc=function(i){return i>=HD&&i<=57},roe=function(i){return i>=55296&&i<=57343},Ug=function(i){return uc(i)||i>=qD&&i<=KD||i>=GD&&i<=Jse},noe=function(i){return i>=GD&&i<=eoe},soe=function(i){return i>=qD&&i<=ioe},ooe=function(i){return noe(i)||soe(i)},aoe=function(i){return i>=Vse},Iv=function(i){return i===Bv||i===Ese||i===Sse},Lv=function(i){return ooe(i)||aoe(i)||i===Mse},WD=function(i){return Lv(i)||uc(i)||i===Pc},loe=function(i){return i>=qse&&i<=$se||i===Kse||i>=Wse&&i<=Xse||i===Zse},wd=function(i,e){return i!==Yy?!1:e!==Bv},Mv=function(i,e,t){return i===Pc?Lv(e)||wd(e,t):Lv(i)?!0:!!(i===Yy&&wd(i,e))},sE=function(i,e,t){return i===Df||i===Pc?uc(e)?!0:e===i0&&uc(t):uc(i===i0?e:i)},coe=function(i){var e=0,t=1;(i[e]===Df||i[e]===Pc)&&(i[e]===Pc&&(t=-1),e++);for(var r=[];uc(i[e]);)r.push(i[e++]);var n=r.length?parseInt(qo.apply(void 0,r),10):0;i[e]===i0&&e++;for(var o=[];uc(i[e]);)o.push(i[e++]);var l=o.length,s=l?parseInt(qo.apply(void 0,o),10):0;(i[e]===$D||i[e]===jD)&&e++;var g=1;(i[e]===Df||i[e]===Pc)&&(i[e]===Pc&&(g=-1),e++);for(var b=[];uc(i[e]);)b.push(i[e++]);var S=b.length?parseInt(qo.apply(void 0,b),10):0;return t*(n+s*Math.pow(10,-l))*Math.pow(10,g*S)},uoe={type:2},hoe={type:3},Aoe={type:4},doe={type:13},foe={type:8},poe={type:21},goe={type:9},moe={type:10},yoe={type:11},_oe={type:12},voe={type:14},Pv={type:23},boe={type:1},xoe={type:25},woe={type:24},Boe={type:26},Coe={type:27},Eoe={type:28},Soe={type:29},Toe={type:31},oE={type:32},XD=function(){function i(){this._value=[]}return i.prototype.write=function(e){this._value=this._value.concat(fv(e))},i.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==oE;)e.push(t),t=this.consumeToken();return e},i.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Cv:return this.consumeStringToken(Cv);case Tse:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(WD(t)||wd(r,n)){var o=Mv(t,r,n)?Cse:Bse,l=this.consumeName();return{type:5,value:l,flags:o}}break;case Ise:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),doe;break;case Ev:return this.consumeStringToken(Ev);case Sv:return uoe;case t0:return hoe;case nE:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),voe;break;case Df:if(sE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Hse:return Aoe;case Pc:var s=e,g=this.peekCodePoint(0),b=this.peekCodePoint(1);if(sE(s,g,b))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(Mv(s,g,b))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(g===Pc&&b===Dse)return this.consumeCodePoint(),this.consumeCodePoint(),woe;break;case i0:if(sE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case zD:if(this.peekCodePoint(0)===nE)for(this.consumeCodePoint();;){var S=this.consumeCodePoint();if(S===nE&&(S=this.consumeCodePoint(),S===zD))return this.consumeToken();if(S===Zh)return this.consumeToken()}break;case Gse:return Boe;case jse:return Coe;case Fse:if(this.peekCodePoint(0)===Pse&&this.peekCodePoint(1)===Pc&&this.peekCodePoint(2)===Pc)return this.consumeCodePoint(),this.consumeCodePoint(),xoe;break;case Rse:var F=this.peekCodePoint(0),D=this.peekCodePoint(1),N=this.peekCodePoint(2);if(Mv(F,D,N)){var l=this.consumeName();return{type:7,value:l}}break;case kse:return Eoe;case Yy:if(wd(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Ose:return Soe;case Use:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),foe;break;case Nse:return yoe;case zse:return _oe;case Yse:case toe:var J=this.peekCodePoint(0),te=this.peekCodePoint(1);return J===Df&&(Ug(te)||te===Tv)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case QD:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),goe;if(this.peekCodePoint(0)===QD)return this.consumeCodePoint(),poe;break;case Qse:if(this.peekCodePoint(0)===e0)return this.consumeCodePoint(),moe;break;case Zh:return oE}return Iv(e)?(this.consumeWhiteSpace(),Toe):uc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Lv(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:qo(e)}},i.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},i.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},i.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},i.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Ug(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===Tv&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(qo.apply(void 0,e.map(function(g){return g===Tv?HD:g})),16),o=parseInt(qo.apply(void 0,e.map(function(g){return g===Tv?KD:g})),16);return{type:30,start:n,end:o}}var l=parseInt(qo.apply(void 0,e),16);if(this.peekCodePoint(0)===Pc&&Ug(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];Ug(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();var o=parseInt(qo.apply(void 0,s),16);return{type:30,start:l,end:o}}else return{type:30,start:l,end:l}},i.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===Sv?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Sv?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},i.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===Ev||t===Cv){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh||this.peekCodePoint(0)===t0)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),Pv)}for(;;){var n=this.consumeCodePoint();if(n===Zh||n===t0)return{type:22,value:qo.apply(void 0,e)};if(Iv(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Zh||this.peekCodePoint(0)===t0?(this.consumeCodePoint(),{type:22,value:qo.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Pv);if(n===Cv||n===Ev||n===Sv||loe(n))return this.consumeBadUrlRemnants(),Pv;if(n===Yy)if(wd(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Pv;else e.push(n)}},i.prototype.consumeWhiteSpace=function(){for(;Iv(this.peekCodePoint(0));)this.consumeCodePoint()},i.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===t0||e===Zh)return;wd(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},i.prototype.consumeStringSlice=function(e){for(var t=5e4,r="";e>0;){var n=Math.min(t,e);r+=qo.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},i.prototype.consumeStringToken=function(e){var t="",r=0;do{var n=this._value[r];if(n===Zh||n===void 0||n===e)return t+=this.consumeStringSlice(r),{type:0,value:t};if(n===Bv)return this._value.splice(0,r),boe;if(n===Yy){var o=this._value[r+1];o!==Zh&&o!==void 0&&(o===Bv?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):wd(n,o)&&(t+=this.consumeStringSlice(r),t+=qo(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},i.prototype.consumeNumber=function(){var e=[],t=Jy,r=this.peekCodePoint(0);for((r===Df||r===Pc)&&e.push(this.consumeCodePoint());uc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===i0&&uc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ND;uc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((r===$D||r===jD)&&((n===Df||n===Pc)&&uc(o)||uc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ND;uc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[coe(e),t]},i.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),l=this.peekCodePoint(2);if(Mv(n,o,l)){var s=this.consumeName();return{type:15,number:t,flags:r,unit:s}}return n===Lse?(this.consumeCodePoint(),{type:16,number:t,flags:r}):{type:17,number:t,flags:r}},i.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Ug(e)){for(var t=qo(e);Ug(this.peekCodePoint(0))&&t.length<6;)t+=qo(this.consumeCodePoint());Iv(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return r===0||roe(r)||r>1114111?VD:r}return e===Zh?VD:e},i.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(WD(t))e+=qo(t);else if(wd(t,this.peekCodePoint(0)))e+=qo(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},i}(),ZD=function(){function i(e){this._tokens=e}return i.create=function(e){var t=new XD;return t.write(e),new i(t.read())},i.parseValue=function(e){return i.create(e).parseComponentValue()},i.parseValues=function(e){return i.create(e).parseComponentValues()},i.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},i.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},i.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},i.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||Loe(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},i.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},i.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?oE:e},i.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},i}(),r0=function(i){return i.type===15},Ng=function(i){return i.type===17},Bs=function(i){return i.type===20},Ioe=function(i){return i.type===0},aE=function(i,e){return Bs(i)&&i.value===e},JD=function(i){return i.type!==31},zg=function(i){return i.type!==31&&i.type!==4},Jh=function(i){var e=[],t=[];return i.forEach(function(r){if(r.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}r.type!==31&&t.push(r)}),t.length&&e.push(t),e},Loe=function(i,e){return e===11&&i.type===12||e===28&&i.type===29?!0:e===2&&i.type===3},Bd=function(i){return i.type===17||i.type===15},la=function(i){return i.type===16||Bd(i)},YD=function(i){return i.length>1?[i[0],i[1]]:[i[0]]},al={type:17,number:0,flags:Jy},lE={type:16,number:50,flags:Jy},Cd={type:16,number:100,flags:Jy},n0=function(i,e,t){var r=i[0],n=i[1];return[Hs(r,e),Hs(typeof n<"u"?n:r,t)]},Hs=function(i,e){if(i.type===16)return i.number/100*e;if(r0(i))switch(i.unit){case"rem":case"em":return 16*i.number;case"px":default:return i.number}return i.number},eR="deg",tR="grad",iR="rad",rR="turn",Fv={name:"angle",parse:function(i,e){if(e.type===15)switch(e.unit){case eR:return Math.PI*e.number/180;case tR:return Math.PI/200*e.number;case iR:return e.number;case rR:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},nR=function(i){return i.type===15&&(i.unit===eR||i.unit===tR||i.unit===iR||i.unit===rR)},sR=function(i){var e=i.filter(Bs).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[al,al];case"to top":case"bottom":return Mu(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[al,Cd];case"to right":case"left":return Mu(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Cd,Cd];case"to bottom":case"top":return Mu(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Cd,al];case"to left":case"right":return Mu(270)}return 0},Mu=function(i){return Math.PI*i/180},Ed={name:"color",parse:function(i,e){if(e.type===18){var t=Moe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(i,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return Td(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3),l=e.value.substring(3,4);return Td(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(l+l,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6);return Td(parseInt(r,16),parseInt(n,16),parseInt(o,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),l=e.value.substring(6,8);return Td(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(l,16)/255)}}if(e.type===20){var s=RA[e.value.toUpperCase()];if(typeof s<"u")return s}return RA.TRANSPARENT}},Sd=function(i){return(255&i)===0},qa=function(i){var e=255&i,t=255&i>>8,r=255&i>>16,n=255&i>>24;return e<255?"rgba("+n+","+r+","+t+","+e/255+")":"rgb("+n+","+r+","+t+")"},Td=function(i,e,t,r){return(i<<24|e<<16|t<<8|Math.round(r*255)<<0)>>>0},oR=function(i,e){if(i.type===17)return i.number;if(i.type===16){var t=e===3?1:255;return e===3?i.number/100*t:Math.round(i.number/100*t)}return 0},aR=function(i,e){var t=e.filter(zg);if(t.length===3){var r=t.map(oR),n=r[0],o=r[1],l=r[2];return Td(n,o,l,1)}if(t.length===4){var s=t.map(oR),n=s[0],o=s[1],l=s[2],g=s[3];return Td(n,o,l,g)}return 0};function cE(i,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-i)*t*6+i:t<1/2?e:t<2/3?(e-i)*6*(2/3-t)+i:i}var lR=function(i,e){var t=e.filter(zg),r=t[0],n=t[1],o=t[2],l=t[3],s=(r.type===17?Mu(r.number):Fv.parse(i,r))/(Math.PI*2),g=la(n)?n.number/100:0,b=la(o)?o.number/100:0,S=typeof l<"u"&&la(l)?Hs(l,1):1;if(g===0)return Td(b*255,b*255,b*255,1);var F=b<=.5?b*(g+1):b+g-b*g,D=b*2-F,N=cE(D,F,s+1/3),J=cE(D,F,s),te=cE(D,F,s-1/3);return Td(N*255,J*255,te*255,S)},Moe={hsl:lR,hsla:lR,rgb:aR,rgba:aR},s0=function(i,e){return Ed.parse(i,ZD.create(e).parseComponentValue())},RA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Poe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(Bs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Foe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Dv=function(i,e){var t=Ed.parse(i,e[0]),r=e[1];return r&&la(r)?{color:t,stop:r}:{color:t,stop:null}},cR=function(i,e){var t=i[0],r=i[i.length-1];t.stop===null&&(t.stop=al),r.stop===null&&(r.stop=Cd);for(var n=[],o=0,l=0;l<i.length;l++){var s=i[l].stop;if(s!==null){var g=Hs(s,e);g>o?n.push(g):n.push(o),o=g}else n.push(null)}for(var b=null,l=0;l<n.length;l++){var S=n[l];if(S===null)b===null&&(b=l);else if(b!==null){for(var F=l-b,D=n[b-1],N=(S-D)/(F+1),J=1;J<=F;J++)n[b+J-1]=N*J;b=null}}return i.map(function(te,he){var ue=te.color;return{color:ue,stop:Math.max(Math.min(1,n[he]/e),0)}})},Doe=function(i,e,t){var r=e/2,n=t/2,o=Hs(i[0],e)-r,l=n-Hs(i[1],t);return(Math.atan2(l,o)+Math.PI*2)%(Math.PI*2)},Roe=function(i,e,t){var r=typeof i=="number"?i:Doe(i,e,t),n=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),o=e/2,l=t/2,s=n/2,g=Math.sin(r-Math.PI/2)*s,b=Math.cos(r-Math.PI/2)*s;return[n,o-b,o+b,l-g,l+g]},dh=function(i,e){return Math.sqrt(i*i+e*e)},uR=function(i,e,t,r,n){var o=[[0,0],[0,e],[i,0],[i,e]];return o.reduce(function(l,s){var g=s[0],b=s[1],S=dh(t-g,r-b);return(n?S<l.optimumDistance:S>l.optimumDistance)?{optimumCorner:s,optimumDistance:S}:l},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},koe=function(i,e,t,r,n){var o=0,l=0;switch(i.size){case 0:i.shape===0?o=l=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.min(Math.abs(e),Math.abs(e-r)),l=Math.min(Math.abs(t),Math.abs(t-n)));break;case 2:if(i.shape===0)o=l=Math.min(dh(e,t),dh(e,t-n),dh(e-r,t),dh(e-r,t-n));else if(i.shape===1){var s=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-r)),g=uR(r,n,e,t,!0),b=g[0],S=g[1];o=dh(b-e,(S-t)/s),l=s*o}break;case 1:i.shape===0?o=l=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.max(Math.abs(e),Math.abs(e-r)),l=Math.max(Math.abs(t),Math.abs(t-n)));break;case 3:if(i.shape===0)o=l=Math.max(dh(e,t),dh(e,t-n),dh(e-r,t),dh(e-r,t-n));else if(i.shape===1){var s=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-r)),F=uR(r,n,e,t,!1),b=F[0],S=F[1];o=dh(b-e,(S-t)/s),l=s*o}break}return Array.isArray(i.size)&&(o=Hs(i.size[0],r),l=i.size.length===2?Hs(i.size[1],n):o),[o,l]},Ooe=function(i,e){var t=Mu(180),r=[];return Jh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&l.value==="to"){t=sR(n);return}else if(nR(l)){t=Fv.parse(i,l);return}}var s=Dv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Rv=function(i,e){var t=Mu(180),r=[];return Jh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&["top","left","right","bottom"].indexOf(l.value)!==-1){t=sR(n);return}else if(nR(l)){t=(Fv.parse(i,l)+Mu(270))%Mu(360);return}}var s=Dv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Uoe=function(i,e){var t=Mu(180),r=[],n=1,o=0,l=3,s=[];return Jh(e).forEach(function(g,b){var S=g[0];if(b===0){if(Bs(S)&&S.value==="linear"){n=1;return}else if(Bs(S)&&S.value==="radial"){n=2;return}}if(S.type===18){if(S.name==="from"){var F=Ed.parse(i,S.values[0]);r.push({stop:al,color:F})}else if(S.name==="to"){var F=Ed.parse(i,S.values[0]);r.push({stop:Cd,color:F})}else if(S.name==="color-stop"){var D=S.values.filter(zg);if(D.length===2){var F=Ed.parse(i,D[1]),N=D[0];Ng(N)&&r.push({stop:{type:16,number:N.number*100,flags:N.flags},color:F})}}}}),n===1?{angle:(t+Mu(180))%Mu(360),stops:r,type:n}:{size:l,shape:o,stops:r,position:s,type:n}},hR="closest-side",AR="farthest-side",dR="closest-corner",fR="farthest-corner",pR="circle",gR="ellipse",mR="cover",yR="contain",Noe=function(i,e){var t=0,r=3,n=[],o=[];return Jh(e).forEach(function(l,s){var g=!0;if(s===0){var b=!1;g=l.reduce(function(F,D){if(b)if(Bs(D))switch(D.value){case"center":return o.push(lE),F;case"top":case"left":return o.push(al),F;case"right":case"bottom":return o.push(Cd),F}else(la(D)||Bd(D))&&o.push(D);else if(Bs(D))switch(D.value){case pR:return t=0,!1;case gR:return t=1,!1;case"at":return b=!0,!1;case hR:return r=0,!1;case mR:case AR:return r=1,!1;case yR:case dR:return r=2,!1;case fR:return r=3,!1}else if(Bd(D)||la(D))return Array.isArray(r)||(r=[]),r.push(D),!1;return F},g)}if(g){var S=Dv(i,l);n.push(S)}}),{size:r,shape:t,stops:n,position:o,type:2}},kv=function(i,e){var t=0,r=3,n=[],o=[];return Jh(e).forEach(function(l,s){var g=!0;if(s===0?g=l.reduce(function(S,F){if(Bs(F))switch(F.value){case"center":return o.push(lE),!1;case"top":case"left":return o.push(al),!1;case"right":case"bottom":return o.push(Cd),!1}else if(la(F)||Bd(F))return o.push(F),!1;return S},g):s===1&&(g=l.reduce(function(S,F){if(Bs(F))switch(F.value){case pR:return t=0,!1;case gR:return t=1,!1;case yR:case hR:return r=0,!1;case AR:return r=1,!1;case dR:return r=2,!1;case mR:case fR:return r=3,!1}else if(Bd(F)||la(F))return Array.isArray(r)||(r=[]),r.push(F),!1;return S},g)),g){var b=Dv(i,l);n.push(b)}}),{size:r,shape:t,stops:n,position:o,type:2}},zoe=function(i){return i.type===1},Qoe=function(i){return i.type===2},uE={name:"image",parse:function(i,e){if(e.type===22){var t={url:e.value,type:0};return i.cache.addImage(e.value),t}if(e.type===18){var r=_R[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(i,e.values)}throw new Error("Unsupported image type "+e.type)}};function Voe(i){return!(i.type===20&&i.value==="none")&&(i.type!==18||!!_R[i.name])}var _R={"linear-gradient":Ooe,"-moz-linear-gradient":Rv,"-ms-linear-gradient":Rv,"-o-linear-gradient":Rv,"-webkit-linear-gradient":Rv,"radial-gradient":Noe,"-moz-radial-gradient":kv,"-ms-radial-gradient":kv,"-o-radial-gradient":kv,"-webkit-radial-gradient":kv,"-webkit-gradient":Uoe},Hoe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(r){return zg(r)&&Voe(r)}).map(function(r){return uE.parse(i,r)})}},Goe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(Bs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},joe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(i,e){return Jh(e).map(function(t){return t.filter(la)}).map(YD)}},qoe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(i,e){return Jh(e).map(function(t){return t.filter(Bs).map(function(r){return r.value}).join(" ")}).map($oe)}},$oe=function(i){switch(i){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Qg;(function(i){i.AUTO="auto",i.CONTAIN="contain",i.COVER="cover"})(Qg||(Qg={}));var Koe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(i,e){return Jh(e).map(function(t){return t.filter(Woe)})}},Woe=function(i){return Bs(i)||la(i)},Ov=function(i){return{name:"border-"+i+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Xoe=Ov("top"),Zoe=Ov("right"),Joe=Ov("bottom"),Yoe=Ov("left"),Uv=function(i){return{name:"border-radius-"+i,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return YD(t.filter(la))}}},eae=Uv("top-left"),tae=Uv("top-right"),iae=Uv("bottom-right"),rae=Uv("bottom-left"),Nv=function(i){return{name:"border-"+i+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nae=Nv("top"),sae=Nv("right"),oae=Nv("bottom"),aae=Nv("left"),zv=function(i){return{name:"border-"+i+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return r0(t)?t.number:0}}},lae=zv("top"),cae=zv("right"),uae=zv("bottom"),hae=zv("left"),Aae={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},dae={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(i,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},fae={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(i,e){return e.filter(Bs).reduce(function(t,r){return t|pae(r.value)},0)}},pae=function(i){switch(i){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},gae={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},mae={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(i,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},Qv;(function(i){i.NORMAL="normal",i.STRICT="strict"})(Qv||(Qv={}));var yae={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"strict":return Qv.STRICT;case"normal":default:return Qv.NORMAL}}},_ae={name:"line-height",initialValue:"normal",prefix:!1,type:4},vR=function(i,e){return Bs(i)&&i.value==="normal"?1.2*e:i.type===17?e*i.number:la(i)?Hs(i,e):e},vae={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(i,e){return e.type===20&&e.value==="none"?null:uE.parse(i,e)}},bae={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(i,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},hE={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Vv=function(i){return{name:"margin-"+i,initialValue:"0",prefix:!1,type:4}},xae=Vv("top"),wae=Vv("right"),Bae=Vv("bottom"),Cae=Vv("left"),Eae={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(i,e){return e.filter(Bs).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Sae={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},Hv=function(i){return{name:"padding-"+i,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Tae=Hv("top"),Iae=Hv("right"),Lae=Hv("bottom"),Mae=Hv("left"),Pae={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(i,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Fae={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(i,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Dae={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&aE(e[0],"none")?[]:Jh(e).map(function(t){for(var r={color:RA.TRANSPARENT,offsetX:al,offsetY:al,blur:al},n=0,o=0;o<t.length;o++){var l=t[o];Bd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:r.blur=l,n++):r.color=Ed.parse(i,l)}return r})}},Rae={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},kae={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(i,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=Nae[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Oae=function(i){var e=i.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Uae=function(i){var e=i.filter(function(g){return g.type===17}).map(function(g){return g.number}),t=e[0],r=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var l=e[12],s=e[13];return e[14],e[15],e.length===16?[t,r,n,o,l,s]:null},Nae={matrix:Oae,matrix3d:Uae},bR={type:16,number:50,flags:Jy},zae=[bR,bR],Qae={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(i,e){var t=e.filter(la);return t.length!==2?zae:[t[0],t[1]]}},Vae={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},o0;(function(i){i.NORMAL="normal",i.BREAK_ALL="break-all",i.KEEP_ALL="keep-all"})(o0||(o0={}));for(var Hae={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-all":return o0.BREAK_ALL;case"keep-all":return o0.KEEP_ALL;case"normal":default:return o0.NORMAL}}},Gae={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(i,e){if(e.type===20)return{auto:!0,order:0};if(Ng(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},xR={name:"time",parse:function(i,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},jae={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(i,e){return Ng(e)?e.number:1}},qae={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},$ae={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(i,e){return e.filter(Bs).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},Kae={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(i,e){var t=[],r=[];return e.forEach(function(n){switch(n.type){case 20:case 0:t.push(n.value);break;case 17:t.push(n.number.toString());break;case 4:r.push(t.join(" ")),t.length=0;break}}),t.length&&r.push(t.join(" ")),r.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},Wae={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Xae={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(i,e){if(Ng(e))return e.number;if(Bs(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Zae={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.filter(Bs).map(function(t){return t.value})}},Jae={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ea=function(i,e){return(i&e)!==0},Yae={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},ele={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var r=[],n=e.filter(JD),o=0;o<n.length;o++){var l=n[o],s=n[o+1];if(l.type===20){var g=s&&Ng(s)?s.number:1;r.push({counter:l.value,increment:g})}}return r}},tle={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return[];for(var t=[],r=e.filter(JD),n=0;n<r.length;n++){var o=r[n],l=r[n+1];if(Bs(o)&&o.value!=="none"){var s=l&&Ng(l)?l.number:0;t.push({counter:o.value,reset:s})}}return t}},ile={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(i,e){return e.filter(r0).map(function(t){return xR.parse(i,t)})}},rle={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var r=[],n=e.filter(Ioe);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var l=n[o].value,s=n[o+1].value;r.push({open:l,close:s})}return r}},wR=function(i,e,t){if(!i)return"";var r=i[Math.min(e,i.length-1)];return r?t?r.open:r.close:""},nle={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&aE(e[0],"none")?[]:Jh(e).map(function(t){for(var r={color:255,offsetX:al,offsetY:al,blur:al,spread:al,inset:!1},n=0,o=0;o<t.length;o++){var l=t[o];aE(l,"inset")?r.inset=!0:Bd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:n===2?r.blur=l:r.spread=l,n++):r.color=Ed.parse(i,l)}return r})}},sle={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(i,e){var t=[0,1,2],r=[];return e.filter(Bs).forEach(function(n){switch(n.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),t.forEach(function(n){r.indexOf(n)===-1&&r.push(n)}),r}},ole={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},ale={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(i,e){return r0(e)?e.number:0}},lle=function(){function i(e,t){var r,n;this.animationDuration=rr(e,ile,t.animationDuration),this.backgroundClip=rr(e,Poe,t.backgroundClip),this.backgroundColor=rr(e,Foe,t.backgroundColor),this.backgroundImage=rr(e,Hoe,t.backgroundImage),this.backgroundOrigin=rr(e,Goe,t.backgroundOrigin),this.backgroundPosition=rr(e,joe,t.backgroundPosition),this.backgroundRepeat=rr(e,qoe,t.backgroundRepeat),this.backgroundSize=rr(e,Koe,t.backgroundSize),this.borderTopColor=rr(e,Xoe,t.borderTopColor),this.borderRightColor=rr(e,Zoe,t.borderRightColor),this.borderBottomColor=rr(e,Joe,t.borderBottomColor),this.borderLeftColor=rr(e,Yoe,t.borderLeftColor),this.borderTopLeftRadius=rr(e,eae,t.borderTopLeftRadius),this.borderTopRightRadius=rr(e,tae,t.borderTopRightRadius),this.borderBottomRightRadius=rr(e,iae,t.borderBottomRightRadius),this.borderBottomLeftRadius=rr(e,rae,t.borderBottomLeftRadius),this.borderTopStyle=rr(e,nae,t.borderTopStyle),this.borderRightStyle=rr(e,sae,t.borderRightStyle),this.borderBottomStyle=rr(e,oae,t.borderBottomStyle),this.borderLeftStyle=rr(e,aae,t.borderLeftStyle),this.borderTopWidth=rr(e,lae,t.borderTopWidth),this.borderRightWidth=rr(e,cae,t.borderRightWidth),this.borderBottomWidth=rr(e,uae,t.borderBottomWidth),this.borderLeftWidth=rr(e,hae,t.borderLeftWidth),this.boxShadow=rr(e,nle,t.boxShadow),this.color=rr(e,Aae,t.color),this.direction=rr(e,dae,t.direction),this.display=rr(e,fae,t.display),this.float=rr(e,gae,t.cssFloat),this.fontFamily=rr(e,Kae,t.fontFamily),this.fontSize=rr(e,Wae,t.fontSize),this.fontStyle=rr(e,Jae,t.fontStyle),this.fontVariant=rr(e,Zae,t.fontVariant),this.fontWeight=rr(e,Xae,t.fontWeight),this.letterSpacing=rr(e,mae,t.letterSpacing),this.lineBreak=rr(e,yae,t.lineBreak),this.lineHeight=rr(e,_ae,t.lineHeight),this.listStyleImage=rr(e,vae,t.listStyleImage),this.listStylePosition=rr(e,bae,t.listStylePosition),this.listStyleType=rr(e,hE,t.listStyleType),this.marginTop=rr(e,xae,t.marginTop),this.marginRight=rr(e,wae,t.marginRight),this.marginBottom=rr(e,Bae,t.marginBottom),this.marginLeft=rr(e,Cae,t.marginLeft),this.opacity=rr(e,jae,t.opacity);var o=rr(e,Eae,t.overflow);this.overflowX=o[0],this.overflowY=o[o.length>1?1:0],this.overflowWrap=rr(e,Sae,t.overflowWrap),this.paddingTop=rr(e,Tae,t.paddingTop),this.paddingRight=rr(e,Iae,t.paddingRight),this.paddingBottom=rr(e,Lae,t.paddingBottom),this.paddingLeft=rr(e,Mae,t.paddingLeft),this.paintOrder=rr(e,sle,t.paintOrder),this.position=rr(e,Fae,t.position),this.textAlign=rr(e,Pae,t.textAlign),this.textDecorationColor=rr(e,qae,(r=t.textDecorationColor)!==null&&r!==void 0?r:t.color),this.textDecorationLine=rr(e,$ae,(n=t.textDecorationLine)!==null&&n!==void 0?n:t.textDecoration),this.textShadow=rr(e,Dae,t.textShadow),this.textTransform=rr(e,Rae,t.textTransform),this.transform=rr(e,kae,t.transform),this.transformOrigin=rr(e,Qae,t.transformOrigin),this.visibility=rr(e,Vae,t.visibility),this.webkitTextStrokeColor=rr(e,ole,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=rr(e,ale,t.webkitTextStrokeWidth),this.wordBreak=rr(e,Hae,t.wordBreak),this.zIndex=rr(e,Gae,t.zIndex)}return i.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},i.prototype.isTransparent=function(){return Sd(this.backgroundColor)},i.prototype.isTransformed=function(){return this.transform!==null},i.prototype.isPositioned=function(){return this.position!==0},i.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},i.prototype.isFloating=function(){return this.float!==0},i.prototype.isInlineLevel=function(){return Ea(this.display,4)||Ea(this.display,33554432)||Ea(this.display,268435456)||Ea(this.display,536870912)||Ea(this.display,67108864)||Ea(this.display,134217728)},i}(),cle=function(){function i(e,t){this.content=rr(e,Yae,t.content),this.quotes=rr(e,rle,t.quotes)}return i}(),BR=function(){function i(e,t){this.counterIncrement=rr(e,ele,t.counterIncrement),this.counterReset=rr(e,tle,t.counterReset)}return i}(),rr=function(i,e,t){var r=new XD,n=t!==null&&typeof t<"u"?t.toString():e.initialValue;r.write(n);var o=new ZD(r.read());switch(e.type){case 2:var l=o.parseComponentValue();return e.parse(i,Bs(l)?l.value:e.initialValue);case 0:return e.parse(i,o.parseComponentValue());case 1:return e.parse(i,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Fv.parse(i,o.parseComponentValue());case"color":return Ed.parse(i,o.parseComponentValue());case"image":return uE.parse(i,o.parseComponentValue());case"length":var s=o.parseComponentValue();return Bd(s)?s:al;case"length-percentage":var g=o.parseComponentValue();return la(g)?g:al;case"time":return xR.parse(i,o.parseComponentValue())}break}},ule="data-html2canvas-debug",hle=function(i){var e=i.getAttribute(ule);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},AE=function(i,e){var t=hle(i);return t===1||e===t},Yh=function(){function i(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,AE(t,3))debugger;this.styles=new lle(e,window.getComputedStyle(t,null)),CE(t)&&(this.styles.animationDuration.some(function(r){return r>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=dv(this.context,t),AE(t,4)&&(this.flags|=16)}return i}(),Ale="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",CR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a0=typeof Uint8Array>"u"?[]:new Uint8Array(256),Gv=0;Gv<CR.length;Gv++)a0[CR.charCodeAt(Gv)]=Gv;for(var dle=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),S=Array.isArray(b)?b:new Uint8Array(b);for(r=0;r<t;r+=4)o=a0[i.charCodeAt(r)],l=a0[i.charCodeAt(r+1)],s=a0[i.charCodeAt(r+2)],g=a0[i.charCodeAt(r+3)],S[n++]=o<<2|l>>4,S[n++]=(l&15)<<4|s>>2,S[n++]=(s&3)<<6|g&63;return b},fle=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},ple=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Rf=5,dE=11,fE=2,gle=dE-Rf,ER=65536>>Rf,mle=1<<Rf,pE=mle-1,yle=1024>>Rf,_le=ER+yle,vle=_le,ble=32,xle=vle+ble,wle=65536>>dE,Ble=1<<gle,Cle=Ble-1,SR=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},Ele=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},Sle=function(i,e){var t=dle(i),r=Array.isArray(t)?ple(t):new Uint32Array(t),n=Array.isArray(t)?fle(t):new Uint16Array(t),o=24,l=SR(n,o/2,r[4]/2),s=r[5]===2?SR(n,(o+r[4])/2):Ele(r,Math.ceil((o+r[4])/4));return new Tle(r[0],r[1],r[2],r[3],l,s)},Tle=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Rf],t=(t<<fE)+(e&pE),this.data[t];if(e<=65535)return t=this.index[ER+(e-55296>>Rf)],t=(t<<fE)+(e&pE),this.data[t];if(e<this.highStart)return t=xle-wle+(e>>dE),t=this.index[t],t+=e>>Rf&Cle,t=this.index[t],t=(t<<fE)+(e&pE),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),TR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ile=typeof Uint8Array>"u"?[]:new Uint8Array(256),jv=0;jv<TR.length;jv++)Ile[TR.charCodeAt(jv)]=jv;var Lle=1,gE=2,mE=3,IR=4,LR=5,Mle=7,MR=8,yE=9,_E=10,PR=11,FR=12,DR=13,RR=14,vE=15,Ple=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Fle=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},Dle=Sle(Ale),kf="",kR="",Rle=function(i){return Dle.get(i)},kle=function(i,e,t){var r=t-2,n=e[r],o=e[t-1],l=e[t];if(o===gE&&l===mE)return kf;if(o===gE||o===mE||o===IR||l===gE||l===mE||l===IR)return kR;if(o===MR&&[MR,yE,PR,FR].indexOf(l)!==-1||(o===PR||o===yE)&&(l===yE||l===_E)||(o===FR||o===_E)&&l===_E||l===DR||l===LR||l===Mle||o===Lle)return kf;if(o===DR&&l===RR){for(;n===LR;)n=e[--r];if(n===RR)return kf}if(o===vE&&l===vE){for(var s=0;n===vE;)s++,n=e[--r];if(s%2===0)return kf}return kR},Ole=function(i){var e=Ple(i),t=e.length,r=0,n=0,o=e.map(Rle);return{next:function(){if(r>=t)return{done:!0,value:null};for(var l=kf;r<t&&(l=kle(e,o,++r))===kf;);if(l!==kf||r===t){var s=Fle.apply(null,e.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},Ule=function(i){for(var e=Ole(i),t=[],r;!(r=e.next()).done;)r.value&&t.push(r.value.slice());return t},Nle=function(i){var e=123;if(i.createRange){var t=i.createRange();if(t.getBoundingClientRect){var r=i.createElement("boundtest");r.style.height=e+"px",r.style.display="block",i.body.appendChild(r),t.selectNode(r);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(i.body.removeChild(r),o===e)return!0}}return!1},zle=function(i){var e=i.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",i.body.appendChild(e);var t=i.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,n=fv(r.data).map(function(g){return qo(g)}),o=0,l={},s=n.every(function(g,b){t.setStart(r,o),t.setEnd(r,o+g.length);var S=t.getBoundingClientRect();o+=g.length;var F=S.x>l.x||S.y>l.y;return l=S,b===0?!0:F});return i.body.removeChild(e),s},Qle=function(){return typeof new Image().crossOrigin<"u"},Vle=function(){return typeof new XMLHttpRequest().responseType=="string"},Hle=function(i){var e=new Image,t=i.createElement("canvas"),r=t.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},OR=function(i){return i[0]===0&&i[1]===255&&i[2]===0&&i[3]===255},Gle=function(i){var e=i.createElement("canvas"),t=100;e.width=t,e.height=t;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,t,t);var n=new Image,o=e.toDataURL();n.src=o;var l=bE(t,t,0,0,n);return r.fillStyle="red",r.fillRect(0,0,t,t),UR(l).then(function(s){r.drawImage(s,0,0);var g=r.getImageData(0,0,t,t).data;r.fillStyle="red",r.fillRect(0,0,t,t);var b=i.createElement("div");return b.style.backgroundImage="url("+o+")",b.style.height=t+"px",OR(g)?UR(bE(t,t,0,0,b)):Promise.reject(!1)}).then(function(s){return r.drawImage(s,0,0),OR(r.getImageData(0,0,t,t).data)}).catch(function(){return!1})},bE=function(i,e,t,r,n){var o="http://www.w3.org/2000/svg",l=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return l.setAttributeNS(null,"width",i.toString()),l.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",t.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),l.appendChild(s),s.appendChild(n),l},UR=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},ll={get SUPPORT_RANGE_BOUNDS(){var i=Nle(document);return Object.defineProperty(ll,"SUPPORT_RANGE_BOUNDS",{value:i}),i},get SUPPORT_WORD_BREAKING(){var i=ll.SUPPORT_RANGE_BOUNDS&&zle(document);return Object.defineProperty(ll,"SUPPORT_WORD_BREAKING",{value:i}),i},get SUPPORT_SVG_DRAWING(){var i=Hle(document);return Object.defineProperty(ll,"SUPPORT_SVG_DRAWING",{value:i}),i},get SUPPORT_FOREIGNOBJECT_DRAWING(){var i=typeof Array.from=="function"&&typeof window.fetch=="function"?Gle(document):Promise.resolve(!1);return Object.defineProperty(ll,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:i}),i},get SUPPORT_CORS_IMAGES(){var i=Qle();return Object.defineProperty(ll,"SUPPORT_CORS_IMAGES",{value:i}),i},get SUPPORT_RESPONSE_TYPE(){var i=Vle();return Object.defineProperty(ll,"SUPPORT_RESPONSE_TYPE",{value:i}),i},get SUPPORT_CORS_XHR(){var i="withCredentials"in new XMLHttpRequest;return Object.defineProperty(ll,"SUPPORT_CORS_XHR",{value:i}),i},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var i=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(ll,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:i}),i}},l0=function(){function i(e,t){this.text=e,this.bounds=t}return i}(),jle=function(i,e,t,r){var n=Kle(e,t),o=[],l=0;return n.forEach(function(s){if(t.textDecorationLine.length||s.trim().length>0)if(ll.SUPPORT_RANGE_BOUNDS){var g=NR(r,l,s.length).getClientRects();if(g.length>1){var b=xE(s),S=0;b.forEach(function(D){o.push(new l0(D,FA.fromDOMRectList(i,NR(r,S+l,D.length).getClientRects()))),S+=D.length})}else o.push(new l0(s,FA.fromDOMRectList(i,g)))}else{var F=r.splitText(s.length);o.push(new l0(s,qle(i,r))),r=F}else ll.SUPPORT_RANGE_BOUNDS||(r=r.splitText(s.length));l+=s.length}),o},qle=function(i,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=dv(i,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return FA.EMPTY},NR=function(i,e,t){var r=i.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(i,e),n.setEnd(i,e+t),n},xE=function(i){if(ll.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(i)).map(function(t){return t.segment})}return Ule(i)},$le=function(i,e){if(ll.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(i)).map(function(r){return r.segment})}return Xle(i,e)},Kle=function(i,e){return e.letterSpacing!==0?xE(i):$le(i,e)},Wle=[32,160,4961,65792,65793,4153,4241],Xle=function(i,e){for(var t=wse(i,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],n,o=function(){if(n.value){var l=n.value.slice(),s=fv(l),g="";s.forEach(function(b){Wle.indexOf(b)===-1?g+=qo(b):(g.length&&r.push(g),r.push(qo(b)),g="")}),g.length&&r.push(g)}};!(n=t.next()).done;)o();return r},Zle=function(){function i(e,t,r){this.text=Jle(t.data,r.textTransform),this.textBounds=jle(e,this.text,r,t)}return i}(),Jle=function(i,e){switch(e){case 1:return i.toLowerCase();case 3:return i.replace(Yle,ece);case 2:return i.toUpperCase();default:return i}},Yle=/(^|\s|:|-|\(|\))([a-z])/g,ece=function(i,e,t){return i.length>0?e+t.toUpperCase():i},zR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return e}(Yh),QR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return e}(Yh),VR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=new XMLSerializer,l=dv(t,r);return r.setAttribute("width",l.width+"px"),r.setAttribute("height",l.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(o.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e}(Yh),HR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Yh),wE=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.start=r.start,n.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,n}return e}(Yh),tce=[{type:15,flags:0,unit:"px",number:3}],ice=[{type:16,flags:0,number:50}],rce=function(i){return i.width>i.height?new FA(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new FA(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i},nce=function(i){var e=i.type===sce?new Array(i.value.length+1).join(""):i.value;return e.length===0?i.placeholder||"":e},qv="checkbox",$v="radio",sce="password",GR=707406591,BE=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=nce(r),(n.type===qv||n.type===$v)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=rce(n.bounds)),n.type){case qv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=tce;break;case $v:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=ice;break}return n}return e}(Yh),jR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=r.options[r.selectedIndex||0];return n.value=o&&o.text||"",n}return e}(Yh),qR=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Yh),$R=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=WR(t,r.contentWindow.document.documentElement);var o=r.contentWindow.document.documentElement?s0(t,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):RA.TRANSPARENT,l=r.contentWindow.document.body?s0(t,getComputedStyle(r.contentWindow.document.body).backgroundColor):RA.TRANSPARENT;n.backgroundColor=Sd(o)?Sd(l)?n.styles.backgroundColor:l:o}}catch{}return n}return e}(Yh),oce=["OL","UL","MENU"],Kv=function(i,e,t,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,XR(n)&&n.data.trim().length>0)t.textNodes.push(new Zle(i,n,t.styles));else if(Vg(n))if(ik(n)&&n.assignedNodes)n.assignedNodes().forEach(function(s){return Kv(i,s,t,r)});else{var l=KR(i,n);l.styles.isVisible()&&(ace(n,l,r)?l.flags|=4:lce(l.styles)&&(l.flags|=2),oce.indexOf(n.tagName)!==-1&&(l.flags|=8),t.elements.push(l),n.slot,n.shadowRoot?Kv(i,n.shadowRoot,l,r):!Xv(n)&&!ZR(n)&&!Zv(n)&&Kv(i,n,l,r))}},KR=function(i,e){return SE(e)?new zR(i,e):JR(e)?new QR(i,e):ZR(e)?new VR(i,e):cce(e)?new HR(i,e):uce(e)?new wE(i,e):hce(e)?new BE(i,e):Zv(e)?new jR(i,e):Xv(e)?new qR(i,e):ek(e)?new $R(i,e):new Yh(i,e)},WR=function(i,e){var t=KR(i,e);return t.flags|=4,Kv(i,e,t,t),t},ace=function(i,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||EE(i)&&t.styles.isTransparent()},lce=function(i){return i.isPositioned()||i.isFloating()},XR=function(i){return i.nodeType===Node.TEXT_NODE},Vg=function(i){return i.nodeType===Node.ELEMENT_NODE},CE=function(i){return Vg(i)&&typeof i.style<"u"&&!Wv(i)},Wv=function(i){return typeof i.className=="object"},cce=function(i){return i.tagName==="LI"},uce=function(i){return i.tagName==="OL"},hce=function(i){return i.tagName==="INPUT"},Ace=function(i){return i.tagName==="HTML"},ZR=function(i){return i.tagName==="svg"},EE=function(i){return i.tagName==="BODY"},JR=function(i){return i.tagName==="CANVAS"},YR=function(i){return i.tagName==="VIDEO"},SE=function(i){return i.tagName==="IMG"},ek=function(i){return i.tagName==="IFRAME"},tk=function(i){return i.tagName==="STYLE"},dce=function(i){return i.tagName==="SCRIPT"},Xv=function(i){return i.tagName==="TEXTAREA"},Zv=function(i){return i.tagName==="SELECT"},ik=function(i){return i.tagName==="SLOT"},rk=function(i){return i.tagName.indexOf("-")>0},fce=function(){function i(){this.counters={}}return i.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},i.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},i.prototype.pop=function(e){var t=this;e.forEach(function(r){return t.counters[r].pop()})},i.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,o=!0;r!==null&&r.forEach(function(s){var g=t.counters[s.counter];g&&s.increment!==0&&(o=!1,g.length||g.push(1),g[Math.max(0,g.length-1)]+=s.increment)});var l=[];return o&&n.forEach(function(s){var g=t.counters[s.counter];l.push(s.counter),g||(g=t.counters[s.counter]=[]),g.push(s.reset)}),l},i}(),nk={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},sk={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},pce={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},gce={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Hg=function(i,e,t,r,n,o){return i<e||i>t?u0(i,n,o.length>0):r.integers.reduce(function(l,s,g){for(;i>=s;)i-=s,l+=r.values[g];return l},"")+o},ok=function(i,e,t,r){var n="";do t||i--,n=r(i)+n,i/=e;while(i*e>=e);return n},$o=function(i,e,t,r,n){var o=t-e+1;return(i<0?"-":"")+(ok(Math.abs(i),o,r,function(l){return qo(Math.floor(l%o)+e)})+n)},Of=function(i,e,t){t===void 0&&(t=". ");var r=e.length;return ok(Math.abs(i),r,!1,function(n){return e[Math.floor(n%r)]})+t},Gg=1,Id=2,Ld=4,c0=8,kA=function(i,e,t,r,n,o){if(i<-9999||i>9999)return u0(i,4,n.length>0);var l=Math.abs(i),s=n;if(l===0)return e[0]+s;for(var g=0;l>0&&g<=4;g++){var b=l%10;b===0&&Ea(o,Gg)&&s!==""?s=e[b]+s:b>1||b===1&&g===0||b===1&&g===1&&Ea(o,Id)||b===1&&g===1&&Ea(o,Ld)&&i>100||b===1&&g>1&&Ea(o,c0)?s=e[b]+(g>0?t[g-1]:"")+s:b===1&&g>0&&(s=t[g-1]+s),l=Math.floor(l/10)}return(i<0?r:"")+s},ak="",lk="",ck="",TE="",u0=function(i,e,t){var r=t?". ":"",n=t?"":"",o=t?", ":"",l=t?" ":"";switch(e){case 0:return""+l;case 1:return""+l;case 2:return""+l;case 5:var s=$o(i,48,57,!0,r);return s.length<4?"0"+s:s;case 4:return Of(i,"",n);case 6:return Hg(i,1,3999,nk,3,r).toLowerCase();case 7:return Hg(i,1,3999,nk,3,r);case 8:return $o(i,945,969,!1,r);case 9:return $o(i,97,122,!1,r);case 10:return $o(i,65,90,!1,r);case 11:return $o(i,1632,1641,!0,r);case 12:case 49:return Hg(i,1,9999,sk,3,r);case 35:return Hg(i,1,9999,sk,3,r).toLowerCase();case 13:return $o(i,2534,2543,!0,r);case 14:case 30:return $o(i,6112,6121,!0,r);case 15:return Of(i,"",n);case 16:return Of(i,"",n);case 17:case 48:return kA(i,"",ak,"",n,Id|Ld|c0);case 47:return kA(i,"",lk,"",n,Gg|Id|Ld|c0);case 42:return kA(i,"",ak,"",n,Id|Ld|c0);case 41:return kA(i,"",lk,"",n,Gg|Id|Ld|c0);case 26:return kA(i,"","",ck,n,0);case 25:return kA(i,"","",ck,n,Gg|Id|Ld);case 31:return kA(i,"","",TE,o,Gg|Id|Ld);case 33:return kA(i,"","",TE,o,0);case 32:return kA(i,"","",TE,o,Gg|Id|Ld);case 18:return $o(i,2406,2415,!0,r);case 20:return Hg(i,1,19999,gce,3,r);case 21:return $o(i,2790,2799,!0,r);case 22:return $o(i,2662,2671,!0,r);case 22:return Hg(i,1,10999,pce,3,r);case 23:return Of(i,"");case 24:return Of(i,"");case 27:return $o(i,3302,3311,!0,r);case 28:return Of(i,"",n);case 29:return Of(i,"",n);case 34:return $o(i,3792,3801,!0,r);case 37:return $o(i,6160,6169,!0,r);case 38:return $o(i,4160,4169,!0,r);case 39:return $o(i,2918,2927,!0,r);case 40:return $o(i,1776,1785,!0,r);case 43:return $o(i,3046,3055,!0,r);case 44:return $o(i,3174,3183,!0,r);case 45:return $o(i,3664,3673,!0,r);case 46:return $o(i,3872,3881,!0,r);case 3:default:return $o(i,48,57,!0,r)}},uk="data-html2canvas-ignore",hk=function(){function i(e,t,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=t,this.counters=new fce,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return i.prototype.toIFrame=function(e,t){var r=this,n=mce(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,l=e.defaultView.pageYOffset,s=n.contentWindow,g=s.document,b=vce(n).then(function(){return lc(r,void 0,void 0,function(){var S,F;return kl(this,function(D){switch(D.label){case 0:return this.scrolledElements.forEach(Bce),s&&(s.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==t.top||s.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),S=this.options.onclone,F=this.clonedReferenceElement,typeof F>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:g.fonts&&g.fonts.ready?[4,g.fonts.ready]:[3,2];case 1:D.sent(),D.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,_ce(g)]:[3,4];case 3:D.sent(),D.label=4;case 4:return typeof S=="function"?[2,Promise.resolve().then(function(){return S(g,F)}).then(function(){return n})]:[2,n]}})})});return g.open(),g.write(xce(document.doctype)+"<html></html>"),wce(this.referenceElement.ownerDocument,o,l),g.replaceChild(g.adoptNode(this.documentElement),g.documentElement),g.close(),b},i.prototype.createElementClone=function(e){if(AE(e,2))debugger;if(JR(e))return this.createCanvasClone(e);if(YR(e))return this.createVideoClone(e);if(tk(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return SE(t)&&(SE(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),rk(t)?this.createCustomElementClone(t):t},i.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return IE(e.style,t),t},i.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(o,l){return l&&typeof l.cssText=="string"?o+l.cssText:o},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(o){if(this.context.logger.error("Unable to access cssRules property",o),o.name!=="SecurityError")throw o}return e.cloneNode(!1)},i.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var o=e.getContext("2d"),l=n.getContext("2d");if(l)if(!this.options.allowTaint&&o)l.putImageData(o.getImageData(0,0,e.width,e.height),0,0);else{var s=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(s){var g=s.getContextAttributes();(g==null?void 0:g.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}l.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},i.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var r=t.getContext("2d");try{return r&&(r.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||r.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},i.prototype.appendChildNode=function(e,t,r){(!Vg(t)||!dce(t)&&!t.hasAttribute(uk)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!Vg(t)||!tk(t))&&e.appendChild(this.cloneNode(t,r))},i.prototype.cloneChildNodes=function(e,t,r){for(var n=this,o=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;o;o=o.nextSibling)if(Vg(o)&&ik(o)&&typeof o.assignedNodes=="function"){var l=o.assignedNodes();l.length&&l.forEach(function(s){return n.appendChildNode(t,s,r)})}else this.appendChildNode(t,o,r)},i.prototype.cloneNode=function(e,t){if(XR(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&Vg(e)&&(CE(e)||Wv(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var o=r.getComputedStyle(e),l=r.getComputedStyle(e,":before"),s=r.getComputedStyle(e,":after");this.referenceElement===e&&CE(n)&&(this.clonedReferenceElement=n),EE(n)&&Sce(n);var g=this.counters.parse(new BR(this.context,o)),b=this.resolvePseudoContent(e,n,l,h0.BEFORE);rk(e)&&(t=!0),YR(e)||this.cloneChildNodes(e,n,t),b&&n.insertBefore(b,n.firstChild);var S=this.resolvePseudoContent(e,n,s,h0.AFTER);return S&&n.appendChild(S),this.counters.pop(g),(o&&(this.options.copyStyles||Wv(e))&&!ek(e)||t)&&IE(o,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(Xv(e)||Zv(e))&&(Xv(n)||Zv(n))&&(n.value=e.value),n}return e.cloneNode(!1)},i.prototype.resolvePseudoContent=function(e,t,r,n){var o=this;if(r){var l=r.content,s=t.ownerDocument;if(!(!s||!l||l==="none"||l==="-moz-alt-content"||r.display==="none")){this.counters.parse(new BR(this.context,r));var g=new cle(this.context,r),b=s.createElement("html2canvaspseudoelement");IE(r,b),g.content.forEach(function(F){if(F.type===0)b.appendChild(s.createTextNode(F.value));else if(F.type===22){var D=s.createElement("img");D.src=F.value,D.style.opacity="1",b.appendChild(D)}else if(F.type===18){if(F.name==="attr"){var N=F.values.filter(Bs);N.length&&b.appendChild(s.createTextNode(e.getAttribute(N[0].value)||""))}else if(F.name==="counter"){var J=F.values.filter(zg),te=J[0],he=J[1];if(te&&Bs(te)){var ue=o.counters.getCounterValue(te.value),fe=he&&Bs(he)?hE.parse(o.context,he.value):3;b.appendChild(s.createTextNode(u0(ue,fe,!1)))}}else if(F.name==="counters"){var ve=F.values.filter(zg),te=ve[0],Se=ve[1],he=ve[2];if(te&&Bs(te)){var Ge=o.counters.getCounterValues(te.value),He=he&&Bs(he)?hE.parse(o.context,he.value):3,$e=Se&&Se.type===0?Se.value:"",Ne=Ge.map(function(Re){return u0(Re,He,!1)}).join($e);b.appendChild(s.createTextNode(Ne))}}}else if(F.type===20)switch(F.value){case"open-quote":b.appendChild(s.createTextNode(wR(g.quotes,o.quoteDepth++,!0)));break;case"close-quote":b.appendChild(s.createTextNode(wR(g.quotes,--o.quoteDepth,!1)));break;default:b.appendChild(s.createTextNode(F.value))}}),b.className=LE+" "+ME;var S=n===h0.BEFORE?" "+LE:" "+ME;return Wv(t)?t.className.baseValue+=S:t.className+=S,b}}},i.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},i}(),h0;(function(i){i[i.BEFORE=0]="BEFORE",i[i.AFTER=1]="AFTER"})(h0||(h0={}));var mce=function(i,e){var t=i.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(uk,"true"),i.body.appendChild(t),t},yce=function(i){return new Promise(function(e){if(i.complete){e();return}if(!i.src){e();return}i.onload=e,i.onerror=e})},_ce=function(i){return Promise.all([].slice.call(i.images,0).map(yce))},vce=function(i){return new Promise(function(e,t){var r=i.contentWindow;if(!r)return t("No window assigned for iframe");var n=r.document;r.onload=i.onload=function(){r.onload=i.onload=null;var o=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(o),e(i))},50)}})},bce=["all","d","content"],IE=function(i,e){for(var t=i.length-1;t>=0;t--){var r=i.item(t);bce.indexOf(r)===-1&&e.style.setProperty(r,i.getPropertyValue(r))}return e},xce=function(i){var e="";return i&&(e+="<!DOCTYPE ",i.name&&(e+=i.name),i.internalSubset&&(e+=i.internalSubset),i.publicId&&(e+='"'+i.publicId+'"'),i.systemId&&(e+='"'+i.systemId+'"'),e+=">"),e},wce=function(i,e,t){i&&i.defaultView&&(e!==i.defaultView.pageXOffset||t!==i.defaultView.pageYOffset)&&i.defaultView.scrollTo(e,t)},Bce=function(i){var e=i[0],t=i[1],r=i[2];e.scrollLeft=t,e.scrollTop=r},Cce=":before",Ece=":after",LE="___html2canvas___pseudoelement_before",ME="___html2canvas___pseudoelement_after",Ak=`{
    content: "" !important;
    display: none !important;
}`,Sce=function(i){Tce(i,"."+LE+Cce+Ak+`
         .`+ME+Ece+Ak)},Tce=function(i,e){var t=i.ownerDocument;if(t){var r=t.createElement("style");r.textContent=e,i.appendChild(r)}},dk=function(){function i(){}return i.getOrigin=function(e){var t=i._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},i.isSameOrigin=function(e){return i.getOrigin(e)===i._origin},i.setContext=function(e){i._link=e.document.createElement("a"),i._origin=i.getOrigin(e.location.href)},i._origin="about:blank",i}(),Ice=function(){function i(e,t){this.context=e,this._options=t,this._cache={}}return i.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(FE(e)||Fce(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},i.prototype.match=function(e){return this._cache[e]},i.prototype.loadImage=function(e){return lc(this,void 0,void 0,function(){var t,r,n,o,l=this;return kl(this,function(s){switch(s.label){case 0:return t=dk.isSameOrigin(e),r=!PE(e)&&this._options.useCORS===!0&&ll.SUPPORT_CORS_IMAGES&&!t,n=!PE(e)&&!t&&!FE(e)&&typeof this._options.proxy=="string"&&ll.SUPPORT_CORS_XHR&&!r,!t&&this._options.allowTaint===!1&&!PE(e)&&!FE(e)&&!n&&!r?[2]:(o=e,n?[4,this.proxy(o)]:[3,2]);case 1:o=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(g,b){var S=new Image;S.onload=function(){return g(S)},S.onerror=b,(Dce(o)||r)&&(S.crossOrigin="anonymous"),S.src=o,S.complete===!0&&setTimeout(function(){return g(S)},500),l._options.imageTimeout>0&&setTimeout(function(){return b("Timed out ("+l._options.imageTimeout+"ms) loading image")},l._options.imageTimeout)})];case 3:return[2,s.sent()]}})})},i.prototype.has=function(e){return typeof this._cache[e]<"u"},i.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},i.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(o,l){var s=ll.SUPPORT_RESPONSE_TYPE?"blob":"text",g=new XMLHttpRequest;g.onload=function(){if(g.status===200)if(s==="text")o(g.response);else{var F=new FileReader;F.addEventListener("load",function(){return o(F.result)},!1),F.addEventListener("error",function(D){return l(D)},!1),F.readAsDataURL(g.response)}else l("Failed to proxy resource "+n+" with status code "+g.status)},g.onerror=l;var b=r.indexOf("?")>-1?"&":"?";if(g.open("GET",""+r+b+"url="+encodeURIComponent(e)+"&responseType="+s),s!=="text"&&g instanceof XMLHttpRequest&&(g.responseType=s),t._options.imageTimeout){var S=t._options.imageTimeout;g.timeout=S,g.ontimeout=function(){return l("Timed out ("+S+"ms) proxying "+n)}}g.send()})},i}(),Lce=/^data:image\/svg\+xml/i,Mce=/^data:image\/.*;base64,/i,Pce=/^data:image\/.*/i,Fce=function(i){return ll.SUPPORT_SVG_DRAWING||!Rce(i)},PE=function(i){return Pce.test(i)},Dce=function(i){return Mce.test(i)},FE=function(i){return i.substr(0,4)==="blob"},Rce=function(i){return i.substr(-3).toLowerCase()==="svg"||Lce.test(i)},tr=function(){function i(e,t){this.type=0,this.x=e,this.y=t}return i.prototype.add=function(e,t){return new i(this.x+e,this.y+t)},i}(),jg=function(i,e,t){return new tr(i.x+(e.x-i.x)*t,i.y+(e.y-i.y)*t)},Jv=function(){function i(e,t,r,n){this.type=1,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return i.prototype.subdivide=function(e,t){var r=jg(this.start,this.startControl,e),n=jg(this.startControl,this.endControl,e),o=jg(this.endControl,this.end,e),l=jg(r,n,e),s=jg(n,o,e),g=jg(l,s,e);return t?new i(this.start,r,l,g):new i(g,s,o,this.end)},i.prototype.add=function(e,t){return new i(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},i.prototype.reverse=function(){return new i(this.end,this.endControl,this.startControl,this.start)},i}(),Pu=function(i){return i.type===1},kce=function(){function i(e){var t=e.styles,r=e.bounds,n=n0(t.borderTopLeftRadius,r.width,r.height),o=n[0],l=n[1],s=n0(t.borderTopRightRadius,r.width,r.height),g=s[0],b=s[1],S=n0(t.borderBottomRightRadius,r.width,r.height),F=S[0],D=S[1],N=n0(t.borderBottomLeftRadius,r.width,r.height),J=N[0],te=N[1],he=[];he.push((o+g)/r.width),he.push((J+F)/r.width),he.push((l+te)/r.height),he.push((b+D)/r.height);var ue=Math.max.apply(Math,he);ue>1&&(o/=ue,l/=ue,g/=ue,b/=ue,F/=ue,D/=ue,J/=ue,te/=ue);var fe=r.width-g,ve=r.height-D,Se=r.width-F,Ge=r.height-te,He=t.borderTopWidth,$e=t.borderRightWidth,Ne=t.borderBottomWidth,at=t.borderLeftWidth,rt=Hs(t.paddingTop,e.bounds.width),Re=Hs(t.paddingRight,e.bounds.width),Pe=Hs(t.paddingBottom,e.bounds.width),Je=Hs(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||l>0?Ys(r.left+at/3,r.top+He/3,o-at/3,l-He/3,cs.TOP_LEFT):new tr(r.left+at/3,r.top+He/3),this.topRightBorderDoubleOuterBox=o>0||l>0?Ys(r.left+fe,r.top+He/3,g-$e/3,b-He/3,cs.TOP_RIGHT):new tr(r.left+r.width-$e/3,r.top+He/3),this.bottomRightBorderDoubleOuterBox=F>0||D>0?Ys(r.left+Se,r.top+ve,F-$e/3,D-Ne/3,cs.BOTTOM_RIGHT):new tr(r.left+r.width-$e/3,r.top+r.height-Ne/3),this.bottomLeftBorderDoubleOuterBox=J>0||te>0?Ys(r.left+at/3,r.top+Ge,J-at/3,te-Ne/3,cs.BOTTOM_LEFT):new tr(r.left+at/3,r.top+r.height-Ne/3),this.topLeftBorderDoubleInnerBox=o>0||l>0?Ys(r.left+at*2/3,r.top+He*2/3,o-at*2/3,l-He*2/3,cs.TOP_LEFT):new tr(r.left+at*2/3,r.top+He*2/3),this.topRightBorderDoubleInnerBox=o>0||l>0?Ys(r.left+fe,r.top+He*2/3,g-$e*2/3,b-He*2/3,cs.TOP_RIGHT):new tr(r.left+r.width-$e*2/3,r.top+He*2/3),this.bottomRightBorderDoubleInnerBox=F>0||D>0?Ys(r.left+Se,r.top+ve,F-$e*2/3,D-Ne*2/3,cs.BOTTOM_RIGHT):new tr(r.left+r.width-$e*2/3,r.top+r.height-Ne*2/3),this.bottomLeftBorderDoubleInnerBox=J>0||te>0?Ys(r.left+at*2/3,r.top+Ge,J-at*2/3,te-Ne*2/3,cs.BOTTOM_LEFT):new tr(r.left+at*2/3,r.top+r.height-Ne*2/3),this.topLeftBorderStroke=o>0||l>0?Ys(r.left+at/2,r.top+He/2,o-at/2,l-He/2,cs.TOP_LEFT):new tr(r.left+at/2,r.top+He/2),this.topRightBorderStroke=o>0||l>0?Ys(r.left+fe,r.top+He/2,g-$e/2,b-He/2,cs.TOP_RIGHT):new tr(r.left+r.width-$e/2,r.top+He/2),this.bottomRightBorderStroke=F>0||D>0?Ys(r.left+Se,r.top+ve,F-$e/2,D-Ne/2,cs.BOTTOM_RIGHT):new tr(r.left+r.width-$e/2,r.top+r.height-Ne/2),this.bottomLeftBorderStroke=J>0||te>0?Ys(r.left+at/2,r.top+Ge,J-at/2,te-Ne/2,cs.BOTTOM_LEFT):new tr(r.left+at/2,r.top+r.height-Ne/2),this.topLeftBorderBox=o>0||l>0?Ys(r.left,r.top,o,l,cs.TOP_LEFT):new tr(r.left,r.top),this.topRightBorderBox=g>0||b>0?Ys(r.left+fe,r.top,g,b,cs.TOP_RIGHT):new tr(r.left+r.width,r.top),this.bottomRightBorderBox=F>0||D>0?Ys(r.left+Se,r.top+ve,F,D,cs.BOTTOM_RIGHT):new tr(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=J>0||te>0?Ys(r.left,r.top+Ge,J,te,cs.BOTTOM_LEFT):new tr(r.left,r.top+r.height),this.topLeftPaddingBox=o>0||l>0?Ys(r.left+at,r.top+He,Math.max(0,o-at),Math.max(0,l-He),cs.TOP_LEFT):new tr(r.left+at,r.top+He),this.topRightPaddingBox=g>0||b>0?Ys(r.left+Math.min(fe,r.width-$e),r.top+He,fe>r.width+$e?0:Math.max(0,g-$e),Math.max(0,b-He),cs.TOP_RIGHT):new tr(r.left+r.width-$e,r.top+He),this.bottomRightPaddingBox=F>0||D>0?Ys(r.left+Math.min(Se,r.width-at),r.top+Math.min(ve,r.height-Ne),Math.max(0,F-$e),Math.max(0,D-Ne),cs.BOTTOM_RIGHT):new tr(r.left+r.width-$e,r.top+r.height-Ne),this.bottomLeftPaddingBox=J>0||te>0?Ys(r.left+at,r.top+Math.min(Ge,r.height-Ne),Math.max(0,J-at),Math.max(0,te-Ne),cs.BOTTOM_LEFT):new tr(r.left+at,r.top+r.height-Ne),this.topLeftContentBox=o>0||l>0?Ys(r.left+at+Je,r.top+He+rt,Math.max(0,o-(at+Je)),Math.max(0,l-(He+rt)),cs.TOP_LEFT):new tr(r.left+at+Je,r.top+He+rt),this.topRightContentBox=g>0||b>0?Ys(r.left+Math.min(fe,r.width+at+Je),r.top+He+rt,fe>r.width+at+Je?0:g-at+Je,b-(He+rt),cs.TOP_RIGHT):new tr(r.left+r.width-($e+Re),r.top+He+rt),this.bottomRightContentBox=F>0||D>0?Ys(r.left+Math.min(Se,r.width-(at+Je)),r.top+Math.min(ve,r.height+He+rt),Math.max(0,F-($e+Re)),D-(Ne+Pe),cs.BOTTOM_RIGHT):new tr(r.left+r.width-($e+Re),r.top+r.height-(Ne+Pe)),this.bottomLeftContentBox=J>0||te>0?Ys(r.left+at+Je,r.top+Ge,Math.max(0,J-(at+Je)),te-(Ne+Pe),cs.BOTTOM_LEFT):new tr(r.left+at+Je,r.top+r.height-(Ne+Pe))}return i}(),cs;(function(i){i[i.TOP_LEFT=0]="TOP_LEFT",i[i.TOP_RIGHT=1]="TOP_RIGHT",i[i.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",i[i.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(cs||(cs={}));var Ys=function(i,e,t,r,n){var o=4*((Math.sqrt(2)-1)/3),l=t*o,s=r*o,g=i+t,b=e+r;switch(n){case cs.TOP_LEFT:return new Jv(new tr(i,b),new tr(i,b-s),new tr(g-l,e),new tr(g,e));case cs.TOP_RIGHT:return new Jv(new tr(i,e),new tr(i+l,e),new tr(g,b-s),new tr(g,b));case cs.BOTTOM_RIGHT:return new Jv(new tr(g,e),new tr(g,e+s),new tr(i+l,b),new tr(i,b));case cs.BOTTOM_LEFT:default:return new Jv(new tr(g,b),new tr(g-l,b),new tr(i,e+s),new tr(i,e))}},Yv=function(i){return[i.topLeftBorderBox,i.topRightBorderBox,i.bottomRightBorderBox,i.bottomLeftBorderBox]},Oce=function(i){return[i.topLeftContentBox,i.topRightContentBox,i.bottomRightContentBox,i.bottomLeftContentBox]},eb=function(i){return[i.topLeftPaddingBox,i.topRightPaddingBox,i.bottomRightPaddingBox,i.bottomLeftPaddingBox]},Uce=function(){function i(e,t,r){this.offsetX=e,this.offsetY=t,this.matrix=r,this.type=0,this.target=6}return i}(),tb=function(){function i(e,t){this.path=e,this.target=t,this.type=1}return i}(),Nce=function(){function i(e){this.opacity=e,this.type=2,this.target=6}return i}(),zce=function(i){return i.type===0},fk=function(i){return i.type===1},Qce=function(i){return i.type===2},pk=function(i,e){return i.length===e.length?i.some(function(t,r){return t===e[r]}):!1},Vce=function(i,e,t,r,n){return i.map(function(o,l){switch(l){case 0:return o.add(e,t);case 1:return o.add(e+r,t);case 2:return o.add(e+r,t+n);case 3:return o.add(e,t+n)}return o})},gk=function(){function i(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return i}(),mk=function(){function i(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new kce(this.container),this.container.styles.opacity<1&&this.effects.push(new Nce(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,o=this.container.styles.transform;this.effects.push(new Uce(r,n,o))}if(this.container.styles.overflowX!==0){var l=Yv(this.curves),s=eb(this.curves);pk(l,s)?this.effects.push(new tb(l,6)):(this.effects.push(new tb(l,2)),this.effects.push(new tb(s,4)))}}return i.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,n=this.effects.slice(0);r;){var o=r.effects.filter(function(g){return!fk(g)});if(t||r.container.styles.position!==0||!r.parent){if(n.unshift.apply(n,o),t=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var l=Yv(r.curves),s=eb(r.curves);pk(l,s)||n.unshift(new tb(s,6))}}else n.unshift.apply(n,o);r=r.parent}return n.filter(function(g){return Ea(g.target,e)})},i}(),DE=function(i,e,t,r){i.container.elements.forEach(function(n){var o=Ea(n.flags,4),l=Ea(n.flags,2),s=new mk(n,i);Ea(n.styles.display,2048)&&r.push(s);var g=Ea(n.flags,8)?[]:r;if(o||l){var b=o||n.styles.isPositioned()?t:e,S=new gk(s);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var F=n.styles.zIndex.order;if(F<0){var D=0;b.negativeZIndex.some(function(J,te){return F>J.element.container.styles.zIndex.order?(D=te,!1):D>0}),b.negativeZIndex.splice(D,0,S)}else if(F>0){var N=0;b.positiveZIndex.some(function(J,te){return F>=J.element.container.styles.zIndex.order?(N=te+1,!1):N>0}),b.positiveZIndex.splice(N,0,S)}else b.zeroOrAutoZIndexOrTransformedOrOpacity.push(S)}else n.styles.isFloating()?b.nonPositionedFloats.push(S):b.nonPositionedInlineLevel.push(S);DE(s,S,o?S:t,g)}else n.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),DE(s,e,t,g);Ea(n.flags,8)&&yk(n,g)})},yk=function(i,e){for(var t=i instanceof wE?i.start:1,r=i instanceof wE?i.reversed:!1,n=0;n<e.length;n++){var o=e[n];o.container instanceof HR&&typeof o.container.value=="number"&&o.container.value!==0&&(t=o.container.value),o.listValue=u0(t,o.container.styles.listStyleType,!0),t+=r?-1:1}},Hce=function(i){var e=new mk(i,null),t=new gk(e),r=[];return DE(e,t,t,r),yk(e.container,r),t},_k=function(i,e){switch(e){case 0:return Fu(i.topLeftBorderBox,i.topLeftPaddingBox,i.topRightBorderBox,i.topRightPaddingBox);case 1:return Fu(i.topRightBorderBox,i.topRightPaddingBox,i.bottomRightBorderBox,i.bottomRightPaddingBox);case 2:return Fu(i.bottomRightBorderBox,i.bottomRightPaddingBox,i.bottomLeftBorderBox,i.bottomLeftPaddingBox);case 3:default:return Fu(i.bottomLeftBorderBox,i.bottomLeftPaddingBox,i.topLeftBorderBox,i.topLeftPaddingBox)}},Gce=function(i,e){switch(e){case 0:return Fu(i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox,i.topRightBorderBox,i.topRightBorderDoubleOuterBox);case 1:return Fu(i.topRightBorderBox,i.topRightBorderDoubleOuterBox,i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox);case 2:return Fu(i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox,i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox);case 3:default:return Fu(i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox,i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox)}},jce=function(i,e){switch(e){case 0:return Fu(i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox,i.topRightBorderDoubleInnerBox,i.topRightPaddingBox);case 1:return Fu(i.topRightBorderDoubleInnerBox,i.topRightPaddingBox,i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox);case 2:return Fu(i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox,i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox);case 3:default:return Fu(i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox,i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox)}},qce=function(i,e){switch(e){case 0:return ib(i.topLeftBorderStroke,i.topRightBorderStroke);case 1:return ib(i.topRightBorderStroke,i.bottomRightBorderStroke);case 2:return ib(i.bottomRightBorderStroke,i.bottomLeftBorderStroke);case 3:default:return ib(i.bottomLeftBorderStroke,i.topLeftBorderStroke)}},ib=function(i,e){var t=[];return Pu(i)?t.push(i.subdivide(.5,!1)):t.push(i),Pu(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Fu=function(i,e,t,r){var n=[];return Pu(i)?n.push(i.subdivide(.5,!1)):n.push(i),Pu(t)?n.push(t.subdivide(.5,!0)):n.push(t),Pu(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Pu(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},vk=function(i){var e=i.bounds,t=i.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},rb=function(i){var e=i.styles,t=i.bounds,r=Hs(e.paddingLeft,t.width),n=Hs(e.paddingRight,t.width),o=Hs(e.paddingTop,t.width),l=Hs(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+o+l))},$ce=function(i,e){return i===0?e.bounds:i===2?rb(e):vk(e)},Kce=function(i,e){return i===0?e.bounds:i===2?rb(e):vk(e)},RE=function(i,e,t){var r=$ce($g(i.styles.backgroundOrigin,e),i),n=Kce($g(i.styles.backgroundClip,e),i),o=Wce($g(i.styles.backgroundSize,e),t,r),l=o[0],s=o[1],g=n0($g(i.styles.backgroundPosition,e),r.width-l,r.height-s),b=Xce($g(i.styles.backgroundRepeat,e),g,o,r,n),S=Math.round(r.left+g[0]),F=Math.round(r.top+g[1]);return[b,S,F,l,s]},qg=function(i){return Bs(i)&&i.value===Qg.AUTO},nb=function(i){return typeof i=="number"},Wce=function(i,e,t){var r=e[0],n=e[1],o=e[2],l=i[0],s=i[1];if(!l)return[0,0];if(la(l)&&s&&la(s))return[Hs(l,t.width),Hs(s,t.height)];var g=nb(o);if(Bs(l)&&(l.value===Qg.CONTAIN||l.value===Qg.COVER)){if(nb(o)){var b=t.width/t.height;return b<o!=(l.value===Qg.COVER)?[t.width,t.width/o]:[t.height*o,t.height]}return[t.width,t.height]}var S=nb(r),F=nb(n),D=S||F;if(qg(l)&&(!s||qg(s))){if(S&&F)return[r,n];if(!g&&!D)return[t.width,t.height];if(D&&g){var N=S?r:n*o,J=F?n:r/o;return[N,J]}var te=S?r:t.width,he=F?n:t.height;return[te,he]}if(g){var ue=0,fe=0;return la(l)?ue=Hs(l,t.width):la(s)&&(fe=Hs(s,t.height)),qg(l)?ue=fe*o:(!s||qg(s))&&(fe=ue/o),[ue,fe]}var ve=null,Se=null;if(la(l)?ve=Hs(l,t.width):s&&la(s)&&(Se=Hs(s,t.height)),ve!==null&&(!s||qg(s))&&(Se=S&&F?ve/r*n:t.height),Se!==null&&qg(l)&&(ve=S&&F?Se/n*r:t.width),ve!==null&&Se!==null)return[ve,Se];throw new Error("Unable to calculate background-size for element")},$g=function(i,e){var t=i[e];return typeof t>"u"?i[0]:t},Xce=function(i,e,t,r,n){var o=e[0],l=e[1],s=t[0],g=t[1];switch(i){case 2:return[new tr(Math.round(r.left),Math.round(r.top+l)),new tr(Math.round(r.left+r.width),Math.round(r.top+l)),new tr(Math.round(r.left+r.width),Math.round(g+r.top+l)),new tr(Math.round(r.left),Math.round(g+r.top+l))];case 3:return[new tr(Math.round(r.left+o),Math.round(r.top)),new tr(Math.round(r.left+o+s),Math.round(r.top)),new tr(Math.round(r.left+o+s),Math.round(r.height+r.top)),new tr(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new tr(Math.round(r.left+o),Math.round(r.top+l)),new tr(Math.round(r.left+o+s),Math.round(r.top+l)),new tr(Math.round(r.left+o+s),Math.round(r.top+l+g)),new tr(Math.round(r.left+o),Math.round(r.top+l+g))];default:return[new tr(Math.round(n.left),Math.round(n.top)),new tr(Math.round(n.left+n.width),Math.round(n.top)),new tr(Math.round(n.left+n.width),Math.round(n.height+n.top)),new tr(Math.round(n.left),Math.round(n.height+n.top))]}},Zce="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bk="Hidden Text",Jce=function(){function i(e){this._data={},this._document=e}return i.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),l=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",l.appendChild(r),n.src=Zce,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(bk)),r.appendChild(o),r.appendChild(n);var s=n.offsetTop-o.offsetTop+2;r.removeChild(o),r.appendChild(this._document.createTextNode(bk)),r.style.lineHeight="normal",n.style.verticalAlign="super";var g=n.offsetTop-r.offsetTop+2;return l.removeChild(r),{baseline:s,middle:g}},i.prototype.getMetrics=function(e,t){var r=e+" "+t;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},i}(),xk=function(){function i(e,t){this.context=e,this.options=t}return i}(),Yce=1e4,eue=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new Jce(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return e.prototype.applyEffects=function(t){for(var r=this;this._activeEffects.length;)this.popEffect();t.forEach(function(n){return r.applyEffect(n)})},e.prototype.applyEffect=function(t){this.ctx.save(),Qce(t)&&(this.ctx.globalAlpha=t.opacity),zce(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),fk(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return lc(this,void 0,void 0,function(){var r;return kl(this,function(n){switch(n.label){case 0:return r=t.element.container.styles,r.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return lc(this,void 0,void 0,function(){return kl(this,function(r){switch(r.label){case 0:if(Ea(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,r,n){var o=this;if(r===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n);else{var l=xE(t.text);l.reduce(function(s,g){return o.ctx.fillText(g,s,t.bounds.top+n),s+o.ctx.measureText(g).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var r=t.fontVariant.filter(function(l){return l==="normal"||l==="small-caps"}).join(""),n=sue(t.fontFamily).join(", "),o=r0(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,r,t.fontWeight,o,n].join(" "),n,o]},e.prototype.renderTextNode=function(t,r){return lc(this,void 0,void 0,function(){var n,o,l,s,g,b,S,F,D=this;return kl(this,function(N){return n=this.createFontStyle(r),o=n[0],l=n[1],s=n[2],this.ctx.font=o,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",g=this.fontMetrics.getMetrics(l,s),b=g.baseline,S=g.middle,F=r.paintOrder,t.textBounds.forEach(function(J){F.forEach(function(te){switch(te){case 0:D.ctx.fillStyle=qa(r.color),D.renderTextWithLetterSpacing(J,r.letterSpacing,b);var he=r.textShadow;he.length&&J.text.trim().length&&(he.slice(0).reverse().forEach(function(ue){D.ctx.shadowColor=qa(ue.color),D.ctx.shadowOffsetX=ue.offsetX.number*D.options.scale,D.ctx.shadowOffsetY=ue.offsetY.number*D.options.scale,D.ctx.shadowBlur=ue.blur.number,D.renderTextWithLetterSpacing(J,r.letterSpacing,b)}),D.ctx.shadowColor="",D.ctx.shadowOffsetX=0,D.ctx.shadowOffsetY=0,D.ctx.shadowBlur=0),r.textDecorationLine.length&&(D.ctx.fillStyle=qa(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(ue){switch(ue){case 1:D.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top+b),J.bounds.width,1);break;case 2:D.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top),J.bounds.width,1);break;case 3:D.ctx.fillRect(J.bounds.left,Math.ceil(J.bounds.top+S),J.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&J.text.trim().length&&(D.ctx.strokeStyle=qa(r.webkitTextStrokeColor),D.ctx.lineWidth=r.webkitTextStrokeWidth,D.ctx.lineJoin=window.chrome?"miter":"round",D.ctx.strokeText(J.text,J.bounds.left,J.bounds.top+b)),D.ctx.strokeStyle="",D.ctx.lineWidth=0,D.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,r,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var o=rb(t),l=eb(r);this.path(l),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,o.left,o.top,o.width,o.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return lc(this,void 0,void 0,function(){var r,n,o,l,s,g,fe,fe,b,S,F,D,Se,N,J,Ge,te,he,ue,fe,ve,Se,Ge;return kl(this,function(He){switch(He.label){case 0:this.applyEffects(t.getEffects(4)),r=t.container,n=t.curves,o=r.styles,l=0,s=r.textNodes,He.label=1;case 1:return l<s.length?(g=s[l],[4,this.renderTextNode(g,o)]):[3,4];case 2:He.sent(),He.label=3;case 3:return l++,[3,1];case 4:if(!(r instanceof zR))return[3,8];He.label=5;case 5:return He.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return fe=He.sent(),this.renderReplacedElement(r,n,fe),[3,8];case 7:return He.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof QR&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof VR))return[3,12];He.label=9;case 9:return He.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return fe=He.sent(),this.renderReplacedElement(r,n,fe),[3,12];case 11:return He.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof $R&&r.tree?(b=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,b.render(r.tree)]):[3,14];case 13:S=He.sent(),r.width&&r.height&&this.ctx.drawImage(S,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),He.label=14;case 14:if(r instanceof BE&&(F=Math.min(r.bounds.width,r.bounds.height),r.type===qv?r.checked&&(this.ctx.save(),this.path([new tr(r.bounds.left+F*.39363,r.bounds.top+F*.79),new tr(r.bounds.left+F*.16,r.bounds.top+F*.5549),new tr(r.bounds.left+F*.27347,r.bounds.top+F*.44071),new tr(r.bounds.left+F*.39694,r.bounds.top+F*.5649),new tr(r.bounds.left+F*.72983,r.bounds.top+F*.23),new tr(r.bounds.left+F*.84,r.bounds.top+F*.34085),new tr(r.bounds.left+F*.39363,r.bounds.top+F*.79)]),this.ctx.fillStyle=qa(GR),this.ctx.fill(),this.ctx.restore()):r.type===$v&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+F/2,r.bounds.top+F/2,F/4,0,Math.PI*2,!0),this.ctx.fillStyle=qa(GR),this.ctx.fill(),this.ctx.restore())),tue(r)&&r.value.length){switch(D=this.createFontStyle(o),Se=D[0],N=D[1],J=this.fontMetrics.getMetrics(Se,N).baseline,this.ctx.font=Se,this.ctx.fillStyle=qa(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=rue(r.styles.textAlign),Ge=rb(r),te=0,r.styles.textAlign){case 1:te+=Ge.width/2;break;case 2:te+=Ge.width;break}he=Ge.add(te,0,0,-Ge.height/2+1),this.ctx.save(),this.path([new tr(Ge.left,Ge.top),new tr(Ge.left+Ge.width,Ge.top),new tr(Ge.left+Ge.width,Ge.top+Ge.height),new tr(Ge.left,Ge.top+Ge.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new l0(r.value,he),o.letterSpacing,J),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ea(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(ue=r.styles.listStyleImage,ue.type!==0)return[3,18];fe=void 0,ve=ue.url,He.label=15;case 15:return He.trys.push([15,17,,18]),[4,this.context.cache.match(ve)];case 16:return fe=He.sent(),this.ctx.drawImage(fe,r.bounds.left-(fe.width+10),r.bounds.top),[3,18];case 17:return He.sent(),this.context.logger.error("Error loading list-style-image "+ve),[3,18];case 18:return[3,20];case 19:t.listValue&&r.styles.listStyleType!==-1&&(Se=this.createFontStyle(o)[0],this.ctx.font=Se,this.ctx.fillStyle=qa(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",Ge=new FA(r.bounds.left,r.bounds.top+Hs(r.styles.paddingTop,r.bounds.width),r.bounds.width,vR(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new l0(t.listValue,Ge),o.letterSpacing,vR(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),He.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return lc(this,void 0,void 0,function(){var r,n,ue,o,l,ue,s,g,ue,b,S,ue,F,D,ue,N,J,ue,te,he,ue;return kl(this,function(fe){switch(fe.label){case 0:if(Ea(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:fe.sent(),r=0,n=t.negativeZIndex,fe.label=2;case 2:return r<n.length?(ue=n[r],[4,this.renderStack(ue)]):[3,5];case 3:fe.sent(),fe.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:fe.sent(),o=0,l=t.nonInlineLevel,fe.label=7;case 7:return o<l.length?(ue=l[o],[4,this.renderNode(ue)]):[3,10];case 8:fe.sent(),fe.label=9;case 9:return o++,[3,7];case 10:s=0,g=t.nonPositionedFloats,fe.label=11;case 11:return s<g.length?(ue=g[s],[4,this.renderStack(ue)]):[3,14];case 12:fe.sent(),fe.label=13;case 13:return s++,[3,11];case 14:b=0,S=t.nonPositionedInlineLevel,fe.label=15;case 15:return b<S.length?(ue=S[b],[4,this.renderStack(ue)]):[3,18];case 16:fe.sent(),fe.label=17;case 17:return b++,[3,15];case 18:F=0,D=t.inlineLevel,fe.label=19;case 19:return F<D.length?(ue=D[F],[4,this.renderNode(ue)]):[3,22];case 20:fe.sent(),fe.label=21;case 21:return F++,[3,19];case 22:N=0,J=t.zeroOrAutoZIndexOrTransformedOrOpacity,fe.label=23;case 23:return N<J.length?(ue=J[N],[4,this.renderStack(ue)]):[3,26];case 24:fe.sent(),fe.label=25;case 25:return N++,[3,23];case 26:te=0,he=t.positiveZIndex,fe.label=27;case 27:return te<he.length?(ue=he[te],[4,this.renderStack(ue)]):[3,30];case 28:fe.sent(),fe.label=29;case 29:return te++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var r=this;t.forEach(function(n,o){var l=Pu(n)?n.start:n;o===0?r.ctx.moveTo(l.x,l.y):r.ctx.lineTo(l.x,l.y),Pu(n)&&r.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(t,r,n,o){this.path(t),this.ctx.fillStyle=r,this.ctx.translate(n,o),this.ctx.fill(),this.ctx.translate(-n,-o)},e.prototype.resizeImage=function(t,r,n){var o;if(t.width===r&&t.height===n)return t;var l=(o=this.canvas.ownerDocument)!==null&&o!==void 0?o:document,s=l.createElement("canvas");s.width=Math.max(1,r),s.height=Math.max(1,n);var g=s.getContext("2d");return g.drawImage(t,0,0,t.width,t.height,0,0,r,n),s},e.prototype.renderBackgroundImage=function(t){return lc(this,void 0,void 0,function(){var r,n,o,l,s,g;return kl(this,function(b){switch(b.label){case 0:r=t.styles.backgroundImage.length-1,n=function(S){var F,D,N,rt,Et,Mt,Je,Xe,Ne,J,rt,Et,Mt,Je,Xe,te,he,ue,fe,ve,Se,Ge,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct,Et,Mt,vt,Dt,Pt,Xt,Te,Ze,tt,dt;return kl(this,function(pt){switch(pt.label){case 0:if(S.type!==0)return[3,5];F=void 0,D=S.url,pt.label=1;case 1:return pt.trys.push([1,3,,4]),[4,o.context.cache.match(D)];case 2:return F=pt.sent(),[3,4];case 3:return pt.sent(),o.context.logger.error("Error loading background-image "+D),[3,4];case 4:return F&&(N=RE(t,r,[F.width,F.height,F.width/F.height]),rt=N[0],Et=N[1],Mt=N[2],Je=N[3],Xe=N[4],Ne=o.ctx.createPattern(o.resizeImage(F,Je,Xe),"repeat"),o.renderRepeat(rt,Ne,Et,Mt)),[3,6];case 5:zoe(S)?(J=RE(t,r,[null,null,null]),rt=J[0],Et=J[1],Mt=J[2],Je=J[3],Xe=J[4],te=Roe(S.angle,Je,Xe),he=te[0],ue=te[1],fe=te[2],ve=te[3],Se=te[4],Ge=document.createElement("canvas"),Ge.width=Je,Ge.height=Xe,He=Ge.getContext("2d"),$e=He.createLinearGradient(ue,ve,fe,Se),cR(S.stops,he).forEach(function(Bt){return $e.addColorStop(Bt.stop,qa(Bt.color))}),He.fillStyle=$e,He.fillRect(0,0,Je,Xe),Je>0&&Xe>0&&(Ne=o.ctx.createPattern(Ge,"repeat"),o.renderRepeat(rt,Ne,Et,Mt))):Qoe(S)&&(at=RE(t,r,[null,null,null]),rt=at[0],Re=at[1],Pe=at[2],Je=at[3],Xe=at[4],Ct=S.position.length===0?[lE]:S.position,Et=Hs(Ct[0],Je),Mt=Hs(Ct[Ct.length-1],Xe),vt=koe(S,Et,Mt,Je,Xe),Dt=vt[0],Pt=vt[1],Dt>0&&Pt>0&&(Xt=o.ctx.createRadialGradient(Re+Et,Pe+Mt,0,Re+Et,Pe+Mt,Dt),cR(S.stops,Dt*2).forEach(function(Bt){return Xt.addColorStop(Bt.stop,qa(Bt.color))}),o.path(rt),o.ctx.fillStyle=Xt,Dt!==Pt?(Te=t.bounds.left+.5*t.bounds.width,Ze=t.bounds.top+.5*t.bounds.height,tt=Pt/Dt,dt=1/tt,o.ctx.save(),o.ctx.translate(Te,Ze),o.ctx.transform(1,0,0,tt,0,0),o.ctx.translate(-Te,-Ze),o.ctx.fillRect(Re,dt*(Pe-Ze)+Ze,Je,Xe*dt),o.ctx.restore()):o.ctx.fill())),pt.label=6;case 6:return r--,[2]}})},o=this,l=0,s=t.styles.backgroundImage.slice(0).reverse(),b.label=1;case 1:return l<s.length?(g=s[l],[5,n(g)]):[3,4];case 2:b.sent(),b.label=3;case 3:return l++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,r,n){return lc(this,void 0,void 0,function(){return kl(this,function(o){return this.path(_k(n,r)),this.ctx.fillStyle=qa(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,r,n,o){return lc(this,void 0,void 0,function(){var l,s;return kl(this,function(g){switch(g.label){case 0:return r<3?[4,this.renderSolidBorder(t,n,o)]:[3,2];case 1:return g.sent(),[2];case 2:return l=Gce(o,n),this.path(l),this.ctx.fillStyle=qa(t),this.ctx.fill(),s=jce(o,n),this.path(s),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return lc(this,void 0,void 0,function(){var r,n,o,l,s,g,b,S,F=this;return kl(this,function(D){switch(D.label){case 0:return this.applyEffects(t.getEffects(2)),r=t.container.styles,n=!Sd(r.backgroundColor)||r.backgroundImage.length,o=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],l=iue($g(r.backgroundClip,0),t.curves),n||r.boxShadow.length?(this.ctx.save(),this.path(l),this.ctx.clip(),Sd(r.backgroundColor)||(this.ctx.fillStyle=qa(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:D.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(N){F.ctx.save();var J=Yv(t.curves),te=N.inset?0:Yce,he=Vce(J,-te+(N.inset?1:-1)*N.spread.number,(N.inset?1:-1)*N.spread.number,N.spread.number*(N.inset?-2:2),N.spread.number*(N.inset?-2:2));N.inset?(F.path(J),F.ctx.clip(),F.mask(he)):(F.mask(J),F.ctx.clip(),F.path(he)),F.ctx.shadowOffsetX=N.offsetX.number+te,F.ctx.shadowOffsetY=N.offsetY.number,F.ctx.shadowColor=qa(N.color),F.ctx.shadowBlur=N.blur.number,F.ctx.fillStyle=N.inset?qa(N.color):"rgba(0,0,0,1)",F.ctx.fill(),F.ctx.restore()}),D.label=2;case 2:s=0,g=0,b=o,D.label=3;case 3:return g<b.length?(S=b[g],S.style!==0&&!Sd(S.color)&&S.width>0?S.style!==2?[3,5]:[4,this.renderDashedDottedBorder(S.color,S.width,s,t.curves,2)]:[3,11]):[3,13];case 4:return D.sent(),[3,11];case 5:return S.style!==3?[3,7]:[4,this.renderDashedDottedBorder(S.color,S.width,s,t.curves,3)];case 6:return D.sent(),[3,11];case 7:return S.style!==4?[3,9]:[4,this.renderDoubleBorder(S.color,S.width,s,t.curves)];case 8:return D.sent(),[3,11];case 9:return[4,this.renderSolidBorder(S.color,s,t.curves)];case 10:D.sent(),D.label=11;case 11:s++,D.label=12;case 12:return g++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,r,n,o,l){return lc(this,void 0,void 0,function(){var s,g,b,S,F,D,N,J,te,he,ue,fe,ve,Se,Ge,He,Ge,He;return kl(this,function($e){return this.ctx.save(),s=qce(o,n),g=_k(o,n),l===2&&(this.path(g),this.ctx.clip()),Pu(g[0])?(b=g[0].start.x,S=g[0].start.y):(b=g[0].x,S=g[0].y),Pu(g[1])?(F=g[1].end.x,D=g[1].end.y):(F=g[1].x,D=g[1].y),n===0||n===2?N=Math.abs(b-F):N=Math.abs(S-D),this.ctx.beginPath(),l===3?this.formatPath(s):this.formatPath(g.slice(0,2)),J=r<3?r*3:r*2,te=r<3?r*2:r,l===3&&(J=r,te=r),he=!0,N<=J*2?he=!1:N<=J*2+te?(ue=N/(2*J+te),J*=ue,te*=ue):(fe=Math.floor((N+te)/(J+te)),ve=(N-fe*J)/(fe-1),Se=(N-(fe+1)*J)/fe,te=Se<=0||Math.abs(te-ve)<Math.abs(te-Se)?ve:Se),he&&(l===3?this.ctx.setLineDash([0,J+te]):this.ctx.setLineDash([J,te])),l===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=qa(t),this.ctx.stroke(),this.ctx.setLineDash([]),l===2&&(Pu(g[0])&&(Ge=g[3],He=g[0],this.ctx.beginPath(),this.formatPath([new tr(Ge.end.x,Ge.end.y),new tr(He.start.x,He.start.y)]),this.ctx.stroke()),Pu(g[1])&&(Ge=g[1],He=g[2],this.ctx.beginPath(),this.formatPath([new tr(Ge.end.x,Ge.end.y),new tr(He.start.x,He.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return lc(this,void 0,void 0,function(){var r;return kl(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=qa(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=Hce(t),[4,this.renderStack(r)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(xk),tue=function(i){return i instanceof qR||i instanceof jR?!0:i instanceof BE&&i.type!==$v&&i.type!==qv},iue=function(i,e){switch(i){case 0:return Yv(e);case 2:return Oce(e);case 1:default:return eb(e)}},rue=function(i){switch(i){case 1:return"center";case 2:return"right";case 0:default:return"left"}},nue=["-apple-system","system-ui"],sue=function(i){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?i.filter(function(e){return nue.indexOf(e)===-1}):i},oue=function(i){Ah(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return e.prototype.render=function(t){return lc(this,void 0,void 0,function(){var r,n;return kl(this,function(o){switch(o.label){case 0:return r=bE(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,aue(r)];case 1:return n=o.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=qa(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(xk),aue=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},lue=function(){function i(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.getTime=function(){return Date.now()-this.start},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Av([this.id,this.getTime()+"ms"],e))},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Av([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.instances={},i}(),cue=function(){function i(e,t){var r;this.windowBounds=t,this.instanceName="#"+i.instanceCount++,this.logger=new lue({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new Ice(this,e)}return i.instanceCount=1,i}(),uue=function(i,e){return e===void 0&&(e={}),hue(i,e)};typeof window<"u"&&dk.setContext(window);var hue=function(i,e){return lc(void 0,void 0,void 0,function(){var t,r,n,o,l,s,g,b,S,F,D,N,J,te,he,ue,fe,ve,Se,Ge,$e,He,$e,Ne,at,rt,Re,Pe,Je,Xe,Ct,Et,Mt,vt,Dt,Pt,Xt,Te,Ze,tt;return kl(this,function(dt){switch(dt.label){case 0:if(!i||typeof i!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=i.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(r=t.defaultView,!r)throw new Error("Document is not attached to a Window");return n={allowTaint:(Ne=e.allowTaint)!==null&&Ne!==void 0?Ne:!1,imageTimeout:(at=e.imageTimeout)!==null&&at!==void 0?at:15e3,proxy:e.proxy,useCORS:(rt=e.useCORS)!==null&&rt!==void 0?rt:!1},o=QC({logging:(Re=e.logging)!==null&&Re!==void 0?Re:!0,cache:e.cache},n),l={windowWidth:(Pe=e.windowWidth)!==null&&Pe!==void 0?Pe:r.innerWidth,windowHeight:(Je=e.windowHeight)!==null&&Je!==void 0?Je:r.innerHeight,scrollX:(Xe=e.scrollX)!==null&&Xe!==void 0?Xe:r.pageXOffset,scrollY:(Ct=e.scrollY)!==null&&Ct!==void 0?Ct:r.pageYOffset},s=new FA(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),g=new cue(o,s),b=(Et=e.foreignObjectRendering)!==null&&Et!==void 0?Et:!1,S={allowTaint:(Mt=e.allowTaint)!==null&&Mt!==void 0?Mt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:b,copyStyles:b},g.logger.debug("Starting document clone with size "+s.width+"x"+s.height+" scrolled to "+-s.left+","+-s.top),F=new hk(g,i,S),D=F.clonedReferenceElement,D?[4,F.toIFrame(t,s)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return N=dt.sent(),J=EE(D)||Ace(D)?Vne(D.ownerDocument):dv(g,D),te=J.width,he=J.height,ue=J.left,fe=J.top,ve=Aue(g,D,e.backgroundColor),Se={canvas:e.canvas,backgroundColor:ve,scale:(Dt=(vt=e.scale)!==null&&vt!==void 0?vt:r.devicePixelRatio)!==null&&Dt!==void 0?Dt:1,x:((Pt=e.x)!==null&&Pt!==void 0?Pt:0)+ue,y:((Xt=e.y)!==null&&Xt!==void 0?Xt:0)+fe,width:(Te=e.width)!==null&&Te!==void 0?Te:Math.ceil(te),height:(Ze=e.height)!==null&&Ze!==void 0?Ze:Math.ceil(he)},b?(g.logger.debug("Document cloned, using foreign object rendering"),$e=new oue(g,Se),[4,$e.render(D)]):[3,3];case 2:return Ge=dt.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+ue+","+fe+" with size "+te+"x"+he+" using computed rendering"),g.logger.debug("Starting DOM parsing"),He=WR(g,D),ve===He.styles.backgroundColor&&(He.styles.backgroundColor=RA.TRANSPARENT),g.logger.debug("Starting renderer for element at "+Se.x+","+Se.y+" with size "+Se.width+"x"+Se.height),$e=new eue(g,Se),[4,$e.render(He)];case 4:Ge=dt.sent(),dt.label=5;case 5:return(!((tt=e.removeContainer)!==null&&tt!==void 0)||tt)&&(hk.destroy(N)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),g.logger.debug("Finished rendering"),[2,Ge]}})})},Aue=function(i,e,t){var r=e.ownerDocument,n=r.documentElement?s0(i,getComputedStyle(r.documentElement).backgroundColor):RA.TRANSPARENT,o=r.body?s0(i,getComputedStyle(r.body).backgroundColor):RA.TRANSPARENT,l=typeof t=="string"?s0(i,t):t===null?RA.TRANSPARENT:4294967295;return e===r.documentElement?Sd(n)?Sd(o)?l:o:n:l};const due=Object.freeze(Object.defineProperty({__proto__:null,default:uue},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function Md(i){"@babel/helpers - typeof";return Md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Md(i)}function kE(i,e){return kE=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},kE(i,e)}function fue(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function sb(i,e,t){return fue()?sb=Reflect.construct:sb=function(r,n,o){var l=[null];l.push.apply(l,n);var s=Function.bind.apply(r,l),g=new s;return o&&kE(g,o.prototype),g},sb.apply(null,arguments)}function fh(i){return pue(i)||gue(i)||mue(i)||yue()}function pue(i){if(Array.isArray(i))return OE(i)}function gue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function mue(i,e){if(i){if(typeof i=="string")return OE(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OE(i,e)}}function OE(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function yue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _ue=Object.hasOwnProperty,wk=Object.setPrototypeOf,vue=Object.isFrozen,bue=Object.getPrototypeOf,xue=Object.getOwnPropertyDescriptor,hc=Object.freeze,ph=Object.seal,wue=Object.create,Bk=typeof Reflect<"u"&&Reflect,ob=Bk.apply,UE=Bk.construct;ob||(ob=function(i,e,t){return i.apply(e,t)}),hc||(hc=function(i){return i}),ph||(ph=function(i){return i}),UE||(UE=function(i,e){return sb(i,fh(e))});var Bue=Du(Array.prototype.forEach),Ck=Du(Array.prototype.pop),A0=Du(Array.prototype.push),ab=Du(String.prototype.toLowerCase),NE=Du(String.prototype.toString),Cue=Du(String.prototype.match),gh=Du(String.prototype.replace),Eue=Du(String.prototype.indexOf),Sue=Du(String.prototype.trim),Ac=Du(RegExp.prototype.test),zE=Tue(TypeError);function Du(i){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ob(i,e,r)}}function Tue(i){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return UE(i,t)}}function sn(i,e,t){t=t||ab,wk&&wk(i,null);for(var r=e.length;r--;){var n=e[r];if(typeof n=="string"){var o=t(n);o!==n&&(vue(e)||(e[r]=o),n=o)}i[n]=!0}return i}function Uf(i){var e=wue(null),t;for(t in i)ob(_ue,i,[t])===!0&&(e[t]=i[t]);return e}function lb(i,e){for(;i!==null;){var t=xue(i,e);if(t){if(t.get)return Du(t.get);if(typeof t.value=="function")return Du(t.value)}i=bue(i)}function r(n){return console.warn("fallback value for",n),null}return r}var Ek=hc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),QE=hc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),VE=hc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Iue=hc(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),HE=hc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),Lue=hc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Sk=hc(["#text"]),Tk=hc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),GE=hc(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ik=hc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),cb=hc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Mue=ph(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Pue=ph(/<%[\w\W]*|[\w\W]*%>/gm),Fue=ph(/\${[\w\W]*}/gm),Due=ph(/^data-[\-\w.\u00B7-\uFFFF]/),Rue=ph(/^aria-[\-\w]+$/),kue=ph(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Oue=ph(/^(?:\w+script|data):/i),Uue=ph(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Nue=ph(/^html$/i),zue=function(){return typeof window>"u"?null:window},Que=function(i,e){if(Md(i)!=="object"||typeof i.createPolicy!="function")return null;var t=null,r="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(r)&&(t=e.currentScript.getAttribute(r));var n="dompurify"+(t?"#"+t:"");try{return i.createPolicy(n,{createHTML:function(o){return o},createScriptURL:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}};function Lk(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zue(),e=function(ot){return Lk(ot)};if(e.version="2.4.5",e.removed=[],!i||!i.document||i.document.nodeType!==9)return e.isSupported=!1,e;var t=i.document,r=i.document,n=i.DocumentFragment,o=i.HTMLTemplateElement,l=i.Node,s=i.Element,g=i.NodeFilter,b=i.NamedNodeMap,S=b===void 0?i.NamedNodeMap||i.MozNamedAttrMap:b,F=i.HTMLFormElement,D=i.DOMParser,N=i.trustedTypes,J=s.prototype,te=lb(J,"cloneNode"),he=lb(J,"nextSibling"),ue=lb(J,"childNodes"),fe=lb(J,"parentNode");if(typeof o=="function"){var ve=r.createElement("template");ve.content&&ve.content.ownerDocument&&(r=ve.content.ownerDocument)}var Se=Que(N,t),Ge=Se?Se.createHTML(""):"",He=r,$e=He.implementation,Ne=He.createNodeIterator,at=He.createDocumentFragment,rt=He.getElementsByTagName,Re=t.importNode,Pe={};try{Pe=Uf(r).documentMode?r.documentMode:{}}catch{}var Je={};e.isSupported=typeof fe=="function"&&$e&&typeof $e.createHTMLDocument<"u"&&Pe!==9;var Xe=Mue,Ct=Pue,Et=Fue,Mt=Due,vt=Rue,Dt=Oue,Pt=Uue,Xt=kue,Te=null,Ze=sn({},[].concat(fh(Ek),fh(QE),fh(VE),fh(HE),fh(Sk))),tt=null,dt=sn({},[].concat(fh(Tk),fh(GE),fh(Ik),fh(cb))),pt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Bt=null,Ft=null,Lt=!0,Gt=!0,ri=!1,mi=!0,yi=!1,Pi=!1,Ot=!1,lt=!1,wt=!1,ki=!1,ti=!1,ht=!0,qt=!1,si="user-content-",fi=!0,ci=!1,Wi={},ir=null,dr=sn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Sr=null,zt=sn({},["audio","video","img","source","image","track"]),Yi=null,ui=sn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Kt="http://www.w3.org/1998/Math/MathML",Ji="http://www.w3.org/2000/svg",Vt="http://www.w3.org/1999/xhtml",Ci=Vt,Li=!1,jt=null,bi=sn({},[Kt,Ji,Vt],NE),Yt,yr=["application/xhtml+xml","text/html"],Tr="text/html",Qe,Be=null,ae=r.createElement("form"),ie=function(ot){return ot instanceof RegExp||ot instanceof Function},ce=function(ot){Be&&Be===ot||((!ot||Md(ot)!=="object")&&(ot={}),ot=Uf(ot),Yt=yr.indexOf(ot.PARSER_MEDIA_TYPE)===-1?Yt=Tr:Yt=ot.PARSER_MEDIA_TYPE,Qe=Yt==="application/xhtml+xml"?NE:ab,Te="ALLOWED_TAGS"in ot?sn({},ot.ALLOWED_TAGS,Qe):Ze,tt="ALLOWED_ATTR"in ot?sn({},ot.ALLOWED_ATTR,Qe):dt,jt="ALLOWED_NAMESPACES"in ot?sn({},ot.ALLOWED_NAMESPACES,NE):bi,Yi="ADD_URI_SAFE_ATTR"in ot?sn(Uf(ui),ot.ADD_URI_SAFE_ATTR,Qe):ui,Sr="ADD_DATA_URI_TAGS"in ot?sn(Uf(zt),ot.ADD_DATA_URI_TAGS,Qe):zt,ir="FORBID_CONTENTS"in ot?sn({},ot.FORBID_CONTENTS,Qe):dr,Bt="FORBID_TAGS"in ot?sn({},ot.FORBID_TAGS,Qe):{},Ft="FORBID_ATTR"in ot?sn({},ot.FORBID_ATTR,Qe):{},Wi="USE_PROFILES"in ot?ot.USE_PROFILES:!1,Lt=ot.ALLOW_ARIA_ATTR!==!1,Gt=ot.ALLOW_DATA_ATTR!==!1,ri=ot.ALLOW_UNKNOWN_PROTOCOLS||!1,mi=ot.ALLOW_SELF_CLOSE_IN_ATTR!==!1,yi=ot.SAFE_FOR_TEMPLATES||!1,Pi=ot.WHOLE_DOCUMENT||!1,wt=ot.RETURN_DOM||!1,ki=ot.RETURN_DOM_FRAGMENT||!1,ti=ot.RETURN_TRUSTED_TYPE||!1,lt=ot.FORCE_BODY||!1,ht=ot.SANITIZE_DOM!==!1,qt=ot.SANITIZE_NAMED_PROPS||!1,fi=ot.KEEP_CONTENT!==!1,ci=ot.IN_PLACE||!1,Xt=ot.ALLOWED_URI_REGEXP||Xt,Ci=ot.NAMESPACE||Vt,pt=ot.CUSTOM_ELEMENT_HANDLING||{},ot.CUSTOM_ELEMENT_HANDLING&&ie(ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(pt.tagNameCheck=ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&ie(ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(pt.attributeNameCheck=ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&typeof ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(pt.allowCustomizedBuiltInElements=ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),yi&&(Gt=!1),ki&&(wt=!0),Wi&&(Te=sn({},fh(Sk)),tt=[],Wi.html===!0&&(sn(Te,Ek),sn(tt,Tk)),Wi.svg===!0&&(sn(Te,QE),sn(tt,GE),sn(tt,cb)),Wi.svgFilters===!0&&(sn(Te,VE),sn(tt,GE),sn(tt,cb)),Wi.mathMl===!0&&(sn(Te,HE),sn(tt,Ik),sn(tt,cb))),ot.ADD_TAGS&&(Te===Ze&&(Te=Uf(Te)),sn(Te,ot.ADD_TAGS,Qe)),ot.ADD_ATTR&&(tt===dt&&(tt=Uf(tt)),sn(tt,ot.ADD_ATTR,Qe)),ot.ADD_URI_SAFE_ATTR&&sn(Yi,ot.ADD_URI_SAFE_ATTR,Qe),ot.FORBID_CONTENTS&&(ir===dr&&(ir=Uf(ir)),sn(ir,ot.FORBID_CONTENTS,Qe)),fi&&(Te["#text"]=!0),Pi&&sn(Te,["html","head","body"]),Te.table&&(sn(Te,["tbody"]),delete Bt.tbody),hc&&hc(ot),Be=ot)},me=sn({},["mi","mo","mn","ms","mtext"]),be=sn({},["foreignobject","desc","title","annotation-xml"]),Ee=sn({},["title","style","font","a","script"]),xe=sn({},QE);sn(xe,VE),sn(xe,Iue);var Fe=sn({},HE);sn(Fe,Lue);var Ue=function(ot){var ii=fe(ot);(!ii||!ii.tagName)&&(ii={namespaceURI:Ci,tagName:"template"});var Qt=ab(ot.tagName),Qi=ab(ii.tagName);return jt[ot.namespaceURI]?ot.namespaceURI===Ji?ii.namespaceURI===Vt?Qt==="svg":ii.namespaceURI===Kt?Qt==="svg"&&(Qi==="annotation-xml"||me[Qi]):!!xe[Qt]:ot.namespaceURI===Kt?ii.namespaceURI===Vt?Qt==="math":ii.namespaceURI===Ji?Qt==="math"&&be[Qi]:!!Fe[Qt]:ot.namespaceURI===Vt?ii.namespaceURI===Ji&&!be[Qi]||ii.namespaceURI===Kt&&!me[Qi]?!1:!Fe[Qt]&&(Ee[Qt]||!xe[Qt]):!!(Yt==="application/xhtml+xml"&&jt[ot.namespaceURI]):!1},je=function(ot){A0(e.removed,{element:ot});try{ot.parentNode.removeChild(ot)}catch{try{ot.outerHTML=Ge}catch{ot.remove()}}},nt=function(ot,ii){try{A0(e.removed,{attribute:ii.getAttributeNode(ot),from:ii})}catch{A0(e.removed,{attribute:null,from:ii})}if(ii.removeAttribute(ot),ot==="is"&&!tt[ot])if(wt||ki)try{je(ii)}catch{}else try{ii.setAttribute(ot,"")}catch{}},_t=function(ot){var ii,Qt;if(lt)ot="<remove></remove>"+ot;else{var Qi=Cue(ot,/^[\r\n\t ]+/);Qt=Qi&&Qi[0]}Yt==="application/xhtml+xml"&&Ci===Vt&&(ot='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ot+"</body></html>");var Ar=Se?Se.createHTML(ot):ot;if(Ci===Vt)try{ii=new D().parseFromString(Ar,Yt)}catch{}if(!ii||!ii.documentElement){ii=$e.createDocument(Ci,"template",null);try{ii.documentElement.innerHTML=Li?Ge:Ar}catch{}}var on=ii.body||ii.documentElement;return ot&&Qt&&on.insertBefore(r.createTextNode(Qt),on.childNodes[0]||null),Ci===Vt?rt.call(ii,Pi?"html":"body")[0]:Pi?ii.documentElement:on},St=function(ot){return Ne.call(ot.ownerDocument||ot,ot,g.SHOW_ELEMENT|g.SHOW_COMMENT|g.SHOW_TEXT,null,!1)},ei=function(ot){return ot instanceof F&&(typeof ot.nodeName!="string"||typeof ot.textContent!="string"||typeof ot.removeChild!="function"||!(ot.attributes instanceof S)||typeof ot.removeAttribute!="function"||typeof ot.setAttribute!="function"||typeof ot.namespaceURI!="string"||typeof ot.insertBefore!="function"||typeof ot.hasChildNodes!="function")},$t=function(ot){return Md(l)==="object"?ot instanceof l:ot&&Md(ot)==="object"&&typeof ot.nodeType=="number"&&typeof ot.nodeName=="string"},Wt=function(ot,ii,Qt){Je[ot]&&Bue(Je[ot],function(Qi){Qi.call(e,ii,Qt,Be)})},oi=function(ot){var ii;if(Wt("beforeSanitizeElements",ot,null),ei(ot)||Ac(/[\u0080-\uFFFF]/,ot.nodeName))return je(ot),!0;var Qt=Qe(ot.nodeName);if(Wt("uponSanitizeElement",ot,{tagName:Qt,allowedTags:Te}),ot.hasChildNodes()&&!$t(ot.firstElementChild)&&(!$t(ot.content)||!$t(ot.content.firstElementChild))&&Ac(/<[/\w]/g,ot.innerHTML)&&Ac(/<[/\w]/g,ot.textContent)||Qt==="select"&&Ac(/<template/i,ot.innerHTML))return je(ot),!0;if(!Te[Qt]||Bt[Qt]){if(!Bt[Qt]&&Gi(Qt)&&(pt.tagNameCheck instanceof RegExp&&Ac(pt.tagNameCheck,Qt)||pt.tagNameCheck instanceof Function&&pt.tagNameCheck(Qt)))return!1;if(fi&&!ir[Qt]){var Qi=fe(ot)||ot.parentNode,Ar=ue(ot)||ot.childNodes;if(Ar&&Qi)for(var on=Ar.length,xn=on-1;xn>=0;--xn)Qi.insertBefore(te(Ar[xn],!0),he(ot))}return je(ot),!0}return ot instanceof s&&!Ue(ot)||(Qt==="noscript"||Qt==="noembed")&&Ac(/<\/no(script|embed)/i,ot.innerHTML)?(je(ot),!0):(yi&&ot.nodeType===3&&(ii=ot.textContent,ii=gh(ii,Xe," "),ii=gh(ii,Ct," "),ii=gh(ii,Et," "),ot.textContent!==ii&&(A0(e.removed,{element:ot.cloneNode()}),ot.textContent=ii)),Wt("afterSanitizeElements",ot,null),!1)},Ei=function(ot,ii,Qt){if(ht&&(ii==="id"||ii==="name")&&(Qt in r||Qt in ae))return!1;if(!(Gt&&!Ft[ii]&&Ac(Mt,ii))&&!(Lt&&Ac(vt,ii))){if(!tt[ii]||Ft[ii]){if(!(Gi(ot)&&(pt.tagNameCheck instanceof RegExp&&Ac(pt.tagNameCheck,ot)||pt.tagNameCheck instanceof Function&&pt.tagNameCheck(ot))&&(pt.attributeNameCheck instanceof RegExp&&Ac(pt.attributeNameCheck,ii)||pt.attributeNameCheck instanceof Function&&pt.attributeNameCheck(ii))||ii==="is"&&pt.allowCustomizedBuiltInElements&&(pt.tagNameCheck instanceof RegExp&&Ac(pt.tagNameCheck,Qt)||pt.tagNameCheck instanceof Function&&pt.tagNameCheck(Qt))))return!1}else if(!Yi[ii]&&!Ac(Xt,gh(Qt,Pt,""))&&!((ii==="src"||ii==="xlink:href"||ii==="href")&&ot!=="script"&&Eue(Qt,"data:")===0&&Sr[ot])&&!(ri&&!Ac(Dt,gh(Qt,Pt,"")))&&Qt)return!1}return!0},Gi=function(ot){return ot.indexOf("-")>0},Bi=function(ot){var ii,Qt,Qi,Ar;Wt("beforeSanitizeAttributes",ot,null);var on=ot.attributes;if(on){var xn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:tt};for(Ar=on.length;Ar--;){ii=on[Ar];var hr=ii,mn=hr.name,yn=hr.namespaceURI;if(Qt=mn==="value"?ii.value:Sue(ii.value),Qi=Qe(mn),xn.attrName=Qi,xn.attrValue=Qt,xn.keepAttr=!0,xn.forceKeepAttr=void 0,Wt("uponSanitizeAttribute",ot,xn),Qt=xn.attrValue,!xn.forceKeepAttr&&(nt(mn,ot),!!xn.keepAttr)){if(!mi&&Ac(/\/>/i,Qt)){nt(mn,ot);continue}yi&&(Qt=gh(Qt,Xe," "),Qt=gh(Qt,Ct," "),Qt=gh(Qt,Et," "));var cr=Qe(ot.nodeName);if(Ei(cr,Qi,Qt)){if(qt&&(Qi==="id"||Qi==="name")&&(nt(mn,ot),Qt=si+Qt),Se&&Md(N)==="object"&&typeof N.getAttributeType=="function"&&!yn)switch(N.getAttributeType(cr,Qi)){case"TrustedHTML":Qt=Se.createHTML(Qt);break;case"TrustedScriptURL":Qt=Se.createScriptURL(Qt);break}try{yn?ot.setAttributeNS(yn,mn,Qt):ot.setAttribute(mn,Qt),Ck(e.removed)}catch{}}}}Wt("afterSanitizeAttributes",ot,null)}},Ni=function ot(ii){var Qt,Qi=St(ii);for(Wt("beforeSanitizeShadowDOM",ii,null);Qt=Qi.nextNode();)Wt("uponSanitizeShadowNode",Qt,null),!oi(Qt)&&(Qt.content instanceof n&&ot(Qt.content),Bi(Qt));Wt("afterSanitizeShadowDOM",ii,null)};return e.sanitize=function(ot){var ii=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Qt,Qi,Ar,on,xn;if(Li=!ot,Li&&(ot="<!-->"),typeof ot!="string"&&!$t(ot)){if(typeof ot.toString!="function")throw zE("toString is not a function");if(ot=ot.toString(),typeof ot!="string")throw zE("dirty is not a string, aborting")}if(!e.isSupported){if(Md(i.toStaticHTML)==="object"||typeof i.toStaticHTML=="function"){if(typeof ot=="string")return i.toStaticHTML(ot);if($t(ot))return i.toStaticHTML(ot.outerHTML)}return ot}if(Ot||ce(ii),e.removed=[],typeof ot=="string"&&(ci=!1),ci){if(ot.nodeName){var hr=Qe(ot.nodeName);if(!Te[hr]||Bt[hr])throw zE("root node is forbidden and cannot be sanitized in-place")}}else if(ot instanceof l)Qt=_t("<!---->"),Qi=Qt.ownerDocument.importNode(ot,!0),Qi.nodeType===1&&Qi.nodeName==="BODY"||Qi.nodeName==="HTML"?Qt=Qi:Qt.appendChild(Qi);else{if(!wt&&!yi&&!Pi&&ot.indexOf("<")===-1)return Se&&ti?Se.createHTML(ot):ot;if(Qt=_t(ot),!Qt)return wt?null:ti?Ge:""}Qt&&lt&&je(Qt.firstChild);for(var mn=St(ci?ot:Qt);Ar=mn.nextNode();)Ar.nodeType===3&&Ar===on||oi(Ar)||(Ar.content instanceof n&&Ni(Ar.content),Bi(Ar),on=Ar);if(on=null,ci)return ot;if(wt){if(ki)for(xn=at.call(Qt.ownerDocument);Qt.firstChild;)xn.appendChild(Qt.firstChild);else xn=Qt;return(tt.shadowroot||tt.shadowrootmod)&&(xn=Re.call(t,xn,!0)),xn}var yn=Pi?Qt.outerHTML:Qt.innerHTML;return Pi&&Te["!doctype"]&&Qt.ownerDocument&&Qt.ownerDocument.doctype&&Qt.ownerDocument.doctype.name&&Ac(Nue,Qt.ownerDocument.doctype.name)&&(yn="<!DOCTYPE "+Qt.ownerDocument.doctype.name+`>
`+yn),yi&&(yn=gh(yn,Xe," "),yn=gh(yn,Ct," "),yn=gh(yn,Et," ")),Se&&ti?Se.createHTML(yn):yn},e.setConfig=function(ot){ce(ot),Ot=!0},e.clearConfig=function(){Be=null,Ot=!1},e.isValidAttribute=function(ot,ii,Qt){Be||ce({});var Qi=Qe(ot),Ar=Qe(ii);return Ei(Qi,Ar,Qt)},e.addHook=function(ot,ii){typeof ii=="function"&&(Je[ot]=Je[ot]||[],A0(Je[ot],ii))},e.removeHook=function(ot){if(Je[ot])return Ck(Je[ot])},e.removeHooks=function(ot){Je[ot]&&(Je[ot]=[])},e.removeAllHooks=function(){Je={}},e}var Vue=Lk();const Hue=Object.freeze(Object.defineProperty({__proto__:null,default:Vue},Symbol.toStringTag,{value:"Module"}));var d0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mk(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ub=function(i){return i&&i.Math==Math&&i},Sa=ub(typeof globalThis=="object"&&globalThis)||ub(typeof window=="object"&&window)||ub(typeof self=="object"&&self)||ub(typeof d0=="object"&&d0)||function(){return this}()||d0||Function("return this")(),Kg={},Ko=function(i){try{return!!i()}catch{return!0}},Gue=Ko,eA=!Gue(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),jue=Ko,hb=!jue(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")}),que=hb,Ab=Function.prototype.call,cl=que?Ab.bind(Ab):function(){return Ab.apply(Ab,arguments)},Pk={},Fk={}.propertyIsEnumerable,Dk=Object.getOwnPropertyDescriptor,$ue=Dk&&!Fk.call({1:2},1);Pk.f=$ue?function(i){var e=Dk(this,i);return!!e&&e.enumerable}:Fk;var db=function(i,e){return{enumerable:!(i&1),configurable:!(i&2),writable:!(i&4),value:e}},Rk=hb,kk=Function.prototype,jE=kk.call,Kue=Rk&&kk.bind.bind(jE,jE),Wo=Rk?Kue:function(i){return function(){return jE.apply(i,arguments)}},Ok=Wo,Wue=Ok({}.toString),Xue=Ok("".slice),Nf=function(i){return Xue(Wue(i),8,-1)},Zue=Wo,Jue=Ko,Yue=Nf,qE=Object,ehe=Zue("".split),Uk=Jue(function(){return!qE("z").propertyIsEnumerable(0)})?function(i){return Yue(i)=="String"?ehe(i,""):qE(i)}:qE,zf=function(i){return i==null},the=zf,ihe=TypeError,tA=function(i){if(the(i))throw ihe("Can't call method on "+i);return i},rhe=Uk,nhe=tA,f0=function(i){return rhe(nhe(i))},$E=typeof document=="object"&&document.all,she=typeof $E>"u"&&$E!==void 0,Nk={all:$E,IS_HTMLDDA:she},zk=Nk,ohe=zk.all,Eo=zk.IS_HTMLDDA?function(i){return typeof i=="function"||i===ohe}:function(i){return typeof i=="function"},Qk=Eo,Vk=Nk,ahe=Vk.all,OA=Vk.IS_HTMLDDA?function(i){return typeof i=="object"?i!==null:Qk(i)||i===ahe}:function(i){return typeof i=="object"?i!==null:Qk(i)},KE=Sa,lhe=Eo,che=function(i){return lhe(i)?i:void 0},Qf=function(i,e){return arguments.length<2?che(KE[i]):KE[i]&&KE[i][e]},uhe=Wo,fb=uhe({}.isPrototypeOf),pb=typeof navigator<"u"&&String(navigator.userAgent)||"",Hk=Sa,WE=pb,Gk=Hk.process,jk=Hk.Deno,qk=Gk&&Gk.versions||jk&&jk.version,$k=qk&&qk.v8,mh,gb;$k&&(mh=$k.split("."),gb=mh[0]>0&&mh[0]<4?1:+(mh[0]+mh[1])),!gb&&WE&&(mh=WE.match(/Edge\/(\d+)/),(!mh||mh[1]>=74)&&(mh=WE.match(/Chrome\/(\d+)/),mh&&(gb=+mh[1])));var XE=gb,Kk=XE,hhe=Ko,Ahe=Sa,dhe=Ahe.String,Wk=!!Object.getOwnPropertySymbols&&!hhe(function(){var i=Symbol();return!dhe(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&Kk&&Kk<41}),fhe=Wk,Xk=fhe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",phe=Qf,ghe=Eo,mhe=fb,yhe=Xk,_he=Object,Zk=yhe?function(i){return typeof i=="symbol"}:function(i){var e=phe("Symbol");return ghe(e)&&mhe(e.prototype,_he(i))},vhe=String,mb=function(i){try{return vhe(i)}catch{return"Object"}},bhe=Eo,xhe=mb,whe=TypeError,UA=function(i){if(bhe(i))return i;throw whe(xhe(i)+" is not a function")},Bhe=UA,Che=zf,Wg=function(i,e){var t=i[e];return Che(t)?void 0:Bhe(t)},ZE=cl,JE=Eo,YE=OA,Ehe=TypeError,She=function(i,e){var t,r;if(e==="string"&&JE(t=i.toString)&&!YE(r=ZE(t,i))||JE(t=i.valueOf)&&!YE(r=ZE(t,i))||e!=="string"&&JE(t=i.toString)&&!YE(r=ZE(t,i)))return r;throw Ehe("Can't convert object to primitive value")},Jk={exports:{}},Yk=Sa,The=Object.defineProperty,eS=function(i,e){try{The(Yk,i,{value:e,configurable:!0,writable:!0})}catch{Yk[i]=e}return e},Ihe=Sa,Lhe=eS,eO="__core-js_shared__",Mhe=Ihe[eO]||Lhe(eO,{}),tS=Mhe,tO=tS;(Jk.exports=function(i,e){return tO[i]||(tO[i]=e!==void 0?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var iS=Jk.exports,Phe=tA,Fhe=Object,yb=function(i){return Fhe(Phe(i))},Dhe=Wo,Rhe=yb,khe=Dhe({}.hasOwnProperty),yh=Object.hasOwn||function(i,e){return khe(Rhe(i),e)},Ohe=Wo,Uhe=0,Nhe=Math.random(),zhe=Ohe(1 .toString),iO=function(i){return"Symbol("+(i===void 0?"":i)+")_"+zhe(++Uhe+Nhe,36)},Qhe=Sa,Vhe=iS,rO=yh,Hhe=iO,Ghe=Wk,jhe=Xk,Xg=Qhe.Symbol,rS=Vhe("wks"),qhe=jhe?Xg.for||Xg:Xg&&Xg.withoutSetter||Hhe,$a=function(i){return rO(rS,i)||(rS[i]=Ghe&&rO(Xg,i)?Xg[i]:qhe("Symbol."+i)),rS[i]},$he=cl,nO=OA,sO=Zk,Khe=Wg,Whe=She,Xhe=$a,Zhe=TypeError,Jhe=Xhe("toPrimitive"),Yhe=function(i,e){if(!nO(i)||sO(i))return i;var t=Khe(i,Jhe),r;if(t){if(e===void 0&&(e="default"),r=$he(t,i,e),!nO(r)||sO(r))return r;throw Zhe("Can't convert object to primitive value")}return e===void 0&&(e="number"),Whe(i,e)},eAe=Yhe,tAe=Zk,nS=function(i){var e=eAe(i,"string");return tAe(e)?e:e+""},iAe=Sa,oO=OA,sS=iAe.document,rAe=oO(sS)&&oO(sS.createElement),_b=function(i){return rAe?sS.createElement(i):{}},nAe=eA,sAe=Ko,oAe=_b,aO=!nAe&&!sAe(function(){return Object.defineProperty(oAe("div"),"a",{get:function(){return 7}}).a!=7}),aAe=eA,lAe=cl,cAe=Pk,uAe=db,hAe=f0,AAe=nS,dAe=yh,fAe=aO,lO=Object.getOwnPropertyDescriptor;Kg.f=aAe?lO:function(i,e){if(i=hAe(i),e=AAe(e),fAe)try{return lO(i,e)}catch{}if(dAe(i,e))return uAe(!lAe(cAe.f,i,e),i[e])};var iA={},pAe=eA,gAe=Ko,cO=pAe&&gAe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),mAe=OA,yAe=String,_Ae=TypeError,Ol=function(i){if(mAe(i))return i;throw _Ae(yAe(i)+" is not an object")},vAe=eA,bAe=aO,xAe=cO,vb=Ol,uO=nS,wAe=TypeError,oS=Object.defineProperty,BAe=Object.getOwnPropertyDescriptor,aS="enumerable",lS="configurable",cS="writable";iA.f=vAe?xAe?function(i,e,t){if(vb(i),e=uO(e),vb(t),typeof i=="function"&&e==="prototype"&&"value"in t&&cS in t&&!t[cS]){var r=BAe(i,e);r&&r[cS]&&(i[e]=t.value,t={configurable:lS in t?t[lS]:r[lS],enumerable:aS in t?t[aS]:r[aS],writable:!1})}return oS(i,e,t)}:oS:function(i,e,t){if(vb(i),e=uO(e),vb(t),bAe)try{return oS(i,e,t)}catch{}if("get"in t||"set"in t)throw wAe("Accessors not supported");return"value"in t&&(i[e]=t.value),i};var CAe=eA,EAe=iA,SAe=db,p0=CAe?function(i,e,t){return EAe.f(i,e,SAe(1,t))}:function(i,e,t){return i[e]=t,i},hO={exports:{}},uS=eA,TAe=yh,AO=Function.prototype,IAe=uS&&Object.getOwnPropertyDescriptor,hS=TAe(AO,"name"),LAe=hS&&(function(){}).name==="something",MAe=hS&&(!uS||uS&&IAe(AO,"name").configurable),bb={EXISTS:hS,PROPER:LAe,CONFIGURABLE:MAe},PAe=Wo,FAe=Eo,AS=tS,DAe=PAe(Function.toString);FAe(AS.inspectSource)||(AS.inspectSource=function(i){return DAe(i)});var dS=AS.inspectSource,RAe=Sa,kAe=Eo,dO=RAe.WeakMap,OAe=kAe(dO)&&/native code/.test(String(dO)),UAe=iS,NAe=iO,fO=UAe("keys"),fS=function(i){return fO[i]||(fO[i]=NAe(i))},pS={},zAe=OAe,pO=Sa,QAe=OA,VAe=p0,gS=yh,mS=tS,HAe=fS,GAe=pS,gO="Object already initialized",yS=pO.TypeError,jAe=pO.WeakMap,xb,g0,wb,qAe=function(i){return wb(i)?g0(i):xb(i,{})},$Ae=function(i){return function(e){var t;if(!QAe(e)||(t=g0(e)).type!==i)throw yS("Incompatible receiver, "+i+" required");return t}};if(zAe||mS.state){var rA=mS.state||(mS.state=new jAe);rA.get=rA.get,rA.has=rA.has,rA.set=rA.set,xb=function(i,e){if(rA.has(i))throw yS(gO);return e.facade=i,rA.set(i,e),e},g0=function(i){return rA.get(i)||{}},wb=function(i){return rA.has(i)}}else{var Zg=HAe("state");GAe[Zg]=!0,xb=function(i,e){if(gS(i,Zg))throw yS(gO);return e.facade=i,VAe(i,Zg,e),e},g0=function(i){return gS(i,Zg)?i[Zg]:{}},wb=function(i){return gS(i,Zg)}}var Bb={set:xb,get:g0,has:wb,enforce:qAe,getterFor:$Ae},_S=Wo,KAe=Ko,WAe=Eo,Cb=yh,vS=eA,XAe=bb.CONFIGURABLE,ZAe=dS,mO=Bb,JAe=mO.enforce,YAe=mO.get,yO=String,Eb=Object.defineProperty,ede=_S("".slice),tde=_S("".replace),ide=_S([].join),rde=vS&&!KAe(function(){return Eb(function(){},"length",{value:8}).length!==8}),nde=String(String).split("String"),sde=hO.exports=function(i,e,t){ede(yO(e),0,7)==="Symbol("&&(e="["+tde(yO(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Cb(i,"name")||XAe&&i.name!==e)&&(vS?Eb(i,"name",{value:e,configurable:!0}):i.name=e),rde&&t&&Cb(t,"arity")&&i.length!==t.arity&&Eb(i,"length",{value:t.arity});try{t&&Cb(t,"constructor")&&t.constructor?vS&&Eb(i,"prototype",{writable:!1}):i.prototype&&(i.prototype=void 0)}catch{}var r=JAe(i);return Cb(r,"source")||(r.source=ide(nde,typeof e=="string"?e:"")),i};Function.prototype.toString=sde(function(){return WAe(this)&&YAe(this).source||ZAe(this)},"toString");var _O=hO.exports,ode=Eo,ade=iA,lde=_O,cde=eS,Vf=function(i,e,t,r){r||(r={});var n=r.enumerable,o=r.name!==void 0?r.name:e;if(ode(t)&&lde(t,o,r),r.global)n?i[e]=t:cde(e,t);else{try{r.unsafe?i[e]&&(n=!0):delete i[e]}catch{}n?i[e]=t:ade.f(i,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return i},vO={},ude=Math.ceil,hde=Math.floor,Ade=Math.trunc||function(i){var e=+i;return(e>0?hde:ude)(e)},dde=Ade,Sb=function(i){var e=+i;return e!==e||e===0?0:dde(e)},fde=Sb,pde=Math.max,gde=Math.min,bO=function(i,e){var t=fde(i);return t<0?pde(t+e,0):gde(t,e)},mde=Sb,yde=Math.min,Jg=function(i){return i>0?yde(mde(i),9007199254740991):0},_de=Jg,Tb=function(i){return _de(i.length)},vde=f0,bde=bO,xde=Tb,xO=function(i){return function(e,t,r){var n=vde(e),o=xde(n),l=bde(r,o),s;if(i&&t!=t){for(;o>l;)if(s=n[l++],s!=s)return!0}else for(;o>l;l++)if((i||l in n)&&n[l]===t)return i||l||0;return!i&&-1}},wO={includes:xO(!0),indexOf:xO(!1)},wde=Wo,bS=yh,Bde=f0,Cde=wO.indexOf,Ede=pS,BO=wde([].push),CO=function(i,e){var t=Bde(i),r=0,n=[],o;for(o in t)!bS(Ede,o)&&bS(t,o)&&BO(n,o);for(;e.length>r;)bS(t,o=e[r++])&&(~Cde(n,o)||BO(n,o));return n},xS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Sde=CO,Tde=xS,Ide=Tde.concat("length","prototype");vO.f=Object.getOwnPropertyNames||function(i){return Sde(i,Ide)};var EO={};EO.f=Object.getOwnPropertySymbols;var Lde=Qf,Mde=Wo,Pde=vO,Fde=EO,Dde=Ol,Rde=Mde([].concat),kde=Lde("Reflect","ownKeys")||function(i){var e=Pde.f(Dde(i)),t=Fde.f;return t?Rde(e,t(i)):e},SO=yh,Ode=kde,Ude=Kg,Nde=iA,zde=function(i,e,t){for(var r=Ode(e),n=Nde.f,o=Ude.f,l=0;l<r.length;l++){var s=r[l];!SO(i,s)&&!(t&&SO(t,s))&&n(i,s,o(e,s))}},Qde=Ko,Vde=Eo,Hde=/#|\.prototype\./,m0=function(i,e){var t=jde[Gde(i)];return t==$de?!0:t==qde?!1:Vde(e)?Qde(e):!!e},Gde=m0.normalize=function(i){return String(i).replace(Hde,".").toLowerCase()},jde=m0.data={},qde=m0.NATIVE="N",$de=m0.POLYFILL="P",TO=m0,wS=Sa,Kde=Kg.f,Wde=p0,Xde=Vf,Zde=eS,Jde=zde,Yde=TO,dc=function(i,e){var t=i.target,r=i.global,n=i.stat,o,l,s,g,b,S;if(r?l=wS:n?l=wS[t]||Zde(t,{}):l=(wS[t]||{}).prototype,l)for(s in e){if(b=e[s],i.dontCallGetSet?(S=Kde(l,s),g=S&&S.value):g=l[s],o=Yde(r?s:t+(n?".":"#")+s,i.forced),!o&&g!==void 0){if(typeof b==typeof g)continue;Jde(b,g)}(i.sham||g&&g.sham)&&Wde(b,"sham",!0),Xde(l,s,b,i)}},efe=Nf,y0=typeof process<"u"&&efe(process)=="process",tfe=Wo,ife=UA,rfe=function(i,e,t){try{return tfe(ife(Object.getOwnPropertyDescriptor(i,e)[t]))}catch{}},nfe=Eo,sfe=String,ofe=TypeError,afe=function(i){if(typeof i=="object"||nfe(i))return i;throw ofe("Can't set "+sfe(i)+" as a prototype")},lfe=rfe,cfe=Ol,ufe=afe,IO=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,e={},t;try{t=lfe(Object.prototype,"__proto__","set"),t(e,[]),i=e instanceof Array}catch{}return function(r,n){return cfe(r),ufe(n),i?t(r,n):r.__proto__=n,r}}():void 0),hfe=iA.f,Afe=yh,dfe=$a,LO=dfe("toStringTag"),BS=function(i,e,t){i&&!t&&(i=i.prototype),i&&!Afe(i,LO)&&hfe(i,LO,{configurable:!0,value:e})},MO=_O,ffe=iA,pfe=function(i,e,t){return t.get&&MO(t.get,e,{getter:!0}),t.set&&MO(t.set,e,{setter:!0}),ffe.f(i,e,t)},gfe=Qf,mfe=pfe,yfe=$a,_fe=eA,PO=yfe("species"),vfe=function(i){var e=gfe(i);_fe&&e&&!e[PO]&&mfe(e,PO,{configurable:!0,get:function(){return this}})},bfe=fb,xfe=TypeError,wfe=function(i,e){if(bfe(e,i))return i;throw xfe("Incorrect invocation")},Bfe=$a,Cfe=Bfe("toStringTag"),FO={};FO[Cfe]="z";var Efe=String(FO)==="[object z]",Sfe=Efe,Tfe=Eo,Ib=Nf,Ife=$a,Lfe=Ife("toStringTag"),Mfe=Object,Pfe=Ib(function(){return arguments}())=="Arguments",Ffe=function(i,e){try{return i[e]}catch{}},CS=Sfe?Ib:function(i){var e,t,r;return i===void 0?"Undefined":i===null?"Null":typeof(t=Ffe(e=Mfe(i),Lfe))=="string"?t:Pfe?Ib(e):(r=Ib(e))=="Object"&&Tfe(e.callee)?"Arguments":r},Dfe=Wo,Rfe=Ko,DO=Eo,kfe=CS,Ofe=Qf,Ufe=dS,RO=function(){},Nfe=[],kO=Ofe("Reflect","construct"),ES=/^\s*(?:class|function)\b/,zfe=Dfe(ES.exec),Qfe=!ES.exec(RO),_0=function(i){if(!DO(i))return!1;try{return kO(RO,Nfe,i),!0}catch{return!1}},OO=function(i){if(!DO(i))return!1;switch(kfe(i)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Qfe||!!zfe(ES,Ufe(i))}catch{return!0}};OO.sham=!0;var Vfe=!kO||Rfe(function(){var i;return _0(_0.call)||!_0(Object)||!_0(function(){i=!0})||i})?OO:_0,Hfe=Vfe,Gfe=mb,jfe=TypeError,qfe=function(i){if(Hfe(i))return i;throw jfe(Gfe(i)+" is not a constructor")},UO=Ol,$fe=qfe,Kfe=zf,Wfe=$a,Xfe=Wfe("species"),NO=function(i,e){var t=UO(i).constructor,r;return t===void 0||Kfe(r=UO(t)[Xfe])?e:$fe(r)},Zfe=hb,zO=Function.prototype,QO=zO.apply,VO=zO.call,SS=typeof Reflect=="object"&&Reflect.apply||(Zfe?VO.bind(QO):function(){return VO.apply(QO,arguments)}),Jfe=Nf,Yfe=Wo,v0=function(i){if(Jfe(i)==="Function")return Yfe(i)},HO=v0,epe=UA,tpe=hb,ipe=HO(HO.bind),TS=function(i,e){return epe(i),e===void 0?i:tpe?ipe(i,e):function(){return i.apply(e,arguments)}},rpe=Qf,GO=rpe("document","documentElement"),npe=Wo,spe=npe([].slice),ope=TypeError,ape=function(i,e){if(i<e)throw ope("Not enough arguments");return i},lpe=pb,jO=/(?:ipad|iphone|ipod).*applewebkit/i.test(lpe),au=Sa,cpe=SS,upe=TS,qO=Eo,hpe=yh,$O=Ko,KO=GO,Ape=spe,WO=_b,dpe=ape,fpe=jO,ppe=y0,IS=au.setImmediate,LS=au.clearImmediate,gpe=au.process,MS=au.Dispatch,mpe=au.Function,XO=au.MessageChannel,ype=au.String,PS=0,b0={},ZO="onreadystatechange",x0,Hf,FS,DS;$O(function(){x0=au.location});var RS=function(i){if(hpe(b0,i)){var e=b0[i];delete b0[i],e()}},kS=function(i){return function(){RS(i)}},JO=function(i){RS(i.data)},YO=function(i){au.postMessage(ype(i),x0.protocol+"//"+x0.host)};(!IS||!LS)&&(IS=function(i){dpe(arguments.length,1);var e=qO(i)?i:mpe(i),t=Ape(arguments,1);return b0[++PS]=function(){cpe(e,void 0,t)},Hf(PS),PS},LS=function(i){delete b0[i]},ppe?Hf=function(i){gpe.nextTick(kS(i))}:MS&&MS.now?Hf=function(i){MS.now(kS(i))}:XO&&!fpe?(FS=new XO,DS=FS.port2,FS.port1.onmessage=JO,Hf=upe(DS.postMessage,DS)):au.addEventListener&&qO(au.postMessage)&&!au.importScripts&&x0&&x0.protocol!=="file:"&&!$O(YO)?(Hf=YO,au.addEventListener("message",JO,!1)):ZO in WO("script")?Hf=function(i){KO.appendChild(WO("script"))[ZO]=function(){KO.removeChild(this),RS(i)}}:Hf=function(i){setTimeout(kS(i),0)});var eU={set:IS,clear:LS},tU=function(){this.head=null,this.tail=null};tU.prototype={add:function(i){var e={item:i,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var i=this.head;if(i){var e=this.head=i.next;return e===null&&(this.tail=null),i.item}}};var iU=tU,_pe=pb,vpe=/ipad|iphone|ipod/i.test(_pe)&&typeof Pebble<"u",bpe=pb,xpe=/web0s(?!.*chrome)/i.test(bpe),Gf=Sa,rU=TS,wpe=Kg.f,OS=eU.set,Bpe=iU,Cpe=jO,Epe=vpe,Spe=xpe,US=y0,nU=Gf.MutationObserver||Gf.WebKitMutationObserver,sU=Gf.document,oU=Gf.process,Lb=Gf.Promise,aU=wpe(Gf,"queueMicrotask"),NS=aU&&aU.value,Yg,zS,QS,Mb,lU;if(!NS){var Pb=new Bpe,Fb=function(){var i,e;for(US&&(i=oU.domain)&&i.exit();e=Pb.get();)try{e()}catch(t){throw Pb.head&&Yg(),t}i&&i.enter()};!Cpe&&!US&&!Spe&&nU&&sU?(zS=!0,QS=sU.createTextNode(""),new nU(Fb).observe(QS,{characterData:!0}),Yg=function(){QS.data=zS=!zS}):!Epe&&Lb&&Lb.resolve?(Mb=Lb.resolve(void 0),Mb.constructor=Lb,lU=rU(Mb.then,Mb),Yg=function(){lU(Fb)}):US?Yg=function(){oU.nextTick(Fb)}:(OS=rU(OS,Gf),Yg=function(){OS(Fb)}),NS=function(i){Pb.head||Yg(),Pb.add(i)}}var Tpe=NS,Ipe=function(i,e){try{arguments.length==1?console.error(i):console.error(i,e)}catch{}},VS=function(i){try{return{error:!1,value:i()}}catch(e){return{error:!0,value:e}}},Lpe=Sa,Db=Lpe.Promise,cU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Mpe=cU,Ppe=y0,Fpe=!Mpe&&!Ppe&&typeof window=="object"&&typeof document=="object",Dpe=Sa,w0=Db,Rpe=Eo,kpe=TO,Ope=dS,Upe=$a,Npe=Fpe,zpe=cU,HS=XE;w0&&w0.prototype;var Qpe=Upe("species"),GS=!1,uU=Rpe(Dpe.PromiseRejectionEvent),Vpe=kpe("Promise",function(){var i=Ope(w0),e=i!==String(w0);if(!e&&HS===66)return!0;if(!HS||HS<51||!/native code/.test(i)){var t=new w0(function(o){o(1)}),r=function(o){o(function(){},function(){})},n=t.constructor={};if(n[Qpe]=r,GS=t.then(function(){})instanceof r,!GS)return!0}return!e&&(Npe||zpe)&&!uU}),B0={CONSTRUCTOR:Vpe,REJECTION_EVENT:uU,SUBCLASSING:GS},em={},hU=UA,Hpe=TypeError,Gpe=function(i){var e,t;this.promise=new i(function(r,n){if(e!==void 0||t!==void 0)throw Hpe("Bad Promise constructor");e=r,t=n}),this.resolve=hU(e),this.reject=hU(t)};em.f=function(i){return new Gpe(i)};var jpe=dc,Rb=y0,Pd=Sa,tm=cl,AU=Vf,dU=IO,qpe=BS,$pe=vfe,Kpe=UA,kb=Eo,Wpe=OA,Xpe=wfe,Zpe=NO,fU=eU.set,jS=Tpe,Jpe=Ipe,Ype=VS,ege=iU,pU=Bb,Ob=Db,qS=B0,gU=em,Ub="Promise",mU=qS.CONSTRUCTOR,tge=qS.REJECTION_EVENT,ige=qS.SUBCLASSING,$S=pU.getterFor(Ub),rge=pU.set,im=Ob&&Ob.prototype,jf=Ob,Nb=im,yU=Pd.TypeError,KS=Pd.document,WS=Pd.process,XS=gU.f,nge=XS,sge=!!(KS&&KS.createEvent&&Pd.dispatchEvent),_U="unhandledrejection",oge="rejectionhandled",vU=0,bU=1,age=2,ZS=1,xU=2,zb,wU,lge,BU,CU=function(i){var e;return Wpe(i)&&kb(e=i.then)?e:!1},EU=function(i,e){var t=e.value,r=e.state==bU,n=r?i.ok:i.fail,o=i.resolve,l=i.reject,s=i.domain,g,b,S;try{n?(r||(e.rejection===xU&&uge(e),e.rejection=ZS),n===!0?g=t:(s&&s.enter(),g=n(t),s&&(s.exit(),S=!0)),g===i.promise?l(yU("Promise-chain cycle")):(b=CU(g))?tm(b,g,o,l):o(g)):l(t)}catch(F){s&&!S&&s.exit(),l(F)}},SU=function(i,e){i.notified||(i.notified=!0,jS(function(){for(var t=i.reactions,r;r=t.get();)EU(r,i);i.notified=!1,e&&!i.rejection&&cge(i)}))},TU=function(i,e,t){var r,n;sge?(r=KS.createEvent("Event"),r.promise=e,r.reason=t,r.initEvent(i,!1,!0),Pd.dispatchEvent(r)):r={promise:e,reason:t},!tge&&(n=Pd["on"+i])?n(r):i===_U&&Jpe("Unhandled promise rejection",t)},cge=function(i){tm(fU,Pd,function(){var e=i.facade,t=i.value,r=IU(i),n;if(r&&(n=Ype(function(){Rb?WS.emit("unhandledRejection",t,e):TU(_U,e,t)}),i.rejection=Rb||IU(i)?xU:ZS,n.error))throw n.value})},IU=function(i){return i.rejection!==ZS&&!i.parent},uge=function(i){tm(fU,Pd,function(){var e=i.facade;Rb?WS.emit("rejectionHandled",e):TU(oge,e,i.value)})},rm=function(i,e,t){return function(r){i(e,r,t)}},nm=function(i,e,t){i.done||(i.done=!0,t&&(i=t),i.value=e,i.state=age,SU(i,!0))},JS=function(i,e,t){if(!i.done){i.done=!0,t&&(i=t);try{if(i.facade===e)throw yU("Promise can't be resolved itself");var r=CU(e);r?jS(function(){var n={done:!1};try{tm(r,e,rm(JS,n,i),rm(nm,n,i))}catch(o){nm(n,o,i)}}):(i.value=e,i.state=bU,SU(i,!1))}catch(n){nm({done:!1},n,i)}}};if(mU&&(jf=function(i){Xpe(this,Nb),Kpe(i),tm(zb,this);var e=$S(this);try{i(rm(JS,e),rm(nm,e))}catch(t){nm(e,t)}},Nb=jf.prototype,zb=function(i){rge(this,{type:Ub,done:!1,notified:!1,parent:!1,reactions:new ege,rejection:!1,state:vU,value:void 0})},zb.prototype=AU(Nb,"then",function(i,e){var t=$S(this),r=XS(Zpe(this,jf));return t.parent=!0,r.ok=kb(i)?i:!0,r.fail=kb(e)&&e,r.domain=Rb?WS.domain:void 0,t.state==vU?t.reactions.add(r):jS(function(){EU(r,t)}),r.promise}),wU=function(){var i=new zb,e=$S(i);this.promise=i,this.resolve=rm(JS,e),this.reject=rm(nm,e)},gU.f=XS=function(i){return i===jf||i===lge?new wU(i):nge(i)},kb(Ob)&&im!==Object.prototype)){BU=im.then,ige||AU(im,"then",function(i,e){var t=this;return new jf(function(r,n){tm(BU,t,r,n)}).then(i,e)},{unsafe:!0});try{delete im.constructor}catch{}dU&&dU(im,Nb)}jpe({global:!0,constructor:!0,wrap:!0,forced:mU},{Promise:jf}),qpe(jf,Ub,!1),$pe(Ub);var C0={},hge=$a,Age=C0,dge=hge("iterator"),fge=Array.prototype,pge=function(i){return i!==void 0&&(Age.Array===i||fge[dge]===i)},gge=CS,LU=Wg,mge=zf,yge=C0,_ge=$a,vge=_ge("iterator"),MU=function(i){if(!mge(i))return LU(i,vge)||LU(i,"@@iterator")||yge[gge(i)]},bge=cl,xge=UA,wge=Ol,Bge=mb,Cge=MU,Ege=TypeError,Sge=function(i,e){var t=arguments.length<2?Cge(i):e;if(xge(t))return wge(bge(t,i));throw Ege(Bge(i)+" is not iterable")},Tge=cl,PU=Ol,Ige=Wg,Lge=function(i,e,t){var r,n;PU(i);try{if(r=Ige(i,"return"),!r){if(e==="throw")throw t;return t}r=Tge(r,i)}catch(o){n=!0,r=o}if(e==="throw")throw t;if(n)throw r;return PU(r),t},Mge=TS,Pge=cl,Fge=Ol,Dge=mb,Rge=pge,kge=Tb,FU=fb,Oge=Sge,Uge=MU,DU=Lge,Nge=TypeError,Qb=function(i,e){this.stopped=i,this.result=e},RU=Qb.prototype,kU=function(i,e,t){var r=t&&t.that,n=!!(t&&t.AS_ENTRIES),o=!!(t&&t.IS_RECORD),l=!!(t&&t.IS_ITERATOR),s=!!(t&&t.INTERRUPTED),g=Mge(e,r),b,S,F,D,N,J,te,he=function(fe){return b&&DU(b,"normal",fe),new Qb(!0,fe)},ue=function(fe){return n?(Fge(fe),s?g(fe[0],fe[1],he):g(fe[0],fe[1])):s?g(fe,he):g(fe)};if(o)b=i.iterator;else if(l)b=i;else{if(S=Uge(i),!S)throw Nge(Dge(i)+" is not iterable");if(Rge(S)){for(F=0,D=kge(i);D>F;F++)if(N=ue(i[F]),N&&FU(RU,N))return N;return new Qb(!1)}b=Oge(i,S)}for(J=o?i.next:b.next;!(te=Pge(J,b)).done;){try{N=ue(te.value)}catch(fe){DU(b,"throw",fe)}if(typeof N=="object"&&N&&FU(RU,N))return N}return new Qb(!1)},zge=$a,OU=zge("iterator"),UU=!1;try{var Qge=0,NU={next:function(){return{done:!!Qge++}},return:function(){UU=!0}};NU[OU]=function(){return this},Array.from(NU,function(){throw 2})}catch{}var Vge=function(i,e){if(!e&&!UU)return!1;var t=!1;try{var r={};r[OU]=function(){return{next:function(){return{done:t=!0}}}},i(r)}catch{}return t},Hge=Db,Gge=Vge,jge=B0.CONSTRUCTOR,zU=jge||!Gge(function(i){Hge.all(i).then(void 0,function(){})}),qge=dc,$ge=cl,Kge=UA,Wge=em,Xge=VS,Zge=kU,Jge=zU;qge({target:"Promise",stat:!0,forced:Jge},{all:function(i){var e=this,t=Wge.f(e),r=t.resolve,n=t.reject,o=Xge(function(){var l=Kge(e.resolve),s=[],g=0,b=1;Zge(i,function(S){var F=g++,D=!1;b++,$ge(l,e,S).then(function(N){D||(D=!0,s[F]=N,--b||r(s))},n)}),--b||r(s)});return o.error&&n(o.value),t.promise}});var Yge=dc,eme=B0.CONSTRUCTOR,YS=Db,tme=Qf,ime=Eo,rme=Vf,QU=YS&&YS.prototype;if(Yge({target:"Promise",proto:!0,forced:eme,real:!0},{catch:function(i){return this.then(void 0,i)}}),ime(YS)){var VU=tme("Promise").prototype.catch;QU.catch!==VU&&rme(QU,"catch",VU,{unsafe:!0})}var nme=dc,sme=cl,ome=UA,ame=em,lme=VS,cme=kU,ume=zU;nme({target:"Promise",stat:!0,forced:ume},{race:function(i){var e=this,t=ame.f(e),r=t.reject,n=lme(function(){var o=ome(e.resolve);cme(i,function(l){sme(o,e,l).then(t.resolve,r)})});return n.error&&r(n.value),t.promise}});var hme=dc,Ame=cl,dme=em,fme=B0.CONSTRUCTOR;hme({target:"Promise",stat:!0,forced:fme},{reject:function(i){var e=dme.f(this);return Ame(e.reject,void 0,i),e.promise}});var pme=Ol,gme=OA,mme=em,yme=function(i,e){if(pme(i),gme(e)&&e.constructor===i)return e;var t=mme.f(i),r=t.resolve;return r(e),t.promise},_me=dc,vme=Qf,bme=B0.CONSTRUCTOR,xme=yme;vme("Promise"),_me({target:"Promise",stat:!0,forced:bme},{resolve:function(i){return xme(this,i)}});function HU(i,e,t,r,n,o,l){try{var s=i[o](l),g=s.value}catch(b){t(b);return}s.done?e(g):Promise.resolve(g).then(r,n)}function NA(i){return function(){var e=this,t=arguments;return new Promise(function(r,n){var o=i.apply(e,t);function l(g){HU(o,r,n,l,s,"next",g)}function s(g){HU(o,r,n,l,s,"throw",g)}l(void 0)})}}var wme=CS,Bme=String,nA=function(i){if(wme(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Bme(i)},Cme=Ol,GU=function(){var i=Cme(this),e="";return i.hasIndices&&(e+="d"),i.global&&(e+="g"),i.ignoreCase&&(e+="i"),i.multiline&&(e+="m"),i.dotAll&&(e+="s"),i.unicode&&(e+="u"),i.unicodeSets&&(e+="v"),i.sticky&&(e+="y"),e},eT=Ko,Eme=Sa,tT=Eme.RegExp,iT=eT(function(){var i=tT("a","y");return i.lastIndex=2,i.exec("abcd")!=null}),Sme=iT||eT(function(){return!tT("a","y").sticky}),Tme=iT||eT(function(){var i=tT("^r","gy");return i.lastIndex=2,i.exec("str")!=null}),jU={BROKEN_CARET:Tme,MISSED_STICKY:Sme,UNSUPPORTED_Y:iT},qU={},Ime=CO,Lme=xS,Mme=Object.keys||function(i){return Ime(i,Lme)},Pme=eA,Fme=cO,Dme=iA,Rme=Ol,kme=f0,Ome=Mme;qU.f=Pme&&!Fme?Object.defineProperties:function(i,e){Rme(i);for(var t=kme(e),r=Ome(e),n=r.length,o=0,l;n>o;)Dme.f(i,l=r[o++],t[l]);return i};var Ume=Ol,Nme=qU,$U=xS,zme=pS,Qme=GO,Vme=_b,Hme=fS,KU=">",WU="<",rT="prototype",nT="script",XU=Hme("IE_PROTO"),sT=function(){},ZU=function(i){return WU+nT+KU+i+WU+"/"+nT+KU},JU=function(i){i.write(ZU("")),i.close();var e=i.parentWindow.Object;return i=null,e},Gme=function(){var i=Vme("iframe"),e="java"+nT+":",t;return i.style.display="none",Qme.appendChild(i),i.src=String(e),t=i.contentWindow.document,t.open(),t.write(ZU("document.F=Object")),t.close(),t.F},Vb,Hb=function(){try{Vb=new ActiveXObject("htmlfile")}catch{}Hb=typeof document<"u"?document.domain&&Vb?JU(Vb):Gme():JU(Vb);for(var i=$U.length;i--;)delete Hb[rT][$U[i]];return Hb()};zme[XU]=!0;var oT=Object.create||function(i,e){var t;return i!==null?(sT[rT]=Ume(i),t=new sT,sT[rT]=null,t[XU]=i):t=Hb(),e===void 0?t:Nme.f(t,e)},jme=Ko,qme=Sa,$me=qme.RegExp,Kme=jme(function(){var i=$me(".","s");return!(i.dotAll&&i.exec(`
`)&&i.flags==="s")}),Wme=Ko,Xme=Sa,Zme=Xme.RegExp,Jme=Wme(function(){var i=Zme("(?<a>b)","g");return i.exec("b").groups.a!=="b"||"b".replace(i,"$<a>c")!=="bc"}),sm=cl,Gb=Wo,Yme=nA,eye=GU,tye=jU,iye=iS,rye=oT,nye=Bb.get,sye=Kme,oye=Jme,aye=iye("native-string-replace",String.prototype.replace),jb=RegExp.prototype.exec,aT=jb,lye=Gb("".charAt),cye=Gb("".indexOf),uye=Gb("".replace),lT=Gb("".slice),cT=function(){var i=/a/,e=/b*/g;return sm(jb,i,"a"),sm(jb,e,"a"),i.lastIndex!==0||e.lastIndex!==0}(),YU=tye.BROKEN_CARET,uT=/()??/.exec("")[1]!==void 0,hye=cT||uT||YU||sye||oye;hye&&(aT=function(i){var e=this,t=nye(e),r=Yme(i),n=t.raw,o,l,s,g,b,S,F;if(n)return n.lastIndex=e.lastIndex,o=sm(aT,n,r),e.lastIndex=n.lastIndex,o;var D=t.groups,N=YU&&e.sticky,J=sm(eye,e),te=e.source,he=0,ue=r;if(N&&(J=uye(J,"y",""),cye(J,"g")===-1&&(J+="g"),ue=lT(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&lye(r,e.lastIndex-1)!==`
`)&&(te="(?: "+te+")",ue=" "+ue,he++),l=new RegExp("^(?:"+te+")",J)),uT&&(l=new RegExp("^"+te+"$(?!\\s)",J)),cT&&(s=e.lastIndex),g=sm(jb,N?l:e,ue),N?g?(g.input=lT(g.input,he),g[0]=lT(g[0],he),g.index=e.lastIndex,e.lastIndex+=g[0].length):e.lastIndex=0:cT&&g&&(e.lastIndex=e.global?g.index+g[0].length:s),uT&&g&&g.length>1&&sm(aye,g[0],l,function(){for(b=1;b<arguments.length-2;b++)arguments[b]===void 0&&(g[b]=void 0)}),g&&D)for(g.groups=S=rye(null),b=0;b<D.length;b++)F=D[b],S[F[0]]=g[F[1]];return g});var qb=aT,Aye=dc,e6=qb;Aye({target:"RegExp",proto:!0,forced:/./.exec!==e6},{exec:e6});var t6=v0,i6=Vf,dye=qb,r6=Ko,n6=$a,fye=p0,pye=n6("species"),hT=RegExp.prototype,AT=function(i,e,t,r){var n=n6(i),o=!r6(function(){var b={};return b[n]=function(){return 7},""[i](b)!=7}),l=o&&!r6(function(){var b=!1,S=/a/;return i==="split"&&(S={},S.constructor={},S.constructor[pye]=function(){return S},S.flags="",S[n]=/./[n]),S.exec=function(){return b=!0,null},S[n](""),!b});if(!o||!l||t){var s=t6(/./[n]),g=e(n,""[i],function(b,S,F,D,N){var J=t6(b),te=S.exec;return te===dye||te===hT.exec?o&&!N?{done:!0,value:s(S,F,D)}:{done:!0,value:J(F,S,D)}:{done:!1}});i6(String.prototype,i,g[0]),i6(hT,n,g[1])}r&&fye(hT[n],"sham",!0)},dT=Wo,gye=Sb,mye=nA,yye=tA,_ye=dT("".charAt),s6=dT("".charCodeAt),vye=dT("".slice),o6=function(i){return function(e,t){var r=mye(yye(e)),n=gye(t),o=r.length,l,s;return n<0||n>=o?i?"":void 0:(l=s6(r,n),l<55296||l>56319||n+1===o||(s=s6(r,n+1))<56320||s>57343?i?_ye(r,n):l:i?vye(r,n,n+2):(l-55296<<10)+(s-56320)+65536)}},bye={codeAt:o6(!1),charAt:o6(!0)},xye=bye.charAt,fT=function(i,e,t){return e+(t?xye(i,e).length:1)},a6=cl,wye=Ol,Bye=Eo,Cye=Nf,Eye=qb,Sye=TypeError,pT=function(i,e){var t=i.exec;if(Bye(t)){var r=a6(t,i,e);return r!==null&&wye(r),r}if(Cye(i)==="RegExp")return a6(Eye,i,e);throw Sye("RegExp#exec called on incompatible receiver")},Tye=cl,Iye=AT,Lye=Ol,Mye=zf,Pye=Jg,gT=nA,Fye=tA,Dye=Wg,Rye=fT,l6=pT;Iye("match",function(i,e,t){return[function(r){var n=Fye(this),o=Mye(r)?void 0:Dye(r,i);return o?Tye(o,r,n):new RegExp(r)[i](gT(n))},function(r){var n=Lye(this),o=gT(r),l=t(e,n,o);if(l.done)return l.value;if(!n.global)return l6(n,o);var s=n.unicode;n.lastIndex=0;for(var g=[],b=0,S;(S=l6(n,o))!==null;){var F=gT(S[0]);g[b]=F,F===""&&(n.lastIndex=Rye(o,Pye(n.lastIndex),s)),b++}return b===0?null:g}]});var mT=Wo,kye=yb,Oye=Math.floor,yT=mT("".charAt),Uye=mT("".replace),_T=mT("".slice),Nye=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,zye=/\$([$&'`]|\d{1,2})/g,Qye=function(i,e,t,r,n,o){var l=t+i.length,s=r.length,g=zye;return n!==void 0&&(n=kye(n),g=Nye),Uye(o,g,function(b,S){var F;switch(yT(S,0)){case"$":return"$";case"&":return i;case"`":return _T(e,0,t);case"'":return _T(e,l);case"<":F=n[_T(S,1,-1)];break;default:var D=+S;if(D===0)return b;if(D>s){var N=Oye(D/10);return N===0?b:N<=s?r[N-1]===void 0?yT(S,1):r[N-1]+yT(S,1):b}F=r[D-1]}return F===void 0?"":F})},Vye=SS,c6=cl,$b=Wo,Hye=AT,Gye=Ko,jye=Ol,qye=Eo,$ye=zf,Kye=Sb,Wye=Jg,om=nA,Xye=tA,Zye=fT,Jye=Wg,Yye=Qye,e0e=pT,t0e=$a,vT=t0e("replace"),i0e=Math.max,r0e=Math.min,n0e=$b([].concat),bT=$b([].push),u6=$b("".indexOf),h6=$b("".slice),s0e=function(i){return i===void 0?i:String(i)},o0e=function(){return"a".replace(/./,"$0")==="$0"}(),A6=function(){return/./[vT]?/./[vT]("a","$0")==="":!1}(),a0e=!Gye(function(){var i=/./;return i.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(i,"$<a>")!=="7"});Hye("replace",function(i,e,t){var r=A6?"$":"$0";return[function(n,o){var l=Xye(this),s=$ye(n)?void 0:Jye(n,vT);return s?c6(s,n,l,o):c6(e,om(l),n,o)},function(n,o){var l=jye(this),s=om(n);if(typeof o=="string"&&u6(o,r)===-1&&u6(o,"$<")===-1){var g=t(e,l,s,o);if(g.done)return g.value}var b=qye(o);b||(o=om(o));var S=l.global;if(S){var F=l.unicode;l.lastIndex=0}for(var D=[];;){var N=e0e(l,s);if(N===null||(bT(D,N),!S))break;var J=om(N[0]);J===""&&(l.lastIndex=Zye(s,Wye(l.lastIndex),F))}for(var te="",he=0,ue=0;ue<D.length;ue++){N=D[ue];for(var fe=om(N[0]),ve=i0e(r0e(Kye(N.index),s.length),0),Se=[],Ge=1;Ge<N.length;Ge++)bT(Se,s0e(N[Ge]));var He=N.groups;if(b){var $e=n0e([fe],Se,ve,s);He!==void 0&&bT($e,He);var Ne=om(Vye(o,void 0,$e))}else Ne=Yye(fe,s,ve,Se,He,o);ve>=he&&(te+=h6(s,he,ve)+Ne,he=ve+fe.length)}return te+h6(s,he)}]},!a0e||!o0e||A6);var l0e=OA,c0e=Nf,u0e=$a,h0e=u0e("match"),d6=function(i){var e;return l0e(i)&&((e=i[h0e])!==void 0?!!e:c0e(i)=="RegExp")},A0e=d6,d0e=TypeError,xT=function(i){if(A0e(i))throw d0e("The method doesn't accept regular expressions");return i},f0e=$a,p0e=f0e("match"),wT=function(i){var e=/./;try{"/./"[i](e)}catch{try{return e[p0e]=!1,"/./"[i](e)}catch{}}return!1},g0e=dc,f6=v0,m0e=Kg.f,y0e=Jg,p6=nA,_0e=xT,v0e=tA,b0e=wT,g6=f6("".startsWith),x0e=f6("".slice),w0e=Math.min,m6=b0e("startsWith"),B0e=!m6&&!!function(){var i=m0e(String.prototype,"startsWith");return i&&!i.writable}();g0e({target:"String",proto:!0,forced:!B0e&&!m6},{startsWith:function(i){var e=p6(v0e(this));_0e(i);var t=y0e(w0e(arguments.length>1?arguments[1]:void 0,e.length)),r=p6(i);return g6?g6(e,r,t):x0e(e,t,t+r.length)===r}});var C0e=$a,E0e=oT,S0e=iA.f,BT=C0e("unscopables"),CT=Array.prototype;CT[BT]==null&&S0e(CT,BT,{configurable:!0,value:E0e(null)});var T0e=function(i){CT[BT][i]=!0},I0e=Ko,L0e=!I0e(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),M0e=yh,P0e=Eo,F0e=yb,D0e=fS,R0e=L0e,y6=D0e("IE_PROTO"),ET=Object,k0e=ET.prototype,_6=R0e?ET.getPrototypeOf:function(i){var e=F0e(i);if(M0e(e,y6))return e[y6];var t=e.constructor;return P0e(t)&&e instanceof t?t.prototype:e instanceof ET?k0e:null},O0e=Ko,U0e=Eo,N0e=OA,v6=_6,z0e=Vf,Q0e=$a,ST=Q0e("iterator"),b6=!1,qf,TT,IT;[].keys&&(IT=[].keys(),"next"in IT?(TT=v6(v6(IT)),TT!==Object.prototype&&(qf=TT)):b6=!0);var V0e=!N0e(qf)||O0e(function(){var i={};return qf[ST].call(i)!==i});V0e&&(qf={}),U0e(qf[ST])||z0e(qf,ST,function(){return this});var x6={IteratorPrototype:qf,BUGGY_SAFARI_ITERATORS:b6},H0e=x6.IteratorPrototype,G0e=oT,j0e=db,q0e=BS,$0e=C0,K0e=function(){return this},W0e=function(i,e,t,r){var n=e+" Iterator";return i.prototype=G0e(H0e,{next:j0e(+!r,t)}),q0e(i,n,!1),$0e[n]=K0e,i},X0e=dc,Z0e=cl,w6=bb,J0e=Eo,Y0e=W0e,B6=_6,C6=IO,e_e=BS,t_e=p0,LT=Vf,i_e=$a,r_e=C0,E6=x6,n_e=w6.PROPER,s_e=w6.CONFIGURABLE,S6=E6.IteratorPrototype,Kb=E6.BUGGY_SAFARI_ITERATORS,E0=i_e("iterator"),T6="keys",S0="values",I6="entries",o_e=function(){return this},a_e=function(i,e,t,r,n,o,l){Y0e(t,e,r);var s=function(ue){if(ue===n&&D)return D;if(!Kb&&ue in S)return S[ue];switch(ue){case T6:return function(){return new t(this,ue)};case S0:return function(){return new t(this,ue)};case I6:return function(){return new t(this,ue)}}return function(){return new t(this)}},g=e+" Iterator",b=!1,S=i.prototype,F=S[E0]||S["@@iterator"]||n&&S[n],D=!Kb&&F||s(n),N=e=="Array"&&S.entries||F,J,te,he;if(N&&(J=B6(N.call(new i)),J!==Object.prototype&&J.next&&(B6(J)!==S6&&(C6?C6(J,S6):J0e(J[E0])||LT(J,E0,o_e)),e_e(J,g,!0))),n_e&&n==S0&&F&&F.name!==S0&&(s_e?t_e(S,"name",S0):(b=!0,D=function(){return Z0e(F,this)})),n)if(te={values:s(S0),keys:o?D:s(T6),entries:s(I6)},l)for(he in te)(Kb||b||!(he in S))&&LT(S,he,te[he]);else X0e({target:e,proto:!0,forced:Kb||b},te);return S[E0]!==D&&LT(S,E0,D,{name:n}),r_e[e]=D,te},l_e=function(i,e){return{value:i,done:e}},c_e=f0,MT=T0e,L6=C0,M6=Bb,u_e=iA.f,h_e=a_e,Wb=l_e,A_e=eA,P6="Array Iterator",d_e=M6.set,f_e=M6.getterFor(P6),p_e=h_e(Array,"Array",function(i,e){d_e(this,{type:P6,target:c_e(i),index:0,kind:e})},function(){var i=f_e(this),e=i.target,t=i.kind,r=i.index++;return!e||r>=e.length?(i.target=void 0,Wb(void 0,!0)):t=="keys"?Wb(r,!1):t=="values"?Wb(e[r],!1):Wb([r,e[r]],!1)},"values"),F6=L6.Arguments=L6.Array;if(MT("keys"),MT("values"),MT("entries"),A_e&&F6.name!=="values")try{u_e(F6,"name",{value:"values"})}catch{}var g_e={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},m_e=_b,PT=m_e("span").classList,D6=PT&&PT.constructor&&PT.constructor.prototype,y_e=D6===Object.prototype?void 0:D6,R6=Sa,k6=g_e,__e=y_e,T0=p_e,FT=p0,O6=$a,DT=O6("iterator"),U6=O6("toStringTag"),RT=T0.values,N6=function(i,e){if(i){if(i[DT]!==RT)try{FT(i,DT,RT)}catch{i[DT]=RT}if(i[U6]||FT(i,U6,e),k6[e]){for(var t in T0)if(i[t]!==T0[t])try{FT(i,t,T0[t])}catch{i[t]=T0[t]}}}};for(var kT in k6)N6(R6[kT]&&R6[kT].prototype,kT);N6(__e,"DOMTokenList");function v_e(i,e){if(Yn(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Yn(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function b_e(i){var e=v_e(i,"string");return Yn(e)==="symbol"?e:String(e)}function OT(i,e,t){return e=b_e(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var x_e=UA,w_e=yb,B_e=Uk,C_e=Tb,E_e=TypeError,z6=function(i){return function(e,t,r,n){x_e(t);var o=w_e(e),l=B_e(o),s=C_e(o),g=i?s-1:0,b=i?-1:1;if(r<2)for(;;){if(g in l){n=l[g],g+=b;break}if(g+=b,i?g<0:s<=g)throw E_e("Reduce of empty array with no initial value")}for(;i?g>=0:s>g;g+=b)g in l&&(n=t(n,l[g],g,o));return n}},S_e={left:z6(!1),right:z6(!0)},T_e=Ko,Q6=function(i,e){var t=[][i];return!!t&&T_e(function(){t.call(null,e||function(){return 1},1)})},I_e=dc,L_e=S_e.left,M_e=Q6,V6=XE,P_e=y0,F_e=!P_e&&V6>79&&V6<83,D_e=F_e||!M_e("reduce");I_e({target:"Array",proto:!0,forced:D_e},{reduce:function(i){var e=arguments.length;return L_e(this,i,e,e>1?arguments[1]:void 0)}});var R_e=dc,H6=v0,k_e=Kg.f,O_e=Jg,G6=nA,U_e=xT,N_e=tA,z_e=wT,j6=H6("".endsWith),Q_e=H6("".slice),V_e=Math.min,q6=z_e("endsWith"),H_e=!q6&&!!function(){var i=k_e(String.prototype,"endsWith");return i&&!i.writable}();R_e({target:"String",proto:!0,forced:!H_e&&!q6},{endsWith:function(i){var e=G6(N_e(this));U_e(i);var t=arguments.length>1?arguments[1]:void 0,r=e.length,n=t===void 0?r:V_e(O_e(t),r),o=G6(i);return j6?j6(e,o,n):Q_e(e,n-o.length,n)===o}});var G_e=nS,j_e=iA,q_e=db,$_e=function(i,e,t){var r=G_e(e);r in i?j_e.f(i,r,q_e(0,t)):i[r]=t},$6=bO,K_e=Tb,W_e=$_e,X_e=Array,Z_e=Math.max,J_e=function(i,e,t){for(var r=K_e(i),n=$6(e,r),o=$6(t===void 0?r:t,r),l=X_e(Z_e(o-n,0)),s=0;n<o;n++,s++)W_e(l,s,i[n]);return l.length=s,l},Y_e=SS,I0=cl,UT=Wo,e1e=AT,t1e=Ol,i1e=zf,r1e=d6,K6=tA,n1e=NO,s1e=fT,o1e=Jg,NT=nA,a1e=Wg,W6=J_e,X6=pT,l1e=qb,c1e=jU,u1e=Ko,am=c1e.UNSUPPORTED_Y,Z6=4294967295,h1e=Math.min,J6=[].push,A1e=UT(/./.exec),lm=UT(J6),L0=UT("".slice),d1e=!u1e(function(){var i=/(?:)/,e=i.exec;i.exec=function(){return e.apply(this,arguments)};var t="ab".split(i);return t.length!==2||t[0]!=="a"||t[1]!=="b"});e1e("split",function(i,e,t){var r;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?r=function(n,o){var l=NT(K6(this)),s=o===void 0?Z6:o>>>0;if(s===0)return[];if(n===void 0)return[l];if(!r1e(n))return I0(e,l,n,s);for(var g=[],b=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),S=0,F=new RegExp(n.source,b+"g"),D,N,J;(D=I0(l1e,F,l))&&(N=F.lastIndex,!(N>S&&(lm(g,L0(l,S,D.index)),D.length>1&&D.index<l.length&&Y_e(J6,g,W6(D,1)),J=D[0].length,S=N,g.length>=s)));)F.lastIndex===D.index&&F.lastIndex++;return S===l.length?(J||!A1e(F,""))&&lm(g,""):lm(g,L0(l,S)),g.length>s?W6(g,0,s):g}:"0".split(void 0,0).length?r=function(n,o){return n===void 0&&o===0?[]:I0(e,this,n,o)}:r=e,[function(n,o){var l=K6(this),s=i1e(n)?void 0:a1e(n,i);return s?I0(s,n,l,o):I0(r,NT(l),n,o)},function(n,o){var l=t1e(this),s=NT(n),g=t(r,l,s,o,r!==e);if(g.done)return g.value;var b=n1e(l,RegExp),S=l.unicode,F=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(am?"g":"y"),D=new b(am?"^(?:"+l.source+")":l,F),N=o===void 0?Z6:o>>>0;if(N===0)return[];if(s.length===0)return X6(D,s)===null?[s]:[];for(var J=0,te=0,he=[];te<s.length;){D.lastIndex=am?0:te;var ue=X6(D,am?L0(s,te):s),fe;if(ue===null||(fe=h1e(o1e(D.lastIndex+(am?te:0)),s.length))===J)te=s1e(s,te,S);else{if(lm(he,L0(s,J,te)),he.length===N)return he;for(var ve=1;ve<=ue.length-1;ve++)if(lm(he,ue[ve]),he.length===N)return he;te=J=fe}}return lm(he,L0(s,J)),he}]},!d1e,am);var Xb={exports:{}},M0={exports:{}};(function(){var i,e,t,r,n,o;typeof performance<"u"&&performance!==null&&performance.now?M0.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(M0.exports=function(){return(i()-n)/1e6},e=process.hrtime,i=function(){var l;return l=e(),l[0]*1e9+l[1]},r=i(),o=process.uptime()*1e9,n=r-o):Date.now?(M0.exports=function(){return Date.now()-t},t=Date.now()):(M0.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(d0);for(var f1e=M0.exports,p1e=f1e,zA=typeof window>"u"?d0:window,Zb=["moz","webkit"],cm="AnimationFrame",um=zA["request"+cm],P0=zA["cancel"+cm]||zA["cancelRequest"+cm],F0=0;!um&&F0<Zb.length;F0++)um=zA[Zb[F0]+"Request"+cm],P0=zA[Zb[F0]+"Cancel"+cm]||zA[Zb[F0]+"CancelRequest"+cm];if(!um||!P0){var zT=0,Y6=0,$f=[],g1e=1e3/60;um=function(i){if($f.length===0){var e=p1e(),t=Math.max(0,g1e-(e-zT));zT=t+e,setTimeout(function(){var r=$f.slice(0);$f.length=0;for(var n=0;n<r.length;n++)if(!r[n].cancelled)try{r[n].callback(zT)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return $f.push({handle:++Y6,callback:i,cancelled:!1}),Y6},P0=function(i){for(var e=0;e<$f.length;e++)$f[e].handle===i&&($f[e].cancelled=!0)}}Xb.exports=function(i){return um.call(zA,i)},Xb.exports.cancel=function(){P0.apply(zA,arguments)},Xb.exports.polyfill=function(i){i||(i=zA),i.requestAnimationFrame=um,i.cancelAnimationFrame=P0};var m1e=Xb.exports;const QT=Mk(m1e);var eN=`	
\v\f\r \u2028\u2029\uFEFF`,y1e=Wo,_1e=tA,v1e=nA,VT=eN,tN=y1e("".replace),b1e=RegExp("^["+VT+"]+"),x1e=RegExp("(^|[^"+VT+"])["+VT+"]+$"),HT=function(i){return function(e){var t=v1e(_1e(e));return i&1&&(t=tN(t,b1e,"")),i&2&&(t=tN(t,x1e,"$1")),t}},w1e={start:HT(1),end:HT(2),trim:HT(3)},B1e=bb.PROPER,C1e=Ko,iN=eN,rN="",E1e=function(i){return C1e(function(){return!!iN[i]()||rN[i]()!==rN||B1e&&iN[i].name!==i})},S1e=dc,T1e=w1e.trim,I1e=E1e;S1e({target:"String",proto:!0,forced:I1e("trim")},{trim:function(){return T1e(this)}});var L1e=function(i){this.ok=!1,this.alpha=1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i=i.replace(/ /g,""),i=i.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};i=e[i]||i;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseFloat(g[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(g){return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(g){return[parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);if(l){var s=o(l);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var g=this.r.toString(16),b=this.g.toString(16),S=this.b.toString(16);return g.length==1&&(g="0"+g),b.length==1&&(b="0"+b),S.length==1&&(S="0"+S),"#"+g+b+S},this.getHelpXML=function(){for(var g=new Array,b=0;b<t.length;b++)for(var S=t[b].example,F=0;F<S.length;F++)g[g.length]=S[F];for(var D in e)g[g.length]=D;var N=document.createElement("ul");N.setAttribute("id","rgbcolor-examples");for(var b=0;b<g.length;b++)try{var J=document.createElement("li"),te=new RGBColor(g[b]),he=document.createElement("div");he.style.cssText="margin: 3px; border: 1px solid black; background:"+te.toHex()+"; color:"+te.toHex(),he.appendChild(document.createTextNode("test"));var ue=document.createTextNode(" "+g[b]+" -> "+te.toRGB()+" -> "+te.toHex());J.appendChild(he),J.appendChild(ue),N.appendChild(J)}catch{}return N}};const GT=Mk(L1e);var M1e=dc,P1e=v0,F1e=wO.indexOf,D1e=Q6,jT=P1e([].indexOf),nN=!!jT&&1/jT([1],1,-0)<0,R1e=nN||!D1e("indexOf");M1e({target:"Array",proto:!0,forced:R1e},{indexOf:function(i){var e=arguments.length>1?arguments[1]:void 0;return nN?jT(this,i,e)||0:F1e(this,i,e)}});var k1e=dc,O1e=Wo,U1e=xT,N1e=tA,sN=nA,z1e=wT,Q1e=O1e("".indexOf);k1e({target:"String",proto:!0,forced:!z1e("includes")},{includes:function(i){return!!~Q1e(sN(N1e(this)),sN(U1e(i)),arguments.length>1?arguments[1]:void 0)}});var V1e=Nf,H1e=Array.isArray||function(i){return V1e(i)=="Array"},G1e=dc,j1e=Wo,q1e=H1e,$1e=j1e([].reverse),oN=[1,2];G1e({target:"Array",proto:!0,forced:String(oN)===String(oN.reverse())},{reverse:function(){return q1e(this)&&(this.length=this.length),$1e(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var aN=function(i,e){return(aN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)};function lN(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}aN(i,e),i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function K1e(i){var e="";Array.isArray(i)||(i=[i]);for(var t=0;t<i.length;t++){var r=i[t];if(r.type===_i.CLOSE_PATH)e+="z";else if(r.type===_i.HORIZ_LINE_TO)e+=(r.relative?"h":"H")+r.x;else if(r.type===_i.VERT_LINE_TO)e+=(r.relative?"v":"V")+r.y;else if(r.type===_i.MOVE_TO)e+=(r.relative?"m":"M")+r.x+" "+r.y;else if(r.type===_i.LINE_TO)e+=(r.relative?"l":"L")+r.x+" "+r.y;else if(r.type===_i.CURVE_TO)e+=(r.relative?"c":"C")+r.x1+" "+r.y1+" "+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===_i.SMOOTH_CURVE_TO)e+=(r.relative?"s":"S")+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===_i.QUAD_TO)e+=(r.relative?"q":"Q")+r.x1+" "+r.y1+" "+r.x+" "+r.y;else if(r.type===_i.SMOOTH_QUAD_TO)e+=(r.relative?"t":"T")+r.x+" "+r.y;else{if(r.type!==_i.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+t+".");e+=(r.relative?"a":"A")+r.rX+" "+r.rY+" "+r.xRot+" "+ +r.lArcFlag+" "+ +r.sweepFlag+" "+r.x+" "+r.y}}return e}function qT(i,e){var t=i[0],r=i[1];return[t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e)]}function _h(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];for(var t=0;t<i.length;t++)if(typeof i[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof i[t]+" == typeof "+i[t]);return!0}var Fd=Math.PI;function $T(i,e,t){i.lArcFlag=i.lArcFlag===0?0:1,i.sweepFlag=i.sweepFlag===0?0:1;var r=i.rX,n=i.rY,o=i.x,l=i.y;r=Math.abs(i.rX),n=Math.abs(i.rY);var s=qT([(e-o)/2,(t-l)/2],-i.xRot/180*Fd),g=s[0],b=s[1],S=Math.pow(g,2)/Math.pow(r,2)+Math.pow(b,2)/Math.pow(n,2);1<S&&(r*=Math.sqrt(S),n*=Math.sqrt(S)),i.rX=r,i.rY=n;var F=Math.pow(r,2)*Math.pow(b,2)+Math.pow(n,2)*Math.pow(g,2),D=(i.lArcFlag!==i.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(n,2)-F)/F)),N=r*b/n*D,J=-n*g/r*D,te=qT([N,J],i.xRot/180*Fd);i.cX=te[0]+(e+o)/2,i.cY=te[1]+(t+l)/2,i.phi1=Math.atan2((b-J)/n,(g-N)/r),i.phi2=Math.atan2((-b-J)/n,(-g-N)/r),i.sweepFlag===0&&i.phi2>i.phi1&&(i.phi2-=2*Fd),i.sweepFlag===1&&i.phi2<i.phi1&&(i.phi2+=2*Fd),i.phi1*=180/Fd,i.phi2*=180/Fd}function cN(i,e,t){_h(i,e,t);var r=i*i+e*e-t*t;if(0>r)return[];if(r===0)return[[i*t/(i*i+e*e),e*t/(i*i+e*e)]];var n=Math.sqrt(r);return[[(i*t+e*n)/(i*i+e*e),(e*t-i*n)/(i*i+e*e)],[(i*t-e*n)/(i*i+e*e),(e*t+i*n)/(i*i+e*e)]]}var ca,QA=Math.PI/180;function uN(i,e,t){return(1-t)*i+t*e}function hN(i,e,t,r){return i+Math.cos(r/180*Fd)*e+Math.sin(r/180*Fd)*t}function AN(i,e,t,r){var n=1e-6,o=e-i,l=t-e,s=3*o+3*(r-t)-6*l,g=6*(l-o),b=3*o;return Math.abs(s)<n?[-b/g]:function(S,F,D){D===void 0&&(D=1e-6);var N=S*S/4-F;if(N<-D)return[];if(N<=D)return[-S/2];var J=Math.sqrt(N);return[-S/2-J,-S/2+J]}(g/s,b/s,n)}function dN(i,e,t,r,n){var o=1-n;return i*(o*o*o)+e*(3*o*o*n)+t*(3*o*n*n)+r*(n*n*n)}(function(i){function e(){return n(function(s,g,b){return s.relative&&(s.x1!==void 0&&(s.x1+=g),s.y1!==void 0&&(s.y1+=b),s.x2!==void 0&&(s.x2+=g),s.y2!==void 0&&(s.y2+=b),s.x!==void 0&&(s.x+=g),s.y!==void 0&&(s.y+=b),s.relative=!1),s})}function t(){var s=NaN,g=NaN,b=NaN,S=NaN;return n(function(F,D,N){return F.type&_i.SMOOTH_CURVE_TO&&(F.type=_i.CURVE_TO,s=isNaN(s)?D:s,g=isNaN(g)?N:g,F.x1=F.relative?D-s:2*D-s,F.y1=F.relative?N-g:2*N-g),F.type&_i.CURVE_TO?(s=F.relative?D+F.x2:F.x2,g=F.relative?N+F.y2:F.y2):(s=NaN,g=NaN),F.type&_i.SMOOTH_QUAD_TO&&(F.type=_i.QUAD_TO,b=isNaN(b)?D:b,S=isNaN(S)?N:S,F.x1=F.relative?D-b:2*D-b,F.y1=F.relative?N-S:2*N-S),F.type&_i.QUAD_TO?(b=F.relative?D+F.x1:F.x1,S=F.relative?N+F.y1:F.y1):(b=NaN,S=NaN),F})}function r(){var s=NaN,g=NaN;return n(function(b,S,F){if(b.type&_i.SMOOTH_QUAD_TO&&(b.type=_i.QUAD_TO,s=isNaN(s)?S:s,g=isNaN(g)?F:g,b.x1=b.relative?S-s:2*S-s,b.y1=b.relative?F-g:2*F-g),b.type&_i.QUAD_TO){s=b.relative?S+b.x1:b.x1,g=b.relative?F+b.y1:b.y1;var D=b.x1,N=b.y1;b.type=_i.CURVE_TO,b.x1=((b.relative?0:S)+2*D)/3,b.y1=((b.relative?0:F)+2*N)/3,b.x2=(b.x+2*D)/3,b.y2=(b.y+2*N)/3}else s=NaN,g=NaN;return b})}function n(s){var g=0,b=0,S=NaN,F=NaN;return function(D){if(isNaN(S)&&!(D.type&_i.MOVE_TO))throw new Error("path must start with moveto");var N=s(D,g,b,S,F);return D.type&_i.CLOSE_PATH&&(g=S,b=F),D.x!==void 0&&(g=D.relative?g+D.x:D.x),D.y!==void 0&&(b=D.relative?b+D.y:D.y),D.type&_i.MOVE_TO&&(S=g,F=b),N}}function o(s,g,b,S,F,D){return _h(s,g,b,S,F,D),n(function(N,J,te,he){var ue=N.x1,fe=N.x2,ve=N.relative&&!isNaN(he),Se=N.x!==void 0?N.x:ve?0:J,Ge=N.y!==void 0?N.y:ve?0:te;function He(Te){return Te*Te}N.type&_i.HORIZ_LINE_TO&&g!==0&&(N.type=_i.LINE_TO,N.y=N.relative?0:te),N.type&_i.VERT_LINE_TO&&b!==0&&(N.type=_i.LINE_TO,N.x=N.relative?0:J),N.x!==void 0&&(N.x=N.x*s+Ge*b+(ve?0:F)),N.y!==void 0&&(N.y=Se*g+N.y*S+(ve?0:D)),N.x1!==void 0&&(N.x1=N.x1*s+N.y1*b+(ve?0:F)),N.y1!==void 0&&(N.y1=ue*g+N.y1*S+(ve?0:D)),N.x2!==void 0&&(N.x2=N.x2*s+N.y2*b+(ve?0:F)),N.y2!==void 0&&(N.y2=fe*g+N.y2*S+(ve?0:D));var $e=s*S-g*b;if(N.xRot!==void 0&&(s!==1||g!==0||b!==0||S!==1))if($e===0)delete N.rX,delete N.rY,delete N.xRot,delete N.lArcFlag,delete N.sweepFlag,N.type=_i.LINE_TO;else{var Ne=N.xRot*Math.PI/180,at=Math.sin(Ne),rt=Math.cos(Ne),Re=1/He(N.rX),Pe=1/He(N.rY),Je=He(rt)*Re+He(at)*Pe,Xe=2*at*rt*(Re-Pe),Ct=He(at)*Re+He(rt)*Pe,Et=Je*S*S-Xe*g*S+Ct*g*g,Mt=Xe*(s*S+g*b)-2*(Je*b*S+Ct*s*g),vt=Je*b*b-Xe*s*b+Ct*s*s,Dt=(Math.atan2(Mt,Et-vt)+Math.PI)%Math.PI/2,Pt=Math.sin(Dt),Xt=Math.cos(Dt);N.rX=Math.abs($e)/Math.sqrt(Et*He(Xt)+Mt*Pt*Xt+vt*He(Pt)),N.rY=Math.abs($e)/Math.sqrt(Et*He(Pt)-Mt*Pt*Xt+vt*He(Xt)),N.xRot=180*Dt/Math.PI}return N.sweepFlag!==void 0&&0>$e&&(N.sweepFlag=+!N.sweepFlag),N})}function l(){return function(s){var g={};for(var b in s)g[b]=s[b];return g}}i.ROUND=function(s){function g(b){return Math.round(b*s)/s}return s===void 0&&(s=1e13),_h(s),function(b){return b.x1!==void 0&&(b.x1=g(b.x1)),b.y1!==void 0&&(b.y1=g(b.y1)),b.x2!==void 0&&(b.x2=g(b.x2)),b.y2!==void 0&&(b.y2=g(b.y2)),b.x!==void 0&&(b.x=g(b.x)),b.y!==void 0&&(b.y=g(b.y)),b.rX!==void 0&&(b.rX=g(b.rX)),b.rY!==void 0&&(b.rY=g(b.rY)),b}},i.TO_ABS=e,i.TO_REL=function(){return n(function(s,g,b){return s.relative||(s.x1!==void 0&&(s.x1-=g),s.y1!==void 0&&(s.y1-=b),s.x2!==void 0&&(s.x2-=g),s.y2!==void 0&&(s.y2-=b),s.x!==void 0&&(s.x-=g),s.y!==void 0&&(s.y-=b),s.relative=!0),s})},i.NORMALIZE_HVZ=function(s,g,b){return s===void 0&&(s=!0),g===void 0&&(g=!0),b===void 0&&(b=!0),n(function(S,F,D,N,J){if(isNaN(N)&&!(S.type&_i.MOVE_TO))throw new Error("path must start with moveto");return g&&S.type&_i.HORIZ_LINE_TO&&(S.type=_i.LINE_TO,S.y=S.relative?0:D),b&&S.type&_i.VERT_LINE_TO&&(S.type=_i.LINE_TO,S.x=S.relative?0:F),s&&S.type&_i.CLOSE_PATH&&(S.type=_i.LINE_TO,S.x=S.relative?N-F:N,S.y=S.relative?J-D:J),S.type&_i.ARC&&(S.rX===0||S.rY===0)&&(S.type=_i.LINE_TO,delete S.rX,delete S.rY,delete S.xRot,delete S.lArcFlag,delete S.sweepFlag),S})},i.NORMALIZE_ST=t,i.QT_TO_C=r,i.INFO=n,i.SANITIZE=function(s){s===void 0&&(s=0),_h(s);var g=NaN,b=NaN,S=NaN,F=NaN;return n(function(D,N,J,te,he){var ue=Math.abs,fe=!1,ve=0,Se=0;if(D.type&_i.SMOOTH_CURVE_TO&&(ve=isNaN(g)?0:N-g,Se=isNaN(b)?0:J-b),D.type&(_i.CURVE_TO|_i.SMOOTH_CURVE_TO)?(g=D.relative?N+D.x2:D.x2,b=D.relative?J+D.y2:D.y2):(g=NaN,b=NaN),D.type&_i.SMOOTH_QUAD_TO?(S=isNaN(S)?N:2*N-S,F=isNaN(F)?J:2*J-F):D.type&_i.QUAD_TO?(S=D.relative?N+D.x1:D.x1,F=D.relative?J+D.y1:D.y2):(S=NaN,F=NaN),D.type&_i.LINE_COMMANDS||D.type&_i.ARC&&(D.rX===0||D.rY===0||!D.lArcFlag)||D.type&_i.CURVE_TO||D.type&_i.SMOOTH_CURVE_TO||D.type&_i.QUAD_TO||D.type&_i.SMOOTH_QUAD_TO){var Ge=D.x===void 0?0:D.relative?D.x:D.x-N,He=D.y===void 0?0:D.relative?D.y:D.y-J;ve=isNaN(S)?D.x1===void 0?ve:D.relative?D.x:D.x1-N:S-N,Se=isNaN(F)?D.y1===void 0?Se:D.relative?D.y:D.y1-J:F-J;var $e=D.x2===void 0?0:D.relative?D.x:D.x2-N,Ne=D.y2===void 0?0:D.relative?D.y:D.y2-J;ue(Ge)<=s&&ue(He)<=s&&ue(ve)<=s&&ue(Se)<=s&&ue($e)<=s&&ue(Ne)<=s&&(fe=!0)}return D.type&_i.CLOSE_PATH&&ue(N-te)<=s&&ue(J-he)<=s&&(fe=!0),fe?[]:D})},i.MATRIX=o,i.ROTATE=function(s,g,b){g===void 0&&(g=0),b===void 0&&(b=0),_h(s,g,b);var S=Math.sin(s),F=Math.cos(s);return o(F,S,-S,F,g-g*F+b*S,b-g*S-b*F)},i.TRANSLATE=function(s,g){return g===void 0&&(g=0),_h(s,g),o(1,0,0,1,s,g)},i.SCALE=function(s,g){return g===void 0&&(g=s),_h(s,g),o(s,0,0,g,0,0)},i.SKEW_X=function(s){return _h(s),o(1,0,Math.atan(s),1,0,0)},i.SKEW_Y=function(s){return _h(s),o(1,Math.atan(s),0,1,0,0)},i.X_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),_h(s),o(-1,0,0,1,s,0)},i.Y_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),_h(s),o(1,0,0,-1,0,s)},i.A_TO_C=function(){return n(function(s,g,b){return _i.ARC===s.type?function(S,F,D){var N,J,te,he;S.cX||$T(S,F,D);for(var ue=Math.min(S.phi1,S.phi2),fe=Math.max(S.phi1,S.phi2)-ue,ve=Math.ceil(fe/90),Se=new Array(ve),Ge=F,He=D,$e=0;$e<ve;$e++){var Ne=uN(S.phi1,S.phi2,$e/ve),at=uN(S.phi1,S.phi2,($e+1)/ve),rt=at-Ne,Re=4/3*Math.tan(rt*QA/4),Pe=[Math.cos(Ne*QA)-Re*Math.sin(Ne*QA),Math.sin(Ne*QA)+Re*Math.cos(Ne*QA)],Je=Pe[0],Xe=Pe[1],Ct=[Math.cos(at*QA),Math.sin(at*QA)],Et=Ct[0],Mt=Ct[1],vt=[Et+Re*Math.sin(at*QA),Mt-Re*Math.cos(at*QA)],Dt=vt[0],Pt=vt[1];Se[$e]={relative:S.relative,type:_i.CURVE_TO};var Xt=function(Te,Ze){var tt=qT([Te*S.rX,Ze*S.rY],S.xRot),dt=tt[0],pt=tt[1];return[S.cX+dt,S.cY+pt]};N=Xt(Je,Xe),Se[$e].x1=N[0],Se[$e].y1=N[1],J=Xt(Dt,Pt),Se[$e].x2=J[0],Se[$e].y2=J[1],te=Xt(Et,Mt),Se[$e].x=te[0],Se[$e].y=te[1],S.relative&&(Se[$e].x1-=Ge,Se[$e].y1-=He,Se[$e].x2-=Ge,Se[$e].y2-=He,Se[$e].x-=Ge,Se[$e].y-=He),Ge=(he=[Se[$e].x,Se[$e].y])[0],He=he[1]}return Se}(s,s.relative?0:g,s.relative?0:b):s})},i.ANNOTATE_ARCS=function(){return n(function(s,g,b){return s.relative&&(g=0,b=0),_i.ARC===s.type&&$T(s,g,b),s})},i.CLONE=l,i.CALCULATE_BOUNDS=function(){var s=function(D){var N={};for(var J in D)N[J]=D[J];return N},g=e(),b=r(),S=t(),F=n(function(D,N,J){var te=S(b(g(s(D))));function he(Pt){Pt>F.maxX&&(F.maxX=Pt),Pt<F.minX&&(F.minX=Pt)}function ue(Pt){Pt>F.maxY&&(F.maxY=Pt),Pt<F.minY&&(F.minY=Pt)}if(te.type&_i.DRAWING_COMMANDS&&(he(N),ue(J)),te.type&_i.HORIZ_LINE_TO&&he(te.x),te.type&_i.VERT_LINE_TO&&ue(te.y),te.type&_i.LINE_TO&&(he(te.x),ue(te.y)),te.type&_i.CURVE_TO){he(te.x),ue(te.y);for(var fe=0,ve=AN(N,te.x1,te.x2,te.x);fe<ve.length;fe++)0<(Dt=ve[fe])&&1>Dt&&he(dN(N,te.x1,te.x2,te.x,Dt));for(var Se=0,Ge=AN(J,te.y1,te.y2,te.y);Se<Ge.length;Se++)0<(Dt=Ge[Se])&&1>Dt&&ue(dN(J,te.y1,te.y2,te.y,Dt))}if(te.type&_i.ARC){he(te.x),ue(te.y),$T(te,N,J);for(var He=te.xRot/180*Math.PI,$e=Math.cos(He)*te.rX,Ne=Math.sin(He)*te.rX,at=-Math.sin(He)*te.rY,rt=Math.cos(He)*te.rY,Re=te.phi1<te.phi2?[te.phi1,te.phi2]:-180>te.phi2?[te.phi2+360,te.phi1+360]:[te.phi2,te.phi1],Pe=Re[0],Je=Re[1],Xe=function(Pt){var Xt=Pt[0],Te=Pt[1],Ze=180*Math.atan2(Te,Xt)/Math.PI;return Ze<Pe?Ze+360:Ze},Ct=0,Et=cN(at,-$e,0).map(Xe);Ct<Et.length;Ct++)(Dt=Et[Ct])>Pe&&Dt<Je&&he(hN(te.cX,$e,at,Dt));for(var Mt=0,vt=cN(rt,-Ne,0).map(Xe);Mt<vt.length;Mt++){var Dt;(Dt=vt[Mt])>Pe&&Dt<Je&&ue(hN(te.cY,Ne,rt,Dt))}}return D});return F.minX=1/0,F.maxX=-1/0,F.minY=1/0,F.maxY=-1/0,F}})(ca||(ca={}));var vh,fN=function(){function i(){}return i.prototype.round=function(e){return this.transform(ca.ROUND(e))},i.prototype.toAbs=function(){return this.transform(ca.TO_ABS())},i.prototype.toRel=function(){return this.transform(ca.TO_REL())},i.prototype.normalizeHVZ=function(e,t,r){return this.transform(ca.NORMALIZE_HVZ(e,t,r))},i.prototype.normalizeST=function(){return this.transform(ca.NORMALIZE_ST())},i.prototype.qtToC=function(){return this.transform(ca.QT_TO_C())},i.prototype.aToC=function(){return this.transform(ca.A_TO_C())},i.prototype.sanitize=function(e){return this.transform(ca.SANITIZE(e))},i.prototype.translate=function(e,t){return this.transform(ca.TRANSLATE(e,t))},i.prototype.scale=function(e,t){return this.transform(ca.SCALE(e,t))},i.prototype.rotate=function(e,t,r){return this.transform(ca.ROTATE(e,t,r))},i.prototype.matrix=function(e,t,r,n,o,l){return this.transform(ca.MATRIX(e,t,r,n,o,l))},i.prototype.skewX=function(e){return this.transform(ca.SKEW_X(e))},i.prototype.skewY=function(e){return this.transform(ca.SKEW_Y(e))},i.prototype.xSymmetry=function(e){return this.transform(ca.X_AXIS_SYMMETRY(e))},i.prototype.ySymmetry=function(e){return this.transform(ca.Y_AXIS_SYMMETRY(e))},i.prototype.annotateArcs=function(){return this.transform(ca.ANNOTATE_ARCS())},i}(),W1e=function(i){return i===" "||i==="	"||i==="\r"||i===`
`},pN=function(i){return 48<=i.charCodeAt(0)&&i.charCodeAt(0)<=57},X1e=function(i){function e(){var t=i.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return lN(e,i),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,r){var n=this;r===void 0&&(r=[]);for(var o=function(F){r.push(F),n.curArgs.length=0,n.canParseCommandOrComma=!0},l=0;l<t.length;l++){var s=t[l],g=!(this.curCommandType!==_i.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),b=pN(s)&&(this.curNumber==="0"&&s==="0"||g);if(!pN(s)||b)if(s!=="e"&&s!=="E")if(s!=="-"&&s!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(s!=="."||this.curNumberHasExp||this.curNumberHasDecimal||g){if(this.curNumber&&this.curCommandType!==-1){var S=Number(this.curNumber);if(isNaN(S))throw new SyntaxError("Invalid number ending at "+l);if(this.curCommandType===_i.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>S)throw new SyntaxError('Expected positive number, got "'+S+'" at index "'+l+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+l+'"')}this.curArgs.push(S),this.curArgs.length===Z1e[this.curCommandType]&&(_i.HORIZ_LINE_TO===this.curCommandType?o({type:_i.HORIZ_LINE_TO,relative:this.curCommandRelative,x:S}):_i.VERT_LINE_TO===this.curCommandType?o({type:_i.VERT_LINE_TO,relative:this.curCommandRelative,y:S}):this.curCommandType===_i.MOVE_TO||this.curCommandType===_i.LINE_TO||this.curCommandType===_i.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),_i.MOVE_TO===this.curCommandType&&(this.curCommandType=_i.LINE_TO)):this.curCommandType===_i.CURVE_TO?o({type:_i.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===_i.SMOOTH_CURVE_TO?o({type:_i.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===_i.QUAD_TO?o({type:_i.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===_i.ARC&&o({type:_i.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!W1e(s))if(s===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(s!=="+"&&s!=="-"&&s!==".")if(b)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+l+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+l+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,s!=="z"&&s!=="Z")if(s==="h"||s==="H")this.curCommandType=_i.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=_i.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=_i.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=_i.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=_i.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=_i.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=_i.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=_i.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else{if(s!=="a"&&s!=="A")throw new SyntaxError('Unexpected character "'+s+'" at index '+l+".");this.curCommandType=_i.ARC,this.curCommandRelative=s==="a"}else r.push({type:_i.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal=s==="."}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return r},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(r,n){n===void 0&&(n=[]);for(var o=0,l=Object.getPrototypeOf(this).parse.call(this,r);o<l.length;o++){var s=l[o],g=t(s);Array.isArray(g)?n.push.apply(n,g):n.push(g)}return n}}})},e}(fN),_i=function(i){function e(t){var r=i.call(this)||this;return r.commands=typeof t=="string"?e.parse(t):t,r}return lN(e,i),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=ca.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var r=[],n=0,o=this.commands;n<o.length;n++){var l=t(o[n]);Array.isArray(l)?r.push.apply(r,l):r.push(l)}return this.commands=r,this},e.encode=function(t){return K1e(t)},e.parse=function(t){var r=new X1e,n=[];return r.parse(t,n),r.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(fN),Z1e=((vh={})[_i.MOVE_TO]=2,vh[_i.LINE_TO]=2,vh[_i.HORIZ_LINE_TO]=1,vh[_i.VERT_LINE_TO]=1,vh[_i.CLOSE_PATH]=0,vh[_i.QUAD_TO]=4,vh[_i.SMOOTH_QUAD_TO]=2,vh[_i.CURVE_TO]=6,vh[_i.SMOOTH_CURVE_TO]=4,vh[_i.ARC]=7,vh),J1e=cl,Y1e=yh,eve=fb,tve=GU,gN=RegExp.prototype,ive=function(i){var e=i.flags;return e===void 0&&!("flags"in gN)&&!Y1e(i,"flags")&&eve(gN,i)?J1e(tve,i):e},rve=bb.PROPER,nve=Vf,sve=Ol,mN=nA,ove=Ko,ave=ive,KT="toString",lve=RegExp.prototype,yN=lve[KT],cve=ove(function(){return yN.call({source:"a",flags:"b"})!="/a/b"}),uve=rve&&yN.name!=KT;(cve||uve)&&nve(RegExp.prototype,KT,function(){var i=sve(this),e=mN(i.source),t=mN(ave(i));return"/"+e+"/"+t},{unsafe:!0});function Jb(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Jb=function(e){return typeof e}:Jb=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jb(i)}function hve(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Ave=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],dve=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function fve(i,e,t,r,n){if(typeof i=="string"&&(i=document.getElementById(i)),!i||Jb(i)!=="object"||!("getContext"in i))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=i.getContext("2d");try{return o.getImageData(e,t,r,n)}catch(l){throw new Error("unable to access image data: "+l)}}function pve(i,e,t,r,n,o){if(!(isNaN(o)||o<1)){o|=0;var l=fve(i,e,t,r,n);l=gve(l,e,t,r,n,o),i.getContext("2d").putImageData(l,e,t)}}function gve(i,e,t,r,n,o){for(var l=i.data,s=2*o+1,g=r-1,b=n-1,S=o+1,F=S*(S+1)/2,D=new _N,N=D,J,te=1;te<s;te++)N=N.next=new _N,te===S&&(J=N);N.next=D;for(var he=null,ue=null,fe=0,ve=0,Se=Ave[o],Ge=dve[o],He=0;He<n;He++){N=D;for(var $e=l[ve],Ne=l[ve+1],at=l[ve+2],rt=l[ve+3],Re=0;Re<S;Re++)N.r=$e,N.g=Ne,N.b=at,N.a=rt,N=N.next;for(var Pe=0,Je=0,Xe=0,Ct=0,Et=S*$e,Mt=S*Ne,vt=S*at,Dt=S*rt,Pt=F*$e,Xt=F*Ne,Te=F*at,Ze=F*rt,tt=1;tt<S;tt++){var dt=ve+((g<tt?g:tt)<<2),pt=l[dt],Bt=l[dt+1],Ft=l[dt+2],Lt=l[dt+3],Gt=S-tt;Pt+=(N.r=pt)*Gt,Xt+=(N.g=Bt)*Gt,Te+=(N.b=Ft)*Gt,Ze+=(N.a=Lt)*Gt,Pe+=pt,Je+=Bt,Xe+=Ft,Ct+=Lt,N=N.next}he=D,ue=J;for(var ri=0;ri<r;ri++){var mi=Ze*Se>>Ge;if(l[ve+3]=mi,mi!==0){var yi=255/mi;l[ve]=(Pt*Se>>Ge)*yi,l[ve+1]=(Xt*Se>>Ge)*yi,l[ve+2]=(Te*Se>>Ge)*yi}else l[ve]=l[ve+1]=l[ve+2]=0;Pt-=Et,Xt-=Mt,Te-=vt,Ze-=Dt,Et-=he.r,Mt-=he.g,vt-=he.b,Dt-=he.a;var Pi=ri+o+1;Pi=fe+(Pi<g?Pi:g)<<2,Pe+=he.r=l[Pi],Je+=he.g=l[Pi+1],Xe+=he.b=l[Pi+2],Ct+=he.a=l[Pi+3],Pt+=Pe,Xt+=Je,Te+=Xe,Ze+=Ct,he=he.next;var Ot=ue,lt=Ot.r,wt=Ot.g,ki=Ot.b,ti=Ot.a;Et+=lt,Mt+=wt,vt+=ki,Dt+=ti,Pe-=lt,Je-=wt,Xe-=ki,Ct-=ti,ue=ue.next,ve+=4}fe+=r}for(var ht=0;ht<r;ht++){ve=ht<<2;var qt=l[ve],si=l[ve+1],fi=l[ve+2],ci=l[ve+3],Wi=S*qt,ir=S*si,dr=S*fi,Sr=S*ci,zt=F*qt,Yi=F*si,ui=F*fi,Kt=F*ci;N=D;for(var Ji=0;Ji<S;Ji++)N.r=qt,N.g=si,N.b=fi,N.a=ci,N=N.next;for(var Vt=r,Ci=0,Li=0,jt=0,bi=0,Yt=1;Yt<=o;Yt++){ve=Vt+ht<<2;var yr=S-Yt;zt+=(N.r=qt=l[ve])*yr,Yi+=(N.g=si=l[ve+1])*yr,ui+=(N.b=fi=l[ve+2])*yr,Kt+=(N.a=ci=l[ve+3])*yr,bi+=qt,Ci+=si,Li+=fi,jt+=ci,N=N.next,Yt<b&&(Vt+=r)}ve=ht,he=D,ue=J;for(var Tr=0;Tr<n;Tr++){var Qe=ve<<2;l[Qe+3]=ci=Kt*Se>>Ge,ci>0?(ci=255/ci,l[Qe]=(zt*Se>>Ge)*ci,l[Qe+1]=(Yi*Se>>Ge)*ci,l[Qe+2]=(ui*Se>>Ge)*ci):l[Qe]=l[Qe+1]=l[Qe+2]=0,zt-=Wi,Yi-=ir,ui-=dr,Kt-=Sr,Wi-=he.r,ir-=he.g,dr-=he.b,Sr-=he.a,Qe=ht+((Qe=Tr+S)<b?Qe:b)*r<<2,zt+=bi+=he.r=l[Qe],Yi+=Ci+=he.g=l[Qe+1],ui+=Li+=he.b=l[Qe+2],Kt+=jt+=he.a=l[Qe+3],he=he.next,Wi+=qt=ue.r,ir+=si=ue.g,dr+=fi=ue.b,Sr+=ci=ue.a,bi-=qt,Ci-=si,Li-=fi,jt-=ci,ue=ue.next,ve+=r}}return i}var _N=function i(){hve(this,i),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function mve(){var{DOMParser:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:i,createCanvas(t,r){return new OffscreenCanvas(t,r)},createImage(t){return NA(function*(){var r=yield fetch(t),n=yield r.blob(),o=yield createImageBitmap(n);return o})()}};return(typeof DOMParser<"u"||typeof i>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function yve(i){var{DOMParser:e,canvas:t,fetch:r}=i;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:r,createCanvas:t.createCanvas,createImage:t.loadImage}}var _ve=Object.freeze({__proto__:null,offscreen:mve,node:yve});function Kf(i){return i.replace(/(?!\u3000)\s+/gm," ")}function vN(i){return i.replace(/^[\n \t]+/,"")}function bN(i){return i.replace(/[\n \t]+$/,"")}function Fc(i){var e=(i||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var vve=/^[A-Z-]+$/;function xN(i){return vve.test(i)?i.toLowerCase():i}function WT(i){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(i)||[];return e[2]||e[3]||e[4]}function wN(i){if(!i.startsWith("rgb"))return i;var e=3,t=i.replace(/\d+(\.\d+)?/g,(r,n)=>e--&&n?String(Math.round(parseFloat(r))):r);return t}var bve=/(\[[^\]]+\])/g,xve=/(#[^\s+>~.[:]+)/g,wve=/(\.[^\s+>~.[:]+)/g,Bve=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Cve=/(:[\w-]+\([^)]*\))/gi,Eve=/(:[^\s+>~.[:]+)/g,Sve=/([^\s+>~.[:]+)/g;function Wf(i,e){var t=e.exec(i);return t?[i.replace(e," "),t.length]:[i,0]}function BN(i){var e=[0,0,0],t=i.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),r=0;return[t,r]=Wf(t,bve),e[1]+=r,[t,r]=Wf(t,xve),e[0]+=r,[t,r]=Wf(t,wve),e[1]+=r,[t,r]=Wf(t,Bve),e[2]+=r,[t,r]=Wf(t,Cve),e[1]+=r,[t,r]=Wf(t,Eve),e[1]+=r,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,r]=Wf(t,Sve),e[2]+=r,e.join("")}var Xf=1e-8;function XT(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))}function Yb(i,e){return(i[0]*e[0]+i[1]*e[1])/(XT(i)*XT(e))}function ZT(i,e){return(i[0]*e[1]<i[1]*e[0]?-1:1)*Math.acos(Yb(i,e))}function JT(i){return i*i*i}function YT(i){return 3*i*i*(1-i)}function eI(i){return 3*i*(1-i)*(1-i)}function tI(i){return(1-i)*(1-i)*(1-i)}function iI(i){return i*i}function rI(i){return 2*i*(1-i)}function nI(i){return(1-i)*(1-i)}class Br{constructor(e,t,r){this.document=e,this.name=t,this.value=r,this.isNormalizedColor=!1}static empty(e){return new Br(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:r}=this;return Kf(this.getString()).trim().split(e).map(n=>new Br(t,r,n))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,r=typeof t=="string";return!r||!e?r:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,r=parseFloat(t);return this.isString(/%$/)&&(r/=100),r}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=wN(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[r,n]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&n):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(r);default:{var l=this.getNumber();return t&&l<1?l*o.computeSize(r):l}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var r=this.getDefinition();if(!r)return null;if(typeof r.createGradient=="function")return r.createGradient(this.document.ctx,e,t);if(typeof r.createPattern=="function"){if(r.getHrefAttribute().hasValue()){var n=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),n.hasValue()&&r.getAttribute("patternTransform",!0).setValue(n.value)}return r.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?Br.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),r=t.length,n=0,o=0;o<r&&(t[o]===","&&n++,n!==3);o++);if(e.hasValue()&&this.isString()&&n!==3){var l=new GT(t);l.ok&&(l.alpha=e.getNumber(),t=l.toRGBA())}return new Br(this.document,this.name,t)}}Br.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class CN{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class So{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[r=t,n=t]=Fc(e);return new So(r,n)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[r=t,n=r]=Fc(e);return new So(r,n)}static parsePath(e){for(var t=Fc(e),r=t.length,n=[],o=0;o<r;o+=2)n.push(new So(t[o],t[o+1]));return n}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:r}=this,n=t*e[0]+r*e[2]+e[4],o=t*e[1]+r*e[3]+e[5];this.x=n,this.y=o}}class EN{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:r}=this,n=e.ctx.canvas;n.onclick=t,n.onmousemove=r,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:r}=this,{style:n}=e.ctx.canvas;n&&(n.cursor=""),t.forEach((o,l)=>{for(var{run:s}=o,g=r[l];g;)s(g),g=g.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInPath&&t.isPointInPath(s,g)&&(n[l]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInBox(s,g)&&(n[l]=e)})}}mapXY(e,t){for(var{window:r,ctx:n}=this.screen,o=new So(e,t),l=n.canvas;l;)o.x-=l.offsetLeft,o.y-=l.offsetTop,l=l.offsetParent;return r.scrollX&&(o.x+=r.scrollX),r.scrollY&&(o.y+=r.scrollY),o}onClick(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:r,run(n){n.onClick&&n.onClick()}})}onMouseMove(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:r,run(n){n.onMouseMove&&n.onMouseMove()}})}}var SN=typeof window<"u"?window:null,TN=typeof fetch<"u"?fetch.bind(void 0):null;class D0{constructor(e){var{fetch:t=TN,window:r=SN}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new CN,this.mouse=new EN(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=r,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:r,aspectRatio:n,width:o,desiredWidth:l,height:s,desiredHeight:g,minX:b=0,minY:S=0,refX:F,refY:D,clip:N=!1,clipX:J=0,clipY:te=0}=e,he=Kf(n).replace(/^defer\s/,""),[ue,fe]=he.split(" "),ve=ue||"xMidYMid",Se=fe||"meet",Ge=o/l,He=s/g,$e=Math.min(Ge,He),Ne=Math.max(Ge,He),at=l,rt=g;Se==="meet"&&(at*=$e,rt*=$e),Se==="slice"&&(at*=Ne,rt*=Ne);var Re=new Br(t,"refX",F),Pe=new Br(t,"refY",D),Je=Re.hasValue()&&Pe.hasValue();if(Je&&r.translate(-$e*Re.getPixels("x"),-$e*Pe.getPixels("y")),N){var Xe=$e*J,Ct=$e*te;r.beginPath(),r.moveTo(Xe,Ct),r.lineTo(o,Ct),r.lineTo(o,s),r.lineTo(Xe,s),r.closePath(),r.clip()}if(!Je){var Et=Se==="meet"&&$e===He,Mt=Se==="slice"&&Ne===He,vt=Se==="meet"&&$e===Ge,Dt=Se==="slice"&&Ne===Ge;ve.startsWith("xMid")&&(Et||Mt)&&r.translate(o/2-at/2,0),ve.endsWith("YMid")&&(vt||Dt)&&r.translate(0,s/2-rt/2),ve.startsWith("xMax")&&(Et||Mt)&&r.translate(o-at,0),ve.endsWith("YMax")&&(vt||Dt)&&r.translate(0,s-rt)}switch(!0){case ve==="none":r.scale(Ge,He);break;case Se==="meet":r.scale($e,$e);break;case Se==="slice":r.scale(Ne,Ne);break}r.translate(-b,-S)}start(e){var{enableRedraw:t=!1,ignoreMouse:r=!1,ignoreAnimation:n=!1,ignoreDimensions:o=!1,ignoreClear:l=!1,forceRedraw:s,scaleWidth:g,scaleHeight:b,offsetX:S,offsetY:F}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:D,mouse:N}=this,J=1e3/D;if(this.frameDuration=J,this.readyPromise=new Promise(ve=>{this.resolveReady=ve}),this.isReady()&&this.render(e,o,l,g,b,S,F),!!t){var te=Date.now(),he=te,ue=0,fe=()=>{te=Date.now(),ue=te-he,ue>=J&&(he=te-ue%J,this.shouldUpdate(n,s)&&(this.render(e,o,l,g,b,S,F),N.runEvents())),this.intervalId=QT(fe)};r||N.start(),this.intervalId=QT(fe)}}stop(){this.intervalId&&(QT.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:r}=this,n=this.animations.reduce((o,l)=>l.update(r)||o,!1);if(n)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,r,n,o,l,s){var{CLIENT_WIDTH:g,CLIENT_HEIGHT:b,viewPort:S,ctx:F,isFirstRender:D}=this,N=F.canvas;S.clear(),N.width&&N.height?S.setCurrent(N.width,N.height):S.setCurrent(g,b);var J=e.getStyle("width"),te=e.getStyle("height");!t&&(D||typeof n!="number"&&typeof o!="number")&&(J.hasValue()&&(N.width=J.getPixels("x"),N.style&&(N.style.width="".concat(N.width,"px"))),te.hasValue()&&(N.height=te.getPixels("y"),N.style&&(N.style.height="".concat(N.height,"px"))));var he=N.clientWidth||N.width,ue=N.clientHeight||N.height;if(t&&J.hasValue()&&te.hasValue()&&(he=J.getPixels("x"),ue=te.getPixels("y")),S.setCurrent(he,ue),typeof l=="number"&&e.getAttribute("x",!0).setValue(l),typeof s=="number"&&e.getAttribute("y",!0).setValue(s),typeof n=="number"||typeof o=="number"){var fe=Fc(e.getAttribute("viewBox").getString()),ve=0,Se=0;if(typeof n=="number"){var Ge=e.getStyle("width");Ge.hasValue()?ve=Ge.getPixels("x")/n:isNaN(fe[2])||(ve=fe[2]/n)}if(typeof o=="number"){var He=e.getStyle("height");He.hasValue()?Se=He.getPixels("y")/o:isNaN(fe[3])||(Se=fe[3]/o)}ve||(ve=Se),Se||(Se=ve),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var $e=e.getStyle("transform",!0,!0);$e.setValue("".concat($e.getString()," scale(").concat(1/ve,", ").concat(1/Se,")"))}r||F.clearRect(0,0,he,ue),e.render(F),D&&(this.isFirstRender=!1)}}D0.defaultWindow=SN,D0.defaultFetch=TN;var{defaultFetch:Tve}=D0,Ive=typeof DOMParser<"u"?DOMParser:null;class ex{constructor(){var{fetch:e=Tve,DOMParser:t=Ive}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return NA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return NA(function*(){var r=yield t.fetch(e),n=yield r.text();return t.parseFromString(n)})()}}class IN{constructor(e,t){this.type="translate",this.point=null,this.point=So.parse(t)}apply(e){var{x:t,y:r}=this.point;e.translate(t||0,r||0)}unapply(e){var{x:t,y:r}=this.point;e.translate(-1*t||0,-1*r||0)}applyToPoint(e){var{x:t,y:r}=this.point;e.applyTransform([1,0,0,1,t||0,r||0])}}class LN{constructor(e,t,r){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var n=Fc(t);this.angle=new Br(e,"angle",n[0]),this.originX=r[0],this.originY=r[1],this.cx=n[1]||0,this.cy=n[2]||0}apply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(l.getRadians()),e.translate(-s,-g)}unapply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(-1*l.getRadians()),e.translate(-s,-g)}applyToPoint(e){var{cx:t,cy:r,angle:n}=this,o=n.getRadians();e.applyTransform([1,0,0,1,t||0,r||0]),e.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),e.applyTransform([1,0,0,1,-t||0,-r||0])}}class MN{constructor(e,t,r){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var n=So.parseScale(t);(n.x===0||n.y===0)&&(n.x=Xf,n.y=Xf),this.scale=n,this.originX=r[0],this.originY=r[1]}apply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(t,r||t),e.translate(-l,-s)}unapply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(1/t,1/r||t),e.translate(-l,-s)}applyToPoint(e){var{x:t,y:r}=this.scale;e.applyTransform([t||0,0,0,r||0,0,0])}}class sI{constructor(e,t,r){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=Fc(t),this.originX=r[0],this.originY=r[1]}apply(e){var{originX:t,originY:r,matrix:n}=this,o=t.getPixels("x"),l=r.getPixels("y");e.translate(o,l),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.translate(-o,-l)}unapply(e){var{originX:t,originY:r,matrix:n}=this,o=n[0],l=n[2],s=n[4],g=n[1],b=n[3],S=n[5],F=0,D=0,N=1,J=1/(o*(b*N-S*D)-l*(g*N-S*F)+s*(g*D-b*F)),te=t.getPixels("x"),he=r.getPixels("y");e.translate(te,he),e.transform(J*(b*N-S*D),J*(S*F-g*N),J*(s*D-l*N),J*(o*N-s*F),J*(l*S-s*b),J*(s*g-o*S)),e.translate(-te,-he)}applyToPoint(e){e.applyTransform(this.matrix)}}class oI extends sI{constructor(e,t,r){super(e,t,r),this.type="skew",this.angle=null,this.angle=new Br(e,"angle",t)}}class PN extends oI{constructor(e,t,r){super(e,t,r),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class FN extends oI{constructor(e,t,r){super(e,t,r),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function Lve(i){return Kf(i).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Mve(i){var[e,t]=i.split("(");return[e.trim(),t.trim().replace(")","")]}class Dd{constructor(e,t,r){this.document=e,this.transforms=[];var n=Lve(t);n.forEach(o=>{if(o!=="none"){var[l,s]=Mve(o),g=Dd.transformTypes[l];typeof g<"u"&&this.transforms.push(new g(this.document,s,r))}})}static fromElement(e,t){var r=t.getStyle("transform",!1,!0),[n,o=n]=t.getStyle("transform-origin",!1,!0).split(),l=[n,o];return r.hasValue()?new Dd(e,r.getString(),l):null}apply(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].apply(e)}unapply(e){for(var{transforms:t}=this,r=t.length,n=r-1;n>=0;n--)t[n].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].applyToPoint(e)}}Dd.transformTypes={translate:IN,rotate:LN,scale:MN,matrix:sI,skewX:PN,skewY:FN};class Gs{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=r,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(s=>{var g=xN(s.nodeName);this.attributes[g]=new Br(e,g,s.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var n=this.getAttribute("style").getString().split(";").map(s=>s.trim());n.forEach(s=>{if(s){var[g,b]=s.split(":").map(S=>S.trim());this.styles[g]=new Br(e,g,b)}})}var{definitions:o}=e,l=this.getAttribute("id");l.hasValue()&&(o[l.getString()]||(o[l.getString()]=this)),Array.from(t.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(r&&(s.nodeType===3||s.nodeType===4)){var g=e.createTextNode(s);g.getText().length>0&&this.addChild(g)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.attributes[e];if(!r&&t){var n=new Br(this.document,e,"");return this.attributes[e]=n,n}return r||Br.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return Br.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o!=null&&o.hasValue())return this.styles[e]=o,o;if(!r){var{parent:l}=this;if(l){var s=l.getStyle(e);if(s!=null&&s.hasValue())return s}}if(t){var g=new Br(this.document,e,"");return this.styles[e]=g,g}return n||Br.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var r=this.getStyle("filter").getDefinition();r&&(this.applyEffects(e),r.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=Dd.fromElement(this.document,this);t&&t.apply(e);var r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){var n=r.getDefinition();n&&n.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Gs?e:this.document.createElement(e);t.parent=this,Gs.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:r}=this;if(typeof r.matches=="function")return r.matches(e);var n=(t=r.getAttribute)===null||t===void 0?void 0:t.call(r,"class");return!n||n===""?!1:n.split(" ").some(o=>".".concat(o)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var r in e)if(!r.startsWith("@")&&this.matchesSelector(r)){var n=e[r],o=t[r];if(n)for(var l in n){var s=this.stylesSpecificity[l];typeof s>"u"&&(s="000"),o>=s&&(this.styles[l]=n[l],this.stylesSpecificity[l]=o)}}}removeStyles(e,t){var r=t.reduce((n,o)=>{var l=e.getStyle(o);if(!l.hasValue())return n;var s=l.getString();return l.setValue(""),[...n,[o,s]]},[]);return r}restoreStyles(e,t){t.forEach(r=>{var[n,o]=r;e.getStyle(n,!0).setValue(o)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Gs.ignoreChildTypes=["title"];class DN extends Gs{constructor(e,t,r){super(e,t,r)}}function Pve(i){var e=i.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function Fve(i){return typeof process>"u"?i:i.trim().split(",").map(Pve).join(",")}function Dve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function Rve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Ul{constructor(e,t,r,n,o,l){var s=l?typeof l=="string"?Ul.parse(l):l:{};this.fontFamily=o||s.fontFamily,this.fontSize=n||s.fontSize,this.fontStyle=e||s.fontStyle,this.fontWeight=r||s.fontWeight,this.fontVariant=t||s.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r="",n="",o="",l="",s="",g=Kf(e).trim().split(" "),b={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return g.forEach(S=>{switch(!0){case(!b.fontStyle&&Ul.styles.includes(S)):S!=="inherit"&&(r=S),b.fontStyle=!0;break;case(!b.fontVariant&&Ul.variants.includes(S)):S!=="inherit"&&(n=S),b.fontStyle=!0,b.fontVariant=!0;break;case(!b.fontWeight&&Ul.weights.includes(S)):S!=="inherit"&&(o=S),b.fontStyle=!0,b.fontVariant=!0,b.fontWeight=!0;break;case!b.fontSize:S!=="inherit"&&([l]=S.split("/")),b.fontStyle=!0,b.fontVariant=!0,b.fontWeight=!0,b.fontSize=!0;break;default:S!=="inherit"&&(s+=S)}}),new Ul(r,n,o,l,s,t)}toString(){return[Dve(this.fontStyle),this.fontVariant,Rve(this.fontWeight),this.fontSize,Fve(this.fontFamily)].join(" ").trim()}}Ul.styles="normal|italic|oblique|inherit",Ul.variants="normal|small-caps|inherit",Ul.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class Ru{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=r,this.y2=n,this.addPoint(e,t),this.addPoint(r,n)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:r,x2:n,y2:o}=e;this.addPoint(t,r),this.addPoint(n,o)}}sumCubic(e,t,r,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}bezierCurveAdd(e,t,r,n,o){var l=6*t-12*r+6*n,s=-3*t+9*r-9*n+3*o,g=3*r-3*t;if(s===0){if(l===0)return;var b=-g/l;0<b&&b<1&&(e?this.addX(this.sumCubic(b,t,r,n,o)):this.addY(this.sumCubic(b,t,r,n,o)));return}var S=Math.pow(l,2)-4*g*s;if(!(S<0)){var F=(-l+Math.sqrt(S))/(2*s);0<F&&F<1&&(e?this.addX(this.sumCubic(F,t,r,n,o)):this.addY(this.sumCubic(F,t,r,n,o)));var D=(-l-Math.sqrt(S))/(2*s);0<D&&D<1&&(e?this.addX(this.sumCubic(D,t,r,n,o)):this.addY(this.sumCubic(D,t,r,n,o)))}}addBezierCurve(e,t,r,n,o,l,s,g){this.addPoint(e,t),this.addPoint(s,g),this.bezierCurveAdd(!0,e,r,o,s),this.bezierCurveAdd(!1,t,n,l,g)}addQuadraticCurve(e,t,r,n,o,l){var s=e+.6666666666666666*(r-e),g=t+2/3*(n-t),b=s+1/3*(o-e),S=g+1/3*(l-t);this.addBezierCurve(e,t,s,b,g,S,o,l)}isPointInBox(e,t){var{x1:r,y1:n,x2:o,y2:l}=this;return r<=e&&e<=o&&n<=t&&t<=l}}class en extends _i{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new So(0,0),this.control=new So(0,0),this.current=new So(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",r=new So(this.command[e],this.command[t]);return this.makeAbsolute(r)}getAsControlPoint(e,t){var r=this.getPoint(e,t);return this.control=r,r}getAsCurrentPoint(e,t){var r=this.getPoint(e,t);return this.current=r,r}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==_i.CURVE_TO&&e!==_i.SMOOTH_CURVE_TO&&e!==_i.QUAD_TO&&e!==_i.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:r},control:{x:n,y:o}}=this,l=new So(2*t-n,2*r-o);return l}makeAbsolute(e){if(this.command.relative){var{x:t,y:r}=this.current;e.x+=t,e.y+=r}return e}addMarker(e,t,r){var{points:n,angles:o}=this;r&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(r)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,r=0;r<t;r++)if(!e[r]){for(var n=r+1;n<t;n++)if(e[n]){e[r]=e[n];break}}return e}}class Rd extends Gs{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var r=t.getStyle("opacity",!1,!0);r.hasValue(!0)&&(e*=r.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var r=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),l=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var s=r.getFillStyleDefinition(this,n);s&&(e.fillStyle=s)}else if(r.hasValue()){r.getString()==="currentColor"&&r.setValue(this.getStyle("color").getColor());var g=r.getColor();g!=="inherit"&&(e.fillStyle=g==="none"?"rgba(0,0,0,0)":g)}if(n.hasValue()){var b=new Br(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=b}if(o.isUrlDefinition()){var S=o.getFillStyleDefinition(this,l);S&&(e.strokeStyle=S)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());var F=o.getString();F!=="inherit"&&(e.strokeStyle=F==="none"?"rgba(0,0,0,0)":F)}if(l.hasValue()){var D=new Br(this.document,"stroke",e.strokeStyle).addOpacity(l).getString();e.strokeStyle=D}var N=this.getStyle("stroke-width");if(N.hasValue()){var J=N.getPixels();e.lineWidth=J||Xf}var te=this.getStyle("stroke-linecap"),he=this.getStyle("stroke-linejoin"),ue=this.getStyle("stroke-miterlimit"),fe=this.getStyle("stroke-dasharray"),ve=this.getStyle("stroke-dashoffset");if(te.hasValue()&&(e.lineCap=te.getString()),he.hasValue()&&(e.lineJoin=he.getString()),ue.hasValue()&&(e.miterLimit=ue.getNumber()),fe.hasValue()&&fe.getString()!=="none"){var Se=Fc(fe.getString());typeof e.setLineDash<"u"?e.setLineDash(Se):typeof e.webkitLineDash<"u"?e.webkitLineDash=Se:typeof e.mozDash<"u"&&!(Se.length===1&&Se[0]===0)&&(e.mozDash=Se);var Ge=ve.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=Ge:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=Ge:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=Ge)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var He=this.getStyle("font"),$e=this.getStyle("font-style"),Ne=this.getStyle("font-variant"),at=this.getStyle("font-weight"),rt=this.getStyle("font-size"),Re=this.getStyle("font-family"),Pe=new Ul($e.getString(),Ne.getString(),at.getString(),rt.hasValue()?"".concat(rt.getPixels(!0),"px"):"",Re.getString(),Ul.parse(He.getString(),e.font));$e.setValue(Pe.fontStyle),Ne.setValue(Pe.fontVariant),at.setValue(Pe.fontWeight),rt.setValue(Pe.fontSize),Re.setValue(Pe.fontFamily),e.font=Pe.toString(),rt.isPixels()&&(this.document.emSize=rt.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class us extends Rd{constructor(e,t,r){super(e,t,r),this.type="path",this.pathParser=null,this.pathParser=new en(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,r=new Ru;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case en.MOVE_TO:this.pathM(e,r);break;case en.LINE_TO:this.pathL(e,r);break;case en.HORIZ_LINE_TO:this.pathH(e,r);break;case en.VERT_LINE_TO:this.pathV(e,r);break;case en.CURVE_TO:this.pathC(e,r);break;case en.SMOOTH_CURVE_TO:this.pathS(e,r);break;case en.QUAD_TO:this.pathQ(e,r);break;case en.SMOOTH_QUAD_TO:this.pathT(e,r);break;case en.ARC:this.pathA(e,r);break;case en.CLOSE_PATH:this.pathZ(e,r);break}return r}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),r=e.getMarkerAngles(),n=t.map((o,l)=>[o,r[l]]);return n}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var r=this.getMarkers();if(r){var n=r.length-1,o=this.getStyle("marker-start"),l=this.getStyle("marker-mid"),s=this.getStyle("marker-end");if(o.isUrlDefinition()){var g=o.getDefinition(),[b,S]=r[0];g.render(e,b,S)}if(l.isUrlDefinition())for(var F=l.getDefinition(),D=1;D<n;D++){var[N,J]=r[D];F.render(e,N,J)}if(s.isUrlDefinition()){var te=s.getDefinition(),[he,ue]=r[n];te.render(e,he,ue)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:r}=this,{point:n}=us.pathM(r),{x:o,y:l}=n;r.addMarker(n),t.addPoint(o,l),e&&e.moveTo(o,l)}static pathL(e){var{current:t}=e,r=e.getAsCurrentPoint();return{current:t,point:r}}pathL(e,t){var{pathParser:r}=this,{current:n,point:o}=us.pathL(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathH(e){var{current:t,command:r}=e,n=new So((r.relative?t.x:0)+r.x,t.y);return e.current=n,{current:t,point:n}}pathH(e,t){var{pathParser:r}=this,{current:n,point:o}=us.pathH(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathV(e){var{current:t,command:r}=e,n=new So(t.x,(r.relative?t.y:0)+r.y);return e.current=n,{current:t,point:n}}pathV(e,t){var{pathParser:r}=this,{current:n,point:o}=us.pathV(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathC(e){var{current:t}=e,r=e.getPoint("x1","y1"),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathC(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=us.pathC(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathS(e){var{current:t}=e,r=e.getReflectedControlPoint(),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathS(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=us.pathS(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathQ(e){var{current:t}=e,r=e.getAsControlPoint("x1","y1"),n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathQ(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=us.pathQ(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathT(e){var{current:t}=e,r=e.getReflectedControlPoint();e.control=r;var n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathT(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=us.pathT(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathA(e){var{current:t,command:r}=e,{rX:n,rY:o,xRot:l,lArcFlag:s,sweepFlag:g}=r,b=l*(Math.PI/180),S=e.getAsCurrentPoint(),F=new So(Math.cos(b)*(t.x-S.x)/2+Math.sin(b)*(t.y-S.y)/2,-Math.sin(b)*(t.x-S.x)/2+Math.cos(b)*(t.y-S.y)/2),D=Math.pow(F.x,2)/Math.pow(n,2)+Math.pow(F.y,2)/Math.pow(o,2);D>1&&(n*=Math.sqrt(D),o*=Math.sqrt(D));var N=(s===g?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(F.y,2)-Math.pow(o,2)*Math.pow(F.x,2))/(Math.pow(n,2)*Math.pow(F.y,2)+Math.pow(o,2)*Math.pow(F.x,2)));isNaN(N)&&(N=0);var J=new So(N*n*F.y/o,N*-o*F.x/n),te=new So((t.x+S.x)/2+Math.cos(b)*J.x-Math.sin(b)*J.y,(t.y+S.y)/2+Math.sin(b)*J.x+Math.cos(b)*J.y),he=ZT([1,0],[(F.x-J.x)/n,(F.y-J.y)/o]),ue=[(F.x-J.x)/n,(F.y-J.y)/o],fe=[(-F.x-J.x)/n,(-F.y-J.y)/o],ve=ZT(ue,fe);return Yb(ue,fe)<=-1&&(ve=Math.PI),Yb(ue,fe)>=1&&(ve=0),{currentPoint:S,rX:n,rY:o,sweepFlag:g,xAxisRotation:b,centp:te,a1:he,ad:ve}}pathA(e,t){var{pathParser:r}=this,{currentPoint:n,rX:o,rY:l,sweepFlag:s,xAxisRotation:g,centp:b,a1:S,ad:F}=us.pathA(r),D=1-s?1:-1,N=S+D*(F/2),J=new So(b.x+o*Math.cos(N),b.y+l*Math.sin(N));if(r.addMarkerAngle(J,N-D*Math.PI/2),r.addMarkerAngle(n,N-D*Math.PI),t.addPoint(n.x,n.y),e&&!isNaN(S)&&!isNaN(F)){var te=o>l?o:l,he=o>l?1:o/l,ue=o>l?l/o:1;e.translate(b.x,b.y),e.rotate(g),e.scale(he,ue),e.arc(0,0,te,S,S+F,!!(1-s)),e.scale(1/he,1/ue),e.rotate(-g),e.translate(-b.x,-b.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){us.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class aI extends us{constructor(e,t,r){super(e,t,r),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class VA extends Rd{constructor(e,t,r){super(e,t,new.target===VA?!0:r),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(e.textBaseline=r)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((r,n)=>{var o=this.getChildBoundingBox(e,this,this,n);t?t.addBoundingBox(o):t=o}),t}getFontSize(){var{document:e,parent:t}=this,r=Ul.parse(e.ctx.font).fontSize,n=t.getStyle("font-size").getNumber(r);return n}getTElementBoundingBox(e){var t=this.getFontSize();return new Ru(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,r){var n=t[r],o=null;if(e.isArabic){var l=t.length,s=t[r-1],g=t[r+1],b="isolated";if((r===0||s===" ")&&r<l-1&&g!==" "&&(b="terminal"),r>0&&s!==" "&&r<l-1&&g!==" "&&(b="medial"),r>0&&s!==" "&&(r===l-1||g===" ")&&(b="initial"),typeof e.glyphs[n]<"u"){var S=e.glyphs[n];o=S instanceof aI?S:S[b]}}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}getText(){return""}getTextFromNode(e){var t=e||this.node,r=Array.from(t.parentNode.childNodes),n=r.indexOf(t),o=r.length-1,l=Kf(t.textContent||"");return n===0&&(l=vN(l)),n===o&&(l=bN(l)),l}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((r,n)=>{this.renderChild(e,this,this,n)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:r}=this,n=this.getText(),o=r.getStyle("font-family").getDefinition();if(o){for(var{unitsPerEm:l}=o.fontFace,s=Ul.parse(t.ctx.font),g=r.getStyle("font-size").getNumber(s.fontSize),b=r.getStyle("font-style").getString(s.fontStyle),S=g/l,F=o.isRTL?n.split("").reverse().join(""):n,D=Fc(r.getAttribute("dx").getString()),N=F.length,J=0;J<N;J++){var te=this.getGlyph(o,F,J);e.translate(this.x,this.y),e.scale(S,-S);var he=e.lineWidth;e.lineWidth=e.lineWidth*l/g,b==="italic"&&e.transform(1,0,.4,1,0,0),te.render(e),b==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=he,e.scale(1/S,-1/S),e.translate(-this.x,-this.y),this.x+=g*(te.horizAdvX||o.horizAdvX)/l,typeof D[J]<"u"&&!isNaN(D[J])&&(this.x+=D[J])}return}var{x:ue,y:fe}=this;e.fillStyle&&e.fillText(n,ue,fe),e.strokeStyle&&e.strokeText(n,ue,fe)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),r=!1,n=0;t==="start"&&!r||t==="end"&&r?n=e.x-this.minX:t==="end"&&!r||t==="start"&&r?n=e.x-this.maxX:n=e.x-(this.minX+this.maxX)/2;for(var o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=n;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,r)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,r)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,r,n){var o=r.children[n];o.children.length>0?o.children.forEach((l,s)=>{t.adjustChildCoordinatesRecursiveCore(e,t,o,s)}):this.adjustChildCoordinates(e,t,r,n)}adjustChildCoordinates(e,t,r,n){var o=r.children[n];if(typeof o.measureText!="function")return o;e.save(),o.setContext(e,!0);var l=o.getAttribute("x"),s=o.getAttribute("y"),g=o.getAttribute("dx"),b=o.getAttribute("dy"),S=o.getStyle("font-family").getDefinition(),F=!!S&&S.isRTL;n===0&&(l.hasValue()||l.setValue(o.getInheritedAttribute("x")),s.hasValue()||s.setValue(o.getInheritedAttribute("y")),g.hasValue()||g.setValue(o.getInheritedAttribute("dx")),b.hasValue()||b.setValue(o.getInheritedAttribute("dy")));var D=o.measureText(e);return F&&(t.x-=D),l.hasValue()?(t.applyAnchoring(),o.x=l.getPixels("x"),g.hasValue()&&(o.x+=g.getPixels("x"))):(g.hasValue()&&(t.x+=g.getPixels("x")),o.x=t.x),t.x=o.x,F||(t.x+=D),s.hasValue()?(o.y=s.getPixels("y"),b.hasValue()&&(o.y+=b.getPixels("y"))):(b.hasValue()&&(t.y+=b.getPixels("y")),o.y=t.y),t.y=o.y,t.leafTexts.push(o),t.minX=Math.min(t.minX,o.x,o.x+D),t.maxX=Math.max(t.maxX,o.x,o.x+D),o.clearContext(e),e.restore(),o}getChildBoundingBox(e,t,r,n){var o=r.children[n];if(typeof o.getBoundingBox!="function")return null;var l=o.getBoundingBox(e);return l?(o.children.forEach((s,g)=>{var b=t.getChildBoundingBox(e,t,o,g);l.addBoundingBox(b)}),l):null}renderChild(e,t,r,n){var o=r.children[n];o.render(e),o.children.forEach((l,s)=>{t.renderChild(e,t,o,s)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var r=this.getText(),n=this.measureTargetText(e,r);return this.measureCache=n,n}measureTargetText(e,t){if(!t.length)return 0;var{parent:r}=this,n=r.getStyle("font-family").getDefinition();if(n){for(var o=this.getFontSize(),l=n.isRTL?t.split("").reverse().join(""):t,s=Fc(r.getAttribute("dx").getString()),g=l.length,b=0,S=0;S<g;S++){var F=this.getGlyph(n,l,S);b+=(F.horizAdvX||n.horizAdvX)*o/n.fontFace.unitsPerEm,typeof s[S]<"u"&&!isNaN(s[S])&&(b+=s[S])}return b}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:D}=e.measureText(t);return this.clearContext(e),e.restore(),D}getInheritedAttribute(e){for(var t=this;t instanceof VA&&t.isFirstChild();){var r=t.parent.getAttribute(e);if(r.hasValue(!0))return r.getValue("0");t=t.parent}return null}}class R0 extends VA{constructor(e,t,r){super(e,t,new.target===R0?!0:r),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class kve extends R0{constructor(){super(...arguments),this.type="textNode"}}class hm extends Rd{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:r}=this,{screen:n,window:o}=r,l=e.canvas;if(n.setDefaults(e),l.style&&typeof e.font<"u"&&o&&typeof o.getComputedStyle<"u"){e.font=o.getComputedStyle(l).getPropertyValue("font");var s=new Br(r,"fontSize",Ul.parse(e.font).fontSize);s.hasValue()&&(r.rootEmSize=s.getPixels("y"),r.emSize=r.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:g,height:b}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var S=this.getAttribute("refX"),F=this.getAttribute("refY"),D=this.getAttribute("viewBox"),N=D.hasValue()?Fc(D.getString()):null,J=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",te=0,he=0,ue=0,fe=0;N&&(te=N[0],he=N[1]),this.root||(g=this.getStyle("width").getPixels("x"),b=this.getStyle("height").getPixels("y"),this.type==="marker"&&(ue=te,fe=he,te=0,he=0)),n.viewPort.setCurrent(g,b),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),N&&(g=N[2],b=N[3]),r.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:g,height:n.viewPort.height,desiredHeight:b,minX:te,minY:he,refX:S.getValue(),refY:F.getValue(),clip:J,clipX:ue,clipY:fe}),N&&(n.viewPort.removeCurrent(),n.viewPort.setCurrent(g,b))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.getAttribute("width",!0),o=this.getAttribute("height",!0),l=this.getAttribute("viewBox"),s=this.getAttribute("style"),g=n.getNumber(0),b=o.getNumber(0);if(r)if(typeof r=="string")this.getAttribute("preserveAspectRatio",!0).setValue(r);else{var S=this.getAttribute("preserveAspectRatio");S.hasValue()&&S.setValue(S.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(n.setValue(e),o.setValue(t),l.hasValue()||l.setValue("0 0 ".concat(g||e," ").concat(b||t)),s.hasValue()){var F=this.getStyle("width"),D=this.getStyle("height");F.hasValue()&&F.setValue("".concat(e,"px")),D.hasValue()&&D.setValue("".concat(t,"px"))}}}class lI extends us{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),l=this.getAttribute("rx"),s=this.getAttribute("ry"),g=l.getPixels("x"),b=s.getPixels("y");if(l.hasValue()&&!s.hasValue()&&(b=g),s.hasValue()&&!l.hasValue()&&(g=b),g=Math.min(g,n/2),b=Math.min(b,o/2),e){var S=4*((Math.sqrt(2)-1)/3);e.beginPath(),o>0&&n>0&&(e.moveTo(t+g,r),e.lineTo(t+n-g,r),e.bezierCurveTo(t+n-g+S*g,r,t+n,r+b-S*b,t+n,r+b),e.lineTo(t+n,r+o-b),e.bezierCurveTo(t+n,r+o-b+S*b,t+n-g+S*g,r+o,t+n-g,r+o),e.lineTo(t+g,r+o),e.bezierCurveTo(t+g-S*g,r+o,t,r+o-b+S*b,t,r+o-b),e.lineTo(t,r+b),e.bezierCurveTo(t,r+b-S*b,t+g-S*g,r,t+g,r),e.closePath())}return new Ru(t,r,t+n,r+o)}getMarkers(){return null}}class RN extends us{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,r,n,0,Math.PI*2,!1),e.closePath()),new Ru(t-n,r-n,t+n,r+n)}getMarkers(){return null}}class kN extends us{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),r=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),l=this.getAttribute("cy").getPixels("y");return e&&r>0&&n>0&&(e.beginPath(),e.moveTo(o+r,l),e.bezierCurveTo(o+r,l+t*n,o+t*r,l+n,o,l+n),e.bezierCurveTo(o-t*r,l+n,o-r,l+t*n,o-r,l),e.bezierCurveTo(o-r,l-t*n,o-t*r,l-n,o,l-n),e.bezierCurveTo(o+t*r,l-n,o+r,l-t*n,o+r,l),e.closePath()),new Ru(o-r,l-n,o+r,l+n)}getMarkers(){return null}}class ON extends us{constructor(){super(...arguments),this.type="line"}getPoints(){return[new So(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new So(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:r},{x:n,y:o}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,r),e.lineTo(n,o)),new Ru(t,r,n,o)}getMarkers(){var[e,t]=this.getPoints(),r=e.angleTo(t);return[[e,r],[t,r]]}}class cI extends us{constructor(e,t,r){super(e,t,r),this.type="polyline",this.points=[],this.points=So.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:r,y:n}]=t,o=new Ru(r,n);return e&&(e.beginPath(),e.moveTo(r,n)),t.forEach(l=>{var{x:s,y:g}=l;o.addPoint(s,g),e&&e.lineTo(s,g)}),o}getMarkers(){var{points:e}=this,t=e.length-1,r=[];return e.forEach((n,o)=>{o!==t&&r.push([n,n.angleTo(e[o+1])])}),r.length>0&&r.push([e[e.length-1],r[r.length-1][1]]),r}}class UN extends cI{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:r,y:n}]=this.points;return e&&(e.lineTo(r,n),e.closePath()),t}}class NN extends Gs{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,r){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),l=new hm(this.document,null);l.attributes.viewBox=new Br(this.document,"viewBox",this.getAttribute("viewBox").getValue()),l.attributes.width=new Br(this.document,"width","".concat(n,"px")),l.attributes.height=new Br(this.document,"height","".concat(o,"px")),l.attributes.transform=new Br(this.document,"transform",this.getAttribute("patternTransform").getValue()),l.children=this.children;var s=this.document.createCanvas(n,o),g=s.getContext("2d"),b=this.getAttribute("x"),S=this.getAttribute("y");b.hasValue()&&S.hasValue()&&g.translate(b.getPixels("x",!0),S.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(var F=-1;F<=1;F++)for(var D=-1;D<=1;D++)g.save(),l.attributes.x=new Br(this.document,"x",F*s.width),l.attributes.y=new Br(this.document,"y",D*s.height),l.render(g),g.restore();var N=e.createPattern(s,"repeat");return N}}class zN extends Gs{constructor(){super(...arguments),this.type="marker"}render(e,t,r){if(t){var{x:n,y:o}=t,l=this.getAttribute("orient").getString("auto"),s=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(n,o),l==="auto"&&e.rotate(r),s==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var g=new hm(this.document,null);g.type=this.type,g.attributes.viewBox=new Br(this.document,"viewBox",this.getAttribute("viewBox").getValue()),g.attributes.refX=new Br(this.document,"refX",this.getAttribute("refX").getValue()),g.attributes.refY=new Br(this.document,"refY",this.getAttribute("refY").getValue()),g.attributes.width=new Br(this.document,"width",this.getAttribute("markerWidth").getValue()),g.attributes.height=new Br(this.document,"height",this.getAttribute("markerHeight").getValue()),g.attributes.overflow=new Br(this.document,"overflow",this.getAttribute("overflow").getValue()),g.attributes.fill=new Br(this.document,"fill",this.getAttribute("fill").getColor("black")),g.attributes.stroke=new Br(this.document,"stroke",this.getAttribute("stroke").getValue("none")),g.children=this.children,g.render(e),e.restore(),s==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),l==="auto"&&e.rotate(-r),e.translate(-n,-o)}}}class QN extends Gs{constructor(){super(...arguments),this.type="defs"}render(){}}class tx extends Rd{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new Ru;return this.children.forEach(r=>{t.addBoundingBox(r.getBoundingBox(e))}),t}}class uI extends Gs{constructor(e,t,r){super(e,t,r),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:n,children:o}=this;o.forEach(l=>{l.type==="stop"&&n.push(l)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,r){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var{stops:o}=n,l=this.getGradient(e,t);if(!l)return this.addParentOpacity(r,o[o.length-1].color);if(o.forEach(he=>{l.addColorStop(he.offset,this.addParentOpacity(r,he.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:s}=this,{MAX_VIRTUAL_PIXELS:g,viewPort:b}=s.screen,[S]=b.viewPorts,F=new lI(s,null);F.attributes.x=new Br(s,"x",-g/3),F.attributes.y=new Br(s,"y",-g/3),F.attributes.width=new Br(s,"width",g),F.attributes.height=new Br(s,"height",g);var D=new tx(s,null);D.attributes.transform=new Br(s,"transform",this.getAttribute("gradientTransform").getValue()),D.children=[F];var N=new hm(s,null);N.attributes.x=new Br(s,"x",0),N.attributes.y=new Br(s,"y",0),N.attributes.width=new Br(s,"width",S.width),N.attributes.height=new Br(s,"height",S.height),N.children=[D];var J=s.createCanvas(S.width,S.height),te=J.getContext("2d");return te.fillStyle=l,N.render(te),te.createPattern(J,"no-repeat")}return l}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var r=new Br(this.document,"color",t);return r.addOpacity(e).getColor()}return t}}class VN extends uI{constructor(e,t,r){super(e,t,r),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=r?t.getBoundingBox(e):null;if(r&&!n)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=r?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),l=r?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),s=r?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),g=r?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===s&&l===g?null:e.createLinearGradient(o,l,s,g)}}class HN extends uI{constructor(e,t,r){super(e,t,r),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=t.getBoundingBox(e);if(r&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=r?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),l=r?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),s=o,g=l;this.getAttribute("fx").hasValue()&&(s=r?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(g=r?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var b=r?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),S=this.getAttribute("fr").getPixels();return e.createRadialGradient(s,g,S,o,l,b)}}class GN extends Gs{constructor(e,t,r){super(e,t,r),this.type="stop";var n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),l=this.getStyle("stop-color",!0);l.getString()===""&&l.setValue("#000"),o.hasValue()&&(l=l.addOpacity(o)),this.offset=n,this.color=l.getColor()}}class ix extends Gs{constructor(e,t,r){super(e,t,r),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Br(e,"values",null);var n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:r,to:n}=this.getProgress(),o=r.getNumber()+(n.getNumber()-r.getNumber())*t;return e==="%"&&(o*=100),"".concat(o).concat(e)}update(e){var{parent:t}=this,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(n==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=r.getString();else if(n==="remove"&&!this.removed)return this.removed=!0,r.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var l=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){var g=s.getString();l="".concat(g,"(").concat(l,")")}r.setValue(l),o=!0}return o}getProgress(){var{document:e,values:t}=this,r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=r.progress*(t.getValue().length-1),o=Math.floor(n),l=Math.ceil(n);r.from=new Br(e,"from",parseFloat(t.getValue()[o])),r.to=new Br(e,"to",parseFloat(t.getValue()[l])),r.progress=(n-o)/(l-o)}else r.from=this.from,r.to=this.to;return r}}class jN extends ix{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=new GT(t.getColor()),o=new GT(r.getColor());if(n.ok&&o.ok){var l=n.r+(o.r-n.r)*e,s=n.g+(o.g-n.g)*e,g=n.b+(o.b-n.b)*e;return"rgb(".concat(Math.floor(l),", ").concat(Math.floor(s),", ").concat(Math.floor(g),")")}return this.getAttribute("from").getColor()}}class qN extends ix{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=Fc(t.getString()),o=Fc(r.getString()),l=n.map((s,g)=>{var b=o[g];return s+(b-s)*e}).join(" ");return l}}class $N extends Gs{constructor(e,t,r){super(e,t,r),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:n}=e,{children:o}=this;for(var l of o)switch(l.type){case"font-face":{this.fontFace=l;var s=l.getStyle("font-family");s.hasValue()&&(n[s.getString()]=this);break}case"missing-glyph":this.missingGlyph=l;break;case"glyph":{var g=l;g.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[g.unicode]>"u"&&(this.glyphs[g.unicode]={}),this.glyphs[g.unicode][g.arabicForm]=g):this.glyphs[g.unicode]=g;break}}}render(){}}class KN extends Gs{constructor(e,t,r){super(e,t,r),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class WN extends us{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class XN extends VA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class ZN extends VA{constructor(e,t,r){super(e,t,r),this.type="a";var{childNodes:n}=t,o=n[0],l=n.length>0&&Array.from(n).every(s=>s.nodeType===3);this.hasText=l,this.text=l?this.getTextFromNode(o):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:r,y:n}=this,{mouse:o}=t.screen,l=new Br(t,"fontSize",Ul.parse(t.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new Ru(r,n-l.getPixels("y"),r+this.measureText(e),n))}else if(this.children.length>0){var s=new tx(this.document,null);s.children=this.children,s.parent=this,s.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function JN(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function rx(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?JN(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):JN(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class YN extends VA{constructor(e,t,r){super(e,t,r),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(n)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(r=>{var{type:n,points:o}=r;switch(n){case en.LINE_TO:e&&e.lineTo(o[0],o[1]);break;case en.MOVE_TO:e&&e.moveTo(o[0],o[1]);break;case en.CURVE_TO:e&&e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case en.QUAD_TO:e&&e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case en.ARC:{var[l,s,g,b,S,F,D,N]=o,J=g>b?g:b,te=g>b?1:g/b,he=g>b?b/g:1;e&&(e.translate(l,s),e.rotate(D),e.scale(te,he),e.arc(0,0,J,S,S+F,!!(1-N)),e.scale(1/te,1/he),e.rotate(-D),e.translate(-l,-s));break}case en.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),{glyphInfo:n}=this,o=e.fillStyle;t==="underline"&&e.beginPath(),n.forEach((l,s)=>{var{p0:g,p1:b,rotation:S,text:F}=l;e.save(),e.translate(g.x,g.y),e.rotate(S),e.fillStyle&&e.fillText(F,0,0),e.strokeStyle&&e.strokeText(F,0,0),e.restore(),t==="underline"&&(s===0&&e.moveTo(g.x,g.y+r/8),e.lineTo(b.x,b.y+r/5))}),t==="underline"&&(e.lineWidth=r/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,r,n,o,l,s,g,b){var S=l,F=this.measureText(e,g);g===" "&&t==="justify"&&r<n&&(F+=(n-r)/o),b>-1&&(S+=this.getLetterSpacingAt(b));var D=this.textHeight/20,N=this.getEquidistantPointOnPath(S,D,0),J=this.getEquidistantPointOnPath(S+F,D,0),te={p0:N,p1:J},he=N&&J?Math.atan2(J.y-N.y,J.x-N.x):0;if(s){var ue=Math.cos(Math.PI/2+he)*s,fe=Math.cos(-he)*s;te.p0=rx(rx({},N),{},{x:N.x+ue,y:N.y+fe}),te.p1=rx(rx({},J),{},{x:J.x+ue,y:J.y+fe})}return S+=F,{offset:S,segment:te,rotation:he}}measureText(e,t){var{measuresCache:r}=this,n=t||this.getText();if(r.has(n))return r.get(n);var o=this.measureTargetText(e,n);return r.set(n,o),o}setTextData(e){if(!this.glyphInfo){var t=this.getText(),r=t.split(""),n=t.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(Se=>Se.getPixels("x")),l=this.parent.getAttribute("dy").getPixels("y"),s=this.parent.getStyle("text-anchor").getString("start"),g=this.getStyle("letter-spacing"),b=this.parent.getStyle("letter-spacing"),S=0;!g.hasValue()||g.getValue()==="inherit"?S=b.getPixels():g.hasValue()&&g.getValue()!=="initial"&&g.getValue()!=="unset"&&(S=g.getPixels());var F=[],D=t.length;this.letterSpacingCache=F;for(var N=0;N<D;N++)F.push(typeof o[N]<"u"?o[N]:S);var J=F.reduce((Se,Ge,He)=>He===0?0:Se+Ge||0,0),te=this.measureText(e),he=Math.max(te+J,0);this.textWidth=te,this.textHeight=this.getFontSize(),this.glyphInfo=[];var ue=this.getPathLength(),fe=this.getStyle("startOffset").getNumber(0)*ue,ve=0;(s==="middle"||s==="center")&&(ve=-he/2),(s==="end"||s==="right")&&(ve=-he),ve+=fe,r.forEach((Se,Ge)=>{var{offset:He,segment:$e,rotation:Ne}=this.findSegmentToFitChar(e,s,he,ue,n,ve,l,Se,Ge);ve=He,!(!$e.p0||!$e.p1)&&this.glyphInfo.push({text:r[Ge],p0:$e.p0,p1:$e.p1,rotation:Ne})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:r}=e;for(r.reset();!r.isEnd();){var{current:n}=r,o=n?n.x:0,l=n?n.y:0,s=r.next(),g=s.type,b=[];switch(s.type){case en.MOVE_TO:this.pathM(r,b);break;case en.LINE_TO:g=this.pathL(r,b);break;case en.HORIZ_LINE_TO:g=this.pathH(r,b);break;case en.VERT_LINE_TO:g=this.pathV(r,b);break;case en.CURVE_TO:this.pathC(r,b);break;case en.SMOOTH_CURVE_TO:g=this.pathS(r,b);break;case en.QUAD_TO:this.pathQ(r,b);break;case en.SMOOTH_QUAD_TO:g=this.pathT(r,b);break;case en.ARC:b=this.pathA(r);break;case en.CLOSE_PATH:us.pathZ(r);break}s.type!==en.CLOSE_PATH?t.push({type:g,points:b,start:{x:o,y:l},pathLength:this.calcLength(o,l,g,b)}):t.push({type:en.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:r,y:n}=us.pathM(e).point;t.push(r,n)}pathL(e,t){var{x:r,y:n}=us.pathL(e).point;return t.push(r,n),en.LINE_TO}pathH(e,t){var{x:r,y:n}=us.pathH(e).point;return t.push(r,n),en.LINE_TO}pathV(e,t){var{x:r,y:n}=us.pathV(e).point;return t.push(r,n),en.LINE_TO}pathC(e,t){var{point:r,controlPoint:n,currentPoint:o}=us.pathC(e);t.push(r.x,r.y,n.x,n.y,o.x,o.y)}pathS(e,t){var{point:r,controlPoint:n,currentPoint:o}=us.pathS(e);return t.push(r.x,r.y,n.x,n.y,o.x,o.y),en.CURVE_TO}pathQ(e,t){var{controlPoint:r,currentPoint:n}=us.pathQ(e);t.push(r.x,r.y,n.x,n.y)}pathT(e,t){var{controlPoint:r,currentPoint:n}=us.pathT(e);return t.push(r.x,r.y,n.x,n.y),en.QUAD_TO}pathA(e){var{rX:t,rY:r,sweepFlag:n,xAxisRotation:o,centp:l,a1:s,ad:g}=us.pathA(e);return n===0&&g>0&&(g-=2*Math.PI),n===1&&g<0&&(g+=2*Math.PI),[l.x,l.y,t,r,s,g,o,n]}calcLength(e,t,r,n){var o=0,l=null,s=null,g=0;switch(r){case en.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case en.CURVE_TO:for(o=0,l=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),g=.01;g<=1;g+=.01)s=this.getPointOnCubicBezier(g,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case en.QUAD_TO:for(o=0,l=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),g=.01;g<=1;g+=.01)s=this.getPointOnQuadraticBezier(g,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case en.ARC:{o=0;var b=n[4],S=n[5],F=n[4]+S,D=Math.PI/180;if(Math.abs(b-F)<D&&(D=Math.abs(b-F)),l=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],b,0),S<0)for(g=b-D;g>F;g-=D)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;else for(g=b+D;g<F;g+=D)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],F,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),o}}return 0}getPointOnLine(e,t,r,n,o){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:r,g=(o-r)/(n-t+Xf),b=Math.sqrt(e*e/(1+g*g));n<t&&(b*=-1);var S=g*b,F=null;if(n===t)F={x:l,y:s+S};else if((s-r)/(l-t+Xf)===g)F={x:l+b,y:s+S};else{var D=0,N=0,J=this.getLineLength(t,r,n,o);if(J<Xf)return null;var te=(l-t)*(n-t)+(s-r)*(o-r);te/=J*J,D=t+te*(n-t),N=r+te*(o-r);var he=this.getLineLength(l,s,D,N),ue=Math.sqrt(e*e-he*he);b=Math.sqrt(ue*ue/(1+g*g)),n<t&&(b*=-1),S=g*b,F={x:D+b,y:N+S}}return F}getPointOnPath(e){var t=this.getPathLength(),r=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:o}=this;for(var l of o){if(l&&(l.pathLength<5e-5||r+l.pathLength+5e-5<e)){r+=l.pathLength;continue}var s=e-r,g=0;switch(l.type){case en.LINE_TO:n=this.getPointOnLine(s,l.start.x,l.start.y,l.points[0],l.points[1],l.start.x,l.start.y);break;case en.ARC:{var b=l.points[4],S=l.points[5],F=l.points[4]+S;if(g=b+s/l.pathLength*S,S<0&&g<F||S>=0&&g>F)break;n=this.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],g,l.points[6]);break}case en.CURVE_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnCubicBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);break;case en.QUAD_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnQuadraticBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3]);break}if(n)return n;break}return null}getLineLength(e,t,r,n){return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,r,n,o,l,s,g,b){var S=g*JT(e)+l*YT(e)+n*eI(e)+t*tI(e),F=b*JT(e)+s*YT(e)+o*eI(e)+r*tI(e);return{x:S,y:F}}getPointOnQuadraticBezier(e,t,r,n,o,l,s){var g=l*iI(e)+n*rI(e)+t*nI(e),b=s*iI(e)+o*rI(e)+r*nI(e);return{x:g,y:b}}getPointOnEllipticalArc(e,t,r,n,o,l){var s=Math.cos(l),g=Math.sin(l),b={x:r*Math.cos(o),y:n*Math.sin(o)};return{x:e+(b.x*s-b.y*g),y:t+(b.x*g+b.y*s)}}buildEquidistantCache(e,t){var r=this.getPathLength(),n=t||.25,o=e||r/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var l=0,s=0;s<=r;s+=n){var g=this.getPointOnPath(s),b=this.getPointOnPath(s+n);!g||!b||(l+=this.getLineLength(g.x,g.y,b.x,b.y),l>=o&&(this.equidistantCache.points.push({x:g.x,y:g.y,distance:s}),l-=o))}}}getEquidistantPointOnPath(e,t,r){if(this.buildEquidistantCache(t,r),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}var Ove=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class e8 extends Rd{constructor(e,t,r){super(e,t,r),this.type="image",this.loaded=!1;var n=this.getHrefAttribute().getString();if(n){var o=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);e.images.push(this),o?this.loadSvg(n):this.loadImage(n),this.isSvg=o}}loadImage(e){var t=this;return NA(function*(){try{var r=yield t.document.createImage(e);t.image=r}catch(n){console.error('Error while loading image "'.concat(e,'":'),n)}t.loaded=!0})()}loadSvg(e){var t=this;return NA(function*(){var r=Ove.exec(e);if(r){var n=r[5];r[4]==="base64"?t.image=atob(n):t.image=decodeURIComponent(n)}else try{var o=yield t.document.fetch(e),l=yield o.text();t.image=l}catch(s){console.error('Error while loading image "'.concat(e,'":'),s)}t.loaded=!0})()}renderChildren(e){var{document:t,image:r,loaded:n}=this,o=this.getAttribute("x").getPixels("x"),l=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),g=this.getStyle("height").getPixels("y");if(!(!n||!r||!s||!g)){if(e.save(),e.translate(o,l),this.isSvg){var b=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:s,scaleHeight:g});b.document.documentElement.parent=this,b.render()}else{var S=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:s,desiredWidth:S.width,height:g,desiredHeight:S.height}),this.loaded&&(typeof S.complete>"u"||S.complete)&&e.drawImage(S,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new Ru(e,t,e+r,t+n)}}class t8 extends Rd{constructor(){super(...arguments),this.type="symbol"}render(e){}}class i8{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var r=this;return NA(function*(){try{var{document:n}=r,o=yield n.canvg.parser.load(t),l=o.getElementsByTagName("font");Array.from(l).forEach(s=>{var g=n.createElement(s);n.definitions[e]=g})}catch(s){console.error('Error while loading font "'.concat(t,'":'),s)}r.loaded=!0})()}}class hI extends Gs{constructor(e,t,r){super(e,t,r),this.type="style";var n=Kf(Array.from(t.childNodes).map(l=>l.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),o=n.split("}");o.forEach(l=>{var s=l.trim();if(s){var g=s.split("{"),b=g[0].split(","),S=g[1].split(";");b.forEach(F=>{var D=F.trim();if(D){var N=e.styles[D]||{};if(S.forEach(he=>{var ue=he.indexOf(":"),fe=he.substr(0,ue).trim(),ve=he.substr(ue+1,he.length-ue).trim();fe&&ve&&(N[fe]=new Br(e,fe,ve))}),e.styles[D]=N,e.stylesSpecificity[D]=BN(D),D==="@font-face"){var J=N["font-family"].getString().replace(/"|'/g,""),te=N.src.getString().split(",");te.forEach(he=>{if(he.indexOf('format("svg")')>0){var ue=WT(he);ue&&new i8(e).load(J,ue)}})}}})}})}}hI.parseExternalUrl=WT;class r8 extends Rd{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),r=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),r.hasValue()&&e.translate(0,r.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:r}=this;if(r){var n=r;if(r.type==="symbol"&&(n=new hm(t,null),n.attributes.viewBox=new Br(t,"viewBox",r.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new Br(t,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new Br(t,"overflow",r.getAttribute("overflow").getString()),n.children=r.children,r.styles.opacity=new Br(t,"opacity",this.calculateOpacity())),n.type==="svg"){var o=this.getStyle("width",!1,!0),l=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new Br(t,"width",o.getString())),l.hasValue()&&(n.attributes.height=new Br(t,"height",l.getString()))}var s=n.parent;n.parent=this,n.render(e),n.parent=s}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return Dd.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function nx(i,e,t,r,n,o){return i[t*r*4+e*4+o]}function sx(i,e,t,r,n,o,l){i[t*r*4+e*4+o]=l}function ua(i,e,t){var r=i[e];return r*t}function HA(i,e,t,r){return e+Math.cos(i)*t+Math.sin(i)*r}class AI extends Gs{constructor(e,t,r){super(e,t,r),this.type="feColorMatrix";var n=Fc(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var l=n[0]*Math.PI/180;n=[HA(l,.213,.787,-.213),HA(l,.715,-.715,-.715),HA(l,.072,-.072,.928),0,0,HA(l,.213,-.213,.143),HA(l,.715,.285,.14),HA(l,.072,-.072,-.283),0,0,HA(l,.213,-.213,-.787),HA(l,.715,-.715,.715),HA(l,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,r,n,o){for(var{includeOpacity:l,matrix:s}=this,g=e.getImageData(0,0,n,o),b=0;b<o;b++)for(var S=0;S<n;S++){var F=nx(g.data,S,b,n,o,0),D=nx(g.data,S,b,n,o,1),N=nx(g.data,S,b,n,o,2),J=nx(g.data,S,b,n,o,3),te=ua(s,0,F)+ua(s,1,D)+ua(s,2,N)+ua(s,3,J)+ua(s,4,1),he=ua(s,5,F)+ua(s,6,D)+ua(s,7,N)+ua(s,8,J)+ua(s,9,1),ue=ua(s,10,F)+ua(s,11,D)+ua(s,12,N)+ua(s,13,J)+ua(s,14,1),fe=ua(s,15,F)+ua(s,16,D)+ua(s,17,N)+ua(s,18,J)+ua(s,19,1);l&&(te=0,he=0,ue=0,fe*=J/255),sx(g.data,S,b,n,o,0,te),sx(g.data,S,b,n,o,1,he),sx(g.data,S,b,n,o,2,ue),sx(g.data,S,b,n,o,3,fe)}e.clearRect(0,0,n,o),e.putImageData(g,0,0)}}class k0 extends Gs{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:r}=this,n=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),l=this.getStyle("width").getPixels("x"),s=this.getStyle("height").getPixels("y");if(!l&&!s){var g=new Ru;this.children.forEach(J=>{g.addBoundingBox(J.getBoundingBox(e))}),n=Math.floor(g.x1),o=Math.floor(g.y1),l=Math.floor(g.width),s=Math.floor(g.height)}var b=this.removeStyles(t,k0.ignoreStyles),S=r.createCanvas(n+l,o+s),F=S.getContext("2d");r.screen.setDefaults(F),this.renderChildren(F),new AI(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(F,0,0,n+l,o+s);var D=r.createCanvas(n+l,o+s),N=D.getContext("2d");r.screen.setDefaults(N),t.render(N),N.globalCompositeOperation="destination-in",N.fillStyle=F.createPattern(S,"no-repeat"),N.fillRect(0,0,n+l,o+s),e.fillStyle=N.createPattern(D,"no-repeat"),e.fillRect(0,0,n+l,o+s),this.restoreStyles(t,b)}render(e){}}k0.ignoreStyles=["mask","transform","clip-path"];var n8=()=>{};class s8 extends Gs{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,r=Reflect.getPrototypeOf(e),{beginPath:n,closePath:o}=e;r&&(r.beginPath=n8,r.closePath=n8),Reflect.apply(n,e,[]),this.children.forEach(l=>{if(!(typeof l.path>"u")){var s=typeof l.elementTransform<"u"?l.elementTransform():null;s||(s=Dd.fromElement(t,l)),s&&s.apply(e),l.path(e),r&&(r.closePath=o),s&&s.unapply(e)}}),Reflect.apply(o,e,[]),e.clip(),r&&(r.beginPath=n,r.closePath=o)}render(e){}}class O0 extends Gs{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:r,children:n}=this,o=t.getBoundingBox(e);if(o){var l=0,s=0;n.forEach(ue=>{var fe=ue.extraFilterDistance||0;l=Math.max(l,fe),s=Math.max(s,fe)});var g=Math.floor(o.width),b=Math.floor(o.height),S=g+2*l,F=b+2*s;if(!(S<1||F<1)){var D=Math.floor(o.x),N=Math.floor(o.y),J=this.removeStyles(t,O0.ignoreStyles),te=r.createCanvas(S,F),he=te.getContext("2d");r.screen.setDefaults(he),he.translate(-D+l,-N+s),t.render(he),n.forEach(ue=>{typeof ue.apply=="function"&&ue.apply(he,0,0,S,F)}),e.drawImage(te,0,0,S,F,D-l,N-s,S,F),this.restoreStyles(t,J)}}}render(e){}}O0.ignoreStyles=["filter","transform","clip-path"];class o8 extends Gs{constructor(e,t,r){super(e,t,r),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,r,n,o){}}class a8 extends Gs{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,r,n,o){}}class l8 extends Gs{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,r,n,o){}}class c8 extends Gs{constructor(e,t,r){super(e,t,r),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,r,n,o){var{document:l,blurRadius:s}=this,g=l.window?l.window.document.body:null,b=e.canvas;b.id=l.getUniqueId(),g&&(b.style.display="none",g.appendChild(b)),pve(b,t,r,n,o,s),g&&g.removeChild(b)}}class u8 extends Gs{constructor(){super(...arguments),this.type="title"}}class h8 extends Gs{constructor(){super(...arguments),this.type="desc"}}var Uve={svg:hm,rect:lI,circle:RN,ellipse:kN,line:ON,polyline:cI,polygon:UN,path:us,pattern:NN,marker:zN,defs:QN,linearGradient:VN,radialGradient:HN,stop:GN,animate:ix,animateColor:jN,animateTransform:qN,font:$N,"font-face":KN,"missing-glyph":WN,glyph:aI,text:VA,tspan:R0,tref:XN,a:ZN,textPath:YN,image:e8,g:tx,symbol:t8,style:hI,use:r8,mask:k0,clipPath:s8,filter:O0,feDropShadow:o8,feMorphology:a8,feComposite:l8,feColorMatrix:AI,feGaussianBlur:c8,title:u8,desc:h8};function A8(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Nve(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?A8(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):A8(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function zve(i,e){var t=document.createElement("canvas");return t.width=i,t.height=e,t}function Qve(i){return dI.apply(this,arguments)}function dI(){return dI=NA(function*(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((r,n)=>{t.onload=()=>{r(t)},t.onerror=(o,l,s,g,b)=>{n(b)},t.src=i})}),dI.apply(this,arguments)}class GA{constructor(e){var{rootEmSize:t=12,emSize:r=12,createCanvas:n=GA.createCanvas,createImage:o=GA.createImage,anonymousCrossOrigin:l}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=r,this.createCanvas=n,this.createImage=this.bindCreateImage(o,l),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(r,n)=>e(r,typeof n=="boolean"?n:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),r=GA.elementTypes[t];return typeof r<"u"?new r(this,e):new DN(this,e)}createTextNode(e){return new kve(this,e)}setViewBox(e){this.screen.setViewBox(Nve({document:this},e))}}GA.createCanvas=zve,GA.createImage=Qve,GA.elementTypes=Uve;function d8(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Zf(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?d8(Object(t),!0).forEach(function(r){OT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):d8(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class Jf{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new ex(r),this.screen=new D0(e,r),this.options=r;var n=new GA(this,r),o=n.createDocumentElement(t);this.document=n,this.documentElement=o}static from(e,t){var r=arguments;return NA(function*(){var n=r.length>2&&r[2]!==void 0?r[2]:{},o=new ex(n),l=yield o.parse(t);return new Jf(e,l,n)})()}static fromString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new ex(r),o=n.parseFromString(t);return new Jf(e,o,r)}fork(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Jf.from(e,t,Zf(Zf({},this.options),r))}forkString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Jf.fromString(e,t,Zf(Zf({},this.options),r))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return NA(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Zf({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},r)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:r,options:n}=this;r.start(t,Zf(Zf({enableRedraw:!0},n),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,r)}}const Vve=Object.freeze(Object.defineProperty({__proto__:null,AElement:ZN,AnimateColorElement:jN,AnimateElement:ix,AnimateTransformElement:qN,BoundingBox:Ru,CB1:JT,CB2:YT,CB3:eI,CB4:tI,Canvg:Jf,CircleElement:RN,ClipPathElement:s8,DefsElement:QN,DescElement:h8,Document:GA,Element:Gs,EllipseElement:kN,FeColorMatrixElement:AI,FeCompositeElement:l8,FeDropShadowElement:o8,FeGaussianBlurElement:c8,FeMorphologyElement:a8,FilterElement:O0,Font:Ul,FontElement:$N,FontFaceElement:KN,GElement:tx,GlyphElement:aI,GradientElement:uI,ImageElement:e8,LineElement:ON,LinearGradientElement:VN,MarkerElement:zN,MaskElement:k0,Matrix:sI,MissingGlyphElement:WN,Mouse:EN,PSEUDO_ZERO:Xf,Parser:ex,PathElement:us,PathParser:en,PatternElement:NN,Point:So,PolygonElement:UN,PolylineElement:cI,Property:Br,QB1:iI,QB2:rI,QB3:nI,RadialGradientElement:HN,RectElement:lI,RenderedElement:Rd,Rotate:LN,SVGElement:hm,SVGFontLoader:i8,Scale:MN,Screen:D0,Skew:oI,SkewX:PN,SkewY:FN,StopElement:GN,StyleElement:hI,SymbolElement:t8,TRefElement:XN,TSpanElement:R0,TextElement:VA,TextPathElement:YN,TitleElement:u8,Transform:Dd,Translate:IN,UnknownElement:DN,UseElement:r8,ViewPort:CN,compressSpaces:Kf,default:Jf,getSelectorSpecificity:BN,normalizeAttributeName:xN,normalizeColor:wN,parseExternalUrl:WT,presets:_ve,toNumbers:Fc,trimLeft:vN,trimRight:bN,vectorMagnitude:XT,vectorsAngle:ZT,vectorsRatio:Yb},Symbol.toStringTag,{value:"Module"}));kh.CompareMaps=Qne,kh.Layers=jo,kh.Map=Rne,kh.Styles=Dg,kh.Terrains=hv,Object.defineProperty(kh,Symbol.toStringTag,{value:"Module"})});
