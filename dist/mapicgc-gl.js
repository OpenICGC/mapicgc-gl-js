(function(rA,Fp){typeof exports=="object"&&typeof module<"u"?Fp(exports):typeof define=="function"&&define.amd?define(["exports"],Fp):(rA=typeof globalThis<"u"?globalThis:rA||self,Fp(rA.mapicgcgl={}))})(this,function(rA){"use strict";function Fp(r,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var uQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Km(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var UT={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(uQ,function(){var e={},n={};function i(a,o,d){if(n[a]=d,a==="index"){var f="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",m={};return n.shared(m),n.index(e,m),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}))),e}}i("shared",["exports"],function(a){function o(A,c,h,p){return new(h||(h=Promise))(function(_,x){function E(N){try{R(p.next(N))}catch(V){x(V)}}function I(N){try{R(p.throw(N))}catch(V){x(V)}}function R(N){var V;N.done?_(N.value):(V=N.value,V instanceof h?V:new h(function(j){j(V)})).then(E,I)}R((p=p.apply(A,c||[])).next())})}function d(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var f,m;function v(){if(m)return f;function A(c,h){this.x=c,this.y=h}return m=1,f=A,A.prototype={clone:function(){return new A(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,h){return this.clone()._rotateAround(c,h)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var h=c.x-this.x,p=c.y-this.y;return h*h+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,h){return Math.atan2(this.x*h-this.y*c,this.x*c+this.y*h)},_matMult:function(c){var h=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=h,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var h=Math.cos(c),p=Math.sin(c),_=p*this.x+h*this.y;return this.x=h*this.x-p*this.y,this.y=_,this},_rotateAround:function(c,h){var p=Math.cos(c),_=Math.sin(c),x=h.y+_*(this.x-h.x)+p*(this.y-h.y);return this.x=h.x+p*(this.x-h.x)-_*(this.y-h.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(c){return c instanceof A?c:Array.isArray(c)?new A(c[0],c[1]):c},f}typeof SuppressedError=="function"&&SuppressedError;var C,b,P=d(v()),F=function(){if(b)return C;function A(c,h,p,_){this.cx=3*c,this.bx=3*(p-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=h,this.p2x=p,this.p2y=_}return b=1,C=A,A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,h){if(h===void 0&&(h=1e-6),c<0)return 0;if(c>1)return 1;for(var p=c,_=0;_<8;_++){var x=this.sampleCurveX(p)-c;if(Math.abs(x)<h)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=x/E}var I=0,R=1;for(p=c,_=0;_<20&&(x=this.sampleCurveX(p),!(Math.abs(x-c)<h));_++)c>x?I=p:R=p,p=.5*(R-I)+I;return p},solve:function(c,h){return this.sampleCurveY(this.solveCurveX(c,h))}},C}(),U=d(F);let k,z;function K(){return k==null&&(k=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),k}function G(){if(z==null&&(z=!1,K())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let p=0;p<5*5;p++){const _=4*p;c.fillStyle=`rgb(${_},${_+1},${_+2})`,c.fillRect(p%5,Math.floor(p/5),1,1)}const h=c.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&h[p]!==p){z=!0;break}}}return z||!1}var X,Y=1e-6,it=typeof Float32Array<"u"?Float32Array:Array;function nt(){var A=new it(9);return it!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}function wt(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function Ct(){var A=new it(3);return it!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function st(A,c,h){var p=new it(3);return p[0]=A,p[1]=c,p[2]=h,p}function ot(A,c,h){var p=c[0],_=c[1],x=c[2],E=c[3];return A[0]=h[0]*p+h[4]*_+h[8]*x+h[12]*E,A[1]=h[1]*p+h[5]*_+h[9]*x+h[13]*E,A[2]=h[2]*p+h[6]*_+h[10]*x+h[14]*E,A[3]=h[3]*p+h[7]*_+h[11]*x+h[15]*E,A}function vt(){var A=new it(4);return it!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A[3]=1,A}function yt(){var A=new it(2);return it!=Float32Array&&(A[0]=0,A[1]=0),A}function re(A,c){var h=new it(2);return h[0]=A,h[1]=c,h}Math.hypot||(Math.hypot=function(){for(var A=0,c=arguments.length;c--;)A+=arguments[c]*arguments[c];return Math.sqrt(A)}),Ct(),X=new it(4),it!=Float32Array&&(X[0]=0,X[1]=0,X[2]=0,X[3]=0),Ct(),st(1,0,0),st(0,1,0),vt(),vt(),nt(),yt();const Wt=8192;function ee(A,c,h){return c*(Wt/(A.tileSize*Math.pow(2,h-A.tileID.overscaledZ)))}function Zt(A,c){return(A%c+c)%c}function oe(A,c,h){return A*(1-h)+c*h}function pe(A){if(A<=0)return 0;if(A>=1)return 1;const c=A*A,h=c*A;return 4*(A<.5?h:3*(A-c)+h-.75)}function De(A,c,h,p){const _=new U(A,c,h,p);return x=>_.solve(x)}const at=De(.25,.1,.25,1);function Tt(A,c,h){return Math.min(h,Math.max(c,A))}function Rt(A,c,h){const p=h-c,_=((A-c)%p+p)%p+c;return _===c?h:_}function Nt(A){for(var c=arguments.length,h=new Array(c>1?c-1:0),p=1;p<c;p++)h[p-1]=arguments[p];for(const _ of h)for(const x in _)A[x]=_[x];return A}let ae=1;function Xt(A,c,h){const p={};for(const _ in A)p[_]=c.call(this,A[_],_,A);return p}function ye(A,c,h){const p={};for(const _ in A)c.call(this,A[_],_,A)&&(p[_]=A[_]);return p}function de(A){return Array.isArray(A)?A.map(de):typeof A=="object"&&A?Xt(A,de):A}const qe={};function Ve(A){qe[A]||(typeof console<"u"&&console.warn(A),qe[A]=!0)}function Je(A,c,h){return(h.y-A.y)*(c.x-A.x)>(c.y-A.y)*(h.x-A.x)}function or(A){return typeof WorkerGlobalScope<"u"&&A!==void 0&&A instanceof WorkerGlobalScope}let mr=null;function Me(A){return typeof ImageBitmap<"u"&&A instanceof ImageBitmap}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ur(A,c,h,p,_){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(A,{timestamp:0});try{const E=x==null?void 0:x.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const I=E.startsWith("BGR"),R=new Uint8ClampedArray(p*_*4);if(yield x.copyTo(R,function(N,V,j,tt,rt){const lt=4*Math.max(1,0),dt=(Math.max(0,j)-j)*tt*4+lt,Pt=4*tt,Mt=Math.max(0,V),ce=Math.max(0,j);return{rect:{x:Mt,y:ce,width:Math.min(N.width,V+tt)-Mt,height:Math.min(N.height,j+rt)-ce},layout:[{offset:dt,stride:Pt}]}}(A,c,h,p,_)),I)for(let N=0;N<R.length;N+=4){const V=R[N];R[N]=R[N+2],R[N+2]=V}return R}finally{x.close()}})}let Ir,$e;function Xe(A){return A/Math.PI*180}const er="AbortError";function gr(){return new Error(er)}const Re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function sr(A){return Re.REGISTERED_PROTOCOLS[A.substring(0,A.indexOf("://"))]}const Br="global-dispatcher";class xr extends Error{constructor(c,h,p,_){super(`AJAXError: ${h} (${c}): ${p}`),this.status=c,this.statusText=h,this.url=p,this.body=_}}const Lr=()=>or(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Zr=function(A,c){if(/:\/\//.test(A.url)&&!/^https?:|^file:/.test(A.url)){const p=sr(A.url);if(p)return p(A,c);if(or(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:A,targetMapId:Br},c)}if(!(/^file:/.test(h=A.url)||/^file:/.test(Lr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return o(this,void 0,void 0,function*(){const x=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Lr(),signal:_.signal});let E,I;p.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{E=yield fetch(x)}catch(N){throw new xr(0,N.message,p.url,new Blob)}if(!E.ok){const N=yield E.blob();throw new xr(E.status,E.statusText,p.url,N)}I=p.type==="arrayBuffer"||p.type==="image"?E.arrayBuffer():p.type==="json"?E.json():E.text();const R=yield I;if(_.signal.aborted)throw gr();return{data:R,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}})}(A,c);if(or(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:A,mustQueue:!0,targetMapId:Br},c)}var h;return function(p,_){return new Promise((x,E)=>{var I;const R=new XMLHttpRequest;R.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(R.responseType="arraybuffer");for(const N in p.headers)R.setRequestHeader(N,p.headers[N]);p.type==="json"&&(R.responseType="text",!((I=p.headers)===null||I===void 0)&&I.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=p.credentials==="include",R.onerror=()=>{E(new Error(R.statusText))},R.onload=()=>{if(!_.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let N=R.response;if(p.type==="json")try{N=JSON.parse(R.response)}catch(V){return void E(V)}x({data:N,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const N=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});E(new xr(R.status,R.statusText,p.url,N))}},_.signal.addEventListener("abort",()=>{R.abort(),E(gr())}),R.send(p.body)})}(A,c)};function Nr(A){if(!A||A.indexOf("://")<=0||A.indexOf("data:image/")===0||A.indexOf("blob:")===0)return!0;const c=new URL(A),h=window.location;return c.protocol===h.protocol&&c.host===h.host}function Vr(A,c,h){h[A]&&h[A].indexOf(c)!==-1||(h[A]=h[A]||[],h[A].push(c))}function yr(A,c,h){if(h&&h[A]){const p=h[A].indexOf(c);p!==-1&&h[A].splice(p,1)}}class In{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Nt(this,h),this.type=c}}class an extends In{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Nt({error:c},h))}}class Xn{on(c,h){return this._listeners=this._listeners||{},Vr(c,h,this._listeners),{unsubscribe:()=>{this.off(c,h)}}}off(c,h){return yr(c,h,this._listeners),yr(c,h,this._oneTimeListeners),this}once(c,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Vr(c,h,this._oneTimeListeners),this):new Promise(p=>this.once(c,p))}fire(c,h){typeof c=="string"&&(c=new In(c,h||{}));const p=c.type;if(this.listens(p)){c.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of _)I.call(this,c);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of x)yr(p,I,this._oneTimeListeners),I.call(this,c);const E=this._eventedParent;E&&(Nt(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(c))}else c instanceof an&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,h){return this._eventedParent=c,this._eventedParentData=h,this}}var Bt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ct=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ft(A,c){const h={};for(const p in A)p!=="ref"&&(h[p]=A[p]);return ct.forEach(p=>{p in c&&(h[p]=c[p])}),h}function pt(A,c){if(Array.isArray(A)){if(!Array.isArray(c)||A.length!==c.length)return!1;for(let h=0;h<A.length;h++)if(!pt(A[h],c[h]))return!1;return!0}if(typeof A=="object"&&A!==null&&c!==null){if(typeof c!="object"||Object.keys(A).length!==Object.keys(c).length)return!1;for(const h in A)if(!pt(A[h],c[h]))return!1;return!0}return A===c}function Dt(A,c){A.push(c)}function Gt(A,c,h){Dt(h,{command:"addSource",args:[A,c[A]]})}function le(A,c,h){Dt(c,{command:"removeSource",args:[A]}),h[A]=!0}function ge(A,c,h,p){le(A,h,p),Gt(A,c,h)}function te(A,c,h){let p;for(p in A[h])if(Object.prototype.hasOwnProperty.call(A[h],p)&&p!=="data"&&!pt(A[h][p],c[h][p]))return!1;for(p in c[h])if(Object.prototype.hasOwnProperty.call(c[h],p)&&p!=="data"&&!pt(A[h][p],c[h][p]))return!1;return!0}function he(A,c,h,p,_,x){A=A||{},c=c||{};for(const E in A)Object.prototype.hasOwnProperty.call(A,E)&&(pt(A[E],c[E])||h.push({command:x,args:[p,E,c[E],_]}));for(const E in c)Object.prototype.hasOwnProperty.call(c,E)&&!Object.prototype.hasOwnProperty.call(A,E)&&(pt(A[E],c[E])||h.push({command:x,args:[p,E,c[E],_]}))}function ve(A){return A.id}function me(A,c){return A[c.id]=c,A}class Yt{constructor(c,h,p,_){this.message=(c?`${c}: `:"")+p,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function ur(A){for(var c=arguments.length,h=new Array(c>1?c-1:0),p=1;p<c;p++)h[p-1]=arguments[p];for(const _ of h)for(const x in _)A[x]=_[x];return A}class ir extends Error{constructor(c,h){super(h),this.message=h,this.key=c}}class tr{constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[p,_]of h)this.bindings[p]=_}concat(c){return new tr(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Mr={kind:"null"},Fe={kind:"number"},nr={kind:"string"},_r={kind:"boolean"},Fr={kind:"color"},Yr={kind:"projectionDefinition"},Qr={kind:"object"},vr={kind:"value"},wn={kind:"collator"},Ai={kind:"formatted"},mn={kind:"padding"},Dn={kind:"resolvedImage"},gn={kind:"variableAnchorOffsetCollection"};function Hn(A,c){return{kind:"array",itemType:A,N:c}}function xn(A){if(A.kind==="array"){const c=xn(A.itemType);return typeof A.N=="number"?`array<${c}, ${A.N}>`:A.itemType.kind==="value"?"array":`array<${c}>`}return A.kind}const vs=[Mr,Fe,nr,_r,Fr,Yr,Ai,Qr,Hn(vr),mn,Dn,gn];function Kt(A,c){if(c.kind==="error")return null;if(A.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Kt(A.itemType,c.itemType))&&(typeof A.N!="number"||A.N===c.N))return null}else{if(A.kind===c.kind)return null;if(A.kind==="value"){for(const h of vs)if(!Kt(h,c))return null}}return`Expected ${xn(A)} but found ${xn(c)} instead.`}function Er(A,c){return c.some(h=>h.kind===A.kind)}function cr(A,c){return c.some(h=>h==="null"?A===null:h==="array"?Array.isArray(A):h==="object"?A&&!Array.isArray(A)&&typeof A=="object":h===typeof A)}function dn(A,c){return A.kind==="array"&&c.kind==="array"?A.itemType.kind===c.itemType.kind&&typeof A.N=="number":A.kind===c.kind}const qn=.96422,Gn=.82521,Qn=4/29,di=6/29,xi=3*di*di,mi=di*di*di,Ds=Math.PI/180,Po=180/Math.PI;function $c(A){return(A%=360)<0&&(A+=360),A}function Oa(A){let[c,h,p,_]=A,x,E;const I=Nn((.2225045*(c=Mo(c))+.7168786*(h=Mo(h))+.0606169*(p=Mo(p)))/1);c===h&&h===p?x=E=I:(x=Nn((.4360747*c+.3850649*h+.1430804*p)/qn),E=Nn((.0139322*c+.0971045*h+.7141733*p)/Gn));const R=116*I-16;return[R<0?0:R,500*(x-I),200*(I-E),_]}function Mo(A){return A<=.04045?A/12.92:Math.pow((A+.055)/1.055,2.4)}function Nn(A){return A>mi?Math.pow(A,1/3):A/xi+Qn}function nl(A){let[c,h,p,_]=A,x=(c+16)/116,E=isNaN(h)?x:x+h/500,I=isNaN(p)?x:x-p/200;return x=1*il(x),E=qn*il(E),I=Gn*il(I),[Fo(3.1338561*E-1.6168667*x-.4906146*I),Fo(-.9787684*E+1.9161415*x+.033454*I),Fo(.0719453*E-.2289914*x+1.4052427*I),_]}function Fo(A){return(A=A<=.00304?12.92*A:1.055*Math.pow(A,1/2.4)-.055)<0?0:A>1?1:A}function il(A){return A>di?A*A*A:xi*(A-Qn)}function fa(A){return parseInt(A.padEnd(2,A),16)/255}function sc(A,c){return Vi(c?A/100:A,0,1)}function Vi(A,c,h){return Math.min(Math.max(c,A),h)}function Ns(A){return!A.some(Number.isNaN)}const Bi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function on(A,c,h){return A+h*(c-A)}function ks(A,c,h){return A.map((p,_)=>on(p,c[_],h))}class cn{constructor(c,h,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=h,this.b=p,this.a=_,x||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[c,h,p,_]))}static parse(c){if(c instanceof cn)return c;if(typeof c!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Bi[p];if(_){const[E,I,R]=_;return[E/255,I/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const E=p.length<6?1:2;let I=1;return[fa(p.slice(I,I+=E)),fa(p.slice(I,I+=E)),fa(p.slice(I,I+=E)),fa(p.slice(I,I+E)||"ff")]}if(p.startsWith("rgb")){const E=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce]=E,Ht=[V||" ",rt||" ",Pt].join("");if(Ht==="  "||Ht==="  /"||Ht===",,"||Ht===",,,"){const et=[N,tt,dt].join(""),Et=et==="%%%"?100:et===""?255:0;if(Et){const Vt=[Vi(+R/Et,0,1),Vi(+j/Et,0,1),Vi(+lt/Et,0,1),Mt?sc(+Mt,ce):1];if(Ns(Vt))return Vt}}return}}const x=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,I,R,N,V,j,tt,rt,lt]=x,dt=[R||" ",V||" ",tt].join("");if(dt==="  "||dt==="  /"||dt===",,"||dt===",,,"){const Pt=[+I,Vi(+N,0,100),Vi(+j,0,100),rt?sc(+rt,lt):1];if(Ns(Pt))return function(Mt){let[ce,Ht,et,Et]=Mt;function Vt(Ee){const We=(Ee+ce/30)%12,Pe=Ht*Math.min(et,1-et);return et-Pe*Math.max(-1,Math.min(We-3,9-We,1))}return ce=$c(ce),Ht/=100,et/=100,[Vt(0),Vt(8),Vt(4),Et]}(Pt)}}}(c);return h?new cn(...h,!1):void 0}get rgb(){const{r:c,g:h,b:p,a:_}=this,x=_||1/0;return this.overwriteGetter("rgb",[c/x,h/x,p/x,_])}get hcl(){return this.overwriteGetter("hcl",function(c){const[h,p,_,x]=Oa(c),E=Math.sqrt(p*p+_*_);return[Math.round(1e4*E)?$c(Math.atan2(_,p)*Po):NaN,E,h,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Oa(this.rgb))}overwriteGetter(c,h){return Object.defineProperty(this,c,{value:h}),h}toString(){const[c,h,p,_]=this.rgb;return`rgba(${[c,h,p].map(x=>Math.round(255*x)).join(",")},${_})`}static interpolate(c,h,p){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[x,E,I,R]=ks(c.rgb,h.rgb,p);return new cn(x,E,I,R,!1)}case"hcl":{const[x,E,I,R]=c.hcl,[N,V,j,tt]=h.hcl;let rt,lt;if(isNaN(x)||isNaN(N))isNaN(x)?isNaN(N)?rt=NaN:(rt=N,I!==1&&I!==0||(lt=V)):(rt=x,j!==1&&j!==0||(lt=E));else{let Ht=N-x;N>x&&Ht>180?Ht-=360:N<x&&x-N>180&&(Ht+=360),rt=x+p*Ht}const[dt,Pt,Mt,ce]=function(Ht){let[et,Et,Vt,Ee]=Ht;return et=isNaN(et)?0:et*Ds,nl([Vt,Math.cos(et)*Et,Math.sin(et)*Et,Ee])}([rt,lt??on(E,V,p),on(I,j,p),on(R,tt,p)]);return new cn(dt,Pt,Mt,ce,!1)}case"lab":{const[x,E,I,R]=nl(ks(c.lab,h.lab,p));return new cn(x,E,I,R,!1)}}}}cn.black=new cn(0,0,0,1),cn.white=new cn(1,1,1,1),cn.transparent=new cn(0,0,0,0),cn.red=new cn(1,0,0,1);class Tl{constructor(c,h,p){this.sensitivity=c?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,h){return this.collator.compare(c,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ku=["bottom","center","top"];class bt{constructor(c,h,p,_,x,E){this.text=c,this.image=h,this.scale=p,this.fontStack=_,this.textColor=x,this.verticalAlign=E}}class It{constructor(c){this.sections=c}static fromString(c){return new It([new bt(c,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof It?c:It.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class jt{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof jt)return c;if(typeof c=="number")return new jt([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const h of c)if(typeof h!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new jt(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,h,p){return new jt(ks(c.values,h.values,p))}}class xe{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const ar=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Cr{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Cr)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let h=0;h<c.length;h+=2){const p=c[h],_=c[h+1];if(typeof p!="string"||!ar.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Cr(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,h,p){const _=c.values,x=h.values;if(_.length!==x.length)throw new xe(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${h.toString()}`);const E=[];for(let I=0;I<_.length;I+=2){if(_[I]!==x[I])throw new xe(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${_[I]}, to[${I}]: ${x[I]}`);E.push(_[I]);const[R,N]=_[I+1],[V,j]=x[I+1];E.push([on(R,V,p),on(N,j,p)])}return new Cr(E)}}class Gr{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Gr({name:c,available:!1}):null}}class Bn{constructor(c,h,p){this.from=c,this.to=h,this.transition=p}static interpolate(c,h,p){return new Bn(c,h,p)}static parse(c){return c instanceof Bn?c:Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"?new Bn(c[0],c[1],c[2]):typeof c=="object"&&typeof c.from=="string"&&typeof c.to=="string"&&typeof c.transition=="number"?new Bn(c.from,c.to,c.transition):typeof c=="string"?new Bn(c,c,1):void 0}}function yi(A,c,h,p){return typeof A=="number"&&A>=0&&A<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[A,c,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[A,c,h,p]:[A,c,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _i(A){if(A===null||typeof A=="string"||typeof A=="boolean"||typeof A=="number"||A instanceof Bn||A instanceof cn||A instanceof Tl||A instanceof It||A instanceof jt||A instanceof Cr||A instanceof Gr)return!0;if(Array.isArray(A)){for(const c of A)if(!_i(c))return!1;return!0}if(typeof A=="object"){for(const c in A)if(!_i(A[c]))return!1;return!0}return!1}function nn(A){if(A===null)return Mr;if(typeof A=="string")return nr;if(typeof A=="boolean")return _r;if(typeof A=="number")return Fe;if(A instanceof cn)return Fr;if(A instanceof Bn)return Yr;if(A instanceof Tl)return wn;if(A instanceof It)return Ai;if(A instanceof jt)return mn;if(A instanceof Cr)return gn;if(A instanceof Gr)return Dn;if(Array.isArray(A)){const c=A.length;let h;for(const p of A){const _=nn(p);if(h){if(h===_)continue;h=vr;break}h=_}return Hn(h||vr,c)}return Qr}function Xc(A){const c=typeof A;return A===null?"":c==="string"||c==="number"||c==="boolean"?String(A):A instanceof cn||A instanceof Bn||A instanceof It||A instanceof jt||A instanceof Cr||A instanceof Gr?A.toString():JSON.stringify(A)}class Ko{constructor(c,h){this.type=c,this.value=h}static parse(c,h){if(c.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!_i(c[1]))return h.error("invalid value");const p=c[1];let _=nn(p);const x=h.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new Ko(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const en={string:nr,number:Fe,boolean:_r,object:Qr};class Lo{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let p,_=1;const x=c[0];if(x==="array"){let I,R;if(c.length>2){const N=c[1];if(typeof N!="string"||!(N in en)||N==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);I=en[N],_++}else I=vr;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return h.error('The length argument to "array" must be a positive integer literal',2);R=c[2],_++}p=Hn(I,R)}else{if(!en[x])throw new Error(`Types doesn't contain name = ${x}`);p=en[x]}const E=[];for(;_<c.length;_++){const I=h.parse(c[_],_,vr);if(!I)return null;E.push(I)}return new Lo(p,E)}evaluate(c){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(c);if(!Kt(this.type,nn(p)))return p;if(h===this.args.length-1)throw new xe(`Expected value to be of type ${xn(this.type)}, but found ${xn(nn(p))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Nh={"to-boolean":_r,"to-color":Fr,"to-number":Fe,"to-string":nr};class bs{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const p=c[0];if(!Nh[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&c.length!==2)return h.error("Expected one argument.");const _=Nh[p],x=[];for(let E=1;E<c.length;E++){const I=h.parse(c[E],E,vr);if(!I)return null;x.push(I)}return new bs(_,x)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let h,p;for(const _ of this.args){if(h=_.evaluate(c),p=null,h instanceof cn)return h;if(typeof h=="string"){const x=c.parseColor(h);if(x)return x}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rgba value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:yi(h[0],h[1],h[2],h[3]),!p))return new cn(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new xe(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(c);const _=jt.parse(h);if(_)return _}throw new xe(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(c);const _=Cr.parse(h);if(_)return _}throw new xe(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(c),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new xe(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return It.fromString(Xc(this.args[0].evaluate(c)));case"resolvedImage":return Gr.fromString(Xc(this.args[0].evaluate(c)));case"projectionDefinition":return this.args[0].evaluate(c);default:return Xc(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Zc=["Unknown","Point","LineString","Polygon"];class ii{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let h=this._parseColorCache[c];return h||(h=this._parseColorCache[c]=cn.parse(c)),h}}class Ua{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new tr,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=x,this.errors=E,this.expectedType=_,this._isConstant=h}parse(c,h,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return h?this.concat(h,p,_)._parse(c,x):this._parse(c,x)}_parse(c,h){function p(_,x,E){return E==="assert"?new Lo(x,[_]):E==="coerce"?new bs(x,[_]):_}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=c[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let E=x.parse(c,this);if(!E)return null;if(this.expectedType){const I=this.expectedType,R=E.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||R.kind!=="value")if(I.kind!=="projectionDefinition"||R.kind!=="string"&&R.kind!=="array")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(I.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(I,R))return null}else E=p(E,I,h.typeAnnotation||"coerce");else E=p(E,I,h.typeAnnotation||"coerce");else E=p(E,I,h.typeAnnotation||"coerce");else E=p(E,I,h.typeAnnotation||"coerce");else E=p(E,I,h.typeAnnotation||"assert")}if(!(E instanceof Ko)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const I=new ii;try{E=new Ko(E.type,E.evaluate(I))}catch(R){return this.error(R.message),null}}return E}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,h,p){const _=typeof c=="number"?this.path.concat(c):this.path,x=p?this.scope.concat(p):this.scope;return new Ua(this.registry,this._isConstant,_,h||null,x,this.errors)}error(c){for(var h=arguments.length,p=new Array(h>1?h-1:0),_=1;_<h;_++)p[_-1]=arguments[_];const x=`${this.key}${p.map(E=>`[${E}]`).join("")}`;this.errors.push(new ir(x,c))}checkSubtype(c,h){const p=Kt(c,h);return p&&this.error(p),p}}class vn{constructor(c,h){this.type=h.type,this.bindings=[].concat(c),this.result=h}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const h of this.bindings)c(h[1]);c(this.result)}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const p=[];for(let x=1;x<c.length-1;x+=2){const E=c[x];if(typeof E!="string")return h.error(`Expected string, but found ${typeof E} instead.`,x);if(/[^a-zA-Z0-9_]/.test(E))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);const I=h.parse(c[x+1],x+1);if(!I)return null;p.push([E,I])}const _=h.parse(c[c.length-1],c.length-1,h.expectedType,p);return _?new vn(p,_):null}outputDefined(){return this.result.outputDefined()}}class ln{constructor(c,h){this.type=h.type,this.name=c,this.boundExpression=h}static parse(c,h){if(c.length!==2||typeof c[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=c[1];return h.scope.has(p)?new ln(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class Yc{constructor(c,h,p){this.type=c,this.index=h,this.input=p}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,Fe),_=h.parse(c[2],2,Hn(h.expectedType||vr));return p&&_?new Yc(_.type.itemType,p,_):null}evaluate(c){const h=this.index.evaluate(c),p=this.input.evaluate(c);if(h<0)throw new xe(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new xe(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new xe(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Sn{constructor(c,h){this.type=_r,this.needle=c,this.haystack=h}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,vr),_=h.parse(c[2],2,vr);return p&&_?Er(p.type,[_r,nr,Fe,Mr,vr])?new Sn(p,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(p.type)} instead`):null}evaluate(c){const h=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!p)return!1;if(!cr(h,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${xn(nn(h))} instead.`);if(!cr(p,["string","array"]))throw new xe(`Expected second argument to be of type array or string, but found ${xn(nn(p))} instead.`);return p.indexOf(h)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class sl{constructor(c,h,p){this.type=Fe,this.needle=c,this.haystack=h,this.fromIndex=p}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,vr),_=h.parse(c[2],2,vr);if(!p||!_)return null;if(!Er(p.type,[_r,nr,Fe,Mr,vr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(p.type)} instead`);if(c.length===4){const x=h.parse(c[3],3,Fe);return x?new sl(p,_,x):null}return new sl(p,_)}evaluate(c){const h=this.needle.evaluate(c),p=this.haystack.evaluate(c);if(!cr(h,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${xn(nn(h))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(c)),cr(p,["string"])){const x=p.indexOf(h,_);return x===-1?-1:[...p.slice(0,x)].length}if(cr(p,["array"]))return p.indexOf(h,_);throw new xe(`Expected second argument to be of type array or string, but found ${xn(nn(p))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Qs{constructor(c,h,p,_,x,E){this.inputType=c,this.type=h,this.input=p,this.cases=_,this.outputs=x,this.otherwise=E}static parse(c,h){if(c.length<5)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return h.error("Expected an even number of arguments.");let p,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const x={},E=[];for(let N=2;N<c.length-1;N+=2){let V=c[N];const j=c[N+1];Array.isArray(V)||(V=[V]);const tt=h.concat(N);if(V.length===0)return tt.error("Expected at least one branch label.");for(const lt of V){if(typeof lt!="number"&&typeof lt!="string")return tt.error("Branch labels must be numbers or strings.");if(typeof lt=="number"&&Math.abs(lt)>Number.MAX_SAFE_INTEGER)return tt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof lt=="number"&&Math.floor(lt)!==lt)return tt.error("Numeric branch labels must be integer values.");if(p){if(tt.checkSubtype(p,nn(lt)))return null}else p=nn(lt);if(x[String(lt)]!==void 0)return tt.error("Branch labels must be unique.");x[String(lt)]=E.length}const rt=h.parse(j,N,_);if(!rt)return null;_=_||rt.type,E.push(rt)}const I=h.parse(c[1],1,vr);if(!I)return null;const R=h.parse(c[c.length-1],c.length-1,_);return R?I.type.kind!=="value"&&h.concat(1).checkSubtype(p,I.type)?null:new Qs(p,_,I,x,E,R):null}evaluate(c){const h=this.input.evaluate(c);return(nn(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class pa{constructor(c,h,p){this.type=c,this.branches=h,this.otherwise=p}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const _=[];for(let E=1;E<c.length-1;E+=2){const I=h.parse(c[E],E,_r);if(!I)return null;const R=h.parse(c[E+1],E+1,p);if(!R)return null;_.push([I,R]),p=p||R.type}const x=h.parse(c[c.length-1],c.length-1,p);if(!x)return null;if(!p)throw new Error("Can't infer output type");return new pa(p,_,x)}evaluate(c){for(const[h,p]of this.branches)if(h.evaluate(c))return p.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[h,p]of this.branches)c(h),c(p);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[h,p]=c;return p.outputDefined()})&&this.otherwise.outputDefined()}}class Jc{constructor(c,h,p,_){this.type=c,this.input=h,this.beginIndex=p,this.endIndex=_}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const p=h.parse(c[1],1,vr),_=h.parse(c[2],2,Fe);if(!p||!_)return null;if(!Er(p.type,[Hn(vr),nr,vr]))return h.error(`Expected first argument to be of type array or string, but found ${xn(p.type)} instead`);if(c.length===4){const x=h.parse(c[3],3,Fe);return x?new Jc(p.type,p,_,x):null}return new Jc(p.type,p,_)}evaluate(c){const h=this.input.evaluate(c),p=this.beginIndex.evaluate(c);let _;if(this.endIndex&&(_=this.endIndex.evaluate(c)),cr(h,["string"]))return[...h].slice(p,_).join("");if(cr(h,["array"]))return h.slice(p,_);throw new xe(`Expected first argument to be of type array or string, but found ${xn(nn(h))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function Da(A,c){const h=A.length-1;let p,_,x=0,E=h,I=0;for(;x<=E;)if(I=Math.floor((x+E)/2),p=A[I],_=A[I+1],p<=c){if(I===h||c<_)return I;x=I+1}else{if(!(p>c))throw new xe("Input is not a number.");E=I-1}return 0}class Na{constructor(c,h,p){this.type=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static parse(c,h){if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(c[1],1,Fe);if(!p)return null;const _=[];let x=null;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(let E=1;E<c.length;E+=2){const I=E===1?-1/0:c[E],R=c[E+1],N=E,V=E+1;if(typeof I!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(_.length&&_[_.length-1][0]>=I)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const j=h.parse(R,V,x);if(!j)return null;x=x||j.type,_.push([I,j])}return new Na(x,p,_)}evaluate(c){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(c);const _=this.input.evaluate(c);if(_<=h[0])return p[0].evaluate(c);const x=h.length;return _>=h[x-1]?p[x-1].evaluate(c):p[Da(h,_)].evaluate(c)}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function tu(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Wu,$u,kh=function(){if($u)return Wu;function A(c,h,p,_){this.cx=3*c,this.bx=3*(p-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=h,this.p2x=p,this.p2y=_}return $u=1,Wu=A,A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,h){if(h===void 0&&(h=1e-6),c<0)return 0;if(c>1)return 1;for(var p=c,_=0;_<8;_++){var x=this.sampleCurveX(p)-c;if(Math.abs(x)<h)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=x/E}var I=0,R=1;for(p=c,_=0;_<20&&(x=this.sampleCurveX(p),!(Math.abs(x-c)<h));_++)c>x?I=p:R=p,p=.5*(R-I)+I;return p},solve:function(c,h){return this.sampleCurveY(this.solveCurveX(c,h))}},Wu}(),oc=tu(kh);class Pn{constructor(c,h,p,_,x){this.type=c,this.operator=h,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[E,I]of x)this.labels.push(E),this.outputs.push(I)}static interpolationFactor(c,h,p,_){let x=0;if(c.name==="exponential")x=Ro(h,c.base,p,_);else if(c.name==="linear")x=Ro(h,1,p,_);else if(c.name==="cubic-bezier"){const E=c.controlPoints;x=new oc(E[0],E[1],E[2],E[3]).solve(Ro(h,1,p,_))}return x}static parse(c,h){let[p,_,x,...E]=c;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const N=_[1];if(typeof N!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:N}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const N=_.slice(1);if(N.length!==4||N.some(V=>typeof V!="number"||V<0||V>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:N}}}if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(x=h.parse(x,2,Fe),!x)return null;const I=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=Fr:h.expectedType&&h.expectedType.kind!=="value"&&(R=h.expectedType);for(let N=0;N<E.length;N+=2){const V=E[N],j=E[N+1],tt=N+3,rt=N+4;if(typeof V!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',tt);if(I.length&&I[I.length-1][0]>=V)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',tt);const lt=h.parse(j,rt,R);if(!lt)return null;R=R||lt.type,I.push([V,lt])}return dn(R,Fe)||dn(R,Yr)||dn(R,Fr)||dn(R,mn)||dn(R,gn)||dn(R,Hn(Fe))?new Pn(R,p,_,x,I):h.error(`Type ${xn(R)} is not interpolatable.`)}evaluate(c){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(c);const _=this.input.evaluate(c);if(_<=h[0])return p[0].evaluate(c);const x=h.length;if(_>=h[x-1])return p[x-1].evaluate(c);const E=Da(h,_),I=Pn.interpolationFactor(this.interpolation,_,h[E],h[E+1]),R=p[E].evaluate(c),N=p[E+1].evaluate(c);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return on(R,N,I);case"color":return cn.interpolate(R,N,I);case"padding":return jt.interpolate(R,N,I);case"variableAnchorOffsetCollection":return Cr.interpolate(R,N,I);case"array":return ks(R,N,I);case"projectionDefinition":return Bn.interpolate(R,N,I)}case"interpolate-hcl":return cn.interpolate(R,N,I,"hcl");case"interpolate-lab":return cn.interpolate(R,N,I,"lab")}}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Ro(A,c,h,p){const _=p-h,x=A-h;return _===0?0:c===1?x/_:(Math.pow(c,x)-1)/(Math.pow(c,_)-1)}const Wo={color:cn.interpolate,number:on,padding:jt.interpolate,variableAnchorOffsetCollection:Cr.interpolate,array:ks};class Oo{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let p=null;const _=h.expectedType;_&&_.kind!=="value"&&(p=_);const x=[];for(const I of c.slice(1)){const R=h.parse(I,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,x.push(R)}if(!p)throw new Error("No output type");const E=_&&x.some(I=>Kt(_,I.type));return new Oo(E?vr:p,x)}evaluate(c){let h,p=null,_=0;for(const x of this.args)if(_++,p=x.evaluate(c),p&&p instanceof Gr&&!p.available&&(h||(h=p.name),p=null,_===this.args.length&&(p=h)),p!==null)break;return p}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}function si(A,c){return A==="=="||A==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function eu(A,c,h,p){return p.compare(c,h)===0}function Uo(A,c,h){const p=A!=="=="&&A!=="!=";return class cQ{constructor(x,E,I){this.type=_r,this.lhs=x,this.rhs=E,this.collator=I,this.hasUntypedArgument=x.type.kind==="value"||E.type.kind==="value"}static parse(x,E){if(x.length!==3&&x.length!==4)return E.error("Expected two or three arguments.");const I=x[0];let R=E.parse(x[1],1,vr);if(!R)return null;if(!si(I,R.type))return E.concat(1).error(`"${I}" comparisons are not supported for type '${xn(R.type)}'.`);let N=E.parse(x[2],2,vr);if(!N)return null;if(!si(I,N.type))return E.concat(2).error(`"${I}" comparisons are not supported for type '${xn(N.type)}'.`);if(R.type.kind!==N.type.kind&&R.type.kind!=="value"&&N.type.kind!=="value")return E.error(`Cannot compare types '${xn(R.type)}' and '${xn(N.type)}'.`);p&&(R.type.kind==="value"&&N.type.kind!=="value"?R=new Lo(N.type,[R]):R.type.kind!=="value"&&N.type.kind==="value"&&(N=new Lo(R.type,[N])));let V=null;if(x.length===4){if(R.type.kind!=="string"&&N.type.kind!=="string"&&R.type.kind!=="value"&&N.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(V=E.parse(x[3],3,wn),!V)return null}return new cQ(R,N,V)}evaluate(x){const E=this.lhs.evaluate(x),I=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const R=nn(E),N=nn(I);if(R.kind!==N.kind||R.kind!=="string"&&R.kind!=="number")throw new xe(`Expected arguments for "${A}" to be (string, string) or (number, number), but found (${R.kind}, ${N.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=nn(E),N=nn(I);if(R.kind!=="string"||N.kind!=="string")return c(x,E,I)}return this.collator?h(x,E,I,this.collator.evaluate(x)):c(x,E,I)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const NA=Uo("==",function(A,c,h){return c===h},eu),Xu=Uo("!=",function(A,c,h){return c!==h},function(A,c,h,p){return!eu(0,c,h,p)}),Zu=Uo("<",function(A,c,h){return c<h},function(A,c,h,p){return p.compare(c,h)<0}),ru=Uo(">",function(A,c,h){return c>h},function(A,c,h,p){return p.compare(c,h)>0}),Qh=Uo("<=",function(A,c,h){return c<=h},function(A,c,h,p){return p.compare(c,h)<=0}),nu=Uo(">=",function(A,c,h){return c>=h},function(A,c,h,p){return p.compare(c,h)>=0});class ga{constructor(c,h,p){this.type=wn,this.locale=p,this.caseSensitive=c,this.diacriticSensitive=h}static parse(c,h){if(c.length!==2)return h.error("Expected one argument.");const p=c[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const _=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,_r);if(!_)return null;const x=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,_r);if(!x)return null;let E=null;return p.locale&&(E=h.parse(p.locale,1,nr),!E)?null:new ga(_,x,E)}evaluate(c){return new Tl(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}class zs{constructor(c,h,p,_,x){this.type=nr,this.number=c,this.locale=h,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(c,h){if(c.length!==3)return h.error("Expected two arguments.");const p=h.parse(c[1],1,Fe);if(!p)return null;const _=c[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=h.parse(_.locale,1,nr),!x))return null;let E=null;if(_.currency&&(E=h.parse(_.currency,1,nr),!E))return null;let I=null;if(_["min-fraction-digits"]&&(I=h.parse(_["min-fraction-digits"],1,Fe),!I))return null;let R=null;return _["max-fraction-digits"]&&(R=h.parse(_["max-fraction-digits"],1,Fe),!R)?null:new zs(p,x,E,I,R)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class Sl{constructor(c){this.type=Ai,this.sections=c}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const p=c[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const _=[];let x=!1;for(let E=1;E<=c.length-1;++E){const I=c[E];if(x&&typeof I=="object"&&!Array.isArray(I)){x=!1;let R=null;if(I["font-scale"]&&(R=h.parse(I["font-scale"],1,Fe),!R))return null;let N=null;if(I["text-font"]&&(N=h.parse(I["text-font"],1,Hn(nr)),!N))return null;let V=null;if(I["text-color"]&&(V=h.parse(I["text-color"],1,Fr),!V))return null;let j=null;if(I["vertical-align"]){if(typeof I["vertical-align"]=="string"&&!Ku.includes(I["vertical-align"]))return h.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${I["vertical-align"]}' instead.`);if(j=h.parse(I["vertical-align"],1,nr),!j)return null}const tt=_[_.length-1];tt.scale=R,tt.font=N,tt.textColor=V,tt.verticalAlign=j}else{const R=h.parse(c[E],1,vr);if(!R)return null;const N=R.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Sl(_)}evaluate(c){return new It(this.sections.map(h=>{const p=h.content.evaluate(c);return nn(p)===Dn?new bt("",p,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(c):null):new bt(Xc(p),null,h.scale?h.scale.evaluate(c):null,h.font?h.font.evaluate(c).join(","):null,h.textColor?h.textColor.evaluate(c):null,h.verticalAlign?h.verticalAlign.evaluate(c):null)}))}eachChild(c){for(const h of this.sections)c(h.content),h.scale&&c(h.scale),h.font&&c(h.font),h.textColor&&c(h.textColor),h.verticalAlign&&c(h.verticalAlign)}outputDefined(){return!1}}class Il{constructor(c){this.type=Dn,this.input=c}static parse(c,h){if(c.length!==2)return h.error("Expected two arguments.");const p=h.parse(c[1],1,nr);return p?new Il(p):h.error("No image name provided.")}evaluate(c){const h=this.input.evaluate(c),p=Gr.fromString(h);return p&&c.availableImages&&(p.available=c.availableImages.indexOf(h)>-1),p}eachChild(c){c(this.input)}outputDefined(){return!1}}class zh{constructor(c){this.type=Fe,this.input=c}static parse(c,h){if(c.length!==2)return h.error(`Expected 1 argument, but found ${c.length-1} instead.`);const p=h.parse(c[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${xn(p.type)} instead.`):new zh(p):null}evaluate(c){const h=this.input.evaluate(c);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new xe(`Expected value to be of type string or array, but found ${xn(nn(h))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const Hs=8192;function iu(A,c){const h=(180+A[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A[1]*Math.PI/360)))/360,_=Math.pow(2,c.z);return[Math.round(h*_*Hs),Math.round(p*_*Hs)]}function su(A,c){const h=Math.pow(2,c.z);return[(_=(A[0]/Hs+c.x)/h,360*_-180),(p=(A[1]/Hs+c.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function ma(A,c){A[0]=Math.min(A[0],c[0]),A[1]=Math.min(A[1],c[1]),A[2]=Math.max(A[2],c[0]),A[3]=Math.max(A[3],c[1])}function Pl(A,c){return!(A[0]<=c[0]||A[2]>=c[2]||A[1]<=c[1]||A[3]>=c[3])}function D(A,c,h){const p=A[0]-c[0],_=A[1]-c[1],x=A[0]-h[0],E=A[1]-h[1];return p*E-x*_==0&&p*x<=0&&_*E<=0}function ht(A,c,h,p){return(_=[p[0]-h[0],p[1]-h[1]])[0]*(x=[c[0]-A[0],c[1]-A[1]])[1]-_[1]*x[0]!=0&&!(!Rr(A,c,h,p)||!Rr(h,p,A,c));var _,x}function zt(A,c,h){for(const p of h)for(let _=0;_<p.length-1;++_)if(ht(A,c,p[_],p[_+1]))return!0;return!1}function ie(A,c){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=!1;for(const I of c)for(let R=0;R<I.length-1;R++){if(D(A,I[R],I[R+1]))return h;(x=I[R])[1]>(_=A)[1]!=(E=I[R+1])[1]>_[1]&&_[0]<(E[0]-x[0])*(_[1]-x[1])/(E[1]-x[1])+x[0]&&(p=!p)}var _,x,E;return p}function Be(A,c){for(const h of c)if(ie(A,h))return!0;return!1}function Qe(A,c){for(const h of A)if(!ie(h,c))return!1;for(let h=0;h<A.length-1;++h)if(zt(A[h],A[h+1],c))return!1;return!0}function hr(A,c){for(const h of c)if(Qe(A,h))return!0;return!1}function Rr(A,c,h,p){const _=p[0]-h[0],x=p[1]-h[1],E=(A[0]-h[0])*x-_*(A[1]-h[1]),I=(c[0]-h[0])*x-_*(c[1]-h[1]);return E>0&&I<0||E<0&&I>0}function $r(A,c,h){const p=[];for(let _=0;_<A.length;_++){const x=[];for(let E=0;E<A[_].length;E++){const I=iu(A[_][E],h);ma(c,I),x.push(I)}p.push(x)}return p}function fn(A,c,h){const p=[];for(let _=0;_<A.length;_++){const x=$r(A[_],c,h);p.push(x)}return p}function An(A,c,h,p){if(A[0]<h[0]||A[0]>h[2]){const _=.5*p;let x=A[0]-h[0]>_?-p:h[0]-A[0]>_?p:0;x===0&&(x=A[0]-h[2]>_?-p:h[2]-A[0]>_?p:0),A[0]+=x}ma(c,A)}function Rn(A,c,h,p){const _=Math.pow(2,p.z)*Hs,x=[p.x*Hs,p.y*Hs],E=[];for(const I of A)for(const R of I){const N=[R.x+x[0],R.y+x[1]];An(N,c,h,_),E.push(N)}return E}function Ci(A,c,h,p){const _=Math.pow(2,p.z)*Hs,x=[p.x*Hs,p.y*Hs],E=[];for(const R of A){const N=[];for(const V of R){const j=[V.x+x[0],V.y+x[1]];ma(c,j),N.push(j)}E.push(N)}if(c[2]-c[0]<=_/2){(I=c)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const R of E)for(const N of R)An(N,c,h,_)}var I;return E}class ci{constructor(c,h){this.type=_r,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(_i(c[1])){const p=c[1];if(p.type==="FeatureCollection"){const _=[];for(const x of p.features){const{type:E,coordinates:I}=x.geometry;E==="Polygon"&&_.push(I),E==="MultiPolygon"&&_.push(...I)}if(_.length)return new ci(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ci(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ci(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(p.type==="Polygon"){const I=$r(p.coordinates,x,E),R=Rn(h.geometry(),_,x,E);if(!Pl(_,x))return!1;for(const N of R)if(!ie(N,I))return!1}if(p.type==="MultiPolygon"){const I=fn(p.coordinates,x,E),R=Rn(h.geometry(),_,x,E);if(!Pl(_,x))return!1;for(const N of R)if(!Be(N,I))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(p.type==="Polygon"){const I=$r(p.coordinates,x,E),R=Ci(h.geometry(),_,x,E);if(!Pl(_,x))return!1;for(const N of R)if(!Qe(N,I))return!1}if(p.type==="MultiPolygon"){const I=fn(p.coordinates,x,E),R=Ci(h.geometry(),_,x,E);if(!Pl(_,x))return!1;for(const N of R)if(!hr(N,I))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xi=class{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(h,p)=>h<p?-1:h>p?1:0;if(this.data=A,this.length=this.data.length,this.compare=c,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(A){this.data.push(A),this._up(this.length++)}pop(){if(this.length===0)return;const A=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),A}peek(){return this.data[0]}_up(A){const{data:c,compare:h}=this,p=c[A];for(;A>0;){const _=A-1>>1,x=c[_];if(h(p,x)>=0)break;c[A]=x,A=_}c[A]=p}_down(A){const{data:c,compare:h}=this,p=this.length>>1,_=c[A];for(;A<p;){let x=1+(A<<1);const E=x+1;if(E<this.length&&h(c[E],c[x])<0&&(x=E),h(c[x],_)>=0)break;c[A]=c[x],A=x}c[A]=_}};function Vs(A,c){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:A.length-1,_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:$o;for(;p>h;){if(p-h>600){const R=p-h+1,N=c-h+1,V=Math.log(R),j=.5*Math.exp(2*V/3),tt=.5*Math.sqrt(V*j*(R-j)/R)*(N-R/2<0?-1:1);Vs(A,c,Math.max(h,Math.floor(c-N*j/R+tt)),Math.min(p,Math.floor(c+(R-N)*j/R+tt)),_)}const x=A[c];let E=h,I=p;for(Gi(A,h,c),_(A[p],x)>0&&Gi(A,h,p);E<I;){for(Gi(A,E,I),E++,I--;_(A[E],x)<0;)E++;for(;_(A[I],x)>0;)I--}_(A[h],x)===0?Gi(A,h,I):(I++,Gi(A,I,p)),I<=c&&(h=I+1),c<=I&&(p=I-1)}}function Gi(A,c,h){const p=A[c];A[c]=A[h],A[h]=p}function $o(A,c){return A<c?-1:A>c?1:0}function fo(A,c){if(A.length<=1)return[A];const h=[];let p,_;for(const x of A){const E=kA(x);E!==0&&(x.area=Math.abs(E),_===void 0&&(_=E<0),_===E<0?(p&&h.push(p),p=[x]):p.push(x))}if(p&&h.push(p),c>1)for(let x=0;x<h.length;x++)h[x].length<=c||(Vs(h[x],c,1,h[x].length-1,ol),h[x]=h[x].slice(0,c));return h}function ol(A,c){return c.area-A.area}function kA(A){let c=0;for(let h,p,_=0,x=A.length,E=x-1;_<x;E=_++)h=A[_],p=A[E],c+=(p.x-h.x)*(h.y+p.y);return c}const ou=1/298.257223563,au=ou*(2-ou),lu=Math.PI/180;class cu{constructor(c){const h=6378.137*lu*1e3,p=Math.cos(c*lu),_=1/(1-au*(1-p*p)),x=Math.sqrt(_);this.kx=h*x*p,this.ky=h*x*_*(1-au)}distance(c,h){const p=this.wrap(c[0]-h[0])*this.kx,_=(c[1]-h[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(c,h){let p,_,x,E,I=1/0;for(let R=0;R<c.length-1;R++){let N=c[R][0],V=c[R][1],j=this.wrap(c[R+1][0]-N)*this.kx,tt=(c[R+1][1]-V)*this.ky,rt=0;j===0&&tt===0||(rt=(this.wrap(h[0]-N)*this.kx*j+(h[1]-V)*this.ky*tt)/(j*j+tt*tt),rt>1?(N=c[R+1][0],V=c[R+1][1]):rt>0&&(N+=j/this.kx*rt,V+=tt/this.ky*rt)),j=this.wrap(h[0]-N)*this.kx,tt=(h[1]-V)*this.ky;const lt=j*j+tt*tt;lt<I&&(I=lt,p=N,_=V,x=R,E=rt)}return{point:[p,_],index:x,t:Math.max(0,Math.min(1,E))}}wrap(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}}function uu(A,c){return c[0]-A[0]}function al(A){return A[1]-A[0]+1}function Ei(A,c){return A[1]>=A[0]&&A[1]<c}function ac(A,c){if(A[0]>A[1])return[null,null];const h=al(A);if(c){if(h===2)return[A,null];const _=Math.floor(h/2);return[[A[0],A[0]+_],[A[0]+_,A[1]]]}if(h===1)return[A,null];const p=Math.floor(h/2)-1;return[[A[0],A[0]+p],[A[0]+p+1,A[1]]]}function lc(A,c){if(!Ei(c,A.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let p=c[0];p<=c[1];++p)ma(h,A[p]);return h}function Ml(A){const c=[1/0,1/0,-1/0,-1/0];for(const h of A)for(const p of h)ma(c,p);return c}function Yu(A){return A[0]!==-1/0&&A[1]!==-1/0&&A[2]!==1/0&&A[3]!==1/0}function eo(A,c,h){if(!Yu(A)||!Yu(c))return NaN;let p=0,_=0;return A[2]<c[0]&&(p=c[0]-A[2]),A[0]>c[2]&&(p=A[0]-c[2]),A[1]>c[3]&&(_=A[1]-c[3]),A[3]<c[1]&&(_=c[1]-A[3]),h.distance([0,0],[p,_])}function Fl(A,c,h){const p=h.pointOnLine(c,A);return h.distance(A,p.point)}function hu(A,c,h,p,_){const x=Math.min(Fl(A,[h,p],_),Fl(c,[h,p],_)),E=Math.min(Fl(h,[A,c],_),Fl(p,[A,c],_));return Math.min(x,E)}function kn(A,c,h,p,_){if(!Ei(c,A.length)||!Ei(p,h.length))return 1/0;let x=1/0;for(let E=c[0];E<c[1];++E){const I=A[E],R=A[E+1];for(let N=p[0];N<p[1];++N){const V=h[N],j=h[N+1];if(ht(I,R,V,j))return 0;x=Math.min(x,hu(I,R,V,j,_))}}return x}function ya(A,c,h,p,_){if(!Ei(c,A.length)||!Ei(p,h.length))return NaN;let x=1/0;for(let E=c[0];E<=c[1];++E)for(let I=p[0];I<=p[1];++I)if(x=Math.min(x,_.distance(A[E],h[I])),x===0)return x;return x}function Ju(A,c,h){if(ie(A,c,!0))return 0;let p=1/0;for(const _ of c){const x=_[0],E=_[_.length-1];if(x!==E&&(p=Math.min(p,Fl(A,[E,x],h)),p===0))return p;const I=h.pointOnLine(_,A);if(p=Math.min(p,h.distance(A,I.point)),p===0)return p}return p}function QA(A,c,h,p){if(!Ei(c,A.length))return NaN;for(let x=c[0];x<=c[1];++x)if(ie(A[x],h,!0))return 0;let _=1/0;for(let x=c[0];x<c[1];++x){const E=A[x],I=A[x+1];for(const R of h)for(let N=0,V=R.length,j=V-1;N<V;j=N++){const tt=R[j],rt=R[N];if(ht(E,I,tt,rt))return 0;_=Math.min(_,hu(E,I,tt,rt,p))}}return _}function Hh(A,c){for(const h of A)for(const p of h)if(ie(p,c,!0))return!0;return!1}function cc(A,c,h){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const _=Ml(A),x=Ml(c);if(p!==1/0&&eo(_,x,h)>=p)return p;if(Pl(_,x)){if(Hh(A,c))return 0}else if(Hh(c,A))return 0;let E=1/0;for(const I of A)for(let R=0,N=I.length,V=N-1;R<N;V=R++){const j=I[V],tt=I[R];for(const rt of c)for(let lt=0,dt=rt.length,Pt=dt-1;lt<dt;Pt=lt++){const Mt=rt[Pt],ce=rt[lt];if(ht(j,tt,Mt,ce))return 0;E=Math.min(E,hu(j,tt,Mt,ce,h))}}return E}function uc(A,c,h,p,_,x){if(!x)return;const E=eo(lc(p,x),_,h);E<c&&A.push([E,x,[0,0]])}function Gs(A,c,h,p,_,x,E){if(!x||!E)return;const I=eo(lc(p,x),lc(_,E),h);I<c&&A.push([I,x,E])}function ws(A,c,h,p){let _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,x=Math.min(p.distance(A[0],h[0][0]),_);if(x===0)return x;const E=new Xi([[0,[0,A.length-1],[0,0]]],uu),I=Ml(h);for(;E.length>0;){const R=E.pop();if(R[0]>=x)continue;const N=R[1],V=c?50:100;if(al(N)<=V){if(!Ei(N,A.length))return NaN;if(c){const j=QA(A,N,h,p);if(isNaN(j)||j===0)return j;x=Math.min(x,j)}else for(let j=N[0];j<=N[1];++j){const tt=Ju(A[j],h,p);if(x=Math.min(x,tt),x===0)return 0}}else{const j=ac(N,c);uc(E,x,p,A,I,j[0]),uc(E,x,p,A,I,j[1])}}return x}function ka(A,c,h,p,_){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,E=Math.min(x,_.distance(A[0],h[0]));if(E===0)return E;const I=new Xi([[0,[0,A.length-1],[0,h.length-1]]],uu);for(;I.length>0;){const R=I.pop();if(R[0]>=E)continue;const N=R[1],V=R[2],j=c?50:100,tt=p?50:100;if(al(N)<=j&&al(V)<=tt){if(!Ei(N,A.length)&&Ei(V,h.length))return NaN;let rt;if(c&&p)rt=kn(A,N,h,V,_),E=Math.min(E,rt);else if(c&&!p){const lt=A.slice(N[0],N[1]+1);for(let dt=V[0];dt<=V[1];++dt)if(rt=Fl(h[dt],lt,_),E=Math.min(E,rt),E===0)return E}else if(!c&&p){const lt=h.slice(V[0],V[1]+1);for(let dt=N[0];dt<=N[1];++dt)if(rt=Fl(A[dt],lt,_),E=Math.min(E,rt),E===0)return E}else rt=ya(A,N,h,V,_),E=Math.min(E,rt)}else{const rt=ac(N,c),lt=ac(V,p);Gs(I,E,_,A,h,rt[0],lt[0]),Gs(I,E,_,A,h,rt[0],lt[1]),Gs(I,E,_,A,h,rt[1],lt[0]),Gs(I,E,_,A,h,rt[1],lt[1])}}return E}function Qa(A){return A.type==="MultiPolygon"?A.coordinates.map(c=>({type:"Polygon",coordinates:c})):A.type==="MultiLineString"?A.coordinates.map(c=>({type:"LineString",coordinates:c})):A.type==="MultiPoint"?A.coordinates.map(c=>({type:"Point",coordinates:c})):[A]}class po{constructor(c,h){this.type=Fe,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${c.length-1} instead.`);if(_i(c[1])){const p=c[1];if(p.type==="FeatureCollection")return new po(p,p.features.map(_=>Qa(_.geometry)).flat());if(p.type==="Feature")return new po(p,Qa(p.geometry));if("type"in p&&"coordinates"in p)return new po(p,Qa(p))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,p){const _=h.geometry(),x=_.flat().map(R=>su([R.x,R.y],h.canonical));if(_.length===0)return NaN;const E=new cu(x[0][1]);let I=1/0;for(const R of p){switch(R.type){case"Point":I=Math.min(I,ka(x,!1,[R.coordinates],!1,E,I));break;case"LineString":I=Math.min(I,ka(x,!1,R.coordinates,!0,E,I));break;case"Polygon":I=Math.min(I,ws(x,!1,R.coordinates,E,I))}if(I===0)return I}return I}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,p){const _=h.geometry(),x=_.flat().map(R=>su([R.x,R.y],h.canonical));if(_.length===0)return NaN;const E=new cu(x[0][1]);let I=1/0;for(const R of p){switch(R.type){case"Point":I=Math.min(I,ka(x,!0,[R.coordinates],!1,E,I));break;case"LineString":I=Math.min(I,ka(x,!0,R.coordinates,!0,E,I));break;case"Polygon":I=Math.min(I,ws(x,!0,R.coordinates,E,I))}if(I===0)return I}return I}(c,this.geometries);if(c.geometryType()==="Polygon")return function(h,p){const _=h.geometry();if(_.length===0||_[0].length===0)return NaN;const x=fo(_,0).map(R=>R.map(N=>N.map(V=>su([V.x,V.y],h.canonical)))),E=new cu(x[0][0][0][1]);let I=1/0;for(const R of p)for(const N of x){switch(R.type){case"Point":I=Math.min(I,ws([R.coordinates],!1,N,E,I));break;case"LineString":I=Math.min(I,ws(R.coordinates,!0,N,E,I));break;case"Polygon":I=Math.min(I,cc(N,R.coordinates,E,I))}if(I===0)return I}return I}(c,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const za={"==":NA,"!=":Xu,">":ru,"<":Zu,">=":nu,"<=":Qh,array:Lo,at:Yc,boolean:Lo,case:pa,coalesce:Oo,collator:ga,format:Sl,image:Il,in:Sn,"index-of":sl,interpolate:Pn,"interpolate-hcl":Pn,"interpolate-lab":Pn,length:zh,let:vn,literal:Ko,match:Qs,number:Lo,"number-format":zs,object:Lo,slice:Jc,step:Na,string:Lo,"to-boolean":bs,"to-color":bs,"to-number":bs,"to-string":bs,var:ln,within:ci,distance:po};class is{constructor(c,h,p,_){this.name=c,this.type=h,this._evaluate=p,this.args=_}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,h){const p=c[0],_=is.definitions[p];if(!_)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,E=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,I=E.filter(N=>{let[V]=N;return!Array.isArray(V)||V.length===c.length-1});let R=null;for(const[N,V]of I){R=new Ua(h.registry,Ll,h.path,null,h.scope);const j=[];let tt=!1;for(let rt=1;rt<c.length;rt++){const lt=c[rt],dt=Array.isArray(N)?N[rt-1]:N.type,Pt=R.parse(lt,1+j.length,dt);if(!Pt){tt=!0;break}j.push(Pt)}if(!tt)if(Array.isArray(N)&&N.length!==j.length)R.error(`Expected ${N.length} arguments, but found ${j.length} instead.`);else{for(let rt=0;rt<j.length;rt++){const lt=Array.isArray(N)?N[rt]:N.type,dt=j[rt];R.concat(rt+1).checkSubtype(lt,dt.type)}if(R.errors.length===0)return new is(p,x,V,j)}}if(I.length===1)h.errors.push(...R.errors);else{const N=(I.length?I:E).map(j=>{let[tt]=j;return rt=tt,Array.isArray(rt)?`(${rt.map(xn).join(", ")})`:`(${xn(rt.type)}...)`;var rt}).join(" | "),V=[];for(let j=1;j<c.length;j++){const tt=h.parse(c[j],1+V.length);if(!tt)return null;V.push(xn(tt.type))}h.error(`Expected arguments of type ${N}, but found (${V.join(", ")}) instead.`)}return null}static register(c,h){is.definitions=h;for(const p in h)c[p]=is}}function ji(A,c){let[h,p,_,x]=c;h=h.evaluate(A),p=p.evaluate(A),_=_.evaluate(A);const E=x?x.evaluate(A):1,I=yi(h,p,_,E);if(I)throw new xe(I);return new cn(h/255,p/255,_/255,E,!1)}function th(A,c){return A in c}function js(A,c){const h=c[A];return h===void 0?null:h}function xs(A){return{type:A}}function Ll(A){if(A instanceof ln)return Ll(A.boundExpression);if(A instanceof is&&A.name==="error"||A instanceof ga||A instanceof ci||A instanceof po)return!1;const c=A instanceof bs||A instanceof Lo;let h=!0;return A.eachChild(p=>{h=c?h&&Ll(p):h&&p instanceof Ko}),!!h&&Au(A)&&ll(A,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Au(A){if(A instanceof is&&(A.name==="get"&&A.args.length===1||A.name==="feature-state"||A.name==="has"&&A.args.length===1||A.name==="properties"||A.name==="geometry-type"||A.name==="id"||/^filter-/.test(A.name))||A instanceof ci||A instanceof po)return!1;let c=!0;return A.eachChild(h=>{c&&!Au(h)&&(c=!1)}),c}function Rl(A){if(A instanceof is&&A.name==="feature-state")return!1;let c=!0;return A.eachChild(h=>{c&&!Rl(h)&&(c=!1)}),c}function ll(A,c){if(A instanceof is&&c.indexOf(A.name)>=0)return!1;let h=!0;return A.eachChild(p=>{h&&!ll(p,c)&&(h=!1)}),h}function hc(A){return{result:"success",value:A}}function Xo(A){return{result:"error",value:A}}function _a(A){return A["property-type"]==="data-driven"||A["property-type"]==="cross-faded-data-driven"}function du(A){return!!A.expression&&A.expression.parameters.indexOf("zoom")>-1}function Ol(A){return!!A.expression&&A.expression.interpolated}function yn(A){return A instanceof Number?"number":A instanceof String?"string":A instanceof Boolean?"boolean":Array.isArray(A)?"array":A===null?"null":typeof A}function Ac(A){return typeof A=="object"&&A!==null&&!Array.isArray(A)}function va(A){return A}function Zo(A,c){const h=c.type==="color",p=A.stops&&typeof A.stops[0][0]=="object",_=p||!(p||A.property!==void 0),x=A.type||(Ol(c)?"exponential":"interval");if(h||c.type==="padding"){const V=h?cn.parse:jt.parse;(A=ur({},A)).stops&&(A.stops=A.stops.map(j=>[j[0],V(j[1])])),A.default=V(A.default?A.default:c.default)}if(A.colorSpace&&(E=A.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${A.colorSpace}"`);var E;let I,R,N;if(x==="exponential")I=ss;else if(x==="interval")I=Zi;else if(x==="categorical"){I=ui,R=Object.create(null);for(const V of A.stops)R[V[0]]=V[1];N=typeof A.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);I=Ul}if(p){const V={},j=[];for(let lt=0;lt<A.stops.length;lt++){const dt=A.stops[lt],Pt=dt[0].zoom;V[Pt]===void 0&&(V[Pt]={zoom:Pt,type:A.type,property:A.property,default:A.default,stops:[]},j.push(Pt)),V[Pt].stops.push([dt[0].value,dt[1]])}const tt=[];for(const lt of j)tt.push([V[lt].zoom,Zo(V[lt],c)]);const rt={name:"linear"};return{kind:"composite",interpolationType:rt,interpolationFactor:Pn.interpolationFactor.bind(void 0,rt),zoomStops:tt.map(lt=>lt[0]),evaluate:(lt,dt)=>{let{zoom:Pt}=lt;return ss({stops:tt,base:A.base},c,Pt).evaluate(Pt,dt)}}}if(_){const V=x==="exponential"?{name:"exponential",base:A.base!==void 0?A.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:Pn.interpolationFactor.bind(void 0,V),zoomStops:A.stops.map(j=>j[0]),evaluate:j=>{let{zoom:tt}=j;return I(A,c,tt,R,N)}}}return{kind:"source",evaluate(V,j){const tt=j&&j.properties?j.properties[A.property]:void 0;return tt===void 0?Zn(A.default,c.default):I(A,c,tt,R,N)}}}function Zn(A,c,h){return A!==void 0?A:c!==void 0?c:h!==void 0?h:void 0}function ui(A,c,h,p,_){return Zn(typeof h===_?p[h]:void 0,A.default,c.default)}function Zi(A,c,h){if(yn(h)!=="number")return Zn(A.default,c.default);const p=A.stops.length;if(p===1||h<=A.stops[0][0])return A.stops[0][1];if(h>=A.stops[p-1][0])return A.stops[p-1][1];const _=Da(A.stops.map(x=>x[0]),h);return A.stops[_][1]}function ss(A,c,h){const p=A.base!==void 0?A.base:1;if(yn(h)!=="number")return Zn(A.default,c.default);const _=A.stops.length;if(_===1||h<=A.stops[0][0])return A.stops[0][1];if(h>=A.stops[_-1][0])return A.stops[_-1][1];const x=Da(A.stops.map(V=>V[0]),h),E=function(V,j,tt,rt){const lt=rt-tt,dt=V-tt;return lt===0?0:j===1?dt/lt:(Math.pow(j,dt)-1)/(Math.pow(j,lt)-1)}(h,p,A.stops[x][0],A.stops[x+1][0]),I=A.stops[x][1],R=A.stops[x+1][1],N=Wo[c.type]||va;return typeof I.evaluate=="function"?{evaluate(){for(var V=arguments.length,j=new Array(V),tt=0;tt<V;tt++)j[tt]=arguments[tt];const rt=I.evaluate.apply(void 0,j),lt=R.evaluate.apply(void 0,j);if(rt!==void 0&&lt!==void 0)return N(rt,lt,E,A.colorSpace)}}:N(I,R,E,A.colorSpace)}function Ul(A,c,h){switch(c.type){case"color":h=cn.parse(h);break;case"formatted":h=It.fromString(h.toString());break;case"resolvedImage":h=Gr.fromString(h.toString());break;case"padding":h=jt.parse(h);break;default:yn(h)===c.type||c.type==="enum"&&c.values[h]||(h=void 0)}return Zn(h,A.default,c.default)}is.register(za,{error:[{kind:"error"},[nr],(A,c)=>{let[h]=c;throw new xe(h.evaluate(A))}],typeof:[nr,[vr],(A,c)=>{let[h]=c;return xn(nn(h.evaluate(A)))}],"to-rgba":[Hn(Fe,4),[Fr],(A,c)=>{let[h]=c;const[p,_,x,E]=h.evaluate(A).rgb;return[255*p,255*_,255*x,E]}],rgb:[Fr,[Fe,Fe,Fe],ji],rgba:[Fr,[Fe,Fe,Fe,Fe],ji],has:{type:_r,overloads:[[[nr],(A,c)=>{let[h]=c;return th(h.evaluate(A),A.properties())}],[[nr,Qr],(A,c)=>{let[h,p]=c;return th(h.evaluate(A),p.evaluate(A))}]]},get:{type:vr,overloads:[[[nr],(A,c)=>{let[h]=c;return js(h.evaluate(A),A.properties())}],[[nr,Qr],(A,c)=>{let[h,p]=c;return js(h.evaluate(A),p.evaluate(A))}]]},"feature-state":[vr,[nr],(A,c)=>{let[h]=c;return js(h.evaluate(A),A.featureState||{})}],properties:[Qr,[],A=>A.properties()],"geometry-type":[nr,[],A=>A.geometryType()],id:[vr,[],A=>A.id()],zoom:[Fe,[],A=>A.globals.zoom],"heatmap-density":[Fe,[],A=>A.globals.heatmapDensity||0],"line-progress":[Fe,[],A=>A.globals.lineProgress||0],accumulated:[vr,[],A=>A.globals.accumulated===void 0?null:A.globals.accumulated],"+":[Fe,xs(Fe),(A,c)=>{let h=0;for(const p of c)h+=p.evaluate(A);return h}],"*":[Fe,xs(Fe),(A,c)=>{let h=1;for(const p of c)h*=p.evaluate(A);return h}],"-":{type:Fe,overloads:[[[Fe,Fe],(A,c)=>{let[h,p]=c;return h.evaluate(A)-p.evaluate(A)}],[[Fe],(A,c)=>{let[h]=c;return-h.evaluate(A)}]]},"/":[Fe,[Fe,Fe],(A,c)=>{let[h,p]=c;return h.evaluate(A)/p.evaluate(A)}],"%":[Fe,[Fe,Fe],(A,c)=>{let[h,p]=c;return h.evaluate(A)%p.evaluate(A)}],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(A,c)=>{let[h,p]=c;return Math.pow(h.evaluate(A),p.evaluate(A))}],sqrt:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.sqrt(h.evaluate(A))}],log10:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.log(h.evaluate(A))/Math.LN10}],ln:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.log(h.evaluate(A))}],log2:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.log(h.evaluate(A))/Math.LN2}],sin:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.sin(h.evaluate(A))}],cos:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.cos(h.evaluate(A))}],tan:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.tan(h.evaluate(A))}],asin:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.asin(h.evaluate(A))}],acos:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.acos(h.evaluate(A))}],atan:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.atan(h.evaluate(A))}],min:[Fe,xs(Fe),(A,c)=>Math.min(...c.map(h=>h.evaluate(A)))],max:[Fe,xs(Fe),(A,c)=>Math.max(...c.map(h=>h.evaluate(A)))],abs:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.abs(h.evaluate(A))}],round:[Fe,[Fe],(A,c)=>{let[h]=c;const p=h.evaluate(A);return p<0?-Math.round(-p):Math.round(p)}],floor:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.floor(h.evaluate(A))}],ceil:[Fe,[Fe],(A,c)=>{let[h]=c;return Math.ceil(h.evaluate(A))}],"filter-==":[_r,[nr,vr],(A,c)=>{let[h,p]=c;return A.properties()[h.value]===p.value}],"filter-id-==":[_r,[vr],(A,c)=>{let[h]=c;return A.id()===h.value}],"filter-type-==":[_r,[nr],(A,c)=>{let[h]=c;return A.geometryType()===h.value}],"filter-<":[_r,[nr,vr],(A,c)=>{let[h,p]=c;const _=A.properties()[h.value],x=p.value;return typeof _==typeof x&&_<x}],"filter-id-<":[_r,[vr],(A,c)=>{let[h]=c;const p=A.id(),_=h.value;return typeof p==typeof _&&p<_}],"filter->":[_r,[nr,vr],(A,c)=>{let[h,p]=c;const _=A.properties()[h.value],x=p.value;return typeof _==typeof x&&_>x}],"filter-id->":[_r,[vr],(A,c)=>{let[h]=c;const p=A.id(),_=h.value;return typeof p==typeof _&&p>_}],"filter-<=":[_r,[nr,vr],(A,c)=>{let[h,p]=c;const _=A.properties()[h.value],x=p.value;return typeof _==typeof x&&_<=x}],"filter-id-<=":[_r,[vr],(A,c)=>{let[h]=c;const p=A.id(),_=h.value;return typeof p==typeof _&&p<=_}],"filter->=":[_r,[nr,vr],(A,c)=>{let[h,p]=c;const _=A.properties()[h.value],x=p.value;return typeof _==typeof x&&_>=x}],"filter-id->=":[_r,[vr],(A,c)=>{let[h]=c;const p=A.id(),_=h.value;return typeof p==typeof _&&p>=_}],"filter-has":[_r,[vr],(A,c)=>{let[h]=c;return h.value in A.properties()}],"filter-has-id":[_r,[],A=>A.id()!==null&&A.id()!==void 0],"filter-type-in":[_r,[Hn(nr)],(A,c)=>{let[h]=c;return h.value.indexOf(A.geometryType())>=0}],"filter-id-in":[_r,[Hn(vr)],(A,c)=>{let[h]=c;return h.value.indexOf(A.id())>=0}],"filter-in-small":[_r,[nr,Hn(vr)],(A,c)=>{let[h,p]=c;return p.value.indexOf(A.properties()[h.value])>=0}],"filter-in-large":[_r,[nr,Hn(vr)],(A,c)=>{let[h,p]=c;return function(_,x,E,I){for(;E<=I;){const R=E+I>>1;if(x[R]===_)return!0;x[R]>_?I=R-1:E=R+1}return!1}(A.properties()[h.value],p.value,0,p.value.length-1)}],all:{type:_r,overloads:[[[_r,_r],(A,c)=>{let[h,p]=c;return h.evaluate(A)&&p.evaluate(A)}],[xs(_r),(A,c)=>{for(const h of c)if(!h.evaluate(A))return!1;return!0}]]},any:{type:_r,overloads:[[[_r,_r],(A,c)=>{let[h,p]=c;return h.evaluate(A)||p.evaluate(A)}],[xs(_r),(A,c)=>{for(const h of c)if(h.evaluate(A))return!0;return!1}]]},"!":[_r,[_r],(A,c)=>{let[h]=c;return!h.evaluate(A)}],"is-supported-script":[_r,[nr],(A,c)=>{let[h]=c;const p=A.globals&&A.globals.isSupportedScript;return!p||p(h.evaluate(A))}],upcase:[nr,[nr],(A,c)=>{let[h]=c;return h.evaluate(A).toUpperCase()}],downcase:[nr,[nr],(A,c)=>{let[h]=c;return h.evaluate(A).toLowerCase()}],concat:[nr,xs(vr),(A,c)=>c.map(h=>Xc(h.evaluate(A))).join("")],"resolved-locale":[nr,[wn],(A,c)=>{let[h]=c;return h.evaluate(A).resolvedLocale()}]});class dc{constructor(c,h){var p;this.expression=c,this._warningHistory={},this._evaluator=new ii,this._defaultValue=h?(p=h).type==="color"&&Ac(p.default)?new cn(0,0,0,0):p.type==="color"?cn.parse(p.default)||null:p.type==="padding"?jt.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Cr.parse(p.default)||null:p.type==="projectionDefinition"?Bn.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(c,h,p,_,x,E){return this._evaluator.globals=c,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(c,h,p,_,x,E){this._evaluator.globals=c,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new xe(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Dl(A){return Array.isArray(A)&&A.length>0&&typeof A[0]=="string"&&A[0]in za}function fu(A,c){const h=new Ua(za,Ll,[],c?function(_){const x={color:Fr,string:nr,number:Fe,enum:nr,boolean:_r,formatted:Ai,padding:mn,projectionDefinition:Yr,resolvedImage:Dn,variableAnchorOffsetCollection:gn};return _.type==="array"?Hn(x[_.value]||vr,_.length):x[_.type]}(c):void 0),p=h.parse(A,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?hc(new dc(p,c)):Xo(h.errors)}class fc{constructor(c,h){this.kind=c,this._styleExpression=h,this.isStateDependent=c!=="constant"&&!Rl(h.expression)}evaluateWithoutErrorHandling(c,h,p,_,x,E){return this._styleExpression.evaluateWithoutErrorHandling(c,h,p,_,x,E)}evaluate(c,h,p,_,x,E){return this._styleExpression.evaluate(c,h,p,_,x,E)}}class pu{constructor(c,h,p,_){this.kind=c,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=c!=="camera"&&!Rl(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(c,h,p,_,x,E){return this._styleExpression.evaluateWithoutErrorHandling(c,h,p,_,x,E)}evaluate(c,h,p,_,x,E){return this._styleExpression.evaluate(c,h,p,_,x,E)}interpolationFactor(c,h,p){return this.interpolationType?Pn.interpolationFactor(this.interpolationType,c,h,p):0}}function Do(A,c){const h=fu(A,c);if(h.result==="error")return h;const p=h.value.expression,_=Au(p);if(!_&&!_a(c))return Xo([new ir("","data expressions not supported")]);const x=ll(p,["zoom"]);if(!x&&!du(c))return Xo([new ir("","zoom expressions not supported")]);const E=gu(p);return E||x?E instanceof ir?Xo([E]):E instanceof Pn&&!Ol(c)?Xo([new ir("",'"interpolate" expressions cannot be used with this property')]):hc(E?new pu(_?"camera":"composite",h.value,E.labels,E instanceof Pn?E.interpolation:void 0):new fc(_?"constant":"source",h.value)):Xo([new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class go{constructor(c,h){this._parameters=c,this._specification=h,ur(this,Zo(this._parameters,this._specification))}static deserialize(c){return new go(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function gu(A){let c=null;if(A instanceof vn)c=gu(A.result);else if(A instanceof Oo){for(const h of A.args)if(c=gu(h),c)break}else(A instanceof Na||A instanceof Pn)&&A.input instanceof is&&A.input.name==="zoom"&&(c=A);return c instanceof ir||A.eachChild(h=>{const p=gu(h);p instanceof ir?c=p:!c&&p?c=new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&p&&c!==p&&(c=new ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function eh(A){if(A===!0||A===!1)return!0;if(!Array.isArray(A)||A.length===0)return!1;switch(A[0]){case"has":return A.length>=2&&A[1]!=="$id"&&A[1]!=="$type";case"in":return A.length>=3&&(typeof A[1]!="string"||Array.isArray(A[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return A.length!==3||Array.isArray(A[1])||Array.isArray(A[2]);case"any":case"all":for(const c of A.slice(1))if(!eh(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const Ap={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mu(A){if(A==null)return{filter:()=>!0,needGeometry:!1};eh(A)||(A=Gh(A));const c=fu(A,Ap);if(c.result==="error")throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,_)=>c.value.evaluate(h,p,{},_),needGeometry:zA(A)}}function Vh(A,c){return A<c?-1:A>c?1:0}function zA(A){if(!Array.isArray(A))return!1;if(A[0]==="within"||A[0]==="distance")return!0;for(let c=1;c<A.length;c++)if(zA(A[c]))return!0;return!1}function Gh(A){if(!A)return!0;const c=A[0];return A.length<=1?c!=="any":c==="=="?rh(A[1],A[2],"=="):c==="!="?yu(rh(A[1],A[2],"==")):c==="<"||c===">"||c==="<="||c===">="?rh(A[1],A[2],c):c==="any"?(h=A.slice(1),["any"].concat(h.map(Gh))):c==="all"?["all"].concat(A.slice(1).map(Gh)):c==="none"?["all"].concat(A.slice(1).map(Gh).map(yu)):c==="in"?jh(A[1],A.slice(2)):c==="!in"?yu(jh(A[1],A.slice(2))):c==="has"?nh(A[1]):c!=="!has"||yu(nh(A[1]));var h}function rh(A,c,h){switch(A){case"$type":return[`filter-type-${h}`,c];case"$id":return[`filter-id-${h}`,c];default:return[`filter-${h}`,A,c]}}function jh(A,c){if(c.length===0)return!1;switch(A){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(h=>typeof h!=typeof c[0])?["filter-in-large",A,["literal",c.sort(Vh)]]:["filter-in-small",A,["literal",c]]}}function nh(A){switch(A){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",A]}}function yu(A){return["!",A]}function qh(A){const c=typeof A;if(c==="number"||c==="boolean"||c==="string"||A==null)return JSON.stringify(A);if(Array.isArray(A)){let _="[";for(const x of A)_+=`${qh(x)},`;return`${_}]`}const h=Object.keys(A).sort();let p="{";for(let _=0;_<h.length;_++)p+=`${JSON.stringify(h[_])}:${qh(A[h[_]])},`;return`${p}}`}function zd(A){let c="";for(const h of ct)c+=`/${qh(A[h])}`;return c}function Kh(A){const c=A.value;return c?[new Yt(A.key,c,"constants have been deprecated as of v8")]:[]}function Ti(A){return A instanceof Number||A instanceof String||A instanceof Boolean?A.valueOf():A}function _u(A){if(Array.isArray(A))return A.map(_u);if(A instanceof Object&&!(A instanceof Number||A instanceof String||A instanceof Boolean)){const c={};for(const h in A)c[h]=_u(A[h]);return c}return Ti(A)}function ba(A){const c=A.key,h=A.value,p=A.valueSpec||{},_=A.objectElementValidators||{},x=A.style,E=A.styleSpec,I=A.validateSpec;let R=[];const N=yn(h);if(N!=="object")return[new Yt(c,h,`object expected, ${N} found`)];for(const V in h){const j=V.split(".")[0],tt=p[j]||p["*"];let rt;if(_[j])rt=_[j];else if(p[j])rt=I;else if(_["*"])rt=_["*"];else{if(!p["*"]){R.push(new Yt(c,h[V],`unknown property "${V}"`));continue}rt=I}R=R.concat(rt({key:(c&&`${c}.`)+V,value:h[V],valueSpec:tt,style:x,styleSpec:E,object:h,objectKey:V,validateSpec:I},h))}for(const V in p)_[V]||p[V].required&&p[V].default===void 0&&h[V]===void 0&&R.push(new Yt(c,h,`missing required property "${V}"`));return R}function Hd(A){const c=A.value,h=A.valueSpec,p=A.style,_=A.styleSpec,x=A.key,E=A.arrayElementValidator||A.validateSpec;if(yn(c)!=="array")return[new Yt(x,c,`array expected, ${yn(c)} found`)];if(h.length&&c.length!==h.length)return[new Yt(x,c,`array length ${h.length} expected, length ${c.length} found`)];if(h["min-length"]&&c.length<h["min-length"])return[new Yt(x,c,`array length at least ${h["min-length"]} expected, length ${c.length} found`)];let I={type:h.value,values:h.values};_.$version<7&&(I.function=h.function),yn(h.value)==="object"&&(I=h.value);let R=[];for(let N=0;N<c.length;N++)R=R.concat(E({array:c,arrayIndex:N,value:c[N],valueSpec:I,validateSpec:A.validateSpec,style:p,styleSpec:_,key:`${x}[${N}]`}));return R}function Vd(A){const c=A.key,h=A.value,p=A.valueSpec;let _=yn(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new Yt(c,h,`number expected, ${_} found`)]:"minimum"in p&&h<p.minimum?[new Yt(c,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new Yt(c,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function HA(A){const c=A.valueSpec,h=Ti(A.value.type);let p,_,x,E={};const I=h!=="categorical"&&A.value.property===void 0,R=!I,N=yn(A.value.stops)==="array"&&yn(A.value.stops[0])==="array"&&yn(A.value.stops[0][0])==="object",V=ba({key:A.key,value:A.value,valueSpec:A.styleSpec.function,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{stops:function(rt){if(h==="identity")return[new Yt(rt.key,rt.value,'identity function may not have a "stops" property')];let lt=[];const dt=rt.value;return lt=lt.concat(Hd({key:rt.key,value:dt,valueSpec:rt.valueSpec,validateSpec:rt.validateSpec,style:rt.style,styleSpec:rt.styleSpec,arrayElementValidator:j})),yn(dt)==="array"&&dt.length===0&&lt.push(new Yt(rt.key,dt,"array must have at least one stop")),lt},default:function(rt){return rt.validateSpec({key:rt.key,value:rt.value,valueSpec:c,validateSpec:rt.validateSpec,style:rt.style,styleSpec:rt.styleSpec})}}});return h==="identity"&&I&&V.push(new Yt(A.key,A.value,'missing required property "property"')),h==="identity"||A.value.stops||V.push(new Yt(A.key,A.value,'missing required property "stops"')),h==="exponential"&&A.valueSpec.expression&&!Ol(A.valueSpec)&&V.push(new Yt(A.key,A.value,"exponential functions not supported")),A.styleSpec.$version>=8&&(R&&!_a(A.valueSpec)?V.push(new Yt(A.key,A.value,"property functions not supported")):I&&!du(A.valueSpec)&&V.push(new Yt(A.key,A.value,"zoom functions not supported"))),h!=="categorical"&&!N||A.value.property!==void 0||V.push(new Yt(A.key,A.value,'"property" property is required')),V;function j(rt){let lt=[];const dt=rt.value,Pt=rt.key;if(yn(dt)!=="array")return[new Yt(Pt,dt,`array expected, ${yn(dt)} found`)];if(dt.length!==2)return[new Yt(Pt,dt,`array length 2 expected, length ${dt.length} found`)];if(N){if(yn(dt[0])!=="object")return[new Yt(Pt,dt,`object expected, ${yn(dt[0])} found`)];if(dt[0].zoom===void 0)return[new Yt(Pt,dt,"object stop key must have zoom")];if(dt[0].value===void 0)return[new Yt(Pt,dt,"object stop key must have value")];if(x&&x>Ti(dt[0].zoom))return[new Yt(Pt,dt[0].zoom,"stop zoom values must appear in ascending order")];Ti(dt[0].zoom)!==x&&(x=Ti(dt[0].zoom),_=void 0,E={}),lt=lt.concat(ba({key:`${Pt}[0]`,value:dt[0],valueSpec:{zoom:{}},validateSpec:rt.validateSpec,style:rt.style,styleSpec:rt.styleSpec,objectElementValidators:{zoom:Vd,value:tt}}))}else lt=lt.concat(tt({key:`${Pt}[0]`,value:dt[0],valueSpec:{},validateSpec:rt.validateSpec,style:rt.style,styleSpec:rt.styleSpec},dt));return Dl(_u(dt[1]))?lt.concat([new Yt(`${Pt}[1]`,dt[1],"expressions are not allowed in function stops.")]):lt.concat(rt.validateSpec({key:`${Pt}[1]`,value:dt[1],valueSpec:c,validateSpec:rt.validateSpec,style:rt.style,styleSpec:rt.styleSpec}))}function tt(rt,lt){const dt=yn(rt.value),Pt=Ti(rt.value),Mt=rt.value!==null?rt.value:lt;if(p){if(dt!==p)return[new Yt(rt.key,Mt,`${dt} stop domain type must match previous stop domain type ${p}`)]}else p=dt;if(dt!=="number"&&dt!=="string"&&dt!=="boolean")return[new Yt(rt.key,Mt,"stop domain value must be a number, string, or boolean")];if(dt!=="number"&&h!=="categorical"){let ce=`number expected, ${dt} found`;return _a(c)&&h===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Yt(rt.key,Mt,ce)]}return h!=="categorical"||dt!=="number"||isFinite(Pt)&&Math.floor(Pt)===Pt?h!=="categorical"&&dt==="number"&&_!==void 0&&Pt<_?[new Yt(rt.key,Mt,"stop domain values must appear in ascending order")]:(_=Pt,h==="categorical"&&Pt in E?[new Yt(rt.key,Mt,"stop domain values must be unique")]:(E[Pt]=!0,[])):[new Yt(rt.key,Mt,`integer expected, found ${Pt}`)]}}function pc(A){const c=(A.expressionContext==="property"?Do:fu)(_u(A.value),A.valueSpec);if(c.result==="error")return c.value.map(p=>new Yt(`${A.key}${p.key}`,A.value,p.message));const h=c.value.expression||c.value._styleExpression.expression;if(A.expressionContext==="property"&&A.propertyKey==="text-font"&&!h.outputDefined())return[new Yt(A.key,A.value,`Invalid data expression for "${A.propertyKey}". Output values must be contained as literals within the expression.`)];if(A.expressionContext==="property"&&A.propertyType==="layout"&&!Rl(h))return[new Yt(A.key,A.value,'"feature-state" data expressions are not supported with layout properties.')];if(A.expressionContext==="filter"&&!Rl(h))return[new Yt(A.key,A.value,'"feature-state" data expressions are not supported with filters.')];if(A.expressionContext&&A.expressionContext.indexOf("cluster")===0){if(!ll(h,["zoom","feature-state"]))return[new Yt(A.key,A.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(A.expressionContext==="cluster-initial"&&!Au(h))return[new Yt(A.key,A.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cl(A){const c=A.key,h=A.value,p=A.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(Ti(h))===-1&&_.push(new Yt(c,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Ti(h))===-1&&_.push(new Yt(c,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function VA(A){return eh(_u(A.value))?pc(ur({},A,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wh(A)}function Wh(A){const c=A.value,h=A.key;if(yn(c)!=="array")return[new Yt(h,c,`array expected, ${yn(c)} found`)];const p=A.styleSpec;let _,x=[];if(c.length<1)return[new Yt(h,c,"filter array must have at least 1 element")];switch(x=x.concat(cl({key:`${h}[0]`,value:c[0],valueSpec:p.filter_operator,style:A.style,styleSpec:A.styleSpec})),Ti(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Ti(c[1])==="$type"&&x.push(new Yt(h,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&x.push(new Yt(h,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(_=yn(c[1]),_!=="string"&&x.push(new Yt(`${h}[1]`,c[1],`string expected, ${_} found`)));for(let E=2;E<c.length;E++)_=yn(c[E]),Ti(c[1])==="$type"?x=x.concat(cl({key:`${h}[${E}]`,value:c[E],valueSpec:p.geometry_type,style:A.style,styleSpec:A.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new Yt(`${h}[${E}]`,c[E],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let E=1;E<c.length;E++)x=x.concat(Wh({key:`${h}[${E}]`,value:c[E],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":_=yn(c[1]),c.length!==2?x.push(new Yt(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new Yt(`${h}[1]`,c[1],`string expected, ${_} found`))}return x}function Gd(A,c){const h=A.key,p=A.validateSpec,_=A.style,x=A.styleSpec,E=A.value,I=A.objectKey,R=x[`${c}_${A.layerType}`];if(!R)return[];const N=I.match(/^(.*)-transition$/);if(c==="paint"&&N&&R[N[1]]&&R[N[1]].transition)return p({key:h,value:E,valueSpec:x.transition,style:_,styleSpec:x});const V=A.valueSpec||R[I];if(!V)return[new Yt(h,E,`unknown property "${I}"`)];let j;if(yn(E)==="string"&&_a(V)&&!V.tokens&&(j=/^{([^}]+)}$/.exec(E)))return[new Yt(h,E,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const tt=[];return A.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&tt.push(new Yt(h,E,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Ac(_u(E))&&Ti(E.type)==="identity"&&tt.push(new Yt(h,E,'"text-font" does not support identity functions'))),tt.concat(p({key:A.key,value:E,valueSpec:V,style:_,styleSpec:x,expressionContext:"property",propertyType:c,propertyKey:I}))}function jd(A){return Gd(A,"paint")}function qd(A){return Gd(A,"layout")}function dp(A){let c=[];const h=A.value,p=A.key,_=A.style,x=A.styleSpec;h.type||h.ref||c.push(new Yt(p,h,'either "type" or "ref" is required'));let E=Ti(h.type);const I=Ti(h.ref);if(h.id){const R=Ti(h.id);for(let N=0;N<A.arrayIndex;N++){const V=_.layers[N];Ti(V.id)===R&&c.push(new Yt(p,h.id,`duplicate layer id "${h.id}", previously used at line ${V.id.__line__}`))}}if("ref"in h){let R;["type","source","source-layer","filter","layout"].forEach(N=>{N in h&&c.push(new Yt(p,h[N],`"${N}" is prohibited for ref layers`))}),_.layers.forEach(N=>{Ti(N.id)===I&&(R=N)}),R?R.ref?c.push(new Yt(p,h.ref,"ref cannot reference another ref layer")):E=Ti(R.type):c.push(new Yt(p,h.ref,`ref layer "${I}" not found`))}else if(E!=="background")if(h.source){const R=_.sources&&_.sources[h.source],N=R&&Ti(R.type);R?N==="vector"&&E==="raster"?c.push(new Yt(p,h.source,`layer "${h.id}" requires a raster source`)):N!=="raster-dem"&&E==="hillshade"?c.push(new Yt(p,h.source,`layer "${h.id}" requires a raster-dem source`)):N==="raster"&&E!=="raster"?c.push(new Yt(p,h.source,`layer "${h.id}" requires a vector source`)):N!=="vector"||h["source-layer"]?N==="raster-dem"&&E!=="hillshade"?c.push(new Yt(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="line"||!h.paint||!h.paint["line-gradient"]||N==="geojson"&&R.lineMetrics||c.push(new Yt(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Yt(p,h,`layer "${h.id}" must specify a "source-layer"`)):c.push(new Yt(p,h.source,`source "${h.source}" not found`))}else c.push(new Yt(p,h,'missing required property "source"'));return c=c.concat(ba({key:p,value:h,valueSpec:x.layer,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":()=>[],type:()=>A.validateSpec({key:`${p}.type`,value:h.type,valueSpec:x.layer.type,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,object:h,objectKey:"type"}),filter:VA,layout:R=>ba({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":N=>qd(ur({layerType:E},N))}}),paint:R=>ba({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":N=>jd(ur({layerType:E},N))}})}})),c}function gc(A){const c=A.value,h=A.key,p=yn(c);return p!=="string"?[new Yt(h,c,`string expected, ${p} found`)]:[]}const ul={promoteId:function(A){let{key:c,value:h}=A;if(yn(h)==="string")return gc({key:c,value:h});{const p=[];for(const _ in h)p.push(...gc({key:`${c}.${_}`,value:h[_]}));return p}}};function ro(A){const c=A.value,h=A.key,p=A.styleSpec,_=A.style,x=A.validateSpec;if(!c.type)return[new Yt(h,c,'"type" is required')];const E=Ti(c.type);let I;switch(E){case"vector":case"raster":return I=ba({key:h,value:c,valueSpec:p[`source_${E.replace("-","_")}`],style:A.style,styleSpec:p,objectElementValidators:ul,validateSpec:x}),I;case"raster-dem":return I=function(R){var N;const V=(N=R.sourceName)!==null&&N!==void 0?N:"",j=R.value,tt=R.styleSpec,rt=tt.source_raster_dem,lt=R.style;let dt=[];const Pt=yn(j);if(j===void 0)return dt;if(Pt!=="object")return dt.push(new Yt("source_raster_dem",j,`object expected, ${Pt} found`)),dt;const Mt=Ti(j.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],Ht=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const et in j)!Mt&&ce.includes(et)?dt.push(new Yt(et,j[et],`In "${V}": "${et}" is only valid when "encoding" is set to "custom". ${Ht} encoding found`)):rt[et]?dt=dt.concat(R.validateSpec({key:et,value:j[et],valueSpec:rt[et],validateSpec:R.validateSpec,style:lt,styleSpec:tt})):dt.push(new Yt(et,j[et],`unknown property "${et}"`));return dt}({sourceName:h,value:c,style:A.style,styleSpec:p,validateSpec:x}),I;case"geojson":if(I=ba({key:h,value:c,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:x,objectElementValidators:ul}),c.cluster)for(const R in c.clusterProperties){const[N,V]=c.clusterProperties[R],j=typeof N=="string"?[N,["accumulated"],["get",R]]:N;I.push(...pc({key:`${h}.${R}.map`,value:V,validateSpec:x,expressionContext:"cluster-map"})),I.push(...pc({key:`${h}.${R}.reduce`,value:j,validateSpec:x,expressionContext:"cluster-reduce"}))}return I;case"video":return ba({key:h,value:c,valueSpec:p.source_video,style:_,validateSpec:x,styleSpec:p});case"image":return ba({key:h,value:c,valueSpec:p.source_image,style:_,validateSpec:x,styleSpec:p});case"canvas":return[new Yt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cl({key:`${h}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:x,styleSpec:p})}}function hl(A){const c=A.value,h=A.styleSpec,p=h.light,_=A.style;let x=[];const E=yn(c);if(c===void 0)return x;if(E!=="object")return x=x.concat([new Yt("light",c,`object expected, ${E} found`)]),x;for(const I in c){const R=I.match(/^(.*)-transition$/);x=x.concat(R&&p[R[1]]&&p[R[1]].transition?A.validateSpec({key:I,value:c[I],valueSpec:h.transition,validateSpec:A.validateSpec,style:_,styleSpec:h}):p[I]?A.validateSpec({key:I,value:c[I],valueSpec:p[I],validateSpec:A.validateSpec,style:_,styleSpec:h}):[new Yt(I,c[I],`unknown property "${I}"`)])}return x}function fp(A){const c=A.value,h=A.styleSpec,p=h.sky,_=A.style,x=yn(c);if(c===void 0)return[];if(x!=="object")return[new Yt("sky",c,`object expected, ${x} found`)];let E=[];for(const I in c)E=E.concat(p[I]?A.validateSpec({key:I,value:c[I],valueSpec:p[I],style:_,styleSpec:h}):[new Yt(I,c[I],`unknown property "${I}"`)]);return E}function Kd(A){const c=A.value,h=A.styleSpec,p=h.terrain,_=A.style;let x=[];const E=yn(c);if(c===void 0)return x;if(E!=="object")return x=x.concat([new Yt("terrain",c,`object expected, ${E} found`)]),x;for(const I in c)x=x.concat(p[I]?A.validateSpec({key:I,value:c[I],valueSpec:p[I],validateSpec:A.validateSpec,style:_,styleSpec:h}):[new Yt(I,c[I],`unknown property "${I}"`)]);return x}function Nl(A){let c=[];const h=A.value,p=A.key;if(Array.isArray(h)){const _=[],x=[];for(const E in h)h[E].id&&_.includes(h[E].id)&&c.push(new Yt(p,h,`all the sprites' ids must be unique, but ${h[E].id} is duplicated`)),_.push(h[E].id),h[E].url&&x.includes(h[E].url)&&c.push(new Yt(p,h,`all the sprites' URLs must be unique, but ${h[E].url} is duplicated`)),x.push(h[E].url),c=c.concat(ba({key:`${p}[${E}]`,value:h[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:A.validateSpec}));return c}return gc({key:p,value:h})}const Yo={"*":()=>[],array:Hd,boolean:function(A){const c=A.value,h=A.key,p=yn(c);return p!=="boolean"?[new Yt(h,c,`boolean expected, ${p} found`)]:[]},number:Vd,color:function(A){const c=A.key,h=A.value,p=yn(h);return p!=="string"?[new Yt(c,h,`color expected, ${p} found`)]:cn.parse(String(h))?[]:[new Yt(c,h,`color expected, "${h}" found`)]},constants:Kh,enum:cl,filter:VA,function:HA,layer:dp,object:ba,source:ro,light:hl,sky:fp,terrain:Kd,projection:function(A){const c=A.value,h=A.styleSpec,p=h.projection,_=A.style,x=yn(c);if(c===void 0)return[];if(x!=="object")return[new Yt("projection",c,`object expected, ${x} found`)];let E=[];for(const I in c)E=E.concat(p[I]?A.validateSpec({key:I,value:c[I],valueSpec:p[I],style:_,styleSpec:h}):[new Yt(I,c[I],`unknown property "${I}"`)]);return E},projectionDefinition:function(A){const c=A.key;let h=A.value;h=h instanceof String?h.valueOf():h;const p=yn(h);return p!=="array"||function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"}(h)||function(_){return!!["interpolate","step","literal"].includes(_[0])}(h)?["array","string"].includes(p)?[]:[new Yt(c,h,`projection expected, invalid type "${p}" found`)]:[new Yt(c,h,`projection expected, invalid array ${JSON.stringify(h)} found`)]},string:gc,formatted:function(A){return gc(A).length===0?[]:pc(A)},resolvedImage:function(A){return gc(A).length===0?[]:pc(A)},padding:function(A){const c=A.key,h=A.value;if(yn(h)==="array"){if(h.length<1||h.length>4)return[new Yt(c,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let _=[];for(let x=0;x<h.length;x++)_=_.concat(A.validateSpec({key:`${c}[${x}]`,value:h[x],validateSpec:A.validateSpec,valueSpec:p}));return _}return Vd({key:c,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(A){const c=A.key,h=A.value,p=yn(h),_=A.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new Yt(c,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let E=0;E<h.length;E+=2)x=x.concat(cl({key:`${c}[${E}]`,value:h[E],valueSpec:_.layout_symbol["text-anchor"]})),x=x.concat(Hd({key:`${c}[${E+1}]`,value:h[E+1],valueSpec:{length:2,value:"number"},validateSpec:A.validateSpec,style:A.style,styleSpec:_}));return x},sprite:Nl};function $h(A){const c=A.value,h=A.valueSpec,p=A.styleSpec;return A.validateSpec=$h,h.expression&&Ac(Ti(c))?HA(A):h.expression&&Dl(_u(c))?pc(A):h.type&&Yo[h.type]?Yo[h.type](A):ba(ur({},A,{valueSpec:h.type?p[h.type]:h}))}function ih(A){const c=A.value,h=A.key,p=gc(A);return p.length||(c.indexOf("{fontstack}")===-1&&p.push(new Yt(h,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&p.push(new Yt(h,c,'"glyphs" url must include a "{range}" token'))),p}function no(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bt,h=[];return h=h.concat($h({key:"",value:A,valueSpec:c.$root,styleSpec:c,style:A,validateSpec:$h,objectElementValidators:{glyphs:ih,"*":()=>[]}})),A.constants&&(h=h.concat(Kh({key:"constants",value:A.constants,style:A,styleSpec:c,validateSpec:$h}))),vu(h)}function Di(A){return function(c){return A({...c,validateSpec:$h})}}function vu(A){return[].concat(A).sort((c,h)=>c.line-h.line)}function wa(A){return function(){for(var c=arguments.length,h=new Array(c),p=0;p<c;p++)h[p]=arguments[p];return vu(A.apply(this,h))}}no.source=wa(Di(ro)),no.sprite=wa(Di(Nl)),no.glyphs=wa(Di(ih)),no.light=wa(Di(hl)),no.sky=wa(Di(fp)),no.terrain=wa(Di(Kd)),no.layer=wa(Di(dp)),no.filter=wa(Di(VA)),no.paintProperty=wa(Di(jd)),no.layoutProperty=wa(Di(qd));const sh=no,GA=sh.light,mc=sh.sky,oh=sh.paintProperty,Xh=sh.layoutProperty;function pp(A,c){let h=!1;if(c&&c.length)for(const p of c)A.fire(new an(new Error(p.message))),h=!0;return h}class yc{constructor(c,h,p){const _=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const E=new Int32Array(this.arrayBuffer);c=E[0],this.d=(h=E[1])+2*(p=E[2]);for(let R=0;R<this.d*this.d;R++){const N=E[3+R],V=E[3+R+1];_.push(N===V?null:E.subarray(N,V))}const I=E[3+_.length+1];this.keys=E.subarray(E[3+_.length],I),this.bboxes=E.subarray(I),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let E=0;E<this.d*this.d;E++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=c,this.padding=p,this.scale=h/c,this.uid=0;const x=p/h*c;this.min=-x,this.max=c+x}insert(c,h,p,_,x){this._forEachCell(h,p,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,h,p,_,x,E){this.cells[x].push(E)}query(c,h,p,_,x){const E=this.min,I=this.max;if(c<=E&&h<=E&&I<=p&&I<=_&&!x)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(c,h,p,_,this._queryCell,R,{},x),R}}_queryCell(c,h,p,_,x,E,I,R){const N=this.cells[x];if(N!==null){const V=this.keys,j=this.bboxes;for(let tt=0;tt<N.length;tt++){const rt=N[tt];if(I[rt]===void 0){const lt=4*rt;(R?R(j[lt+0],j[lt+1],j[lt+2],j[lt+3]):c<=j[lt+2]&&h<=j[lt+3]&&p>=j[lt+0]&&_>=j[lt+1])?(I[rt]=!0,E.push(V[rt])):I[rt]=!1}}}}_forEachCell(c,h,p,_,x,E,I,R){const N=this._convertToCellCoord(c),V=this._convertToCellCoord(h),j=this._convertToCellCoord(p),tt=this._convertToCellCoord(_);for(let rt=N;rt<=j;rt++)for(let lt=V;lt<=tt;lt++){const dt=this.d*lt+rt;if((!R||R(this._convertFromCellCoord(rt),this._convertFromCellCoord(lt),this._convertFromCellCoord(rt+1),this._convertFromCellCoord(lt+1)))&&x.call(this,c,h,p,_,dt,E,I,R))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,h=3+this.cells.length+1+1;let p=0;for(let E=0;E<this.cells.length;E++)p+=this.cells[E].length;const _=new Int32Array(h+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=h;for(let E=0;E<c.length;E++){const I=c[E];_[3+E]=x,_.set(I,x),x+=I.length}return _[3+c.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+c.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(c,h){const p=c.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(c){return new yc(c.buffer)}}const kl={};function Sr(A,c){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(kl[A])throw new Error(`${A} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:A,writeable:!1}),kl[A]={klass:c,omit:h.omit||[],shallow:h.shallow||[]}}Sr("Object",Object),Sr("TransferableGridIndex",yc),Sr("Color",cn),Sr("Error",Error),Sr("AJAXError",xr),Sr("ResolvedImage",Gr),Sr("StylePropertyFunction",go),Sr("StyleExpression",dc,{omit:["_evaluator"]}),Sr("ZoomDependentExpression",pu),Sr("ZoomConstantExpression",fc),Sr("CompoundExpression",is,{omit:["_evaluate"]});for(const A in za)za[A]._classRegistryKey||Sr(`Expression_${A}`,za[A]);function gp(A){return A&&typeof ArrayBuffer<"u"&&(A instanceof ArrayBuffer||A.constructor&&A.constructor.name==="ArrayBuffer")}function bu(A){return A.$name||A.constructor._classRegistryKey}function mp(A){return!function(c){if(c===null||typeof c!="object")return!1;const h=bu(c);return!(!h||h==="Object")}(A)&&(A==null||typeof A=="boolean"||typeof A=="number"||typeof A=="string"||A instanceof Boolean||A instanceof Number||A instanceof String||A instanceof Date||A instanceof RegExp||A instanceof Blob||A instanceof Error||gp(A)||Me(A)||ArrayBuffer.isView(A)||A instanceof ImageData)}function Zh(A,c){if(mp(A))return(gp(A)||Me(A))&&c&&c.push(A),ArrayBuffer.isView(A)&&c&&c.push(A.buffer),A instanceof ImageData&&c&&c.push(A.data.buffer),A;if(Array.isArray(A)){const x=[];for(const E of A)x.push(Zh(E,c));return x}if(typeof A!="object")throw new Error("can't serialize object of type "+typeof A);const h=bu(A);if(!h)throw new Error(`can't serialize object of unregistered class ${A.constructor.name}`);if(!kl[h])throw new Error(`${h} is not registered.`);const{klass:p}=kl[h],_=p.serialize?p.serialize(A,c):{};if(p.serialize){if(c&&_===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in A){if(!A.hasOwnProperty(x)||kl[h].omit.indexOf(x)>=0)continue;const E=A[x];_[x]=kl[h].shallow.indexOf(x)>=0?E:Zh(E,c)}A instanceof Error&&(_.message=A.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(_.$name=h),_}function Ql(A){if(mp(A))return A;if(Array.isArray(A))return A.map(Ql);if(typeof A!="object")throw new Error("can't deserialize object of type "+typeof A);const c=bu(A)||"Object";if(!kl[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:h}=kl[c];if(!h)throw new Error(`can't deserialize unregistered class ${c}`);if(h.deserialize)return h.deserialize(A);const p=Object.create(h.prototype);for(const _ of Object.keys(A)){if(_==="$name")continue;const x=A[_];p[_]=kl[c].shallow.indexOf(_)>=0?x:Ql(x)}return p}class Yh{constructor(){this.first=!0}update(c,h){const p=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=p,!0))}}const Cn={"Latin-1 Supplement":A=>A>=128&&A<=255,"Hangul Jamo":A=>A>=4352&&A<=4607,Khmer:A=>A>=6016&&A<=6143,"General Punctuation":A=>A>=8192&&A<=8303,"Letterlike Symbols":A=>A>=8448&&A<=8527,"Number Forms":A=>A>=8528&&A<=8591,"Miscellaneous Technical":A=>A>=8960&&A<=9215,"Control Pictures":A=>A>=9216&&A<=9279,"Optical Character Recognition":A=>A>=9280&&A<=9311,"Enclosed Alphanumerics":A=>A>=9312&&A<=9471,"Geometric Shapes":A=>A>=9632&&A<=9727,"Miscellaneous Symbols":A=>A>=9728&&A<=9983,"Miscellaneous Symbols and Arrows":A=>A>=11008&&A<=11263,"Ideographic Description Characters":A=>A>=12272&&A<=12287,"CJK Symbols and Punctuation":A=>A>=12288&&A<=12351,Katakana:A=>A>=12448&&A<=12543,Kanbun:A=>A>=12688&&A<=12703,"CJK Strokes":A=>A>=12736&&A<=12783,"Enclosed CJK Letters and Months":A=>A>=12800&&A<=13055,"CJK Compatibility":A=>A>=13056&&A<=13311,"Yijing Hexagram Symbols":A=>A>=19904&&A<=19967,"Private Use Area":A=>A>=57344&&A<=63743,"Vertical Forms":A=>A>=65040&&A<=65055,"CJK Compatibility Forms":A=>A>=65072&&A<=65103,"Small Form Variants":A=>A>=65104&&A<=65135,"Halfwidth and Fullwidth Forms":A=>A>=65280&&A<=65519};function ah(A){for(const c of A)if(ut(c.charCodeAt(0)))return!0;return!1}function Wd(A){for(const c of A)if(!H(c.charCodeAt(0)))return!1;return!0}function T(A){const c=A.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(c.join("|"),"u")}const M=T(["Arab","Dupl","Mong","Ougr","Syrc"]);function H(A){return!M.test(String.fromCodePoint(A))}const W=T(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ut(A){return!(A!==746&&A!==747&&(A<4352||!(Cn["CJK Compatibility Forms"](A)&&!(A>=65097&&A<=65103)||Cn["CJK Compatibility"](A)||Cn["CJK Strokes"](A)||!(!Cn["CJK Symbols and Punctuation"](A)||A>=12296&&A<=12305||A>=12308&&A<=12319||A===12336)||Cn["Enclosed CJK Letters and Months"](A)||Cn["Ideographic Description Characters"](A)||Cn.Kanbun(A)||Cn.Katakana(A)&&A!==12540||!(!Cn["Halfwidth and Fullwidth Forms"](A)||A===65288||A===65289||A===65293||A>=65306&&A<=65310||A===65339||A===65341||A===65343||A>=65371&&A<=65503||A===65507||A>=65512&&A<=65519)||!(!Cn["Small Form Variants"](A)||A>=65112&&A<=65118||A>=65123&&A<=65126)||Cn["Vertical Forms"](A)||Cn["Yijing Hexagram Symbols"](A)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(A))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(A))||W.test(String.fromCodePoint(A)))))}function mt(A){return!(ut(A)||function(c){return!!(Cn["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Cn["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Cn["Letterlike Symbols"](c)||Cn["Number Forms"](c)||Cn["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Cn["Control Pictures"](c)&&c!==9251||Cn["Optical Character Recognition"](c)||Cn["Enclosed Alphanumerics"](c)||Cn["Geometric Shapes"](c)||Cn["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Cn["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Cn["CJK Symbols and Punctuation"](c)||Cn.Katakana(c)||Cn["Private Use Area"](c)||Cn["CJK Compatibility Forms"](c)||Cn["Small Form Variants"](c)||Cn["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(A))}const _t=T(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xt(A){return _t.test(String.fromCodePoint(A))}function St(A,c){return!(!c&&xt(A)||A>=2304&&A<=3583||A>=3840&&A<=4255||Cn.Khmer(A))}function Ut(A){for(const c of A)if(xt(c.charCodeAt(0)))return!0;return!1}const ue=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(A){this.pluginStatus=A.pluginStatus,this.pluginURL=A.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(A){if(ue.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=A.applyArabicShaping,this.processBidirectionalText=A.processBidirectionalText,this.processStyledBidirectionalText=A.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(A,c){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(A.pluginStatus!=="loading")return this.setState(A),A;const h=A.pluginURL,p=new Promise(x=>{this.loadScriptResolve=x});c(h);const _=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([p,_]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:h};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${h}`)})}};class be{constructor(c,h){this.zoom=c,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yh,this.transition={})}isSupportedScript(c){return function(h,p){for(const _ of h)if(!St(_.charCodeAt(0),p))return!1;return!0}(c,ue.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,h=c-Math.floor(c),p=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Se{constructor(c,h){this.property=c,this.value=h,this.expression=function(p,_){if(Ac(p))return new go(p,_);if(Dl(p)){const x=Do(p,_);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));return x.value}{let x=p;return _.type==="color"&&typeof p=="string"?x=cn.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?x=Cr.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(x=Bn.parse(p)):x=jt.parse(p),{kind:"constant",evaluate:()=>x}}}(h===void 0?c.specification.default:h,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,h,p){return this.property.possiblyEvaluate(this,c,h,p)}}class _e{constructor(c){this.property=c,this.value=new Se(c,void 0)}transitioned(c,h){return new Ne(this.property,this.value,h,Nt({},c.transition,this.transition),c.now)}untransitioned(){return new Ne(this.property,this.value,null,{},0)}}class Ze{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return de(this._values[c].value.value)}setValue(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new _e(this._values[c].property)),this._values[c].value=new Se(this._values[c].property,h===null?void 0:de(h))}getTransition(c){return de(this._values[c].transition)}setTransition(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new _e(this._values[c].property)),this._values[c].transition=de(h)||void 0}serialize(){const c={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(c[h]=p);const _=this.getTransition(h);_!==void 0&&(c[`${h}-transition`]=_)}return c}transitioned(c,h){const p=new Ae(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(c,h._values[_]);return p}untransitioned(){const c=new Ae(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].untransitioned();return c}}class Ne{constructor(c,h,p,_,x){this.property=c,this.value=h,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,c.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(c,h,p){const _=c.now||0,x=this.value.possiblyEvaluate(c,h,p),E=this.prior;if(E){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return E.possiblyEvaluate(c,h,p);{const I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(c,h,p),x,pe(I))}}return x}}class Ae{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,h,p){const _=new rr(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,h,p);return _}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class fe{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return de(this._values[c].value)}setValue(c,h){this._values[c]=new Se(this._values[c].property,h===null?void 0:de(h))}serialize(){const c={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(c[h]=p)}return c}possiblyEvaluate(c,h,p){const _=new rr(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,h,p);return _}}class je{constructor(c,h,p){this.property=c,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,h,p,_){return this.property.evaluate(this.value,this.parameters,c,h,p,_)}}class rr{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class we{constructor(c){this.specification=c}possiblyEvaluate(c,h){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(h)}interpolate(c,h,p){const _=Wo[this.specification.type];return _?_(c,h,p):c}}class Ge{constructor(c,h){this.specification=c,this.overrides=h}possiblyEvaluate(c,h,p,_){return new je(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(h,null,{},p,_)}:c.expression,h)}interpolate(c,h,p){if(c.value.kind!=="constant"||h.value.kind!=="constant")return c;if(c.value.value===void 0||h.value.value===void 0)return new je(this,{kind:"constant",value:void 0},c.parameters);const _=Wo[this.specification.type];if(_){const x=_(c.value.value,h.value.value,p);return new je(this,{kind:"constant",value:x},c.parameters)}return c}evaluate(c,h,p,_,x,E){return c.kind==="constant"?c.value:c.evaluate(h,p,_,x,E)}}class Tr extends Ge{possiblyEvaluate(c,h,p,_){if(c.value===void 0)return new je(this,{kind:"constant",value:void 0},h);if(c.expression.kind==="constant"){const x=c.expression.evaluate(h,null,{},p,_),E=c.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,I=this._calculate(E,E,E,h);return new je(this,{kind:"constant",value:I},h)}if(c.expression.kind==="camera"){const x=this._calculate(c.expression.evaluate({zoom:h.zoom-1}),c.expression.evaluate({zoom:h.zoom}),c.expression.evaluate({zoom:h.zoom+1}),h);return new je(this,{kind:"constant",value:x},h)}return new je(this,c.expression,h)}evaluate(c,h,p,_,x,E){if(c.kind==="source"){const I=c.evaluate(h,p,_,x,E);return this._calculate(I,I,I,h)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(h.zoom)-1},p,_),c.evaluate({zoom:Math.floor(h.zoom)},p,_),c.evaluate({zoom:Math.floor(h.zoom)+1},p,_),h):c.value}_calculate(c,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:p,to:h}}interpolate(c){return c}}class Jr{constructor(c){this.specification=c}possiblyEvaluate(c,h,p,_){if(c.value!==void 0){if(c.expression.kind==="constant"){const x=c.expression.evaluate(h,null,{},p,_);return this._calculate(x,x,x,h)}return this._calculate(c.expression.evaluate(new be(Math.floor(h.zoom-1),h)),c.expression.evaluate(new be(Math.floor(h.zoom),h)),c.expression.evaluate(new be(Math.floor(h.zoom+1),h)),h)}}_calculate(c,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:p,to:h}}interpolate(c){return c}}class Pr{constructor(c){this.specification=c}possiblyEvaluate(c,h,p,_){return!!c.expression.evaluate(h,null,{},p,_)}interpolate(){return!1}}class pn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in c){const p=c[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Se(p,void 0),x=this.defaultTransitionablePropertyValues[h]=new _e(p);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}Sr("DataDrivenProperty",Ge),Sr("DataConstantProperty",we),Sr("CrossFadedDataDrivenProperty",Tr),Sr("CrossFadedProperty",Jr),Sr("ColorRampProperty",Pr);const Yn="-transition";class _n extends Xn{constructor(c,h){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),h.layout&&(this._unevaluatedLayout=new fe(h.layout)),h.paint)){this._transitionablePaint=new Ze(h.paint);for(const p in c.paint)this.setPaintProperty(p,c.paint[p],{validate:!1});for(const p in c.layout)this.setLayoutProperty(p,c.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rr(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};h!=null&&this._validate(Xh,`layers.${this.id}.layout.${c}`,c,h,p)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,h):this.visibility=h)}getPaintProperty(c){return c.endsWith(Yn)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(h!=null&&this._validate(oh,`layers.${this.id}.paint.${c}`,c,h,p))return!1;if(c.endsWith(Yn))return this._transitionablePaint.setTransition(c.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[c],x=_.property.specification["property-type"]==="cross-faded-data-driven",E=_.value.isDataDriven(),I=_.value;this._transitionablePaint.setValue(c,h),this._handleSpecialPaintPropertyUpdate(c);const R=this._transitionablePaint._values[c].value;return R.isDataDriven()||E||x||this._handleOverridablePaintPropertyUpdate(c,I,R)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,h,p){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,h){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,h)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ye(c,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(c,h,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!x||x.validate!==!1)&&pp(this,c.call(sh,{key:h,layerType:this.type,objectKey:p,value:_,styleSpec:Bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const h=this.paint.get(c);if(h instanceof je&&_a(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const On={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kn{constructor(c,h){this._structArray=c,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,h){return c._trim(),h&&(c.isTransferred=!0,h.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const h=Object.create(this.prototype);return h.arrayBuffer=c.arrayBuffer,h.length=c.length,h.capacity=c.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function jr(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=0,p=0;return{members:A.map(_=>{const x=On[_.type].BYTES_PER_ELEMENT,E=h=Yi(h,Math.max(c,x)),I=_.components||1;return p=Math.max(p,x),h+=x*I,{name:_.name,type:_.type,components:I,offset:E}}),size:Yi(h,Math.max(p,c)),alignment:c}}function Yi(A,c){return Math.ceil(A/c)*c}class Bs extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const _=2*c;return this.int16[_+0]=h,this.int16[_+1]=p,c}}Bs.prototype.bytesPerElement=4,Sr("StructArrayLayout2i4",Bs);class Mi extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,p)}emplace(c,h,p,_){const x=3*c;return this.int16[x+0]=h,this.int16[x+1]=p,this.int16[x+2]=_,c}}Mi.prototype.bytesPerElement=6,Sr("StructArrayLayout3i6",Mi);class io extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,h,p,_)}emplace(c,h,p,_,x){const E=4*c;return this.int16[E+0]=h,this.int16[E+1]=p,this.int16[E+2]=_,this.int16[E+3]=x,c}}io.prototype.bytesPerElement=8,Sr("StructArrayLayout4i8",io);class Wn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E){const I=this.length;return this.resize(I+1),this.emplace(I,c,h,p,_,x,E)}emplace(c,h,p,_,x,E,I){const R=6*c;return this.int16[R+0]=h,this.int16[R+1]=p,this.int16[R+2]=_,this.int16[R+3]=x,this.int16[R+4]=E,this.int16[R+5]=I,c}}Wn.prototype.bytesPerElement=12,Sr("StructArrayLayout2i4i12",Wn);class Ji extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E){const I=this.length;return this.resize(I+1),this.emplace(I,c,h,p,_,x,E)}emplace(c,h,p,_,x,E,I){const R=4*c,N=8*c;return this.int16[R+0]=h,this.int16[R+1]=p,this.uint8[N+4]=_,this.uint8[N+5]=x,this.uint8[N+6]=E,this.uint8[N+7]=I,c}}Ji.prototype.bytesPerElement=8,Sr("StructArrayLayout2i4ub8",Ji);class Cs extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const _=2*c;return this.float32[_+0]=h,this.float32[_+1]=p,c}}Cs.prototype.bytesPerElement=8,Sr("StructArrayLayout2f8",Cs);class qi extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E,I,R,N,V){const j=this.length;return this.resize(j+1),this.emplace(j,c,h,p,_,x,E,I,R,N,V)}emplace(c,h,p,_,x,E,I,R,N,V,j){const tt=10*c;return this.uint16[tt+0]=h,this.uint16[tt+1]=p,this.uint16[tt+2]=_,this.uint16[tt+3]=x,this.uint16[tt+4]=E,this.uint16[tt+5]=I,this.uint16[tt+6]=R,this.uint16[tt+7]=N,this.uint16[tt+8]=V,this.uint16[tt+9]=j,c}}qi.prototype.bytesPerElement=20,Sr("StructArrayLayout10ui20",qi);class os extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E,I,R,N,V,j,tt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,c,h,p,_,x,E,I,R,N,V,j,tt)}emplace(c,h,p,_,x,E,I,R,N,V,j,tt,rt){const lt=12*c;return this.int16[lt+0]=h,this.int16[lt+1]=p,this.int16[lt+2]=_,this.int16[lt+3]=x,this.uint16[lt+4]=E,this.uint16[lt+5]=I,this.uint16[lt+6]=R,this.uint16[lt+7]=N,this.int16[lt+8]=V,this.int16[lt+9]=j,this.int16[lt+10]=tt,this.int16[lt+11]=rt,c}}os.prototype.bytesPerElement=24,Sr("StructArrayLayout4i4ui4i24",os);class us extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,p)}emplace(c,h,p,_){const x=3*c;return this.float32[x+0]=h,this.float32[x+1]=p,this.float32[x+2]=_,c}}us.prototype.bytesPerElement=12,Sr("StructArrayLayout3f12",us);class No extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint32[1*c+0]=h,c}}No.prototype.bytesPerElement=4,Sr("StructArrayLayout1ul4",No);class mo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E,I,R,N){const V=this.length;return this.resize(V+1),this.emplace(V,c,h,p,_,x,E,I,R,N)}emplace(c,h,p,_,x,E,I,R,N,V){const j=10*c,tt=5*c;return this.int16[j+0]=h,this.int16[j+1]=p,this.int16[j+2]=_,this.int16[j+3]=x,this.int16[j+4]=E,this.int16[j+5]=I,this.uint32[tt+3]=R,this.uint16[j+8]=N,this.uint16[j+9]=V,c}}mo.prototype.bytesPerElement=20,Sr("StructArrayLayout6i1ul2ui20",mo);class Fi extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E){const I=this.length;return this.resize(I+1),this.emplace(I,c,h,p,_,x,E)}emplace(c,h,p,_,x,E,I){const R=6*c;return this.int16[R+0]=h,this.int16[R+1]=p,this.int16[R+2]=_,this.int16[R+3]=x,this.int16[R+4]=E,this.int16[R+5]=I,c}}Fi.prototype.bytesPerElement=12,Sr("StructArrayLayout2i2i2i12",Fi);class Ha extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,c,h,p,_,x)}emplace(c,h,p,_,x,E){const I=4*c,R=8*c;return this.float32[I+0]=h,this.float32[I+1]=p,this.float32[I+2]=_,this.int16[R+6]=x,this.int16[R+7]=E,c}}Ha.prototype.bytesPerElement=16,Sr("StructArrayLayout2f1f2i16",Ha);class Al extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E){const I=this.length;return this.resize(I+1),this.emplace(I,c,h,p,_,x,E)}emplace(c,h,p,_,x,E,I){const R=16*c,N=4*c,V=8*c;return this.uint8[R+0]=h,this.uint8[R+1]=p,this.float32[N+1]=_,this.float32[N+2]=x,this.int16[V+6]=E,this.int16[V+7]=I,c}}Al.prototype.bytesPerElement=16,Sr("StructArrayLayout2ub2f2i16",Al);class Jo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,p)}emplace(c,h,p,_){const x=3*c;return this.uint16[x+0]=h,this.uint16[x+1]=p,this.uint16[x+2]=_,c}}Jo.prototype.bytesPerElement=6,Sr("StructArrayLayout3ui6",Jo);class dl extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt){const ce=this.length;return this.resize(ce+1),this.emplace(ce,c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt)}emplace(c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce){const Ht=24*c,et=12*c,Et=48*c;return this.int16[Ht+0]=h,this.int16[Ht+1]=p,this.uint16[Ht+2]=_,this.uint16[Ht+3]=x,this.uint32[et+2]=E,this.uint32[et+3]=I,this.uint32[et+4]=R,this.uint16[Ht+10]=N,this.uint16[Ht+11]=V,this.uint16[Ht+12]=j,this.float32[et+7]=tt,this.float32[et+8]=rt,this.uint8[Et+36]=lt,this.uint8[Et+37]=dt,this.uint8[Et+38]=Pt,this.uint32[et+10]=Mt,this.int16[Ht+22]=ce,c}}dl.prototype.bytesPerElement=48,Sr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",dl);class Li extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce,Ht,et,Et,Vt,Ee,We,Pe,Ue,lr,Ye){const dr=this.length;return this.resize(dr+1),this.emplace(dr,c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce,Ht,et,Et,Vt,Ee,We,Pe,Ue,lr,Ye)}emplace(c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce,Ht,et,Et,Vt,Ee,We,Pe,Ue,lr,Ye,dr){const ke=32*c,Dr=16*c;return this.int16[ke+0]=h,this.int16[ke+1]=p,this.int16[ke+2]=_,this.int16[ke+3]=x,this.int16[ke+4]=E,this.int16[ke+5]=I,this.int16[ke+6]=R,this.int16[ke+7]=N,this.uint16[ke+8]=V,this.uint16[ke+9]=j,this.uint16[ke+10]=tt,this.uint16[ke+11]=rt,this.uint16[ke+12]=lt,this.uint16[ke+13]=dt,this.uint16[ke+14]=Pt,this.uint16[ke+15]=Mt,this.uint16[ke+16]=ce,this.uint16[ke+17]=Ht,this.uint16[ke+18]=et,this.uint16[ke+19]=Et,this.uint16[ke+20]=Vt,this.uint16[ke+21]=Ee,this.uint16[ke+22]=We,this.uint32[Dr+12]=Pe,this.float32[Dr+13]=Ue,this.float32[Dr+14]=lr,this.uint16[ke+30]=Ye,this.uint16[ke+31]=dr,c}}Li.prototype.bytesPerElement=64,Sr("StructArrayLayout8i15ui1ul2f2ui64",Li);class wu extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.float32[1*c+0]=h,c}}wu.prototype.bytesPerElement=4,Sr("StructArrayLayout1f4",wu);class jA extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,p)}emplace(c,h,p,_){const x=3*c;return this.uint16[6*c+0]=h,this.float32[x+1]=p,this.float32[x+2]=_,c}}jA.prototype.bytesPerElement=12,Sr("StructArrayLayout1ui2f12",jA);class w extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,p)}emplace(c,h,p,_){const x=4*c;return this.uint32[2*c+0]=h,this.uint16[x+2]=p,this.uint16[x+3]=_,c}}w.prototype.bytesPerElement=8,Sr("StructArrayLayout1ul2ui8",w);class l extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h){const p=this.length;return this.resize(p+1),this.emplace(p,c,h)}emplace(c,h,p){const _=2*c;return this.uint16[_+0]=h,this.uint16[_+1]=p,c}}l.prototype.bytesPerElement=4,Sr("StructArrayLayout2ui4",l);class u extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint16[1*c+0]=h,c}}u.prototype.bytesPerElement=2,Sr("StructArrayLayout1ui2",u);class g extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,h,p,_)}emplace(c,h,p,_,x){const E=4*c;return this.float32[E+0]=h,this.float32[E+1]=p,this.float32[E+2]=_,this.float32[E+3]=x,c}}g.prototype.bytesPerElement=16,Sr("StructArrayLayout4f16",g);class y extends Kn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class B extends mo{get(c){return new y(this,c)}}Sr("CollisionBoxArray",B);class S extends Kn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class L extends dl{get(c){return new S(this,c)}}Sr("PlacedSymbolArray",L);class O extends Kn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}O.prototype.size=64;class Q extends Li{get(c){return new O(this,c)}}Sr("SymbolInstanceArray",Q);class q extends wu{getoffsetX(c){return this.float32[1*c+0]}}Sr("GlyphOffsetArray",q);class Z extends Mi{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Sr("SymbolLineVertexArray",Z);class J extends Kn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}J.prototype.size=12;class At extends jA{get(c){return new J(this,c)}}Sr("TextAnchorOffsetArray",At);class gt extends Kn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}gt.prototype.size=8;class Lt extends w{get(c){return new gt(this,c)}}Sr("FeatureIndexArray",Lt);class Ft extends Bs{}class Ot extends Bs{}class kt extends Bs{}class qt extends Wn{}class $t extends Ji{}class Jt extends Cs{}class ne extends qi{}class se extends os{}class Te extends us{}class Ce extends No{}class Oe extends Fi{}class ze extends Al{}class Le extends Jo{}class fr extends l{}const Ar=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ke}=Ar;class br{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=c}prepareSegment(c,h,p,_){const x=this.segments[this.segments.length-1];return c>br.MAX_VERTEX_ARRAY_LENGTH&&Ve(`Max vertices per segment is ${br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${br.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+c>br.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_?this.createNewSegment(h,p,_):x}createNewSegment(c,h,p){const _={vertexOffset:c.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(_.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(c,h,p){return this.prepareSegment(0,c,h,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const c of this.segments)for(const h in c.vaos)c.vaos[h].destroy()}static simpleSegment(c,h,p,_){return new br([{vertexOffset:c,primitiveOffset:h,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function sn(A,c){return 256*(A=Tt(Math.floor(A),0,255))+Tt(Math.floor(c),0,255)}br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sr("SegmentVector",br);const Mn=jr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var vi,oi,bi,zn={exports:{}},Jn={exports:{}},ti={exports:{}},qs=function(){if(bi)return zn.exports;bi=1;var A=(vi||(vi=1,Jn.exports=function(h,p){var _,x,E,I,R,N,V,j;for(x=h.length-(_=3&h.length),E=p,R=3432918353,N=461845907,j=0;j<x;)V=255&h.charCodeAt(j)|(255&h.charCodeAt(++j))<<8|(255&h.charCodeAt(++j))<<16|(255&h.charCodeAt(++j))<<24,++j,E=27492+(65535&(I=5*(65535&(E=(E^=V=(65535&(V=(V=(65535&V)*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*N+(((V>>>16)*N&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch(V=0,_){case 3:V^=(255&h.charCodeAt(j+2))<<16;case 2:V^=(255&h.charCodeAt(j+1))<<8;case 1:E^=V=(65535&(V=(V=(65535&(V^=255&h.charCodeAt(j)))*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*N+(((V>>>16)*N&65535)<<16)&4294967295}return E^=h.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),Jn.exports),c=(oi||(oi=1,ti.exports=function(h,p){for(var _,x=h.length,E=p^x,I=0;x>=4;)_=1540483477*(65535&(_=255&h.charCodeAt(I)|(255&h.charCodeAt(++I))<<8|(255&h.charCodeAt(++I))<<16|(255&h.charCodeAt(++I))<<24))+((1540483477*(_>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),x-=4,++I;switch(x){case 3:E^=(255&h.charCodeAt(I+2))<<16;case 2:E^=(255&h.charCodeAt(I+1))<<8;case 1:E=1540483477*(65535&(E^=255&h.charCodeAt(I)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),ti.exports);return zn.exports=A,zn.exports.murmur3=A,zn.exports.murmur2=c,zn.exports}(),ts=d(qs);class as{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,h,p,_){this.ids.push(hs(c)),this.positions.push(h,p,_)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=hs(c);let p=0,_=this.ids.length-1;for(;p<_;){const E=p+_>>1;this.ids[E]>=h?_=E:p=E+1}const x=[];for(;this.ids[p]===h;)x.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return x}static serialize(c,h){const p=new Float64Array(c.ids),_=new Uint32Array(c.positions);return Va(p,_,0,p.length-1),h&&h.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(c){const h=new as;return h.ids=c.ids,h.positions=c.positions,h.indexed=!0,h}}function hs(A){const c=+A;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:ts(String(A))}function Va(A,c,h,p){for(;h<p;){const _=A[h+p>>1];let x=h-1,E=p+1;for(;;){do x++;while(A[x]<_);do E--;while(A[E]>_);if(x>=E)break;ta(A,x,E),ta(c,3*x,3*E),ta(c,3*x+1,3*E+1),ta(c,3*x+2,3*E+2)}E-h<p-E?(Va(A,c,h,E),h=E+1):(Va(A,c,E+1,p),p=E)}}function ta(A,c,h){const p=A[c];A[c]=A[h],A[h]=p}Sr("FeaturePositionMap",as);class es{constructor(c,h){this.gl=c.gl,this.location=h}}class so extends es{constructor(c,h){super(c,h),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class xa extends es{constructor(c,h){super(c,h),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class _c extends es{constructor(c,h){super(c,h),this.current=cn.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const vc=new Float32Array(16);function yo(A){return[sn(255*A.r,255*A.g),sn(255*A.b,255*A.a)]}class Ba{constructor(c,h,p){this.value=c,this.uniformNames=h.map(_=>`u_${_}`),this.type=p}setUniform(c,h,p){c.set(p.constantOr(this.value))}getBinding(c,h,p){return this.type==="color"?new _c(c,h):new so(c,h)}}class ko{constructor(c,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=c.tlbr}setUniform(c,h,p,_){const x=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&c.set(x)}getBinding(c,h,p){return p.substr(0,9)==="u_pattern"?new xa(c,h):new so(c,h)}}class _o{constructor(c,h,p,_){this.expression=c,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(c,h,p,_,x){const E=this.paintVertexArray.length,I=this.expression.evaluate(new be(0),h,{},_,[],x);this.paintVertexArray.resize(c),this._setPaintValue(E,c,I)}updatePaintArray(c,h,p,_){const x=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(c,h,x)}_setPaintValue(c,h,p){if(this.type==="color"){const _=yo(p);for(let x=c;x<h;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=c;_<h;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fi{constructor(c,h,p,_,x,E){this.expression=c,this.uniformNames=h.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=h.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(c,h,p,_,x){const E=this.expression.evaluate(new be(this.zoom),h,{},_,[],x),I=this.expression.evaluate(new be(this.zoom+1),h,{},_,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(R,c,E,I)}updatePaintArray(c,h,p,_){const x=this.expression.evaluate({zoom:this.zoom},p,_),E=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(c,h,x,E)}_setPaintValue(c,h,p,_){if(this.type==="color"){const x=yo(p),E=yo(_);for(let I=c;I<h;I++)this.paintVertexArray.emplace(I,x[0],x[1],E[0],E[1])}else{for(let x=c;x<h;x++)this.paintVertexArray.emplace(x,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=Tt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);c.set(_)}getBinding(c,h,p){return new so(c,h)}}class Ni{constructor(c,h,p,_,x,E){this.expression=c,this.type=h,this.useIntegerZoom=p,this.zoom=_,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(c,h,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(_,c,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(c,h,p,_,x){this._setPaintValues(c,h,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(c,h,p,_){if(!_||!p)return;const{min:x,mid:E,max:I}=p,R=_[x],N=_[E],V=_[I];if(R&&N&&V)for(let j=c;j<h;j++)this.zoomInPaintVertexArray.emplace(j,N.tl[0],N.tl[1],N.br[0],N.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],N.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,N.tl[0],N.tl[1],N.br[0],N.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],N.pixelRatio,V.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,Mn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,Mn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ga{constructor(c,h,p){this.binders={},this._buffers=[];const _=[];for(const x in c.paint._values){if(!p(x))continue;const E=c.paint.get(x);if(!(E instanceof je&&_a(E.property.specification)))continue;const I=KE(x,c.type),R=E.value,N=E.property.specification.type,V=E.property.useIntegerZoom,j=E.property.specification["property-type"],tt=j==="cross-faded"||j==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=tt?new ko(R.value,I):new Ba(R.value,I,N),_.push(`/u_${x}`);else if(R.kind==="source"||tt){const rt=c_(x,N,"source");this.binders[x]=tt?new Ni(R,N,V,h,rt,c.id):new _o(R,I,N,rt),_.push(`/a_${x}`)}else{const rt=c_(x,N,"composite");this.binders[x]=new fi(R,I,N,V,h,rt),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(c){const h=this.binders[c];return h instanceof _o||h instanceof fi?h.maxValue:0}populatePaintArrays(c,h,p,_,x){for(const E in this.binders){const I=this.binders[E];(I instanceof _o||I instanceof fi||I instanceof Ni)&&I.populatePaintArray(c,h,p,_,x)}}setConstantPatternPositions(c,h){for(const p in this.binders){const _=this.binders[p];_ instanceof ko&&_.setConstantPatternPositions(c,h)}}updatePaintArrays(c,h,p,_,x){let E=!1;for(const I in c){const R=h.getPositions(I);for(const N of R){const V=p.feature(N.index);for(const j in this.binders){const tt=this.binders[j];if((tt instanceof _o||tt instanceof fi||tt instanceof Ni)&&tt.expression.isStateDependent===!0){const rt=_.paint.get(j);tt.expression=rt.value,tt.updatePaintArray(N.start,N.end,V,c[I],x),E=!0}}}}return E}defines(){const c=[];for(const h in this.binders){const p=this.binders[h];(p instanceof Ba||p instanceof ko)&&c.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return c}getBinderAttributes(){const c=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof _o||p instanceof fi)for(let _=0;_<p.paintVertexAttributes.length;_++)c.push(p.paintVertexAttributes[_].name);else if(p instanceof Ni)for(let _=0;_<Mn.members.length;_++)c.push(Mn.members[_].name)}return c}getBinderUniforms(){const c=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Ba||p instanceof ko||p instanceof fi)for(const _ of p.uniformNames)c.push(_)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,h){const p=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof Ba||x instanceof ko||x instanceof fi){for(const E of x.uniformNames)if(h[E]){const I=x.getBinding(c,h[E],E);p.push({name:E,property:_,binding:I})}}}return p}setUniforms(c,h,p,_){for(const{name:x,property:E,binding:I}of h)this.binders[E].setUniform(I,_,p.get(E),x)}updatePaintBuffers(c){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(c&&p instanceof Ni){const _=c.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof _o||p instanceof fi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(c){for(const h in this.binders){const p=this.binders[h];(p instanceof _o||p instanceof fi||p instanceof Ni)&&p.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const h=this.binders[c];(h instanceof _o||h instanceof fi||h instanceof Ni)&&h.destroy()}}}class Ki{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const _ of c)this.programConfigurations[_.id]=new Ga(_,h,p);this.needsUpload=!1,this._featureMap=new as,this._bufferOffset=0}populatePaintArrays(c,h,p,_,x,E){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(c,h,_,x,E);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,h,p,_){for(const x of p)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(c,this._featureMap,h,x,_)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function KE(A,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[A]||[A.replace(`${c}-`,"").replace(/-/g,"_")]}function c_(A,c,h){const p={color:{source:Cs,composite:g},number:{source:wu,composite:Cs}},_=function(x){return{"line-pattern":{source:ne,composite:ne},"fill-pattern":{source:ne,composite:ne},"fill-extrusion-pattern":{source:ne,composite:ne}}[x]}(A);return _&&_[h]||p[c][h]}Sr("ConstantBinder",Ba),Sr("CrossFadedConstantBinder",ko),Sr("SourceExpressionBinder",_o),Sr("CrossFadedCompositeBinder",Ni),Sr("CompositeExpressionBinder",fi),Sr("ProgramConfiguration",Ga,{omit:["_buffers"]}),Sr("ProgramConfigurationSet",Ki);const Bm=Math.pow(2,14)-1,u_=-Bm-1;function Jh(A){const c=Wt/A.extent,h=A.loadGeometry();for(let p=0;p<h.length;p++){const _=h[p];for(let x=0;x<_.length;x++){const E=_[x],I=Math.round(E.x*c),R=Math.round(E.y*c);E.x=Tt(I,u_,Bm),E.y=Tt(R,u_,Bm),(I<E.x||I>E.x+1||R<E.y||R>E.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function tA(A,c){return{type:A.type,id:A.id,properties:A.properties,geometry:c?Jh(A):[]}}const lh=-32768;function h_(A,c,h,p,_){A.emplaceBack(lh+8*c+p,lh+8*h+_)}class yp{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Ot,this.indexArray=new Le,this.segments=new br,this.programConfigurations=new Ki(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){const _=this.layers[0],x=[];let E=null,I=!1,R=_.type==="heatmap";if(_.type==="circle"){const V=_;E=V.layout.get("circle-sort-key"),I=!E.isConstant(),R=R||V.paint.get("circle-pitch-alignment")==="map"}const N=R?h.subdivisionGranularity.circle:1;for(const{feature:V,id:j,index:tt,sourceLayerIndex:rt}of c){const lt=this.layers[0]._featureFilter.needGeometry,dt=tA(V,lt);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),dt,p))continue;const Pt=I?E.evaluate(dt,{},p):void 0,Mt={id:j,properties:V.properties,type:V.type,sourceLayerIndex:rt,index:tt,geometry:lt?dt.geometry:Jh(V),patterns:{},sortKey:Pt};x.push(Mt)}I&&x.sort((V,j)=>V.sortKey-j.sortKey);for(const V of x){const{geometry:j,index:tt,sourceLayerIndex:rt}=V,lt=c[tt].feature;this.addFeature(V,j,tt,p,N),h.featureIndex.insert(lt,j,tt,rt,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ke),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,h,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,E;switch(x){case 1:E=[0,7];break;case 3:E=[0,2,5,7];break;case 5:E=[0,1,3,4,6,7];break;case 7:E=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const I=E.length;for(const R of h)for(const N of R){const V=N.x,j=N.y;if(V<0||V>=Wt||j<0||j>=Wt)continue;const tt=this.segments.prepareSegment(I*I,this.layoutVertexArray,this.indexArray,c.sortKey),rt=tt.vertexLength;for(let lt=0;lt<I;lt++)for(let dt=0;dt<I;dt++)h_(this.layoutVertexArray,V,j,E[dt],E[lt]);for(let lt=0;lt<I-1;lt++)for(let dt=0;dt<I-1;dt++){const Pt=rt+lt*I+dt,Mt=rt+(lt+1)*I+dt;this.indexArray.emplaceBack(Pt,Mt+1,Pt+1),this.indexArray.emplaceBack(Pt,Mt,Mt+1)}tt.vertexLength+=I*I,tt.primitiveLength+=(I-1)*(I-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,{},_)}}function Cm(A,c){for(let h=0;h<A.length;h++)if(_p(c,A[h]))return!0;for(let h=0;h<c.length;h++)if(_p(A,c[h]))return!0;return!!WE(A,c)}function Em(A,c,h){return!!_p(A,c)||!!$E(c,A,h)}function Tm(A,c){if(A.length===1)return Ik(c,A[0]);for(let h=0;h<c.length;h++){const p=c[h];for(let _=0;_<p.length;_++)if(_p(A,p[_]))return!0}for(let h=0;h<A.length;h++)if(Ik(c,A[h]))return!0;for(let h=0;h<c.length;h++)if(WE(A,c[h]))return!0;return!1}function Sm(A,c,h){if(A.length>1){if(WE(A,c))return!0;for(let p=0;p<c.length;p++)if($E(c[p],A,h))return!0}for(let p=0;p<A.length;p++)if($E(A[p],c,h))return!0;return!1}function WE(A,c){if(A.length===0||c.length===0)return!1;for(let h=0;h<A.length-1;h++){const p=A[h],_=A[h+1];for(let x=0;x<c.length-1;x++)if(Qft(p,_,c[x],c[x+1]))return!0}return!1}function Qft(A,c,h,p){return Je(A,h,p)!==Je(c,h,p)&&Je(A,c,h)!==Je(A,c,p)}function $E(A,c,h){const p=h*h;if(c.length===1)return A.distSqr(c[0])<p;for(let _=1;_<c.length;_++)if(Sk(A,c[_-1],c[_])<p)return!0;return!1}function Sk(A,c,h){const p=c.distSqr(h);if(p===0)return A.distSqr(c);const _=((A.x-c.x)*(h.x-c.x)+(A.y-c.y)*(h.y-c.y))/p;return A.distSqr(_<0?c:_>1?h:h.sub(c)._mult(_)._add(c))}function Ik(A,c){let h,p,_,x=!1;for(let E=0;E<A.length;E++){h=A[E];for(let I=0,R=h.length-1;I<h.length;R=I++)p=h[I],_=h[R],p.y>c.y!=_.y>c.y&&c.x<(_.x-p.x)*(c.y-p.y)/(_.y-p.y)+p.x&&(x=!x)}return x}function _p(A,c){let h=!1;for(let p=0,_=A.length-1;p<A.length;_=p++){const x=A[p],E=A[_];x.y>c.y!=E.y>c.y&&c.x<(E.x-x.x)*(c.y-x.y)/(E.y-x.y)+x.x&&(h=!h)}return h}function zft(A,c,h){const p=h[0],_=h[2];if(A.x<p.x&&c.x<p.x||A.x>_.x&&c.x>_.x||A.y<p.y&&c.y<p.y||A.y>_.y&&c.y>_.y)return!1;const x=Je(A,c,h[0]);return x!==Je(A,c,h[1])||x!==Je(A,c,h[2])||x!==Je(A,c,h[3])}function Im(A,c,h){const p=c.paint.get(A).value;return p.kind==="constant"?p.value:h.programConfigurations.get(c.id).getMaxValue(A)}function A_(A){return Math.sqrt(A[0]*A[0]+A[1]*A[1])}function d_(A,c,h,p,_){if(!c[0]&&!c[1])return A;const x=P.convert(c)._mult(_);h==="viewport"&&x._rotate(-p);const E=[];for(let I=0;I<A.length;I++)E.push(A[I].sub(x));return E}let Pk,Mk;Sr("CircleBucket",yp,{omit:["layers"]});var Hft={get paint(){return Mk=Mk||new pn({"circle-radius":new Ge(Bt.paint_circle["circle-radius"]),"circle-color":new Ge(Bt.paint_circle["circle-color"]),"circle-blur":new Ge(Bt.paint_circle["circle-blur"]),"circle-opacity":new Ge(Bt.paint_circle["circle-opacity"]),"circle-translate":new we(Bt.paint_circle["circle-translate"]),"circle-translate-anchor":new we(Bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new we(Bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new we(Bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ge(Bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ge(Bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ge(Bt.paint_circle["circle-stroke-opacity"])})},get layout(){return Pk=Pk||new pn({"circle-sort-key":new Ge(Bt.layout_circle["circle-sort-key"])})}};class Vft extends _n{constructor(c){super(c,Hft)}createBucket(c){return new yp(c)}queryRadius(c){const h=c;return Im("circle-radius",this,h)+Im("circle-stroke-width",this,h)+A_(this.paint.get("circle-translate"))}queryIntersectsFeature(c){let{queryGeometry:h,feature:p,featureState:_,geometry:x,transform:E,pixelsToTileUnits:I,pixelPosMatrix:R}=c;const N=d_(h,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,I),V=this.paint.get("circle-radius").evaluate(p,_)+this.paint.get("circle-stroke-width").evaluate(p,_),j=this.paint.get("circle-pitch-alignment")==="map",tt=j?N:function(lt,dt){return lt.map(Pt=>Fk(Pt,dt))}(N,R),rt=j?V*I:V;for(const lt of x)for(const dt of lt){const Pt=j?dt:Fk(dt,R);let Mt=rt;const ce=ot([],[dt.x,dt.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Mt*=ce[3]/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Mt*=E.cameraToCenterDistance/ce[3]),Em(tt,Pt,Mt))return!0}return!1}}function Fk(A,c){const h=ot([],[A.x,A.y,0,1],c);return new P(h[0]/h[3],h[1]/h[3])}class Lk extends yp{}let Rk;Sr("HeatmapBucket",Lk,{omit:["layers"]});var Gft={get paint(){return Rk=Rk||new pn({"heatmap-radius":new Ge(Bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ge(Bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new we(Bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pr(Bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new we(Bt.paint_heatmap["heatmap-opacity"])})}};function XE(A,c,h,p){let{width:_,height:x}=c;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==_*x*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${_*x*h}`)}else p=new Uint8Array(_*x*h);return A.width=_,A.height=x,A.data=p,A}function Ok(A,c,h){let{width:p,height:_}=c;if(p===A.width&&_===A.height)return;const x=XE({},{width:p,height:_},h);ZE(A,x,{x:0,y:0},{x:0,y:0},{width:Math.min(A.width,p),height:Math.min(A.height,_)},h),A.width=p,A.height=_,A.data=x.data}function ZE(A,c,h,p,_,x){if(_.width===0||_.height===0)return c;if(_.width>A.width||_.height>A.height||h.x>A.width-_.width||h.y>A.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>c.width||_.height>c.height||p.x>c.width-_.width||p.y>c.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const E=A.data,I=c.data;if(E===I)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<_.height;R++){const N=((h.y+R)*A.width+h.x)*x,V=((p.y+R)*c.width+p.x)*x;for(let j=0;j<_.width*x;j++)I[V+j]=E[N+j]}return c}class Pm{constructor(c,h){XE(this,c,1,h)}resize(c){Ok(this,c,1)}clone(){return new Pm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,p,_,x){ZE(c,h,p,_,x,1)}}class zl{constructor(c,h){XE(this,c,4,h)}resize(c){Ok(this,c,4)}replace(c,h){h?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,p,_,x){ZE(c,h,p,_,x,4)}}function Uk(A){const c={},h=A.resolution||256,p=A.clips?A.clips.length:1,_=A.image||new zl({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const x=(E,I,R)=>{c[A.evaluationKey]=R;const N=A.expression.evaluate(c);_.data[E+I+0]=Math.floor(255*N.r/N.a),_.data[E+I+1]=Math.floor(255*N.g/N.a),_.data[E+I+2]=Math.floor(255*N.b/N.a),_.data[E+I+3]=Math.floor(255*N.a)};if(A.clips)for(let E=0,I=0;E<p;++E,I+=4*h)for(let R=0,N=0;R<h;R++,N+=4){const V=R/(h-1),{start:j,end:tt}=A.clips[E];x(I,N,j*(1-V)+tt*V)}else for(let E=0,I=0;E<h;E++,I+=4)x(0,I,E/(h-1));return _}Sr("AlphaImage",Pm),Sr("RGBAImage",zl);const YE="big-fb";class jft extends _n{createBucket(c){return new Lk(c)}constructor(c){super(c,Gft),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Uk({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(YE)&&this.heatmapFbos.delete(YE)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Dk;var qft={get paint(){return Dk=Dk||new pn({"hillshade-illumination-direction":new we(Bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new we(Bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new we(Bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new we(Bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new we(Bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new we(Bt.paint_hillshade["hillshade-accent-color"])})}};class Kft extends _n{constructor(c){super(c,qft)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Wft=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:$ft}=Wft;function JE(A,c,h){const p=h.patternDependencies;let _=!1;for(const x of c){const E=x.paint.get(`${A}-pattern`);E.isConstant()||(_=!0);const I=E.constantOr(null);I&&(_=!0,p[I.to]=!0,p[I.from]=!0)}return _}function tT(A,c,h,p,_){const x=_.patternDependencies;for(const E of c){const I=E.paint.get(`${A}-pattern`).value;if(I.kind!=="constant"){let R=I.evaluate({zoom:p-1},h,{},_.availableImages),N=I.evaluate({zoom:p},h,{},_.availableImages),V=I.evaluate({zoom:p+1},h,{},_.availableImages);R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,V=V&&V.name?V.name:V,x[R]=!0,x[N]=!0,x[V]=!0,h.patterns[E.id]={min:R,mid:N,max:V}}}return h}function Nk(A,c,h,p,_){let x;if(_===function(E,I,R,N){let V=0;for(let j=I,tt=R-N;j<R;j+=N)V+=(E[tt]-E[j])*(E[j+1]+E[tt+1]),tt=j;return V}(A,c,h,p)>0)for(let E=c;E<h;E+=p)x=Hk(E/p|0,A[E],A[E+1],x);else for(let E=h-p;E>=c;E-=p)x=Hk(E/p|0,A[E],A[E+1],x);return x&&vp(x,x.next)&&(Rm(x),x=x.next),x}function $d(A,c){if(!A)return A;c||(c=A);let h,p=A;do if(h=!1,p.steiner||!vp(p,p.next)&&As(p.prev,p,p.next)!==0)p=p.next;else{if(Rm(p),p=c=p.prev,p===p.next)break;h=!0}while(h||p!==c);return c}function Mm(A,c,h,p,_,x,E){if(!A)return;!E&&x&&function(R,N,V,j){let tt=R;do tt.z===0&&(tt.z=eT(tt.x,tt.y,N,V,j)),tt.prevZ=tt.prev,tt.nextZ=tt.next,tt=tt.next;while(tt!==R);tt.prevZ.nextZ=null,tt.prevZ=null,function(rt){let lt,dt=1;do{let Pt,Mt=rt;rt=null;let ce=null;for(lt=0;Mt;){lt++;let Ht=Mt,et=0;for(let Vt=0;Vt<dt&&(et++,Ht=Ht.nextZ,Ht);Vt++);let Et=dt;for(;et>0||Et>0&&Ht;)et!==0&&(Et===0||!Ht||Mt.z<=Ht.z)?(Pt=Mt,Mt=Mt.nextZ,et--):(Pt=Ht,Ht=Ht.nextZ,Et--),ce?ce.nextZ=Pt:rt=Pt,Pt.prevZ=ce,ce=Pt;Mt=Ht}ce.nextZ=null,dt*=2}while(lt>1)}(tt)}(A,p,_,x);let I=A;for(;A.prev!==A.next;){const R=A.prev,N=A.next;if(x?Zft(A,p,_,x):Xft(A))c.push(R.i,A.i,N.i),Rm(A),A=N.next,I=N.next;else if((A=N)===I){E?E===1?Mm(A=Yft($d(A),c),c,h,p,_,x,2):E===2&&Jft(A,c,h,p,_,x):Mm($d(A),c,h,p,_,x,1);break}}}function Xft(A){const c=A.prev,h=A,p=A.next;if(As(c,h,p)>=0)return!1;const _=c.x,x=h.x,E=p.x,I=c.y,R=h.y,N=p.y,V=Math.min(_,x,E),j=Math.min(I,R,N),tt=Math.max(_,x,E),rt=Math.max(I,R,N);let lt=p.next;for(;lt!==c;){if(lt.x>=V&&lt.x<=tt&&lt.y>=j&&lt.y<=rt&&Fm(_,I,x,R,E,N,lt.x,lt.y)&&As(lt.prev,lt,lt.next)>=0)return!1;lt=lt.next}return!0}function Zft(A,c,h,p){const _=A.prev,x=A,E=A.next;if(As(_,x,E)>=0)return!1;const I=_.x,R=x.x,N=E.x,V=_.y,j=x.y,tt=E.y,rt=Math.min(I,R,N),lt=Math.min(V,j,tt),dt=Math.max(I,R,N),Pt=Math.max(V,j,tt),Mt=eT(rt,lt,c,h,p),ce=eT(dt,Pt,c,h,p);let Ht=A.prevZ,et=A.nextZ;for(;Ht&&Ht.z>=Mt&&et&&et.z<=ce;){if(Ht.x>=rt&&Ht.x<=dt&&Ht.y>=lt&&Ht.y<=Pt&&Ht!==_&&Ht!==E&&Fm(I,V,R,j,N,tt,Ht.x,Ht.y)&&As(Ht.prev,Ht,Ht.next)>=0||(Ht=Ht.prevZ,et.x>=rt&&et.x<=dt&&et.y>=lt&&et.y<=Pt&&et!==_&&et!==E&&Fm(I,V,R,j,N,tt,et.x,et.y)&&As(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;Ht&&Ht.z>=Mt;){if(Ht.x>=rt&&Ht.x<=dt&&Ht.y>=lt&&Ht.y<=Pt&&Ht!==_&&Ht!==E&&Fm(I,V,R,j,N,tt,Ht.x,Ht.y)&&As(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.prevZ}for(;et&&et.z<=ce;){if(et.x>=rt&&et.x<=dt&&et.y>=lt&&et.y<=Pt&&et!==_&&et!==E&&Fm(I,V,R,j,N,tt,et.x,et.y)&&As(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function Yft(A,c){let h=A;do{const p=h.prev,_=h.next.next;!vp(p,_)&&Qk(p,h,h.next,_)&&Lm(p,_)&&Lm(_,p)&&(c.push(p.i,h.i,_.i),Rm(h),Rm(h.next),h=A=_),h=h.next}while(h!==A);return $d(h)}function Jft(A,c,h,p,_,x){let E=A;do{let I=E.next.next;for(;I!==E.prev;){if(E.i!==I.i&&ipt(E,I)){let R=zk(E,I);return E=$d(E,E.next),R=$d(R,R.next),Mm(E,c,h,p,_,x,0),void Mm(R,c,h,p,_,x,0)}I=I.next}E=E.next}while(E!==A)}function tpt(A,c){let h=A.x-c.x;return h===0&&(h=A.y-c.y,h===0)&&(h=(A.next.y-A.y)/(A.next.x-A.x)-(c.next.y-c.y)/(c.next.x-c.x)),h}function ept(A,c){const h=function(_,x){let E=x;const I=_.x,R=_.y;let N,V=-1/0;if(vp(_,E))return E;do{if(vp(_,E.next))return E.next;if(R<=E.y&&R>=E.next.y&&E.next.y!==E.y){const dt=E.x+(R-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(dt<=I&&dt>V&&(V=dt,N=E.x<E.next.x?E:E.next,dt===I))return N}E=E.next}while(E!==x);if(!N)return null;const j=N,tt=N.x,rt=N.y;let lt=1/0;E=N;do{if(I>=E.x&&E.x>=tt&&I!==E.x&&kk(R<rt?I:V,R,tt,rt,R<rt?V:I,R,E.x,E.y)){const dt=Math.abs(R-E.y)/(I-E.x);Lm(E,_)&&(dt<lt||dt===lt&&(E.x>N.x||E.x===N.x&&rpt(N,E)))&&(N=E,lt=dt)}E=E.next}while(E!==j);return N}(A,c);if(!h)return c;const p=zk(h,A);return $d(p,p.next),$d(h,h.next)}function rpt(A,c){return As(A.prev,A,c.prev)<0&&As(c.next,A,A.next)<0}function eT(A,c,h,p,_){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-h)*_|0)|A<<8))|A<<4))|A<<2))|A<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-p)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function npt(A){let c=A,h=A;do(c.x<h.x||c.x===h.x&&c.y<h.y)&&(h=c),c=c.next;while(c!==A);return h}function kk(A,c,h,p,_,x,E,I){return(_-E)*(c-I)>=(A-E)*(x-I)&&(A-E)*(p-I)>=(h-E)*(c-I)&&(h-E)*(x-I)>=(_-E)*(p-I)}function Fm(A,c,h,p,_,x,E,I){return!(A===E&&c===I)&&kk(A,c,h,p,_,x,E,I)}function ipt(A,c){return A.next.i!==c.i&&A.prev.i!==c.i&&!function(h,p){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==p.i&&_.next.i!==p.i&&Qk(_,_.next,h,p))return!0;_=_.next}while(_!==h);return!1}(A,c)&&(Lm(A,c)&&Lm(c,A)&&function(h,p){let _=h,x=!1;const E=(h.x+p.x)/2,I=(h.y+p.y)/2;do _.y>I!=_.next.y>I&&_.next.y!==_.y&&E<(_.next.x-_.x)*(I-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==h);return x}(A,c)&&(As(A.prev,A,c.prev)||As(A,c.prev,c))||vp(A,c)&&As(A.prev,A,A.next)>0&&As(c.prev,c,c.next)>0)}function As(A,c,h){return(c.y-A.y)*(h.x-c.x)-(c.x-A.x)*(h.y-c.y)}function vp(A,c){return A.x===c.x&&A.y===c.y}function Qk(A,c,h,p){const _=p_(As(A,c,h)),x=p_(As(A,c,p)),E=p_(As(h,p,A)),I=p_(As(h,p,c));return _!==x&&E!==I||!(_!==0||!f_(A,h,c))||!(x!==0||!f_(A,p,c))||!(E!==0||!f_(h,A,p))||!(I!==0||!f_(h,c,p))}function f_(A,c,h){return c.x<=Math.max(A.x,h.x)&&c.x>=Math.min(A.x,h.x)&&c.y<=Math.max(A.y,h.y)&&c.y>=Math.min(A.y,h.y)}function p_(A){return A>0?1:A<0?-1:0}function Lm(A,c){return As(A.prev,A,A.next)<0?As(A,c,A.next)>=0&&As(A,A.prev,c)>=0:As(A,c,A.prev)<0||As(A,A.next,c)<0}function zk(A,c){const h=rT(A.i,A.x,A.y),p=rT(c.i,c.x,c.y),_=A.next,x=c.prev;return A.next=c,c.prev=A,h.next=_,_.prev=h,p.next=h,h.prev=p,x.next=p,p.prev=x,p}function Hk(A,c,h,p){const _=rT(A,c,h);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Rm(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function rT(A,c,h){return{i:A,x:c,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class bp{constructor(c,h){if(h>c)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=c,this._minGranularity=h}getGranularityForZoomLevel(c){return Math.max(Math.floor(this._baseZoomGranularity/(1<<c)),this._minGranularity,1)}}class g_{constructor(c){this.fill=c.fill,this.line=c.line,this.tile=c.tile,this.stencil=c.stencil,this.circle=c.circle}}g_.noSubdivision=new g_({fill:new bp(0,0),line:new bp(0,0),tile:new bp(0,0),stencil:new bp(0,0),circle:1}),Sr("SubdivisionGranularityExpression",bp),Sr("SubdivisionGranularitySetting",g_);const wp=-32768,Om=32767;class spt{constructor(c,h){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=c,this._granularityCellSize=Wt/c,this._canonical=h}_getKey(c,h){return(c+=32768)<<16|(h+=32768)<<0}_vertexToIndex(c,h){if(c<-32768||h<-32768||c>32767||h>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(c),_=0|Math.round(h),x=this._getKey(p,_);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const E=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,E),this._vertexBuffer.push(p,_),E}_subdivideTrianglesScanline(c){if(this._granularity<2)return function(_,x){const E=[];for(let I=0;I<x.length;I+=3){const R=x[I],N=x[I+1],V=x[I+2],j=_[2*R],tt=_[2*R+1];(_[2*N]-j)*(_[2*V+1]-tt)-(_[2*N+1]-tt)*(_[2*V]-j)>0?(E.push(R),E.push(V),E.push(N)):(E.push(R),E.push(N),E.push(V))}return E}(this._vertexBuffer,c);const h=[],p=c.length;for(let _=0;_<p;_+=3){const x=[c[_+0],c[_+1],c[_+2]],E=[this._vertexBuffer[2*c[_+0]+0],this._vertexBuffer[2*c[_+0]+1],this._vertexBuffer[2*c[_+1]+0],this._vertexBuffer[2*c[_+1]+1],this._vertexBuffer[2*c[_+2]+0],this._vertexBuffer[2*c[_+2]+1]];let I=1/0,R=1/0,N=-1/0,V=-1/0;for(let dt=0;dt<3;dt++){const Pt=E[2*dt],Mt=E[2*dt+1];I=Math.min(I,Pt),N=Math.max(N,Pt),R=Math.min(R,Mt),V=Math.max(V,Mt)}if(I===N||R===V)continue;const j=Math.floor(I/this._granularityCellSize),tt=Math.ceil(N/this._granularityCellSize),rt=Math.floor(R/this._granularityCellSize),lt=Math.ceil(V/this._granularityCellSize);if(j!==tt||rt!==lt)for(let dt=rt;dt<lt;dt++){const Pt=this._scanlineGenerateVertexRingForCellRow(dt,E,x);opt(this._vertexBuffer,Pt,h)}else h.push(...x)}return h}_scanlineGenerateVertexRingForCellRow(c,h,p){const _=c*this._granularityCellSize,x=_+this._granularityCellSize,E=[];for(let I=0;I<3;I++){const R=h[2*I],N=h[2*I+1],V=h[2*(I+1)%6],j=h[(2*(I+1)+1)%6],tt=h[2*(I+2)%6],rt=h[(2*(I+2)+1)%6],lt=V-R,dt=j-N,Pt=lt===0,Mt=dt===0,ce=(_-N)/dt,Ht=(x-N)/dt,et=Math.min(ce,Ht),Et=Math.max(ce,Ht);if(!Mt&&(et>=1||Et<=0)||Mt&&(N<_||N>x)){j>=_&&j<=x&&E.push(p[(I+1)%3]);continue}!Mt&&et>0&&E.push(this._vertexToIndex(R+lt*et,N+dt*et));const Vt=R+lt*Math.max(et,0),Ee=R+lt*Math.min(Et,1);Pt||this._generateIntraEdgeVertices(E,R,N,V,j,Vt,Ee),!Mt&&Et<1&&E.push(this._vertexToIndex(R+lt*Et,N+dt*Et)),(Mt||j>=_&&j<=x)&&E.push(p[(I+1)%3]),!Mt&&(j<=_||j>=x)&&this._generateInterEdgeVertices(E,R,N,V,j,tt,rt,Ee,_,x)}return E}_generateIntraEdgeVertices(c,h,p,_,x,E,I){const R=_-h,N=x-p,V=N===0,j=V?Math.min(h,_):Math.min(E,I),tt=V?Math.max(h,_):Math.max(E,I),rt=Math.floor(j/this._granularityCellSize)+1,lt=Math.ceil(tt/this._granularityCellSize)-1;if(V?h<_:E<I)for(let dt=rt;dt<=lt;dt++){const Pt=dt*this._granularityCellSize;c.push(this._vertexToIndex(Pt,p+N*(Pt-h)/R))}else for(let dt=lt;dt>=rt;dt--){const Pt=dt*this._granularityCellSize;c.push(this._vertexToIndex(Pt,p+N*(Pt-h)/R))}}_generateInterEdgeVertices(c,h,p,_,x,E,I,R,N,V){const j=x-p,tt=E-_,rt=I-x,lt=(N-x)/rt,dt=(V-x)/rt,Pt=Math.min(lt,dt),Mt=Math.max(lt,dt),ce=_+tt*Pt;let Ht=Math.floor(Math.min(ce,R)/this._granularityCellSize)+1,et=Math.ceil(Math.max(ce,R)/this._granularityCellSize)-1,Et=R<ce;const Vt=rt===0;if(Vt&&(I===N||I===V))return;if(Vt||Pt>=1||Mt<=0){const We=p-I,Pe=E+(h-E)*Math.min((N-I)/We,(V-I)/We);Ht=Math.floor(Math.min(Pe,R)/this._granularityCellSize)+1,et=Math.ceil(Math.max(Pe,R)/this._granularityCellSize)-1,Et=R<Pe}const Ee=j>0?V:N;if(Et)for(let We=Ht;We<=et;We++)c.push(this._vertexToIndex(We*this._granularityCellSize,Ee));else for(let We=et;We>=Ht;We--)c.push(this._vertexToIndex(We*this._granularityCellSize,Ee))}_generateOutline(c){const h=[];for(const p of c){const _=Xd(p,this._granularity,!0),x=this._pointArrayToIndices(_),E=[];for(let I=1;I<x.length;I++)E.push(x[I-1]),E.push(x[I]);h.push(E)}return h}_handlePoles(c){let h=!1,p=!1;this._canonical&&(this._canonical.y===0&&(h=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(h||p)&&this._fillPoles(c,h,p)}_ensureNoPoleVertices(){const c=this._vertexBuffer;for(let h=0;h<c.length;h+=2){const p=c[h+1];p===wp&&(c[h+1]=-32767),p===Om&&(c[h+1]=32766)}}_generatePoleQuad(c,h,p,_,x,E){_>x!=(E===wp)?(c.push(h),c.push(p),c.push(this._vertexToIndex(_,E)),c.push(p),c.push(this._vertexToIndex(x,E)),c.push(this._vertexToIndex(_,E))):(c.push(p),c.push(h),c.push(this._vertexToIndex(_,E)),c.push(this._vertexToIndex(x,E)),c.push(p),c.push(this._vertexToIndex(_,E)))}_fillPoles(c,h,p){const _=this._vertexBuffer,x=Wt,E=c.length;for(let I=2;I<E;I+=3){const R=c[I-2],N=c[I-1],V=c[I],j=_[2*R],tt=_[2*R+1],rt=_[2*N],lt=_[2*N+1],dt=_[2*V],Pt=_[2*V+1];h&&(tt===0&&lt===0&&this._generatePoleQuad(c,R,N,j,rt,wp),lt===0&&Pt===0&&this._generatePoleQuad(c,N,V,rt,dt,wp),Pt===0&&tt===0&&this._generatePoleQuad(c,V,R,dt,j,wp)),p&&(tt===x&&lt===x&&this._generatePoleQuad(c,R,N,j,rt,Om),lt===x&&Pt===x&&this._generatePoleQuad(c,N,V,rt,dt,Om),Pt===x&&tt===x&&this._generatePoleQuad(c,V,R,dt,j,Om))}}_initializeVertices(c){for(let h=0;h<c.length;h+=2)this._vertexToIndex(c[h],c[h+1])}subdividePolygonInternal(c,h){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:_}=function(I){const R=[],N=[];for(const V of I)if(V.length!==0){V!==I[0]&&R.push(N.length/2);for(let j=0;j<V.length;j++)N.push(V[j].x),N.push(V[j].y)}return{flattened:N,holeIndices:R}}(c);let x;this._initializeVertices(p);try{const I=function(N,V){let j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const tt=V&&V.length,rt=tt?V[0]*j:N.length;let lt=Nk(N,0,rt,j,!0);const dt=[];if(!lt||lt.next===lt.prev)return dt;let Pt,Mt,ce;if(tt&&(lt=function(Ht,et,Et,Vt){const Ee=[];for(let We=0,Pe=et.length;We<Pe;We++){const Ue=Nk(Ht,et[We]*Vt,We<Pe-1?et[We+1]*Vt:Ht.length,Vt,!1);Ue===Ue.next&&(Ue.steiner=!0),Ee.push(npt(Ue))}Ee.sort(tpt);for(let We=0;We<Ee.length;We++)Et=ept(Ee[We],Et);return Et}(N,V,lt,j)),N.length>80*j){Pt=1/0,Mt=1/0;let Ht=-1/0,et=-1/0;for(let Et=j;Et<rt;Et+=j){const Vt=N[Et],Ee=N[Et+1];Vt<Pt&&(Pt=Vt),Ee<Mt&&(Mt=Ee),Vt>Ht&&(Ht=Vt),Ee>et&&(et=Ee)}ce=Math.max(Ht-Pt,et-Mt),ce=ce!==0?32767/ce:0}return Mm(lt,dt,j,Pt,Mt,ce,0),dt}(p,_),R=this._convertIndices(p,I);x=this._subdivideTrianglesScanline(R)}catch(I){console.error(I)}let E=[];return h&&(E=this._generateOutline(c)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:E}}_convertIndices(c,h){const p=[];for(let _=0;_<h.length;_++)p.push(this._vertexToIndex(c[2*h[_]],c[2*h[_]+1]));return p}_pointArrayToIndices(c){const h=[];for(let p=0;p<c.length;p++){const _=c[p];h.push(this._vertexToIndex(_.x,_.y))}return h}}function Vk(A,c,h){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return new spt(h,c).subdividePolygonInternal(A,p)}function Xd(A,c){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!A||A.length<1)return[];if(A.length<2)return[];const p=A[0],_=A[A.length-1],x=h&&(p.x!==_.x||p.y!==_.y);if(c<2)return x?[...A,A[0]]:[...A];const E=Math.floor(Wt/c),I=[];I.push(new P(A[0].x,A[0].y));const R=A.length,N=x?R:R-1;for(let V=0;V<N;V++){const j=A[V],tt=V<R-1?A[V+1]:A[0],rt=j.x,lt=j.y,dt=tt.x,Pt=tt.y,Mt=rt!==dt,ce=lt!==Pt;if(!Mt&&!ce)continue;const Ht=dt-rt,et=Pt-lt,Et=Math.abs(Ht),Vt=Math.abs(et);let Ee=rt,We=lt;for(;;){const Ue=Ht>0?(Math.floor(Ee/E)+1)*E:(Math.ceil(Ee/E)-1)*E,lr=et>0?(Math.floor(We/E)+1)*E:(Math.ceil(We/E)-1)*E,Ye=Math.abs(Ee-Ue),dr=Math.abs(We-lr),ke=Math.abs(Ee-dt),Dr=Math.abs(We-Pt),Xr=Mt?Ye/Et:Number.POSITIVE_INFINITY,Kr=ce?dr/Vt:Number.POSITIVE_INFINITY;if((ke<=Ye||!Mt)&&(Dr<=dr||!ce))break;if(Xr<Kr&&Mt||!ce){Ee=Ue,We+=et*Xr;const zr=new P(Ee,Math.round(We));I[I.length-1].x===zr.x&&I[I.length-1].y===zr.y||I.push(zr)}else{Ee+=Ht*Kr,We=lr;const zr=new P(Math.round(Ee),We);I[I.length-1].x===zr.x&&I[I.length-1].y===zr.y||I.push(zr)}}const Pe=new P(dt,Pt);I[I.length-1].x===Pe.x&&I[I.length-1].y===Pe.y||I.push(Pe)}return I}function opt(A,c,h){if(c.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,_=A[2*c[0]];for(let R=1;R<c.length;R++){const N=A[2*c[R]];N<_&&(_=N,p=R)}const x=c.length;let E=p,I=(E+1)%x;for(;;){const R=E-1>=0?E-1:x-1,N=(I+1)%x,V=A[2*c[R]],j=A[2*c[N]],tt=A[2*c[E]],rt=A[2*c[E]+1],lt=A[2*c[I]+1];let dt=!1;if(V<j)dt=!0;else if(V>j)dt=!1;else{const Pt=lt-rt,Mt=-(A[2*c[I]]-tt),ce=rt<lt?1:-1;((V-tt)*Pt+(A[2*c[R]+1]-rt)*Mt)*ce>((j-tt)*Pt+(A[2*c[N]+1]-rt)*Mt)*ce&&(dt=!0)}if(dt){const Pt=c[R],Mt=c[E],ce=c[I];Pt!==Mt&&Pt!==ce&&Mt!==ce&&h.push(ce,Mt,Pt),E--,E<0&&(E=x-1)}else{const Pt=c[N],Mt=c[E],ce=c[I];Pt!==Mt&&Pt!==ce&&Mt!==ce&&h.push(ce,Mt,Pt),I++,I>=x&&(I=0)}if(R===N)break}}function Gk(A,c,h,p,_,x,E,I,R){const N=_.length/2,V=E&&I&&R;if(N<br.MAX_VERTEX_ARRAY_LENGTH){const j=c.prepareSegment(N,h,p),tt=j.vertexLength;for(let dt=0;dt<x.length;dt+=3)p.emplaceBack(tt+x[dt],tt+x[dt+1],tt+x[dt+2]);let rt,lt;j.vertexLength+=N,j.primitiveLength+=x.length/3,V&&(lt=E.prepareSegment(N,h,I),rt=lt.vertexLength,lt.vertexLength+=N);for(let dt=0;dt<_.length;dt+=2)A(_[dt],_[dt+1]);if(V)for(let dt=0;dt<R.length;dt++){const Pt=R[dt];for(let Mt=1;Mt<Pt.length;Mt+=2)I.emplaceBack(rt+Pt[Mt-1],rt+Pt[Mt]);lt.primitiveLength+=Pt.length/2}}else(function(j,tt,rt,lt,dt,Pt){const Mt=[];for(let Vt=0;Vt<lt.length/2;Vt++)Mt.push(-1);const ce={count:0};let Ht=0,et=j.getOrCreateLatestSegment(tt,rt),Et=et.vertexLength;for(let Vt=2;Vt<dt.length;Vt+=3){const Ee=dt[Vt-2],We=dt[Vt-1],Pe=dt[Vt];let Ue=Mt[Ee]<Ht,lr=Mt[We]<Ht,Ye=Mt[Pe]<Ht;et.vertexLength+((Ue?1:0)+(lr?1:0)+(Ye?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(et=j.createNewSegment(tt,rt),Ht=ce.count,Ue=!0,lr=!0,Ye=!0,Et=0);const dr=Um(Mt,lt,Pt,ce,Ee,Ue,et),ke=Um(Mt,lt,Pt,ce,We,lr,et),Dr=Um(Mt,lt,Pt,ce,Pe,Ye,et);rt.emplaceBack(Et+dr-Ht,Et+ke-Ht,Et+Dr-Ht),et.primitiveLength++}})(c,h,p,_,x,A),V&&function(j,tt,rt,lt,dt,Pt){const Mt=[];for(let Vt=0;Vt<lt.length/2;Vt++)Mt.push(-1);const ce={count:0};let Ht=0,et=j.getOrCreateLatestSegment(tt,rt),Et=et.vertexLength;for(let Vt=0;Vt<dt.length;Vt++){const Ee=dt[Vt];for(let We=1;We<dt[Vt].length;We+=2){const Pe=Ee[We-1],Ue=Ee[We];let lr=Mt[Pe]<Ht,Ye=Mt[Ue]<Ht;et.vertexLength+((lr?1:0)+(Ye?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(et=j.createNewSegment(tt,rt),Ht=ce.count,lr=!0,Ye=!0,Et=0);const dr=Um(Mt,lt,Pt,ce,Pe,lr,et),ke=Um(Mt,lt,Pt,ce,Ue,Ye,et);rt.emplaceBack(Et+dr-Ht,Et+ke-Ht),et.primitiveLength++}}}(E,h,I,_,R,A),c.forceNewSegmentOnNextPrepare(),E==null||E.forceNewSegmentOnNextPrepare()}function Um(A,c,h,p,_,x,E){if(x){const I=p.count;return h(c[2*_],c[2*_+1]),A[_]=p.count,p.count++,E.vertexLength++,I}return A[_]}class nT{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kt,this.indexArray=new Le,this.indexArray2=new fr,this.programConfigurations=new Ki(c.layers,c.zoom),this.segments=new br,this.segments2=new br,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.hasPattern=JE("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),E=[];for(const{feature:I,id:R,index:N,sourceLayerIndex:V}of c){const j=this.layers[0]._featureFilter.needGeometry,tt=tA(I,j);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),tt,p))continue;const rt=x?_.evaluate(tt,{},p,h.availableImages):void 0,lt={id:R,properties:I.properties,type:I.type,sourceLayerIndex:V,index:N,geometry:j?tt.geometry:Jh(I),patterns:{},sortKey:rt};E.push(lt)}x&&E.sort((I,R)=>I.sortKey-R.sortKey);for(const I of E){const{geometry:R,index:N,sourceLayerIndex:V}=I;if(this.hasPattern){const j=tT("fill",this.layers,I,this.zoom,h);this.patternFeatures.push(j)}else this.addFeature(I,R,N,p,{},h.subdivisionGranularity);h.featureIndex.insert(c[N].feature,R,N,V,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}addFeatures(c,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,$ft),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,h,p,_,x,E){for(const I of fo(h,500)){const R=Vk(I,_,E.fill.getGranularityForZoomLevel(_.z)),N=this.layoutVertexArray;Gk((V,j)=>{N.emplaceBack(V,j)},this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}}let jk,qk;Sr("FillBucket",nT,{omit:["layers","patternFeatures"]});var apt={get paint(){return qk=qk||new pn({"fill-antialias":new we(Bt.paint_fill["fill-antialias"]),"fill-opacity":new Ge(Bt.paint_fill["fill-opacity"]),"fill-color":new Ge(Bt.paint_fill["fill-color"]),"fill-outline-color":new Ge(Bt.paint_fill["fill-outline-color"]),"fill-translate":new we(Bt.paint_fill["fill-translate"]),"fill-translate-anchor":new we(Bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tr(Bt.paint_fill["fill-pattern"])})},get layout(){return jk=jk||new pn({"fill-sort-key":new Ge(Bt.layout_fill["fill-sort-key"])})}};class lpt extends _n{constructor(c){super(c,apt)}recalculate(c,h){super.recalculate(c,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new nT(c)}queryRadius(){return A_(this.paint.get("fill-translate"))}queryIntersectsFeature(c){let{queryGeometry:h,geometry:p,transform:_,pixelsToTileUnits:x}=c;return Tm(d_(h,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-_.bearingInRadians,x),p)}isTileClipped(){return!0}}const cpt=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),upt=jr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hpt}=cpt;var iT,Kk,sT,Wk,oT,$k,Xk,m_={};function Zk(){if(Kk)return iT;Kk=1;var A=v();function c(_,x,E,I,R){this.properties={},this.extent=E,this.type=0,this._pbf=_,this._geometry=-1,this._keys=I,this._values=R,_.readFields(h,this,x)}function h(_,x,E){_==1?x.id=E.readVarint():_==2?function(I,R){for(var N=I.readVarint()+I.pos;I.pos<N;){var V=R._keys[I.readVarint()],j=R._values[I.readVarint()];R.properties[V]=j}}(E,x):_==3?x.type=E.readVarint():_==4&&(x._geometry=E.pos)}function p(_){for(var x,E,I=0,R=0,N=_.length,V=N-1;R<N;V=R++)I+=((E=_[V]).x-(x=_[R]).x)*(x.y+E.y);return I}return iT=c,c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var x,E=_.readVarint()+_.pos,I=1,R=0,N=0,V=0,j=[];_.pos<E;){if(R<=0){var tt=_.readVarint();I=7&tt,R=tt>>3}if(R--,I===1||I===2)N+=_.readSVarint(),V+=_.readSVarint(),I===1&&(x&&j.push(x),x=[]),x.push(new A(N,V));else{if(I!==7)throw new Error("unknown command "+I);x&&x.push(x[0].clone())}}return x&&j.push(x),j},c.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var x=_.readVarint()+_.pos,E=1,I=0,R=0,N=0,V=1/0,j=-1/0,tt=1/0,rt=-1/0;_.pos<x;){if(I<=0){var lt=_.readVarint();E=7&lt,I=lt>>3}if(I--,E===1||E===2)(R+=_.readSVarint())<V&&(V=R),R>j&&(j=R),(N+=_.readSVarint())<tt&&(tt=N),N>rt&&(rt=N);else if(E!==7)throw new Error("unknown command "+E)}return[V,tt,j,rt]},c.prototype.toGeoJSON=function(_,x,E){var I,R,N=this.extent*Math.pow(2,E),V=this.extent*_,j=this.extent*x,tt=this.loadGeometry(),rt=c.types[this.type];function lt(Mt){for(var ce=0;ce<Mt.length;ce++){var Ht=Mt[ce];Mt[ce]=[360*(Ht.x+V)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ht.y+j)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var dt=[];for(I=0;I<tt.length;I++)dt[I]=tt[I][0];lt(tt=dt);break;case 2:for(I=0;I<tt.length;I++)lt(tt[I]);break;case 3:for(tt=function(Mt){var ce=Mt.length;if(ce<=1)return[Mt];for(var Ht,et,Et=[],Vt=0;Vt<ce;Vt++){var Ee=p(Mt[Vt]);Ee!==0&&(et===void 0&&(et=Ee<0),et===Ee<0?(Ht&&Et.push(Ht),Ht=[Mt[Vt]]):Ht.push(Mt[Vt]))}return Ht&&Et.push(Ht),Et}(tt),I=0;I<tt.length;I++)for(R=0;R<tt[I].length;R++)lt(tt[I][R])}tt.length===1?tt=tt[0]:rt="Multi"+rt;var Pt={type:"Feature",geometry:{type:rt,coordinates:tt},properties:this.properties};return"id"in this&&(Pt.id=this.id),Pt},iT}function Yk(){if(Wk)return sT;Wk=1;var A=Zk();function c(p,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(h,this,_),this.length=this._features.length}function h(p,_,x){p===15?_.version=x.readVarint():p===1?_.name=x.readString():p===5?_.extent=x.readVarint():p===2?_._features.push(x.pos):p===3?_._keys.push(x.readString()):p===4&&_._values.push(function(E){for(var I=null,R=E.readVarint()+E.pos;E.pos<R;){var N=E.readVarint()>>3;I=N===1?E.readString():N===2?E.readFloat():N===3?E.readDouble():N===4?E.readVarint64():N===5?E.readVarint():N===6?E.readSVarint():N===7?E.readBoolean():null}return I}(x))}return sT=c,c.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var _=this._pbf.readVarint()+this._pbf.pos;return new A(this._pbf,_,this.extent,this._keys,this._values)},sT}function Jk(){return Xk||(Xk=1,m_.VectorTile=function(){if($k)return oT;$k=1;var A=Yk();function c(h,p,_){if(h===3){var x=new A(_,_.readVarint()+_.pos);x.length&&(p[x.name]=x)}}return oT=function(h,p){this.layers=h.readFields(c,{},p)},oT}(),m_.VectorTileFeature=Zk(),m_.VectorTileLayer=Yk()),m_}var Dm=d(Jk());const Apt=Dm.VectorTileFeature.types,aT=Math.pow(2,13);function Nm(A,c,h,p,_,x,E,I){A.emplaceBack(c,h,2*Math.floor(p*aT)+E,_*aT*2,x*aT*2,Math.round(I))}class lT{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new qt,this.centroidVertexArray=new Ft,this.indexArray=new Le,this.programConfigurations=new Ki(c.layers,c.zoom),this.segments=new br,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.features=[],this.hasPattern=JE("fill-extrusion",this.layers,h);for(const{feature:_,id:x,index:E,sourceLayerIndex:I}of c){const R=this.layers[0]._featureFilter.needGeometry,N=tA(_,R);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),N,p))continue;const V={id:x,sourceLayerIndex:I,index:E,geometry:R?N.geometry:Jh(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(tT("fill-extrusion",this.layers,V,this.zoom,h)):this.addFeature(V,V.geometry,E,p,{},h.subdivisionGranularity),h.featureIndex.insert(_,V.geometry,E,I,this.index,!0)}}addFeatures(c,h,p){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,h,p,c.subdivisionGranularity)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,hpt),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,upt.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,h,p,_,x,E){for(const I of fo(h,500)){const R={x:0,y:0,sampleCount:0},N=this.layoutVertexArray.length;this.processPolygon(R,_,c,I,E);const V=this.layoutVertexArray.length-N,j=Math.floor(R.x/R.sampleCount),tt=Math.floor(R.y/R.sampleCount);for(let rt=0;rt<V;rt++)this.centroidVertexArray.emplaceBack(j,tt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}processPolygon(c,h,p,_,x){if(_.length<1||t8(_[0]))return;for(const j of _)j.length!==0&&dpt(c,j);const E={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},I=x.fill.getGranularityForZoomLevel(h.z),R=Apt[p.type]==="Polygon";for(const j of _){if(j.length===0||t8(j))continue;const tt=Xd(j,I,R);this._generateSideFaces(tt,E)}if(!R)return;const N=Vk(_,h,I,!1),V=this.layoutVertexArray;Gk((j,tt)=>{Nm(V,j,tt,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,N.verticesFlattened,N.indicesTriangles)}_generateSideFaces(c,h){let p=0;for(let _=1;_<c.length;_++){const x=c[_],E=c[_-1];if(fpt(x,E))continue;h.segment.vertexLength+4>br.MAX_VERTEX_ARRAY_LENGTH&&(h.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const I=x.sub(E)._perp()._unit(),R=E.dist(x);p+R>32768&&(p=0),Nm(this.layoutVertexArray,x.x,x.y,I.x,I.y,0,0,p),Nm(this.layoutVertexArray,x.x,x.y,I.x,I.y,0,1,p),p+=R,Nm(this.layoutVertexArray,E.x,E.y,I.x,I.y,0,0,p),Nm(this.layoutVertexArray,E.x,E.y,I.x,I.y,0,1,p);const N=h.segment.vertexLength;this.indexArray.emplaceBack(N,N+2,N+1),this.indexArray.emplaceBack(N+1,N+2,N+3),h.segment.vertexLength+=4,h.segment.primitiveLength+=2}}}function dpt(A,c){for(let h=0;h<c.length;h++){const p=c[h];h===c.length-1&&c[0].x===p.x&&c[0].y===p.y||(A.x+=p.x,A.y+=p.y,A.sampleCount++)}}function fpt(A,c){return A.x===c.x&&(A.x<0||A.x>Wt)||A.y===c.y&&(A.y<0||A.y>Wt)}function t8(A){return A.every(c=>c.x<0)||A.every(c=>c.x>Wt)||A.every(c=>c.y<0)||A.every(c=>c.y>Wt)}let e8;Sr("FillExtrusionBucket",lT,{omit:["layers","features"]});var ppt={get paint(){return e8=e8||new pn({"fill-extrusion-opacity":new we(Bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ge(Bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new we(Bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new we(Bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tr(Bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ge(Bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ge(Bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new we(Bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gpt extends _n{constructor(c){super(c,ppt)}createBucket(c){return new lT(c)}queryRadius(){return A_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c){let{queryGeometry:h,feature:p,featureState:_,geometry:x,transform:E,pixelsToTileUnits:I,pixelPosMatrix:R}=c;const N=d_(h,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,I),V=this.paint.get("fill-extrusion-height").evaluate(p,_),j=this.paint.get("fill-extrusion-base").evaluate(p,_),tt=function(lt,dt,Pt){const Mt=[];for(const ce of lt){const Ht=[ce.x,ce.y,0,1];ot(Ht,Ht,dt),Mt.push(new P(Ht[0]/Ht[3],Ht[1]/Ht[3]))}return Mt}(N,R),rt=function(lt,dt,Pt,Mt){const ce=[],Ht=[],et=Mt[8]*dt,Et=Mt[9]*dt,Vt=Mt[10]*dt,Ee=Mt[11]*dt,We=Mt[8]*Pt,Pe=Mt[9]*Pt,Ue=Mt[10]*Pt,lr=Mt[11]*Pt;for(const Ye of lt){const dr=[],ke=[];for(const Dr of Ye){const Xr=Dr.x,Kr=Dr.y,zr=Mt[0]*Xr+Mt[4]*Kr+Mt[12],Fn=Mt[1]*Xr+Mt[5]*Kr+Mt[13],rs=Mt[2]*Xr+Mt[6]*Kr+Mt[14],Es=Mt[3]*Xr+Mt[7]*Kr+Mt[15],Ca=rs+Vt,qa=Es+Ee,Ka=zr+We,vo=Fn+Pe,ls=rs+Ue,Ws=Es+lr,bo=new P((zr+et)/qa,(Fn+Et)/qa);bo.z=Ca/qa,dr.push(bo);const Ts=new P(Ka/Ws,vo/Ws);Ts.z=ls/Ws,ke.push(Ts)}ce.push(dr),Ht.push(ke)}return[ce,Ht]}(x,j,V,R);return function(lt,dt,Pt){let Mt=1/0;Tm(Pt,dt)&&(Mt=r8(Pt,dt[0]));for(let ce=0;ce<dt.length;ce++){const Ht=dt[ce],et=lt[ce];for(let Et=0;Et<Ht.length-1;Et++){const Vt=Ht[Et],Ee=[Vt,Ht[Et+1],et[Et+1],et[Et],Vt];Cm(Pt,Ee)&&(Mt=Math.min(Mt,r8(Pt,Ee)))}}return Mt!==1/0&&Mt}(rt[0],rt[1],tt)}}function km(A,c){return A.x*c.x+A.y*c.y}function r8(A,c){if(A.length===1){let h=0;const p=c[h++];let _;for(;!_||p.equals(_);)if(_=c[h++],!_)return 1/0;for(;h<c.length;h++){const x=c[h],E=A[0],I=_.sub(p),R=x.sub(p),N=E.sub(p),V=km(I,I),j=km(I,R),tt=km(R,R),rt=km(N,I),lt=km(N,R),dt=V*tt-j*j,Pt=(tt*rt-j*lt)/dt,Mt=(V*lt-j*rt)/dt,ce=p.z*(1-Pt-Mt)+_.z*Pt+x.z*Mt;if(isFinite(ce))return ce}return 1/0}{let h=1/0;for(const p of c)h=Math.min(h,p.z);return h}}const mpt=jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ypt}=mpt,_pt=jr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vpt}=_pt,bpt=Dm.VectorTileFeature.types,wpt=Math.cos(Math.PI/180*37.5),n8=Math.pow(2,14)/.5;class cT{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new $t,this.layoutVertexArray2=new Jt,this.indexArray=new Le,this.programConfigurations=new Ki(c.layers,c.zoom),this.segments=new br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,p){this.hasPattern=JE("line",this.layers,h);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),E=[];for(const{feature:I,id:R,index:N,sourceLayerIndex:V}of c){const j=this.layers[0]._featureFilter.needGeometry,tt=tA(I,j);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),tt,p))continue;const rt=x?_.evaluate(tt,{},p):void 0,lt={id:R,properties:I.properties,type:I.type,sourceLayerIndex:V,index:N,geometry:j?tt.geometry:Jh(I),patterns:{},sortKey:rt};E.push(lt)}x&&E.sort((I,R)=>I.sortKey-R.sortKey);for(const I of E){const{geometry:R,index:N,sourceLayerIndex:V}=I;if(this.hasPattern){const j=tT("line",this.layers,I,this.zoom,h);this.patternFeatures.push(j)}else this.addFeature(I,R,N,p,{},h.subdivisionGranularity);h.featureIndex.insert(c[N].feature,R,N,V,this.index)}}update(c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,p)}addFeatures(c,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,vpt)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,ypt),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,h,p,_,x,E){const I=this.layers[0].layout,R=I.get("line-join").evaluate(c,{}),N=I.get("line-cap"),V=I.get("line-miter-limit"),j=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const tt of h)this.addLine(tt,c,R,N,V,j,_,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,x,_)}addLine(c,h,p,_,x,E,I,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,c=Xd(c,I?R.line.getGranularityForZoomLevel(I.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ht=0;Ht<c.length-1;Ht++)this.totalDistance+=c[Ht].dist(c[Ht+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=bpt[h.type]==="Polygon";let V=c.length;for(;V>=2&&c[V-1].equals(c[V-2]);)V--;let j=0;for(;j<V-1&&c[j].equals(c[j+1]);)j++;if(V<(N?3:2))return;p==="bevel"&&(x=1.05);const tt=this.overscaling<=16?15*Wt/(512*this.overscaling):0,rt=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let lt,dt,Pt,Mt,ce;this.e1=this.e2=-1,N&&(lt=c[V-2],ce=c[j].sub(lt)._unit()._perp());for(let Ht=j;Ht<V;Ht++){if(Pt=Ht===V-1?N?c[j+1]:void 0:c[Ht+1],Pt&&c[Ht].equals(Pt))continue;ce&&(Mt=ce),lt&&(dt=lt),lt=c[Ht],ce=Pt?Pt.sub(lt)._unit()._perp():Mt,Mt=Mt||ce;let et=Mt.add(ce);et.x===0&&et.y===0||et._unit();const Et=Mt.x*ce.x+Mt.y*ce.y,Vt=et.x*ce.x+et.y*ce.y,Ee=Vt!==0?1/Vt:1/0,We=2*Math.sqrt(2-2*Vt),Pe=Vt<wpt&&dt&&Pt,Ue=Mt.x*ce.y-Mt.y*ce.x>0;if(Pe&&Ht>j){const dr=lt.dist(dt);if(dr>2*tt){const ke=lt.sub(lt.sub(dt)._mult(tt/dr)._round());this.updateDistance(dt,ke),this.addCurrentVertex(ke,Mt,0,0,rt),dt=ke}}const lr=dt&&Pt;let Ye=lr?p:N?"butt":_;if(lr&&Ye==="round"&&(Ee<E?Ye="miter":Ee<=2&&(Ye="fakeround")),Ye==="miter"&&Ee>x&&(Ye="bevel"),Ye==="bevel"&&(Ee>2&&(Ye="flipbevel"),Ee<x&&(Ye="miter")),dt&&this.updateDistance(dt,lt),Ye==="miter")et._mult(Ee),this.addCurrentVertex(lt,et,0,0,rt);else if(Ye==="flipbevel"){if(Ee>100)et=ce.mult(-1);else{const dr=Ee*Mt.add(ce).mag()/Mt.sub(ce).mag();et._perp()._mult(dr*(Ue?-1:1))}this.addCurrentVertex(lt,et,0,0,rt),this.addCurrentVertex(lt,et.mult(-1),0,0,rt)}else if(Ye==="bevel"||Ye==="fakeround"){const dr=-Math.sqrt(Ee*Ee-1),ke=Ue?dr:0,Dr=Ue?0:dr;if(dt&&this.addCurrentVertex(lt,Mt,ke,Dr,rt),Ye==="fakeround"){const Xr=Math.round(180*We/Math.PI/20);for(let Kr=1;Kr<Xr;Kr++){let zr=Kr/Xr;if(zr!==.5){const rs=zr-.5;zr+=zr*rs*(zr-1)*((1.0904+Et*(Et*(3.55645-1.43519*Et)-3.2452))*rs*rs+(.848013+Et*(.215638*Et-1.06021)))}const Fn=ce.sub(Mt)._mult(zr)._add(Mt)._unit()._mult(Ue?-1:1);this.addHalfVertex(lt,Fn.x,Fn.y,!1,Ue,0,rt)}}Pt&&this.addCurrentVertex(lt,ce,-ke,-Dr,rt)}else if(Ye==="butt")this.addCurrentVertex(lt,et,0,0,rt);else if(Ye==="square"){const dr=dt?1:-1;this.addCurrentVertex(lt,et,dr,dr,rt)}else Ye==="round"&&(dt&&(this.addCurrentVertex(lt,Mt,0,0,rt),this.addCurrentVertex(lt,Mt,1,1,rt,!0)),Pt&&(this.addCurrentVertex(lt,ce,-1,-1,rt,!0),this.addCurrentVertex(lt,ce,0,0,rt)));if(Pe&&Ht<V-1){const dr=lt.dist(Pt);if(dr>2*tt){const ke=lt.add(Pt.sub(lt)._mult(tt/dr)._round());this.updateDistance(lt,ke),this.addCurrentVertex(ke,ce,0,0,rt),lt=ke}}}}addCurrentVertex(c,h,p,_,x){let E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const I=h.y*_-h.x,R=-h.y-h.x*_;this.addHalfVertex(c,h.x+h.y*p,h.y-h.x*p,E,!1,p,x),this.addHalfVertex(c,I,R,E,!0,-_,x),this.distance>n8/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,h,p,_,x,E))}addHalfVertex(c,h,p,_,x,E,I){let{x:R,y:N}=c;const V=.5*(this.lineClips?this.scaledDistance*(n8-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((R<<1)+(_?1:0),(N<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(E===0?0:E<0?-1:1)|(63&V)<<2,V>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,j,this.e2),I.primitiveLength++),x?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,h){this.distance+=c.dist(h),this.updateScaledDistance()}}let i8,s8;Sr("LineBucket",cT,{omit:["layers","patternFeatures"]});var o8={get paint(){return s8=s8||new pn({"line-opacity":new Ge(Bt.paint_line["line-opacity"]),"line-color":new Ge(Bt.paint_line["line-color"]),"line-translate":new we(Bt.paint_line["line-translate"]),"line-translate-anchor":new we(Bt.paint_line["line-translate-anchor"]),"line-width":new Ge(Bt.paint_line["line-width"]),"line-gap-width":new Ge(Bt.paint_line["line-gap-width"]),"line-offset":new Ge(Bt.paint_line["line-offset"]),"line-blur":new Ge(Bt.paint_line["line-blur"]),"line-dasharray":new Jr(Bt.paint_line["line-dasharray"]),"line-pattern":new Tr(Bt.paint_line["line-pattern"]),"line-gradient":new Pr(Bt.paint_line["line-gradient"])})},get layout(){return i8=i8||new pn({"line-cap":new we(Bt.layout_line["line-cap"]),"line-join":new Ge(Bt.layout_line["line-join"]),"line-miter-limit":new we(Bt.layout_line["line-miter-limit"]),"line-round-limit":new we(Bt.layout_line["line-round-limit"]),"line-sort-key":new Ge(Bt.layout_line["line-sort-key"])})}};class xpt extends Ge{possiblyEvaluate(c,h){return h=new be(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(c,h)}evaluate(c,h,p,_){return h=Nt({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(c,h,p,_)}}let y_;class Bpt extends _n{constructor(c){super(c,o8),this.gradientVersion=0,y_||(y_=new xpt(o8.paint.properties["line-width"].specification),y_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Na,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,h){super.recalculate(c,h),this.paint._values["line-floorwidth"]=y_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new cT(c)}queryRadius(c){const h=c,p=a8(Im("line-width",this,h),Im("line-gap-width",this,h)),_=Im("line-offset",this,h);return p/2+Math.abs(_)+A_(this.paint.get("line-translate"))}queryIntersectsFeature(c){let{queryGeometry:h,feature:p,featureState:_,geometry:x,transform:E,pixelsToTileUnits:I}=c;const R=d_(h,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,I),N=I/2*a8(this.paint.get("line-width").evaluate(p,_),this.paint.get("line-gap-width").evaluate(p,_)),V=this.paint.get("line-offset").evaluate(p,_);return V&&(x=function(j,tt){const rt=[];for(let lt=0;lt<j.length;lt++){const dt=j[lt],Pt=[];for(let Mt=0;Mt<dt.length;Mt++){const ce=dt[Mt-1],Ht=dt[Mt],et=dt[Mt+1],Et=Mt===0?new P(0,0):Ht.sub(ce)._unit()._perp(),Vt=Mt===dt.length-1?new P(0,0):et.sub(Ht)._unit()._perp(),Ee=Et._add(Vt)._unit(),We=Ee.x*Vt.x+Ee.y*Vt.y;We!==0&&Ee._mult(1/We),Pt.push(Ee._mult(tt)._add(Ht))}rt.push(Pt)}return rt}(x,V*I)),function(j,tt,rt){for(let lt=0;lt<tt.length;lt++){const dt=tt[lt];if(j.length>=3){for(let Pt=0;Pt<dt.length;Pt++)if(_p(j,dt[Pt]))return!0}if(Sm(j,dt,rt))return!0}return!1}(R,x,N)}isTileClipped(){return!0}}function a8(A,c){return c>0?c+2*A:A}const Cpt=jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ept=jr([{name:"a_projected_pos",components:3,type:"Float32"}],4);jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tpt=jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);jr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const l8=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Spt=jr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ipt(A,c,h){return A.sections.forEach(p=>{p.text=function(_,x,E){const I=x.layout.get("text-transform").evaluate(E,{});return I==="uppercase"?_=_.toLocaleUpperCase():I==="lowercase"&&(_=_.toLocaleLowerCase()),ue.applyArabicShaping&&(_=ue.applyArabicShaping(_)),_}(p.text,c,h)}),A}jr([{name:"triangle",components:3,type:"Uint16"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),jr([{type:"Float32",name:"offsetX"}]),jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),jr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var c8,uT,u8,Ks=24,hT={};function Ppt(){return c8||(c8=1,hT.read=function(A,c,h,p,_){var x,E,I=8*_-p-1,R=(1<<I)-1,N=R>>1,V=-7,j=h?_-1:0,tt=h?-1:1,rt=A[c+j];for(j+=tt,x=rt&(1<<-V)-1,rt>>=-V,V+=I;V>0;x=256*x+A[c+j],j+=tt,V-=8);for(E=x&(1<<-V)-1,x>>=-V,V+=p;V>0;E=256*E+A[c+j],j+=tt,V-=8);if(x===0)x=1-N;else{if(x===R)return E?NaN:1/0*(rt?-1:1);E+=Math.pow(2,p),x-=N}return(rt?-1:1)*E*Math.pow(2,x-p)},hT.write=function(A,c,h,p,_,x){var E,I,R,N=8*x-_-1,V=(1<<N)-1,j=V>>1,tt=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,rt=p?0:x-1,lt=p?1:-1,dt=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(I=isNaN(c)?1:0,E=V):(E=Math.floor(Math.log(c)/Math.LN2),c*(R=Math.pow(2,-E))<1&&(E--,R*=2),(c+=E+j>=1?tt/R:tt*Math.pow(2,1-j))*R>=2&&(E++,R/=2),E+j>=V?(I=0,E=V):E+j>=1?(I=(c*R-1)*Math.pow(2,_),E+=j):(I=c*Math.pow(2,j-1)*Math.pow(2,_),E=0));_>=8;A[h+rt]=255&I,rt+=lt,I/=256,_-=8);for(E=E<<_|I,N+=_;N>0;A[h+rt]=255&E,rt+=lt,E/=256,N-=8);A[h+rt-lt]|=128*dt}),hT}function h8(){if(u8)return uT;u8=1,uT=c;var A=Ppt();function c(et){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(et)?et:new Uint8Array(et||0),this.pos=0,this.type=0,this.length=this.buf.length}c.Varint=0,c.Fixed64=1,c.Bytes=2,c.Fixed32=5;var h=4294967296,p=1/h,_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function x(et){return et.type===c.Bytes?et.readVarint()+et.pos:et.pos+1}function E(et,Et,Vt){return Vt?4294967296*Et+(et>>>0):4294967296*(Et>>>0)+(et>>>0)}function I(et,Et,Vt){var Ee=Et<=16383?1:Et<=2097151?2:Et<=268435455?3:Math.floor(Math.log(Et)/(7*Math.LN2));Vt.realloc(Ee);for(var We=Vt.pos-1;We>=et;We--)Vt.buf[We+Ee]=Vt.buf[We]}function R(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeVarint(et[Vt])}function N(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeSVarint(et[Vt])}function V(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeFloat(et[Vt])}function j(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeDouble(et[Vt])}function tt(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeBoolean(et[Vt])}function rt(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeFixed32(et[Vt])}function lt(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeSFixed32(et[Vt])}function dt(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeFixed64(et[Vt])}function Pt(et,Et){for(var Vt=0;Vt<et.length;Vt++)Et.writeSFixed64(et[Vt])}function Mt(et,Et){return(et[Et]|et[Et+1]<<8|et[Et+2]<<16)+16777216*et[Et+3]}function ce(et,Et,Vt){et[Vt]=Et,et[Vt+1]=Et>>>8,et[Vt+2]=Et>>>16,et[Vt+3]=Et>>>24}function Ht(et,Et){return(et[Et]|et[Et+1]<<8|et[Et+2]<<16)+(et[Et+3]<<24)}return c.prototype={destroy:function(){this.buf=null},readFields:function(et,Et,Vt){for(Vt=Vt||this.length;this.pos<Vt;){var Ee=this.readVarint(),We=Ee>>3,Pe=this.pos;this.type=7&Ee,et(We,Et,this),this.pos===Pe&&this.skip(Ee)}return Et},readMessage:function(et,Et){return this.readFields(et,Et,this.readVarint()+this.pos)},readFixed32:function(){var et=Mt(this.buf,this.pos);return this.pos+=4,et},readSFixed32:function(){var et=Ht(this.buf,this.pos);return this.pos+=4,et},readFixed64:function(){var et=Mt(this.buf,this.pos)+Mt(this.buf,this.pos+4)*h;return this.pos+=8,et},readSFixed64:function(){var et=Mt(this.buf,this.pos)+Ht(this.buf,this.pos+4)*h;return this.pos+=8,et},readFloat:function(){var et=A.read(this.buf,this.pos,!0,23,4);return this.pos+=4,et},readDouble:function(){var et=A.read(this.buf,this.pos,!0,52,8);return this.pos+=8,et},readVarint:function(et){var Et,Vt,Ee=this.buf;return Et=127&(Vt=Ee[this.pos++]),Vt<128?Et:(Et|=(127&(Vt=Ee[this.pos++]))<<7,Vt<128?Et:(Et|=(127&(Vt=Ee[this.pos++]))<<14,Vt<128?Et:(Et|=(127&(Vt=Ee[this.pos++]))<<21,Vt<128?Et:function(We,Pe,Ue){var lr,Ye,dr=Ue.buf;if(lr=(112&(Ye=dr[Ue.pos++]))>>4,Ye<128||(lr|=(127&(Ye=dr[Ue.pos++]))<<3,Ye<128)||(lr|=(127&(Ye=dr[Ue.pos++]))<<10,Ye<128)||(lr|=(127&(Ye=dr[Ue.pos++]))<<17,Ye<128)||(lr|=(127&(Ye=dr[Ue.pos++]))<<24,Ye<128)||(lr|=(1&(Ye=dr[Ue.pos++]))<<31,Ye<128))return E(We,lr,Pe);throw new Error("Expected varint not more than 10 bytes")}(Et|=(15&(Vt=Ee[this.pos]))<<28,et,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var et=this.readVarint();return et%2==1?(et+1)/-2:et/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var et=this.readVarint()+this.pos,Et=this.pos;return this.pos=et,et-Et>=12&&_?function(Vt,Ee,We){return _.decode(Vt.subarray(Ee,We))}(this.buf,Et,et):function(Vt,Ee,We){for(var Pe="",Ue=Ee;Ue<We;){var lr,Ye,dr,ke=Vt[Ue],Dr=null,Xr=ke>239?4:ke>223?3:ke>191?2:1;if(Ue+Xr>We)break;Xr===1?ke<128&&(Dr=ke):Xr===2?(192&(lr=Vt[Ue+1]))==128&&(Dr=(31&ke)<<6|63&lr)<=127&&(Dr=null):Xr===3?(Ye=Vt[Ue+2],(192&(lr=Vt[Ue+1]))==128&&(192&Ye)==128&&((Dr=(15&ke)<<12|(63&lr)<<6|63&Ye)<=2047||Dr>=55296&&Dr<=57343)&&(Dr=null)):Xr===4&&(Ye=Vt[Ue+2],dr=Vt[Ue+3],(192&(lr=Vt[Ue+1]))==128&&(192&Ye)==128&&(192&dr)==128&&((Dr=(15&ke)<<18|(63&lr)<<12|(63&Ye)<<6|63&dr)<=65535||Dr>=1114112)&&(Dr=null)),Dr===null?(Dr=65533,Xr=1):Dr>65535&&(Dr-=65536,Pe+=String.fromCharCode(Dr>>>10&1023|55296),Dr=56320|1023&Dr),Pe+=String.fromCharCode(Dr),Ue+=Xr}return Pe}(this.buf,Et,et)},readBytes:function(){var et=this.readVarint()+this.pos,Et=this.buf.subarray(this.pos,et);return this.pos=et,Et},readPackedVarint:function(et,Et){if(this.type!==c.Bytes)return et.push(this.readVarint(Et));var Vt=x(this);for(et=et||[];this.pos<Vt;)et.push(this.readVarint(Et));return et},readPackedSVarint:function(et){if(this.type!==c.Bytes)return et.push(this.readSVarint());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readSVarint());return et},readPackedBoolean:function(et){if(this.type!==c.Bytes)return et.push(this.readBoolean());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readBoolean());return et},readPackedFloat:function(et){if(this.type!==c.Bytes)return et.push(this.readFloat());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readFloat());return et},readPackedDouble:function(et){if(this.type!==c.Bytes)return et.push(this.readDouble());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readDouble());return et},readPackedFixed32:function(et){if(this.type!==c.Bytes)return et.push(this.readFixed32());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readFixed32());return et},readPackedSFixed32:function(et){if(this.type!==c.Bytes)return et.push(this.readSFixed32());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readSFixed32());return et},readPackedFixed64:function(et){if(this.type!==c.Bytes)return et.push(this.readFixed64());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readFixed64());return et},readPackedSFixed64:function(et){if(this.type!==c.Bytes)return et.push(this.readSFixed64());var Et=x(this);for(et=et||[];this.pos<Et;)et.push(this.readSFixed64());return et},skip:function(et){var Et=7&et;if(Et===c.Varint)for(;this.buf[this.pos++]>127;);else if(Et===c.Bytes)this.pos=this.readVarint()+this.pos;else if(Et===c.Fixed32)this.pos+=4;else{if(Et!==c.Fixed64)throw new Error("Unimplemented type: "+Et);this.pos+=8}},writeTag:function(et,Et){this.writeVarint(et<<3|Et)},realloc:function(et){for(var Et=this.length||16;Et<this.pos+et;)Et*=2;if(Et!==this.length){var Vt=new Uint8Array(Et);Vt.set(this.buf),this.buf=Vt,this.length=Et}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(et){this.realloc(4),ce(this.buf,et,this.pos),this.pos+=4},writeSFixed32:function(et){this.realloc(4),ce(this.buf,et,this.pos),this.pos+=4},writeFixed64:function(et){this.realloc(8),ce(this.buf,-1&et,this.pos),ce(this.buf,Math.floor(et*p),this.pos+4),this.pos+=8},writeSFixed64:function(et){this.realloc(8),ce(this.buf,-1&et,this.pos),ce(this.buf,Math.floor(et*p),this.pos+4),this.pos+=8},writeVarint:function(et){(et=+et||0)>268435455||et<0?function(Et,Vt){var Ee,We;if(Et>=0?(Ee=Et%4294967296|0,We=Et/4294967296|0):(We=~(-Et/4294967296),4294967295^(Ee=~(-Et%4294967296))?Ee=Ee+1|0:(Ee=0,We=We+1|0)),Et>=18446744073709552e3||Et<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Vt.realloc(10),function(Pe,Ue,lr){lr.buf[lr.pos++]=127&Pe|128,Pe>>>=7,lr.buf[lr.pos++]=127&Pe|128,Pe>>>=7,lr.buf[lr.pos++]=127&Pe|128,Pe>>>=7,lr.buf[lr.pos++]=127&Pe|128,lr.buf[lr.pos]=127&(Pe>>>=7)}(Ee,0,Vt),function(Pe,Ue){var lr=(7&Pe)<<4;Ue.buf[Ue.pos++]|=lr|((Pe>>>=3)?128:0),Pe&&(Ue.buf[Ue.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ue.buf[Ue.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ue.buf[Ue.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ue.buf[Ue.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ue.buf[Ue.pos++]=127&Pe)))))}(We,Vt)}(et,this):(this.realloc(4),this.buf[this.pos++]=127&et|(et>127?128:0),et<=127||(this.buf[this.pos++]=127&(et>>>=7)|(et>127?128:0),et<=127||(this.buf[this.pos++]=127&(et>>>=7)|(et>127?128:0),et<=127||(this.buf[this.pos++]=et>>>7&127))))},writeSVarint:function(et){this.writeVarint(et<0?2*-et-1:2*et)},writeBoolean:function(et){this.writeVarint(!!et)},writeString:function(et){et=String(et),this.realloc(4*et.length),this.pos++;var Et=this.pos;this.pos=function(Ee,We,Pe){for(var Ue,lr,Ye=0;Ye<We.length;Ye++){if((Ue=We.charCodeAt(Ye))>55295&&Ue<57344){if(!lr){Ue>56319||Ye+1===We.length?(Ee[Pe++]=239,Ee[Pe++]=191,Ee[Pe++]=189):lr=Ue;continue}if(Ue<56320){Ee[Pe++]=239,Ee[Pe++]=191,Ee[Pe++]=189,lr=Ue;continue}Ue=lr-55296<<10|Ue-56320|65536,lr=null}else lr&&(Ee[Pe++]=239,Ee[Pe++]=191,Ee[Pe++]=189,lr=null);Ue<128?Ee[Pe++]=Ue:(Ue<2048?Ee[Pe++]=Ue>>6|192:(Ue<65536?Ee[Pe++]=Ue>>12|224:(Ee[Pe++]=Ue>>18|240,Ee[Pe++]=Ue>>12&63|128),Ee[Pe++]=Ue>>6&63|128),Ee[Pe++]=63&Ue|128)}return Pe}(this.buf,et,this.pos);var Vt=this.pos-Et;Vt>=128&&I(Et,Vt,this),this.pos=Et-1,this.writeVarint(Vt),this.pos+=Vt},writeFloat:function(et){this.realloc(4),A.write(this.buf,et,this.pos,!0,23,4),this.pos+=4},writeDouble:function(et){this.realloc(8),A.write(this.buf,et,this.pos,!0,52,8),this.pos+=8},writeBytes:function(et){var Et=et.length;this.writeVarint(Et),this.realloc(Et);for(var Vt=0;Vt<Et;Vt++)this.buf[this.pos++]=et[Vt]},writeRawMessage:function(et,Et){this.pos++;var Vt=this.pos;et(Et,this);var Ee=this.pos-Vt;Ee>=128&&I(Vt,Ee,this),this.pos=Vt-1,this.writeVarint(Ee),this.pos+=Ee},writeMessage:function(et,Et,Vt){this.writeTag(et,c.Bytes),this.writeRawMessage(Et,Vt)},writePackedVarint:function(et,Et){Et.length&&this.writeMessage(et,R,Et)},writePackedSVarint:function(et,Et){Et.length&&this.writeMessage(et,N,Et)},writePackedBoolean:function(et,Et){Et.length&&this.writeMessage(et,tt,Et)},writePackedFloat:function(et,Et){Et.length&&this.writeMessage(et,V,Et)},writePackedDouble:function(et,Et){Et.length&&this.writeMessage(et,j,Et)},writePackedFixed32:function(et,Et){Et.length&&this.writeMessage(et,rt,Et)},writePackedSFixed32:function(et,Et){Et.length&&this.writeMessage(et,lt,Et)},writePackedFixed64:function(et,Et){Et.length&&this.writeMessage(et,dt,Et)},writePackedSFixed64:function(et,Et){Et.length&&this.writeMessage(et,Pt,Et)},writeBytesField:function(et,Et){this.writeTag(et,c.Bytes),this.writeBytes(Et)},writeFixed32Field:function(et,Et){this.writeTag(et,c.Fixed32),this.writeFixed32(Et)},writeSFixed32Field:function(et,Et){this.writeTag(et,c.Fixed32),this.writeSFixed32(Et)},writeFixed64Field:function(et,Et){this.writeTag(et,c.Fixed64),this.writeFixed64(Et)},writeSFixed64Field:function(et,Et){this.writeTag(et,c.Fixed64),this.writeSFixed64(Et)},writeVarintField:function(et,Et){this.writeTag(et,c.Varint),this.writeVarint(Et)},writeSVarintField:function(et,Et){this.writeTag(et,c.Varint),this.writeSVarint(Et)},writeStringField:function(et,Et){this.writeTag(et,c.Bytes),this.writeString(Et)},writeFloatField:function(et,Et){this.writeTag(et,c.Fixed32),this.writeFloat(Et)},writeDoubleField:function(et,Et){this.writeTag(et,c.Fixed64),this.writeDouble(Et)},writeBooleanField:function(et,Et){this.writeVarintField(et,!!Et)}},uT}var AT=d(h8());const dT=3;function Mpt(A,c,h){A===1&&h.readMessage(Fpt,c)}function Fpt(A,c,h){if(A===3){const{id:p,bitmap:_,width:x,height:E,left:I,top:R,advance:N}=h.readMessage(Lpt,{});c.push({id:p,bitmap:new Pm({width:x+2*dT,height:E+2*dT},_),metrics:{width:x,height:E,left:I,top:R,advance:N}})}}function Lpt(A,c,h){A===1?c.id=h.readVarint():A===2?c.bitmap=h.readBytes():A===3?c.width=h.readVarint():A===4?c.height=h.readVarint():A===5?c.left=h.readSVarint():A===6?c.top=h.readSVarint():A===7&&(c.advance=h.readVarint())}const Rpt=dT;function A8(A){let c=0,h=0;for(const E of A)c+=E.w*E.h,h=Math.max(h,E.w);A.sort((E,I)=>I.h-E.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),h),h:1/0}];let _=0,x=0;for(const E of A)for(let I=p.length-1;I>=0;I--){const R=p[I];if(!(E.w>R.w||E.h>R.h)){if(E.x=R.x,E.y=R.y,x=Math.max(x,E.y+E.h),_=Math.max(_,E.x+E.w),E.w===R.w&&E.h===R.h){const N=p.pop();I<p.length&&(p[I]=N)}else E.h===R.h?(R.x+=E.w,R.w-=E.w):E.w===R.w?(R.y+=E.h,R.h-=E.h):(p.push({x:R.x+E.w,y:R.y,w:R.w-E.w,h:E.h}),R.y+=E.h,R.h-=E.h);break}}return{w:_,h:x,fill:c/(_*x)||0}}const ja=1;class fT{constructor(c,h){let{pixelRatio:p,version:_,stretchX:x,stretchY:E,content:I,textFitWidth:R,textFitHeight:N}=h;this.paddedRect=c,this.pixelRatio=p,this.stretchX=x,this.stretchY=E,this.content=I,this.version=_,this.textFitWidth=R,this.textFitHeight=N}get tl(){return[this.paddedRect.x+ja,this.paddedRect.y+ja]}get br(){return[this.paddedRect.x+this.paddedRect.w-ja,this.paddedRect.y+this.paddedRect.h-ja]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ja)/this.pixelRatio,(this.paddedRect.h-2*ja)/this.pixelRatio]}}class d8{constructor(c,h){const p={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(c,p,x),this.addImages(h,_,x);const{w:E,h:I}=A8(x),R=new zl({width:E||1,height:I||1});for(const N in c){const V=c[N],j=p[N].paddedRect;zl.copy(V.data,R,{x:0,y:0},{x:j.x+ja,y:j.y+ja},V.data)}for(const N in h){const V=h[N],j=_[N].paddedRect,tt=j.x+ja,rt=j.y+ja,lt=V.data.width,dt=V.data.height;zl.copy(V.data,R,{x:0,y:0},{x:tt,y:rt},V.data),zl.copy(V.data,R,{x:0,y:dt-1},{x:tt,y:rt-1},{width:lt,height:1}),zl.copy(V.data,R,{x:0,y:0},{x:tt,y:rt+dt},{width:lt,height:1}),zl.copy(V.data,R,{x:lt-1,y:0},{x:tt-1,y:rt},{width:1,height:dt}),zl.copy(V.data,R,{x:0,y:0},{x:tt+lt,y:rt},{width:1,height:dt})}this.image=R,this.iconPositions=p,this.patternPositions=_}addImages(c,h,p){for(const _ in c){const x=c[_],E={x:0,y:0,w:x.data.width+2*ja,h:x.data.height+2*ja};p.push(E),h[_]=new fT(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(c,h){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in c.updatedImages)this.patchUpdatedImage(this.iconPositions[p],c.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],c.getImage(p),h)}patchUpdatedImage(c,h,p){if(!c||!h||c.version===h.version)return;c.version=h.version;const[_,x]=c.tl;p.update(h.data,void 0,{x:_,y:x})}}var qA;Sr("ImagePosition",fT),Sr("ImageAtlas",d8),a.ai=void 0,(qA=a.ai||(a.ai={}))[qA.none=0]="none",qA[qA.horizontal=1]="horizontal",qA[qA.vertical=2]="vertical",qA[qA.horizontalOnly=3]="horizontalOnly";const __=-17;class zm{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(c,h,p){const _=new zm;return _.scale=c||1,_.fontStack=h,_.verticalAlign=p||"bottom",_}static forImage(c,h){const p=new zm;return p.imageName=c,p.verticalAlign=h||"bottom",p}}class xp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,h){const p=new xp;for(let _=0;_<c.sections.length;_++){const x=c.sections[_];x.image?p.addImageSection(x):p.addTextSection(x,h)}return p}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let h="";for(let p=0;p<c.length;p++){const _=c.charCodeAt(p+1)||null,x=c.charCodeAt(p-1)||null;h+=_&&mt(_)&&!Qm[c[p+1]]||x&&mt(x)&&!Qm[c[p-1]]||!Qm[c[p]]?c[p]:Qm[c[p]]}return h}(this.text)}trim(){let c=0;for(let p=0;p<this.text.length&&b_[this.text.charCodeAt(p)];p++)c++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=c&&b_[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(c,h),this.sectionIndex=this.sectionIndex.slice(c,h)}substring(c,h){const p=new xp;return p.text=this.text.substring(c,h),p.sectionIndex=this.sectionIndex.slice(c,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,h)=>Math.max(c,this.sections[h].scale),0)}getMaxImageSize(c){let h=0,p=0;for(let _=0;_<this.length();_++){const x=this.getSection(_);if(x.imageName){const E=c[x.imageName];if(!E)continue;const I=E.displaySize;h=Math.max(h,I[0]),p=Math.max(p,I[1])}}return{maxImageWidth:h,maxImageHeight:p}}addTextSection(c,h){this.text+=c.text,this.sections.push(zm.forText(c.scale,c.fontStack||h,c.verticalAlign));const p=this.sections.length-1;for(let _=0;_<c.text.length;++_)this.sectionIndex.push(p)}addImageSection(c){const h=c.image?c.image.name:"";if(h.length===0)return void Ve("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(zm.forImage(h,c.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function v_(A,c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt){const dt=xp.fromFeature(A,_);let Pt;j===a.ai.vertical&&dt.verticalizePunctuation();const{processBidirectionalText:Mt,processStyledBidirectionalText:ce}=ue;if(Mt&&dt.sections.length===1){Pt=[];const Et=Mt(dt.toString(),pT(dt,N,x,c,p,rt));for(const Vt of Et){const Ee=new xp;Ee.text=Vt,Ee.sections=dt.sections;for(let We=0;We<Vt.length;We++)Ee.sectionIndex.push(0);Pt.push(Ee)}}else if(ce){Pt=[];const Et=ce(dt.text,dt.sectionIndex,pT(dt,N,x,c,p,rt));for(const Vt of Et){const Ee=new xp;Ee.text=Vt[0],Ee.sectionIndex=Vt[1],Ee.sections=dt.sections,Pt.push(Ee)}}else Pt=function(Et,Vt){const Ee=[],We=Et.text;let Pe=0;for(const Ue of Vt)Ee.push(Et.substring(Pe,Ue)),Pe=Ue;return Pe<We.length&&Ee.push(Et.substring(Pe,We.length)),Ee}(dt,pT(dt,N,x,c,p,rt));const Ht=[],et={positionedLines:Ht,text:dt.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Et,Vt,Ee,We,Pe,Ue,lr,Ye,dr,ke,Dr,Xr){let Kr=0,zr=0,Fn=0,rs=0;const Es=Ye==="right"?1:Ye==="left"?0:.5,Ca=Ks/Xr;let qa=0;for(const ls of Pe){ls.trim();const Ws=ls.getMaxScale(),bo={positionedGlyphs:[],lineOffset:0};Et.positionedLines[qa]=bo;const Ts=bo.positionedGlyphs;let Ea=0;if(!ls.length()){zr+=Ue,++qa;continue}const Vl=Npt(We,ls,Ca);for(let Wa=0;Wa<ls.length();Wa++){const $s=ls.getSection(Wa),ao=ls.getSectionIndex(Wa),lo=ls.getCharCode(Wa),Ss=kpt(dr,Dr,lo);let Ri;if($s.imageName){if(Et.iconsInText=!0,$s.scale=$s.scale*Ca,Ri=zpt($s,Ss,Ws,Vl,We),!Ri)continue;Ea=Math.max(Ea,Ri.imageOffset)}else if(Ri=Qpt($s,lo,Ss,Vl,Vt,Ee),!Ri)continue;const{rect:xu,metrics:Tp,baselineOffset:Bu}=Ri;Ts.push({glyph:lo,imageName:$s.imageName,x:Kr,y:zr+Bu+__,vertical:Ss,scale:$s.scale,fontStack:$s.fontStack,sectionIndex:ao,metrics:Tp,rect:xu}),Ss?(Et.verticalizable=!0,Kr+=($s.imageName?Tp.advance:Ks)*$s.scale+ke):Kr+=Tp.advance*$s.scale+ke}Ts.length!==0&&(Fn=Math.max(Kr-ke,Fn),Hpt(Ts,0,Ts.length-1,Es)),Kr=0,bo.lineOffset=Math.max(Ea,(Ws-1)*Ks);const oo=Ue*Ws+Ea;zr+=oo,rs=Math.max(oo,rs),++qa}const{horizontalAlign:Ka,verticalAlign:vo}=gT(lr);(function(ls,Ws,bo,Ts,Ea,Vl,oo,Wa,$s){const ao=(Ws-bo)*Ea;let lo=0;lo=Vl!==oo?-Wa*Ts-__:-Ts*$s*oo+.5*oo;for(const Ss of ls)for(const Ri of Ss.positionedGlyphs)Ri.x+=ao,Ri.y+=lo})(Et.positionedLines,Es,Ka,vo,Fn,rs,Ue,zr,Pe.length),Et.top+=-vo*zr,Et.bottom=Et.top+zr,Et.left+=-Ka*Fn,Et.right=Et.left+Fn}(et,c,h,p,Pt,E,I,R,j,N,tt,lt),!function(Et){for(const Vt of Et)if(Vt.positionedGlyphs.length!==0)return!1;return!0}(Ht)&&et}const b_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Opt={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Upt={40:!0};function f8(A,c,h,p,_,x){if(c.imageName){const E=p[c.imageName];return E?E.displaySize[0]*c.scale*Ks/x+_:0}{const E=h[c.fontStack],I=E&&E[A];return I?I.metrics.advance*c.scale+_:0}}function p8(A,c,h,p){const _=Math.pow(A-c,2);return p?A<c?_/2:2*_:_+Math.abs(h)*h}function Dpt(A,c,h){let p=0;return A===10&&(p-=1e4),h&&(p+=150),A!==40&&A!==65288||(p+=50),c!==41&&c!==65289||(p+=50),p}function g8(A,c,h,p,_,x){let E=null,I=p8(c,h,_,x);for(const R of p){const N=p8(c-R.x,h,_,x)+R.badness;N<=I&&(E=R,I=N)}return{index:A,x:c,priorBreak:E,badness:I}}function m8(A){return A?m8(A.priorBreak).concat(A.index):[]}function pT(A,c,h,p,_,x){if(!A)return[];const E=[],I=function(j,tt,rt,lt,dt,Pt){let Mt=0;for(let ce=0;ce<j.length();ce++){const Ht=j.getSection(ce);Mt+=f8(j.getCharCode(ce),Ht,lt,dt,tt,Pt)}return Mt/Math.max(1,Math.ceil(Mt/rt))}(A,c,h,p,_,x),R=A.text.indexOf("​")>=0;let N=0;for(let j=0;j<A.length();j++){const tt=A.getSection(j),rt=A.getCharCode(j);if(b_[rt]||(N+=f8(rt,tt,p,_,c,x)),j<A.length()-1){const lt=!((V=rt)<11904)&&(!!Cn["CJK Compatibility Forms"](V)||!!Cn["CJK Compatibility"](V)||!!Cn["CJK Strokes"](V)||!!Cn["CJK Symbols and Punctuation"](V)||!!Cn["Enclosed CJK Letters and Months"](V)||!!Cn["Halfwidth and Fullwidth Forms"](V)||!!Cn["Ideographic Description Characters"](V)||!!Cn["Vertical Forms"](V)||W.test(String.fromCodePoint(V)));(Opt[rt]||lt||tt.imageName||j!==A.length()-2&&Upt[A.getCharCode(j+1)])&&E.push(g8(j+1,N,I,E,Dpt(rt,A.getCharCode(j+1),lt&&R),!1))}}var V;return m8(g8(A.length(),N,I,E,0,!0))}function gT(A){let c=.5,h=.5;switch(A){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(A){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:c,verticalAlign:h}}function Npt(A,c,h){const p=c.getMaxScale()*Ks,{maxImageWidth:_,maxImageHeight:x}=c.getMaxImageSize(A),E=Math.max(p,x*h);return{verticalLineContentWidth:Math.max(p,_*h),horizontalLineContentHeight:E}}function y8(A){switch(A){case"top":return 0;case"center":return .5;default:return 1}}function kpt(A,c,h){return!(A===a.ai.horizontal||!c&&!ut(h)||c&&(b_[h]||(p=h,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function Qpt(A,c,h,p,_,x){const E=x[A.fontStack],I=function(N,V,j,tt){if(N&&N.rect)return N;const rt=V[j.fontStack],lt=rt&&rt[tt];return lt?{rect:null,metrics:lt.metrics}:null}(E&&E[c],_,A,c);if(I===null)return null;let R;if(h)R=p.verticalLineContentWidth-A.scale*Ks;else{const N=y8(A.verticalAlign);R=(p.horizontalLineContentHeight-A.scale*Ks)*N}return{rect:I.rect,metrics:I.metrics,baselineOffset:R}}function zpt(A,c,h,p,_){const x=_[A.imageName];if(!x)return null;const E=x.paddedRect,I=x.displaySize,R={width:I[0],height:I[1],left:ja,top:-3,advance:c?I[1]:I[0]};let N;if(c)N=p.verticalLineContentWidth-I[1]*A.scale;else{const V=y8(A.verticalAlign);N=(p.horizontalLineContentHeight-I[1]*A.scale)*V}return{rect:E,metrics:R,baselineOffset:N,imageOffset:(c?I[0]:I[1])*A.scale-Ks*h}}function Hpt(A,c,h,p){if(p===0)return;const _=A[h],x=(A[h].x+_.metrics.advance*_.scale)*p;for(let E=c;E<=h;E++)A[E].x-=x}function Vpt(A,c,h){const{horizontalAlign:p,verticalAlign:_}=gT(h),x=c[0]-A.displaySize[0]*p,E=c[1]-A.displaySize[1]*_;return{image:A,top:E,bottom:E+A.displaySize[1],left:x,right:x+A.displaySize[0]}}function _8(A){var c,h;let p=A.left,_=A.top,x=A.right-p,E=A.bottom-_;const I=(c=A.image.textFitWidth)!==null&&c!==void 0?c:"stretchOrShrink",R=(h=A.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",N=(A.image.content[2]-A.image.content[0])/(A.image.content[3]-A.image.content[1]);if(R==="proportional"){if(I==="stretchOnly"&&x/E<N||I==="proportional"){const V=Math.ceil(E*N);p*=V/x,x=V}}else if(I==="proportional"&&R==="stretchOnly"&&N!==0&&x/E>N){const V=Math.ceil(x/N);_*=V/E,E=V}return{x1:p,y1:_,x2:p+x,y2:_+E}}function v8(A,c,h,p,_,x){const E=A.image;let I;if(E.content){const Pt=E.content,Mt=E.pixelRatio||1;I=[Pt[0]/Mt,Pt[1]/Mt,E.displaySize[0]-Pt[2]/Mt,E.displaySize[1]-Pt[3]/Mt]}const R=c.left*x,N=c.right*x;let V,j,tt,rt;h==="width"||h==="both"?(rt=_[0]+R-p[3],j=_[0]+N+p[1]):(rt=_[0]+(R+N-E.displaySize[0])/2,j=rt+E.displaySize[0]);const lt=c.top*x,dt=c.bottom*x;return h==="height"||h==="both"?(V=_[1]+lt-p[0],tt=_[1]+dt+p[2]):(V=_[1]+(lt+dt-E.displaySize[1])/2,tt=V+E.displaySize[1]),{image:E,top:V,right:j,bottom:tt,left:rt,collisionPadding:I}}const Hm=255,ch=128,KA=Hm*ch;function b8(A,c){const{expression:h}=c;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new be(A+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let x=0;for(;x<p.length&&p[x]<=A;)x++;x=Math.max(0,x-1);let E=x;for(;E<p.length&&p[E]<A+1;)E++;E=Math.min(p.length-1,E);const I=p[x],R=p[E];return h.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:R,minSize:h.evaluate(new be(I)),maxSize:h.evaluate(new be(R)),interpolationType:_}}}function mT(A,c,h){let p="never";const _=A.get(c);return _?p=_:A.get(h)&&(p="always"),p}const Gpt=Dm.VectorTileFeature.types,jpt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function w_(A,c,h,p,_,x,E,I,R,N,V,j,tt){const rt=I?Math.min(KA,Math.round(I[0])):0,lt=I?Math.min(KA,Math.round(I[1])):0;A.emplaceBack(c,h,Math.round(32*p),Math.round(32*_),x,E,(rt<<1)+(R?1:0),lt,16*N,16*V,256*j,256*tt)}function yT(A,c,h){A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h)}function qpt(A){for(const c of A.sections)if(Ut(c.text))return!0;return!1}class _T{constructor(c){this.layoutVertexArray=new se,this.indexArray=new Le,this.programConfigurations=c,this.segments=new br,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Ce,this.hasVisibleVertices=!1,this.placedSymbolArray=new L}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,h,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Cpt.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Ept.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,jpt,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Sr("SymbolBuffers",_T);class vT{constructor(c,h,p){this.layoutVertexArray=new c,this.layoutAttributes=h,this.indexArray=new p,this.segments=new br,this.collisionVertexArray=new ze}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Tpt.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Sr("CollisionBuffers",vT);class Bp{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(E=>E.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=b8(this.zoom,h["text-size"]),this.iconSizeData=b8(this.zoom,h["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.canOverlap=mT(p,"text-overlap","text-allow-overlap")!=="never"||mT(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(E=>a.ai[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=c.sourceID}createArrays(){this.text=new _T(new Ki(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new _T(new Ki(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new q,this.lineVertexArray=new Z,this.symbolInstances=new Q,this.textAnchorOffsets=new At}calculateGlyphDependencies(c,h,p,_,x){for(let E=0;E<c.length;E++)if(h[c.charCodeAt(E)]=!0,(p||_)&&x){const I=Qm[c.charAt(E)];I&&(h[I.charCodeAt(0)]=!0)}}populate(c,h,p){const _=this.layers[0],x=_.layout,E=x.get("text-font"),I=x.get("text-field"),R=x.get("icon-image"),N=(I.value.kind!=="constant"||I.value.value instanceof It&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),V=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,j=x.get("symbol-sort-key");if(this.features=[],!N&&!V)return;const tt=h.iconDependencies,rt=h.glyphDependencies,lt=h.availableImages,dt=new be(this.zoom);for(const{feature:Pt,id:Mt,index:ce,sourceLayerIndex:Ht}of c){const et=_._featureFilter.needGeometry,Et=tA(Pt,et);if(!_._featureFilter.filter(dt,Et,p))continue;let Vt,Ee;if(et||(Et.geometry=Jh(Pt)),N){const Pe=_.getValueAndResolveTokens("text-field",Et,p,lt),Ue=It.factory(Pe),lr=this.hasRTLText=this.hasRTLText||qpt(Ue);(!lr||ue.getRTLTextPluginStatus()==="unavailable"||lr&&ue.isParsed())&&(Vt=Ipt(Ue,_,Et))}if(V){const Pe=_.getValueAndResolveTokens("icon-image",Et,p,lt);Ee=Pe instanceof Gr?Pe:Gr.fromString(Pe)}if(!Vt&&!Ee)continue;const We=this.sortFeaturesByKey?j.evaluate(Et,{},p):void 0;if(this.features.push({id:Mt,text:Vt,icon:Ee,index:ce,sourceLayerIndex:Ht,geometry:Et.geometry,properties:Pt.properties,type:Gpt[Pt.type],sortKey:We}),Ee&&(tt[Ee.name]=!0),Vt){const Pe=E.evaluate(Et,{},p).join(","),Ue=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const lr of Vt.sections)if(lr.image)tt[lr.image.name]=!0;else{const Ye=ah(Vt.toString()),dr=lr.fontStack||Pe,ke=rt[dr]=rt[dr]||{};this.calculateGlyphDependencies(lr.text,ke,Ue,this.allowVerticalPlacement,Ye)}}}x.get("symbol-placement")==="line"&&(this.features=function(Pt){const Mt={},ce={},Ht=[];let et=0;function Et(Pe){Ht.push(Pt[Pe]),et++}function Vt(Pe,Ue,lr){const Ye=ce[Pe];return delete ce[Pe],ce[Ue]=Ye,Ht[Ye].geometry[0].pop(),Ht[Ye].geometry[0]=Ht[Ye].geometry[0].concat(lr[0]),Ye}function Ee(Pe,Ue,lr){const Ye=Mt[Ue];return delete Mt[Ue],Mt[Pe]=Ye,Ht[Ye].geometry[0].shift(),Ht[Ye].geometry[0]=lr[0].concat(Ht[Ye].geometry[0]),Ye}function We(Pe,Ue,lr){const Ye=lr?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Pe}:${Ye.x}:${Ye.y}`}for(let Pe=0;Pe<Pt.length;Pe++){const Ue=Pt[Pe],lr=Ue.geometry,Ye=Ue.text?Ue.text.toString():null;if(!Ye){Et(Pe);continue}const dr=We(Ye,lr),ke=We(Ye,lr,!0);if(dr in ce&&ke in Mt&&ce[dr]!==Mt[ke]){const Dr=Ee(dr,ke,lr),Xr=Vt(dr,ke,Ht[Dr].geometry);delete Mt[dr],delete ce[ke],ce[We(Ye,Ht[Xr].geometry,!0)]=Xr,Ht[Dr].geometry=null}else dr in ce?Vt(dr,ke,lr):ke in Mt?Ee(dr,ke,lr):(Et(Pe),Mt[dr]=et-1,ce[ke]=et-1)}return Ht.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Pt,Mt)=>Pt.sortKey-Mt.sortKey)}update(c,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(c,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,h){const p=this.lineVertexArray.length;if(c.segment!==void 0){let _=c.dist(h[c.segment+1]),x=c.dist(h[c.segment]);const E={};for(let I=c.segment+1;I<h.length;I++)E[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:_},I<h.length-1&&(_+=h[I+1].dist(h[I]));for(let I=c.segment||0;I>=0;I--)E[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:x},I>0&&(x+=h[I-1].dist(h[I]));for(let I=0;I<h.length;I++){const R=E[I];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(c,h,p,_,x,E,I,R,N,V,j,tt){const rt=c.indexArray,lt=c.layoutVertexArray,dt=c.segments.prepareSegment(4*h.length,lt,rt,this.canOverlap?E.sortKey:void 0),Pt=this.glyphOffsetArray.length,Mt=dt.vertexLength,ce=this.allowVerticalPlacement&&I===a.ai.vertical?Math.PI/2:0,Ht=E.text&&E.text.sections;for(let et=0;et<h.length;et++){const{tl:Et,tr:Vt,bl:Ee,br:We,tex:Pe,pixelOffsetTL:Ue,pixelOffsetBR:lr,minFontScaleX:Ye,minFontScaleY:dr,glyphOffset:ke,isSDF:Dr,sectionIndex:Xr}=h[et],Kr=dt.vertexLength,zr=ke[1];w_(lt,R.x,R.y,Et.x,zr+Et.y,Pe.x,Pe.y,p,Dr,Ue.x,Ue.y,Ye,dr),w_(lt,R.x,R.y,Vt.x,zr+Vt.y,Pe.x+Pe.w,Pe.y,p,Dr,lr.x,Ue.y,Ye,dr),w_(lt,R.x,R.y,Ee.x,zr+Ee.y,Pe.x,Pe.y+Pe.h,p,Dr,Ue.x,lr.y,Ye,dr),w_(lt,R.x,R.y,We.x,zr+We.y,Pe.x+Pe.w,Pe.y+Pe.h,p,Dr,lr.x,lr.y,Ye,dr),yT(c.dynamicLayoutVertexArray,R,ce),rt.emplaceBack(Kr,Kr+2,Kr+1),rt.emplaceBack(Kr+1,Kr+2,Kr+3),dt.vertexLength+=4,dt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),et!==h.length-1&&Xr===h[et+1].sectionIndex||c.programConfigurations.populatePaintArrays(lt.length,E,E.index,{},tt,Ht&&Ht[Xr])}c.placedSymbolArray.emplaceBack(R.x,R.y,Pt,this.glyphOffsetArray.length-Pt,Mt,N,V,R.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],I,0,!1,0,j)}_addCollisionDebugVertex(c,h,p,_,x,E){return h.emplaceBack(0,0),c.emplaceBack(p.x,p.y,_,x,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(c,h,p,_,x,E,I){const R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),N=R.vertexLength,V=x.layoutVertexArray,j=x.collisionVertexArray,tt=I.anchorX,rt=I.anchorY;this._addCollisionDebugVertex(V,j,E,tt,rt,new P(c,h)),this._addCollisionDebugVertex(V,j,E,tt,rt,new P(p,h)),this._addCollisionDebugVertex(V,j,E,tt,rt,new P(p,_)),this._addCollisionDebugVertex(V,j,E,tt,rt,new P(c,_)),R.vertexLength+=4;const lt=x.indexArray;lt.emplaceBack(N,N+1),lt.emplaceBack(N+1,N+2),lt.emplaceBack(N+2,N+3),lt.emplaceBack(N+3,N),R.primitiveLength+=4}addDebugCollisionBoxes(c,h,p,_){for(let x=c;x<h;x++){const E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,_?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vT(Oe,l8.members,fr),this.iconCollisionBox=new vT(Oe,l8.members,fr);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(c,h,p,_,x,E,I,R,N){const V={};for(let j=h;j<p;j++){const tt=c.get(j);V.textBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},V.textFeatureIndex=tt.featureIndex;break}for(let j=_;j<x;j++){const tt=c.get(j);V.verticalTextBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},V.verticalTextFeatureIndex=tt.featureIndex;break}for(let j=E;j<I;j++){const tt=c.get(j);V.iconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},V.iconFeatureIndex=tt.featureIndex;break}for(let j=R;j<N;j++){const tt=c.get(j);V.verticalIconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},V.verticalIconFeatureIndex=tt.featureIndex;break}return V}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,h){const p=c.placedSymbolArray.get(h),_=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<_;x+=4)c.indexArray.emplaceBack(x,x+2,x+1),c.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(c),p=Math.cos(c),_=[],x=[],E=[];for(let I=0;I<this.symbolInstances.length;++I){E.push(I);const R=this.symbolInstances.get(I);_.push(0|Math.round(h*R.anchorX+p*R.anchorY)),x.push(R.featureIndex)}return E.sort((I,R)=>_[I]-_[R]||x[R]-x[I]),E}addToSortKeyRanges(c,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,x,E)=>{_>=0&&E.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let w8,x8;Sr("SymbolBucket",Bp,{omit:["layers","collisionBoxArray","features","compareText"]}),Bp.MAX_GLYPHS=65535,Bp.addDynamicAttributes=yT;var bT={get paint(){return x8=x8||new pn({"icon-opacity":new Ge(Bt.paint_symbol["icon-opacity"]),"icon-color":new Ge(Bt.paint_symbol["icon-color"]),"icon-halo-color":new Ge(Bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ge(Bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ge(Bt.paint_symbol["icon-halo-blur"]),"icon-translate":new we(Bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new we(Bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ge(Bt.paint_symbol["text-opacity"]),"text-color":new Ge(Bt.paint_symbol["text-color"],{runtimeType:Fr,getOverride:A=>A.textColor,hasOverride:A=>!!A.textColor}),"text-halo-color":new Ge(Bt.paint_symbol["text-halo-color"]),"text-halo-width":new Ge(Bt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ge(Bt.paint_symbol["text-halo-blur"]),"text-translate":new we(Bt.paint_symbol["text-translate"]),"text-translate-anchor":new we(Bt.paint_symbol["text-translate-anchor"])})},get layout(){return w8=w8||new pn({"symbol-placement":new we(Bt.layout_symbol["symbol-placement"]),"symbol-spacing":new we(Bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new we(Bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ge(Bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new we(Bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new we(Bt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new we(Bt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new we(Bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new we(Bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new we(Bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ge(Bt.layout_symbol["icon-size"]),"icon-text-fit":new we(Bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new we(Bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ge(Bt.layout_symbol["icon-image"]),"icon-rotate":new Ge(Bt.layout_symbol["icon-rotate"]),"icon-padding":new Ge(Bt.layout_symbol["icon-padding"]),"icon-keep-upright":new we(Bt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ge(Bt.layout_symbol["icon-offset"]),"icon-anchor":new Ge(Bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new we(Bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new we(Bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new we(Bt.layout_symbol["text-rotation-alignment"]),"text-field":new Ge(Bt.layout_symbol["text-field"]),"text-font":new Ge(Bt.layout_symbol["text-font"]),"text-size":new Ge(Bt.layout_symbol["text-size"]),"text-max-width":new Ge(Bt.layout_symbol["text-max-width"]),"text-line-height":new we(Bt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ge(Bt.layout_symbol["text-letter-spacing"]),"text-justify":new Ge(Bt.layout_symbol["text-justify"]),"text-radial-offset":new Ge(Bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new we(Bt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ge(Bt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ge(Bt.layout_symbol["text-anchor"]),"text-max-angle":new we(Bt.layout_symbol["text-max-angle"]),"text-writing-mode":new we(Bt.layout_symbol["text-writing-mode"]),"text-rotate":new Ge(Bt.layout_symbol["text-rotate"]),"text-padding":new we(Bt.layout_symbol["text-padding"]),"text-keep-upright":new we(Bt.layout_symbol["text-keep-upright"]),"text-transform":new Ge(Bt.layout_symbol["text-transform"]),"text-offset":new Ge(Bt.layout_symbol["text-offset"]),"text-allow-overlap":new we(Bt.layout_symbol["text-allow-overlap"]),"text-overlap":new we(Bt.layout_symbol["text-overlap"]),"text-ignore-placement":new we(Bt.layout_symbol["text-ignore-placement"]),"text-optional":new we(Bt.layout_symbol["text-optional"])})}};class B8{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Mr,this.defaultValue=c}evaluate(c){if(c.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(c.formattedSection))return h.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sr("FormatSectionOverride",B8,{omit:["defaultValue"]});class x_ extends _n{constructor(c){super(c,bT)}recalculate(c,h){if(super.recalculate(c,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const x of p)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,h,p,_){const x=this.layout.get(c).evaluate(h,{},p,_),E=this._unevaluatedLayout._values[c];return E.isDataDriven()||Dl(E.value)||!x?x:function(I,R){return R.replace(/{([^{}]+)}/g,(N,V)=>I&&V in I?String(I[V]):"")}(h.properties,x)}createBucket(c){return new Bp(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of bT.paint.overridableProperties){if(!x_.hasPaintOverride(this.layout,c))continue;const h=this.paint.get(c),p=new B8(h),_=new dc(p,h.property.specification);let x=null;x=h.value.kind==="constant"||h.value.kind==="source"?new fc("source",_):new pu("composite",_,h.value.zoomStops),this.paint._values[c]=new je(h.property,x,h.parameters)}}_handleOverridablePaintPropertyUpdate(c,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&x_.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,h){const p=c.get("text-field"),_=bT.paint.properties[h];let x=!1;const E=I=>{for(const R of I)if(_.overrides&&_.overrides.hasOverride(R))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof It)E(p.value.value.sections);else if(p.value.kind==="source"){const I=N=>{x||(N instanceof Ko&&nn(N.value)===Ai?E(N.value.sections):N instanceof Sl?E(N.sections):N.eachChild(I))},R=p.value;R._styleExpression&&I(R._styleExpression.expression)}return x}}let C8;var Kpt={get paint(){return C8=C8||new pn({"background-color":new we(Bt.paint_background["background-color"]),"background-pattern":new Jr(Bt.paint_background["background-pattern"]),"background-opacity":new we(Bt.paint_background["background-opacity"])})}};class Wpt extends _n{constructor(c){super(c,Kpt)}}let E8;var $pt={get paint(){return E8=E8||new pn({"raster-opacity":new we(Bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new we(Bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new we(Bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new we(Bt.paint_raster["raster-brightness-max"]),"raster-saturation":new we(Bt.paint_raster["raster-saturation"]),"raster-contrast":new we(Bt.paint_raster["raster-contrast"]),"raster-resampling":new we(Bt.paint_raster["raster-resampling"]),"raster-fade-duration":new we(Bt.paint_raster["raster-fade-duration"])})}};class Xpt extends _n{constructor(c){super(c,$pt)}}class Zpt extends _n{constructor(c){super(c,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ypt{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const wT=63710088e-1;class WA{constructor(c,h){if(isNaN(c)||isNaN(h))throw new Error(`Invalid LngLat object: (${c}, ${h})`);if(this.lng=+c,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new WA(Rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const h=Math.PI/180,p=this.lat*h,_=c.lat*h,x=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((c.lng-this.lng)*h);return wT*Math.acos(Math.min(x,1))}static convert(c){if(c instanceof WA)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new WA(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new WA(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const T8=2*Math.PI*wT;function S8(A){return T8*Math.cos(A*Math.PI/180)}function I8(A){return(180+A)/360}function P8(A){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A*Math.PI/360)))/360}function M8(A,c){return A/S8(c)}function xT(A){return 360/Math.PI*Math.atan(Math.exp((180-360*A)*Math.PI/180))-90}function F8(A,c){return A*S8(xT(c))}class Vm{constructor(c,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+h,this.z=+p}static fromLngLat(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=WA.convert(c);return new Vm(I8(p.lng),P8(p.lat),M8(h,p.lat))}toLngLat(){return new WA(360*this.x-180,xT(this.y))}toAltitude(){return F8(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/T8*(c=xT(this.y),1/Math.cos(c*Math.PI/180));var c}}function L8(A,c,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[A*p-2*Math.PI*6378137/2,c*p-2*Math.PI*6378137/2]}class BT{constructor(c,h,p){if(!function(_,x,E){return!(_<0||_>25||E<0||E>=Math.pow(2,_)||x<0||x>=Math.pow(2,_))}(c,h,p))throw new Error(`x=${h}, y=${p}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=h,this.y=p,this.key=Cp(0,c,c,h,p)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,h,p){const _=(E=this.y,I=this.z,R=L8(256*(x=this.x),256*(E=Math.pow(2,I)-E-1),I),N=L8(256*(x+1),256*(E+1),I),R[0]+","+R[1]+","+N[0]+","+N[1]);var x,E,I,R,N;const V=function(j,tt,rt){let lt,dt="";for(let Pt=j;Pt>0;Pt--)lt=1<<Pt-1,dt+=(tt&lt?1:0)+(rt&lt?2:0);return dt}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,_)}isChildOf(c){const h=this.z-c.z;return h>0&&c.x===this.x>>h&&c.y===this.y>>h}getTilePoint(c){const h=Math.pow(2,this.z);return new P((c.x*h-this.x)*Wt,(c.y*h-this.y)*Wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class R8{constructor(c,h){this.wrap=c,this.canonical=h,this.key=Cp(c,h.z,h.z,h.x,h.y)}}class Hl{constructor(c,h,p,_,x){if(this.terrainRttPosMatrix32f=null,c<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${p}`);this.overscaledZ=c,this.wrap=h,this.canonical=new BT(p,+_,+x),this.key=Cp(h,c,p,_,x)}clone(){return new Hl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-c;return c>this.canonical.z?new Hl(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hl(c,this.wrap,c,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(c,h){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-c;return c>this.canonical.z?Cp(this.wrap*+h,c,this.canonical.z,this.canonical.x,this.canonical.y):Cp(this.wrap*+h,c,c,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const h=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>h&&c.canonical.y===this.canonical.y>>h}children(c){if(this.overscaledZ>=c)return[new Hl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Hl(h,this.wrap,h,p,_),new Hl(h,this.wrap,h,p+1,_),new Hl(h,this.wrap,h,p,_+1),new Hl(h,this.wrap,h,p+1,_+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Hl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Hl(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new R8(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new Vm(c.x-this.wrap,c.y))}}function Cp(A,c,h,p,_){(A*=2)<0&&(A=-1*A-1);const x=1<<h;return(x*x*A+x*_+p).toString(36)+h.toString(36)+c.toString(36)}Sr("CanonicalTileID",BT),Sr("OverscaledTileID",Hl,{omit:["terrainRttPosMatrix32f"]});class O8{constructor(c,h,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,I=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Ve(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const R=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=x,this.blueFactor=E,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let N=0;N<R;N++)this.data[this._idx(-1,N)]=this.data[this._idx(0,N)],this.data[this._idx(R,N)]=this.data[this._idx(R-1,N)],this.data[this._idx(N,-1)]=this.data[this._idx(N,0)],this.data[this._idx(N,R)]=this.data[this._idx(N,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let N=0;N<R;N++)for(let V=0;V<R;V++){const j=this.get(N,V);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(c,h){const p=new Uint8Array(this.data.buffer),_=4*this._idx(c,h);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,h){if(c<-1||c>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(c+1)}unpack(c,h,p){return c*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new zl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,h,p){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,x=h*this.dim+this.dim,E=p*this.dim,I=p*this.dim+this.dim;switch(h){case-1:_=x-1;break;case 1:x=_+1}switch(p){case-1:E=I-1;break;case 1:I=E+1}const R=-h*this.dim,N=-p*this.dim;for(let V=E;V<I;V++)for(let j=_;j<x;j++)this.data[this._idx(j,V)]=c.data[this._idx(j+R,V+N)]}}Sr("DEMData",O8);class U8{constructor(c){this._stringToNumber={},this._numberToString=[];for(let h=0;h<c.length;h++){const p=c[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class D8{constructor(c,h,p,_,x){this.type="Feature",this._vectorTileFeature=c,c._z=h,c._x=p,c._y=_,this.properties=c.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(c[h]=this[h]);return c}}class N8{constructor(c,h){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new yc(Wt,16,0),this.grid3D=new yc(Wt,16,0),this.featureIndexArray=new Lt,this.promoteId=h}insert(c,h,p,_,x,E){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,x);const R=E?this.grid3D:this.grid;for(let N=0;N<h.length;N++){const V=h[N],j=[1/0,1/0,-1/0,-1/0];for(let tt=0;tt<V.length;tt++){const rt=V[tt];j[0]=Math.min(j[0],rt.x),j[1]=Math.min(j[1],rt.y),j[2]=Math.max(j[2],rt.x),j[3]=Math.max(j[3],rt.y)}j[0]<Wt&&j[1]<Wt&&j[2]>=0&&j[3]>=0&&R.insert(I,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Dm.VectorTile(new AT(this.rawTileData)).layers,this.sourceLayerCoder=new U8(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,h,p,_){this.loadVTLayers();const x=c.params,E=Wt/c.tileSize/c.scale,I=mu(x.filter),R=c.queryGeometry,N=c.queryPadding*E,V=Q8(R),j=this.grid.query(V.minX-N,V.minY-N,V.maxX+N,V.maxY+N),tt=Q8(c.cameraQueryGeometry),rt=this.grid3D.query(tt.minX-N,tt.minY-N,tt.maxX+N,tt.maxY+N,(Pt,Mt,ce,Ht)=>function(et,Et,Vt,Ee,We){for(const Ue of et)if(Et<=Ue.x&&Vt<=Ue.y&&Ee>=Ue.x&&We>=Ue.y)return!0;const Pe=[new P(Et,Vt),new P(Et,We),new P(Ee,We),new P(Ee,Vt)];if(et.length>2){for(const Ue of Pe)if(_p(et,Ue))return!0}for(let Ue=0;Ue<et.length-1;Ue++)if(zft(et[Ue],et[Ue+1],Pe))return!0;return!1}(c.cameraQueryGeometry,Pt-N,Mt-N,ce+N,Ht+N));for(const Pt of rt)j.push(Pt);j.sort(Jpt);const lt={};let dt;for(let Pt=0;Pt<j.length;Pt++){const Mt=j[Pt];if(Mt===dt)continue;dt=Mt;const ce=this.featureIndexArray.get(Mt);let Ht=null;this.loadMatchingFeature(lt,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,I,x.layers,x.availableImages,h,p,_,(et,Et,Vt)=>(Ht||(Ht=Jh(et)),Et.queryIntersectsFeature({queryGeometry:R,feature:et,featureState:Vt,geometry:Ht,zoom:this.z,transform:c.transform,pixelsToTileUnits:E,pixelPosMatrix:c.pixelPosMatrix})))}return lt}loadMatchingFeature(c,h,p,_,x,E,I,R,N,V,j){const tt=this.bucketLayerIDs[h];if(E&&!tt.some(Pt=>E.has(Pt)))return;const rt=this.sourceLayerCoder.decode(p),lt=this.vtLayers[rt].feature(_);if(x.needGeometry){const Pt=tA(lt,!0);if(!x.filter(new be(this.tileID.overscaledZ),Pt,this.tileID.canonical))return}else if(!x.filter(new be(this.tileID.overscaledZ),lt))return;const dt=this.getId(lt,rt);for(let Pt=0;Pt<tt.length;Pt++){const Mt=tt[Pt];if(E&&!E.has(Mt))continue;const ce=R[Mt];if(!ce)continue;let Ht={};dt&&V&&(Ht=V.getState(ce.sourceLayer||"_geojsonTileLayer",dt));const et=Nt({},N[Mt]);et.paint=k8(et.paint,ce.paint,lt,Ht,I),et.layout=k8(et.layout,ce.layout,lt,Ht,I);const Et=!j||j(lt,ce,Ht);if(!Et)continue;const Vt=new D8(lt,this.z,this.x,this.y,dt);Vt.layer=et;let Ee=c[Mt];Ee===void 0&&(Ee=c[Mt]=[]),Ee.push({featureIndex:_,feature:Vt,intersectionZ:Et})}}lookupSymbolFeatures(c,h,p,_,x,E,I,R){const N={};this.loadVTLayers();const V=mu(x);for(const j of c)this.loadMatchingFeature(N,p,_,j,V,E,I,R,h);return N}hasLayer(c){for(const h of this.bucketLayerIDs)for(const p of h)if(c===p)return!0;return!1}getId(c,h){var p;let _=c.id;return this.promoteId&&(_=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((p=c.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(_=Number(c.properties.cluster_id))),_}}function k8(A,c,h,p,_){return Xt(A,(x,E)=>{const I=c instanceof rr?c.get(E):null;return I&&I.evaluate?I.evaluate(h,p,_):I})}function Q8(A){let c=1/0,h=1/0,p=-1/0,_=-1/0;for(const x of A)c=Math.min(c,x.x),h=Math.min(h,x.y),p=Math.max(p,x.x),_=Math.max(_,x.y);return{minX:c,minY:h,maxX:p,maxY:_}}function Jpt(A,c){return c-A}function z8(A,c,h,p,_){const x=[];for(let E=0;E<A.length;E++){const I=A[E];let R;for(let N=0;N<I.length-1;N++){let V=I[N],j=I[N+1];V.x<c&&j.x<c||(V.x<c?V=new P(c,V.y+(c-V.x)/(j.x-V.x)*(j.y-V.y))._round():j.x<c&&(j=new P(c,V.y+(c-V.x)/(j.x-V.x)*(j.y-V.y))._round()),V.y<h&&j.y<h||(V.y<h?V=new P(V.x+(h-V.y)/(j.y-V.y)*(j.x-V.x),h)._round():j.y<h&&(j=new P(V.x+(h-V.y)/(j.y-V.y)*(j.x-V.x),h)._round()),V.x>=p&&j.x>=p||(V.x>=p?V=new P(p,V.y+(p-V.x)/(j.x-V.x)*(j.y-V.y))._round():j.x>=p&&(j=new P(p,V.y+(p-V.x)/(j.x-V.x)*(j.y-V.y))._round()),V.y>=_&&j.y>=_||(V.y>=_?V=new P(V.x+(_-V.y)/(j.y-V.y)*(j.x-V.x),_)._round():j.y>=_&&(j=new P(V.x+(_-V.y)/(j.y-V.y)*(j.x-V.x),_)._round()),R&&V.equals(R[R.length-1])||(R=[V],x.push(R)),R.push(j)))))}}return x}Sr("FeatureIndex",N8,{omit:["rawTileData","sourceLayerCoder"]});class $A extends P{constructor(c,h,p,_){super(c,h),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new $A(this.x,this.y,this.angle,this.segment)}}function H8(A,c,h,p,_){if(c.segment===void 0||h===0)return!0;let x=c,E=c.segment+1,I=0;for(;I>-h/2;){if(E--,E<0)return!1;I-=A[E].dist(x),x=A[E]}I+=A[E].dist(A[E+1]),E++;const R=[];let N=0;for(;I<h/2;){const V=A[E],j=A[E+1];if(!j)return!1;let tt=A[E-1].angleTo(V)-V.angleTo(j);for(tt=Math.abs((tt+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:I,angleDelta:tt}),N+=tt;I-R[0].distance>p;)N-=R.shift().angleDelta;if(N>_)return!1;E++,I+=V.dist(j)}return!0}function V8(A){let c=0;for(let h=0;h<A.length-1;h++)c+=A[h].dist(A[h+1]);return c}function G8(A,c,h){return A?.6*c*h:0}function j8(A,c){return Math.max(A?A.right-A.left:0,c?c.right-c.left:0)}function tgt(A,c,h,p,_,x){const E=G8(h,_,x),I=j8(h,p)*x;let R=0;const N=V8(A)/2;for(let V=0;V<A.length-1;V++){const j=A[V],tt=A[V+1],rt=j.dist(tt);if(R+rt>N){const lt=(N-R)/rt,dt=Wo.number(j.x,tt.x,lt),Pt=Wo.number(j.y,tt.y,lt),Mt=new $A(dt,Pt,tt.angleTo(j),V);return Mt._round(),!E||H8(A,Mt,I,E,c)?Mt:void 0}R+=rt}}function egt(A,c,h,p,_,x,E,I,R){const N=G8(p,x,E),V=j8(p,_),j=V*E,tt=A[0].x===0||A[0].x===R||A[0].y===0||A[0].y===R;return c-j<c/4&&(c=j+c/4),q8(A,tt?c/2*I%c:(V/2+2*x)*E*I%c,c,N,h,j,tt,!1,R)}function q8(A,c,h,p,_,x,E,I,R){const N=x/2,V=V8(A);let j=0,tt=c-h,rt=[];for(let lt=0;lt<A.length-1;lt++){const dt=A[lt],Pt=A[lt+1],Mt=dt.dist(Pt),ce=Pt.angleTo(dt);for(;tt+h<j+Mt;){tt+=h;const Ht=(tt-j)/Mt,et=Wo.number(dt.x,Pt.x,Ht),Et=Wo.number(dt.y,Pt.y,Ht);if(et>=0&&et<R&&Et>=0&&Et<R&&tt-N>=0&&tt+N<=V){const Vt=new $A(et,Et,ce,lt);Vt._round(),p&&!H8(A,Vt,x,p,_)||rt.push(Vt)}}j+=Mt}return I||rt.length||E||(rt=q8(A,j/2,h,p,_,x,E,!0,R)),rt}Sr("Anchor",$A);const Gm=ja;function K8(A,c,h,p){const _=[],x=A.image,E=x.pixelRatio,I=x.paddedRect.w-2*Gm,R=x.paddedRect.h-2*Gm;let N={x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};const V=x.stretchX||[[0,I]],j=x.stretchY||[[0,R]],tt=(ke,Dr)=>ke+Dr[1]-Dr[0],rt=V.reduce(tt,0),lt=j.reduce(tt,0),dt=I-rt,Pt=R-lt;let Mt=0,ce=rt,Ht=0,et=lt,Et=0,Vt=dt,Ee=0,We=Pt;if(x.content&&p){const ke=x.content,Dr=ke[2]-ke[0],Xr=ke[3]-ke[1];(x.textFitWidth||x.textFitHeight)&&(N=_8(A)),Mt=B_(V,0,ke[0]),Ht=B_(j,0,ke[1]),ce=B_(V,ke[0],ke[2]),et=B_(j,ke[1],ke[3]),Et=ke[0]-Mt,Ee=ke[1]-Ht,Vt=Dr-ce,We=Xr-et}const Pe=N.x1,Ue=N.y1,lr=N.x2-Pe,Ye=N.y2-Ue,dr=(ke,Dr,Xr,Kr)=>{const zr=C_(ke.stretch-Mt,ce,lr,Pe),Fn=E_(ke.fixed-Et,Vt,ke.stretch,rt),rs=C_(Dr.stretch-Ht,et,Ye,Ue),Es=E_(Dr.fixed-Ee,We,Dr.stretch,lt),Ca=C_(Xr.stretch-Mt,ce,lr,Pe),qa=E_(Xr.fixed-Et,Vt,Xr.stretch,rt),Ka=C_(Kr.stretch-Ht,et,Ye,Ue),vo=E_(Kr.fixed-Ee,We,Kr.stretch,lt),ls=new P(zr,rs),Ws=new P(Ca,rs),bo=new P(Ca,Ka),Ts=new P(zr,Ka),Ea=new P(Fn/E,Es/E),Vl=new P(qa/E,vo/E),oo=c*Math.PI/180;if(oo){const ao=Math.sin(oo),lo=Math.cos(oo),Ss=[lo,-ao,ao,lo];ls._matMult(Ss),Ws._matMult(Ss),Ts._matMult(Ss),bo._matMult(Ss)}const Wa=ke.stretch+ke.fixed,$s=Dr.stretch+Dr.fixed;return{tl:ls,tr:Ws,bl:Ts,br:bo,tex:{x:x.paddedRect.x+Gm+Wa,y:x.paddedRect.y+Gm+$s,w:Xr.stretch+Xr.fixed-Wa,h:Kr.stretch+Kr.fixed-$s},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ea,pixelOffsetBR:Vl,minFontScaleX:Vt/E/lr,minFontScaleY:We/E/Ye,isSDF:h}};if(p&&(x.stretchX||x.stretchY)){const ke=W8(V,dt,rt),Dr=W8(j,Pt,lt);for(let Xr=0;Xr<ke.length-1;Xr++){const Kr=ke[Xr],zr=ke[Xr+1];for(let Fn=0;Fn<Dr.length-1;Fn++)_.push(dr(Kr,Dr[Fn],zr,Dr[Fn+1]))}}else _.push(dr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:R+1}));return _}function B_(A,c,h){let p=0;for(const _ of A)p+=Math.max(c,Math.min(h,_[1]))-Math.max(c,Math.min(h,_[0]));return p}function W8(A,c,h){const p=[{fixed:-1,stretch:0}];for(const[_,x]of A){const E=p[p.length-1];p.push({fixed:_-E.stretch,stretch:E.stretch}),p.push({fixed:_-E.stretch,stretch:E.stretch+(x-_)})}return p.push({fixed:c+Gm,stretch:h}),p}function C_(A,c,h,p){return A/c*h+p}function E_(A,c,h,p){return A-c*h/p}class T_{constructor(c,h,p,_,x,E,I,R,N,V){var j;if(this.boxStartIndex=c.length,N){let tt=E.top,rt=E.bottom;const lt=E.collisionPadding;lt&&(tt-=lt[1],rt+=lt[3]);let dt=rt-tt;dt>0&&(dt=Math.max(10,dt),this.circleDiameter=dt)}else{const tt=!((j=E.image)===null||j===void 0)&&j.content&&(E.image.textFitWidth||E.image.textFitHeight)?_8(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};tt.y1=tt.y1*I-R[0],tt.y2=tt.y2*I+R[2],tt.x1=tt.x1*I-R[3],tt.x2=tt.x2*I+R[1];const rt=E.collisionPadding;if(rt&&(tt.x1-=rt[0]*I,tt.y1-=rt[1]*I,tt.x2+=rt[2]*I,tt.y2+=rt[3]*I),V){const lt=new P(tt.x1,tt.y1),dt=new P(tt.x2,tt.y1),Pt=new P(tt.x1,tt.y2),Mt=new P(tt.x2,tt.y2),ce=V*Math.PI/180;lt._rotate(ce),dt._rotate(ce),Pt._rotate(ce),Mt._rotate(ce),tt.x1=Math.min(lt.x,dt.x,Pt.x,Mt.x),tt.x2=Math.max(lt.x,dt.x,Pt.x,Mt.x),tt.y1=Math.min(lt.y,dt.y,Pt.y,Mt.y),tt.y2=Math.max(lt.y,dt.y,Pt.y,Mt.y)}c.emplaceBack(h.x,h.y,tt.x1,tt.y1,tt.x2,tt.y2,p,_,x)}this.boxEndIndex=c.length}}class rgt{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(p,_)=>p<_?-1:p>_?1:0;if(this.data=c,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:h,compare:p}=this,_=h[c];for(;c>0;){const x=c-1>>1,E=h[x];if(p(_,E)>=0)break;h[c]=E,c=x}h[c]=_}_down(c){const{data:h,compare:p}=this,_=this.length>>1,x=h[c];for(;c<_;){let E=1+(c<<1);const I=E+1;if(I<this.length&&p(h[I],h[E])<0&&(E=I),p(h[E],x)>=0)break;h[c]=h[E],c=E}h[c]=x}}function ngt(A){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,_=1/0,x=-1/0,E=-1/0;const I=A[0];for(let rt=0;rt<I.length;rt++){const lt=I[rt];(!rt||lt.x<p)&&(p=lt.x),(!rt||lt.y<_)&&(_=lt.y),(!rt||lt.x>x)&&(x=lt.x),(!rt||lt.y>E)&&(E=lt.y)}const R=Math.min(x-p,E-_);let N=R/2;const V=new rgt([],igt);if(R===0)return new P(p,_);for(let rt=p;rt<x;rt+=R)for(let lt=_;lt<E;lt+=R)V.push(new Ep(rt+N,lt+N,N,A));let j=function(rt){let lt=0,dt=0,Pt=0;const Mt=rt[0];for(let ce=0,Ht=Mt.length,et=Ht-1;ce<Ht;et=ce++){const Et=Mt[ce],Vt=Mt[et],Ee=Et.x*Vt.y-Vt.x*Et.y;dt+=(Et.x+Vt.x)*Ee,Pt+=(Et.y+Vt.y)*Ee,lt+=3*Ee}return new Ep(dt/lt,Pt/lt,0,rt)}(A),tt=V.length;for(;V.length;){const rt=V.pop();(rt.d>j.d||!j.d)&&(j=rt,h&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,tt)),rt.max-j.d<=c||(N=rt.h/2,V.push(new Ep(rt.p.x-N,rt.p.y-N,N,A)),V.push(new Ep(rt.p.x+N,rt.p.y-N,N,A)),V.push(new Ep(rt.p.x-N,rt.p.y+N,N,A)),V.push(new Ep(rt.p.x+N,rt.p.y+N,N,A)),tt+=4)}return h&&(console.log(`num probes: ${tt}`),console.log(`best distance: ${j.d}`)),j.p}function igt(A,c){return c.max-A.max}function Ep(A,c,h,p){this.p=new P(A,c),this.h=h,this.d=function(_,x){let E=!1,I=1/0;for(let R=0;R<x.length;R++){const N=x[R];for(let V=0,j=N.length,tt=j-1;V<j;tt=V++){const rt=N[V],lt=N[tt];rt.y>_.y!=lt.y>_.y&&_.x<(lt.x-rt.x)*(_.y-rt.y)/(lt.y-rt.y)+rt.x&&(E=!E),I=Math.min(I,Sk(_,rt,lt))}}return(E?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Qo;a.av=void 0,(Qo=a.av||(a.av={}))[Qo.center=1]="center",Qo[Qo.left=2]="left",Qo[Qo.right=3]="right",Qo[Qo.top=4]="top",Qo[Qo.bottom=5]="bottom",Qo[Qo["top-left"]=6]="top-left",Qo[Qo["top-right"]=7]="top-right",Qo[Qo["bottom-left"]=8]="bottom-left",Qo[Qo["bottom-right"]=9]="bottom-right";const XA=7,CT=Number.POSITIVE_INFINITY;function $8(A,c){return c[1]!==CT?function(h,p,_){let x=0,E=0;switch(p=Math.abs(p),_=Math.abs(_),h){case"top-right":case"top-left":case"top":E=_-XA;break;case"bottom-right":case"bottom-left":case"bottom":E=-_+XA}switch(h){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,E]}(A,c[0],c[1]):function(h,p){let _=0,x=0;p<0&&(p=0);const E=p/Math.SQRT2;switch(h){case"top-right":case"top-left":x=E-XA;break;case"bottom-right":case"bottom-left":x=-E+XA;break;case"bottom":x=-p+XA;break;case"top":x=p-XA}switch(h){case"top-right":case"bottom-right":_=-E;break;case"top-left":case"bottom-left":_=E;break;case"left":_=p;break;case"right":_=-p}return[_,x]}(A,c[0])}function X8(A,c,h){var p;const _=A.layout,x=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(c,{},h);if(x){const I=x.values,R=[];for(let N=0;N<I.length;N+=2){const V=R[N]=I[N],j=I[N+1].map(tt=>tt*Ks);V.startsWith("top")?j[1]-=XA:V.startsWith("bottom")&&(j[1]+=XA),R[N+1]=j}return new Cr(R)}const E=_.get("text-variable-anchor");if(E){let I;I=A._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(c,{},h)*Ks,CT]:_.get("text-offset").evaluate(c,{},h).map(N=>N*Ks);const R=[];for(const N of E)R.push(N,$8(N,I));return new Cr(R)}return null}function ET(A){switch(A){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sgt(A,c,h,p,_,x,E,I,R,N,V,j){let tt=x.textMaxSize.evaluate(c,{});tt===void 0&&(tt=E);const rt=A.layers[0].layout,lt=rt.get("icon-offset").evaluate(c,{},V),dt=Y8(h.horizontal),Pt=E/24,Mt=A.tilePixelRatio*Pt,ce=A.tilePixelRatio*tt/24,Ht=A.tilePixelRatio*I,et=A.tilePixelRatio*rt.get("symbol-spacing"),Et=rt.get("text-padding")*A.tilePixelRatio,Vt=function(Xr,Kr,zr){let Fn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const rs=Xr.get("icon-padding").evaluate(Kr,{},zr),Es=rs&&rs.values;return[Es[0]*Fn,Es[1]*Fn,Es[2]*Fn,Es[3]*Fn]}(rt,c,V,A.tilePixelRatio),Ee=rt.get("text-max-angle")/180*Math.PI,We=rt.get("text-rotation-alignment")!=="viewport"&&rt.get("symbol-placement")!=="point",Pe=rt.get("icon-rotation-alignment")==="map"&&rt.get("symbol-placement")!=="point",Ue=rt.get("symbol-placement"),lr=et/2,Ye=rt.get("icon-text-fit");let dr;p&&Ye!=="none"&&(A.allowVerticalPlacement&&h.vertical&&(dr=v8(p,h.vertical,Ye,rt.get("icon-text-fit-padding"),lt,Pt)),dt&&(p=v8(p,dt,Ye,rt.get("icon-text-fit-padding"),lt,Pt)));const ke=V?j.line.getGranularityForZoomLevel(V.z):1,Dr=(Xr,Kr)=>{Kr.x<0||Kr.x>=Wt||Kr.y<0||Kr.y>=Wt||function(zr,Fn,rs,Es,Ca,qa,Ka,vo,ls,Ws,bo,Ts,Ea,Vl,oo,Wa,$s,ao,lo,Ss,Ri,xu,Tp,Bu,lgt){const Sp=zr.addToLineVertexArray(Fn,rs);let Zd,Ip,Pp,Mp,rQ=0,nQ=0,iQ=0,sQ=0,RT=-1,OT=-1;const eA={};let oQ=ts("");if(zr.allowVerticalPlacement&&Es.vertical){const ea=vo.layout.get("text-rotate").evaluate(Ri,{},Bu)+90;Pp=new T_(ls,Fn,Ws,bo,Ts,Es.vertical,Ea,Vl,oo,ea),Ka&&(Mp=new T_(ls,Fn,Ws,bo,Ts,Ka,$s,ao,oo,ea))}if(Ca){const ea=vo.layout.get("icon-rotate").evaluate(Ri,{}),Gl=vo.layout.get("icon-text-fit")!=="none",Yd=K8(Ca,ea,Tp,Gl),Eu=Ka?K8(Ka,ea,Tp,Gl):void 0;Ip=new T_(ls,Fn,Ws,bo,Ts,Ca,$s,ao,!1,ea),rQ=4*Yd.length;const Jd=zr.iconSizeData;let uh=null;Jd.kind==="source"?(uh=[ch*vo.layout.get("icon-size").evaluate(Ri,{})],uh[0]>KA&&Ve(`${zr.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)):Jd.kind==="composite"&&(uh=[ch*xu.compositeIconSizes[0].evaluate(Ri,{},Bu),ch*xu.compositeIconSizes[1].evaluate(Ri,{},Bu)],(uh[0]>KA||uh[1]>KA)&&Ve(`${zr.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)),zr.addSymbols(zr.icon,Yd,uh,Ss,lo,Ri,a.ai.none,Fn,Sp.lineStartIndex,Sp.lineLength,-1,Bu),RT=zr.icon.placedSymbolArray.length-1,Eu&&(nQ=4*Eu.length,zr.addSymbols(zr.icon,Eu,uh,Ss,lo,Ri,a.ai.vertical,Fn,Sp.lineStartIndex,Sp.lineLength,-1,Bu),OT=zr.icon.placedSymbolArray.length-1)}const aQ=Object.keys(Es.horizontal);for(const ea of aQ){const Gl=Es.horizontal[ea];if(!Zd){oQ=ts(Gl.text);const Eu=vo.layout.get("text-rotate").evaluate(Ri,{},Bu);Zd=new T_(ls,Fn,Ws,bo,Ts,Gl,Ea,Vl,oo,Eu)}const Yd=Gl.positionedLines.length===1;if(iQ+=Z8(zr,Fn,Gl,qa,vo,oo,Ri,Wa,Sp,Es.vertical?a.ai.horizontal:a.ai.horizontalOnly,Yd?aQ:[ea],eA,RT,xu,Bu),Yd)break}Es.vertical&&(sQ+=Z8(zr,Fn,Es.vertical,qa,vo,oo,Ri,Wa,Sp,a.ai.vertical,["vertical"],eA,OT,xu,Bu));const cgt=Zd?Zd.boxStartIndex:zr.collisionBoxArray.length,ugt=Zd?Zd.boxEndIndex:zr.collisionBoxArray.length,hgt=Pp?Pp.boxStartIndex:zr.collisionBoxArray.length,Agt=Pp?Pp.boxEndIndex:zr.collisionBoxArray.length,dgt=Ip?Ip.boxStartIndex:zr.collisionBoxArray.length,fgt=Ip?Ip.boxEndIndex:zr.collisionBoxArray.length,pgt=Mp?Mp.boxStartIndex:zr.collisionBoxArray.length,ggt=Mp?Mp.boxEndIndex:zr.collisionBoxArray.length;let Cu=-1;const I_=(ea,Gl)=>ea&&ea.circleDiameter?Math.max(ea.circleDiameter,Gl):Gl;Cu=I_(Zd,Cu),Cu=I_(Pp,Cu),Cu=I_(Ip,Cu),Cu=I_(Mp,Cu);const lQ=Cu>-1?1:0;lQ&&(Cu*=lgt/Ks),zr.glyphOffsetArray.length>=Bp.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ri.sortKey!==void 0&&zr.addToSortKeyRanges(zr.symbolInstances.length,Ri.sortKey);const mgt=X8(vo,Ri,Bu),[ygt,_gt]=function(ea,Gl){const Yd=ea.length,Eu=Gl==null?void 0:Gl.values;if((Eu==null?void 0:Eu.length)>0)for(let Jd=0;Jd<Eu.length;Jd+=2){const uh=Eu[Jd+1];ea.emplaceBack(a.av[Eu[Jd]],uh[0],uh[1])}return[Yd,ea.length]}(zr.textAnchorOffsets,mgt);zr.symbolInstances.emplaceBack(Fn.x,Fn.y,eA.right>=0?eA.right:-1,eA.center>=0?eA.center:-1,eA.left>=0?eA.left:-1,eA.vertical||-1,RT,OT,oQ,cgt,ugt,hgt,Agt,dgt,fgt,pgt,ggt,Ws,iQ,sQ,rQ,nQ,lQ,0,Ea,Cu,ygt,_gt)}(A,Kr,Xr,h,p,_,dr,A.layers[0],A.collisionBoxArray,c.index,c.sourceLayerIndex,A.index,Mt,[Et,Et,Et,Et],We,R,Ht,Vt,Pe,lt,c,x,N,V,E)};if(Ue==="line")for(const Xr of z8(c.geometry,0,0,Wt,Wt)){const Kr=Xd(Xr,ke),zr=egt(Kr,et,Ee,h.vertical||dt,p,24,ce,A.overscaling,Wt);for(const Fn of zr)dt&&ogt(A,dt.text,lr,Fn)||Dr(Kr,Fn)}else if(Ue==="line-center"){for(const Xr of c.geometry)if(Xr.length>1){const Kr=Xd(Xr,ke),zr=tgt(Kr,Ee,h.vertical||dt,p,24,ce);zr&&Dr(Kr,zr)}}else if(c.type==="Polygon")for(const Xr of fo(c.geometry,0)){const Kr=ngt(Xr,16);Dr(Xd(Xr[0],ke,!0),new $A(Kr.x,Kr.y,0))}else if(c.type==="LineString")for(const Xr of c.geometry){const Kr=Xd(Xr,ke);Dr(Kr,new $A(Kr[0].x,Kr[0].y,0))}else if(c.type==="Point")for(const Xr of c.geometry)for(const Kr of Xr)Dr([Kr],new $A(Kr.x,Kr.y,0))}function Z8(A,c,h,p,_,x,E,I,R,N,V,j,tt,rt,lt){const dt=function(ce,Ht,et,Et,Vt,Ee,We,Pe){const Ue=Et.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,lr=[];for(const Ye of Ht.positionedLines)for(const dr of Ye.positionedGlyphs){if(!dr.rect)continue;const ke=dr.rect||{};let Dr=Rpt+1,Xr=!0,Kr=1,zr=0;const Fn=(Vt||Pe)&&dr.vertical,rs=dr.metrics.advance*dr.scale/2;if(Pe&&Ht.verticalizable&&(zr=Ye.lineOffset/2-(dr.imageName?-(Ks-dr.metrics.width*dr.scale)/2:(dr.scale-1)*Ks)),dr.imageName){const ao=We[dr.imageName];Xr=ao.sdf,Kr=ao.pixelRatio,Dr=ja/Kr}const Es=Vt?[dr.x+rs,dr.y]:[0,0];let Ca=Vt?[0,0]:[dr.x+rs+et[0],dr.y+et[1]-zr],qa=[0,0];Fn&&(qa=Ca,Ca=[0,0]);const Ka=dr.metrics.isDoubleResolution?2:1,vo=(dr.metrics.left-Dr)*dr.scale-rs+Ca[0],ls=(-dr.metrics.top-Dr)*dr.scale+Ca[1],Ws=vo+ke.w/Ka*dr.scale/Kr,bo=ls+ke.h/Ka*dr.scale/Kr,Ts=new P(vo,ls),Ea=new P(Ws,ls),Vl=new P(vo,bo),oo=new P(Ws,bo);if(Fn){const ao=new P(-rs,rs-__),lo=-Math.PI/2,Ss=Ks/2-rs,Ri=new P(5-__-Ss,-(dr.imageName?Ss:0)),xu=new P(...qa);Ts._rotateAround(lo,ao)._add(Ri)._add(xu),Ea._rotateAround(lo,ao)._add(Ri)._add(xu),Vl._rotateAround(lo,ao)._add(Ri)._add(xu),oo._rotateAround(lo,ao)._add(Ri)._add(xu)}if(Ue){const ao=Math.sin(Ue),lo=Math.cos(Ue),Ss=[lo,-ao,ao,lo];Ts._matMult(Ss),Ea._matMult(Ss),Vl._matMult(Ss),oo._matMult(Ss)}const Wa=new P(0,0),$s=new P(0,0);lr.push({tl:Ts,tr:Ea,bl:Vl,br:oo,tex:ke,writingMode:Ht.writingMode,glyphOffset:Es,sectionIndex:dr.sectionIndex,isSDF:Xr,pixelOffsetTL:Wa,pixelOffsetBR:$s,minFontScaleX:0,minFontScaleY:0})}return lr}(0,h,I,_,x,E,p,A.allowVerticalPlacement),Pt=A.textSizeData;let Mt=null;Pt.kind==="source"?(Mt=[ch*_.layout.get("text-size").evaluate(E,{})],Mt[0]>KA&&Ve(`${A.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)):Pt.kind==="composite"&&(Mt=[ch*rt.compositeTextSizes[0].evaluate(E,{},lt),ch*rt.compositeTextSizes[1].evaluate(E,{},lt)],(Mt[0]>KA||Mt[1]>KA)&&Ve(`${A.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)),A.addSymbols(A.text,dt,Mt,I,x,E,N,c,R.lineStartIndex,R.lineLength,tt,lt);for(const ce of V)j[ce]=A.text.placedSymbolArray.length-1;return 4*dt.length}function Y8(A){for(const c in A)return A[c];return null}function ogt(A,c,h,p){const _=A.compareText;if(c in _){const x=_[c];for(let E=x.length-1;E>=0;E--)if(p.dist(x[E])<h)return!0}else _[c]=[];return _[c].push(p),!1}const J8=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class TT{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(c,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const x=J8[15&p];if(!x)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(c,2,1),[I]=new Uint32Array(c,4,1);return new TT(I,E,x,c)}constructor(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,_=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const x=J8.indexOf(this.ArrayType),E=2*c*this.ArrayType.BYTES_PER_ELEMENT,I=c*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-I%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+I+R,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+E+I+R),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+I+R,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=c)}add(c,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=c,this.coords[this._pos++]=h,p}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return ST(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,h,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:E,nodeSize:I}=this,R=[0,x.length-1,0],N=[];for(;R.length;){const V=R.pop()||0,j=R.pop()||0,tt=R.pop()||0;if(j-tt<=I){for(let Pt=tt;Pt<=j;Pt++){const Mt=E[2*Pt],ce=E[2*Pt+1];Mt>=c&&Mt<=p&&ce>=h&&ce<=_&&N.push(x[Pt])}continue}const rt=tt+j>>1,lt=E[2*rt],dt=E[2*rt+1];lt>=c&&lt<=p&&dt>=h&&dt<=_&&N.push(x[rt]),(V===0?c<=lt:h<=dt)&&(R.push(tt),R.push(rt-1),R.push(1-V)),(V===0?p>=lt:_>=dt)&&(R.push(rt+1),R.push(j),R.push(1-V))}return N}within(c,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:E}=this,I=[0,_.length-1,0],R=[],N=p*p;for(;I.length;){const V=I.pop()||0,j=I.pop()||0,tt=I.pop()||0;if(j-tt<=E){for(let Pt=tt;Pt<=j;Pt++)eQ(x[2*Pt],x[2*Pt+1],c,h)<=N&&R.push(_[Pt]);continue}const rt=tt+j>>1,lt=x[2*rt],dt=x[2*rt+1];eQ(lt,dt,c,h)<=N&&R.push(_[rt]),(V===0?c-p<=lt:h-p<=dt)&&(I.push(tt),I.push(rt-1),I.push(1-V)),(V===0?c+p>=lt:h+p>=dt)&&(I.push(rt+1),I.push(j),I.push(1-V))}return R}}function ST(A,c,h,p,_,x){if(_-p<=h)return;const E=p+_>>1;tQ(A,c,E,p,_,x),ST(A,c,h,p,E-1,1-x),ST(A,c,h,E+1,_,1-x)}function tQ(A,c,h,p,_,x){for(;_>p;){if(_-p>600){const N=_-p+1,V=h-p+1,j=Math.log(N),tt=.5*Math.exp(2*j/3),rt=.5*Math.sqrt(j*tt*(N-tt)/N)*(V-N/2<0?-1:1);tQ(A,c,h,Math.max(p,Math.floor(h-V*tt/N+rt)),Math.min(_,Math.floor(h+(N-V)*tt/N+rt)),x)}const E=c[2*h+x];let I=p,R=_;for(jm(A,c,p,h),c[2*_+x]>E&&jm(A,c,p,_);I<R;){for(jm(A,c,I,R),I++,R--;c[2*I+x]<E;)I++;for(;c[2*R+x]>E;)R--}c[2*p+x]===E?jm(A,c,p,R):(R++,jm(A,c,R,_)),R<=h&&(p=R+1),h<=R&&(_=R-1)}}function jm(A,c,h,p){IT(A,h,p),IT(c,2*h,2*p),IT(c,2*h+1,2*p+1)}function IT(A,c,h){const p=A[c];A[c]=A[h],A[h]=p}function eQ(A,c,h,p){const _=A-h,x=c-p;return _*_+x*x}var PT;a.ce=void 0,(PT=a.ce||(a.ce={})).create="create",PT.load="load",PT.fullLoad="fullLoad";let S_=null,qm=[];const MT=1e3/60,FT="loadTime",LT="fullLoadTime",agt={mark(A){performance.mark(A)},frame(A){const c=A;S_!=null&&qm.push(c-S_),S_=c},clearMetrics(){S_=null,qm=[],performance.clearMeasures(FT),performance.clearMeasures(LT);for(const A in a.ce)performance.clearMarks(a.ce[A])},getPerformanceMetrics(){performance.measure(FT,a.ce.create,a.ce.load),performance.measure(LT,a.ce.create,a.ce.fullLoad);const A=performance.getEntriesByName(FT)[0].duration,c=performance.getEntriesByName(LT)[0].duration,h=qm.length,p=1/(qm.reduce((x,E)=>x+E,0)/h/1e3),_=qm.filter(x=>x>MT).reduce((x,E)=>x+(E-MT)/MT,0);return{loadTime:A,fullLoadTime:c,fps:p,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};a.$=Yt,a.A=it,a.B=mc,a.C=function(A){if(mr==null){const c=A.navigator?A.navigator.userAgent:null;mr=!!A.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return mr},a.D=we,a.E=Xn,a.F=class{constructor(A,c){this.target=A,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ypt(()=>this.process()),this.subscription=function(h,p,_,x){return h.addEventListener(p,_,!1),{unsubscribe:()=>{h.removeEventListener(p,_,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=or(self)?A:window}registerMessageHandler(A,c){this.messageHandlers[A]=c}sendAsync(A,c){return new Promise((h,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:h,reject:p},c&&c.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const I={id:_,type:"<cancel>",origin:location.origin,targetMapId:A.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const x=[],E=Object.assign(Object.assign({},A),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Zh(A.data,x)});this.target.postMessage(E,{transfer:x})})}receive(A){const c=A.data,h=c.id;if(!(c.origin!=="file://"&&location.origin!=="file://"&&c.origin!=="resource://android"&&location.origin!=="resource://android"&&c.origin!==location.origin||c.targetMapId&&this.mapId!==c.targetMapId)){if(c.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(or(self)||c.mustQueue)return this.tasks[h]=c,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,c)}}process(){if(this.taskQueue.length===0)return;const A=this.taskQueue.shift(),c=this.tasks[A];delete this.tasks[A],this.taskQueue.length>0&&this.invoker.trigger(),c&&this.processTask(A,c)}processTask(A,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>"){const _=this.resolveRejects[A];return delete this.resolveRejects[A],_?void(c.error?_.reject(Ql(c.error)):_.resolve(Ql(c.data))):void 0}if(!this.messageHandlers[c.type])return void this.completeTask(A,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Ql(c.data),p=new AbortController;this.abortControllers[A]=p;try{const _=yield this.messageHandlers[c.type](c.sourceMapId,h,p);this.completeTask(A,null,_)}catch(_){this.completeTask(A,_)}})}completeTask(A,c,h){const p=[];delete this.abortControllers[A];const _={id:A,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?Zh(c):null,data:Zh(h,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.G=Br,a.H=function(){var A=new it(16);return it!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0),A[0]=1,A[5]=1,A[10]=1,A[15]=1,A},a.I=fT,a.J=function(A,c,h){var p,_,x,E,I,R,N,V,j,tt,rt,lt,dt=h[0],Pt=h[1],Mt=h[2];return c===A?(A[12]=c[0]*dt+c[4]*Pt+c[8]*Mt+c[12],A[13]=c[1]*dt+c[5]*Pt+c[9]*Mt+c[13],A[14]=c[2]*dt+c[6]*Pt+c[10]*Mt+c[14],A[15]=c[3]*dt+c[7]*Pt+c[11]*Mt+c[15]):(_=c[1],x=c[2],E=c[3],I=c[4],R=c[5],N=c[6],V=c[7],j=c[8],tt=c[9],rt=c[10],lt=c[11],A[0]=p=c[0],A[1]=_,A[2]=x,A[3]=E,A[4]=I,A[5]=R,A[6]=N,A[7]=V,A[8]=j,A[9]=tt,A[10]=rt,A[11]=lt,A[12]=p*dt+I*Pt+j*Mt+c[12],A[13]=_*dt+R*Pt+tt*Mt+c[13],A[14]=x*dt+N*Pt+rt*Mt+c[14],A[15]=E*dt+V*Pt+lt*Mt+c[15]),A},a.K=function(A,c,h){var p=h[0],_=h[1],x=h[2];return A[0]=c[0]*p,A[1]=c[1]*p,A[2]=c[2]*p,A[3]=c[3]*p,A[4]=c[4]*_,A[5]=c[5]*_,A[6]=c[6]*_,A[7]=c[7]*_,A[8]=c[8]*x,A[9]=c[9]*x,A[10]=c[10]*x,A[11]=c[11]*x,A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},a.L=function(A,c,h){var p=c[0],_=c[1],x=c[2],E=c[3],I=c[4],R=c[5],N=c[6],V=c[7],j=c[8],tt=c[9],rt=c[10],lt=c[11],dt=c[12],Pt=c[13],Mt=c[14],ce=c[15],Ht=h[0],et=h[1],Et=h[2],Vt=h[3];return A[0]=Ht*p+et*I+Et*j+Vt*dt,A[1]=Ht*_+et*R+Et*tt+Vt*Pt,A[2]=Ht*x+et*N+Et*rt+Vt*Mt,A[3]=Ht*E+et*V+Et*lt+Vt*ce,A[4]=(Ht=h[4])*p+(et=h[5])*I+(Et=h[6])*j+(Vt=h[7])*dt,A[5]=Ht*_+et*R+Et*tt+Vt*Pt,A[6]=Ht*x+et*N+Et*rt+Vt*Mt,A[7]=Ht*E+et*V+Et*lt+Vt*ce,A[8]=(Ht=h[8])*p+(et=h[9])*I+(Et=h[10])*j+(Vt=h[11])*dt,A[9]=Ht*_+et*R+Et*tt+Vt*Pt,A[10]=Ht*x+et*N+Et*rt+Vt*Mt,A[11]=Ht*E+et*V+Et*lt+Vt*ce,A[12]=(Ht=h[12])*p+(et=h[13])*I+(Et=h[14])*j+(Vt=h[15])*dt,A[13]=Ht*_+et*R+Et*tt+Vt*Pt,A[14]=Ht*x+et*N+Et*rt+Vt*Mt,A[15]=Ht*E+et*V+Et*lt+Vt*ce,A},a.M=function(A,c){const h={};for(let p=0;p<c.length;p++){const _=c[p];_ in A&&(h[_]=A[_])}return h},a.N=WA,a.O=I8,a.P=P,a.Q=P8,a.R=zl,a.S=Hl,a.T=Ze,a.U=K,a.V=G,a.W=Ur,a.X=Wt,a.Y=Vm,a.Z=BT,a._=o,a.a=Re,a.a$=function(){return new Float64Array(16)},a.a0=A=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(h=>{c.onloadstart=()=>{h(c)};for(const p of A){const _=window.document.createElement("source");Nr(p)||(c.crossOrigin="Anonymous"),_.src=p,c.appendChild(_)}})},a.a1=function(){return ae++},a.a2=B,a.a3=Bp,a.a4=mu,a.a5=tA,a.a6=D8,a.a7=function(A){const c={};if(A.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,_,x)=>{const E=_||x;return c[p]=!E||E.toLowerCase(),""}),c["max-age"]){const h=parseInt(c["max-age"],10);isNaN(h)?delete c["max-age"]:c["max-age"]=h}return c},a.a8=function(A){return Math.log(A)/Math.LN2},a.a9=function(A){var c=A[0],h=A[1];return c*c+h*h},a.aA=jr,a.aB=g_,a.aC=Ft,a.aD=br,a.aE=Le,a.aF=85.051129,a.aG=function(A){return Math.pow(2,A)},a.aH=M8,a.aI=Rt,a.aJ=Xe,a.aK=F8,a.aL=function(A,c,h){return A[0]=c[0]*h,A[1]=c[1]*h,A[2]=c[2]*h,A},a.aM=function(A,c,h){return A[0]=c[0]+h[0],A[1]=c[1]+h[1],A[2]=c[2]+h[2],A},a.aN=function(A){var c=new it(3);return c[0]=A[0],c[1]=A[1],c[2]=A[2],c},a.aO=function(A,c,h){return A[0]=c[0]*h[0],A[1]=c[1]*h[1],A[2]=c[2]*h[2],A[3]=c[3]*h[3],A},a.aP=function(A,c,h){return A[0]=c[0]-h[0],A[1]=c[1]-h[1],A[2]=c[2]-h[2],A},a.aQ=function(A,c){var h=c[0],p=c[1],_=c[2],x=h*h+p*p+_*_;return x>0&&(x=1/Math.sqrt(x)),A[0]=c[0]*x,A[1]=c[1]*x,A[2]=c[2]*x,A},a.aR=function(A,c,h){var p=c[0],_=c[1],x=c[2],E=h[0],I=h[1],R=h[2];return A[0]=_*R-x*I,A[1]=x*E-p*R,A[2]=p*I-_*E,A},a.aS=function(A,c){return A[0]*c[0]+A[1]*c[1]+A[2]*c[2]},a.aT=R8,a.aU=Cp,a.aV=function(A,c,h,p,_){var x,E=1/Math.tan(c/2);return A[0]=E/h,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=E,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,_!=null&&_!==1/0?(A[10]=(_+p)*(x=1/(p-_)),A[14]=2*_*p*x):(A[10]=-1,A[14]=-2*p),A},a.aW=function(A){var c=new it(16);return c[0]=A[0],c[1]=A[1],c[2]=A[2],c[3]=A[3],c[4]=A[4],c[5]=A[5],c[6]=A[6],c[7]=A[7],c[8]=A[8],c[9]=A[9],c[10]=A[10],c[11]=A[11],c[12]=A[12],c[13]=A[13],c[14]=A[14],c[15]=A[15],c},a.aX=function(A,c,h){var p=Math.sin(h),_=Math.cos(h),x=c[0],E=c[1],I=c[2],R=c[3],N=c[4],V=c[5],j=c[6],tt=c[7];return c!==A&&(A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[0]=x*_+N*p,A[1]=E*_+V*p,A[2]=I*_+j*p,A[3]=R*_+tt*p,A[4]=N*_-x*p,A[5]=V*_-E*p,A[6]=j*_-I*p,A[7]=tt*_-R*p,A},a.aY=function(A,c,h){var p=Math.sin(h),_=Math.cos(h),x=c[4],E=c[5],I=c[6],R=c[7],N=c[8],V=c[9],j=c[10],tt=c[11];return c!==A&&(A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[4]=x*_+N*p,A[5]=E*_+V*p,A[6]=I*_+j*p,A[7]=R*_+tt*p,A[8]=N*_-x*p,A[9]=V*_-E*p,A[10]=j*_-I*p,A[11]=tt*_-R*p,A},a.aZ=function(){const A=new Float32Array(16);return wt(A),A},a.a_=function(){const A=new Float64Array(16);return wt(A),A},a.aa=function(A){return A*Math.PI/180},a.ab=Tt,a.ac=function(A,c){const h=[];for(const p in A)p in c||h.push(p);return h},a.ad=yt,a.ae=function(A){return Math.hypot(A[0],A[1])},a.af=function(A){return A[0]=0,A[1]=0,A},a.ag=function(A,c,h){return A[0]=c[0]*h,A[1]=c[1]*h,A},a.ah=function(A,c){let h=0,p=0;if(A.kind==="constant")p=A.layoutSize;else if(A.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:E}=A,I=_?Tt(Pn.interpolationFactor(_,c,x,E),0,1):0;A.kind==="camera"?p=Wo.number(A.minSize,A.maxSize,I):h=I}return{uSizeT:h,uSize:p}},a.aj=function(A,c,h){let{uSize:p,uSizeT:_}=c,{lowerSize:x,upperSize:E}=h;return A.kind==="source"?x/ch:A.kind==="composite"?Wo.number(x/ch,E/ch,_):p},a.ak=yT,a.al=ot,a.am=function(A,c,h,p){const _=c.y-A.y,x=c.x-A.x,E=p.y-h.y,I=p.x-h.x,R=E*x-I*_;if(R===0)return null;const N=(I*(A.y-h.y)-E*(A.x-h.x))/R;return new P(A.x+N*x,A.y+N*_)},a.an=function(A,c){var h=c[0],p=c[1],_=c[2],x=c[3],E=c[4],I=c[5],R=c[6],N=c[7],V=c[8],j=c[9],tt=c[10],rt=c[11],lt=c[12],dt=c[13],Pt=c[14],Mt=c[15],ce=h*I-p*E,Ht=h*R-_*E,et=h*N-x*E,Et=p*R-_*I,Vt=p*N-x*I,Ee=_*N-x*R,We=V*dt-j*lt,Pe=V*Pt-tt*lt,Ue=V*Mt-rt*lt,lr=j*Pt-tt*dt,Ye=j*Mt-rt*dt,dr=tt*Mt-rt*Pt,ke=ce*dr-Ht*Ye+et*lr+Et*Ue-Vt*Pe+Ee*We;return ke?(A[0]=(I*dr-R*Ye+N*lr)*(ke=1/ke),A[1]=(_*Ye-p*dr-x*lr)*ke,A[2]=(dt*Ee-Pt*Vt+Mt*Et)*ke,A[3]=(tt*Vt-j*Ee-rt*Et)*ke,A[4]=(R*Ue-E*dr-N*Pe)*ke,A[5]=(h*dr-_*Ue+x*Pe)*ke,A[6]=(Pt*et-lt*Ee-Mt*Ht)*ke,A[7]=(V*Ee-tt*et+rt*Ht)*ke,A[8]=(E*Ye-I*Ue+N*We)*ke,A[9]=(p*Ue-h*Ye-x*We)*ke,A[10]=(lt*Vt-dt*et+Mt*ce)*ke,A[11]=(j*et-V*Vt-rt*ce)*ke,A[12]=(I*Pe-E*lr-R*We)*ke,A[13]=(h*lr-p*Pe+_*We)*ke,A[14]=(dt*Ht-lt*Et-Pt*ce)*ke,A[15]=(V*Et-j*Ht+tt*ce)*ke,A):null},a.ao=z8,a.ap=Cm,a.aq=wt,a.ar=function(A){let c=1/0,h=1/0,p=-1/0,_=-1/0;for(const x of A)c=Math.min(c,x.x),h=Math.min(h,x.y),p=Math.max(p,x.x),_=Math.max(_,x.y);return[c,h,p,_]},a.as=Ks,a.at=ee,a.au=function(A,c,h,p){let _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!h[0]&&!h[1])return[0,0];const x=_?p==="map"?-A.bearingInRadians:0:p==="viewport"?A.bearingInRadians:0;if(x){const E=Math.sin(x),I=Math.cos(x);h=[h[0]*I-h[1]*E,h[0]*E+h[1]*I]}return[_?h[0]:ee(c,h[0],A.zoom),_?h[1]:ee(c,h[1],A.zoom)]},a.aw=mT,a.ax=ET,a.ay=gT,a.az=TT,a.b=Me,a.b$=A=>A.type==="line",a.b0=function(A,c,h){const p=new Float64Array(4);return function(_,x,E,I){var R=.5*Math.PI/180;x*=R,E*=R,I*=R;var N=Math.sin(x),V=Math.cos(x),j=Math.sin(E),tt=Math.cos(E),rt=Math.sin(I),lt=Math.cos(I);_[0]=N*tt*lt-V*j*rt,_[1]=V*j*lt+N*tt*rt,_[2]=V*tt*rt-N*j*lt,_[3]=V*tt*lt+N*j*rt}(p,A,c-90,h),p},a.b1=function(A,c,h,p){var _,x,E,I,R,N=c[0],V=c[1],j=c[2],tt=c[3],rt=h[0],lt=h[1],dt=h[2],Pt=h[3];return(x=N*rt+V*lt+j*dt+tt*Pt)<0&&(x=-x,rt=-rt,lt=-lt,dt=-dt,Pt=-Pt),1-x>Y?(_=Math.acos(x),E=Math.sin(_),I=Math.sin((1-p)*_)/E,R=Math.sin(p*_)/E):(I=1-p,R=p),A[0]=I*N+R*rt,A[1]=I*V+R*lt,A[2]=I*j+R*dt,A[3]=I*tt+R*Pt,A},a.b2=function(A){const c=new Float64Array(9);var h,p,_,x,E,I,R,N,V,j,tt,rt,lt,dt,Pt,Mt,ce,Ht;j=(_=(p=A)[0])*(R=_+_),tt=(x=p[1])*R,lt=(E=p[2])*R,dt=E*(N=x+x),Mt=(I=p[3])*R,ce=I*N,Ht=I*(V=E+E),(h=c)[0]=1-(rt=x*N)-(Pt=E*V),h[3]=tt-Ht,h[6]=lt+ce,h[1]=tt+Ht,h[4]=1-j-Pt,h[7]=dt-Mt,h[2]=lt-ce,h[5]=dt+Mt,h[8]=1-j-rt;const et=Xe(-Math.asin(Tt(c[2],-1,1)));let Et,Vt;return Math.hypot(c[5],c[8])<.001?(Et=0,Vt=-Xe(Math.atan2(c[3],c[4]))):(Et=Xe(c[5]===0&&c[8]===0?0:Math.atan2(c[5],c[8])),Vt=Xe(c[1]===0&&c[0]===0?0:Math.atan2(c[1],c[0]))),{roll:Et,pitch:et+90,bearing:Vt}},a.b3=function(A,c){return A.roll==c.roll&&A.pitch==c.pitch&&A.bearing==c.bearing},a.b4=cn,a.b5=so,a.b6=wp,a.b7=Om,a.b8=bp,a.b9=oe,a.bA=Xt,a.bB=ye,a.bC=class extends es{constructor(A,c){super(A,c),this.current=0}set(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))}},a.bD=class extends es{constructor(A,c){super(A,c),this.current=vc}set(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(let c=1;c<16;c++)if(A[c]!==this.current[c]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}}},a.bE=xa,a.bF=_c,a.bG=class extends es{constructor(A,c){super(A,c),this.current=[0,0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))}},a.bH=class extends es{constructor(A,c){super(A,c),this.current=[0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))}},a.bI=nt,a.bJ=function(A,c){var h=Math.sin(c),p=Math.cos(c);return A[0]=p,A[1]=h,A[2]=0,A[3]=-h,A[4]=p,A[5]=0,A[6]=0,A[7]=0,A[8]=1,A},a.bK=function(A,c,h){var p=c[0],_=c[1],x=c[2];return A[0]=p*h[0]+_*h[3]+x*h[6],A[1]=p*h[1]+_*h[4]+x*h[7],A[2]=p*h[2]+_*h[5]+x*h[8],A},a.bL=function(A,c,h,p,_,x,E){var I=1/(c-h),R=1/(p-_),N=1/(x-E);return A[0]=-2*I,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*R,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*N,A[11]=0,A[12]=(c+h)*I,A[13]=(_+p)*R,A[14]=(E+x)*N,A[15]=1,A},a.bM=class extends Ha{},a.bN=Spt,a.bO=class extends Jo{},a.bP=YE,a.bQ=function(A){return A<=1?1:Math.pow(2,Math.ceil(Math.log(A)/Math.LN2))},a.bR=Uk,a.bS=function(A,c,h){var p=c[0],_=c[1],x=c[2],E=h[3]*p+h[7]*_+h[11]*x+h[15];return A[0]=(h[0]*p+h[4]*_+h[8]*x+h[12])/(E=E||1),A[1]=(h[1]*p+h[5]*_+h[9]*x+h[13])/E,A[2]=(h[2]*p+h[6]*_+h[10]*x+h[14])/E,A},a.bT=class extends io{},a.bU=class extends u{},a.bV=function(A,c){return A[0]===c[0]&&A[1]===c[1]&&A[2]===c[2]&&A[3]===c[3]&&A[4]===c[4]&&A[5]===c[5]&&A[6]===c[6]&&A[7]===c[7]&&A[8]===c[8]&&A[9]===c[9]&&A[10]===c[10]&&A[11]===c[11]&&A[12]===c[12]&&A[13]===c[13]&&A[14]===c[14]&&A[15]===c[15]},a.bW=function(A,c){var h=A[0],p=A[1],_=A[2],x=A[3],E=A[4],I=A[5],R=A[6],N=A[7],V=A[8],j=A[9],tt=A[10],rt=A[11],lt=A[12],dt=A[13],Pt=A[14],Mt=A[15],ce=c[0],Ht=c[1],et=c[2],Et=c[3],Vt=c[4],Ee=c[5],We=c[6],Pe=c[7],Ue=c[8],lr=c[9],Ye=c[10],dr=c[11],ke=c[12],Dr=c[13],Xr=c[14],Kr=c[15];return Math.abs(h-ce)<=Y*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(p-Ht)<=Y*Math.max(1,Math.abs(p),Math.abs(Ht))&&Math.abs(_-et)<=Y*Math.max(1,Math.abs(_),Math.abs(et))&&Math.abs(x-Et)<=Y*Math.max(1,Math.abs(x),Math.abs(Et))&&Math.abs(E-Vt)<=Y*Math.max(1,Math.abs(E),Math.abs(Vt))&&Math.abs(I-Ee)<=Y*Math.max(1,Math.abs(I),Math.abs(Ee))&&Math.abs(R-We)<=Y*Math.max(1,Math.abs(R),Math.abs(We))&&Math.abs(N-Pe)<=Y*Math.max(1,Math.abs(N),Math.abs(Pe))&&Math.abs(V-Ue)<=Y*Math.max(1,Math.abs(V),Math.abs(Ue))&&Math.abs(j-lr)<=Y*Math.max(1,Math.abs(j),Math.abs(lr))&&Math.abs(tt-Ye)<=Y*Math.max(1,Math.abs(tt),Math.abs(Ye))&&Math.abs(rt-dr)<=Y*Math.max(1,Math.abs(rt),Math.abs(dr))&&Math.abs(lt-ke)<=Y*Math.max(1,Math.abs(lt),Math.abs(ke))&&Math.abs(dt-Dr)<=Y*Math.max(1,Math.abs(dt),Math.abs(Dr))&&Math.abs(Pt-Xr)<=Y*Math.max(1,Math.abs(Pt),Math.abs(Xr))&&Math.abs(Mt-Kr)<=Y*Math.max(1,Math.abs(Mt),Math.abs(Kr))},a.bX=function(A,c){return A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[4]=c[4],A[5]=c[5],A[6]=c[6],A[7]=c[7],A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},a.bY=A=>A.type==="symbol",a.bZ=A=>A.type==="circle",a.b_=A=>A.type==="heatmap",a.ba=pe,a.bb=Bn,a.bc=function(A,c,h,p,_){return oe(p,_,Tt((A-c)/(h-c),0,1))},a.bd=Zt,a.be=function(){return new Float64Array(4)},a.bf=function(){return new Float64Array(3)},a.bg=function(A,c,h,p){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[0]*Math.cos(p)-_[1]*Math.sin(p),x[1]=_[0]*Math.sin(p)+_[1]*Math.cos(p),x[2]=_[2],A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.bh=function(A,c,h,p){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[0],x[1]=_[1]*Math.cos(p)-_[2]*Math.sin(p),x[2]=_[1]*Math.sin(p)+_[2]*Math.cos(p),A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.bi=function(A,c,h,p){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[2]*Math.sin(p)+_[0]*Math.cos(p),x[1]=_[1],x[2]=_[2]*Math.cos(p)-_[0]*Math.sin(p),A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.bj=function(A,c,h){var p=Math.sin(h),_=Math.cos(h),x=c[0],E=c[1],I=c[2],R=c[3],N=c[8],V=c[9],j=c[10],tt=c[11];return c!==A&&(A[4]=c[4],A[5]=c[5],A[6]=c[6],A[7]=c[7],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[0]=x*_-N*p,A[1]=E*_-V*p,A[2]=I*_-j*p,A[3]=R*_-tt*p,A[8]=x*p+N*_,A[9]=E*p+V*_,A[10]=I*p+j*_,A[11]=R*p+tt*_,A},a.bk=function(A,c){const h=Zt(A,360),p=Zt(c,360),_=p-h,x=p>h?_-360:_+360;return Math.abs(_)<Math.abs(x)?_:x},a.bl=function(A){return A[0]=0,A[1]=0,A[2]=0,A},a.bm=function(A,c,h,p){const _=Math.sqrt(A*A+c*c),x=Math.sqrt(h*h+p*p);A/=_,c/=_,h/=x,p/=x;const E=Math.acos(A*h+c*p);return-c*h+A*p>0?E:-E},a.bn=function(A,c){return A[0]*c[0]+A[1]*c[1]+A[2]*c[2]+A[3]},a.bo=wT,a.bp=function(A,c){const h=Zt(A,2*Math.PI),p=Zt(c,2*Math.PI);return Math.min(Math.abs(h-p),Math.abs(h-p+2*Math.PI),Math.abs(h-p-2*Math.PI))},a.bq=function(A){return Math.hypot(A[0],A[1],A[2])},a.br=function(){const A={},c=Bt.$version;for(const h in Bt.$root){const p=Bt.$root[h];if(p.required){let _=null;_=h==="version"?c:p.type==="array"?[]:{},_!=null&&(A[h]=_)}}return A},a.bs=Yh,a.bt=Lr,a.bu=function(A){A=A.slice();const c=Object.create(null);for(let h=0;h<A.length;h++)c[A[h].id]=A[h];for(let h=0;h<A.length;h++)"ref"in A[h]&&(A[h]=ft(A[h],c[A[h].ref]));return A},a.bv=function(A){if(A.type==="custom")return new Zpt(A);switch(A.type){case"background":return new Wpt(A);case"circle":return new Vft(A);case"fill":return new lpt(A);case"fill-extrusion":return new gpt(A);case"heatmap":return new jft(A);case"hillshade":return new Kft(A);case"line":return new Bpt(A);case"raster":return new Xpt(A);case"symbol":return new x_(A)}},a.bw=de,a.bx=function(A,c){if(!A)return[{command:"setStyle",args:[c]}];let h=[];try{if(!pt(A.version,c.version))return[{command:"setStyle",args:[c]}];pt(A.center,c.center)||h.push({command:"setCenter",args:[c.center]}),pt(A.centerAltitude,c.centerAltitude)||h.push({command:"setCenterAltitude",args:[c.centerAltitude]}),pt(A.zoom,c.zoom)||h.push({command:"setZoom",args:[c.zoom]}),pt(A.bearing,c.bearing)||h.push({command:"setBearing",args:[c.bearing]}),pt(A.pitch,c.pitch)||h.push({command:"setPitch",args:[c.pitch]}),pt(A.roll,c.roll)||h.push({command:"setRoll",args:[c.roll]}),pt(A.sprite,c.sprite)||h.push({command:"setSprite",args:[c.sprite]}),pt(A.glyphs,c.glyphs)||h.push({command:"setGlyphs",args:[c.glyphs]}),pt(A.transition,c.transition)||h.push({command:"setTransition",args:[c.transition]}),pt(A.light,c.light)||h.push({command:"setLight",args:[c.light]}),pt(A.terrain,c.terrain)||h.push({command:"setTerrain",args:[c.terrain]}),pt(A.sky,c.sky)||h.push({command:"setSky",args:[c.sky]}),pt(A.projection,c.projection)||h.push({command:"setProjection",args:[c.projection]});const p={},_=[];(function(E,I,R,N){let V;for(V in I=I||{},E=E||{})Object.prototype.hasOwnProperty.call(E,V)&&(Object.prototype.hasOwnProperty.call(I,V)||le(V,R,N));for(V in I)Object.prototype.hasOwnProperty.call(I,V)&&(Object.prototype.hasOwnProperty.call(E,V)?pt(E[V],I[V])||(E[V].type==="geojson"&&I[V].type==="geojson"&&te(E,I,V)?Dt(R,{command:"setGeoJSONSourceData",args:[V,I[V].data]}):ge(V,I,R,N)):Gt(V,I,R))})(A.sources,c.sources,_,p);const x=[];A.layers&&A.layers.forEach(E=>{"source"in E&&p[E.source]?h.push({command:"removeLayer",args:[E.id]}):x.push(E)}),h=h.concat(_),function(E,I,R){I=I||[];const N=(E=E||[]).map(ve),V=I.map(ve),j=E.reduce(me,{}),tt=I.reduce(me,{}),rt=N.slice(),lt=Object.create(null);let dt,Pt,Mt,ce,Ht;for(let et=0,Et=0;et<N.length;et++)dt=N[et],Object.prototype.hasOwnProperty.call(tt,dt)?Et++:(Dt(R,{command:"removeLayer",args:[dt]}),rt.splice(rt.indexOf(dt,Et),1));for(let et=0,Et=0;et<V.length;et++)dt=V[V.length-1-et],rt[rt.length-1-et]!==dt&&(Object.prototype.hasOwnProperty.call(j,dt)?(Dt(R,{command:"removeLayer",args:[dt]}),rt.splice(rt.lastIndexOf(dt,rt.length-Et),1)):Et++,ce=rt[rt.length-et],Dt(R,{command:"addLayer",args:[tt[dt],ce]}),rt.splice(rt.length-et,0,dt),lt[dt]=!0);for(let et=0;et<V.length;et++)if(dt=V[et],Pt=j[dt],Mt=tt[dt],!lt[dt]&&!pt(Pt,Mt))if(pt(Pt.source,Mt.source)&&pt(Pt["source-layer"],Mt["source-layer"])&&pt(Pt.type,Mt.type)){for(Ht in he(Pt.layout,Mt.layout,R,dt,null,"setLayoutProperty"),he(Pt.paint,Mt.paint,R,dt,null,"setPaintProperty"),pt(Pt.filter,Mt.filter)||Dt(R,{command:"setFilter",args:[dt,Mt.filter]}),pt(Pt.minzoom,Mt.minzoom)&&pt(Pt.maxzoom,Mt.maxzoom)||Dt(R,{command:"setLayerZoomRange",args:[dt,Mt.minzoom,Mt.maxzoom]}),Pt)Object.prototype.hasOwnProperty.call(Pt,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?he(Pt[Ht],Mt[Ht],R,dt,Ht.slice(6),"setPaintProperty"):pt(Pt[Ht],Mt[Ht])||Dt(R,{command:"setLayerProperty",args:[dt,Ht,Mt[Ht]]}));for(Ht in Mt)Object.prototype.hasOwnProperty.call(Mt,Ht)&&!Object.prototype.hasOwnProperty.call(Pt,Ht)&&Ht!=="layout"&&Ht!=="paint"&&Ht!=="filter"&&Ht!=="metadata"&&Ht!=="minzoom"&&Ht!=="maxzoom"&&(Ht.indexOf("paint.")===0?he(Pt[Ht],Mt[Ht],R,dt,Ht.slice(6),"setPaintProperty"):pt(Pt[Ht],Mt[Ht])||Dt(R,{command:"setLayerProperty",args:[dt,Ht,Mt[Ht]]}))}else Dt(R,{command:"removeLayer",args:[dt]}),ce=rt[rt.lastIndexOf(dt)+1],Dt(R,{command:"addLayer",args:[Mt,ce]})}(x,c.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[c]}]}return h},a.by=function(A){const c=[],h=A.id;return h===void 0&&c.push({message:`layers.${h}: missing required property "id"`}),A.render===void 0&&c.push({message:`layers.${h}: missing required method "render"`}),A.renderingMode&&A.renderingMode!=="2d"&&A.renderingMode!=="3d"&&c.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),c},a.bz=function A(c,h){if(Array.isArray(c)){if(!Array.isArray(h)||c.length!==h.length)return!1;for(let p=0;p<c.length;p++)if(!A(c[p],h[p]))return!1;return!0}if(typeof c=="object"&&c!==null&&h!==null){if(typeof h!="object"||Object.keys(c).length!==Object.keys(h).length)return!1;for(const p in c)if(!A(c[p],h[p]))return!1;return!0}return c===h},a.c=gr,a.c0=A=>A.type==="fill",a.c1=A=>A.type==="fill-extrusion",a.c2=A=>A.type==="hillshade",a.c3=A=>A.type==="raster",a.c4=A=>A.type==="background",a.c5=A=>A.type==="custom",a.c6=De,a.c7=function(A,c,h){const p=re(c.x-h.x,c.y-h.y),_=re(A.x-h.x,A.y-h.y);var x,E;return Xe(Math.atan2(p[0]*_[1]-p[1]*_[0],(x=p)[0]*(E=_)[0]+x[1]*E[1]))},a.c8=at,a.c9=function(A,c,h){var p=c[0],_=c[1];return A[0]=h[0]*p+h[4]*_+h[12],A[1]=h[1]*p+h[5]*_+h[13],A},a.cA=h8,a.cB=fu,a.cC=ue,a.ca=function(A,c){const{x:h,y:p}=Vm.fromLngLat(c);return!(A<0||A>25||p<0||p>=1||h<0||h>=1)},a.cb=function(A,c){return A[0]=c[0],A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=c[1],A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=c[2],A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},a.cc=class extends Mi{},a.cd=agt,a.cf=function(A){return A.message===er},a.cg=xr,a.ch=function(A,c){Re.REGISTERED_PROTOCOLS[A]=c},a.ci=function(A){delete Re.REGISTERED_PROTOCOLS[A]},a.cj=function(A,c){const h={};for(let _=0;_<A.length;_++){const x=c&&c[A[_].id]||zd(A[_]);c&&(c[A[_].id]=x);let E=h[x];E||(E=h[x]=[]),E.push(A[_])}const p=[];for(const _ in h)p.push(h[_]);return p},a.ck=Sr,a.cl=U8,a.cm=N8,a.cn=d8,a.co=function(A){A.bucket.createArrays(),A.bucket.tilePixelRatio=Wt/(512*A.bucket.overscaling),A.bucket.compareText={},A.bucket.iconsNeedLinear=!1;const c=A.bucket.layers[0],h=c.layout,p=c._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new be(A.bucket.zoom+1),A.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new be(A.bucket.zoom+1),A.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new be(18))};if(A.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:V}=A.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new be(N),A.canonical),p["text-size"].possiblyEvaluate(new be(V),A.canonical)]}if(A.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:V}=A.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new be(N),A.canonical),p["icon-size"].possiblyEvaluate(new be(V),A.canonical)]}const x=h.get("text-line-height")*Ks,E=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",I=h.get("text-keep-upright"),R=h.get("text-size");for(const N of A.bucket.features){const V=h.get("text-font").evaluate(N,{},A.canonical).join(","),j=R.evaluate(N,{},A.canonical),tt=_.layoutTextSize.evaluate(N,{},A.canonical),rt=_.layoutIconSize.evaluate(N,{},A.canonical),lt={horizontal:{},vertical:void 0},dt=N.text;let Pt,Mt=[0,0];if(dt){const et=dt.toString(),Et=h.get("text-letter-spacing").evaluate(N,{},A.canonical)*Ks,Vt=Wd(et)?Et:0,Ee=h.get("text-anchor").evaluate(N,{},A.canonical),We=X8(c,N,A.canonical);if(!We){const Ye=h.get("text-radial-offset").evaluate(N,{},A.canonical);Mt=Ye?$8(Ee,[Ye*Ks,CT]):h.get("text-offset").evaluate(N,{},A.canonical).map(dr=>dr*Ks)}let Pe=E?"center":h.get("text-justify").evaluate(N,{},A.canonical);const Ue=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(N,{},A.canonical)*Ks:1/0,lr=()=>{A.bucket.allowVerticalPlacement&&ah(et)&&(lt.vertical=v_(dt,A.glyphMap,A.glyphPositions,A.imagePositions,V,Ue,x,Ee,"left",Vt,Mt,a.ai.vertical,!0,tt,j))};if(!E&&We){const Ye=new Set;if(Pe==="auto")for(let ke=0;ke<We.values.length;ke+=2)Ye.add(ET(We.values[ke]));else Ye.add(Pe);let dr=!1;for(const ke of Ye)if(!lt.horizontal[ke])if(dr)lt.horizontal[ke]=lt.horizontal[0];else{const Dr=v_(dt,A.glyphMap,A.glyphPositions,A.imagePositions,V,Ue,x,"center",ke,Vt,Mt,a.ai.horizontal,!1,tt,j);Dr&&(lt.horizontal[ke]=Dr,dr=Dr.positionedLines.length===1)}lr()}else{Pe==="auto"&&(Pe=ET(Ee));const Ye=v_(dt,A.glyphMap,A.glyphPositions,A.imagePositions,V,Ue,x,Ee,Pe,Vt,Mt,a.ai.horizontal,!1,tt,j);Ye&&(lt.horizontal[Pe]=Ye),lr(),ah(et)&&E&&I&&(lt.vertical=v_(dt,A.glyphMap,A.glyphPositions,A.imagePositions,V,Ue,x,Ee,Pe,Vt,Mt,a.ai.vertical,!1,tt,j))}}let ce=!1;if(N.icon&&N.icon.name){const et=A.imageMap[N.icon.name];et&&(Pt=Vpt(A.imagePositions[N.icon.name],h.get("icon-offset").evaluate(N,{},A.canonical),h.get("icon-anchor").evaluate(N,{},A.canonical)),ce=!!et.sdf,A.bucket.sdfIcons===void 0?A.bucket.sdfIcons=ce:A.bucket.sdfIcons!==ce&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==A.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(A.bucket.iconsNeedLinear=!0))}const Ht=Y8(lt.horizontal)||lt.vertical;A.bucket.iconsInText=!!Ht&&Ht.iconsInText,(Ht||Pt)&&sgt(A.bucket,N,lt,Pt,A.imageMap,_,tt,rt,Mt,ce,A.canonical,A.subdivisionGranularity)}A.showCollisionBoxes&&A.bucket.generateCollisionDebugBuffers()},a.cp=cT,a.cq=nT,a.cr=lT,a.cs=Dm,a.ct=AT,a.cu=class{constructor(A){this._marks={start:[A.url,"start"].join("#"),end:[A.url,"end"].join("#"),measure:A.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let A=performance.getEntriesByName(this._marks.measure);return A.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),A=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),A}},a.cv=function(A,c,h,p,_){return o(this,void 0,void 0,function*(){if(G())try{return yield Ur(A,c,h,p,_)}catch{}return function(x,E,I,R,N){const V=x.width,j=x.height;Ir&&$e||(Ir=new OffscreenCanvas(V,j),$e=Ir.getContext("2d",{willReadFrequently:!0})),Ir.width=V,Ir.height=j,$e.drawImage(x,0,0,V,j);const tt=$e.getImageData(E,I,R,N);return $e.clearRect(0,0,V,j),tt.data}(A,c,h,p,_)})},a.cw=O8,a.cx=d,a.cy=v,a.cz=Jk,a.d=A=>o(void 0,void 0,void 0,function*(){if(A.byteLength===0)return createImageBitmap(new ImageData(1,1));const c=new Blob([new Uint8Array(A)],{type:"image/png"});try{return createImageBitmap(c)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=Nt,a.f=A=>new Promise((c,h)=>{const p=new Image;p.onload=()=>{c(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Qt})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(A)],{type:"image/png"});p.src=A.byteLength?URL.createObjectURL(_):Qt}),a.g=sr,a.h=(A,c)=>Zr(Nt(A,{type:"json"}),c),a.i=or,a.j=an,a.k=In,a.l=(A,c)=>Zr(Nt(A,{type:"arrayBuffer"}),c),a.m=Zr,a.n=function(A){return new AT(A).readFields(Mpt,[])},a.o=Pm,a.p=A8,a.q=pn,a.r=GA,a.s=Nr,a.t=pp,a.u=sh,a.v=Bt,a.w=Ve,a.x=function(A){let[c,h,p]=A;return h+=90,h*=Math.PI/180,p*=Math.PI/180,{x:c*Math.cos(h)*Math.sin(p),y:c*Math.sin(h)*Math.sin(p),z:c*Math.cos(p)}},a.y=Wo,a.z=be}),i("worker",["./shared"],function(a){class o{constructor(ct){this.keyCache={},ct&&this.replace(ct)}replace(ct){this._layerConfigs={},this._layers={},this.update(ct,[])}update(ct,ft){for(const Dt of ct){this._layerConfigs[Dt.id]=Dt;const Gt=this._layers[Dt.id]=a.bv(Dt);Gt._featureFilter=a.a4(Gt.filter),this.keyCache[Dt.id]&&delete this.keyCache[Dt.id]}for(const Dt of ft)delete this.keyCache[Dt],delete this._layerConfigs[Dt],delete this._layers[Dt];this.familiesBySource={};const pt=a.cj(Object.values(this._layerConfigs),this.keyCache);for(const Dt of pt){const Gt=Dt.map(me=>this._layers[me.id]),le=Gt[0];if(le.visibility==="none")continue;const ge=le.source||"";let te=this.familiesBySource[ge];te||(te=this.familiesBySource[ge]={});const he=le.sourceLayer||"_geojsonTileLayer";let ve=te[he];ve||(ve=te[he]=[]),ve.push(Gt)}}}class d{constructor(ct){const ft={},pt=[];for(const ge in ct){const te=ct[ge],he=ft[ge]={};for(const ve in te){const me=te[+ve];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const Yt={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};pt.push(Yt),he[ve]={rect:Yt,metrics:me.metrics}}}const{w:Dt,h:Gt}=a.p(pt),le=new a.o({width:Dt||1,height:Gt||1});for(const ge in ct){const te=ct[ge];for(const he in te){const ve=te[+he];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const me=ft[ge][he].rect;a.o.copy(ve.bitmap,le,{x:0,y:0},{x:me.x+1,y:me.y+1},ve.bitmap)}}this.image=le,this.positions=ft}}a.ck("GlyphAtlas",d);class f{constructor(ct){this.tileID=new a.S(ct.tileID.overscaledZ,ct.tileID.wrap,ct.tileID.canonical.z,ct.tileID.canonical.x,ct.tileID.canonical.y),this.uid=ct.uid,this.zoom=ct.zoom,this.pixelRatio=ct.pixelRatio,this.tileSize=ct.tileSize,this.source=ct.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ct.showCollisionBoxes,this.collectResourceTiming=!!ct.collectResourceTiming,this.returnDependencies=!!ct.returnDependencies,this.promoteId=ct.promoteId,this.inFlightDependencies=[]}parse(ct,ft,pt,Dt,Gt){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=ct,this.collisionBoxArray=new a.a2;const le=new a.cl(Object.keys(ct.layers).sort()),ge=new a.cm(this.tileID,this.promoteId);ge.bucketLayerIDs=[];const te={},he={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pt,subdivisionGranularity:Gt},ve=ft.familiesBySource[this.source];for(const Qr in ve){const vr=ct.layers[Qr];if(!vr)continue;vr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Qr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wn=le.encode(Qr),Ai=[];for(let mn=0;mn<vr.length;mn++){const Dn=vr.feature(mn),gn=ge.getId(Dn,Qr);Ai.push({feature:Dn,id:gn,index:mn,sourceLayerIndex:wn})}for(const mn of ve[Qr]){const Dn=mn[0];Dn.source!==this.source&&a.w(`layer.source = ${Dn.source} does not equal this.source = ${this.source}`),Dn.minzoom&&this.zoom<Math.floor(Dn.minzoom)||Dn.maxzoom&&this.zoom>=Dn.maxzoom||Dn.visibility!=="none"&&(m(mn,this.zoom,pt),(te[Dn.id]=Dn.createBucket({index:ge.bucketLayerIDs.length,layers:mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wn,sourceID:this.source})).populate(Ai,he,this.tileID.canonical),ge.bucketLayerIDs.push(mn.map(gn=>gn.id)))}}const me=a.bA(he.glyphDependencies,Qr=>Object.keys(Qr).map(Number));this.inFlightDependencies.forEach(Qr=>Qr==null?void 0:Qr.abort()),this.inFlightDependencies=[];let Yt=Promise.resolve({});if(Object.keys(me).length){const Qr=new AbortController;this.inFlightDependencies.push(Qr),Yt=Dt.sendAsync({type:"GG",data:{stacks:me,source:this.source,tileID:this.tileID,type:"glyphs"}},Qr)}const ur=Object.keys(he.iconDependencies);let ir=Promise.resolve({});if(ur.length){const Qr=new AbortController;this.inFlightDependencies.push(Qr),ir=Dt.sendAsync({type:"GI",data:{icons:ur,source:this.source,tileID:this.tileID,type:"icons"}},Qr)}const tr=Object.keys(he.patternDependencies);let Mr=Promise.resolve({});if(tr.length){const Qr=new AbortController;this.inFlightDependencies.push(Qr),Mr=Dt.sendAsync({type:"GI",data:{icons:tr,source:this.source,tileID:this.tileID,type:"patterns"}},Qr)}const[Fe,nr,_r]=yield Promise.all([Yt,ir,Mr]),Fr=new d(Fe),Yr=new a.cn(nr,_r);for(const Qr in te){const vr=te[Qr];vr instanceof a.a3?(m(vr.layers,this.zoom,pt),a.co({bucket:vr,glyphMap:Fe,glyphPositions:Fr.positions,imageMap:nr,imagePositions:Yr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:he.subdivisionGranularity})):vr.hasPattern&&(vr instanceof a.cp||vr instanceof a.cq||vr instanceof a.cr)&&(m(vr.layers,this.zoom,pt),vr.addFeatures(he,this.tileID.canonical,Yr.patternPositions))}return this.status="done",{buckets:Object.values(te).filter(Qr=>!Qr.isEmpty()),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fr.image,imageAtlas:Yr,glyphMap:this.returnDependencies?Fe:null,iconMap:this.returnDependencies?nr:null,glyphPositions:this.returnDependencies?Fr.positions:null}})}}function m(Bt,ct,ft){const pt=new a.z(ct);for(const Dt of Bt)Dt.recalculate(pt,ft)}class v{constructor(ct,ft,pt){this.actor=ct,this.layerIndex=ft,this.availableImages=pt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ct,ft){return a._(this,void 0,void 0,function*(){const pt=yield a.l(ct.request,ft);try{return{vectorTile:new a.cs.VectorTile(new a.ct(pt.data)),rawData:pt.data,cacheControl:pt.cacheControl,expires:pt.expires}}catch(Dt){const Gt=new Uint8Array(pt.data);let le=`Unable to parse the tile at ${ct.request.url}, `;throw le+=Gt[0]===31&&Gt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Dt.message}`,new Error(le)}})}loadTile(ct){return a._(this,void 0,void 0,function*(){const ft=ct.uid,pt=!!(ct&&ct.request&&ct.request.collectResourceTiming)&&new a.cu(ct.request),Dt=new f(ct);this.loading[ft]=Dt;const Gt=new AbortController;Dt.abort=Gt;try{const le=yield this.loadVectorTile(ct,Gt);if(delete this.loading[ft],!le)return null;const ge=le.rawData,te={};le.expires&&(te.expires=le.expires),le.cacheControl&&(te.cacheControl=le.cacheControl);const he={};if(pt){const me=pt.finish();me&&(he.resourceTiming=JSON.parse(JSON.stringify(me)))}Dt.vectorTile=le.vectorTile;const ve=Dt.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,ct.subdivisionGranularity);this.loaded[ft]=Dt,this.fetching[ft]={rawTileData:ge,cacheControl:te,resourceTiming:he};try{const me=yield ve;return a.e({rawTileData:ge.slice(0)},me,te,he)}finally{delete this.fetching[ft]}}catch(le){throw delete this.loading[ft],Dt.status="done",this.loaded[ft]=Dt,le}})}reloadTile(ct){return a._(this,void 0,void 0,function*(){const ft=ct.uid;if(!this.loaded||!this.loaded[ft])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const pt=this.loaded[ft];if(pt.showCollisionBoxes=ct.showCollisionBoxes,pt.status==="parsing"){const Dt=yield pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,ct.subdivisionGranularity);let Gt;if(this.fetching[ft]){const{rawTileData:le,cacheControl:ge,resourceTiming:te}=this.fetching[ft];delete this.fetching[ft],Gt=a.e({rawTileData:le.slice(0)},Dt,ge,te)}else Gt=Dt;return Gt}if(pt.status==="done"&&pt.vectorTile)return pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,ct.subdivisionGranularity)})}abortTile(ct){return a._(this,void 0,void 0,function*(){const ft=this.loading,pt=ct.uid;ft&&ft[pt]&&ft[pt].abort&&(ft[pt].abort.abort(),delete ft[pt])})}removeTile(ct){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ct.uid]&&delete this.loaded[ct.uid]})}}class C{constructor(){this.loaded={}}loadTile(ct){return a._(this,void 0,void 0,function*(){const{uid:ft,encoding:pt,rawImageData:Dt,redFactor:Gt,greenFactor:le,blueFactor:ge,baseShift:te}=ct,he=Dt.width+2,ve=Dt.height+2,me=a.b(Dt)?new a.R({width:he,height:ve},yield a.cv(Dt,-1,-1,he,ve)):Dt,Yt=new a.cw(ft,me,pt,Gt,le,ge,te);return this.loaded=this.loaded||{},this.loaded[ft]=Yt,Yt})}removeTile(ct){const ft=this.loaded,pt=ct.uid;ft&&ft[pt]&&delete ft[pt]}}var b,P,F=function(){if(P)return b;function Bt(ft,pt){if(ft.length!==0){ct(ft[0],pt);for(var Dt=1;Dt<ft.length;Dt++)ct(ft[Dt],!pt)}}function ct(ft,pt){for(var Dt=0,Gt=0,le=0,ge=ft.length,te=ge-1;le<ge;te=le++){var he=(ft[le][0]-ft[te][0])*(ft[te][1]+ft[le][1]),ve=Dt+he;Gt+=Math.abs(Dt)>=Math.abs(he)?Dt-ve+he:he-ve+Dt,Dt=ve}Dt+Gt>=0!=!!pt&&ft.reverse()}return P=1,b=function ft(pt,Dt){var Gt,le=pt&&pt.type;if(le==="FeatureCollection")for(Gt=0;Gt<pt.features.length;Gt++)ft(pt.features[Gt],Dt);else if(le==="GeometryCollection")for(Gt=0;Gt<pt.geometries.length;Gt++)ft(pt.geometries[Gt],Dt);else if(le==="Feature")ft(pt.geometry,Dt);else if(le==="Polygon")Bt(pt.coordinates,Dt);else if(le==="MultiPolygon")for(Gt=0;Gt<pt.coordinates.length;Gt++)Bt(pt.coordinates[Gt],Dt);return pt}}(),U=a.cx(F);const k=a.cs.VectorTileFeature.prototype.toGeoJSON;class z{constructor(ct){this._feature=ct,this.extent=a.X,this.type=ct.type,this.properties=ct.tags,"id"in ct&&!isNaN(ct.id)&&(this.id=parseInt(ct.id,10))}loadGeometry(){if(this._feature.type===1){const ct=[];for(const ft of this._feature.geometry)ct.push([new a.P(ft[0],ft[1])]);return ct}{const ct=[];for(const ft of this._feature.geometry){const pt=[];for(const Dt of ft)pt.push(new a.P(Dt[0],Dt[1]));ct.push(pt)}return ct}}toGeoJSON(ct,ft,pt){return k.call(this,ct,ft,pt)}}class K{constructor(ct){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.X,this.length=ct.length,this._features=ct}feature(ct){return new z(this._features[ct])}}var G,X,Y,it={exports:{}},nt=function(){if(Y)return it.exports;Y=1;var Bt=a.cA(),ct=function(){if(X)return G;X=1;var ve=a.cy(),me=a.cz().VectorTileFeature;function Yt(ir,tr){this.options=tr||{},this.features=ir,this.length=ir.length}function ur(ir,tr){this.id=typeof ir.id=="number"?ir.id:void 0,this.type=ir.type,this.rawGeometry=ir.type===1?[ir.geometry]:ir.geometry,this.properties=ir.tags,this.extent=tr||4096}return G=Yt,Yt.prototype.feature=function(ir){return new ur(this.features[ir],this.options.extent)},ur.prototype.loadGeometry=function(){var ir=this.rawGeometry;this.geometry=[];for(var tr=0;tr<ir.length;tr++){for(var Mr=ir[tr],Fe=[],nr=0;nr<Mr.length;nr++)Fe.push(new ve(Mr[nr][0],Mr[nr][1]));this.geometry.push(Fe)}return this.geometry},ur.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ir=this.geometry,tr=1/0,Mr=-1/0,Fe=1/0,nr=-1/0,_r=0;_r<ir.length;_r++)for(var Fr=ir[_r],Yr=0;Yr<Fr.length;Yr++){var Qr=Fr[Yr];tr=Math.min(tr,Qr.x),Mr=Math.max(Mr,Qr.x),Fe=Math.min(Fe,Qr.y),nr=Math.max(nr,Qr.y)}return[tr,Fe,Mr,nr]},ur.prototype.toGeoJSON=me.prototype.toGeoJSON,G}();function ft(ve){var me=new Bt;return function(Yt,ur){for(var ir in Yt.layers)ur.writeMessage(3,pt,Yt.layers[ir])}(ve,me),me.finish()}function pt(ve,me){var Yt;me.writeVarintField(15,ve.version||1),me.writeStringField(1,ve.name||""),me.writeVarintField(5,ve.extent||4096);var ur={keys:[],values:[],keycache:{},valuecache:{}};for(Yt=0;Yt<ve.length;Yt++)ur.feature=ve.feature(Yt),me.writeMessage(2,Dt,ur);var ir=ur.keys;for(Yt=0;Yt<ir.length;Yt++)me.writeStringField(3,ir[Yt]);var tr=ur.values;for(Yt=0;Yt<tr.length;Yt++)me.writeMessage(4,he,tr[Yt])}function Dt(ve,me){var Yt=ve.feature;Yt.id!==void 0&&me.writeVarintField(1,Yt.id),me.writeMessage(2,Gt,ve),me.writeVarintField(3,Yt.type),me.writeMessage(4,te,Yt)}function Gt(ve,me){var Yt=ve.feature,ur=ve.keys,ir=ve.values,tr=ve.keycache,Mr=ve.valuecache;for(var Fe in Yt.properties){var nr=Yt.properties[Fe],_r=tr[Fe];if(nr!==null){_r===void 0&&(ur.push(Fe),tr[Fe]=_r=ur.length-1),me.writeVarint(_r);var Fr=typeof nr;Fr!=="string"&&Fr!=="boolean"&&Fr!=="number"&&(nr=JSON.stringify(nr));var Yr=Fr+":"+nr,Qr=Mr[Yr];Qr===void 0&&(ir.push(nr),Mr[Yr]=Qr=ir.length-1),me.writeVarint(Qr)}}}function le(ve,me){return(me<<3)+(7&ve)}function ge(ve){return ve<<1^ve>>31}function te(ve,me){for(var Yt=ve.loadGeometry(),ur=ve.type,ir=0,tr=0,Mr=Yt.length,Fe=0;Fe<Mr;Fe++){var nr=Yt[Fe],_r=1;ur===1&&(_r=nr.length),me.writeVarint(le(1,_r));for(var Fr=ur===3?nr.length-1:nr.length,Yr=0;Yr<Fr;Yr++){Yr===1&&ur!==1&&me.writeVarint(le(2,Fr-1));var Qr=nr[Yr].x-ir,vr=nr[Yr].y-tr;me.writeVarint(ge(Qr)),me.writeVarint(ge(vr)),ir+=Qr,tr+=vr}ur===3&&me.writeVarint(le(7,1))}}function he(ve,me){var Yt=typeof ve;Yt==="string"?me.writeStringField(1,ve):Yt==="boolean"?me.writeBooleanField(7,ve):Yt==="number"&&(ve%1!=0?me.writeDoubleField(3,ve):ve<0?me.writeSVarintField(6,ve):me.writeVarintField(5,ve))}return it.exports=ft,it.exports.fromVectorTileJs=ft,it.exports.fromGeojsonVt=function(ve,me){me=me||{};var Yt={};for(var ur in ve)Yt[ur]=new ct(ve[ur].features,me),Yt[ur].name=ur,Yt[ur].version=me.version,Yt[ur].extent=me.extent;return ft({layers:Yt})},it.exports.GeoJSONWrapper=ct,it.exports}(),wt=a.cx(nt);const Ct={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Bt=>Bt},st=Math.fround||(ot=new Float32Array(1),Bt=>(ot[0]=+Bt,ot[0]));var ot;const vt=3,yt=5,re=6;class Wt{constructor(ct){this.options=Object.assign(Object.create(Ct),ct),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ct){const{log:ft,minZoom:pt,maxZoom:Dt}=this.options;ft&&console.time("total time");const Gt=`prepare ${ct.length} points`;ft&&console.time(Gt),this.points=ct;const le=[];for(let te=0;te<ct.length;te++){const he=ct[te];if(!he.geometry)continue;const[ve,me]=he.geometry.coordinates,Yt=st(oe(ve)),ur=st(pe(me));le.push(Yt,ur,1/0,te,-1,1),this.options.reduce&&le.push(0)}let ge=this.trees[Dt+1]=this._createTree(le);ft&&console.timeEnd(Gt);for(let te=Dt;te>=pt;te--){const he=+Date.now();ge=this.trees[te]=this._createTree(this._cluster(ge,te)),ft&&console.log("z%d: %d clusters in %dms",te,ge.numItems,+Date.now()-he)}return ft&&console.timeEnd("total time"),this}getClusters(ct,ft){let pt=((ct[0]+180)%360+360)%360-180;const Dt=Math.max(-90,Math.min(90,ct[1]));let Gt=ct[2]===180?180:((ct[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,ct[3]));if(ct[2]-ct[0]>=360)pt=-180,Gt=180;else if(pt>Gt){const me=this.getClusters([pt,Dt,180,le],ft),Yt=this.getClusters([-180,Dt,Gt,le],ft);return me.concat(Yt)}const ge=this.trees[this._limitZoom(ft)],te=ge.range(oe(pt),pe(le),oe(Gt),pe(Dt)),he=ge.data,ve=[];for(const me of te){const Yt=this.stride*me;ve.push(he[Yt+yt]>1?ee(he,Yt,this.clusterProps):this.points[he[Yt+vt]])}return ve}getChildren(ct){const ft=this._getOriginId(ct),pt=this._getOriginZoom(ct),Dt="No cluster with the specified id.",Gt=this.trees[pt];if(!Gt)throw new Error(Dt);const le=Gt.data;if(ft*this.stride>=le.length)throw new Error(Dt);const ge=this.options.radius/(this.options.extent*Math.pow(2,pt-1)),te=Gt.within(le[ft*this.stride],le[ft*this.stride+1],ge),he=[];for(const ve of te){const me=ve*this.stride;le[me+4]===ct&&he.push(le[me+yt]>1?ee(le,me,this.clusterProps):this.points[le[me+vt]])}if(he.length===0)throw new Error(Dt);return he}getLeaves(ct,ft,pt){const Dt=[];return this._appendLeaves(Dt,ct,ft=ft||10,pt=pt||0,0),Dt}getTile(ct,ft,pt){const Dt=this.trees[this._limitZoom(ct)],Gt=Math.pow(2,ct),{extent:le,radius:ge}=this.options,te=ge/le,he=(pt-te)/Gt,ve=(pt+1+te)/Gt,me={features:[]};return this._addTileFeatures(Dt.range((ft-te)/Gt,he,(ft+1+te)/Gt,ve),Dt.data,ft,pt,Gt,me),ft===0&&this._addTileFeatures(Dt.range(1-te/Gt,he,1,ve),Dt.data,Gt,pt,Gt,me),ft===Gt-1&&this._addTileFeatures(Dt.range(0,he,te/Gt,ve),Dt.data,-1,pt,Gt,me),me.features.length?me:null}getClusterExpansionZoom(ct){let ft=this._getOriginZoom(ct)-1;for(;ft<=this.options.maxZoom;){const pt=this.getChildren(ct);if(ft++,pt.length!==1)break;ct=pt[0].properties.cluster_id}return ft}_appendLeaves(ct,ft,pt,Dt,Gt){const le=this.getChildren(ft);for(const ge of le){const te=ge.properties;if(te&&te.cluster?Gt+te.point_count<=Dt?Gt+=te.point_count:Gt=this._appendLeaves(ct,te.cluster_id,pt,Dt,Gt):Gt<Dt?Gt++:ct.push(ge),ct.length===pt)break}return Gt}_createTree(ct){const ft=new a.az(ct.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pt=0;pt<ct.length;pt+=this.stride)ft.add(ct[pt],ct[pt+1]);return ft.finish(),ft.data=ct,ft}_addTileFeatures(ct,ft,pt,Dt,Gt,le){for(const ge of ct){const te=ge*this.stride,he=ft[te+yt]>1;let ve,me,Yt;if(he)ve=Zt(ft,te,this.clusterProps),me=ft[te],Yt=ft[te+1];else{const tr=this.points[ft[te+vt]];ve=tr.properties;const[Mr,Fe]=tr.geometry.coordinates;me=oe(Mr),Yt=pe(Fe)}const ur={type:1,geometry:[[Math.round(this.options.extent*(me*Gt-pt)),Math.round(this.options.extent*(Yt*Gt-Dt))]],tags:ve};let ir;ir=he||this.options.generateId?ft[te+vt]:this.points[ft[te+vt]].id,ir!==void 0&&(ur.id=ir),le.features.push(ur)}}_limitZoom(ct){return Math.max(this.options.minZoom,Math.min(Math.floor(+ct),this.options.maxZoom+1))}_cluster(ct,ft){const{radius:pt,extent:Dt,reduce:Gt,minPoints:le}=this.options,ge=pt/(Dt*Math.pow(2,ft)),te=ct.data,he=[],ve=this.stride;for(let me=0;me<te.length;me+=ve){if(te[me+2]<=ft)continue;te[me+2]=ft;const Yt=te[me],ur=te[me+1],ir=ct.within(te[me],te[me+1],ge),tr=te[me+yt];let Mr=tr;for(const Fe of ir){const nr=Fe*ve;te[nr+2]>ft&&(Mr+=te[nr+yt])}if(Mr>tr&&Mr>=le){let Fe,nr=Yt*tr,_r=ur*tr,Fr=-1;const Yr=((me/ve|0)<<5)+(ft+1)+this.points.length;for(const Qr of ir){const vr=Qr*ve;if(te[vr+2]<=ft)continue;te[vr+2]=ft;const wn=te[vr+yt];nr+=te[vr]*wn,_r+=te[vr+1]*wn,te[vr+4]=Yr,Gt&&(Fe||(Fe=this._map(te,me,!0),Fr=this.clusterProps.length,this.clusterProps.push(Fe)),Gt(Fe,this._map(te,vr)))}te[me+4]=Yr,he.push(nr/Mr,_r/Mr,1/0,Yr,-1,Mr),Gt&&he.push(Fr)}else{for(let Fe=0;Fe<ve;Fe++)he.push(te[me+Fe]);if(Mr>1)for(const Fe of ir){const nr=Fe*ve;if(!(te[nr+2]<=ft)){te[nr+2]=ft;for(let _r=0;_r<ve;_r++)he.push(te[nr+_r])}}}}return he}_getOriginId(ct){return ct-this.points.length>>5}_getOriginZoom(ct){return(ct-this.points.length)%32}_map(ct,ft,pt){if(ct[ft+yt]>1){const le=this.clusterProps[ct[ft+re]];return pt?Object.assign({},le):le}const Dt=this.points[ct[ft+vt]].properties,Gt=this.options.map(Dt);return pt&&Gt===Dt?Object.assign({},Gt):Gt}}function ee(Bt,ct,ft){return{type:"Feature",id:Bt[ct+vt],properties:Zt(Bt,ct,ft),geometry:{type:"Point",coordinates:[(pt=Bt[ct],360*(pt-.5)),De(Bt[ct+1])]}};var pt}function Zt(Bt,ct,ft){const pt=Bt[ct+yt],Dt=pt>=1e4?`${Math.round(pt/1e3)}k`:pt>=1e3?Math.round(pt/100)/10+"k":pt,Gt=Bt[ct+re],le=Gt===-1?{}:Object.assign({},ft[Gt]);return Object.assign(le,{cluster:!0,cluster_id:Bt[ct+vt],point_count:pt,point_count_abbreviated:Dt})}function oe(Bt){return Bt/360+.5}function pe(Bt){const ct=Math.sin(Bt*Math.PI/180),ft=.5-.25*Math.log((1+ct)/(1-ct))/Math.PI;return ft<0?0:ft>1?1:ft}function De(Bt){const ct=(180-360*Bt)*Math.PI/180;return 360*Math.atan(Math.exp(ct))/Math.PI-90}function at(Bt,ct,ft,pt){let Dt=pt;const Gt=ct+(ft-ct>>1);let le,ge=ft-ct;const te=Bt[ct],he=Bt[ct+1],ve=Bt[ft],me=Bt[ft+1];for(let Yt=ct+3;Yt<ft;Yt+=3){const ur=Tt(Bt[Yt],Bt[Yt+1],te,he,ve,me);if(ur>Dt)le=Yt,Dt=ur;else if(ur===Dt){const ir=Math.abs(Yt-Gt);ir<ge&&(le=Yt,ge=ir)}}Dt>pt&&(le-ct>3&&at(Bt,ct,le,pt),Bt[le+2]=Dt,ft-le>3&&at(Bt,le,ft,pt))}function Tt(Bt,ct,ft,pt,Dt,Gt){let le=Dt-ft,ge=Gt-pt;if(le!==0||ge!==0){const te=((Bt-ft)*le+(ct-pt)*ge)/(le*le+ge*ge);te>1?(ft=Dt,pt=Gt):te>0&&(ft+=le*te,pt+=ge*te)}return le=Bt-ft,ge=ct-pt,le*le+ge*ge}function Rt(Bt,ct,ft,pt){const Dt={id:Bt??null,type:ct,geometry:ft,tags:pt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ct==="Point"||ct==="MultiPoint"||ct==="LineString")Nt(Dt,ft);else if(ct==="Polygon")Nt(Dt,ft[0]);else if(ct==="MultiLineString")for(const Gt of ft)Nt(Dt,Gt);else if(ct==="MultiPolygon")for(const Gt of ft)Nt(Dt,Gt[0]);return Dt}function Nt(Bt,ct){for(let ft=0;ft<ct.length;ft+=3)Bt.minX=Math.min(Bt.minX,ct[ft]),Bt.minY=Math.min(Bt.minY,ct[ft+1]),Bt.maxX=Math.max(Bt.maxX,ct[ft]),Bt.maxY=Math.max(Bt.maxY,ct[ft+1])}function ae(Bt,ct,ft,pt){if(!ct.geometry)return;const Dt=ct.geometry.coordinates;if(Dt&&Dt.length===0)return;const Gt=ct.geometry.type,le=Math.pow(ft.tolerance/((1<<ft.maxZoom)*ft.extent),2);let ge=[],te=ct.id;if(ft.promoteId?te=ct.properties[ft.promoteId]:ft.generateId&&(te=pt||0),Gt==="Point")Xt(Dt,ge);else if(Gt==="MultiPoint")for(const he of Dt)Xt(he,ge);else if(Gt==="LineString")ye(Dt,ge,le,!1);else if(Gt==="MultiLineString"){if(ft.lineMetrics){for(const he of Dt)ge=[],ye(he,ge,le,!1),Bt.push(Rt(te,"LineString",ge,ct.properties));return}de(Dt,ge,le,!1)}else if(Gt==="Polygon")de(Dt,ge,le,!0);else{if(Gt!=="MultiPolygon"){if(Gt==="GeometryCollection"){for(const he of ct.geometry.geometries)ae(Bt,{id:te,geometry:he,properties:ct.properties},ft,pt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const he of Dt){const ve=[];de(he,ve,le,!0),ge.push(ve)}}Bt.push(Rt(te,Gt,ge,ct.properties))}function Xt(Bt,ct){ct.push(qe(Bt[0]),Ve(Bt[1]),0)}function ye(Bt,ct,ft,pt){let Dt,Gt,le=0;for(let te=0;te<Bt.length;te++){const he=qe(Bt[te][0]),ve=Ve(Bt[te][1]);ct.push(he,ve,0),te>0&&(le+=pt?(Dt*ve-he*Gt)/2:Math.sqrt(Math.pow(he-Dt,2)+Math.pow(ve-Gt,2))),Dt=he,Gt=ve}const ge=ct.length-3;ct[2]=1,at(ct,0,ge,ft),ct[ge+2]=1,ct.size=Math.abs(le),ct.start=0,ct.end=ct.size}function de(Bt,ct,ft,pt){for(let Dt=0;Dt<Bt.length;Dt++){const Gt=[];ye(Bt[Dt],Gt,ft,pt),ct.push(Gt)}}function qe(Bt){return Bt/360+.5}function Ve(Bt){const ct=Math.sin(Bt*Math.PI/180),ft=.5-.25*Math.log((1+ct)/(1-ct))/Math.PI;return ft<0?0:ft>1?1:ft}function Je(Bt,ct,ft,pt,Dt,Gt,le,ge){if(pt/=ct,Gt>=(ft/=ct)&&le<pt)return Bt;if(le<ft||Gt>=pt)return null;const te=[];for(const he of Bt){const ve=he.geometry;let me=he.type;const Yt=Dt===0?he.minX:he.minY,ur=Dt===0?he.maxX:he.maxY;if(Yt>=ft&&ur<pt){te.push(he);continue}if(ur<ft||Yt>=pt)continue;let ir=[];if(me==="Point"||me==="MultiPoint")or(ve,ir,ft,pt,Dt);else if(me==="LineString")mr(ve,ir,ft,pt,Dt,!1,ge.lineMetrics);else if(me==="MultiLineString")Qt(ve,ir,ft,pt,Dt,!1);else if(me==="Polygon")Qt(ve,ir,ft,pt,Dt,!0);else if(me==="MultiPolygon")for(const tr of ve){const Mr=[];Qt(tr,Mr,ft,pt,Dt,!0),Mr.length&&ir.push(Mr)}if(ir.length){if(ge.lineMetrics&&me==="LineString"){for(const tr of ir)te.push(Rt(he.id,me,tr,he.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(ir.length===1?(me="LineString",ir=ir[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=ir.length===3?"Point":"MultiPoint"),te.push(Rt(he.id,me,ir,he.tags))}}return te.length?te:null}function or(Bt,ct,ft,pt,Dt){for(let Gt=0;Gt<Bt.length;Gt+=3){const le=Bt[Gt+Dt];le>=ft&&le<=pt&&Ur(ct,Bt[Gt],Bt[Gt+1],Bt[Gt+2])}}function mr(Bt,ct,ft,pt,Dt,Gt,le){let ge=Me(Bt);const te=Dt===0?Ir:$e;let he,ve,me=Bt.start;for(let Mr=0;Mr<Bt.length-3;Mr+=3){const Fe=Bt[Mr],nr=Bt[Mr+1],_r=Bt[Mr+2],Fr=Bt[Mr+3],Yr=Bt[Mr+4],Qr=Dt===0?Fe:nr,vr=Dt===0?Fr:Yr;let wn=!1;le&&(he=Math.sqrt(Math.pow(Fe-Fr,2)+Math.pow(nr-Yr,2))),Qr<ft?vr>ft&&(ve=te(ge,Fe,nr,Fr,Yr,ft),le&&(ge.start=me+he*ve)):Qr>pt?vr<pt&&(ve=te(ge,Fe,nr,Fr,Yr,pt),le&&(ge.start=me+he*ve)):Ur(ge,Fe,nr,_r),vr<ft&&Qr>=ft&&(ve=te(ge,Fe,nr,Fr,Yr,ft),wn=!0),vr>pt&&Qr<=pt&&(ve=te(ge,Fe,nr,Fr,Yr,pt),wn=!0),!Gt&&wn&&(le&&(ge.end=me+he*ve),ct.push(ge),ge=Me(Bt)),le&&(me+=he)}let Yt=Bt.length-3;const ur=Bt[Yt],ir=Bt[Yt+1],tr=Dt===0?ur:ir;tr>=ft&&tr<=pt&&Ur(ge,ur,ir,Bt[Yt+2]),Yt=ge.length-3,Gt&&Yt>=3&&(ge[Yt]!==ge[0]||ge[Yt+1]!==ge[1])&&Ur(ge,ge[0],ge[1],ge[2]),ge.length&&ct.push(ge)}function Me(Bt){const ct=[];return ct.size=Bt.size,ct.start=Bt.start,ct.end=Bt.end,ct}function Qt(Bt,ct,ft,pt,Dt,Gt){for(const le of Bt)mr(le,ct,ft,pt,Dt,Gt,!1)}function Ur(Bt,ct,ft,pt){Bt.push(ct,ft,pt)}function Ir(Bt,ct,ft,pt,Dt,Gt){const le=(Gt-ct)/(pt-ct);return Ur(Bt,Gt,ft+(Dt-ft)*le,1),le}function $e(Bt,ct,ft,pt,Dt,Gt){const le=(Gt-ft)/(Dt-ft);return Ur(Bt,ct+(pt-ct)*le,Gt,1),le}function Xe(Bt,ct){const ft=[];for(let pt=0;pt<Bt.length;pt++){const Dt=Bt[pt],Gt=Dt.type;let le;if(Gt==="Point"||Gt==="MultiPoint"||Gt==="LineString")le=er(Dt.geometry,ct);else if(Gt==="MultiLineString"||Gt==="Polygon"){le=[];for(const ge of Dt.geometry)le.push(er(ge,ct))}else if(Gt==="MultiPolygon"){le=[];for(const ge of Dt.geometry){const te=[];for(const he of ge)te.push(er(he,ct));le.push(te)}}ft.push(Rt(Dt.id,Gt,le,Dt.tags))}return ft}function er(Bt,ct){const ft=[];ft.size=Bt.size,Bt.start!==void 0&&(ft.start=Bt.start,ft.end=Bt.end);for(let pt=0;pt<Bt.length;pt+=3)ft.push(Bt[pt]+ct,Bt[pt+1],Bt[pt+2]);return ft}function gr(Bt,ct){if(Bt.transformed)return Bt;const ft=1<<Bt.z,pt=Bt.x,Dt=Bt.y;for(const Gt of Bt.features){const le=Gt.geometry,ge=Gt.type;if(Gt.geometry=[],ge===1)for(let te=0;te<le.length;te+=2)Gt.geometry.push(Re(le[te],le[te+1],ct,ft,pt,Dt));else for(let te=0;te<le.length;te++){const he=[];for(let ve=0;ve<le[te].length;ve+=2)he.push(Re(le[te][ve],le[te][ve+1],ct,ft,pt,Dt));Gt.geometry.push(he)}}return Bt.transformed=!0,Bt}function Re(Bt,ct,ft,pt,Dt,Gt){return[Math.round(ft*(Bt*pt-Dt)),Math.round(ft*(ct*pt-Gt))]}function sr(Bt,ct,ft,pt,Dt){const Gt=ct===Dt.maxZoom?0:Dt.tolerance/((1<<ct)*Dt.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:Bt.length,source:null,x:ft,y:pt,z:ct,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ge of Bt)Br(le,ge,Gt,Dt);return le}function Br(Bt,ct,ft,pt){const Dt=ct.geometry,Gt=ct.type,le=[];if(Bt.minX=Math.min(Bt.minX,ct.minX),Bt.minY=Math.min(Bt.minY,ct.minY),Bt.maxX=Math.max(Bt.maxX,ct.maxX),Bt.maxY=Math.max(Bt.maxY,ct.maxY),Gt==="Point"||Gt==="MultiPoint")for(let ge=0;ge<Dt.length;ge+=3)le.push(Dt[ge],Dt[ge+1]),Bt.numPoints++,Bt.numSimplified++;else if(Gt==="LineString")xr(le,Dt,Bt,ft,!1,!1);else if(Gt==="MultiLineString"||Gt==="Polygon")for(let ge=0;ge<Dt.length;ge++)xr(le,Dt[ge],Bt,ft,Gt==="Polygon",ge===0);else if(Gt==="MultiPolygon")for(let ge=0;ge<Dt.length;ge++){const te=Dt[ge];for(let he=0;he<te.length;he++)xr(le,te[he],Bt,ft,!0,he===0)}if(le.length){let ge=ct.tags||null;if(Gt==="LineString"&&pt.lineMetrics){ge={};for(const he in ct.tags)ge[he]=ct.tags[he];ge.mapbox_clip_start=Dt.start/Dt.size,ge.mapbox_clip_end=Dt.end/Dt.size}const te={geometry:le,type:Gt==="Polygon"||Gt==="MultiPolygon"?3:Gt==="LineString"||Gt==="MultiLineString"?2:1,tags:ge};ct.id!==null&&(te.id=ct.id),Bt.features.push(te)}}function xr(Bt,ct,ft,pt,Dt,Gt){const le=pt*pt;if(pt>0&&ct.size<(Dt?le:pt))return void(ft.numPoints+=ct.length/3);const ge=[];for(let te=0;te<ct.length;te+=3)(pt===0||ct[te+2]>le)&&(ft.numSimplified++,ge.push(ct[te],ct[te+1])),ft.numPoints++;Dt&&function(te,he){let ve=0;for(let me=0,Yt=te.length,ur=Yt-2;me<Yt;ur=me,me+=2)ve+=(te[me]-te[ur])*(te[me+1]+te[ur+1]);if(ve>0===he)for(let me=0,Yt=te.length;me<Yt/2;me+=2){const ur=te[me],ir=te[me+1];te[me]=te[Yt-2-me],te[me+1]=te[Yt-1-me],te[Yt-2-me]=ur,te[Yt-1-me]=ir}}(ge,Gt),Bt.push(ge)}const Lr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zr{constructor(ct,ft){const pt=(ft=this.options=function(Gt,le){for(const ge in le)Gt[ge]=le[ge];return Gt}(Object.create(Lr),ft)).debug;if(pt&&console.time("preprocess data"),ft.maxZoom<0||ft.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ft.promoteId&&ft.generateId)throw new Error("promoteId and generateId cannot be used together.");let Dt=function(Gt,le){const ge=[];if(Gt.type==="FeatureCollection")for(let te=0;te<Gt.features.length;te++)ae(ge,Gt.features[te],le,te);else ae(ge,Gt.type==="Feature"?Gt:{geometry:Gt},le);return ge}(ct,ft);this.tiles={},this.tileCoords=[],pt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ft.indexMaxZoom,ft.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Dt=function(Gt,le){const ge=le.buffer/le.extent;let te=Gt;const he=Je(Gt,1,-1-ge,ge,0,-1,2,le),ve=Je(Gt,1,1-ge,2+ge,0,-1,2,le);return(he||ve)&&(te=Je(Gt,1,-ge,1+ge,0,-1,2,le)||[],he&&(te=Xe(he,1).concat(te)),ve&&(te=te.concat(Xe(ve,-1)))),te}(Dt,ft),Dt.length&&this.splitTile(Dt,0,0,0),pt&&(Dt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ct,ft,pt,Dt,Gt,le,ge){const te=[ct,ft,pt,Dt],he=this.options,ve=he.debug;for(;te.length;){Dt=te.pop(),pt=te.pop(),ft=te.pop(),ct=te.pop();const me=1<<ft,Yt=Nr(ft,pt,Dt);let ur=this.tiles[Yt];if(!ur&&(ve>1&&console.time("creation"),ur=this.tiles[Yt]=sr(ct,ft,pt,Dt,he),this.tileCoords.push({z:ft,x:pt,y:Dt}),ve)){ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ft,pt,Dt,ur.numFeatures,ur.numPoints,ur.numSimplified),console.timeEnd("creation"));const wn=`z${ft}`;this.stats[wn]=(this.stats[wn]||0)+1,this.total++}if(ur.source=ct,Gt==null){if(ft===he.indexMaxZoom||ur.numPoints<=he.indexMaxPoints)continue}else{if(ft===he.maxZoom||ft===Gt)continue;if(Gt!=null){const wn=Gt-ft;if(pt!==le>>wn||Dt!==ge>>wn)continue}}if(ur.source=null,ct.length===0)continue;ve>1&&console.time("clipping");const ir=.5*he.buffer/he.extent,tr=.5-ir,Mr=.5+ir,Fe=1+ir;let nr=null,_r=null,Fr=null,Yr=null,Qr=Je(ct,me,pt-ir,pt+Mr,0,ur.minX,ur.maxX,he),vr=Je(ct,me,pt+tr,pt+Fe,0,ur.minX,ur.maxX,he);ct=null,Qr&&(nr=Je(Qr,me,Dt-ir,Dt+Mr,1,ur.minY,ur.maxY,he),_r=Je(Qr,me,Dt+tr,Dt+Fe,1,ur.minY,ur.maxY,he),Qr=null),vr&&(Fr=Je(vr,me,Dt-ir,Dt+Mr,1,ur.minY,ur.maxY,he),Yr=Je(vr,me,Dt+tr,Dt+Fe,1,ur.minY,ur.maxY,he),vr=null),ve>1&&console.timeEnd("clipping"),te.push(nr||[],ft+1,2*pt,2*Dt),te.push(_r||[],ft+1,2*pt,2*Dt+1),te.push(Fr||[],ft+1,2*pt+1,2*Dt),te.push(Yr||[],ft+1,2*pt+1,2*Dt+1)}}getTile(ct,ft,pt){ct=+ct,ft=+ft,pt=+pt;const Dt=this.options,{extent:Gt,debug:le}=Dt;if(ct<0||ct>24)return null;const ge=1<<ct,te=Nr(ct,ft=ft+ge&ge-1,pt);if(this.tiles[te])return gr(this.tiles[te],Gt);le>1&&console.log("drilling down to z%d-%d-%d",ct,ft,pt);let he,ve=ct,me=ft,Yt=pt;for(;!he&&ve>0;)ve--,me>>=1,Yt>>=1,he=this.tiles[Nr(ve,me,Yt)];return he&&he.source?(le>1&&(console.log("found parent tile z%d-%d-%d",ve,me,Yt),console.time("drilling down")),this.splitTile(he.source,ve,me,Yt,ct,ft,pt),le>1&&console.timeEnd("drilling down"),this.tiles[te]?gr(this.tiles[te],Gt):null):null}}function Nr(Bt,ct,ft){return 32*((1<<Bt)*ft+ct)+Bt}function Vr(Bt,ct){return ct?Bt.properties[ct]:Bt.id}function yr(Bt,ct){if(Bt==null)return!0;if(Bt.type==="Feature")return Vr(Bt,ct)!=null;if(Bt.type==="FeatureCollection"){const ft=new Set;for(const pt of Bt.features){const Dt=Vr(pt,ct);if(Dt==null||ft.has(Dt))return!1;ft.add(Dt)}return!0}return!1}function In(Bt,ct){const ft=new Map;if(Bt!=null)if(Bt.type==="Feature")ft.set(Vr(Bt,ct),Bt);else for(const pt of Bt.features)ft.set(Vr(pt,ct),pt);return ft}class an extends v{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ct,ft){return a._(this,void 0,void 0,function*(){const pt=ct.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Dt=this._geoJSONIndex.getTile(pt.z,pt.x,pt.y);if(!Dt)return null;const Gt=new K(Dt.features);let le=wt(Gt);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:Gt,rawData:le.buffer}})}loadData(ct){return a._(this,void 0,void 0,function*(){var ft;(ft=this._pendingRequest)===null||ft===void 0||ft.abort();const pt=!!(ct&&ct.request&&ct.request.collectResourceTiming)&&new a.cu(ct.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ct,this._pendingRequest),this._geoJSONIndex=ct.cluster?new Wt(function(le){let{superclusterOptions:ge,clusterProperties:te}=le;if(!te||!ge)return ge;const he={},ve={},me={accumulated:null,zoom:0},Yt={properties:null},ur=Object.keys(te);for(const ir of ur){const[tr,Mr]=te[ir],Fe=a.cB(Mr),nr=a.cB(typeof tr=="string"?[tr,["accumulated"],["get",ir]]:tr);he[ir]=Fe.value,ve[ir]=nr.value}return ge.map=ir=>{Yt.properties=ir;const tr={};for(const Mr of ur)tr[Mr]=he[Mr].evaluate(me,Yt);return tr},ge.reduce=(ir,tr)=>{Yt.properties=tr;for(const Mr of ur)me.accumulated=ir[Mr],ir[Mr]=ve[Mr].evaluate(me,Yt)},ge}(ct)).load((yield this._pendingData).features):(Dt=yield this._pendingData,new Zr(Dt,ct.geojsonVtOptions)),this.loaded={};const Gt={};if(pt){const le=pt.finish();le&&(Gt.resourceTiming={},Gt.resourceTiming[ct.source]=JSON.parse(JSON.stringify(le)))}return Gt}catch(Gt){if(delete this._pendingRequest,a.cf(Gt))return{abandoned:!0};throw Gt}var Dt})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ct){const ft=this.loaded;return ft&&ft[ct.uid]?super.reloadTile(ct):this.loadTile(ct)}loadAndProcessGeoJSON(ct,ft){return a._(this,void 0,void 0,function*(){let pt=yield this.loadGeoJSON(ct,ft);if(delete this._pendingRequest,typeof pt!="object")throw new Error(`Input data given to '${ct.source}' is not a valid GeoJSON object.`);if(U(pt,!0),ct.filter){const Dt=a.cB(ct.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Dt.result==="error")throw new Error(Dt.value.map(le=>`${le.key}: ${le.message}`).join(", "));pt={type:"FeatureCollection",features:pt.features.filter(le=>Dt.value.evaluate({zoom:0},le))}}return pt})}loadGeoJSON(ct,ft){return a._(this,void 0,void 0,function*(){const{promoteId:pt}=ct;if(ct.request){const Dt=yield a.h(ct.request,ft);return this._dataUpdateable=yr(Dt.data,pt)?In(Dt.data,pt):void 0,Dt.data}if(typeof ct.data=="string")try{const Dt=JSON.parse(ct.data);return this._dataUpdateable=yr(Dt,pt)?In(Dt,pt):void 0,Dt}catch{throw new Error(`Input data given to '${ct.source}' is not a valid GeoJSON object.`)}if(!ct.dataDiff)throw new Error(`Input data given to '${ct.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ct.source}`);return function(Dt,Gt,le){var ge,te,he,ve;if(Gt.removeAll&&Dt.clear(),Gt.remove)for(const me of Gt.remove)Dt.delete(me);if(Gt.add)for(const me of Gt.add){const Yt=Vr(me,le);Yt!=null&&Dt.set(Yt,me)}if(Gt.update)for(const me of Gt.update){let Yt=Dt.get(me.id);if(Yt==null)continue;const ur=!me.removeAllProperties&&(((ge=me.removeProperties)===null||ge===void 0?void 0:ge.length)>0||((te=me.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((me.newGeometry||me.removeAllProperties||ur)&&(Yt=Object.assign({},Yt),Dt.set(me.id,Yt),ur&&(Yt.properties=Object.assign({},Yt.properties))),me.newGeometry&&(Yt.geometry=me.newGeometry),me.removeAllProperties)Yt.properties={};else if(((he=me.removeProperties)===null||he===void 0?void 0:he.length)>0)for(const ir of me.removeProperties)Object.prototype.hasOwnProperty.call(Yt.properties,ir)&&delete Yt.properties[ir];if(((ve=me.addOrUpdateProperties)===null||ve===void 0?void 0:ve.length)>0)for(const{key:ir,value:tr}of me.addOrUpdateProperties)Yt.properties[ir]=tr}}(this._dataUpdateable,ct.dataDiff,pt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ct){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ct){return this._geoJSONIndex.getClusterExpansionZoom(ct.clusterId)}getClusterChildren(ct){return this._geoJSONIndex.getChildren(ct.clusterId)}getClusterLeaves(ct){return this._geoJSONIndex.getLeaves(ct.clusterId,ct.limit,ct.offset)}}class Xn{constructor(ct){this.self=ct,this.actor=new a.F(ct),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ft,pt)=>{if(this.externalWorkerSourceTypes[ft])throw new Error(`Worker source with name "${ft}" already registered.`);this.externalWorkerSourceTypes[ft]=pt},this.self.addProtocol=a.ch,this.self.removeProtocol=a.ci,this.self.registerRTLTextPlugin=ft=>{a.cC.setMethods(ft)},this.actor.registerMessageHandler("LDT",(ft,pt)=>this._getDEMWorkerSource(ft,pt.source).loadTile(pt)),this.actor.registerMessageHandler("RDT",(ft,pt)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ft,pt.source).removeTile(pt)})),this.actor.registerMessageHandler("GCEZ",(ft,pt)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ft,pt.type,pt.source).getClusterExpansionZoom(pt)})),this.actor.registerMessageHandler("GCC",(ft,pt)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ft,pt.type,pt.source).getClusterChildren(pt)})),this.actor.registerMessageHandler("GCL",(ft,pt)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ft,pt.type,pt.source).getClusterLeaves(pt)})),this.actor.registerMessageHandler("LD",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).loadData(pt)),this.actor.registerMessageHandler("GD",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).getData()),this.actor.registerMessageHandler("LT",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).loadTile(pt)),this.actor.registerMessageHandler("RT",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).reloadTile(pt)),this.actor.registerMessageHandler("AT",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).abortTile(pt)),this.actor.registerMessageHandler("RMT",(ft,pt)=>this._getWorkerSource(ft,pt.type,pt.source).removeTile(pt)),this.actor.registerMessageHandler("RS",(ft,pt)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[ft]||!this.workerSources[ft][pt.type]||!this.workerSources[ft][pt.type][pt.source])return;const Dt=this.workerSources[ft][pt.type][pt.source];delete this.workerSources[ft][pt.type][pt.source],Dt.removeSource!==void 0&&Dt.removeSource(pt)})),this.actor.registerMessageHandler("RM",ft=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[ft],delete this.availableImages[ft],delete this.workerSources[ft],delete this.demWorkerSources[ft]})),this.actor.registerMessageHandler("SR",(ft,pt)=>a._(this,void 0,void 0,function*(){this.referrer=pt})),this.actor.registerMessageHandler("SRPS",(ft,pt)=>this._syncRTLPluginState(ft,pt)),this.actor.registerMessageHandler("IS",(ft,pt)=>a._(this,void 0,void 0,function*(){this.self.importScripts(pt)})),this.actor.registerMessageHandler("SI",(ft,pt)=>this._setImages(ft,pt)),this.actor.registerMessageHandler("UL",(ft,pt)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ft).update(pt.layers,pt.removedIds)})),this.actor.registerMessageHandler("SL",(ft,pt)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ft).replace(pt)}))}_setImages(ct,ft){return a._(this,void 0,void 0,function*(){this.availableImages[ct]=ft;for(const pt in this.workerSources[ct]){const Dt=this.workerSources[ct][pt];for(const Gt in Dt)Dt[Gt].availableImages=ft}})}_syncRTLPluginState(ct,ft){return a._(this,void 0,void 0,function*(){return yield a.cC.syncState(ft,this.self.importScripts)})}_getAvailableImages(ct){let ft=this.availableImages[ct];return ft||(ft=[]),ft}_getLayerIndex(ct){let ft=this.layerIndexes[ct];return ft||(ft=this.layerIndexes[ct]=new o),ft}_getWorkerSource(ct,ft,pt){if(this.workerSources[ct]||(this.workerSources[ct]={}),this.workerSources[ct][ft]||(this.workerSources[ct][ft]={}),!this.workerSources[ct][ft][pt]){const Dt={sendAsync:(Gt,le)=>(Gt.targetMapId=ct,this.actor.sendAsync(Gt,le))};switch(ft){case"vector":this.workerSources[ct][ft][pt]=new v(Dt,this._getLayerIndex(ct),this._getAvailableImages(ct));break;case"geojson":this.workerSources[ct][ft][pt]=new an(Dt,this._getLayerIndex(ct),this._getAvailableImages(ct));break;default:this.workerSources[ct][ft][pt]=new this.externalWorkerSourceTypes[ft](Dt,this._getLayerIndex(ct),this._getAvailableImages(ct))}}return this.workerSources[ct][ft][pt]}_getDEMWorkerSource(ct,ft){return this.demWorkerSources[ct]||(this.demWorkerSources[ct]={}),this.demWorkerSources[ct][ft]||(this.demWorkerSources[ct][ft]=new C),this.demWorkerSources[ct][ft]}}return a.i(self)&&(self.worker=new Xn(self)),Xn}),i("index",["exports","./shared"],function(a,o){var d="5.1.0";function f(){var w=new o.A(4);return o.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}let m,v;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(w,l,u){const g=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(g),u(o.c())})},frameAsync(w){return new Promise((l,u)=>{this.frame(w,l,u)})},getImageData(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),u=l.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,u.drawImage(w,0,0,w.width,w.height),u},resolveURL:w=>(m||(m=document.createElement("a")),m.href=w,m.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(v==null&&(v=matchMedia("(prefers-reduced-motion: reduce)")),v.matches)}};class b{static testProp(l){if(!b.docStyle)return l[0];for(let u=0;u<l.length;u++)if(l[u]in b.docStyle)return l[u];return l[0]}static create(l,u,g){const y=window.document.createElement(l);return u!==void 0&&(y.className=u),g&&g.appendChild(y),y}static createNS(l,u){return window.document.createElementNS(l,u)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(l,u){l.style[b.transformProp]=u}static addEventListener(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(u,g,"passive"in y?y:y.capture)}static removeEventListener(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(u,g,"passive"in y?y:y.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static getScale(l){const u=l.getBoundingClientRect();return{x:u.width/l.offsetWidth||1,y:u.height/l.offsetHeight||1,boundingClientRect:u}}static getPoint(l,u,g){const y=u.boundingClientRect;return new o.P((g.clientX-y.left)/u.x-l.clientLeft,(g.clientY-y.top)/u.y-l.clientTop)}static mousePos(l,u){const g=b.getScale(l);return b.getPoint(l,g,u)}static touchPos(l,u){const g=[],y=b.getScale(l);for(let B=0;B<u.length;B++)g.push(b.getPoint(l,y,u[B]));return g}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const u=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),g=u.querySelectorAll("script");for(const y of g)y.remove();return b.clean(u),u.innerHTML}static isPossiblyDangerous(l,u){const g=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!g.includes("javascript:")&&!g.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const u=l.children;for(const g of u)b.removeAttributes(g),b.clean(g)}static removeAttributes(l){for(const{name:u,value:g}of l.attributes)b.isPossiblyDangerous(u,g)&&l.removeAttribute(u)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(w){!k&&U&&(z?K(w):F=w)}};let F,U,k=!1,z=!1;function K(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,U),w.isContextLost())return;P.supported=!0}catch{}w.deleteTexture(l),k=!0}var G;typeof document<"u"&&(U=document.createElement("img"),U.onload=()=>{F&&K(F),F=null,z=!0},U.onerror=()=>{k=!0,F=null},U.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,u,g,y;w.resetRequestQueue=()=>{l=[],u=0,g=0,y={}},w.addThrottleControl=O=>{const Q=g++;return y[Q]=O,Q},w.removeThrottleControl=O=>{delete y[O],S()},w.getImage=function(O,Q){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((Z,J)=>{P.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),o.e(O,{type:"image"}),l.push({abortController:Q,requestParameters:O,supportImageRefresh:q,state:"queued",onError:At=>{J(At)},onSuccess:At=>{Z(At)}}),S()})};const B=O=>o._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:Q,supportImageRefresh:q,onError:Z,onSuccess:J,abortController:At}=O,gt=q===!1&&!o.i(self)&&!o.g(Q.url)&&(!Q.headers||Object.keys(Q.headers).reduce((Ot,kt)=>Ot&&kt==="accept",!0));u++;const Lt=gt?L(Q,At):o.m(Q,At);try{const Ot=yield Lt;delete O.abortController,O.state="completed",Ot.data instanceof HTMLImageElement||o.b(Ot.data)?J(Ot):Ot.data&&J({data:yield(Ft=Ot.data,typeof createImageBitmap=="function"?o.d(Ft):o.f(Ft)),cacheControl:Ot.cacheControl,expires:Ot.expires})}catch(Ot){delete O.abortController,Z(Ot)}finally{u--,S()}var Ft}),S=()=>{const O=(()=>{for(const Q of Object.keys(y))if(y[Q]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Q=u;Q<O&&l.length>0;Q++){const q=l.shift();q.abortController.signal.aborted?Q--:B(q)}},L=(O,Q)=>new Promise((q,Z)=>{const J=new Image,At=O.url,gt=O.credentials;gt&&gt==="include"?J.crossOrigin="use-credentials":(gt&&gt==="same-origin"||!o.s(At))&&(J.crossOrigin="anonymous"),Q.signal.addEventListener("abort",()=>{J.src="",Z(o.c())}),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,q({data:J})},J.onerror=()=>{J.onerror=J.onload=null,Q.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=At})}(G||(G={})),G.resetRequestQueue();class X{constructor(l){this._transformRequestFn=l}transformRequest(l,u){return this._transformRequestFn&&this._transformRequestFn(l,u)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function Y(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const u=[];for(const{id:g,url:y}of w){const B=`${g}${y}`;u.indexOf(B)===-1&&(u.push(B),l.push({id:g,url:y}))}}return l}function it(w,l,u){try{const g=new URL(w);return g.pathname+=`${l}${u}`,g.toString()}catch{throw new Error(`Invalid sprite URL "${w}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class nt{constructor(l,u,g,y){this.context=l,this.format=g,this.texture=l.gl.createTexture(),this.update(u,y)}update(l,u,g){const{width:y,height:B}=l,S=!(this.size&&this.size[0]===y&&this.size[1]===B||g),{context:L}=this,{gl:O}=L;if(this.useMipmap=!!(u&&u.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!u||u.premultiply!==!1)),S)this.size=[y,B],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,l):O.texImage2D(O.TEXTURE_2D,0,this.format,y,B,0,this.format,O.UNSIGNED_BYTE,l.data);else{const{x:Q,y:q}=g||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||o.b(l)?O.texSubImage2D(O.TEXTURE_2D,0,Q,q,O.RGBA,O.UNSIGNED_BYTE,l):O.texSubImage2D(O.TEXTURE_2D,0,Q,q,y,B,O.RGBA,O.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(l,u,g){const{context:y}=this,{gl:B}=y;B.bindTexture(B.TEXTURE_2D,this.texture),g!==B.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=B.LINEAR),l!==this.filter&&(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,l),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,g||l),this.filter=l),u!==this.wrap&&(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,u),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function wt(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class Ct extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:u,promiseResolve:g}of this.requestors)g(this._getImagesForIds(u));this.requestors=[]}}getImage(l){const u=this.images[l];if(u&&!u.data&&u.spriteData){const g=u.spriteData;u.data=new o.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),u.spriteData=null}return u}addImage(l,u){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,u)&&(this.images[l]=u)}_validate(l,u){let g=!0;const y=u.data||u.spriteData;return this._validateStretch(u.stretchX,y&&y.width)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,y&&y.height)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new o.j(new Error(`Image "${l}" has invalid "content" value`))),g=!1),g}_validateStretch(l,u){if(!l)return!0;let g=0;for(const y of l){if(y[0]<g||y[1]<y[0]||u<y[1])return!1;g=y[1]}return!0}_validateContent(l,u){if(!l)return!0;if(l.length!==4)return!1;const g=u.spriteData,y=g&&g.width||u.data.width,B=g&&g.height||u.data.height;return!(l[0]<0||y<l[0]||l[1]<0||B<l[1]||l[2]<0||y<l[2]||l[3]<0||B<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const y=this.getImage(l);if(g&&(y.data.width!==u.data.width||y.data.height!==u.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=y.version+1,this.images[l]=u,this.updatedImages[l]=!0}removeImage(l){const u=this.images[l];delete this.images[l],delete this.patterns[l],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((u,g)=>{let y=!0;if(!this.isLoaded())for(const B of l)this.images[B]||(y=!1);this.isLoaded()||y?u(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:u})})}_getImagesForIds(l){const u={};for(const g of l){let y=this.getImage(g);y||(this.fire(new o.k("styleimagemissing",{id:g})),y=this.getImage(g)),y?u[g]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:l,height:u}=this.atlasImage;return{width:l,height:u}}getPattern(l){const u=this.patterns[l],g=this.getImage(l);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const y={w:g.data.width+2,h:g.data.height+2,x:0,y:0},B=new o.I(y,g);this.patterns[l]={bin:y,position:B}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const u=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new nt(l,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const B in this.patterns)l.push(this.patterns[B].bin);const{w:u,h:g}=o.p(l),y=this.atlasImage;y.resize({width:u||1,height:g||1});for(const B in this.patterns){const{bin:S}=this.patterns[B],L=S.x+1,O=S.y+1,Q=this.getImage(B).data,q=Q.width,Z=Q.height;o.R.copy(Q,y,{x:0,y:0},{x:L,y:O},{width:q,height:Z}),o.R.copy(Q,y,{x:0,y:Z-1},{x:L,y:O-1},{width:q,height:1}),o.R.copy(Q,y,{x:0,y:0},{x:L,y:O+Z},{width:q,height:1}),o.R.copy(Q,y,{x:q-1,y:0},{x:L-1,y:O},{width:1,height:Z}),o.R.copy(Q,y,{x:0,y:0},{x:L+q,y:O},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const u of l){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.getImage(u);g||o.w(`Image with ID: "${u}" was not found`),wt(g)&&this.updateImage(u,g)}}}const st=1e20;function ot(w,l,u,g,y,B,S,L,O){for(let Q=l;Q<l+g;Q++)vt(w,u*B+Q,B,y,S,L,O);for(let Q=u;Q<u+y;Q++)vt(w,Q*B+l,1,g,S,L,O)}function vt(w,l,u,g,y,B,S){B[0]=0,S[0]=-1e20,S[1]=st,y[0]=w[l];for(let L=1,O=0,Q=0;L<g;L++){y[L]=w[l+L*u];const q=L*L;do{const Z=B[O];Q=(y[L]-y[Z]+q-Z*Z)/(L-Z)/2}while(Q<=S[O]&&--O>-1);O++,B[O]=L,S[O]=Q,S[O+1]=st}for(let L=0,O=0;L<g;L++){for(;S[O+1]<L;)O++;const Q=B[O],q=L-Q;w[l+L*u]=y[Q]+q*q}}class yt{constructor(l,u){this.requestManager=l,this.localIdeographFontFamily=u,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return o._(this,void 0,void 0,function*(){const u=[];for(const B in l)for(const S of l[B])u.push(this._getAndCacheGlyphsPromise(B,S));const g=yield Promise.all(u),y={};for(const{stack:B,id:S,glyph:L}of g)y[B]||(y[B]={}),y[B][S]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return y})}_getAndCacheGlyphsPromise(l,u){return o._(this,void 0,void 0,function*(){let g=this.entries[l];g||(g=this.entries[l]={glyphs:{},requests:{},ranges:{}});let y=g.glyphs[u];if(y!==void 0)return{stack:l,id:u,glyph:y};if(y=this._tinySDF(g,l,u),y)return g.glyphs[u]=y,{stack:l,id:u,glyph:y};const B=Math.floor(u/256);if(256*B>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[B])return{stack:l,id:u,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[B]){const L=yt.loadGlyphRange(l,B,this.url,this.requestManager);g.requests[B]=L}const S=yield g.requests[B];for(const L in S)this._doesCharSupportLocalGlyph(+L)||(g.glyphs[+L]=S[+L]);return g.ranges[B]=!0,{stack:l,id:u,glyph:S[u]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(l))}_tinySDF(l,u,g){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(g))return;let B=l.tinySDF;if(!B){let L="400";/bold/i.test(u)?L="900":/medium/i.test(u)?L="500":/light/i.test(u)&&(L="200"),B=l.tinySDF=new yt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:L})}const S=B.draw(String.fromCharCode(g));return{id:g,bitmap:new o.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}yt.loadGlyphRange=function(w,l,u,g){return o._(this,void 0,void 0,function*(){const y=256*l,B=y+255,S=g.transformRequest(u.replace("{fontstack}",w).replace("{range}",`${y}-${B}`),"Glyphs"),L=yield o.l(S,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${l}, ${y}-${B}`);const O={};for(const Q of o.n(L.data))O[Q.id]=Q;return O})},yt.TinySDF=class{constructor(){let{fontSize:w=24,buffer:l=3,radius:u=8,cutoff:g=.25,fontFamily:y="sans-serif",fontWeight:B="normal",fontStyle:S="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=g,this.radius=u;const L=this.size=w+4*l,O=this._createCanvas(L),Q=this.ctx=O.getContext("2d",{willReadFrequently:!0});Q.font=`${S} ${B} ${w}px ${y}`,Q.textBaseline="alphabetic",Q.textAlign="left",Q.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:u,actualBoundingBoxDescent:g,actualBoundingBoxLeft:y,actualBoundingBoxRight:B}=this.ctx.measureText(w),S=Math.ceil(u),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(B-y))),O=Math.min(this.size-this.buffer,S+Math.ceil(g)),Q=L+2*this.buffer,q=O+2*this.buffer,Z=Math.max(Q*q,0),J=new Uint8ClampedArray(Z),At={data:J,width:Q,height:q,glyphWidth:L,glyphHeight:O,glyphTop:S,glyphLeft:0,glyphAdvance:l};if(L===0||O===0)return At;const{ctx:gt,buffer:Lt,gridInner:Ft,gridOuter:Ot}=this;gt.clearRect(Lt,Lt,L,O),gt.fillText(w,Lt,Lt+S);const kt=gt.getImageData(Lt,Lt,L,O);Ot.fill(st,0,Z),Ft.fill(0,0,Z);for(let qt=0;qt<O;qt++)for(let $t=0;$t<L;$t++){const Jt=kt.data[4*(qt*L+$t)+3]/255;if(Jt===0)continue;const ne=(qt+Lt)*Q+$t+Lt;if(Jt===1)Ot[ne]=0,Ft[ne]=st;else{const se=.5-Jt;Ot[ne]=se>0?se*se:0,Ft[ne]=se<0?se*se:0}}ot(Ot,0,0,Q,q,Q,this.f,this.v,this.z),ot(Ft,Lt,Lt,L,O,Q,this.f,this.v,this.z);for(let qt=0;qt<Z;qt++){const $t=Math.sqrt(Ot[qt])-Math.sqrt(Ft[qt]);J[qt]=Math.round(255-255*($t/this.radius+this.cutoff))}return At}};class re{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,u){return o.x(l.expression.evaluate(u))}interpolate(l,u,g){return{x:o.y.number(l.x,u.x,g),y:o.y.number(l.y,u.y,g),z:o.y.number(l.z,u.z,g)}}}let Wt;class ee extends o.E{constructor(l){super(),Wt=Wt||new o.q({anchor:new o.D(o.v.light.anchor),position:new re,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Wt),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,l,u))for(const g in l){const y=l[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),y):this._transitionable.setValue(g,y)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,u,g){return(!g||g.validate!==!1)&&o.t(this,l.call(o.u,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Zt=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class oe extends o.E{constructor(l){super(),this._transitionable=new o.T(Zt),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.B,l,u)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in l){const y=l[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),y):this._transitionable.setValue(g,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(g==null?void 0:g.validate)!==!1&&o.t(this,l.call(o.u,o.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class pe{constructor(l,u){this.width=l,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,u){const g=l.join(",")+String(u);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(l,u)),this.dashEntry[g]}getDashRanges(l,u,g){const y=[];let B=l.length%2==1?-l[l.length-1]*g:0,S=l[0]*g,L=!0;y.push({left:B,right:S,isDash:L,zeroLength:l[0]===0});let O=l[0];for(let Q=1;Q<l.length;Q++){L=!L;const q=l[Q];B=O*g,O+=q,S=O*g,y.push({left:B,right:S,isDash:L,zeroLength:q===0})}return y}addRoundDash(l,u,g){const y=u/2;for(let B=-g;B<=g;B++){const S=this.width*(this.nextRow+g+B);let L=0,O=l[L];for(let Q=0;Q<this.width;Q++){Q/O.right>1&&(O=l[++L]);const q=Math.abs(Q-O.left),Z=Math.abs(Q-O.right),J=Math.min(q,Z);let At;const gt=B/g*(y+1);if(O.isDash){const Lt=y-Math.abs(gt);At=Math.sqrt(J*J+Lt*Lt)}else At=y-Math.sqrt(J*J+gt*gt);this.data[S+Q]=Math.max(0,Math.min(255,At+128))}}}addRegularDash(l){for(let L=l.length-1;L>=0;--L){const O=l[L],Q=l[L+1];O.zeroLength?l.splice(L,1):Q&&Q.isDash===O.isDash&&(Q.left=O.left,l.splice(L,1))}const u=l[0],g=l[l.length-1];u.isDash===g.isDash&&(u.left=g.left-this.width,g.right=u.right+this.width);const y=this.width*this.nextRow;let B=0,S=l[B];for(let L=0;L<this.width;L++){L/S.right>1&&(S=l[++B]);const O=Math.abs(L-S.left),Q=Math.abs(L-S.right),q=Math.min(O,Q);this.data[y+L]=Math.max(0,Math.min(255,(S.isDash?q:-q)+128))}}addDash(l,u){const g=u?7:0,y=2*g+1;if(this.nextRow+y>this.height)return o.w("LineAtlas out of space"),null;let B=0;for(let L=0;L<l.length;L++)B+=l[L];if(B!==0){const L=this.width/B,O=this.getDashRanges(l,this.width,L);u?this.addRoundDash(O,L,g):this.addRegularDash(O)}const S={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:B};return this.nextRow+=y,this.dirty=!0,S}bind(l){const u=l.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const De="maplibre_preloaded_worker_pool";class at{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<at.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}const Tt=Math.floor(C.hardwareConcurrency/2);let Rt,Nt;function ae(){return Rt||(Rt=new at),Rt}at.workerCount=o.C(globalThis)?Math.max(Math.min(Tt,3),1):1;class Xt{constructor(l,u){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=u;const g=this.workerPool.acquire(u);for(let y=0;y<g.length;y++){const B=new o.F(g[y],u);B.name=`Worker ${y}`,this.actors.push(B)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,u){const g=[];for(const y of this.actors)g.push(y.sendAsync({type:l,data:u}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(u=>{u.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,u){for(const g of this.actors)g.registerMessageHandler(l,u)}}function ye(){return Nt||(Nt=new Xt(ae(),o.G),Nt.registerMessageHandler("GR",(w,l,u)=>o.m(l,u))),Nt}function de(w,l){const u=o.H();return o.J(u,u,[1,1,0]),o.K(u,u,[.5*w.width,.5*w.height,1]),w.calculatePosMatrix?o.L(u,u,w.calculatePosMatrix(l.toUnwrapped())):u}function qe(w,l,u,g,y,B){var S;const L=function(Z,J,At){if(Z)for(const gt of Z){const Lt=J[gt];if(Lt&&Lt.source===At&&Lt.type==="fill-extrusion")return!0}else for(const gt in J){const Lt=J[gt];if(Lt.source===At&&Lt.type==="fill-extrusion")return!0}return!1}((S=y==null?void 0:y.layers)!==null&&S!==void 0?S:null,l,w.id),O=B.maxPitchScaleFactor(),Q=w.tilesIn(g,O,L);Q.sort(Ve);const q=[];for(const Z of Q)q.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(l,u,w._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,y,B,O,de(w.transform,Z.tileID))});return function(Z,J){for(const At in Z)for(const gt of Z[At])Je(gt,J);return Z}(function(Z){const J={},At={};for(const gt of Z){const Lt=gt.queryResults,Ft=gt.wrappedTileID,Ot=At[Ft]=At[Ft]||{};for(const kt in Lt){const qt=Lt[kt],$t=Ot[kt]=Ot[kt]||{},Jt=J[kt]=J[kt]||[];for(const ne of qt)$t[ne.featureIndex]||($t[ne.featureIndex]=!0,Jt.push(ne))}}return J}(q),w)}function Ve(w,l){const u=w.tileID,g=l.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Je(w,l){const u=w.feature,g=l.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=g}function or(w,l,u){return o._(this,void 0,void 0,function*(){let g=w;if(w.url?g=(yield o.h(l.transformRequest(w.url,"Source"),u)).data:yield C.frameAsync(u),!g)return null;const y=o.M(o.e(g,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(y.vectorLayerIds=g.vector_layers.map(B=>B.id)),y})}class mr{constructor(l,u){l&&(u?this.setSouthWest(l).setNorthEast(u):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.N?new o.N(l.lng,l.lat):o.N.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.N?new o.N(l.lng,l.lat):o.N.convert(l),this}extend(l){const u=this._sw,g=this._ne;let y,B;if(l instanceof o.N)y=l,B=l;else{if(!(l instanceof mr))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(mr.convert(l)):this.extend(o.N.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.N.convert(l)):this;if(y=l._sw,B=l._ne,!y||!B)return this}return u||g?(u.lng=Math.min(y.lng,u.lng),u.lat=Math.min(y.lat,u.lat),g.lng=Math.max(B.lng,g.lng),g.lat=Math.max(B.lat,g.lat)):(this._sw=new o.N(y.lng,y.lat),this._ne=new o.N(B.lng,B.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:u,lat:g}=o.N.convert(l);let y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&y}static convert(l){return l instanceof mr?l:l&&new mr(l)}static fromLngLat(l){const g=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,y=g/Math.cos(Math.PI/180*l.lat);return new mr(new o.N(l.lng-y,l.lat-g),new o.N(l.lng+y,l.lat+g))}adjustAntiMeridian(){const l=new o.N(this._sw.lng,this._sw.lat),u=new o.N(this._ne.lng,this._ne.lat);return new mr(l,l.lng>u.lng?new o.N(u.lng+360,u.lat):u)}}class Me{constructor(l,u,g){this.bounds=mr.convert(this.validateBounds(l)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const u=Math.pow(2,l.z),g=Math.floor(o.O(this.bounds.getWest())*u),y=Math.floor(o.Q(this.bounds.getNorth())*u),B=Math.ceil(o.O(this.bounds.getEast())*u),S=Math.ceil(o.Q(this.bounds.getSouth())*u);return l.x>=g&&l.x<B&&l.y>=y&&l.y<S}}class Qt extends o.E{constructor(l,u,g,y){if(super(),this.id=l,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(u,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield or(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Me(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new o.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(l){return o._(this,void 0,void 0,function*(){const u=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(u,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};g.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((B,S)=>{l.reloadPromise={resolve:B,reject:S}})}else l.actor=this.dispatcher.getActor(),y="LT";l.abortController=new AbortController;try{const B=yield l.actor.sendAsync({type:y,data:g},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,B)}catch(B){if(delete l.abortController,l.aborted)return;if(B&&B.status!==404)throw B;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,u){if(u&&u.resourceTiming&&(l.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&l.setExpiryData(u),l.loadVectorData(u,this.map.painter),l.reloadPromise){const g=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(g.resolve).catch(g.reject)}}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ur extends o.E{constructor(l,u,g,y){super(),this.id=l,this.dispatcher=g,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},u),o.e(this,o.M(u,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){l._loaded=!1,l.fire(new o.k("dataloading",{dataType:"source"})),l._tileJSONRequest=new AbortController;try{const g=yield or(l._options,l.map._requestManager,l._tileJSONRequest);l._tileJSONRequest=null,l._loaded=!0,g&&(o.e(l,g),g.bounds&&(l.tileBounds=new Me(g.bounds,l.minzoom,l.maxzoom)),l.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new o.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:u})))}catch(g){l._tileJSONRequest=null,l.fire(new o.j(g))}}()})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return o._(this,void 0,void 0,function*(){const u=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const g=yield G.getImage(this.map._requestManager.transformRequest(u,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&l.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const y=this.map.painter.context,B=y.gl,S=g.data;l.texture=this.map.painter.getTileTexture(S.width),l.texture?l.texture.update(S,{useMipmap:!0}):(l.texture=new nt(y,S,B.RGBA,{useMipmap:!0}),l.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(g){if(delete l.abortController,l.aborted)l.state="unloaded";else if(g)throw l.state="errored",g}})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class Ir extends Ur{constructor(l,u,g,y){super(l,u,g,y),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(l){return o._(this,void 0,void 0,function*(){const u=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(u,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const y=yield G.getImage(g,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){const B=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const S=o.b(B)&&o.U()?B:yield this.readImageNow(B),L={type:this.type,uid:l.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const O=yield l.actor.sendAsync({type:"LDT",data:L});l.dem=O,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}readImageNow(l){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const u=l.width+2,g=l.height+2;try{return new o.R({width:u,height:g},yield o.W(l,-1,-1,u,g))}catch{}}return C.getImageData(l,1)})}_getNeighboringTiles(l){const u=l.canonical,g=Math.pow(2,u.z),y=(u.x-1+g)%g,B=u.x===0?l.wrap-1:l.wrap,S=(u.x+1+g)%g,L=u.x+1===g?l.wrap+1:l.wrap,O={};return O[new o.S(l.overscaledZ,B,u.z,y,u.y).key]={backfilled:!1},O[new o.S(l.overscaledZ,L,u.z,S,u.y).key]={backfilled:!1},u.y>0&&(O[new o.S(l.overscaledZ,B,u.z,y,u.y-1).key]={backfilled:!1},O[new o.S(l.overscaledZ,l.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},O[new o.S(l.overscaledZ,L,u.z,S,u.y-1).key]={backfilled:!1}),u.y+1<g&&(O[new o.S(l.overscaledZ,B,u.z,y,u.y+1).key]={backfilled:!1},O[new o.S(l.overscaledZ,l.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},O[new o.S(l.overscaledZ,L,u.z,S,u.y+1).key]={backfilled:!1}),O}unloadTile(l){return o._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class $e extends o.E{constructor(l,u,g,y){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(y),this._data=u.data,this._options=o.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:o.X,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.X,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(l){return l*(o.X/this.tileSize)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}getData(){return o._(this,void 0,void 0,function*(){const l=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})})}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,u,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:u,offset:g}})}_updateWorkerData(l){return o._(this,void 0,void 0,function*(){const u=o.e({type:this.type},this.workerOptions);l?u.dataDiff=l:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let y=null;g.resourceTiming&&g.resourceTiming[this.id]&&(y=g.resourceTiming[this.id].slice(0));const B={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&o.e(B,{resourceTiming:y}),this.fire(new o.k("data",Object.assign(Object.assign({},B),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},B),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(g))}})}loaded(){return this._pendingLoads===0}loadTile(l){return o._(this,void 0,void 0,function*(){const u=l.actor?"RT":"LT";l.actor=this.actor;const g={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const y=yield this.actor.sendAsync({type:u,data:g},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(y,this.map.painter,u==="RT")})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Xe extends o.E{constructor(l,u,g,y){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=u}load(l){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield G.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,l&&(this.coordinates=l),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new o.j(u))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const u=l.map(o.Y.fromLngLat);var g;return this.tileID=function(y){let B=1/0,S=1/0,L=-1/0,O=-1/0;for(const J of y)B=Math.min(B,J.x),S=Math.min(S,J.y),L=Math.max(L,J.x),O=Math.max(O,J.y);const Q=Math.max(L-B,O-S),q=Math.max(0,Math.floor(-Math.log(Q)/Math.LN2)),Z=Math.pow(2,q);return new o.Z(q,Math.floor((B+L)/2*Z),Math.floor((S+O)/2*Z))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(y=>this.tileID.getTilePoint(y)._round()),this.flippedWindingOrder=((g=this.tileCoords)[1].x-g[0].x)*(g[2].y-g[0].y)-(g[1].y-g[0].y)*(g[2].x-g[0].x)<0,this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,u=l.gl;this.texture||(this.texture=new nt(l,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const B=this.tiles[y];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class er extends Xe{constructor(l,u,g,y){super(l,u,g,y),this.roundZoom=!0,this.type="video",this.options=u}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const u of l.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield o.a0(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new o.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const u=this.video.seekable;l<u.start(0)||l>u.end(0)?this.fire(new o.j(new o.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,u=l.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new nt(l,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const B=this.tiles[y];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gr extends Xe{constructor(l,u,g,y){super(l,u,g,y),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(B=>!Array.isArray(B)||B.length!==2||B.some(S=>typeof S!="number"))||this.fire(new o.j(new o.$(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.$(`sources.${l}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.j(new o.$(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.$(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.$(`sources.${l}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,g=u.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new nt(u,this.canvas,g.RGBA,{premultiply:!0});let y=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Re={},sr=w=>{switch(w){case"geojson":return $e;case"image":return Xe;case"raster":return Ur;case"raster-dem":return Ir;case"vector":return Qt;case"video":return er;case"canvas":return gr}return Re[w]},Br="RTLPluginLoaded";class xr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ye()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return o._(this,arguments,void 0,function(u){var g=this;let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(g.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(g.url=C.resolveURL(u),!g.url)throw new Error(`requested url ${u} is invalid`);if(g.status==="unavailable"){if(!y)return g._requestImport();g.status="deferred",g._syncState(g.status)}else if(g.status==="requested")return g._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Br))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Lr=null;function Zr(){return Lr||(Lr=new xr),Lr}class Nr{constructor(l,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=o.a1(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const u=l+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,u,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(y,B){const S={};if(!B)return S;for(const L of y){const O=L.layerIds.map(Q=>B.getLayer(Q)).filter(Boolean);if(O.length!==0){L.layers=O,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(Q=>O.filter(q=>q.id===Q)[0]));for(const Q of O)S[Q.id]=L}}return S}(l.buckets,u==null?void 0:u.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const B=this.buckets[y];if(B instanceof o.a3){if(this.hasSymbolBuckets=!0,!g)break;B.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const B=this.buckets[y];if(B instanceof o.a3&&B.hasRTLText){this.hasRTLText=!0,Zr().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const B=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(y).queryRadius(B))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new o.a2}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(l)}const u=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nt(l,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nt(l,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,u,g,y,B,S,L,O,Q,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:B,scale:S,tileSize:this.tileSize,pixelPosMatrix:q,transform:O,params:L,queryPadding:this.queryPadding*Q},l,u,g):{}}querySourceFeatures(l,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const y=g.loadVTLayers(),B=u&&u.sourceLayer?u.sourceLayer:"",S=y._geojsonTileLayer||y[B];if(!S)return;const L=o.a4(u&&u.filter),{z:O,x:Q,y:q}=this.tileID.canonical,Z={z:O,x:Q,y:q};for(let J=0;J<S.length;J++){const At=S.feature(J);if(L.needGeometry){const Ft=o.a5(At,!0);if(!L.filter(new o.z(this.tileID.overscaledZ),Ft,this.tileID.canonical))continue}else if(!L.filter(new o.z(this.tileID.overscaledZ),At))continue;const gt=g.getId(At,B),Lt=new o.a6(At,O,Q,q,gt);Lt.tile=Z,l.push(Lt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const u=this.expirationTime;if(l.cacheControl){const g=o.a7(l.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const g=Date.now();let y=!1;if(this.expirationTime>g)y=!1;else if(u)if(this.expirationTime<u)y=!0;else{const B=this.expirationTime-u;B?this.expirationTime=g+Math.max(B,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!u.style.hasLayer(y))continue;const B=this.buckets[y],S=B.layers[0].sourceLayer||"_geojsonTileLayer",L=g[S],O=l[S];if(!L||!O||Object.keys(O).length===0)continue;B.update(O,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Q=u&&u.style&&u.style.getLayer(y);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(B)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=C.now()+l}setDependencies(l,u){const g={};for(const y of u)g[y]=!0;this.dependencies[l]=g}hasDependency(l,u){for(const g of l){const y=this.dependencies[g];if(y){for(const B of u)if(y[B])return!0}}return!1}}class Vr{constructor(l,u){this.max=l,this.onRemove=u,this.reset()}reset(){for(const l in this.data)for(const u of this.data[l])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(l,u,g){const y=l.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const B={value:u,timeout:void 0};if(g!==void 0&&(B.timeout=setTimeout(()=>{this.remove(l,B)},g)),this.data[y].push(B),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const u=this.data[l].shift();return u.timeout&&clearTimeout(u.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),u.value}getByKey(l){const u=this.data[l];return u?u[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,u){if(!this.has(l))return this;const g=l.wrapped().key,y=u===void 0?0:this.data[g].indexOf(u),B=this.data[g][y];return this.data[g].splice(y,1),B.timeout&&clearTimeout(B.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(B.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(l){const u=[];for(const g in this.data)for(const y of this.data[g])l(y.value)||u.push(y);for(const g of u)this.remove(g.value.tileID,g)}}class yr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,u,g){const y=String(u);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][y]=this.stateChanges[l][y]||{},o.e(this.stateChanges[l][y],g),this.deletedStates[l]===null){this.deletedStates[l]={};for(const B in this.state[l])B!==y&&(this.deletedStates[l][B]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][y]===null){this.deletedStates[l][y]={};for(const B in this.state[l][y])g[B]||(this.deletedStates[l][y][B]=null)}else for(const B in g)this.deletedStates[l]&&this.deletedStates[l][y]&&this.deletedStates[l][y][B]===null&&delete this.deletedStates[l][y][B]}removeFeatureState(l,u,g){if(this.deletedStates[l]===null)return;const y=String(u);if(this.deletedStates[l]=this.deletedStates[l]||{},g&&u!==void 0)this.deletedStates[l][y]!==null&&(this.deletedStates[l][y]=this.deletedStates[l][y]||{},this.deletedStates[l][y][g]=null);else if(u!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][y])for(g in this.deletedStates[l][y]={},this.stateChanges[l][y])this.deletedStates[l][y][g]=null;else this.deletedStates[l][y]=null;else this.deletedStates[l]=null}getState(l,u){const g=String(u),y=o.e({},(this.state[l]||{})[g],(this.stateChanges[l]||{})[g]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const B=this.deletedStates[l][u];if(B===null)return{};for(const S in B)delete y[S]}return y}initializeTileState(l,u){l.setFeatureState(this.state,u)}coalesceChanges(l,u){const g={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const B={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),o.e(this.state[y][S],this.stateChanges[y][S]),B[S]=this.state[y][S];g[y]=B}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const B={};if(this.deletedStates[y]===null)for(const S in this.state[y])B[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else for(const L of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][L];B[S]=this.state[y][S]}g[y]=g[y]||{},o.e(g[y],B)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const y in l)l[y].setFeatureState(g,u)}}function In(w,l,u){const g=l.intersectsFrustum(w);if(!u)return g;const y=l.intersectsPlane(u);return g===0||y===0?0:g===2&&y===2?2:1}function an(w,l,u,g,y){let B=w;const S=Math.atan(l/u),L=Math.hypot(l,u);return B=w+o.a8(g/L/Math.max(.5,Math.cos(o.aa(y/2)))),B+=1*o.a8(Math.cos(S))/2,B+=o.ab(w-B,-0,0),B}function Xn(w,l){const u=(l.roundZoom?Math.round:Math.floor)(w.zoom+o.a8(w.tileSize/l.tileSize));return Math.max(0,u)}function Bt(w,l){const u=w.getCameraFrustum(),g=w.getClippingPlane(),y=w.screenPointToMercatorCoordinate(w.getCameraPoint()),B=o.Y.fromLngLat(w.center,w.elevation);y.z=B.z+Math.cos(w.pitchInRadians)*w.cameraToCenterDistance/w.worldSize;const S=w.getCoveringTilesDetailsProvider(),L=S.allowVariableZoom(w,l),O=Xn(w,l),Q=l.minzoom||0,q=l.maxzoom!==void 0?l.maxzoom:w.maxZoom,Z=Math.min(Math.max(0,O),q),J=Math.pow(2,Z),At=[J*y.x,J*y.y,0],gt=[J*B.x,J*B.y,0],Lt=Math.hypot(B.x-y.x,B.y-y.y),Ft=Math.abs(B.z-y.z),Ot=Math.hypot(Lt,Ft),kt=Jt=>({zoom:0,x:0,y:0,wrap:Jt,fullyVisible:!1}),qt=[],$t=[];if(w.renderWorldCopies&&S.allowWorldCopies())for(let Jt=1;Jt<=3;Jt++)qt.push(kt(-Jt)),qt.push(kt(Jt));for(qt.push(kt(0));qt.length>0;){const Jt=qt.pop(),ne=Jt.x,se=Jt.y;let Te=Jt.fullyVisible;const Ce={x:ne,y:se,z:Jt.zoom},Oe=S.getTileAABB(Ce,Jt.wrap,w.elevation,l);if(!Te){const Ar=In(u,Oe,g);if(Ar===0)continue;Te=Ar===2}const ze=S.distanceToTile2d(y.x,y.y,Ce,Oe);let Le=O;L&&(Le=(l.calculateTileZoom||an)(w.zoom+o.a8(w.tileSize/l.tileSize),ze,Ft,Ot,w.fov)),Le=(l.roundZoom?Math.round:Math.floor)(Le),Le=Math.max(0,Le);const fr=Math.min(Le,q);if(Jt.wrap=S.getWrap(B,Ce,Jt.wrap),Jt.zoom>=fr){if(Jt.zoom<Q)continue;const Ar=Z-Jt.zoom,Ke=At[0]-.5-(ne<<Ar),br=At[1]-.5-(se<<Ar),sn=l.reparseOverscaled?Math.max(Jt.zoom,Le):Jt.zoom;$t.push({tileID:new o.S(Jt.zoom===q?sn:Jt.zoom,Jt.wrap,Jt.zoom,ne,se),distanceSq:o.a9([gt[0]-.5-ne,gt[1]-.5-se]),tileDistanceToCamera:Math.sqrt(Ke*Ke+br*br)})}else for(let Ar=0;Ar<4;Ar++)qt.push({zoom:Jt.zoom+1,x:(ne<<1)+Ar%2,y:(se<<1)+(Ar>>1),wrap:Jt.wrap,fullyVisible:Te})}return $t.sort((Jt,ne)=>Jt.distanceSq-ne.distanceSq).map(Jt=>Jt.tileID)}class ct extends o.E{constructor(l,u,g){super(),this.id=l,this.dispatcher=g,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,B,S,L)=>{const O=new(sr(B.type))(y,B,S,L);if(O.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${O.id}`);return O})(l,u,g,this),this._tiles={},this._cache=new Vr(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yr,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const u=this._tiles[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,u,g){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,u,g)}catch(y){l.state="errored",y.status!==404?this._source.fire(new o.j(y,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new o.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(l),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(ft).map(l=>l.key)}getRenderableIds(l){const u=[];for(const g in this._tiles)this._isIdRenderable(g,l)&&u.push(this._tiles[g]);return l?u.sort((g,y)=>{const B=g.tileID,S=y.tileID,L=new o.P(B.canonical.x,B.canonical.y)._rotate(-this.transform.bearingInRadians),O=new o.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians);return B.overscaledZ-S.overscaledZ||O.y-L.y||O.x-L.x}).map(g=>g.tileID.key):u.map(g=>g.tileID).sort(ft).map(g=>g.key)}hasRenderableParent(l){const u=this.findLoadedParent(l,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(l,u){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(u||!this._tiles[l].holdingForFade())}reload(l){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)(l||this._tiles[u].state!=="errored")&&this._reloadTile(u,"reloading")}}_reloadTile(l,u){return o._(this,void 0,void 0,function*(){const g=this._tiles[l];g&&(g.state!=="loading"&&(g.state=u),yield this._loadTile(g,l,u))})}_tileLoaded(l,u,g){l.timeAdded=C.now(),g==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(u,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const u=this.getRenderableIds();for(let y=0;y<u.length;y++){const B=u[y];if(l.neighboringTiles&&l.neighboringTiles[B]){const S=this.getTileByID(B);g(l,S),g(S,l)}}function g(y,B){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let S=B.tileID.canonical.x-y.tileID.canonical.x;const L=B.tileID.canonical.y-y.tileID.canonical.y,O=Math.pow(2,y.tileID.canonical.z),Q=B.tileID.key;S===0&&L===0||Math.abs(L)>1||(Math.abs(S)>1&&(Math.abs(S+O)===1?S+=O:Math.abs(S-O)===1&&(S-=O)),B.dem&&y.dem&&(y.dem.backfillBorder(B.dem,S,L),y.neighboringTiles&&y.neighboringTiles[Q]&&(y.neighboringTiles[Q].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,u,g,y){for(const B in this._tiles){let S=this._tiles[B];if(y[B]||!S.hasData()||S.tileID.overscaledZ<=u||S.tileID.overscaledZ>g)continue;let L=S.tileID;for(;S&&S.tileID.overscaledZ>u+1;){const Q=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[Q.key],S&&S.hasData()&&(L=Q)}let O=L;for(;O.overscaledZ>u;)if(O=O.scaledTo(O.overscaledZ-1),l[O.key]||l[O.canonical.key]){y[L.key]=L;break}}}findLoadedParent(l,u){if(l.key in this._loadedParentTiles){const g=this._loadedParentTiles[l.key];return g&&g.tileID.overscaledZ>=u?g:null}for(let g=l.overscaledZ-1;g>=u;g--){const y=l.scaledTo(g),B=this._getLoadedTile(y);if(B)return B}}findLoadedSibling(l){return this._getLoadedTile(l)}_getLoadedTile(l){const u=this._tiles[l.key];return u&&u.hasData()?u:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const u=Math.ceil(l.width/this._source.tileSize)+1,g=Math.ceil(l.height/this._source.tileSize)+1,y=Math.floor(u*g*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),B=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(B)}handleWrapJump(l){const u=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,u){const g={};for(const y in this._tiles){const B=this._tiles[y];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+u),g[B.tileID.key]=B}this._tiles=g;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(l,u,g,y,B,S){const L={},O={},Q=Object.keys(l),q=C.now();for(const Z of Q){const J=l[Z],At=this._tiles[Z];if(!At||At.fadeEndTime!==0&&At.fadeEndTime<=q)continue;const gt=this.findLoadedParent(J,u),Lt=this.findLoadedSibling(J),Ft=gt||Lt||null;Ft&&(this._addTile(Ft.tileID),L[Ft.tileID.key]=Ft.tileID),O[Z]=J}this._retainLoadedChildren(O,y,g,l);for(const Z in L)l[Z]||(this._coveredTiles[Z]=!0,l[Z]=L[Z]);if(S){const Z={},J={};for(const At of B)this._tiles[At.key].hasData()?Z[At.key]=At:J[At.key]=At;for(const At in J){const gt=J[At].children(this._source.maxzoom);this._tiles[gt[0].key]&&this._tiles[gt[1].key]&&this._tiles[gt[2].key]&&this._tiles[gt[3].key]&&(Z[gt[0].key]=l[gt[0].key]=gt[0],Z[gt[1].key]=l[gt[1].key]=gt[1],Z[gt[2].key]=l[gt[2].key]=gt[2],Z[gt[3].key]=l[gt[3].key]=gt[3],delete J[At])}for(const At in J){const gt=J[At],Lt=this.findLoadedParent(gt,this._source.minzoom),Ft=this.findLoadedSibling(gt),Ot=Lt||Ft||null;if(Ot){Z[Ot.tileID.key]=l[Ot.tileID.key]=Ot.tileID;for(const kt in Z)Z[kt].isChildOf(Ot.tileID)&&delete Z[kt]}}for(const At in this._tiles)Z[At]||(this._coveredTiles[At]=!0)}}update(l,u){if(!this._sourceLoaded||this._paused)return;let g;this.transform=l,this.terrain=u,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new o.S(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(g=Bt(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(g=g.filter(q=>this._source.hasTile(q)))):g=[];const y=Xn(l,this._source),B=Math.max(y-ct.maxOverzooming,this._source.minzoom),S=Math.max(y+ct.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const Z of g)if(Z.canonical.z>this._source.minzoom){const J=Z.scaledTo(Z.canonical.z-1);q[J.key]=J;const At=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));q[At.key]=At}g=g.concat(Object.values(q))}const L=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(g,y);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(O,B,S,y,g,u);for(const q in O)this._tiles[q].clearFadeHold();const Q=o.ac(this._tiles,O);for(const q of Q){const Z=this._tiles[q];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,u){var g;const y={},B={},S=Math.max(u-ct.maxOverzooming,this._source.minzoom),L=Math.max(u+ct.maxUnderzooming,this._source.minzoom),O={};for(const Q of l){const q=this._addTile(Q);y[Q.key]=Q,q.hasData()||u<this._source.maxzoom&&(O[Q.key]=Q)}this._retainLoadedChildren(O,u,L,y);for(const Q of l){let q=this._tiles[Q.key];if(q.hasData())continue;if(u+1>this._source.maxzoom){const J=Q.children(this._source.maxzoom)[0],At=this.getTile(J);if(At&&At.hasData()){y[J.key]=J;continue}}else{const J=Q.children(this._source.maxzoom);if(y[J[0].key]&&y[J[1].key]&&y[J[2].key]&&y[J[3].key])continue}let Z=q.wasRequested();for(let J=Q.overscaledZ-1;J>=S;--J){const At=Q.scaledTo(J);if(B[At.key])break;if(B[At.key]=!0,q=this.getTile(At),!q&&Z&&(q=this._addTile(At)),q){const gt=q.hasData();if((gt||!(!((g=this.map)===null||g===void 0)&&g.cancelPendingTileRequestsWhileZooming)||Z)&&(y[At.key]=At),Z=q.wasRequested(),gt)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const u=[];let g,y=this._tiles[l].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){g=this._loadedParentTiles[y.key];break}u.push(y.key);const B=y.scaledTo(y.overscaledZ-1);if(g=this._getLoadedTile(B),g)break;y=B}for(const B of u)this._loadedParentTiles[B]=g}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const l in this._tiles){const u=this._tiles[l].tileID,g=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=g}}_addTile(l){let u=this._tiles[l.key];if(u)return u;u=this._cache.getAndRemove(l),u&&(this._setTileReloadTimer(l.key,u),u.tileID=l,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,u)));const g=u;return u||(u=new Nr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(u,l.key,u.state)),u.uses++,this._tiles[l.key]=u,g||this._source.fire(new o.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(l,u){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const g=u.getExpiryTimeout();g&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},g))}_removeTile(l){const u=this._tiles[l];u&&(u.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(l){const u=l.sourceDataType;l.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&u==="content"&&(this.reload(l.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,u,g){const y=[],B=this.transform;if(!B)return y;const S=g?B.getCameraQueryGeometry(l):l,L=l.map(gt=>B.screenPointToMercatorCoordinate(gt,this.terrain)),O=S.map(gt=>B.screenPointToMercatorCoordinate(gt,this.terrain)),Q=this.getIds();let q=1/0,Z=1/0,J=-1/0,At=-1/0;for(const gt of O)q=Math.min(q,gt.x),Z=Math.min(Z,gt.y),J=Math.max(J,gt.x),At=Math.max(At,gt.y);for(let gt=0;gt<Q.length;gt++){const Lt=this._tiles[Q[gt]];if(Lt.holdingForFade())continue;const Ft=Lt.tileID,Ot=Math.pow(2,B.zoom-Lt.tileID.overscaledZ),kt=u*Lt.queryPadding*o.X/Lt.tileSize/Ot,qt=[Ft.getTilePoint(new o.Y(q,Z)),Ft.getTilePoint(new o.Y(J,At))];if(qt[0].x-kt<o.X&&qt[0].y-kt<o.X&&qt[1].x+kt>=0&&qt[1].y+kt>=0){const $t=L.map(ne=>Ft.getTilePoint(ne)),Jt=O.map(ne=>Ft.getTilePoint(ne));y.push({tile:Lt,tileID:Ft,queryGeometry:$t,cameraQueryGeometry:Jt,scale:Ot})}}return y}getVisibleCoordinates(l){const u=this.getRenderableIds(l).map(g=>this._tiles[g].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){const l=C.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=l)return!0}return!1}setFeatureState(l,u,g){this._state.updateState(l=l||"_geojsonTileLayer",u,g)}removeFeatureState(l,u,g){this._state.removeFeatureState(l=l||"_geojsonTileLayer",u,g)}getFeatureState(l,u){return this._state.getState(l=l||"_geojsonTileLayer",u)}setDependencies(l,u,g){const y=this._tiles[l];y&&y.setDependencies(u,g)}reloadTilesForDependencies(l,u){for(const g in this._tiles)this._tiles[g].hasDependency(l,u)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(l,u))}}function ft(w,l){const u=Math.abs(2*w.wrap)-+(w.wrap<0),g=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||g-u||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function pt(w){return w==="raster"||w==="image"||w==="video"}ct.maxOverzooming=10,ct.maxUnderzooming=3;class Dt{constructor(l,u){this.reset(l,u)}reset(l,u){this.points=l||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ab(l,0,1);let u=1,g=this._distances[u];const y=l*this.paddedLength+this.padding;for(;g<y&&u<this._distances.length;)g=this._distances[++u];const B=u-1,S=this._distances[B],L=g-S,O=L>0?(y-S)/L:0;return this.points[B].mult(1-O).add(this.points[u].mult(O))}}function Gt(w,l){let u=!0;return w==="always"||w!=="never"&&l!=="never"||(u=!1),u}class le{constructor(l,u,g){const y=this.boxCells=[],B=this.circleCells=[];this.xCellCount=Math.ceil(l/g),this.yCellCount=Math.ceil(u/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),B.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=u,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,u,g,y,B){this._forEachCell(u,g,y,B,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(B)}insertCircle(l,u,g,y){this._forEachCell(u-y,g-y,u+y,g+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(u),this.circles.push(g),this.circles.push(y)}_insertBoxCell(l,u,g,y,B,S){this.boxCells[B].push(S)}_insertCircleCell(l,u,g,y,B,S){this.circleCells[B].push(S)}_query(l,u,g,y,B,S,L){if(g<0||l>this.width||y<0||u>this.height)return[];const O=[];if(l<=0&&u<=0&&this.width<=g&&this.height<=y){if(B)return[{key:null,x1:l,y1:u,x2:g,y2:y}];for(let Q=0;Q<this.boxKeys.length;Q++)O.push({key:this.boxKeys[Q],x1:this.bboxes[4*Q],y1:this.bboxes[4*Q+1],x2:this.bboxes[4*Q+2],y2:this.bboxes[4*Q+3]});for(let Q=0;Q<this.circleKeys.length;Q++){const q=this.circles[3*Q],Z=this.circles[3*Q+1],J=this.circles[3*Q+2];O.push({key:this.circleKeys[Q],x1:q-J,y1:Z-J,x2:q+J,y2:Z+J})}}else this._forEachCell(l,u,g,y,this._queryCell,O,{hitTest:B,overlapMode:S,seenUids:{box:{},circle:{}}},L);return O}query(l,u,g,y){return this._query(l,u,g,y,!1,null)}hitTest(l,u,g,y,B,S){return this._query(l,u,g,y,!0,B,S).length>0}hitTestCircle(l,u,g,y,B){const S=l-g,L=l+g,O=u-g,Q=u+g;if(L<0||S>this.width||Q<0||O>this.height)return!1;const q=[];return this._forEachCell(S,O,L,Q,this._queryCellCircle,q,{hitTest:!0,overlapMode:y,circle:{x:l,y:u,radius:g},seenUids:{box:{},circle:{}}},B),q.length>0}_queryCell(l,u,g,y,B,S,L,O){const{seenUids:Q,hitTest:q,overlapMode:Z}=L,J=this.boxCells[B];if(J!==null){const gt=this.bboxes;for(const Lt of J)if(!Q.box[Lt]){Q.box[Lt]=!0;const Ft=4*Lt,Ot=this.boxKeys[Lt];if(l<=gt[Ft+2]&&u<=gt[Ft+3]&&g>=gt[Ft+0]&&y>=gt[Ft+1]&&(!O||O(Ot))&&(!q||!Gt(Z,Ot.overlapMode))&&(S.push({key:Ot,x1:gt[Ft],y1:gt[Ft+1],x2:gt[Ft+2],y2:gt[Ft+3]}),q))return!0}}const At=this.circleCells[B];if(At!==null){const gt=this.circles;for(const Lt of At)if(!Q.circle[Lt]){Q.circle[Lt]=!0;const Ft=3*Lt,Ot=this.circleKeys[Lt];if(this._circleAndRectCollide(gt[Ft],gt[Ft+1],gt[Ft+2],l,u,g,y)&&(!O||O(Ot))&&(!q||!Gt(Z,Ot.overlapMode))){const kt=gt[Ft],qt=gt[Ft+1],$t=gt[Ft+2];if(S.push({key:Ot,x1:kt-$t,y1:qt-$t,x2:kt+$t,y2:qt+$t}),q)return!0}}}return!1}_queryCellCircle(l,u,g,y,B,S,L,O){const{circle:Q,seenUids:q,overlapMode:Z}=L,J=this.boxCells[B];if(J!==null){const gt=this.bboxes;for(const Lt of J)if(!q.box[Lt]){q.box[Lt]=!0;const Ft=4*Lt,Ot=this.boxKeys[Lt];if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,gt[Ft+0],gt[Ft+1],gt[Ft+2],gt[Ft+3])&&(!O||O(Ot))&&!Gt(Z,Ot.overlapMode))return S.push(!0),!0}}const At=this.circleCells[B];if(At!==null){const gt=this.circles;for(const Lt of At)if(!q.circle[Lt]){q.circle[Lt]=!0;const Ft=3*Lt,Ot=this.circleKeys[Lt];if(this._circlesCollide(gt[Ft],gt[Ft+1],gt[Ft+2],Q.x,Q.y,Q.radius)&&(!O||O(Ot))&&!Gt(Z,Ot.overlapMode))return S.push(!0),!0}}}_forEachCell(l,u,g,y,B,S,L,O){const Q=this._convertToXCellCoord(l),q=this._convertToYCellCoord(u),Z=this._convertToXCellCoord(g),J=this._convertToYCellCoord(y);for(let At=Q;At<=Z;At++)for(let gt=q;gt<=J;gt++)if(B.call(this,l,u,g,y,this.xCellCount*gt+At,S,L,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,u,g,y,B,S){const L=y-l,O=B-u,Q=g+S;return Q*Q>L*L+O*O}_circleAndRectCollide(l,u,g,y,B,S,L){const O=(S-y)/2,Q=Math.abs(l-(y+O));if(Q>O+g)return!1;const q=(L-B)/2,Z=Math.abs(u-(B+q));if(Z>q+g)return!1;if(Q<=O||Z<=q)return!0;const J=Q-O,At=Z-q;return J*J+At*At<=g*g}}function ge(w,l,u){const g=o.H();if(!w){const{vecSouth:Z,vecEast:J}=he(l),At=f();At[0]=J[0],At[1]=J[1],At[2]=Z[0],At[3]=Z[1],y=At,(q=(S=(B=At)[0])*(Q=B[3])-(O=B[2])*(L=B[1]))&&(y[0]=Q*(q=1/q),y[1]=-L*q,y[2]=-O*q,y[3]=S*q),g[0]=At[0],g[1]=At[1],g[4]=At[2],g[5]=At[3]}var y,B,S,L,O,Q,q;return o.K(g,g,[1/u,1/u,1]),g}function te(w,l,u,g){if(w){const y=o.H();if(!l){const{vecSouth:B,vecEast:S}=he(u);y[0]=S[0],y[1]=S[1],y[4]=B[0],y[5]=B[1]}return o.K(y,y,[g,g,1]),y}return u.pixelsToClipSpaceMatrix}function he(w){const l=Math.cos(w.rollInRadians),u=Math.sin(w.rollInRadians),g=Math.cos(w.pitchInRadians),y=Math.cos(w.bearingInRadians),B=Math.sin(w.bearingInRadians),S=o.ad();S[0]=-y*g*u-B*l,S[1]=-B*g*u+y*l;const L=o.ae(S);L<1e-9?o.af(S):o.ag(S,S,1/L);const O=o.ad();O[0]=y*g*l-B*u,O[1]=B*g*l+y*u;const Q=o.ae(O);return Q<1e-9?o.af(O):o.ag(O,O,1/Q),{vecEast:O,vecSouth:S}}function ve(w,l,u,g){let y;g?(y=[w,l,g(w,l),1],o.al(y,y,u)):(y=[w,l,0,1],Dn(y,y,u));const B=y[3];return{point:new o.P(y[0]/B,y[1]/B),signedDistanceFromCamera:B,isOccluded:!1}}function me(w,l){return .5+w/l*.5}function Yt(w,l){return w.x>=-l[0]&&w.x<=l[0]&&w.y>=-l[1]&&w.y<=l[1]}function ur(w,l,u,g,y,B,S,L,O,Q,q,Z,J){const At=u?w.textSizeData:w.iconSizeData,gt=o.ah(At,l.transform.zoom),Lt=[256/l.width*2+1,256/l.height*2+1],Ft=u?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Ft.clear();const Ot=w.lineVertexArray,kt=u?w.text.placedSymbolArray:w.icon.placedSymbolArray,qt=l.transform.width/l.transform.height;let $t=!1;for(let Jt=0;Jt<kt.length;Jt++){const ne=kt.get(Jt);if(ne.hidden||ne.writingMode===o.ai.vertical&&!$t){mn(ne.numGlyphs,Ft);continue}$t=!1;const se=new o.P(ne.anchorX,ne.anchorY),Te={getElevation:J,pitchedLabelPlaneMatrix:g,lineVertexArray:Ot,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:se,unwrappedTileID:O,width:Q,height:q,translation:Z},Ce=Yr(ne.anchorX,ne.anchorY,Te);if(!Yt(Ce.point,Lt)){mn(ne.numGlyphs,Ft);continue}const Oe=me(l.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),ze=o.aj(At,gt,ne),Le=B?ze*l.transform.getPitchedTextCorrection(ne.anchorX,ne.anchorY,O)/Oe:ze*Oe,fr=Mr({projectionContext:Te,pitchedLabelPlaneMatrixInverse:y,symbol:ne,fontSize:Le,flip:!1,keepUpright:S,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:Ft,aspectRatio:qt,rotateToLine:L});$t=fr.useVertical,(fr.notEnoughRoom||$t||fr.needsFlipping&&Mr({projectionContext:Te,pitchedLabelPlaneMatrixInverse:y,symbol:ne,fontSize:Le,flip:!0,keepUpright:S,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:Ft,aspectRatio:qt,rotateToLine:L}).notEnoughRoom)&&mn(ne.numGlyphs,Ft)}u?w.text.dynamicLayoutVertexBuffer.updateData(Ft):w.icon.dynamicLayoutVertexBuffer.updateData(Ft)}function ir(w,l,u,g,y,B,S,L){const O=B.glyphStartIndex+B.numGlyphs,Q=B.lineStartIndex,q=B.lineStartIndex+B.lineLength,Z=l.getoffsetX(B.glyphStartIndex),J=l.getoffsetX(O-1),At=wn(w*Z,u,g,y,B.segment,Q,q,L,S);if(!At)return null;const gt=wn(w*J,u,g,y,B.segment,Q,q,L,S);return gt?L.projectionCache.anyProjectionOccluded?null:{first:At,last:gt}:null}function tr(w,l,u,g){return w===o.ai.horizontal&&Math.abs(u.y-l.y)>Math.abs(u.x-l.x)*g?{useVertical:!0}:(w===o.ai.vertical?l.y<u.y:l.x>u.x)?{needsFlipping:!0}:null}function Mr(w){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:u,symbol:g,fontSize:y,flip:B,keepUpright:S,glyphOffsetArray:L,dynamicLayoutVertexArray:O,aspectRatio:Q,rotateToLine:q}=w,Z=y/24,J=g.lineOffsetX*Z,At=g.lineOffsetY*Z;let gt;if(g.numGlyphs>1){const Lt=g.glyphStartIndex+g.numGlyphs,Ft=g.lineStartIndex,Ot=g.lineStartIndex+g.lineLength,kt=ir(Z,L,J,At,B,g,q,l);if(!kt)return{notEnoughRoom:!0};const qt=Fr(kt.first.point.x,kt.first.point.y,l,u),$t=Fr(kt.last.point.x,kt.last.point.y,l,u);if(S&&!B){const Jt=tr(g.writingMode,qt,$t,Q);if(Jt)return Jt}gt=[kt.first];for(let Jt=g.glyphStartIndex+1;Jt<Lt-1;Jt++)gt.push(wn(Z*L.getoffsetX(Jt),J,At,B,g.segment,Ft,Ot,l,q));gt.push(kt.last)}else{if(S&&!B){const Ft=_r(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,Ot=g.lineStartIndex+g.segment+1,kt=new o.P(l.lineVertexArray.getx(Ot),l.lineVertexArray.gety(Ot)),qt=_r(kt.x,kt.y,l),$t=qt.signedDistanceFromCamera>0?qt.point:Fe(l.tileAnchorPoint,kt,Ft,1,l),Jt=Fr(Ft.x,Ft.y,l,u),ne=Fr($t.x,$t.y,l,u),se=tr(g.writingMode,Jt,ne,Q);if(se)return se}const Lt=wn(Z*L.getoffsetX(g.glyphStartIndex),J,At,B,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,l,q);if(!Lt||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};gt=[Lt]}for(const Lt of gt)o.ak(O,Lt.point,Lt.angle);return{}}function Fe(w,l,u,g,y){const B=w.add(w.sub(l)._unit()),S=_r(B.x,B.y,y).point,L=u.sub(S);return u.add(L._mult(g/L.mag()))}function nr(w,l,u){const g=l.projectionCache;if(g.projections[w])return g.projections[w];const y=new o.P(l.lineVertexArray.getx(w),l.lineVertexArray.gety(w)),B=_r(y.x,y.y,l);if(B.signedDistanceFromCamera>0)return g.projections[w]=B.point,g.anyProjectionOccluded=g.anyProjectionOccluded||B.isOccluded,B.point;const S=w-u.direction;return Fe(u.distanceFromAnchor===0?l.tileAnchorPoint:new o.P(l.lineVertexArray.getx(S),l.lineVertexArray.gety(S)),y,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,l)}function _r(w,l,u){const g=w+u.translation[0],y=l+u.translation[1];let B;return u.pitchWithMap?(B=ve(g,y,u.pitchedLabelPlaneMatrix,u.getElevation),B.isOccluded=!1):(B=u.transform.projectTileCoordinates(g,y,u.unwrappedTileID,u.getElevation),B.point.x=(.5*B.point.x+.5)*u.width,B.point.y=(.5*-B.point.y+.5)*u.height),B}function Fr(w,l,u,g){if(u.pitchWithMap){const y=[w,l,0,1];return o.al(y,y,g),u.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],u.unwrappedTileID,u.getElevation).point}return{x:w/u.width*2-1,y:l/u.height*2-1}}function Yr(w,l,u){return u.transform.projectTileCoordinates(w,l,u.unwrappedTileID,u.getElevation)}function Qr(w,l,u){return w._unit()._perp()._mult(l*u)}function vr(w,l,u,g,y,B,S,L,O){if(L.projectionCache.offsets[w])return L.projectionCache.offsets[w];const Q=u.add(l);if(w+O.direction<g||w+O.direction>=y)return L.projectionCache.offsets[w]=Q,Q;const q=nr(w+O.direction,L,O),Z=Qr(q.sub(u),S,O.direction),J=u.add(Z),At=q.add(Z);return L.projectionCache.offsets[w]=o.am(B,Q,J,At)||Q,L.projectionCache.offsets[w]}function wn(w,l,u,g,y,B,S,L,O){const Q=g?w-l:w+l;let q=Q>0?1:-1,Z=0;g&&(q*=-1,Z=Math.PI),q<0&&(Z+=Math.PI);let J,At=q>0?B+y:B+y+1;L.projectionCache.cachedAnchorPoint?J=L.projectionCache.cachedAnchorPoint:(J=_r(L.tileAnchorPoint.x,L.tileAnchorPoint.y,L).point,L.projectionCache.cachedAnchorPoint=J);let gt,Lt,Ft=J,Ot=J,kt=0,qt=0;const $t=Math.abs(Q),Jt=[];let ne;for(;kt+qt<=$t;){if(At+=q,At<B||At>=S)return null;kt+=qt,Ot=Ft,Lt=gt;const Ce={absOffsetX:$t,direction:q,distanceFromAnchor:kt,previousVertex:Ot};if(Ft=nr(At,L,Ce),u===0)Jt.push(Ot),ne=Ft.sub(Ot);else{let Oe;const ze=Ft.sub(Ot);Oe=ze.mag()===0?Qr(nr(At+q,L,Ce).sub(Ft),u,q):Qr(ze,u,q),Lt||(Lt=Ot.add(Oe)),gt=vr(At,Oe,Ft,B,S,Lt,u,L,Ce),Jt.push(Lt),ne=gt.sub(Lt)}qt=ne.mag()}const se=ne._mult(($t-kt)/qt)._add(Lt||Ot),Te=Z+Math.atan2(Ft.y-Ot.y,Ft.x-Ot.x);return Jt.push(se),{point:se,angle:O?Te:0,path:Jt}}const Ai=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mn(w,l){for(let u=0;u<w;u++){const g=l.length;l.resize(g+4),l.float32.set(Ai,3*g)}}function Dn(w,l,u){const g=l[0],y=l[1];return w[0]=u[0]*g+u[4]*y+u[12],w[1]=u[1]*g+u[5]*y+u[13],w[3]=u[3]*g+u[7]*y+u[15],w}const gn=100;class Hn{constructor(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new le(l.width+200,l.height+200,25),g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new le(l.width+200,l.height+200,25);this.transform=l,this.grid=u,this.ignoredGrid=g,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+gn,this.screenBottomBoundary=l.height+gn,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,u,g,y,B,S,L,O,Q,q,Z,J){const At=this.projectAndGetPerspectiveRatio(l.anchorPointX+O[0],l.anchorPointY+O[1],B,q,J),gt=g*At.perspectiveRatio;let Lt;if(S||L)Lt=this._projectCollisionBox(l,gt,y,B,S,L,O,At,q,Z,J);else{const ne=At.x+(Z?Z.x*gt:0),se=At.y+(Z?Z.y*gt:0);Lt={allPointsOccluded:!1,box:[ne+l.x1*gt,se+l.y1*gt,ne+l.x2*gt,se+l.y2*gt]}}const[Ft,Ot,kt,qt]=Lt.box,$t=S?Lt.allPointsOccluded:At.isOccluded;let Jt=$t;return Jt||(Jt=At.perspectiveRatio<this.perspectiveRatioCutoff),Jt||(Jt=!this.isInsideGrid(Ft,Ot,kt,qt)),Jt||u!=="always"&&this.grid.hitTest(Ft,Ot,kt,qt,u,Q)?{box:[Ft,Ot,kt,qt],placeable:!1,offscreen:!1,occluded:$t}:{box:[Ft,Ot,kt,qt],placeable:!0,offscreen:this.isOffscreen(Ft,Ot,kt,qt),occluded:$t}}placeCollisionCircles(l,u,g,y,B,S,L,O,Q,q,Z,J,At,gt){const Lt=[],Ft=new o.P(u.anchorX,u.anchorY),Ot=this.getPerspectiveRatio(Ft.x,Ft.y,S,gt),kt=(Q?B*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,S)/Ot:B*Ot)/o.as,qt={getElevation:gt,pitchedLabelPlaneMatrix:L,lineVertexArray:g,pitchWithMap:Q,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ft,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:At},$t=ir(kt,y,u.lineOffsetX*kt,u.lineOffsetY*kt,!1,u,!1,qt);let Jt=!1,ne=!1,se=!0;if($t){const Te=.5*Z*Ot+J,Ce=new o.P(-100,-100),Oe=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new Dt,Le=$t.first,fr=$t.last;let Ar=[];for(let sn=Le.path.length-1;sn>=1;sn--)Ar.push(Le.path[sn]);for(let sn=1;sn<fr.path.length;sn++)Ar.push(fr.path[sn]);const Ke=2.5*Te;if(Q){const sn=this.projectPathToScreenSpace(Ar,qt);Ar=sn.some(Mn=>Mn.signedDistanceFromCamera<=0)?[]:sn.map(Mn=>Mn.point)}let br=[];if(Ar.length>0){const sn=Ar[0].clone(),Mn=Ar[0].clone();for(let vi=1;vi<Ar.length;vi++)sn.x=Math.min(sn.x,Ar[vi].x),sn.y=Math.min(sn.y,Ar[vi].y),Mn.x=Math.max(Mn.x,Ar[vi].x),Mn.y=Math.max(Mn.y,Ar[vi].y);br=sn.x>=Ce.x&&Mn.x<=Oe.x&&sn.y>=Ce.y&&Mn.y<=Oe.y?[Ar]:Mn.x<Ce.x||sn.x>Oe.x||Mn.y<Ce.y||sn.y>Oe.y?[]:o.ao([Ar],Ce.x,Ce.y,Oe.x,Oe.y)}for(const sn of br){ze.reset(sn,.25*Te);let Mn=0;Mn=ze.length<=.5*Te?1:Math.ceil(ze.paddedLength/Ke)+1;for(let vi=0;vi<Mn;vi++){const oi=vi/Math.max(Mn-1,1),bi=ze.lerp(oi),zn=bi.x+gn,Jn=bi.y+gn;Lt.push(zn,Jn,Te,0);const ti=zn-Te,qs=Jn-Te,ts=zn+Te,as=Jn+Te;if(se=se&&this.isOffscreen(ti,qs,ts,as),ne=ne||this.isInsideGrid(ti,qs,ts,as),l!=="always"&&this.grid.hitTestCircle(zn,Jn,Te,l,q)&&(Jt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Jt}}}}return{circles:!O&&Jt||!ne||Ot<this.perspectiveRatioCutoff?[]:Lt,offscreen:se,collisionDetected:Jt}}projectPathToScreenSpace(l,u){const g=function(y,B){const S=o.H();return o.an(S,B.pitchedLabelPlaneMatrix),y.map(L=>{const O=ve(L.x,L.y,S,B.getElevation),Q=B.transform.projectTileCoordinates(O.point.x,O.point.y,B.unwrappedTileID,B.getElevation);return Q.point.x=(.5*Q.point.x+.5)*B.width,Q.point.y=(.5*-Q.point.y+.5)*B.height,Q})}(l,u);return function(y){let B=0,S=0,L=0,O=0;for(let Q=0;Q<y.length;Q++)y[Q].isOccluded?(L=Q+1,O=0):(O++,O>S&&(S=O,B=L));return y.slice(B,B+S)}(g)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,y=1/0,B=-1/0,S=-1/0;for(const q of l){const Z=new o.P(q.x+gn,q.y+gn);g=Math.min(g,Z.x),y=Math.min(y,Z.y),B=Math.max(B,Z.x),S=Math.max(S,Z.y),u.push(Z)}const L=this.grid.query(g,y,B,S).concat(this.ignoredGrid.query(g,y,B,S)),O={},Q={};for(const q of L){const Z=q.key;if(O[Z.bucketInstanceId]===void 0&&(O[Z.bucketInstanceId]={}),O[Z.bucketInstanceId][Z.featureIndex])continue;const J=[new o.P(q.x1,q.y1),new o.P(q.x2,q.y1),new o.P(q.x2,q.y2),new o.P(q.x1,q.y2)];o.ap(u,J)&&(O[Z.bucketInstanceId][Z.featureIndex]=!0,Q[Z.bucketInstanceId]===void 0&&(Q[Z.bucketInstanceId]=[]),Q[Z.bucketInstanceId].push(Z.featureIndex))}return Q}insertCollisionBox(l,u,g,y,B,S){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:B,collisionGroupID:S,overlapMode:u},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,u,g,y,B,S){const L=g?this.ignoredGrid:this.grid,O={bucketInstanceId:y,featureIndex:B,collisionGroupID:S,overlapMode:u};for(let Q=0;Q<l.length;Q+=4)L.insertCircle(O,l[Q],l[Q+1],l[Q+2])}projectAndGetPerspectiveRatio(l,u,g,y,B){if(B){let S;y?(S=[l,u,y(l,u),1],o.al(S,S,B)):(S=[l,u,0,1],Dn(S,S,B));const L=S[3];return{x:(S[0]/L+1)/2*this.transform.width+gn,y:(-S[1]/L+1)/2*this.transform.height+gn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/L*.5,isOccluded:!1,signedDistanceFromCamera:L}}{const S=this.transform.projectTileCoordinates(l,u,g,y);return{x:(S.point.x+1)/2*this.transform.width+gn,y:(1-S.point.y)/2*this.transform.height+gn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5,isOccluded:S.isOccluded,signedDistanceFromCamera:S.signedDistanceFromCamera}}}getPerspectiveRatio(l,u,g,y){const B=this.transform.projectTileCoordinates(l,u,g,y);return .5+this.transform.cameraToCenterDistance/B.signedDistanceFromCamera*.5}isOffscreen(l,u,g,y){return g<gn||l>=this.screenRightBoundary||y<gn||u>this.screenBottomBoundary}isInsideGrid(l,u,g,y){return g>=0&&l<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const l=o.aq([]);return o.J(l,l,[-100,-100,0]),l}_projectCollisionBox(l,u,g,y,B,S,L,O,Q,q,Z){let J=1,At=0,gt=0,Lt=1;const Ft=l.anchorPointX+L[0],Ot=l.anchorPointY+L[1];if(S&&!B){const Ar=this.projectAndGetPerspectiveRatio(Ft+1,Ot,y,Q,Z),Ke=Ar.x-O.x,br=Math.atan((Ar.y-O.y)/Ke)+(Ke<0?Math.PI:0),sn=Math.sin(br),Mn=Math.cos(br);J=Mn,At=sn,gt=-sn,Lt=Mn}else if(!S&&B){const Ar=he(this.transform);J=Ar.vecEast[0],At=Ar.vecEast[1],gt=Ar.vecSouth[0],Lt=Ar.vecSouth[1]}let kt=O.x,qt=O.y,$t=u;B&&(kt=Ft,qt=Ot,$t=Math.pow(2,-(this.transform.zoom-g.overscaledZ)),$t*=this.transform.getPitchedTextCorrection(Ft,Ot,y),q||($t*=o.ab(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),q&&(kt+=J*q.x*$t+gt*q.y*$t,qt+=At*q.x*$t+Lt*q.y*$t);const Jt=l.x1*$t,ne=l.x2*$t,se=(Jt+ne)/2,Te=l.y1*$t,Ce=l.y2*$t,Oe=(Te+Ce)/2,ze=[{offsetX:Jt,offsetY:Te},{offsetX:se,offsetY:Te},{offsetX:ne,offsetY:Te},{offsetX:ne,offsetY:Oe},{offsetX:ne,offsetY:Ce},{offsetX:se,offsetY:Ce},{offsetX:Jt,offsetY:Ce},{offsetX:Jt,offsetY:Oe}];let Le=[];for(const{offsetX:Ar,offsetY:Ke}of ze)Le.push(new o.P(kt+J*Ar+gt*Ke,qt+At*Ar+Lt*Ke));let fr=!1;if(B){const Ar=Le.map(Ke=>this.projectAndGetPerspectiveRatio(Ke.x,Ke.y,y,Q,Z));fr=Ar.some(Ke=>!Ke.isOccluded),Le=Ar.map(Ke=>new o.P(Ke.x,Ke.y))}else fr=!0;return{box:o.ar(Le),allPointsOccluded:!fr}}}class xn{constructor(l,u,g,y){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?u:-u))):y&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class vs{constructor(l,u,g,y,B){this.text=new xn(l?l.text:null,u,g,B),this.icon=new xn(l?l.icon:null,u,y,B)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kt{constructor(l,u,g){this.text=l,this.icon=u,this.skipFade=g}}class Er{constructor(l,u,g,y,B){this.bucketInstanceId=l,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=y,this.tileID=B}}class cr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const u=++this.maxGroupID;this.collisionGroups[l]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[l]}}function dn(w,l,u,g,y){const{horizontalAlign:B,verticalAlign:S}=o.ay(w);return new o.P(-(B-.5)*l+g[0]*y,-(S-.5)*u+g[1]*y)}class qn{constructor(l,u,g,y,B){this.transform=l.clone(),this.terrain=u,this.collisionIndex=new Hn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new cr(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=B,B&&(B.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const u=this.terrain;return u?(g,y)=>u.getElevation(l,g,y):null}getBucketParts(l,u,g,y){const B=g.getBucket(u),S=g.latestFeatureIndex;if(!B||!S||u.id!==B.layerIds[0])return;const L=g.collisionBoxArray,O=B.layers[0].layout,Q=B.layers[0].paint,q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),Z=g.tileSize/o.X,J=g.tileID.toUnwrapped(),At=O.get("text-rotation-alignment")==="map",gt=o.at(g,1,this.transform.zoom),Lt=o.au(this.collisionIndex.transform,g,Q.get("text-translate"),Q.get("text-translate-anchor")),Ft=o.au(this.collisionIndex.transform,g,Q.get("icon-translate"),Q.get("icon-translate-anchor")),Ot=ge(At,this.transform,gt);this.retainedQueryData[B.bucketInstanceId]=new Er(B.bucketInstanceId,S,B.sourceLayerIndex,B.index,g.tileID);const kt={bucket:B,layout:O,translationText:Lt,translationIcon:Ft,unwrappedTileID:J,pitchedLabelPlaneMatrix:Ot,scale:q,textPixelRatio:Z,holdingForFade:g.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:o.ah(B.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(B.sourceID)};if(y)for(const qt of B.sortKeyRanges){const{sortKey:$t,symbolInstanceStart:Jt,symbolInstanceEnd:ne}=qt;l.push({sortKey:$t,symbolInstanceStart:Jt,symbolInstanceEnd:ne,parameters:kt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:B.symbolInstances.length,parameters:kt})}attemptAnchorPlacement(l,u,g,y,B,S,L,O,Q,q,Z,J,At,gt,Lt,Ft,Ot,kt,qt,$t){const Jt=o.av[l.textAnchor],ne=[l.textOffset0,l.textOffset1],se=dn(Jt,g,y,ne,B),Te=this.collisionIndex.placeCollisionBox(u,J,O,Q,q,L,S,Ft,Z.predicate,qt,se,$t);if((!kt||this.collisionIndex.placeCollisionBox(kt,J,O,Q,q,L,S,Ot,Z.predicate,qt,se,$t).placeable)&&Te.placeable){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[At.crossTileID]&&this.prevPlacement.placements[At.crossTileID]&&this.prevPlacement.placements[At.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[At.crossTileID].anchor),At.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[At.crossTileID]={textOffset:ne,width:g,height:y,anchor:Jt,textBoxScale:B,prevAnchor:Ce},this.markUsedJustification(gt,Jt,At,Lt),gt.allowVerticalPlacement&&(this.markUsedOrientation(gt,Lt,At),this.placedOrientations[At.crossTileID]=Lt),{shift:se,placedGlyphBoxes:Te}}}placeLayerBucketPart(l,u,g){const{bucket:y,layout:B,translationText:S,translationIcon:L,unwrappedTileID:O,pitchedLabelPlaneMatrix:Q,textPixelRatio:q,holdingForFade:Z,collisionBoxArray:J,partiallyEvaluatedTextSize:At,collisionGroup:gt}=l.parameters,Lt=B.get("text-optional"),Ft=B.get("icon-optional"),Ot=o.aw(B,"text-overlap","text-allow-overlap"),kt=Ot==="always",qt=o.aw(B,"icon-overlap","icon-allow-overlap"),$t=qt==="always",Jt=B.get("text-rotation-alignment")==="map",ne=B.get("text-pitch-alignment")==="map",se=B.get("icon-text-fit")!=="none",Te=B.get("symbol-z-order")==="viewport-y",Ce=kt&&($t||!y.hasIconData()||Ft),Oe=$t&&(kt||!y.hasTextData()||Lt);!y.collisionArrays&&J&&y.deserializeCollisionBoxes(J);const ze=this.retainedQueryData[y.bucketInstanceId].tileID,Le=this._getTerrainElevationFunc(ze),fr=this.transform.getFastPathSimpleProjectionMatrix(ze),Ar=(Ke,br,sn)=>{var Mn,vi;if(u[Ke.crossTileID])return;if(Z)return void(this.placements[Ke.crossTileID]=new Kt(!1,!1,!1));let oi=!1,bi=!1,zn=!0,Jn=null,ti={box:null,placeable:!1,offscreen:null,occluded:!1},qs={box:null,placeable:!1,offscreen:null},ts=null,as=null,hs=null,Va=0,ta=0,es=0;br.textFeatureIndex?Va=br.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(Va=Ke.featureIndex),br.verticalTextFeatureIndex&&(ta=br.verticalTextFeatureIndex);const so=br.textBox;if(so){const yo=fi=>{let Ni=o.ai.horizontal;if(y.allowVerticalPlacement&&!fi&&this.prevPlacement){const Ga=this.prevPlacement.placedOrientations[Ke.crossTileID];Ga&&(this.placedOrientations[Ke.crossTileID]=Ga,Ni=Ga,this.markUsedOrientation(y,Ni,Ke))}return Ni},Ba=(fi,Ni)=>{if(y.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&br.verticalTextBox){for(const Ga of y.writingModes)if(Ga===o.ai.vertical?(ti=Ni(),qs=ti):ti=fi(),ti&&ti.placeable)break}else ti=fi()},ko=Ke.textAnchorOffsetStartIndex,_o=Ke.textAnchorOffsetEndIndex;if(_o===ko){const fi=(Ni,Ga)=>{const Ki=this.collisionIndex.placeCollisionBox(Ni,Ot,q,ze,O,ne,Jt,S,gt.predicate,Le,void 0,fr);return Ki&&Ki.placeable&&(this.markUsedOrientation(y,Ga,Ke),this.placedOrientations[Ke.crossTileID]=Ga),Ki};Ba(()=>fi(so,o.ai.horizontal),()=>{const Ni=br.verticalTextBox;return y.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&Ni?fi(Ni,o.ai.vertical):{box:null,offscreen:null}}),yo(ti&&ti.placeable)}else{let fi=o.av[(vi=(Mn=this.prevPlacement)===null||Mn===void 0?void 0:Mn.variableOffsets[Ke.crossTileID])===null||vi===void 0?void 0:vi.anchor];const Ni=(Ki,KE,c_)=>{const Bm=Ki.x2-Ki.x1,u_=Ki.y2-Ki.y1,Jh=Ke.textBoxScale,tA=se&&qt==="never"?KE:null;let lh=null,h_=Ot==="never"?1:2,yp="never";fi&&h_++;for(let Cm=0;Cm<h_;Cm++){for(let Em=ko;Em<_o;Em++){const Tm=y.textAnchorOffsets.get(Em);if(fi&&Tm.textAnchor!==fi)continue;const Sm=this.attemptAnchorPlacement(Tm,Ki,Bm,u_,Jh,Jt,ne,q,ze,O,gt,yp,Ke,y,c_,S,L,tA,Le);if(Sm&&(lh=Sm.placedGlyphBoxes,lh&&lh.placeable))return oi=!0,Jn=Sm.shift,lh}fi?fi=null:yp=Ot}return g&&!lh&&(lh={box:this.collisionIndex.placeCollisionBox(so,"always",q,ze,O,ne,Jt,S,gt.predicate,Le,void 0,fr).box,offscreen:!1,placeable:!1,occluded:!1}),lh};Ba(()=>Ni(so,br.iconBox,o.ai.horizontal),()=>{const Ki=br.verticalTextBox;return y.allowVerticalPlacement&&(!ti||!ti.placeable)&&Ke.numVerticalGlyphVertices>0&&Ki?Ni(Ki,br.verticalIconBox,o.ai.vertical):{box:null,occluded:!0,offscreen:null}}),ti&&(oi=ti.placeable,zn=ti.offscreen);const Ga=yo(ti&&ti.placeable);if(!oi&&this.prevPlacement){const Ki=this.prevPlacement.variableOffsets[Ke.crossTileID];Ki&&(this.variableOffsets[Ke.crossTileID]=Ki,this.markUsedJustification(y,Ki.anchor,Ke,Ga))}}}if(ts=ti,oi=ts&&ts.placeable,zn=ts&&ts.offscreen,Ke.useRuntimeCollisionCircles){const yo=y.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),Ba=o.aj(y.textSizeData,At,yo),ko=B.get("text-padding");as=this.collisionIndex.placeCollisionCircles(Ot,yo,y.lineVertexArray,y.glyphOffsetArray,Ba,O,Q,g,ne,gt.predicate,Ke.collisionCircleDiameter,ko,S,Le),as.circles.length&&as.collisionDetected&&!g&&o.w("Collisions detected, but collision boxes are not shown"),oi=kt||as.circles.length>0&&!as.collisionDetected,zn=zn&&as.offscreen}if(br.iconFeatureIndex&&(es=br.iconFeatureIndex),br.iconBox){const yo=Ba=>this.collisionIndex.placeCollisionBox(Ba,qt,q,ze,O,ne,Jt,L,gt.predicate,Le,se&&Jn?Jn:void 0,fr);qs&&qs.placeable&&br.verticalIconBox?(hs=yo(br.verticalIconBox),bi=hs.placeable):(hs=yo(br.iconBox),bi=hs.placeable),zn=zn&&hs.offscreen}const xa=Lt||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,_c=Ft||Ke.numIconVertices===0;xa||_c?_c?xa||(bi=bi&&oi):oi=bi&&oi:bi=oi=bi&&oi;const vc=bi&&hs.placeable;if(oi&&ts.placeable&&this.collisionIndex.insertCollisionBox(ts.box,Ot,B.get("text-ignore-placement"),y.bucketInstanceId,qs&&qs.placeable&&ta?ta:Va,gt.ID),vc&&this.collisionIndex.insertCollisionBox(hs.box,qt,B.get("icon-ignore-placement"),y.bucketInstanceId,es,gt.ID),as&&oi&&this.collisionIndex.insertCollisionCircles(as.circles,Ot,B.get("text-ignore-placement"),y.bucketInstanceId,Va,gt.ID),g&&this.storeCollisionData(y.bucketInstanceId,sn,br,ts,hs,as),Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new Kt((oi||Ce)&&!(ts!=null&&ts.occluded),(bi||Oe)&&!(hs!=null&&hs.occluded),zn||y.justReloaded),u[Ke.crossTileID]=!0};if(Te){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let br=Ke.length-1;br>=0;--br){const sn=Ke[br];Ar(y.symbolInstances.get(sn),y.collisionArrays[sn],sn)}}else for(let Ke=l.symbolInstanceStart;Ke<l.symbolInstanceEnd;Ke++)Ar(y.symbolInstances.get(Ke),y.collisionArrays[Ke],Ke);y.justReloaded=!1}storeCollisionData(l,u,g,y,B,S){if(g.textBox||g.iconBox){let L,O;this.collisionBoxArrays.has(l)?L=this.collisionBoxArrays.get(l):(L=new Map,this.collisionBoxArrays.set(l,L)),L.has(u)?O=L.get(u):(O={text:null,icon:null},L.set(u,O)),g.textBox&&(O.text=y.box),g.iconBox&&(O.icon=B.box)}if(S){let L=this.collisionCircleArrays[l];L===void 0&&(L=this.collisionCircleArrays[l]=[]);for(let O=0;O<S.circles.length;O+=4)L.push(S.circles[O+0]-gn),L.push(S.circles[O+1]-gn),L.push(S.circles[O+2]),L.push(S.collisionDetected?1:0)}}markUsedJustification(l,u,g,y){let B;B=y===o.ai.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[o.ax(u)];const S=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const L of S)L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=B>=0&&L!==B?0:g.crossTileID)}markUsedOrientation(l,u,g){const y=u===o.ai.horizontal||u===o.ai.horizontalOnly?u:0,B=u===o.ai.vertical?u:0,S=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const L of S)l.text.placedSymbolArray.get(L).placedOrientation=y;g.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=B)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(l):1,B=u?u.opacities:{},S=u?u.variableOffsets:{},L=u?u.placedOrientations:{};for(const O in this.placements){const Q=this.placements[O],q=B[O];q?(this.opacities[O]=new vs(q,y,Q.text,Q.icon),g=g||Q.text!==q.text.placed||Q.icon!==q.icon.placed):(this.opacities[O]=new vs(null,y,Q.text,Q.icon,Q.skipFade),g=g||Q.text||Q.icon)}for(const O in B){const Q=B[O];if(!this.opacities[O]){const q=new vs(Q,y,!1,!1);q.isHidden()||(this.opacities[O]=q,g=g||Q.text.placed||Q.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in L)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=L[O]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:l)}updateLayerOpacities(l,u){const g={};for(const y of u){const B=y.getBucket(l);B&&y.latestFeatureIndex&&l.id===B.layerIds[0]&&this.updateBucketOpacities(B,y.tileID,g,y.collisionBoxArray)}}updateBucketOpacities(l,u,g,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const B=l.layers[0],S=B.layout,L=new vs(null,0,!1,!1,!0),O=S.get("text-allow-overlap"),Q=S.get("icon-allow-overlap"),q=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=S.get("text-rotation-alignment")==="map",J=S.get("text-pitch-alignment")==="map",At=S.get("icon-text-fit")!=="none",gt=new vs(null,0,O&&(Q||!l.hasIconData()||S.get("icon-optional")),Q&&(O||!l.hasTextData()||S.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const Lt=(Ot,kt,qt)=>{for(let $t=0;$t<kt/4;$t++)Ot.opacityVertexArray.emplaceBack(qt);Ot.hasVisibleVertices=Ot.hasVisibleVertices||qt!==Mo},Ft=this.collisionBoxArrays.get(l.bucketInstanceId);for(let Ot=0;Ot<l.symbolInstances.length;Ot++){const kt=l.symbolInstances.get(Ot),{numHorizontalGlyphVertices:qt,numVerticalGlyphVertices:$t,crossTileID:Jt}=kt;let ne=this.opacities[Jt];g[Jt]?ne=L:ne||(ne=gt,this.opacities[Jt]=ne),g[Jt]=!0;const se=kt.numIconVertices>0,Te=this.placedOrientations[kt.crossTileID],Ce=Te===o.ai.vertical,Oe=Te===o.ai.horizontal||Te===o.ai.horizontalOnly;if(qt>0||$t>0){const Le=Oa(ne.text);Lt(l.text,qt,Ce?Mo:Le),Lt(l.text,$t,Oe?Mo:Le);const fr=ne.text.isHidden();[kt.rightJustifiedTextSymbolIndex,kt.centerJustifiedTextSymbolIndex,kt.leftJustifiedTextSymbolIndex].forEach(br=>{br>=0&&(l.text.placedSymbolArray.get(br).hidden=fr||Ce?1:0)}),kt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(kt.verticalPlacedTextSymbolIndex).hidden=fr||Oe?1:0);const Ar=this.variableOffsets[kt.crossTileID];Ar&&this.markUsedJustification(l,Ar.anchor,kt,Te);const Ke=this.placedOrientations[kt.crossTileID];Ke&&(this.markUsedJustification(l,"left",kt,Ke),this.markUsedOrientation(l,Ke,kt))}if(se){const Le=Oa(ne.icon),fr=!(At&&kt.verticalPlacedIconSymbolIndex&&Ce);kt.placedIconSymbolIndex>=0&&(Lt(l.icon,kt.numIconVertices,fr?Le:Mo),l.icon.placedSymbolArray.get(kt.placedIconSymbolIndex).hidden=ne.icon.isHidden()),kt.verticalPlacedIconSymbolIndex>=0&&(Lt(l.icon,kt.numVerticalIconVertices,fr?Mo:Le),l.icon.placedSymbolArray.get(kt.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}const ze=Ft&&Ft.has(Ot)?Ft.get(Ot):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Le=l.collisionArrays[Ot];if(Le){let fr=new o.P(0,0);if(Le.textBox||Le.verticalTextBox){let Ar=!0;if(q){const Ke=this.variableOffsets[Jt];Ke?(fr=dn(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),Z&&fr._rotate(J?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ar=!1}if(Le.textBox||Le.verticalTextBox){let Ke;Le.textBox&&(Ke=Ce),Le.verticalTextBox&&(Ke=Oe),Gn(l.textCollisionBox.collisionVertexArray,ne.text.placed,!Ar||Ke,ze.text,fr.x,fr.y)}}if(Le.iconBox||Le.verticalIconBox){const Ar=!!(!Oe&&Le.verticalIconBox);let Ke;Le.iconBox&&(Ke=Ar),Le.verticalIconBox&&(Ke=!Ar),Gn(l.iconCollisionBox.collisionVertexArray,ne.icon.placed,Ke,ze.icon,At?fr.x:0,At?fr.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>l}setStale(){this.stale=!0}}function Gn(w,l,u,g,y,B){g&&g.length!==0||(g=[0,0,0,0]);const S=g[0]-gn,L=g[1]-gn,O=g[2]-gn,Q=g[3]-gn;w.emplaceBack(l?1:0,u?1:0,y||0,B||0,S,L),w.emplaceBack(l?1:0,u?1:0,y||0,B||0,O,L),w.emplaceBack(l?1:0,u?1:0,y||0,B||0,O,Q),w.emplaceBack(l?1:0,u?1:0,y||0,B||0,S,Q)}const Qn=Math.pow(2,25),di=Math.pow(2,24),xi=Math.pow(2,17),mi=Math.pow(2,16),Ds=Math.pow(2,9),Po=Math.pow(2,8),$c=Math.pow(2,1);function Oa(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,u=Math.floor(127*w.opacity);return u*Qn+l*di+u*xi+l*mi+u*Ds+l*Po+u*$c+l}const Mo=0;class Nn{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,u,g,y,B){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(u.getBucketParts(S,y,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,B())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((L,O)=>L.sortKey-O.sortKey));this._currentPartIndex<S.length;)if(u.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,B())return!0;return!1}}class nl{constructor(l,u,g,y,B,S,L,O){this.placement=new qn(l,u,S,L,O),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=B,this._done=!1}isDone(){return this._done}continuePlacement(l,u,g){const y=C.now(),B=()=>!this._forceFullPlacement&&C.now()-y>2;for(;this._currentPlacementIndex>=0;){const S=u[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=L)&&(!S.maxzoom||S.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Nn(S)),this._inProgressLayer.continuePlacement(g[S.source],this.placement,this._showCollisionBoxes,S,B))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Fo=512/o.X/2;class il{constructor(l,u,g){this.tileID=l,this.bucketInstanceId=g,this._symbolsByKey={};const y=new Map;for(let B=0;B<u.length;B++){const S=u.get(B),L=S.key,O=y.get(L);O?O.push(S):y.set(L,[S])}for(const[B,S]of y){const L={positions:S.map(O=>({x:Math.floor(O.anchorX*Fo),y:Math.floor(O.anchorY*Fo)})),crossTileIDs:S.map(O=>O.crossTileID)};if(L.positions.length>128){const O=new o.az(L.positions.length,16,Uint16Array);for(const{x:Q,y:q}of L.positions)O.add(Q,q);O.finish(),delete L.positions,L.index=O}this._symbolsByKey[B]=L}}getScaledCoordinates(l,u){const{x:g,y,z:B}=this.tileID.canonical,{x:S,y:L,z:O}=u.canonical,Q=Fo/Math.pow(2,O-B),q=(L*o.X+l.anchorY)*Q,Z=y*o.X*Fo;return{x:Math.floor((S*o.X+l.anchorX)*Q-g*o.X*Fo),y:Math.floor(q-Z)}}findMatches(l,u,g){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let B=0;B<l.length;B++){const S=l.get(B);if(S.crossTileID)continue;const L=this._symbolsByKey[S.key];if(!L)continue;const O=this.getScaledCoordinates(S,u);if(L.index){const Q=L.index.range(O.x-y,O.y-y,O.x+y,O.y+y).sort();for(const q of Q){const Z=L.crossTileIDs[q];if(!g[Z]){g[Z]=!0,S.crossTileID=Z;break}}}else if(L.positions)for(let Q=0;Q<L.positions.length;Q++){const q=L.positions[Q],Z=L.crossTileIDs[Q];if(Math.abs(q.x-O.x)<=y&&Math.abs(q.y-O.y)<=y&&!g[Z]){g[Z]=!0,S.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:u}=l;return u})}}class fa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const u=Math.round((l-this.lng)/360);if(u!==0)for(const g in this.indexes){const y=this.indexes[g],B={};for(const S in y){const L=y[S];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+u),B[L.tileID.key]=L}this.indexes[g]=B}this.lng=l}addBucket(l,u,g){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let B=0;B<u.symbolInstances.length;B++)u.symbolInstances.get(B).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const y=this.usedCrossTileIDs[l.overscaledZ];for(const B in this.indexes){const S=this.indexes[B];if(Number(B)>l.overscaledZ)for(const L in S){const O=S[L];O.tileID.isChildOf(l)&&O.findMatches(u.symbolInstances,l,y)}else{const L=S[l.scaledTo(Number(B)).key];L&&L.findMatches(u.symbolInstances,l,y)}}for(let B=0;B<u.symbolInstances.length;B++){const S=u.symbolInstances.get(B);S.crossTileID||(S.crossTileID=g.generate(),y[S.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new il(l,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(l,u){for(const g of u.getCrossTileIDsLists())for(const y of g)delete this.usedCrossTileIDs[l][y]}removeStaleBuckets(l){let u=!1;for(const g in this.indexes){const y=this.indexes[g];for(const B in y)l[y[B].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,y[B]),delete y[B],u=!0)}return u}}class Vi{constructor(){this.layerIndexes={},this.crossTileIDs=new fa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,u,g){let y=this.layerIndexes[l.id];y===void 0&&(y=this.layerIndexes[l.id]=new sc);let B=!1;const S={};y.handleWrapJump(g);for(const L of u){const O=L.getBucket(l);O&&l.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(L.tileID,O,this.crossTileIDs)&&(B=!0),S[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(B=!0),B}pruneUnusedLayers(l){const u={};l.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}var Ns="void main() {fragColor=vec4(1.0);}";const Bi={prelude:on(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:on("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:on("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:on(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:on(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:on(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:on(Ns,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:on(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:on("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:on("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:on(Ns,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:on(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:on(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:on(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:on(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:on(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:on(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:on(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:on(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:on(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:on(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:on(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:on(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:on(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:on("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:on("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:on("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:on("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:on(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:on("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function on(w,l){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=l.match(/in ([\w]+) ([\w]+)/g),y=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=B?B.concat(y):y,L={};return{fragmentSource:w=w.replace(u,(O,Q,q,Z,J)=>(L[J]=!0,Q==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = u_${J};
#endif
`)),vertexSource:l=l.replace(u,(O,Q,q,Z,J)=>{const At=Z==="float"?"vec2":"vec4",gt=J.match(/color/)?"color":At;return L[J]?Q==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${q} ${At} a_${J};
out ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:gt==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${gt}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:Q==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${q} ${At} a_${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:gt==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = unpack_mix_${gt}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`}),staticAttributes:g,staticUniforms:S}}class ks{constructor(l,u,g){this.vertexBuffer=l,this.indexBuffer=u,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var cn=o.aA([{name:"a_pos",type:"Int16",components:2}]);const Tl="#define PROJECTION_MERCATOR",Ku="mercator";class bt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ku}get shaderDefine(){return Tl}get shaderPreludeCode(){return Bi.projectionMercator}get vertexShaderPreludeCode(){return Bi.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,u,g,y,B){if(this._cachedMesh)return this._cachedMesh;const S=new o.aC;S.emplaceBack(0,0),S.emplaceBack(o.X,0),S.emplaceBack(0,o.X),S.emplaceBack(o.X,o.X);const L=l.createVertexBuffer(S,cn.members),O=o.aD.simpleSegment(0,0,4,2),Q=new o.aE;Q.emplaceBack(1,0,2),Q.emplaceBack(1,2,3);const q=l.createIndexBuffer(Q);return this._cachedMesh=new ks(L,q,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}function It(w,l){const u=o.ab(l.lat,-85.051129,o.aF);return new o.P(o.O(l.lng)*w,o.Q(u)*w)}function jt(w,l){return new o.Y(l.x/w,l.y/w).toLngLat()}function xe(w){return w.cameraToCenterDistance*Math.min(.85*Math.tan(o.aa(90-w.pitch)),Math.tan(o.aa(89.25-w.pitch)))}function ar(w,l){const u=w.canonical,g=l/o.aG(u.z),y=u.x+Math.pow(2,u.z)*w.wrap,B=o.aq(new Float64Array(16));return o.J(B,B,[y*g,u.y*g,0]),o.K(B,B,[g/o.X,g/o.X,1]),B}function Cr(w,l,u,g,y){const B=o.Y.fromLngLat(w,l),S=y*o.aH(1,w.lat),L=S*Math.cos(o.aa(u)),O=Math.sqrt(S*S-L*L),Q=O*Math.sin(o.aa(-g)),q=O*Math.cos(o.aa(-g));return new o.Y(B.x+Q,B.y+q,B.z+L)}class Gr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=u,this.left=g,this.right=y}interpolate(l,u,g){return u.top!=null&&l.top!=null&&(this.top=o.y.number(l.top,u.top,g)),u.bottom!=null&&l.bottom!=null&&(this.bottom=o.y.number(l.bottom,u.bottom,g)),u.left!=null&&l.left!=null&&(this.left=o.y.number(l.left,u.left,g)),u.right!=null&&l.right!=null&&(this.right=o.y.number(l.right,u.right,g)),this}getCenter(l,u){const g=o.ab((this.left+l-this.right)/2,0,l),y=o.ab((this.top+u-this.bottom)/2,0,u);return new o.P(g,y)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Gr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bn(w,l){if(!w.renderWorldCopies||w.lngRange)return;const u=l.lng-w.center.lng;l.lng+=u>180?-360:u<-180?360:0}function yi(w){return Math.max(0,Math.floor(w))}class _i{constructor(l,u,g,y,B,S){this._callbacks=l,this._tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=u||0,this._maxZoom=g||22,this._minPitch=y??0,this._maxPitch=B??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=yi(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Gr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,u,g){this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=yi(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new Gr(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!g&&l.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const u=o.aI(l,-180,180)*Math.PI/180;var g,y,B,S,L,O,Q,q,Z;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=f(),g=this._rotationMatrix,B=-this._bearingInRadians,S=(y=this._rotationMatrix)[0],L=y[1],O=y[2],Q=y[3],q=Math.sin(B),Z=Math.cos(B),g[0]=S*Z+O*q,g[1]=L*Z+Q*q,g[2]=S*-q+O*Z,g[3]=L*-q+Q*Z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const u=o.ab(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const u=l/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aJ(this._fovInRadians)}setFov(l){l=o.ab(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=o.aa(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const u=this.getConstrained(this._center,l).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=o.aG(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,u){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,u,g){this._unmodified=!1,this._edgeInsets.interpolate(l,u,g),this._constrain(),this._calcMatrices()}resize(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._width=l,this._height=u,g&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new mr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.aF])}getConstrained(l,u){return this._callbacks.getConstrained(l,u)}getCameraQueryGeometry(l,u){if(u.length===1)return[u[0],l];{let g=l.x,y=l.y,B=l.x,S=l.y;for(const L of u)g=Math.min(g,L.x),y=Math.min(y,L.y),B=Math.max(B,L.x),S=Math.max(S,L.y);return[new o.P(g,y),new o.P(B,y),new o.P(B,S),new o.P(g,S),new o.P(g,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:u,zoom:g}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(g),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=o.aq(new Float64Array(16));o.K(l,l,[this._width/2,-this._height/2,1]),o.J(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=o.aq(new Float64Array(16)),o.K(l,l,[1,-1,1]),o.J(l,l,[-1,-1,0]),o.K(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,u,g,y){const B=g!==void 0?g:this.bearing,S=y=y!==void 0?y:this.pitch,L=o.Y.fromLngLat(l,u),O=-Math.cos(o.aa(S)),Q=Math.sin(o.aa(S)),q=Q*Math.sin(o.aa(B)),Z=-Q*Math.cos(o.aa(B));let J=this.elevation;const At=u-J;let gt;O*At>=0||Math.abs(O)<.1?(gt=1e4,J=u+gt*O):gt=-At/O;let Lt,Ft,Ot=o.aK(1,L.y),kt=0;do{if(kt+=1,kt>10)break;Ft=gt/Ot,Lt=new o.Y(L.x+q*Ft,L.y+Z*Ft),Ot=1/Lt.meterInMercatorCoordinateUnits()}while(Math.abs(gt-Ft*Ot)>1e-12);return{center:Lt.toLngLat(),elevation:J,zoom:o.a8(this.height/2/Math.tan(this.fovInRadians/2)/Ft/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const u=o.aH(1,this.center.lat)*this.worldSize,g=this.cameraToCenterDistance/u,y=o.Y.fromLngLat(this.center,this.elevation),B=Cr(this.center,this.elevation,this.pitch,this.bearing,g);this._elevation=l;const S=this.calculateCenterFromCameraLngLatAlt(B.toLngLat(),o.aK(B.z,y.y),this.bearing,this.pitch);this._elevation=S.elevation,this._center=S.center,this.setZoom(S.zoom)}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=o.aH(1,this.center.lat)*this.worldSize;return Cr(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const u=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/u,l.canonical.y/u,1/u/o.X,1/u/o.X]}}class nn{constructor(l,u){this.min=l,this.max=u,this.center=o.aL([],o.aM([],this.min,this.max),.5)}quadrant(l){const u=[l%2==0,l<2],g=o.aN(this.min),y=o.aN(this.max);for(let B=0;B<u.length;B++)g[B]=u[B]?this.min[B]:this.center[B],y[B]=u[B]?this.center[B]:this.max[B];return y[2]=this.max[2],new nn(g,y)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let u=!0;for(let g=0;g<l.planes.length;g++){const y=this.intersectsPlane(l.planes[g]);if(y===0)return 0;y===1&&(u=!1)}return u?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let u=l[3],g=l[3];for(let y=0;y<3;y++)l[y]>0?(u+=l[y]*this.min[y],g+=l[y]*this.max[y]):(g+=l[y]*this.min[y],u+=l[y]*this.max[y]);return u>=0?2:g<0?0:1}}class Xc{distanceToTile2d(l,u,g,y){const B=y.distanceX([l,u]),S=y.distanceY([l,u]);return Math.hypot(B,S)}getWrap(l,u,g){return g}getTileAABB(l,u,g,y){var B,S;let L=g,O=g;if(y.terrain){const q=new o.S(l.z,u,l.z,l.x,l.y),Z=y.terrain.getMinMaxElevation(q);L=(B=Z.minElevation)!==null&&B!==void 0?B:g,O=(S=Z.maxElevation)!==null&&S!==void 0?S:g}const Q=1<<l.z;return new nn([u+l.x/Q,l.y/Q,L],[u+(l.x+1)/Q,(l.y+1)/Q,O])}allowVariableZoom(l,u){const g=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,y=o.ab(78.5-g/2,0,60);return!!u.terrain||l.pitch>y||l.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Ko{constructor(l,u,g){this.points=l,this.planes=u,this.aabb=g}static fromInvProjectionMatrix(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const y=Math.pow(2,g),B=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Q=>{const q=1/(Q=o.al([],Q,l))[3]/u*y;return o.aO(Q,Q,[q,q,1/Q[3],q])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Q=>{const q=o.aP([],B[Q[0]],B[Q[1]]),Z=o.aP([],B[Q[2]],B[Q[1]]),J=o.aQ([],o.aR([],q,Z)),At=-o.aS(J,B[Q[1]]);return J.concat(At)}),L=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],O=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Q of B)for(let q=0;q<3;q++)L[q]=Math.min(L[q],Q[q]),O[q]=Math.max(O[q],Q[q]);return new Ko(B,S,new nn(L,O))}}class en{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,u,g){return this._helper.interpolatePadding(l,u,g)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,u,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,u){this._helper.overrideNearFarZ(l,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,u){}constructor(l,u,g,y,B){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new _i({calcMatrices:()=>{this._calcMatrices()},getConstrained:(S,L)=>this.getConstrained(S,L)},l,u,g,y,B),this._coveringTilesDetailsProvider=new Xc}clone(){const l=new en;return l.apply(this),l}apply(l,u,g){this._helper.apply(l,u,g)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const u=[new o.aT(0,l)];if(this._helper._renderWorldCopies){const g=this.screenPointToMercatorCoordinate(new o.P(0,0)),y=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),B=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),S=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),L=Math.floor(Math.min(g.x,y.x,B.x,S.x)),O=Math.floor(Math.max(g.x,y.x,B.x,S.x)),Q=1;for(let q=L-Q;q<=O+Q;q++)q!==0&&u.push(new o.aT(q,l))}return u}getCameraFrustum(){return Ko.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const u=this.screenPointToLocation(this.centerPoint,l),g=l?l.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(g)}setLocationAtPoint(l,u){const g=o.aH(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(u,g),B=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,g),S=o.Y.fromLngLat(l),L=new o.Y(S.x-(y.x-B.x),S.y-(y.y-B.y));this.setCenter(L==null?void 0:L.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,u){return u?this.coordinatePoint(o.Y.fromLngLat(l),u.getElevationForLngLatZoom(l,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.Y.fromLngLat(l))}screenPointToLocation(l,u){var g;return(g=this.screenPointToMercatorCoordinate(l,u))===null||g===void 0?void 0:g.toLngLat()}screenPointToMercatorCoordinate(l,u){if(u){const g=u.pointCoordinate(l);if(g!=null)return g}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,u){const g=u||0,y=[l.x,l.y,0,1],B=[l.x,l.y,1,1];o.al(y,y,this._pixelMatrixInverse),o.al(B,B,this._pixelMatrixInverse);const S=y[3],L=B[3],O=y[1]/S,Q=B[1]/L,q=y[2]/S,Z=B[2]/L,J=q===Z?0:(g-q)/(Z-q);return new o.Y(o.y.number(y[0]/S,B[0]/L,J)/this.worldSize,o.y.number(O,Q,J)/this.worldSize,g)}coordinatePoint(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this._pixelMatrix;const y=[l.x*this.worldSize,l.y*this.worldSize,u,1];return o.al(y,y,g),new o.P(y[0]/y[3],y[1]/y[3])}getBounds(){const l=Math.max(0,this._helper._height/2-xe(this));return new mr().extend(this.screenPointToLocation(new o.P(0,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(l,u){return u?u.pointCoordinate(l)!=null:l.y>this.height/2-xe(this)}calculatePosMatrix(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,g=arguments.length>2?arguments[2]:void 0;var y;const B=(y=l.key)!==null&&y!==void 0?y:o.aU(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),S=u?this._alignedPosMatrixCache:this._posMatrixCache;if(S.has(B)){const Q=S.get(B);return g?Q.f32:Q.f64}const L=ar(l,this.worldSize);o.L(L,u?this._alignedProjMatrix:this._viewProjMatrix,L);const O={f64:L,f32:new Float32Array(L)};return S.set(B,O),g?O.f32:O.f64}calculateFogMatrix(l){const u=l.key,g=this._fogMatrixCacheF32;if(g.has(u))return g.get(u);const y=ar(l,this.worldSize);return o.L(y,this._fogMatrix,y),g.set(u,new Float32Array(y)),g.get(u)}getConstrained(l,u){u=o.ab(+u,this.minZoom,this.maxZoom);const g={center:new o.N(l.lng,l.lat),zoom:u};let y=this._helper._lngRange;this._helper._renderWorldCopies||y!==null||(y=[-179.9999999999,180-1e-10]);const B=this.tileSize*o.aG(g.zoom);let S=0,L=B,O=0,Q=B,q=0,Z=0;const{x:J,y:At}=this.size;if(this._helper._latRange){const qt=this._helper._latRange;S=o.Q(qt[1])*B,L=o.Q(qt[0])*B,L-S<At&&(q=At/(L-S))}y&&(O=o.aI(o.O(y[0])*B,0,B),Q=o.aI(o.O(y[1])*B,0,B),Q<O&&(Q+=B),Q-O<J&&(Z=J/(Q-O)));const{x:gt,y:Lt}=It(B,l);let Ft,Ot;const kt=Math.max(Z||0,q||0);if(kt){const qt=new o.P(Z?(Q+O)/2:gt,q?(L+S)/2:Lt);return g.center=jt(B,qt).wrap(),g.zoom+=o.a8(kt),g}if(this._helper._latRange){const qt=At/2;Lt-qt<S&&(Ot=S+qt),Lt+qt>L&&(Ot=L-qt)}if(y){const qt=(O+Q)/2;let $t=gt;this._helper._renderWorldCopies&&($t=o.aI(gt,qt-B/2,qt+B/2));const Jt=J/2;$t-Jt<O&&(Ft=O+Jt),$t+Jt>Q&&(Ft=Q-Jt)}if(Ft!==void 0||Ot!==void 0){const qt=new o.P(Ft??gt,Ot??Lt);g.center=jt(B,qt).wrap()}return g}calculateCenterFromCameraLngLatAlt(l,u,g,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,u,g,y)}_calculateNearFarZIfNeeded(l,u,g){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),B=l-y*this._helper._pixelPerMeter/Math.cos(u),S=y<0?B:l,L=Math.PI/2+this.pitchInRadians,O=o.aa(this.fov)*(Math.abs(Math.cos(o.aa(this.roll)))*this.height+Math.abs(Math.sin(o.aa(this.roll)))*this.width)/this.height*(.5+g.y/this.height),Q=Math.sin(O)*S/Math.sin(o.ab(Math.PI-L-O,.01,Math.PI-.01)),q=xe(this),Z=Math.atan(q/this._helper.cameraToCenterDistance),J=o.aa(.75),At=Z>J?2*Z*(.5+g.y/(2*q)):J,gt=Math.sin(At)*S/Math.sin(o.ab(Math.PI-L-At,.01,Math.PI-.01)),Lt=Math.min(Q,gt);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Lt+S),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,u=It(this.worldSize,this.center),g=u.x,y=u.y;this._helper._pixelPerMeter=o.aH(1,this.center.lat)*this.worldSize;const B=o.aa(Math.min(this.pitch,89.25)),S=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(B));let L;this._calculateNearFarZIfNeeded(S,B,l),L=new Float64Array(16),o.aV(L,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.an(this._invProjMatrix,L),L[8]=2*-l.x/this._helper._width,L[9]=2*l.y/this._helper._height,this._projectionMatrix=o.aW(L),o.K(L,L,[1,-1,1]),o.J(L,L,[0,0,-this._helper.cameraToCenterDistance]),o.aX(L,L,-this.rollInRadians),o.aY(L,L,this.pitchInRadians),o.aX(L,L,-this.bearingInRadians),o.J(L,L,[-g,-y,0]),this._mercatorMatrix=o.K([],L,[this.worldSize,this.worldSize,this.worldSize]),o.K(L,L,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,L),o.J(L,L,[0,0,-this.elevation]),this._viewProjMatrix=L,this._invViewProjMatrix=o.an([],L);const O=[0,0,-1,1];o.al(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),o.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,S,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,o.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.J(this._fogMatrix,this._fogMatrix,[-g,-y,0]),o.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,L);const Q=this._helper._width%2/2,q=this._helper._height%2/2,Z=Math.cos(this.bearingInRadians),J=Math.sin(-this.bearingInRadians),At=g-Math.round(g)+Z*Q+J*q,gt=y-Math.round(y)+Z*q+J*Q,Lt=new Float64Array(L);if(o.J(Lt,Lt,[At>.5?At-1:At,gt>.5?gt-1:gt,0]),this._alignedProjMatrix=Lt,L=o.an(new Float64Array(16),this._pixelMatrix),!L)throw new Error("failed to invert matrix");this._pixelMatrixInverse=L,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new o.P(0,0)),u=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.al(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=o.aH(1,this.center.lat)*this.worldSize;return Cr(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,u){const g=o.Y.fromLngLat(l),y=[g.x*this.worldSize,g.y*this.worldSize,u,1];return o.al(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(l){const{overscaledTileID:u,aligned:g,applyTerrainMatrix:y}=l,B=this._helper.getMercatorTileCoordinates(u),S=u?this.calculatePosMatrix(u,g,!0):null;let L;return L=u&&u.terrainRttPosMatrix32f&&y?u.terrainRttPosMatrix32f:S||o.aZ(),{mainMatrix:L,tileMercatorCoords:B,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:L}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,u,g){return 1}transformLightDirection(l){return o.aN(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,u,g,y){const B=this.calculatePosMatrix(g);let S;y?(S=[l,u,y(l,u),1],o.al(S,S,B)):(S=[l,u,0,1],Dn(S,S,B));const L=S[3];return{point:new o.P(S[0]/L,S[1]/L),signedDistanceFromCamera:L,isOccluded:!1}}populateCache(l){for(const u of l)this.calculatePosMatrix(u)}getMatrixForModel(l,u){const g=o.Y.fromLngLat(l,u),y=g.meterInMercatorCoordinateUnits(),B=o.a_();return o.J(B,B,[g.x,g.y,g.z]),o.aX(B,B,Math.PI),o.aY(B,B,Math.PI/2),o.K(B,B,[-y,y,y]),B}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const u=new o.S(0,0,0,0,0),g=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:l}),y=ar(u,this.worldSize);o.L(y,this._viewProjMatrix,y),g.tileMercatorCoords=[0,0,1,1];const B=[o.X,o.X,this.worldSize/this._helper.pixelsPerMeter],S=o.a$();return o.K(S,y,B),g.fallbackMatrix=S,g.mainMatrix=S,g}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function Lo(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Nh(w){if(w.useSlerp)if(w.k<1){const l=o.b0(w.startEulerAngles.roll,w.startEulerAngles.pitch,w.startEulerAngles.bearing),u=o.b0(w.endEulerAngles.roll,w.endEulerAngles.pitch,w.endEulerAngles.bearing),g=new Float64Array(4);o.b1(g,l,u,w.k);const y=o.b2(g);w.tr.setRoll(y.roll),w.tr.setPitch(y.pitch),w.tr.setBearing(y.bearing)}else w.tr.setRoll(w.endEulerAngles.roll),w.tr.setPitch(w.endEulerAngles.pitch),w.tr.setBearing(w.endEulerAngles.bearing);else w.tr.setRoll(o.y.number(w.startEulerAngles.roll,w.endEulerAngles.roll,w.k)),w.tr.setPitch(o.y.number(w.startEulerAngles.pitch,w.endEulerAngles.pitch,w.k)),w.tr.setBearing(o.y.number(w.startEulerAngles.bearing,w.endEulerAngles.bearing,w.k))}function bs(w,l,u,g,y){const B=y.padding,S=It(y.worldSize,u.getNorthWest()),L=It(y.worldSize,u.getNorthEast()),O=It(y.worldSize,u.getSouthEast()),Q=It(y.worldSize,u.getSouthWest()),q=o.aa(-g),Z=S.rotate(q),J=L.rotate(q),At=O.rotate(q),gt=Q.rotate(q),Lt=new o.P(Math.max(Z.x,J.x,gt.x,At.x),Math.max(Z.y,J.y,gt.y,At.y)),Ft=new o.P(Math.min(Z.x,J.x,gt.x,At.x),Math.min(Z.y,J.y,gt.y,At.y)),Ot=Lt.sub(Ft),kt=(y.width-(B.left+B.right+l.left+l.right))/Ot.x,qt=(y.height-(B.top+B.bottom+l.top+l.bottom))/Ot.y;if(qt<0||kt<0)return void Lo();const $t=Math.min(o.a8(y.scale*Math.min(kt,qt)),w.maxZoom),Jt=o.P.convert(w.offset),ne=new o.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(o.aa(g)),se=Jt.add(ne).mult(y.scale/o.aG($t));return{center:jt(y.worldSize,S.add(O).div(2).sub(se)),zoom:$t,bearing:g}}class Zc{get useGlobeControls(){return!1}handlePanInertia(l,u){return{easingOffset:l,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(l,u){l.bearingDelta&&u.setBearing(u.bearing+l.bearingDelta),l.pitchDelta&&u.setPitch(u.pitch+l.pitchDelta),l.rollDelta&&u.setRoll(u.roll+l.rollDelta),l.zoomDelta&&u.setZoom(u.zoom+l.zoomDelta)}handleMapControlsPan(l,u,g){l.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(g,l.around)}cameraForBoxAndBearing(l,u,g,y,B){return bs(l,u,g,y,B)}handleJumpToCenterZoom(l,u){l.zoom!==(u.zoom!==void 0?+u.zoom:l.zoom)&&l.setZoom(+u.zoom),u.center!==void 0&&l.setCenter(o.N.convert(u.center))}handleEaseTo(l,u){const g=l.zoom,y=l.padding,B={roll:l.roll,pitch:l.pitch,bearing:l.bearing},S={roll:u.roll===void 0?l.roll:u.roll,pitch:u.pitch===void 0?l.pitch:u.pitch,bearing:u.bearing===void 0?l.bearing:u.bearing},L=u.zoom!==void 0,O=!l.isPaddingEqual(u.padding);let Q=!1;const q=L?+u.zoom:l.zoom;let Z=l.centerPoint.add(u.offsetAsPoint);const J=l.screenPointToLocation(Z),{center:At,zoom:gt}=l.getConstrained(o.N.convert(u.center||J),q??g);Bn(l,At);const Lt=It(l.worldSize,J),Ft=It(l.worldSize,At).sub(Lt),Ot=o.aG(gt-g);return Q=gt!==g,{easeFunc:kt=>{if(Q&&l.setZoom(o.y.number(g,gt,kt)),o.b3(B,S)||Nh({startEulerAngles:B,endEulerAngles:S,tr:l,k:kt,useSlerp:B.roll!=S.roll}),O&&(l.interpolatePadding(y,u.padding,kt),Z=l.centerPoint.add(u.offsetAsPoint)),u.around)l.setLocationAtPoint(u.around,u.aroundPoint);else{const qt=o.aG(l.zoom-g),$t=gt>g?Math.min(2,Ot):Math.max(.5,Ot),Jt=Math.pow($t,1-kt),ne=jt(l.worldSize,Lt.add(Ft.mult(kt*Jt)).mult(qt));l.setLocationAtPoint(l.renderWorldCopies?ne.wrap():ne,Z)}},isZooming:Q,elevationCenter:At}}handleFlyTo(l,u){const g=u.zoom!==void 0,y=l.zoom,B=l.getConstrained(o.N.convert(u.center||u.locationAtOffset),g?+u.zoom:y),S=B.center,L=B.zoom;Bn(l,S);const O=It(l.worldSize,u.locationAtOffset),Q=It(l.worldSize,S).sub(O),q=Q.mag(),Z=o.aG(L-y);let J;if(u.minZoom!==void 0){const At=Math.min(+u.minZoom,y,L),gt=l.getConstrained(S,At).zoom;J=o.aG(gt-y)}return{easeFunc:(At,gt,Lt,Ft)=>{l.setZoom(At===1?L:y+o.a8(gt));const Ot=At===1?S:jt(l.worldSize,O.add(Q.mult(Lt)).mult(gt));l.setLocationAtPoint(l.renderWorldCopies?Ot.wrap():Ot,Ft)},scaleOfZoom:Z,targetCenter:S,scaleOfMinZoom:J,pixelPathLength:q}}}class ii{constructor(l,u,g){this.blendFunction=l,this.blendColor=u,this.mask=g}}ii.Replace=[1,0],ii.disabled=new ii(ii.Replace,o.b4.transparent,[!1,!1,!1,!1]),ii.unblended=new ii(ii.Replace,o.b4.transparent,[!0,!0,!0,!0]),ii.alphaBlended=new ii([1,771],o.b4.transparent,[!0,!0,!0,!0]);const Ua=2305;class vn{constructor(l,u,g){this.enable=l,this.mode=u,this.frontFace=g}}vn.disabled=new vn(!1,1029,Ua),vn.backCCW=new vn(!0,1029,Ua),vn.frontCCW=new vn(!0,1028,Ua);class ln{constructor(l,u,g){this.func=l,this.mask=u,this.range=g}}ln.ReadOnly=!1,ln.ReadWrite=!0,ln.disabled=new ln(519,ln.ReadOnly,[0,1]);const Yc=7680;class Sn{constructor(l,u,g,y,B,S){this.test=l,this.ref=u,this.mask=g,this.fail=y,this.depthFail=B,this.pass=S}}Sn.disabled=new Sn({func:519,mask:0},0,0,Yc,Yc,Yc);const sl=new WeakMap;function Qs(w){var l;if(sl.has(w))return sl.get(w);{const u=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return sl.set(w,u),u}}class pa{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const u=l.context,g=u.gl;this._texFormat=g.RGBA,this._texType=g.UNSIGNED_BYTE;const y=new o.aC;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const B=new o.aE;B.emplaceBack(0,1,2),this._fullscreenTriangle=new ks(u.createVertexBuffer(y,cn.members),u.createIndexBuffer(B),o.aD.simpleSegment(0,0,y.length,B.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(g.TEXTURE1);const S=g.createTexture();g.bindTexture(g.TEXTURE_2D,S),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texImage2D(g.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(S),Qs(g)&&(this._pbo=g.createBuffer(),g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.bufferData(g.PIXEL_PACK_BUFFER,4,g.STREAM_READ),g.bindBuffer(g.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,u){const g=this._updateCount;return this._readbackQueue?g>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():g>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,u=l.gl;l.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,u){const g=this._cachedRenderContext.context,y=g.gl;if(this._bindFramebuffer(),g.viewport.set([0,0,this._texWidth,this._texHeight]),g.clear({color:o.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(g,y.TRIANGLES,ln.disabled,Sn.disabled,ii.unblended,vn.disabled,((B,S)=>({u_input:B,u_output_expected:S}))(l,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Qs(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const B=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:B}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Qs(l)){const u=l.clientWaitSync(this._readbackQueue.sync,0,0);if(u===l.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=pa._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let u=0;return u+=l[0]/256,u+=l[1]/65536,u+=l[2]/16777216,l[3]<127&&(u=-u),u/128}}const Jc=o.X/128;function Da(w,l){const u=w.granularity!==void 0?Math.max(w.granularity,1):1,g=u+(w.generateBorders?2:0),y=u+(w.extendToNorthPole||w.generateBorders?1:0)+(w.extendToSouthPole||w.generateBorders?1:0),B=g+1,S=y+1,L=w.generateBorders?-1:0,O=w.generateBorders||w.extendToNorthPole?-1:0,Q=u+(w.generateBorders?1:0),q=u+(w.generateBorders||w.extendToSouthPole?1:0),Z=B*S,J=g*y*6,At=B*S>65536;if(At&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const gt=At||l==="32bit",Lt=new Int16Array(2*Z);let Ft=0;for(let qt=O;qt<=q;qt++)for(let $t=L;$t<=Q;$t++){let Jt=$t/u*o.X;$t===-1&&(Jt=-64),$t===u+1&&(Jt=o.X+Jc);let ne=qt/u*o.X;qt===-1&&(ne=w.extendToNorthPole?o.b6:-64),qt===u+1&&(ne=w.extendToSouthPole?o.b7:o.X+Jc),Lt[Ft++]=Jt,Lt[Ft++]=ne}const Ot=gt?new Uint32Array(J):new Uint16Array(J);let kt=0;for(let qt=0;qt<y;qt++)for(let $t=0;$t<g;$t++){const Jt=$t+1+qt*B,ne=$t+(qt+1)*B,se=$t+1+(qt+1)*B;Ot[kt++]=$t+qt*B,Ot[kt++]=ne,Ot[kt++]=Jt,Ot[kt++]=Jt,Ot[kt++]=ne,Ot[kt++]=se}return{vertices:Lt.buffer.slice(0),indices:Ot.buffer.slice(0),uses32bitIndices:gt}}const Na=new o.aB({fill:new o.b8(128,2),line:new o.b8(512,0),tile:new o.b8(128,32),stencil:new o.b8(128,1),circle:3});class tu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Bi.projectionGlobe}get vertexShaderPreludeCode(){return Bi.projectionMercator.vertexSource}get subdivisionGranularity(){return Na}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new pa(l));const u=o.Q(this._errorQueryLatitudeDegrees),g=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(u,g),B=C.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=B);const S=Math.min(Math.max((B-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.ba(S))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,u,g,y,B){const S=(B==="stencil"?Na.stencil:Na.tile).getGranularityForZoomLevel(u.z);return this._getMesh(l,{granularity:S,generateBorders:g,extendToNorthPole:u.y===0&&y,extendToSouthPole:u.y===(1<<u.z)-1&&y})}_getMesh(l,u){const g=this._getMeshKey(u);if(g in this._tileMeshCache)return this._tileMeshCache[g];const y=function(B,S){const L=Da(S,"16bit"),O=o.aC.deserialize({arrayBuffer:L.vertices,length:L.vertices.byteLength/2/2}),Q=o.aE.deserialize({arrayBuffer:L.indices,length:L.indices.byteLength/2/3});return new ks(B.createVertexBuffer(O,cn.members),B.createIndexBuffer(Q),o.aD.simpleSegment(0,0,O.length,Q.length))}(l,u);return this._tileMeshCache[g]=y,y}recalculate(l){}hasTransition(){const l=C.now();let u=!1;return u=u||(l-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const Wu=new o.q({type:new o.D(o.v.projection.type)});class $u extends o.E{constructor(l){super(),this._transitionable=new o.T(Wu),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0)),this._mercatorProjection=new bt,this._verticalPerspectiveProjection=new tu}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof o.bb){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,u,g,y,B){return this.currentProjection.getMeshFromTileID(l,u,g,y,B)}setProjection(l){this._transitionable.setValue("type",(l==null?void 0:l.type)||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function kh(w){const l=Ro(w.worldSize,w.center.lat);return 2*Math.PI*l}function oc(w,l,u,g,y){const B=1/(1<<y),S=l/o.X*B+g*B,L=o.bd((w/o.X*B+u*B)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI,Q=Math.cos(O),q=new Float64Array(3);return q[0]=Math.sin(L)*Q,q[1]=Math.sin(O),q[2]=Math.cos(L)*Q,q}function Pn(w){return function(l,u){const g=Math.cos(u),y=new Float64Array(3);return y[0]=Math.sin(l)*g,y[1]=Math.sin(u),y[2]=Math.cos(l)*g,y}(w.lng*Math.PI/180,w.lat*Math.PI/180)}function Ro(w,l){return w/(2*Math.PI)/Math.cos(l*Math.PI/180)}function Wo(w){const l=Math.asin(w[1])/Math.PI*180,u=Math.sqrt(w[0]*w[0]+w[2]*w[2]);if(u>1e-6){const g=w[0]/u,y=Math.acos(w[2]/u),B=(g>0?y:-y)/Math.PI*180;return new o.N(o.aI(B,-180,180),l)}return new o.N(0,l)}function Oo(w){return Math.cos(w*Math.PI/180)}function si(w,l){const u=Oo(w),g=Oo(l);return o.a8(g/u)}function eu(w,l){const u=w.rotate(l.bearingInRadians),g=l.zoom+si(l.center.lat,0),y=o.b9(1/Oo(l.center.lat),1/Oo(Math.min(Math.abs(l.center.lat),60)),o.bc(g,7,3,0,1)),B=360/kh({worldSize:l.worldSize,center:{lat:l.center.lat}});return new o.N(l.center.lng-u.x*B*y,o.ab(l.center.lat+u.y*B,-85.051129,o.aF))}function Uo(w){const l=.5*w,u=Math.sin(l),g=Math.cos(l);return Math.log(u+g)-Math.log(g-u)}function NA(w,l,u,g){const y=w.lat+u*g;if(Math.abs(u)>1){const B=(Math.sign(w.lat+u)!==Math.sign(w.lat)?-Math.abs(w.lat):Math.abs(w.lat))*Math.PI/180,S=Math.abs(w.lat+u)*Math.PI/180,L=Uo(B+g*(S-B)),O=Uo(B),Q=Uo(S);return new o.N(w.lng+l*((L-O)/(Q-O)),y)}return new o.N(w.lng+l*g,y)}class Xu{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=l}recalculateCache(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(l,u,g,y){const B=`${l.z}_${l.x}_${l.y}`,S=this._cache.get(B);if(S)return S;const L=this._cachePrevious.get(B);if(L)return this._cache.set(B,L),L;const O=this._aabbFactory(l,u,g,y);return this._cache.set(B,O),this._hadAnyChanges=!0,O}}function Zu(w,l,u){const g=w-l;return g<0?-g:Math.max(0,g-u)}function ru(w,l,u,g,y){const B=w-u;let S;return S=B<0?Math.min(-B,1+B-y):B>1?Math.min(Math.max(B-y,0),1-B):0,Math.max(S,Zu(l,g,y))}class Qh{constructor(){this._aabbCache=new Xu(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(l,u,g,y){const B=1<<g.z,S=1/B,L=g.x/B,O=g.y/B;let Q=2;return Q=Math.min(Q,ru(l,u,L,O,S)),Q=Math.min(Q,ru(l,u,L+.5,-O-S,S)),Q=Math.min(Q,ru(l,u,L+.5,2-O-S,S)),Q}getWrap(l,u,g){const y=1<<u.z,B=1/y,S=u.x/y,L=Zu(l.x,S,B),O=Zu(l.x,S-1,B),Q=Zu(l.x,S+1,B),q=Math.min(L,O,Q);return q===Q?1:q===O?-1:0}allowVariableZoom(l,u){return Xn(l,u)>4}allowWorldCopies(){return!1}getTileAABB(l,u,g,y){return this._aabbCache.getTileAABB(l,u,g,y)}_computeTileAABB(l,u,g,y){if(l.z<=0)return new nn([-1,-1,-1],[1,1,1]);if(l.z===1)return new nn([l.x===0?-1:0,l.y===0?0:-1,-1],[l.x===0?0:1,l.y===0?1:0,1]);{const B=[oc(0,0,l.x,l.y,l.z),oc(o.X,0,l.x,l.y,l.z),oc(o.X,o.X,l.x,l.y,l.z),oc(0,o.X,l.x,l.y,l.z)],S=[1,1,1],L=[-1,-1,-1];for(const O of B)for(let Q=0;Q<3;Q++)S[Q]=Math.min(S[Q],O[Q]),L[Q]=Math.max(L[Q],O[Q]);if(l.y===0||l.y===(1<<l.z)-1){const O=[0,l.y===0?1:-1,0];for(let Q=0;Q<3;Q++)S[Q]=Math.min(S[Q],O[Q]),L[Q]=Math.max(L[Q],O[Q])}return new nn(S,L)}}}class nu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,u,g){return this._helper.interpolatePadding(l,u,g)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,u){this._helper.resize(l,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,u){this._helper.overrideNearFarZ(l,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(){this._cachedClippingPlane=o.be(),this._projectionMatrix=o.a_(),this._globeViewProjMatrix32f=o.aZ(),this._globeViewProjMatrixNoCorrection=o.a_(),this._globeViewProjMatrixNoCorrectionInverted=o.a_(),this._globeProjMatrixInverted=o.a_(),this._cameraPosition=o.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new _i({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,u)=>this.getConstrained(l,u)}),this._coveringTilesDetailsProvider=new Qh}clone(){const l=new nu;return l.apply(this),l}apply(l,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=o.bf();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:u,applyGlobeMatrix:g}=l,y=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:g?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const u=this.pitchInRadians,g=this.cameraToCenterDistance/l,y=Math.sin(u)*g,B=Math.cos(u)*g+1,S=1/Math.sqrt(y*y+B*B)*1;let L=-y,O=B;const Q=Math.sqrt(L*L+O*O);L/=Q,O/=Q;const q=[0,L,O];return o.bg(q,q,[0,0,0],-this.bearingInRadians),o.bh(q,q,[0,0,0],-1*this.center.lat*Math.PI/180),o.bi(q,q,[0,0,0],this.center.lng*Math.PI/180),o.aL(q,q,.25),[...q,.25*-S]}isLocationOccluded(l){return!this.isSurfacePointVisible(Pn(l))}transformLightDirection(l){const u=this._helper._center.lng*Math.PI/180,g=this._helper._center.lat*Math.PI/180,y=Math.cos(g),B=[Math.sin(u)*y,Math.sin(g),Math.cos(u)*y],S=[B[2],0,-B[0]],L=[0,0,0];o.aR(L,S,B),o.aQ(S,S),o.aQ(L,L);const O=[0,0,0];return o.aQ(O,[S[0]*l[0]+L[0]*l[1]+B[0]*l[2],S[1]*l[0]+L[1]*l[1]+B[1]*l[2],S[2]*l[0]+L[2]*l[1]+B[2]*l[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,u,g){const y=function(L,O,Q){const q=1/(1<<Q.z);return new o.Y(L/o.X*q+Q.x*q,O/o.X*q+Q.y*q)}(l,u,g.canonical),B=(S=y.y,[o.bd(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI]);var S;return this.getCircleRadiusCorrection()/Math.cos(B[1])}projectTileCoordinates(l,u,g,y){const B=g.canonical,S=oc(l,u,B.x,B.y,B.z),L=1+(y?y(l,u):0)/o.bo,O=[S[0]*L,S[1]*L,S[2]*L,1];o.al(O,O,this._globeViewProjMatrixNoCorrection);const Q=this._cachedClippingPlane,q=Q[0]*S[0]+Q[1]*S[1]+Q[2]*S[2]+Q[3]<0;return{point:new o.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=Ro(this.worldSize,this.center.lat),u=o.a$(),g=o.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),o.aV(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;u[8]=2*-y.x/this._helper._width,u[9]=2*y.y/this._helper._height,this._projectionMatrix=o.aW(u),this._globeProjMatrixInverted=o.a$(),o.an(this._globeProjMatrixInverted,u),o.J(u,u,[0,0,-this.cameraToCenterDistance]),o.aX(u,u,this.rollInRadians),o.aY(u,u,-this.pitchInRadians),o.aX(u,u,this.bearingInRadians),o.J(u,u,[0,0,-l]);const B=o.bf();B[0]=l,B[1]=l,B[2]=l,o.aY(g,u,this.center.lat*Math.PI/180),o.bj(g,g,-this.center.lng*Math.PI/180),o.K(g,g,B),this._globeViewProjMatrixNoCorrection=g,o.aY(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bj(u,u,-this.center.lng*Math.PI/180),o.K(u,u,B),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=o.a$(),o.an(this._globeViewProjMatrixNoCorrectionInverted,g);const S=o.bf();this._cameraPosition=o.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/l,o.bg(this._cameraPosition,this._cameraPosition,S,-this.rollInRadians),o.bh(this._cameraPosition,this._cameraPosition,S,this.pitchInRadians),o.bg(this._cameraPosition,this._cameraPosition,S,-this.bearingInRadians),o.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bh(this._cameraPosition,this._cameraPosition,S,-this.center.lat*Math.PI/180),o.bi(this._cameraPosition,this._cameraPosition,S,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const L=o.aW(this._globeViewProjMatrixNoCorrectionInverted);o.K(L,L,[1,1,-1]),this._cachedFrustum=Ko.fromInvProjectionMatrix(L)}calculateFogMatrix(l){o.w("calculateFogMatrix is not supported on globe projection.");const u=o.a$();return o.aq(u),u}getVisibleUnwrappedCoordinates(l){return[new o.aT(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const g=Pn(l);o.aL(g,g,1+u/o.bo);const y=o.be();return o.al(y,[g[0],g[1],g[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(l){}getBounds(){const l=.5*this.width,u=.5*this.height,g=[new o.P(0,0),new o.P(l,0),new o.P(this.width,0),new o.P(this.width,u),new o.P(this.width,this.height),new o.P(l,this.height),new o.P(0,this.height),new o.P(0,u)],y=[];for(const Z of g)y.push(this.unprojectScreenPoint(Z));let B=0,S=0,L=0,O=0;const Q=this.center;for(const Z of y){const J=o.bk(Q.lng,Z.lng),At=o.bk(Q.lat,Z.lat);J<S&&(S=J),J>B&&(B=J),At<O&&(O=At),At>L&&(L=At)}const q=[Q.lng+S,Q.lat+O,Q.lng+B,Q.lat+L];return this.isSurfacePointOnScreen([0,1,0])&&(q[3]=90,q[0]=-180,q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(q[1]=-90,q[0]=-180,q[2]=180),new mr(q)}getConstrained(l,u){const g=o.ab(l.lat,-85.051129,o.aF),y=o.ab(+u,this.minZoom+si(0,g),this.maxZoom);return{center:new o.N(l.lng,g),zoom:y}}calculateCenterFromCameraLngLatAlt(l,u,g,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,u,g,y)}setLocationAtPoint(l,u){const g=Pn(this.unprojectScreenPoint(u)),y=Pn(l),B=o.bf();o.bl(B);const S=o.bf();o.bi(S,g,B,-this.center.lng*Math.PI/180),o.bh(S,S,B,this.center.lat*Math.PI/180);const L=y[0]*y[0]+y[2]*y[2],O=S[0]*S[0];if(L<O)return;const Q=Math.sqrt(L-O),q=-Q,Z=o.bm(y[0],y[2],S[0],Q),J=o.bm(y[0],y[2],S[0],q),At=o.bf();o.bi(At,y,B,-Z);const gt=o.bm(At[1],At[2],S[1],S[2]),Lt=o.bf();o.bi(Lt,y,B,-J);const Ft=o.bm(Lt[1],Lt[2],S[1],S[2]),Ot=.5*Math.PI,kt=gt>=-Ot&&gt<=Ot,qt=Ft>=-Ot&&Ft<=Ot;let $t,Jt;if(kt&&qt){const Ce=this.center.lng*Math.PI/180,Oe=this.center.lat*Math.PI/180;o.bp(Z,Ce)+o.bp(gt,Oe)<o.bp(J,Ce)+o.bp(Ft,Oe)?($t=Z,Jt=gt):($t=J,Jt=Ft)}else if(kt)$t=Z,Jt=gt;else{if(!qt)return;$t=J,Jt=Ft}const ne=$t/Math.PI*180,se=Jt/Math.PI*180,Te=this.center.lat;this.setCenter(new o.N(ne,o.ab(se,-90,90))),this.setZoom(this.zoom+si(Te,this.center.lat))}locationToScreenPoint(l,u){const g=Pn(l);if(u){const y=u.getElevationForLngLatZoom(l,this._helper._tileZoom);o.aL(g,g,1+y/o.bo)}return this._projectSurfacePointToScreen(g)}_projectSurfacePointToScreen(l){const u=o.be();return o.al(u,[...l,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new o.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,u){if(u){const g=u.pointCoordinate(l);if(g)return g}return o.Y.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,u){var g;return(g=this.screenPointToMercatorCoordinate(l,u))===null||g===void 0?void 0:g.toLngLat()}isPointOnMapSurface(l,u){const g=this._cameraPosition,y=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(g,y)}getRayDirectionFromPixel(l){const u=o.be();u[0]=l.x/this.width*2-1,u[1]=-1*(l.y/this.height*2-1),u[2]=1,u[3]=1,o.al(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const g=o.bf();g[0]=u[0]-this._cameraPosition[0],g[1]=u[1]-this._cameraPosition[1],g[2]=u[2]-this._cameraPosition[2];const y=o.bf();return o.aQ(y,g),y}isSurfacePointVisible(l){const u=this._cachedClippingPlane;return u[0]*l[0]+u[1]*l[1]+u[2]*l[2]+u[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const u=o.be();return o.al(u,[...l,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(l,u){const g=o.aS(l,u),y=o.bf(),B=o.bf();o.aL(B,u,g),o.aP(y,l,B);const S=1-o.aS(y,y);if(S<0)return null;const L=o.aS(l,l)-1,O=-g+(g<0?1:-1)*Math.sqrt(S),Q=L/O,q=O;return{tMin:Math.min(Q,q),tMax:Math.max(Q,q)}}unprojectScreenPoint(l){const u=this._cameraPosition,g=this.getRayDirectionFromPixel(l),y=this.rayPlanetIntersection(u,g);if(y){const Q=o.bf();o.aM(Q,u,[g[0]*y.tMin,g[1]*y.tMin,g[2]*y.tMin]);const q=o.bf();return o.aQ(q,Q),Wo(q)}const B=this._cachedClippingPlane[0]*g[0]+this._cachedClippingPlane[1]*g[1]+this._cachedClippingPlane[2]*g[2],S=-o.bn(this._cachedClippingPlane,u)/B,L=o.bf();if(S>0)o.aM(L,u,[g[0]*S,g[1]*S,g[2]*S]);else{const Q=o.bf();o.aM(Q,u,[2*g[0],2*g[1],2*g[2]]);const q=o.bn(this._cachedClippingPlane,Q);o.aP(L,Q,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const O=o.bf();return o.aQ(O,L),Wo(O)}getMatrixForModel(l,u){const g=o.N.convert(l),y=1/o.bo,B=o.a_();return o.bj(B,B,g.lng/180*Math.PI),o.aY(B,B,-g.lat/180*Math.PI),o.J(B,B,[0,0,1+u/o.bo]),o.aY(B,B,.5*Math.PI),o.K(B,B,[y,y,y]),B}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const u=this.getProjectionData({overscaledTileID:new o.S(0,0,0,0,0),applyGlobeMatrix:l});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(l){}}class ga{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,u,g){return this._helper.interpolatePadding(l,u,g)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._helper.resize(l,u,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}overrideNearFarZ(l,u){this._helper.overrideNearFarZ(l,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,u){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new _i({calcMatrices:()=>{this._calcMatrices()},getConstrained:(l,u)=>this.getConstrained(l,u)}),this._globeness=1,this._mercatorTransform=new en,this._verticalPerspectiveTransform=new nu}clone(){const l=new ga;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const u=this._mercatorTransform.getProjectionData(l),g=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?g.mainMatrix:u.mainMatrix,clippingPlane:g.clippingPlane,tileMercatorCoords:g.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return o.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,u,g){const y=this._mercatorTransform.getPitchedTextCorrection(l,u,g),B=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,u,g);return o.b9(y,B,this._globeness)}projectTileCoordinates(l,u,g,y){return this.currentTransform.projectTileCoordinates(l,u,g,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,u){return this.currentTransform.lngLatToCameraDepth(l,u)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}getConstrained(l,u){return this.currentTransform.getConstrained(l,u)}calculateCenterFromCameraLngLatAlt(l,u,g,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,u,g,y)}setLocationAtPoint(l,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,u){return this.currentTransform.locationToScreenPoint(l,u)}screenPointToMercatorCoordinate(l,u){return this.currentTransform.screenPointToMercatorCoordinate(l,u)}screenPointToLocation(l,u){return this.currentTransform.screenPointToLocation(l,u)}isPointOnMapSurface(l,u){return this.currentTransform.isPointOnMapSurface(l,u)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,u){return this.currentTransform.getMatrixForModel(l,u)}getProjectionDataForCustomLayer(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const u=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return u;const g=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return g.fallbackMatrix=u.mainMatrix,g}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class zs{get useGlobeControls(){return!0}handlePanInertia(l,u){const g=eu(l,u);return Math.abs(g.lng-u.center.lng)>180&&(g.lng=u.center.lng+179.5*Math.sign(g.lng-u.center.lng)),{easingCenter:g,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,u){const g=l.around,y=u.screenPointToLocation(g);l.bearingDelta&&u.setBearing(u.bearing+l.bearingDelta),l.pitchDelta&&u.setPitch(u.pitch+l.pitchDelta),l.rollDelta&&u.setRoll(u.roll+l.rollDelta);const B=u.zoom;l.zoomDelta&&u.setZoom(u.zoom+l.zoomDelta);const S=u.zoom-B;if(S===0)return;const L=o.bk(u.center.lng,y.lng),O=L/(Math.abs(L/180)+1),Q=o.bk(u.center.lat,y.lat),q=u.getRayDirectionFromPixel(g),Z=u.cameraPosition,J=-1*o.aS(Z,q),At=o.bf();o.aM(At,Z,[q[0]*J,q[1]*J,q[2]*J]);const gt=o.bq(At)-1,Lt=Math.exp(.5*-Math.max(gt-.3,0)),Ft=Ro(u.worldSize,u.center.lat)/Math.min(u.width,u.height),Ot=o.bc(Ft,.9,.5,1,.25),kt=(1-o.aG(-S))*Math.min(Lt,Ot),qt=u.center.lat,$t=u.zoom,Jt=new o.N(u.center.lng+O*kt,o.ab(u.center.lat+Q*kt,-85.051129,o.aF));u.setLocationAtPoint(y,g);const ne=u.center,se=o.bc(Math.abs(L),45,85,0,1),Te=o.bc(Ft,.75,.35,0,1),Ce=Math.pow(Math.max(se,Te),.25),Oe=o.bk(ne.lng,Jt.lng),ze=o.bk(ne.lat,Jt.lat);u.setCenter(new o.N(ne.lng+Oe*Ce,ne.lat+ze*Ce).wrap()),u.setZoom($t+si(qt,u.center.lat))}handleMapControlsPan(l,u,g){if(!l.panDelta)return;const y=u.center.lat,B=u.zoom;u.setCenter(eu(l.panDelta,u).wrap()),u.setZoom(B+si(y,u.center.lat))}cameraForBoxAndBearing(l,u,g,y,B){const S=bs(l,u,g,y,B),L=u.left/B.width*2-1,O=(B.width-u.right)/B.width*2-1,Q=u.top/B.height*-2+1,q=(B.height-u.bottom)/B.height*-2+1,Z=o.bk(g.getWest(),g.getEast())<0,J=Z?g.getEast():g.getWest(),At=Z?g.getWest():g.getEast(),gt=Math.max(g.getNorth(),g.getSouth()),Lt=Math.min(g.getNorth(),g.getSouth()),Ft=J+.5*o.bk(J,At),Ot=gt+.5*o.bk(gt,Lt),kt=B.clone();kt.setCenter(S.center),kt.setBearing(S.bearing),kt.setPitch(0),kt.setRoll(0),kt.setZoom(S.zoom);const qt=kt.modelViewProjectionMatrix,$t=[Pn(g.getNorthWest()),Pn(g.getNorthEast()),Pn(g.getSouthWest()),Pn(g.getSouthEast()),Pn(new o.N(At,Ot)),Pn(new o.N(J,Ot)),Pn(new o.N(Ft,gt)),Pn(new o.N(Ft,Lt))],Jt=Pn(S.center);let ne=Number.POSITIVE_INFINITY;for(const se of $t)L<0&&(ne=zs.getLesserNonNegativeNonNull(ne,zs.solveVectorScale(se,Jt,qt,"x",L))),O>0&&(ne=zs.getLesserNonNegativeNonNull(ne,zs.solveVectorScale(se,Jt,qt,"x",O))),Q>0&&(ne=zs.getLesserNonNegativeNonNull(ne,zs.solveVectorScale(se,Jt,qt,"y",Q))),q<0&&(ne=zs.getLesserNonNegativeNonNull(ne,zs.solveVectorScale(se,Jt,qt,"y",q)));if(Number.isFinite(ne)&&ne!==0)return S.zoom=kt.zoom+o.a8(ne),S;Lo()}handleJumpToCenterZoom(l,u){const g=l.center.lat,y=l.getConstrained(u.center?o.N.convert(u.center):l.center,l.zoom).center;l.setCenter(y.wrap());const B=u.zoom!==void 0?+u.zoom:l.zoom+si(g,y.lat);l.zoom!==B&&l.setZoom(B)}handleEaseTo(l,u){const g=l.zoom,y=l.center,B=l.padding,S={roll:l.roll,pitch:l.pitch,bearing:l.bearing},L={roll:u.roll===void 0?l.roll:u.roll,pitch:u.pitch===void 0?l.pitch:u.pitch,bearing:u.bearing===void 0?l.bearing:u.bearing},O=u.zoom!==void 0,Q=!l.isPaddingEqual(u.padding);let q=!1;const Z=u.center?o.N.convert(u.center):y,J=l.getConstrained(Z,g).center;Bn(l,J);const At=l.clone();At.setCenter(J),At.setZoom(O?+u.zoom:g+si(y.lat,Z.lat)),At.setBearing(u.bearing);const gt=new o.P(o.ab(l.centerPoint.x+u.offsetAsPoint.x,0,l.width),o.ab(l.centerPoint.y+u.offsetAsPoint.y,0,l.height));At.setLocationAtPoint(J,gt);const Lt=(u.offset&&u.offsetAsPoint.mag())>0?At.center:J,Ft=O?+u.zoom:g+si(y.lat,Lt.lat),Ot=g+si(y.lat,0),kt=Ft+si(Lt.lat,0),qt=o.bk(y.lng,Lt.lng),$t=o.bk(y.lat,Lt.lat),Jt=o.aG(kt-Ot);return q=Ft!==g,{easeFunc:ne=>{if(o.b3(S,L)||Nh({startEulerAngles:S,endEulerAngles:L,tr:l,k:ne,useSlerp:S.roll!=L.roll}),Q&&l.interpolatePadding(B,u.padding,ne),u.around)o.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(u.around,u.aroundPoint);else{const se=kt>Ot?Math.min(2,Jt):Math.max(.5,Jt),Te=Math.pow(se,1-ne),Ce=NA(y,qt,$t,ne*Te);l.setCenter(Ce.wrap())}if(q){const se=o.y.number(Ot,kt,ne)+si(0,l.center.lat);l.setZoom(se)}},isZooming:q,elevationCenter:Lt}}handleFlyTo(l,u){const g=u.zoom!==void 0,y=l.center,B=l.zoom,S=!l.isPaddingEqual(u.padding),L=l.getConstrained(o.N.convert(u.center||u.locationAtOffset),B).center,O=g?+u.zoom:l.zoom+si(l.center.lat,L.lat),Q=l.clone();Q.setCenter(L),S&&Q.setPadding(u.padding),Q.setZoom(O),Q.setBearing(u.bearing);const q=new o.P(o.ab(l.centerPoint.x+u.offsetAsPoint.x,0,l.width),o.ab(l.centerPoint.y+u.offsetAsPoint.y,0,l.height));Q.setLocationAtPoint(L,q);const Z=Q.center;Bn(l,Z);const J=function(qt,$t,Jt){const ne=Pn($t),se=Pn(Jt),Te=o.aS(ne,se),Ce=Math.acos(Te),Oe=kh(qt);return Ce/(2*Math.PI)*Oe}(l,y,Z),At=B+si(y.lat,0),gt=O+si(Z.lat,0),Lt=o.aG(gt-At);let Ft;if(typeof u.minZoom=="number"){const qt=+u.minZoom+si(Z.lat,0),$t=Math.min(qt,At,gt)+si(0,Z.lat),Jt=l.getConstrained(Z,$t).zoom+si(Z.lat,0);Ft=o.aG(Jt-At)}const Ot=o.bk(y.lng,Z.lng),kt=o.bk(y.lat,Z.lat);return{easeFunc:(qt,$t,Jt,ne)=>{const se=NA(y,Ot,kt,Jt),Te=qt===1?Z:se;l.setCenter(Te.wrap());const Ce=At+o.a8($t);l.setZoom(qt===1?O:Ce+si(0,Te.lat))},scaleOfZoom:Lt,targetCenter:Z,scaleOfMinZoom:Ft,pixelPathLength:J}}static solveVectorScale(l,u,g,y,B){const S=y==="x"?[g[0],g[4],g[8],g[12]]:[g[1],g[5],g[9],g[13]],L=[g[3],g[7],g[11],g[15]],O=l[0]*S[0]+l[1]*S[1]+l[2]*S[2],Q=l[0]*L[0]+l[1]*L[1]+l[2]*L[2],q=u[0]*S[0]+u[1]*S[1]+u[2]*S[2],Z=u[0]*L[0]+u[1]*L[1]+u[2]*L[2];return q+B*Q===O+B*Z||L[3]*(O-q)+S[3]*(Z-Q)+O*Z==q*Q?null:(q+S[3]-B*Z-B*L[3])/(q-O-B*Z+B*Q)}static getLesserNonNegativeNonNull(l,u){return u!==null&&u>=0&&u<l?u:l}}class Sl{constructor(l){this._globe=l,this._mercatorCameraHelper=new Zc,this._verticalPerspectiveCameraHelper=new zs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,u){return this.currentHelper.handlePanInertia(l,u)}handleMapControlsRollPitchBearingZoom(l,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,u)}handleMapControlsPan(l,u,g){this.currentHelper.handleMapControlsPan(l,u,g)}cameraForBoxAndBearing(l,u,g,y,B){return this.currentHelper.cameraForBoxAndBearing(l,u,g,y,B)}handleJumpToCenterZoom(l,u){this.currentHelper.handleJumpToCenterZoom(l,u)}handleEaseTo(l,u){return this.currentHelper.handleEaseTo(l,u)}handleFlyTo(l,u){return this.currentHelper.handleFlyTo(l,u)}}const Il=(w,l)=>o.t(w,l&&l.filter(u=>u.identifier!=="source.canvas")),zh=o.br();class Hs extends o.E{constructor(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const y=this.sourceCaches[g].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[g].reload()}},this.map=l,this.dispatcher=new Xt(ae(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,y)=>this.getGlyphs(g,y)),this.dispatcher.registerMessageHandler("GI",(g,y)=>this.getImages(g,y)),this.imageManager=new Ct,this.imageManager.setEventedParent(this),this.glyphManager=new yt(l._requestManager,u.localIdeographFontFamily),this.lineAtlas=new pe(256,512),this.crossTileSymbolIndex=new Vi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.bt()),Zr().on(Br,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.sourceCaches[g.sourceId];if(!y)return;const B=y.getSource();if(B&&B.vectorLayerIds)for(const S in this._layers){const L=this._layers[S];L.source===B.id&&this._validateLayer(L)}})}loadURL(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const y=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const B=this._loadStyleRequest;o.h(y,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,u,g)}).catch(S=>{this._loadStyleRequest=null,S&&!B.signal.aborted&&this.fire(new o.j(S))})}loadJSON(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(l,u,g)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(zh,{validate:!1})}_load(l,u,g){var y,B;const S=u.transformStyle?u.transformStyle(g,l):l;if(!u.validate||!Il(this,o.u(S))){this._loaded=!0,this.stylesheet=S;for(const L in S.sources)this.addSource(L,S.sources[L],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new ee(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new oe(this.stylesheet.sky),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const l=o.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of l){const g=o.bv(u);g.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=g}}_loadSprite(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(B,S,L,O){return o._(this,void 0,void 0,function*(){const Q=Y(B),q=L>1?"@2x":"",Z={},J={};for(const{id:At,url:gt}of Q){const Lt=S.transformRequest(it(gt,q,".json"),"SpriteJSON");Z[At]=o.h(Lt,O);const Ft=S.transformRequest(it(gt,q,".png"),"SpriteImage");J[At]=G.getImage(Ft,O)}return yield Promise.all([...Object.values(Z),...Object.values(J)]),function(At,gt){return o._(this,void 0,void 0,function*(){const Lt={};for(const Ft in At){Lt[Ft]={};const Ot=C.getImageCanvasContext((yield gt[Ft]).data),kt=(yield At[Ft]).data;for(const qt in kt){const{width:$t,height:Jt,x:ne,y:se,sdf:Te,pixelRatio:Ce,stretchX:Oe,stretchY:ze,content:Le,textFitWidth:fr,textFitHeight:Ar}=kt[qt];Lt[Ft][qt]={data:null,pixelRatio:Ce,sdf:Te,stretchX:Oe,stretchY:ze,content:Le,textFitWidth:fr,textFitHeight:Ar,spriteData:{width:$t,height:Jt,x:ne,y:se,context:Ot}}}}return Lt})}(Z,J)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(B=>{if(this._spriteRequest=null,B)for(const S in B){this._spritesImagesIds[S]=[];const L=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(O=>!(O in B)):[];for(const O of L)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in B[S]){const Q=S==="default"?O:`${S}:${O}`;this._spritesImagesIds[S].push(Q),Q in this.imageManager.images?this.imageManager.updateImage(Q,B[S][O],!1):this.imageManager.addImage(Q,B[S][O]),u&&(this._changedImages[Q]=!0)}}}).catch(B=>{this._spriteRequest=null,y=B,this.fire(new o.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),g&&g(y)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(l){const u=this.sourceCaches[l.source];if(!u)return;const g=l.sourceLayer;if(!g)return;const y=u.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.j(new Error(`Source layer "${g}" does not exist on source "${y.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const g=this._serializedAllLayers();if(!l||l.length===0)return Object.values(u?o.bw(g):g);const y=[];for(const B of l)if(g[B]){const S=u?o.bw(g[B]):g[B];y.push(S)}return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const u=Object.keys(this._layers);for(const g of u){const y=this._layers[g];y.type!=="custom"&&(l[g]=y.serialize())}return l}hasTransitions(){var l,u,g;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((g=this.projection)===null||g===void 0)&&g.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const u=this._changed;if(u){const y=Object.keys(this._updatedLayers),B=Object.keys(this._removedLayers);(y.length||B.length)&&this._updateWorkerLayers(y,B);for(const S in this._updatedSources){const L=this._updatedSources[S];if(L==="reload")this._reloadSource(S);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const g={};for(const y in this.sourceCaches){const B=this.sourceCaches[y];g[y]=B.used,B.used=!1}for(const y of this._order){const B=this._layers[y];B.recalculate(l,this._availableImages),!B.isHidden(l.zoom)&&B.source&&(this.sourceCaches[B.source].used=!0)}for(const y in g){const B=this.sourceCaches[y];!!g[y]!=!!B.used&&B.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,u&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var g;this._checkLoaded();const y=this.serialize();if(l=u.transformStyle?u.transformStyle(y,l):l,((g=u.validate)===null||g===void 0||g)&&Il(this,o.u(l)))return!1;(l=o.bw(l)).layers=o.bu(l.layers);const B=o.bx(y,l),S=this._getOperationsToPerform(B);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const L of S.operations)L();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const u=[],g=[];for(const y of l)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":u.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":u.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,y.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setSky":u.push(()=>this.setSky.apply(this,y.args));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setTransition":u.push(()=>{});break;default:g.push(y.command)}return{operations:u,unimplemented:g}}addImage(l,u){if(this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,u),this._afterImageUpdated(l)}updateImage(l,u){this.imageManager.updateImage(l,u)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.u.source,`sources.${l}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=this.sourceCaches[l]=new ct(l,u,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:l})),y.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===l)return this.fire(new o.j(new Error(`Source "${l}" cannot be removed while layer "${g}" is using it.`)));const u=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],u.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,u){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const g=this.sourceCaches[l].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(u),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=l.id;if(this.getLayer(y))return void this.fire(new o.j(new Error(`Layer "${y}" already exists on this map.`)));let B;if(l.type==="custom"){if(Il(this,o.by(l)))return;B=o.bv(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(y,l.source),l=o.bw(l),l=o.e(l,{source:y})),this._validate(o.u.layer,`layers.${y}`,l,{arrayIndex:-1},g))return;B=o.bv(l),this._validateLayer(B),B.setEventedParent(this,{layer:{id:y}})}const S=u?this._order.indexOf(u):this._order.length;if(u&&S===-1)this.fire(new o.j(new Error(`Cannot add layer "${y}" before non-existing layer "${u}".`)));else{if(this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=B,this._removedLayers[y]&&B.source&&B.type!=="custom"){const L=this._removedLayers[y];delete this._removedLayers[y],L.type!==B.type?this._updatedSources[B.source]="clear":(this._updatedSources[B.source]="reload",this.sourceCaches[B.source].pause())}this._updateLayer(B),B.onAdd&&B.onAdd(this.map)}}moveLayer(l,u){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===u)return;const g=this._order.indexOf(l);this._order.splice(g,1);const y=u?this._order.indexOf(u):this._order.length;u&&y===-1?this.fire(new o.j(new Error(`Cannot move layer "${l}" before non-existing layer "${u}".`))):(this._order.splice(y,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const u=this._layers[l];if(!u)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${l}".`)));u.setEventedParent(null);const g=this._order.indexOf(l);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=u,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],u.onRemove&&u.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,u,g){this._checkLoaded();const y=this.getLayer(l);y?y.minzoom===u&&y.maxzoom===g||(u!=null&&(y.minzoom=u),g!=null&&(y.maxzoom=g),this._updateLayer(y)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=this.getLayer(l);if(y){if(!o.bz(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(o.u.filter,`layers.${y.id}.filter`,u,null,g)||(y.filter=o.bw(u),this._updateLayer(y)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.bw(this.getLayer(l).filter)}setLayoutProperty(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const B=this.getLayer(l);B?o.bz(B.getLayoutProperty(u),g)||(B.setLayoutProperty(u,g,y),this._updateLayer(B)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,u){const g=this.getLayer(l);if(g)return g.getLayoutProperty(u);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const B=this.getLayer(l);B?o.bz(B.getPaintProperty(u),g)||(B.setPaintProperty(u,g,y)&&this._updateLayer(B),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,u){return this.getLayer(l).getPaintProperty(u)}setFeatureState(l,u){this._checkLoaded();const g=l.source,y=l.sourceLayer,B=this.sourceCaches[g];if(B===void 0)return void this.fire(new o.j(new Error(`The source '${g}' does not exist in the map's style.`)));const S=B.getSource().type;S==="geojson"&&y?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||y?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),B.setFeatureState(y,l.id,u)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,u){this._checkLoaded();const g=l.source,y=this.sourceCaches[g];if(y===void 0)return void this.fire(new o.j(new Error(`The source '${g}' does not exist in the map's style.`)));const B=y.getSource().type,S=B==="vector"?l.sourceLayer:void 0;B!=="vector"||S?u&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(S,l.id,u):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const u=l.source,g=l.sourceLayer,y=this.sourceCaches[u];if(y!==void 0)return y.getSource().type!=="vector"||g?(l.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(g,l.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.bA(this.sourceCaches,B=>B.serialize()),u=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,y=this.stylesheet;return o.bB({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:l,layers:u,terrain:g},B=>B!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const u=S=>this._layers[S].type==="fill-extrusion",g={},y=[];for(let S=this._order.length-1;S>=0;S--){const L=this._order[S];if(u(L)){g[L]=S;for(const O of l){const Q=O[L];if(Q)for(const q of Q)y.push(q)}}}y.sort((S,L)=>L.intersectionZ-S.intersectionZ);const B=[];for(let S=this._order.length-1;S>=0;S--){const L=this._order[S];if(u(L))for(let O=y.length-1;O>=0;O--){const Q=y[O].feature;if(g[Q.layer.id]<S)break;B.push(Q),y.pop()}else for(const O of l){const Q=O[L];if(Q)for(const q of Q)B.push(q.feature)}}return B}queryRenderedFeatures(l,u,g){u&&u.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",u.filter,null,u);const y={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new o.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Q of u.layers){const q=this._layers[Q];if(!q)return this.fire(new o.j(new Error(`The layer '${Q}' does not exist in the map's style and cannot be queried for features.`))),[];y[q.source]=!0}}const B=[];u.availableImages=this._availableImages;const S=this._serializedAllLayers(),L=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,O=Object.assign(Object.assign({},u),{layers:L});for(const Q in this.sourceCaches)u.layers&&!y[Q]||B.push(qe(this.sourceCaches[Q],this._layers,S,l,O,g));return this.placement&&B.push(function(Q,q,Z,J,At,gt,Lt){const Ft={},Ot=gt.queryRenderedSymbols(J),kt=[];for(const qt of Object.keys(Ot).map(Number))kt.push(Lt[qt]);kt.sort(Ve);for(const qt of kt){const $t=qt.featureIndex.lookupSymbolFeatures(Ot[qt.bucketInstanceId],q,qt.bucketIndex,qt.sourceLayerIndex,At.filter,At.layers,At.availableImages,Q);for(const Jt in $t){const ne=Ft[Jt]=Ft[Jt]||[],se=$t[Jt];se.sort((Te,Ce)=>{const Oe=qt.featureSortOrder;if(Oe){const ze=Oe.indexOf(Te.featureIndex);return Oe.indexOf(Ce.featureIndex)-ze}return Ce.featureIndex-Te.featureIndex});for(const Te of se)ne.push(Te)}}return function(qt,$t,Jt){for(const ne in qt)for(const se of qt[ne])Je(se,Jt[$t[ne].source]);return qt}(Ft,Q,Z)}(this._layers,S,this.sourceCaches,l,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(B)}querySourceFeatures(l,u){u&&u.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",u.filter,null,u);const g=this.sourceCaches[l];return g?function(y,B){const S=y.getRenderableIds().map(Q=>y.getTileByID(Q)),L=[],O={};for(let Q=0;Q<S.length;Q++){const q=S[Q],Z=q.tileID.canonical.key;O[Z]||(O[Z]=!0,q.querySourceFeatures(L,B))}return L}(g,u):[]}getLight(){return this.light.getLight()}setLight(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const g=this.light.getLight();let y=!1;for(const S in l)if(!o.bz(l[S],g[S])){y=!0;break}if(!y)return;const B={now:C.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,u),this.light.updateTransitions(B)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const g=this.getSky();let y=!1;if(!l&&!g)return;if(l&&!g)y=!0;else if(!l&&g)y=!0;else for(const S in l)if(!o.bz(l[S],g[S])){y=!0;break}if(!y)return;const B={now:C.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,u),this.sky.updateTransitions(B)}_setProjectionInternal(l){const u=function(g){if(Array.isArray(g)){const y=new $u({type:g});return{projection:y,transform:new ga,cameraHelper:new Sl(y)}}switch(g){case"mercator":return{projection:new bt,transform:new en,cameraHelper:new Zc};case"globe":{const y=new $u({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new ga,cameraHelper:new Sl(y)}}case"vertical-perspective":return{projection:new tu,transform:new nu,cameraHelper:new zs};default:return o.w(`Unknown projection name: ${g}. Falling back to mercator projection.`),{projection:new bt,transform:new en,cameraHelper:new Zc}}}(l);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const g in this.sourceCaches)this.sourceCaches[g].reload()}_validate(l,u,g,y){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!B||B.validate!==!1)&&Il(this,l.call(o.u,o.e({key:u,style:this.serialize(),value:g,styleSpec:o.v},y)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Zr().off(Br,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const g=this.sourceCaches[u];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const u in this.sourceCaches)this.sourceCaches[u].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,u,g,y){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,S=!1,L=!1;const O={};for(const Q of this._order){const q=this._layers[Q];if(q.type!=="symbol")continue;if(!O[q.source]){const J=this.sourceCaches[q.source];O[q.source]=J.getRenderableIds(!0).map(At=>J.getTileByID(At)).sort((At,gt)=>gt.tileID.overscaledZ-At.tileID.overscaledZ||(At.tileID.isLessThan(gt.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(q,O[q.source],l.center.lng);S=S||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((B=B||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),l.zoom))&&(this.pauseablePlacement=new nl(l,this.map.terrain,this._order,B,u,g,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),L=!0),S&&this.pauseablePlacement.placement.setStale()),L||S)for(const Q of this._order){const q=this._layers[Q];q.type==="symbol"&&this.placement.updateLayerOpacities(q,O[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,u){return o._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[u.source];return y&&y.setDependencies(u.tileID.key,u.type,u.icons),g})}getGlyphs(l,u){return o._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(u.stacks),y=this.sourceCaches[u.source];return y&&y.setDependencies(u.tileID.key,u.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(o.u.glyphs,"glyphs",l,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const B=[{id:l,url:u}],S=[...Y(this.stylesheet.sprite),...B];this._validate(o.u.sprite,"sprite",S,null,g)||(this.stylesheet.sprite=S,this._loadSprite(B,!0,y))}removeSprite(l){this._checkLoaded();const u=Y(this.stylesheet.sprite);if(u.find(g=>g.id===l)){if(this._spritesImagesIds[l])for(const g of this._spritesImagesIds[l])this.imageManager.removeImage(g),this._changedImages[g]=!0;u.splice(u.findIndex(g=>g.id===l),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Y(this.stylesheet.sprite)}setSprite(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(o.u.sprite,"sprite",l,null,u)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,g):(this._unloadSprite(),g&&g(null)))}}var iu=o.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class su{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,u,g,y,B,S,L,O,Q){this.context=l;let q=this.boundPaintVertexBuffers.length!==y.length;for(let Z=0;!q&&Z<y.length;Z++)this.boundPaintVertexBuffers[Z]!==y[Z]&&(q=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||q||this.boundIndexBuffer!==B||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==Q?this.freshBind(u,g,y,B,S,L,O,Q):(l.bindVertexArray.set(this.vao),L&&L.bind(),B&&B.dynamicDraw&&B.bind(),O&&O.bind(),Q&&Q.bind())}freshBind(l,u,g,y,B,S,L,O){const Q=l.numAttributes,q=this.context,Z=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=y,this.boundVertexOffset=B,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=O,u.enableAttributes(Z,l);for(const J of g)J.enableAttributes(Z,l);S&&S.enableAttributes(Z,l),L&&L.enableAttributes(Z,l),O&&O.enableAttributes(Z,l),u.bind(),u.setVertexAttribPointers(Z,l,B);for(const J of g)J.bind(),J.setVertexAttribPointers(Z,l,B);S&&(S.bind(),S.setVertexAttribPointers(Z,l,B)),y&&y.bind(),L&&(L.bind(),L.setVertexAttribPointers(Z,l,B)),O&&(O.bind(),O.setVertexAttribPointers(Z,l,B)),q.currentNumAttributes=Q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ma=(w,l,u,g,y)=>({u_texture:0,u_ele_delta:w,u_fog_matrix:l,u_fog_color:u?u.properties.get("fog-color"):o.b4.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:u?u.calculateFogBlendOpacity(g):0,u_horizon_color:u?u.properties.get("horizon-color"):o.b4.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),Pl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function D(w){const l=[];for(let u=0;u<w.length;u++){if(w[u]===null)continue;const g=w[u].split(" ");l.push(g.pop())}return l}class ht{constructor(l,u,g,y,B,S,L,O){const Q=l.gl;this.program=Q.createProgram();const q=D(u.staticAttributes),Z=g?g.getBinderAttributes():[],J=q.concat(Z),At=Bi.prelude.staticUniforms?D(Bi.prelude.staticUniforms):[],gt=L.staticUniforms?D(L.staticUniforms):[],Lt=u.staticUniforms?D(u.staticUniforms):[],Ft=g?g.getBinderUniforms():[],Ot=At.concat(gt).concat(Lt).concat(Ft),kt=[];for(const Ce of Ot)kt.indexOf(Ce)<0&&kt.push(Ce);const qt=g?g.defines():[];Qs(Q)&&qt.unshift("#version 300 es"),B&&qt.push("#define OVERDRAW_INSPECTOR;"),S&&qt.push("#define TERRAIN3D;"),O&&qt.push(O);let $t=qt.concat(Bi.prelude.fragmentSource,L.fragmentSource,u.fragmentSource).join(`
`),Jt=qt.concat(Bi.prelude.vertexSource,L.vertexSource,u.vertexSource).join(`
`);Qs(Q)||($t=function(Ce){return Ce.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}($t),Jt=function(Ce){return Ce.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Jt));const ne=Q.createShader(Q.FRAGMENT_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);if(Q.shaderSource(ne,$t),Q.compileShader(ne),!Q.getShaderParameter(ne,Q.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${Q.getShaderInfoLog(ne)}`);Q.attachShader(this.program,ne);const se=Q.createShader(Q.VERTEX_SHADER);if(Q.isContextLost())return void(this.failedToCreate=!0);if(Q.shaderSource(se,Jt),Q.compileShader(se),!Q.getShaderParameter(se,Q.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${Q.getShaderInfoLog(se)}`);Q.attachShader(this.program,se),this.attributes={};const Te={};this.numAttributes=J.length;for(let Ce=0;Ce<this.numAttributes;Ce++)J[Ce]&&(Q.bindAttribLocation(this.program,Ce,J[Ce]),this.attributes[J[Ce]]=Ce);if(Q.linkProgram(this.program),!Q.getProgramParameter(this.program,Q.LINK_STATUS))throw new Error(`Program failed to link: ${Q.getProgramInfoLog(this.program)}`);Q.deleteShader(se),Q.deleteShader(ne);for(let Ce=0;Ce<kt.length;Ce++){const Oe=kt[Ce];if(Oe&&!Te[Oe]){const ze=Q.getUniformLocation(this.program,Oe);ze&&(Te[Oe]=ze)}}this.fixedUniforms=y(l,Te),this.terrainUniforms=((Ce,Oe)=>({u_depth:new o.bC(Ce,Oe.u_depth),u_terrain:new o.bC(Ce,Oe.u_terrain),u_terrain_dim:new o.b5(Ce,Oe.u_terrain_dim),u_terrain_matrix:new o.bD(Ce,Oe.u_terrain_matrix),u_terrain_unpack:new o.bE(Ce,Oe.u_terrain_unpack),u_terrain_exaggeration:new o.b5(Ce,Oe.u_terrain_exaggeration)}))(l,Te),this.projectionUniforms=((Ce,Oe)=>({u_projection_matrix:new o.bD(Ce,Oe.u_projection_matrix),u_projection_tile_mercator_coords:new o.bE(Ce,Oe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bE(Ce,Oe.u_projection_clipping_plane),u_projection_transition:new o.b5(Ce,Oe.u_projection_transition),u_projection_fallback_matrix:new o.bD(Ce,Oe.u_projection_fallback_matrix)}))(l,Te),this.binderUniforms=g?g.getUniforms(l,Te):[]}draw(l,u,g,y,B,S,L,O,Q,q,Z,J,At,gt,Lt,Ft,Ot,kt,qt){const $t=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(g),l.setStencilMode(y),l.setColorMode(B),l.setCullFace(S),O){l.activeTexture.set($t.TEXTURE2),$t.bindTexture($t.TEXTURE_2D,O.depthTexture),l.activeTexture.set($t.TEXTURE3),$t.bindTexture($t.TEXTURE_2D,O.texture);for(const ne in this.terrainUniforms)this.terrainUniforms[ne].set(O[ne])}if(Q)for(const ne in Q)this.projectionUniforms[Pl[ne]].set(Q[ne]);if(L)for(const ne in this.fixedUniforms)this.fixedUniforms[ne].set(L[ne]);Ft&&Ft.setUniforms(l,this.binderUniforms,gt,{zoom:Lt});let Jt=0;switch(u){case $t.LINES:Jt=2;break;case $t.TRIANGLES:Jt=3;break;case $t.LINE_STRIP:Jt=1}for(const ne of At.get()){const se=ne.vaos||(ne.vaos={});(se[q]||(se[q]=new su)).bind(l,this,Z,Ft?Ft.getPaintVertexBuffers():[],J,ne.vertexOffset,Ot,kt,qt),$t.drawElements(u,ne.primitiveLength*Jt,$t.UNSIGNED_SHORT,ne.primitiveOffset*Jt*2)}}}function zt(w,l,u){const g=1/o.at(u,1,l.transform.tileZoom),y=Math.pow(2,u.tileID.overscaledZ),B=u.tileSize*Math.pow(2,l.transform.tileZoom)/y,S=B*(u.tileID.canonical.x+u.tileID.wrap*y),L=B*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[S>>16,L>>16],u_pixel_coord_lower:[65535&S,65535&L]}}const ie=(w,l,u,g)=>{const y=w.style.light,B=y.properties.get("position"),S=[B.x,B.y,B.z],L=o.bI();y.properties.get("anchor")==="viewport"&&o.bJ(L,w.transform.bearingInRadians),o.bK(S,S,L);const O=w.transform.transformLightDirection(S),Q=y.properties.get("color");return{u_lightpos:S,u_lightpos_globe:O,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+l,u_opacity:u,u_fill_translate:g}},Be=(w,l,u,g,y,B,S)=>o.e(ie(w,l,u,g),zt(B,w,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8}),Qe=(w,l,u,g)=>o.e(zt(l,w,u),{u_fill_translate:g}),hr=(w,l)=>({u_world:w,u_fill_translate:l}),Rr=(w,l,u,g,y)=>o.e(Qe(w,l,u,y),{u_world:g}),$r=(w,l,u,g,y)=>{const B=w.transform;let S,L,O=0;if(u.paint.get("circle-pitch-alignment")==="map"){const Q=o.at(l,1,B.zoom);S=!0,L=[Q,Q],O=Q/(o.X*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*y}else S=!1,L=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+S,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:L,u_globe_extrude_scale:O,u_translate:g}},fn=w=>({u_pixel_extrude_scale:[1/w.width,1/w.height]}),An=w=>({u_viewport_size:[w.width,w.height]}),Rn=function(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return{u_color:w,u_overlay:0,u_overlay_scale:l}},Ci=(w,l,u,g)=>{const y=o.at(w,1,l)/(o.X*Math.pow(2,w.tileID.overscaledZ))*2*Math.PI*g;return{u_extrude_scale:o.at(w,1,l),u_intensity:u,u_globe_extrude_scale:y}},ci=(w,l,u,g)=>{const y=o.H();o.bL(y,0,w.width,w.height,0,0,1);const B=w.context.gl;return{u_matrix:y,u_world:[B.drawingBufferWidth,B.drawingBufferHeight],u_image:u,u_color_ramp:g,u_opacity:l.paint.get("heatmap-opacity")}},Xi=(w,l,u)=>{const g=u.paint.get("hillshade-shadow-color"),y=u.paint.get("hillshade-highlight-color"),B=u.paint.get("hillshade-accent-color");let S=u.paint.get("hillshade-illumination-direction")*(Math.PI/180);return u.paint.get("hillshade-illumination-anchor")==="viewport"&&(S+=w.transform.bearingInRadians),{u_image:0,u_latrange:Gi(0,l.tileID),u_light:[u.paint.get("hillshade-exaggeration"),S],u_shadow:g,u_highlight:y,u_accent:B}},Vs=(w,l)=>{const u=l.stride,g=o.H();return o.bL(g,0,o.X,-8192,0,0,1),o.J(g,g,[0,-8192,0]),{u_matrix:g,u_image:1,u_dimension:[u,u],u_zoom:w.overscaledZ,u_unpack:l.getUnpackVector()}};function Gi(w,l){const u=Math.pow(2,l.canonical.z),g=l.canonical.y;return[new o.Y(0,g/u).toLngLat().lat,new o.Y(0,(g+1)/u).toLngLat().lat]}const $o=(w,l,u,g)=>{const y=w.transform;return{u_translation:au(w,l,u),u_ratio:g/o.at(l,1,y.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},fo=(w,l,u,g,y)=>o.e($o(w,l,u,g),{u_image:0,u_image_height:y}),ol=(w,l,u,g,y)=>{const B=w.transform,S=ou(l,B);return{u_translation:au(w,l,u),u_texsize:l.imageAtlasTexture.size,u_ratio:g/o.at(l,1,B.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[S,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},kA=(w,l,u,g,y,B)=>{const S=w.lineAtlas,L=ou(l,w.transform),O=u.layout.get("line-cap")==="round",Q=S.getDash(y.from,O),q=S.getDash(y.to,O),Z=Q.width*B.fromScale,J=q.width*B.toScale;return o.e($o(w,l,u,g),{u_patternscale_a:[L/Z,-Q.height/2],u_patternscale_b:[L/J,-q.height/2],u_sdfgamma:S.width/(256*Math.min(Z,J)*w.pixelRatio)/2,u_image:0,u_tex_y_a:Q.y,u_tex_y_b:q.y,u_mix:B.t})};function ou(w,l){return 1/o.at(w,1,l.tileZoom)}function au(w,l,u){return o.au(w.transform,l,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const lu=(w,l,u,g,y)=>{return{u_tl_parent:w,u_scale_parent:l,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(S=g.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(B=g.paint.get("raster-contrast"),B>0?1/(1-B):1+B),u_spin_weights:cu(g.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var B,S};function cu(w){w*=Math.PI/180;const l=Math.sin(w),u=Math.cos(w);return[(2*u+1)/3,(-Math.sqrt(3)*l-u+1)/3,(Math.sqrt(3)*l-u+1)/3]}const uu=(w,l,u,g,y,B,S,L,O,Q,q,Z,J)=>{const At=S.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:At.cameraToCenterDistance,u_pitch:At.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:At.width/At.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_label_plane_matrix:L,u_coord_matrix:O,u_is_text:+q,u_pitch_with_map:+g,u_is_along_line:y,u_is_variable_anchor:B,u_texsize:Z,u_texture:0,u_translation:Q,u_pitched_scale:J}},al=(w,l,u,g,y,B,S,L,O,Q,q,Z,J,At)=>{const gt=S.transform;return o.e(uu(w,l,u,g,y,B,S,L,O,Q,q,Z,At),{u_gamma_scale:g?Math.cos(gt.pitch*Math.PI/180)*gt.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},Ei=(w,l,u,g,y,B,S,L,O,Q,q,Z,J)=>o.e(al(w,l,u,g,y,B,S,L,O,Q,!0,q,0,J),{u_texsize_icon:Z,u_texture_icon:1}),ac=(w,l)=>({u_opacity:w,u_color:l}),lc=(w,l,u,g,y)=>o.e(function(B,S,L,O){const Q=L.imageManager.getPattern(B.from.toString()),q=L.imageManager.getPattern(B.to.toString()),{width:Z,height:J}=L.imageManager.getPixelSize(),At=Math.pow(2,O.tileID.overscaledZ),gt=O.tileSize*Math.pow(2,L.transform.tileZoom)/At,Lt=gt*(O.tileID.canonical.x+O.tileID.wrap*At),Ft=gt*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Z,J],u_mix:S.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/o.at(O,1,L.transform.tileZoom),u_pixel_coord_upper:[Lt>>16,Ft>>16],u_pixel_coord_lower:[65535&Lt,65535&Ft]}}(u,y,l,g),{u_opacity:w}),Ml=(w,l)=>{},Yu={fillExtrusion:(w,l)=>({u_lightpos:new o.bG(w,l.u_lightpos),u_lightpos_globe:new o.bG(w,l.u_lightpos_globe),u_lightintensity:new o.b5(w,l.u_lightintensity),u_lightcolor:new o.bG(w,l.u_lightcolor),u_vertical_gradient:new o.b5(w,l.u_vertical_gradient),u_opacity:new o.b5(w,l.u_opacity),u_fill_translate:new o.bH(w,l.u_fill_translate)}),fillExtrusionPattern:(w,l)=>({u_lightpos:new o.bG(w,l.u_lightpos),u_lightpos_globe:new o.bG(w,l.u_lightpos_globe),u_lightintensity:new o.b5(w,l.u_lightintensity),u_lightcolor:new o.bG(w,l.u_lightcolor),u_vertical_gradient:new o.b5(w,l.u_vertical_gradient),u_height_factor:new o.b5(w,l.u_height_factor),u_opacity:new o.b5(w,l.u_opacity),u_fill_translate:new o.bH(w,l.u_fill_translate),u_image:new o.bC(w,l.u_image),u_texsize:new o.bH(w,l.u_texsize),u_pixel_coord_upper:new o.bH(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(w,l.u_pixel_coord_lower),u_scale:new o.bG(w,l.u_scale),u_fade:new o.b5(w,l.u_fade)}),fill:(w,l)=>({u_fill_translate:new o.bH(w,l.u_fill_translate)}),fillPattern:(w,l)=>({u_image:new o.bC(w,l.u_image),u_texsize:new o.bH(w,l.u_texsize),u_pixel_coord_upper:new o.bH(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(w,l.u_pixel_coord_lower),u_scale:new o.bG(w,l.u_scale),u_fade:new o.b5(w,l.u_fade),u_fill_translate:new o.bH(w,l.u_fill_translate)}),fillOutline:(w,l)=>({u_world:new o.bH(w,l.u_world),u_fill_translate:new o.bH(w,l.u_fill_translate)}),fillOutlinePattern:(w,l)=>({u_world:new o.bH(w,l.u_world),u_image:new o.bC(w,l.u_image),u_texsize:new o.bH(w,l.u_texsize),u_pixel_coord_upper:new o.bH(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(w,l.u_pixel_coord_lower),u_scale:new o.bG(w,l.u_scale),u_fade:new o.b5(w,l.u_fade),u_fill_translate:new o.bH(w,l.u_fill_translate)}),circle:(w,l)=>({u_camera_to_center_distance:new o.b5(w,l.u_camera_to_center_distance),u_scale_with_map:new o.bC(w,l.u_scale_with_map),u_pitch_with_map:new o.bC(w,l.u_pitch_with_map),u_extrude_scale:new o.bH(w,l.u_extrude_scale),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_globe_extrude_scale:new o.b5(w,l.u_globe_extrude_scale),u_translate:new o.bH(w,l.u_translate)}),collisionBox:(w,l)=>({u_pixel_extrude_scale:new o.bH(w,l.u_pixel_extrude_scale)}),collisionCircle:(w,l)=>({u_viewport_size:new o.bH(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new o.bF(w,l.u_color),u_overlay:new o.bC(w,l.u_overlay),u_overlay_scale:new o.b5(w,l.u_overlay_scale)}),depth:Ml,clippingMask:Ml,heatmap:(w,l)=>({u_extrude_scale:new o.b5(w,l.u_extrude_scale),u_intensity:new o.b5(w,l.u_intensity),u_globe_extrude_scale:new o.b5(w,l.u_globe_extrude_scale)}),heatmapTexture:(w,l)=>({u_matrix:new o.bD(w,l.u_matrix),u_world:new o.bH(w,l.u_world),u_image:new o.bC(w,l.u_image),u_color_ramp:new o.bC(w,l.u_color_ramp),u_opacity:new o.b5(w,l.u_opacity)}),hillshade:(w,l)=>({u_image:new o.bC(w,l.u_image),u_latrange:new o.bH(w,l.u_latrange),u_light:new o.bH(w,l.u_light),u_shadow:new o.bF(w,l.u_shadow),u_highlight:new o.bF(w,l.u_highlight),u_accent:new o.bF(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new o.bD(w,l.u_matrix),u_image:new o.bC(w,l.u_image),u_dimension:new o.bH(w,l.u_dimension),u_zoom:new o.b5(w,l.u_zoom),u_unpack:new o.bE(w,l.u_unpack)}),line:(w,l)=>({u_translation:new o.bH(w,l.u_translation),u_ratio:new o.b5(w,l.u_ratio),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_translation:new o.bH(w,l.u_translation),u_ratio:new o.b5(w,l.u_ratio),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(w,l.u_units_to_pixels),u_image:new o.bC(w,l.u_image),u_image_height:new o.b5(w,l.u_image_height)}),linePattern:(w,l)=>({u_translation:new o.bH(w,l.u_translation),u_texsize:new o.bH(w,l.u_texsize),u_ratio:new o.b5(w,l.u_ratio),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_image:new o.bC(w,l.u_image),u_units_to_pixels:new o.bH(w,l.u_units_to_pixels),u_scale:new o.bG(w,l.u_scale),u_fade:new o.b5(w,l.u_fade)}),lineSDF:(w,l)=>({u_translation:new o.bH(w,l.u_translation),u_ratio:new o.b5(w,l.u_ratio),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_units_to_pixels:new o.bH(w,l.u_units_to_pixels),u_patternscale_a:new o.bH(w,l.u_patternscale_a),u_patternscale_b:new o.bH(w,l.u_patternscale_b),u_sdfgamma:new o.b5(w,l.u_sdfgamma),u_image:new o.bC(w,l.u_image),u_tex_y_a:new o.b5(w,l.u_tex_y_a),u_tex_y_b:new o.b5(w,l.u_tex_y_b),u_mix:new o.b5(w,l.u_mix)}),raster:(w,l)=>({u_tl_parent:new o.bH(w,l.u_tl_parent),u_scale_parent:new o.b5(w,l.u_scale_parent),u_buffer_scale:new o.b5(w,l.u_buffer_scale),u_fade_t:new o.b5(w,l.u_fade_t),u_opacity:new o.b5(w,l.u_opacity),u_image0:new o.bC(w,l.u_image0),u_image1:new o.bC(w,l.u_image1),u_brightness_low:new o.b5(w,l.u_brightness_low),u_brightness_high:new o.b5(w,l.u_brightness_high),u_saturation_factor:new o.b5(w,l.u_saturation_factor),u_contrast_factor:new o.b5(w,l.u_contrast_factor),u_spin_weights:new o.bG(w,l.u_spin_weights),u_coords_top:new o.bE(w,l.u_coords_top),u_coords_bottom:new o.bE(w,l.u_coords_bottom)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new o.bC(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(w,l.u_is_size_feature_constant),u_size_t:new o.b5(w,l.u_size_t),u_size:new o.b5(w,l.u_size),u_camera_to_center_distance:new o.b5(w,l.u_camera_to_center_distance),u_pitch:new o.b5(w,l.u_pitch),u_rotate_symbol:new o.bC(w,l.u_rotate_symbol),u_aspect_ratio:new o.b5(w,l.u_aspect_ratio),u_fade_change:new o.b5(w,l.u_fade_change),u_label_plane_matrix:new o.bD(w,l.u_label_plane_matrix),u_coord_matrix:new o.bD(w,l.u_coord_matrix),u_is_text:new o.bC(w,l.u_is_text),u_pitch_with_map:new o.bC(w,l.u_pitch_with_map),u_is_along_line:new o.bC(w,l.u_is_along_line),u_is_variable_anchor:new o.bC(w,l.u_is_variable_anchor),u_texsize:new o.bH(w,l.u_texsize),u_texture:new o.bC(w,l.u_texture),u_translation:new o.bH(w,l.u_translation),u_pitched_scale:new o.b5(w,l.u_pitched_scale)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new o.bC(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(w,l.u_is_size_feature_constant),u_size_t:new o.b5(w,l.u_size_t),u_size:new o.b5(w,l.u_size),u_camera_to_center_distance:new o.b5(w,l.u_camera_to_center_distance),u_pitch:new o.b5(w,l.u_pitch),u_rotate_symbol:new o.bC(w,l.u_rotate_symbol),u_aspect_ratio:new o.b5(w,l.u_aspect_ratio),u_fade_change:new o.b5(w,l.u_fade_change),u_label_plane_matrix:new o.bD(w,l.u_label_plane_matrix),u_coord_matrix:new o.bD(w,l.u_coord_matrix),u_is_text:new o.bC(w,l.u_is_text),u_pitch_with_map:new o.bC(w,l.u_pitch_with_map),u_is_along_line:new o.bC(w,l.u_is_along_line),u_is_variable_anchor:new o.bC(w,l.u_is_variable_anchor),u_texsize:new o.bH(w,l.u_texsize),u_texture:new o.bC(w,l.u_texture),u_gamma_scale:new o.b5(w,l.u_gamma_scale),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_is_halo:new o.bC(w,l.u_is_halo),u_translation:new o.bH(w,l.u_translation),u_pitched_scale:new o.b5(w,l.u_pitched_scale)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new o.bC(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(w,l.u_is_size_feature_constant),u_size_t:new o.b5(w,l.u_size_t),u_size:new o.b5(w,l.u_size),u_camera_to_center_distance:new o.b5(w,l.u_camera_to_center_distance),u_pitch:new o.b5(w,l.u_pitch),u_rotate_symbol:new o.bC(w,l.u_rotate_symbol),u_aspect_ratio:new o.b5(w,l.u_aspect_ratio),u_fade_change:new o.b5(w,l.u_fade_change),u_label_plane_matrix:new o.bD(w,l.u_label_plane_matrix),u_coord_matrix:new o.bD(w,l.u_coord_matrix),u_is_text:new o.bC(w,l.u_is_text),u_pitch_with_map:new o.bC(w,l.u_pitch_with_map),u_is_along_line:new o.bC(w,l.u_is_along_line),u_is_variable_anchor:new o.bC(w,l.u_is_variable_anchor),u_texsize:new o.bH(w,l.u_texsize),u_texsize_icon:new o.bH(w,l.u_texsize_icon),u_texture:new o.bC(w,l.u_texture),u_texture_icon:new o.bC(w,l.u_texture_icon),u_gamma_scale:new o.b5(w,l.u_gamma_scale),u_device_pixel_ratio:new o.b5(w,l.u_device_pixel_ratio),u_is_halo:new o.bC(w,l.u_is_halo),u_translation:new o.bH(w,l.u_translation),u_pitched_scale:new o.b5(w,l.u_pitched_scale)}),background:(w,l)=>({u_opacity:new o.b5(w,l.u_opacity),u_color:new o.bF(w,l.u_color)}),backgroundPattern:(w,l)=>({u_opacity:new o.b5(w,l.u_opacity),u_image:new o.bC(w,l.u_image),u_pattern_tl_a:new o.bH(w,l.u_pattern_tl_a),u_pattern_br_a:new o.bH(w,l.u_pattern_br_a),u_pattern_tl_b:new o.bH(w,l.u_pattern_tl_b),u_pattern_br_b:new o.bH(w,l.u_pattern_br_b),u_texsize:new o.bH(w,l.u_texsize),u_mix:new o.b5(w,l.u_mix),u_pattern_size_a:new o.bH(w,l.u_pattern_size_a),u_pattern_size_b:new o.bH(w,l.u_pattern_size_b),u_scale_a:new o.b5(w,l.u_scale_a),u_scale_b:new o.b5(w,l.u_scale_b),u_pixel_coord_upper:new o.bH(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.b5(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_texture:new o.bC(w,l.u_texture),u_ele_delta:new o.b5(w,l.u_ele_delta),u_fog_matrix:new o.bD(w,l.u_fog_matrix),u_fog_color:new o.bF(w,l.u_fog_color),u_fog_ground_blend:new o.b5(w,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.b5(w,l.u_fog_ground_blend_opacity),u_horizon_color:new o.bF(w,l.u_horizon_color),u_horizon_fog_blend:new o.b5(w,l.u_horizon_fog_blend),u_is_globe_mode:new o.b5(w,l.u_is_globe_mode)}),terrainDepth:(w,l)=>({u_ele_delta:new o.b5(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_texture:new o.bC(w,l.u_texture),u_terrain_coords_id:new o.b5(w,l.u_terrain_coords_id),u_ele_delta:new o.b5(w,l.u_ele_delta)}),projectionErrorMeasurement:(w,l)=>({u_input:new o.b5(w,l.u_input),u_output_expected:new o.b5(w,l.u_output_expected)}),atmosphere:(w,l)=>({u_sun_pos:new o.bG(w,l.u_sun_pos),u_atmosphere_blend:new o.b5(w,l.u_atmosphere_blend),u_globe_position:new o.bG(w,l.u_globe_position),u_globe_radius:new o.b5(w,l.u_globe_radius),u_inv_proj_matrix:new o.bD(w,l.u_inv_proj_matrix)}),sky:(w,l)=>({u_sky_color:new o.bF(w,l.u_sky_color),u_horizon_color:new o.bF(w,l.u_horizon_color),u_horizon:new o.bH(w,l.u_horizon),u_horizon_normal:new o.bH(w,l.u_horizon_normal),u_sky_horizon_blend:new o.b5(w,l.u_sky_horizon_blend),u_sky_blend:new o.b5(w,l.u_sky_blend)})};class eo{constructor(l,u,g){this.context=l;const y=l.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hu{constructor(l,u,g,y){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.context=l;const B=l.gl;this.buffer=B.createBuffer(),l.bindVertexBuffer.set(this.buffer),B.bufferData(B.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,u){for(let g=0;g<this.attributes.length;g++){const y=u.attributes[this.attributes[g].name];y!==void 0&&l.enableVertexAttribArray(y)}}setVertexAttribPointers(l,u,g){for(let y=0;y<this.attributes.length;y++){const B=this.attributes[y],S=u.attributes[B.name];S!==void 0&&l.vertexAttribPointer(S,B.components,l[Fl[B.type]],!1,this.itemSize,B.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ya extends kn{getDefault(){return o.b4.transparent}set(l){const u=this.current;(l.r!==u.r||l.g!==u.g||l.b!==u.b||l.a!==u.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ju extends kn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class QA extends kn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Hh extends kn{getDefault(){return[!0,!0,!0,!0]}set(l){const u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||l[3]!==u[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class cc extends kn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class uc extends kn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Gs extends kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const u=this.current;(l.func!==u.func||l.ref!==u.ref||l.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ws extends kn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ka extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;l?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=l,this.dirty=!1}}class Qa extends kn{getDefault(){return[0,1]}set(l){const u=this.current;(l[0]!==u[0]||l[1]!==u[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class po extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;l?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=l,this.dirty=!1}}class za extends kn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class is extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;l?u.enable(u.BLEND):u.disable(u.BLEND),this.current=l,this.dirty=!1}}class ji extends kn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const u=this.current;(l[0]!==u[0]||l[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class th extends kn{getDefault(){return o.b4.transparent}set(l){const u=this.current;(l.r!==u.r||l.g!==u.g||l.b!==u.b||l.a!==u.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class js extends kn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class xs extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;l?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=l,this.dirty=!1}}class Ll extends kn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Au extends kn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Rl extends kn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class ll extends kn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class hc extends kn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const u=this.current;(l[0]!==u[0]||l[1]!==u[1]||l[2]!==u[2]||l[3]!==u[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Xo extends kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class _a extends kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class du extends kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Ol extends kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class yn extends kn{getDefault(){return null}set(l){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ac extends kn{getDefault(){return null}set(l){var u;if(l===this.current&&!this.dirty)return;const g=this.gl;Qs(g)?g.bindVertexArray(l):(u=g.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class va extends kn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Zo extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Zn extends kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class ui extends kn{constructor(l,u){super(l),this.context=l,this.parent=u}getDefault(){return null}}class Zi extends ui{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class ss extends ui{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ul extends ui{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const dc="Framebuffer is not complete";class Dl{constructor(l,u,g,y,B){this.context=l,this.width=u,this.height=g;const S=l.gl,L=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Zi(l,L),y)this.depthAttachment=B?new Ul(l,L):new ss(l,L);else if(B)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error(dc)}destroy(){const l=this.context.gl,u=this.colorAttachment.get();if(u&&l.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&l.deleteRenderbuffer(g)}l.deleteFramebuffer(this.framebuffer)}}class fu{constructor(l){var u,g;if(this.gl=l,this.clearColor=new ya(this),this.clearDepth=new Ju(this),this.clearStencil=new QA(this),this.colorMask=new Hh(this),this.depthMask=new cc(this),this.stencilMask=new uc(this),this.stencilFunc=new Gs(this),this.stencilOp=new ws(this),this.stencilTest=new ka(this),this.depthRange=new Qa(this),this.depthTest=new po(this),this.depthFunc=new za(this),this.blend=new is(this),this.blendFunc=new ji(this),this.blendColor=new th(this),this.blendEquation=new js(this),this.cullFace=new xs(this),this.cullFaceSide=new Ll(this),this.frontFace=new Au(this),this.program=new Rl(this),this.activeTexture=new ll(this),this.viewport=new hc(this),this.bindFramebuffer=new Xo(this),this.bindRenderbuffer=new _a(this),this.bindTexture=new du(this),this.bindVertexBuffer=new Ol(this),this.bindElementBuffer=new yn(this),this.bindVertexArray=new Ac(this),this.pixelStoreUnpack=new va(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Zn(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Qs(l)){this.HALF_FLOAT=l.HALF_FLOAT;const y=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=l.RGBA16F)!==null&&u!==void 0?u:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(g=l.RGB16F)!==null&&g!==void 0?g:y==null?void 0:y.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const y=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,u){return new eo(this,l,u)}createVertexBuffer(l,u,g){return new hu(this,l,u,g)}createRenderbuffer(l,u,g){const y=this.gl,B=y.createRenderbuffer();return this.bindRenderbuffer.set(B),y.renderbufferStorage(y.RENDERBUFFER,l,u,g),this.bindRenderbuffer.set(null),B}createFramebuffer(l,u,g,y){return new Dl(this,l,u,g,y)}clear(l){let{color:u,depth:g,stencil:y}=l;const B=this.gl;let S=0;u&&(S|=B.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(S|=B.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),y!==void 0&&(S|=B.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),B.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.bz(l.blendFunction,ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Qs(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var u;return Qs(this.gl)?this.gl.deleteVertexArray(l):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let fc;function pu(w,l,u,g,y){const B=w.context,S=w.transform,L=B.gl,O=w.useProgram("collisionBox"),Q=[];let q=0,Z=0;for(let Ot=0;Ot<g.length;Ot++){const kt=g[Ot],qt=l.getTile(kt).getBucket(u);if(!qt)continue;const $t=y?qt.textCollisionBox:qt.iconCollisionBox,Jt=qt.collisionCircleArray;Jt.length>0&&(Q.push({circleArray:Jt,circleOffset:Z,coord:kt}),q+=Jt.length/4,Z=q),$t&&O.draw(B,L.LINES,ln.disabled,Sn.disabled,w.colorModeForRenderPass(),vn.disabled,fn(w.transform),w.style.map.terrain&&w.style.map.terrain.getTerrainData(kt),S.getProjectionData({overscaledTileID:kt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,$t.layoutVertexBuffer,$t.indexBuffer,$t.segments,null,w.transform.zoom,null,null,$t.collisionVertexBuffer)}if(!y||!Q.length)return;const J=w.useProgram("collisionCircle"),At=new o.bM;At.resize(4*q),At._trim();let gt=0;for(const Ot of Q)for(let kt=0;kt<Ot.circleArray.length/4;kt++){const qt=4*kt,$t=Ot.circleArray[qt+0],Jt=Ot.circleArray[qt+1],ne=Ot.circleArray[qt+2],se=Ot.circleArray[qt+3];At.emplace(gt++,$t,Jt,ne,se,0),At.emplace(gt++,$t,Jt,ne,se,1),At.emplace(gt++,$t,Jt,ne,se,2),At.emplace(gt++,$t,Jt,ne,se,3)}(!fc||fc.length<2*q)&&(fc=function(Ot){const kt=2*Ot,qt=new o.bO;qt.resize(kt),qt._trim();for(let $t=0;$t<kt;$t++){const Jt=6*$t;qt.uint16[Jt+0]=4*$t+0,qt.uint16[Jt+1]=4*$t+1,qt.uint16[Jt+2]=4*$t+2,qt.uint16[Jt+3]=4*$t+2,qt.uint16[Jt+4]=4*$t+3,qt.uint16[Jt+5]=4*$t+0}return qt}(q));const Lt=B.createIndexBuffer(fc,!0),Ft=B.createVertexBuffer(At,o.bN.members,!0);for(const Ot of Q){const kt=An(w.transform);J.draw(B,L.TRIANGLES,ln.disabled,Sn.disabled,w.colorModeForRenderPass(),vn.disabled,kt,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ot.coord),null,u.id,Ft,Lt,o.aD.simpleSegment(0,2*Ot.circleOffset,Ot.circleArray.length,Ot.circleArray.length/2),null,w.transform.zoom,null,null,null)}Ft.destroy(),Lt.destroy()}const Do=o.aq(new Float32Array(16));function go(w,l,u,g,y,B){const{horizontalAlign:S,verticalAlign:L}=o.ay(w);return new o.P((-(S-.5)*l/y+g[0])*B,(-(L-.5)*u/y+g[1])*B)}function gu(w,l,u,g,y,B){const S=l.tileAnchorPoint.add(new o.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let L=g.mult(B);u||(L=L.rotate(-y));const O=S.add(L);return ve(O.x,O.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(u){const L=_r(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(w),O=Math.atan(L.y/L.x)+(L.x<0?Math.PI:0);return w.add(g.rotate(O))}return w.add(g)}function eh(w,l,u,g,y,B,S,L,O,Q,q,Z){const J=w.text.placedSymbolArray,At=w.text.dynamicLayoutVertexArray,gt=w.icon.dynamicLayoutVertexArray,Lt={};At.clear();for(let Ft=0;Ft<J.length;Ft++){const Ot=J.get(Ft),kt=Ot.hidden||!Ot.crossTileID||w.allowVerticalPlacement&&!Ot.placedOrientation?null:g[Ot.crossTileID];if(kt){const qt=new o.P(Ot.anchorX,Ot.anchorY),$t={getElevation:Z,width:y.width,height:y.height,pitchedLabelPlaneMatrix:B,lineVertexArray:null,pitchWithMap:u,transform:y,projectionCache:null,tileAnchorPoint:qt,translation:Q,unwrappedTileID:q},Jt=u?Yr(qt.x,qt.y,$t):_r(qt.x,qt.y,$t),ne=me(y.cameraToCenterDistance,Jt.signedDistanceFromCamera);let se=o.aj(w.textSizeData,L,Ot)*ne/o.as;u&&(se*=w.tilePixelRatio/S);const{width:Te,height:Ce,anchor:Oe,textOffset:ze,textBoxScale:Le}=kt,fr=go(Oe,Te,Ce,ze,Le,se),Ar=y.getPitchedTextCorrection(qt.x+Q[0],qt.y+Q[1],q),Ke=gu(Jt.point,$t,l,fr,-y.bearingInRadians,Ar),br=w.allowVerticalPlacement&&Ot.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let sn=0;sn<Ot.numGlyphs;sn++)o.ak(At,Ke,br);O&&Ot.associatedIconIndex>=0&&(Lt[Ot.associatedIconIndex]={shiftedAnchor:Ke,angle:br})}else mn(Ot.numGlyphs,At)}if(O){gt.clear();const Ft=w.icon.placedSymbolArray;for(let Ot=0;Ot<Ft.length;Ot++){const kt=Ft.get(Ot);if(kt.hidden)mn(kt.numGlyphs,gt);else{const qt=Lt[Ot];if(qt)for(let $t=0;$t<kt.numGlyphs;$t++)o.ak(gt,qt.shiftedAnchor,qt.angle);else mn(kt.numGlyphs,gt)}}w.icon.dynamicLayoutVertexBuffer.updateData(gt)}w.text.dynamicLayoutVertexBuffer.updateData(At)}function Ap(w,l,u){return u.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function mu(w,l,u,g,y,B,S,L,O,Q,q,Z,J){const At=w.context,gt=At.gl,Lt=w.transform,Ft=L==="map",Ot=O==="map",kt=L!=="viewport"&&u.layout.get("symbol-placement")!=="point",qt=Ft&&!Ot&&!kt,$t=!u.layout.get("symbol-sort-key").isConstant();let Jt=!1;const ne=w.getDepthModeForSublayer(0,ln.ReadOnly),se=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Ce=Lt.getCircleRadiusCorrection();for(const Oe of g){const ze=l.getTile(Oe),Le=ze.getBucket(u);if(!Le)continue;const fr=y?Le.text:Le.icon;if(!fr||!fr.segments.get().length||!fr.hasVisibleVertices)continue;const Ar=fr.programConfigurations.get(u.id),Ke=y||Le.sdfIcons,br=y?Le.textSizeData:Le.iconSizeData,sn=Ot||Lt.pitch!==0,Mn=w.useProgram(Ap(Ke,y,Le),Ar),vi=o.ah(br,Lt.zoom),oi=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Oe);let bi,zn,Jn,ti,qs=[0,0],ts=null;if(y)zn=ze.glyphAtlasTexture,Jn=gt.LINEAR,bi=ze.glyphAtlasTexture.size,Le.iconsInText&&(qs=ze.imageAtlasTexture.size,ts=ze.imageAtlasTexture,ti=sn||w.options.rotating||w.options.zooming||br.kind==="composite"||br.kind==="camera"?gt.LINEAR:gt.NEAREST);else{const fi=u.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear;zn=ze.imageAtlasTexture,Jn=Ke||w.options.rotating||w.options.zooming||fi||sn?gt.LINEAR:gt.NEAREST,bi=ze.imageAtlasTexture.size}const as=o.at(ze,1,w.transform.zoom),hs=ge(Ft,w.transform,as),Va=o.H();o.an(Va,hs);const ta=te(Ot,Ft,w.transform,as),es=o.au(Lt,ze,B,S),so=Lt.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),xa=se&&Le.hasTextData(),_c=u.layout.get("icon-text-fit")!=="none"&&xa&&Le.hasIconData();if(kt){const fi=w.style.map.terrain?(Ga,Ki)=>w.style.map.terrain.getElevation(Oe,Ga,Ki):null,Ni=u.layout.get("text-rotation-alignment")==="map";ur(Le,w,y,hs,Va,Ot,Q,Ni,Oe.toUnwrapped(),Lt.width,Lt.height,es,fi)}const vc=y&&se||_c,yo=kt||vc?Do:Ot?hs:w.transform.clipSpaceToPixelsMatrix,Ba=Ke&&u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ko;ko=Ke?Le.iconsInText?Ei(br.kind,vi,qt,Ot,kt,vc,w,yo,ta,es,bi,qs,Ce):al(br.kind,vi,qt,Ot,kt,vc,w,yo,ta,es,y,bi,0,Ce):uu(br.kind,vi,qt,Ot,kt,vc,w,yo,ta,es,y,bi,Ce);const _o={program:Mn,buffers:fr,uniformValues:ko,projectionData:so,atlasTexture:zn,atlasTextureIcon:ts,atlasInterpolation:Jn,atlasInterpolationIcon:ti,isSDF:Ke,hasHalo:Ba};if($t&&Le.canOverlap){Jt=!0;const fi=fr.segments.get();for(const Ni of fi)Te.push({segments:new o.aD([Ni]),sortKey:Ni.sortKey,state:_o,terrainData:oi})}else Te.push({segments:fr.segments,sortKey:0,state:_o,terrainData:oi})}Jt&&Te.sort((Oe,ze)=>Oe.sortKey-ze.sortKey);for(const Oe of Te){const ze=Oe.state;if(At.activeTexture.set(gt.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,gt.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(At.activeTexture.set(gt.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,gt.CLAMP_TO_EDGE)),ze.isSDF){const Le=ze.uniformValues;ze.hasHalo&&(Le.u_is_halo=1,Vh(ze.buffers,Oe.segments,u,w,ze.program,ne,q,Z,Le,ze.projectionData,Oe.terrainData)),Le.u_is_halo=0}Vh(ze.buffers,Oe.segments,u,w,ze.program,ne,q,Z,ze.uniformValues,ze.projectionData,Oe.terrainData)}}function Vh(w,l,u,g,y,B,S,L,O,Q,q){const Z=g.context;y.draw(Z,Z.gl.TRIANGLES,B,S,L,vn.backCCW,O,q,Q,u.id,w.layoutVertexBuffer,w.indexBuffer,l,u.paint,g.transform.zoom,w.programConfigurations.get(u.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function zA(w,l,u,g,y){const B=w.context,S=B.gl,L=Sn.disabled,O=new ii([S.ONE,S.ONE],o.b4.transparent,[!0,!0,!0,!0]),Q=l.getBucket(u);if(!Q)return;const q=g.key;let Z=u.heatmapFbos.get(q);Z||(Z=rh(B,l.tileSize,l.tileSize),u.heatmapFbos.set(q,Z)),B.bindFramebuffer.set(Z.framebuffer),B.viewport.set([0,0,l.tileSize,l.tileSize]),B.clear({color:o.b4.transparent});const J=Q.programConfigurations.get(u.id),At=w.useProgram("heatmap",J,!y),gt=w.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Lt=w.style.map.terrain.getTerrainData(g);At.draw(B,S.TRIANGLES,ln.disabled,L,O,vn.disabled,Ci(l,w.transform.zoom,u.paint.get("heatmap-intensity"),1),Lt,gt,u.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,u.paint,w.transform.zoom,J)}function Gh(w,l,u,g,y){const B=w.context,S=B.gl,L=w.transform;B.setColorMode(w.colorModeForRenderPass());const O=jh(B,l),Q=u.key,q=l.heatmapFbos.get(Q);if(!q)return;B.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,q.colorAttachment.get()),B.activeTexture.set(S.TEXTURE1),O.bind(S.LINEAR,S.CLAMP_TO_EDGE);const Z=L.getProjectionData({overscaledTileID:u,applyTerrainMatrix:y,applyGlobeMatrix:!g});w.useProgram("heatmapTexture").draw(B,S.TRIANGLES,ln.disabled,Sn.disabled,w.colorModeForRenderPass(),vn.disabled,ci(w,l,0,1),null,Z,l.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,l.paint,L.zoom),q.destroy(),l.heatmapFbos.delete(Q)}function rh(w,l,u){var g,y;const B=w.gl,S=B.createTexture();B.bindTexture(B.TEXTURE_2D,S),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);const L=(g=w.HALF_FLOAT)!==null&&g!==void 0?g:B.UNSIGNED_BYTE,O=(y=w.RGBA16F)!==null&&y!==void 0?y:B.RGBA;B.texImage2D(B.TEXTURE_2D,0,O,l,u,0,B.RGBA,L,null);const Q=w.createFramebuffer(l,u,!1,!1);return Q.colorAttachment.set(S),Q}function jh(w,l){return l.colorRampTexture||(l.colorRampTexture=new nt(w,l.colorRamp,w.gl.RGBA)),l.colorRampTexture}function nh(w,l,u,g,y){if(!u||!g||!g.imageAtlas)return;const B=g.imageAtlas.patternPositions;let S=B[u.to.toString()],L=B[u.from.toString()];if(!S&&L&&(S=L),!L&&S&&(L=S),!S||!L){const O=y.getPaintProperty(l);S=B[O],L=B[O]}S&&L&&w.setConstantPatternPositions(S,L)}function yu(w,l,u,g,y,B,S,L){const O=w.context.gl,Q="fill-pattern",q=u.paint.get(Q),Z=q&&q.constantOr(1),J=u.getCrossfadeParameters();let At,gt,Lt,Ft,Ot;const kt=w.transform,qt=u.paint.get("fill-translate"),$t=u.paint.get("fill-translate-anchor");S?(gt=Z&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",At=O.LINES):(gt=Z?"fillPattern":"fill",At=O.TRIANGLES);const Jt=q.constantOr(null);for(const ne of g){const se=l.getTile(ne);if(Z&&!se.patternsLoaded())continue;const Te=se.getBucket(u);if(!Te)continue;const Ce=Te.programConfigurations.get(u.id),Oe=w.useProgram(gt,Ce),ze=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ne);Z&&(w.context.activeTexture.set(O.TEXTURE0),se.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ce.updatePaintBuffers(J)),nh(Ce,Q,Jt,se,u);const Le=kt.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),fr=o.au(kt,se,qt,$t);if(S){Ft=Te.indexBuffer2,Ot=Te.segments2;const Ke=[O.drawingBufferWidth,O.drawingBufferHeight];Lt=gt==="fillOutlinePattern"&&Z?Rr(w,J,se,Ke,fr):hr(Ke,fr)}else Ft=Te.indexBuffer,Ot=Te.segments,Lt=Z?Qe(w,J,se,fr):{u_fill_translate:fr};let Ar;if(w.renderPass==="translucent"&&L){const[Ke]=w.getStencilConfigForOverlapAndUpdateStencilID(g);Ar=Ke[ne.overscaledZ]}else Ar=w.stencilModeForClipping(ne);Oe.draw(w.context,At,y,Ar,B,vn.backCCW,Lt,ze,Le,u.id,Te.layoutVertexBuffer,Ft,Ot,u.paint,w.transform.zoom,Ce)}}function qh(w,l,u,g,y,B,S,L){const O=w.context,Q=O.gl,q="fill-extrusion-pattern",Z=u.paint.get(q),J=Z.constantOr(1),At=u.getCrossfadeParameters(),gt=u.paint.get("fill-extrusion-opacity"),Lt=Z.constantOr(null),Ft=w.transform;for(const Ot of g){const kt=l.getTile(Ot),qt=kt.getBucket(u);if(!qt)continue;const $t=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ot),Jt=qt.programConfigurations.get(u.id),ne=w.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Jt);J&&(w.context.activeTexture.set(Q.TEXTURE0),kt.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Jt.updatePaintBuffers(At));const se=Ft.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!L,applyTerrainMatrix:!0});nh(Jt,q,Lt,kt,u);const Te=o.au(Ft,kt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ce=u.paint.get("fill-extrusion-vertical-gradient"),Oe=J?Be(w,Ce,gt,Te,Ot,At,kt):ie(w,Ce,gt,Te);ne.draw(O,O.gl.TRIANGLES,y,B,S,vn.backCCW,Oe,$t,se,u.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,u.paint,w.transform.zoom,Jt,w.style.map.terrain&&qt.centroidVertexBuffer)}}function zd(w,l,u,g,y,B,S,L,O){var Q;const q=w.style.projection,Z=w.context,J=w.transform,At=Z.gl,gt=w.useProgram("hillshade"),Lt=!w.options.moving;for(const Ft of g){const Ot=l.getTile(Ft),kt=Ot.fbo;if(!kt)continue;const qt=q.getMeshFromTileID(Z,Ft.canonical,L,!0,"raster"),$t=(Q=w.style.map.terrain)===null||Q===void 0?void 0:Q.getTerrainData(Ft);Z.activeTexture.set(At.TEXTURE0),At.bindTexture(At.TEXTURE_2D,kt.colorAttachment.get());const Jt=J.getProjectionData({overscaledTileID:Ft,aligned:Lt,applyGlobeMatrix:!O,applyTerrainMatrix:!0});gt.draw(Z,At.TRIANGLES,B,y[Ft.overscaledZ],S,vn.backCCW,Xi(w,Ot,u),$t,Jt,u.id,qt.vertexBuffer,qt.indexBuffer,qt.segments)}}const Kh=[new o.P(0,0),new o.P(o.X,0),new o.P(o.X,o.X),new o.P(0,o.X)];function Ti(w,l,u,g,y,B,S,L){let O=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,Q=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1;const q=g[g.length-1].overscaledZ,Z=w.context,J=Z.gl,At=w.useProgram("raster"),gt=w.transform,Lt=w.style.projection,Ft=w.colorModeForRenderPass(),Ot=!w.options.moving;for(const kt of g){const qt=w.getDepthModeForSublayer(kt.overscaledZ-q,u.paint.get("raster-opacity")===1?ln.ReadWrite:ln.ReadOnly,J.LESS),$t=l.getTile(kt);$t.registerFadeDuration(u.paint.get("raster-fade-duration"));const Jt=l.findLoadedParent(kt,0),ne=l.findLoadedSibling(kt),se=_u($t,Jt||ne||null,l,u,w.transform,w.style.map.terrain);let Te,Ce;const Oe=u.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR;Z.activeTexture.set(J.TEXTURE0),$t.texture.bind(Oe,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(J.TEXTURE1),Jt?(Jt.texture.bind(Oe,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),Te=Math.pow(2,Jt.tileID.overscaledZ-$t.tileID.overscaledZ),Ce=[$t.tileID.canonical.x*Te%1,$t.tileID.canonical.y*Te%1]):$t.texture.bind(Oe,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),$t.texture.useMipmap&&Z.extTextureFilterAnisotropic&&w.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const ze=w.style.map.terrain&&w.style.map.terrain.getTerrainData(kt),Le=gt.getProjectionData({overscaledTileID:kt,aligned:Ot,applyGlobeMatrix:!Q,applyTerrainMatrix:!0}),fr=lu(Ce||[0,0],Te||1,se,u,L),Ar=Lt.getMeshFromTileID(Z,kt.canonical,B,S,"raster");At.draw(Z,J.TRIANGLES,qt,y?y[kt.overscaledZ]:Sn.disabled,Ft,O?vn.frontCCW:vn.backCCW,fr,ze,Le,u.id,Ar.vertexBuffer,Ar.indexBuffer,Ar.segments)}}function _u(w,l,u,g,y,B){const S=g.paint.get("raster-fade-duration");if(!B&&S>0){const L=C.now(),O=(L-w.timeAdded)/S,Q=l?(L-l.timeAdded)/S:-1,q=u.getSource(),Z=Xn(y,{tileSize:q.tileSize,roundZoom:q.roundZoom}),J=!l||Math.abs(l.tileID.overscaledZ-Z)>Math.abs(w.tileID.overscaledZ-Z),At=J&&w.refreshedUponExpiration?1:o.ab(J?O:1-Q,0,1);return w.refreshedUponExpiration&&O>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-At}:{opacity:At,mix:0}}return{opacity:1,mix:0}}const ba=new o.b4(1,0,0,1),Hd=new o.b4(0,1,0,1),Vd=new o.b4(0,0,1,1),HA=new o.b4(1,0,1,1),pc=new o.b4(0,1,1,1);function cl(w,l,u,g){Wh(w,0,l+u/2,w.transform.width,u,g)}function VA(w,l,u,g){Wh(w,l-u/2,0,u,w.transform.height,g)}function Wh(w,l,u,g,y,B){const S=w.context,L=S.gl;L.enable(L.SCISSOR_TEST),L.scissor(l*w.pixelRatio,u*w.pixelRatio,g*w.pixelRatio,y*w.pixelRatio),S.clear({color:B}),L.disable(L.SCISSOR_TEST)}function Gd(w,l,u){const g=w.context,y=g.gl,B=w.useProgram("debug"),S=ln.disabled,L=Sn.disabled,O=w.colorModeForRenderPass(),Q="$debug",q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(u);g.activeTexture.set(y.TEXTURE0);const Z=l.getTileByID(u.key).latestRawTileData,J=Math.floor((Z&&Z.byteLength||0)/1024),At=l.getTile(u).tileSize,gt=512/Math.min(At,512)*(u.overscaledZ/w.transform.zoom)*.5;let Lt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Lt+=` => ${u.overscaledZ}`),function(Ot,kt){Ot.initDebugOverlayCanvas();const qt=Ot.debugOverlayCanvas,$t=Ot.context.gl,Jt=Ot.debugOverlayCanvas.getContext("2d");Jt.clearRect(0,0,qt.width,qt.height),Jt.shadowColor="white",Jt.shadowBlur=2,Jt.lineWidth=1.5,Jt.strokeStyle="white",Jt.textBaseline="top",Jt.font="bold 36px Open Sans, sans-serif",Jt.fillText(kt,5,5),Jt.strokeText(kt,5,5),Ot.debugOverlayTexture.update(qt),Ot.debugOverlayTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE)}(w,`${Lt} ${J}kB`);const Ft=w.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(g,y.TRIANGLES,S,L,ii.alphaBlended,vn.disabled,Rn(o.b4.transparent,gt),null,Ft,Q,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),B.draw(g,y.LINE_STRIP,S,L,O,vn.disabled,Rn(o.b4.red),q,Ft,Q,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function jd(w,l,u,g){const{isRenderingGlobe:y}=g,B=w.context,S=B.gl,L=w.transform,O=w.colorModeForRenderPass(),Q=w.getDepthModeFor3D(),q=w.useProgram("terrain");B.bindFramebuffer.set(null),B.viewport.set([0,0,w.width,w.height]);for(const Z of u){const J=l.getTerrainMesh(Z.tileID),At=w.renderToTexture.getTexture(Z),gt=l.getTerrainData(Z.tileID);B.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,At.texture);const Lt=l.getMeshFrameDelta(L.zoom),Ft=L.calculateFogMatrix(Z.tileID.toUnwrapped()),Ot=ma(Lt,Ft,w.style.sky,L.pitch,y),kt=L.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(B,S.TRIANGLES,Q,Sn.disabled,O,vn.backCCW,Ot,gt,kt,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}}function qd(w,l){if(!l.mesh){const u=new o.aC;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const g=new o.aE;g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),l.mesh=new ks(w.createVertexBuffer(u,cn.members),w.createIndexBuffer(g),o.aD.simpleSegment(0,0,u.length,g.length))}return l.mesh}class dp{constructor(l,u){this.context=new fu(l),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ct.maxUnderzooming+ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vi}resize(l,u,g){if(this.width=Math.floor(l*g),this.height=Math.floor(u*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const l=this.context,u=new o.aC;u.emplaceBack(0,0),u.emplaceBack(o.X,0),u.emplaceBack(0,o.X),u.emplaceBack(o.X,o.X),this.tileExtentBuffer=l.createVertexBuffer(u,cn.members),this.tileExtentSegments=o.aD.simpleSegment(0,0,4,2);const g=new o.aC;g.emplaceBack(0,0),g.emplaceBack(o.X,0),g.emplaceBack(0,o.X),g.emplaceBack(o.X,o.X),this.debugBuffer=l.createVertexBuffer(g,cn.members),this.debugSegments=o.aD.simpleSegment(0,0,4,5);const y=new o.bT;y.emplaceBack(0,0,0,0),y.emplaceBack(o.X,0,o.X,0),y.emplaceBack(0,o.X,0,o.X),y.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=l.createVertexBuffer(y,iu.members),this.rasterBoundsSegments=o.aD.simpleSegment(0,0,4,2);const B=new o.aC;B.emplaceBack(0,0),B.emplaceBack(o.X,0),B.emplaceBack(0,o.X),B.emplaceBack(o.X,o.X),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(B,cn.members),this.rasterBoundsSegmentsPosOnly=o.aD.simpleSegment(0,0,4,5);const S=new o.aC;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(S,cn.members),this.viewportSegments=o.aD.simpleSegment(0,0,4,2);const L=new o.bU;L.emplaceBack(0),L.emplaceBack(1),L.emplaceBack(3),L.emplaceBack(2),L.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(L);const O=new o.aE;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const Q=this.context.gl;this.stencilClearMode=new Sn({func:Q.ALWAYS,mask:0},0,255,Q.ZERO,Q.ZERO,Q.ZERO),this.tileExtentMesh=new ks(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,u=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=o.H();o.bL(g,0,this.width,this.height,0,0,1),o.K(g,g,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const y={mainMatrix:g,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g};this.useProgram("clippingMask",null,!0).draw(l,u.TRIANGLES,ln.disabled,this.stencilClearMode,ii.disabled,vn.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,u,g){if(this.currentStencilSource===l.source||!l.isTileClipped()||!u||!u.length)return;this.currentStencilSource=l.source,this.nextStencilID+u.length>256&&this.clearStencil();const y=this.context;y.setColorMode(ii.disabled),y.setDepthMode(ln.disabled);const B={};for(const S of u)B[S.key]=this.nextStencilID++;this._renderTileMasks(B,u,g,!0),this._renderTileMasks(B,u,g,!1),this._tileClippingMaskIDs=B}_renderTileMasks(l,u,g,y){const B=this.context,S=B.gl,L=this.style.projection,O=this.transform,Q=this.useProgram("clippingMask");for(const q of u){const Z=l[q.key],J=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q),At=L.getMeshFromTileID(this.context,q.canonical,y,!0,"stencil"),gt=O.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!0,applyTerrainMatrix:!0});Q.draw(B,S.TRIANGLES,ln.disabled,new Sn({func:S.ALWAYS,mask:0},Z,255,S.KEEP,S.KEEP,S.REPLACE),ii.disabled,g?vn.disabled:vn.backCCW,null,J,gt,"$clipping",At.vertexBuffer,At.indexBuffer,At.segments)}}_renderTilesDepthBuffer(){const l=this.context,u=l.gl,g=this.style.projection,y=this.transform,B=this.useProgram("depth"),S=this.getDepthModeFor3D(),L=Bt(y,{tileSize:y.tileSize});for(const O of L){const Q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),q=g.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),Z=y.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(l,u.TRIANGLES,S,Sn.disabled,ii.disabled,vn.backCCW,null,Q,Z,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,u=this.context.gl;return new Sn({func:u.NOTEQUAL,mask:255},l,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(l){const u=this.context.gl;return new Sn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const u=this.context.gl,g=l.sort((S,L)=>L.overscaledZ-S.overscaledZ),y=g[g.length-1].overscaledZ,B=g[0].overscaledZ-y+1;if(B>1){this.currentStencilSource=void 0,this.nextStencilID+B>256&&this.clearStencil();const S={};for(let L=0;L<B;L++)S[L+y]=new Sn({func:u.GEQUAL,mask:255},L+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=B,[S,g]}return[{[y]:Sn.disabled},g]}stencilConfigForOverlapTwoPass(l){const u=this.context.gl,g=l.sort((S,L)=>L.overscaledZ-S.overscaledZ),y=g[g.length-1].overscaledZ,B=g[0].overscaledZ-y+1;if(this.clearStencil(),B>1){const S={},L={};for(let O=0;O<B;O++)S[O+y]=new Sn({func:u.GREATER,mask:255},B+1+O,255,u.KEEP,u.KEEP,u.REPLACE),L[O+y]=new Sn({func:u.GREATER,mask:255},1+O,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*B+1,[S,L,g]}return this.nextStencilID=3,[{[y]:new Sn({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[y]:new Sn({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},g]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new ii([l.CONSTANT_COLOR,l.ONE],new o.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ii.unblended:ii.alphaBlended}getDepthModeForSublayer(l,u,g){if(!this.opaquePassEnabledForLayer())return ln.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ln(g||this.context.gl.LEQUAL,u,[y,y])}getDepthModeFor3D(){return new ln(this.context.gl.LEQUAL,ln.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,u){var g,y;this.style=l,this.options=u,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const B=this.style._order,S=this.style.sourceCaches,L={},O={},Q={},q={isRenderingToTexture:!1,isRenderingGlobe:((g=l.projection)===null||g===void 0?void 0:g.transitionState)>0};for(const J in S){const At=S[J];At.used&&At.prepare(this.context),L[J]=At.getVisibleCoordinates(!1),O[J]=L[J].slice().reverse(),Q[J]=At.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<B.length;J++)if(this.style._layers[B[J]].is3D()){this.opaquePassCutoff=J;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const J of B){const At=this.style._layers[J];if(!At.hasOffscreenPass()||At.isHidden(this.transform.zoom))continue;const gt=O[At.source];(At.type==="custom"||gt.length)&&this.renderLayer(this,S[At.source],At,gt,q)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:J=>this.useProgram(J)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?o.b4.black:o.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(J,At){const gt=J.context,Lt=gt.gl,Ft=((ne,se,Te)=>{const Ce=Math.cos(se.rollInRadians),Oe=Math.sin(se.rollInRadians),ze=xe(se),Le=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ne.properties.get("sky-color"),u_horizon_color:ne.properties.get("horizon-color"),u_horizon:[(se.width/2-ze*Oe)*Te,(se.height/2+ze*Ce)*Te],u_horizon_normal:[-Oe,Ce],u_sky_horizon_blend:ne.properties.get("sky-horizon-blend")*se.height/2*Te,u_sky_blend:Le}})(At,J.style.map.transform,J.pixelRatio),Ot=new ln(Lt.LEQUAL,ln.ReadWrite,[0,1]),kt=Sn.disabled,qt=J.colorModeForRenderPass(),$t=J.useProgram("sky"),Jt=qd(gt,At);$t.draw(gt,Lt.TRIANGLES,Ot,kt,qt,vn.disabled,Ft,null,void 0,"sky",Jt.vertexBuffer,Jt.indexBuffer,Jt.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const J=this.style._layers[B[this.currentLayer]],At=S[J.source],gt=L[J.source];this._renderTileClippingMasks(J,gt,!1),this.renderLayer(this,At,J,gt,q)}this.renderPass="translucent";let Z=!1;for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const J=this.style._layers[B[this.currentLayer]],At=S[J.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(J,q))continue;this.opaquePassEnabledForLayer()||Z||(Z=!0,q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const gt=(J.type==="symbol"?Q:O)[J.source];this._renderTileClippingMasks(J,L[J.source],!1),this.renderLayer(this,At,J,gt,q)}if(q.isRenderingGlobe&&function(J,At,gt){const Lt=J.context,Ft=Lt.gl,Ot=J.useProgram("atmosphere"),kt=new ln(Ft.LEQUAL,ln.ReadOnly,[0,1]),qt=J.transform,$t=function(Le,fr){const Ar=Le.properties.get("position"),Ke=[-Ar.x,-Ar.y,-Ar.z],br=o.aq(new Float64Array(16));return Le.properties.get("anchor")==="map"&&(o.aX(br,br,fr.rollInRadians),o.aY(br,br,-fr.pitchInRadians),o.aX(br,br,fr.bearingInRadians),o.aY(br,br,fr.center.lat*Math.PI/180),o.bj(br,br,-fr.center.lng*Math.PI/180)),o.bS(Ke,Ke,br),Ke}(gt,J.transform),Jt=qt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ne=At.properties.get("atmosphere-blend")*Jt.projectionTransition;if(ne===0)return;const se=Ro(qt.worldSize,qt.center.lat),Te=qt.inverseProjectionMatrix,Ce=new Float64Array(4);Ce[3]=1,o.al(Ce,Ce,qt.modelViewProjectionMatrix),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1,o.al(Ce,Ce,Te),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1;const Oe=((Le,fr,Ar,Ke,br)=>({u_sun_pos:Le,u_atmosphere_blend:fr,u_globe_position:Ar,u_globe_radius:Ke,u_inv_proj_matrix:br}))($t,ne,[Ce[0],Ce[1],Ce[2]],se,Te),ze=qd(Lt,At);Ot.draw(Lt,Ft.TRIANGLES,kt,Sn.disabled,ii.alphaBlended,vn.disabled,Oe,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const J=function(At,gt){let Lt=null;const Ft=Object.values(At._layers).flatMap($t=>$t.source&&!$t.isHidden(gt)?[At.sourceCaches[$t.source]]:[]),Ot=Ft.filter($t=>$t.getSource().type==="vector"),kt=Ft.filter($t=>$t.getSource().type!=="vector"),qt=$t=>{(!Lt||Lt.getSource().maxzoom<$t.getSource().maxzoom)&&(Lt=$t)};return Ot.forEach($t=>qt($t)),Lt||kt.forEach($t=>qt($t)),Lt}(this.style,this.transform.zoom);J&&function(At,gt,Lt){for(let Ft=0;Ft<Lt.length;Ft++)Gd(At,gt,Lt[Ft])}(this,J,J.getVisibleCoordinates())}this.options.showPadding&&function(J){const At=J.transform.padding;cl(J,J.transform.height-(At.top||0),3,ba),cl(J,At.bottom||0,3,Hd),VA(J,At.left||0,3,Vd),VA(J,J.transform.width-(At.right||0),3,HA);const gt=J.transform.centerPoint;(function(Lt,Ft,Ot,kt){Wh(Lt,Ft-1,Ot-10,2,20,kt),Wh(Lt,Ft-10,Ot-1,20,2,kt)})(J,gt.x,J.transform.height-gt.y,pc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=l?!o.bV(u,g):!o.bW(u,g)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(o.bX(u,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,S){const L=B.context,O=L.gl,Q=B.transform,q=ii.unblended,Z=new ln(O.LEQUAL,ln.ReadWrite,[0,1]),J=S.sourceCache.getRenderableTiles(),At=B.useProgram("terrainDepth");L.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),L.clear({color:o.b4.transparent,depth:1});for(const gt of J){const Lt=S.getTerrainMesh(gt.tileID),Ft=S.getTerrainData(gt.tileID),Ot=Q.getProjectionData({overscaledTileID:gt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),kt={u_ele_delta:S.getMeshFrameDelta(Q.zoom)};At.draw(L,O.TRIANGLES,Z,Sn.disabled,q,vn.backCCW,kt,Ft,Ot,"terrain",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain),function(B,S){const L=B.context,O=L.gl,Q=B.transform,q=ii.unblended,Z=new ln(O.LEQUAL,ln.ReadWrite,[0,1]),J=S.getCoordsTexture(),At=S.sourceCache.getRenderableTiles(),gt=B.useProgram("terrainCoords");L.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),L.clear({color:o.b4.transparent,depth:1}),S.coordsIndex=[];for(const Lt of At){const Ft=S.getTerrainMesh(Lt.tileID),Ot=S.getTerrainData(Lt.tileID);L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,J.texture);const kt={u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(Q.zoom)},qt=Q.getProjectionData({overscaledTileID:Lt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});gt.draw(L,O.TRIANGLES,Z,Sn.disabled,q,vn.backCCW,kt,Ot,qt,"terrain",Ft.vertexBuffer,Ft.indexBuffer,Ft.segments),S.coordsIndex.push(Lt.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain))}renderLayer(l,u,g,y,B){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||(y||[]).length)&&(this.id=g.id,o.bY(g)?function(S,L,O,Q,q,Z){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:J}=Z,At=Sn.disabled,gt=S.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Lt,Ft,Ot,kt,qt,$t,Jt,ne,se){const Te=Ft.transform,Ce=Ft.style.map.terrain,Oe=qt==="map",ze=$t==="map";for(const Le of Lt){const fr=kt.getTile(Le),Ar=fr.getBucket(Ot);if(!Ar||!Ar.text||!Ar.text.segments.get().length)continue;const Ke=o.ah(Ar.textSizeData,Te.zoom),br=o.at(fr,1,Ft.transform.zoom),sn=ge(Oe,Ft.transform,br),Mn=Ot.layout.get("icon-text-fit")!=="none"&&Ar.hasIconData();{const vi=Math.pow(2,Te.zoom-fr.tileID.overscaledZ),oi=Ce?(bi,zn)=>Ce.getElevation(Le,bi,zn):null;eh(Ar,Oe,ze,se,Te,sn,vi,Ke,Mn,o.au(Te,fr,Jt,ne),Le.toUnwrapped(),oi)}}}(Q,S,O,L,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),q),O.paint.get("icon-opacity").constantOr(1)!==0&&mu(S,L,O,Q,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),At,gt,J),O.paint.get("text-opacity").constantOr(1)!==0&&mu(S,L,O,Q,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),At,gt,J),L.map.showCollisionBoxes&&(pu(S,L,O,Q,!0),pu(S,L,O,Q,!1))}(l,u,g,y,this.style.placement.variableOffsets,B):o.bZ(g)?function(S,L,O,Q,q){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=q,J=O.paint.get("circle-opacity"),At=O.paint.get("circle-stroke-width"),gt=O.paint.get("circle-stroke-opacity"),Lt=!O.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(At.constantOr(1)===0||gt.constantOr(1)===0))return;const Ft=S.context,Ot=Ft.gl,kt=S.transform,qt=S.getDepthModeForSublayer(0,ln.ReadOnly),$t=Sn.disabled,Jt=S.colorModeForRenderPass(),ne=[],se=kt.getCircleRadiusCorrection();for(let Te=0;Te<Q.length;Te++){const Ce=Q[Te],Oe=L.getTile(Ce),ze=Oe.getBucket(O);if(!ze)continue;const Le=O.paint.get("circle-translate"),fr=O.paint.get("circle-translate-anchor"),Ar=o.au(kt,Oe,Le,fr),Ke=ze.programConfigurations.get(O.id),br=S.useProgram("circle",Ke),sn=ze.layoutVertexBuffer,Mn=ze.indexBuffer,vi=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ce),oi={programConfiguration:Ke,program:br,layoutVertexBuffer:sn,indexBuffer:Mn,uniformValues:$r(S,Oe,O,Ar,se),terrainData:vi,projectionData:kt.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!Z,applyTerrainMatrix:!0})};if(Lt){const bi=ze.segments.get();for(const zn of bi)ne.push({segments:new o.aD([zn]),sortKey:zn.sortKey,state:oi})}else ne.push({segments:ze.segments,sortKey:0,state:oi})}Lt&&ne.sort((Te,Ce)=>Te.sortKey-Ce.sortKey);for(const Te of ne){const{programConfiguration:Ce,program:Oe,layoutVertexBuffer:ze,indexBuffer:Le,uniformValues:fr,terrainData:Ar,projectionData:Ke}=Te.state;Oe.draw(Ft,Ot.TRIANGLES,qt,$t,Jt,vn.backCCW,fr,Ar,Ke,O.id,ze,Le,Te.segments,O.paint,S.transform.zoom,Ce)}}(l,u,g,y,B):o.b_(g)?function(S,L,O,Q,q){if(O.paint.get("heatmap-opacity")===0)return;const Z=S.context,{isRenderingToTexture:J,isRenderingGlobe:At}=q;if(S.style.map.terrain){for(const gt of Q){const Lt=L.getTile(gt);L.hasRenderableParent(gt)||(S.renderPass==="offscreen"?zA(S,Lt,O,gt,At):S.renderPass==="translucent"&&Gh(S,O,gt,J,At))}Z.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?function(gt,Lt,Ft,Ot){const kt=gt.context,qt=kt.gl,$t=gt.transform,Jt=Sn.disabled,ne=new ii([qt.ONE,qt.ONE],o.b4.transparent,[!0,!0,!0,!0]);(function(se,Te,Ce){const Oe=se.gl;se.activeTexture.set(Oe.TEXTURE1),se.viewport.set([0,0,Te.width/4,Te.height/4]);let ze=Ce.heatmapFbos.get(o.bP);ze?(Oe.bindTexture(Oe.TEXTURE_2D,ze.colorAttachment.get()),se.bindFramebuffer.set(ze.framebuffer)):(ze=rh(se,Te.width/4,Te.height/4),Ce.heatmapFbos.set(o.bP,ze))})(kt,gt,Ft),kt.clear({color:o.b4.transparent});for(let se=0;se<Ot.length;se++){const Te=Ot[se];if(Lt.hasRenderableParent(Te))continue;const Ce=Lt.getTile(Te),Oe=Ce.getBucket(Ft);if(!Oe)continue;const ze=Oe.programConfigurations.get(Ft.id),Le=gt.useProgram("heatmap",ze),fr=$t.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ar=$t.getCircleRadiusCorrection();Le.draw(kt,qt.TRIANGLES,ln.disabled,Jt,ne,vn.backCCW,Ci(Ce,$t.zoom,Ft.paint.get("heatmap-intensity"),Ar),null,fr,Ft.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,Ft.paint,$t.zoom,ze)}kt.viewport.set([0,0,gt.width,gt.height])}(S,L,O,Q):S.renderPass==="translucent"&&function(gt,Lt){const Ft=gt.context,Ot=Ft.gl;Ft.setColorMode(gt.colorModeForRenderPass());const kt=Lt.heatmapFbos.get(o.bP);kt&&(Ft.activeTexture.set(Ot.TEXTURE0),Ot.bindTexture(Ot.TEXTURE_2D,kt.colorAttachment.get()),Ft.activeTexture.set(Ot.TEXTURE1),jh(Ft,Lt).bind(Ot.LINEAR,Ot.CLAMP_TO_EDGE),gt.useProgram("heatmapTexture").draw(Ft,Ot.TRIANGLES,ln.disabled,Sn.disabled,gt.colorModeForRenderPass(),vn.disabled,ci(gt,Lt,0,1),null,null,Lt.id,gt.viewportBuffer,gt.quadTriangleIndexBuffer,gt.viewportSegments,Lt.paint,gt.transform.zoom))}(S,O)}(l,u,g,y,B):o.b$(g)?function(S,L,O,Q,q){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=q,J=O.paint.get("line-opacity"),At=O.paint.get("line-width");if(J.constantOr(1)===0||At.constantOr(1)===0)return;const gt=S.getDepthModeForSublayer(0,ln.ReadOnly),Lt=S.colorModeForRenderPass(),Ft=O.paint.get("line-dasharray"),Ot=O.paint.get("line-pattern"),kt=Ot.constantOr(1),qt=O.paint.get("line-gradient"),$t=O.getCrossfadeParameters(),Jt=kt?"linePattern":Ft?"lineSDF":qt?"lineGradient":"line",ne=S.context,se=ne.gl,Te=S.transform;let Ce=!0;for(const Oe of Q){const ze=L.getTile(Oe);if(kt&&!ze.patternsLoaded())continue;const Le=ze.getBucket(O);if(!Le)continue;const fr=Le.programConfigurations.get(O.id),Ar=S.context.program.get(),Ke=S.useProgram(Jt,fr),br=Ce||Ke.program!==Ar,sn=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Oe),Mn=Ot.constantOr(null);if(Mn&&ze.imageAtlas){const Jn=ze.imageAtlas,ti=Jn.patternPositions[Mn.to.toString()],qs=Jn.patternPositions[Mn.from.toString()];ti&&qs&&fr.setConstantPatternPositions(ti,qs)}const vi=Te.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),oi=Te.getPixelScale(),bi=kt?ol(S,ze,O,oi,$t):Ft?kA(S,ze,O,oi,Ft,$t):qt?fo(S,ze,O,oi,Le.lineClipsArray.length):$o(S,ze,O,oi);if(kt)ne.activeTexture.set(se.TEXTURE0),ze.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),fr.updatePaintBuffers($t);else if(Ft&&(br||S.lineAtlas.dirty))ne.activeTexture.set(se.TEXTURE0),S.lineAtlas.bind(ne);else if(qt){const Jn=Le.gradients[O.id];let ti=Jn.texture;if(O.gradientVersion!==Jn.version){let qs=256;if(O.stepInterpolant){const ts=L.getSource().maxzoom,as=Oe.canonical.z===ts?Math.ceil(1<<S.transform.maxZoom-Oe.canonical.z):1;qs=o.ab(o.bQ(Le.maxLineLength/o.X*1024*as),256,ne.maxTextureSize)}Jn.gradient=o.bR({expression:O.gradientExpression(),evaluationKey:"lineProgress",resolution:qs,image:Jn.gradient||void 0,clips:Le.lineClipsArray}),Jn.texture?Jn.texture.update(Jn.gradient):Jn.texture=new nt(ne,Jn.gradient,se.RGBA),Jn.version=O.gradientVersion,ti=Jn.texture}ne.activeTexture.set(se.TEXTURE0),ti.bind(O.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}let zn;if(Z){const[Jn]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);zn=Jn[Oe.overscaledZ]}else zn=S.stencilModeForClipping(Oe);Ke.draw(ne,se.TRIANGLES,gt,zn,Lt,vn.disabled,bi,sn,vi,O.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,O.paint,S.transform.zoom,fr,Le.layoutVertexBuffer2),Ce=!1}}(l,u,g,y,B):o.c0(g)?function(S,L,O,Q,q){const Z=O.paint.get("fill-color"),J=O.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const{isRenderingToTexture:At}=q,gt=S.colorModeForRenderPass(),Lt=O.paint.get("fill-pattern"),Ft=S.opaquePassEnabledForLayer()&&!Lt.constantOr(1)&&Z.constantOr(o.b4.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===Ft){const Ot=S.getDepthModeForSublayer(1,S.renderPass==="opaque"?ln.ReadWrite:ln.ReadOnly);yu(S,L,O,Q,Ot,gt,!1,At)}if(S.renderPass==="translucent"&&O.paint.get("fill-antialias")){const Ot=S.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,ln.ReadOnly);yu(S,L,O,Q,Ot,gt,!0,At)}}(l,u,g,y,B):o.c1(g)?function(S,L,O,Q,q){const Z=O.paint.get("fill-extrusion-opacity");if(Z===0)return;const{isRenderingToTexture:J}=q;if(S.renderPass==="translucent"){const At=new ln(S.context.gl.LEQUAL,ln.ReadWrite,S.depthRangeFor3D);if(Z!==1||O.paint.get("fill-extrusion-pattern").constantOr(1))qh(S,L,O,Q,At,Sn.disabled,ii.disabled,J),qh(S,L,O,Q,At,S.stencilModeFor3D(),S.colorModeForRenderPass(),J);else{const gt=S.colorModeForRenderPass();qh(S,L,O,Q,At,Sn.disabled,gt,J)}}}(l,u,g,y,B):o.c2(g)?function(S,L,O,Q,q){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=q,J=S.context,At=S.style.projection.useSubdivision,gt=S.getDepthModeForSublayer(0,ln.ReadOnly),Lt=S.colorModeForRenderPass();if(S.renderPass==="offscreen")(function(Ft,Ot,kt,qt,$t,Jt,ne){const se=Ft.context,Te=se.gl;for(const Ce of kt){const Oe=Ot.getTile(Ce),ze=Oe.dem;if(!ze||!ze.data||!Oe.needsHillshadePrepare)continue;const Le=ze.dim,fr=ze.stride,Ar=ze.getPixels();if(se.activeTexture.set(Te.TEXTURE1),se.pixelStoreUnpackPremultiplyAlpha.set(!1),Oe.demTexture=Oe.demTexture||Ft.getTileTexture(fr),Oe.demTexture){const br=Oe.demTexture;br.update(Ar,{premultiply:!1}),br.bind(Te.NEAREST,Te.CLAMP_TO_EDGE)}else Oe.demTexture=new nt(se,Ar,Te.RGBA,{premultiply:!1}),Oe.demTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);se.activeTexture.set(Te.TEXTURE0);let Ke=Oe.fbo;if(!Ke){const br=new nt(se,{width:Le,height:Le,data:null},Te.RGBA);br.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Ke=Oe.fbo=se.createFramebuffer(Le,Le,!0,!1),Ke.colorAttachment.set(br.texture)}se.bindFramebuffer.set(Ke.framebuffer),se.viewport.set([0,0,Le,Le]),Ft.useProgram("hillshadePrepare").draw(se,Te.TRIANGLES,$t,Jt,ne,vn.disabled,Vs(Oe.tileID,ze),null,null,qt.id,Ft.rasterBoundsBuffer,Ft.quadTriangleIndexBuffer,Ft.rasterBoundsSegments),Oe.needsHillshadePrepare=!1}})(S,L,Q,O,gt,Sn.disabled,Lt),J.viewport.set([0,0,S.width,S.height]);else if(S.renderPass==="translucent")if(At){const[Ft,Ot,kt]=S.stencilConfigForOverlapTwoPass(Q);zd(S,L,O,kt,Ft,gt,Lt,!1,Z),zd(S,L,O,kt,Ot,gt,Lt,!0,Z)}else{const[Ft,Ot]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);zd(S,L,O,Ot,Ft,gt,Lt,!1,Z)}}(l,u,g,y,B):o.c3(g)?function(S,L,O,Q,q){if(S.renderPass!=="translucent"||O.paint.get("raster-opacity")===0||!Q.length)return;const{isRenderingToTexture:Z}=q,J=L.getSource(),At=S.style.projection.useSubdivision;if(J instanceof Xe)Ti(S,L,O,Q,null,!1,!1,J.tileCoords,J.flippedWindingOrder,Z);else if(At){const[gt,Lt,Ft]=S.stencilConfigForOverlapTwoPass(Q);Ti(S,L,O,Ft,gt,!1,!0,Kh,!1,Z),Ti(S,L,O,Ft,Lt,!0,!0,Kh,!1,Z)}else{const[gt,Lt]=S.getStencilConfigForOverlapAndUpdateStencilID(Q);Ti(S,L,O,Lt,gt,!1,!0,Kh,!1,Z)}}(l,u,g,y,B):o.c4(g)?function(S,L,O,Q,q){const Z=O.paint.get("background-color"),J=O.paint.get("background-opacity");if(J===0)return;const{isRenderingToTexture:At}=q,gt=S.context,Lt=gt.gl,Ft=S.style.projection,Ot=S.transform,kt=Ot.tileSize,qt=O.paint.get("background-pattern");if(S.isPatternMissing(qt))return;const $t=!qt&&Z.a===1&&J===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==$t)return;const Jt=Sn.disabled,ne=S.getDepthModeForSublayer(0,$t==="opaque"?ln.ReadWrite:ln.ReadOnly),se=S.colorModeForRenderPass(),Te=S.useProgram(qt?"backgroundPattern":"background"),Ce=Q||Bt(Ot,{tileSize:kt,terrain:S.style.map.terrain});qt&&(gt.activeTexture.set(Lt.TEXTURE0),S.imageManager.bind(S.context));const Oe=O.getCrossfadeParameters();for(const ze of Ce){const Le=Ot.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!At,applyTerrainMatrix:!0}),fr=qt?lc(J,S,qt,{tileID:ze,tileSize:kt},Oe):ac(J,Z),Ar=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ze),Ke=Ft.getMeshFromTileID(gt,ze.canonical,!1,!0,"raster");Te.draw(gt,Lt.TRIANGLES,ne,Jt,se,vn.backCCW,fr,Ar,Le,O.id,Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}}(l,0,g,y,B):o.c5(g)&&function(S,L,O,Q){const{isRenderingGlobe:q}=Q,Z=S.context,J=O.implementation,At=S.style.projection,gt=S.transform,Lt=gt.getProjectionDataForCustomLayer(q),Ft={farZ:gt.farZ,nearZ:gt.nearZ,fov:gt.fov*Math.PI/180,modelViewProjectionMatrix:gt.modelViewProjectionMatrix,projectionMatrix:gt.projectionMatrix,shaderData:{variantName:At.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${At.shaderPreludeCode.vertexSource}`,define:At.shaderDefine},defaultProjectionData:Lt},Ot=J.renderingMode?J.renderingMode:"2d";if(S.renderPass==="offscreen"){const kt=J.prerender;kt&&(S.setCustomLayerDefaults(),Z.setColorMode(S.colorModeForRenderPass()),kt.call(J,Z.gl,Ft),Z.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),Z.setColorMode(S.colorModeForRenderPass()),Z.setStencilMode(Sn.disabled);const kt=Ot==="3d"?S.getDepthModeFor3D():S.getDepthModeForSublayer(0,ln.ReadOnly);Z.setDepthMode(kt),J.render(Z.gl,Ft),Z.setDirty(),S.setBaseState(),Z.bindFramebuffer.set(null)}}(l,0,g,B))}saveTileTexture(l){const u=this._tileTextures[l.size[0]];u?u.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const u=this._tileTextures[l];return u&&u.length>0?u.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const u=this.imageManager.getPattern(l.from.toString()),g=this.imageManager.getPattern(l.to.toString());return!u||!g}useProgram(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.cache=this.cache||{};const y=!!this.style.map.terrain,B=this.style.projection,S=l+(u?u.cacheKey:"")+`/${g?Ku:B.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"");return this.cache[S]||(this.cache[S]=new ht(this.context,Bi[l],u,Yu[l],this._showOverdrawInspector,y,g?Bi.projectionMercator:B.shaderPreludeCode,g?Tl:B.shaderDefine)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:u}=this.context.gl;return this.width!==l||this.height!==u}}function gc(w,l){var u=this;let g,y=!1,B=null,S=null;const L=()=>{B=null,y&&(w.apply(S,g),B=setTimeout(L,l),y=!1)};return function(){for(var O=arguments.length,Q=new Array(O),q=0;q<O;q++)Q[q]=arguments[q];return y=!0,S=u,g=Q,B||L(),B}}class ul{constructor(l){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let g;return u.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(g=y)}),(g&&g[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const g=u.join("/");let y=g;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${g}`);let B=window.location.hash.replace(y,"");B.startsWith("#&")?B=B.slice(0,1)+B.slice(2):B==="#"&&(B="");let S=window.location.href.replace(/(#.+)?$/,B);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=gc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const u=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,y=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),B=Math.pow(10,y),S=Math.round(u.lng*B)/B,L=Math.round(u.lat*B)/B,O=this._map.getBearing(),Q=this._map.getPitch();let q="";if(q+=l?`/${S}/${L}/${g}`:`${g}/${L}/${S}`,(O||Q)&&(q+="/"+Math.round(10*O)/10),Q&&(q+=`/${Math.round(Q)}`),this._hashName){const Z=this._hashName;let J=!1;const At=window.location.hash.slice(1).split("&").map(gt=>{const Lt=gt.split("=")[0];return Lt===Z?(J=!0,`${Lt}=${q}`):gt}).filter(gt=>gt);return J||At.push(`${Z}=${q}`),`#${At.join("&")}`}return`#${q}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new o.N(+l[2],+l[1])}catch{return!1}const u=+l[0],g=+(l[3]||0),y=+(l[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&g>=0&&g<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const ro={linearity:.3,easing:o.c6(0,0,.3,1)},hl=o.e({deceleration:2500,maxSpeed:1400},ro),fp=o.e({deceleration:20,maxSpeed:1400},ro),Kd=o.e({deceleration:1e3,maxSpeed:360},ro),Nl=o.e({deceleration:1e3,maxSpeed:90},ro),Yo=o.e({deceleration:1e3,maxSpeed:360},ro);class $h{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,u=C.now();for(;l.length>0&&u-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:B}of this._inertiaBuffer)u.zoom+=B.zoomDelta||0,u.bearing+=B.bearingDelta||0,u.pitch+=B.pitchDelta||0,u.roll+=B.rollDelta||0,B.panDelta&&u.pan._add(B.panDelta),B.around&&(u.around=B.around),B.pinchAround&&(u.pinchAround=B.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const B=no(u.pan.mag(),g,o.e({},hl,l||{})),S=u.pan.mult(B.amount/u.pan.mag()),L=this._map.cameraHelper.handlePanInertia(S,this._map.transform);y.center=L.easingCenter,y.offset=L.easingOffset,ih(y,B)}if(u.zoom){const B=no(u.zoom,g,fp);y.zoom=this._map.transform.zoom+B.amount,ih(y,B)}if(u.bearing){const B=no(u.bearing,g,Kd);y.bearing=this._map.transform.bearing+o.ab(B.amount,-179,179),ih(y,B)}if(u.pitch){const B=no(u.pitch,g,Nl);y.pitch=this._map.transform.pitch+B.amount,ih(y,B)}if(u.roll){const B=no(u.roll,g,Yo);y.roll=this._map.transform.roll+o.ab(B.amount,-179,179),ih(y,B)}if(y.zoom||y.bearing){const B=u.pinchAround===void 0?u.around:u.pinchAround;y.around=B?this._map.unproject(B):this._map.getCenter()}return this.clear(),o.e(y,{noMoveStart:!0})}}function ih(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function no(w,l,u){const{maxSpeed:g,linearity:y,deceleration:B}=u,S=o.ab(w*y/(l/1e3),-g,g),L=Math.abs(S)/(B*y);return{easing:u.easing,duration:1e3*L,amount:S*(L/2)}}class Di extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const B=b.mousePos(u.getCanvas(),g),S=u.unproject(B);super(l,o.e({point:B,lngLat:S,originalEvent:g},y)),this._defaultPrevented=!1,this.target=u}}class vu extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,g){const y=l==="touchend"?g.changedTouches:g.touches,B=b.touchPos(u.getCanvasContainer(),y),S=B.map(O=>u.unproject(O)),L=B.reduce((O,Q,q,Z)=>O.add(Q.div(Z.length)),new o.P(0,0));super(l,{points:B,point:L,lngLats:S,lngLat:u.unproject(L),originalEvent:g}),this._defaultPrevented=!1}}class wa extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,u,g){super(l,{originalEvent:g}),this._defaultPrevented=!1}}class sh{constructor(l,u){this._map=l,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new wa(l.type,this._map,l))}mousedown(l,u){return this._mousedownPos=u,this._firePreventable(new Di(l.type,this._map,l))}mouseup(l){this._map.fire(new Di(l.type,this._map,l))}click(l,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Di(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Di(l.type,this._map,l))}mouseover(l){this._map.fire(new Di(l.type,this._map,l))}mouseout(l){this._map.fire(new Di(l.type,this._map,l))}touchstart(l){return this._firePreventable(new vu(l.type,this._map,l))}touchmove(l){this._map.fire(new vu(l.type,this._map,l))}touchend(l){this._map.fire(new vu(l.type,this._map,l))}touchcancel(l){this._map.fire(new vu(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class GA{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Di(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Di(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mc{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(o.P.convert(l),this._map.terrain)}}class oh{constructor(l,u){this._map=l,this._tr=new mc(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,u){this.isEnabled()&&l.shiftKey&&l.button===0&&(b.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(l,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=g,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const B=Math.min(y.x,g.x),S=Math.max(y.x,g.x),L=Math.min(y.y,g.y),O=Math.max(y.y,g.y);b.setTransform(this._box,`translate(${B}px,${L}px)`),this._box.style.width=S-B+"px",this._box.style.height=O-L+"px"}mouseupWindow(l,u){if(!this._active||l.button!==0)return;const g=this._startPos,y=u;if(this.reset(),b.suppressClick(),g.x!==y.x||g.y!==y.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:l})),{cameraAnimation:B=>B.fitScreenCoordinates(g,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,u){return this._map.fire(new o.k(l,{originalEvent:u}))}}function Xh(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const u={};for(let g=0;g<w.length;g++)u[w[g].identifier]=l[g];return u}class pp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),g.length===this.numTouches&&(this.centroid=function(y){const B=new o.P(0,0);for(const S of y)B._add(S);return B.div(y.length)}(u),this.touches=Xh(g,u)))}touchmove(l,u,g){if(this.aborted||!this.centroid)return;const y=Xh(g,u);for(const B in this.touches){const S=y[B];(!S||S.dist(this.touches[B])>30)&&(this.aborted=!0)}}touchend(l,u,g){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class yc{constructor(l){this.singleTap=new pp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,u,g){this.singleTap.touchstart(l,u,g)}touchmove(l,u,g){this.singleTap.touchmove(l,u,g)}touchend(l,u,g){const y=this.singleTap.touchend(l,u,g);if(y){const B=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(B&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class kl{constructor(l){this._tr=new mc(l),this._zoomIn=new yc({numTouches:1,numTaps:2}),this._zoomOut=new yc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,u,g){this._zoomIn.touchstart(l,u,g),this._zoomOut.touchstart(l,u,g)}touchmove(l,u,g){this._zoomIn.touchmove(l,u,g),this._zoomOut.touchmove(l,u,g)}touchend(l,u,g){const y=this._zoomIn.touchend(l,u,g),B=this._zoomOut.touchend(l,u,g),S=this._tr;return y?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(y)},{originalEvent:l})}):B?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(B)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,u){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const y=Array.isArray(u)?u[0]:u;return!this._moved&&y.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(g,y))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&b.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gp={0:1,2:2};class bu{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const u=b.mouseButton(l);this._eventButton=u}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(u,g){const y=gp[g];return u.buttons===void 0||(u.buttons&y)!==y}(l,this._eventButton)}isValidEndEvent(l){return b.mouseButton(l)===this._eventButton}}class mp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class Zh{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new bu({checkCorrectEvent:()=>!0}),u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new mp;this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(l,u,g){return l instanceof MouseEvent?u(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?g(l):void 0}startMove(l){this._executeRelevantHandler(l,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(l){this._executeRelevantHandler(l,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(l){return this._executeRelevantHandler(l,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(l){return this._executeRelevantHandler(l,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(l){return this._executeRelevantHandler(l,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}const Ql=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=l=>{l.preventDefault()}};class Yh{constructor(l,u){this._clickTolerance=l.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,u,g){return this._calculateTransform(l,u,g)}touchmove(l,u,g){if(this._active){if(!this._shouldBePrevented(g.length))return l.preventDefault(),this._calculateTransform(l,u,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,u,g){this._calculateTransform(l,u,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,u,g){g.length>0&&(this._active=!0);const y=Xh(g,u),B=new o.P(0,0),S=new o.P(0,0);let L=0;for(const Q in y){const q=y[Q],Z=this._touches[Q];Z&&(B._add(q),S._add(q.sub(Z)),L++,y[Q]=q)}if(this._touches=y,this._shouldBePrevented(L)||!S.mag())return;const O=S.div(L);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:B.div(L),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(l,u,g){if(!this._firstTwoTouches)return;l.preventDefault();const[y,B]=this._firstTwoTouches,S=ah(g,u,y),L=ah(g,u,B);if(!S||!L)return;const O=this._aroundCenter?null:S.add(L).div(2);return this._move([S,L],O,l)}touchend(l,u,g){if(!this._firstTwoTouches)return;const[y,B]=this._firstTwoTouches,S=ah(g,u,y),L=ah(g,u,B);S&&L||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ah(w,l,u){for(let g=0;g<w.length;g++)if(w[g].identifier===u)return l[g]}function Wd(w,l){return Math.log(w/l)/Math.LN2}class T extends Cn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,u){const g=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Wd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wd(this._distance,g),pinchAround:u}}}function M(w,l){return 180*w.angleWith(l)/Math.PI}class H extends Cn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,u,g){const y=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:M(this._vector,y),pinchAround:u}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const u=25/(Math.PI*this._minDiameter)*360,g=M(l,this._startVector);return Math.abs(g)<u}}function W(w){return Math.abs(w.y)>Math.abs(w.x)}class ut extends Cn{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,u,g){super.touchstart(l,u,g),this._currentTouchCount=g.length}_start(l){this._lastPoints=l,W(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,u,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=l[0].sub(this._lastPoints[0]),B=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,B,g.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(y.y+B.y)/2*-.5}):void 0}gestureBeginsVertically(l,u,g){if(this._valid!==void 0)return this._valid;const y=l.mag()>=2,B=u.mag()>=2;if(!y&&!B)return;if(!y||!B)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const S=l.y>0==u.y>0;return W(l)&&W(u)&&S}}const mt={panStep:100,bearingStep:15,pitchStep:10};class _t{constructor(l){this._tr=new mc(l);const u=mt;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let u=0,g=0,y=0,B=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:l.shiftKey?g=-1:(l.preventDefault(),B=-1);break;case 39:l.shiftKey?g=1:(l.preventDefault(),B=1);break;case 38:l.shiftKey?y=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?y=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,y=0),{cameraAnimation:L=>{const O=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:xt,zoom:u?Math.round(O.zoom)+u*(l.shiftKey?2:1):O.zoom,bearing:O.bearing+g*this._bearingStep,pitch:O.pitch+y*this._pitchStep,offset:[-B*this._panStep,-S*this._panStep],center:O.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xt(w){return w*(2-w)}const St=4.000244140625;class Ut{constructor(l,u){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=l,this._tr=new mc(l),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let u=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const g=C.now(),y=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%St==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),l.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=l,this._delta-=u,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=b.mousePos(this._map.getCanvas(),l),g=this._tr;this._aroundPoint=this._aroundCenter?g.transform.locationToScreenPoint(o.N.convert(g.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const L=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=L),typeof this._targetZoom=="number"&&(this._targetZoom+=L)}if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>St?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&O!==0&&(O=1/O);const Q=typeof this._targetZoom!="number"?l.scale:o.aG(this._targetZoom);this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,o.a8(Q*O))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,g=this._startZoom,y=this._easing;let B,S=!1;if(this._type==="wheel"&&g&&y){const L=C.now()-this._lastWheelEventTime,O=Math.min((L+5)/200,1),Q=y(O);B=o.y.number(g,u,Q),O<1?this._frameId||(this._frameId=!0):S=!0}else B=u,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=B,{noInertia:!0,needsRenderFrame:!S,zoomDelta:B-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let u=o.c8;if(this._prevEase){const g=this._prevEase,y=(C.now()-g.start)/g.duration,B=g.easing(y+.01)-g.easing(y),S=.27/Math.sqrt(B*B+1e-4)*.01,L=Math.sqrt(.0729-S*S);u=o.c6(S,L,.25,1)}return this._prevEase={start:C.now(),duration:l,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ue{constructor(l,u){this._clickZoom=l,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class be{constructor(l){this._tr=new mc(l),this.reset()}reset(){this._active=!1}dblclick(l,u){return l.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Se{constructor(){this._tap=new yc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,u,g){if(!this._swipePoint)if(this._tapTime){const y=u[0],B=l.timeStamp-this._tapTime<500,S=this._tapPoint.dist(y)<30;B&&S?g.length>0&&(this._swipePoint=y,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(l,u,g)}touchmove(l,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const y=u[0],B=y.y-this._swipePoint.y;return this._swipePoint=y,l.preventDefault(),this._active=!0,{zoomDelta:B/128}}}else this._tap.touchmove(l,u,g)}touchend(l,u,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const y=this._tap.touchend(l,u,g);y&&(this._tapTime=l.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _e{constructor(l,u,g){this._el=l,this._mousePan=u,this._touchPan=g}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ze{constructor(l,u,g,y){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=u,this._mousePitch=g,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ne{constructor(l,u,g,y){this._el=l,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ae{constructor(l,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=b.create("div","maplibregl-cooperative-gesture-screen",l);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=u,this._container.appendChild(y);const B=document.createElement("div");B.className="maplibregl-mobile-message",B.textContent=g,this._container.appendChild(B),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(b.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,u){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:l,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const fe=w=>w.zoom||w.drag||w.roll||w.pitch||w.rotate;class je extends o.k{}function rr(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta||w.rollDelta}class we{constructor(l,u){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,B)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=y.type==="renderFrame"?void 0:y,L={needsRenderFrame:!1},O={},Q={},q=y.touches,Z=q?this._getMapTouches(q):void 0,J=Z?b.touchPos(this._map.getCanvas(),Z):b.mousePos(this._map.getCanvas(),y);for(const{handlerName:Lt,handler:Ft,allowed:Ot}of this._handlers){if(!Ft.isEnabled())continue;let kt;this._blockedByActive(Q,Ot,Lt)?Ft.reset():Ft[B||y.type]&&(kt=Ft[B||y.type](y,J,Z),this.mergeHandlerResult(L,O,kt,Lt,S),kt&&kt.needsRenderFrame&&this._triggerRenderFrame()),(kt||Ft.isActive())&&(Q[Lt]=Ft)}const At={};for(const Lt in this._previousActiveHandlers)Q[Lt]||(At[Lt]=S);this._previousActiveHandlers=Q,(Object.keys(At).length||rr(L))&&(this._changes.push([L,O,At]),this._triggerRenderFrame()),(Object.keys(Q).length||rr(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:gt}=L;gt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],gt(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $h(l),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,B,S]of this._listeners)b.addEventListener(y,B,y===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[l,u,g]of this._listeners)b.removeEventListener(l,u,l===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(l){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new sh(u,l));const y=u.boxZoom=new oh(u,l);this._add("boxZoom",y),l.interactive&&l.boxZoom&&y.enable();const B=u.cooperativeGestures=new Ae(u,l.cooperativeGestures);this._add("cooperativeGestures",B),l.cooperativeGestures&&B.enable();const S=new kl(u),L=new be(u);u.doubleClickZoom=new ue(L,S),this._add("tapZoom",S),this._add("clickZoom",L),l.interactive&&l.doubleClickZoom&&u.doubleClickZoom.enable();const O=new Se;this._add("tapDragZoom",O);const Q=u.touchPitch=new ut(u);this._add("touchPitch",Q),l.interactive&&l.touchPitch&&u.touchPitch.enable(l.touchPitch);const q=()=>u.project(u.getCenter()),Z=function($t,Jt){let{enable:ne,clickTolerance:se,aroundCenter:Te=!0,minPixelCenterThreshold:Ce=100,rotateDegreesPerPixelMoved:Oe=.8}=$t;const ze=new bu({checkCorrectEvent:Le=>b.mouseButton(Le)===0&&Le.ctrlKey||b.mouseButton(Le)===2&&!Le.ctrlKey});return new Sr({clickTolerance:se,move:(Le,fr)=>{const Ar=Jt();if(Te&&Math.abs(Ar.y-Le.y)>Ce)return{bearingDelta:o.c7(new o.P(Le.x,fr.y),fr,Ar)};let Ke=(fr.x-Le.x)*Oe;return Te&&fr.y<Ar.y&&(Ke=-Ke),{bearingDelta:Ke}},moveStateManager:ze,enable:ne,assignEvents:Ql})}(l,q),J=function($t){let{enable:Jt,clickTolerance:ne,pitchDegreesPerPixelMoved:se=-.5}=$t;const Te=new bu({checkCorrectEvent:Ce=>b.mouseButton(Ce)===0&&Ce.ctrlKey||b.mouseButton(Ce)===2});return new Sr({clickTolerance:ne,move:(Ce,Oe)=>({pitchDelta:(Oe.y-Ce.y)*se}),moveStateManager:Te,enable:Jt,assignEvents:Ql})}(l),At=function($t,Jt){let{enable:ne,clickTolerance:se,rollDegreesPerPixelMoved:Te=.3}=$t;const Ce=new bu({checkCorrectEvent:Oe=>b.mouseButton(Oe)===2&&Oe.ctrlKey});return new Sr({clickTolerance:se,move:(Oe,ze)=>{const Le=Jt();let fr=(ze.x-Oe.x)*Te;return ze.y<Le.y&&(fr=-fr),{rollDelta:fr}},moveStateManager:Ce,enable:ne,assignEvents:Ql})}(l,q);u.dragRotate=new Ze(l,Z,J,At),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",J,["mouseRotate","mouseRoll"]),this._add("mouseRoll",At,["mousePitch"]),l.interactive&&l.dragRotate&&u.dragRotate.enable();const gt=function($t){let{enable:Jt,clickTolerance:ne}=$t;const se=new bu({checkCorrectEvent:Te=>b.mouseButton(Te)===0&&!Te.ctrlKey});return new Sr({clickTolerance:ne,move:(Te,Ce)=>({around:Ce,panDelta:Ce.sub(Te)}),activateOnStart:!0,moveStateManager:se,enable:Jt,assignEvents:Ql})}(l),Lt=new Yh(l,u);u.dragPan=new _e(g,gt,Lt),this._add("mousePan",gt),this._add("touchPan",Lt,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&u.dragPan.enable(l.dragPan);const Ft=new H,Ot=new T;u.touchZoomRotate=new Ne(g,Ot,Ft,O),this._add("touchRotate",Ft,["touchPan","touchZoom"]),this._add("touchZoom",Ot,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&u.touchZoomRotate.enable(l.touchZoomRotate);const kt=u.scrollZoom=new Ut(u,()=>this._triggerRenderFrame());this._add("scrollZoom",kt,["mousePan"]),l.interactive&&l.scrollZoom&&u.scrollZoom.enable(l.scrollZoom);const qt=u.keyboard=new _t(u);this._add("keyboard",qt),l.interactive&&l.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new GA(u))}_add(l,u,g){this._handlers.push({handlerName:l,handler:u,allowed:g}),this._handlersById[l]=u}stop(l){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fe(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,u,g){for(const y in l)if(y!==g&&(!u||u.indexOf(y)<0))return!0;return!1}_getMapTouches(l){const u=[];for(const g of l)this._el.contains(g.target)&&u.push(g);return u}mergeHandlerResult(l,u,g,y,B){if(!g)return;o.e(l,g);const S={handlerName:y,originalEvent:g.originalEvent||B};g.zoomDelta!==void 0&&(u.zoom=S),g.panDelta!==void 0&&(u.drag=S),g.rollDelta!==void 0&&(u.roll=S),g.pitchDelta!==void 0&&(u.pitch=S),g.bearingDelta!==void 0&&(u.rotate=S)}_applyChanges(){const l={},u={},g={};for(const[y,B,S]of this._changes)y.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(l.rollDelta=(l.rollDelta||0)+y.rollDelta),y.around!==void 0&&(l.around=y.around),y.pinchAround!==void 0&&(l.pinchAround=y.pinchAround),y.noInertia&&(l.noInertia=y.noInertia),o.e(u,B),o.e(g,S);this._updateMapTransform(l,u,g),this._changes=[]}_updateMapTransform(l,u,g){const y=this._map,B=y._getTransformForUpdate(),S=y.terrain;if(!(rr(l)||S&&this._terrainMovement))return this._fireEvents(u,g,!0);y._stop(!0);let{panDelta:L,zoomDelta:O,bearingDelta:Q,pitchDelta:q,rollDelta:Z,around:J,pinchAround:At}=l;At!==void 0&&(J=At),J=J||y.transform.centerPoint,S&&!B.isPointOnMapSurface(J)&&(J=B.centerPoint);const gt={panDelta:L,zoomDelta:O,rollDelta:Z,pitchDelta:q,bearingDelta:Q,around:J};this._map.cameraHelper.useGlobeControls&&!B.isPointOnMapSurface(J)&&(J=B.centerPoint);const Lt=J.distSqr(B.centerPoint)<.01?B.center:B.screenPointToLocation(L?J.sub(L):J);S?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(gt,B),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?B.setCenter(B.screenPointToLocation(B.centerPoint.sub(L))):this._map.cameraHelper.handleMapControlsPan(gt,B,Lt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(gt,B,Lt))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(gt,B),this._map.cameraHelper.handleMapControlsPan(gt,B,Lt)),y._applyUpdatedTransform(B),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(u,g,!0)}_fireEvents(l,u,g){const y=fe(this._eventsInProgress),B=fe(l),S={};for(const Z in l){const{originalEvent:J}=l[Z];this._eventsInProgress[Z]||(S[`${Z}start`]=J),this._eventsInProgress[Z]=l[Z]}!y&&B&&this._fireEvent("movestart",B.originalEvent);for(const Z in S)this._fireEvent(Z,S[Z]);B&&this._fireEvent("move",B.originalEvent);for(const Z in l){const{originalEvent:J}=l[Z];this._fireEvent(Z,J)}const L={};let O;for(const Z in this._eventsInProgress){const{handlerName:J,originalEvent:At}=this._eventsInProgress[Z];this._handlersById[J].isActive()||(delete this._eventsInProgress[Z],O=u[J]||At,L[`${Z}end`]=O)}for(const Z in L)this._fireEvent(Z,L[Z]);const Q=fe(this._eventsInProgress),q=(y||B)&&!Q;if(q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(g&&q){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=At=>At!==0&&-this._bearingSnap<At&&At<this._bearingSnap;!Z||!Z.essential&&C.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:O})),J(this._map.getBearing())&&this._map.resetNorth()):(J(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(l,u){this._map.fire(new o.k(l,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new je("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ge extends o.E{constructor(l,u,g){super(),this._renderFrameCallback=()=>{const y=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(l,u){l.apply(this.transform),this.transform=l,this.cameraHelper=u}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(l,u){return this.jumpTo({center:l},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,u){return this.jumpTo({elevation:l},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,u,g){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},u),g)}panTo(l,u,g){return this.easeTo(o.e({center:l},u),g)}getZoom(){return this.transform.zoom}setZoom(l,u){return this.jumpTo({zoom:l},u),this}zoomTo(l,u,g){return this.easeTo(o.e({zoom:l},u),g)}zoomIn(l,u){return this.zoomTo(this.getZoom()+1,l,u),this}zoomOut(l,u){return this.zoomTo(this.getZoom()-1,l,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,u){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new o.k("movestart",u)).fire(new o.k("move",u)).fire(new o.k("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(l,u){return this.jumpTo({bearing:l},u),this}getPadding(){return this.transform.padding}setPadding(l,u){return this.jumpTo({padding:l},u),this}rotateTo(l,u,g){return this.easeTo(o.e({bearing:l},u),g)}resetNorth(l,u){return this.rotateTo(0,o.e({duration:1e3},l),u),this}resetNorthPitch(l,u){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},l),u),this}snapToNorth(l,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,u):this}getPitch(){return this.transform.pitch}setPitch(l,u){return this.jumpTo({pitch:l},u),this}getRoll(){return this.transform.roll}setRoll(l,u){return this.jumpTo({roll:l},u),this}cameraForBounds(l,u){l=mr.convert(l).adjustAntiMeridian();const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),g,u)}_cameraForBoxAndBearing(l,u,g,y){const B={top:0,bottom:0,right:0,left:0};if(typeof(y=o.e({padding:B,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const Q=y.padding;y.padding={top:Q,bottom:Q,right:Q,left:Q}}const S=o.e(B,y.padding);y.padding=S;const L=this.transform,O=new mr(l,u);return this.cameraHelper.cameraForBoxAndBearing(y,S,O,g,L)}fitBounds(l,u,g){return this._fitInternal(this.cameraForBounds(l,u),u,g)}fitScreenCoordinates(l,u,g,y,B){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(l)),this.transform.screenPointToLocation(o.P.convert(u)),g,y),y,B)}_fitInternal(l,u,g){return l?(delete(u=o.e(l,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(l,u){this.stop();const g=this._getTransformForUpdate();let y=!1,B=!1,S=!1;const L=g.zoom;this.cameraHelper.handleJumpToCenterZoom(g,l);const O=g.zoom!==L;return"elevation"in l&&g.elevation!==+l.elevation&&g.setElevation(+l.elevation),"bearing"in l&&g.bearing!==+l.bearing&&(y=!0,g.setBearing(+l.bearing)),"pitch"in l&&g.pitch!==+l.pitch&&(B=!0,g.setPitch(+l.pitch)),"roll"in l&&g.roll!==+l.roll&&(S=!0,g.setRoll(+l.roll)),l.padding==null||g.isPaddingEqual(l.padding)||g.setPadding(l.padding),this._applyUpdatedTransform(g),this.fire(new o.k("movestart",u)).fire(new o.k("move",u)),O&&this.fire(new o.k("zoomstart",u)).fire(new o.k("zoom",u)).fire(new o.k("zoomend",u)),y&&this.fire(new o.k("rotatestart",u)).fire(new o.k("rotate",u)).fire(new o.k("rotateend",u)),B&&this.fire(new o.k("pitchstart",u)).fire(new o.k("pitch",u)).fire(new o.k("pitchend",u)),S&&this.fire(new o.k("rollstart",u)).fire(new o.k("roll",u)).fire(new o.k("rollend",u)),this.fire(new o.k("moveend",u))}calculateCameraOptionsFromTo(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const B=o.Y.fromLngLat(l,u),S=o.Y.fromLngLat(g,y),L=S.x-B.x,O=S.y-B.y,Q=S.z-B.z,q=Math.hypot(L,O,Q);if(q===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(L,O),J=o.a8(this.transform.cameraToCenterDistance/q/this.transform.tileSize),At=180*Math.atan2(L,-O)/Math.PI;let gt=180*Math.acos(Z/q)/Math.PI;return gt=Q<0?90-gt:90+gt,{center:S.toLngLat(),elevation:y,zoom:J,pitch:gt,bearing:At}}calculateCameraOptionsFromCameraLngLatAltRotation(l,u,g,y,B){const S=this.transform.calculateCenterFromCameraLngLatAlt(l,u,g,y);return{center:S.center,elevation:S.elevation,zoom:S.zoom,bearing:g,pitch:y,roll:B}}easeTo(l,u){this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.c8},l)).animate===!1||!l.essential&&C.prefersReducedMotion)&&(l.duration=0);const g=this._getTransformForUpdate(),y=this.getBearing(),B=g.pitch,S=g.roll,L="bearing"in l?this._normalizeBearing(l.bearing,y):y,O="pitch"in l?+l.pitch:B,Q="roll"in l?this._normalizeBearing(l.roll,S):S,q="padding"in l?l.padding:g.padding,Z=o.P.convert(l.offset);let J,At;l.around&&(J=o.N.convert(l.around),At=g.locationToScreenPoint(J));const gt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Lt=this.cameraHelper.handleEaseTo(g,{bearing:L,pitch:O,roll:Q,padding:q,around:J,aroundPoint:At,offsetAsPoint:Z,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||y!==L,this._pitching=this._pitching||O!==B,this._rolling=this._rolling||Q!==S,this._padding=!g.isPaddingEqual(q),this._zooming=this._zooming||Lt.isZooming,this._easeId=l.easeId,this._prepareEase(u,l.noMoveStart,gt),this.terrain&&this._prepareElevation(Lt.elevationCenter),this._ease(Ft=>{Lt.easeFunc(Ft),this.terrain&&!l.freezeElevation&&this._updateElevation(Ft),this._applyUpdatedTransform(g),this._fireMoveEvents(u)},Ft=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Ft)},l),this}_prepareEase(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,u||g.moving||this.fire(new o.k("movestart",l)),this._zooming&&!g.zooming&&this.fire(new o.k("zoomstart",l)),this._rotating&&!g.rotating&&this.fire(new o.k("rotatestart",l)),this._pitching&&!g.pitching&&this.fire(new o.k("pitchstart",l)),this._rolling&&!g.rolling&&this.fire(new o.k("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&u!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(g-(u-(g*l+this._elevationStart))/(1-l)),this._elevationTarget=u}this.transform.setElevation(o.y.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const u=l.getCameraLngLat(),g=l.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(u,l.zoom):0;if(g<y){const B=this.calculateCameraOptionsFromTo(u,y,l.center,l.elevation);return{pitch:B.pitch,zoom:B.zoom}}return{}}_applyUpdatedTransform(l){const u=[];if(u.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&u.push(y=>this.transformCameraUpdate(y)),!u.length)return;const g=l.clone();for(const y of u){const B=g.clone(),{center:S,zoom:L,roll:O,pitch:Q,bearing:q,elevation:Z}=y(B);S&&B.setCenter(S),Z!==void 0&&B.setElevation(Z),L!==void 0&&B.setZoom(L),O!==void 0&&B.setRoll(O),Q!==void 0&&B.setPitch(Q),q!==void 0&&B.setBearing(q),g.apply(B)}this.transform.apply(g)}_fireMoveEvents(l){this.fire(new o.k("move",l)),this._zooming&&this.fire(new o.k("zoom",l)),this._rotating&&this.fire(new o.k("rotate",l)),this._pitching&&this.fire(new o.k("pitch",l)),this._rolling&&this.fire(new o.k("roll",l))}_afterEase(l,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const g=this._zooming,y=this._rotating,B=this._pitching,S=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,g&&this.fire(new o.k("zoomend",l)),y&&this.fire(new o.k("rotateend",l)),B&&this.fire(new o.k("pitchend",l)),S&&this.fire(new o.k("rollend",l)),this.fire(new o.k("moveend",l))}flyTo(l,u){if(!l.essential&&C.prefersReducedMotion){const Le=o.M(l,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Le,u)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.c8},l);const g=this._getTransformForUpdate(),y=g.bearing,B=g.pitch,S=g.roll,L=g.padding,O="bearing"in l?this._normalizeBearing(l.bearing,y):y,Q="pitch"in l?+l.pitch:B,q="roll"in l?this._normalizeBearing(l.roll,S):S,Z="padding"in l?l.padding:g.padding,J=o.P.convert(l.offset);let At=g.centerPoint.add(J);const gt=g.screenPointToLocation(At),Lt=this.cameraHelper.handleFlyTo(g,{bearing:O,pitch:Q,roll:q,padding:Z,locationAtOffset:gt,offsetAsPoint:J,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let Ft=l.curve;const Ot=Math.max(g.width,g.height),kt=Ot/Lt.scaleOfZoom,qt=Lt.pixelPathLength;typeof Lt.scaleOfMinZoom=="number"&&(Ft=Math.sqrt(Ot/Lt.scaleOfMinZoom/qt*2));const $t=Ft*Ft;function Jt(Le){const fr=(kt*kt-Ot*Ot+(Le?-1:1)*$t*$t*qt*qt)/(2*(Le?kt:Ot)*$t*qt);return Math.log(Math.sqrt(fr*fr+1)-fr)}function ne(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function se(Le){return(Math.exp(Le)+Math.exp(-Le))/2}const Te=Jt(!1);let Ce=function(Le){return se(Te)/se(Te+Ft*Le)},Oe=function(Le){return Ot*((se(Te)*(ne(fr=Te+Ft*Le)/se(fr))-ne(Te))/$t)/qt;var fr},ze=(Jt(!0)-Te)/Ft;if(Math.abs(qt)<2e-6||!isFinite(ze)){if(Math.abs(Ot-kt)<1e-6)return this.easeTo(l,u);const Le=kt<Ot?-1:1;ze=Math.abs(Math.log(kt/Ot))/Ft,Oe=()=>0,Ce=fr=>Math.exp(Le*Ft*fr)}return l.duration="duration"in l?+l.duration:1e3*ze/("screenSpeed"in l?+l.screenSpeed/Ft:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=y!==O,this._pitching=Q!==B,this._rolling=q!==S,this._padding=!g.isPaddingEqual(Z),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Lt.targetCenter),this._ease(Le=>{const fr=Le*ze,Ar=1/Ce(fr),Ke=Oe(fr);this._rotating&&g.setBearing(o.y.number(y,O,Le)),this._pitching&&g.setPitch(o.y.number(B,Q,Le)),this._rolling&&g.setRoll(o.y.number(S,q,Le)),this._padding&&(g.interpolatePadding(L,Z,Le),At=g.centerPoint.add(J)),Lt.easeFunc(Le,Ar,Ke,At),this.terrain&&!l.freezeElevation&&this._updateElevation(Le),this._applyUpdatedTransform(g),this._fireMoveEvents(u)},()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,u){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,u)}return l||(g=this.handlers)===null||g===void 0||g.stop(!1),this}_ease(l,u,g){g.animate===!1||g.duration===0?(l(1),u()):(this._easeStart=C.now(),this._easeOptions=g,this._onEaseFrame=l,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,u){l=o.aI(l,-180,180);const g=Math.abs(l-u);return Math.abs(l-360-u)<g&&(l-=360),Math.abs(l+360-u)<g&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(l),this.transform.tileZoom):null}}const Tr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Jr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Tr;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(l,u){const g=this._map._getUIString(`AttributionControl.${u}`);l.title=g,l.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style.sourceCaches;for(const y in u){const B=u[y];if(B.used||B.usedForTerrain){const S=B.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l=l.filter(y=>String(y).trim()),l.sort((y,B)=>y.length-B.length),l=l.filter((y,B)=>{for(let S=B+1;S<l.length;S++)if(l[S].indexOf(y)>=0)return!1;return!0});const g=l.join(" | ");g!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=b.sanitize(g),l.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const u=this._container.children;if(u.length){const g=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const u=b.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const u=++this._id;return this._queue.push({callback:l,id:u,cancelled:!1}),u}remove(l){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const y of g)if(y.id===l)return void(y.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Yn=o.aA([{name:"a_pos3d",type:"Int16",components:3}]);class _n extends o.E{constructor(l){super(),this._lastTilesetChange=C.now(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,u){this.sourceCache.update(l,u),this._renderableTilesKeys=[];const g={};for(const y of Bt(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))g[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),o.bL(y.terrainRttPosMatrix32f,0,o.X,o.X,0,0,1),this._tiles[y.key]=new Nr(y,this.tileSize),this._lastTilesetChange=C.now());for(const y in this._tiles)g[y]||delete this._tiles[y]}freeRtt(l){for(const u in this._tiles){const g=this._tiles[u];(!l||g.tileID.equals(l)||g.tileID.isChildOf(l)||l.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const u={};for(const g of this._renderableTilesKeys){const y=this._tiles[g].tileID,B=l.clone(),S=o.a$();if(y.canonical.equals(l.canonical))o.bL(S,0,o.X,o.X,0,0,1);else if(y.canonical.isChildOf(l.canonical)){const L=y.canonical.z-l.canonical.z,O=y.canonical.x-(y.canonical.x>>L<<L),Q=y.canonical.y-(y.canonical.y>>L<<L),q=o.X>>L;o.bL(S,0,q,q,0,0,1),o.J(S,S,[-O*q,-Q*q,0])}else{if(!l.canonical.isChildOf(y.canonical))continue;{const L=l.canonical.z-y.canonical.z,O=l.canonical.x-(l.canonical.x>>L<<L),Q=l.canonical.y-(l.canonical.y>>L<<L),q=o.X>>L;o.bL(S,0,o.X,o.X,0,0,1),o.J(S,S,[O*q,Q*q,0]),o.K(S,S,[1/2**L,1/2**L,0])}}B.terrainRttPosMatrix32f=new Float32Array(S),u[g]=B}return u}getSourceTile(l,u){const g=this.sourceCache._source;let y=l.overscaledZ-this.deltaZoom;if(y>g.maxzoom&&(y=g.maxzoom),y<g.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(y).key);let B=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!B||!B.dem)&&u)for(;y>=g.minzoom&&(!B||!B.dem);)B=this.sourceCache.getTileByID(l.scaledTo(y--).key);return B}anyTilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return this._lastTilesetChange>=l}}class On{constructor(l,u,g){this._meshCache={},this.painter=l,this.sourceCache=new _n(u),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;var B;if(!(u>=0&&u<y&&g>=0&&g<y))return 0;const S=this.getTerrainData(l),L=(B=S.tile)===null||B===void 0?void 0:B.dem;if(!L)return 0;const O=o.c9([],[u/y*o.X,g/y*o.X],S.u_terrain_matrix),Q=[O[0]*L.dim,O[1]*L.dim],q=Math.floor(Q[0]),Z=Math.floor(Q[1]),J=Q[0]-q,At=Q[1]-Z;return L.get(q,Z)*(1-J)*(1-At)+L.get(q+1,Z)*J*(1-At)+L.get(q,Z+1)*(1-J)*At+L.get(q+1,Z+1)*J*At}getElevationForLngLatZoom(l,u){if(!o.ca(u,l.wrap()))return 0;const{tileID:g,mercatorX:y,mercatorY:B}=this._getOverscaledTileIDFromLngLatZoom(l,u);return this.getElevation(g,y%o.X,B%o.X,o.X)}getElevation(l,u,g){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.X;return this.getDEMElevation(l,u,g,y)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const y=this.painter.context,B=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new nt(y,B,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new nt(y,new o.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.aq([])}const u=this.sourceCache.getSourceTile(l,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const y=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new nt(y,u.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),u.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const g=u&&u+u.tileID.key+l.key;if(g&&!this._demMatrixCache[g]){const y=this.sourceCache.sourceCache._source.maxzoom;let B=l.canonical.z-u.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=y?B=l.canonical.z-y:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=l.canonical.x-(l.canonical.x>>B<<B),L=l.canonical.y-(l.canonical.y>>B<<B),O=o.cb(new Float64Array(16),[1/(o.X<<B),1/(o.X<<B),0]);o.J(O,O,[S*o.X,L*o.X,0]),this._demMatrixCache[l.key]={matrix:O,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(l){const u=this.painter,g=u.width/devicePixelRatio,y=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new nt(u.context,{width:g,height:y,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new nt(u.context,{width:g,height:y,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(g,y,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,g,y))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let B=0,S=0;B<this._coordsTextureSize;B++)for(let L=0;L<this._coordsTextureSize;L++,S+=4)u[S+0]=255&L,u[S+1]=255&B,u[S+2]=L>>8<<4|B>>8,u[S+3]=0;const g=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),y=new nt(l,g,l.gl.RGBA,{premultiply:!1});return y.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),g=this.painter.context,y=g.gl,B=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),L=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(B,L-S-1,1,1,y.RGBA,y.UNSIGNED_BYTE,u),g.bindFramebuffer.set(null);const O=u[0]+(u[2]>>4<<8),Q=u[1]+((15&u[2])<<8),q=this.coordsIndex[255-u[3]],Z=q&&this.sourceCache.getTileByID(q);if(!Z)return null;const J=this._coordsTextureSize,At=(1<<Z.tileID.canonical.z)*J;return new o.Y((Z.tileID.canonical.x*J+O)/At+Z.tileID.wrap,(Z.tileID.canonical.y*J+Q)/At,this.getElevation(Z.tileID,O,Q,J))}depthAtPoint(l){const u=new Uint8Array(4),g=this.painter.context,y=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,u),g.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(l){var u;const g=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,y=g&&l.canonical.y===0,B=g&&l.canonical.y===(1<<l.canonical.z)-1,S=`m_${y?"n":""}_${B?"s":""}`;if(this._meshCache[S])return this._meshCache[S];const L=this.painter.context,O=new o.cc,Q=new o.aE,q=this.meshSize,Z=o.X/q,J=q*q;for(let se=0;se<=q;se++)for(let Te=0;Te<=q;Te++)O.emplaceBack(Te*Z,se*Z,0);for(let se=0;se<J;se+=q+1)for(let Te=0;Te<q;Te++)Q.emplaceBack(Te+se,q+Te+se+1,q+Te+se+2),Q.emplaceBack(Te+se,q+Te+se+2,Te+se+1);const At=O.length,gt=At+(q+1),Lt=(q+1)*q,Ft=y?o.b6:0,Ot=y?0:1,kt=B?o.b7:o.X,qt=B?0:1;for(let se=0;se<=q;se++)O.emplaceBack(se*Z,Ft,Ot);for(let se=0;se<=q;se++)O.emplaceBack(se*Z,kt,qt);for(let se=0;se<q;se++)Q.emplaceBack(Lt+se,gt+se,gt+se+1),Q.emplaceBack(Lt+se,gt+se+1,Lt+se+1),Q.emplaceBack(0+se,At+se+1,At+se),Q.emplaceBack(0+se,0+se+1,At+se+1);const $t=O.length,Jt=$t+2*(q+1);for(const se of[0,1])for(let Te=0;Te<=q;Te++)for(const Ce of[0,1])O.emplaceBack(se*o.X,Te*Z,Ce);for(let se=0;se<2*q;se+=2)Q.emplaceBack($t+se,$t+se+1,$t+se+3),Q.emplaceBack($t+se,$t+se+3,$t+se+2),Q.emplaceBack(Jt+se,Jt+se+3,Jt+se+1),Q.emplaceBack(Jt+se,Jt+se+2,Jt+se+3);const ne=new ks(L.createVertexBuffer(O,Yn.members),L.createIndexBuffer(Q),o.aD.simpleSegment(0,0,O.length,Q.length));return this._meshCache[S]=ne,ne}getMeshFrameDelta(l){return 2*Math.PI*o.bo/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,u){var g;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(l,u);return(g=this.getMinMaxElevation(y).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(l){const u=this.getTerrainData(l).tile,g={minElevation:null,maxElevation:null};return u&&u.dem&&(g.minElevation=u.dem.min*this.exaggeration,g.maxElevation=u.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(l,u){const g=o.Y.fromLngLat(l.wrap()),y=(1<<u)*o.X,B=g.x*y,S=g.y*y,L=Math.floor(B/o.X),O=Math.floor(S/o.X);return{tileID:new o.S(u,0,u,L,O),mercatorX:B,mercatorY:S}}}class Kn{constructor(l,u,g){this._context=l,this._size=u,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(g.texture),{id:l,fbo:u,texture:g,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>l.id!==u),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const tn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class jr{constructor(l,u){this.painter=l,this.terrain=u,this.pool=new Kn(l.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(g=>!l._layers[g].isHidden(u)),this._coordsAscending={};for(const g in l.sourceCaches){this._coordsAscending[g]={};const y=l.sourceCaches[g].getVisibleCoordinates();for(const B of y){const S=this.terrain.sourceCache.getTerrainCoords(B);for(const L in S)this._coordsAscending[g][L]||(this._coordsAscending[g][L]=[]),this._coordsAscending[g][L].push(S[L])}}this._coordsAscendingStr={};for(const g of l._order){const y=l._layers[g],B=y.source;if(tn[y.type]&&!this._coordsAscendingStr[B]){this._coordsAscendingStr[B]={};for(const S in this._coordsAscending[B])this._coordsAscendingStr[B][S]=this._coordsAscending[B][S].map(L=>L.key).sort().join()}}for(const g of this._renderableTiles)for(const y in this._coordsAscendingStr){const B=this._coordsAscendingStr[y][g.tileID.key];B&&B!==g.rttCoords[y]&&(g.rtt=[])}}renderLayer(l,u){if(l.isHidden(this.painter.transform.zoom))return!1;const g=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),y=l.type,B=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(tn[y]&&(this._prevType&&tn[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(l.id),!S))return!0;if(tn[this._prevType]||tn[y]&&S){this._prevType=y;const L=this._stacks.length-1,O=this._stacks[L]||[];for(const Q of this._renderableTiles){if(this.pool.isFull()&&(jd(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Q),Q.rtt[L]){const Z=this.pool.getObjectForId(Q.rtt[L].id);if(Z.stamp===Q.rtt[L].stamp){this.pool.useObject(Z);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),Q.rtt[L]={id:q.id,stamp:q.stamp},B.context.bindFramebuffer.set(q.fbo.framebuffer),B.context.clear({color:o.b4.transparent,stencil:0}),B.currentStencilSource=void 0;for(let Z=0;Z<O.length;Z++){const J=B.style._layers[O[Z]],At=J.source?this._coordsAscending[J.source][Q.tileID.key]:[Q.tileID];B.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),B._renderTileClippingMasks(J,At,!0),B.renderLayer(B,B.style.sourceCaches[J.source],J,At,g),J.source&&(Q.rttCoords[J.source]=this._coordsAscendingStr[J.source][Q.tileID.key])}}return jd(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects(),tn[y]}return!1}}const Yi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bs=d,Mi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Tr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},io={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Wn{constructor(l,u){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=B=>{this.startMove(B,b.mousePos(this.element,B)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.move(B,b.mousePos(this.element,B))},this.mouseup=B=>{this._rotatePitchHanlder.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,B.targetTouches)[0],this.startMove(B,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,B.targetTouches)[0],this.move(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const y=new Zh;this._rotatePitchHanlder=new Sr({clickTolerance:3,move:(B,S)=>{const L=u.getBoundingClientRect(),O=new o.P((L.bottom-L.top)/2,(L.right-L.left)/2);return{bearingDelta:o.c7(new o.P(B.x,S.y),S,O),pitchDelta:g?-.5*(S.y-B.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=l,b.addEventListener(u,"mousedown",this.mousedown),b.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(u,"touchcancel",this.reset)}startMove(l,u){this._rotatePitchHanlder.dragStart(l,u),b.disableDrag()}move(l,u){const g=this.map,{bearingDelta:y,pitchDelta:B}=this._rotatePitchHanlder.dragMove(l,u)||{};y&&g.setBearing(g.getBearing()+y),B&&g.setPitch(g.getPitch()+B)}off(){const l=this.element;b.removeEventListener(l,"mousedown",this.mousedown),b.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let Ji;function Cs(w,l,u){const g=new o.N(w.lng,w.lat);if(w=new o.N(w.lng,w.lat),l){const y=new o.N(w.lng-360,w.lat),B=new o.N(w.lng+360,w.lat),S=u.locationToScreenPoint(w).distSqr(l);u.locationToScreenPoint(y).distSqr(l)<S?w=y:u.locationToScreenPoint(B).distSqr(l)<S&&(w=B)}for(;Math.abs(w.lng-u.center.lng)>180;){const y=u.locationToScreenPoint(w);if(y.x>=0&&y.y>=0&&y.x<=u.width&&y.y<=u.height)break;w.lng>u.center.lng?w.lng-=360:w.lng+=360}return w.lng!==g.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(w))?w:g}const qi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function os(w,l,u){const g=w.classList;for(const y in qi)g.remove(`maplibregl-${u}-anchor-${y}`);g.add(`maplibregl-${u}-anchor-${l}`)}class us extends o.E{constructor(l){if(super(),this._onKeyPress=u=>{const g=u.code,y=u.charCode||u.keyCode;g!=="Space"&&g!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=u=>{const g=u.originalEvent.target,y=this._element;this._popup&&(g===y||y.contains(g))&&this.togglePopup()},this._update=u=>{var g;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Cs(this._lngLat,this._flatPos,this._map.transform):(g=this._lngLat)===null||g===void 0?void 0:g.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let B="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?B=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(B=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${qi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${B}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div");const u=b.createNS("http://www.w3.org/2000/svg","svg"),g=41,y=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${g}px`),u.setAttributeNS(null,"width",`${y}px`),u.setAttributeNS(null,"viewBox",`0 0 ${y} ${g}`);const B=b.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"stroke","none"),B.setAttributeNS(null,"stroke-width","1"),B.setAttributeNS(null,"fill","none"),B.setAttributeNS(null,"fill-rule","evenodd");const S=b.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const L=b.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ot of O){const kt=b.createNS("http://www.w3.org/2000/svg","ellipse");kt.setAttributeNS(null,"opacity","0.04"),kt.setAttributeNS(null,"cx","10.5"),kt.setAttributeNS(null,"cy","5.80029008"),kt.setAttributeNS(null,"rx",Ot.rx),kt.setAttributeNS(null,"ry",Ot.ry),L.appendChild(kt)}const Q=b.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const q=b.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(q);const Z=b.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const J=b.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(J);const At=b.createNS("http://www.w3.org/2000/svg","g");At.setAttributeNS(null,"transform","translate(6.0, 7.0)"),At.setAttributeNS(null,"fill","#FFFFFF");const gt=b.createNS("http://www.w3.org/2000/svg","g");gt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Lt=b.createNS("http://www.w3.org/2000/svg","circle");Lt.setAttributeNS(null,"fill","#000000"),Lt.setAttributeNS(null,"opacity","0.25"),Lt.setAttributeNS(null,"cx","5.5"),Lt.setAttributeNS(null,"cy","5.5"),Lt.setAttributeNS(null,"r","5.4999962");const Ft=b.createNS("http://www.w3.org/2000/svg","circle");Ft.setAttributeNS(null,"fill","#FFFFFF"),Ft.setAttributeNS(null,"cx","5.5"),Ft.setAttributeNS(null,"cy","5.5"),Ft.setAttributeNS(null,"r","5.4999962"),gt.appendChild(Lt),gt.appendChild(Ft),S.appendChild(L),S.appendChild(Q),S.appendChild(Z),S.appendChild(At),S.appendChild(gt),u.appendChild(S),u.setAttributeNS(null,"height",g*this._scale+"px"),u.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(u),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),os(this._element,this._anchor,"marker"),l&&l.className)for(const u of l.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.N.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const y=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var u,g;if(!(!((u=this._map)===null||u===void 0)&&u.terrain)){const Z=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,B=y.terrain.depthAtPoint(this._pos),S=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,S)-B<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/y.transform.pixelsPerMeter,O=Math.sin(y.getPitch()*Math.PI/180)*L,Q=y.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),q=y.transform.lngLatToCameraDepth(this._lngLat,S+O)-Q>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,u){return l===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const No={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mo=0,Fi=!1;const Ha={maxWidth:100,unit:"metric"};function Al(w,l,u){const g=u&&u.maxWidth||100,y=w._container.clientHeight/2,B=w._container.clientWidth/2,S=w.unproject([B-g/2,y]),L=w.unproject([B+g/2,y]),O=Math.round(w.project(L).x-w.project(S).x),Q=Math.min(g,O,w._container.clientWidth),q=S.distanceTo(L);if(u&&u.unit==="imperial"){const Z=3.2808*q;Z>5280?Jo(l,Q,Z/5280,w._getUIString("ScaleControl.Miles")):Jo(l,Q,Z,w._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Jo(l,Q,q/1852,w._getUIString("ScaleControl.NauticalMiles")):q>=1e3?Jo(l,Q,q/1e3,w._getUIString("ScaleControl.Kilometers")):Jo(l,Q,q,w._getUIString("ScaleControl.Meters"))}function Jo(w,l,u,g){const y=function(B){const S=Math.pow(10,`${Math.floor(B)}`.length-1);let L=B/S;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(O){const Q=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*Q)/Q}(L),S*L}(u);w.style.width=l*(y/u)+"px",w.innerHTML=`${y}&nbsp;${g}`}const dl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Li=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wu(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,w),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-w),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(w,0),right:new o.P(-w,0)}}if(w instanceof o.P||Array.isArray(w)){const l=o.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(w.center||[0,0]),top:o.P.convert(w.top||[0,0]),"top-left":o.P.convert(w["top-left"]||[0,0]),"top-right":o.P.convert(w["top-right"]||[0,0]),bottom:o.P.convert(w.bottom||[0,0]),"bottom-left":o.P.convert(w["bottom-left"]||[0,0]),"bottom-right":o.P.convert(w["bottom-right"]||[0,0]),left:o.P.convert(w.left||[0,0]),right:o.P.convert(w.right||[0,0])}}return wu(new o.P(0,0))}const jA=d;a.AJAXError=o.cg,a.Event=o.k,a.Evented=o.E,a.LngLat=o.N,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.ch,a.config=o.a,a.removeProtocol=o.ci,a.AttributionControl=Jr,a.BoxZoomHandler=oh,a.CanvasSource=gr,a.CooperativeGesturesHandler=Ae,a.DoubleClickZoomHandler=ue,a.DragPanHandler=_e,a.DragRotateHandler=Ze,a.EdgeInsets=Gr,a.FullscreenControl=class extends o.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var l;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=u==null?void 0:u.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=$e,a.GeolocateControl=class extends o.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const u=new o.N(l.coords.longitude,l.coords.latitude),g=l.coords.accuracy,y=this._map.getBearing(),B=o.e({bearing:y},this.options.fitBoundsOptions),S=mr.fromLngLat(u,g);this._map.fitBounds(S,B,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const u=new o.N(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Fi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new us({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new us({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},No,w)}onAdd(w){return this._map=w,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Ji!==void 0&&!l)return Ji;if(window.navigator.permissions===void 0)return Ji=!!window.navigator.geolocation,Ji;try{Ji=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ji=!!window.navigator.geolocation}return Ji}()})}().then(l=>this._finishSetupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mo=0,Fi=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),u=w.coords;return l&&(u.longitude<l.getWest()||u.longitude>l.getEast()||u.latitude<l.getSouth()||u.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),u=w.getNorthEast(),g=l.distanceTo(u),y=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mo--,Fi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mo++,mo>1?(w={maximumAge:6e5,timeout:0},Fi=!0):(w=this.options.positionOptions,Fi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.GlobeControl=class{constructor(){this._toggleProjection=()=>{var w;const l=(w=this._map.getProjection())===null||w===void 0?void 0:w.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var w;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((w=this._map.getProjection())===null||w===void 0?void 0:w.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(w){return this._map=w,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=b.create("button","maplibregl-ctrl-globe",this._container),b.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},a.Hash=ul,a.ImageSource=Xe,a.KeyboardHandler=_t,a.LngLatBounds=mr,a.LogoControl=Pr,a.Map=class extends Ge{constructor(w){var l,u;o.cd.mark(o.ce.create);const g=Object.assign(Object.assign(Object.assign({},Mi),w),{canvasContextAttributes:Object.assign(Object.assign({},Mi.canvasContextAttributes),w.canvasContextAttributes)});if(g.minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new en,B=new Zc;if(g.minZoom!==void 0&&y.setMinZoom(g.minZoom),g.maxZoom!==void 0&&y.setMaxZoom(g.maxZoom),g.minPitch!==void 0&&y.setMinPitch(g.minPitch),g.maxPitch!==void 0&&y.setMaxPitch(g.maxPitch),g.renderWorldCopies!==void 0&&y.setRenderWorldCopies(g.renderWorldCopies),super(y,B,{bearingSnap:g.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new pn,this._controls=[],this._mapId=o.a1(),this._contextLost=L=>{L.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:L}))},this._contextRestored=L=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:L}))},this._onMapScroll=L=>{if(L.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},g.canvasContextAttributes),this._trackResize=g.trackResize===!0,this._bearingSnap=g.bearingSnap,this._centerClampedToGround=g.centerClampedToGround,this._refreshExpiredTiles=g.refreshExpiredTiles===!0,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions===!0,this._collectResourceTiming=g.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yi),g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=g.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=G.addThrottleControl(()=>this.isMoving()),this._requestManager=new X(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let L=!1;const O=gc(Q=>{this._trackResize&&!this._removed&&(this.resize(Q),this.redraw())},50);this._resizeObserver=new ResizeObserver(Q=>{L?O(Q):L=!0}),this._resizeObserver.observe(this._container)}this.handlers=new we(this,g),this._hash=g.hash&&new ul(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,roll:g.roll}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.e({},g.fitBoundsOptions,{duration:0}))));const S=typeof g.style=="string"||((u=(l=g.style)===null||l===void 0?void 0:l.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,S),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Jr(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new Pr,g.logoPosition),this.on("style.load",()=>{if(S||this._resizeTransform(),this.transform.unmodified){const L=o.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(L)}}),this.on("data",L=>{this._update(L.dataType==="style"),this.fire(new o.k(`${L.dataType}data`,L))}),this.on("dataloading",L=>{this.fire(new o.k(`${L.dataType}dataloading`,L))}),this.on("dataabort",L=>{this.fire(new o.k("sourcedataabort",L))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=w.onAdd(this);this._controls.push(w);const g=this._controlPositions[l];return l.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,u,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,u,g)}resize(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const[u,g]=this._containerDimensions(),y=this._getClampedPixelRatio(u,g);if(this._resizeCanvas(u,g,y),this.painter.resize(u,g,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const L=this._getClampedPixelRatio(u,g);this._resizeCanvas(u,g,L),this.painter.resize(u,g,L)}this._resizeTransform(l);const B=!this._moving;return B&&(this.stop(),this.fire(new o.k("movestart",w)).fire(new o.k("move",w))),this.fire(new o.k("resize",w)),B&&this.fire(new o.k("moveend",w)),this}_resizeTransform(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;var l;const[u,g]=this._containerDimensions();this.transform.resize(u,g,w),(l=this._requestedCameraState)===null||l===void 0||l.resize(u,g,w)}_getClampedPixelRatio(w,l){const{0:u,1:g}=this._maxCanvasSize,y=this.getPixelRatio(),B=w*y,S=l*y;return Math.min(B>u?u/B:1,S>g?g/S:1)*y}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(mr.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.setMinZoom(w),this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.setMaxZoom(w),this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.setMinPitch(w),this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(w>=this.transform.minPitch)return this.transform.setMaxPitch(w),this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.setRenderWorldCopies(w),this._update()}project(w){return this.transform.locationToScreenPoint(o.N.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.screenPointToLocation(o.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,u){if(w==="mouseenter"||w==="mouseover"){let g=!1;return{layers:l,listener:u,delegates:{mousemove:B=>{const S=l.filter(O=>this.getLayer(O)),L=S.length!==0?this.queryRenderedFeatures(B.point,{layers:S}):[];L.length?g||(g=!0,u.call(this,new Di(w,this,B.originalEvent,{features:L}))):g=!1},mouseout:()=>{g=!1}}}}if(w==="mouseleave"||w==="mouseout"){let g=!1;return{layers:l,listener:u,delegates:{mousemove:S=>{const L=l.filter(O=>this.getLayer(O));(L.length!==0?this.queryRenderedFeatures(S.point,{layers:L}):[]).length?g=!0:g&&(g=!1,u.call(this,new Di(w,this,S.originalEvent)))},mouseout:S=>{g&&(g=!1,u.call(this,new Di(w,this,S.originalEvent)))}}}}{const g=y=>{const B=l.filter(L=>this.getLayer(L)),S=B.length!==0?this.queryRenderedFeatures(y.point,{layers:B}):[];S.length&&(y.features=S,u.call(this,y),delete y.features)};return{layers:l,listener:u,delegates:{[w]:g}}}}_saveDelegatedListener(w,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(l)}_removeDelegatedListener(w,l,u){if(!this._delegatedListeners||!this._delegatedListeners[w])return;const g=this._delegatedListeners[w];for(let y=0;y<g.length;y++){const B=g[y];if(B.listener===u&&B.layers.length===l.length&&B.layers.every(S=>l.includes(S))){for(const S in B.delegates)this.off(S,B.delegates[S]);return void g.splice(y,1)}}}on(w,l,u){if(u===void 0)return super.on(w,l);const g=typeof l=="string"?[l]:l,y=this._createDelegatedListener(w,g,u);this._saveDelegatedListener(w,y);for(const B in y.delegates)this.on(B,y.delegates[B]);return{unsubscribe:()=>{this._removeDelegatedListener(w,g,u)}}}once(w,l,u){var g=this;if(u===void 0)return super.once(w,l);const y=typeof l=="string"?[l]:l,B=this._createDelegatedListener(w,y,u);for(const S in B.delegates){const L=B.delegates[S];B.delegates[S]=function(){g._removeDelegatedListener(w,y,u),L(...arguments)}}this._saveDelegatedListener(w,B);for(const S in B.delegates)this.once(S,B.delegates[S]);return this}off(w,l,u){return u===void 0?super.off(w,l):(this._removeDelegatedListener(w,typeof l=="string"?[l]:l,u),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let u;const g=w instanceof o.P||Array.isArray(w),y=g?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(g?{}:w)||{},y instanceof o.P||typeof y[0]=="number")u=[o.P.convert(y)];else{const B=o.P.convert(y[0]),S=o.P.convert(y[1]);u=[B,new o.P(S.x,B.y),S,new o.P(B.x,S.y),B]}return this.style.queryRenderedFeatures(u,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){var u,g;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const y=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Hs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,y):this.style.loadJSON(w,l,y),this):((g=(u=this.style)===null||u===void 0?void 0:u.projection)===null||g===void 0||g.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const u=this._requestManager.transformRequest(w,"Style");o.h(u,new AbortController).then(g=>{this._updateDiff(g.data,l)}).catch(g=>{g&&this.fire(new o.j(g))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(u){o.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new o.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const u in this.style._layers){const g=this.style._layers[u];g.type==="hillshade"&&g.source===w.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new On(this.painter,l,w),this.painter.renderToTexture=new jr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==w.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const u=w[l]._tiles;for(const g in u){const y=u[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:g=1,sdf:y=!1,stretchX:B,stretchY:S,content:L,textFitWidth:O,textFitHeight:Q}=u;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:Z,data:J}=l,At=l;return this.style.addImage(w,{data:new o.R({width:q,height:Z},new Uint8Array(J)),pixelRatio:g,stretchX:B,stretchY:S,content:L,textFitWidth:O,textFitHeight:Q,sdf:y,version:0,userImage:At}),At.onAdd&&At.onAdd(this,w),this}}{const{width:q,height:Z,data:J}=C.getImageData(l);this.style.addImage(w,{data:new o.R({width:q,height:Z},J),pixelRatio:g,stretchX:B,stretchY:S,content:L,textFitWidth:O,textFitHeight:Q,sdf:y,version:0})}}updateImage(w,l){const u=this.style.getImage(w);if(!u)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=l instanceof HTMLImageElement||o.b(l)?C.getImageData(l):l,{width:y,height:B,data:S}=g;if(y===void 0||B===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==u.data.width||B!==u.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(l instanceof HTMLImageElement||o.b(l));return u.data.replace(S,L),this.style.updateImage(w,u),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return G.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,u){return this.style.setLayerZoomRange(w,l,u),this._update(!0)}setFilter(w,l){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,l,u),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,u){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,l,u,g),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,u){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,l,u,g),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,u,g=>{g||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,u=>{u||this._update(!0)}),this}setLight(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(w,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=b.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),g=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],g);const y=this._controlContainer=b.create("div","maplibregl-control-container",w),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{B[S]=b.create("div",`maplibregl-ctrl-${S} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,u){this._canvas.width=Math.floor(u*w),this._canvas.height=Math.floor(u*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{l={requestedAttributes:w},g&&(l.statusMessage=g.statusMessage,l.type=g.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,w):this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w),!u){const g="Failed to initialize WebGL";throw l?(l.message=g,new Error(JSON.stringify(l))):new Error(g)}this.painter=new dp(u,this.transform),P.testSupport(u)}migrateProjection(w,l){super.migrateProjection(w,l),this.painter.transform=w,this.fire(new o.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var l,u,g,y,B;const S=this._idleTriggered?this._fadeDuration:0,L=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,J=C.now();this.style.zoomHistory.update(Z,J);const At=new o.z(Z,{now:J,fadeDuration:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),gt=At.crossFadingFactor();gt===1&&gt===this._crossFadingFactor||(O=!0,this._crossFadingFactor=gt),this.style.update(At)}const Q=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==L;(g=this.style.projection)===null||g===void 0||g.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(B=this.style.projection)===null||B===void 0?void 0:B.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Q)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,Q),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cd.mark(o.ce.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const q=this._sourcesDirty||this._styleDirty||this._placementDirty;return q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||q||(this._fullyLoaded=!0,o.cd.mark(o.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l!=null&&l.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cd.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frame(this._frameRequest,w=>{o.cd.frame(w),this._frameRequest=null;try{this._render(w)}catch(l){if(!o.cf(l)&&!function(u){return u.message===dc}(l))throw l}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Bs}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(w){return this._lazyInitEmptyStyle(),this.style.setProjection(w),this._update(!0)}},a.MapMouseEvent=Di,a.MapTouchEvent=vu,a.MapWheelEvent=wa,a.Marker=us,a.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),u=l===this._map.getMaxZoom(),g=l===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,u)=>{const g=this._map._getUIString(`NavigationControl.${u}`);l.title=g,l.setAttribute("aria-label",g)},this.options=o.e({},io,w),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const u=b.create("button",w,this._container);return u.type="button",u.addEventListener("click",l),u}},a.Popup=class extends o.E{constructor(w){super(),this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const L of this.options.className.split(" "))this._container.classList.add(L);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Cs(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!l)return;const g=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let y=this.options.anchor;const B=wu(this.options.offset);if(!y){const L=this._container.offsetWidth,O=this._container.offsetHeight;let Q;Q=g.y+B.bottom.y<O?["top"]:g.y>this._map.transform.height-O?["bottom"]:[],g.x<L/2?Q.push("left"):g.x>this._map.transform.width-L/2&&Q.push("right"),y=Q.length===0?"bottom":Q.join("-")}let S=g.add(B[y]);this.options.subpixelPositioning||(S=S.round()),b.setTransform(this._container,`${qi[y]} translate(${S.x}px,${S.y}px)`),os(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(dl),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=o.N.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=w;g=u.firstChild,g;)l.appendChild(g);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Li);w&&w.focus()}},a.RasterDEMTileSource=Ir,a.RasterTileSource=Ur,a.ScaleControl=class{constructor(w){this._onMove=()=>{Al(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Al(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ha),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=Ut,a.Style=Hs,a.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=ut,a.TwoFingersTouchRotateHandler=H,a.TwoFingersTouchZoomHandler=T,a.TwoFingersTouchZoomRotateHandler=Ne,a.VectorTileSource=Qt,a.VideoSource=er,a.addSourceType=(w,l)=>o._(void 0,void 0,void 0,function*(){if(sr(w))throw new Error(`A source type called "${w}" already exists.`);((u,g)=>{Re[u]=g})(w,l)}),a.clearPrewarmedResources=function(){const w=Rt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(De),Rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.createTileMesh=Da,a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return Zr().getRTLTextPluginStatus()},a.getVersion=function(){return jA},a.getWorkerCount=function(){return at.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(w){return ye().broadcast("IS",w)},a.prewarm=function(){ae().acquire(De)},a.setMaxParallelImageRequests=function(w){o.a.MAX_PARALLEL_IMAGE_REQUESTS=w},a.setRTLTextPlugin=function(w,l){return Zr().setRTLTextPlugin(w,l)},a.setWorkerCount=function(w){at.workerCount=w},a.setWorkerUrl=function(w){o.a.WORKER_URL=w}});var s=e;return s})})(UT);var DT=UT.exports;const wo=Km(DT);var xo;(function(r){r[r.Unknown=0]="Unknown",r[r.Point=1]="Point",r[r.LineString=2]="LineString",r[r.Polygon=3]="Polygon",r[r.MultiPoint=4]="MultiPoint",r[r.MultiLineString=5]="MultiLineString",r[r.MultiPolygon=6]="MultiPolygon",r[r.GeometryCollection=7]="GeometryCollection",r[r.CircularString=8]="CircularString",r[r.CompoundCurve=9]="CompoundCurve",r[r.CurvePolygon=10]="CurvePolygon",r[r.MultiCurve=11]="MultiCurve",r[r.MultiSurface=12]="MultiSurface",r[r.Curve=13]="Curve",r[r.Surface=14]="Surface",r[r.PolyhedralSurface=15]="PolyhedralSurface",r[r.TIN=16]="TIN",r[r.Triangle=17]="Triangle"})(xo||(xo={}));const Lp=4,Rp=4,Op=4,nA=new Int32Array(2),NT=new Float32Array(nA.buffer),kT=new Float64Array(nA.buffer),Wm=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var P_;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(P_||(P_={}));class hh{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new hh(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return nA[0]=this.readInt32(t),NT[0]}readFloat64(t){return nA[Wm?0:1]=this.readInt32(t),nA[Wm?1:0]=this.readInt32(t+4),kT[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){NT[0]=e,this.writeInt32(t,nA[0])}writeFloat64(t,e){kT[0]=e,this.writeInt32(t,nA[Wm?0:1]),this.writeInt32(t+4,nA[Wm?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Lp+Rp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Rp;e++)t+=String.fromCharCode(this.readInt8(this.position_+Lp+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=Lp;const i=this.bytes_.subarray(t,t+n);return e===P_.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Lp}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Rp)throw new Error("FlatBuffers: file identifier must be length "+Rp);for(let e=0;e<Rp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Lp+e))return!1;return!0}createScalarList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s)}return n}createObjList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s.unpack())}return n}}let hQ=class fl{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new fl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+Op),(e||new fl).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):xo.Unknown}parts(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new fl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,xo.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,n,i,s,a,o,d,f){return fl.startGeometry(t),fl.addEnds(t,e),fl.addXy(t,n),fl.addZ(t,i),fl.addM(t,s),fl.addT(t,a),fl.addTm(t,o),fl.addType(t,d),fl.addParts(t,f),fl.endGeometry(t)}};function M_(r,t){const e=[];for(let n=0;n<r.length;n+=2){const i=[r[n],r[n+1]];t&&i.push(t[n>>1]),e.push(i)}return e}function QT(r,t,e){if(!e||e.length===0)return[M_(r,t)];let n=0;const i=Array.from(e).map(a=>r.slice(n,n=a<<1));let s;return t&&(n=0,s=Array.from(e).map(a=>t.slice(n,n=a))),i.map((a,o)=>M_(a,s?s[o]:void 0))}function AQ(r,t){const e=r.xyArray(),n=r.zArray();switch(t){case xo.Point:{const i=Array.from(e);return n&&i.push(n[0]),i}case xo.MultiPoint:case xo.LineString:return M_(e,n);case xo.MultiLineString:return QT(e,n,r.endsArray());case xo.Polygon:return QT(e,n,r.endsArray())}}function F_(r,t){let e=t;if(e===xo.Unknown&&(e=r.type()),e===xo.GeometryCollection){const i=[];for(let s=0;s<r.partsLength();s++){const a=r.parts(s),o=a.type();i.push(F_(a,o))}return{type:xo[e],geometries:i}}else if(e===xo.MultiPolygon){const i=[];for(let s=0;s<r.partsLength();s++)i.push(F_(r.parts(s),xo.Polygon));return{type:xo[e],coordinates:i.map(s=>s.coordinates)}}const n=AQ(r,e);return{type:xo[e],coordinates:n}}var Bo;(function(r){r[r.Byte=0]="Byte",r[r.UByte=1]="UByte",r[r.Bool=2]="Bool",r[r.Short=3]="Short",r[r.UShort=4]="UShort",r[r.Int=5]="Int",r[r.UInt=6]="UInt",r[r.Long=7]="Long",r[r.ULong=8]="ULong",r[r.Float=9]="Float",r[r.Double=10]="Double",r[r.String=11]="String",r[r.Json=12]="Json",r[r.DateTime=13]="DateTime",r[r.Binary=14]="Binary"})(Bo||(Bo={}));class Co{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new Co).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+Op),(e||new Co).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Bo.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,Bo.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,n,i,s,a,o,d,f,m,v,C){return Co.startColumn(t),Co.addName(t,e),Co.addType(t,n),Co.addTitle(t,i),Co.addDescription(t,s),Co.addWidth(t,a),Co.addPrecision(t,o),Co.addScale(t,d),Co.addNullable(t,f),Co.addUnique(t,m),Co.addPrimaryKey(t,v),Co.addMetadata(t,C),Co.endColumn(t)}}class bc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+Op),(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new hQ).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Co).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let n=e.length-1;n>=0;n--)t.addInt8(e[n]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,n,i){return bc.startFeature(t),bc.addGeometry(t,e),bc.addProperties(t,n),bc.addColumns(t,i),bc.endFeature(t)}}new TextEncoder;const zT=new TextDecoder;function dQ(r,t){const e={};if(!t||t.length===0)return e;const n=r.propertiesArray();if(!n)return e;const i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength();let a=0;for(;a<s;){const o=i.getUint16(a,!0);a+=2;const d=t[o],f=d.name;switch(d.type){case Bo.Bool:{e[f]=!!i.getUint8(a),a+=1;break}case Bo.Byte:{e[f]=i.getInt8(a),a+=1;break}case Bo.UByte:{e[f]=i.getUint8(a),a+=1;break}case Bo.Short:{e[f]=i.getInt16(a,!0),a+=2;break}case Bo.UShort:{e[f]=i.getUint16(a,!0),a+=2;break}case Bo.Int:{e[f]=i.getInt32(a,!0),a+=4;break}case Bo.UInt:{e[f]=i.getUint32(a,!0),a+=4;break}case Bo.Long:{e[f]=Number(i.getBigInt64(a,!0)),a+=8;break}case Bo.ULong:{e[f]=Number(i.getBigUint64(a,!0)),a+=8;break}case Bo.Float:{e[f]=i.getFloat32(a,!0),a+=4;break}case Bo.Double:{e[f]=i.getFloat64(a,!0),a+=8;break}case Bo.DateTime:case Bo.String:{const m=i.getUint32(a,!0);a+=4,e[f]=zT.decode(n.subarray(a,a+m)),a+=m;break}case Bo.Json:{const m=i.getUint32(a,!0);a+=4;const v=zT.decode(n.subarray(a,a+m));e[f]=JSON.parse(v),a+=m;break}default:throw new Error("Unknown type "+d.type)}}return e}function L_(r,t){const e=t.columns;return{type:"Feature",geometry:F_(r.geometry(),t.geometryType),properties:dQ(r,e)}}const R_=new Uint8Array(0);function fQ(){return this._source.cancel()}function pQ(r,t){if(!r.length)return t;if(!t.length)return r;var e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function gQ(){var r=this,t=r._array.subarray(r._index);return r._source.read().then(function(e){return r._array=R_,r._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:pQ(t,e.value)}})}function mQ(r){if((r|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return t._source.read().then(function(s){return s.done?(t._array=R_,t._index=0,e>0?n.subarray(0,e):null):e+s.value.length>=r?(t._array=s.value,t._index=r-e,n.set(s.value.subarray(0,r-e),e),n):(n.set(s.value,e),e+=s.value.length,i())})}()}function yQ(r){return typeof r.slice=="function"?r:new $m(typeof r.read=="function"?r:r.getReader())}function $m(r){this._source=r,this._array=R_,this._index=0}$m.prototype.read=gQ,$m.prototype.slice=mQ,$m.prototype.cancel=fQ;class jl{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new jl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+Op),(e||new jl).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,n,i,s,a,o){return jl.startCrs(t),jl.addOrg(t,e),jl.addCode(t,n),jl.addName(t,i),jl.addDescription(t,s),jl.addWkt(t,a),jl.addCodeString(t,o),jl.endCrs(t)}}class Xm{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new Xm).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+Op),(e||new Xm).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):xo.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const n=this.bb.__offset(this.bb_pos,18);return n?(e||new Co).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new jl).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,xo.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function O_(r){const t=Xm.getRootAsHeader(r),e=t.featuresCount(),n=t.indexNodeSize(),i=[];for(let d=0;d<t.columnsLength();d++){const f=t.columns(d);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");i.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const s=t.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:i,envelope:null,featuresCount:Number(e),indexNodeSize:n,crs:a,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var U_=function(r,t){return U_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},U_(r,t)};function _Q(r,t){U_(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function tf(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(v){a(v)}}function d(m){try{f(n.throw(m))}catch(v){a(v)}}function f(m){m.done?s(m.value):i(m.value).then(o,d)}f((n=n.apply(r,[])).next())})}function iA(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return d([f,m])}}function d(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function ef(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Up(r){return this instanceof Up?(this.v=r,this):new Up(r)}function vQ(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(r,t||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(C){n[C]&&(i[C]=function(b){return new Promise(function(P,F){s.push([C,b,P,F])>1||o(C,b)})})}function o(C,b){try{d(n[C](b))}catch(P){v(s[0][3],P)}}function d(C){C.value instanceof Up?Promise.resolve(C.value.v).then(f,m):v(s[0][2],C)}function f(C){o("next",C)}function m(C){o("throw",C)}function v(C,b){C(b),s.shift(),s.length&&o(s[0][0],s[0][1])}}var HT=function(r){_Q(t,r);function t(e){var n=r.call(this,e)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return t}(Error);(function(){function r(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function D_(r){r!=null&&typeof r.then=="function"&&r.then(Jm,Jm)}var N_=0,VT=1,ZA=2,Zm=3,k_=4,Ym=1024,Jm=function(){};function rf(r){var t=r.err,e=Promise.resolve(r.execution).then(function(n){if(t!=null)throw t;return n});return r.err=void 0,r.execution=e.then(function(){},function(){}),r.pending===void 0?e:r.pending.then(function(){return e})}function YA(r,t){var e=r.state>=Zm;return Promise.resolve(t).then(function(n){return!e&&r.state>=k_?rf(r).then(function(i){return{value:i,done:!0}}):{value:n,done:e}})}function Q_(r,t){var e,n;if(!(r.state>=ZA))if(r.state=ZA,r.onnext(),r.onstop(),r.err==null&&(r.err=t),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Dp(r);else try{for(var i=ef(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){e={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}function Dp(r){var t,e;if(!(r.state>=Zm)){r.state<ZA&&Q_(r),r.state=Zm,r.buffer=void 0;try{for(var n=ef(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?rf(r):r.pending.then(function(){return rf(r)});s.resolve(YA(r,a))}}catch(o){t={error:o}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}r.pushes=[],r.nexts=[]}}function GT(r){r.state>=k_||(r.state<Zm&&Dp(r),r.state=k_)}function bQ(r,t){if(D_(t),r.pushes.length>=Ym)throw new HT("No more than "+Ym+" pending calls to push are allowed on a single repeater.");if(r.state>=ZA)return Promise.resolve(void 0);var e=r.pending===void 0?Promise.resolve(t):r.pending.then(function(){return t});e=e.catch(function(d){r.state<ZA&&(r.err=d),GT(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(YA(r,e)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):n=new Promise(function(d){return r.onnext=d})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(e),n=Promise.resolve(void 0)):n=new Promise(function(d){return r.pushes.push({resolve:d,value:e})});var s=!0,a={},o=n.catch(function(d){if(s)throw d});return a.then=function(d,f){return s=!1,Promise.prototype.then.call(n,d,f)},a.catch=function(d){return s=!1,Promise.prototype.catch.call(n,d)},a.finally=n.finally.bind(n),r.pending=e.then(function(){return o}).catch(function(d){r.err=d,GT(r)}),a}function wQ(r){var t=Q_.bind(null,r),e=new Promise(function(n){return r.onstop=n});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function xQ(r){if(!(r.state>=VT)){r.state=VT;var t=bQ.bind(null,r),e=wQ(r);r.execution=new Promise(function(n){return n(r.executor(t,e))}),r.execution.catch(function(){return Q_(r)})}}var t0=new WeakMap,Np=function(){function r(t,e){t0.set(this,{executor:t,buffer:e,err:void 0,state:N_,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Jm,onstop:Jm})}return r.prototype.next=function(t){D_(t);var e=t0.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=Ym)throw new HT("No more than "+Ym+" pending calls to next are allowed on a single repeater.");if(e.state<=N_&&xQ(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var n=YA(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return n}else if(e.pushes.length){var s=e.pushes.shift();return e.onnext=s.resolve,YA(e,s.value)}else if(e.state>=ZA)return Dp(e),YA(e,rf(e));return new Promise(function(a){return e.nexts.push({resolve:a,value:t})})},r.prototype.return=function(t){D_(t);var e=t0.get(this);if(e===void 0)throw new Error("WeakMap error");return Dp(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),YA(e,rf(e))},r.prototype.throw=function(t){var e=t0.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=N_||e.state>=ZA||typeof e.buffer<"u"&&!e.buffer.empty?(Dp(e),e.err==null&&(e.err=t),YA(e,rf(e))):this.next(Promise.reject(t))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=BQ,r.merge=CQ,r.zip=EQ,r.latest=TQ,r}();function e0(r,t){var e,n,i=[],s=function(f){f!=null&&typeof f[Symbol.asyncIterator]=="function"?i.push(f[Symbol.asyncIterator]()):f!=null&&typeof f[Symbol.iterator]=="function"?i.push(f[Symbol.iterator]()):i.push(function(){return vQ(this,arguments,function(){return iA(this,function(C){switch(C.label){case 0:return t.yieldValues?[4,Up(f)]:[3,3];case 1:return[4,C.sent()];case 2:C.sent(),C.label=3;case 3:return t.returnValues?[4,Up(f)]:[3,5];case 4:return[2,C.sent()];case 5:return[2]}})})}())};try{for(var a=ef(r),o=a.next();!o.done;o=a.next()){var d=o.value;s(d)}}catch(f){e={error:f}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i}function BQ(r){var t=this,e=e0(r,{returnValues:!0});return new Np(function(n,i){return tf(t,void 0,void 0,function(){var s,a,o,d,f,m;return iA(this,function(v){switch(v.label){case 0:if(!e.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),v.label=1;case 1:v.trys.push([1,,5,7]),d=void 0,f=0,m=function(){var C,b,P,F,U,k;return iA(this,function(z){switch(z.label){case 0:C=f;try{for(b=(U=void 0,ef(e)),P=b.next();!P.done;P=b.next())F=P.value,Promise.resolve(F.next()).then(function(K){K.done?(i(),o===void 0&&(o=K)):f===C&&(f++,s(K))},function(K){return i(K)})}catch(K){U={error:K}}finally{try{P&&!P.done&&(k=b.return)&&k.call(b)}finally{if(U)throw U.error}}return[4,new Promise(function(K){return s=K})];case 1:return d=z.sent(),d===void 0?[3,3]:[4,n(d.value)];case 2:z.sent(),z.label=3;case 3:return[2]}})},v.label=2;case 2:return a?[3,4]:[5,m()];case 3:return v.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(e.map(function(C){return C.return&&C.return()}))];case 6:return v.sent(),[7];case 7:return[2]}})})})}function CQ(r){var t=this,e=e0(r,{yieldValues:!0});return new Np(function(n,i){return tf(t,void 0,void 0,function(){var s,a,o,d=this;return iA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2];s=[],a=!1,i.then(function(){var m,v;a=!0;try{for(var C=ef(s),b=C.next();!b.done;b=C.next()){var P=b.value;P()}}catch(F){m={error:F}}finally{try{b&&!b.done&&(v=C.return)&&v.call(C)}finally{if(m)throw m.error}}}),f.label=1;case 1:return f.trys.push([1,,3,4]),[4,Promise.all(e.map(function(m,v){return tf(d,void 0,void 0,function(){var C,b;return iA(this,function(P){switch(P.label){case 0:P.trys.push([0,,6,9]),P.label=1;case 1:return a?[3,5]:(Promise.resolve(m.next()).then(function(F){return s[v](F)},function(F){return i(F)}),[4,new Promise(function(F){s[v]=F})]);case 2:return C=P.sent(),C===void 0?[3,4]:C.done?(o=C,[2]):[4,n(C.value)];case 3:P.sent(),P.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return b=m.return,b?[4,m.return()]:[3,8];case 7:b=P.sent(),P.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return f.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function EQ(r){var t=this,e=e0(r,{returnValues:!0});return new Np(function(n,i){return tf(t,void 0,void 0,function(){var s,a,o,d;return iA(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),f.label=1;case 1:f.trys.push([1,,6,8]),f.label=2;case 2:return a?[3,5]:(Promise.all(e.map(function(m){return m.next()})).then(function(m){return s(m)},function(m){return i(m)}),[4,new Promise(function(m){return s=m})]);case 3:return o=f.sent(),o===void 0?[2]:(d=o.map(function(m){return m.value}),o.some(function(m){return m.done})?[2,d]:[4,n(d)]);case 4:return f.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(e.map(function(m){return m.return&&m.return()}))];case 7:return f.sent(),[7];case 8:return[2]}})})})}function TQ(r){var t=this,e=e0(r,{yieldValues:!0,returnValues:!0});return new Np(function(n,i){return tf(t,void 0,void 0,function(){var s,a,o,d,f,m=this;return iA(this,function(v){switch(v.label){case 0:if(!e.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var C,b;s();try{for(var P=ef(a),F=P.next();!F.done;F=P.next()){var U=F.value;U()}}catch(k){C={error:k}}finally{try{F&&!F.done&&(b=P.return)&&b.call(P)}finally{if(C)throw C.error}}o=!0}),v.label=1;case 1:return v.trys.push([1,,5,7]),Promise.all(e.map(function(C){return C.next()})).then(function(C){return s(C)},function(C){return i(C)}),[4,new Promise(function(C){return s=C})];case 2:return d=v.sent(),d===void 0?[2]:(f=d.map(function(C){return C.value}),d.every(function(C){return C.done})?[2,f]:[4,n(f.slice())]);case 3:return v.sent(),[4,Promise.all(e.map(function(C,b){return tf(m,void 0,void 0,function(){var P;return iA(this,function(F){switch(F.label){case 0:if(d[b].done)return[2,d[b].value];F.label=1;case 1:return o?[3,4]:(Promise.resolve(C.next()).then(function(U){return a[b](U)},function(U){return i(U)}),[4,new Promise(function(U){return a[b]=U})]);case 2:return P=F.sent(),P===void 0?[2,d[b].value]:P.done?[2,P.value]:(f[b]=P.value,[4,n(f.slice())]);case 3:return F.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,v.sent()];case 5:return i(),[4,Promise.all(e.map(function(C){return C.return&&C.return()}))];case 6:return v.sent(),[7];case 7:return[2]}})})})}let r0=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}};r0.global=new r0;var wc;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error"})(wc||(wc={}));class Eo{static debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(wc.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(wc.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(wc.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log(wc.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];switch(t){case wc.Debug:{console.debug(...n);break}case wc.Info:{console.info(...n);break}case wc.Warn:{console.warn(...n);break}case wc.Error:{console.error(...n);break}}}}}Eo.logLevel=wc.Warn;const JA=8*4+8,SQ=16;function z_(r,t){t=Math.min(Math.max(+t,2),65535);let e=r,n=e;do e=Math.ceil(e/t),n+=e;while(e!==1);return n*JA}function IQ(r,t){if(t<2)throw new Error("Node size must be at least 2");if(r===0)throw new Error("Number of items must be greater than 0");let e=r,n=e;const i=[e];do e=Math.ceil(e/t),n+=e,i.push(e);while(e!==1);const s=[];e=n;for(const o of i)s.push(e-o),e-=o;const a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*PQ(r,t,e,n){class i{constructor(P,F){this._level=F,this.nodes=P}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(P){console.assert(P>this.nodes[1]),this.nodes[1]=P}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:a,maxX:o,maxY:d}=e;Eo.info(`tree items: ${r}, nodeSize: ${t}`);const f=IQ(r,t),m=f[0][0],C=[(()=>{const b=[0,1],P=f.length-1;return new i(b,P)})()];for(Eo.debug(`starting stream search with queue: ${C}, numItems: ${r}, nodeSize: ${t}, levelBounds: ${f}`);C.length!=0;){const b=C.shift();Eo.debug(`popped node: ${b}, queueLength: ${C.length}`);const P=b.startNodeIdx(),F=P>=m,U=(()=>{const[,G]=f[b.level()],X=Math.min(b.endNodeIdx()+t,G);return F&&X<G?X+1:X})(),k=U-P,z=await n(P*JA,k*JA),K=new DataView(z);for(let G=P;G<U;G++){const X=G-P,Y=X*JA;if(o<K.getFloat64(Y+0,!0)||d<K.getFloat64(Y+8,!0)||s>K.getFloat64(Y+16,!0)||a>K.getFloat64(Y+24,!0))continue;const it=K.getBigUint64(Y+32,!0);if(F){const ot=it,vt=(()=>{if(G<r-1){const re=(X+1)*JA;return K.getBigUint64(re+32,!0)-ot}else return null})(),yt=G-m;yield[Number(ot),yt,Number(vt)];continue}const nt=it,wt=r0.global.extraRequestThreshold()/JA,Ct=C[C.length-1];if(Ct!==void 0&&Ct.level()==b.level()-1&&nt<Ct.endNodeIdx()+wt){Eo.debug(`Merging "nodeRange" request into existing range: ${Ct}, newEndNodeIdx: ${Ct.endNodeIdx()} -> ${nt}`),Ct.extendEndNodeIdx(Number(nt));continue}const st=(()=>{const ot=b.level()-1,vt=[Number(nt),Number(nt)+1];return new i(vt,ot)})();Ct!==void 0&&Ct.level()==st.level()?Eo.info(`Same level, but too far away. Pushing new request for nodeIdx: ${nt} rather than merging with distant ${Ct}`):Eo.info(`Pushing new level for ${st} onto queue with nearestNodeRange: ${Ct} since there's not already a range for this level.`),C.push(st)}}}const sA=new Uint8Array([102,103,98,3,102,103,98,0]),Ah=4;class H_{constructor(t,e,n,i,s){this.headerClient=t,this.header=e,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(t,e){const i=new jT(t,e),s=(()=>{const C=SQ,b=3;let P=0,F;for(F=0;F<b;F++){const U=C**F*JA;P+=U}return P})(),a=2024+s;Eo.debug(`fetching header. minReqLength: ${a} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const C=new Uint8Array(await i.getRange(0,8,a,"header"));if(!C.subarray(0,3).every((b,P)=>sA[P]===b))throw Eo.error(`bytes: ${C} != ${sA}`),new Error("Not a FlatGeobuf file");Eo.debug("magic bytes look good")}let o;{const C=await i.getRange(8,4,a,"header");o=new DataView(C).getUint32(0,!0);const b=1048576*10;if(o>b||o<8)throw new Error("Invalid header size");Eo.debug(`headerLength: ${o}`)}const d=await i.getRange(12,o,a,"header"),f=new hh(new Uint8Array(d)),m=O_(f),v=z_(m.featuresCount,m.indexNodeSize);return Eo.debug("completed: opening http reader"),new H_(i,m,o,v,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),n=this.headerClient,i=async function(d,f){return n.getRange(e+d,f,0,"index")},s=[];let a=[];for await(const d of PQ(this.header.featuresCount,this.header.indexNodeSize,t,i)){const[f,,]=d;let[,,m]=d;if(m||(Eo.info("final feature"),m=4),a.length==0){a.push([f,m]);continue}const v=a[a.length-1],C=f-(v[0]+v[1]);C>r0.global.extraRequestThreshold()&&(Eo.info(`Pushing new feature batch, since gap ${C} was too large`),s.push(a),a=[]),a.push([f,m])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);const o=s.flatMap(d=>this.readFeatureBatch(d,this.nocache));yield*Np.merge(o)}lengthBeforeTree(){return sA.length+Ah+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new jT(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[n]=t[0],[i,s]=t[t.length-1],a=n,d=i+s-a,f=this.buildFeatureClient(e);let m=d;for(const[v]of t)yield await this.readFeature(f,v,m),m=0;f.logUsage("feature")}async readFeature(t,e,n){const i=e+this.lengthBeforeFeatures();let s;{const m=await t.getRange(i,4,n,"feature length");s=new DataView(m).getUint32(0,!0)}const a=await t.getRange(i+4,s,n,"feature data"),o=new Uint8Array(a),d=new Uint8Array(s+Ah);d.set(o,Ah);const f=new hh(d);return f.setPosition(Ah),bc.getRootAsFeature(f)}}class jT{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new qT(t,e);else if(t instanceof qT)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,n,i){this.bytesEverUsed+=e;const s=t-this.head,a=s+e;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);const o=Math.max(e,n);return this.bytesEverFetched+=o,Eo.debug(`requesting for new Range: ${t}-${t+o-1}`),this.buffer=await this.httpClient.getRange(t,o,i),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],n=this.bytesEverUsed,i=this.bytesEverFetched,s=(100*n/i).toFixed(2);Eo.info(`${e} bytes used/requested: ${n} / ${i} = ${s}%`)}}class qT{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,n){this.requestsEverMade+=1,this.bytesEverRequested+=e;const i=`bytes=${t}-${t+e-1}`;Eo.info(`request: #${this.requestsEverMade}, purpose: ${n}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${i}`);const s={Range:i};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function MQ(r,t,e){if(!r.subarray(0,3).every((m,v)=>sA[v]===m))throw new Error("Not a FlatGeobuf file");const n=new hh(r),i=n.readUint32(sA.length);n.setPosition(sA.length+Ah);const s=O_(n);let a=sA.length+Ah+i;const{indexNodeSize:o,featuresCount:d}=s;o>0&&(a+=z_(d,o));const f=[];for(;a<n.capacity();){const m=n.readUint32(a);n.setPosition(a+Ah);const v=bc.getRootAsFeature(n);f.push(t(v,s)),a+=Ah+m}return f}async function*FQ(r,t,e){const n=yQ(r),i=async C=>await n.slice(C);let s=new Uint8Array(await i(8));if(!s.subarray(0,3).every((C,b)=>sA[b]===C))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await i(4));let a=new hh(s);const o=a.readUint32(0);s=new Uint8Array(await i(o)),a=new hh(s);const d=O_(a),{indexNodeSize:f,featuresCount:m}=d;if(f>0){const C=z_(m,f);await i(C)}let v;for(;v=await RQ(i,d,t);)yield v}function LQ(r,t,e,n){try{let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await H_.open(r,i);Eo.debug("opened reader");for await(const a of s.selectBbox(t))yield e(a,s.header)}()}catch(i){return Promise.reject(i)}}async function RQ(r,t,e){let n=new Uint8Array(await r(4,"feature length"));if(n.byteLength===0)return;let i=new hh(n);const s=i.readUint32(0);n=new Uint8Array(await r(s,"feature data"));const a=new Uint8Array(s+4);a.set(n,4),i=new hh(a),i.setPosition(Ah);const o=bc.getRootAsFeature(i);return e(o,t)}function OQ(r,t){return{type:"FeatureCollection",features:MQ(r,L_)}}function UQ(r,t){return FQ(r,L_)}function DQ(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return LQ(r,t,L_,e,n)}function KT(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return r instanceof Uint8Array?OQ(r):r instanceof ReadableStream?UQ(r):DQ(r,t,e,n)}class NQ{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let f={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(f.zoom=e._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:d}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainICGC",exaggeration:1.5}):o>=n&&o<=s&&d>=i&&d<=a?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainICGC",exaggeration:1.5}),t.easeTo(f),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function kp(r){"@babel/helpers - typeof";return kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kp(r)}function kQ(r,t){if(kp(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(kp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function QQ(r){var t=kQ(r,"string");return kp(t)=="symbol"?t:t+""}function $(r,t,e){return t=QQ(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function Oi(r,t){if(!r)throw new Error(t||"loader assertion failed.")}const n0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),WT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);WT&&parseFloat(WT[1]);const zQ="3.4.15";function Tu(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}const V_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},HQ=V_.global||V_.self||V_.window||{},dh=typeof process!="object"||String(process)!=="[object process]"||process.browser,G_=typeof importScripts=="function",VQ=typeof window<"u"&&typeof window.orientation<"u",$T=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$T&&parseFloat($T[1]);class GQ{constructor(t,e){$(this,"name",void 0),$(this,"workerThread",void 0),$(this,"isRunning",!0),$(this,"result",void 0),$(this,"_resolve",()=>{}),$(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Tu(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Tu(this.isRunning),this.isRunning=!1,this._reject(t)}}let j_=class{terminate(){}};const q_=new Map;function jQ(r){Tu(r.source&&!r.url||!r.source&&r.url);let t=q_.get(r.source||r.url);return t||(r.url&&(t=qQ(r.url),q_.set(r.url,t)),r.source&&(t=XT(r.source),q_.set(r.source,t))),Tu(t),t}function qQ(r){if(!r.startsWith("http"))return r;const t=KQ(r);return XT(t)}function XT(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function KQ(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function ZT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const n=e||new Set;if(r){if(YT(r))n.add(r);else if(YT(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(const i in r)ZT(r[i],t,n)}}return e===void 0?Array.from(n):[]}function YT(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const K_=()=>{};class W_{static isSupported(){return typeof Worker<"u"&&dh||typeof j_<"u"&&!dh}constructor(t){$(this,"name",void 0),$(this,"source",void 0),$(this,"url",void 0),$(this,"terminated",!1),$(this,"worker",void 0),$(this,"onMessage",void 0),$(this,"onError",void 0),$(this,"_loadableURL","");const{name:e,source:n,url:i}=t;Tu(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=K_,this.onError=s=>console.log(s),this.worker=dh?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=K_,this.onError=K_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||ZT(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=jQ({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new j_(n,{eval:!1})}else if(this.source)t=new j_(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class WQ{static isSupported(){return W_.isSupported()}constructor(t){$(this,"name","unnamed"),$(this,"source",void 0),$(this,"url",void 0),$(this,"maxConcurrency",1),$(this,"maxMobileConcurrency",1),$(this,"onDebug",()=>{}),$(this,"reuseWorkers",!0),$(this,"props",{}),$(this,"jobQueue",[]),$(this,"idleQueue",[]),$(this,"count",0),$(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const i=new Promise(s=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new GQ(e.name,t);t.onMessage=i=>e.onMessage(n,i.type,i.payload),t.onError=i=>e.onError(n,i),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new W_({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return VQ?this.maxMobileConcurrency:this.maxConcurrency}}const $Q={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class fh{static isSupported(){return W_.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return fh._workerFarm=fh._workerFarm||new fh({}),fh._workerFarm.setProps(t),fh._workerFarm}constructor(t){$(this,"props",void 0),$(this,"workerPools",new Map),this.props={...$Q},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let s=this.workerPools.get(e);return s||(s=new WQ({name:e,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$(fh,"_workerFarm",void 0);const XQ="latest";function ZQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[r.id]||{},n="".concat(r.id,"-worker.js");let i=e.workerUrl;if(!i&&r.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(i="modules/".concat(r.module,"/dist/").concat(n)),!i){let s=r.version;s==="latest"&&(s=XQ);const a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(n)}return Tu(i),i}function YQ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zQ;Tu(r,"no worker provided");const e=r.version;return!(!t||!e)}const JQ=null,tz=null,$_=null,JT=null,ez=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:JQ,readFileAsText:tz,requireFromFile:$_,requireFromString:JT},Symbol.toStringTag,{value:"Module"})),rz="3.4.15",X_={};async function td(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(r=nz(r,t,e)),X_[r]=X_[r]||iz(r),await X_[r]}function nz(r,t,e){if(r.startsWith("http"))return r;const n=e.modules||{};return n[r]?n[r]:dh?e.CDN?(Tu(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(rz,"/dist/libs/").concat(r)):G_?"../src/libs/".concat(r):"modules/".concat(t,"/src/libs/").concat(r):"modules/".concat(t,"/dist/libs/").concat(r)}async function iz(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!dh)try{return ez&&$_&&await $_(r)}catch{return null}if(G_)return importScripts(r);const e=await(await fetch(r)).text();return sz(e,r)}function sz(r,t){if(!dh)return JT;if(G_)return eval.call(HQ,r),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(r))}catch{e.text=r}return document.body.appendChild(e),null}function oz(r,t){return!fh.isSupported()||!dh&&!(t!=null&&t._nodeWorkers)?!1:r.worker&&(t==null?void 0:t.worker)}async function az(r,t,e,n,i){const s=r.id,a=ZQ(r,e),d=fh.getWorkerFarm(e).getWorkerPool({name:s,url:a});e=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(n||{}));const f=await d.startJob("process-on-worker",lz.bind(null,i));return f.postMessage("process",{input:t,options:e,context:n}),await(await f.result).result}async function lz(r,t,e,n){switch(e){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);t.postMessage("done",{id:i,result:o})}catch(o){const d=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:i,error:d})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function cz(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?tS(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?tS(r,0,t):""}function tS(r,t,e){if(r.byteLength<=t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}function uz(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(cz(r),'"'))}}function hz(r,t,e){if(e=e||r.byteLength,r.byteLength<e||t.byteLength<e)return!1;const n=new Uint8Array(r),i=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function Az(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];const n=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=n.reduce((o,d)=>o+d.byteLength,0),s=new Uint8Array(i);let a=0;for(const o of n)s.set(o,a),a+=o.byteLength;return s.buffer}function Z_(r,t,e){const n=e!==void 0?new Uint8Array(r).subarray(t,t+e):new Uint8Array(r).subarray(t);return new Uint8Array(n).buffer}function Qp(r,t){return Oi(r>=0),Oi(t>0),r+(t-1)&~(t-1)}function dz(r,t,e){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return t.set(n,e),e+Qp(n.byteLength,4)}async function fz(r){const t=[];for await(const e of r)t.push(e);return Az(...t)}function eS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();r=t[0]*1e3+t[1]/1e6}else r=Date.now();return r}class rS{constructor(t,e){$(this,"name",void 0),$(this,"type",void 0),$(this,"sampleSize",1),$(this,"time",void 0),$(this,"count",void 0),$(this,"samples",void 0),$(this,"lastTiming",void 0),$(this,"lastSampleTime",void 0),$(this,"lastSampleCount",void 0),$(this,"_count",0),$(this,"_time",0),$(this,"_samples",0),$(this,"_startTime",0),$(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class zp{constructor(t){$(this,"id",void 0),$(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:n}=t;return this.stats[e]||(t instanceof rS?this.stats[e]=t:this.stats[e]=new rS(e,n)),this.stats[e]}}const pz="Queued Requests",gz="Active Requests",mz="Cancelled Requests",yz="Queued Requests Ever",_z="Active Requests Ever",vz={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class bz{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"props",void 0),$(this,"stats",void 0),$(this,"activeRequestCount",0),$(this,"requestQueue",[]),$(this,"requestMap",new Map),$(this,"deferredUpdate",null),this.props={...vz,...t},this.stats=new zp({id:this.props.id}),this.stats.get(pz),this.stats.get(gz),this.stats.get(mz),this.stats.get(yz),this.stats.get(_z)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((e,n)=>e.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let wz="";const nS={};function xz(r){for(const t in nS)if(r.startsWith(t)){const e=nS[t];r=r.replace(t,e)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(wz).concat(r)),r}function vgt(r){return r}function Bz(r){return r&&typeof r=="object"&&r.isBuffer}function iS(r){if(Bz(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const t=r;return new TextEncoder().encode(t).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function sS(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(t+1):""}function Y_(r){const t=r?r.lastIndexOf("/"):-1;return t>=0?r.substr(0,t):""}const Cz=r=>typeof r=="boolean",Hp=r=>typeof r=="function",Vp=r=>r!==null&&typeof r=="object",oS=r=>Vp(r)&&r.constructor==={}.constructor,Ez=r=>r&&typeof r[Symbol.iterator]=="function",Tz=r=>r&&typeof r[Symbol.asyncIterator]=="function",ed=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,rd=r=>typeof Blob<"u"&&r instanceof Blob,Sz=r=>r&&typeof r=="object"&&r.isBuffer,Iz=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Vp(r)&&Hp(r.tee)&&Hp(r.cancel)&&Hp(r.getReader),Pz=r=>Vp(r)&&Hp(r.read)&&Hp(r.pipe)&&Cz(r.readable),aS=r=>Iz(r)||Pz(r),Mz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Fz=/^([-\w.]+\/[-\w.+]+)/;function Lz(r){const t=Fz.exec(r);return t?t[1]:r}function lS(r){const t=Mz.exec(r);return t?t[1]:""}const cS=/\?.*/;function Rz(r){const t=r.match(cS);return t&&t[0]}function J_(r){return r.replace(cS,"")}function i0(r){return ed(r)?r.url:rd(r)?r.name||"":typeof r=="string"?r:""}function tv(r){if(ed(r)){const t=r,e=t.headers.get("content-type")||"",n=J_(t.url);return Lz(e)||lS(n)}return rd(r)?r.type||"":typeof r=="string"?lS(r):""}function Oz(r){return ed(r)?r.headers["content-length"]||-1:rd(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function uS(r){if(ed(r))return r;const t={},e=Oz(r);e>=0&&(t["content-length"]=String(e));const n=i0(r),i=tv(r);i&&(t["content-type"]=i);const s=await Nz(r);s&&(t["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:t});return Object.defineProperty(a,"url",{value:n}),a}async function Uz(r){if(!r.ok){const t=await Dz(r);throw new Error(t)}}async function Dz(r){let t="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const e=r.headers.get("Content-Type");let n=r.statusText;e.includes("application/json")&&(n+=" ".concat(await r.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function Nz(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const e=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>{var a;return n(s==null||(a=s.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(e)})}if(r instanceof ArrayBuffer){const e=r.slice(0,5),n=kz(e);return"data:base64,".concat(n)}return null}function kz(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function hS(r,t){if(typeof r=="string"){r=xz(r);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(r,e)}return await uS(r)}function AS(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function ph(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||AS()}const s0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},o0=s0.window||s0.self||s0.global,Gp=s0.process||{},dS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ph();const ev=globalThis;function fS(r){if(!ph())return"Node";if(AS())return"Electron";const e=(typeof navigator<"u"?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";const n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":ev.chrome?"Chrome":ev.safari?"Safari":ev.mozInnerScreenX?"Firefox":"Unknown"}function Qz(r){try{const t=window[r],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class zz{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";$(this,"storage",void 0),$(this,"id",void 0),$(this,"config",void 0),this.storage=Qz(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Hz(r){let t;return r<10?t="".concat(r.toFixed(2),"ms"):r<100?t="".concat(r.toFixed(1),"ms"):r<1e3?t="".concat(r.toFixed(0),"ms"):t="".concat((r/1e3).toFixed(2),"s"),t}function Vz(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-r.length,0);return"".concat(" ".repeat(e)).concat(r)}function rv(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>n&&(e=Math.min(e,n/r.width));const s=r.width*e,a=r.height*e,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let a0;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(a0||(a0={}));function pS(r){return typeof r=="string"?a0[r.toUpperCase()]||a0.WHITE:r}function Gz(r,t,e){return!ph&&typeof r=="string"&&(t&&(t=pS(t),r="\x1B[".concat(t,"m").concat(r,"\x1B[39m")),e&&(t=pS(e),r="\x1B[".concat(e+10,"m").concat(r,"\x1B[49m"))),r}function jz(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(e);for(const i of n)typeof r[i]=="function"&&(t.find(s=>i===s)||(r[i]=r[i].bind(r)))}function l0(r,t){if(!r)throw new Error(t||"Assertion failed")}function nf(){let r;if(ph&&"performance"in o0){var t,e;r=o0==null||(t=o0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in Gp){var n;const i=Gp==null||(n=Gp.hrtime)===null||n===void 0?void 0:n.call(Gp);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const sf={debug:ph&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},qz={enabled:!0,level:0};function ql(){}const gS={},mS={once:!0};class jp{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};$(this,"id",void 0),$(this,"VERSION",dS),$(this,"_startTs",nf()),$(this,"_deltaTs",nf()),$(this,"_storage",void 0),$(this,"userData",{}),$(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new zz("__probe-".concat(this.id,"__"),qz),this.timeStamp("".concat(this.id," started")),jz(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((nf()-this._startTs).toPrecision(10))}getDelta(){return Number((nf()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){l0(t,e)}warn(t){return this._getLogFunction(0,t,sf.warn,arguments,mS)}error(t){return this._getLogFunction(0,t,sf.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,sf.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,sf.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,sf.debug||sf.info,arguments,mS)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||ql,n&&[n],{tag:Xz(e)}):ql}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:a=1}=t;return this._shouldLog(e||n)?ph?$z({image:i,message:s,scale:a}):Wz():ql}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||ql)}group(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=_S({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||ql)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=yS(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=_S({logLevel:t,message:e,args:i,opts:s}),n=n||s.method,l0(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=nf();const a=s.tag||s.message;if(s.once)if(!gS[a])gS[a]=nf();else return ql;return e=Kz(this.id,s.message,s),n.bind(console,e,...s.args)}return ql}}$(jp,"VERSION",dS);function yS(r){if(!r)return 0;let t;switch(typeof r){case"number":t=r;break;case"object":t=r.logLevel||r.priority||0;break;default:return 0}return l0(Number.isFinite(t)&&t>=0),t}function _S(r){const{logLevel:t,message:e}=r;r.logLevel=yS(t);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&n.unshift(e),r.message=t;break;case"object":Object.assign(r,t);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return l0(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function Kz(r,t,e){if(typeof t=="string"){const n=e.time?Vz(Hz(e.total)):"";t=e.time?"".concat(r,": ").concat(n,"  ").concat(t):"".concat(r,": ").concat(t),t=Gz(t,e.color,e.background)}return t}function Wz(r){return console.warn("removed"),ql}function $z(r){let{image:t,message:e="",scale:n=1}=r;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=rv(s,e,n);console.log(...a)},s.src=t,ql}const i=t.nodeName||"";if(i.toLowerCase()==="img")return console.log(...rv(t,e,n)),ql;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...rv(s,e,n)),s.src=t.toDataURL(),ql}return ql}function Xz(r){for(const t in r)for(const e in r[t])return e||"untitled";return"empty"}const vS=new jp({id:"loaders.gl"});class Zz{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Yz{constructor(){$(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}}const bS={fetch:null,mimeType:void 0,nothrow:!1,log:new Yz,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:n0,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Jz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function wS(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const xS=()=>{const r=wS();return r.globalOptions=r.globalOptions||{...bS},r.globalOptions};function tH(r,t,e,n){return e=e||[],e=Array.isArray(e)?e:[e],eH(r,e),nH(t,r,n)}function eH(r,t){BS(r,null,bS,Jz,t);for(const e of t){const n=r&&r[e.id]||{},i=e.options&&e.options[e.id]||{},s=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};BS(n,e.id,i,s,t)}}function BS(r,t,e,n,i){const s=t||"Top level",a=t?"".concat(t,"."):"";for(const o in r){const d=!t&&Vp(r[o]),f=o==="baseUri"&&!t,m=o==="workerUrl"&&t;if(!(o in e)&&!f&&!m){if(o in n)vS.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(n[o],"'"))();else if(!d){const v=rH(o,i);vS.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(v))()}}}}function rH(r,t){const e=r.toLowerCase();let n="";for(const i of t)for(const s in i.options){if(r===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const a=s.toLowerCase();(e.startsWith(a)||a.startsWith(e))&&(n=n||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return n}function nH(r,t,e){const i={...r.options||{}};return iH(i,e),i.log===null&&(i.log=new Zz),CS(i,xS()),CS(i,t),i}function CS(r,t){for(const e in t)if(e in t){const n=t[e];oS(n)&&oS(r[e])?r[e]={...r[e],...t[e]}:r[e]=t[e]}}function iH(r,t){t&&!("baseUri"in r)&&(r.baseUri=t)}function nv(r){var t;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((t=r)===null||t===void 0?void 0:t.extensions)):!1}function iv(r){var t,e;Oi(r,"null loader"),Oi(nv(r),"invalid loader");let n;return Array.isArray(r)&&(n=r[1],r=r[0],r={...r,options:{...r.options,...n}}),((t=r)!==null&&t!==void 0&&t.parseTextSync||(e=r)!==null&&e!==void 0&&e.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const ES=()=>{const r=wS();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function sH(r){const t=ES();r=Array.isArray(r)?r:[r];for(const e of r){const n=iv(e);t.find(i=>n===i)||t.unshift(n)}}function oH(){return ES()}const aH=new jp({id:"loaders.gl"}),lH=/\.([^.]+)$/;async function cH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!SS(r))return null;let i=TS(r,t,{...e,nothrow:!0},n);if(i)return i;if(rd(r)&&(r=await r.slice(0,10).arrayBuffer(),i=TS(r,t,e,n)),!i&&!(e!=null&&e.nothrow))throw new Error(IS(r));return i}function TS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!SS(r))return null;if(t&&!Array.isArray(t))return iv(t);let i=[];t&&(i=i.concat(t)),e!=null&&e.ignoreRegisteredLoaders||i.push(...oH()),hH(i);const s=uH(r,i,e,n);if(!s&&!(e!=null&&e.nothrow))throw new Error(IS(r));return s}function uH(r,t,e,n){const i=i0(r),s=tv(r),a=J_(i)||(n==null?void 0:n.url);let o=null,d="";if(e!=null&&e.mimeType&&(o=sv(t,e==null?void 0:e.mimeType),d="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),o=o||AH(t,a),d=d||(o?"matched url ".concat(a):""),o=o||sv(t,s),d=d||(o?"matched MIME type ".concat(s):""),o=o||fH(t,r),d=d||(o?"matched initial data ".concat(MS(r)):""),o=o||sv(t,e==null?void 0:e.fallbackMimeType),d=d||(o?"matched fallback MIME type ".concat(s):""),d){var f;aH.log(1,"selectLoader selected ".concat((f=o)===null||f===void 0?void 0:f.name,": ").concat(d,"."))}return o}function SS(r){return!(r instanceof Response&&r.status===204)}function IS(r){const t=i0(r),e=tv(r);let n="No valid loader found (";n+=t?"".concat(sS(t),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const i=r?MS(r):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function hH(r){for(const t of r)iv(t)}function AH(r,t){const e=t&&lH.exec(t),n=e&&e[1];return n?dH(r,n):null}function dH(r,t){t=t.toLowerCase();for(const e of r)for(const n of e.extensions)if(n.toLowerCase()===t)return e;return null}function sv(r,t){for(const e of r)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function fH(r,t){if(!t)return null;for(const e of r)if(typeof t=="string"){if(pH(t,e))return e}else if(ArrayBuffer.isView(t)){if(PS(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&PS(t,0,e))return e;return null}function pH(r,t){return t.testText?t.testText(r):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>r.startsWith(n))}function PS(r,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>gH(r,t,e,i))}function gH(r,t,e,n){if(n instanceof ArrayBuffer)return hz(n,r,n.byteLength);switch(typeof n){case"function":return n(r,e);case"string":const i=ov(r,t,n.length);return n===i;default:return!1}}function MS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,t):ArrayBuffer.isView(r)?ov(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?ov(r,0,t):""}function ov(r,t,e){if(r.byteLength<t+e)return"";const n=new DataView(r);let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(n.getUint8(t+s));return i}const mH=256*1024;function*yH(r,t){const e=(t==null?void 0:t.chunkSize)||mH;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,e),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const _H=256*1024;function vH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=_H}=t;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,e),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}()}const bH=1024*1024;async function*wH(r,t){const e=(t==null?void 0:t.chunkSize)||bH;let n=0;for(;n<r.size;){const i=n+e,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function FS(r,t){return n0?xH(r,t):BH(r)}async function*xH(r,t){const e=r.getReader();let n;try{for(;;){const i=n||e.read();t!=null&&t._streamReadAhead&&(n=e.read());const{done:s,value:a}=await i;if(s)return;yield iS(a)}}catch{e.releaseLock()}}async function*BH(r,t){for await(const e of r)yield iS(e)}function CH(r,t){if(typeof r=="string")return yH(r,t);if(r instanceof ArrayBuffer)return vH(r,t);if(rd(r))return wH(r,t);if(aS(r))return FS(r,t);if(ed(r))return FS(r.body,t);throw new Error("makeIterator")}const LS="Cannot convert supplied data type";function EH(r,t,e){if(t.text&&typeof r=="string")return r;if(Sz(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(LS)}async function TH(r,t,e){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return EH(r,t);if(rd(r)&&(r=await uS(r)),ed(r)){const i=r;return await Uz(i),t.binary?await i.arrayBuffer():await i.text()}if(aS(r)&&(r=CH(r,e)),Ez(r)||Tz(r))return fz(r);throw new Error(LS)}function RS(r,t){const e=xS(),n=r||e;return typeof n.fetch=="function"?n.fetch:Vp(n.fetch)?i=>hS(i,n):t!=null&&t.fetch?t==null?void 0:t.fetch:hS}function SH(r,t,e){if(e)return e;const n={fetch:RS(t,r),...r};if(n.url){const i=J_(n.url);n.baseUrl=i,n.queryString=Rz(n.url),n.filename=sS(i),n.baseUrl=Y_(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function IH(r,t){if(!t&&r&&!Array.isArray(r))return r;let e;if(r&&(e=Array.isArray(r)?r:[r]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...n]:n}return e&&e.length?e:null}async function av(r,t,e,n){Tu(!n||typeof n=="object"),t&&!Array.isArray(t)&&!nv(t)&&(n=void 0,e=t,t=void 0),r=await r,e=e||{};const i=i0(r),a=IH(t,n),o=await cH(r,a,e);return o?(e=tH(e,o,a,i),n=SH({url:i,parse:av,loaders:a},e,n||null),await PH(o,r,e,n)):null}async function PH(r,t,e,n){if(YQ(r),ed(t)){const i=t,{ok:s,redirected:a,status:o,statusText:d,type:f,url:m}=i,v=Object.fromEntries(i.headers.entries());n.response={headers:v,ok:s,redirected:a,status:o,statusText:d,type:f,url:m}}if(t=await TH(t,r,e),r.parseTextSync&&typeof t=="string")return e.dataType="text",r.parseTextSync(t,e,n,r);if(oz(r,e))return await az(r,t,e,n,av);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,n,r);if(r.parse)return await r.parse(t,e,n,r);throw Tu(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function oA(r,t,e,n){!Array.isArray(t)&&!nv(t)&&(e=t,t=void 0);const i=RS(e);let s=r;return typeof r=="string"&&(s=await i(r)),rd(r)&&(s=await i(r)),await av(s,t,e)}const MH="3.4.15",{_parseImageNode:FH}=globalThis,lv=typeof Image<"u",cv=typeof ImageBitmap<"u",uv=n0?!0:!!FH;function LH(r){switch(r){case"auto":return cv||lv||uv;case"imagebitmap":return cv;case"image":return lv;case"data":return uv;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function RH(){if(cv)return"imagebitmap";if(lv)return"image";if(uv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function OH(r){const t=DH(r);if(!t)throw new Error("Not an image");return t}function UH(r){switch(OH(r)){case"data":return r;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=r.width,t.height=r.height,e.drawImage(r,0,0),e.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function DH(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const NH=/^data:image\/svg\+xml/,kH=/\.svg((\?|#).*)?$/;function hv(r){return r&&(NH.test(r)||kH.test(r))}function QH(r,t){if(hv(t)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return OS(r,t)}function OS(r,t){if(hv(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function US(r,t,e){const n=QH(r,e),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await zH(s||n,t)}finally{s&&i.revokeObjectURL(s)}}async function zH(r,t){const e=new Image;return e.src=r,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((n,i)=>{try{e.onload=()=>n(e),e.onerror=s=>i(new Error("Could not load image ".concat(r,": ").concat(s)))}catch(s){i(s)}})}const HH={};let DS=!0;async function VH(r,t,e){let n;hv(e)?n=await US(r,t,e):n=OS(r,e);const i=t&&t.imagebitmap;return await GH(n,i)}async function GH(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((jH(t)||!DS)&&(t=null),t)try{return await createImageBitmap(r,t)}catch(e){console.warn(e),DS=!1}return await createImageBitmap(r)}function jH(r){for(const t in r||HH)return!1;return!0}function qH(r){return!XH(r,"ftyp",4)||!(r[8]&96)?null:KH(r)}function KH(r){switch(WH(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function WH(r,t,e){return String.fromCharCode(...r.slice(t,e))}function $H(r){return[...r].map(t=>t.charCodeAt(0))}function XH(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=$H(t);for(let i=0;i<n.length;++i)if(n[i]!==r[i+e])return!1;return!0}const Su=!1,qp=!0;function Av(r){const t=Kp(r);return YH(t)||e7(t)||JH(t)||t7(t)||ZH(t)}function ZH(r){const t=new Uint8Array(r instanceof DataView?r.buffer:r),e=qH(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function YH(r){const t=Kp(r);return t.byteLength>=24&&t.getUint32(0,Su)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Su),height:t.getUint32(20,Su)}:null}function JH(r){const t=Kp(r);return t.byteLength>=10&&t.getUint32(0,Su)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,qp),height:t.getUint16(8,qp)}:null}function t7(r){const t=Kp(r);return t.byteLength>=14&&t.getUint16(0,Su)===16973&&t.getUint32(2,qp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,qp),height:t.getUint32(22,qp)}:null}function e7(r){const t=Kp(r);if(!(t.byteLength>=3&&t.getUint16(0,Su)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=r7();let s=2;for(;s+9<t.byteLength;){const a=t.getUint16(s,Su);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Su),width:t.getUint16(s+7,Su)};if(!n.has(a))return null;s+=2,s+=t.getUint16(s,Su)}return null}function r7(){const r=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)r.add(e);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Kp(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function n7(r,t){const{mimeType:e}=Av(r)||{},n=globalThis._parseImageNode;return Oi(n),await n(r,e)}async function i7(r,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:s}=e||{},a=s7(i);let o;switch(a){case"imagebitmap":o=await VH(r,t,s);break;case"image":o=await US(r,t,s);break;case"data":o=await n7(r);break;default:Oi(!1)}return i==="data"&&(o=UH(o)),o}function s7(r){switch(r){case"auto":case"data":return RH();default:return LH(r),r}}const NS={id:"image",module:"images",name:"Images",version:MH,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:i7,tests:[r=>!!Av(new DataView(r))],options:{image:{type:"auto",decode:!0}}},dv={};function o7(r){if(dv[r]===void 0){const t=n0?l7(r):a7(r);dv[r]=t}return dv[r]}function a7(r){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:n=t}=globalThis;return!!e&&n.includes(r)}function l7(r){switch(r){case"image/avif":case"image/webp":return c7(r);default:return!0}}function c7(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}const $n=new jp({id:"deck"}),aA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},fv=1,Wp=2,pv=3,gv=4,u7=2,h7=r=>({"layer.changeFlag":(t,e,n)=>{r.log(pv,"".concat(t.id," ").concat(e,": "),n[e])()},"layer.initialize":t=>{r.log(fv,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const n=t.getChangeFlags();r.log(Wp,"Updating ".concat(t," because: ").concat(Object.keys(n).filter(i=>n[i]).join(", ")))()}else r.log(gv,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&r.log(gv,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{r.log(fv,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,n)=>{e?r.log(Wp,"Composite layer rendered new subLayers ".concat(t),n)():r.log(gv,"Composite layer reused subLayers ".concat(t),n)()},"layerManager.setLayers":(t,e,n)=>{e&&r.log(Wp,"Updating ".concat(n.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{r.log(pv,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,n)=>{r.log(fv,n?"invalidated attributes ".concat(n," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{aA.attributeUpdateMessages.length=0,aA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const n=Math.round(Date.now()-aA.attributeManagerUpdateStart);r.groupCollapsed(Wp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(n,"ms"))();for(const i of aA.attributeUpdateMessages)r.log(pv,i)();r.groupEnd(Wp)()},"attribute.updateStart":t=>{aA.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const n="".concat(t.id," allocated ").concat(e);aA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(t,e)=>{const n=Math.round(Date.now()-aA.attributeUpdateStart),i="".concat(t.id," updated ").concat(e," in ").concat(n,"ms");aA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(t,e,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of e){const{totalCount:d,visibleCount:f,compositeCount:m,pickableCount:v}=o,b=d-m-f;r.log(u7,"RENDER #".concat(t.renderCount,"   ").concat(f," (of ").concat(d," layers) to ").concat(i," because ").concat(s,"   (").concat(b," hidden, ").concat(m," composite ").concat(v," pickable)"))(),a&&a.get("Redraw Layers").add(f)}}});var A7={};let c0={};A7.NODE_ENV!=="production"&&(c0=h7($n));function d7(r){c0=r}function ra(r,t,e,n){$n.level>0&&c0[r]&&c0[r].call(null,t,e,n)}function f7(r){const t=r[0],e=r[r.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const p7={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:f7,parseTextSync:JSON.parse};function g7(){const r="8.9.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==r)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(r));return t||($n.log(1,"deck.gl ".concat(r))(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:$n,_registerLoggers:d7},sH([p7,[NS,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const m7=g7(),jn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(jn,"IDENTITY",{get:()=>($n.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Iu={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},mv={common:0,meters:1,pixels:2},kS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},qr=new jp({id:"luma.gl"});function Ta(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}const y7="Invalid WebGLRenderingContext",_7="Requires WebGL2";function u0(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function Un(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function v7(r){return Un(r)?r:null}function h0(r){return Ta(u0(r),y7),r}function Sa(r){return Ta(Un(r),_7),r}const $p={};function b7(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function w7(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function x7(r,t){$p[r]=!0,b7(t)}function B7(r){const t=r.getError;r.getError=function(){let n;do n=t.apply(r),n!==0&&($p[n]=!0);while(n!==0);for(n in $p)if($p[n])return delete $p[n],parseInt(n,10);return 0}}const Xp=function r(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let n=0;n<this.attribs.length;n++){const i=new r.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};Xp.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},Xp.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const nd=function(t){const e=this;this.gl=t,B7(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(s){return s===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(s){const a=e.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,s);const o=a.attribs[s];return o.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(s,a){switch(s){case 34962:e.currentArrayBuffer=a;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=a;break}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(s,a){const d=e.currentVertexArrayObject.attribs[s];switch(a){case 34975:return d.buffer;case 34338:return d.enabled;case 34339:return d.size;case 34340:return d.stride;case 34341:return d.type;case 34922:return d.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(s,a,o,d,f,m){const v=e.currentVertexArrayObject;v.maxAttrib=Math.max(v.maxAttrib,s);const C=v.attribs[s];return C.buffer=e.currentArrayBuffer,C.size=a,C.type=o,C.normalized=d,C.stride=f,C.offset=m,C.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{w7("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};nd.prototype.VERTEX_ARRAY_BINDING_OES=34229,nd.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let n=0;n<this.vertexArrayObjects.length;++n)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new Xp(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},nd.prototype.createVertexArrayOES=function(){const t=new Xp(this);return this.vertexArrayObjects.push(t),t},nd.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},nd.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof Xp&&t.hasBeenBound&&t.ext===this)},nd.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive){x7(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let d=0;d<=o;d++){const f=s.attribs[d],m=i?i.attribs[d]:null;if((!i||f.enabled!==m.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,d):n.disableVertexAttribArray.call(e,d)),f.enabled){let v=!1;(!i||f.buffer!==m.buffer)&&(a!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),a=f.buffer),v=!0),(v||f.cached!==m.cached)&&n.vertexAttribPointer.call(e,d,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==a&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)};function C7(r){if(typeof r.createVertexArray=="function")return;const t=r.getSupportedExtensions;r.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const e=r.getExtension;r.getExtension=function(i){const s=e.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new nd(this)),this.__OESVertexArrayObject))}}const QS="OES_element_index",zS="WEBGL_draw_buffers",E7="EXT_disjoint_timer_query",T7="EXT_disjoint_timer_query_webgl2",S7="EXT_texture_filter_anisotropic",HS="WEBGL_debug_renderer_info",I7=35723,P7=4352,M7=36795,F7=34047,L7=37445,R7=37446,ki=r=>Un(r)?void 0:0,O7={3074:r=>Un(r)?void 0:36064,[I7]:r=>Un(r)?void 0:P7,35977:ki,32937:ki,[M7]:(r,t)=>{const e=Un(r)?r.getExtension(T7):r.getExtension(E7);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[L7]:(r,t)=>{const e=r.getExtension(HS);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[R7]:(r,t)=>{const e=r.getExtension(HS);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[F7]:(r,t)=>{const e=r.luma.extensions[S7];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:ki,35071:ki,37447:ki,36063:(r,t)=>{if(!Un(r)){const e=r.getExtension(zS);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:ki,35374:ki,35377:ki,34852:r=>{if(!Un(r)){const t=r.getExtension(zS);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(QS)?2147483647:65535,33001:r=>r.getExtension(QS)?16777216:65535,33e3:r=>16777216,37157:ki,35373:ki,35657:ki,36183:ki,37137:ki,34045:ki,35978:ki,35979:ki,35968:ki,35376:ki,35375:ki,35659:ki,37154:ki,35371:ki,35658:ki,35076:ki,35077:ki,35380:ki};function U7(r,t,e){const n=O7[e],i=typeof n=="function"?n(r,t,e):n;return i!==void 0?i:t(e)}const D7="OES_vertex_array_object",VS="ANGLE_instanced_arrays",N7="WEBGL_draw_buffers",k7="EXT_disjoint_timer_query",Q7="EXT_texture_filter_anisotropic",z7="VertexArray requires WebGL2 or OES_vertex_array_object extension";function H7(r,t){return{webgl2:Un(r),ext:r.getExtension(t)}}const GS={[D7]:{meta:{suffix:"OES"},createVertexArray:()=>{Ta(!1,z7)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[VS]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,t){Ta(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[N7]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Ta(!1)}},[k7]:{meta:{suffix:"EXT"},createQuery:()=>{Ta(!1)},deleteQuery:()=>{Ta(!1)},beginQuery:()=>{Ta(!1)},endQuery:()=>{},getQuery(r,t){return this.getQueryObject(r,t)},getQueryParameter(r,t){return this.getQueryObject(r,t)},getQueryObject:()=>{}}},yv={readBuffer:(r,t,e)=>{Un(r)&&t(e)},getVertexAttrib:(r,t,e,n)=>{const{webgl2:i,ext:s}=H7(r,VS);let a;switch(n){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!s?0:void 0;break}return a!==void 0?a:t(e,n)},getProgramParameter:(r,t,e,n)=>{if(!Un(r))switch(n){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,n)},getInternalformatParameter:(r,t,e,n,i)=>{if(!Un(r))switch(i){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(e,n,i)},getTexParameter(r,t,e,n){switch(n){case 34046:const{extensions:i}=r.luma,s=i[Q7];n=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,n)},getParameter:U7,hint(r,t,e,n){return t(e,n)}};function V7(r){r.luma=r.luma||{};const{luma:t}=r;return t.polyfilled||(C7(r),G7(r),q7(r,GS),j7(r,{target:t,target2:r}),t.polyfilled=!0),r}globalThis.polyfillContext=V7;function G7(r){r.luma.extensions={};const t=r.getSupportedExtensions()||[];for(const e of t)r.luma[e]=r.getExtension(e)}function j7(r,t){let{target:e,target2:n}=t;Object.keys(yv).forEach(i=>{if(typeof yv[i]=="function"){const s=r[i]?r[i].bind(r):()=>{},a=yv[i].bind(null,r,s);e[i]=a,n[i]=a}})}function q7(r,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&K7(r,{extension:e,target:r.luma,target2:r})}function K7(r,t){let{extension:e,target:n,target2:i}=t;const s=GS[e];Ta(s);const{meta:a={}}=s,{suffix:o=""}=a,d=r.getExtension(e);for(const f of Object.keys(s)){const m="".concat(f).concat(o);let v=null;f==="meta"||typeof r[f]=="function"||(d&&typeof d[m]=="function"?v=function(){return d[m](...arguments)}:typeof s[f]=="function"&&(v=s[f].bind(n))),v&&(n[f]=v,i[f]=v)}}const _v={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},lA=(r,t,e)=>t?r.enable(e):r.disable(e),jS=(r,t,e)=>r.hint(e,t),pl=(r,t,e)=>r.pixelStorei(e,t),W7=(r,t)=>{const e=Un(r)?36009:36160;return r.bindFramebuffer(e,t)},$7=(r,t)=>r.bindFramebuffer(36008,t);function Zp(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const X7={3042:lA,32773:(r,t)=>r.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,t)=>r.clearColor(...t),3107:(r,t)=>r.colorMask(...t),2884:lA,2885:(r,t)=>r.cullFace(t),2929:lA,2931:(r,t)=>r.clearDepth(t),2932:(r,t)=>r.depthFunc(t),2928:(r,t)=>r.depthRange(...t),2930:(r,t)=>r.depthMask(t),3024:lA,35723:jS,36006:W7,2886:(r,t)=>r.frontFace(t),33170:jS,2849:(r,t)=>r.lineWidth(t),32823:lA,32824:"polygonOffset",10752:"polygonOffset",35977:lA,32938:"sampleCoverage",32939:"sampleCoverage",3089:lA,3088:(r,t)=>r.scissor(...t),2960:lA,2961:(r,t)=>r.clearStencil(t),2968:(r,t)=>r.stencilMaskSeparate(1028,t),36005:(r,t)=>r.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,t)=>r.viewport(...t),3333:pl,3317:pl,37440:pl,37441:pl,37443:pl,3330:pl,3332:pl,3331:pl,36010:$7,3314:pl,32878:pl,3316:pl,3315:pl,32877:pl,framebuffer:(r,t)=>{const e=t&&"handle"in t?t.handle:t;return r.bindFramebuffer(36160,e)},blend:(r,t)=>t?r.enable(3042):r.disable(3042),blendColor:(r,t)=>r.blendColor(...t),blendEquation:(r,t)=>{t=Zp(t)?t:[t,t],r.blendEquationSeparate(...t)},blendFunc:(r,t)=>{t=Zp(t)&&t.length===2?[...t,...t]:t,r.blendFuncSeparate(...t)},clearColor:(r,t)=>r.clearColor(...t),clearDepth:(r,t)=>r.clearDepth(t),clearStencil:(r,t)=>r.clearStencil(t),colorMask:(r,t)=>r.colorMask(...t),cull:(r,t)=>t?r.enable(2884):r.disable(2884),cullFace:(r,t)=>r.cullFace(t),depthTest:(r,t)=>t?r.enable(2929):r.disable(2929),depthFunc:(r,t)=>r.depthFunc(t),depthMask:(r,t)=>r.depthMask(t),depthRange:(r,t)=>r.depthRange(...t),dither:(r,t)=>t?r.enable(3024):r.disable(3024),derivativeHint:(r,t)=>{r.hint(35723,t)},frontFace:(r,t)=>r.frontFace(t),mipmapHint:(r,t)=>r.hint(33170,t),lineWidth:(r,t)=>r.lineWidth(t),polygonOffsetFill:(r,t)=>t?r.enable(32823):r.disable(32823),polygonOffset:(r,t)=>r.polygonOffset(...t),sampleCoverage:(r,t)=>r.sampleCoverage(...t),scissorTest:(r,t)=>t?r.enable(3089):r.disable(3089),scissor:(r,t)=>r.scissor(...t),stencilTest:(r,t)=>t?r.enable(2960):r.disable(2960),stencilMask:(r,t)=>{t=Zp(t)?t:[t,t];const[e,n]=t;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,t)=>{t=Zp(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilFuncSeparate(1028,e,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,t)=>{t=Zp(t)&&t.length===3?[...t,...t]:t;const[e,n,i,s,a,o]=t;r.stencilOpSeparate(1028,e,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,t)=>r.viewport(...t)};function ds(r,t,e){return t[r]!==void 0?t[r]:e[r]}const Z7={blendEquation:(r,t,e)=>r.blendEquationSeparate(ds(32777,t,e),ds(34877,t,e)),blendFunc:(r,t,e)=>r.blendFuncSeparate(ds(32969,t,e),ds(32968,t,e),ds(32971,t,e),ds(32970,t,e)),polygonOffset:(r,t,e)=>r.polygonOffset(ds(32824,t,e),ds(10752,t,e)),sampleCoverage:(r,t,e)=>r.sampleCoverage(ds(32938,t,e),ds(32939,t,e)),stencilFuncFront:(r,t,e)=>r.stencilFuncSeparate(1028,ds(2962,t,e),ds(2967,t,e),ds(2963,t,e)),stencilFuncBack:(r,t,e)=>r.stencilFuncSeparate(1029,ds(34816,t,e),ds(36003,t,e),ds(36004,t,e)),stencilOpFront:(r,t,e)=>r.stencilOpSeparate(1028,ds(2964,t,e),ds(2965,t,e),ds(2966,t,e)),stencilOpBack:(r,t,e)=>r.stencilOpSeparate(1029,ds(34817,t,e),ds(34818,t,e),ds(34819,t,e))},qS={enable:(r,t)=>r({[t]:!0}),disable:(r,t)=>r({[t]:!1}),pixelStorei:(r,t,e)=>r({[t]:e}),hint:(r,t,e)=>r({[t]:e}),bindFramebuffer:(r,t,e)=>{switch(t){case 36160:return r({36006:e,36010:e});case 36009:return r({36006:e});case 36008:return r({36010:e});default:return null}},blendColor:(r,t,e,n,i)=>r({32773:new Float32Array([t,e,n,i])}),blendEquation:(r,t)=>r({32777:t,34877:t}),blendEquationSeparate:(r,t,e)=>r({32777:t,34877:e}),blendFunc:(r,t,e)=>r({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(r,t,e,n,i)=>r({32969:t,32968:e,32971:n,32970:i}),clearColor:(r,t,e,n,i)=>r({3106:new Float32Array([t,e,n,i])}),clearDepth:(r,t)=>r({2931:t}),clearStencil:(r,t)=>r({2961:t}),colorMask:(r,t,e,n,i)=>r({3107:[t,e,n,i]}),cullFace:(r,t)=>r({2885:t}),depthFunc:(r,t)=>r({2932:t}),depthRange:(r,t,e)=>r({2928:new Float32Array([t,e])}),depthMask:(r,t)=>r({2930:t}),frontFace:(r,t)=>r({2886:t}),lineWidth:(r,t)=>r({2849:t}),polygonOffset:(r,t,e)=>r({32824:t,10752:e}),sampleCoverage:(r,t,e)=>r({32938:t,32939:e}),scissor:(r,t,e,n,i)=>r({3088:new Int32Array([t,e,n,i])}),stencilMask:(r,t)=>r({2968:t,36005:t}),stencilMaskSeparate:(r,t,e)=>r({[t===1028?2968:36005]:e}),stencilFunc:(r,t,e,n)=>r({2962:t,2967:e,2963:n,34816:t,36003:e,36004:n}),stencilFuncSeparate:(r,t,e,n,i)=>r({[t===1028?2962:34816]:e,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(r,t,e,n)=>r({2964:t,2965:e,2966:n,34817:t,34818:e,34819:n}),stencilOpSeparate:(r,t,e,n,i)=>r({[t===1028?2964:34817]:e,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(r,t,e,n,i)=>r({2978:[t,e,n,i]})},Pu=(r,t)=>r.isEnabled(t),KS={3042:Pu,2884:Pu,2929:Pu,3024:Pu,32823:Pu,32926:Pu,32928:Pu,3089:Pu,2960:Pu,35977:Pu};function WS(r){for(const t in r)return!1;return!0}function Y7(r,t){if(r===t)return!0;const e=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&n&&r.length===t.length){for(let i=0;i<r.length;++i)if(r[i]!==t[i])return!1;return!0}return!1}function $S(r,t){const e=r[t].bind(r);r[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in r.state.cache?r.state.enable?r.state.cache[i]:e(...arguments):e(...arguments)},Object.defineProperty(r[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function J7(r,t,e){const n=r[t].bind(r);r[t]=function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];const{valueChanged:d,oldValue:f}=e(r.state._updateCache,...a);return d&&n(...a),f},Object.defineProperty(r[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function tV(r){const t=r.useProgram.bind(r);r.useProgram=function(n){r.state.program!==n&&(t(n),r.state.program=n)}}class eV{constructor(t){let{copyState:e=!1,log:n=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?nV(t):Object.assign({},_v),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Ta(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];gh(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,n;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){Ta(s!==void 0);const a=t[s],o=this.cache[s];Y7(a,o)||(e=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:e,oldValue:n}}}function XS(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:n}=t;if(Ta(n!==void 0),!r.state){const{polyfillContext:i}=globalThis;i&&i(r),r.state=new eV(r,{copyState:n}),tV(r);for(const s in qS){const a=qS[s];J7(r,s,a)}$S(r,"getParameter"),$S(r,"isEnabled")}return r.state.enable=e,r}function rV(r){r.state||XS(r,{copyState:!1}),r.state.push()}function ZS(r){Ta(r.state),r.state.pop()}function gh(r,t){if(Ta(u0(r),"setParameters requires a WebGL context"),WS(t))return;const e={};for(const i in t){const s=Number(i),a=X7[i];a&&(typeof a=="string"?e[a]=!0:a(r,t[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in e){const s=Z7[i];s(r,t,n)}}function nV(r,t){if(t=t||_v,typeof t=="number"){const i=t,s=KS[i];return s?s(r,i):r.getParameter(i)}const e=Array.isArray(t)?t:Object.keys(t),n={};for(const i of e){const s=KS[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function iV(r){gh(r,_v)}function xc(r,t,e){if(WS(t))return e(r);const{nocatch:n=!0}=t;rV(r),gh(r,t);let i;if(n)i=e(r),ZS(r);else try{i=e(r)}finally{ZS(r)}return i}function of(r){const{luma:t}=r;if(r.canvas&&t){const e=t.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:r.canvas.clientWidth;return n?r.drawingBufferWidth/n:1}return 1}function vv(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const n=of(r),i=r.drawingBufferWidth,s=r.drawingBufferHeight;return oV(t,n,i,s,e)}function sV(r){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?t:1}function oV(r,t,e,n,i){const s=YS(r[0],t,e);let a=JS(r[1],t,n,i),o=YS(r[0]+1,t,e);const d=o===e-1?o:o-1;o=JS(r[1]+1,t,n,i);let f;return i?(o=o===0?o:o+1,f=a,a=o):f=o===n-1?o:o-1,{x:s,y:a,width:Math.max(d-s+1,1),height:Math.max(f-a+1,1)}}function YS(r,t,e){return Math.min(Math.round(r*t),e-1)}function JS(r,t,e,n){return n?Math.max(0,e-1-Math.round(r*t)):Math.min(Math.round(r*t),e-1)}const bv=ph(),aV=bv&&typeof document<"u",t5={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function e5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ta(bv,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},t5,r);const{width:t,height:e}=r;function n(o){if(r.throwOnError)throw new Error(o);return console.error(o),null}r.onError=n;let i;const{canvas:s}=r,a=hV({canvas:s,width:t,height:e,onError:n});return i=uV(a,r),i?(i=wv(i,r),AV(i),i):null}function wv(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||dV(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},t=Object.assign({},t5,t);const{manageState:e,debug:n}=t;return e&&XS(r,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return qr.log(1,...s)()}}),bv&&n&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,t),qr.level=Math.max(qr.level,1)):qr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function lV(r){const t=r.getParameter(7936),e=r.getParameter(7937),n=r.getExtension("WEBGL_debug_renderer_info"),i=n&&r.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),s=n&&r.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||t,renderer:s||e,vendorMasked:t,rendererMasked:e,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function cV(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const n=sV(t.useDevicePixels);fV(r,n,t);return}const e=r.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function uV(r,t){const{onError:e}=t;let n=null;const i=d=>n=d.statusMessage||n;r.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;return a&&(o=o||r.getContext("webgl2",t),o=o||r.getContext("experimental-webgl2",t)),s&&(o=o||r.getContext("webgl",t),o=o||r.getContext("experimental-webgl",t)),r.removeEventListener("webglcontextcreationerror",i,!1),o?(t.onContextLost&&r.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&r.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):e("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function hV(r){let{canvas:t,width:e=800,height:n=600,onError:i}=r,s;return typeof t=="string"?(aV&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",s.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function AV(r){const t=Un(r)?"WebGL2":"WebGL1",e=lV(r),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=r.debug?" debug":"";qr.info(1,"".concat(t).concat(i," context ").concat(n))()}function dV(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function fV(r,t,e){let n="width"in e?e.width:r.canvas.clientWidth,i="height"in e?e.height:r.canvas.clientHeight;(!n||!i)&&(qr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=r.canvas.width||1,i=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const s=r.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let a=t;const o=Math.floor(n*a),d=Math.floor(i*a);r.canvas.width=o,r.canvas.height=d,(r.drawingBufferWidth!==o||r.drawingBufferHeight!==d)&&(qr.warn("Device pixel ratio clamped")(),a=Math.min(r.drawingBufferWidth/n,r.drawingBufferHeight/i),r.canvas.width=Math.floor(n*a),r.canvas.height=Math.floor(i*a)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}const Yp="8.5.21",pV="set luma.log.level=1 (or higher) to trace rendering";class gV{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new zp({id:t})),this.stats.get(t)}}const id=new gV;if(globalThis.luma&&globalThis.luma.VERSION!==Yp)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Yp));globalThis.luma||(ph()&&qr.log(1,"luma.gl ".concat(Yp," - ").concat(pV))(),globalThis.luma=globalThis.luma||{VERSION:Yp,version:Yp,log:qr,stats:id,globals:{modules:{},nodeIO:{}}});function mV(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function yV(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function Or(r,t){if(!r)throw new Error(t||"luma.gl: assertion failed.")}function xv(r,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const n=r[t];return Or(n!==void 0,"Accessing undefined constant GL.".concat(t)),n}function cA(r,t){t=Number(t);for(const e in r)if(r[e]===t)return"GL.".concat(e);return String(t)}const Bv={};function mh(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Bv[r]=Bv[r]||1;const t=Bv[r]++;return"".concat(r,"-").concat(t)}function r5(r){return Or(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function af(r){let t=!0;for(const e in r){t=!1;break}return t}function n5(r,t,e,n){const i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(r);n.forEach(a=>{s.methodName||(s[a]=()=>{throw qr.removed("Calling removed method ".concat(t,".").concat(a,": "),i)(),new Error(a)})})}const lf="Resource subclass must define virtual methods";let yh=class{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};h0(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||mh(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(n=>n.delete()),this}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof t!="function")return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=xv(this.gl,t),Or(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=Un(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const o=i.webgl1,d="webgl2"in i?i.webgl2:i.webgl1;return s?d:o}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},s=Un(this.gl),a={},o=e||Object.keys(i);for(const d of o){const f=i[d];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const v=n?cA(this.gl,d):d;a[v]=this.getParameter(d,t),n&&f.type==="GLenum"&&(a[v]=cA(this.gl,a[v]))}}return a}setParameter(t,e){t=xv(this.gl,t),Or(t);const i=(this.constructor.PARAMETERS||{})[t];if(i){const s=Un(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(e=xv(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return n5(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(lf)}_deleteHandle(){throw new Error(lf)}_bindHandle(t){throw new Error(lf)}_getOptsFromHandle(){throw new Error(lf)}_getParameter(t,e){throw new Error(lf)}_setParameter(t,e){throw new Error(lf)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=id.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];id.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=id.get("Memory Usage".concat(n));i.get("GPU Memory").addCount(t),i.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=id.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}};const _V="Failed to deduce GL constant from typed array";function Cv(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(_V)}}function Jp(r){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function vV(r){let{data:t,width:e,height:n,bytesPerPixel:i=4,temp:s}=r;const a=e*i;s=s||new Uint8Array(a);for(let o=0;o<n/2;++o){const d=o*a,f=(n-o-1)*a;s.set(t.subarray(d,d+a)),t.copyWithin(d,f,f+a),t.set(s,f)}}function bV(r){let{data:t,width:e,height:n}=r;const i=Math.round(e/2),s=Math.round(n/2),a=new Uint8Array(i*s*4);for(let o=0;o<s;o++)for(let d=0;d<i;d++)for(let f=0;f<4;f++)a[(o*i+d)*4+f]=t[(o*2*e+d*2)*4+f];return{data:a,width:i,height:s}}function Ev(r,t,e){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=e;for(const o in n)if(o in t){const f=n[o]?"".concat(r,".").concat(n[o]):"N/A";qr.removed("".concat(r,".").concat(o),f)()}for(const o in i)if(o in t){const d=i[o];qr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(d))()}let a=null;for(const o in s)if(o in t){const d=s[o];qr.deprecated("".concat(r,".").concat(o),"".concat(r,".").concat(d))(),a=a||Object.assign({},t),a[d]=t[o],delete a[o]}return a||t}const wV={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},xV={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class $a{static getBytesPerElement(t){return Jp(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Or(t.size),Jp(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new $a(wV,...e)}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return $a.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return $a.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=Ev("Accessor",t,xV),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const i5=10,s5={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},BV={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:s5},CV={removedProps:s5};let Si=class extends yh{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/$a.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/$a.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Ev("Buffer",t,BV),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return t=Ev("Buffer",t,CV),"accessor"in t&&this.setAccessor(t.accessor),this}setAccessor(t){return t=Object.assign({},t),delete t.buffer,this.accessor=new $a(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,s=t.byteLength||t.length;Or(e);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||s!==void 0?(Sa(this.gl),this.gl.bufferSubData(this.target,n,e,i,s)):this.gl.bufferSubData(a,n,e),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:s}=t;const{gl:a}=this;return Sa(a),a.bindBuffer(36662,e.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,n,i,s),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Sa(this.gl);const s=Jp(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(e),o=n;let d,f;t?(f=t.length,d=f-o):(d=Math.min(a,i||a),f=o+d);const m=Math.min(a,d);return i=i||m,Or(i<=m),t=t||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?i!==void 0?this.gl.bindBufferRange(t,e,this.handle,n,i):(Or(n===0),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t===35345||t===35982?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(i5,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.byteLength+e;Or(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,i5),this.bytesUsed=n,this._trackAllocatedMemory(n);const s=Cv(t);return Or(s),this.setAccessor(new $a(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Or(t>=0),this._trackDeallocatedMemory();let n=t;t===0&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=Jp(this.accessor.type||5126,{clamped:!1}),n=t/e.BYTES_PER_ELEMENT;return this.getElementCount()-n}_inferType(t){this.accessor.type||this.setAccessor(new $a(this.accessor,{type:Cv(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return qr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return qr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return qr.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return qr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new $a(this.accessor,t),this}};const Tv={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},o5={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},a5={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function EV(r,t){const e=Tv[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const n=Un(r)&&e.gl2||e.gl1;return typeof n=="string"?r.getExtension(n):n}function TV(r,t){const e=Tv[t];switch(e&&e.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const SV=[9729,9728],l5=globalThis.WebGLBuffer||function(){};class cf extends yh{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:n,linearFiltering:i}=e;let s=!0;return n&&(s=s&&EV(t,n),s=s&&(!i||TV(t,n))),s}constructor(t,e){const{id:n=mh("texture"),handle:i,target:s}=e;super(t,{id:n,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(z=>this.initialize(Object.assign({},t,{pixels:z,data:z}))),this;const n=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:i=null,format:s=6408,border:a=0,recreate:o=!1,parameters:d={},pixelStore:f={},textureUnit:m=void 0}=t;e||(e=i);let{width:v,height:C,dataFormat:b,type:P,compressed:F=!1,mipmaps:U=!0}=t;const{depth:k=0}=t;return{width:v,height:C,compressed:F,dataFormat:b,type:P}=this._deduceParameters({format:s,type:P,dataFormat:b,compressed:F,data:e,width:v,height:C}),this.width=v,this.height=C,this.depth=k,this.format=s,this.type=P,this.dataFormat=b,this.border=a,this.textureUnit=m,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),U&&this._isNPOT()&&(qr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),U=!1,this._updateForNPOT(d)),this.mipmaps=U,this.setImageData({data:e,width:v,height:C,depth:k,format:s,type:P,dataFormat:b,border:a,mipmaps:U,parameters:f,compressed:F}),U&&this.generateMipmap(),this.setParameters(d),o&&(this.data=e),n&&(this._video={video:e,parameters:d,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:i=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(qr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),xc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:s=this.format,border:a=this.border,offset:o=0,parameters:d={}}=t;let{data:f=null,type:m=this.type,width:v=this.width,height:C=this.height,dataFormat:b=this.dataFormat,compressed:P=!1}=t;f||(f=n),{type:m,dataFormat:b,compressed:P,width:v,height:C}=this._deduceParameters({format:s,type:m,dataFormat:b,compressed:P,data:f,width:v,height:C});const{gl:F}=this;F.bindTexture(this.target,this.handle);let U=null;({data:f,dataType:U}=this._getDataType({data:f,compressed:P}));let k,z=0;if(xc(this.gl,d,()=>{switch(U){case"null":F.texImage2D(e,i,s,v,C,a,b,m,f);break;case"typed-array":F.texImage2D(e,i,s,v,C,a,b,m,f,o);break;case"buffer":k=Sa(F),k.bindBuffer(35052,f.handle||f),k.texImage2D(e,i,s,v,C,a,b,m,o),k.bindBuffer(35052,null);break;case"browser-object":Un(F)?F.texImage2D(e,i,s,v,C,a,b,m,f):F.texImage2D(e,i,s,b,m,f);break;case"compressed":for(const[K,G]of f.entries())F.compressedTexImage2D(e,K,G.format,G.width,G.height,a,G.data),z+=G.levelSize;break;default:Or(!1,"Unknown image data type")}}),U==="compressed")this._trackAllocatedMemory(z,"Texture");else if(f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const K=o5[this.dataFormat]||4,G=a5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*K*G,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:a=0,width:o=this.width,height:d=this.height,level:f=0,format:m=this.format,type:v=this.type,dataFormat:C=this.dataFormat,compressed:b=!1,offset:P=0,border:F=this.border,parameters:U={}}=t;if({type:v,dataFormat:C,compressed:b,width:o,height:d}=this._deduceParameters({format:m,type:v,dataFormat:C,compressed:b,data:i,width:o,height:d}),Or(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const k=i;i=k.data,o=k.shape[0],d=k.shape[1]}i instanceof Si&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),xc(this.gl,U,()=>{if(b)this.gl.compressedTexSubImage2D(e,f,s,a,o,d,m,i);else if(i===null)this.gl.texSubImage2D(e,f,s,a,o,d,C,v,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,f,s,a,o,d,C,v,i,P);else if(i instanceof l5){const k=Sa(this.gl);k.bindBuffer(35052,i),k.texSubImage2D(e,f,s,a,o,d,C,v,P),k.bindBuffer(35052,null)}else Un(this.gl)?Sa(this.gl).texSubImage2D(e,f,s,a,o,d,C,v,i):this.gl.texSubImage2D(e,f,s,a,C,v,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return qr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Si?{data:e.handle,dataType:"buffer"}:e instanceof l5?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:s,dataFormat:a,type:o,compressed:d}=t;const f=Tv[e];return a=a||f&&f.dataFormat,o=o||f&&f.types[0],d=d||f&&f.compressed,{width:i,height:s}=this._deduceImageSize(n,i,s),{dataFormat:a,type:o,compressed:d,width:i,height:s,format:e,data:n}}_deduceImageSize(t,e,n){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:e,height:n}:i={width:e>=0?e:1,height:n>=0?n:1},Or(i,"Could not deduced texture size"),Or(e===void 0||i.width===e,"Deduced texture width does not match supplied width"),Or(n===void 0||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Or(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Un(this.gl)||!this.width||!this.height?!1:!r5(this.width)||!r5(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:SV.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let IV="";function PV(r,t){return Or(typeof r=="string"),r=IV+r,new Promise((e,n)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>n(new Error("Could not load image ".concat(r,"."))),i.crossOrigin=t&&t.crossOrigin||"anonymous",i.src=r}catch(i){n(i)}})}class gl extends cf{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return cf.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};h0(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:PV(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const Sv=[34069,34070,34071,34072,34073,34074];class c5 extends cf{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};h0(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)}),this}subImage(t){let{face:e,data:n,x:i=0,y:s=0,mipmapLevel:a=0}=t;return this._subImage({target:e,data:n,x:i,y:s,mipmapLevel:a})}async setCubeMapImageData(t){let{width:e,height:n,pixels:i,data:s,border:a=0,format:o=6408,type:d=5121}=t;const{gl:f}=this,m=i||s,v=await Promise.all(Sv.map(C=>{const b=m[C];return Promise.all(Array.isArray(b)?b:[b])}));this.bind(),Sv.forEach((C,b)=>{v[b].length>1&&this.opts.mipmaps!==!1&&qr.warn("".concat(this.id," has mipmap and multiple LODs."))(),v[b].forEach((P,F)=>{e&&n?f.texImage2D(C,F,o,e,n,a,o,d,P):f.texImage2D(C,F,o,o,d,P)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:s,data:a,border:o=0,format:d=6408,type:f=5121}=t,{gl:m}=this,v=s||a;return this.bind(),v instanceof Promise?v.then(C=>this.setImageDataForFace(Object.assign({},t,{face:e,data:C,pixels:C}))):this.width||this.height?m.texImage2D(e,0,d,n,i,o,d,f,v):m.texImage2D(e,0,d,d,f,v),this}}c5.FACES=Sv;class MV extends cf{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return Un(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Sa(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:i,height:s,depth:a=1,border:o=0,format:d,type:f=5121,offset:m=0,data:v,parameters:C={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),xc(this.gl,C,()=>{ArrayBuffer.isView(v)&&this.gl.texImage3D(this.target,e,n,i,s,a,o,d,f,v),v instanceof Si&&(this.gl.bindBuffer(35052,v.handle),this.gl.texImage3D(this.target,e,n,i,s,a,o,d,f,m))}),v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{const b=o5[this.dataFormat]||4,P=a5[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*b*P,"Texture")}return this.loaded=!0,this}}const sd="EXT_color_buffer_float",u5={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:sd,bpp:2},33327:{gl2:sd,bpp:4},34842:{gl2:sd,bpp:8},33326:{gl2:sd,bpp:4},33328:{gl2:sd,bpp:8},34836:{gl2:sd,bpp:16},35898:{gl2:sd,bpp:4}};function FV(r,t,e){const n=e[t];if(!n)return!1;const i=Un(r)&&n.gl2||n.gl1;return typeof i=="string"?r.getExtension(i):i}class uf extends yh{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||FV(t,e,u5)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:i=1,samples:s=0}=t;return Or(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Un(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*u5[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const LV=256,RV=1024,OV=16384,h5=6144,A5=6145,d5=6146,f5=34041,p5="clear: bad arguments";function Iv(r){let{framebuffer:t=null,color:e=null,depth:n=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let a=0;e&&(a|=OV,e!==!0&&(s.clearColor=e)),n&&(a|=LV,n!==!0&&(s.clearDepth=n)),i&&(a|=RV,n!==!0&&(s.clearStencil=n)),Or(a!==0,p5),xc(r,s,()=>{r.clear(a)})}function UV(r){let{framebuffer:t=null,buffer:e=h5,drawBuffer:n=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Sa(r),xc(r,{framebuffer:t},()=>{switch(e){case h5:switch(i.constructor){case Int32Array:r.clearBufferiv(e,n,i);break;case Uint32Array:r.clearBufferuiv(e,n,i);break;case Float32Array:default:r.clearBufferfv(e,n,i)}break;case A5:r.clearBufferfv(A5,0,[i]);break;case d5:r.clearBufferiv(d5,0,[i]);break;case f5:const[s,a]=i;r.clearBufferfi(f5,0,s,a);break;default:Or(!1,p5)}})}function DV(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Or(!1),0}}function A0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:n=0,sourceFormat:i=6408}=t;let{sourceAttachment:s=36064,target:a=null,sourceWidth:o,sourceHeight:d,sourceType:f}=t;const{framebuffer:m,deleteFramebuffer:v}=NV(r);Or(m);const{gl:C,handle:b,attachments:P}=m;o=o||m.width,d=d||m.height,s===36064&&b===null&&(s=1028),Or(P[s]),f=f||P[s].type,a=kV(a,f,i,o,d),f=f||Cv(a);const F=C.bindFramebuffer(36160,b);return C.readPixels(e,n,o,d,i,f,a),C.bindFramebuffer(36160,F||null),v&&m.delete(),a}function g5(r){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=A0(r,{sourceAttachment:t}),{width:i,height:s}=r;for(;s>e;)({data:n,width:i,height:s}=bV({data:n,width:i,height:s}));vV({data:n,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),d=o.createImageData(i,s);return d.data.set(n),o.putImageData(d,0,0),a.toDataURL()}function NV(r){return r instanceof co?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:WV(r),deleteFramebuffer:!0}}function kV(r,t,e,n,i){if(r)return r;t=t||5121;const s=Jp(t,{clamped:!1}),a=DV(e);return new s(n*i*a)}const Qi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function QV(r){const t=new gl(r,{format:6408,type:5126,dataFormat:6408}),e=new co(r,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),n=e.getStatus();return t.delete(),e.delete(),n===36053}const m5={[Qi.WEBGL2]:[!1,!0],[Qi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Qi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Qi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Qi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Qi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Qi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Qi.FLOAT_BLEND]:["EXT_float_blend"],[Qi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Qi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Qi.TEXTURE_FLOAT]:["OES_texture_float",!0],[Qi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Qi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Qi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Qi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Qi.COLOR_ATTACHMENT_RGBA32F]:[QV,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Qi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Qi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Qi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Qi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},zV=2;function Pv(r,t){return y5(r,t)}function y5(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>_5(r,e))}function HV(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const t in m5)r.luma.caps[t]===void 0&&(r.luma.caps[t]=_5(r,t));return r.luma.caps}function _5(r,t){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[t]===void 0&&(r.luma.caps[t]=VV(r,t)),r.luma.caps[t]||qr.log(zV,"Feature: ".concat(t," not supported"))(),r.luma.caps[t]}function VV(r,t){const e=m5[t];Or(e,t);let n;const i=Un(r)&&e[1]||e[0];if(typeof i=="function")n=i(r);else if(Array.isArray(i)){n=!0;for(const s of i)n=n&&!!r.getExtension(s)}else typeof i=="string"?n=!!r.getExtension(i):typeof i=="boolean"?n=i:Or(!1);return n}const v5="Multiple render targets not supported";class co extends yh{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let s=!0;return n&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new co(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Sa(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Sa(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:i=null,color:s=!0,depth:a=!0,stencil:o=!1,check:d=!0,readBuffer:f=void 0,drawBuffers:m=void 0}=t;if(Or(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const v in i){const C=i[v];(Array.isArray(C)?C[0]:C).resize({width:e,height:n})}else i=this._createDefaultAttachments(s,a,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:f,drawBuffers:m}),i&&d&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:a=!0}=t;this.attach(e,{clearAttachments:s,resizeAttachments:a});const{gl:o}=this,d=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,d||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:n}=t;if(this.handle===null)return Or(e===void 0&&n===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&qr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const i in this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};e&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){Or(a!==void 0,"Misspelled framebuffer binding point?");const o=Number(a),d=i[o];let f=d;if(!f)this._unattach(o);else if(f instanceof uf)this._attachRenderbuffer({attachment:o,renderbuffer:f});else if(Array.isArray(d)){const[m,v=0,C=0]=d;f=m,this._attachTexture({attachment:o,texture:m,layer:v,level:C})}else this._attachTexture({attachment:o,texture:f,layer:0,level:0});n&&f&&f.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(jV(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:n,stencil:i,drawBuffers:s=[]}=t,a=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Iv(this.gl,{color:e,depth:n,stencil:i}),s.forEach((o,d)=>{UV(this.gl,{drawBuffer:d,value:o})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return qr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return qr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return qr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return qr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return qr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return qr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:s,height:a}=t;const o=Sa(this.gl),d=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&s===void 0&&a===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,s,a),o.bindFramebuffer(36008,d),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=cA(this.gl,i)),i}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of n){const a=e?cA(this.gl,s):s;i[a]=this.getAttachmentParameter(t,s,e)}return i}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),n={};for(const i of e){const s=Number(i),a=t?cA(this.gl,s):s;n[a]=this.getAttachmentParameters(s,t)}return n}show(){return typeof window<"u"&&window.open(g5(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>qr.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const n=g5(this,{targetMaxHeight:100});return qr.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,s){let a=null;return t&&(a=a||{},a[36064]=new gl(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),e&&n?(a=a||{},a[33306]=new uf(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):e?(a=a||{},a[36096]=new uf(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(a[36096])):n&&Or(!1),a}_unattach(t){const e=this.attachments[t];e&&(e instanceof uf?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:s}=t;const{gl:a}=this;switch(a.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Sa(a).framebufferTextureLayer(36160,e,n.target,s,i);break;case 34067:const d=GV(i);a.framebufferTexture2D(36160,e,d,n.handle,s);break;case 3553:a.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:Or(!1,"Illegal texture type")}a.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=v7(this.gl);e?e.readBuffer(t):Or(t===36064||t===1029,v5),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=Sa(e);if(n)n.drawBuffers(t);else{const i=e.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(t):Or(t.length===1&&(t[0]===36064||t[0]===1029),v5)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=HV(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function GV(r){return r<34069?r+34069:r}function jV(r){return(co.STATUS||{})[r]||"Framebuffer error ".concat(r)}const qV=[36049,36048,33296,33298,33299,33300,33301,33302,33303];co.ATTACHMENT_PARAMETERS=qV;function KV(r,t){Or(r instanceof gl||r instanceof c5||r instanceof MV);const e=r.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:d,border:f,mipmaps:m}=r,v=Object.assign({width:i,height:s,format:a,type:o,dataFormat:d,border:f,mipmaps:m},t);return new e(n,v)}function WV(r,t){const{gl:e,width:n,height:i,id:s}=r;return new co(e,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:n,height:i,attachments:{36064:r}}))}function d0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=r.match(e);return n?n[1]:t}const $V=35632,XV=35633;function ZV(r){switch(r){case $V:return"fragment";case XV:return"vertex";default:return"unknown type"}}function YV(r,t,e,n){const i=r.split(/\r?\n/),s={},a={},o=n||d0(t)||"(unnamed)",d="".concat(ZV(e)," shader ").concat(o);for(let m=0;m<i.length;m++){const v=i[m];if(v.length<=1)continue;const C=v.split(":"),b=C[0],P=parseInt(C[2],10);if(isNaN(P))throw new Error("GLSL compilation error in ".concat(d,": ").concat(r));b!=="WARNING"?s[P]=v:a[P]=v}const f=JV(t);return{shaderName:d,errors:b5(s,f),warnings:b5(a,f)}}function b5(r,t){let e="";for(let n=0;n<t.length;n++){const i=t[n];if(!(!r[n+3]&&!r[n+2]&&!r[n+1])&&(e+="".concat(i,`
`),r[n+1])){const s=r[n+1],a=s.split(":",3),o=a[0],d=parseInt(a[1],10)||0,f=s.substring(a.join(":").length+1).trim();e+=w5("^^^ ".concat(o,": ").concat(f,`

`),d)}}return e}function JV(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const n=r.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((s,a)=>{const o=String(a+t),d=o.length;return w5(o,i-d)+e+s})}function w5(r,t){let e="";for(let n=0;n<t;++n)e+=" ";return"".concat(e).concat(r)}function x5(r){let t=100;const e=r.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const n=parseInt(e[1],10);Number.isFinite(n)&&(t=n)}return t}const t9="Shader: GLSL source code must be a JavaScript string";class tg extends yh{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Or(!1),"unknown"}}constructor(t,e){h0(t),Or(typeof e.source=="string",t9);const n=d0(e.source,null)||e.id||mh("unnamed ".concat(tg.getTypeName(e.shaderType)));super(t,{id:n}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=d0(e,null);n&&(this.id=mh(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(tg.getTypeName(this.shaderType),":").concat(this.id)}getName(){return d0(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const n=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:a}=YV(n,this.source,this.shaderType,this.id);throw qr.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),qr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Mv extends tg{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Fv extends tg{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const e9={5126:Wi.bind(null,"uniform1fv",ml,1,na),35664:Wi.bind(null,"uniform2fv",ml,2,na),35665:Wi.bind(null,"uniform3fv",ml,3,na),35666:Wi.bind(null,"uniform4fv",ml,4,na),5124:Wi.bind(null,"uniform1iv",uA,1,na),35667:Wi.bind(null,"uniform2iv",uA,2,na),35668:Wi.bind(null,"uniform3iv",uA,3,na),35669:Wi.bind(null,"uniform4iv",uA,4,na),35670:Wi.bind(null,"uniform1iv",uA,1,na),35671:Wi.bind(null,"uniform2iv",uA,2,na),35672:Wi.bind(null,"uniform3iv",uA,3,na),35673:Wi.bind(null,"uniform4iv",uA,4,na),35674:Wi.bind(null,"uniformMatrix2fv",ml,4,_h),35675:Wi.bind(null,"uniformMatrix3fv",ml,9,_h),35676:Wi.bind(null,"uniformMatrix4fv",ml,16,_h),35678:zo,35680:zo,5125:Wi.bind(null,"uniform1uiv",f0,1,na),36294:Wi.bind(null,"uniform2uiv",f0,2,na),36295:Wi.bind(null,"uniform3uiv",f0,3,na),36296:Wi.bind(null,"uniform4uiv",f0,4,na),35685:Wi.bind(null,"uniformMatrix2x3fv",ml,6,_h),35686:Wi.bind(null,"uniformMatrix2x4fv",ml,8,_h),35687:Wi.bind(null,"uniformMatrix3x2fv",ml,6,_h),35688:Wi.bind(null,"uniformMatrix3x4fv",ml,12,_h),35689:Wi.bind(null,"uniformMatrix4x2fv",ml,8,_h),35690:Wi.bind(null,"uniformMatrix4x3fv",ml,12,_h),35678:zo,35680:zo,35679:zo,35682:zo,36289:zo,36292:zo,36293:zo,36298:zo,36299:zo,36300:zo,36303:zo,36306:zo,36307:zo,36308:zo,36311:zo},r9={},n9={},i9={},B5=[0];function Lv(r,t,e,n){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(B5[0]=r,r=B5);const i=r.length;if(i%t&&qr.warn("Uniform size should be multiples of ".concat(t),r)(),r instanceof e)return r;let s=n[i];s||(s=new e(i),n[i]=s);for(let a=0;a<i;a++)s[a]=r[a];return s}function ml(r,t){return Lv(r,t,Float32Array,r9)}function uA(r,t){return Lv(r,t,Int32Array,n9)}function f0(r,t){return Lv(r,t,Uint32Array,i9)}function C5(r,t,e){const n=e9[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,r,t)}function s9(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=r.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function o9(r,t,e){for(const n in r){const i=r[n];if((!e||!!e[n])&&!a9(i))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(n),i),new Error("".concat(t," Bad uniform ").concat(n))}return!0}function a9(r){return Array.isArray(r)||ArrayBuffer.isView(r)?c9(r):isFinite(r)||r===!0||r===!1||r instanceof cf||r instanceof uf?!0:r instanceof co?!!r.texture:!1}function l9(r,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(r[t]){const n=r[t];for(let i=0,s=e.length;i<s;++i)n[i]=e[i]}else r[t]=e.slice();else r[t]=e}function c9(r){if(r.length===0)return!1;const t=Math.min(r.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(r[e]))return!1;return!0}function zo(){let r=null;return(t,e,n)=>{const i=r!==n;return i&&(t.uniform1i(e,n),r=n),i}}function Wi(r,t,e,n){let i=null,s=null;return(a,o,d)=>{const f=t(d,e),m=f.length;let v=!1;if(i===null)i=new Float32Array(m),s=m,v=!0;else{Or(s===m,"Uniform length cannot change.");for(let C=0;C<m;++C)if(f[C]!==i[C]){v=!0;break}}return v&&(n(a,r,o,f),i.set(f)),v}}function na(r,t,e,n){r[t](e,n)}function _h(r,t,e,n){r[t](e,!1,n)}const u9=5120,h9=5121,A9=5122,d9=5123,E5=0,p0=1,f9=2,p9=3,g0=4,g9=5,m9=6,uo=5126,y9=35664,_9=35665,v9=35666,eg=5124,b9=35667,w9=35668,x9=35669,rg=5125,B9=36294,C9=36295,E9=36296,T9=35670,S9=35671,I9=35672,P9=35673,M9=35674,F9=35675,L9=35676,R9=35685,O9=35686,U9=35687,D9=35688,N9=35689,k9=35690,Rv={[uo]:[uo,1,"float"],[y9]:[uo,2,"vec2"],[_9]:[uo,3,"vec3"],[v9]:[uo,4,"vec4"],[eg]:[eg,1,"int"],[b9]:[eg,2,"ivec2"],[w9]:[eg,3,"ivec3"],[x9]:[eg,4,"ivec4"],[rg]:[rg,1,"uint"],[B9]:[rg,2,"uvec2"],[C9]:[rg,3,"uvec3"],[E9]:[rg,4,"uvec4"],[T9]:[uo,1,"bool"],[S9]:[uo,2,"bvec2"],[I9]:[uo,3,"bvec3"],[P9]:[uo,4,"bvec4"],[M9]:[uo,8,"mat2"],[R9]:[uo,8,"mat2x3"],[O9]:[uo,8,"mat2x4"],[F9]:[uo,12,"mat3"],[U9]:[uo,12,"mat3x2"],[D9]:[uo,12,"mat3x4"],[L9]:[uo,16,"mat4"],[N9]:[uo,16,"mat4x2"],[k9]:[uo,16,"mat4x3"]};function Q9(r){switch(r){case E5:return E5;case p0:return p0;case p9:return p0;case f9:return p0;case g0:return g0;case g9:return g0;case m9:return g0;default:return Or(!1),0}}function T5(r){const t=Rv[r];if(!t)return null;const[e,n]=t;return{type:e,components:n}}function S5(r,t){switch(r){case u9:case h9:case A9:case d9:r=uo;break}for(const e in Rv){const[n,i,s]=Rv[e];if(n===r&&i===t)return{glType:e,name:s}}return null}class z9{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getActiveAttrib(t.handle,i),d=e.getAttribLocation(t.handle,s);d>=0&&this._addAttribute(d,s,a,o)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!Un(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:s,type:a,size:o}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,s,a,o)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(t,e,n,i){const{type:s,components:a}=T5(n),o={type:s,size:i*a};this._inferProperties(t,e,o);const d={location:t,name:e,accessor:new $a(o)};this.attributeInfos.push(d),this.attributeInfosByLocation[t]=d,this.attributeInfosByName[d.name]=d}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:s,components:a}=T5(n),o=new $a({type:s,size:i*a}),d={location:t,name:e,accessor:o};this.varyingInfos.push(d),this.varyingInfosByName[d.name]=d}}const I5=4,H9=35981,V9=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class P5 extends yh{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",V9),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:n,fs:i,varyings:s,bufferMode:a=H9}=t;return this.hash=e||"",this.vs=typeof n=="string"?new Mv(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs=typeof i=="string"?new Fv(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,Or(this.vs instanceof Mv),Or(this.fs instanceof Fv),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Sa(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new z9(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:i,offset:s=0,start:a,end:o,isIndexed:d=!1,indexType:f=5123,instanceCount:m=0,isInstanced:v=m>0,vertexArray:C=null,transformFeedback:b,framebuffer:P,parameters:F={},uniforms:U,samplers:k}=t;if((U||k)&&(qr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(U||{})),qr.priority>=e){const z=P?P.id:"default",K="mode=".concat(cA(this.gl,n)," verts=").concat(i," ")+"instances=".concat(m," indexType=").concat(cA(this.gl,f)," ")+"isInstanced=".concat(v," isIndexed=").concat(d," ")+"Framebuffer=".concat(z);qr.log(e,K)()}return Or(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||v&&m===0?!1:(C.bindForDraw(i,m,()=>{if(P!==void 0&&(F=Object.assign({},F,{framebuffer:P})),b){const z=Q9(n);b.begin(z)}this._bindTextures(),xc(this.gl,F,()=>{d&&v?this.gl2.drawElementsInstanced(n,i,f,s,m):d&&Un(this.gl)&&!isNaN(a)&&!isNaN(o)?this.gl2.drawRangeElements(n,a,o,i,f,s):d?this.gl.drawElements(n,i,f,s):v?this.gl2.drawArraysInstanced(n,s,i,m):this.gl.drawArrays(n,s,i)}),b&&b.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};qr.priority>=2&&o9(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let s=n,a=!1;if(s instanceof co&&(s=s.texture),s instanceof cf)if(a=this.uniforms[e]!==n,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const o=s,{textureIndex:d}=i;o.bind(d),s=d,this._textureUniforms[e]=o}else s=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(s)||a)&&l9(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const i of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new Mv({handle:i});break;case 35632:n.fs=new Fv({handle:i});break}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=mh(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),qr.time(I5,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),qr.timeEnd(I5,"linkProgram for ".concat(this._getName()))(),t.debug||qr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=s9(n.name);let s=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=C5(t,s,n),n.size>1)for(let a=0;a<n.size;a++)s=t.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=C5(t,s,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const G9=34918,j9=34919,q9=35007,K9=36795,W9=35976,$9=35887,X9=36202;class m0 extends yh{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const n=Un(t),i=y5(t,Qi.TIMER_QUERY);let s=n||i;for(const a of e)switch(a){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:Or(!1)}return s}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(q9)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?X9:$9)}beginTransformFeedbackQuery(){return this.begin(W9)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,j9);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(K9)}getResult(){return this.gl2.getQueryParameter(this.handle,G9)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,i)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return m0.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class M5 extends yh{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return Un(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Sa(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,af(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:s,byteOffset:a}=this._getBufferParams(e);return n<0?(this.unused[t]=i,qr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,a,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof Si?i=t:(i=t.buffer,n=t.byteSize,e=t.byteOffset),(e!==void 0||n!==void 0)&&(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=e&&e.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let y0=null;function Z9(r){return(!y0||y0.byteLength<r)&&(y0=new ArrayBuffer(r)),y0}function Y9(r,t){const e=Z9(r.BYTES_PER_ELEMENT*t);return new r(e,0,t)}function J9(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let d=n;o<s;o++)t[d++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}const tG="elements must be GL.ELEMENT_ARRAY_BUFFER";class yl extends yh{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Un(t)||fS()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new yl(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return yl.MAX_ATTRIBUTES=yl.MAX_ATTRIBUTES||t.getParameter(34921),yl.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:yl._setConstantFloatArray(t,e,n);break;case Int32Array:yl._setConstantIntArray(t,e,n);break;case Uint32Array:yl._setConstantUintArray(t,e,n);break;default:Or(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return yl.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Or(!t||t.target===34963,tG),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,n){if(e.target===34963)return this.setElementBuffer(e,n);const{size:i,type:s,stride:a,offset:o,normalized:d,integer:f,divisor:m}=n,{gl:v,gl2:C}=this;return t=Number(t),this.bind(()=>{v.bindBuffer(34962,e.handle),f?(Or(Un(v)),C.vertexAttribIPointer(t,i,s,a,o)):v.vertexAttribPointer(t,i,s,d,a,o),v.enableVertexAttribArray(t),C.vertexAttribDivisor(t,m||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!yl.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,s=n.length*t;let a=!this.buffer;if(this.buffer=this.buffer||new Si(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(n,this.bufferValue),a){const o=Y9(e.constructor,s);J9({target:o,source:n,start:0,count:s}),this.buffer.subData(o),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:Or(!1)}}static _setConstantIntArray(t,e,n){switch(Or(Un(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:Or(!1)}}static _setConstantUintArray(t,e,n){switch(Or(Un(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:Or(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return Or(Number.isFinite(n)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(n,t);default:return this.gl.getVertexAttrib(n,t)}})}}const eG="VertexArray: attributes must be Buffers or constants (i.e. typed array)",rG=/^(.+)__LOCATION_([0-9]+)$/,nG=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class iG{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new yl(t),n5(this,"VertexArray","v6.0",nG),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,n);const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,s)),this}setConstant(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Si(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Si&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof Si&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),i=n()}),i}_resolveLocationAndAccessor(t,e,n,i){const s={location:-1,accessor:null},{location:a,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,qr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const d=this._getAttributeInfo(o||a);if(!d)return s;const f=this.accessors[a]||{},m=$a.resolve(d.accessor,f,n,i),{size:v,type:C}=m;return Or(Number.isFinite(v)&&Number.isFinite(C)),{location:a,accessor:m}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=rG.exec(t),i=n?n[1]:t,s=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof Si)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Si){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else if(e.buffer instanceof Si){const n=e;this.setBuffer(t,n.buffer,n)}else throw new Error(eG)}_setConstantAttributes(t,e){const n=Math.max(t|0,e|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(t,e){if(yl.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){yl.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:s}=i,a=s>0;if(t.isInstanced=t.isInstanced||a,n instanceof Si){const o=n;if(a){const d=o.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,d)}else{const d=o.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,d)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return qr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function sG(r,t){const{maxElts:e=16,size:n=1}=t;let i="[";for(let a=0;a<r.length&&a<e;++a)a>0&&(i+=",".concat(a%n===0?" ":"")),i+=ng(r[a],t);const s=r.length>e?"...":"]";return"".concat(i).concat(s)}function ng(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:n=!1}=t;if(Array.isArray(r)||ArrayBuffer.isView(r))return sG(r,t);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<e)return n?"0":"0.";if(n||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const i=r.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function F5(r){let{header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}=r;Or(e);const s=".*_.*",a=".*Matrix",o=e._uniformSetters,d={},f=Object.keys(o).sort();let m=0;for(const b of f)!b.match(s)&&!b.match(a)&&Ov({table:d,header:t,uniforms:n,uniformName:b,undefinedOnly:i})&&m++;for(const b of f)b.match(a)&&Ov({table:d,header:t,uniforms:n,uniformName:b,undefinedOnly:i})&&m++;for(const b of f)d[b]||Ov({table:d,header:t,uniforms:n,uniformName:b,undefinedOnly:i})&&m++;let v=0;const C={};if(!i)for(const b in n){const P=n[b];d[b]||(v++,C[b]={Type:"NOT USED: ".concat(P),[t]:ng(P)})}return{table:d,count:m,unusedTable:C,unusedCount:v}}function Ov(r){let{table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:s}=r;const a=n[i],o=oG(a);return!s||!o?(t[i]={[e]:o?ng(a):"N/A","Uniform Type":o?a:"NOT PROVIDED"},!0):!1}function oG(r){return r!=null}function aG(r){let{vertexArray:t,header:e="Attributes"}=r;if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=L5(t,t.elements,null,e));const i=t.values;for(const s in i){const a=t._getAttributeInfo(s);if(a){let o="".concat(s,": ").concat(a.name);const d=t.accessors[a.location];d&&(o="".concat(s,": ").concat(lG(a.name,d))),n[o]=L5(t,i[s],d,e)}}return n}function L5(r,t,e,n){const{gl:i}=r;if(!t)return{[n]:"null","Format ":"N/A"};let s="NOT PROVIDED",a=1,o=0,d=0,f,m,v;if(e&&(s=e.type,a=e.size,s=String(s).replace("Array",""),f=s.indexOf("nt")!==-1),t instanceof Si){const C=t,{data:b,changed:P}=C.getDebugData();m=P?"*":"",v=b,d=C.byteLength,o=d/b.BYTES_PER_ELEMENT/a;let F;if(e){const U=e.divisor>0;F="".concat(U?"I ":"P "," ").concat(o," (x").concat(a,"=").concat(d," bytes ").concat(cA(i,s),")")}else f=!0,F="".concat(d," bytes");return{[n]:"".concat(m).concat(ng(v,{size:a,isInteger:f})),"Format ":F}}return v=t,a=t.length,s=String(t.constructor.name).replace("Array",""),f=s.indexOf("nt")!==-1,{[n]:"".concat(ng(v,{size:a,isInteger:f})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function lG(r,t){const{type:e,size:n}=t,i=S5(e,n);return i?"".concat(r," (").concat(i.name,")"):r}function cG(r){const t={},e="Accessors for ".concat(r.id);for(const n of r.attributeInfos)if(n){const i=R5(n);t["in ".concat(i)]={[e]:JSON.stringify(n.accessor)}}for(const n of r.varyingInfos)if(n){const i=R5(n);t["out ".concat(i)]={[e]:JSON.stringify(n.accessor)}}return t}function R5(r){const{type:t,size:e}=r.accessor,n=S5(t,e);return n?"".concat(n.name," ").concat(r.name):r.name}const O5=ph()&&typeof document<"u";let uG=0;class hG{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=U=>e5(U),onAddHTML:n=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:a=()=>{},onError:o,gl:d=null,glOptions:f={},debug:m=!1,createFramebuffer:v=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:b=!0,stats:P=id.get("animation-loop-".concat(uG++))}=t;let{useDevicePixels:F=!0}=t;"useDevicePixelRatio"in t&&(qr.deprecated("useDevicePixelRatio","useDevicePixels")(),F=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:s,onFinalize:a,onError:o,gl:d,glOptions:f,debug:m,createFramebuffer:v},this.gl=d,this.needsRedraw=null,this.timeline=null,this.stats=P,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:b,useDevicePixels:F}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Or(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=m0.isSupported(this.gl,["timers"])?new m0(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(n=>{this._running&&(this._addCallbackData(n||{}),n!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return qr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=O5?new Promise((t,e)=>{if(O5&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):yV(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):mV(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?wv(this.props.gl,t):this.onCreateContext(t),!u0(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");iV(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&cV(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new co(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const ig="vs",Uv="fs";function _l(r,t){if(!r)throw new Error(t||"shadertools: assertion failed.")}const Dv={number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},array:{validate(r,t){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function AG(r){const t={};for(const e in r){const n=r[e],i=dG(n);t[e]=i}return t}function dG(r){let t=U5(r);return t==="object"?r?"type"in r?Object.assign({},r,Dv[r.type]):"value"in r?(t=U5(r.value),Object.assign({type:t},r,Dv[t])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:t,value:r},Dv[t])}function U5(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const fG="vs",pG="fs";class D5{constructor(t){let{name:e,vs:n,fs:i,dependencies:s=[],uniforms:a,getUniforms:o,deprecations:d=[],defines:f={},inject:m={},vertexShader:v,fragmentShader:C}=t;_l(typeof e=="string"),this.name=e,this.vs=n||v,this.fs=i||C,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(d),this.defines=f,this.injections=gG(m),a&&(this.uniforms=AG(a))}getModuleSource(t){let e;switch(t){case fG:e=this.vs||"";break;case pG:e=this.fs||"";break;default:_l(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},n=this.uniforms;for(const i in n){const s=n[i];i in t&&!s.private?(s.validate&&_l(s.validate(t[i],s),"".concat(this.name,": invalid ").concat(i)),e[i]=t[i]):e[i]=s.value}return e}}function gG(r){const t={vs:{},fs:{}};for(const e in r){let n=r[e];const i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),t[i][e]=n}return t}function mG(r){return yG(k5(r))}function yG(r){const t={},e={};return N5({modules:r,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((n,i)=>e[i]-e[n]).map(n=>t[n])}function N5(r){let{modules:t,level:e,moduleMap:n,moduleDepth:i}=r;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e);for(const s of t)s.dependencies&&N5({modules:s.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function k5(r,t){return r.map(e=>(e instanceof D5||(_l(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),_l(e.name,"shader module has no name"),e=new D5(e),e.dependencies=k5(e.dependencies)),e))}function _G(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=r.userAgent||t.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}const vG=7936,bG=7937,wG=7938,xG=35724,Nv={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},od={};Object.keys(Nv).forEach(r=>{od[r]=r});function BG(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function CG(r){const t=r.getExtension("WEBGL_debug_renderer_info"),e=r.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||vG),n=r.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||bG);return{gpuVendor:EG(e,n),vendor:e,renderer:n,version:r.getParameter(wG),shadingLanguageVersion:r.getParameter(xG)}}function EG(r,t){return r.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||t.match(/AMD/i)||r.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const kv={};function Q5(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=Nv[t];if(_l(n,t),!_G(e))return!0;if(t in kv)return kv[t];const i=n[0],s=e.behavior||"enable",a="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),o=r.createShader(35633);r.shaderSource(o,a),r.compileShader(o);const d=r.getShaderParameter(o,35713);return r.deleteShader(o),kv[t]=d,d}function TG(r,t){const e=Nv[t];_l(e,t);const n=BG(r)&&e[1]||e[0],i=typeof n=="string"?!!r.getExtension(n):n;return _l(i===!1||i===!0),i}function _0(r,t){return t=Array.isArray(t)?t:[t],t.every(e=>TG(r,e))}function SG(r){switch(CG(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function IG(r,t,e){let n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return _0(r,od.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),_0(r,od.GLSL_DERIVATIVES)&&Q5(r,od.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),_0(r,od.GLSL_FRAG_DATA)&&Q5(r,od.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),_0(r,od.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}const PG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,MG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,FG={[ig]:PG,[Uv]:MG},v0="__LUMA_INJECT_DECLARATIONS__",z5=/void\s+main\s*\([^)]*\)\s*\{\n?/,H5=/}\n?[^{}]*$/,Qv=[];function V5(r,t,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=t===ig;for(const s in e){const a=e[s];a.sort((d,f)=>d.order-f.order),Qv.length=a.length;for(let d=0,f=a.length;d<f;++d)Qv[d]=a[d].injection;const o="".concat(Qv.join(`
`),`
`);switch(s){case"vs:#decl":i&&(r=r.replace(v0,o));break;case"vs:#main-start":i&&(r=r.replace(z5,d=>d+o));break;case"vs:#main-end":i&&(r=r.replace(H5,d=>o+d));break;case"fs:#decl":i||(r=r.replace(v0,o));break;case"fs:#main-start":i||(r=r.replace(z5,d=>d+o));break;case"fs:#main-end":i||(r=r.replace(H5,d=>o+d));break;default:r=r.replace(s,d=>d+o)}}return r=r.replace(v0,""),n&&(r=r.replace(/\}\s*$/,s=>s+FG[t])),r}function zv(r){const t={};return _l(Array.isArray(r)&&r.length>1),r.forEach(e=>{for(const n in e)t[n]=t[n]?"".concat(t[n],`
`).concat(e[n]):e[n]}),t}function hf(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const G5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],LG=[...G5,[hf("attribute"),"in $1"],[hf("varying"),"out $1"]],RG=[...G5,[hf("varying"),"in $1"]],j5=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],OG=[...j5,[hf("in"),"attribute $1"],[hf("out"),"varying $1"]],UG=[...j5,[hf("in"),"varying $1"]],Hv="gl_FragColor",Vv=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,DG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function NG(r,t,e){switch(t){case 300:return e?b0(r,LG):kG(r);case 100:return e?b0(r,OG):QG(r);default:throw new Error("unknown GLSL version ".concat(t))}}function b0(r,t){for(const[e,n]of t)r=r.replace(e,n);return r}function kG(r){r=b0(r,RG);const t=r.match(Vv);if(t){const e=t[1];r=r.replace(new RegExp("\\b".concat(Hv,"\\b"),"g"),e)}else{const e="fragmentColor";r=r.replace(DG,n=>"out vec4 ".concat(e,`;
`).concat(n)).replace(new RegExp("\\b".concat(Hv,"\\b"),"g"),e)}return r}function QG(r){r=b0(r,UG);const t=r.match(Vv);if(t){const e=t[1];r=r.replace(Vv,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),Hv)}return r}const zG=`

`.concat(v0,`

`),q5={[ig]:"vertex",[Uv]:"fragment"},HG=`precision highp float;

`;function VG(r,t){const{vs:e,fs:n}=t,i=mG(t.modules||[]);return{gl:r,vs:K5(r,Object.assign({},t,{source:e,type:ig,modules:i})),fs:K5(r,Object.assign({},t,{source:n,type:Uv,modules:i})),getUniforms:GG(i)}}function K5(r,t){let{id:e,source:n,type:i,modules:s,defines:a={},hookFunctions:o=[],inject:d={},transpileToGLSL100:f=!1,prologue:m=!0,log:v}=t;_l(typeof n=="string","shader source must be a string");const C=i===ig,b=n.split(`
`);let P=100,F="",U=n;b[0].indexOf("#version ")===0?(P=300,F=b[0],U=b.slice(1).join(`
`)):F="#version ".concat(P);const k={};s.forEach(it=>{Object.assign(k,it.getDefines())}),Object.assign(k,a);let z=m?"".concat(F,`
`).concat(qG({id:e,source:n,type:i}),`
`).concat(jG({type:i}),`
`).concat(SG(r),`
`).concat(IG(r),`
`).concat(KG(k),`
`).concat(C?"":HG,`
`):"".concat(F,`
`);const K=$G(o),G={},X={},Y={};for(const it in d){const nt=typeof d[it]=="string"?{injection:d[it],order:0}:d[it],wt=it.match(/^(v|f)s:(#)?([\w-]+)$/);if(wt){const Ct=wt[2],st=wt[3];Ct?st==="decl"?X[it]=[nt]:Y[it]=[nt]:G[it]=[nt]}else Y[it]=[nt]}for(const it of s){v&&it.checkDeprecations(U,v);const nt=it.getModuleSource(i,P);z+=nt;const wt=it.injections[i];for(const Ct in wt){const st=Ct.match(/^(v|f)s:#([\w-]+)$/);if(st){const vt=st[2]==="decl"?X:Y;vt[Ct]=vt[Ct]||[],vt[Ct].push(wt[Ct])}else G[Ct]=G[Ct]||[],G[Ct].push(wt[Ct])}}return z+=zG,z=V5(z,i,X),z+=WG(K[i],G),z+=U,z=V5(z,i,Y),z=NG(z,f?100:P,C),z}function GG(r){return function(e){const n={};for(const i of r){const s=i.getUniforms(e,n);Object.assign(n,s)}return n}}function jG(r){let{type:t}=r;return`
#define SHADER_TYPE_`.concat(q5[t].toUpperCase(),`
`)}function qG(r){let{id:t,source:e,type:n}=r;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(q5[n],`

`):""}function KG(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const n in r){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const i=r[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(r[n],`
`))}return t===0&&(e+=`
`),e}function WG(r,t){let e="";for(const n in r){const i=r[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),t[n]){const s=t[n];s.sort((a,o)=>a.order-o.order);for(const a of s)e+="  ".concat(a.injection,`
`)}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function $G(r){const t={vs:{},fs:{}};return r.forEach(e=>{let n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();const[i,s]=e.split(":"),a=e.replace(/\(.+/,"");t[i][a]=Object.assign(n,{signature:s})}),t}const XG="void main() {gl_FragColor = vec4(0);}",W5=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,ZG=`#version 300 es
`.concat(W5);function $5(r,t){t=Array.isArray(t)?t:[t];const e=r.replace(/^\s+/,"").split(/\s+/),[n,i,s]=e;if(!t.includes(n)||!i||!s)return null;const a=s.split(";")[0];return{qualifier:n,type:i,name:a}}function X5(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:n,output:i}=r;if(!e)return t===300?ZG:t>300?"#version ".concat(t,`
`).concat(W5):XG;const s=tj(e,n);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(n," ").concat(e,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(n," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function YG(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return _l(!1),null}}function JG(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return _l(!1),null}}function tj(r,t){switch(t){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return _l(!1),null}}const ej={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function Bc(r,t){if(!r)throw new Error("math.gl assertion ".concat(t))}const rj=1/Math.PI*180,nj=1/180*Math.PI,ho={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ij(r){let{precision:t=ho.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=lj(r),"".concat(parseFloat(r.toPrecision(t)))}function hA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function sj(r){return aj(r)}function oj(r){return vh(r)}function aj(r,t){return Gv(r,e=>e*nj,t)}function vh(r,t){return Gv(r,e=>e*rj,t)}function bh(r,t,e){return Gv(r,n=>Math.max(t,Math.min(e,n)))}function w0(r,t,e){return hA(r)?r.map((n,i)=>w0(n,t[i],e)):e*t+(1-e)*r}function Cc(r,t,e){const n=ho.EPSILON;e&&(ho.EPSILON=e);try{if(r===t)return!0;if(hA(r)&&hA(t)){if(r.length!==t.length)return!1;for(let i=0;i<r.length;++i)if(!Cc(r[i],t[i]))return!1;return!0}return r&&r.equals?r.equals(t):t&&t.equals?t.equals(r):typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=ho.EPSILON*Math.max(1,Math.abs(r),Math.abs(t)):!1}finally{ho.EPSILON=n}}function lj(r){return Math.round(r/ho.EPSILON)*ho.EPSILON}function cj(r){return r.clone?r.clone():new Array(r.length)}function Gv(r,t,e){if(hA(r)){const n=r;e=e||cj(n);for(let i=0;i<e.length&&i<n.length;++i)e[i]=t(r[i],i,e);return e}return t(r)}function uj(r){function t(){var e=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r,t}class jv extends uj(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:hA(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ho)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+ij(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Cc(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(n===void 0)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const s=t[i];this[i]=s+n*(e[i]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=i[s];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=i[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(ho.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function hj(r,t){if(r.length!==t)return!1;for(let e=0;e<r.length;++e)if(!Number.isFinite(r[e]))return!1;return!0}function hi(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function sg(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ho.debug&&!hj(r,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return r}class qv extends jv{get x(){return this[0]}set x(t){this[0]=hi(t)}get y(){return this[1]}set y(t){this[1]=hi(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-t[n];e+=i*i}return hi(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return hi(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=i[s];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=i[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Bc(t>=0&&t<this.ELEMENTS,"index is out of range"),hi(this[t])}setComponent(t,e){return Bc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var og=1e-6,Ec=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function Aj(){var r=new Ec(2);return Ec!=Float32Array&&(r[0]=0,r[1]=0),r}function Z5(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function dj(r,t){return r[0]=-t[0],r[1]=-t[1],r}function Y5(r,t,e,n){var i=t[0],s=t[1];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r}function fj(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r}function pj(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i+e[4],r[1]=e[1]*n+e[3]*i+e[5],r}function J5(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function tI(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[4]*i+e[12],r[1]=e[1]*n+e[5]*i+e[13],r}(function(){var r=Aj();return function(t,e,n,i,s,a){var o,d;for(e||(e=2),n||(n=0),i?d=Math.min(i*e+n,t.length):d=t.length,o=n;o<d;o+=e)r[0]=t[o],r[1]=t[o+1],s(r,r,a),t[o]=r[0],t[o+1]=r[1];return t}})();function eI(r,t,e){const n=t[0],i=t[1],s=e[3]*n+e[7]*i||1;return r[0]=(e[0]*n+e[4]*i)/s,r[1]=(e[1]*n+e[5]*i)/s,r}function rI(r,t,e){const n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s||1;return r[0]=(e[0]*n+e[4]*i+e[8]*s)/a,r[1]=(e[1]*n+e[5]*i+e[9]*s)/a,r[2]=(e[2]*n+e[6]*i+e[10]*s)/a,r}function gj(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r}function mj(r,t,e){const n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r[2]=t[2],r[3]=t[3],r}function nI(r,t,e){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n+e[3]*i+e[6]*s,r[1]=e[1]*n+e[4]*i+e[7]*s,r[2]=e[2]*n+e[5]*i+e[8]*s,r[3]=t[3],r}class Kv extends qv{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),hA(t)&&arguments.length===1?this.copy(t):(ho.debug&&(hi(t),hi(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return ho.debug&&(hi(t.x),hi(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return tI(this,this,t),this.check()}transformAsVector(t){return eI(this,this,t),this.check()}transformByMatrix3(t){return J5(this,this,t),this.check()}transformByMatrix2x3(t){return pj(this,this,t),this.check()}transformByMatrix2(t){return fj(this,this,t),this.check()}}function iI(){var r=new Ec(3);return Ec!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function sI(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function oI(r,t,e){var n=new Ec(3);return n[0]=r,n[1]=t,n[2]=e,n}function yj(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function _j(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function vj(r,t){var e=t[0],n=t[1],i=t[2],s=e*e+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Wv(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function x0(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],d=e[2];return r[0]=i*d-s*o,r[1]=s*a-n*d,r[2]=n*o-i*a,r}function $v(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[3]*n+e[7]*i+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*n+e[4]*i+e[8]*s+e[12])/a,r[1]=(e[1]*n+e[5]*i+e[9]*s+e[13])/a,r[2]=(e[2]*n+e[6]*i+e[10]*s+e[14])/a,r}function aI(r,t,e){var n=t[0],i=t[1],s=t[2];return r[0]=n*e[0]+i*e[3]+s*e[6],r[1]=n*e[1]+i*e[4]+s*e[7],r[2]=n*e[2]+i*e[5]+s*e[8],r}function lI(r,t,e){var n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],d=t[1],f=t[2],m=i*f-s*d,v=s*o-n*f,C=n*d-i*o,b=i*C-s*v,P=s*m-n*C,F=n*v-i*m,U=a*2;return m*=U,v*=U,C*=U,b*=2,P*=2,F*=2,r[0]=o+m+b,r[1]=d+v+P,r[2]=f+C+F,r}function bj(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function wj(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function xj(r,t,e,n){var i=[],s=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function Bj(r,t){var e=r[0],n=r[1],i=r[2],s=t[0],a=t[1],o=t[2],d=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(s*s+a*a+o*o),m=d*f,v=m&&Wv(r,t)/m;return Math.acos(Math.min(Math.max(v,-1),1))}var Cj=yj,Ej=sI;(function(){var r=iI();return function(t,e,n,i,s,a){var o,d;for(e||(e=3),n||(n=0),i?d=Math.min(i*e+n,t.length):d=t.length,o=n;o<d;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();const Xv=[0,0,0];let B0;class Ie extends qv{static get ZERO(){return B0||(B0=new Ie(0,0,0),Object.freeze(B0)),B0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&hA(t)?this.copy(t):(ho.debug&&(hi(t),hi(e),hi(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ho.debug&&(hi(t.x),hi(t.y),hi(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=hi(t)}angle(t){return Bj(this,t)}cross(t){return x0(this,this,t),this.check()}rotateX(t){let{radians:e,origin:n=Xv}=t;return bj(this,this,n,e),this.check()}rotateY(t){let{radians:e,origin:n=Xv}=t;return wj(this,this,n,e),this.check()}rotateZ(t){let{radians:e,origin:n=Xv}=t;return xj(this,this,n,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return $v(this,this,t),this.check()}transformAsVector(t){return rI(this,this,t),this.check()}transformByMatrix3(t){return aI(this,this,t),this.check()}transformByMatrix2(t){return gj(this,this,t),this.check()}transformByQuaternion(t){return lI(this,this,t),this.check()}}let C0;class Zv extends qv{static get ZERO(){return C0||(C0=new Zv(0,0,0,0),Object.freeze(C0)),C0}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),hA(t)&&arguments.length===1?this.copy(t):(ho.debug&&(hi(t),hi(e),hi(n),hi(i)),this[0]=t,this[1]=e,this[2]=n,this[3]=i)}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return ho.debug&&(hi(t.x),hi(t.y),hi(t.z),hi(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=hi(t)}get w(){return this[3]}set w(t){this[3]=hi(t)}transform(t){return $v(this,this,t),this.check()}transformByMatrix3(t){return nI(this,this,t),this.check()}transformByMatrix2(t){return mj(this,this,t),this.check()}transformByQuaternion(t){return lI(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class cI extends jv{toString(){let t="[";if(ho.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=hi(n),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const n=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[n+i];return e}setColumn(t,e){const n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}function Tj(){var r=new Ec(9);return Ec!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Sj(r,t){if(r===t){var e=t[1],n=t[2],i=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=n,r[7]=i}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function Ij(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],d=t[6],f=t[7],m=t[8],v=m*a-o*f,C=-m*s+o*d,b=f*s-a*d,P=e*v+n*C+i*b;return P?(P=1/P,r[0]=v*P,r[1]=(-m*n+i*f)*P,r[2]=(o*n-i*a)*P,r[3]=C*P,r[4]=(m*e-i*d)*P,r[5]=(-o*e+i*s)*P,r[6]=b*P,r[7]=(-f*e+n*d)*P,r[8]=(a*e-n*s)*P,r):null}function Pj(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],d=r[7],f=r[8];return t*(f*s-a*d)+e*(-f*i+a*o)+n*(d*i-s*o)}function uI(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],d=t[5],f=t[6],m=t[7],v=t[8],C=e[0],b=e[1],P=e[2],F=e[3],U=e[4],k=e[5],z=e[6],K=e[7],G=e[8];return r[0]=C*n+b*a+P*f,r[1]=C*i+b*o+P*m,r[2]=C*s+b*d+P*v,r[3]=F*n+U*a+k*f,r[4]=F*i+U*o+k*m,r[5]=F*s+U*d+k*v,r[6]=z*n+K*a+G*f,r[7]=z*i+K*o+G*m,r[8]=z*s+K*d+G*v,r}function Mj(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],d=t[5],f=t[6],m=t[7],v=t[8],C=e[0],b=e[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=d,r[6]=C*n+b*a+f,r[7]=C*i+b*o+m,r[8]=C*s+b*d+v,r}function Fj(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],d=t[5],f=t[6],m=t[7],v=t[8],C=Math.sin(e),b=Math.cos(e);return r[0]=b*n+C*a,r[1]=b*i+C*o,r[2]=b*s+C*d,r[3]=b*a-C*n,r[4]=b*o-C*i,r[5]=b*d-C*s,r[6]=f,r[7]=m,r[8]=v,r}function hI(r,t,e){var n=e[0],i=e[1];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=i*t[3],r[4]=i*t[4],r[5]=i*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function Lj(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,d=i+i,f=e*a,m=n*a,v=n*o,C=i*a,b=i*o,P=i*d,F=s*a,U=s*o,k=s*d;return r[0]=1-v-P,r[3]=m-k,r[6]=C+U,r[1]=m+k,r[4]=1-f-P,r[7]=b-F,r[2]=C-U,r[5]=b+F,r[8]=1-f-v,r}var Yv;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(Yv||(Yv={}));const Rj=Object.freeze([1,0,0,0,1,0,0,0,1]);class fs extends cI{static get IDENTITY(){return Uj()}static get ZERO(){return Oj()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Yv}constructor(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Rj)}fromObject(t){return this.check()}fromQuaternion(t){return Lj(this,t),this.check()}set(t,e,n,i,s,a,o,d,f){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=d,this[8]=f,this.check()}setRowMajor(t,e,n,i,s,a,o,d,f){return this[0]=t,this[1]=i,this[2]=o,this[3]=e,this[4]=s,this[5]=d,this[6]=n,this[7]=a,this[8]=f,this.check()}determinant(){return Pj(this)}transpose(){return Sj(this,this),this.check()}invert(){return Ij(this,this),this.check()}multiplyLeft(t){return uI(this,t,this),this.check()}multiplyRight(t){return uI(this,this,t),this.check()}rotate(t){return Fj(this,this,t),this.check()}scale(t){return Array.isArray(t)?hI(this,this,t):hI(this,this,[t,t]),this.check()}translate(t){return Mj(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=J5(e||[-0,-0],t,this);break;case 3:n=aI(e||[-0,-0,-0],t,this);break;case 4:n=nI(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return sg(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let E0,T0;function Oj(){return E0||(E0=new fs([0,0,0,0,0,0,0,0,0]),Object.freeze(E0)),E0}function Uj(){return T0||(T0=new fs,Object.freeze(T0)),T0}function Dj(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Nj(r,t){if(r===t){var e=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=n,r[9]=s,r[11]=t[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Jv(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],d=t[6],f=t[7],m=t[8],v=t[9],C=t[10],b=t[11],P=t[12],F=t[13],U=t[14],k=t[15],z=e*o-n*a,K=e*d-i*a,G=e*f-s*a,X=n*d-i*o,Y=n*f-s*o,it=i*f-s*d,nt=m*F-v*P,wt=m*U-C*P,Ct=m*k-b*P,st=v*U-C*F,ot=v*k-b*F,vt=C*k-b*U,yt=z*vt-K*ot+G*st+X*Ct-Y*wt+it*nt;return yt?(yt=1/yt,r[0]=(o*vt-d*ot+f*st)*yt,r[1]=(i*ot-n*vt-s*st)*yt,r[2]=(F*it-U*Y+k*X)*yt,r[3]=(C*Y-v*it-b*X)*yt,r[4]=(d*Ct-a*vt-f*wt)*yt,r[5]=(e*vt-i*Ct+s*wt)*yt,r[6]=(U*G-P*it-k*K)*yt,r[7]=(m*it-C*G+b*K)*yt,r[8]=(a*ot-o*Ct+f*nt)*yt,r[9]=(n*Ct-e*ot-s*nt)*yt,r[10]=(P*Y-F*G+k*z)*yt,r[11]=(v*G-m*Y-b*z)*yt,r[12]=(o*wt-a*st-d*nt)*yt,r[13]=(e*st-n*wt+i*nt)*yt,r[14]=(F*K-P*X-U*z)*yt,r[15]=(m*X-v*K+C*z)*yt,r):null}function kj(r){var t=r[0],e=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],d=r[7],f=r[8],m=r[9],v=r[10],C=r[11],b=r[12],P=r[13],F=r[14],U=r[15],k=t*a-e*s,z=t*o-n*s,K=t*d-i*s,G=e*o-n*a,X=e*d-i*a,Y=n*d-i*o,it=f*P-m*b,nt=f*F-v*b,wt=f*U-C*b,Ct=m*F-v*P,st=m*U-C*P,ot=v*U-C*F;return k*ot-z*st+K*Ct+G*wt-X*nt+Y*it}function ad(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],d=t[5],f=t[6],m=t[7],v=t[8],C=t[9],b=t[10],P=t[11],F=t[12],U=t[13],k=t[14],z=t[15],K=e[0],G=e[1],X=e[2],Y=e[3];return r[0]=K*n+G*o+X*v+Y*F,r[1]=K*i+G*d+X*C+Y*U,r[2]=K*s+G*f+X*b+Y*k,r[3]=K*a+G*m+X*P+Y*z,K=e[4],G=e[5],X=e[6],Y=e[7],r[4]=K*n+G*o+X*v+Y*F,r[5]=K*i+G*d+X*C+Y*U,r[6]=K*s+G*f+X*b+Y*k,r[7]=K*a+G*m+X*P+Y*z,K=e[8],G=e[9],X=e[10],Y=e[11],r[8]=K*n+G*o+X*v+Y*F,r[9]=K*i+G*d+X*C+Y*U,r[10]=K*s+G*f+X*b+Y*k,r[11]=K*a+G*m+X*P+Y*z,K=e[12],G=e[13],X=e[14],Y=e[15],r[12]=K*n+G*o+X*v+Y*F,r[13]=K*i+G*d+X*C+Y*U,r[14]=K*s+G*f+X*b+Y*k,r[15]=K*a+G*m+X*P+Y*z,r}function S0(r,t,e){var n=e[0],i=e[1],s=e[2],a,o,d,f,m,v,C,b,P,F,U,k;return t===r?(r[12]=t[0]*n+t[4]*i+t[8]*s+t[12],r[13]=t[1]*n+t[5]*i+t[9]*s+t[13],r[14]=t[2]*n+t[6]*i+t[10]*s+t[14],r[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],d=t[2],f=t[3],m=t[4],v=t[5],C=t[6],b=t[7],P=t[8],F=t[9],U=t[10],k=t[11],r[0]=a,r[1]=o,r[2]=d,r[3]=f,r[4]=m,r[5]=v,r[6]=C,r[7]=b,r[8]=P,r[9]=F,r[10]=U,r[11]=k,r[12]=a*n+m*i+P*s+t[12],r[13]=o*n+v*i+F*s+t[13],r[14]=d*n+C*i+U*s+t[14],r[15]=f*n+b*i+k*s+t[15]),r}function tb(r,t,e){var n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Qj(r,t,e,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),d,f,m,v,C,b,P,F,U,k,z,K,G,X,Y,it,nt,wt,Ct,st,ot,vt,yt,re;return o<og?null:(o=1/o,i*=o,s*=o,a*=o,d=Math.sin(e),f=Math.cos(e),m=1-f,v=t[0],C=t[1],b=t[2],P=t[3],F=t[4],U=t[5],k=t[6],z=t[7],K=t[8],G=t[9],X=t[10],Y=t[11],it=i*i*m+f,nt=s*i*m+a*d,wt=a*i*m-s*d,Ct=i*s*m-a*d,st=s*s*m+f,ot=a*s*m+i*d,vt=i*a*m+s*d,yt=s*a*m-i*d,re=a*a*m+f,r[0]=v*it+F*nt+K*wt,r[1]=C*it+U*nt+G*wt,r[2]=b*it+k*nt+X*wt,r[3]=P*it+z*nt+Y*wt,r[4]=v*Ct+F*st+K*ot,r[5]=C*Ct+U*st+G*ot,r[6]=b*Ct+k*st+X*ot,r[7]=P*Ct+z*st+Y*ot,r[8]=v*vt+F*yt+K*re,r[9]=C*vt+U*yt+G*re,r[10]=b*vt+k*yt+X*re,r[11]=P*vt+z*yt+Y*re,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function AI(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[4],a=t[5],o=t[6],d=t[7],f=t[8],m=t[9],v=t[10],C=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*i+f*n,r[5]=a*i+m*n,r[6]=o*i+v*n,r[7]=d*i+C*n,r[8]=f*i-s*n,r[9]=m*i-a*n,r[10]=v*i-o*n,r[11]=C*i-d*n,r}function zj(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],d=t[3],f=t[8],m=t[9],v=t[10],C=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i-f*n,r[1]=a*i-m*n,r[2]=o*i-v*n,r[3]=d*i-C*n,r[8]=s*n+f*i,r[9]=a*n+m*i,r[10]=o*n+v*i,r[11]=d*n+C*i,r}function dI(r,t,e){var n=Math.sin(e),i=Math.cos(e),s=t[0],a=t[1],o=t[2],d=t[3],f=t[4],m=t[5],v=t[6],C=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*i+f*n,r[1]=a*i+m*n,r[2]=o*i+v*n,r[3]=d*i+C*n,r[4]=f*i-s*n,r[5]=m*i-a*n,r[6]=v*i-o*n,r[7]=C*i-d*n,r}function Hj(r,t){var e=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],d=t[8],f=t[9],m=t[10];return r[0]=Math.hypot(e,n,i),r[1]=Math.hypot(s,a,o),r[2]=Math.hypot(d,f,m),r}function Vj(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e+e,o=n+n,d=i+i,f=e*a,m=n*a,v=n*o,C=i*a,b=i*o,P=i*d,F=s*a,U=s*o,k=s*d;return r[0]=1-v-P,r[1]=m+k,r[2]=C-U,r[3]=0,r[4]=m-k,r[5]=1-f-P,r[6]=b+F,r[7]=0,r[8]=C+U,r[9]=b-F,r[10]=1-f-v,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Gj(r,t,e,n,i,s,a){var o=1/(e-t),d=1/(i-n),f=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*d,r[6]=0,r[7]=0,r[8]=(e+t)*o,r[9]=(i+n)*d,r[10]=(a+s)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*f,r[15]=0,r}function jj(r,t,e,n,i){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(a=1/(n-i),r[10]=(i+n)*a,r[14]=2*i*n*a):(r[10]=-1,r[14]=-2*n),r}var qj=jj;function Kj(r,t,e,n,i,s,a){var o=1/(t-e),d=1/(n-i),f=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(t+e)*o,r[13]=(i+n)*d,r[14]=(a+s)*f,r[15]=1,r}var Wj=Kj;function $j(r,t,e,n){var i,s,a,o,d,f,m,v,C,b,P=t[0],F=t[1],U=t[2],k=n[0],z=n[1],K=n[2],G=e[0],X=e[1],Y=e[2];return Math.abs(P-G)<og&&Math.abs(F-X)<og&&Math.abs(U-Y)<og?Dj(r):(m=P-G,v=F-X,C=U-Y,b=1/Math.hypot(m,v,C),m*=b,v*=b,C*=b,i=z*C-K*v,s=K*m-k*C,a=k*v-z*m,b=Math.hypot(i,s,a),b?(b=1/b,i*=b,s*=b,a*=b):(i=0,s=0,a=0),o=v*a-C*s,d=C*i-m*a,f=m*s-v*i,b=Math.hypot(o,d,f),b?(b=1/b,o*=b,d*=b,f*=b):(o=0,d=0,f=0),r[0]=i,r[1]=o,r[2]=m,r[3]=0,r[4]=s,r[5]=d,r[6]=v,r[7]=0,r[8]=a,r[9]=f,r[10]=C,r[11]=0,r[12]=-(i*P+s*F+a*U),r[13]=-(o*P+d*F+f*U),r[14]=-(m*P+v*F+C*U),r[15]=1,r)}function Xj(){var r=new Ec(4);return Ec!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Zj(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function fI(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function Yj(r){var t=r[0],e=r[1],n=r[2],i=r[3];return Math.hypot(t,e,n,i)}function Jj(r){var t=r[0],e=r[1],n=r[2],i=r[3];return t*t+e*e+n*n+i*i}function tq(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function eq(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function rq(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3];return r[0]=i+n*(e[0]-i),r[1]=s+n*(e[1]-s),r[2]=a+n*(e[2]-a),r[3]=o+n*(e[3]-o),r}function ag(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3];return r[0]=e[0]*n+e[4]*i+e[8]*s+e[12]*a,r[1]=e[1]*n+e[5]*i+e[9]*s+e[13]*a,r[2]=e[2]*n+e[6]*i+e[10]*s+e[14]*a,r[3]=e[3]*n+e[7]*i+e[11]*s+e[15]*a,r}function nq(r,t,e){var n=t[0],i=t[1],s=t[2],a=e[0],o=e[1],d=e[2],f=e[3],m=f*n+o*s-d*i,v=f*i+d*n-a*s,C=f*s+a*i-o*n,b=-a*n-o*i-d*s;return r[0]=m*f+b*-a+v*-d-C*-o,r[1]=v*f+b*-o+C*-a-m*-d,r[2]=C*f+b*-d+m*-o-v*-a,r[3]=t[3],r}(function(){var r=Xj();return function(t,e,n,i,s,a){var o,d;for(e||(e=4),n||(n=0),i?d=Math.min(i*e+n,t.length):d=t.length,o=n;o<d;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();var eb;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(eb||(eb={}));const iq=45*Math.PI/180,sq=1,rb=.1,nb=500,oq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Vn extends cI{static get IDENTITY(){return lq()}static get ZERO(){return aq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return eb}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,i,s,a,o,d,f,m,v,C,b,P,F,U){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=d,this[8]=f,this[9]=m,this[10]=v,this[11]=C,this[12]=b,this[13]=P,this[14]=F,this[15]=U,this.check()}setRowMajor(t,e,n,i,s,a,o,d,f,m,v,C,b,P,F,U){return this[0]=t,this[1]=s,this[2]=f,this[3]=b,this[4]=e,this[5]=a,this[6]=m,this[7]=P,this[8]=n,this[9]=o,this[10]=v,this[11]=F,this[12]=i,this[13]=d,this[14]=C,this[15]=U,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(oq)}fromObject(t){return this.check()}fromQuaternion(t){return Vj(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:i,top:s,near:a=rb,far:o=nb}=t;return o===1/0?cq(this,e,n,i,s,a):Gj(this,e,n,i,s,a,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:i=[0,1,0]}=t;return $j(this,e,n,i),this.check()}ortho(t){const{left:e,right:n,bottom:i,top:s,near:a=rb,far:o=nb}=t;return Wj(this,e,n,i,s,a,o),this.check()}orthographic(t){const{fovy:e=iq,aspect:n=sq,focalDistance:i=1,near:s=rb,far:a=nb}=t;pI(e);const o=e/2,d=i*Math.tan(o),f=d*n;return this.ortho({left:-f,right:f,bottom:-d,top:d,near:s,far:a})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=t;return pI(e),qj(this,e,n,i,s),this.check()}determinant(){return kj(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*s,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*s,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),i=1/n[0],s=1/n[1],a=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=this[4]*i,t[4]=this[5]*s,t[5]=this[6]*a,t[6]=this[8]*i,t[7]=this[9]*s,t[8]=this[10]*a,t}transpose(){return Nj(this,this),this.check()}invert(){return Jv(this,this),this.check()}multiplyLeft(t){return ad(this,t,this),this.check()}multiplyRight(t){return ad(this,this,t),this.check()}rotateX(t){return AI(this,this,t),this.check()}rotateY(t){return zj(this,this,t),this.check()}rotateZ(t){return dI(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return Qj(this,this,t,e),this.check()}scale(t){return tb(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return S0(this,this,t),this.check()}transform(t,e){return t.length===4?(e=ag(e||[-0,-0,-0,-0],t,this),sg(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let i;switch(n){case 2:i=tI(e||[-0,-0],t,this);break;case 3:i=$v(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return sg(i,t.length),i}transformAsVector(t,e){let n;switch(t.length){case 2:n=eI(e||[-0,-0],t,this);break;case 3:n=rI(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return sg(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let I0,P0;function aq(){return I0||(I0=new Vn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(I0)),I0}function lq(){return P0||(P0=new Vn,Object.freeze(P0)),P0}function pI(r){if(r>Math.PI*2)throw Error("expected radians")}function cq(r,t,e,n,i,s){const a=2*s/(e-t),o=2*s/(i-n),d=(e+t)/(e-t),f=(i+n)/(i-n),m=-1,v=-1,C=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=d,r[9]=f,r[10]=m,r[11]=v,r[12]=0,r[13]=0,r[14]=C,r[15]=0,r}function gI(){var r=new Ec(4);return Ec!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function uq(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function mI(r,t,e){e=e*.5;var n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function yI(r,t,e){var n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],d=e[1],f=e[2],m=e[3];return r[0]=n*m+a*o+i*f-s*d,r[1]=i*m+a*d+s*o-n*f,r[2]=s*m+a*f+n*d-i*o,r[3]=a*m-n*o-i*d-s*f,r}function hq(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),d=Math.cos(e);return r[0]=n*d+a*o,r[1]=i*d+s*o,r[2]=s*d-i*o,r[3]=a*d-n*o,r}function Aq(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),d=Math.cos(e);return r[0]=n*d-s*o,r[1]=i*d+a*o,r[2]=s*d+n*o,r[3]=a*d-i*o,r}function dq(r,t,e){e*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(e),d=Math.cos(e);return r[0]=n*d+i*o,r[1]=i*d-n*o,r[2]=s*d+a*o,r[3]=a*d-s*o,r}function fq(r,t){var e=t[0],n=t[1],i=t[2];return r[0]=e,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),r}function M0(r,t,e,n){var i=t[0],s=t[1],a=t[2],o=t[3],d=e[0],f=e[1],m=e[2],v=e[3],C,b,P,F,U;return b=i*d+s*f+a*m+o*v,b<0&&(b=-b,d=-d,f=-f,m=-m,v=-v),1-b>og?(C=Math.acos(b),P=Math.sin(C),F=Math.sin((1-n)*C)/P,U=Math.sin(n*C)/P):(F=1-n,U=n),r[0]=F*i+U*d,r[1]=F*s+U*f,r[2]=F*a+U*m,r[3]=F*o+U*v,r}function pq(r,t){var e=t[0],n=t[1],i=t[2],s=t[3],a=e*e+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-e*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function gq(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function _I(r,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(t[s*3+a]-t[a*3+s])*n,r[s]=(t[s*3+i]+t[i*3+s])*n,r[a]=(t[a*3+i]+t[i*3+a])*n}return r}var mq=Zj,yq=fI,_q=eq,vq=rq,bq=Yj,wq=Jj,vI=tq,xq=function(){var r=iI(),t=oI(1,0,0),e=oI(0,1,0);return function(n,i,s){var a=Wv(i,s);return a<-.999999?(x0(r,t,i),Ej(r)<1e-6&&x0(r,e,i),vj(r,r),mI(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(x0(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,vI(n,n))}}();(function(){var r=gI(),t=gI();return function(e,n,i,s,a,o){return M0(r,n,a,o),M0(t,i,s,o),M0(e,r,t,2*o*(1-o)),e}})(),function(){var r=Tj();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],vI(t,_I(t,r))}}();const Bq=[0,0,0,1];class lg extends jv{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,n,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return _I(this,t),this.check()}fromAxisRotation(t,e){return mI(this,t,e),this.check()}identity(){return uq(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=hi(t)}get y(){return this[1]}set y(t){this[1]=hi(t)}get z(){return this[2]}set z(t){this[2]=hi(t)}get w(){return this[3]}set w(t){this[3]=hi(t)}len(){return bq(this)}lengthSquared(){return wq(this)}dot(t){return _q(this,t)}rotationTo(t,e){return xq(this,t,e),this.check()}add(t){return mq(this,this,t),this.check()}calculateW(){return fq(this,this),this.check()}conjugate(){return gq(this,this),this.check()}invert(){return pq(this,this),this.check()}lerp(t,e,n){return n===void 0?this.lerp(this,t,e):(vq(this,t,e,n),this.check())}multiplyRight(t){return yI(this,this,t),this.check()}multiplyLeft(t){return yI(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return hq(this,this,t),this.check()}rotateY(t){return Aq(this,this,t),this.check()}rotateZ(t){return dq(this,this,t),this.check()}scale(t){return yq(this,this,t),this.check()}slerp(t,e,n){let i,s,a;switch(arguments.length){case 1:({start:i=Bq,target:s,ratio:a}=t);break;case 2:i=this,s=t,a=e;break;default:i=t,s=e,a=n}return M0(this,i,s,a),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Zv;return nq(e,t,this),sg(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const cg={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},bI=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,Cq={lightSources:{}};function ib(){let{color:r=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.map(e=>e*t/255)}function Eq(r){let{ambientLight:t,pointLights:e=[],directionalLights:n=[]}=r;const i={};return t?i["lighting_uAmbientLight.color"]=ib(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,a)=>{i["lighting_uPointLight[".concat(a,"].color")]=ib(s),i["lighting_uPointLight[".concat(a,"].position")]=s.position,i["lighting_uPointLight[".concat(a,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((s,a)=>{i["lighting_uDirectionalLight[".concat(a,"].color")]=ib(s),i["lighting_uDirectionalLight[".concat(a,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=n.length,i}function wI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cq;if("lightSources"in r){const{ambientLight:t,pointLights:e,directionalLights:n}=r.lightSources||{};return t||e&&e.length>0||n&&n.length>0?Object.assign({},Eq({ambientLight:t,pointLights:e,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const t={pointLights:[],directionalLights:[]};for(const e of r.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return wI({lightSources:t})}return{}}const sb={name:"lights",vs:bI,fs:bI,getUniforms:wI,defines:{MAX_LIGHTS:3}},Tq={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function Sq(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Tq;const t={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=r.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(r.pickingHighlightColor){const e=Array.from(r.pickingHighlightColor,n=>n/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return r.pickingActive!==void 0&&(t.picking_uActive=!!r.pickingActive,t.picking_uAttribute=!!r.pickingAttribute),t}const Iq={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:Sq},xI=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Pq={};function Mq(r){const{ambient:t=.35,diffuse:e=.6,shininess:n=32,specularColor:i=[30,30,30]}=r;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:n,lighting_uSpecularColor:i.map(s=>s/255)}}function BI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pq;if(!("material"in r))return{};const{material:t}=r;return t?Mq(t):{lighting_uEnabled:!1}}const Fq={name:"gouraud-lighting",dependencies:[sb],vs:xI,defines:{LIGHTING_VERTEX:1},getUniforms:BI},Lq={name:"phong-lighting",dependencies:[sb],fs:xI,defines:{LIGHTING_FRAGMENT:1},getUniforms:BI},ob={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[sb]},Rq={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class ug{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new ug(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:s={},varyings:a=[],bufferMode:o=35981,transpileToGLSL100:d=!1}=t,f=this._getModuleList(t.modules),m=this._getHash(e),v=this._getHash(n),C=f.map(K=>this._getHash(K.name)).sort(),b=a.map(K=>this._getHash(K)),P=Object.keys(i).sort(),F=Object.keys(s).sort(),U=[],k=[];for(const K of P)U.push(this._getHash(K)),U.push(this._getHash(i[K]));for(const K of F)k.push(this._getHash(K)),k.push(this._getHash(s[K]));const z="".concat(m,"/").concat(v,"D").concat(U.join("/"),"M").concat(C.join("/"),"I").concat(k.join("/"),"V").concat(b.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(d?"T":"");if(!this._programCache[z]){const K=VG(this.gl,{vs:e,fs:n,modules:f,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:d});this._programCache[z]=new P5(this.gl,{hash:z,vs:K.vs,fs:K.fs,varyings:a,bufferMode:o}),this._getUniforms[z]=K.getUniforms||(G=>{}),this._useCounts[z]=0}return this._useCounts[z]++,this._programCache[z]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],d=o.name;e[i++]=o,n[d]=!0}for(let s=0,a=t.length;s<a;++s){const o=t[s],d=o.name;n[d]||(e[i++]=o,n[d]=!0)}return e.length=i,e}}const Oq={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Uq(r,t,e){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=Dq(s);if(s==="indices")i=a;else if(a.constant)n[o]=a.value;else{const d=a.value,f={...a};delete f.value,n[o]=[new Si(r,d),f],Nq(s,f)}}if(i){const s=i.value||i;Or(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new Si(r,{data:s,target:34963}),a]}return n}function Dq(r,t){const{attributeMap:e=Oq}={};return e&&e[r]||r}function Nq(r,t){let e;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}Or(Number.isFinite(t.size),"attribute ".concat(r," needs size"))}const Af=2,kq=1e4,Qq="Model needs drawMode and vertexCount",CI=()=>{},zq={};class df{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:n=mh("model")}=e;Or(u0(t)),this.id=n,this.gl=t,this.id=e.id||mh("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||ug.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:d,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:d,bufferMode:f,transpileToGLSL100:m},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Or(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Qq)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:d,bufferMode:f,transpileToGLSL100:m}=t;this.programProps={program:e,vs:n,fs:i,modules:s,defines:a,inject:o,varyings:d,bufferMode:f,transpileToGLSL100:m},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Or(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Or(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Uq(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(af(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return Iv(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:o={},vertexArray:d=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(e),this.setUniforms(i);let f;qr.priority>=Af&&(f=this._logDrawCallStart(Af));const m=this.vertexArray.getDrawParams(),{isIndexed:v=m.isIndexed,indexType:C=m.indexType,indexOffset:b=m.indexOffset,vertexArrayInstanced:P=m.isInstanced}=this.props;P&&!this.isInstanced&&qr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:F,instanceCount:U}=this,{onBeforeRender:k=CI,onAfterRender:z=CI}=this.props;k(),this.program.setUniforms(this.uniforms);const K=this.program.draw(Object.assign(zq,t,{logPriority:f,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:d,transformFeedback:a,isIndexed:v,indexType:C,isInstanced:F,instanceCount:U,offset:v?b:0}));return z(),qr.priority>=Af&&this._logDrawCallEnd(f,d,n),K}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:s}=t;n&&this._setFeedbackBuffers(n),e&&(s=Object.assign({},s,{35977:e})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return qr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:n,fs:i,modules:s,inject:a,defines:o,varyings:d,bufferMode:f,transpileToGLSL100:m}=this.programProps;e=this.programManager.get({vs:n,fs:i,modules:s,inject:a,defines:o,varyings:d,bufferMode:f,transpileToGLSL100:m}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Or(e instanceof P5,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new iG(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Si&&e.delete()}}_setAnimationProps(t){this.animated&&Or(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(af(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new M5(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:kq;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),qr.group(Af,">>> DRAWING MODEL ".concat(this.id),{collapsed:qr.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(t===void 0)return;const s=aG({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:d}=F5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:f,count:m}=F5({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});m>0&&qr.log("MISSING UNIFORMS",Object.keys(f))(),d>0&&qr.log("UNUSED UNIFORMS",Object.keys(o))();const v=cG(this.vertexArray.configuration);qr.table(t,s)(),qr.table(t,a)(),qr.table(t+1,v)(),i&&i.log({logLevel:Af,message:"Rendered to ".concat(i.id)}),qr.groupEnd(Af)()}}class Hq{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof Si?n:n.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Or(Un(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in e&&(n[s]=i)}Object.assign(n,t.feedbackBuffers);for(const i in n){const s=n[i];if(typeof s=="string"){const a=e[s],{byteLength:o,usage:d,accessor:f}=a;n[i]=this._createNewBuffer(i,{byteLength:o,usage:d,accessor:f})}}return n}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:i}=n;t.transformFeedback=new M5(this.gl,{program:i,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:n}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:e,feedbackBuffers:n})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];e[i]=t.feedbackBuffers[s],n[s]=t.sourceBuffers[i],Or(n[s]instanceof Si)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new Si(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}const Vq="transform_uSampler_",F0="transform_uSize_",EI="transform_position";function Gq(r){let{vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=r,a=Object.keys(e).length,o=null;const d={};let f=t,m={};if(a>0||n){const v=f.split(`
`),C=v.slice();if(v.forEach((b,P,F)=>{if(a>0){const U=$q(b,e);if(U){const{updatedLine:k,inject:z}=U;C[P]=k,m=zv([m,z]),Object.assign(d,U.samplerTextureMap),a--}}n&&!o&&(o=Wq(b,n))}),n){Or(i);const b="".concat(F0).concat(n),P="uniform vec2 ".concat(b,`;
`),F="     vec2 ".concat(EI," = transform_getPos(").concat(b,`);
     gl_Position = vec4(`).concat(EI,`, 0, 1.);
`);m=zv([m,{"vs:#decl":P,"vs:#main-start":F}])}f=C.join(`
`)}return{vs:f,targetTextureType:o,inject:m,samplerTextureMap:d}}function jq(r){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}=r;const i={};let s,a;e&&({width:s,height:a}=n,i["".concat(F0).concat(e)]=[s,a]);for(const o in t)({width:s,height:a}=t[o]),i["".concat(F0).concat(o)]=[s,a];return i}function qq(r){return $5(r,["attribute","in"])}function Kq(r){const t="".concat(Vq).concat(r),e="".concat(F0).concat(r),n="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:n}}function Wq(r,t){const e=$5(r,["varying","out"]);return e&&e.name===t?e.type:null}function $q(r,t){const e={},n=qq(r);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const a="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:d,uniformDeclerations:f}=Kq(s),m=YG(i),v="  ".concat(i," ").concat(s," = transform_getInput(").concat(o,", ").concat(d,").").concat(m,`;
`);return e[o]=s,{updatedLine:a,inject:{"vs:#decl":f,"vs:#main-start":v},samplerTextureMap:e}}return null}const Xq={10241:9728,10240:9728,10242:33071,10243:33071},Zq="transform_output";class Yq{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},e,t.attributes),o=Object.assign({},t.uniforms),d=Object.assign({},t.parameters);let f=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const v in this.samplerTextureMap){const C=this.samplerTextureMap[v];o[v]=n[C]}this._setSourceTextureParameters();const m=jq({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(o,m)}return this.hasTargetTexture&&(f=!1,d.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:o,discard:f,parameters:d}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=A0(e);if(!t)return n;const i=n.constructor,s=JG(this.targetTextureType),a=new i(n.length*s/4);let o=0;for(let d=0;d<n.length;d+=4)for(let f=0;f<s;f++)a[o++]=n[d+f];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof gl)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,s=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((n,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Si(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:n}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:e,targetTexture:n})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:s}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),s){t.targetTexture=s;const{width:a,height:o}=s,{framebuffer:d}=t;d?(d.update({attachments:{36064:s},resizeAttachments:!1}),d.resize({width:a,height:o})):t.framebuffer=new co(this.gl,{id:"transform-framebuffer",width:a,height:o,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const n in e)e[n].setParameters(Xq)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const n=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:n}}_createNewTexture(t){const e=KV(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:a,inject:o,samplerTextureMap:d}=Gq({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),f=zv([t.inject||{},o]);this.targetTextureType=a,this.samplerTextureMap=d;const m=t._fs||X5({version:x5(i),input:this.targetTextureVarying,inputType:a,output:Zq}),v=this.hasSourceTextures||this.targetTextureVarying?[Rq].concat(t.modules||[]):t.modules;return{vs:i,fs:m,modules:v,uniforms:s,inject:f}}}class ab{static isSupported(t){return Un(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();Or(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const i=n.getData(t);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new df(e,Object.assign({},t,{fs:t.fs||X5({version:x5(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=i.updateModelProps(e);return e}_buildResourceTransforms(t,e){Jq(e)&&(this.bufferTransform=new Hq(t,e)),tK(e)&&(this.textureTransform=new Yq(t,e)),Or(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=Object.assign(e,i.getDrawOptions(e));return e}}function Jq(r){return!!(!af(r.feedbackBuffers)||!af(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function tK(r){return!!(!af(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const TI={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class hg{static get DRAW_MODE(){return TI}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=mh("geometry"),drawMode:n=TI.TRIANGLES,attributes:i={},indices:s=null,vertexCount:a=null}=t;this.id=e,this.drawMode=n|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const n in t){let i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,Or(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),(n==="POSITION"||n==="positions")&&!i.size&&(i.size=3),n==="indices"?(Or(!this.indices),this.indices=i):this.attributes[n]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const i in t){const s=t[i],{value:a,size:o,constant:d}=s;!d&&a&&o>=1&&(n=Math.min(n,a.length/o))}return Or(Number.isFinite(n)),n}}let eK=1,rK=1;class SI{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=t,a=eK++,o={time:0,delay:e,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const i of e)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=rK++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}const nK=[255,255,255],iK=1;let sK=0;class II{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","ambient");const{color:e=nK}=t,{intensity:n=iK}=t;this.id=t.id||"ambient-".concat(sK++),this.color=e,this.intensity=n}}const oK=[255,255,255],aK=1,lK=[0,0,-1];let cK=0;class PI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","directional"),$(this,"direction",void 0),$(this,"shadow",void 0);const{color:e=oK}=t,{intensity:n=aK}=t,{direction:i=lK}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(cK++),this.color=e,this.intensity=n,this.type="directional",this.direction=new Ie(i).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class uK{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};$(this,"id",void 0),$(this,"gl",void 0),$(this,"props",void 0);const{id:n}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class lb extends uK{constructor(){super(...arguments),$(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return gh(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:n,viewports:i,views:s,onViewportActive:a,clearStack:o=!0,clearCanvas:d=!0}=t;t.pass=t.pass||"unknown";const f=this.gl;d&&AK(f,e),o&&(this._lastRenderIndex=-1);const m=[];for(const v of i){const C=s&&s[v.id];a==null||a(v);const b=this._getDrawLayerParams(v,t),P=v.subViewports||[v];for(const F of P){const U=this._drawLayersInViewport(f,{target:e,moduleParameters:n,viewport:F,view:C,pass:t.pass,layers:t.layers},b);m.push(U)}}return m}_getDrawLayerParams(t,e){let{layers:n,pass:i,isPicking:s=!1,layerFilter:a,cullRect:o,effects:d,moduleParameters:f}=e,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const v=[],C=MI(this._lastRenderIndex+1),b={layer:n[0],viewport:t,isPicking:s,renderPass:i,cullRect:o},P={};for(let F=0;F<n.length;F++){const U=n[F],k=this._shouldDrawLayer(U,b,a,P),z={shouldDrawLayer:k};k&&!m&&(z.layerRenderIndex=C(U,k),z.moduleParameters=this._getModuleParameters(U,d,i,f),z.layerParameters=this.getLayerParameters(U,F,t)),v[F]=z}return v}_drawLayersInViewport(t,e,n){let{layers:i,moduleParameters:s,pass:a,target:o,viewport:d,view:f}=e;const m=hK(t,{moduleParameters:s,target:o,viewport:d});if(f&&f.props.clear){const C=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;xc(t,{scissorTest:!0,scissor:m},()=>Iv(t,C))}const v={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};gh(t,{viewport:m});for(let C=0;C<i.length;C++){const b=i[C],{shouldDrawLayer:P,layerRenderIndex:F,moduleParameters:U,layerParameters:k}=n[C];if(P&&b.props.pickable&&v.pickableCount++,b.isComposite)v.compositeCount++;else if(P){v.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),U.viewport=d;try{b._drawLayer({moduleParameters:U,uniforms:{layerIndex:F},parameters:k})}catch(z){b.raiseError(z,"drawing ".concat(b," to ").concat(a))}}}return v}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,n){return t.props.parameters}_shouldDrawLayer(t,e,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let a=t.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(e))return!1;e.layer=a,a=a.parent}if(n){const o=e.layer.id;if(o in i||(i[o]=n(e)),!i[o])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,n,i){var s;const a=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:of(this.gl)});if(e)for(const d of e){var o;Object.assign(a,(o=d.getModuleParameters)===null||o===void 0?void 0:o.call(d,t))}return Object.assign(a,this.getModuleParameters(t,e),i)}}function MI(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},n=(i,s)=>{const a=i.props._offset,o=i.id,d=i.parent&&i.parent.id;let f;if(d&&!(d in t)&&n(i.parent,!1),d in e){const m=e[d]=e[d]||MI(t[d],t);f=m(i,s),e[o]=m}else Number.isFinite(a)?(f=a+(t[d]||0),e[o]=null):f=r;return s&&f>=r&&(r=f+1),t[o]=f,f};return n}function hK(r,t){let{moduleParameters:e,target:n,viewport:i}=t;const s=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||of(r),o=s?n.height:r.drawingBufferHeight,d=i;return[d.x*a,o-(d.y+d.height)*a,d.width*a,d.height*a]}function AK(r,t){const e=t?t.width:r.drawingBufferWidth,n=t?t.height:r.drawingBufferHeight;gh(r,{viewport:[0,0,e,n]}),r.clear(16640)}class dK extends lb{constructor(t,e){super(t,e),$(this,"shadowMap",void 0),$(this,"depthBuffer",void 0),$(this,"fbo",void 0),this.shadowMap=new gl(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new uf(t,{format:33189,width:1,height:1}),this.fbo=new co(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;xc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const n=t.viewports[0],i=of(this.gl),s=n.width*i,a=n.height*i;(s!==e.width||a!==e.height)&&e.resize({width:s,height:a}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const FI="#define SMOOTH_EDGE_RADIUS 0.5",fK=`
`.concat(FI,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),pK=`
`.concat(FI,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),gK={name:"geometry",vs:fK,fs:pK},mK=Object.keys(jn).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(jn[r],";")).join(""),yK=Object.keys(Iu).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(Iu[r],";")).join(""),_K=Object.keys(mv).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(mv[r],";")).join(""),vK="".concat(mK,`
`).concat(yK,`
`).concat(_K,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function bK(r,t){if(r===t)return!0;if(Array.isArray(r)){const e=r.length;if(!t||t.length!==e)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}return!1}function Ag(r){let t={},e;return n=>{for(const i in n)if(!bK(n[i],t[i])){e=r(n),t=n;break}return e}}const LI=[0,0,0,0],wK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],RI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xK=[0,0,0],OI=[0,0,0],BK=Ag(TK);function UI(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:OI;e.length<3&&(e=[e[0],e[1],0]);let n=e,i,s=!0;switch(t===jn.LNGLAT_OFFSETS||t===jn.METER_OFFSETS?i=e:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Iu.WEB_MERCATOR:(t===jn.LNGLAT||t===jn.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Iu.WEB_MERCATOR_AUTO_OFFSET:t===jn.LNGLAT?n=i:t===jn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case Iu.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case Iu.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function CK(r,t,e){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=LI,d=LI,f=r.cameraPosition;const{geospatialOrigin:m,shaderCoordinateOrigin:v,offsetMode:C}=UI(r,t,e);return C&&(d=r.projectPosition(m||v),f=[f[0]-d[0],f[1]-d[1],f[2]-d[2]],d[3]=1,o=ag([],d,a),s=n||s,a=ad([],i,s),a=ad([],a,wK)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:d,cameraPosCommon:f,shaderCoordinateOrigin:v,geospatialOrigin:m}}function EK(r){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=jn.DEFAULT,coordinateOrigin:s=OI,autoWrapLongitude:a=!1}=r;i===jn.DEFAULT&&(i=t.isGeospatial?jn.LNGLAT:jn.CARTESIAN);const o=BK({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.project_uWrapLongitude=a,o.project_uModelMatrix=n||RI,o}function TK(r){let{viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}=r;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:d,shaderCoordinateOrigin:f,geospatialOrigin:m}=CK(t,n,i),v=t.getDistanceScales(),C=[t.width*e,t.height*e],b=ag([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,P={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:e,project_uFocalDistance:b,project_uCommonUnitsPerMeter:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:xK,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:RI,project_uCameraPosition:d};if(m){const F=t.getDistanceScales(m);switch(n){case jn.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,P.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case jn.LNGLAT:case jn.LNGLAT_OFFSETS:t._pseudoMeters||(P.project_uCommonUnitsPerMeter=F.unitsPerMeter),P.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,P.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case jn.CARTESIAN:P.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],P.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return P}const SK={};function IK(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:SK;return"viewport"in r?EK(r):{}}const cb={name:"project",dependencies:[ej,gK],vs:vK,getUniforms:IK};function PK(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ff(r,t){const e=ag([],t,r);return fI(e,e,1/e[3]),e}function DI(r,t){const e=r%t;return e<0?t+e:e}function ub(r,t,e){return r<t?t:r>e?e:r}function MK(r){return Math.log(r)*Math.LOG2E}const hb=Math.log2||MK;function wh(r,t){if(!r)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Tc=Math.PI,NI=Tc/4,Kl=Tc/180,Ab=180/Tc,pf=512,L0=4003e4,R0=85.051129,FK=1.5;function LK(r){return hb(r)}function dg(r){const[t,e]=r;wh(Number.isFinite(t)),wh(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Kl,i=e*Kl,s=pf*(n+Tc)/(2*Tc),a=pf*(Tc+Math.log(Math.tan(NI+i*.5)))/(2*Tc);return[s,a]}function gf(r){const[t,e]=r,n=t/pf*(2*Tc)-Tc,i=2*(Math.atan(Math.exp(e/pf*(2*Tc)-Tc))-NI);return[n*Ab,i*Ab]}function RK(r){const{latitude:t}=r;wh(Number.isFinite(t));const e=Math.cos(t*Kl);return LK(L0*e)-9}function O0(r){const t=Math.cos(r*Kl);return pf/L0/t}function db(r){const{latitude:t,longitude:e,highPrecision:n=!1}=r;wh(Number.isFinite(t)&&Number.isFinite(e));const i=pf,s=Math.cos(t*Kl),a=i/360,o=a/s,d=i/L0/s,f={unitsPerMeter:[d,d,d],metersPerUnit:[1/d,1/d,1/d],unitsPerDegree:[a,o,d],degreesPerUnit:[1/a,1/o,1/d]};if(n){const m=Kl*Math.tan(t*Kl)/s,v=a*m/2,C=i/L0*m,b=C/o*d;f.unitsPerDegree2=[0,v,C],f.unitsPerMeter2=[b,0,b]}return f}function kI(r,t){const[e,n,i]=r,[s,a,o]=t,{unitsPerMeter:d,unitsPerMeter2:f}=db({longitude:e,latitude:n,highPrecision:!0}),m=dg(r);m[0]+=s*(d[0]+f[0]*a),m[1]+=a*(d[1]+f[1]*a);const v=gf(m),C=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[v[0],v[1],C]:v}function OK(r){const{height:t,pitch:e,bearing:n,altitude:i,scale:s,center:a}=r,o=PK();S0(o,o,[0,0,-i]),AI(o,o,-e*Kl),dI(o,o,n*Kl);const d=s/t;return tb(o,o,[d,d,d]),a&&S0(o,o,_j([],a)),o}function UK(r){const{width:t,height:e,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:d=1,farZMultiplier:f=1}=r;let{fovy:m=U0(FK)}=r;n!==void 0&&(m=U0(n));const v=m*Kl,C=i*Kl,b=QI(m);let P=b;a&&(P+=a[2]*o/Math.cos(C)/e);const F=v*(.5+(s?s[1]:0)/e),U=Math.sin(F)*P/Math.sin(ub(Math.PI/2-C-F,.01,Math.PI-.01)),k=Math.sin(C)*U+P,z=P*10,K=Math.min(k*f,z);return{fov:v,aspect:t/e,focalDistance:b,near:d,far:K}}function U0(r){return 2*Math.atan(.5/r)*Ab}function QI(r){return .5/Math.tan(.5*r*Kl)}function zI(r,t){const[e,n,i=0]=r;return wh(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i)),ff(t,[e,n,i,1])}function fb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[n,i,s]=r;if(wh(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return ff(t,[n,i,s,1]);const a=ff(t,[n,i,0,1]),o=ff(t,[n,i,1,1]),d=a[2],f=o[2],m=d===f?0:((e||0)-d)/(f-d);return Y5([],a,o,m)}function DK(r){const{width:t,height:e,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,d],[f,m]]=n,v=NK(r.padding),C=dg([o,ub(m,-R0,R0)]),b=dg([f,ub(d,-R0,R0)]),P=[Math.max(Math.abs(b[0]-C[0]),i),Math.max(Math.abs(b[1]-C[1]),i)],F=[t-v.left-v.right-Math.abs(a[0])*2,e-v.top-v.bottom-Math.abs(a[1])*2];wh(F[0]>0&&F[1]>0);const U=F[0]/P[0],k=F[1]/P[1],z=(v.right-v.left)/2/U,K=(v.top-v.bottom)/2/k,G=[(b[0]+C[0])/2+z,(b[1]+C[1])/2+K],X=gf(G),Y=Math.min(s,hb(Math.abs(Math.min(U,k))));return wh(Number.isFinite(Y)),{longitude:X[0],latitude:X[1],zoom:Y}}function NK(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(wh(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const HI=Math.PI/180;function kK(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:n,unproject:i}=r,s={targetZ:t},a=i([0,n],s),o=i([e,n],s);let d,f;const m=r.fovy?.5*r.fovy*HI:Math.atan(.5/r.altitude),v=(90-r.pitch)*HI;return m>v-.01?(d=VI(r,0,t),f=VI(r,e,t)):(d=i([0,0],s),f=i([e,0],s)),[a,o,f,d]}function VI(r,t,e){const{pixelUnprojectionMatrix:n}=r,i=ff(n,[t,0,1,1]),s=ff(n,[t,r.height,1,1]),o=(e*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),d=Y5([],i,s,o),f=gf(d);return f.push(e),f}const GI=512;function QK(r){const{width:t,height:e,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=DI(i+180,360)-180),(o<-180||o>180)&&(o=DI(o+180,360)-180);const d=hb(e/GI);if(a<=d)a=d,s=0;else{const f=e/2/Math.pow(2,a),m=gf([0,f])[1];if(s<m)s=m;else{const v=gf([0,GI-f])[1];s>v&&(s=v)}}return{width:t,height:e,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const zK=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,HK=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,VK=Ag(WK),GK=Ag($K),jK=[0,0,0,1],qK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function KK(r,t){const[e,n,i]=r,s=fb([e,n,i],t);return Number.isFinite(i)?s:[s[0],s[1],0]}function WK(r){let{viewport:t,center:e}=r;return new Vn(t.viewProjectionMatrix).invert().transform(e)}function $K(r){let{viewport:t,shadowMatrices:e}=r;const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>KK(o,i));for(const o of e){const d=o.clone().translate(new Ie(t.center).negate()),f=a.map(v=>d.transform(v)),m=new Vn().ortho({left:Math.min(...f.map(v=>v[0])),right:Math.max(...f.map(v=>v[0])),bottom:Math.min(...f.map(v=>v[1])),top:Math.max(...f.map(v=>v[1])),near:Math.min(...f.map(v=>-v[2])),far:Math.max(...f.map(v=>-v[2]))});n.push(m.multiplyRight(o))}return n}function XK(r,t){const{shadowEnabled:e=!0}=r;if(!e||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||jK,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=VK({viewport:r.viewport,center:t.project_uCenter}),s=[],a=GK({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let o=0;o<r.shadowMatrices.length;o++){const d=a[o],f=d.clone().translate(new Ie(r.viewport.center).negate());t.project_uCoordinateSystem===jn.LNGLAT&&t.project_uProjectionMode===Iu.WEB_MERCATOR?(a[o]=f,s[o]=i):(a[o]=d.clone().multiplyRight(qK),s[o]=f.transform(i))}for(let o=0;o<a.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=a[o],n["shadow_uProjectCenters[".concat(o,"]")]=s[o],r.shadowMaps&&r.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=r.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=r.dummyShadowMap;return n}const pb={name:"shadow",dependencies:[cb],vs:zK,fs:HK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?XK(r,t):{}}},ZK={color:[255,255,255],intensity:1},jI=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],YK=[0,0,0,200/255];class gb{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id","lighting-effect"),$(this,"props",void 0),$(this,"shadowColor",YK),$(this,"shadow",void 0),$(this,"ambientLight",void 0),$(this,"directionalLights",void 0),$(this,"pointLights",void 0),$(this,"shadowPasses",[]),$(this,"shadowMaps",[]),$(this,"dummyShadowMap",null),$(this,"programManager",void 0),$(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=ug.getDefaultProgramManager(t),pb&&this.programManager.addDefaultModule(pb)),this.dummyShadowMap||(this.dummyShadowMap=new gl(t,{width:1,height:1}));for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:n,layerFilter:i,viewports:s,onViewportActive:a,views:o,moduleParameters:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(pb),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const n=new Vn().lookAt({eye:new Ie(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new dK(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;!t&&e.length===0&&n.length===0&&(this.ambientLight=new II(ZK),this.directionalLights.push(new PI(jI[0]),new PI(jI[1])))}}class JK{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"_pool",[]),$(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:s,padding:a=0,copy:o=!1,initialize:d=!1,maxCount:f}=n;const m=s||t&&t.constructor||Float32Array,v=e*i+a;if(ArrayBuffer.isView(t)){if(v<=t.length)return t;if(v*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new m(t.buffer,0,v)}let C=1/0;f&&(C=f*i+a);const b=this._allocate(m,v,d,C);return t&&o?b.set(t):d||b.fill(0,0,4),this._release(t),b}release(t){this._release(t)}_allocate(t,e,n,i){let s=Math.max(Math.ceil(e*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=t.BYTES_PER_ELEMENT*s,d=a.findIndex(f=>f.byteLength>=o);if(d>=0){const f=new t(a.splice(d,1)[0],0,s);return n&&f.fill(0),f}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,s=e.findIndex(a=>a.byteLength>=i);s<0?e.push(n):(s>0||e.length<this.opts.poolSize)&&e.splice(s,0,n),e.length>this.opts.poolSize&&e.shift()}}const fg=new JK;function pg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tW(r){return[r[12],r[13],r[14]]}function eW(r){return{left:mf(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:mf(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:mf(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:mf(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:mf(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:mf(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const qI=new Ie;function mf(r,t,e,n){qI.set(r,t,e);const i=qI.len();return{distance:n/i,normal:new Ie(-r/i,-t/i,-e/i)}}function rW(r){return r-Math.fround(r)}let gg;function mb(r,t){const{size:e=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:r.length,s=(i-n)/e;gg=fg.allocate(gg,s,{type:Float32Array,size:e*2});let a=n,o=0;for(;a<i;){for(let d=0;d<e;d++){const f=r[a++];gg[o+d]=f,gg[o+d+e]=rW(f)}o+=e*2}return gg.subarray(0,s*e*2)}function nW(r){let t=null,e=!1;for(const n of r)n&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const iW=Math.PI/180,sW=pg(),KI=[0,0,0],oW={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function aW(r){let{width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:a,near:o,far:d}=r;const f=t/e,m=n?new Vn().orthographic({fovy:i,aspect:f,focalDistance:s,near:o,far:d}):new Vn().perspective({fovy:i,aspect:f,near:o,far:d});if(a){const{left:v=0,right:C=0,top:b=0,bottom:P=0}=a,F=bh((v+t-C)/2,0,t)-t/2,U=bh((b+e-P)/2,0,e)-e/2;m[8]-=F*2/t,m[9]+=U*2/e}return m}class yf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"x",void 0),$(this,"y",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"padding",void 0),$(this,"isGeospatial",void 0),$(this,"zoom",void 0),$(this,"focalDistance",void 0),$(this,"position",void 0),$(this,"modelMatrix",void 0),$(this,"distanceScales",void 0),$(this,"scale",void 0),$(this,"center",void 0),$(this,"cameraPosition",void 0),$(this,"projectionMatrix",void 0),$(this,"viewMatrix",void 0),$(this,"viewMatrixUncentered",void 0),$(this,"viewMatrixInverse",void 0),$(this,"viewProjectionMatrix",void 0),$(this,"pixelProjectionMatrix",void 0),$(this,"pixelUnprojectionMatrix",void 0),$(this,"resolution",void 0),$(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||oW,this.focalDistance=t.focalDistance||1,this.position=t.position||KI,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Iu.WEB_MERCATOR:Iu.WEB_MERCATOR_AUTO_OFFSET:Iu.IDENTITY}equals(t){return t instanceof yf?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Cc(t.projectionMatrix,this.projectionMatrix)&&Cc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.projectPosition(t),i=zI(n,this.pixelProjectionMatrix),[s,a]=i,o=e?a:this.height-a;return t.length===2?[s,o]:[s,o,i[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[i,s,a]=t,o=e?s:this.height-s,d=n&&n*this.distanceScales.unitsPerMeter[2],f=fb([i,o,a],this.pixelUnprojectionMatrix,d),[m,v,C]=this.unprojectPosition(f);return Number.isFinite(a)?[m,v,C]:Number.isFinite(n)?[m,v,n]:[m,v]}projectPosition(t){const[e,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,n,i]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,n,i]}projectFlat(t){if(this.isGeospatial){const e=dg(t);return e[1]=bh(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?gf(t):t}getBounds(){const e={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),s=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(t){return t?db({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:s=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,eW(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=RK({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||db({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=t;let o=KI;if(s&&(o=a?new Vn(a).transformAsVector(s,[]):s),this.isGeospatial){const d=this.projectPosition([e,n,0]);this.center=new Ie(o).scale(this.distanceScales.unitsPerMeter).add(d)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:e=sW,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:d=1e3,padding:f=null,focalDistance:m=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new Vn().multiplyRight(e).translate(new Ie(this.center).negate()),this.projectionMatrix=n||aW({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*iW,focalDistance:m,padding:f,near:o,far:d});const v=pg();ad(v,v,this.projectionMatrix),ad(v,v,this.viewMatrix),this.viewProjectionMatrix=v,this.viewMatrixInverse=Jv([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=tW(this.viewMatrixInverse);const C=pg(),b=pg();tb(C,C,[this.width/2,-this.height/2,1]),S0(C,C,[1,-1,0]),ad(b,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=Jv(pg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$n.warn("Pixel project matrix not invertible")()}}$(yf,"displayName","Viewport");class ld extends yf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:d=1.01,nearZ:f,farZ:m,orthographic:v=!1,projectionMatrix:C,repeat:b=!1,worldOffset:P=0,position:F,padding:U,legacyMeterSizes:k=!1}=t;let{width:z,height:K,altitude:G=1.5}=t;const X=Math.pow(2,i);z=z||1,K=K||1;let Y,it=null;if(C)G=C[5]/2,Y=U0(G);else{t.fovy?(Y=t.fovy,G=QI(Y)):Y=U0(G);let wt;if(U){const{top:Ct=0,bottom:st=0}=U;wt=[0,bh((Ct+K-st)/2,0,K)-K/2]}it=UK({width:z,height:K,scale:X,center:F&&[0,0,F[2]*O0(e)],offset:wt,pitch:s,fovy:Y,nearZMultiplier:o,farZMultiplier:d}),Number.isFinite(f)&&(it.near=f),Number.isFinite(m)&&(it.far=m)}let nt=OK({height:K,pitch:s,bearing:a,scale:X,altitude:G});P&&(nt=new Vn().translate([512*P,0,0]).multiplyLeft(nt)),super({...t,width:z,height:K,viewMatrix:nt,longitude:n,latitude:e,zoom:i,...it,fovy:Y,focalDistance:G}),$(this,"longitude",void 0),$(this,"latitude",void 0),$(this,"pitch",void 0),$(this,"bearing",void 0),$(this,"altitude",void 0),$(this,"fovy",void 0),$(this,"orthographic",void 0),$(this,"_subViewports",void 0),$(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=G,this.fovy=Y,this.orthographic=v,this._subViewports=b?[]:null,this._pseudoMeters=k,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const s=i?new ld({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t),i=(t[2]||0)*O0(t[1]);return[e,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t),i=(t[2]||0)/O0(n);return[e,n,i]}addMetersToLngLat(t,e){return kI(t,e)}panByPosition(t,e){const n=fb(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),s=Z5([],i,dj([],n)),a=Z5([],this.center,s),[o,d]=this.unprojectFlat(a);return{longitude:o,latitude:d}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=kK(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=DK({width:n,height:i,bounds:t,...e});return new ld({width:n,height:i,longitude:s,latitude:a,zoom:o})}}$(ld,"displayName","WebMercatorViewport");const WI=[0,0,0];function yb(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.projectPosition(r);if(e&&t instanceof ld){const[i,s,a=0]=r,o=t.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function lW(r){const{viewport:t,modelMatrix:e,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===jn.DEFAULT&&(i=t.isGeospatial?jn.LNGLAT:jn.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function $I(r,t){let{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}=t,[o,d,f=0]=r;switch(n&&([o,d,f]=ag([],[o,d,f,1],n)),i){case jn.LNGLAT:return yb([o,d,f],e,a);case jn.LNGLAT_OFFSETS:return yb([o+s[0],d+s[1],f+(s[2]||0)],e,a);case jn.METER_OFFSETS:return yb(kI(s,[o,d,f]),e,a);case jn.CARTESIAN:default:return e.isGeospatial?[o+s[0],d+s[1],f+s[2]]:e.projectPosition([o,d,f])}}function cW(r,t){const{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=lW(t),{autoOffset:d=!0}=t,{geospatialOrigin:f=WI,shaderCoordinateOrigin:m=WI,offsetMode:v=!1}=d?UI(e,n,i):{},C=$I(r,{viewport:e,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:v});if(v){const b=e.projectPosition(f||m);Cj(C,C,b)}return C}const XI={blendFunc:[1,0,32771,0],blendEquation:32774};class ZI extends lb{constructor(){super(...arguments),$(this,"pickZ",void 0),$(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:d,y:f,width:m,height:v},cullRect:C,effects:b,pass:P="picking",pickZ:F,moduleParameters:U}=t;const k=this.gl;this.pickZ=F;const z=this._resetColorEncoder(F),K=xc(k,{scissorTest:!0,scissor:[d,f,m,v],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...XI,blend:!F},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:a,cullRect:C,effects:b==null?void 0:b.filter(X=>X.useInPicking),pass:P,isPicking:!0,moduleParameters:U}));return this._colorEncoderState=null,{decodePickingColor:z&&hW.bind(null,z),stats:K}}shouldDrawLayer(t){const{pickable:e,operation:n}=t.props;return e&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,n){const i={...t.props.parameters},{pickable:s,operation:a}=t.props;return this._colorEncoderState?s&&a.includes("draw")&&(Object.assign(i,XI),i.blend=!0,i.blendColor=uW(this._colorEncoderState,t,n)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function uW(r,t,e){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(t);return a?(a.viewports.push(e),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:t,viewports:[e]},n.set(t,a),i[s]=a):($n.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function hW(r,t){const e=r.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const _f={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},D0=Symbol.for("component"),AA=Symbol.for("propTypes"),_b=Symbol.for("deprecatedProps"),vf=Symbol.for("asyncPropDefaults"),cd=Symbol.for("asyncPropOriginal"),dA=Symbol.for("asyncPropResolved");function N0(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?YI(r,t,[]):t(r)?[r]:[]}function YI(r,t,e){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?YI(i,t,e):t(i)&&e.push(i)}return e}function AW(r){let{target:t,source:e,start:n=0,count:i=1}=r;const s=e.length,a=i*s;let o=0;for(let d=n;o<s;o++)t[d++]=e[o];for(;o<a;)o<a-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+a-o),o=a);return t}class dW{constructor(t,e,n){$(this,"id",void 0),$(this,"context",void 0),$(this,"isLoaded",void 0),$(this,"persistent",void 0),$(this,"_loadCount",0),$(this,"_subscribers",new Set),$(this,"_data",void 0),$(this,"_loader",void 0),$(this,"_error",void 0),$(this,"_content",void 0),this.id=t,this.context=n,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;typeof t=="string"&&(i=oA(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class fW{constructor(t){let{gl:e,protocol:n}=t;$(this,"protocol",void 0),$(this,"_context",void 0),$(this,"_resources",void 0),$(this,"_consumers",void 0),$(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}=t,a=this._resources[e];a?a.setData(n,i):(a=new dW(e,n,this._context),this._resources[e]=a),a.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const n=this._consumers[e];if(n){for(const i in n){const s=n[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:n,consumerId:i,requestId:s="default"}=t;const{_resources:a,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const d=a[e];if(this._track(i,s,d,n),d)return d.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const s=this._consumers,a=s[t]=s[t]||{},o=a[e]||{},d=o.resourceId&&this._resources[o.resourceId];d&&(d.unsubscribe(o),this.prune()),n&&(a[e]=o,o.onChange=i,o.resourceId=n.id,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const vb={name:"project32",dependencies:[cb],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},bb={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Iq},pW=[cb],gW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function mW(r){const t=ug.getDefaultProgramManager(r);for(const e of pW)t.addDefaultModule(e);for(const e of gW)t.addShaderHook(e);return t}const yW="layerManager.setLayers",_W="layerManager.activateViewport";class vW{constructor(t){let{deck:e,stats:n,viewport:i,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"layers",void 0),$(this,"context",void 0),$(this,"resourceManager",void 0),$(this,"_lastRenderedLayers",[]),$(this,"_needsRedraw",!1),$(this,"_needsUpdate",!1),$(this,"_nextLayers",null),$(this,"_debug",!1),$(this,"activateViewport",a=>{ra(_W,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new fW({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&mW(t),stats:n||new zp({id:"deck.gl"}),viewport:i||new yf({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new SI,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(n=>e.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){ra(yW,this,e,t),this._lastRenderedLayers=t;const n=N0(t,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,n){n.raiseError(e,"".concat(t," of ").concat(n))}_updateLayers(t,e){const n={};for(const a of t)n[a.id]?$n.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const s=e[i.id];s===null&&$n.warn("Multiple new layers with same id ".concat(i.id))(),e[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=_f.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=_f.MATCHED,e!==t&&(t.lifecycle=_f.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=_f.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=_f.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Mu(r,t,e){if(r===t)return!0;if(!e||!r||!t)return!1;if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Mu(r[n],t[n],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof r=="object"&&typeof t=="object"){const n=Object.keys(r),i=Object.keys(t);if(n.length!==i.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!Mu(r[s],t[s],e-1))return!1;return!0}return!1}class bW{constructor(t){$(this,"width",void 0),$(this,"height",void 0),$(this,"views",void 0),$(this,"viewState",void 0),$(this,"controllers",void 0),$(this,"timeline",void 0),$(this,"_viewports",void 0),$(this,"_viewportMap",void 0),$(this,"_isUpdating",void 0),$(this,"_needsRedraw",void 0),$(this,"_needsUpdate",void 0),$(this,"_eventManager",void 0),$(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=N0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Mu(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):$n.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const n=e.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var a;return(a=this.getView(t.id))===null||a===void 0?void 0:a.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,n,i){const s=t.controller;if(s&&n){const a={...e,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(t,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){const s=t[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let d=e[s.id];const f=!!s.controller;f&&!d&&(n=!0),(n||!f)&&d&&(d.finalize(),d=null),this.controllers[s.id]=this._updateController(s,a,o,d),o&&this._viewports.unshift(o)}for(const i in e){const s=e[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((n,i)=>!t[i].equals(e[i]))}}const wW=/([0-9]+\.?[0-9]*)(%|px)/;function fA(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const t=wW.exec(r);if(t&&t.length>=3){const e=t[2]==="%",n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(r))}}function pA(r,t){return r.relative?Math.round(r.position*t):r.position}function Ho(r,t){if(!r)throw new Error(t||"deck.gl: assertion failed.")}class xW{constructor(t){$(this,"id",void 0),$(this,"viewportInstance",void 0),$(this,"_x",void 0),$(this,"_y",void 0),$(this,"_width",void 0),$(this,"_height",void 0),$(this,"_padding",void 0),$(this,"props",void 0);const{id:e,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null,viewportInstance:d}=t||{};Ho(!d||d instanceof yf),this.viewportInstance=d,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=fA(n),this._y=fA(i),this._width=fA(s),this._height=fA(a),this._padding=o&&{left:fA(o.left||0),right:fA(o.right||0),top:fA(o.top||0),bottom:fA(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&Mu(this.props,t.props,2)}makeViewport(t){let{width:e,height:n,viewState:i}=t;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const n in this.props.viewState)n!=="id"&&(e[n]=this.props.viewState[n]);return e}return t}getDimensions(t){let{width:e,height:n}=t;const i={x:pA(this._x,e),y:pA(this._y,n),width:pA(this._width,e),height:pA(this._height,n)};return this._padding&&(i.padding={left:pA(this._padding.left,e),top:pA(this._padding.top,n),right:pA(this._padding.right,e),bottom:pA(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class mg{constructor(t){$(this,"_inProgress",void 0),$(this,"_handle",void 0),$(this,"_timeline",void 0),$(this,"time",void 0),$(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,(e=(n=this.settings).onStart)===null||e===void 0||e.call(n,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const JI=()=>{},wb={BREAK:1,SNAP_TO_END:2,IGNORE:3},BW=r=>r,CW=wb.BREAK;class EW{constructor(t){$(this,"getControllerState",void 0),$(this,"props",void 0),$(this,"propsInTransition",void 0),$(this,"transition",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"_onTransitionUpdate",e=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:d}}=e,f=d(n/o),m=i.interpolateProps(s,a,f);this.propsInTransition=this.getControllerState({...this.props,...m}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new mg(t.timeline),this.onViewStateChange=t.onViewStateChange||JI,this.onStateChange=t.onStateChange||JI}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===wb.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||e==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===wb.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const n=this.getControllerState(t),i=this.getControllerState(e).shortestPathFrom(n),s=e.transitionInterpolator,a=s.getDuration?s.getDuration(t,e):e.transitionDuration;if(a===0)return;const o=s.initializeProps(t,i);this.propsInTransition={};const d={duration:a,easing:e.transitionEasing||BW,interpolator:s,interruption:e.transitionInterruption||CW,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(d),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class TW{constructor(t){$(this,"_propsToCompare",void 0),$(this,"_propsToExtract",void 0),$(this,"_requiredProps",void 0);const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare)if(!(n in t)||!(n in e)||!Cc(t[n],e[n]))return!1;return!0}initializeProps(t,e){const n={},i={};for(const s of this._propsToExtract)(s in t||s in e)&&(n[s]=t[s],i[s]=e[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];Ho(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}const SW=["longitude","latitude","zoom","bearing","pitch"],IW=["longitude","latitude","zoom"];class t3 extends TW{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:SW,required:IW},super(n.transitionProps),$(this,"opts",void 0),this.opts=n}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(t),o=i(e),d=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(d),aroundPosition:d,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const s of this._propsToExtract)i[s]=w0(t[s]||0,e[s]||0,n);if(e.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...e,...i});Object.assign(i,s.panByPosition(e.aroundPosition,w0(t.around,e.around,n)))}return i}}const gA={transitionDuration:0},PW=300,k0=r=>1-(1-r)*(1-r),bf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ud={};class MW{constructor(t){$(this,"props",void 0),$(this,"state",{}),$(this,"transitionManager",void 0),$(this,"eventManager",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"makeViewport",void 0),$(this,"_controllerState",void 0),$(this,"_events",{}),$(this,"_interactionState",{isDragging:!1}),$(this,"_customEvents",[]),$(this,"_eventStartBlocked",null),$(this,"_panMove",!1),$(this,"invertPan",!1),$(this,"dragMode","rotate"),$(this,"inertia",0),$(this,"scrollZoom",!0),$(this,"dragPan",!0),$(this,"dragRotate",!0),$(this,"doubleClickZoom",!0),$(this,"touchZoom",!0),$(this,"touchRotate",!1),$(this,"keyboard",!0),this.transitionManager=new EW({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:n}=this.props,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.props;if(e&&e.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return s&&e&&e.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?PW:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:d=!1,keyboard:f=!0}=t,m=!!this.onViewStateChange;this.toggleEvents(bf.WHEEL,m&&n),this.toggleEvents(bf.PAN,m),this.toggleEvents(bf.PINCH,m&&(o||d)),this.toggleEvents(bf.TRIPLE_PAN,m&&d),this.toggleEvents(bf.DOUBLE_TAP,m&&a),this.toggleEvents(bf.KEYBOARD,m&&f),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=d,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(n=>{this._events[n]!==e&&(this._events[n]=e,e?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={...t.getViewportProps(),...e},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,gA,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,gA,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:k0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,gA,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:k0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:e,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,gA,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,gA,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:k0},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return ud._startPinchRotation=t.rotation,ud._lastPinchEvent=t,this.updateViewport(n,gA,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:ud._startPinchRotation-n})}return this.updateViewport(e,gA,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ud._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:n}=ud;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let s=this.controllerState.rotateEnd();const a=Math.log2(t.scale),o=(a-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),d=Math.pow(2,a+o*e/2);s=s.zoom({pos:i,scale:d}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:k0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ud._startPinchRotation=null,ud._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let d;const f={};switch(t.srcEvent.code){case"Minus":d=e?o.zoomOut(n).zoomOut(n):o.zoomOut(n),f.isZooming=!0;break;case"Equal":d=e?o.zoomIn(n).zoomIn(n):o.zoomIn(n),f.isZooming=!0;break;case"ArrowLeft":e?(d=o.rotateLeft(s),f.isRotating=!0):(d=o.moveLeft(i),f.isPanning=!0);break;case"ArrowRight":e?(d=o.rotateRight(s),f.isRotating=!0):(d=o.moveRight(i),f.isPanning=!0);break;case"ArrowUp":e?(d=o.rotateUp(a),f.isRotating=!0):(d=o.moveUp(i),f.isPanning=!0);break;case"ArrowDown":e?(d=o.rotateDown(a),f.isRotating=!0):(d=o.moveDown(i),f.isPanning=!0);break;default:return!1}return this.updateViewport(d,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?gA:t?{...e,transitionInterpolator:new t3({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class FW{constructor(t,e){$(this,"_viewportProps",void 0),$(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const e3=5,LW=1.2;class RW extends FW{constructor(t){const{width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:d=0,altitude:f=1.5,position:m=[0,0,0],maxZoom:v=20,minZoom:C=0,maxPitch:b=60,minPitch:P=0,startPanLngLat:F,startZoomLngLat:U,startRotatePos:k,startBearing:z,startPitch:K,startZoom:G,normalize:X=!0}=t;Ho(Number.isFinite(s)),Ho(Number.isFinite(i)),Ho(Number.isFinite(a)),super({width:e,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:d,altitude:f,maxZoom:v,minZoom:C,maxPitch:b,minPitch:P,normalize:X,position:m},{startPanLngLat:F,startZoomLngLat:U,startRotatePos:k,startBearing:z,startPitch:K,startZoom:G}),$(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:n}=t;const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:n=0,deltaAngleY:i=0}=t;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let d;return e?d=this._getNewRotation(e,s,o,a):d={bearing:a+n,pitch:o+i},this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:n,scale:i}=t,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:o,minZoom:d}=this.getViewportProps();let f=s+Math.log2(i);f=bh(f,d,o);const m=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...m.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-e.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=bh(i,n,e);const{maxPitch:s,minPitch:a,pitch:o}=t;t.pitch=bh(o,a,s);const{normalize:d=!0}=t;return d&&Object.assign(t,QK(t)),t}_zoomFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this.getViewportProps();return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,n,i){const s=t[0]-e[0],a=t[1]-e[1],o=t[1],d=e[1],{width:f,height:m}=this.getViewportProps(),v=s/f;let C=0;a>0?Math.abs(m-d)>e3&&(C=a/(d-m)*LW):a<0&&d>e3&&(C=1-o/d),C=bh(C,-1,1);const{minPitch:b,maxPitch:P}=this.getViewportProps(),F=i+180*v;let U=n;return C>0?U=n+C*(P-n):C<0&&(U=n-C*(b-n)),{pitch:U,bearing:F}}}class OW extends MW{constructor(){super(...arguments),$(this,"ControllerState",RW),$(this,"transition",{transitionDuration:300,transitionInterpolator:new t3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),$(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class xb extends xW{get ViewportType(){return ld}get ControllerType(){return OW}}$(xb,"displayName","MapView");const UW=new gb;function DW(r,t){var e,n;const i=(e=r.order)!==null&&e!==void 0?e:1/0,s=(n=t.order)!==null&&n!==void 0?n:1/0;return i-s}class NW{constructor(){$(this,"effects",void 0),$(this,"_resolvedEffects",[]),$(this,"_defaultEffects",[]),$(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(n=>n.id===t.id)){const n=e.findIndex(i=>DW(i,t)>0);n<0?e.push(t):e.splice(n,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Mu(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const i of this.effects)e[i.id]=i;const n=[];for(const i of t){const s=e[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),n.push(s)):(s.cleanup(),n.push(i)):n.push(i),delete e[i.id]}for(const i in e)e[i].cleanup();this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof gb)||this._resolvedEffects.push(UW),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class kW extends lb{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const QW="deckRenderer.renderLayers";class zW{constructor(t){$(this,"gl",void 0),$(this,"layerFilter",void 0),$(this,"drawPickingColors",void 0),$(this,"drawLayersPass",void 0),$(this,"pickLayersPass",void 0),$(this,"renderCount",void 0),$(this,"_needsRedraw",void 0),$(this,"renderBuffers",void 0),$(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new kW(t),this.pickLayersPass=new ZI(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||co.getDefaultFramebuffer(this.gl)};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target,s=e.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,ra(QW,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const n of t)e.preRenderStats[n.id]=n.preRender(this.gl,e),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new co(this.gl),new co(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={...e,inputBuffer:n[0],swapBuffer:n[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=e.target,s.postRender(this.gl,i);break}const a=s.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const HW={pickedColor:null,pickedObjectIndex:-1};function VW(r){let{pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:a}=r;const{x:o,y:d,width:f,height:m}=a;let v=s*s,C=-1,b=0;for(let P=0;P<m;P++){const F=P+d-i,U=F*F;if(U>v)b+=4*f;else for(let k=0;k<f;k++){if(t[b+3]-1>=0){const K=k+o-n,G=K*K+U;G<=v&&(v=G,C=b)}b+=4}}if(C>=0){const P=t.slice(C,C+4),F=e(P);if(F){const U=Math.floor(C/4/f),k=C/4-U*f;return{...F,pickedColor:P,pickedX:o+k,pickedY:d+U}}$n.error("Picked non-existent layer. Is picking buffer corrupt?")()}return HW}function GW(r){let{pickedColors:t,decodePickingColor:e}=r;const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),o=a.join(",");if(!n.has(o)){const d=e(a);d?n.set(o,{...d,color:a}):$n.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function r3(r){let{pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:a}=r,o=e[0];e.length>1&&(o=qW((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let d;if(o){const f=[i-o.x,s-o.y];a!==void 0&&(f[2]=a),d=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:d,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function jW(r){const{pickInfo:t,lastPickedInfo:e,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,d=a?[a]:[];if(n==="hover"){const v=e.index,C=e.layerId,b=a?a.props.id:null;if(b!==C||o!==v){if(b!==C){const P=i.find(F=>F.props.id===C);P&&d.unshift(P)}e.layerId=b,e.index=o,e.info=null}}const f=r3(r),m=new Map;return m.set(null,f),d.forEach(v=>{let C={...f};v===a&&(C.color=s,C.index=o,C.picked=!0),C=n3({layer:v,info:C,mode:n});const b=C.layer;v===a&&n==="hover"&&(e.info=C),m.set(b.id,C),n==="hover"&&b.updateAutoHighlight(C)}),m}function n3(r){let{layer:t,info:e,mode:n}=r;for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function qW(r,t){for(let e=r.length-1;e>=0;e--){const n=r[e];if(n.containsPixel(t))return n}return r[0]}class KW{constructor(t){$(this,"gl",void 0),$(this,"pickingFBO",void 0),$(this,"depthFBO",void 0),$(this,"pickLayersPass",void 0),$(this,"layerFilter",void 0),$(this,"lastPickedInfo",void 0),$(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new ZI(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:n,layers:i,viewports:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,d=a&&a.viewport&&a.viewport.id,f=o?i.find(b=>b.id===o):null,m=d&&s.find(b=>b.id===d)||s[0],v=m&&m.unproject([e-m.x,n-m.y]);return{...a,...{x:e,y:n,viewport:m,coordinate:v,layer:f}}}_resizeBuffer(){var t,e;const{gl:n}=this;if(!this.pickingFBO&&(this.pickingFBO=new co(n),co.isSupported(n,{colorBufferFloat:!0}))){const i=new co(n);i.attach({36064:new gl(n,{format:Un(n)?34836:6408,type:5126})}),this.depthFBO=i}(t=this.pickingFBO)===null||t===void 0||t.resize({width:n.canvas.width,height:n.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:n.canvas.width,height:n.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:n,viewports:i,x:s,y:a,radius:o=0,depth:d=1,mode:f="query",unproject3D:m,onViewportActive:v,effects:C}=t;const b=this._getPickable(e),P=of(this.gl);if(!b)return{result:[],emptyInfo:r3({viewports:i,x:s,y:a,pixelRatio:P})};this._resizeBuffer();const F=vv(this.gl,[s,a],!0),U=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],k=Math.round(o*P),{width:z,height:K}=this.pickingFBO,G=this._getPickingRect({deviceX:U[0],deviceY:U[1],deviceRadius:k,deviceWidth:z,deviceHeight:K}),X={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let Y;const it=[],nt=new Set;for(let wt=0;wt<d;wt++){let Ct;if(G){const ot=this._drawAndSample({layers:b,views:n,viewports:i,onViewportActive:v,deviceRect:G,cullRect:X,effects:C,pass:"picking:".concat(f)});Ct=VW({...ot,deviceX:U[0],deviceY:U[1],deviceRadius:k,deviceRect:G})}else Ct={pickedColor:null,pickedObjectIndex:-1};let st;if(Ct.pickedLayer&&m&&this.depthFBO){const{pickedColors:ot}=this._drawAndSample({layers:[Ct.pickedLayer],views:n,viewports:i,onViewportActive:v,deviceRect:{x:Ct.pickedX,y:Ct.pickedY,width:1,height:1},cullRect:X,effects:C,pass:"picking:".concat(f,":z")},!0);ot[3]&&(st=ot[0])}Ct.pickedLayer&&wt+1<d&&(nt.add(Ct.pickedLayer),Ct.pickedLayer.disablePickingIndex(Ct.pickedObjectIndex)),Y=jW({pickInfo:Ct,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:a,z:st,pixelRatio:P});for(const ot of Y.values())ot.layer&&it.push(ot);if(!Ct.pickedColor)break}for(const wt of nt)wt.restorePickingColors();return{result:it,emptyInfo:Y.get(null)}}_pickVisibleObjects(t){let{layers:e,views:n,viewports:i,x:s,y:a,width:o=1,height:d=1,mode:f="query",maxObjects:m=null,onViewportActive:v,effects:C}=t;const b=this._getPickable(e);if(!b)return[];this._resizeBuffer();const P=of(this.gl),F=vv(this.gl,[s,a],!0),U=F.x,k=F.y+F.height,z=vv(this.gl,[s+o,a+d],!0),K=z.x+z.width,G=z.y,X={x:U,y:G,width:K-U,height:k-G},Y=this._drawAndSample({layers:b,views:n,viewports:i,onViewportActive:v,deviceRect:X,cullRect:{x:s,y:a,width:o,height:d},effects:C,pass:"picking:".concat(f)}),it=GW(Y),nt=new Map,wt=Number.isFinite(m);for(let st=0;st<it.length;st++){var Ct;if(wt&&m&&nt.size>=m)break;const ot=it[st];let vt={color:ot.pickedColor,layer:null,index:ot.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:P};vt=n3({layer:ot.pickedLayer,info:vt,mode:f});const yt=(Ct=vt.object)!==null&&Ct!==void 0?Ct:"".concat(vt.layer.id,"[").concat(vt.index,"]");nt.has(yt)||nt.set(yt,vt)}return Array.from(nt.values())}_drawAndSample(t){let{layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:a,cullRect:o,effects:d,pass:f}=t,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const v=m?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:v,deviceRect:a,cullRect:o,effects:d,pass:f,pickZ:m,preRenderStats:{}};for(const K of d)K.useInPicking&&(C.preRenderStats[K.id]=K.preRender(this.gl,C));const{decodePickingColor:b}=this.pickLayersPass.render(C),{x:P,y:F,width:U,height:k}=a,z=new(m?Float32Array:Uint8Array)(U*k*4);return A0(v,{sourceX:P,sourceY:F,sourceWidth:U,sourceHeight:k,target:z}),{pickedColors:z,decodePickingColor:b}}_getPickingRect(t){let{deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:a}=t;const o=Math.max(0,e-i),d=Math.max(0,n-i),f=Math.min(s,e+i+1)-o,m=Math.min(a,n+i+1)-d;return f<=0||m<=0?null:{x:o,y:d,width:f,height:m}}}const WW={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class $W{constructor(t){$(this,"el",null),$(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,WW),e.appendChild(this.el))}setTooltip(t,e,n){const i=this.el;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var i3={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(t,e,n,i){var s=["","webkit","Moz","MS","ms","o"],a=e.createElement("div"),o="function",d=Math.round,f=Math.abs,m=Date.now;function v(bt,It,jt){return setTimeout(K(bt,jt),It)}function C(bt,It,jt){return Array.isArray(bt)?(b(bt,jt[It],jt),!0):!1}function b(bt,It,jt){var xe;if(bt)if(bt.forEach)bt.forEach(It,jt);else if(bt.length!==i)for(xe=0;xe<bt.length;)It.call(jt,bt[xe],xe,bt),xe++;else for(xe in bt)bt.hasOwnProperty(xe)&&It.call(jt,bt[xe],xe,bt)}function P(bt,It,jt){var xe="DEPRECATED METHOD: "+It+`
`+jt+` AT 
`;return function(){var ar=new Error("get-stack-trace"),Cr=ar&&ar.stack?ar.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Gr=t.console&&(t.console.warn||t.console.log);return Gr&&Gr.call(t.console,xe,Cr),bt.apply(this,arguments)}}var F;typeof Object.assign!="function"?F=function(It){if(It===i||It===null)throw new TypeError("Cannot convert undefined or null to object");for(var jt=Object(It),xe=1;xe<arguments.length;xe++){var ar=arguments[xe];if(ar!==i&&ar!==null)for(var Cr in ar)ar.hasOwnProperty(Cr)&&(jt[Cr]=ar[Cr])}return jt}:F=Object.assign;var U=P(function(It,jt,xe){for(var ar=Object.keys(jt),Cr=0;Cr<ar.length;)(!xe||xe&&It[ar[Cr]]===i)&&(It[ar[Cr]]=jt[ar[Cr]]),Cr++;return It},"extend","Use `assign`."),k=P(function(It,jt){return U(It,jt,!0)},"merge","Use `assign`.");function z(bt,It,jt){var xe=It.prototype,ar;ar=bt.prototype=Object.create(xe),ar.constructor=bt,ar._super=xe,jt&&F(ar,jt)}function K(bt,It){return function(){return bt.apply(It,arguments)}}function G(bt,It){return typeof bt==o?bt.apply(It&&It[0]||i,It):bt}function X(bt,It){return bt===i?It:bt}function Y(bt,It,jt){b(Ct(It),function(xe){bt.addEventListener(xe,jt,!1)})}function it(bt,It,jt){b(Ct(It),function(xe){bt.removeEventListener(xe,jt,!1)})}function nt(bt,It){for(;bt;){if(bt==It)return!0;bt=bt.parentNode}return!1}function wt(bt,It){return bt.indexOf(It)>-1}function Ct(bt){return bt.trim().split(/\s+/g)}function st(bt,It,jt){if(bt.indexOf&&!jt)return bt.indexOf(It);for(var xe=0;xe<bt.length;){if(jt&&bt[xe][jt]==It||!jt&&bt[xe]===It)return xe;xe++}return-1}function ot(bt){return Array.prototype.slice.call(bt,0)}function vt(bt,It,jt){for(var xe=[],ar=[],Cr=0;Cr<bt.length;){var Gr=bt[Cr][It];st(ar,Gr)<0&&xe.push(bt[Cr]),ar[Cr]=Gr,Cr++}return xe=xe.sort(function(yi,_i){return yi[It]>_i[It]}),xe}function yt(bt,It){for(var jt,xe,ar=It[0].toUpperCase()+It.slice(1),Cr=0;Cr<s.length;){if(jt=s[Cr],xe=jt?jt+ar:It,xe in bt)return xe;Cr++}return i}var re=1;function Wt(){return re++}function ee(bt){var It=bt.ownerDocument||bt;return It.defaultView||It.parentWindow||t}var Zt=/mobile|tablet|ip(ad|hone|od)|android/i,oe="ontouchstart"in t,pe=yt(t,"PointerEvent")!==i,De=oe&&Zt.test(navigator.userAgent),at="touch",Tt="pen",Rt="mouse",Nt="kinect",ae=25,Xt=1,ye=2,de=4,qe=8,Ve=1,Je=2,or=4,mr=8,Me=16,Qt=Je|or,Ur=mr|Me,Ir=Qt|Ur,$e=["x","y"],Xe=["clientX","clientY"];function er(bt,It){var jt=this;this.manager=bt,this.callback=It,this.element=bt.element,this.target=bt.options.inputTarget,this.domHandler=function(xe){G(bt.options.enable,[bt])&&jt.handler(xe)},this.init()}er.prototype={handler:function(){},init:function(){this.evEl&&Y(this.element,this.evEl,this.domHandler),this.evTarget&&Y(this.target,this.evTarget,this.domHandler),this.evWin&&Y(ee(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&it(this.element,this.evEl,this.domHandler),this.evTarget&&it(this.target,this.evTarget,this.domHandler),this.evWin&&it(ee(this.element),this.evWin,this.domHandler)}};function gr(bt){var It,jt=bt.options.inputClass;return jt?It=jt:pe?It=te:De?It=Mr:oe?It=Fr:It=pt,new It(bt,Re)}function Re(bt,It,jt){var xe=jt.pointers.length,ar=jt.changedPointers.length,Cr=It&Xt&&xe-ar===0,Gr=It&(de|qe)&&xe-ar===0;jt.isFirst=!!Cr,jt.isFinal=!!Gr,Cr&&(bt.session={}),jt.eventType=It,sr(bt,jt),bt.emit("hammer.input",jt),bt.recognize(jt),bt.session.prevInput=jt}function sr(bt,It){var jt=bt.session,xe=It.pointers,ar=xe.length;jt.firstInput||(jt.firstInput=Lr(It)),ar>1&&!jt.firstMultiple?jt.firstMultiple=Lr(It):ar===1&&(jt.firstMultiple=!1);var Cr=jt.firstInput,Gr=jt.firstMultiple,Bn=Gr?Gr.center:Cr.center,yi=It.center=Zr(xe);It.timeStamp=m(),It.deltaTime=It.timeStamp-Cr.timeStamp,It.angle=In(Bn,yi),It.distance=yr(Bn,yi),Br(jt,It),It.offsetDirection=Vr(It.deltaX,It.deltaY);var _i=Nr(It.deltaTime,It.deltaX,It.deltaY);It.overallVelocityX=_i.x,It.overallVelocityY=_i.y,It.overallVelocity=f(_i.x)>f(_i.y)?_i.x:_i.y,It.scale=Gr?Xn(Gr.pointers,xe):1,It.rotation=Gr?an(Gr.pointers,xe):0,It.maxPointers=jt.prevInput?It.pointers.length>jt.prevInput.maxPointers?It.pointers.length:jt.prevInput.maxPointers:It.pointers.length,xr(jt,It);var nn=bt.element;nt(It.srcEvent.target,nn)&&(nn=It.srcEvent.target),It.target=nn}function Br(bt,It){var jt=It.center,xe=bt.offsetDelta||{},ar=bt.prevDelta||{},Cr=bt.prevInput||{};(It.eventType===Xt||Cr.eventType===de)&&(ar=bt.prevDelta={x:Cr.deltaX||0,y:Cr.deltaY||0},xe=bt.offsetDelta={x:jt.x,y:jt.y}),It.deltaX=ar.x+(jt.x-xe.x),It.deltaY=ar.y+(jt.y-xe.y)}function xr(bt,It){var jt=bt.lastInterval||It,xe=It.timeStamp-jt.timeStamp,ar,Cr,Gr,Bn;if(It.eventType!=qe&&(xe>ae||jt.velocity===i)){var yi=It.deltaX-jt.deltaX,_i=It.deltaY-jt.deltaY,nn=Nr(xe,yi,_i);Cr=nn.x,Gr=nn.y,ar=f(nn.x)>f(nn.y)?nn.x:nn.y,Bn=Vr(yi,_i),bt.lastInterval=It}else ar=jt.velocity,Cr=jt.velocityX,Gr=jt.velocityY,Bn=jt.direction;It.velocity=ar,It.velocityX=Cr,It.velocityY=Gr,It.direction=Bn}function Lr(bt){for(var It=[],jt=0;jt<bt.pointers.length;)It[jt]={clientX:d(bt.pointers[jt].clientX),clientY:d(bt.pointers[jt].clientY)},jt++;return{timeStamp:m(),pointers:It,center:Zr(It),deltaX:bt.deltaX,deltaY:bt.deltaY}}function Zr(bt){var It=bt.length;if(It===1)return{x:d(bt[0].clientX),y:d(bt[0].clientY)};for(var jt=0,xe=0,ar=0;ar<It;)jt+=bt[ar].clientX,xe+=bt[ar].clientY,ar++;return{x:d(jt/It),y:d(xe/It)}}function Nr(bt,It,jt){return{x:It/bt||0,y:jt/bt||0}}function Vr(bt,It){return bt===It?Ve:f(bt)>=f(It)?bt<0?Je:or:It<0?mr:Me}function yr(bt,It,jt){jt||(jt=$e);var xe=It[jt[0]]-bt[jt[0]],ar=It[jt[1]]-bt[jt[1]];return Math.sqrt(xe*xe+ar*ar)}function In(bt,It,jt){jt||(jt=$e);var xe=It[jt[0]]-bt[jt[0]],ar=It[jt[1]]-bt[jt[1]];return Math.atan2(ar,xe)*180/Math.PI}function an(bt,It){return In(It[1],It[0],Xe)+In(bt[1],bt[0],Xe)}function Xn(bt,It){return yr(It[0],It[1],Xe)/yr(bt[0],bt[1],Xe)}var Bt={mousedown:Xt,mousemove:ye,mouseup:de},ct="mousedown",ft="mousemove mouseup";function pt(){this.evEl=ct,this.evWin=ft,this.pressed=!1,er.apply(this,arguments)}z(pt,er,{handler:function(It){var jt=Bt[It.type];jt&Xt&&It.button===0&&(this.pressed=!0),jt&ye&&It.which!==1&&(jt=de),this.pressed&&(jt&de&&(this.pressed=!1),this.callback(this.manager,jt,{pointers:[It],changedPointers:[It],pointerType:Rt,srcEvent:It}))}});var Dt={pointerdown:Xt,pointermove:ye,pointerup:de,pointercancel:qe,pointerout:qe},Gt={2:at,3:Tt,4:Rt,5:Nt},le="pointerdown",ge="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(le="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function te(){this.evEl=le,this.evWin=ge,er.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}z(te,er,{handler:function(It){var jt=this.store,xe=!1,ar=It.type.toLowerCase().replace("ms",""),Cr=Dt[ar],Gr=Gt[It.pointerType]||It.pointerType,Bn=Gr==at,yi=st(jt,It.pointerId,"pointerId");Cr&Xt&&(It.button===0||Bn)?yi<0&&(jt.push(It),yi=jt.length-1):Cr&(de|qe)&&(xe=!0),!(yi<0)&&(jt[yi]=It,this.callback(this.manager,Cr,{pointers:jt,changedPointers:[It],pointerType:Gr,srcEvent:It}),xe&&jt.splice(yi,1))}});var he={touchstart:Xt,touchmove:ye,touchend:de,touchcancel:qe},ve="touchstart",me="touchstart touchmove touchend touchcancel";function Yt(){this.evTarget=ve,this.evWin=me,this.started=!1,er.apply(this,arguments)}z(Yt,er,{handler:function(It){var jt=he[It.type];if(jt===Xt&&(this.started=!0),!!this.started){var xe=ur.call(this,It,jt);jt&(de|qe)&&xe[0].length-xe[1].length===0&&(this.started=!1),this.callback(this.manager,jt,{pointers:xe[0],changedPointers:xe[1],pointerType:at,srcEvent:It})}}});function ur(bt,It){var jt=ot(bt.touches),xe=ot(bt.changedTouches);return It&(de|qe)&&(jt=vt(jt.concat(xe),"identifier")),[jt,xe]}var ir={touchstart:Xt,touchmove:ye,touchend:de,touchcancel:qe},tr="touchstart touchmove touchend touchcancel";function Mr(){this.evTarget=tr,this.targetIds={},er.apply(this,arguments)}z(Mr,er,{handler:function(It){var jt=ir[It.type],xe=Fe.call(this,It,jt);xe&&this.callback(this.manager,jt,{pointers:xe[0],changedPointers:xe[1],pointerType:at,srcEvent:It})}});function Fe(bt,It){var jt=ot(bt.touches),xe=this.targetIds;if(It&(Xt|ye)&&jt.length===1)return xe[jt[0].identifier]=!0,[jt,jt];var ar,Cr,Gr=ot(bt.changedTouches),Bn=[],yi=this.target;if(Cr=jt.filter(function(_i){return nt(_i.target,yi)}),It===Xt)for(ar=0;ar<Cr.length;)xe[Cr[ar].identifier]=!0,ar++;for(ar=0;ar<Gr.length;)xe[Gr[ar].identifier]&&Bn.push(Gr[ar]),It&(de|qe)&&delete xe[Gr[ar].identifier],ar++;if(Bn.length)return[vt(Cr.concat(Bn),"identifier"),Bn]}var nr=2500,_r=25;function Fr(){er.apply(this,arguments);var bt=K(this.handler,this);this.touch=new Mr(this.manager,bt),this.mouse=new pt(this.manager,bt),this.primaryTouch=null,this.lastTouches=[]}z(Fr,er,{handler:function(It,jt,xe){var ar=xe.pointerType==at,Cr=xe.pointerType==Rt;if(!(Cr&&xe.sourceCapabilities&&xe.sourceCapabilities.firesTouchEvents)){if(ar)Yr.call(this,jt,xe);else if(Cr&&vr.call(this,xe))return;this.callback(It,jt,xe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Yr(bt,It){bt&Xt?(this.primaryTouch=It.changedPointers[0].identifier,Qr.call(this,It)):bt&(de|qe)&&Qr.call(this,It)}function Qr(bt){var It=bt.changedPointers[0];if(It.identifier===this.primaryTouch){var jt={x:It.clientX,y:It.clientY};this.lastTouches.push(jt);var xe=this.lastTouches,ar=function(){var Cr=xe.indexOf(jt);Cr>-1&&xe.splice(Cr,1)};setTimeout(ar,nr)}}function vr(bt){for(var It=bt.srcEvent.clientX,jt=bt.srcEvent.clientY,xe=0;xe<this.lastTouches.length;xe++){var ar=this.lastTouches[xe],Cr=Math.abs(It-ar.x),Gr=Math.abs(jt-ar.y);if(Cr<=_r&&Gr<=_r)return!0}return!1}var wn=yt(a.style,"touchAction"),Ai=wn!==i,mn="compute",Dn="auto",gn="manipulation",Hn="none",xn="pan-x",vs="pan-y",Kt=dn();function Er(bt,It){this.manager=bt,this.set(It)}Er.prototype={set:function(bt){bt==mn&&(bt=this.compute()),Ai&&this.manager.element.style&&Kt[bt]&&(this.manager.element.style[wn]=bt),this.actions=bt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var bt=[];return b(this.manager.recognizers,function(It){G(It.options.enable,[It])&&(bt=bt.concat(It.getTouchAction()))}),cr(bt.join(" "))},preventDefaults:function(bt){var It=bt.srcEvent,jt=bt.offsetDirection;if(this.manager.session.prevented){It.preventDefault();return}var xe=this.actions,ar=wt(xe,Hn)&&!Kt[Hn],Cr=wt(xe,vs)&&!Kt[vs],Gr=wt(xe,xn)&&!Kt[xn];if(ar){var Bn=bt.pointers.length===1,yi=bt.distance<2,_i=bt.deltaTime<250;if(Bn&&yi&&_i)return}if(!(Gr&&Cr)&&(ar||Cr&&jt&Qt||Gr&&jt&Ur))return this.preventSrc(It)},preventSrc:function(bt){this.manager.session.prevented=!0,bt.preventDefault()}};function cr(bt){if(wt(bt,Hn))return Hn;var It=wt(bt,xn),jt=wt(bt,vs);return It&&jt?Hn:It||jt?It?xn:vs:wt(bt,gn)?gn:Dn}function dn(){if(!Ai)return!1;var bt={},It=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(jt){bt[jt]=It?t.CSS.supports("touch-action",jt):!0}),bt}var qn=1,Gn=2,Qn=4,di=8,xi=di,mi=16,Ds=32;function Po(bt){this.options=F({},this.defaults,bt||{}),this.id=Wt(),this.manager=null,this.options.enable=X(this.options.enable,!0),this.state=qn,this.simultaneous={},this.requireFail=[]}Po.prototype={defaults:{},set:function(bt){return F(this.options,bt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(bt){if(C(bt,"recognizeWith",this))return this;var It=this.simultaneous;return bt=Mo(bt,this),It[bt.id]||(It[bt.id]=bt,bt.recognizeWith(this)),this},dropRecognizeWith:function(bt){return C(bt,"dropRecognizeWith",this)?this:(bt=Mo(bt,this),delete this.simultaneous[bt.id],this)},requireFailure:function(bt){if(C(bt,"requireFailure",this))return this;var It=this.requireFail;return bt=Mo(bt,this),st(It,bt)===-1&&(It.push(bt),bt.requireFailure(this)),this},dropRequireFailure:function(bt){if(C(bt,"dropRequireFailure",this))return this;bt=Mo(bt,this);var It=st(this.requireFail,bt);return It>-1&&this.requireFail.splice(It,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(bt){return!!this.simultaneous[bt.id]},emit:function(bt){var It=this,jt=this.state;function xe(ar){It.manager.emit(ar,bt)}jt<di&&xe(It.options.event+$c(jt)),xe(It.options.event),bt.additionalEvent&&xe(bt.additionalEvent),jt>=di&&xe(It.options.event+$c(jt))},tryEmit:function(bt){if(this.canEmit())return this.emit(bt);this.state=Ds},canEmit:function(){for(var bt=0;bt<this.requireFail.length;){if(!(this.requireFail[bt].state&(Ds|qn)))return!1;bt++}return!0},recognize:function(bt){var It=F({},bt);if(!G(this.options.enable,[this,It])){this.reset(),this.state=Ds;return}this.state&(xi|mi|Ds)&&(this.state=qn),this.state=this.process(It),this.state&(Gn|Qn|di|mi)&&this.tryEmit(It)},process:function(bt){},getTouchAction:function(){},reset:function(){}};function $c(bt){return bt&mi?"cancel":bt&di?"end":bt&Qn?"move":bt&Gn?"start":""}function Oa(bt){return bt==Me?"down":bt==mr?"up":bt==Je?"left":bt==or?"right":""}function Mo(bt,It){var jt=It.manager;return jt?jt.get(bt):bt}function Nn(){Po.apply(this,arguments)}z(Nn,Po,{defaults:{pointers:1},attrTest:function(bt){var It=this.options.pointers;return It===0||bt.pointers.length===It},process:function(bt){var It=this.state,jt=bt.eventType,xe=It&(Gn|Qn),ar=this.attrTest(bt);return xe&&(jt&qe||!ar)?It|mi:xe||ar?jt&de?It|di:It&Gn?It|Qn:Gn:Ds}});function nl(){Nn.apply(this,arguments),this.pX=null,this.pY=null}z(nl,Nn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ir},getTouchAction:function(){var bt=this.options.direction,It=[];return bt&Qt&&It.push(vs),bt&Ur&&It.push(xn),It},directionTest:function(bt){var It=this.options,jt=!0,xe=bt.distance,ar=bt.direction,Cr=bt.deltaX,Gr=bt.deltaY;return ar&It.direction||(It.direction&Qt?(ar=Cr===0?Ve:Cr<0?Je:or,jt=Cr!=this.pX,xe=Math.abs(bt.deltaX)):(ar=Gr===0?Ve:Gr<0?mr:Me,jt=Gr!=this.pY,xe=Math.abs(bt.deltaY))),bt.direction=ar,jt&&xe>It.threshold&&ar&It.direction},attrTest:function(bt){return Nn.prototype.attrTest.call(this,bt)&&(this.state&Gn||!(this.state&Gn)&&this.directionTest(bt))},emit:function(bt){this.pX=bt.deltaX,this.pY=bt.deltaY;var It=Oa(bt.direction);It&&(bt.additionalEvent=this.options.event+It),this._super.emit.call(this,bt)}});function Fo(){Nn.apply(this,arguments)}z(Fo,Nn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Hn]},attrTest:function(bt){return this._super.attrTest.call(this,bt)&&(Math.abs(bt.scale-1)>this.options.threshold||this.state&Gn)},emit:function(bt){if(bt.scale!==1){var It=bt.scale<1?"in":"out";bt.additionalEvent=this.options.event+It}this._super.emit.call(this,bt)}});function il(){Po.apply(this,arguments),this._timer=null,this._input=null}z(il,Po,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Dn]},process:function(bt){var It=this.options,jt=bt.pointers.length===It.pointers,xe=bt.distance<It.threshold,ar=bt.deltaTime>It.time;if(this._input=bt,!xe||!jt||bt.eventType&(de|qe)&&!ar)this.reset();else if(bt.eventType&Xt)this.reset(),this._timer=v(function(){this.state=xi,this.tryEmit()},It.time,this);else if(bt.eventType&de)return xi;return Ds},reset:function(){clearTimeout(this._timer)},emit:function(bt){this.state===xi&&(bt&&bt.eventType&de?this.manager.emit(this.options.event+"up",bt):(this._input.timeStamp=m(),this.manager.emit(this.options.event,this._input)))}});function fa(){Nn.apply(this,arguments)}z(fa,Nn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Hn]},attrTest:function(bt){return this._super.attrTest.call(this,bt)&&(Math.abs(bt.rotation)>this.options.threshold||this.state&Gn)}});function sc(){Nn.apply(this,arguments)}z(sc,Nn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Qt|Ur,pointers:1},getTouchAction:function(){return nl.prototype.getTouchAction.call(this)},attrTest:function(bt){var It=this.options.direction,jt;return It&(Qt|Ur)?jt=bt.overallVelocity:It&Qt?jt=bt.overallVelocityX:It&Ur&&(jt=bt.overallVelocityY),this._super.attrTest.call(this,bt)&&It&bt.offsetDirection&&bt.distance>this.options.threshold&&bt.maxPointers==this.options.pointers&&f(jt)>this.options.velocity&&bt.eventType&de},emit:function(bt){var It=Oa(bt.offsetDirection);It&&this.manager.emit(this.options.event+It,bt),this.manager.emit(this.options.event,bt)}});function Vi(){Po.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}z(Vi,Po,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[gn]},process:function(bt){var It=this.options,jt=bt.pointers.length===It.pointers,xe=bt.distance<It.threshold,ar=bt.deltaTime<It.time;if(this.reset(),bt.eventType&Xt&&this.count===0)return this.failTimeout();if(xe&&ar&&jt){if(bt.eventType!=de)return this.failTimeout();var Cr=this.pTime?bt.timeStamp-this.pTime<It.interval:!0,Gr=!this.pCenter||yr(this.pCenter,bt.center)<It.posThreshold;this.pTime=bt.timeStamp,this.pCenter=bt.center,!Gr||!Cr?this.count=1:this.count+=1,this._input=bt;var Bn=this.count%It.taps;if(Bn===0)return this.hasRequireFailures()?(this._timer=v(function(){this.state=xi,this.tryEmit()},It.interval,this),Gn):xi}return Ds},failTimeout:function(){return this._timer=v(function(){this.state=Ds},this.options.interval,this),Ds},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==xi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ns(bt,It){return It=It||{},It.recognizers=X(It.recognizers,Ns.defaults.preset),new ks(bt,It)}Ns.VERSION="2.0.7",Ns.defaults={domEvents:!1,touchAction:mn,enable:!0,inputTarget:null,inputClass:null,preset:[[fa,{enable:!1}],[Fo,{enable:!1},["rotate"]],[sc,{direction:Qt}],[nl,{direction:Qt},["swipe"]],[Vi],[Vi,{event:"doubletap",taps:2},["tap"]],[il]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Bi=1,on=2;function ks(bt,It){this.options=F({},Ns.defaults,It||{}),this.options.inputTarget=this.options.inputTarget||bt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=bt,this.input=gr(this),this.touchAction=new Er(this,this.options.touchAction),cn(this,!0),b(this.options.recognizers,function(jt){var xe=this.add(new jt[0](jt[1]));jt[2]&&xe.recognizeWith(jt[2]),jt[3]&&xe.requireFailure(jt[3])},this)}ks.prototype={set:function(bt){return F(this.options,bt),bt.touchAction&&this.touchAction.update(),bt.inputTarget&&(this.input.destroy(),this.input.target=bt.inputTarget,this.input.init()),this},stop:function(bt){this.session.stopped=bt?on:Bi},recognize:function(bt){var It=this.session;if(!It.stopped){this.touchAction.preventDefaults(bt);var jt,xe=this.recognizers,ar=It.curRecognizer;(!ar||ar&&ar.state&xi)&&(ar=It.curRecognizer=null);for(var Cr=0;Cr<xe.length;)jt=xe[Cr],It.stopped!==on&&(!ar||jt==ar||jt.canRecognizeWith(ar))?jt.recognize(bt):jt.reset(),!ar&&jt.state&(Gn|Qn|di)&&(ar=It.curRecognizer=jt),Cr++}},get:function(bt){if(bt instanceof Po)return bt;for(var It=this.recognizers,jt=0;jt<It.length;jt++)if(It[jt].options.event==bt)return It[jt];return null},add:function(bt){if(C(bt,"add",this))return this;var It=this.get(bt.options.event);return It&&this.remove(It),this.recognizers.push(bt),bt.manager=this,this.touchAction.update(),bt},remove:function(bt){if(C(bt,"remove",this))return this;if(bt=this.get(bt),bt){var It=this.recognizers,jt=st(It,bt);jt!==-1&&(It.splice(jt,1),this.touchAction.update())}return this},on:function(bt,It){if(bt!==i&&It!==i){var jt=this.handlers;return b(Ct(bt),function(xe){jt[xe]=jt[xe]||[],jt[xe].push(It)}),this}},off:function(bt,It){if(bt!==i){var jt=this.handlers;return b(Ct(bt),function(xe){It?jt[xe]&&jt[xe].splice(st(jt[xe],It),1):delete jt[xe]}),this}},emit:function(bt,It){this.options.domEvents&&Tl(bt,It);var jt=this.handlers[bt]&&this.handlers[bt].slice();if(!(!jt||!jt.length)){It.type=bt,It.preventDefault=function(){It.srcEvent.preventDefault()};for(var xe=0;xe<jt.length;)jt[xe](It),xe++}},destroy:function(){this.element&&cn(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function cn(bt,It){var jt=bt.element;if(jt.style){var xe;b(bt.options.cssProps,function(ar,Cr){xe=yt(jt.style,Cr),It?(bt.oldCssProps[xe]=jt.style[xe],jt.style[xe]=ar):jt.style[xe]=bt.oldCssProps[xe]||""}),It||(bt.oldCssProps={})}}function Tl(bt,It){var jt=e.createEvent("Event");jt.initEvent(bt,!0,!0),jt.gesture=It,It.target.dispatchEvent(jt)}F(Ns,{INPUT_START:Xt,INPUT_MOVE:ye,INPUT_END:de,INPUT_CANCEL:qe,STATE_POSSIBLE:qn,STATE_BEGAN:Gn,STATE_CHANGED:Qn,STATE_ENDED:di,STATE_RECOGNIZED:xi,STATE_CANCELLED:mi,STATE_FAILED:Ds,DIRECTION_NONE:Ve,DIRECTION_LEFT:Je,DIRECTION_RIGHT:or,DIRECTION_UP:mr,DIRECTION_DOWN:Me,DIRECTION_HORIZONTAL:Qt,DIRECTION_VERTICAL:Ur,DIRECTION_ALL:Ir,Manager:ks,Input:er,TouchAction:Er,TouchInput:Mr,MouseInput:pt,PointerEventInput:te,TouchMouseInput:Fr,SingleTouchInput:Yt,Recognizer:Po,AttrRecognizer:Nn,Tap:Vi,Pan:nl,Swipe:sc,Pinch:Fo,Rotate:fa,Press:il,on:Y,off:it,each:b,merge:k,extend:U,assign:F,inherit:z,bindFn:K,prefixed:yt});var Ku=typeof t<"u"?t:typeof self<"u"?self:{};Ku.Hammer=Ns,r.exports?r.exports=Ns:t[n]=Ns})(window,document,"Hammer")})(i3);var yg=i3.exports;const Fu=Fp({__proto__:null,default:Km(yg)},[yg]),s3=1,o3=2,Bb=4,XW={mousedown:s3,mousemove:o3,mouseup:Bb};function ZW(r,t){for(let e=0;e<r.length;e++)if(t(r[e]))return!0;return!1}function YW(r){const t=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(ZW(i,s=>s.pointerId===n.pointerId)||i.push(n)),t.call(this,n)}}function JW(r){r.prototype.handler=function(e){let n=XW[e.type];n&s3&&e.button>=0&&(this.pressed=!0),n&o3&&e.buttons===0&&(n=Bb),this.pressed&&(n&Bb&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}YW(yg.PointerEventInput),JW(yg.MouseInput);const t$=yg.Manager;class Q0{constructor(t,e,n){this.element=t,this.callback=e,this.options={enable:!0,...n}}}const e$=Fu?[[Fu.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Fu.Rotate,{enable:!1}],[Fu.Pinch,{enable:!1}],[Fu.Swipe,{enable:!1}],[Fu.Pan,{threshold:0,enable:!1}],[Fu.Press,{enable:!1}],[Fu.Tap,{event:"doubletap",taps:2,enable:!1}],[Fu.Tap,{event:"anytap",enable:!1}],[Fu.Tap,{enable:!1}]]:null,a3={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},r$={doubletap:["tap"]},n$={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Cb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},i$={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},l3={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},s$=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wf=typeof window<"u"?window:global;let Eb=!1;try{const r={get passive(){return Eb=!0,!0}};wf.addEventListener("test",null,r),wf.removeEventListener("test",null)}catch{Eb=!1}const o$=s$.indexOf("firefox")!==-1,{WHEEL_EVENTS:a$}=Cb,c3="wheel",u3=4.000244140625,l$=40,c$=.25;class u$ extends Q0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;wf.WheelEvent&&(o$&&i.deltaMode===wf.WheelEvent.DOM_DELTA_PIXEL&&(s/=wf.devicePixelRatio),i.deltaMode===wf.WheelEvent.DOM_DELTA_LINE&&(s*=l$)),s!==0&&s%u3===0&&(s=Math.floor(s/u3)),i.shiftKey&&s&&(s=s*c$),this.callback({type:c3,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(a$),this.events.forEach(i=>t.addEventListener(i,this.handleEvent,Eb?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===c3&&(this.options.enable=e)}}const{MOUSE_EVENTS:h$}=Cb,h3="pointermove",A3="pointerover",d3="pointerout",f3="pointerenter",p3="pointerleave";class A$ extends Q0{constructor(t,e,n){super(t,e,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(h$),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===h3&&(this.enableMoveEvent=e),t===A3&&(this.enableOverEvent=e),t===d3&&(this.enableOutEvent=e),t===f3&&(this.enableEnterEvent=e),t===p3&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(A3,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(d3,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(f3,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(p3,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit(h3,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:d$}=Cb,g3="keydown",m3="keyup";class f$ extends Q0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:g3,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:m3,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(d$),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===g3&&(this.enableDownEvent=e),t===m3&&(this.enableUpEvent=e)}}const y3="contextmenu";class p$ extends Q0{constructor(t,e,n){super(t,e,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:y3,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===y3&&(this.options.enable=e)}}const _3=1,Tb=2,v3=4,g$={pointerdown:_3,pointermove:Tb,pointerup:v3,mousedown:_3,mousemove:Tb,mouseup:v3},m$=0,y$=1,_$=2,v$=1,b$=2,w$=4;function x$(r){const t=g$[r.srcEvent.type];if(!t)return null;const{buttons:e,button:n}=r.srcEvent;let i=!1,s=!1,a=!1;return t===Tb?(i=!!(e&v$),s=!!(e&w$),a=!!(e&b$)):(i=n===m$,s=n===y$,a=n===_$),{leftButton:i,middleButton:s,rightButton:a}}function B$(r,t){const e=r.center;if(!e)return null;const n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,a={x:(e.x-n.left-t.clientLeft)/i,y:(e.y-n.top-t.clientTop)/s};return{center:e,offsetCenter:a}}const Sb={srcElement:"root",priority:0};class C${constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this;let d=Sb;typeof n=="string"||n&&n.addEventListener?d={...Sb,srcElement:n}:n&&(d={...Sb,...n});let f=o.get(d.srcElement);f||(f=[],o.set(d.srcElement,f));const m={type:t,handler:e,srcElement:d.srcElement,priority:d.priority};i&&(m.once=!0),s&&(m.passive=!0),a.push(m),this._active=this._active||!m.passive;let v=f.length-1;for(;v>=0&&!(f[v].priority>=m.priority);)v--;f.splice(v+1,0,m)}remove(t,e){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===t&&a.handler===e){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,e){const n=this.handlersByElement.get(e);if(n){let i=!1;const s=()=>{t.handled=!0},a=()=>{t.handled=!0,i=!0},o=[];for(let d=0;d<n.length;d++){const{type:f,handler:m,once:v}=n[d];if(m({...t,type:f,stopPropagation:s,stopImmediatePropagation:a}),v&&o.push(n[d]),i)break}for(let d=0;d<o.length;d++){const{type:f,handler:m}=o[d];this.remove(f,m)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...x$(t),...B$(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const E$={events:null,recognizers:null,recognizerOptions:{},Manager:t$,touchAction:"none",tabIndex:0};class T${constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=i=>{const{srcEvent:s}=i,a=n$[s.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...E$,...e},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,n=e.Manager;this.manager=new n(t,{touchAction:e.touchAction,recognizers:e.recognizers||e$}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(a3).forEach(i=>{const s=this.manager.get(i);s&&a3[i].forEach(a=>{s.recognizeWith(a)})});for(const i in e.recognizerOptions){const s=this.manager.get(i);if(s){const a=e.recognizerOptions[i];delete a.enable,s.set(a)}}this.wheelInput=new u$(t,this._onOtherEvent,{enable:!1}),this.moveInput=new A$(t,this._onOtherEvent,{enable:!1}),this.keyInput=new f$(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new p$(t,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,n){this._addEventHandler(t,e,n,!1)}once(t,e,n){this._addEventHandler(t,e,n,!0)}watch(t,e,n){this._addEventHandler(t,e,n,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:n}=this;if(!n)return;const i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});const s=r$[t];s&&!this.options.recognizers&&s.forEach(a=>{const o=n.get(a);e?(o.requireFailure(t),i.dropRequireFailure(a)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,n,i,s){if(typeof t!="string"){n=e;for(const m in t)this._addEventHandler(m,t[m],n,i,s);return}const{manager:a,events:o}=this,d=l3[t]||t;let f=o.get(d);f||(f=new C$(this),o.set(d,f),f.recognizerName=i$[d]||d,a&&a.on(d,f.handleEvent)),f.add(t,e,n,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const a in t)this._removeEventHandler(a,t[a]);return}const{events:n}=this,i=l3[t]||t,s=n.get(i);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:a}=s;let o=!1;for(const d of n.values())if(d.recognizerName===a&&!d.isEmpty()){o=!0;break}o||this._toggleRecognizer(a,!1)}}}function hd(){}const b3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:hd,onResize:hd,onViewStateChange:hd,onInteractionStateChange:hd,onBeforeRender:hd,onAfterRender:hd,onLoad:hd,onError:r=>$n.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:t}=r;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class Ib{constructor(t){$(this,"props",void 0),$(this,"width",0),$(this,"height",0),$(this,"userData",{}),$(this,"canvas",null),$(this,"viewManager",null),$(this,"layerManager",null),$(this,"effectManager",null),$(this,"deckRenderer",null),$(this,"deckPicker",null),$(this,"eventManager",null),$(this,"tooltip",null),$(this,"metrics",void 0),$(this,"animationLoop",void 0),$(this,"stats",void 0),$(this,"viewState",void 0),$(this,"cursorState",void 0),$(this,"_needsRedraw",void 0),$(this,"_pickRequest",void 0),$(this,"_lastPointerDownInfo",null),$(this,"_metricsCounter",void 0),$(this,"_onPointerMove",e=>{const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e}),$(this,"_onEvent",e=>{const n=kS[e.type],i=e.offsetCenter;if(!n||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=a,d=o&&(o[n.handler]||o.props[n.handler]),f=this.props[n.handler];let m=!1;d&&(m=d.call(o,a,e)),!m&&f&&f(a,e)}),$(this,"_onPointerDown",e=>{const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...b3,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&$n.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),fS()==="IE"&&$n.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new zp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&fg.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,n,i,s,a,o,d;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(d=this.tooltip)===null||d===void 0||d.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&$n.removed("onLayerHover","onHover")(),"onLayerClick"in t&&$n.removed("onLayerClick","onClick")(),t.initialViewState&&!Mu(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||i||s||a,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Ho(this.viewManager),this.viewManager.views}getViewports(t){return Ho(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,n){Ho(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(e).timeEnd(),s}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Ho(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:n}=t;if(e||e===0){const s=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=s}if(n||n===0){var i;const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.position=((i=t.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,e;const{canvas:n}=this;if(!n)return;const i=(t=n.clientWidth)!==null&&t!==void 0?t:n.width,s=(e=n.clientHeight)!==null&&e!==void 0?e:n.height;if(i!==this.width||s!==this.height){var a,o;this.width=i,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:s}),(o=this.layerManager)===null||o===void 0||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:s,debug:a,onError:o,onBeforeRender:d,onAfterRender:f,useDevicePixels:m}=t;return new hG({width:e,height:n,useDevicePixels:m,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:v=>e5({...s,...v,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:v=>this._setGLContext(v.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:d,onAfterRender:f,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new xb({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=n.length>0;let s=i,a=!1;for(const o of n){var e;s=o,a=((e=o.layer)===null||e===void 0?void 0:e.onHover(o,t.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,wv(t,{enable:!0,copyState:!0})),this.tooltip=new $W(this.canvas),gh(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new SI;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new T$(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in kS)this.eventManager.on(i,this._onEvent);this.viewManager=new bW({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new vW(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new NW,this.deckRenderer=new zW(t),this.deckPicker=new KW(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;gh(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$n.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=id.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}$(Ib,"defaultProps",b3),$(Ib,"VERSION",m7);class Pb{constructor(t,e){$(this,"opts",void 0),$(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let s=n;if(n&&n.length!==i){s=new Float32Array(i);const a=e.elementOffset||0;for(let o=0;o<i;++o)s[o]=n[a+o]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function S$(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function z0(r){return r.stride||r.size*r.bytesPerElement}function w3(r,t){t.offset&&$n.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=z0(r),n=t.vertexOffset!==void 0?t.vertexOffset:r.vertexOffset||0,i=t.elementOffset||0,s=n*e+i*r.bytesPerElement+(r.offset||0);return{...t,offset:s,stride:e}}function I$(r,t){const e=w3(r,t);return{high:e,low:{...e,offset:e.offset+r.size*4}}}class P${constructor(t,e,n){$(this,"gl",void 0),$(this,"id",void 0),$(this,"size",void 0),$(this,"settings",void 0),$(this,"value",void 0),$(this,"doublePrecision",void 0),$(this,"_buffer",void 0),$(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const i=e.logicalType||e.type,s=i===5130;let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o=5126:!i&&e.isIndexed?o=t&&Pv(t,Qi.ELEMENT_INDEX_UINT32)?5125:5123:o=i||5126;let d=S$(i||o||5126);this.doublePrecision=s,s&&e.fp64===!1&&(d=Float32Array),this.value=null,this.settings={...e,defaultType:d,defaultValue:a,logicalType:i,type:o,size:this.size,bytesPerElement:d.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new Si(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*z0(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),fg.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,s=I$(this.getAccessor(),e||{});return n[t]=new Pb(this,s.high),n["".concat(t,"64Low")]=i?new Pb(this,s.low):new Float32Array(this.size),n}if(e){const n=w3(this.getAccessor(),e);return{[t]:new Pb(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,s=n*i;if(e&&s&&e.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let d=0;d<s;)for(let f=0;f<i;f++){const m=e[d++];m<a[f]&&(a[f]=m),m>o[f]&&(o[f]=m)}t=[a,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof Si?n={buffer:t}:n=t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=s}else if(n.buffer){const s=n.buffer;e.externalBuffer=s,e.constant=!1,this.value=n.value||null;const a=n.value instanceof Float64Array;i.type=n.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=z0(i)}else if(n.value){this._checkExternalBuffer(n);let s=n.value;e.externalBuffer=null,e.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=z0(i);const{buffer:a,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=mb(s,i));const d=s.byteLength+o+i.stride*2;a.byteLength<d&&a.reallocate(d),a.setAccessor(null),a.subData({data:s,offset:o}),i.type=n.type||a.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?mb(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:n}=this,i=n.allocatedValue,s=fg.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{buffer:a,byteOffset:o}=this;return a.byteLength<s.byteLength+o&&(a.reallocate(s.byteLength+o),e&&i&&a.subData({data:i instanceof Float64Array?mb(i,this):i,offset:o})),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof n)&&this.settings.normalized&&!("normalized"in t)&&$n.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let a=s;for(;--a>=0;)e[n+a]=i[a];return e}switch(s){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let a=s;for(;--a>=0;)e[n+a]=Number.isFinite(t[a])?t[a]:i[a]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}const x3=[],B3=[];function C3(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=x3;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(B3.length=r.length,n=B3):n=x3,(t>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,e),i.index=t-1),{iterable:n,objectInfo:i}}function E3(r){return r&&r[Symbol.asyncIterator]}function M$(r,t){const{size:e,stride:n,offset:i,startIndices:s,nested:a}=t,o=r.BYTES_PER_ELEMENT,d=n?n/o:e,f=i?i/o:0,m=Math.floor((r.length-f)/d);return(v,C)=>{let{index:b,target:P}=C;if(!s){const z=b*d+f;for(let K=0;K<e;K++)P[K]=r[z+K];return P}const F=s[b],U=s[b+1]||m;let k;if(a){k=new Array(U-F);for(let z=F;z<U;z++){const K=z*d+f;P=new Array(e);for(let G=0;G<e;G++)P[G]=r[K+G];k[z-F]=P}}else if(d===e)k=r.subarray(F*e+f,U*e+f);else{k=new r.constructor((U-F)*e);let z=0;for(let K=F;K<U;K++){const G=K*d+f;for(let X=0;X<e;X++)k[z++]=r[G+X]}}return k}}const F$=[],H0=[[0,1/0]];function L$(r,t){if(r===H0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return r;const e=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<t[0]?(e.push(a),i=s+1):a[0]>t[1]?e.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return e.splice(i,0,t),e}function Mb(r){const{source:t,target:e,start:n=0,size:i,getData:s}=r,a=r.end||e.length,o=t.length,d=a-n;if(o>d){e.set(t.subarray(0,d),n);return}if(e.set(t,n),!s)return;let f=o;for(;f<d;){const m=s(f,t);for(let v=0;v<i;v++)e[n+f]=m[v]||0,f++}}function R$(r){let{source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:a}=r;if(!Array.isArray(a))return Mb({source:t,target:e,size:n,getData:i}),e;let o=0,d=0;const f=i&&((v,C)=>i(v+d,C)),m=Math.min(s.length,a.length);for(let v=1;v<m;v++){const C=s[v]*n,b=a[v]*n;Mb({source:t.subarray(o,C),target:e,start:d,end:b,size:n,getData:f}),o=C,d=b}return d<e.length&&Mb({source:[],target:e,start:d,size:n,getData:f}),e}const O$={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function T3(r,t){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const e=r.type||"interpolation";return{...O$[e],...t,...r,type:e}}function S3(r,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function I3(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function P3(r){r.push(r.shift())}function Fb(r,t){const{doublePrecision:e,settings:n,value:i,size:s}=r,a=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:t*s)*a}function M3(r){let{buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:a=z=>z}=r;const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,d=n.size*o,f=n.byteOffset,m=n.startIndices,v=s&&m,C=Fb(n,e),b=n.isConstant;if(!v&&i>=C)return;const P=b?n.value:n.getBuffer().getData({srcByteOffset:f});if(n.settings.normalized&&!b){const z=a;a=(K,G)=>n.normalizeConstant(z(K,G))}const F=b?(z,K)=>a(P,K):(z,K)=>a(P.subarray(z,z+d),K),U=t.getData({length:i}),k=new Float32Array(C);R$({source:U,target:k,sourceStartIndices:s,targetStartIndices:m,size:d,getData:F}),t.byteLength<k.byteLength+f&&t.reallocate(k.byteLength+f),t.subData({data:k,offset:f})}class Lb extends P${constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:H0}),$(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return T3(i,n)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:n=0,endRow:i=1/0}=e;this.state.updateRanges=L$(this.state.updateRanges,[n,i])}else this.state.updateRanges=H0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=F$}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,e.updateRanges!==H0),!0):!1}updateBuffer(t){let{numInstances:e,data:n,props:i,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:d}}=this;let f=!0;if(o){for(const[m,v]of a)o.call(s,this,{data:n,startRow:m,endRow:v,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[m,v]of a){const C=Number.isFinite(m)?this.getVertexOffset(m):0,b=Number.isFinite(v)?this.getVertexOffset(v):d||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:b})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const a=t;Ho(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=M$(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:s,props:a,numInstances:o}=e;if(t.constant)return;const{settings:d,state:f,value:m,size:v,startIndices:C}=t,{accessor:b,transform:P}=d,F=f.binaryAccessor||(typeof b=="function"?b:a[b]);Ho(typeof F=="function",'accessor "'.concat(b,'" is not a function'));let U=t.getVertexOffset(i);const{iterable:k,objectInfo:z}=C3(n,i,s);for(const K of k){z.index++;let G=F(K,z);if(P&&(G=P.call(this,G)),C){const X=(z.index<C.length-1?C[z.index+1]:o)-C[z.index];if(G&&Array.isArray(G[0])){let Y=U;for(const it of G)t._normalizeValue(it,m,Y),Y+=v}else G&&G.length>v?m.set(G,U):(t._normalizeValue(G,z.target,0),AW({target:m,source:z.target,start:U,count:X}));U+=X*v}else t._normalizeValue(G,m,U),U+=v}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class U${constructor(t){let{gl:e,attribute:n,timeline:i}=t;$(this,"gl",void 0),$(this,"type","interpolation"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.transition=new mg(i),this.attribute=n,this.attributeInTransition=new Lb(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=N$(e,n);const s={byteLength:0,usage:35050};this.buffers=[new Si(e,s),new Si(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:n,buffers:i,attribute:s}=this;P3(i);const a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)M3({buffer:o,...a});this.currentStartIndices=s.startIndices,this.currentLength=Fb(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:S3(n,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let s=i/e;n&&(s=n(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const D$=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function N$(r,t){const e=I3(t.size);return new ab(r,{vs:D$,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class k${constructor(t){let{gl:e,attribute:n,timeline:i}=t;$(this,"gl",void 0),$(this,"type","spring"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"texture",void 0),$(this,"framebuffer",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new mg(i),this.attribute=n,this.attributeInTransition=new Lb(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=z$(e),this.framebuffer=H$(e,this.texture),this.transform=Q$(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new Si(e,s),new Si(e,s),new Si(e,s)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:s}=this,a={numInstances:e,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of i)M3({buffer:o,...a});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=Fb(s,e),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:S3(n,s)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const a=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),P3(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),A0(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function Q$(r,t,e){const n=I3(t.size);return new ab(r,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function z$(r){return new gl(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function H$(r,t){return new co(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const V$={interpolation:U$,spring:k$};class G${constructor(t,e){let{id:n,timeline:i}=e;$(this,"id",void 0),$(this,"isSupported",void 0),$(this,"gl",void 0),$(this,"timeline",void 0),$(this,"transitions",void 0),$(this,"needsRedraw",void 0),$(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ab.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const s in e){const a=e[s],o=a.getTransitionSetting(n);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let s=!i||i.type!==n.type;if(s){if(!this.isSupported){$n.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}i&&this._removeTransition(t);const a=V$[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):($n.error("unsupported transition type '".concat(n.type,"'"))(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const F3="attributeManager.invalidate",j$="attributeManager.updateStart",q$="attributeManager.updateEnd",K$="attribute.updateStart",W$="attribute.allocate",$$="attribute.updateEnd";class X${constructor(t){let{id:e="attribute-manager",stats:n,timeline:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"id",void 0),$(this,"gl",void 0),$(this,"attributes",void 0),$(this,"updateTriggers",void 0),$(this,"needsRedraw",void 0),$(this,"userData",void 0),$(this,"stats",void 0),$(this,"attributeTransitionManager",void 0),$(this,"mergeBoundsMemoized",Ag(nW)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new G$(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);ra(F3,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);ra(F3,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:s,props:a={},buffers:o={},context:d={}}=t,f=!1;ra(j$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const m in this.attributes){const v=this.attributes[m],C=v.settings.accessor;v.startIndices=i,v.numInstances=n,a[m]&&$n.removed("props.".concat(m),"data.attributes.".concat(m))(),v.setExternalBuffer(o[m])||v.setBinaryValue(typeof C=="string"?o[C]:void 0,e.startIndices)||typeof C=="string"&&!o[C]&&v.setConstantValue(a[C])||v.needsUpdate()&&(f=!0,this._updateAttribute({attribute:v,numInstances:n,data:e,props:a,context:d})),this.needsRedraw=this.needsRedraw||v.needsRedraw()}f&&ra(q$,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(n=>{var i;return(i=this.attributes[n])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in e){const a=e[s];a.needsRedraw(t)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:n.instanced?1:e.divisor||0};return new Lb(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,s=i[t];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if(ra(K$,e),e.constant){e.setConstantValue(e.value);return}e.allocate(n)&&ra(W$,e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,ra($$,e,n))}}class Z$ extends mg{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:s}}=this,a=s(t/i);this._value=w0(e,n,a)}}const L3=1e-5;function R3(r,t,e,n,i){const s=t-r,o=(e-t)*i,d=-s*n;return o+d+s+t}function Y$(r,t,e,n,i){if(Array.isArray(e)){const s=[];for(let a=0;a<e.length;a++)s[a]=R3(r[a],t[a],e[a],n,i);return s}return R3(r,t,e,n,i)}function O3(r,t){if(Array.isArray(r)){let e=0;for(let n=0;n<r.length;n++){const i=r[n]-t[n];e+=i*i}return Math.sqrt(e)}return Math.abs(r-t)}class J$ extends mg{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:s=t,_currValue:a=t}=this;let o=Y$(s,a,e,n,i);const d=O3(o,e),f=O3(o,a);d<L3&&f<L3&&(o=e,this.end()),this._prevValue=a,this._currValue=o}}const tX={interpolation:Z$,spring:J$};class eX{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:s}=this;if(s.has(t)){const d=s.get(t),{value:f=d.settings.fromValue}=d;e=f,this.remove(t)}if(i=T3(i),!i)return;const a=tX[i.type];if(!a){$n.error("unsupported transition type '".concat(i.type,"'"))();return}const o=new a(this.timeline);o.start({...i,fromValue:e,toValue:n}),s.set(t,o)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function rX(r){const t=r[AA];for(const e in t){const n=t[e],{validate:i}=n;if(i&&!i(r[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(r[e]))}}function nX(r,t){const e=U3({newProps:r,oldProps:t,propTypes:r[AA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=sX(r,t);let i=!1;return n||(i=oX(r,t)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:aX(r,t),transitionsChanged:iX(r,t)}}function iX(r,t){if(!r.transitions)return!1;const e={},n=r[AA];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&Rb(r[s],t[s],a)&&(e[s]=!0,i=!0)}return i?e:!1}function U3(r){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}=r;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(s,".").concat(a," added");const o=Rb(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(s,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const o=Rb(t[a],e[a],i[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}}return!1}function Rb(r,t,e){let n=e&&e.equal;return n&&!n(r,t,e)||!n&&(n=r&&t&&r.equals,n&&!n.call(r,t))?"changed deeply":!n&&t!==r?"changed shallowly":null}function sX(r,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,t.data)||(e="Data comparator detected a change"):r.data!==t.data&&(e="A new data container was supplied"),e&&i&&(e=i(r.data,t.data)||e),e}function oX(r,t){if(t===null)return{all:!0};if("all"in r.updateTriggers&&D3(r,t,"all"))return{all:!0};const e={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&D3(r,t,i)&&(e[i]=!0,n=!0);return n?e:!1}function aX(r,t){if(t===null)return!0;const e=t.extensions,{extensions:n}=r;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function D3(r,t,e){let n=r.updateTriggers[e];n=n??{};let i=t.updateTriggers[e];return i=i??{},U3({oldProps:i,newProps:n,triggerName:e})}const lX="count(): argument not an object",cX="count(): argument not a container";function uX(r){if(!AX(r))throw new Error(lX);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(hX(r))return Object.keys(r).length;throw new Error(cX)}function hX(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function AX(r){return r!==null&&typeof r=="object"}function dX(r,t){if(!t)return r;const e={...r,...t};if("defines"in t&&(e.defines={...r.defines,...t.defines}),"modules"in t&&(e.modules=(r.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=e.modules.findIndex(i=>i.name==="project32");n>=0&&e.modules.splice(n,1)}if("inject"in t)if(!r.inject)e.inject=t.inject;else{const n={...r.inject};for(const i in t.inject)n[i]=(n[i]||"")+t.inject[i];e.inject=n}return e}const fX={10241:9987,10240:9729,10242:33071,10243:33071},Ob={};function pX(r,t,e,n){if(e instanceof gl)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const s=new gl(t,{...e,parameters:{...fX,...i,...n}});return Ob[s.id]=r,s}function gX(r,t){!t||!(t instanceof gl)||Ob[t.id]===r&&(t.delete(),delete Ob[t.id])}const mX={boolean:{validate(r,t){return!0},equal(r,t,e){return!!r==!!t}},number:{validate(r,t){return Number.isFinite(r)&&(!("max"in t)||r<=t.max)&&(!("min"in t)||r>=t.min)}},color:{validate(r,t){return t.optional&&!r||Ub(r)&&(r.length===3||r.length===4)},equal(r,t,e){return Mu(r,t,1)}},accessor:{validate(r,t){const e=V0(r);return e==="function"||e===V0(t.value)},equal(r,t,e){return typeof t=="function"?!0:Mu(r,t,1)}},array:{validate(r,t){return t.optional&&!r||Ub(r)},equal(r,t,e){const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Mu(r,t,i):r===t}},object:{equal(r,t,e){if(e.ignore)return!0;const{compare:n}=e,i=Number.isInteger(n)?n:n?1:0;return n?Mu(r,t,i):r===t}},function:{validate(r,t){return t.optional&&!r||typeof r=="function"},equal(r,t,e){return!e.compare&&e.ignore!==!1||r===t}},data:{transform:(r,t,e)=>{const{dataTransform:n}=e.props;return n&&r?n(r):r}},image:{transform:(r,t,e)=>{const n=e.context;return!n||!n.gl?null:pX(e.id,n.gl,r,{...t.parameters,...e.props.textureParameters})},release:(r,t,e)=>{gX(e.id,r)}}};function yX(r){const t={},e={},n={};for(const[i,s]of Object.entries(r)){const a=s==null?void 0:s.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=_X(i,s);t[i]=o,e[i]=o.value}}return{propTypes:t,defaultProps:e,deprecatedProps:n}}function _X(r,t){switch(V0(t)){case"object":return _g(r,t);case"array":return _g(r,{type:"array",value:t,compare:!1});case"boolean":return _g(r,{type:"boolean",value:t});case"number":return _g(r,{type:"number",value:t});case"function":return _g(r,{type:"function",value:t,compare:!0});default:return{name:r,type:"unknown",value:t}}}function _g(r,t){return"type"in t?{name:r,...mX[t.type],...t}:"value"in t?{name:r,type:V0(t.value),...t}:{name:r,type:"object",value:t}}function Ub(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function V0(r){return Ub(r)?"array":r===null?"null":typeof r}function vX(r,t){let e;for(let s=t.length-1;s>=0;s--){const a=t[s];"extensions"in a&&(e=a.extensions)}const n=Db(r.constructor,e),i=Object.create(n);i[D0]=r,i[cd]={},i[dA]={};for(let s=0;s<t.length;++s){const a=t[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const bX="_mergedDefaultProps";function Db(r,t){let e=bX;if(t)for(const i of t){const s=i.constructor;s&&(e+=":".concat(s.extensionName||s.name))}const n=N3(r,e);return n||(r[e]=wX(r,t||[]))}function wX(r,t){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=Db(n),s=N3(r,"defaultProps")||{},a=yX(s),o=Object.assign(Object.create(null),i,a.defaultProps),d=Object.assign(Object.create(null),i==null?void 0:i[AA],a.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[_b],a.deprecatedProps);for(const m of t){const v=Db(m.constructor);v&&(Object.assign(o,v),Object.assign(d,v[AA]),Object.assign(f,v[_b]))}return xX(o,r),CX(o,d),BX(o,f),o[AA]=d,o[_b]=f,t.length===0&&!Nb(r,"_propTypes")&&(r._propTypes=d),o}function xX(r,t){const e=TX(t);Object.defineProperties(r,{id:{writable:!0,value:e}})}function BX(r,t){for(const e in t)Object.defineProperty(r,e,{enumerable:!1,set(n){const i="".concat(this.id,": ").concat(e);for(const s of t[e])Nb(this,s)||(this[s]=n);$n.deprecated(i,t[e].join("/"))()}})}function CX(r,t){const e={},n={};for(const i in t){const s=t[i],{name:a,value:o}=s;s.async&&(e[a]=o,n[a]=EX(a))}r[vf]=e,r[cd]={},Object.defineProperties(r,n)}function EX(r){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||E3(t)?this[cd][r]=t:this[dA][r]=t},get(){if(this[dA]){if(r in this[dA])return this[dA][r]||this[vf][r];if(r in this[cd]){const t=this[D0]&&this[D0].internalState;if(t&&t.hasAsyncProp(r))return t.getAsyncProp(r)||this[vf][r]}}return this[vf][r]}}}function Nb(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function N3(r,t){return Nb(r,t)&&r[t]}function TX(r){const t=r.componentName;return t||$n.warn("".concat(r.name,".componentName not specified"))(),t||r.name}let SX=0;class kb{constructor(){$(this,"id",void 0),$(this,"props",void 0),$(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=vX(this,e),this.id=this.props.id,this.count=SX++}clone(t){const{props:e}=this,n={};for(const i in e[vf])i in e[dA]?n[i]=e[dA][i]:i in e[cd]&&(n[i]=e[cd][i]);return new this.constructor({...e,...n,...t})}}$(kb,"componentName","Component"),$(kb,"defaultProps",{});const IX=Object.freeze({});class PX{constructor(t){$(this,"component",void 0),$(this,"onAsyncPropUpdated",void 0),$(this,"asyncProps",void 0),$(this,"oldProps",void 0),$(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||IX}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[D0]||this.component;const e=t[dA]||{},n=t[cd]||t,i=t[vf]||{};for(const s in e){const a=e[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),e[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(E3(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e===n.resolvedValue||e===n.lastValue?!1:(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,i),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of e){if(!this.component)return;const{dataTransform:d}=this.component.props;d?s=d(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(t,s,i)}this._onResolve(t,s)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const i=this.component&&this.component.props[AA];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class MX extends PX{constructor(t){let{attributeManager:e,layer:n}=t;super(n),$(this,"attributeManager",void 0),$(this,"needsRedraw",void 0),$(this,"needsUpdate",void 0),$(this,"subLayers",void 0),$(this,"usesPickingColorCache",void 0),$(this,"hasPickingBuffer",void 0),$(this,"changeFlags",void 0),$(this,"viewport",void 0),$(this,"uniformTransitions",void 0),$(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;t==="data"&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const FX="layer.changeFlag",LX="layer.initialize",RX="layer.update",OX="layer.finalize",UX="layer.matched",k3=2**24-1,DX=Object.freeze([]),NX=Ag(r=>{let{oldViewport:t,viewport:e}=r;return t.equals(e)});let Lu=new Uint8ClampedArray(0);const kX={data:{type:"data",value:DX,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,t)=>{let{propName:e,layer:n,loaders:i,loadOptions:s,signal:a}=t;const{resourceManager:o}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,a){var d;s={...s,fetch:{...(d=s)===null||d===void 0?void 0:d.fetch,signal:a}}}let f=o.contains(r);return!f&&!s&&(o.add({resourceId:r,data:oA(r,i),persistent:!1}),f=!0),f?o.subscribe({resourceId:r,onChange:m=>{var v;return(v=n.internalState)===null||v===void 0?void 0:v.reloadAsyncProp(e,m)},consumerId:n.id,requestId:e}):oA(r,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:jn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:t}=r;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class xf extends kb{constructor(){super(...arguments),$(this,"internalState",null),$(this,"lifecycle",_f.NO_STATE),$(this,"context",void 0),$(this,"state",void 0),$(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Ho(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=$I(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=zI(n,e.pixelProjectionMatrix);return t.length===2?[i,s]:[i,s,a]}unproject(t){return Ho(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Ho(this.internalState);const n=this.internalState.viewport||this.context.viewport;return cW(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===jn.DEFAULT||t===jn.LNGLAT||t===jn.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Ho(t instanceof Uint8Array);const[e,n,i]=t;return e+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:uX(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=dX(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const i of n)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:i}=t,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:d}=e.attributes,f=o||d;f&&(a&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(t,e){var n,i;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((n=(i=this.props).onError)!==null&&n!==void 0&&n.call(i,t))){var s,a;(s=this.context)===null||s===void 0||(a=s.onError)===null||a===void 0||a.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!NX({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const i in e)Object.defineProperty(n,i,{value:e[i]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(Lu.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>k3&&$n.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Lu=fg.allocate(Lu,n,{size:3,copy:!0,maxCount:Math.max(n,k3)});const s=Math.floor(Lu.length/3),a=[];for(let o=i;o<s;o++)this.encodePickingColor(o,a),Lu[o*3+0]=a[0],Lu[o*3+1]=a[1],Lu[o*3+2]=a[2]}t.value=Lu.subarray(0,n*3)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},s=n.getShaderAttributes(e,i);t.setAttributes(s)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&e.attributes&&e.attributes[s.id];if(a&&a.value){const o=a.value,d=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const m=s.getVertexOffset(f);o[m]===d[0]&&o[m+1]===d[1]&&o[m+2]===d[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const s=i.getVertexOffset(t),a=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Lu.buffer&&(n.value=Lu.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ho(!this.internalState),Ho(Number.isFinite(this.props.coordinateSystem)),ra(LX,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new MX({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($n.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new eX(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){ra(UX,this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(ra(RX,this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),d=this.getModels();if(n.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const m of this.props.extensions)m.updateState.call(this,o,m);const f=this.getModels()[0]!==d[0];this._postUpdate(o,f)}finally{n.viewport=s,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ra(OX,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:d}=this.props,f=d&&d(n)||[0,0];gh(a.gl,{polygonOffset:f}),xc(a.gl,i,()=>{const m={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const v of this.props.extensions)v.draw.call(this,m,v);this.draw(m)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let s=!1;switch(i){case"dataChanged":const a=t[i],o=e[i];a&&Array.isArray(o)&&(e.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:e[i]||(e[i]=t[i],s=!0)}s&&ra(FX,this,i,t)}const n=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=nX(t,e);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,e[s],t[s],(i=t.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(n)}validateProps(){rX(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new X$(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:d}=n;if(e||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==d){const f={};a||(f.pickingSelectedColor=null),Array.isArray(d)&&(f.pickingHighlightColor=d),(e||o!==i.highlightedObjectIndex)&&(f.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(f)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(e=e||i,e)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$(xf,"defaultProps",kX),$(xf,"layerName","Layer");const QX="compositeLayer.renderLayers";class Q3 extends xf{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:d,autoHighlight:f,highlightColor:m,coordinateSystem:v,coordinateOrigin:C,wrapLongitude:b,positionFormat:P,modelMatrix:F,extensions:U,fetch:k,operation:z,_subLayerProps:K}=this.props,G={id:"",updateTriggers:{},opacity:n,pickable:i,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:d,autoHighlight:f,highlightColor:m,coordinateSystem:v,coordinateOrigin:C,wrapLongitude:b,positionFormat:P,modelMatrix:F,extensions:U,fetch:k,operation:z},X=K&&t.id&&K[t.id],Y=X&&X.updateTriggers,it=t.id||"sublayer";if(X){const nt=this.props[AA],wt=t.type?t.type._propTypes:{};for(const Ct in X){const st=wt[Ct]||nt[Ct];st&&st.type==="accessor"&&(X[Ct]=this.getSubLayerAccessor(X[Ct]))}}Object.assign(G,t,X),G.id="".concat(this.props.id,"-").concat(it),G.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...Y};for(const nt of U){const wt=nt.getSubLayerProps.call(this,nt);wt&&Object.assign(G,wt,{updateTriggers:Object.assign(G.updateTriggers,wt.updateTriggers)})}return G}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=N0(s,Boolean),this.internalState.subLayers=n}ra(QX,this,i,n);for(const s of n)s.parent=this}}$(Q3,"layerName","CompositeLayer");const Qb=512,zX=Math.PI/180;function HX(r){let{map:t,gl:e,deck:n}=r;if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,s=n==null?void 0:n.props.onLoad,a=GX({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let o;return(!n||n.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:zb(t)}),n!=null&&n.isInitialized?z3(n,t):a.onLoad=()=>{s==null||s(),z3(o,t)}),n?(o=n,n.setProps(a),n.userData.isExternal=!0):(o=new Ib(a),t.on("remove",()=>{VX(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&XX(o,t)}),o}function z3(r,t){const e=()=>{r.isInitialized?ZX(r,t):t.off("move",e)};t.on("move",e)}function VX(r){var t;(t=r.__deck)===null||t===void 0||t.finalize(),r.__deck=null}function GX(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new xb({id:"mapbox"})]}}function jX(r,t){r.userData.mapboxLayers.add(t),Hb(r)}function qX(r,t){r.userData.mapboxLayers.delete(t),Hb(r)}function KX(r,t){Hb(r)}function WX(r,t,e){let{currentViewport:n}=r.userData,i=!1;n||(n=H3(r,t,!0),r.userData.currentViewport=n,i=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{let{layer:a}=s;return e.id===a.id||a.props.operation.includes("terrain")},clearStack:i,clearCanvas:!1})}function zb(r){var t;const{lng:e,lat:n}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:n,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(t=r.getTerrain)!==null&&t!==void 0&&t.call(r)&&$X(r,i),i}function $X(r,t){if(r.getFreeCameraOptions){const{position:e}=r.getFreeCameraOptions();if(!e||e.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=t,o=e.x*Qb,d=(1-e.y)*Qb,f=e.z*Qb,m=dg([i,s]),v=o-m[0],C=d-m[1],b=Math.sqrt(v*v+C*C),P=a*zX,F=1.5*n,U=P<.001?F*Math.cos(P)/f:F*Math.sin(P)/b;t.zoom=Math.log2(U);const k=F*Math.cos(P)/U,z=f-k;t.position=[0,0,z/O0(s)]}else typeof r.transform.elevation=="number"&&(t.position=[0,0,r.transform.elevation])}function H3(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new ld({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...zb(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function XX(r,t){const{mapboxLayers:e,isExternal:n}=r.userData;if(n){const i=Array.from(e,m=>m.id),a=N0(r.props.layers,Boolean).some(m=>m&&!i.includes(m.id));let o=r.getViewports();const d=o.findIndex(m=>m.id==="mapbox"),f=o.length>1||d<0;(a||f)&&(d>=0&&(o=o.slice(),o[d]=H3(r,t,!1)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:m=>(!r.props.layerFilter||r.props.layerFilter(m))&&(m.viewport.id!=="mapbox"||!i.includes(m.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function ZX(r,t){r.setProps({viewState:zb(t)}),r.needsRedraw({clearRedrawFlags:!0})}function Hb(r){if(r.userData.isExternal)return;const t=[];r.userData.mapboxLayers.forEach(e=>{const n=e.props.type,i=new n(e.props);t.push(i)}),r.setProps({layers:t})}class YX{constructor(t){if($(this,"id",void 0),$(this,"type",void 0),$(this,"renderingMode",void 0),$(this,"map",void 0),$(this,"deck",void 0),$(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=HX({map:t,gl:e,deck:this.props.deck}),jX(this.deck,this)}onRemove(){this.deck&&qX(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&KX(this.deck)}render(){WX(this.deck,this.map,this)}}const JX=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tZ=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,V3=[0,0,0,255],G3=[0,0,1],eZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:G3},getColor:{type:"accessor",value:V3},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function rZ(r){const{header:t,attributes:e}=r;!t||!e||(r.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class Vb extends xf{getShaders(){return super.getShaders({vs:JX,fs:tZ,modules:[vb,Fq,bb]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:G3},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:V3}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}e.dataChanged&&rZ(n.data)}draw(t){let{uniforms:e}=t;const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:mv[i],radiusPixels:n}).draw()}_getModel(t){const e=[];for(let n=0;n<3;n++){const i=n/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new df(t,{...this.getShaders(),id:this.props.id,geometry:new hg({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}$(Vb,"layerName","PointCloudLayer"),$(Vb,"defaultProps",eZ);const vl={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ie,new Ie;const vg=new Ie,j3=new Ie;class bg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"center",void 0),$(this,"radius",void 0),this.radius=-0,this.center=new Ie,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=vg.from(e),this.center=new Ie().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new bg(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,s=t.radius,a=vg.copy(i).subtract(e),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const d=(n+o+s)*.5;return j3.copy(a).scale((-n+d)/o).add(e),this.center.copy(j3),this.radius=d,this}expand(t){const n=vg.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const e=Hj(vg,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const n=vg.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,s=t.normal.dot(e)+t.distance;return s<-n?vl.OUTSIDE:s<n?vl.INTERSECTING:vl.INSIDE}}const nZ=new Ie,iZ=new Ie,G0=new Ie,j0=new Ie,q0=new Ie,sZ=new Ie,oZ=new Ie,xh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class wg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];$(this,"center",void 0),$(this,"halfAxes",void 0),this.center=new Ie().from(t),this.halfAxes=new fs(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Ie(t).len(),new Ie(e).len(),new Ie(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new Ie(t).normalize(),s=new Ie(e).normalize(),a=new Ie(n).normalize();return new lg().fromMatrix3(new fs([...i,...s,...a]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new lg(n),s=new fs().fromQuaternion(i);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=new Ie().from(t),this.halfAxes=s,this}clone(){return new wg(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new bg;const e=this.halfAxes,n=e.getColumn(0,G0),i=e.getColumn(1,j0),s=e.getColumn(2,q0),a=nZ.copy(n).add(i).add(s);return t.center.copy(this.center),t.radius=a.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,d=Math.abs(s*i[xh.COLUMN0ROW0]+a*i[xh.COLUMN0ROW1]+o*i[xh.COLUMN0ROW2])+Math.abs(s*i[xh.COLUMN1ROW0]+a*i[xh.COLUMN1ROW1]+o*i[xh.COLUMN1ROW2])+Math.abs(s*i[xh.COLUMN2ROW0]+a*i[xh.COLUMN2ROW1]+o*i[xh.COLUMN2ROW2]),f=n.dot(e)+t.distance;return f<=-d?vl.OUTSIDE:f>=d?vl.INSIDE:vl.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=iZ.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,G0),s=n.getColumn(1,j0),a=n.getColumn(2,q0),o=i.magnitude(),d=s.magnitude(),f=a.magnitude();i.normalize(),s.normalize(),a.normalize();let m=0,v;return v=Math.abs(e.dot(i))-o,v>0&&(m+=v*v),v=Math.abs(e.dot(s))-d,v>0&&(m+=v*v),v=Math.abs(e.dot(a))-f,v>0&&(m+=v*v),m}computePlaneDistances(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,d=o.getColumn(0,G0),f=o.getColumn(1,j0),m=o.getColumn(2,q0),v=sZ.copy(d).add(f).add(m).add(a),C=oZ.copy(v).subtract(t);let b=e.dot(C);return i=Math.min(b,i),s=Math.max(b,s),v.copy(a).add(d).add(f).subtract(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),v.copy(a).add(d).subtract(f).add(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),v.copy(a).add(d).subtract(f).subtract(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),a.copy(v).subtract(d).add(f).add(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),a.copy(v).subtract(d).add(f).subtract(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),a.copy(v).subtract(d).subtract(f).add(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),a.copy(v).subtract(d).subtract(f).subtract(m),C.copy(v).subtract(t),b=e.dot(C),i=Math.min(b,i),s=Math.max(b,s),n[0]=i,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,G0);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,j0);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,q0);return i.transformAsPoint(t),this.halfAxes=new fs([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const q3=new Ie,K3=new Ie;class Sc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"normal",void 0),$(this,"distance",void 0),this.normal=new Ie,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Bc(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=q3.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),Bc(Cc(this.normal.len(),1)),this.distance=i,this}clone(){return new Sc(this.normal,this.distance)}equals(t){return Cc(this.distance,t.distance)&&Cc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=K3.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=q3.from(t);const n=this.getPointDistance(t),i=K3.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const W3=[new Ie([1,0,0]),new Ie([0,1,0]),new Ie([0,0,1])],$3=new Ie,aZ=new Ie;new Sc(new Ie(1,0,0),0);class Wl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];$(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*W3.length;const e=t.center,n=t.radius;let i=0;for(const s of W3){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new Sc),o||(o=this.planes[i+1]=new Sc);const d=$3.copy(s).scale(-n).add(e);-s.dot(d),a.fromPointNormal(d,s);const f=$3.copy(s).scale(n).add(e),m=aZ.copy(s).negate();-m.dot(f),o.fromPointNormal(f,m),i+=2}return this}computeVisibility(t){let e=vl.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case vl.OUTSIDE:return vl.OUTSIDE;case vl.INTERSECTING:e=vl.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(Bc(Number.isFinite(e),"parentPlaneMask is required."),e===Wl.MASK_OUTSIDE||e===Wl.MASK_INSIDE)return e;let n=Wl.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(e&a))continue;const o=i[s],d=t.intersectPlane(o);if(d===vl.OUTSIDE)return Wl.MASK_OUTSIDE;d===vl.INTERSECTING&&(n|=a)}return n}}$(Wl,"MASK_OUTSIDE",4294967295),$(Wl,"MASK_INSIDE",0),$(Wl,"MASK_INDETERMINATE",2147483647),new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie;const Ru=new fs,lZ=new fs,cZ=new fs,K0=new fs,X3=new fs;function uZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=cg.EPSILON20,n=10;let i=0,s=0;const a=lZ,o=cZ;a.identity(),o.copy(r);const d=e*hZ(o);for(;s<n&&AZ(o)>d;)dZ(o,K0),X3.copy(K0).transpose(),o.multiplyRight(K0),o.multiplyLeft(X3),a.multiplyRight(K0),++i>2&&(++s,i=0);return t.unitary=a.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function hZ(r){let t=0;for(let e=0;e<9;++e){const n=r[e];t+=n*n}return Math.sqrt(t)}const Gb=[1,0,0],jb=[2,2,1];function AZ(r){let t=0;for(let e=0;e<3;++e){const n=r[Ru.getElementIndex(jb[e],Gb[e])];t+=2*n*n}return Math.sqrt(t)}function dZ(r,t){const e=cg.EPSILON15;let n=0,i=1;for(let f=0;f<3;++f){const m=Math.abs(r[Ru.getElementIndex(jb[f],Gb[f])]);m>n&&(i=f,n=m)}const s=Gb[i],a=jb[i];let o=1,d=0;if(Math.abs(r[Ru.getElementIndex(a,s)])>e){const f=r[Ru.getElementIndex(a,a)],m=r[Ru.getElementIndex(s,s)],v=r[Ru.getElementIndex(a,s)],C=(f-m)/2/v;let b;C<0?b=-1/(-C+Math.sqrt(1+C*C)):b=1/(C+Math.sqrt(1+C*C)),o=1/Math.sqrt(1+b*b),d=b*o}return fs.IDENTITY.to(t),t[Ru.getElementIndex(s,s)]=t[Ru.getElementIndex(a,a)]=o,t[Ru.getElementIndex(a,s)]=d,t[Ru.getElementIndex(s,a)]=-d,t}const mA=new Ie,fZ=new Ie,pZ=new Ie,gZ=new Ie,mZ=new Ie,yZ=new fs,_Z={diagonal:new fs,unitary:new fs};function vZ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new wg;if(!r||r.length===0)return t.halfAxes=new fs([0,0,0,0,0,0,0,0,0]),t.center=new Ie,t;const e=r.length,n=new Ie(0,0,0);for(const wt of r)n.add(wt);const i=1/e;n.multiplyByScalar(i);let s=0,a=0,o=0,d=0,f=0,m=0;for(const wt of r){const Ct=mA.copy(wt).subtract(n);s+=Ct.x*Ct.x,a+=Ct.x*Ct.y,o+=Ct.x*Ct.z,d+=Ct.y*Ct.y,f+=Ct.y*Ct.z,m+=Ct.z*Ct.z}s*=i,a*=i,o*=i,d*=i,f*=i,m*=i;const v=yZ;v[0]=s,v[1]=a,v[2]=o,v[3]=a,v[4]=d,v[5]=f,v[6]=o,v[7]=f,v[8]=m;const{unitary:C}=uZ(v,_Z),b=t.halfAxes.copy(C);let P=b.getColumn(0,pZ),F=b.getColumn(1,gZ),U=b.getColumn(2,mZ),k=-Number.MAX_VALUE,z=-Number.MAX_VALUE,K=-Number.MAX_VALUE,G=Number.MAX_VALUE,X=Number.MAX_VALUE,Y=Number.MAX_VALUE;for(const wt of r)mA.copy(wt),k=Math.max(mA.dot(P),k),z=Math.max(mA.dot(F),z),K=Math.max(mA.dot(U),K),G=Math.min(mA.dot(P),G),X=Math.min(mA.dot(F),X),Y=Math.min(mA.dot(U),Y);P=P.multiplyByScalar(.5*(G+k)),F=F.multiplyByScalar(.5*(X+z)),U=U.multiplyByScalar(.5*(Y+K)),t.center.copy(P).add(F).add(U);const it=fZ.set(k-G,z-X,K-Y).multiplyByScalar(.5),nt=new fs([it[0],0,0,0,it[1],0,0,0,it[2]]);return t.halfAxes.multiplyRight(nt),t}const qb=Math.PI/180,W0=new Float32Array(16),Z3=new Float32Array(12);function Y3(r,t,e){const n=t[0]*qb,i=t[1]*qb,s=t[2]*qb,a=Math.sin(s),o=Math.sin(n),d=Math.sin(i),f=Math.cos(s),m=Math.cos(n),v=Math.cos(i),C=e[0],b=e[1],P=e[2];r[0]=C*v*m,r[1]=C*d*m,r[2]=C*-o,r[3]=b*(-d*f+v*o*a),r[4]=b*(v*f+d*o*a),r[5]=b*m*a,r[6]=P*(d*a+v*o*f),r[7]=P*(-v*a+d*o*f),r[8]=P*m*f}function J3(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const tP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,t){let{startRow:e,endRow:n}=t;const{data:i,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:d}=this.props,f=Array.isArray(d),m=f&&d.length===16,v=Array.isArray(a),C=Array.isArray(s),b=Array.isArray(o),P=m||!f&&!!d(i[0]);P?r.constant=m:r.constant=C&&v&&b;const F=r.value;if(r.constant){let U;P?(W0.set(d),U=J3(W0)):(U=Z3,Y3(U,s,a),U.set(o,9)),r.value=new Float32Array(U)}else{let U=e*r.size;const{iterable:k,objectInfo:z}=C3(i,e,n);for(const K of k){z.index++;let G;if(P)W0.set(m?d:d(K,z)),G=J3(W0);else{G=Z3;const X=C?s:s(K,z),Y=v?a:a(K,z);Y3(G,X,Y),G.set(b?o:o(K,z),9)}F[U++]=G[0],F[U++]=G[1],F[U++]=G[2],F[U++]=G[3],F[U++]=G[4],F[U++]=G[5],F[U++]=G[6],F[U++]=G[7],F[U++]=G[8],F[U++]=G[9],F[U++]=G[10],F[U++]=G[11]}}}};function eP(r,t){return t===jn.CARTESIAN||t===jn.METER_OFFSETS||t===jn.DEFAULT&&!r.isGeospatial}const bZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function rP(r){let t=1/0,e=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],d=o&&o.length;for(let f=0;f<d;f+=3){const m=o[f],v=o[f+1],C=o[f+2];t=m<t?m:t,e=v<e?v:e,n=C<n?C:n,i=m>i?m:i,s=v>s?v:s,a=C>a?C:a}return[[t,e,n],[i,s,a]]}function xZ(r,t){if(!r)throw new Error("loader assertion failed.")}class Bf{constructor(t,e){$(this,"fields",void 0),$(this,"metadata",void 0),xZ(Array.isArray(t)),BZ(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const a of n)t[a]=!0;const s=this.fields.filter(a=>t[a.name]);return new Bf(s,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(s=>this.fields[s]).filter(Boolean);return new Bf(i,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof Bf){const a=t;e=a.fields,n=nP(nP(new Map,this.metadata),a.metadata)}else e=t;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of e)i[a.name]=a;const s=Object.values(i);return new Bf(s,n)}}function BZ(r){const t={};for(const e of r)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function nP(r,t){return new Map([...r||new Map,...t||new Map])}class $0{constructor(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;$(this,"name",void 0),$(this,"type",void 0),$(this,"nullable",void 0),$(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new $0(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let ps=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),iP,sP,oP;class Kb{static isNull(t){return t&&t.typeId===ps.Null}static isInt(t){return t&&t.typeId===ps.Int}static isFloat(t){return t&&t.typeId===ps.Float}static isBinary(t){return t&&t.typeId===ps.Binary}static isUtf8(t){return t&&t.typeId===ps.Utf8}static isBool(t){return t&&t.typeId===ps.Bool}static isDecimal(t){return t&&t.typeId===ps.Decimal}static isDate(t){return t&&t.typeId===ps.Date}static isTime(t){return t&&t.typeId===ps.Time}static isTimestamp(t){return t&&t.typeId===ps.Timestamp}static isInterval(t){return t&&t.typeId===ps.Interval}static isList(t){return t&&t.typeId===ps.List}static isStruct(t){return t&&t.typeId===ps.Struct}static isUnion(t){return t&&t.typeId===ps.Union}static isFixedSizeBinary(t){return t&&t.typeId===ps.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===ps.FixedSizeList}static isMap(t){return t&&t.typeId===ps.Map}static isDictionary(t){return t&&t.typeId===ps.Dictionary}get typeId(){return ps.NONE}compareTo(t){return this===t}}iP=Symbol.toStringTag;class Cf extends Kb{constructor(t,e){super(),$(this,"isSigned",void 0),$(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return ps.Int}get[iP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class CZ extends Cf{constructor(){super(!0,8)}}class EZ extends Cf{constructor(){super(!0,16)}}class TZ extends Cf{constructor(){super(!0,32)}}class SZ extends Cf{constructor(){super(!1,8)}}class IZ extends Cf{constructor(){super(!1,16)}}class PZ extends Cf{constructor(){super(!1,32)}}const aP={HALF:16,SINGLE:32,DOUBLE:64};sP=Symbol.toStringTag;class lP extends Kb{constructor(t){super(),$(this,"precision",void 0),this.precision=t}get typeId(){return ps.Float}get[sP](){return"Float"}toString(){return"Float".concat(this.precision)}}class MZ extends lP{constructor(){super(aP.SINGLE)}}class FZ extends lP{constructor(){super(aP.DOUBLE)}}oP=Symbol.toStringTag;class LZ extends Kb{constructor(t,e){super(),$(this,"listSize",void 0),$(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return ps.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[oP](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function RZ(r){switch(r.constructor){case Int8Array:return new CZ;case Uint8Array:return new SZ;case Int16Array:return new EZ;case Uint16Array:return new IZ;case Int32Array:return new TZ;case Uint32Array:return new PZ;case Float32Array:return new MZ;case Float64Array:return new FZ;default:throw new Error("array type not supported")}}function OZ(r,t,e){const n=RZ(t.value),i=e||UZ(t);return new $0(r,new LZ(t.size,new $0("value",n)),!1,i)}function UZ(r){const t=new Map;return"byteOffset"in r&&t.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&t.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&t.set("normalized",r.normalized.toString()),t}function cP(r,t){(r.COLOR_0||r.colors)&&t||(r.colors={constant:!0,value:new Float32Array([1,1,1])}),$n.assert(r.positions||r.POSITION,'no "postions" or "POSITION" attribute in mesh')}function uP(r,t){if(r.attributes)return cP(r.attributes,t),r instanceof hg?r:new hg(r);if(r.positions||r.POSITION)return cP(r,t),new hg({attributes:r});throw Error("Invalid mesh")}const DZ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Wb extends xf{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=!Un(this.context.gl),e={};return Pv(this.context.gl,Qi.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:bZ,fs:wZ,modules:[vb,Lq,bb],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(t=n.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:i}=uP(n,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,e=rP(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:tP}),this.setState({emptyTexture:new gl(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const a=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:s,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||eP(n,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new df(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:uP(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:!!n}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:!!t})}}$(Wb,"defaultProps",DZ),$(Wb,"layerName","SimpleMeshLayer");class Ef{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||mh(this.constructor.name),this.display=!0,this.position=new Ie,this.rotation=new Ie,this.scale=new Ie(1,1,1),this.matrix=new Vn,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return Or(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Or(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Or(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:n,scale:i,update:s=!0}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){Or(t),e=e||this.matrix;const n=new Vn(t).multiplyRight(e),i=n.invert(),s=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class xg extends Ef{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;qr.assert(e.every(n=>n instanceof Ef),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const i of e)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,n)=>{let{worldMatrix:i}=n;const s=e.getBounds();if(!s)return;const[a,o]=s,d=new Ie(a).add(o).divide([2,2,2]);i.transformAsPoint(d,d);const f=new Ie(o).subtract(a).divide([2,2,2]);i.transformAsVector(f,f);for(let m=0;m<8;m++){const v=new Ie(m&1?-1:1,m&2?-1:1,m&4?-1:1).multiply(f).add(d);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],v[C]),t[1][C]=Math.max(t[1][C],v[C])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new Vn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new Vn(e).multiplyRight(this.matrix);for(const i of this.children)i instanceof xg?i.traverse(t,{worldMatrix:n}):t(i,{worldMatrix:n})}}const NZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function hP(r){if(!r._animation){const t=kZ[r.componentType],e=NZ[r.type],n=e*r.count,{buffer:i,byteOffset:s}=r.bufferView.data,a=new t(i,s+(r.byteOffset||0),n);if(e===1)r._animation=Array.from(a);else{const o=[];for(let d=0;d<a.length;d+=e)o.push(Array.from(a.slice(d,d+e)));r._animation=o}}return r._animation}const QZ=new Vn;function zZ(r,t){if(t.matrix.identity(),r.translation&&t.matrix.translate(r.translation),r.rotation){const e=QZ.fromQuaternion(r.rotation);t.matrix.multiplyRight(e)}r.scale&&t.matrix.scale(r.scale)}const $b=new lg;function HZ(r,t,e,n,i){if(t==="rotation"){$b.slerp({start:e,target:n,ratio:i});for(let s=0;s<$b.length;s++)r[t][s]=$b[s]}else for(let s=0;s<e.length;s++)r[t][s]=i*n[s]+(1-i)*e[s]}function VZ(r,t,e){let{p0:n,outTangent0:i,inTangent1:s,p1:a,tDiff:o,ratio:d}=e;for(let f=0;f<r[t].length;f++){const m=i[f]*o,v=s[f]*o;r[t][f]=(2*Math.pow(d,3)-3*Math.pow(d,2)+1)*n[f]+(Math.pow(d,3)-2*Math.pow(d,2)+d)*m+(-2*Math.pow(d,3)+3*Math.pow(d,2))*a[f]+(Math.pow(d,3)-Math.pow(d,2))*v}}function GZ(r,t,e){for(let n=0;n<e.length;n++)r[t][n]=e[n]}function jZ(r,t,e,n){let{input:i,interpolation:s,output:a}=t;const o=i[i.length-1],d=r%o,f=i.findIndex(b=>b>=d),m=Math.max(0,f-1);if(!Array.isArray(e[n]))switch(n){case"translation":e[n]=[0,0,0];break;case"rotation":e[n]=[0,0,0,1];break;case"scale":e[n]=[1,1,1];break;default:qr.warn("Bad animation path ".concat(n))()}Or(e[n].length===a[m].length);const v=i[m],C=i[f];switch(s){case"STEP":GZ(e,n,a[m]);break;case"LINEAR":if(C>v){const b=(d-v)/(C-v);HZ(e,n,a[m],a[f],b)}break;case"CUBICSPLINE":if(C>v){const b=(d-v)/(C-v),P=C-v,F=a[3*m+1],U=a[3*m+2],k=a[3*f+0],z=a[3*f+1];VZ(e,n,{p0:F,outTangent0:U,inTangent1:k,p1:z,tDiff:P,ratio:b})}break;default:qr.warn("Interpolation ".concat(s," not supported"))();break}}class qZ{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:s,target:a,path:o}=i;jZ(n,s,a,o),zZ(a,a._node)})}}class KZ{constructor(t){this.animations=t.animations.map((e,n)=>{const i=e.name||"Animation-".concat(n),s=e.samplers.map(o=>{let{input:d,interpolation:f="LINEAR",output:m}=o;return{input:hP(t.accessors[d]),interpolation:f,output:hP(t.accessors[m])}}),a=e.channels.map(o=>{let{sampler:d,target:f}=o;return{sampler:s[d],target:t.nodes[f.node],path:f.path}});return new qZ({name:i,channels:a})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class WZ extends Ef{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof df?(this.model=t,this._setModelNodeProps(e)):this.model=new df(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class AP{constructor(t,e){let{attributes:n,material:i,pbrDebug:s,imageBasedLightingEnvironment:a,lights:o,useTangents:d}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Pv(t,Qi.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&d,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let a,o={};s.compressed?(a=s,o={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:s};const d=new gl(this.gl,{id:t.name||t.id,parameters:{...i,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[e]=d,this.defineIfPresent(n,n),this.generatedTextures.push(d)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(qr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const $Z=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,XZ=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function dP(r,t){return Un(r)?`#version 300 es
`.concat(t):t}function ZZ(r,t){const{id:e,drawMode:n,vertexCount:i,attributes:s,modelOptions:a}=t,o=new AP(r,t);qr.info(4,"createGLTFModel defines: ",o.defines)();const d=[];d.push(...o.generatedTextures),d.push(...Object.values(s).map(m=>m.buffer));const f=new WZ(r,{id:e,drawMode:n,vertexCount:i,modules:[ob],parameters:o.parameters,vs:dP(r,$Z),fs:dP(r,XZ),managedResources:d,...a,defines:{...o.defines,...a.defines}});return f.setProps({attributes:s}),f.setUniforms(o.uniforms),f}const YZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},JZ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class tY{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},JZ,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new KZ(this.gltf):null}createScene(t){const n=(t.nodes||[]).map(s=>this.createNode(s));return new xg({id:t.name||t.id,children:n})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const i=new xg({id:t.name||t.id,children:n});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const s=new Vn().fromQuaternion(t.rotation);i.matrix.multiplyRight(s)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const n=(t.primitives||[]).map((s,a)=>this.createPrimitive(s,a,t)),i=new xg({id:t.name||t.id,children:n});t._mesh=i}return t._mesh}getVertexCount(t){qr.warn("getVertexCount() not found")()}createPrimitive(t,e,n){const i=ZZ(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return i.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],i}createAttributes(t,e){const n={};return Object.keys(t).forEach(i=>{n[i]=this.createAccessor(t[i],this.createBuffer(t[i],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),qr.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new Si(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new $a({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:YZ[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function eY(r,t,e){const n=new tY(r,e),i=n.instantiate(t),s=n.createAnimator();return{scenes:i,animator:s}}const rY="3.4.15",nY="3.4.15",fP="3.4.15",iY="https://unpkg.com/@loaders.gl/textures@".concat(fP,"/dist/libs/basis_encoder.wasm"),sY="https://unpkg.com/@loaders.gl/textures@".concat(fP,"/dist/libs/basis_encoder.js");let Xb;async function pP(r){const t=r.modules||{};return t.basis?t.basis:(Xb=Xb||oY(r),await Xb)}async function oY(r){let t=null,e=null;return[t,e]=await Promise.all([await td("basis_transcoder.js","textures",r),await td("basis_transcoder.wasm","textures",r)]),t=t||globalThis.BASIS,await aY(t,e)}function aY(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let Zb;async function gP(r){const t=r.modules||{};return t.basisEncoder?t.basisEncoder:(Zb=Zb||lY(r),await Zb)}async function lY(r){let t=null,e=null;return[t,e]=await Promise.all([await td(sY,"textures",r),await td(iY,"textures",r)]),t=t||globalThis.BASIS,await cY(t,e)}function cY(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r(e).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:d}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:d})})})}const Tf={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},uY=["","WEBKIT_","MOZ_"],mP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let X0=null;function hY(r){if(!X0){r=r||AY()||void 0,X0=new Set;for(const t of uY)for(const e in mP)if(r&&r.getExtension("".concat(t).concat(e))){const n=mP[e];X0.add(n)}}return X0}function AY(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var yP,_P,vP,bP,wP,xP,BP,CP;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(yP||(yP={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(_P||(_P={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(vP||(vP={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(bP||(bP={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(wP||(wP={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(xP||(xP={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(BP||(BP={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(CP||(CP={}));const bl=[171,75,84,88,32,50,48,187,13,10,26,10];function dY(r){const t=new Uint8Array(r);return!(t.byteLength<bl.length||t[0]!==bl[0]||t[1]!==bl[1]||t[2]!==bl[2]||t[3]!==bl[3]||t[4]!==bl[4]||t[5]!==bl[5]||t[6]!==bl[6]||t[7]!==bl[7]||t[8]!==bl[8]||t[9]!==bl[9]||t[10]!==bl[10]||t[11]!==bl[11])}const fY={etc1:{basisFormat:0,compressed:!0,format:Tf.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Tf.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Tf.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Tf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Tf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Tf.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function pY(r,t){if(t.basis.containerFormat==="auto"){if(dY(r)){const n=await gP(t);return EP(n.KTX2File,r,t)}const{BasisFile:e}=await pP(t);return Yb(e,r,t)}switch(t.basis.module){case"encoder":const e=await gP(t);switch(t.basis.containerFormat){case"ktx2":return EP(e.KTX2File,r,t);case"basis":default:return Yb(e.BasisFile,r,t)}case"transcoder":default:const{BasisFile:n}=await pP(t);return Yb(n,r,t)}}function Yb(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),d=[];for(let f=0;f<o;f++)d.push(gY(n,a,f,e));s.push(d)}return s}finally{n.close(),n.delete()}}function gY(r,t,e,n){const i=r.getImageWidth(t,e),s=r.getImageHeight(t,e),a=r.getHasAlpha(),{compressed:o,format:d,basisFormat:f}=TP(n,a),m=r.getImageTranscodedSizeInBytes(t,e,f),v=new Uint8Array(m);if(!r.transcodeImage(v,t,e,f,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:v,compressed:o,format:d,hasAlpha:a}}function EP(r,t,e){const n=new r(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++){s.push(mY(n,a,e));break}return[s]}finally{n.close(),n.delete()}}function mY(r,t,e){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(t,0,0),{compressed:a,format:o,basisFormat:d}=TP(e,n),f=r.getImageTranscodedSizeInBytes(t,0,0,d),m=new Uint8Array(f);if(!r.transcodeImage(m,t,0,0,d,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:m,compressed:a,levelSize:f,hasAlpha:n,format:o}}function TP(r,t){let e=r&&r.basis&&r.basis.format;return e==="auto"&&(e=SP()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),fY[e]}function SP(){const r=hY();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const yY={...{name:"Basis",id:dh?"basis":"basis-nodejs",module:"textures",version:nY,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:pY};function wl(r,t){if(!r)throw new Error(t||"assert failed: gltf")}function IP(r,t){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return n.substr(0,n.lastIndexOf("/")+1)+r}function _Y(r,t,e){const n=r.bufferViews[e];wl(n);const i=n.buffer,s=t[i];wl(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}const PP=["SCALAR","VEC2","VEC3","VEC4"],vY=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],bY=new Map(vY),wY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},BY={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function MP(r){return PP[r-1]||PP[0]}function FP(r){const t=bY.get(r.constructor);if(!t)throw new Error("Illegal typed array");return t}function Jb(r,t){const e=BY[r.componentType],n=wY[r.type],i=xY[r.componentType],s=r.count*n,a=r.count*n*i;return wl(a>=0&&a<=t.byteLength),{ArrayType:e,length:s,byteLength:a}}function LP(r){let{images:t,bufferViews:e}=r;t=t||[],e=e||[];const n=t.map(a=>a.bufferView);e=e.filter(a=>!n.includes(a));const i=e.reduce((a,o)=>a+o.byteLength,0),s=t.reduce((a,o)=>{const{width:d,height:f}=o.image;return a+d*f},0);return i+Math.ceil(4*s*1.33)}const CY={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Xa{constructor(t){$(this,"gltf",void 0),$(this,"sourceBuffers",void 0),$(this,"byteLength",void 0),this.gltf=t||{json:{...CY},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(i=>i===t),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,n=this.gltf.buffers[e];wl(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,{ArrayType:s,length:a}=Jb(t,e),o=e.byteOffset+t.byteOffset;return new s(i,o,a)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(i,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){const i=t.extensions||{};i[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wl(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return wl(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:i,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(n){const d=this._addIndices(n);o.primitives[0].indices=d}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,e){const n=Av(t),i=e||(n==null?void 0:n.mimeType),a={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(t){const e=t.byteLength;wl(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Qp(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:MP(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const n=this.addBufferView(t);let i={min:e.min,max:e.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:FP(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,i=new ArrayBuffer(n),s=new Uint8Array(i);let a=0;for(const o of this.sourceBuffers||[])a=dz(o,s,a);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const n in t){const i=t[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);e[s]=a}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const s of i)n.min.push(s),n.max.push(s);for(let s=e;s<t.length;s+=e)for(let a=0;a<e;a++)n.min[0+a]=Math.min(n.min[0+a],t[s+a]),n.max[0+a]=Math.max(n.max[0+a],t[s+a]);return n}}const EY="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",TY="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",SY=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),IY=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),PY={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},MY={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function FY(r,t,e,n,i){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await LY();UY(a,a.exports[MY[i]],r,t,e,n,a.exports[PY[s||"NONE"]])}let tw;async function LY(){return tw||(tw=RY()),tw}async function RY(){let r=EY;WebAssembly.validate(SY)&&(r=TY,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(OY(r),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function OY(r){const t=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);t[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let e=0;for(let n=0;n<r.length;++n)t[e++]=t[n]<60?IY[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,e)}function UY(r,t,e,n,i,s,a){const o=r.exports.sbrk,d=n+3&-4,f=o(d*i),m=o(s.length),v=new Uint8Array(r.exports.memory.buffer);v.set(s,m);const C=t(f,n,i,m,s.length);if(C===0&&a&&a(f,d,i),e.set(v.subarray(f,f+n*i)),o(f-o(0)),C!==0)throw new Error("Malformed buffer data: ".concat(C))}const ew="EXT_meshopt_compression",DY=ew;async function NY(r,t){var e;const n=new Xa(r);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const i=[];for(const s of r.json.bufferViews||[])i.push(kY(n,s));await Promise.all(i),n.removeExtension(ew)}async function kY(r,t){const e=r.getObjectExtension(t,ew);if(e){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:d="NONE",buffer:f}=e,m=r.gltf.buffers[f],v=new Uint8Array(m.arrayBuffer,m.byteOffset+n,i),C=new Uint8Array(r.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await FY(C,a,s,v,o,d),C}return null}const QY=Object.freeze(Object.defineProperty({__proto__:null,decode:NY,name:DY},Symbol.toStringTag,{value:"Module"})),Sf="EXT_texture_webp",zY=Sf;function HY(r,t){const e=new Xa(r);if(!o7("image/webp")){if(e.getRequiredExtensions().includes(Sf))throw new Error("gltf: Required extension ".concat(Sf," not supported by browser"));return}const{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,Sf);s&&(i.source=s.source),e.removeObjectExtension(i,Sf)}e.removeExtension(Sf)}const VY=Object.freeze(Object.defineProperty({__proto__:null,name:zY,preprocess:HY},Symbol.toStringTag,{value:"Module"})),Z0="KHR_texture_basisu",GY=Z0;function jY(r,t){const e=new Xa(r),{json:n}=e;for(const i of n.textures||[]){const s=e.getObjectExtension(i,Z0);s&&(i.source=s.source),e.removeObjectExtension(i,Z0)}e.removeExtension(Z0)}const qY=Object.freeze(Object.defineProperty({__proto__:null,name:GY,preprocess:jY},Symbol.toStringTag,{value:"Module"})),KY={name:"Draco",id:dh?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.15",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function WY(r,t,e){const n=OP(t.metadata),i=[],s=$Y(t.attributes);for(const a in r){const o=r[a],d=RP(a,o,s[a]);i.push(d)}if(e){const a=RP("indices",e);i.push(a)}return new Bf(i,n)}function $Y(r){const t={};for(const e in r){const n=r[e];t[n.name||"undefined"]=n}return t}function RP(r,t,e){const n=e?OP(e.metadata):void 0;return OZ(r,t,n)}function OP(r){const t=new Map;for(const e in r)t.set("".concat(e,".string"),JSON.stringify(r[e]));return t}const UP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},XY={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},ZY=4;class YY{constructor(t){$(this,"draco",void 0),$(this,"decoder",void 0),$(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const C="DRACO decompression failed: ".concat(a.error_msg());throw new Error(C)}const o=this._getDracoLoaderData(s,i,e),d=this._getMeshData(s,o,e),f=rP(d.attributes),m=WY(d.attributes,o,d.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:f},...d,schema:m}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,n){const i=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(t,e){const n={};for(let i=0;i<t.num_attributes();i++){const s=this.decoder.GetAttribute(t,i),a=this._getAttributeMetadata(t,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,e);o&&(n[s.unique_id()].quantization_transform=o);const d=this._getOctahedronTransform(s,e);d&&(n[s.unique_id()].octahedron_transform=d)}return n}_getMeshData(t,e,n){const i=this._getMeshAttributes(e,t,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,n){const i={};for(const s of Object.values(t.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const{value:o,size:d}=this._getAttributeValues(e,s);i[a]={value:o,size:d,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return i}_getTriangleListIndices(t){const n=t.num_faces()*3,i=n*ZY,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),eJ(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=XY[e.data_type],i=e.num_components,a=t.num_points()*i,o=a*n.BYTES_PER_ELEMENT,d=JY(this.draco,n);let f;const m=this.draco._malloc(o);try{const v=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,v,d,o,m),f=new n(this.draco.HEAPF32.buffer,m,a).slice()}finally{this.draco._free(m)}return{value:f,size:i}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[a,o]of Object.entries(e.extraAttributes||{}))if(o===n)return a;const i=t.attribute_type;for(const a in UP)if(this.draco[a]===i)return UP[a];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(t,i);e[s]=this._getDracoMetadataField(t,s)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const i=tJ(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,i=[...e,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,i=t.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(t))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function JY(r,t){switch(t){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function tJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}function eJ(r){const t=r.size(),e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=r.GetValue(n);return e}const rw="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),rJ="".concat(rw,"/draco_decoder.js"),nJ="".concat(rw,"/draco_wasm_wrapper.js"),iJ="".concat(rw,"/draco_decoder.wasm");let Bg;async function sJ(r){const t=r.modules||{};return t.draco3d?Bg=Bg||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Bg=Bg||oJ(r),await Bg}async function oJ(r){let t,e;switch(r.draco&&r.draco.decoderType){case"js":t=await td(rJ,"draco",r);break;case"wasm":default:[t,e]=await Promise.all([await td(nJ,"draco",r),await td(iJ,"draco",r)])}return t=t||globalThis.DracoDecoderModule,await aJ(t,e)}function aJ(r,t){const e={};return t&&(e.wasmBinary=t),new Promise(n=>{r({...e,onModuleLoaded:i=>n({draco:i})})})}const DP={...KY,parse:lJ};async function lJ(r,t){const{draco:e}=await sJ(t),n=new YY(e);try{return n.parseSync(r,t==null?void 0:t.draco)}finally{n.destroy()}}function cJ(r){const t={};for(const e in r){const n=r[e];if(e!=="indices"){const i=NP(n);t[e]=i}}return t}function NP(r){const{buffer:t,size:e,count:n}=uJ(r);return{value:t,size:e,byteOffset:0,count:n,type:MP(e),componentType:FP(t)}}function uJ(r){let t=r,e=1,n=0;return r&&r.value&&(t=r.value,e=r.size||1),t&&(ArrayBuffer.isView(t)||(t=hJ(t,Float32Array)),n=t.length/e),{buffer:t,size:e,count:n}}function hJ(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new t(r):e&&!(r instanceof t)?new t(r):r:null}const Ad="KHR_draco_mesh_compression",AJ=Ad;function dJ(r,t,e){const n=new Xa(r);for(const i of kP(n))n.getObjectExtension(i,Ad)}async function fJ(r,t,e){var n;if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=new Xa(r),s=[];for(const a of kP(i))i.getObjectExtension(a,Ad)&&s.push(gJ(i,a,t,e));await Promise.all(s),i.removeExtension(Ad)}function pJ(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new Xa(r);for(const n of e.json.meshes||[])mJ(n,t),e.addRequiredExtension(Ad)}async function gJ(r,t,e,n){const i=r.getObjectExtension(t,Ad);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=Z_(s.buffer,s.byteOffset),{parse:o}=n,d={...e};delete d["3d-tiles"];const f=await o(a,DP,d,n),m=cJ(f.attributes);for(const[v,C]of Object.entries(m))if(v in t.attributes){const b=t.attributes[v],P=r.getAccessor(b);P!=null&&P.min&&P!==null&&P!==void 0&&P.max&&(C.min=P.min,C.max=P.max)}t.attributes=m,f.indices&&(t.indices=NP(f.indices)),yJ(t)}function mJ(r,t){var e;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:r}),o=s==null||(e=s.parseSync)===null||e===void 0?void 0:e.call(s,{attributes:r}),d=i._addFauxAttributes(o.attributes),f=i.addBufferView(a);return{primitives:[{attributes:d,mode:n,extensions:{[Ad]:{bufferView:f,attributes:d}}}]}}function yJ(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*kP(r){for(const t of r.json.meshes||[])for(const e of t.primitives)yield e}const _J=Object.freeze(Object.defineProperty({__proto__:null,decode:fJ,encode:pJ,name:AJ,preprocess:dJ},Symbol.toStringTag,{value:"Module"})),vJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},nw="KHR_texture_transform",wJ=nw,Y0=new Ie,xJ=new fs,BJ=new fs;async function CJ(r,t){if(!new Xa(r).getExtension(nw))return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)EJ(s,r)}function EJ(r,t){var e,n,i;const s=[],a=(e=t.json.materials)===null||e===void 0?void 0:e[r],o=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.baseColorTexture;o&&Cg(t,r,o,s);const d=a==null?void 0:a.emissiveTexture;d&&Cg(t,r,d,s);const f=a==null?void 0:a.normalTexture;f&&Cg(t,r,f,s);const m=a==null?void 0:a.occlusionTexture;m&&Cg(t,r,m,s);const v=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;v&&Cg(t,r,v,s)}function Cg(r,t,e,n){const i=TJ(e,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const d=o.material;Number.isFinite(d)&&t===d&&SJ(r,o,i)}}function TJ(r,t){var e;const n=(e=r.extensions)===null||e===void 0?void 0:e[nw],{texCoord:i=0}=r,{texCoord:s=i}=n;if(!(t.findIndex(o=>{let[d,f]=o;return d===i&&f===s})!==-1)){const o=MJ(n);return i!==s&&(r.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:o}}return null}function SJ(r,t,e){const{originalTexCoord:n,texCoord:i,matrix:s}=e,a=t.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(a)){var o;const f=(o=r.json.accessors)===null||o===void 0?void 0:o[a];if(f&&f.bufferView){var d;const m=(d=r.json.bufferViews)===null||d===void 0?void 0:d[f.bufferView];if(m){const{arrayBuffer:v,byteOffset:C}=r.buffers[m.buffer],b=(C||0)+(f.byteOffset||0)+(m.byteOffset||0),{ArrayType:P,length:F}=Jb(f,m),U=bJ[f.componentType],k=vJ[f.type],z=m.byteStride||U*k,K=new Float32Array(F);for(let G=0;G<f.count;G++){const X=new P(v,b+G*z,2);Y0.set(X[0],X[1],1),Y0.transformByMatrix3(s),K.set([Y0[0],Y0[1]],G*k)}n===i?IJ(f,m,r.buffers,K):PJ(i,f,t,r,K)}}}}function IJ(r,t,e,n){r.componentType=5126,e.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function PJ(r,t,e,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(r)]=a.length-1)}function MJ(r){const{offset:t=[0,0],rotation:e=0,scale:n=[1,1]}=r,i=new fs().set(1,0,0,0,1,0,t[0],t[1],1),s=xJ.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),a=BJ.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const FJ=Object.freeze(Object.defineProperty({__proto__:null,decode:CJ,name:wJ},Symbol.toStringTag,{value:"Module"})),dd="KHR_lights_punctual",LJ=dd;async function RJ(r){const t=new Xa(r),{json:e}=t,n=t.getExtension(dd);n&&(t.json.lights=n.lights,t.removeExtension(dd));for(const i of e.nodes||[]){const s=t.getObjectExtension(i,dd);s&&(i.light=s.light),t.removeObjectExtension(i,dd)}}async function OJ(r){const t=new Xa(r),{json:e}=t;if(e.lights){const n=t.addExtension(dd);wl(!n.lights),n.lights=e.lights,delete e.lights}if(t.json.lights){for(const n of t.json.lights){const i=n.node;t.addObjectExtension(i,dd,n)}delete t.json.lights}}const UJ=Object.freeze(Object.defineProperty({__proto__:null,decode:RJ,encode:OJ,name:LJ},Symbol.toStringTag,{value:"Module"})),Eg="KHR_materials_unlit",DJ=Eg;async function NJ(r){const t=new Xa(r),{json:e}=t;for(const n of e.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Eg);t.removeExtension(Eg)}function kJ(r){const t=new Xa(r),{json:e}=t;if(t.materials)for(const n of e.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Eg,{}),t.addExtension(Eg))}const QJ=Object.freeze(Object.defineProperty({__proto__:null,decode:NJ,encode:kJ,name:DJ},Symbol.toStringTag,{value:"Module"})),Tg="KHR_techniques_webgl",zJ=Tg;async function HJ(r){const t=new Xa(r),{json:e}=t,n=t.getExtension(Tg);if(n){const i=GJ(n,t);for(const s of e.materials||[]){const a=t.getObjectExtension(s,Tg);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=jJ(s.technique,t)),t.removeObjectExtension(s,Tg)}t.removeExtension(Tg)}}async function VJ(r,t){}function GJ(r,t){const{programs:e=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(t.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=e[a.program]}),i}function jJ(r,t){const e=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in e)&&(e[n]=r.uniforms[n].value)}),Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n].index!==void 0&&(e[n].texture=t.getTexture(e[n].index))}),e}const qJ=Object.freeze(Object.defineProperty({__proto__:null,decode:HJ,encode:VJ,name:zJ},Symbol.toStringTag,{value:"Module"})),QP="EXT_feature_metadata",KJ=QP;async function WJ(r){const t=new Xa(r);$J(t)}function $J(r){var t;const e=r.getExtension(QP),n=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,i=e==null?void 0:e.featureTables;if((e==null?void 0:e.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&i)for(const a in n){const o=n[a],d=YJ(i,a);d&&XJ(r,d,o)}}function XJ(r,t,e){for(const i in e.properties){var n;const s=e.properties[i],a=t==null||(n=t.properties)===null||n===void 0?void 0:n[i],o=t.count;if(a){const d=ZJ(r,s,o,a);a.data=d}}}function ZJ(r,t,e,n){const i=n.bufferView;let s=r.getTypedArrayForBufferView(i);switch(t.type){case"STRING":{const a=n.stringOffsetBufferView,o=r.getTypedArrayForBufferView(a);s=JJ(s,o,e);break}}return s}function YJ(r,t){for(const e in r){const n=r[e];if(n.class===t)return n}return null}function JJ(r,t,e){const n=[],i=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<e;o++){const d=t[(o+1)*a]-t[o*a],f=r.subarray(s,d+s),m=i.decode(f);n.push(m),s+=d}return n}const zP=[QY,VY,qY,_J,UJ,QJ,qJ,FJ,Object.freeze(Object.defineProperty({__proto__:null,decode:WJ,name:KJ},Symbol.toStringTag,{value:"Module"}))];function ttt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=zP.filter(s=>HP(s.name,t));for(const s of n){var i;(i=s.preprocess)===null||i===void 0||i.call(s,r,t,e)}}async function ett(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const n=zP.filter(s=>HP(s.name,t));for(const s of n){var i;await((i=s.decode)===null||i===void 0?void 0:i.call(s,r,t,e))}}function HP(r,t){var e;const n=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(r in n&&!n[r])}const iw="KHR_binary_glTF";function rtt(r){const t=new Xa(r),{json:e}=t;for(const n of e.images||[]){const i=t.getObjectExtension(n,iw);i&&Object.assign(n,i),t.removeObjectExtension(n,iw)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(iw)}const VP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ntt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class itt{constructor(){$(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),$(this,"json",void 0)}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(n.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),rtt(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in VP)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(!(!n||Array.isArray(n))){t[e]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=t[e].length;t[e].push(s),this.idToIndexMap[e][i]=a}}}_convertObjectIdsToArrayIndices(t){for(const e in VP)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:n,indices:i,material:s}=e;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),s&&(e.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(t,e){const n=ntt[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const s of t.materials){var e,n,i;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((e=s.values)===null||e===void 0?void 0:e.tex)||((n=s.values)===null||n===void 0?void 0:n.texture2d_0)||((i=s.values)===null||i===void 0?void 0:i.diffuseTex),o=t.textures.findIndex(d=>d.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function stt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new itt().normalize(r,t)}const ott={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},att={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},$l={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ltt={magFilter:$l.TEXTURE_MAG_FILTER,minFilter:$l.TEXTURE_MIN_FILTER,wrapS:$l.TEXTURE_WRAP_S,wrapT:$l.TEXTURE_WRAP_T},ctt={[$l.TEXTURE_MAG_FILTER]:$l.LINEAR,[$l.TEXTURE_MIN_FILTER]:$l.NEAREST_MIPMAP_LINEAR,[$l.TEXTURE_WRAP_S]:$l.REPEAT,[$l.TEXTURE_WRAP_T]:$l.REPEAT};function utt(r){return att[r]}function htt(r){return ott[r]}class Att{constructor(){$(this,"baseUri",""),$(this,"json",{}),$(this,"buffers",[]),$(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:n,buffers:i=[],images:s=[],baseUri:a=""}=t;return wl(n),this.baseUri=a,this.json=n,this.buffers=i,this.images=s,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,n)=>this._resolveBufferView(e,n))),t.images&&(t.images=t.images.map((e,n)=>this._resolveImage(e,n))),t.samplers&&(t.samplers=t.samplers.map((e,n)=>this._resolveSampler(e,n))),t.textures&&(t.textures=t.textures.map((e,n)=>this._resolveTexture(e,n))),t.accessors&&(t.accessors=t.accessors.map((e,n)=>this._resolveAccessor(e,n))),t.materials&&(t.materials=t.materials.map((e,n)=>this._resolveMaterial(e,n))),t.meshes&&(t.meshes=t.meshes.map((e,n)=>this._resolveMesh(e,n))),t.nodes&&(t.nodes=t.nodes.map((e,n)=>this._resolveNode(e,n))),t.skins&&(t.skins=t.skins.map((e,n)=>this._resolveSkin(e,n))),t.scenes&&(t.scenes=t.scenes.map((e,n)=>this._resolveScene(e,n))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(n=>this.getNode(n)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(n=>this.getNode(n))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((n,i)=>{const s=this.getMesh(i);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(n=>{n={...n};const i=n.attributes;n.attributes={};for(const s in i)n.attributes[s]=this.getAccessor(i[s]);return n.indices!==void 0&&(n.indices=this.getAccessor(n.indices)),n.material!==void 0&&(n.material=this.getMaterial(n.material)),n})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const n=t.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=utt(t.componentType),t.components=htt(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const n=t.bufferView.buffer,{ArrayType:i,byteLength:s}=Jb(t,t.bufferView),a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+n.byteOffset;let o=n.arrayBuffer.slice(a,a+s);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(n,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(o)}return t}_getValueFromInterleavedBuffer(t,e,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const d=e+o*n;a.set(new Uint8Array(t.arrayBuffer.slice(d,d+i)),o*i)}return a.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):ctt,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const n in t){const i=this._enumSamplerParameter(n);i!==void 0&&(t.parameters[i]=t[n])}return t}_enumSamplerParameter(t){return ltt[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){const n=t.buffer,i={id:"bufferView-".concat(e),...t,buffer:this.buffers[n]},s=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(a+=t.byteOffset),i.data=new Uint8Array(s,a,t.byteLength),i}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function dtt(r,t){return new Att().postProcess(r,t)}const GP=1735152710,sw=12,J0=8,ftt=1313821514,ptt=5130562,gtt=0,mtt=1,ytt=0,If=!0;function _tt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}function vtt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new DataView(r),{magic:i=GP}=e,s=n.getUint32(t,!1);return s===i||s===GP}function btt(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t),i=_tt(n,e+0),s=n.getUint32(e+4,If),a=n.getUint32(e+8,If);switch(Object.assign(r,{header:{byteOffset:e,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),e+=sw,r.version){case 1:return wtt(r,n,e);case 2:return xtt(r,n,e,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function wtt(r,t,e){Oi(r.header.byteLength>sw+J0);const n=t.getUint32(e+0,If),i=t.getUint32(e+4,If);return e+=J0,Oi(i===ytt),ow(r,t,e,n),e+=n,e+=aw(r,t,e,r.header.byteLength),e}function xtt(r,t,e,n){return Oi(r.header.byteLength>sw+J0),Btt(r,t,e,n),e+r.header.byteLength}function Btt(r,t,e,n){for(;e+8<=r.header.byteLength;){const i=t.getUint32(e+0,If),s=t.getUint32(e+4,If);switch(e+=J0,s){case ftt:ow(r,t,e,i);break;case ptt:aw(r,t,e,i);break;case gtt:n.strict||ow(r,t,e,i);break;case mtt:n.strict||aw(r,t,e,i);break}e+=Qp(i,4)}return e}function ow(r,t,e,n){const i=new Uint8Array(t.buffer,e,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),Qp(n,4)}function aw(r,t,e,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:e,byteLength:n,arrayBuffer:t.buffer}),Qp(n,4)}async function Ctt(r,t){var e,n,i,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;Ett(r,t,a,o),stt(r,{normalize:o==null||(e=o.gltf)===null||e===void 0?void 0:e.normalize}),ttt(r,o,d);const f=[];if(o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadBuffers&&r.json.buffers&&await Ttt(r,o,d),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadImages){const v=Stt(r,o,d);f.push(v)}const m=ett(r,o,d);return f.push(m),await Promise.all(f),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?dtt(r,o):r}function Ett(r,t,e,n){if(n.uri&&(r.baseUri=n.uri),t instanceof ArrayBuffer&&!vtt(t,e,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")r.json=uz(t);else if(t instanceof ArrayBuffer){const a={};e=btt(a,t,e,n.glb),wl(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else wl(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function Ttt(r,t,e){const n=r.json.buffers||[];for(let a=0;a<n.length;++a){const o=n[a];if(o.uri){var i,s;const{fetch:d}=e;wl(d);const f=IP(o.uri,t),m=await(e==null||(i=e.fetch)===null||i===void 0?void 0:i.call(e,f)),v=await(m==null||(s=m.arrayBuffer)===null||s===void 0?void 0:s.call(m));r.buffers[a]={arrayBuffer:v,byteOffset:0,byteLength:v.byteLength},delete o.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Stt(r,t,e){const n=Itt(r),i=r.json.images||[],s=[];for(const a of n)s.push(Ptt(r,i[a],a,t,e));return await Promise.all(s)}function Itt(r){const t=new Set,e=r.json.textures||[];for(const n of e)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function Ptt(r,t,e,n,i){const{fetch:s,parse:a}=i;let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const f=IP(t.uri,n);o=await(await s(f)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const f=_Y(r.json,r.buffers,t.bufferView);o=Z_(f.buffer,f.byteOffset,f.byteLength)}wl(o,"glTF image has no data");let d=await a(o,[NS,yY],{mimeType:t.mimeType,basis:n.basis||{format:SP()}},i);d&&d[0]&&(d={compressed:!0,mipmaps:!1,width:d[0].width,height:d[0].height,data:d[0]}),r.images=r.images||[],r.images[e]=d}const Sg={name:"glTF",id:"gltf",module:"gltf",version:rY,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Mtt,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function Mtt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...Sg.options,...t},t.gltf={...Sg.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await Ctt({},r,n,t,e)}async function Ftt(r){const t=[];return r.scenes.forEach(e=>{e.traverse(n=>{Object.values(n.model.getUniforms()).forEach(i=>{i.loaded===!1&&t.push(i)})})}),await Ltt(()=>t.some(e=>!e.loaded))}async function Ltt(r){for(;r();)await new Promise(t=>requestAnimationFrame(t))}const Rtt=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ott=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,jP=[255,255,255,255],Utt={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:jP},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Sg]};class lw extends xf{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=[vb,bb];return this.props._lighting==="pbr"&&t.push(ob),super.getShaders({vs:Rtt,fs:Ott,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:jP,transition:!0},instanceModelMatrix:tP})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof Ef)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const o=t.scenegraph,d=eY(e,o,this._getModelOptions());n={gltf:o,...d},Ftt(d).then(()=>this.setNeedsRedraw())}else t.scenegraph&&($n.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},s=t.getScene(n,i),a=t.getAnimator(n,i);s instanceof Ef?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,a,t._animations),this.setState({scenegraph:s,animator:a})):s!==null&&$n.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(n=>{this._setModelAttributes(n.model,e)})}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach(s=>{const a=n[s];if(s==="*")i.forEach(o=>{Object.assign(o,a)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<i.length?Object.assign(i[o],a):$n.warn("animation ".concat(s," not found"))()}else{const o=i.find(d=>{let{name:f}=d;return f===s});o?Object.assign(o,a):$n.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Ef&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!Un(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:n={},context:i}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:a,sizeMinPixels:o,sizeMaxPixels:d,opacity:f,coordinateSystem:m}=this.props,v=this.getNumInstances();this.state.scenegraph.traverse((C,b)=>{let{worldMatrix:P}=b;C.model.setInstanceCount(v),C.updateModuleSettings(e),C.draw({parameters:n,uniforms:{sizeScale:a,opacity:f,sizeMinPixels:o,sizeMaxPixels:d,composeModelMatrix:eP(s,m),sceneModelMatrix:P,u_Camera:C.model.getUniforms().project_uCameraPosition}})})}}$(lw,"defaultProps",Utt),$(lw,"layerName","ScenegraphLayer");const Dtt=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ntt=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function ktt(r){r.COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])})}const Qtt={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class cw extends Wb{getShaders(){const t=super.getShaders();return t.modules.push(ob),{...t,vs:Dtt,fs:Ntt}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const s=this.getShaders();return ktt(t.attributes),new df(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(n=this.state.materialParser)===null||n===void 0||n.delete(),new AP(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let s=0;s<e.length;s++)this.encodePickingColor(e[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}$(cw,"layerName","MeshLayer"),$(cw,"defaultProps",Qtt);const ztt=6378137,Htt=6378137,Vtt=6356752314245179e-9;function ty(r){return r}new Ie;function Gtt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ty;return"longitude"in r?(t[0]=e(r.longitude),t[1]=e(r.latitude),t[2]=r.height):"x"in r?(t[0]=e(r.x),t[1]=e(r.y),t[2]=r.z):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function jtt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Gtt(r,t,ho._cartographicRadians?ty:sj)}function qtt(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ty;return"longitude"in t?(t.longitude=e(r[0]),t.latitude=e(r[1]),t.height=r[2]):"x"in t?(t.x=e(r[0]),t.y=e(r[1]),t.z=r[2]):(t[0]=e(r[0]),t[1]=e(r[1]),t[2]=r[2]),t}function Ktt(r,t){return qtt(r,t,ho._cartographicRadians?ty:oj)}const Pf=new Ie,Wtt=new Ie,$tt=new Ie;function Xtt(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=t;Pf.from(r);const a=Pf.x,o=Pf.y,d=Pf.z,f=n.x,m=n.y,v=n.z,C=a*a*f*f,b=o*o*m*m,P=d*d*v*v,F=C+b+P,U=Math.sqrt(1/F);if(!Number.isFinite(U))return;const k=Wtt;if(k.copy(r).scale(U),F<s)return k.to(e);const z=i.x,K=i.y,G=i.z,X=$tt;X.set(k.x*z*2,k.y*K*2,k.z*G*2);let Y=(1-U)*Pf.len()/(.5*X.len()),it=0,nt,wt,Ct,st;do{Y-=it,nt=1/(1+Y*z),wt=1/(1+Y*K),Ct=1/(1+Y*G);const ot=nt*nt,vt=wt*wt,yt=Ct*Ct,re=ot*nt,Wt=vt*wt,ee=yt*Ct;st=C*ot+b*vt+P*yt-1;const oe=-2*(C*re*z+b*Wt*K+P*ee*G);it=st/oe}while(Math.abs(st)>cg.EPSILON12);return Pf.scale([nt,wt,Ct]).to(e)}const qP=1e-14,Ztt=new Ie,KP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},uw={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ig={east:new Ie,north:new Ie,up:new Ie,west:new Ie,south:new Ie,down:new Ie},Ytt=new Ie,Jtt=new Ie,tet=new Ie;function WP(r,t,e,n,i,s){const a=KP[t]&&KP[t][e];Bc(a&&(!n||n===a));let o,d,f;const m=Ztt.copy(i);if(Cc(m.x,0,qP)&&Cc(m.y,0,qP)){const C=Math.sign(m.z);o=Ytt.fromArray(uw[t]),t!=="east"&&t!=="west"&&o.scale(C),d=Jtt.fromArray(uw[e]),e!=="east"&&e!=="west"&&d.scale(C),f=tet.fromArray(uw[n]),n!=="east"&&n!=="west"&&f.scale(C)}else{const{up:C,east:b,north:P}=Ig;b.set(-m.y,m.x,0).normalize(),r.geodeticSurfaceNormal(m,C),P.copy(C).cross(b);const{down:F,west:U,south:k}=Ig;F.copy(C).scale(-1),U.copy(b).scale(-1),k.copy(P).scale(-1),o=Ig[t],d=Ig[e],f=Ig[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=d.x,s[5]=d.y,s[6]=d.z,s[7]=0,s[8]=f.x,s[9]=f.y,s[10]=f.z,s[11]=0,s[12]=m.x,s[13]=m.y,s[14]=m.z,s[15]=1,s}const ey=new Ie,$P=new Ie,eet=new Ie,Ic=new Ie,ret=new Ie,ry=new Ie;class cs{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;$(this,"radii",void 0),$(this,"radiiSquared",void 0),$(this,"radiiToTheFourth",void 0),$(this,"oneOverRadii",void 0),$(this,"oneOverRadiiSquared",void 0),$(this,"minimumRadius",void 0),$(this,"maximumRadius",void 0),$(this,"centerToleranceSquared",cg.EPSILON1),$(this,"squaredXOverSquaredZ",void 0),Bc(t>=0),Bc(e>=0),Bc(n>=0),this.radii=new Ie(t,e,n),this.radiiSquared=new Ie(t*t,e*e,n*n),this.radiiToTheFourth=new Ie(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new Ie(t===0?0:1/t,e===0?0:1/e,n===0?0:1/n),this.oneOverRadiiSquared=new Ie(t===0?0:1/(t*t),e===0?0:1/(e*e),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=$P,i=eet,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];ry.from(t);const n=this.scaleToGeodeticSurface(ry,Ic);if(!n)return;const i=this.geodeticSurfaceNormal(n,$P),s=ret;s.copy(ry).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),d=Math.sign(Wv(s,ry))*sI(s);return Ktt([a,o,d],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Vn;return WP(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Vn;return WP(this,t,e,n,i,s)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return ey.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=jtt(t),i=n[0],s=n[1],a=Math.cos(s);return ey.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),ey.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return ey.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return Xtt(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Ic.from(t);const n=Ic.x,i=Ic.y,s=Ic.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return Ic.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Ic.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Ic.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Bc(Cc(this.radii.x,this.radii.y,cg.EPSILON15)),Bc(this.radii.z>0),Ic.from(t);const i=Ic.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return Ic.set(0,0,i).to(n)}}$(cs,"WGS84",new cs(ztt,Htt,Vtt));class net{constructor(t,e,n){$(this,"item",void 0),$(this,"previous",void 0),$(this,"next",void 0),this.item=t,this.previous=e,this.next=n}}class iet{constructor(){$(this,"head",null),$(this,"tail",null),$(this,"_length",0)}get length(){return this._length}add(t){const e=new net(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class set{constructor(){$(this,"_list",void 0),$(this,"_sentinel",void 0),$(this,"_trimTiles",void 0),this._list=new iet,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=t.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(t.gpuMemoryUsageInBytes>s||n);){const d=o.item;o=o.next,this.unloadTile(t,d,e)}}trim(){this._trimTiles=!0}}function oet(r,t){Oi(r),Oi(t);const{rtcCenter:e,gltfUpAxis:n}=t,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new Vn(i);switch(e&&a.translate(e),n){case"Z":break;case"Y":const v=new Vn().rotateX(Math.PI/2);a=a.multiplyRight(v);break;case"X":const C=new Vn().rotateY(-Math.PI/2);a=a.multiplyRight(C);break}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const o=new Ie(s);t.cartesianModelMatrix=a,t.cartesianOrigin=o;const d=cs.WGS84.cartesianToCartographic(o,new Ie),m=cs.WGS84.eastNorthUpToFixedFrame(o).invert();t.cartographicModelMatrix=m.multiplyRight(a),t.cartographicOrigin=d,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const XP=new Ie,hw=new Ie,Aw=new Wl([new Sc,new Sc,new Sc,new Sc,new Sc,new Sc]);function aet(r,t){const{cameraDirection:e,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=ny(r,r.center),o=cs.WGS84.eastNorthUpToFixedFrame(a),d=r.unprojectPosition(r.cameraPosition),f=cs.WGS84.cartographicToCartesian(d,new Ie),m=new Ie(o.transformAsVector(new Ie(e).scale(s))).normalize(),v=new Ie(o.transformAsVector(new Ie(n).scale(s))).normalize();uet(r);const C=r.constructor,{longitude:b,latitude:P,width:F,bearing:U,zoom:k}=r,z=new C({longitude:b,latitude:P,height:i,width:F,bearing:U,zoom:k,pitch:0});return{camera:{position:f,direction:m,up:v},viewport:r,topDownViewport:z,height:i,cullingVolume:Aw,frameNumber:t,sseDenominator:1.15}}function cet(r,t,e){if(e===0||r.length<=e)return[r,[]];const n=[],{longitude:i,latitude:s}=t.viewport;for(const[f,m]of r.entries()){const[v,C]=m.header.mbs,b=Math.abs(i-v),P=Math.abs(s-C),F=Math.sqrt(P*P+b*b);n.push([f,F])}const a=n.sort((f,m)=>f[1]-m[1]),o=[];for(let f=0;f<e;f++)o.push(r[a[f][0]]);const d=[];for(let f=e;f<a.length;f++)d.push(r[a[f][0]]);return[o,d]}function uet(r){const t=r.getFrustumPlanes(),e=ZP(t.near,r.cameraPosition),n=ny(r,e),i=ny(r,r.cameraPosition,hw);let s=0;Aw.planes[s++].fromPointNormal(n,XP.copy(n).subtract(i));for(const a in t){if(a==="near")continue;const o=t[a],d=ZP(o,e,hw),f=ny(r,d,hw);Aw.planes[s++].fromPointNormal(f,XP.copy(n).subtract(f))}}function ZP(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ie;const n=r.normal.dot(t);return e.copy(r.normal).scale(r.distance-n).add(t),e}function ny(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ie;const n=r.unprojectPosition(t);return cs.WGS84.cartographicToCartesian(n,e)}const het=6378137,Aet=6378137,dw=6356752314245179e-9,YP=new Ie;function det(r,t){if(r instanceof wg){const{halfAxes:e}=r,n=pet(e);return Math.log2(dw/(n+t[2]))}else if(r instanceof bg){const{radius:e}=r;return Math.log2(dw/(e+t[2]))}else if(r.width&&r.height){const{width:e,height:n}=r,i=Math.log2(het/e),s=Math.log2(Aet/n);return(i+s)/2}return 1}function JP(r,t,e){const n=cs.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],new Ie),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Math.log2(dw/(i+t[2]))}function fet(r,t,e){const[n,i,s,a]=r;return JP({xmin:n,xmax:s,ymin:i,ymax:a,zmin:0,zmax:0},t,e)}function pet(r){r.getColumn(0,YP);const t=r.getColumn(1),e=r.getColumn(2);return YP.add(t).add(e).len()}const xl={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Bh={ADD:1,REPLACE:2},Mf={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Xl={I3S:"I3S",TILES3D:"TILES3D"},iy={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},get={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function tM(r){return r!=null}const ia=new Ie,sy=new Ie,met=new Ie,yet=new Ie;function fw(r,t,e){if(Oi(r,"3D Tile: boundingVolume must be defined"),r.box)return vet(r.box,t,e);if(r.region){const[n,i,s,a,o,d]=r.region,f=cs.WGS84.cartographicToCartesian([vh(n),vh(a),o],met),m=cs.WGS84.cartographicToCartesian([vh(s),vh(i),d],yet),v=new Ie().addVectors(f,m).multiplyScalar(.5),C=new Ie().subVectors(f,m).len()/2;return eM([v[0],v[1],v[2],C],new Vn)}if(r.sphere)return eM(r.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function _et(r,t){if(r.box)return bet(t);if(r.region){const[e,n,i,s,a,o]=r.region;return[[vh(e),vh(n),a],[vh(i),vh(s),o]]}if(r.sphere)return wet(t);throw new Error("Unkown boundingVolume type")}function vet(r,t,e){const n=new Ie(r[0],r[1],r[2]);t.transform(n,n);let i=[];if(r.length===10){const f=r.slice(3,6),m=new lg;m.fromArray(r,6);const v=new Ie([1,0,0]),C=new Ie([0,1,0]),b=new Ie([0,0,1]);v.transformByQuaternion(m),v.scale(f[0]),C.transformByQuaternion(m),C.scale(f[1]),b.transformByQuaternion(m),b.scale(f[2]),i=[...v.toArray(),...C.toArray(),...b.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),o=t.transformAsVector(i.slice(6,9)),d=new fs([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return tM(e)?(e.center=n,e.halfAxes=d,e):new wg(n,d)}function eM(r,t,e){const n=new Ie(r[0],r[1],r[2]);t.transform(n,n);const i=t.getScale(sy),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return tM(e)?(e.center=n,e.radius=a,e):new bg(n,a)}function bet(r){const t=rM(),{halfAxes:e}=r,n=new Ie(e.getColumn(0)),i=new Ie(e.getColumn(1)),s=new Ie(e.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let d=0;d<2;d++)ia.copy(r.center),ia.add(n),ia.add(i),ia.add(s),nM(t,ia),s.negate();i.negate()}n.negate()}return t}function wet(r){const t=rM(),{center:e,radius:n}=r,i=cs.WGS84.scaleToGeodeticSurface(e,ia);let s;i?s=cs.WGS84.geodeticSurfaceNormal(i):s=new Ie(0,0,1);let a=new Ie(s[2],-s[1],0);a.len()>0?a.normalize():a=new Ie(0,1,0);const o=a.clone().cross(s);for(const d of[a,o,s]){sy.copy(d).scale(n);for(let f=0;f<2;f++)ia.copy(e),ia.add(sy),nM(t,ia),sy.negate()}return t}function rM(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function nM(r,t){cs.WGS84.cartesianToCartographic(t,ia),r[0][0]=Math.min(r[0][0],ia[0]),r[0][1]=Math.min(r[0][1],ia[1]),r[0][2]=Math.min(r[0][2],ia[2]),r[1][0]=Math.max(r[1][0],ia[0]),r[1][1]=Math.max(r[1][1],ia[1]),r[1][2]=Math.max(r[1][2],ia[2])}new Ie,new Ie,new Vn,new Ie,new Ie,new Ie;function xet(r,t){const e=r*t;return 1-Math.exp(-(e*e))}function Bet(r,t){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const e=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return xet(t,e)*n}return 0}function Cet(r,t,e){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=e?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:d}=t,{viewDistanceScale:f}=n.options;let m=s*o*(f||1)/(a*d);return m-=Bet(n,a),m}const pw=new Ie,iM=new Ie,yA=new Ie,sM=new Ie,Eet=new Ie,gw=new Vn,oM=new Vn;function Tet(r,t){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const e=2*aM(r,t);return e<2?"OUT":!r.header.children||e<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function aM(r,t){const{topDownViewport:e}=t,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],d=e.unprojectPosition(e.cameraPosition);cs.WGS84.cartographicToCartesian(d,pw),iM.copy(pw).subtract(o).normalize(),cs.WGS84.eastNorthUpToFixedFrame(o,gw),oM.copy(gw).invert(),yA.copy(pw).transform(oM);const f=Math.sqrt(yA[0]*yA[0]+yA[1]*yA[1]),m=f*f/yA[2];sM.copy([yA[0],yA[1],m]);const C=sM.transform(gw).subtract(o).normalize(),P=iM.cross(C).normalize().scale(a).add(o),F=cs.WGS84.cartesianToCartographic(P),U=e.project([i,n,s]),k=e.project(F);return Eet.copy(U).subtract(k).magnitude()}function Iet(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class lM{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;$(this,"_map",new Map),$(this,"_array",void 0),$(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Oi(t<this._array.length),this._array[t]}set(t,e){Oi(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Oi(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Oi(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Pet={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class oy{traversalFinished(t){return!0}constructor(t){$(this,"options",void 0),$(this,"root",null),$(this,"selectedTiles",{}),$(this,"requestedTiles",{}),$(this,"emptyTiles",{}),$(this,"lastUpdate",new Date().getTime()),$(this,"updateDebounceTime",1e3),$(this,"_traversalStack",new lM),$(this,"_emptyTraversalStack",new lM),$(this,"_frameNumber",null),this.options={...Pet,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,e)&&(this.updateChildTiles(s,e),a=this.updateAndPushChildren(s,e,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,d=!!(!o||o._shouldRefine),f=!a;s.hasRenderContent?s.refine===Bh.ADD?(this.loadTile(s,e),this.selectTile(s,e)):s.refine===Bh.REPLACE&&(this.loadTile(s,e),f&&this.selectTile(s,e)):(this.emptyTiles[s.id]=s,this.loadTile(s,e),f&&this.selectTile(s,e)),this.touchTile(s,e),s._shouldRefine=a&&d}const i=new Date().getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const i of n)this.updateTile(i,e)}updateAndPushChildren(t,e,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const d=t.refine===Bh.REPLACE&&t.hasRenderContent&&!a;let f=!1,m=!0;for(const v of o)if(v._selectionDepth=i,v.isVisibleAndInRequestVolume?(n.find(v)&&n.delete(v),n.push(v),f=!0):(d||s)&&(this.loadTile(v,e),this.touchTile(v,e)),d){let C;if(v._inRequestVolume?v.hasRenderContent?C=v.contentAvailable:C=this.executeEmptyTraversal(v,e):C=!1,m=m&&C,!m)return!1}return f||(m=!1),m}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!i&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,n):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===e.viewport.id&&n.push(i);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0&&n;){const s=i.pop();if(this.updateTile(s,e),s.isVisibleAndInRequestVolume||this.loadTile(s,e),this.touchTile(s,e),!s.hasRenderContent&&this.canTraverse(s,e,!1,!0)){const o=s.children;for(const d of o)i.find(d)&&i.delete(d),i.push(d)}else!s.contentAvailable&&!s.hasEmptyContent&&(n=!1)}return n}}const cM=new Ie;function Met(r){return r!=null}class mw{constructor(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";$(this,"tileset",void 0),$(this,"header",void 0),$(this,"id",void 0),$(this,"url",void 0),$(this,"parent",void 0),$(this,"refine",void 0),$(this,"type",void 0),$(this,"contentUrl",void 0),$(this,"lodMetricType","geometricError"),$(this,"lodMetricValue",0),$(this,"boundingVolume",null),$(this,"content",null),$(this,"contentState",xl.UNLOADED),$(this,"gpuMemoryUsageInBytes",0),$(this,"children",[]),$(this,"depth",0),$(this,"viewportIds",[]),$(this,"transform",new Vn),$(this,"extensions",null),$(this,"implicitTiling",null),$(this,"userData",{}),$(this,"computedTransform",void 0),$(this,"hasEmptyContent",!1),$(this,"hasTilesetContent",!1),$(this,"traverser",new oy({})),$(this,"_cacheNode",null),$(this,"_frameNumber",null),$(this,"_expireDate",null),$(this,"_expiredContent",null),$(this,"_boundingBox",void 0),$(this,"_distanceToCamera",0),$(this,"_screenSpaceError",0),$(this,"_visibilityPlaneMask",void 0),$(this,"_visible",void 0),$(this,"_contentBoundingVolume",void 0),$(this,"_viewerRequestVolume",void 0),$(this,"_initialTransform",new Vn),$(this,"_priority",0),$(this,"_selectedFrame",0),$(this,"_requestedFrame",0),$(this,"_selectionDepth",0),$(this,"_touchedFrame",0),$(this,"_centerZDepth",0),$(this,"_shouldRefine",!1),$(this,"_stackLength",0),$(this,"_visitedFrame",0),$(this,"_inRequestVolume",!1),$(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===xl.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===xl.UNLOADED}get contentExpired(){return this.contentState===xl.EXPIRED}get contentFailed(){return this.contentState===xl.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=_et(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Xl.I3S:return aM(this,t);case Xl.TILES3D:return Cet(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===Bh.ADD||e;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===xl.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=xl.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=xl.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await oA(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=xl.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=xl.FAILED,n}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=xl.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:Wl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==Wl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return cM.subVectors(n.center,e.position),e.direction.dot(cM)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(Met(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=xl.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new Vn(t.transform):new Vn;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Vn(i).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new Vn;this._initialTransform=new Vn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=xl.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Wl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Bh.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=fw(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=fw(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=fw(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Vn).clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Iet(this.tileset.tileset)}}}class Fet extends oy{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const a=t.children[0];this.updateTileVisibility(a,e),t._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const i=t.refine===Bh.REPLACE,s=t._optimChildrenWithinParent===get.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Bh.ADD?!1:!this.shouldRefine(t,e,!0)}}class Let{constructor(){$(this,"frameNumberMap",new Map)}register(t,e){const n=this.frameNumberMap.get(t)||new Map,i=n.get(e)||0;n.set(e,i+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const i=n.get(e)||1;n.set(e,i-1)}isZero(t,e){var n;return(((n=this.frameNumberMap.get(t))===null||n===void 0?void 0:n.get(e))||0)===0}}const yw={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Ret{constructor(){$(this,"_statusMap",void 0),$(this,"pendingTilesRegister",new Let),this._statusMap={}}add(t,e,n,i){if(!this._statusMap[e]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:yw.REQUESTED},this.pendingTilesRegister.register(a,s),t().then(o=>{this._statusMap[e].status=yw.COMPLETED;const{frameNumber:d,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,d),this._statusMap[e].callback(o,i)}).catch(o=>{this._statusMap[e].status=yw.ERROR;const{frameNumber:d,viewport:{id:f}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(f,d),n(o)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=e;this.pendingTilesRegister.register(a,s),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class Oet extends oy{constructor(t){super(t),$(this,"_tileManager",void 0),this._tileManager=new Ret}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=Tet(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,s=t.tileset;for(const a of n){const o="".concat(a.id,"-").concat(e.viewport.id),d=i&&i.find(f=>f.id===o);if(d)d&&this.updateTile(d,e);else{let f=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,e):(s.tileset.nodePages&&(f=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(f,o,v=>this._onTileLoad(v,t,o),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await oA(i,n,s)}_onTileLoad(t,e,n){const i=new mw(e.tileset,t,e,n);e.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const Uet={description:"",ellipsoid:cs.WGS84,modelMatrix:new Vn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ay="Tiles In Tileset(s)",_w="Tiles In Memory",uM="Tiles In View",hM="Tiles To Render",AM="Tiles Loaded",vw="Tiles Loading",dM="Tiles Unloaded",fM="Failed Tile Loads",pM="Points/Vertices",bw="Tile Memory Use";class Det{constructor(t,e){$(this,"options",void 0),$(this,"loadOptions",void 0),$(this,"type",void 0),$(this,"tileset",void 0),$(this,"loader",void 0),$(this,"url",void 0),$(this,"basePath",void 0),$(this,"modelMatrix",void 0),$(this,"ellipsoid",void 0),$(this,"lodMetricType",void 0),$(this,"lodMetricValue",void 0),$(this,"refine",void 0),$(this,"root",null),$(this,"roots",{}),$(this,"asset",{}),$(this,"description",""),$(this,"properties",void 0),$(this,"extras",null),$(this,"attributions",{}),$(this,"credits",{}),$(this,"stats",void 0),$(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),$(this,"cartographicCenter",null),$(this,"cartesianCenter",null),$(this,"zoom",1),$(this,"boundingVolume",null),$(this,"dynamicScreenSpaceErrorComputedDensity",0),$(this,"maximumMemoryUsage",32),$(this,"gpuMemoryUsageInBytes",0),$(this,"_frameNumber",0),$(this,"_queryParams",{}),$(this,"_extensionsUsed",[]),$(this,"_tiles",{}),$(this,"_pendingCount",0),$(this,"selectedTiles",[]),$(this,"traverseCounter",0),$(this,"geometricError",0),$(this,"lastUpdatedVieports",null),$(this,"_requestedTiles",[]),$(this,"_emptyTiles",[]),$(this,"frameStateData",{}),$(this,"_traverser",void 0),$(this,"_cache",new set),$(this,"_requestScheduler",void 0),$(this,"updatePromise",null),$(this,"tilesetInitializationPromise",void 0),this.options={...Uet,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||Y_(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new bz({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new zp({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const i of e){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of e){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=aet(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[s,a]=cet(i,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(a=>a.id)),i=new Set(e.map(a=>a.id));let s=t.filter(a=>!i.has(a.id)).length>0;return s=s||e.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(uM).count=this.selectedTiles.length,this.stats.get(hM).count=t,this.stats.get(pM).count=e}async _initializeTileSet(t){this.type===Xl.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Xl.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Xl.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:s,ymin:a,ymax:o,zmin:d,zmax:f}=e;this.cartographicCenter=new Ie(i+(s-i)/2,a+(o-a)/2,d+(f-d)/2),this.cartesianCenter=cs.WGS84.cartographicToCartesian(this.cartographicCenter,new Ie),this.zoom=JP(e,this.cartographicCenter,this.cartesianCenter);return}const n=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(n){const[i,s,a,o]=n;this.cartographicCenter=new Ie(i+(a-i)/2,s+(o-s)/2,0),this.cartesianCenter=cs.WGS84.cartographicToCartesian(this.cartographicCenter,new Ie),this.zoom=fet(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ie,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ie,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=cs.WGS84.cartesianToCartographic(e,new Ie):this.cartographicCenter=new Ie(0,0,-cs.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=det(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ay),this.stats.get(vw),this.stats.get(_w),this.stats.get(uM),this.stats.get(hM),this.stats.get(AM),this.stats.get(dM),this.stats.get(fM),this.stats.get(pM),this.stats.get(bw,"memory")}_initializeTileHeaders(t,e){const n=new mw(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===Xl.TILES3D){const s=[];for(s.push(n);s.length>0;){const a=s.pop();this.stats.get(ay).incrementCount();const o=a.header.children||[];for(const d of o){var i;const f=new mw(this,d,a);if((i=f.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const v=new URL(f.contentUrl).searchParams.get("session");v&&(this._queryParams.session=v)}a.children.push(f),f.depth=a.depth+1,s.push(f)}}}return n}_initializeTraverser(){let t;switch(this.type){case Xl.TILES3D:t=Fet;break;case Xl.I3S:t=Oet;break;default:t=oy}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(fM).incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){if(e){if(this.type===Xl.I3S){var n,i;const s=((n=this.tileset)===null||n===void 0||(i=n.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(ay).reset(),this.stats.get(ay).addCount(s)}t&&t.content&&oet(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Xl.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Xl.TILES3D){var e;const{extensionsRemoved:n=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(vw).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(vw).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(AM).incrementCount(),this.stats.get(_w).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(bw).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(_w).decrementCount(),this.stats.get(dM).incrementCount(),this.stats.get(bw).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const i of t.children)n.push(i);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const gM="3.4.15",Pg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function mM(r,t,e){Oi(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,t,e);return n.decode(i)}function Net(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(r);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const ket={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Xs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ei={...ket,...Xs},ww={[Xs.DOUBLE]:Float64Array,[Xs.FLOAT]:Float32Array,[Xs.UNSIGNED_SHORT]:Uint16Array,[Xs.UNSIGNED_INT]:Uint32Array,[Xs.UNSIGNED_BYTE]:Uint8Array,[Xs.BYTE]:Int8Array,[Xs.SHORT]:Int16Array,[Xs.INT]:Int32Array},Qet={DOUBLE:Xs.DOUBLE,FLOAT:Xs.FLOAT,UNSIGNED_SHORT:Xs.UNSIGNED_SHORT,UNSIGNED_INT:Xs.UNSIGNED_INT,UNSIGNED_BYTE:Xs.UNSIGNED_BYTE,BYTE:Xs.BYTE,SHORT:Xs.SHORT,INT:Xs.INT},xw="Failed to convert GL type";class Ou{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in ww)if(ww[e]===t)return e;throw new Error(xw)}static fromName(t){const e=Qet[t];if(!e)throw new Error(xw);return e}static getArrayType(t){switch(t){case Xs.UNSIGNED_SHORT_5_6_5:case Xs.UNSIGNED_SHORT_4_4_4_4:case Xs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=ww[t];if(!e)throw new Error(xw);return e}}static getByteSize(t){return Ou.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Ou.getArrayType(t)}static createTypedArray(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(e.byteLength-n)/Ou.getByteSize(t));const s=Ou.getArrayType(t);return new s(e,n,i)}}function zet(r,t){if(!r)throw new Error("math.gl assertion failed. ".concat(t))}function Het(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=r>>11&31,n=r>>5&63,i=r&31;return t[0]=e<<3,t[1]=n<<2,t[2]=i<<3,t}new Kv,new Ie,new Kv,new Kv;function yM(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return bh(r,0,t)/t*2-1}function _M(r){return r<0?-1:1}function Vet(r,t,e,n){if(zet(n),r<0||r>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(n.x=yM(r,e),n.y=yM(t,e),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*_M(i),n.y=(1-Math.abs(i))*_M(n.y)}return n.normalize()}function Get(r,t,e){return Vet(r,t,255,e)}class Bw{constructor(t,e){$(this,"json",void 0),$(this,"buffer",void 0),$(this,"featuresLength",0),$(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ei.UNSIGNED_INT,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=Ou.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,s){const a=this.json[t];if(!a)return a;const o=this.getPropertyArray(t,e,n);if(n===1)return o[i];for(let d=0;d<n;++d)s[d]=o[n*i+d];return s}_getTypedArrayFromBinary(t,e,n,i,s){const a=this._cachedTypedArrays;let o=a[t];return o||(o=Ou.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let s=i[t];return s||(s=Ou.createTypedArray(e,n),i[t]=s),s}}const jet={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qet={SCALAR:(r,t)=>r[t],VEC2:(r,t)=>[r[2*t+0],r[2*t+1]],VEC3:(r,t)=>[r[3*t+0],r[3*t+1],r[3*t+2]],VEC4:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT2:(r,t)=>[r[4*t+0],r[4*t+1],r[4*t+2],r[4*t+3]],MAT3:(r,t)=>[r[9*t+0],r[9*t+1],r[9*t+2],r[9*t+3],r[9*t+4],r[9*t+5],r[9*t+6],r[9*t+7],r[9*t+8]],MAT4:(r,t)=>[r[16*t+0],r[16*t+1],r[16*t+2],r[16*t+3],r[16*t+4],r[16*t+5],r[16*t+6],r[16*t+7],r[16*t+8],r[16*t+9],r[16*t+10],r[16*t+11],r[16*t+12],r[16*t+13],r[16*t+14],r[16*t+15]]},Ket={SCALAR:(r,t,e)=>{t[e]=r},VEC2:(r,t,e)=>{t[2*e+0]=r[0],t[2*e+1]=r[1]},VEC3:(r,t,e)=>{t[3*e+0]=r[0],t[3*e+1]=r[1],t[3*e+2]=r[2]},VEC4:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT2:(r,t,e)=>{t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},MAT3:(r,t,e)=>{t[9*e+0]=r[0],t[9*e+1]=r[1],t[9*e+2]=r[2],t[9*e+3]=r[3],t[9*e+4]=r[4],t[9*e+5]=r[5],t[9*e+6]=r[6],t[9*e+7]=r[7],t[9*e+8]=r[8],t[9*e+9]=r[9]},MAT4:(r,t,e)=>{t[16*e+0]=r[0],t[16*e+1]=r[1],t[16*e+2]=r[2],t[16*e+3]=r[3],t[16*e+4]=r[4],t[16*e+5]=r[5],t[16*e+6]=r[6],t[16*e+7]=r[7],t[16*e+8]=r[8],t[16*e+9]=r[9],t[16*e+10]=r[10],t[16*e+11]=r[11],t[16*e+12]=r[12],t[16*e+13]=r[13],t[16*e+14]=r[14],t[16*e+15]=r[15]}};function Wet(r,t,e,n){const{componentType:i}=r;Oi(r.componentType);const s=typeof i=="string"?Ou.fromName(i):i,a=jet[r.type],o=qet[r.type],d=Ket[r.type];return e+=r.byteOffset,{values:Ou.createTypedArray(s,t,e,a*n),type:s,size:a,unpacker:o,packer:d}}const Uu=r=>r!==void 0;function $et(r,t,e){if(!t)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?Xet(n,e):null}function Xet(r,t){let e,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,d=r.parentCounts,f=r.parentIds,m=s;Uu(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));let v;if(Uu(d))for(Uu(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,i=getBinaryAccessor(d),d=i.createArrayBufferView(t.buffer,t.byteOffset+d.byteOffset,s)),v=new Uint16Array(s),m=0,e=0;e<s;++e)v[e]=m,m+=d[e];Uu(f)&&Uu(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,i=getBinaryAccessor(f),f=i.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,m));const C=a.length;for(e=0;e<C;++e){const U=a[e].length,k=a[e].instances,z=getBinaryProperties(U,k,t);a[e].instances=combine(z,k)}const b=new Array(C).fill(0),P=new Uint16Array(s);for(e=0;e<s;++e)n=o[e],P[e]=b[n],++b[n];const F={classes:a,classIds:o,classIndexes:P,parentCounts:d,parentIndexes:v,parentIds:f};return Jet(F),F}function Mg(r,t,e){if(!r)return;const n=r.parentCounts;return r.parentIds?e(r,t):n>0?Zet(r,t,e):Yet(r,t,e)}function Zet(r,t,e){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,d=scratchVisited;d.length=Math.max(d.length,o);const f=++marker,m=scratchStack;for(m.length=0,m.push(t);m.length>0;){if(t=m.pop(),d[t]===f)continue;d[t]=f;const v=e(r,t);if(Uu(v))return v;const C=i[t],b=a[t];for(let P=0;P<C;++P){const F=s[b+P];F!==t&&m.push(F)}}return null}function Yet(r,t,e){let n=!0;for(;n;){const i=e(r,t);if(Uu(i))return i;const s=r.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function Jet(r){const e=r.classIds.length;for(let n=0;n<e;++n)vM(r,n,stack)}function vM(r,t,e){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!Uu(i))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const d=Uu(n)?n[t]:1,f=Uu(n)?s[t]:t;for(let m=0;m<d;++m){const v=i[f+m];v!==t&&vM(r,v,e)}e.pop(t)}function Za(r){return r!=null}const ly=(r,t)=>r,trt={HIERARCHY:!0,extensions:!0,extras:!0};class bM{constructor(t,e,n){var i;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};$(this,"json",void 0),$(this,"binary",void 0),$(this,"featureCount",void 0),$(this,"_extensions",void 0),$(this,"_properties",void 0),$(this,"_binaryProperties",void 0),$(this,"_hierarchy",void 0),Oi(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)trt[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=$et(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Oi(typeof e=="string",e),this._hierarchy){const n=Mg(this._hierarchy,t,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===e});return Za(n)}return!1}isExactClass(t,e){return Oi(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Oi(typeof e=="string",e),Za(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=Za(e)?e:[],e.length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Oi(typeof e=="string",e),this._binaryProperties){const i=this._binaryProperties[e];if(Za(i))return this._getBinaryProperty(i,t)}const n=this._properties[e];if(Za(n))return ly(n[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(Za(i))return i}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),Oi(typeof e=="string",e),this._binaryProperties){const a=this._binaryProperties[e];if(a){this._setBinaryProperty(a,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let s=this._properties[e];Za(s)||(this._properties[e]=new Array(i),s=this._properties[e]),s[t]=ly(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;Oi(this.binary,"Property ".concat(t," requires a batch table binary.")),Oi(n.type,"Property ".concat(t," requires a type."));const i=Wet(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Mg(this._hierarchy,t,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return Za(o[e])});return Za(n)}_getPropertyNamesInHierarchy(t,e){Mg(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&e.indexOf(o)===-1&&e.push(o)})}_getHierarchyProperty(t,e){return Mg(this._hierarchy,t,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],d=a.instances[e];return Za(d)?Za(d.typedArray)?this._getBinaryProperty(d,o):ly(d[o]):null})}_setHierarchyProperty(t,e,n,i){const s=Mg(this._hierarchy,e,(a,o)=>{const d=a.classIds[o],f=a.classes[d],m=a.classIndexes[o],v=f.instances[n];return Za(v)?(Oi(o===e,'Inherited property "'.concat(n,'" is read-only.')),Za(v.typedArray)?this._setBinaryProperty(v,m,i):v[m]=ly(i),!0):!1});return Za(s)}}const Cw=4;function cy(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const n=new DataView(t);if(r.magic=n.getUint32(e,!0),e+=Cw,r.version=n.getUint32(e,!0),e+=Cw,r.byteLength=n.getUint32(e,!0),e+=Cw,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return e}const Ff=4,wM="b3dm tile in legacy format.";function Ew(r,t,e){const n=new DataView(t);let i;r.header=r.header||{};let s=n.getUint32(e,!0);e+=Ff;let a=n.getUint32(e,!0);e+=Ff;let o=n.getUint32(e,!0);e+=Ff;let d=n.getUint32(e,!0);return e+=Ff,o>=570425344?(e-=Ff*2,i=s,o=a,d=0,s=0,a=0,console.warn(wM)):d>=570425344&&(e-=Ff,i=o,o=s,d=a,s=0,a=0,console.warn(wM)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=d,r.header.batchLength=i,e}function Tw(r,t,e,n){return e=ert(r,t,e),e=rrt(r,t,e),e}function ert(r,t,e,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},i>0){const o=mM(t,e,i);r.featureTableJson=JSON.parse(o)}return e+=i,r.featureTableBinary=new Uint8Array(t,e,s),e+=s,e}function rrt(r,t,e,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header;if(i>0){const a=mM(t,e,i);r.batchTableJson=JSON.parse(a),e+=i,s>0&&(r.batchTableBinary=new Uint8Array(t,e,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),e+=s)}return e}function xM(r,t,e){if(!t&&(!r||!r.batchIds||!e))return null;const{batchIds:n,isRGB565:i,pointCount:s}=r;if(n&&e){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const d=n[o],m=e.getProperty(d,"dimensions").map(v=>v*255);a[o*3]=m[0],a[o*3+1]=m[1],a[o*3+2]=m[2]}return{type:ei.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const d=Het(t[o]);a[o*3]=d[0],a[o*3+1]=d[1],a[o*3+2]=d[2]}return{type:ei.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return t&&t.length===s*3?{type:ei.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:ei.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const BM=new Ie;function nrt(r,t){if(!t)return null;if(r.isOctEncoded16P){const e=new Float32Array(r.pointsLength*3);for(let n=0;n<r.pointsLength;n++)Get(t[n*2],t[n*2+1],BM),BM.toArray(e,n*3);return{type:ei.FLOAT,size:2,value:e}}return{type:ei.FLOAT,size:2,value:t}}function irt(r,t,e){return r.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,srt(r,t)):{type:ei.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function srt(r,t){const e=new Ie,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)e.set(t[i*3],t[i*3+1],t[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function ort(r,t,e,n,i){e=cy(r,t,e),e=Ew(r,t,e),e=Tw(r,t,e),art(r);const{featureTable:s,batchTable:a}=lrt(r);return await drt(r,s,a,n,i),crt(r,s,n),urt(r,s,a),hrt(r,s),e}function art(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function lrt(r){const t=new Bw(r.featureTableJson,r.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,r.featuresLength=e,r.pointsLength=e,r.pointCount=e,r.rtcCenter=t.getGlobalProperty("RTC_CENTER",ei.FLOAT,3);const n=Art(r,t);return{featureTable:t,batchTable:n}}function crt(r,t,e){if(!r.attributes.positions){if(t.hasProperty("POSITION"))r.attributes.positions=t.getPropertyArray("POSITION",ei.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",ei.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ei.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ei.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=irt(r,n,e)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function urt(r,t,e){if(!r.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",ei.UNSIGNED_BYTE,4),r.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",ei.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",ei.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=xM(r,n,e)}t.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",ei.UNSIGNED_BYTE,4))}function hrt(r,t){if(!r.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",ei.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",ei.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=nrt(r,e)}}function Art(r,t){let e=null;if(!r.batchIds&&t.hasProperty("BATCH_ID")&&(r.batchIds=t.getPropertyArray("BATCH_ID",ei.UNSIGNED_SHORT,1),r.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;e=new bM(i,s,n)}return e}async function drt(r,t,e,n,i){let s,a,o;const d=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];d&&(o=d.properties);const f=t.getExtension("3DTILES_draco_point_compression");if(f){a=f.properties;const v=f.byteOffset,C=f.byteLength;if(!a||!Number.isFinite(v)||!C)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=r.featureTableBinary.slice(v,v+C),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const m={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await frt(r,m,n,i)}async function frt(r,t,e,n){const{parse:i}=n,s={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const a=await i(t.buffer,DP,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,d=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,f=a.attributes.NORMAL&&a.attributes.NORMAL.value,m=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,v=o&&a.attributes.POSITION.value.quantization,C=f&&a.attributes.NORMAL.value.quantization;if(v){const P=a.POSITION.data.quantization,F=P.range;r.quantizedVolumeScale=new Ie(F,F,F),r.quantizedVolumeOffset=new Ie(P.minValues),r.quantizedRange=(1<<P.quantizationBits)-1,r.isQuantizedDraco=!0}C&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const b={};if(t.batchTableProperties)for(const P of Object.keys(t.batchTableProperties))a.attributes[P]&&a.attributes[P].value&&(b[P.toLowerCase()]=a.attributes[P].value);r.attributes={positions:o,colors:xM(r,d,void 0),normals:f,batchIds:m,...b}}const Sw={URI:0,EMBEDDED:1};function CM(r,t,e,n){r.rotateYtoZ=!0;const i=r.byteOffset+r.byteLength-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=Z_(t,e,i),r.gltfByteOffset=0,r.gltfByteLength=i,e%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function EM(r,t,e,n){const i=e["3d-tiles"]||{};if(prt(r,t),i.loadGLTF){const{parse:s,fetch:a}=n;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,e),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await s(r.gltfArrayBuffer,Sg,e,n),r.gpuMemoryUsageInBytes=LP(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function prt(r,t,e){switch(t){case Sw.URI:const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case Sw.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function grt(r,t,e,n,i){var s;e=mrt(r,t,e,n),await EM(r,Sw.EMBEDDED,n,i);const a=r==null||(s=r.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),e}function mrt(r,t,e,n,i){e=cy(r,t,e),e=Ew(r,t,e),e=Tw(r,t,e),e=CM(r,t,e,n);const s=new Bw(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",ei.FLOAT,3),e}async function yrt(r,t,e,n,i){return e=_rt(r,t,e,n),await EM(r,r.gltfFormat,n,i),e}function _rt(r,t,e,n,i){if(e=cy(r,t,e),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));e=Ew(r,t,e);const s=new DataView(t);if(r.gltfFormat=s.getUint32(e,!0),e+=4,e=Tw(r,t,e),e=CM(r,t,e,n),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new Bw(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",ei.FLOAT,3);const d=new bM(r.batchTableJson,r.batchTableBinary,o);return vrt(r,a,d,o),e}function vrt(r,t,e,n){const s={instances:new Array(n),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new Ie;new Ie,new Ie,new Ie;const o=new fs,d=new lg,f=new Ie,m={},v=new Vn,C=[],b=[],P=new Ie,F=new Ie;for(let U=0;U<n;U++){let k;if(t.hasProperty("POSITION"))k=t.getProperty("POSITION",ei.FLOAT,3,U,a);else if(t.hasProperty("POSITION_QUANTIZED")){k=t.getProperty("POSITION_QUANTIZED",ei.UNSIGNED_SHORT,3,U,a);const it=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ei.FLOAT,3,P);if(!it)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const nt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ei.FLOAT,3,F);if(!nt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const wt=65535;for(let Ct=0;Ct<3;Ct++)k[Ct]=k[Ct]/wt*nt[Ct]+it[Ct]}if(!k)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(k),m.translation=a,r.normalUp=t.getProperty("NORMAL_UP",ei.FLOAT,3,U,C),r.normalRight=t.getProperty("NORMAL_RIGHT",ei.FLOAT,3,U,b),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",ei.UNSIGNED_SHORT,2,C),r.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",ei.UNSIGNED_SHORT,2,b),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(cs.WGS84.eastNorthUpToFixedFrame(a,v),v.getRotationMatrix3(o)):o.identity()}d.fromMatrix3(o),m.rotation=d,f.set(1,1,1);const z=t.getProperty("SCALE",ei.FLOAT,1,U);Number.isFinite(z)&&f.multiplyByScalar(z);const K=t.getProperty("SCALE_NON_UNIFORM",ei.FLOAT,3,U,C);K&&f.scale(K),m.scale=f;let G=t.getProperty("BATCH_ID",ei.UNSIGNED_SHORT,1,U);G===void 0&&(G=U);const X=new Vn().fromQuaternion(m.rotation);v.identity(),v.translate(m.translation),v.multiplyRight(X),v.scale(m.scale);const Y=v.clone();s[U]={modelMatrix:Y,batchId:G}}r.instances=s}async function brt(r,t,e,n,i,s){e=cy(r,t,e);const a=new DataView(t);for(r.tilesLength=a.getUint32(e,!0),e+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-e>12;){const o={};r.tiles.push(o),e=await s(t,e,n,i,o)}return e}async function wrt(r,t,e,n){r.rotateYtoZ=!0,r.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;r.gltf=await i(t,Sg,e,n),r.gpuMemoryUsageInBytes=LP(r.gltf)}async function TM(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=t,i.type=Net(r,t),i.type){case Pg.COMPOSITE:return await brt(i,r,t,e,n,TM);case Pg.BATCHED_3D_MODEL:return await grt(i,r,t,e,n);case Pg.GLTF:return await wrt(i,r,e,n);case Pg.INSTANCED_3D_MODEL:return await yrt(i,r,t,e,n);case Pg.POINT_CLOUD:return await ort(i,r,t,e,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const xrt=1952609651,Brt=1;async function Crt(r,t,e){if(new Uint32Array(r.slice(0,4))[0]!==xrt)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==Brt)throw new Error("Wrong subtree file verson, must be 1");const s=SM(r.slice(8,16)),a=new Uint8Array(r,24,s),d=new TextDecoder("utf8").decode(a),f=JSON.parse(d),m=SM(r.slice(16,24));let v=new ArrayBuffer(0);return m&&(v=r.slice(24+s)),"bufferView"in f.tileAvailability&&(f.tileAvailability.explicitBitstream=await Iw(f,"tileAvailability",v,e)),"bufferView"in f.contentAvailability&&(f.contentAvailability.explicitBitstream=await Iw(f,"contentAvailability",v,e)),"bufferView"in f.childSubtreeAvailability&&(f.childSubtreeAvailability.explicitBitstream=await Iw(f,"childSubtreeAvailability",v,e)),f}function Ert(r,t){if(t.startsWith("http")){const s=new URL(r,t);return decodeURI(s.toString())}const n="http://".concat(t),i=new URL(r,n);return"/".concat(i.host).concat(i.pathname)}async function Iw(r,t,e,n){const i=r[t].bufferView,s=r.bufferViews[i],a=r.buffers[s.buffer];if(!(n!=null&&n.url)||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const o=Ert(a.uri,n==null?void 0:n.url),f=await(await n.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(e,s.byteOffset,s.byteLength)}function SM(r){const t=new DataView(r),e=t.getUint32(0,!0),n=t.getUint32(4,!0);return e+2**32*n}const IM={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:gM,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Crt,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Zl=null;try{Zl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function wi(r,t,e){this.low=r|0,this.high=t|0,this.unsigned=!!e}wi.prototype.__isLong__,Object.defineProperty(wi.prototype,"__isLong__",{value:!0});function sa(r){return(r&&r.__isLong__)===!0}function PM(r){var t=Math.clz32(r&-r);return r?31-t:t}wi.isLong=sa;var MM={},FM={};function fd(r,t){var e,n,i;return t?(r>>>=0,(i=0<=r&&r<256)&&(n=FM[r],n)?n:(e=ai(r,0,!0),i&&(FM[r]=e),e)):(r|=0,(i=-128<=r&&r<128)&&(n=MM[r],n)?n:(e=ai(r,r<0?-1:0,!1),i&&(MM[r]=e),e))}wi.fromInt=fd;function Yl(r,t){if(isNaN(r))return t?Ch:Mc;if(t){if(r<0)return Ch;if(r>=RM)return kM}else{if(r<=-OM)return Ya;if(r+1>=OM)return NM}return r<0?Yl(-r,t).neg():ai(r%Lf|0,r/Lf|0,t)}wi.fromNumber=Yl;function ai(r,t,e){return new wi(r,t,e)}wi.fromBits=ai;var uy=Math.pow;function Pw(r,t,e){if(r.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return t?Ch:Mc;if(e=e||10,e<2||36<e)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Pw(r.substring(1),t,e).neg();for(var i=Yl(uy(e,8)),s=Mc,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),d=parseInt(r.substring(a,a+o),e);if(o<8){var f=Yl(uy(e,o));s=s.mul(f).add(Yl(d))}else s=s.mul(i),s=s.add(Yl(d))}return s.unsigned=t,s}wi.fromString=Pw;function Pc(r,t){return typeof r=="number"?Yl(r,t):typeof r=="string"?Pw(r,t):ai(r.low,r.high,typeof t=="boolean"?t:r.unsigned)}wi.fromValue=Pc;var LM=65536,Trt=1<<24,Lf=LM*LM,RM=Lf*Lf,OM=RM/2,UM=fd(Trt),Mc=fd(0);wi.ZERO=Mc;var Ch=fd(0,!0);wi.UZERO=Ch;var Rf=fd(1);wi.ONE=Rf;var DM=fd(1,!0);wi.UONE=DM;var Mw=fd(-1);wi.NEG_ONE=Mw;var NM=ai(-1,2147483647,!1);wi.MAX_VALUE=NM;var kM=ai(-1,-1,!0);wi.MAX_UNSIGNED_VALUE=kM;var Ya=ai(0,-2147483648,!1);wi.MIN_VALUE=Ya;var wr=wi.prototype;wr.toInt=function(){return this.unsigned?this.low>>>0:this.low},wr.toNumber=function(){return this.unsigned?(this.high>>>0)*Lf+(this.low>>>0):this.high*Lf+(this.low>>>0)},wr.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ya)){var e=Yl(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=Yl(uy(t,6),this.unsigned),a=this,o="";;){var d=a.div(s),f=a.sub(d.mul(s)).toInt()>>>0,m=f.toString(t);if(a=d,a.isZero())return m+o;for(;m.length<6;)m="0"+m;o=""+m+o}},wr.getHighBits=function(){return this.high},wr.getHighBitsUnsigned=function(){return this.high>>>0},wr.getLowBits=function(){return this.low},wr.getLowBitsUnsigned=function(){return this.low>>>0},wr.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ya)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1},wr.isZero=function(){return this.high===0&&this.low===0},wr.eqz=wr.isZero,wr.isNegative=function(){return!this.unsigned&&this.high<0},wr.isPositive=function(){return this.unsigned||this.high>=0},wr.isOdd=function(){return(this.low&1)===1},wr.isEven=function(){return(this.low&1)===0},wr.equals=function(t){return sa(t)||(t=Pc(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},wr.eq=wr.equals,wr.notEquals=function(t){return!this.eq(t)},wr.neq=wr.notEquals,wr.ne=wr.notEquals,wr.lessThan=function(t){return this.comp(t)<0},wr.lt=wr.lessThan,wr.lessThanOrEqual=function(t){return this.comp(t)<=0},wr.lte=wr.lessThanOrEqual,wr.le=wr.lessThanOrEqual,wr.greaterThan=function(t){return this.comp(t)>0},wr.gt=wr.greaterThan,wr.greaterThanOrEqual=function(t){return this.comp(t)>=0},wr.gte=wr.greaterThanOrEqual,wr.ge=wr.greaterThanOrEqual,wr.compare=function(t){if(sa(t)||(t=Pc(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},wr.comp=wr.compare,wr.negate=function(){return!this.unsigned&&this.eq(Ya)?Ya:this.not().add(Rf)},wr.neg=wr.negate,wr.add=function(t){sa(t)||(t=Pc(t));var e=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,o=t.high&65535,d=t.low>>>16,f=t.low&65535,m=0,v=0,C=0,b=0;return b+=s+f,C+=b>>>16,b&=65535,C+=i+d,v+=C>>>16,C&=65535,v+=n+o,m+=v>>>16,v&=65535,m+=e+a,m&=65535,ai(C<<16|b,m<<16|v,this.unsigned)},wr.subtract=function(t){return sa(t)||(t=Pc(t)),this.add(t.neg())},wr.sub=wr.subtract,wr.multiply=function(t){if(this.isZero())return this;if(sa(t)||(t=Pc(t)),Zl){var e=Zl.mul(this.low,this.high,t.low,t.high);return ai(e,Zl.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Ch:Mc;if(this.eq(Ya))return t.isOdd()?Ya:Mc;if(t.eq(Ya))return this.isOdd()?Ya:Mc;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(UM)&&t.lt(UM))return Yl(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=t.high>>>16,d=t.high&65535,f=t.low>>>16,m=t.low&65535,v=0,C=0,b=0,P=0;return P+=a*m,b+=P>>>16,P&=65535,b+=s*m,C+=b>>>16,b&=65535,b+=a*f,C+=b>>>16,b&=65535,C+=i*m,v+=C>>>16,C&=65535,C+=s*f,v+=C>>>16,C&=65535,C+=a*d,v+=C>>>16,C&=65535,v+=n*m+i*f+s*d+a*o,v&=65535,ai(b<<16|P,v<<16|C,this.unsigned)},wr.mul=wr.multiply,wr.divide=function(t){if(sa(t)||(t=Pc(t)),t.isZero())throw Error("division by zero");if(Zl){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Zl.div_u:Zl.div_s)(this.low,this.high,t.low,t.high);return ai(e,Zl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ch:Mc;var n,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Ch;if(t.gt(this.shru(1)))return DM;s=Ch}else{if(this.eq(Ya)){if(t.eq(Rf)||t.eq(Mw))return Ya;if(t.eq(Ya))return Rf;var a=this.shr(1);return n=a.div(t).shl(1),n.eq(Mc)?t.isNegative()?Rf:Mw:(i=this.sub(t.mul(n)),s=n.add(i.div(t)),s)}else if(t.eq(Ya))return this.unsigned?Ch:Mc;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=Mc}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),d=o<=48?1:uy(2,o-48),f=Yl(n),m=f.mul(t);m.isNegative()||m.gt(i);)n-=d,f=Yl(n,this.unsigned),m=f.mul(t);f.isZero()&&(f=Rf),s=s.add(f),i=i.sub(m)}return s},wr.div=wr.divide,wr.modulo=function(t){if(sa(t)||(t=Pc(t)),Zl){var e=(this.unsigned?Zl.rem_u:Zl.rem_s)(this.low,this.high,t.low,t.high);return ai(e,Zl.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},wr.mod=wr.modulo,wr.rem=wr.modulo,wr.not=function(){return ai(~this.low,~this.high,this.unsigned)},wr.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},wr.clz=wr.countLeadingZeros,wr.countTrailingZeros=function(){return this.low?PM(this.low):PM(this.high)+32},wr.ctz=wr.countTrailingZeros,wr.and=function(t){return sa(t)||(t=Pc(t)),ai(this.low&t.low,this.high&t.high,this.unsigned)},wr.or=function(t){return sa(t)||(t=Pc(t)),ai(this.low|t.low,this.high|t.high,this.unsigned)},wr.xor=function(t){return sa(t)||(t=Pc(t)),ai(this.low^t.low,this.high^t.high,this.unsigned)},wr.shiftLeft=function(t){return sa(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ai(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):ai(0,this.low<<t-32,this.unsigned)},wr.shl=wr.shiftLeft,wr.shiftRight=function(t){return sa(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ai(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):ai(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},wr.shr=wr.shiftRight,wr.shiftRightUnsigned=function(t){return sa(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ai(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?ai(this.high,0,this.unsigned):ai(this.high>>>t-32,0,this.unsigned)},wr.shru=wr.shiftRightUnsigned,wr.shr_u=wr.shiftRightUnsigned,wr.rotateLeft=function(t){var e;return sa(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?ai(this.high,this.low,this.unsigned):t<32?(e=32-t,ai(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,ai(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},wr.rotl=wr.rotateLeft,wr.rotateRight=function(t){var e;return sa(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?ai(this.high,this.low,this.unsigned):t<32?(e=32-t,ai(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,ai(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},wr.rotr=wr.rotateRight,wr.toSigned=function(){return this.unsigned?ai(this.low,this.high,!1):this},wr.toUnsigned=function(){return this.unsigned?this:ai(this.low,this.high,!0)},wr.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},wr.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},wr.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},wi.fromBytes=function(t,e,n){return n?wi.fromBytesLE(t,e):wi.fromBytesBE(t,e)},wi.fromBytesLE=function(t,e){return new wi(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},wi.fromBytesBE=function(t,e){return new wi(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Srt=16;function QM(r){r==="X"&&(r="");const t=r.padEnd(Srt,"0");return wi.fromString(t,!0,16)}function Irt(r){if(r.isZero())return"X";let t=r.countTrailingZeros();const e=t%4;t=(t-e)/4;const n=t;t*=4;const s=r.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function Prt(r,t){const e=Mrt(r).shiftRightUnsigned(2);return r.add(wi.fromNumber(2*t+1-4).multiply(e))}function Mrt(r){return r.and(r.not().add(1))}const Frt=3,Lrt=2*30+1,zM=180/Math.PI;function Rrt(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const t=r.split("/"),e=parseInt(t[0],10),n=t[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const d=n[o];let f=0,m=0;d==="1"?m=1:d==="2"?(f=1,m=1):d==="3"&&(f=1);const v=Math.pow(2,s-1);Urt(v,a,f,m),a[0]+=v*f,a[1]+=v*m}if(e%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:e,ij:a,level:s}}function Ort(r){if(r.isZero())return"";let t=r.toString(2);for(;t.length<Frt+Lrt;)t="0"+t;const e=t.lastIndexOf("1"),n=t.substring(0,3),i=t.substring(3,e),s=i.length/2,a=wi.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=wi.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function HM(r,t,e){const n=1<<t;return[(r[0]+e[0])/n,(r[1]+e[1])/n]}function VM(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function GM(r){return[VM(r[0]),VM(r[1])]}function jM(r,t){let[e,n]=t;switch(r){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function qM(r){let[t,e,n]=r;const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*zM,i*zM]}function Urt(r,t,e,n){if(n===0){e===1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function Drt(r){const t=HM(r.ij,r.level,[.5,.5]),e=GM(t),n=jM(r.face,e);return qM(n)}const Nrt=100;function KM(r){const{face:t,ij:e,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Nrt*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,d=0;for(let f=0;f<4;f++){const m=i[f].slice(0),v=i[f+1],C=(v[0]-m[0])/s,b=(v[1]-m[1])/s;for(let P=0;P<s;P++){m[0]+=C,m[1]+=b;const F=HM(e,n,m),U=GM(F),k=jM(t,U),z=qM(k);Math.abs(z[1])>89.999&&(z[0]=d);const K=z[0]-d;z[0]+=K>180?-360:K<-180?360:0,a[o++]=z[0],a[o++]=z[1],d=z[0]}}return a[o++]=a[0],a[o++]=a[1],a}function Fw(r){const t=krt(r);return Rrt(t)}function krt(r){if(r.indexOf("/")>0)return r;const t=QM(r);return Ort(t)}function Qrt(r){const t=Fw(r);return Drt(t)}function zrt(r){let t;if(r.face===2||r.face===5){let e=null,n=0;for(let i=0;i<4;i++){const s="".concat(r.face,"/").concat(i),a=Fw(s),o=KM(a);(typeof e>"u"||e===null)&&(e=new Float64Array(4*o.length)),e.set(o,n),n+=o.length}t=WM(e)}else{const e=KM(r);t=WM(e)}return t}function WM(r){if(r.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let n=0;n<r.length;n+=2)t.push(r[n]),e.push(r[n+1]);return t.sort((n,i)=>n-i),e.sort((n,i)=>n-i),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function Hrt(r,t){const e=(t==null?void 0:t.minimumHeight)||0,n=(t==null?void 0:t.maximumHeight)||0,i=Fw(r),s=zrt(i),a=s.west,o=s.south,d=s.east,f=s.north,m=[];return m.push(new Ie(a,f,e)),m.push(new Ie(d,f,e)),m.push(new Ie(d,o,e)),m.push(new Ie(a,o,e)),m.push(new Ie(a,f,n)),m.push(new Ie(d,f,n)),m.push(new Ie(d,o,n)),m.push(new Ie(a,o,n)),m}function $M(r){const t=r.token,e={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=Hrt(t,e),i=Qrt(t),s=i[0],a=i[1],o=cs.WGS84.cartographicToCartesian([s,a,e.maximumHeight]),d=new Ie(o[0],o[1],o[2]);n.push(d);const f=vZ(n);return[...f.center,...f.halfAxes]}const Vrt={QUADTREE:4,OCTREE:8};function Grt(r,t,e){if(r!=null&&r.box){const n=QM(r.s2VolumeInfo.token),i=Prt(n,t),s=Irt(i),a={...r.s2VolumeInfo};switch(a.token=s,e){case"OCTREE":const f=r.s2VolumeInfo,m=f.maximumHeight-f.minimumHeight,v=m/2,C=f.minimumHeight+m/2;f.minimumHeight=C-v,f.maximumHeight=C+v;break}return{box:$M(a),s2VolumeInfo:a}}}async function XM(r){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=r;let{subtree:a,level:o=0}=r;const{subdivisionScheme:d,subtreeLevels:f,maximumLevel:m,contentUrlTemplate:v,subtreesUriTemplate:C,basePath:b}=t,P={children:[],lodMetricValue:0,contentUrl:""},F=Vrt[d],U=n&1,k=n>>1&1,z=n>>2&1,K=(F**o-1)/(F-1);let G=pd(e.mortonIndex,n),X=K+G,Y=pd(e.x,U),it=pd(e.y,k),nt=pd(e.z,z),wt=!1;o+1>f&&(wt=Lw(a.childSubtreeAvailability,G));const Ct=pd(i.x,Y),st=pd(i.y,it),ot=pd(i.z,nt),vt=o+i.level;if(wt){const Zt="".concat(b,"/").concat(C),oe=Rw(Zt,vt,Ct,st,ot);a=await oA(oe,IM),i.mortonIndex=G,i.x=Y,i.y=it,i.z=nt,i.level=o,G=0,X=0,Y=0,it=0,nt=0,o=0}if(!Lw(a.tileAvailability,X)||o>m)return P;Lw(a.contentAvailability,X)&&(P.contentUrl=Rw(v,vt,Ct,st,ot));const Wt=o+1,ee={mortonIndex:G,x:Y,y:it,z:nt};for(let Zt=0;Zt<F;Zt++){const oe=Grt(s,Zt,d),pe=await XM({subtree:a,options:t,parentData:ee,childIndex:Zt,level:Wt,globalData:i,s2VolumeBox:oe});if(pe.contentUrl||pe.children.length){const De=vt+1,Tt=jrt(pe,De,{childTileX:Y,childTileY:it,childTileZ:nt},t,s);P.children.push(Tt)}}return P}function Lw(r,t){return"constant"in r?!!r.constant:r.explicitBitstream?Wrt(t,r.explicitBitstream):!1}function jrt(r,t,e,n,i){const{basePath:s,refine:a,getRefine:o,lodMetricType:d,getTileType:f,rootLodMetricValue:m,rootBoundingVolume:v}=n,C=r.contentUrl&&r.contentUrl.replace("".concat(s,"/"),""),b=m/2**t,P=i!=null&&i.box?{box:i.box}:v,F=qrt(t,P,e);return{children:r.children,contentUrl:r.contentUrl,content:{uri:C},id:r.contentUrl,refine:o(a),type:f(r),lodMetricType:d,lodMetricValue:b,geometricError:b,transform:r.transform,boundingVolume:F}}function qrt(r,t,e){if(t.region){const{childTileX:n,childTileY:i,childTileZ:s}=e,[a,o,d,f,m,v]=t.region,C=2**r,b=(d-a)/C,P=(f-o)/C,F=(v-m)/C,[U,k]=[a+b*n,a+b*(n+1)],[z,K]=[o+P*i,o+P*(i+1)],[G,X]=[m+F*s,m+F*(s+1)];return{region:[U,z,k,K,G,X]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function pd(r,t){return parseInt(r.toString(2)+t.toString(2),2)}function Rw(r,t,e,n,i){const s=Krt({level:t,x:e,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Krt(r){const t={};for(const e in r)t["{".concat(e,"}")]=r[e];return t}function Wrt(r,t){const e=Math.floor(r/8),n=r%8;return(t[e]>>n&1)===1}function Ow(r){if(!r.contentUrl)return Mf.EMPTY;const e=r.contentUrl.split("?")[0].split(".").pop();switch(e){case"pnts":return Mf.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Mf.SCENEGRAPH;default:return e}}function Uw(r){switch(r){case"REPLACE":case"replace":return Bh.REPLACE;case"ADD":case"add":return Bh.ADD;default:return r}}function Dw(r,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(r,"".concat(t,"/"));return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return"".concat(t,"/").concat(r)}function ZM(r,t){if(!r)return null;if(r.content){const e=r.content.uri||r.content.url;r.contentUrl=Dw(e,t.basePath)}return r.id=r.contentUrl,r.lodMetricType=iy.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=Ow(r),r.refine=Uw(r.refine),r}async function $rt(r,t){const e=r.basePath;let n;const i=JM(r==null?void 0:r.root);i&&r.root?n=await YM(r.root,r,i,t):n=ZM(r.root,r);const s=[];for(s.push(n);s.length>0;){const o=(s.pop()||{}).children||[];for(let d of o){const f=JM(d);f?d=await YM(d,r,f,t):ZM(d,{basePath:e}),s.push(d)}}return n}async function YM(r,t,e,n){var i,s;const a=t.basePath,{subdivisionScheme:o,maximumLevel:d,subtreeLevels:f,subtrees:{uri:m}}=e,v=Rw(m,0,0,0,0),C=Dw(v,a),b=await oA(C,IM,n),P=Dw(r.content.uri,a),F=t==null||(i=t.root)===null||i===void 0?void 0:i.refine,U=r.geometricError,k=(s=r.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(k){const X={box:$M(k),s2VolumeInfo:k};r.boundingVolume=X}const z=r.boundingVolume,K={contentUrlTemplate:P,subtreesUriTemplate:m,subdivisionScheme:o,subtreeLevels:f,maximumLevel:d,refine:F,basePath:a,lodMetricType:iy.GEOMETRIC_ERROR,rootLodMetricValue:U,rootBoundingVolume:z,getTileType:Ow,getRefine:Uw};return await Xrt(r,b,K)}async function Xrt(r,t,e){if(!r)return null;r.lodMetricType=iy.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:n,contentUrl:i}=await XM({subtree:t,options:e,s2VolumeBox:r});return i&&(r.contentUrl=i,r.content={uri:i.replace("".concat(e.basePath,"/"),"")}),r.refine=Uw(r.refine),r.type=Ow(r),r.children=n,r.id=r.contentUrl,r}function JM(r){var t;return(r==null||(t=r.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const Nw={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:gM,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:tnt,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Zrt(r){return Y_(r.url)}async function Yrt(r,t,e){const n={content:{featureIds:null}};return await TM(r,0,t,e,n.content),n.content}async function Jrt(r,t,e){var n;const i=JSON.parse(new TextDecoder().decode(r));return i.loader=t.loader||Nw,i.url=e.url,i.queryString=e.queryString,i.basePath=Zrt(i),i.root=await $rt(i,t),i.type=Xl.TILES3D,i.lodMetricType=iy.GEOMETRIC_ERROR,i.lodMetricValue=((n=i.root)===null||n===void 0?void 0:n.lodMetricValue)||0,i}async function tnt(r,t,e){const n=t["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=e.url&&e.url.indexOf(".json")!==-1:i=n.isTileset,i?r=await Jrt(r,t,e):r=await Yrt(r,t,e),r}const tF=[0],ent={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Nw,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,t,e)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class kw extends Q3{constructor(){super(...arguments),$(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&$n.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:n,changeFlags:i}=t;if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=n==null?void 0:n[t.id];(!i||!t.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:n}=t;const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer(t){let{layer:e,viewport:n}=t;const{tile:i}=e.props,{id:s}=n;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[e==null?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};let s=t;if(n.preload){const d=await n.preload(t,e);d.url&&(s=d.url),d.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:d.headers}),Object.assign(i,d)}const a=await oA(s,n,i.loadOptions),o=new Det(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;!n||!i||!e||e.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Mf.POINTCLOUD:return this._makePointCloudLayer(t,e);case Mf.SCENEGRAPH:return this._make3DModelLayer(t);case Mf.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=t.content,{positions:d,normals:f,colors:m}=n;if(!d)return null;const v=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:d,NORMAL:f,COLOR_0:m}},{pointSize:C,getPointColor:b}=this.props,P=this.getSubLayerClass("pointcloud",Vb);return new P({pointSize:C},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:v,coordinateSystem:jn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||b,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:s}=t.content,a=this.getSubLayerClass("scenegraph",lw);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||tF,scenegraph:e,coordinateSystem:jn.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:d=jn.METER_OFFSETS,material:f,featureIds:m}=n,{_getMeshColor:v}=this.props,C=e&&e.props.mesh||new hg({drawMode:4,attributes:rnt(i),indices:s}),b=this.getSubLayerClass("mesh",cw);return new b(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:C,data:tF,getColor:v(t),pbrMaterial:f,modelMatrix:a,coordinateOrigin:o,coordinateSystem:d,featureIds:m,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(n=>{const i=e[n.id]=e[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}$(kw,"defaultProps",ent),$(kw,"layerName","Tile3DLayer");function rnt(r){const t={};return t.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(t.normals=r.normals),r.texCoords&&(t.texCoords=r.texCoords),r.colors&&(t.colors=r.colors),r.uvRegions&&(t.uvRegions=r.uvRegions),t}var nnt=Object.defineProperty,int=(r,t,e)=>t in r?nnt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ri=(r,t,e)=>int(r,typeof t!="symbol"?t+"":t,e);let snt=class{constructor(t){ri(this,"map"),ri(this,"width"),ri(this,"height"),ri(this,"svgCanvas"),ri(this,"xLine"),ri(this,"yLine"),ri(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=e.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const Qw={72:72,96:96,200:200,300:300,400:400},Eh={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Fg={Landscape:"landscape",Portrait:"portrait"},gd={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Of={in:"in",mm:"mm"};let ont=class{constructor(t){ri(this,"map"),ri(this,"width"),ri(this,"height"),ri(this,"unit"),ri(this,"svgCanvas"),ri(this,"svgPath");var e,n,i;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(n=this.map)==null?void 0:n.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("style","fill:#888888;stroke-width:0"),d.setAttribute("fill-opacity","0.5"),o.append(d),(i=this.map)==null||i.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=d}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=Of.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const n=this.toPixels(this.width),i=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(e=this.map)==null?void 0:e.getCanvas().clientHeight,o=s/2-n/2,d=o+n,f=a/2-i/2,m=f+i;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${f} L ${o} ${m} L ${d} ${m} L ${d} ${f}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Of.mm&&(e/=25.4),e*t}};const eF={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},ant={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},lnt={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},cnt={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},unt={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},hnt={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},Ant={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},dnt={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},fnt={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},pnt={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},gnt={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},mnt={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},ynt={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},_nt=[eF,ant,lnt,cnt,unt,hnt,Ant,dnt,fnt,pnt,gnt,mnt,ynt],vnt=r=>_nt.find(t=>t.LanguageCode===r)??eF;function li(r){"@babel/helpers - typeof";return li=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},li(r)}var oa=Uint8Array,Bl=Uint16Array,zw=Int32Array,hy=new oa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ay=new oa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hw=new oa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rF=function(r,t){for(var e=new Bl(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new zw(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return{b:e,r:i}},nF=rF(hy,2),iF=nF.b,Vw=nF.r;iF[28]=258,Vw[258]=28;for(var sF=rF(Ay,0),bnt=sF.b,oF=sF.r,Gw=new Bl(32768),$i=0;$i<32768;++$i){var _A=($i&43690)>>1|($i&21845)<<1;_A=(_A&52428)>>2|(_A&13107)<<2,_A=(_A&61680)>>4|(_A&3855)<<4,Gw[$i]=((_A&65280)>>8|(_A&255)<<8)>>1}for(var Du=function(r,t,e){for(var n=r.length,i=0,s=new Bl(t);i<n;++i)r[i]&&++s[r[i]-1];var a=new Bl(t);for(i=1;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(e){o=new Bl(1<<t);var d=15-t;for(i=0;i<n;++i)if(r[i])for(var f=i<<4|r[i],m=t-r[i],v=a[r[i]-1]++<<m,C=v|(1<<m)-1;v<=C;++v)o[Gw[v]>>d]=f}else for(o=new Bl(n),i=0;i<n;++i)r[i]&&(o[i]=Gw[a[r[i]-1]++]>>15-r[i]);return o},vA=new oa(288),$i=0;$i<144;++$i)vA[$i]=8;for(var $i=144;$i<256;++$i)vA[$i]=9;for(var $i=256;$i<280;++$i)vA[$i]=7;for(var $i=280;$i<288;++$i)vA[$i]=8;for(var Lg=new oa(32),$i=0;$i<32;++$i)Lg[$i]=5;var wnt=Du(vA,9,0),xnt=Du(vA,9,1),Bnt=Du(Lg,5,0),Cnt=Du(Lg,5,1),jw=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Fc=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},qw=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},Kw=function(r){return(r+7)/8|0},aF=function(r,t,e){return(e==null||e>r.length)&&(e=r.length),new oa(r.subarray(t,e))},Ent=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lc=function(r,t,e){var n=new Error(t||Ent[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Lc),!e)throw n;return n},Tnt=function(r,t,e,n){var i=r.length,s=0;if(!i||t.f&&!t.l)return e||new oa(0);var a=!e,o=a||t.i!=2,d=t.i;a&&(e=new oa(i*3));var f=function(Ve){var Je=e.length;if(Ve>Je){var or=new oa(Math.max(Je*2,Ve));or.set(e),e=or}},m=t.f||0,v=t.p||0,C=t.b||0,b=t.l,P=t.d,F=t.m,U=t.n,k=i*8;do{if(!b){m=Fc(r,v,1);var z=Fc(r,v+1,3);if(v+=3,z)if(z==1)b=xnt,P=Cnt,F=9,U=5;else if(z==2){var K=Fc(r,v,31)+257,G=Fc(r,v+10,15)+4,X=K+Fc(r,v+5,31)+1;v+=14;for(var Y=new oa(X),it=new oa(19),nt=0;nt<G;++nt)it[Hw[nt]]=Fc(r,v+nt*3,7);v+=G*3;for(var wt=jw(it),Ct=(1<<wt)-1,st=Du(it,wt,1),nt=0;nt<X;){var ot=st[Fc(r,v,Ct)];v+=ot&15;var vt=ot>>4;if(vt<16)Y[nt++]=vt;else{var yt=0,re=0;for(vt==16?(re=3+Fc(r,v,3),v+=2,yt=Y[nt-1]):vt==17?(re=3+Fc(r,v,7),v+=3):vt==18&&(re=11+Fc(r,v,127),v+=7);re--;)Y[nt++]=yt}}var Wt=Y.subarray(0,K),ee=Y.subarray(K);F=jw(Wt),U=jw(ee),b=Du(Wt,F,1),P=Du(ee,U,1)}else Lc(1);else{var vt=Kw(v)+4,Zt=r[vt-4]|r[vt-3]<<8,oe=vt+Zt;if(oe>i){d&&Lc(0);break}o&&f(C+Zt),e.set(r.subarray(vt,oe),C),t.b=C+=Zt,t.p=v=oe*8,t.f=m;continue}if(v>k){d&&Lc(0);break}}o&&f(C+131072);for(var pe=(1<<F)-1,De=(1<<U)-1,at=v;;at=v){var yt=b[qw(r,v)&pe],Tt=yt>>4;if(v+=yt&15,v>k){d&&Lc(0);break}if(yt||Lc(2),Tt<256)e[C++]=Tt;else if(Tt==256){at=v,b=null;break}else{var Rt=Tt-254;if(Tt>264){var nt=Tt-257,Nt=hy[nt];Rt=Fc(r,v,(1<<Nt)-1)+iF[nt],v+=Nt}var ae=P[qw(r,v)&De],Xt=ae>>4;ae||Lc(3),v+=ae&15;var ee=bnt[Xt];if(Xt>3){var Nt=Ay[Xt];ee+=qw(r,v)&(1<<Nt)-1,v+=Nt}if(v>k){d&&Lc(0);break}o&&f(C+131072);var ye=C+Rt;if(C<ee){var de=s-ee,qe=Math.min(ee,ye);for(de+C<0&&Lc(3);C<qe;++C)e[C]=n[de+C]}for(;C<ye;++C)e[C]=e[C-ee]}}t.l=b,t.p=at,t.b=C,t.f=m,b&&(m=1,t.m=F,t.d=P,t.n=U)}while(!m);return C!=e.length&&a?aF(e,0,C):e.subarray(0,C)},Th=function(r,t,e){e<<=t&7;var n=t/8|0;r[n]|=e,r[n+1]|=e>>8},Rg=function(r,t,e){e<<=t&7;var n=t/8|0;r[n]|=e,r[n+1]|=e>>8,r[n+2]|=e>>16},Ww=function(r,t){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var i=e.length,s=e.slice();if(!i)return{t:hF,l:0};if(i==1){var a=new oa(e[0].s+1);return a[e[0].s]=1,{t:a,l:1}}e.sort(function(X,Y){return X.f-Y.f}),e.push({s:-1,f:25001});var o=e[0],d=e[1],f=0,m=1,v=2;for(e[0]={s:-1,f:o.f+d.f,l:o,r:d};m!=i-1;)o=e[e[f].f<e[v].f?f++:v++],d=e[f!=m&&e[f].f<e[v].f?f++:v++],e[m++]={s:-1,f:o.f+d.f,l:o,r:d};for(var C=s[0].s,n=1;n<i;++n)s[n].s>C&&(C=s[n].s);var b=new Bl(C+1),P=$w(e[m-1],b,0);if(P>t){var n=0,F=0,U=P-t,k=1<<U;for(s.sort(function(Y,it){return b[it.s]-b[Y.s]||Y.f-it.f});n<i;++n){var z=s[n].s;if(b[z]>t)F+=k-(1<<P-b[z]),b[z]=t;else break}for(F>>=U;F>0;){var K=s[n].s;b[K]<t?F-=1<<t-b[K]++-1:++n}for(;n>=0&&F;--n){var G=s[n].s;b[G]==t&&(--b[G],++F)}P=t}return{t:new oa(b),l:P}},$w=function(r,t,e){return r.s==-1?Math.max($w(r.l,t,e+1),$w(r.r,t,e+1)):t[r.s]=e},lF=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new Bl(++t),n=0,i=r[0],s=1,a=function(d){e[n++]=d},o=1;o<=t;++o)if(r[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return{c:e.subarray(0,n),n:t}},Og=function(r,t){for(var e=0,n=0;n<t.length;++n)e+=r[n]*t[n];return e},cF=function(r,t,e){var n=e.length,i=Kw(t+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=e[s];return(i+4+n)*8},uF=function(r,t,e,n,i,s,a,o,d,f,m){Th(t,m++,e),++i[256];for(var v=Ww(i,15),C=v.t,b=v.l,P=Ww(s,15),F=P.t,U=P.l,k=lF(C),z=k.c,K=k.n,G=lF(F),X=G.c,Y=G.n,it=new Bl(19),nt=0;nt<z.length;++nt)++it[z[nt]&31];for(var nt=0;nt<X.length;++nt)++it[X[nt]&31];for(var wt=Ww(it,7),Ct=wt.t,st=wt.l,ot=19;ot>4&&!Ct[Hw[ot-1]];--ot);var vt=f+5<<3,yt=Og(i,vA)+Og(s,Lg)+a,re=Og(i,C)+Og(s,F)+a+14+3*ot+Og(it,Ct)+2*it[16]+3*it[17]+7*it[18];if(d>=0&&vt<=yt&&vt<=re)return cF(t,m,r.subarray(d,d+f));var Wt,ee,Zt,oe;if(Th(t,m,1+(re<yt)),m+=2,re<yt){Wt=Du(C,b,0),ee=C,Zt=Du(F,U,0),oe=F;var pe=Du(Ct,st,0);Th(t,m,K-257),Th(t,m+5,Y-1),Th(t,m+10,ot-4),m+=14;for(var nt=0;nt<ot;++nt)Th(t,m+3*nt,Ct[Hw[nt]]);m+=3*ot;for(var De=[z,X],at=0;at<2;++at)for(var Tt=De[at],nt=0;nt<Tt.length;++nt){var Rt=Tt[nt]&31;Th(t,m,pe[Rt]),m+=Ct[Rt],Rt>15&&(Th(t,m,Tt[nt]>>5&127),m+=Tt[nt]>>12)}}else Wt=wnt,ee=vA,Zt=Bnt,oe=Lg;for(var nt=0;nt<o;++nt){var Nt=n[nt];if(Nt>255){var Rt=Nt>>18&31;Rg(t,m,Wt[Rt+257]),m+=ee[Rt+257],Rt>7&&(Th(t,m,Nt>>23&31),m+=hy[Rt]);var ae=Nt&31;Rg(t,m,Zt[ae]),m+=oe[ae],ae>3&&(Rg(t,m,Nt>>5&8191),m+=Ay[ae])}else Rg(t,m,Wt[Nt]),m+=ee[Nt]}return Rg(t,m,Wt[256]),m+ee[256]},Snt=new zw([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),hF=new oa(0),Int=function(r,t,e,n,i,s){var a=s.z||r.length,o=new oa(n+a+5*(1+Math.ceil(a/7e3))+i),d=o.subarray(n,o.length-i),f=s.l,m=(s.r||0)&7;if(t){m&&(d[0]=s.r>>3);for(var v=Snt[t-1],C=v>>13,b=v&8191,P=(1<<e)-1,F=s.p||new Bl(32768),U=s.h||new Bl(P+1),k=Math.ceil(e/3),z=2*k,K=function(mr){return(r[mr]^r[mr+1]<<k^r[mr+2]<<z)&P},G=new zw(25e3),X=new Bl(288),Y=new Bl(32),it=0,nt=0,wt=s.i||0,Ct=0,st=s.w||0,ot=0;wt+2<a;++wt){var vt=K(wt),yt=wt&32767,re=U[vt];if(F[yt]=re,U[vt]=yt,st<=wt){var Wt=a-wt;if((it>7e3||Ct>24576)&&(Wt>423||!f)){m=uF(r,d,0,G,X,Y,nt,Ct,ot,wt-ot,m),Ct=it=nt=0,ot=wt;for(var ee=0;ee<286;++ee)X[ee]=0;for(var ee=0;ee<30;++ee)Y[ee]=0}var Zt=2,oe=0,pe=b,De=yt-re&32767;if(Wt>2&&vt==K(wt-De))for(var at=Math.min(C,Wt)-1,Tt=Math.min(32767,wt),Rt=Math.min(258,Wt);De<=Tt&&--pe&&yt!=re;){if(r[wt+Zt]==r[wt+Zt-De]){for(var Nt=0;Nt<Rt&&r[wt+Nt]==r[wt+Nt-De];++Nt);if(Nt>Zt){if(Zt=Nt,oe=De,Nt>at)break;for(var ae=Math.min(De,Nt-2),Xt=0,ee=0;ee<ae;++ee){var ye=wt-De+ee&32767,de=F[ye],qe=ye-de&32767;qe>Xt&&(Xt=qe,re=ye)}}}yt=re,re=F[yt],De+=yt-re&32767}if(oe){G[Ct++]=268435456|Vw[Zt]<<18|oF[oe];var Ve=Vw[Zt]&31,Je=oF[oe]&31;nt+=hy[Ve]+Ay[Je],++X[257+Ve],++Y[Je],st=wt+Zt,++it}else G[Ct++]=r[wt],++X[r[wt]]}}for(wt=Math.max(wt,st);wt<a;++wt)G[Ct++]=r[wt],++X[r[wt]];m=uF(r,d,f,G,X,Y,nt,Ct,ot,wt-ot,m),f||(s.r=m&7|d[m/8|0]<<3,m-=7,s.h=U,s.p=F,s.i=wt,s.w=st)}else{for(var wt=s.w||0;wt<a+f;wt+=65535){var or=wt+65535;or>=a&&(d[m/8|0]=f,or=a),m=cF(d,m+1,r.subarray(wt,or))}s.i=a}return aF(o,0,n+Kw(m)+i)},AF=function(){var r=1,t=0;return{p:function(e){for(var n=r,i=t,s=e.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=n+=e[a];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,t=i},d:function(){return r%=65521,t%=65521,(r&255)<<24|(r&65280)<<8|(t&255)<<8|t>>8}}},Pnt=function(r,t,e,n,i){if(!i&&(i={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new oa(s.length+r.length);a.set(s),a.set(r,s.length),r=a,i.w=s.length}return Int(r,t.level==null?6:t.level,t.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+t.mem,e,n,i)},dF=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},Mnt=function(r,t){var e=t.level,n=e==0?0:e<6?1:e==9?3:2;if(r[0]=120,r[1]=n<<6|(t.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,t.dictionary){var i=AF();i.p(t.dictionary),dF(r,2,i.d())}},Fnt=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Lc(6,"invalid zlib data"),(r[1]>>5&1)==1&&Lc(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Xw(r,t){t||(t={});var e=AF();e.p(r);var n=Pnt(r,t,t.dictionary?6:2,4);return Mnt(n,t),dF(n,n.length-4,e.d()),n}function Lnt(r,t){return Tnt(r.subarray(Fnt(r),-4),{i:2},t,t)}var Rnt=typeof TextDecoder<"u"&&new TextDecoder,Ont=0;try{Rnt.decode(hF,{stream:!0}),Ont=1}catch{}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.2 Built on 2024-09-17T13:29:57.859Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var un=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Zw(){un.console&&typeof un.console.log=="function"&&un.console.log.apply(un.console,arguments)}var Ui={log:Zw,warn:function(r){un.console&&(typeof un.console.warn=="function"?un.console.warn.apply(un.console,arguments):Zw.call(null,arguments))},error:function(r){un.console&&(typeof un.console.error=="function"?un.console.error.apply(un.console,arguments):Zw(r))}};function Yw(r,t,e){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){md(n.response,t,e)},n.onerror=function(){Ui.error("could not download file")},n.send()}function fF(r){var t=new XMLHttpRequest;t.open("HEAD",r,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function dy(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(t)}}var Ug,Jw,md=un.saveAs||((typeof window>"u"?"undefined":li(window))!=="object"||window!==un?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,t,e){var n=un.URL||un.webkitURL,i=document.createElement("a");t=t||r.name||"download",i.download=t,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?fF(i.href)?Yw(r,t,e):dy(i,i.target="_blank"):dy(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){dy(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,t,e){if(t=t||r.name||"download",typeof r=="string")if(fF(r))Yw(r,t,e);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){dy(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:li(s)!=="object"&&(Ui.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,e),t)}:function(r,t,e,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return Yw(r,t,e);var i=r.type==="application/octet-stream",s=/constructor/i.test(un.HTMLElement)||un.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":li(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var m=o.result;m=a?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=m:location=m,n=null},o.readAsDataURL(r)}else{var d=un.URL||un.webkitURL,f=d.createObjectURL(r);n?n.location=f:location.href=f,n=null,setTimeout(function(){d.revokeObjectURL(f)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function pF(r){var t;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),d=this.g.toString(16),f=this.b.toString(16);return o.length==1&&(o="0"+o),d.length==1&&(d="0"+d),f.length==1&&(f="0"+f),"#"+o+d+f}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function t2(r,t){var e=r[0],n=r[1],i=r[2],s=r[3];e=aa(e,n,i,s,t[0],7,-680876936),s=aa(s,e,n,i,t[1],12,-389564586),i=aa(i,s,e,n,t[2],17,606105819),n=aa(n,i,s,e,t[3],22,-1044525330),e=aa(e,n,i,s,t[4],7,-176418897),s=aa(s,e,n,i,t[5],12,1200080426),i=aa(i,s,e,n,t[6],17,-1473231341),n=aa(n,i,s,e,t[7],22,-45705983),e=aa(e,n,i,s,t[8],7,1770035416),s=aa(s,e,n,i,t[9],12,-1958414417),i=aa(i,s,e,n,t[10],17,-42063),n=aa(n,i,s,e,t[11],22,-1990404162),e=aa(e,n,i,s,t[12],7,1804603682),s=aa(s,e,n,i,t[13],12,-40341101),i=aa(i,s,e,n,t[14],17,-1502002290),e=la(e,n=aa(n,i,s,e,t[15],22,1236535329),i,s,t[1],5,-165796510),s=la(s,e,n,i,t[6],9,-1069501632),i=la(i,s,e,n,t[11],14,643717713),n=la(n,i,s,e,t[0],20,-373897302),e=la(e,n,i,s,t[5],5,-701558691),s=la(s,e,n,i,t[10],9,38016083),i=la(i,s,e,n,t[15],14,-660478335),n=la(n,i,s,e,t[4],20,-405537848),e=la(e,n,i,s,t[9],5,568446438),s=la(s,e,n,i,t[14],9,-1019803690),i=la(i,s,e,n,t[3],14,-187363961),n=la(n,i,s,e,t[8],20,1163531501),e=la(e,n,i,s,t[13],5,-1444681467),s=la(s,e,n,i,t[2],9,-51403784),i=la(i,s,e,n,t[7],14,1735328473),e=ca(e,n=la(n,i,s,e,t[12],20,-1926607734),i,s,t[5],4,-378558),s=ca(s,e,n,i,t[8],11,-2022574463),i=ca(i,s,e,n,t[11],16,1839030562),n=ca(n,i,s,e,t[14],23,-35309556),e=ca(e,n,i,s,t[1],4,-1530992060),s=ca(s,e,n,i,t[4],11,1272893353),i=ca(i,s,e,n,t[7],16,-155497632),n=ca(n,i,s,e,t[10],23,-1094730640),e=ca(e,n,i,s,t[13],4,681279174),s=ca(s,e,n,i,t[0],11,-358537222),i=ca(i,s,e,n,t[3],16,-722521979),n=ca(n,i,s,e,t[6],23,76029189),e=ca(e,n,i,s,t[9],4,-640364487),s=ca(s,e,n,i,t[12],11,-421815835),i=ca(i,s,e,n,t[15],16,530742520),e=ua(e,n=ca(n,i,s,e,t[2],23,-995338651),i,s,t[0],6,-198630844),s=ua(s,e,n,i,t[7],10,1126891415),i=ua(i,s,e,n,t[14],15,-1416354905),n=ua(n,i,s,e,t[5],21,-57434055),e=ua(e,n,i,s,t[12],6,1700485571),s=ua(s,e,n,i,t[3],10,-1894986606),i=ua(i,s,e,n,t[10],15,-1051523),n=ua(n,i,s,e,t[1],21,-2054922799),e=ua(e,n,i,s,t[8],6,1873313359),s=ua(s,e,n,i,t[15],10,-30611744),i=ua(i,s,e,n,t[6],15,-1560198380),n=ua(n,i,s,e,t[13],21,1309151649),e=ua(e,n,i,s,t[4],6,-145523070),s=ua(s,e,n,i,t[11],10,-1120210379),i=ua(i,s,e,n,t[2],15,718787259),n=ua(n,i,s,e,t[9],21,-343485551),r[0]=bA(e,r[0]),r[1]=bA(n,r[1]),r[2]=bA(i,r[2]),r[3]=bA(s,r[3])}function fy(r,t,e,n,i,s){return t=bA(bA(t,r),bA(n,s)),bA(t<<i|t>>>32-i,e)}function aa(r,t,e,n,i,s,a){return fy(t&e|~t&n,r,t,i,s,a)}function la(r,t,e,n,i,s,a){return fy(t&n|e&~n,r,t,i,s,a)}function ca(r,t,e,n,i,s,a){return fy(t^e^n,r,t,i,s,a)}function ua(r,t,e,n,i,s,a){return fy(e^(t|~n),r,t,i,s,a)}function gF(r){var t,e=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r.length;t+=64)t2(n,Unt(r.substring(t-64,t)));r=r.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r.length;t++)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(t2(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*e,t2(n,i),n}function Unt(r){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return e}Ug=un.atob.bind(un),Jw=un.btoa.bind(un);var mF="0123456789abcdef".split("");function Dnt(r){for(var t="",e=0;e<4;e++)t+=mF[r>>8*e+4&15]+mF[r>>8*e&15];return t}function Nnt(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function e2(r){return gF(r).map(Nnt).join("")}var knt=function(r){for(var t=0;t<r.length;t++)r[t]=Dnt(r[t]);return r.join("")}(gF("hello"))!="5d41402abc4b2a76b9719d911017c592";function bA(r,t){if(knt){var e=(65535&r)+(65535&t);return(r>>16)+(t>>16)+(e>>16)<<16|65535&e}return r+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function r2(r,t){var e,n,i,s;if(r!==e){for(var a=(i=r,s=1+(256/r.length>>0),new Array(s+1).join(i)),o=[],d=0;d<256;d++)o[d]=d;var f=0;for(d=0;d<256;d++){var m=o[d];f=(f+m+a.charCodeAt(d))%256,o[d]=o[f],o[f]=m}e=r,n=o}else o=n;var v=t.length,C=0,b=0,P="";for(d=0;d<v;d++)b=(b+(m=o[C=(C+1)%256]))%256,o[C]=o[b],o[b]=m,a=o[(o[C]+o[b])%256],P+=String.fromCharCode(t.charCodeAt(d)^a);return P}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var yF={print:4,modify:8,copy:16,"annot-forms":32};function Uf(r,t,e,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(yF.perm!==void 0)throw new Error("Invalid permission: "+o);i+=yF[o]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=e2(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=r2(this.encryptionKey,this.padding)}function Df(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var t="",e=r.length,n=0;n<e;n++){var i=r.charCodeAt(n);i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?t+="#"+("0"+i.toString(16)).slice(-2):t+=r[n]}return t}function _F(r){if(li(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,i){if(i=i||!1,typeof e!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[n,!!i],s},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(r,n)}catch(o){un.console&&Ui.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function py(r){if(!(this instanceof py))return new py(r);var t="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function vF(r,t){this.gState=r,this.matrix=t,this.id="",this.objectNumber=-1}function yd(r,t,e,n,i){if(!(this instanceof yd))return new yd(r,t,e,n,i);this.type=r==="axial"?2:3,this.coords=t,this.colors=e,vF.call(this,n,i)}function Nf(r,t,e,n,i){if(!(this instanceof Nf))return new Nf(r,t,e,n,i);this.boundingBox=r,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,vF.call(this,n,i)}function hn(r){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,d=16,f="S",m=null;li(r=r||{})==="object"&&(e=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(m=r.encryption||null)!==null&&(m.userPassword=m.userPassword||"",m.ownerPassword=m.ownerPassword||"",m.userPermissions=m.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(t=r.precision),r.floatPrecision!==void 0&&(d=r.floatPrecision),f=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",e=(""+(e||"P")).toLowerCase();var v=r.putOnlyUsedFonts||!1,C={},b={internal:{},__private__:{}};b.__private__.PubSub=_F;var P="1.3",F=b.__private__.getPdfVersion=function(){return P};b.__private__.setPdfVersion=function(D){P=D};var U={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};b.__private__.getPageFormats=function(){return U};var k=b.__private__.getPageFormat=function(D){return U[D]};i=i||"a4";var z={COMPAT:"compat",ADVANCED:"advanced"},K=z.COMPAT;function G(){this.saveGraphicsState(),Qt(new tr(yr,0,0,-yr,0,ma()*yr).toString()+" cm"),this.setFontSize(this.getFontSize()/yr),f="n",K=z.ADVANCED}function X(){this.restoreGraphicsState(),f="S",K=z.COMPAT}var Y=b.__private__.combineFontStyleAndFontWeight=function(D,ht){if(D=="bold"&&ht=="normal"||D=="bold"&&ht==400||D=="normal"&&ht=="italic"||D=="bold"&&ht=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ht&&(D=ht==400||ht==="normal"?D==="italic"?"italic":"normal":ht!=700&&ht!=="bold"||D!=="normal"?(ht==700?"bold":ht)+""+D:"bold"),D};b.advancedAPI=function(D){var ht=K===z.COMPAT;return ht&&G.call(this),typeof D!="function"||(D(this),ht&&X.call(this)),this},b.compatAPI=function(D){var ht=K===z.ADVANCED;return ht&&X.call(this),typeof D!="function"||(D(this),ht&&G.call(this)),this},b.isAdvancedAPI=function(){return K===z.ADVANCED};var it,nt=function(D){if(K!==z.ADVANCED)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},wt=b.roundToPrecision=b.__private__.roundToPrecision=function(D,ht){var zt=t||ht;if(isNaN(D)||isNaN(zt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(zt).replace(/0+$/,"")};it=b.hpf=b.__private__.hpf=typeof d=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return wt(D,d)}:d==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return wt(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return wt(D,16)};var Ct=b.f2=b.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return wt(D,2)},st=b.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return wt(D,3)},ot=b.scale=b.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return K===z.COMPAT?D*yr:K===z.ADVANCED?D:void 0},vt=function(D){return K===z.COMPAT?ma()-D:K===z.ADVANCED?D:void 0},yt=function(D){return ot(vt(D))};b.__private__.setPrecision=b.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(t=parseInt(D,10))};var re,Wt="00000000000000000000000000000000",ee=b.__private__.getFileId=function(){return Wt},Zt=b.__private__.setFileId=function(D){return Wt=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():Wt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),m!==null&&(nn=new Uf(m.userPermissions,m.userPassword,m.ownerPassword,Wt)),Wt};b.setFileId=function(D){return Zt(D),this},b.getFileId=function(){return ee()};var oe=b.__private__.convertDateToPDFDate=function(D){var ht=D.getTimezoneOffset(),zt=ht<0?"+":"-",ie=Math.floor(Math.abs(ht/60)),Be=Math.abs(ht%60),Qe=[zt,Rt(ie),"'",Rt(Be),"'"].join("");return["D:",D.getFullYear(),Rt(D.getMonth()+1),Rt(D.getDate()),Rt(D.getHours()),Rt(D.getMinutes()),Rt(D.getSeconds()),Qe].join("")},pe=b.__private__.convertPDFDateToDate=function(D){var ht=parseInt(D.substr(2,4),10),zt=parseInt(D.substr(6,2),10)-1,ie=parseInt(D.substr(8,2),10),Be=parseInt(D.substr(10,2),10),Qe=parseInt(D.substr(12,2),10),hr=parseInt(D.substr(14,2),10);return new Date(ht,zt,ie,Be,Qe,hr,0)},De=b.__private__.setCreationDate=function(D){var ht;if(D===void 0&&(D=new Date),D instanceof Date)ht=oe(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ht=D}return re=ht},at=b.__private__.getCreationDate=function(D){var ht=re;return D==="jsDate"&&(ht=pe(re)),ht};b.setCreationDate=function(D){return De(D),this},b.getCreationDate=function(D){return at(D)};var Tt,Rt=b.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},Nt=b.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},ae=0,Xt=[],ye=[],de=0,qe=[],Ve=[],Je=!1,or=ye,mr=function(){ae=0,de=0,ye=[],Xt=[],qe=[],vr=Fr(),wn=Fr()};b.__private__.setCustomOutputDestination=function(D){Je=!0,or=D};var Me=function(D){Je||(or=D)};b.__private__.resetCustomOutputDestination=function(){Je=!1,or=ye};var Qt=b.__private__.out=function(D){return D=D.toString(),de+=D.length+1,or.push(D),or},Ur=b.__private__.write=function(D){return Qt(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},Ir=b.__private__.getArrayBuffer=function(D){for(var ht=D.length,zt=new ArrayBuffer(ht),ie=new Uint8Array(zt);ht--;)ie[ht]=D.charCodeAt(ht);return zt},$e=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];b.__private__.getStandardFonts=function(){return $e};var Xe=r.fontSize||16;b.__private__.setFontSize=b.setFontSize=function(D){return Xe=K===z.ADVANCED?D/yr:D,this};var er,gr=b.__private__.getFontSize=b.getFontSize=function(){return K===z.COMPAT?Xe:Xe*yr},Re=r.R2L||!1;b.__private__.setR2L=b.setR2L=function(D){return Re=D,this},b.__private__.getR2L=b.getR2L=function(){return Re};var sr,Br=b.__private__.setZoomMode=function(D){var ht=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))er=D;else if(isNaN(D)){if(ht.indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');er=D}else er=parseInt(D,10)};b.__private__.getZoomMode=function(){return er};var xr,Lr=b.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');sr=D};b.__private__.getPageMode=function(){return sr};var Zr=b.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');xr=D};b.__private__.getLayoutMode=function(){return xr},b.__private__.setDisplayMode=b.setDisplayMode=function(D,ht,zt){return Br(D),Zr(ht),Lr(zt),this};var Nr={title:"",subject:"",author:"",keywords:"",creator:""};b.__private__.getDocumentProperty=function(D){if(Object.keys(Nr).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Nr[D]},b.__private__.getDocumentProperties=function(){return Nr},b.__private__.setDocumentProperties=b.setProperties=b.setDocumentProperties=function(D){for(var ht in Nr)Nr.hasOwnProperty(ht)&&D[ht]&&(Nr[ht]=D[ht]);return this},b.__private__.setDocumentProperty=function(D,ht){if(Object.keys(Nr).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Nr[D]=ht};var Vr,yr,In,an,Xn,Bt={},ct={},ft=[],pt={},Dt={},Gt={},le={},ge=null,te=0,he=[],ve=new _F(b),me=r.hotfixes||[],Yt={},ur={},ir=[],tr=function D(ht,zt,ie,Be,Qe,hr){if(!(this instanceof D))return new D(ht,zt,ie,Be,Qe,hr);isNaN(ht)&&(ht=1),isNaN(zt)&&(zt=0),isNaN(ie)&&(ie=0),isNaN(Be)&&(Be=1),isNaN(Qe)&&(Qe=0),isNaN(hr)&&(hr=0),this._matrix=[ht,zt,ie,Be,Qe,hr]};Object.defineProperty(tr.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(tr.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(tr.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(tr.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(tr.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(tr.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(tr.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(tr.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(tr.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(tr.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(tr.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(tr.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(tr.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(tr.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(tr.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(tr.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),tr.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(it).join(D)},tr.prototype.multiply=function(D){var ht=D.sx*this.sx+D.shy*this.shx,zt=D.sx*this.shy+D.shy*this.sy,ie=D.shx*this.sx+D.sy*this.shx,Be=D.shx*this.shy+D.sy*this.sy,Qe=D.tx*this.sx+D.ty*this.shx+this.tx,hr=D.tx*this.shy+D.ty*this.sy+this.ty;return new tr(ht,zt,ie,Be,Qe,hr)},tr.prototype.decompose=function(){var D=this.sx,ht=this.shy,zt=this.shx,ie=this.sy,Be=this.tx,Qe=this.ty,hr=Math.sqrt(D*D+ht*ht),Rr=(D/=hr)*zt+(ht/=hr)*ie;zt-=D*Rr,ie-=ht*Rr;var $r=Math.sqrt(zt*zt+ie*ie);return Rr/=$r,D*(ie/=$r)<ht*(zt/=$r)&&(D=-D,ht=-ht,Rr=-Rr,hr=-hr),{scale:new tr(hr,0,0,$r,0,0),translate:new tr(1,0,0,1,Be,Qe),rotate:new tr(D,ht,-ht,D,0,0),skew:new tr(1,0,Rr,1,0,0)}},tr.prototype.toString=function(D){return this.join(" ")},tr.prototype.inversed=function(){var D=this.sx,ht=this.shy,zt=this.shx,ie=this.sy,Be=this.tx,Qe=this.ty,hr=1/(D*ie-ht*zt),Rr=ie*hr,$r=-ht*hr,fn=-zt*hr,An=D*hr;return new tr(Rr,$r,fn,An,-Rr*Be-fn*Qe,-$r*Be-An*Qe)},tr.prototype.applyToPoint=function(D){var ht=D.x*this.sx+D.y*this.shx+this.tx,zt=D.x*this.shy+D.y*this.sy+this.ty;return new ga(ht,zt)},tr.prototype.applyToRectangle=function(D){var ht=this.applyToPoint(D),zt=this.applyToPoint(new ga(D.x+D.w,D.y+D.h));return new zs(ht.x,ht.y,zt.x-ht.x,zt.y-ht.y)},tr.prototype.clone=function(){var D=this.sx,ht=this.shy,zt=this.shx,ie=this.sy,Be=this.tx,Qe=this.ty;return new tr(D,ht,zt,ie,Be,Qe)},b.Matrix=tr;var Mr=b.matrixMult=function(D,ht){return ht.multiply(D)},Fe=new tr(1,0,0,1,0,0);b.unitMatrix=b.identityMatrix=Fe;var nr=function(D,ht){if(!Dt[D]){var zt=(ht instanceof yd?"Sh":"P")+(Object.keys(pt).length+1).toString(10);ht.id=zt,Dt[D]=zt,pt[zt]=ht,ve.publish("addPattern",ht)}};b.ShadingPattern=yd,b.TilingPattern=Nf,b.addShadingPattern=function(D,ht){return nt("addShadingPattern()"),nr(D,ht),this},b.beginTilingPattern=function(D){nt("beginTilingPattern()"),Il(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},b.endTilingPattern=function(D,ht){nt("endTilingPattern()"),ht.stream=Ve[Tt].join(`
`),nr(D,ht),ve.publish("endTilingPattern",ht),ir.pop().restore()};var _r=b.__private__.newObject=function(){var D=Fr();return Yr(D,!0),D},Fr=b.__private__.newObjectDeferred=function(){return ae++,Xt[ae]=function(){return de},ae},Yr=function(D,ht){return ht=typeof ht=="boolean"&&ht,Xt[D]=de,ht&&Qt(D+" 0 obj"),D},Qr=b.__private__.newAdditionalObject=function(){var D={objId:Fr(),content:""};return qe.push(D),D},vr=Fr(),wn=Fr(),Ai=b.__private__.decodeColorString=function(D){var ht=D.split(" ");if(ht.length!==2||ht[1]!=="g"&&ht[1]!=="G")ht.length===5&&(ht[4]==="k"||ht[4]==="K")&&(ht=[(1-ht[0])*(1-ht[3]),(1-ht[1])*(1-ht[3]),(1-ht[2])*(1-ht[3]),"r"]);else{var zt=parseFloat(ht[0]);ht=[zt,zt,zt,"r"]}for(var ie="#",Be=0;Be<3;Be++)ie+=("0"+Math.floor(255*parseFloat(ht[Be])).toString(16)).slice(-2);return ie},mn=b.__private__.encodeColorString=function(D){var ht;typeof D=="string"&&(D={ch1:D});var zt=D.ch1,ie=D.ch2,Be=D.ch3,Qe=D.ch4,hr=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof zt=="string"&&zt.charAt(0)!=="#"){var Rr=new pF(zt);if(Rr.ok)zt=Rr.toHex();else if(!/^\d*\.?\d*$/.test(zt))throw new Error('Invalid color "'+zt+'" passed to jsPDF.encodeColorString.')}if(typeof zt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(zt)&&(zt="#"+zt[1]+zt[1]+zt[2]+zt[2]+zt[3]+zt[3]),typeof zt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(zt)){var $r=parseInt(zt.substr(1),16);zt=$r>>16&255,ie=$r>>8&255,Be=255&$r}if(ie===void 0||Qe===void 0&&zt===ie&&ie===Be)if(typeof zt=="string")ht=zt+" "+hr[0];else switch(D.precision){case 2:ht=Ct(zt/255)+" "+hr[0];break;case 3:default:ht=st(zt/255)+" "+hr[0]}else if(Qe===void 0||li(Qe)==="object"){if(Qe&&!isNaN(Qe.a)&&Qe.a===0)return ht=["1.","1.","1.",hr[1]].join(" ");if(typeof zt=="string")ht=[zt,ie,Be,hr[1]].join(" ");else switch(D.precision){case 2:ht=[Ct(zt/255),Ct(ie/255),Ct(Be/255),hr[1]].join(" ");break;default:case 3:ht=[st(zt/255),st(ie/255),st(Be/255),hr[1]].join(" ")}}else if(typeof zt=="string")ht=[zt,ie,Be,Qe,hr[2]].join(" ");else switch(D.precision){case 2:ht=[Ct(zt),Ct(ie),Ct(Be),Ct(Qe),hr[2]].join(" ");break;case 3:default:ht=[st(zt),st(ie),st(Be),st(Qe),hr[2]].join(" ")}return ht},Dn=b.__private__.getFilters=function(){return a},gn=b.__private__.putStream=function(D){var ht=(D=D||{}).data||"",zt=D.filters||Dn(),ie=D.alreadyAppliedFilters||[],Be=D.addLength1||!1,Qe=ht.length,hr=D.objectId,Rr=function(Vs){return Vs};if(m!==null&&hr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");m!==null&&(Rr=nn.encryptor(hr,0));var $r={};zt===!0&&(zt=["FlateEncode"]);var fn=D.additionalKeyValues||[],An=($r=hn.API.processDataByFilters!==void 0?hn.API.processDataByFilters(ht,zt):{data:ht,reverseChain:[]}).reverseChain+(Array.isArray(ie)?ie.join(" "):ie.toString());if($r.data.length!==0&&(fn.push({key:"Length",value:$r.data.length}),Be===!0&&fn.push({key:"Length1",value:Qe})),An.length!=0)if(An.split("/").length-1==1)fn.push({key:"Filter",value:An});else{fn.push({key:"Filter",value:"["+An+"]"});for(var Rn=0;Rn<fn.length;Rn+=1)if(fn[Rn].key==="DecodeParms"){for(var Ci=[],ci=0;ci<$r.reverseChain.split("/").length-1;ci+=1)Ci.push("null");Ci.push(fn[Rn].value),fn[Rn].value="["+Ci.join(" ")+"]"}}Qt("<<");for(var Xi=0;Xi<fn.length;Xi++)Qt("/"+fn[Xi].key+" "+fn[Xi].value);Qt(">>"),$r.data.length!==0&&(Qt("stream"),Qt(Rr($r.data)),Qt("endstream"))},Hn=b.__private__.putPage=function(D){var ht=D.number,zt=D.data,ie=D.objId,Be=D.contentsObjId;Yr(ie,!0),Qt("<</Type /Page"),Qt("/Parent "+D.rootDictionaryObjId+" 0 R"),Qt("/Resources "+D.resourceDictionaryObjId+" 0 R"),Qt("/MediaBox ["+parseFloat(it(D.mediaBox.bottomLeftX))+" "+parseFloat(it(D.mediaBox.bottomLeftY))+" "+it(D.mediaBox.topRightX)+" "+it(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&Qt("/CropBox ["+it(D.cropBox.bottomLeftX)+" "+it(D.cropBox.bottomLeftY)+" "+it(D.cropBox.topRightX)+" "+it(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&Qt("/BleedBox ["+it(D.bleedBox.bottomLeftX)+" "+it(D.bleedBox.bottomLeftY)+" "+it(D.bleedBox.topRightX)+" "+it(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&Qt("/TrimBox ["+it(D.trimBox.bottomLeftX)+" "+it(D.trimBox.bottomLeftY)+" "+it(D.trimBox.topRightX)+" "+it(D.trimBox.topRightY)+"]"),D.artBox!==null&&Qt("/ArtBox ["+it(D.artBox.bottomLeftX)+" "+it(D.artBox.bottomLeftY)+" "+it(D.artBox.topRightX)+" "+it(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&Qt("/UserUnit "+D.userUnit),ve.publish("putPage",{objId:ie,pageContext:he[ht],pageNumber:ht,page:zt}),Qt("/Contents "+Be+" 0 R"),Qt(">>"),Qt("endobj");var Qe=zt.join(`
`);return K===z.ADVANCED&&(Qe+=`
Q`),Yr(Be,!0),gn({data:Qe,filters:Dn(),objectId:Be}),Qt("endobj"),ie},xn=b.__private__.putPages=function(){var D,ht,zt=[];for(D=1;D<=te;D++)he[D].objId=Fr(),he[D].contentsObjId=Fr();for(D=1;D<=te;D++)zt.push(Hn({number:D,data:Ve[D],objId:he[D].objId,contentsObjId:he[D].contentsObjId,mediaBox:he[D].mediaBox,cropBox:he[D].cropBox,bleedBox:he[D].bleedBox,trimBox:he[D].trimBox,artBox:he[D].artBox,userUnit:he[D].userUnit,rootDictionaryObjId:vr,resourceDictionaryObjId:wn}));Yr(vr,!0),Qt("<</Type /Pages");var ie="/Kids [";for(ht=0;ht<te;ht++)ie+=zt[ht]+" 0 R ";Qt(ie+"]"),Qt("/Count "+te),Qt(">>"),Qt("endobj"),ve.publish("postPutPages")},vs=function(D){ve.publish("putFont",{font:D,out:Qt,newObject:_r,putStream:gn}),D.isAlreadyPutted!==!0&&(D.objectNumber=_r(),Qt("<<"),Qt("/Type /Font"),Qt("/BaseFont /"+Df(D.postScriptName)),Qt("/Subtype /Type1"),typeof D.encoding=="string"&&Qt("/Encoding /"+D.encoding),Qt("/FirstChar 32"),Qt("/LastChar 255"),Qt(">>"),Qt("endobj"))},Kt=function(){for(var D in Bt)Bt.hasOwnProperty(D)&&(v===!1||v===!0&&C.hasOwnProperty(D))&&vs(Bt[D])},Er=function(D){D.objectNumber=_r();var ht=[];ht.push({key:"Type",value:"/XObject"}),ht.push({key:"Subtype",value:"/Form"}),ht.push({key:"BBox",value:"["+[it(D.x),it(D.y),it(D.x+D.width),it(D.y+D.height)].join(" ")+"]"}),ht.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var zt=D.pages[1].join(`
`);gn({data:zt,additionalKeyValues:ht,objectId:D.objectNumber}),Qt("endobj")},cr=function(){for(var D in Yt)Yt.hasOwnProperty(D)&&Er(Yt[D])},dn=function(D,ht){var zt,ie=[],Be=1/(ht-1);for(zt=0;zt<1;zt+=Be)ie.push(zt);if(ie.push(1),D[0].offset!=0){var Qe={offset:0,color:D[0].color};D.unshift(Qe)}if(D[D.length-1].offset!=1){var hr={offset:1,color:D[D.length-1].color};D.push(hr)}for(var Rr="",$r=0,fn=0;fn<ie.length;fn++){for(zt=ie[fn];zt>D[$r+1].offset;)$r++;var An=D[$r].offset,Rn=(zt-An)/(D[$r+1].offset-An),Ci=D[$r].color,ci=D[$r+1].color;Rr+=Nt(Math.round((1-Rn)*Ci[0]+Rn*ci[0]).toString(16))+Nt(Math.round((1-Rn)*Ci[1]+Rn*ci[1]).toString(16))+Nt(Math.round((1-Rn)*Ci[2]+Rn*ci[2]).toString(16))}return Rr.trim()},qn=function(D,ht){ht||(ht=21);var zt=_r(),ie=dn(D.colors,ht),Be=[];Be.push({key:"FunctionType",value:"0"}),Be.push({key:"Domain",value:"[0.0 1.0]"}),Be.push({key:"Size",value:"["+ht+"]"}),Be.push({key:"BitsPerSample",value:"8"}),Be.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Be.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),gn({data:ie,additionalKeyValues:Be,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:zt}),Qt("endobj"),D.objectNumber=_r(),Qt("<< /ShadingType "+D.type),Qt("/ColorSpace /DeviceRGB");var Qe="/Coords ["+it(parseFloat(D.coords[0]))+" "+it(parseFloat(D.coords[1]))+" ";D.type===2?Qe+=it(parseFloat(D.coords[2]))+" "+it(parseFloat(D.coords[3])):Qe+=it(parseFloat(D.coords[2]))+" "+it(parseFloat(D.coords[3]))+" "+it(parseFloat(D.coords[4]))+" "+it(parseFloat(D.coords[5])),Qt(Qe+="]"),D.matrix&&Qt("/Matrix ["+D.matrix.toString()+"]"),Qt("/Function "+zt+" 0 R"),Qt("/Extend [true true]"),Qt(">>"),Qt("endobj")},Gn=function(D,ht){var zt=Fr(),ie=_r();ht.push({resourcesOid:zt,objectOid:ie}),D.objectNumber=ie;var Be=[];Be.push({key:"Type",value:"/Pattern"}),Be.push({key:"PatternType",value:"1"}),Be.push({key:"PaintType",value:"1"}),Be.push({key:"TilingType",value:"1"}),Be.push({key:"BBox",value:"["+D.boundingBox.map(it).join(" ")+"]"}),Be.push({key:"XStep",value:it(D.xStep)}),Be.push({key:"YStep",value:it(D.yStep)}),Be.push({key:"Resources",value:zt+" 0 R"}),D.matrix&&Be.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),gn({data:D.stream,additionalKeyValues:Be,objectId:D.objectNumber}),Qt("endobj")},Qn=function(D){var ht;for(ht in pt)pt.hasOwnProperty(ht)&&(pt[ht]instanceof yd?qn(pt[ht]):pt[ht]instanceof Nf&&Gn(pt[ht],D))},di=function(D){for(var ht in D.objectNumber=_r(),Qt("<<"),D)switch(ht){case"opacity":Qt("/ca "+Ct(D[ht]));break;case"stroke-opacity":Qt("/CA "+Ct(D[ht]))}Qt(">>"),Qt("endobj")},xi=function(){var D;for(D in Gt)Gt.hasOwnProperty(D)&&di(Gt[D])},mi=function(){for(var D in Qt("/XObject <<"),Yt)Yt.hasOwnProperty(D)&&Yt[D].objectNumber>=0&&Qt("/"+D+" "+Yt[D].objectNumber+" 0 R");ve.publish("putXobjectDict"),Qt(">>")},Ds=function(){nn.oid=_r(),Qt("<<"),Qt("/Filter /Standard"),Qt("/V "+nn.v),Qt("/R "+nn.r),Qt("/U <"+nn.toHexString(nn.U)+">"),Qt("/O <"+nn.toHexString(nn.O)+">"),Qt("/P "+nn.P),Qt(">>"),Qt("endobj")},Po=function(){for(var D in Qt("/Font <<"),Bt)Bt.hasOwnProperty(D)&&(v===!1||v===!0&&C.hasOwnProperty(D))&&Qt("/"+D+" "+Bt[D].objectNumber+" 0 R");Qt(">>")},$c=function(){if(Object.keys(pt).length>0){for(var D in Qt("/Shading <<"),pt)pt.hasOwnProperty(D)&&pt[D]instanceof yd&&pt[D].objectNumber>=0&&Qt("/"+D+" "+pt[D].objectNumber+" 0 R");ve.publish("putShadingPatternDict"),Qt(">>")}},Oa=function(D){if(Object.keys(pt).length>0){for(var ht in Qt("/Pattern <<"),pt)pt.hasOwnProperty(ht)&&pt[ht]instanceof b.TilingPattern&&pt[ht].objectNumber>=0&&pt[ht].objectNumber<D&&Qt("/"+ht+" "+pt[ht].objectNumber+" 0 R");ve.publish("putTilingPatternDict"),Qt(">>")}},Mo=function(){if(Object.keys(Gt).length>0){var D;for(D in Qt("/ExtGState <<"),Gt)Gt.hasOwnProperty(D)&&Gt[D].objectNumber>=0&&Qt("/"+D+" "+Gt[D].objectNumber+" 0 R");ve.publish("putGStateDict"),Qt(">>")}},Nn=function(D){Yr(D.resourcesOid,!0),Qt("<<"),Qt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Po(),$c(),Oa(D.objectOid),Mo(),mi(),Qt(">>"),Qt("endobj")},nl=function(){var D=[];Kt(),xi(),cr(),Qn(D),ve.publish("putResources"),D.forEach(Nn),Nn({resourcesOid:wn,objectOid:Number.MAX_SAFE_INTEGER}),ve.publish("postPutResources")},Fo=function(){ve.publish("putAdditionalObjects");for(var D=0;D<qe.length;D++){var ht=qe[D];Yr(ht.objId,!0),Qt(ht.content),Qt("endobj")}ve.publish("postPutAdditionalObjects")},il=function(D){ct[D.fontName]=ct[D.fontName]||{},ct[D.fontName][D.fontStyle]=D.id},fa=function(D,ht,zt,ie,Be){var Qe={id:"F"+(Object.keys(Bt).length+1).toString(10),postScriptName:D,fontName:ht,fontStyle:zt,encoding:ie,isStandardFont:Be||!1,metadata:{}};return ve.publish("addFont",{font:Qe,instance:this}),Bt[Qe.id]=Qe,il(Qe),Qe.id},sc=function(D){for(var ht=0,zt=$e.length;ht<zt;ht++){var ie=fa.call(this,D[ht][0],D[ht][1],D[ht][2],$e[ht][3],!0);v===!1&&(C[ie]=!0);var Be=D[ht][0].split("-");il({id:ie,fontName:Be[0],fontStyle:Be[1]||""})}ve.publish("addFonts",{fonts:Bt,dictionary:ct})},Vi=function(D){return D.foo=function(){try{return D.apply(this,arguments)}catch(ie){var ht=ie.stack||"";~ht.indexOf(" at ")&&(ht=ht.split(" at ")[1]);var zt="Error in function "+ht.split(`
`)[0].split("<")[0]+": "+ie.message;if(!un.console)throw new Error(zt);un.console.error(zt,ie),un.alert&&alert(zt)}},D.foo.bar=D,D.foo},Ns=function(D,ht){var zt,ie,Be,Qe,hr,Rr,$r,fn,An;if(Be=(ht=ht||{}).sourceEncoding||"Unicode",hr=ht.outputEncoding,(ht.autoencode||hr)&&Bt[Vr].metadata&&Bt[Vr].metadata[Be]&&Bt[Vr].metadata[Be].encoding&&(Qe=Bt[Vr].metadata[Be].encoding,!hr&&Bt[Vr].encoding&&(hr=Bt[Vr].encoding),!hr&&Qe.codePages&&(hr=Qe.codePages[0]),typeof hr=="string"&&(hr=Qe[hr]),hr)){for($r=!1,Rr=[],zt=0,ie=D.length;zt<ie;zt++)(fn=hr[D.charCodeAt(zt)])?Rr.push(String.fromCharCode(fn)):Rr.push(D[zt]),Rr[zt].charCodeAt(0)>>8&&($r=!0);D=Rr.join("")}for(zt=D.length;$r===void 0&&zt!==0;)D.charCodeAt(zt-1)>>8&&($r=!0),zt--;if(!$r)return D;for(Rr=ht.noBOM?[]:[254,255],zt=0,ie=D.length;zt<ie;zt++){if((An=(fn=D.charCodeAt(zt))>>8)>>8)throw new Error("Character at position "+zt+" of string '"+D+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Rr.push(An),Rr.push(fn-(An<<8))}return String.fromCharCode.apply(void 0,Rr)},Bi=b.__private__.pdfEscape=b.pdfEscape=function(D,ht){return Ns(D,ht).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},on=b.__private__.beginPage=function(D){Ve[++te]=[],he[te]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},Tl(te),Me(Ve[Tt])},ks=function(D,ht){var zt,ie,Be;switch(e=ht||e,typeof D=="string"&&(zt=k(D.toLowerCase()),Array.isArray(zt)&&(ie=zt[0],Be=zt[1])),Array.isArray(D)&&(ie=D[0]*yr,Be=D[1]*yr),isNaN(ie)&&(ie=i[0],Be=i[1]),(ie>14400||Be>14400)&&(Ui.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),ie=Math.min(14400,ie),Be=Math.min(14400,Be)),i=[ie,Be],e.substr(0,1)){case"l":Be>ie&&(i=[Be,ie]);break;case"p":ie>Be&&(i=[Be,ie])}on(i),Wu(Na),Qt(si),ru!==0&&Qt(ru+" J"),Qh!==0&&Qt(Qh+" j"),ve.publish("addPage",{pageNumber:te})},cn=function(D){D>0&&D<=te&&(Ve.splice(D,1),he.splice(D,1),te--,Tt>te&&(Tt=te),this.setPage(Tt))},Tl=function(D){D>0&&D<=te&&(Tt=D)},Ku=b.__private__.getNumberOfPages=b.getNumberOfPages=function(){return Ve.length-1},bt=function(D,ht,zt){var ie,Be=void 0;return zt=zt||{},D=D!==void 0?D:Bt[Vr].fontName,ht=ht!==void 0?ht:Bt[Vr].fontStyle,ie=D.toLowerCase(),ct[ie]!==void 0&&ct[ie][ht]!==void 0?Be=ct[ie][ht]:ct[D]!==void 0&&ct[D][ht]!==void 0?Be=ct[D][ht]:zt.disableWarning===!1&&Ui.warn("Unable to look up font label for font '"+D+"', '"+ht+"'. Refer to getFontList() for available fonts."),Be||zt.noFallback||(Be=ct.times[ht])==null&&(Be=ct.times.normal),Be},It=b.__private__.putInfo=function(){var D=_r(),ht=function(ie){return ie};for(var zt in m!==null&&(ht=nn.encryptor(D,0)),Qt("<<"),Qt("/Producer ("+Bi(ht("jsPDF "+hn.version))+")"),Nr)Nr.hasOwnProperty(zt)&&Nr[zt]&&Qt("/"+zt.substr(0,1).toUpperCase()+zt.substr(1)+" ("+Bi(ht(Nr[zt]))+")");Qt("/CreationDate ("+Bi(ht(re))+")"),Qt(">>"),Qt("endobj")},jt=b.__private__.putCatalog=function(D){var ht=(D=D||{}).rootDictionaryObjId||vr;switch(_r(),Qt("<<"),Qt("/Type /Catalog"),Qt("/Pages "+ht+" 0 R"),er||(er="fullwidth"),er){case"fullwidth":Qt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Qt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Qt("/OpenAction [3 0 R /Fit]");break;case"original":Qt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var zt=""+er;zt.substr(zt.length-1)==="%"&&(er=parseInt(er)/100),typeof er=="number"&&Qt("/OpenAction [3 0 R /XYZ null null "+Ct(er)+"]")}switch(xr||(xr="continuous"),xr){case"continuous":Qt("/PageLayout /OneColumn");break;case"single":Qt("/PageLayout /SinglePage");break;case"two":case"twoleft":Qt("/PageLayout /TwoColumnLeft");break;case"tworight":Qt("/PageLayout /TwoColumnRight")}sr&&Qt("/PageMode /"+sr),ve.publish("putCatalog"),Qt(">>"),Qt("endobj")},xe=b.__private__.putTrailer=function(){Qt("trailer"),Qt("<<"),Qt("/Size "+(ae+1)),Qt("/Root "+ae+" 0 R"),Qt("/Info "+(ae-1)+" 0 R"),m!==null&&Qt("/Encrypt "+nn.oid+" 0 R"),Qt("/ID [ <"+Wt+"> <"+Wt+"> ]"),Qt(">>")},ar=b.__private__.putHeader=function(){Qt("%PDF-"+P),Qt("%ºß¬à")},Cr=b.__private__.putXRef=function(){var D="0000000000";Qt("xref"),Qt("0 "+(ae+1)),Qt("0000000000 65535 f ");for(var ht=1;ht<=ae;ht++)typeof Xt[ht]=="function"?Qt((D+Xt[ht]()).slice(-10)+" 00000 n "):Xt[ht]!==void 0?Qt((D+Xt[ht]).slice(-10)+" 00000 n "):Qt("0000000000 00000 n ")},Gr=b.__private__.buildDocument=function(){mr(),Me(ye),ve.publish("buildDocument"),ar(),xn(),Fo(),nl(),m!==null&&Ds(),It(),jt();var D=de;return Cr(),xe(),Qt("startxref"),Qt(""+D),Qt("%%EOF"),Me(Ve[Tt]),ye.join(`
`)},Bn=b.__private__.getBlob=function(D){return new Blob([Ir(D)],{type:"application/pdf"})},yi=b.output=b.__private__.output=Vi(function(D,ht){switch(typeof(ht=ht||{})=="string"?ht={filename:ht}:ht.filename=ht.filename||"generated.pdf",D){case void 0:return Gr();case"save":b.save(ht.filename);break;case"arraybuffer":return Ir(Gr());case"blob":return Bn(Gr());case"bloburi":case"bloburl":if(un.URL!==void 0&&typeof un.URL.createObjectURL=="function")return un.URL&&un.URL.createObjectURL(Bn(Gr()))||void 0;Ui.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var zt="",ie=Gr();try{zt=Jw(ie)}catch{zt=Jw(unescape(encodeURIComponent(ie)))}return"data:application/pdf;filename="+ht.filename+";base64,"+zt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(un)==="[object Window]"){var Be="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Qe=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ht.pdfObjectUrl&&(Be=ht.pdfObjectUrl,Qe="");var hr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Be+'"'+Qe+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ht)+");<\/script></body></html>",Rr=un.open();return Rr!==null&&Rr.document.write(hr),Rr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(un)==="[object Window]"){var $r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ht.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ht.filename+'" width="500px" height="400px" /></body></html>',fn=un.open();if(fn!==null){fn.document.write($r);var An=this;fn.document.documentElement.querySelector("#pdfViewer").onload=function(){fn.document.title=ht.filename,fn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(An.output("bloburl"))}}return fn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(un)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Rn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ht)+'"></iframe></body></html>',Ci=un.open();if(Ci!==null&&(Ci.document.write(Rn),Ci.document.title=ht.filename),Ci||typeof safari>"u")return Ci;break;case"datauri":case"dataurl":return un.document.location.href=this.output("datauristring",ht);default:return null}}),_i=function(D){return Array.isArray(me)===!0&&me.indexOf(D)>-1};switch(n){case"pt":yr=1;break;case"mm":yr=72/25.4;break;case"cm":yr=72/2.54;break;case"in":yr=72;break;case"px":yr=_i("px_scaling")==1?.75:96/72;break;case"pc":case"em":yr=12;break;case"ex":yr=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);yr=n}var nn=null;De(),Zt();var Xc=function(D){return m!==null?nn.encryptor(D,0):function(ht){return ht}},Ko=b.__private__.getPageInfo=b.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:he[D].objId,pageNumber:D,pageContext:he[D]}},en=b.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ht in he)if(he[ht].objId===D)break;return Ko(ht)},Lo=b.__private__.getCurrentPageInfo=b.getCurrentPageInfo=function(){return{objId:he[Tt].objId,pageNumber:Tt,pageContext:he[Tt]}};b.addPage=function(){return ks.apply(this,arguments),this},b.setPage=function(){return Tl.apply(this,arguments),Me.call(this,Ve[Tt]),this},b.insertPage=function(D){return this.addPage(),this.movePage(Tt,D),this},b.movePage=function(D,ht){var zt,ie;if(D>ht){zt=Ve[D],ie=he[D];for(var Be=D;Be>ht;Be--)Ve[Be]=Ve[Be-1],he[Be]=he[Be-1];Ve[ht]=zt,he[ht]=ie,this.setPage(ht)}else if(D<ht){zt=Ve[D],ie=he[D];for(var Qe=D;Qe<ht;Qe++)Ve[Qe]=Ve[Qe+1],he[Qe]=he[Qe+1];Ve[ht]=zt,he[ht]=ie,this.setPage(ht)}return this},b.deletePage=function(){return cn.apply(this,arguments),this},b.__private__.text=b.text=function(D,ht,zt,ie,Be){var Qe,hr,Rr,$r,fn,An,Rn,Ci,ci,Xi=(ie=ie||{}).scope||this;if(typeof D=="number"&&typeof ht=="number"&&(typeof zt=="string"||Array.isArray(zt))){var Vs=zt;zt=ht,ht=D,D=Vs}if(arguments[3]instanceof tr?(nt("The transform parameter of text() with a Matrix value"),ci=Be):(Rr=arguments[4],$r=arguments[5],li(Rn=arguments[3])==="object"&&Rn!==null||(typeof Rr=="string"&&($r=Rr,Rr=null),typeof Rn=="string"&&($r=Rn,Rn=null),typeof Rn=="number"&&(Rr=Rn,Rn=null),ie={flags:Rn,angle:Rr,align:$r})),isNaN(ht)||isNaN(zt)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return Xi;var Gi="",$o=!1,fo=typeof ie.lineHeightFactor=="number"?ie.lineHeightFactor:Da,ol=Xi.internal.scaleFactor;function kA(Zn){return Zn=Zn.split("	").join(Array(ie.TabLen||9).join(" ")),Bi(Zn,Rn)}function ou(Zn){for(var ui,Zi=Zn.concat(),ss=[],Ul=Zi.length;Ul--;)typeof(ui=Zi.shift())=="string"?ss.push(ui):Array.isArray(Zn)&&(ui.length===1||ui[1]===void 0&&ui[2]===void 0)?ss.push(ui[0]):ss.push([ui[0],ui[1],ui[2]]);return ss}function au(Zn,ui){var Zi;if(typeof Zn=="string")Zi=ui(Zn)[0];else if(Array.isArray(Zn)){for(var ss,Ul,dc=Zn.concat(),Dl=[],fu=dc.length;fu--;)typeof(ss=dc.shift())=="string"?Dl.push(ui(ss)[0]):Array.isArray(ss)&&typeof ss[0]=="string"&&(Ul=ui(ss[0],ss[1],ss[2]),Dl.push([Ul[0],Ul[1],Ul[2]]));Zi=Dl}return Zi}var lu=!1,cu=!0;if(typeof D=="string")lu=!0;else if(Array.isArray(D)){var uu=D.concat();hr=[];for(var al,Ei=uu.length;Ei--;)(typeof(al=uu.shift())!="string"||Array.isArray(al)&&typeof al[0]!="string")&&(cu=!1);lu=cu}if(lu===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var ac=Xe/Xi.internal.scaleFactor,lc=ac*(fo-1);switch(ie.baseline){case"bottom":zt-=lc;break;case"top":zt+=ac-lc;break;case"hanging":zt+=ac-2*lc;break;case"middle":zt+=ac/2-lc}if((An=ie.maxWidth||0)>0&&(typeof D=="string"?D=Xi.splitTextToSize(D,An):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(Zn,ui){return Zn.concat(Xi.splitTextToSize(ui,An))},[]))),Qe={text:D,x:ht,y:zt,options:ie,mutex:{pdfEscape:Bi,activeFontKey:Vr,fonts:Bt,activeFontSize:Xe}},ve.publish("preProcessText",Qe),D=Qe.text,Rr=(ie=Qe.options).angle,!(ci instanceof tr)&&Rr&&typeof Rr=="number"){Rr*=Math.PI/180,ie.rotationDirection===0&&(Rr=-Rr),K===z.ADVANCED&&(Rr=-Rr);var Ml=Math.cos(Rr),Yu=Math.sin(Rr);ci=new tr(Ml,Yu,-Yu,Ml,0,0)}else Rr&&Rr instanceof tr&&(ci=Rr);K!==z.ADVANCED||ci||(ci=Fe),(fn=ie.charSpace||Xu)!==void 0&&(Gi+=it(ot(fn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ci=ie.horizontalScale)!==void 0&&(Gi+=it(100*Ci)+` Tz
`),ie.lang;var eo=-1,Fl=ie.renderingMode!==void 0?ie.renderingMode:ie.stroke,hu=Xi.internal.getCurrentPageInfo().pageContext;switch(Fl){case 0:case!1:case"fill":eo=0;break;case 1:case!0:case"stroke":eo=1;break;case 2:case"fillThenStroke":eo=2;break;case 3:case"invisible":eo=3;break;case 4:case"fillAndAddForClipping":eo=4;break;case 5:case"strokeAndAddPathForClipping":eo=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":eo=6;break;case 7:case"addToPathForClipping":eo=7}var kn=hu.usedRenderingMode!==void 0?hu.usedRenderingMode:-1;eo!==-1?Gi+=eo+` Tr
`:kn!==-1&&(Gi+=`0 Tr
`),eo!==-1&&(hu.usedRenderingMode=eo),$r=ie.align||"left";var ya,Ju=Xe*fo,QA=Xi.internal.pageSize.getWidth(),Hh=Bt[Vr];fn=ie.charSpace||Xu,An=ie.maxWidth||0,Rn=Object.assign({autoencode:!0,noBOM:!0},ie.flags);var cc=[],uc=function(Zn){return Xi.getStringUnitWidth(Zn,{font:Hh,charSpace:fn,fontSize:Xe,doKerning:!1})*Xe/ol};if(Object.prototype.toString.call(D)==="[object Array]"){var Gs;hr=ou(D),$r!=="left"&&(ya=hr.map(uc));var ws,ka=0;if($r==="right"){ht-=ya[0],D=[],Ei=hr.length;for(var Qa=0;Qa<Ei;Qa++)Qa===0?(ws=Pn(ht),Gs=Ro(zt)):(ws=ot(ka-ya[Qa]),Gs=-Ju),D.push([hr[Qa],ws,Gs]),ka=ya[Qa]}else if($r==="center"){ht-=ya[0]/2,D=[],Ei=hr.length;for(var po=0;po<Ei;po++)po===0?(ws=Pn(ht),Gs=Ro(zt)):(ws=ot((ka-ya[po])/2),Gs=-Ju),D.push([hr[po],ws,Gs]),ka=ya[po]}else if($r==="left"){D=[],Ei=hr.length;for(var za=0;za<Ei;za++)D.push(hr[za])}else if($r==="justify"&&Hh.encoding==="Identity-H"){D=[],Ei=hr.length,An=An!==0?An:QA;for(var is=0,ji=0;ji<Ei;ji++)if(Gs=ji===0?Ro(zt):-Ju,ws=ji===0?Pn(ht):is,ji<Ei-1){var th=ot((An-ya[ji])/(hr[ji].split(" ").length-1)),js=hr[ji].split(" ");D.push([js[0]+" ",ws,Gs]),is=0;for(var xs=1;xs<js.length;xs++){var Ll=(uc(js[xs-1]+" "+js[xs])-uc(js[xs]))*ol+th;xs==js.length-1?D.push([js[xs],Ll,0]):D.push([js[xs]+" ",Ll,0]),is-=Ll}}else D.push([hr[ji],ws,Gs]);D.push(["",is,0])}else{if($r!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(D=[],Ei=hr.length,An=An!==0?An:QA,ji=0;ji<Ei;ji++)Gs=ji===0?Ro(zt):-Ju,ws=ji===0?Pn(ht):0,ji<Ei-1?cc.push(it(ot((An-ya[ji])/(hr[ji].split(" ").length-1)))):cc.push(0),D.push([hr[ji],ws,Gs])}}var Au=typeof ie.R2L=="boolean"?ie.R2L:Re;Au===!0&&(D=au(D,function(Zn,ui,Zi){return[Zn.split("").reverse().join(""),ui,Zi]})),Qe={text:D,x:ht,y:zt,options:ie,mutex:{pdfEscape:Bi,activeFontKey:Vr,fonts:Bt,activeFontSize:Xe}},ve.publish("postProcessText",Qe),D=Qe.text,$o=Qe.mutex.isHex||!1;var Rl=Bt[Vr].encoding;Rl!=="WinAnsiEncoding"&&Rl!=="StandardEncoding"||(D=au(D,function(Zn,ui,Zi){return[kA(Zn),ui,Zi]})),hr=ou(D),D=[];for(var ll,hc,Xo,_a=0,du=1,Ol=Array.isArray(hr[0])?du:_a,yn="",Ac=function(Zn,ui,Zi){var ss="";return Zi instanceof tr?(Zi=typeof ie.angle=="number"?Mr(Zi,new tr(1,0,0,1,Zn,ui)):Mr(new tr(1,0,0,1,Zn,ui),Zi),K===z.ADVANCED&&(Zi=Mr(new tr(1,0,0,-1,0,0),Zi)),ss=Zi.join(" ")+` Tm
`):ss=it(Zn)+" "+it(ui)+` Td
`,ss},va=0;va<hr.length;va++){switch(yn="",Ol){case du:Xo=($o?"<":"(")+hr[va][0]+($o?">":")"),ll=parseFloat(hr[va][1]),hc=parseFloat(hr[va][2]);break;case _a:Xo=($o?"<":"(")+hr[va]+($o?">":")"),ll=Pn(ht),hc=Ro(zt)}cc!==void 0&&cc[va]!==void 0&&(yn=cc[va]+` Tw
`),va===0?D.push(yn+Ac(ll,hc,ci)+Xo):Ol===_a?D.push(yn+Xo):Ol===du&&D.push(yn+Ac(ll,hc,ci)+Xo)}D=Ol===_a?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var Zo=`BT
/`;return Zo+=Vr+" "+Xe+` Tf
`,Zo+=it(Xe*fo)+` TL
`,Zo+=Uo+`
`,Zo+=Gi,Zo+=D,Qt(Zo+="ET"),C[Vr]=!0,Xi};var Nh=b.__private__.clip=b.clip=function(D){return Qt(D==="evenodd"?"W*":"W"),this};b.clipEvenOdd=function(){return Nh("evenodd")},b.__private__.discardPath=b.discardPath=function(){return Qt("n"),this};var bs=b.__private__.isValidStyle=function(D){var ht=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(ht=!0),ht};b.__private__.setDefaultPathOperation=b.setDefaultPathOperation=function(D){return bs(D)&&(f=D),this};var Zc=b.__private__.getStyle=b.getStyle=function(D){var ht=f;switch(D){case"D":case"S":ht="S";break;case"F":ht="f";break;case"FD":case"DF":ht="B";break;case"f":case"f*":case"B":case"B*":ht=D}return ht},ii=b.close=function(){return Qt("h"),this};b.stroke=function(){return Qt("S"),this},b.fill=function(D){return Ua("f",D),this},b.fillEvenOdd=function(D){return Ua("f*",D),this},b.fillStroke=function(D){return Ua("B",D),this},b.fillStrokeEvenOdd=function(D){return Ua("B*",D),this};var Ua=function(D,ht){li(ht)==="object"?Yc(ht,D):Qt(D)},vn=function(D){D===null||K===z.ADVANCED&&D===void 0||(D=Zc(D),Qt(D))};function ln(D,ht,zt,ie,Be){var Qe=new Nf(ht||this.boundingBox,zt||this.xStep,ie||this.yStep,this.gState,Be||this.matrix);Qe.stream=this.stream;var hr=D+"$$"+this.cloneIndex+++"$$";return nr(hr,Qe),Qe}var Yc=function(D,ht){var zt=Dt[D.key],ie=pt[zt];if(ie instanceof yd)Qt("q"),Qt(Sn(ht)),ie.gState&&b.setGState(ie.gState),Qt(D.matrix.toString()+" cm"),Qt("/"+zt+" sh"),Qt("Q");else if(ie instanceof Nf){var Be=new tr(1,0,0,-1,0,ma());D.matrix&&(Be=Be.multiply(D.matrix||Fe),zt=ln.call(ie,D.key,D.boundingBox,D.xStep,D.yStep,Be).id),Qt("q"),Qt("/Pattern cs"),Qt("/"+zt+" scn"),ie.gState&&b.setGState(ie.gState),Qt(ht),Qt("Q")}},Sn=function(D){switch(D){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},sl=b.moveTo=function(D,ht){return Qt(it(ot(D))+" "+it(yt(ht))+" m"),this},Qs=b.lineTo=function(D,ht){return Qt(it(ot(D))+" "+it(yt(ht))+" l"),this},pa=b.curveTo=function(D,ht,zt,ie,Be,Qe){return Qt([it(ot(D)),it(yt(ht)),it(ot(zt)),it(yt(ie)),it(ot(Be)),it(yt(Qe)),"c"].join(" ")),this};b.__private__.line=b.line=function(D,ht,zt,ie,Be){if(isNaN(D)||isNaN(ht)||isNaN(zt)||isNaN(ie)||!bs(Be))throw new Error("Invalid arguments passed to jsPDF.line");return K===z.COMPAT?this.lines([[zt-D,ie-ht]],D,ht,[1,1],Be||"S"):this.lines([[zt-D,ie-ht]],D,ht,[1,1]).stroke()},b.__private__.lines=b.lines=function(D,ht,zt,ie,Be,Qe){var hr,Rr,$r,fn,An,Rn,Ci,ci,Xi,Vs,Gi,$o;if(typeof D=="number"&&($o=zt,zt=ht,ht=D,D=$o),ie=ie||[1,1],Qe=Qe||!1,isNaN(ht)||isNaN(zt)||!Array.isArray(D)||!Array.isArray(ie)||!bs(Be)||typeof Qe!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(sl(ht,zt),hr=ie[0],Rr=ie[1],fn=D.length,Vs=ht,Gi=zt,$r=0;$r<fn;$r++)(An=D[$r]).length===2?(Vs=An[0]*hr+Vs,Gi=An[1]*Rr+Gi,Qs(Vs,Gi)):(Rn=An[0]*hr+Vs,Ci=An[1]*Rr+Gi,ci=An[2]*hr+Vs,Xi=An[3]*Rr+Gi,Vs=An[4]*hr+Vs,Gi=An[5]*Rr+Gi,pa(Rn,Ci,ci,Xi,Vs,Gi));return Qe&&ii(),vn(Be),this},b.path=function(D){for(var ht=0;ht<D.length;ht++){var zt=D[ht],ie=zt.c;switch(zt.op){case"m":sl(ie[0],ie[1]);break;case"l":Qs(ie[0],ie[1]);break;case"c":pa.apply(this,ie);break;case"h":ii()}}return this},b.__private__.rect=b.rect=function(D,ht,zt,ie,Be){if(isNaN(D)||isNaN(ht)||isNaN(zt)||isNaN(ie)||!bs(Be))throw new Error("Invalid arguments passed to jsPDF.rect");return K===z.COMPAT&&(ie=-ie),Qt([it(ot(D)),it(yt(ht)),it(ot(zt)),it(ot(ie)),"re"].join(" ")),vn(Be),this},b.__private__.triangle=b.triangle=function(D,ht,zt,ie,Be,Qe,hr){if(isNaN(D)||isNaN(ht)||isNaN(zt)||isNaN(ie)||isNaN(Be)||isNaN(Qe)||!bs(hr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[zt-D,ie-ht],[Be-zt,Qe-ie],[D-Be,ht-Qe]],D,ht,[1,1],hr,!0),this},b.__private__.roundedRect=b.roundedRect=function(D,ht,zt,ie,Be,Qe,hr){if(isNaN(D)||isNaN(ht)||isNaN(zt)||isNaN(ie)||isNaN(Be)||isNaN(Qe)||!bs(hr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Rr=4/3*(Math.SQRT2-1);return Be=Math.min(Be,.5*zt),Qe=Math.min(Qe,.5*ie),this.lines([[zt-2*Be,0],[Be*Rr,0,Be,Qe-Qe*Rr,Be,Qe],[0,ie-2*Qe],[0,Qe*Rr,-Be*Rr,Qe,-Be,Qe],[2*Be-zt,0],[-Be*Rr,0,-Be,-Qe*Rr,-Be,-Qe],[0,2*Qe-ie],[0,-Qe*Rr,Be*Rr,-Qe,Be,-Qe]],D+Be,ht,[1,1],hr,!0),this},b.__private__.ellipse=b.ellipse=function(D,ht,zt,ie,Be){if(isNaN(D)||isNaN(ht)||isNaN(zt)||isNaN(ie)||!bs(Be))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Qe=4/3*(Math.SQRT2-1)*zt,hr=4/3*(Math.SQRT2-1)*ie;return sl(D+zt,ht),pa(D+zt,ht-hr,D+Qe,ht-ie,D,ht-ie),pa(D-Qe,ht-ie,D-zt,ht-hr,D-zt,ht),pa(D-zt,ht+hr,D-Qe,ht+ie,D,ht+ie),pa(D+Qe,ht+ie,D+zt,ht+hr,D+zt,ht),vn(Be),this},b.__private__.circle=b.circle=function(D,ht,zt,ie){if(isNaN(D)||isNaN(ht)||isNaN(zt)||!bs(ie))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,ht,zt,zt,ie)},b.setFont=function(D,ht,zt){return zt&&(ht=Y(ht,zt)),Vr=bt(D,ht,{disableWarning:!1}),this};var Jc=b.__private__.getFont=b.getFont=function(){return Bt[bt.apply(b,arguments)]};b.__private__.getFontList=b.getFontList=function(){var D,ht,zt={};for(D in ct)if(ct.hasOwnProperty(D))for(ht in zt[D]=[],ct[D])ct[D].hasOwnProperty(ht)&&zt[D].push(ht);return zt},b.addFont=function(D,ht,zt,ie,Be){var Qe=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Qe.indexOf(arguments[3])!==-1?Be=arguments[3]:arguments[3]&&Qe.indexOf(arguments[3])==-1&&(zt=Y(zt,ie)),Be=Be||"Identity-H",fa.call(this,D,ht,zt,Be)};var Da,Na=r.lineWidth||.200025,tu=b.__private__.getLineWidth=b.getLineWidth=function(){return Na},Wu=b.__private__.setLineWidth=b.setLineWidth=function(D){return Na=D,Qt(it(ot(D))+" w"),this};b.__private__.setLineDash=hn.API.setLineDash=hn.API.setLineDashPattern=function(D,ht){if(D=D||[],ht=ht||0,isNaN(ht)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(zt){return it(ot(zt))}).join(" "),ht=it(ot(ht)),Qt("["+D+"] "+ht+" d"),this};var $u=b.__private__.getLineHeight=b.getLineHeight=function(){return Xe*Da};b.__private__.getLineHeight=b.getLineHeight=function(){return Xe*Da};var kh=b.__private__.setLineHeightFactor=b.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(Da=D),this},oc=b.__private__.getLineHeightFactor=b.getLineHeightFactor=function(){return Da};kh(r.lineHeight);var Pn=b.__private__.getHorizontalCoordinate=function(D){return ot(D)},Ro=b.__private__.getVerticalCoordinate=function(D){return K===z.ADVANCED?D:he[Tt].mediaBox.topRightY-he[Tt].mediaBox.bottomLeftY-ot(D)},Wo=b.__private__.getHorizontalCoordinateString=b.getHorizontalCoordinateString=function(D){return it(Pn(D))},Oo=b.__private__.getVerticalCoordinateString=b.getVerticalCoordinateString=function(D){return it(Ro(D))},si=r.strokeColor||"0 G";b.__private__.getStrokeColor=b.getDrawColor=function(){return Ai(si)},b.__private__.setStrokeColor=b.setDrawColor=function(D,ht,zt,ie){return si=mn({ch1:D,ch2:ht,ch3:zt,ch4:ie,pdfColorType:"draw",precision:2}),Qt(si),this};var eu=r.fillColor||"0 g";b.__private__.getFillColor=b.getFillColor=function(){return Ai(eu)},b.__private__.setFillColor=b.setFillColor=function(D,ht,zt,ie){return eu=mn({ch1:D,ch2:ht,ch3:zt,ch4:ie,pdfColorType:"fill",precision:2}),Qt(eu),this};var Uo=r.textColor||"0 g",NA=b.__private__.getTextColor=b.getTextColor=function(){return Ai(Uo)};b.__private__.setTextColor=b.setTextColor=function(D,ht,zt,ie){return Uo=mn({ch1:D,ch2:ht,ch3:zt,ch4:ie,pdfColorType:"text",precision:3}),this};var Xu=r.charSpace,Zu=b.__private__.getCharSpace=b.getCharSpace=function(){return parseFloat(Xu||0)};b.__private__.setCharSpace=b.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Xu=D,this};var ru=0;b.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},b.__private__.setLineCap=b.setLineCap=function(D){var ht=b.CapJoinStyles[D];if(ht===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ru=ht,Qt(ht+" J"),this};var Qh=0;b.__private__.setLineJoin=b.setLineJoin=function(D){var ht=b.CapJoinStyles[D];if(ht===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Qh=ht,Qt(ht+" j"),this},b.__private__.setLineMiterLimit=b.__private__.setMiterLimit=b.setLineMiterLimit=b.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Qt(it(ot(D))+" M"),this},b.GState=py,b.setGState=function(D){(D=typeof D=="string"?Gt[le[D]]:nu(null,D)).equals(ge)||(Qt("/"+D.id+" gs"),ge=D)};var nu=function(D,ht){if(!D||!le[D]){var zt=!1;for(var ie in Gt)if(Gt.hasOwnProperty(ie)&&Gt[ie].equals(ht)){zt=!0;break}if(zt)ht=Gt[ie];else{var Be="GS"+(Object.keys(Gt).length+1).toString(10);Gt[Be]=ht,ht.id=Be}return D&&(le[D]=ht.id),ve.publish("addGState",ht),ht}};b.addGState=function(D,ht){return nu(D,ht),this},b.saveGraphicsState=function(){return Qt("q"),ft.push({key:Vr,size:Xe,color:Uo}),this},b.restoreGraphicsState=function(){Qt("Q");var D=ft.pop();return Vr=D.key,Xe=D.size,Uo=D.color,ge=null,this},b.setCurrentTransformationMatrix=function(D){return Qt(D.toString()+" cm"),this},b.comment=function(D){return Qt("#"+D),this};var ga=function(D,ht){var zt=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return zt},set:function(Qe){isNaN(Qe)||(zt=parseFloat(Qe))}});var ie=ht||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return ie},set:function(Qe){isNaN(Qe)||(ie=parseFloat(Qe))}});var Be="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Be},set:function(Qe){Be=Qe.toString()}}),this},zs=function(D,ht,zt,ie){ga.call(this,D,ht),this.type="rect";var Be=zt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Be},set:function(hr){isNaN(hr)||(Be=parseFloat(hr))}});var Qe=ie||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Qe},set:function(hr){isNaN(hr)||(Qe=parseFloat(hr))}}),this},Sl=function(){this.page=te,this.currentPage=Tt,this.pages=Ve.slice(0),this.pagesContext=he.slice(0),this.x=In,this.y=an,this.matrix=Xn,this.width=iu(Tt),this.height=ma(Tt),this.outputDestination=or,this.id="",this.objectNumber=-1};Sl.prototype.restore=function(){te=this.page,Tt=this.currentPage,he=this.pagesContext,Ve=this.pages,In=this.x,an=this.y,Xn=this.matrix,su(Tt,this.width),Pl(Tt,this.height),or=this.outputDestination};var Il=function(D,ht,zt,ie,Be){ir.push(new Sl),te=Tt=0,Ve=[],In=D,an=ht,Xn=Be,on([zt,ie])},zh=function(D){if(ur[D])ir.pop().restore();else{var ht=new Sl,zt="Xo"+(Object.keys(Yt).length+1).toString(10);ht.id=zt,ur[D]=zt,Yt[zt]=ht,ve.publish("addFormObject",ht),ir.pop().restore()}};for(var Hs in b.beginFormObject=function(D,ht,zt,ie,Be){return Il(D,ht,zt,ie,Be),this},b.endFormObject=function(D){return zh(D),this},b.doFormObject=function(D,ht){var zt=Yt[ur[D]];return Qt("q"),Qt(ht.toString()+" cm"),Qt("/"+zt.id+" Do"),Qt("Q"),this},b.getFormObject=function(D){var ht=Yt[ur[D]];return{x:ht.x,y:ht.y,width:ht.width,height:ht.height,matrix:ht.matrix}},b.save=function(D,ht){return D=D||"generated.pdf",(ht=ht||{}).returnPromise=ht.returnPromise||!1,ht.returnPromise===!1?(md(Bn(Gr()),D),typeof md.unload=="function"&&un.setTimeout&&setTimeout(md.unload,911),this):new Promise(function(zt,ie){try{var Be=md(Bn(Gr()),D);typeof md.unload=="function"&&un.setTimeout&&setTimeout(md.unload,911),zt(Be)}catch(Qe){ie(Qe.message)}})},hn.API)hn.API.hasOwnProperty(Hs)&&(Hs==="events"&&hn.API.events.length?function(D,ht){var zt,ie,Be;for(Be=ht.length-1;Be!==-1;Be--)zt=ht[Be][0],ie=ht[Be][1],D.subscribe.apply(D,[zt].concat(typeof ie=="function"?[ie]:ie))}(ve,hn.API.events):b[Hs]=hn.API[Hs]);var iu=b.getPageWidth=function(D){return(he[D=D||Tt].mediaBox.topRightX-he[D].mediaBox.bottomLeftX)/yr},su=b.setPageWidth=function(D,ht){he[D].mediaBox.topRightX=ht*yr+he[D].mediaBox.bottomLeftX},ma=b.getPageHeight=function(D){return(he[D=D||Tt].mediaBox.topRightY-he[D].mediaBox.bottomLeftY)/yr},Pl=b.setPageHeight=function(D,ht){he[D].mediaBox.topRightY=ht*yr+he[D].mediaBox.bottomLeftY};return b.internal={pdfEscape:Bi,getStyle:Zc,getFont:Jc,getFontSize:gr,getCharSpace:Zu,getTextColor:NA,getLineHeight:$u,getLineHeightFactor:oc,getLineWidth:tu,write:Ur,getHorizontalCoordinate:Pn,getVerticalCoordinate:Ro,getCoordinateString:Wo,getVerticalCoordinateString:Oo,collections:{},newObject:_r,newAdditionalObject:Qr,newObjectDeferred:Fr,newObjectDeferredBegin:Yr,getFilters:Dn,putStream:gn,events:ve,scaleFactor:yr,pageSize:{getWidth:function(){return iu(Tt)},setWidth:function(D){su(Tt,D)},getHeight:function(){return ma(Tt)},setHeight:function(D){Pl(Tt,D)}},encryptionOptions:m,encryption:nn,getEncryptor:Xc,output:yi,getNumberOfPages:Ku,pages:Ve,out:Qt,f2:Ct,f3:st,getPageInfo:Ko,getPageInfoByObjId:en,getCurrentPageInfo:Lo,getPDFVersion:F,Point:ga,Rectangle:zs,Matrix:tr,hasHotfix:_i},Object.defineProperty(b.internal.pageSize,"width",{get:function(){return iu(Tt)},set:function(D){su(Tt,D)},enumerable:!0,configurable:!0}),Object.defineProperty(b.internal.pageSize,"height",{get:function(){return ma(Tt)},set:function(D){Pl(Tt,D)},enumerable:!0,configurable:!0}),sc.call(b,$e),Vr="F1",ks(i,e),ve.publish("initialized"),b}Uf.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},Uf.prototype.toHexString=function(r){return r.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Uf.prototype.hexToBytes=function(r){for(var t=[],e=0;e<r.length;e+=2)t.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return t.join("")},Uf.prototype.processOwnerPassword=function(r,t){return r2(e2(t).substr(0,5),r)},Uf.prototype.encryptor=function(r,t){var e=e2(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return r2(e,n)}},py.prototype.equals=function(r){var t,e="id,objectNumber,equals";if(!r||li(r)!==li(this))return!1;var n=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!r.hasOwnProperty(t)||this[t]!==r[t])return!1;n++}for(t in r)r.hasOwnProperty(t)&&e.indexOf(t)<0&&n--;return n===0},hn.API={events:[]},hn.version="2.5.2";var gs=hn.API,n2=1,_d=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},kf=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},bn=function(r){return r.toFixed(2)},wA=function(r){return r.toFixed(5)};gs.__acroform__={};var Ja=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},bF=function(r){return r*n2},Nu=function(r){var t=new xF,e=Wr.internal.getHeight(r)||0,n=Wr.internal.getWidth(r)||0;return t.BBox=[0,0,Number(bn(n)),Number(bn(e))],t},Qnt=gs.__acroform__.setBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<t},znt=gs.__acroform__.clearBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<t)},Hnt=gs.__acroform__.getBit=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<t?1:0},Is=gs.__acroform__.getBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Hnt(r,t-1)},Ps=gs.__acroform__.setBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Qnt(r,t-1)},Ms=gs.__acroform__.clearBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return znt(r,t-1)},Vnt=gs.__acroform__.calculateCoordinates=function(r,t){var e=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],d={};return d.lowerLeft_X=e(i)||0,d.lowerLeft_Y=n(s+o)||0,d.upperRight_X=e(i+a)||0,d.upperRight_Y=n(s)||0,[Number(bn(d.lowerLeft_X)),Number(bn(d.lowerLeft_Y)),Number(bn(d.upperRight_X)),Number(bn(d.upperRight_Y))]},Gnt=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var t=[],e=r._V||r.DV,n=i2(r,e),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(r.scope.__private__.encodeColorString(r.color)),t.push("/"+i+" "+bn(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Nu(r);return s.scope=r.scope,s.stream=t.join(`
`),s}},i2=function(r,t){var e=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");i=r.multiline?i.map(function(st){return st.split(`
`)}):i.map(function(st){return[st]});var s=e,a=Wr.internal.getHeight(r)||0;a=a<0?-a:a;var o=Wr.internal.getWidth(r)||0;o=o<0?-o:o;var d=function(st,ot,vt){if(st+1<i.length){var yt=ot+" "+i[st+1][0];return gy(yt,r,vt).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var f,m,v=gy("3",r,s).height,C=r.multiline?a-s:(a-v)/2,b=C+=2,P=0,F=0,U=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+gy(t,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var k="",z=0,K=0;K<i.length;K++)if(i.hasOwnProperty(K)){var G=!1;if(i[K].length!==1&&U!==i[K].length-1){if((v+2)*(z+2)+2>a)continue t;k+=i[K][U],G=!0,F=K,K--}else{k=(k+=i[K][U]+" ").substr(k.length-1)==" "?k.substr(0,k.length-1):k;var X=parseInt(K),Y=d(X,k,s),it=K>=i.length-1;if(Y&&!it){k+=" ",U=0;continue}if(Y||it){if(it)F=X;else if(r.multiline&&(v+2)*(z+2)+2>a)continue t}else{if(!r.multiline||(v+2)*(z+2)+2>a)continue t;F=X}}for(var nt="",wt=P;wt<=F;wt++){var Ct=i[wt];if(r.multiline){if(wt===F){nt+=Ct[U]+" ",U=(U+1)%Ct.length;continue}if(wt===P){nt+=Ct[Ct.length-1]+" ";continue}}nt+=Ct[0]+" "}switch(nt=nt.substr(nt.length-1)==" "?nt.substr(0,nt.length-1):nt,m=gy(nt,r,s).width,r.textAlign){case"right":f=o-m-2;break;case"center":f=(o-m)/2;break;case"left":default:f=2}t+=bn(f)+" "+bn(b)+` Td
`,t+="("+_d(nt)+`) Tj
`,t+=-bn(f)+` 0 Td
`,b=-(s+2),m=0,P=G?F:F+1,z++,k=""}break}return n.text=t,n.fontSize=s,n},gy=function(r,t,e){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},jnt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},qnt=function(r,t){var e={type:"reference",object:r};t.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===e.type&&n.object===e.object})===void 0&&t.internal.getPageInfo(r.page).pageContext.annotations.push(e)},Knt=function(r,t){for(var e in r)if(r.hasOwnProperty(e)){var n=e,i=r[e];t.internal.newObjectDeferredBegin(i.objId,!0),li(i)==="object"&&typeof i.putStream=="function"&&i.putStream(),delete r[n]}},Wnt=function(r,t){if(t.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(Rc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(jnt)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");n2=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new BF,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&qnt(s,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],d=[],f=o.Rect;if(o.Rect&&(o.Rect=Vnt(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Wr.createDefaultAppearanceStream(o),li(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(d=o.getKeyValueListForStream()),o.Rect=f,o.hasAppearanceStream&&!o.appearanceStreamContent){var m=Gnt(o);d.push({key:"AP",value:"<</N "+m+">>"}),i.internal.acroformPlugin.xForms.push(m)}if(o.appearanceStreamContent){var v="";for(var C in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(C)){var b=o.appearanceStreamContent[C];if(v+="/"+C+" ",v+="<<",Object.keys(b).length>=1||Array.isArray(b)){for(var a in b)if(b.hasOwnProperty(a)){var P=b[a];typeof P=="function"&&(P=P.call(i,o)),v+="/"+a+" "+P+" ",i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P)}}else typeof(P=b)=="function"&&(P=P.call(i,o)),v+="/"+a+" "+P,i.internal.acroformPlugin.xForms.indexOf(P)>=0||i.internal.acroformPlugin.xForms.push(P);v+=">>"}d.push({key:"AP",value:`<<
`+v+">>"})}i.internal.putStream({additionalKeyValues:d,objectId:o.objId}),i.internal.out("endobj")}s&&Knt(i.internal.acroformPlugin.xForms,i)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},wF=gs.__acroform__.arrayToPdfArray=function(r,t,e){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),li(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(t!==void 0&&e&&(n=e.internal.getEncryptor(t)),i+="("+_d(n(r[s].toString()))+")"):i+=r[s].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},s2=function(r,t,e){var n=function(i){return i};return t!==void 0&&e&&(n=e.internal.getEncryptor(t)),(r=r||"").toString(),r="("+_d(n(r))+")"},ku=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};ku.prototype.toString=function(){return this.objId+" 0 R"},ku.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},ku.prototype.getKeyValueListForStream=function(){var r=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var n=t[e],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:wF(i,this.objId,this.scope)}):i instanceof ku?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var xF=function(){ku.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};Ja(xF,ku);var BF=function(){ku.call(this);var r,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(n){return n};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+_d(e(r))+")"}},set:function(e){r=e}})};Ja(BF,ku);var Rc=function r(){ku.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(k){if(isNaN(k))throw new Error('Invalid value "'+k+'" for attribute F supplied.');t=k}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Is(t,3)},set:function(k){k?this.F=Ps(t,3):this.F=Ms(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(k){if(isNaN(k))throw new Error('Invalid value "'+k+'" for attribute Ff supplied.');e=k}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(k){n=k!==void 0?k:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(k){n[0]=k}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(k){n[1]=k}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(k){n[2]=k}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(k){n[3]=k}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(k){switch(k){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=k;break;default:throw new Error('Invalid value "'+k+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof _y)return;s="FieldObject"+r.FieldNum++}var k=function(z){return z};return this.scope&&(k=this.scope.internal.getEncryptor(this.objId)),"("+_d(k(s))+")"},set:function(k){s=k.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(k){s=k}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(k){a=k}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(k){o=k}});var d=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return d},set:function(k){d=k}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/n2:f},set:function(k){f=k}});var m="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return m},set:function(k){m=k}});var v="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!v||this instanceof _y||this instanceof vd))return s2(v,this.objId,this.scope)},set:function(k){k=k.toString(),v=k}});var C=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(C)return this instanceof To?C:s2(C,this.objId,this.scope)},set:function(k){k=k.toString(),C=this instanceof To?k:k.substr(0,1)==="("?kf(k.substr(1,k.length-2)):kf(k)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof To?kf(C.substr(1,C.length-1)):C},set:function(k){k=k.toString(),C=this instanceof To?"/"+k:k}});var b=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(b)return b},set:function(k){this.V=k}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(b)return this instanceof To?b:s2(b,this.objId,this.scope)},set:function(k){k=k.toString(),b=this instanceof To?k:k.substr(0,1)==="("?kf(k.substr(1,k.length-2)):kf(k)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof To?kf(b.substr(1,b.length-1)):b},set:function(k){k=k.toString(),b=this instanceof To?"/"+k:k}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var P,F=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return F},set:function(k){k=!!k,F=k}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(P)return P},set:function(k){P=k}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,1)},set:function(k){k?this.Ff=Ps(this.Ff,1):this.Ff=Ms(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,2)},set:function(k){k?this.Ff=Ps(this.Ff,2):this.Ff=Ms(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,3)},set:function(k){k?this.Ff=Ps(this.Ff,3):this.Ff=Ms(this.Ff,3)}});var U=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(U!==null)return U},set:function(k){if([0,1,2].indexOf(k)===-1)throw new Error('Invalid value "'+k+'" for attribute Q supplied.');U=k}}),Object.defineProperty(this,"textAlign",{get:function(){var k;switch(U){case 0:default:k="left";break;case 1:k="center";break;case 2:k="right"}return k},configurable:!0,enumerable:!0,set:function(k){switch(k){case"right":case 2:U=2;break;case"center":case 1:U=1;break;case"left":case 0:default:U=0}}})};Ja(Rc,ku);var Qf=function(){Rc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return wF(t,this.objId,this.scope)},set:function(e){var n,i;i=[],typeof(n=e)=="string"&&(i=function(s,a,o){o||(o=1);for(var d,f=[];d=a.exec(s);)f.push(d[o]);return f}(n,/\((.*?)\)/g)),t=i}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,18)},set:function(e){e?this.Ff=Ps(this.Ff,18):this.Ff=Ms(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Ps(this.Ff,19):this.Ff=Ms(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,20)},set:function(e){e?(this.Ff=Ps(this.Ff,20),t.sort()):this.Ff=Ms(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,22)},set:function(e){e?this.Ff=Ps(this.Ff,22):this.Ff=Ms(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,23)},set:function(e){e?this.Ff=Ps(this.Ff,23):this.Ff=Ms(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,27)},set:function(e){e?this.Ff=Ps(this.Ff,27):this.Ff=Ms(this.Ff,27)}}),this.hasAppearanceStream=!1};Ja(Qf,Rc);var zf=function(){Qf.call(this),this.fontName="helvetica",this.combo=!1};Ja(zf,Qf);var Hf=function(){zf.call(this),this.combo=!0};Ja(Hf,zf);var my=function(){Hf.call(this),this.edit=!0};Ja(my,Hf);var To=function(){Rc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,15)},set:function(e){e?this.Ff=Ps(this.Ff,15):this.Ff=Ms(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,16)},set:function(e){e?this.Ff=Ps(this.Ff,16):this.Ff=Ms(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,17)},set:function(e){e?this.Ff=Ps(this.Ff,17):this.Ff=Ms(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,26)},set:function(e){e?this.Ff=Ps(this.Ff,26):this.Ff=Ms(this.Ff,26)}});var r,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,i=[];for(n in i.push("<<"),t)i.push("/"+n+" ("+_d(e(t[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){li(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};Ja(To,Rc);var yy=function(){To.call(this),this.pushButton=!0};Ja(yy,To);var Vf=function(){To.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t!==void 0?t:[]}})};Ja(Vf,To);var _y=function(){var r,t;Rc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(i){t=i}});var e,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+_d(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){li(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Wr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Ja(_y,Rc),Vf.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},Vf.prototype.createOption=function(r){var t=new _y;return t.Parent=this,t.optionName=r,this.Kids.push(t),$nt.call(this.scope,t),t};var vy=function(){To.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Wr.CheckBox.createAppearanceStream()};Ja(vy,To);var vd=function(){Rc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,13)},set:function(t){t?this.Ff=Ps(this.Ff,13):this.Ff=Ms(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,21)},set:function(t){t?this.Ff=Ps(this.Ff,21):this.Ff=Ms(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,23)},set:function(t){t?this.Ff=Ps(this.Ff,23):this.Ff=Ms(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,24)},set:function(t){t?this.Ff=Ps(this.Ff,24):this.Ff=Ms(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,25)},set:function(t){t?this.Ff=Ps(this.Ff,25):this.Ff=Ms(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,26)},set:function(t){t?this.Ff=Ps(this.Ff,26):this.Ff=Ms(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){Number.isInteger(t)&&(r=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Ja(vd,Rc);var by=function(){vd.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Is(this.Ff,14)},set:function(r){r?this.Ff=Ps(this.Ff,14):this.Ff=Ms(this.Ff,14)}}),this.password=!0};Ja(by,vd);var Wr={CheckBox:{createAppearanceStream:function(){return{N:{On:Wr.CheckBox.YesNormal},D:{On:Wr.CheckBox.YesPushDown,Off:Wr.CheckBox.OffPushDown}}},YesPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=i2(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+bn(Wr.internal.getWidth(r))+" "+bn(Wr.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+n+" "+bn(s.fontSize)+" Tf "+i),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(r){var t=Nu(r);t.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=Wr.internal.getHeight(r),a=Wr.internal.getWidth(r),o=i2(r,r.caption);return i.push("1 g"),i.push("0 0 "+bn(a)+" "+bn(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+bn(a-1)+" "+bn(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+bn(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+bn(Wr.internal.getWidth(r))+" "+bn(Wr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(r){var t={D:{Off:Wr.RadioButton.Circle.OffPushDown},N:{}};return t.N[r]=Wr.RadioButton.Circle.YesNormal,t.D[r]=Wr.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(r){var t=Nu(r);t.scope=r.scope;var e=[],n=Wr.internal.getWidth(r)<=Wr.internal.getHeight(r)?Wr.internal.getWidth(r)/4:Wr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Wr.internal.Bezier_C,s=Number((n*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+wA(Wr.internal.getWidth(r)/2)+" "+wA(Wr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),e.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),e.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),e.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=[],n=Wr.internal.getWidth(r)<=Wr.internal.getHeight(r)?Wr.internal.getWidth(r)/4:Wr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Wr.internal.Bezier_C).toFixed(5)),a=Number((n*Wr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+wA(Wr.internal.getWidth(r)/2)+" "+wA(Wr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+wA(Wr.internal.getWidth(r)/2)+" "+wA(Wr.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),e.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),e.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),e.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=[],n=Wr.internal.getWidth(r)<=Wr.internal.getHeight(r)?Wr.internal.getWidth(r)/4:Wr.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*Wr.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+wA(Wr.internal.getWidth(r)/2)+" "+wA(Wr.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(r){var t={D:{Off:Wr.RadioButton.Cross.OffPushDown},N:{}};return t.N[r]=Wr.RadioButton.Cross.YesNormal,t.D[r]=Wr.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(r){var t=Nu(r);t.scope=r.scope;var e=[],n=Wr.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+bn(Wr.internal.getWidth(r)-2)+" "+bn(Wr.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(bn(n.x1.x)+" "+bn(n.x1.y)+" m"),e.push(bn(n.x2.x)+" "+bn(n.x2.y)+" l"),e.push(bn(n.x4.x)+" "+bn(n.x4.y)+" m"),e.push(bn(n.x3.x)+" "+bn(n.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=Wr.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+bn(Wr.internal.getWidth(r))+" "+bn(Wr.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+bn(Wr.internal.getWidth(r)-2)+" "+bn(Wr.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(bn(e.x1.x)+" "+bn(e.x1.y)+" m"),n.push(bn(e.x2.x)+" "+bn(e.x2.y)+" l"),n.push(bn(e.x4.x)+" "+bn(e.x4.y)+" m"),n.push(bn(e.x3.x)+" "+bn(e.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(r){var t=Nu(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+bn(Wr.internal.getWidth(r))+" "+bn(Wr.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(r){var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+t+" "+r.fontSize+" Tf "+e}};Wr.internal={Bezier_C:.551915024494,calculateCross:function(r){var t=Wr.internal.getWidth(r),e=Wr.internal.getHeight(r),n=Math.min(t,e);return{x1:{x:(t-n)/2,y:(e-n)/2+n},x2:{x:(t-n)/2+n,y:(e-n)/2},x3:{x:(t-n)/2,y:(e-n)/2},x4:{x:(t-n)/2+n,y:(e-n)/2+n}}}},Wr.internal.getWidth=function(r){var t=0;return li(r)==="object"&&(t=bF(r.Rect[2])),t},Wr.internal.getHeight=function(r){var t=0;return li(r)==="object"&&(t=bF(r.Rect[3])),t};var $nt=gs.addField=function(r){if(Wnt(this,r),!(r instanceof Rc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=r).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};gs.AcroFormChoiceField=Qf,gs.AcroFormListBox=zf,gs.AcroFormComboBox=Hf,gs.AcroFormEditBox=my,gs.AcroFormButton=To,gs.AcroFormPushButton=yy,gs.AcroFormRadioButton=Vf,gs.AcroFormCheckBox=vy,gs.AcroFormTextField=vd,gs.AcroFormPasswordField=by,gs.AcroFormAppearance=Wr,gs.AcroForm={ChoiceField:Qf,ListBox:zf,ComboBox:Hf,EditBox:my,Button:To,PushButton:yy,RadioButton:Vf,CheckBox:vy,TextField:vd,PasswordField:by,Appearance:Wr},hn.AcroForm={ChoiceField:Qf,ListBox:zf,ComboBox:Hf,EditBox:my,Button:To,PushButton:yy,RadioButton:Vf,CheckBox:vy,TextField:vd,PasswordField:by,Appearance:Wr};function CF(r){return r.reduce(function(t,e,n){return t[e]=n,t},{})}(function(r){r.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=r.__addimage__.getImageFileTypeByImageData=function(st,ot){var vt,yt,re,Wt,ee,Zt=t;if((ot=ot||t)==="RGBA"||st.data!==void 0&&st.data instanceof Uint8ClampedArray&&"height"in st&&"width"in st)return"RGBA";if(Y(st))for(ee in e)for(re=e[ee],vt=0;vt<re.length;vt+=1){for(Wt=!0,yt=0;yt<re[vt].length;yt+=1)if(re[vt][yt]!==void 0&&re[vt][yt]!==st[yt]){Wt=!1;break}if(Wt===!0){Zt=ee;break}}else for(ee in e)for(re=e[ee],vt=0;vt<re.length;vt+=1){for(Wt=!0,yt=0;yt<re[vt].length;yt+=1)if(re[vt][yt]!==void 0&&re[vt][yt]!==st.charCodeAt(yt)){Wt=!1;break}if(Wt===!0){Zt=ee;break}}return Zt===t&&ot!==t&&(Zt=ot),Zt},i=function st(ot){for(var vt=this.internal.write,yt=this.internal.putStream,re=(0,this.internal.getFilters)();re.indexOf("FlateEncode")!==-1;)re.splice(re.indexOf("FlateEncode"),1);ot.objectId=this.internal.newObject();var Wt=[];if(Wt.push({key:"Type",value:"/XObject"}),Wt.push({key:"Subtype",value:"/Image"}),Wt.push({key:"Width",value:ot.width}),Wt.push({key:"Height",value:ot.height}),ot.colorSpace===U.INDEXED?Wt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ot.palette.length/3-1)+" "+("sMask"in ot&&ot.sMask!==void 0?ot.objectId+2:ot.objectId+1)+" 0 R]"}):(Wt.push({key:"ColorSpace",value:"/"+ot.colorSpace}),ot.colorSpace===U.DEVICE_CMYK&&Wt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Wt.push({key:"BitsPerComponent",value:ot.bitsPerComponent}),"decodeParameters"in ot&&ot.decodeParameters!==void 0&&Wt.push({key:"DecodeParms",value:"<<"+ot.decodeParameters+">>"}),"transparency"in ot&&Array.isArray(ot.transparency)){for(var ee="",Zt=0,oe=ot.transparency.length;Zt<oe;Zt++)ee+=ot.transparency[Zt]+" "+ot.transparency[Zt]+" ";Wt.push({key:"Mask",value:"["+ee+"]"})}ot.sMask!==void 0&&Wt.push({key:"SMask",value:ot.objectId+1+" 0 R"});var pe=ot.filter!==void 0?["/"+ot.filter]:void 0;if(yt({data:ot.data,additionalKeyValues:Wt,alreadyAppliedFilters:pe,objectId:ot.objectId}),vt("endobj"),"sMask"in ot&&ot.sMask!==void 0){var De="/Predictor "+ot.predictor+" /Colors 1 /BitsPerComponent "+ot.bitsPerComponent+" /Columns "+ot.width,at={width:ot.width,height:ot.height,colorSpace:"DeviceGray",bitsPerComponent:ot.bitsPerComponent,decodeParameters:De,data:ot.sMask};"filter"in ot&&(at.filter=ot.filter),st.call(this,at)}if(ot.colorSpace===U.INDEXED){var Tt=this.internal.newObject();yt({data:nt(new Uint8Array(ot.palette)),objectId:Tt}),vt("endobj")}},s=function(){var st=this.internal.collections.addImage_images;for(var ot in st)i.call(this,st[ot])},a=function(){var st,ot=this.internal.collections.addImage_images,vt=this.internal.write;for(var yt in ot)vt("/I"+(st=ot[yt]).index,st.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},d=function(){var st=this.internal.collections.addImage_images;return o.call(this),st},f=function(){return Object.keys(this.internal.collections.addImage_images).length},m=function(st){return typeof r["process"+st.toUpperCase()]=="function"},v=function(st){return li(st)==="object"&&st.nodeType===1},C=function(st,ot){if(st.nodeName==="IMG"&&st.hasAttribute("src")){var vt=""+st.getAttribute("src");if(vt.indexOf("data:image/")===0)return Ug(unescape(vt).split("base64,").pop());var yt=r.loadFile(vt,!0);if(yt!==void 0)return yt}if(st.nodeName==="CANVAS"){if(st.width===0||st.height===0)throw new Error("Given canvas must have data. Canvas width: "+st.width+", height: "+st.height);var re;switch(ot){case"PNG":re="image/png";break;case"WEBP":re="image/webp";break;case"JPEG":case"JPG":default:re="image/jpeg"}return Ug(st.toDataURL(re,1).split("base64,").pop())}},b=function(st){var ot=this.internal.collections.addImage_images;if(ot){for(var vt in ot)if(st===ot[vt].alias)return ot[vt]}},P=function(st,ot,vt){return st||ot||(st=-96,ot=-96),st<0&&(st=-1*vt.width*72/st/this.internal.scaleFactor),ot<0&&(ot=-1*vt.height*72/ot/this.internal.scaleFactor),st===0&&(st=ot*vt.width/vt.height),ot===0&&(ot=st*vt.height/vt.width),[st,ot]},F=function(st,ot,vt,yt,re,Wt){var ee=P.call(this,vt,yt,re),Zt=this.internal.getCoordinateString,oe=this.internal.getVerticalCoordinateString,pe=d.call(this);if(vt=ee[0],yt=ee[1],pe[re.index]=re,Wt){Wt*=Math.PI/180;var De=Math.cos(Wt),at=Math.sin(Wt),Tt=function(Nt){return Nt.toFixed(4)},Rt=[Tt(De),Tt(at),Tt(-1*at),Tt(De),0,0,"cm"]}this.internal.write("q"),Wt?(this.internal.write([1,"0","0",1,Zt(st),oe(ot+yt),"cm"].join(" ")),this.internal.write(Rt.join(" ")),this.internal.write([Zt(vt),"0","0",Zt(yt),"0","0","cm"].join(" "))):this.internal.write([Zt(vt),"0","0",Zt(yt),Zt(st),oe(ot+yt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+re.index+" Do"),this.internal.write("Q")},U=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var k=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},z=r.__addimage__.sHashCode=function(st){var ot,vt,yt=0;if(typeof st=="string")for(vt=st.length,ot=0;ot<vt;ot++)yt=(yt<<5)-yt+st.charCodeAt(ot),yt|=0;else if(Y(st))for(vt=st.byteLength/2,ot=0;ot<vt;ot++)yt=(yt<<5)-yt+st[ot],yt|=0;return yt},K=r.__addimage__.validateStringAsBase64=function(st){(st=st||"").toString().trim();var ot=!0;return st.length===0&&(ot=!1),st.length%4!=0&&(ot=!1),/^[A-Za-z0-9+/]+$/.test(st.substr(0,st.length-2))===!1&&(ot=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(st.substr(-2))===!1&&(ot=!1),ot},G=r.__addimage__.extractImageFromDataUrl=function(st){var ot=(st=st||"").split("base64,"),vt=null;if(ot.length===2){var yt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(ot[0]);Array.isArray(yt)&&(vt={mimeType:yt[1],charset:yt[2],data:ot[1]})}return vt},X=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(st){return X()&&st instanceof ArrayBuffer};var Y=r.__addimage__.isArrayBufferView=function(st){return X()&&typeof Uint32Array<"u"&&(st instanceof Int8Array||st instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&st instanceof Uint8ClampedArray||st instanceof Int16Array||st instanceof Uint16Array||st instanceof Int32Array||st instanceof Uint32Array||st instanceof Float32Array||st instanceof Float64Array)},it=r.__addimage__.binaryStringToUint8Array=function(st){for(var ot=st.length,vt=new Uint8Array(ot),yt=0;yt<ot;yt++)vt[yt]=st.charCodeAt(yt);return vt},nt=r.__addimage__.arrayBufferToBinaryString=function(st){for(var ot="",vt=Y(st)?st:new Uint8Array(st),yt=0;yt<vt.length;yt+=8192)ot+=String.fromCharCode.apply(null,vt.subarray(yt,yt+8192));return ot};r.addImage=function(){var st,ot,vt,yt,re,Wt,ee,Zt,oe;if(typeof arguments[1]=="number"?(ot=t,vt=arguments[1],yt=arguments[2],re=arguments[3],Wt=arguments[4],ee=arguments[5],Zt=arguments[6],oe=arguments[7]):(ot=arguments[1],vt=arguments[2],yt=arguments[3],re=arguments[4],Wt=arguments[5],ee=arguments[6],Zt=arguments[7],oe=arguments[8]),li(st=arguments[0])==="object"&&!v(st)&&"imageData"in st){var pe=st;st=pe.imageData,ot=pe.format||ot||t,vt=pe.x||vt||0,yt=pe.y||yt||0,re=pe.w||pe.width||re,Wt=pe.h||pe.height||Wt,ee=pe.alias||ee,Zt=pe.compression||Zt,oe=pe.rotation||pe.angle||oe}var De=this.internal.getFilters();if(Zt===void 0&&De.indexOf("FlateEncode")!==-1&&(Zt="SLOW"),isNaN(vt)||isNaN(yt))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var at=wt.call(this,st,ot,ee,Zt);return F.call(this,vt,yt,re,Wt,at,oe),this};var wt=function(st,ot,vt,yt){var re,Wt,ee;if(typeof st=="string"&&n(st)===t){st=unescape(st);var Zt=Ct(st,!1);(Zt!==""||(Zt=r.loadFile(st,!0))!==void 0)&&(st=Zt)}if(v(st)&&(st=C(st,ot)),ot=n(st,ot),!m(ot))throw new Error("addImage does not support files of type '"+ot+"', please ensure that a plugin for '"+ot+"' support is added.");if(((ee=vt)==null||ee.length===0)&&(vt=function(oe){return typeof oe=="string"||Y(oe)?z(oe):Y(oe.data)?z(oe.data):null}(st)),(re=b.call(this,vt))||(X()&&(st instanceof Uint8Array||ot==="RGBA"||(Wt=st,st=it(st))),re=this["process"+ot.toUpperCase()](st,f.call(this),vt,function(oe){return oe&&typeof oe=="string"&&(oe=oe.toUpperCase()),oe in r.image_compression?oe:k.NONE}(yt),Wt)),!re)throw new Error("An unknown error occurred whilst processing the image.");return re},Ct=r.__addimage__.convertBase64ToBinaryString=function(st,ot){var vt;ot=typeof ot!="boolean"||ot;var yt,re="";if(typeof st=="string"){yt=(vt=G(st))!==null?vt.data:st;try{re=Ug(yt)}catch(Wt){if(ot)throw K(yt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Wt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return re};r.getImageProperties=function(st){var ot,vt,yt="";if(v(st)&&(st=C(st)),typeof st=="string"&&n(st)===t&&((yt=Ct(st,!1))===""&&(yt=r.loadFile(st)||""),st=yt),vt=n(st),!m(vt))throw new Error("addImage does not support files of type '"+vt+"', please ensure that a plugin for '"+vt+"' support is added.");if(!X()||st instanceof Uint8Array||(st=it(st)),!(ot=this["process"+vt.toUpperCase()](st)))throw new Error("An unknown error occurred whilst processing the image");return ot.fileType=vt,ot}})(hn.API),function(r){var t=function(e){if(e!==void 0&&e!="")return!0};hn.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,d=this.internal.getPageInfoByObjId(e.objId),f=e.pageContext.annotations,m=!1,v=0;v<f.length&&!m;v++)switch((n=f[v]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(m=!0);break;case"reference":case"text":case"freetext":m=!0}if(m!=0){this.internal.write("/Annots [");for(var C=0;C<f.length;C++){n=f[C];var b=this.internal.pdfEscape,P=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var F=this.internal.newAdditionalObject(),U=this.internal.newAdditionalObject(),k=this.internal.getEncryptor(F.objId),z=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+b(k(n.contents))+")",s+=" /Popup "+U.objId+" 0 R",s+=" /P "+d.objId+" 0 R",s+=" /T ("+b(k(z))+") >>",F.content=s;var K=F.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+K,n.open&&(s+=" /Open true"),s+=" >>",U.content=s,this.internal.write(F.objId,"0 R",U.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var G=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+b(P(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+G+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var X=this.annotations._nameMap[n.options.name];n.options.pageNumber=X.page,n.options.top=X.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+b(P(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var Y=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+Y+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var n=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":n.pageContext.annotations.push(e)}},r.link=function(e,n,i,s,a){var o=this.internal.getCurrentPageInfo(),d=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:d(e),y:f(n),w:d(e+i),h:f(n+s)},options:a,type:"link"})},r.textWithLink=function(e,n,i,s){var a,o,d=this.getTextWidth(e),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var m=this.splitTextToSize(e,o).length;a=Math.ceil(f*m)}else o=d,a=f;return this.text(e,n,i,s),i+=.2*f,s.align==="center"&&(n-=d/2),s.align==="right"&&(n-=d),this.link(n,i-f,o,a,s),d},r.getTextWidth=function(e){var n=this.internal.getFontSize();return this.getStringUnitWidth(e)*n/this.internal.scaleFactor}}(hn.API),function(r){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(F){return t[F.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(F){return typeof F=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(F)},o=r.__arabicParser__.isArabicEndLetter=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length<=2},d=r.__arabicParser__.isArabicAlfLetter=function(F){return a(F)&&i.indexOf(F.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=1};var f=r.__arabicParser__.arabicLetterHasFinalForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=3};var m=r.__arabicParser__.arabicLetterHasMedialForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length==4},v=r.__arabicParser__.resolveLigatures=function(F){var U=0,k=e,z="",K=0;for(U=0;U<F.length;U+=1)k[F.charCodeAt(U)]!==void 0?(K++,typeof(k=k[F.charCodeAt(U)])=="number"&&(z+=String.fromCharCode(k),k=e,K=0),U===F.length-1&&(k=e,z+=F.charAt(U-(K-1)),U-=K-1,K=0)):(k=e,z+=F.charAt(U-K),U-=K,K=0);return z};r.__arabicParser__.isArabicDiacritic=function(F){return F!==void 0&&n[F.charCodeAt(0)]!==void 0};var C=r.__arabicParser__.getCorrectForm=function(F,U,k){return a(F)?s(F)===!1?-1:!f(F)||!a(U)&&!a(k)||!a(k)&&o(U)||o(F)&&!a(U)||o(F)&&d(U)||o(F)&&o(U)?0:m(F)&&a(U)&&!o(U)&&a(k)&&f(k)?3:o(F)||!a(k)?1:2:-1},b=function(F){var U=0,k=0,z=0,K="",G="",X="",Y=(F=F||"").split("\\s+"),it=[];for(U=0;U<Y.length;U+=1){for(it.push(""),k=0;k<Y[U].length;k+=1)K=Y[U][k],G=Y[U][k-1],X=Y[U][k+1],a(K)?(z=C(K,G,X),it[U]+=z!==-1?String.fromCharCode(t[K.charCodeAt(0)][z]):K):it[U]+=K;it[U]=v(it[U])}return it.join(" ")},P=r.__arabicParser__.processArabic=r.processArabic=function(){var F,U=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,k=[];if(Array.isArray(U)){var z=0;for(k=[],z=0;z<U.length;z+=1)Array.isArray(U[z])?k.push([b(U[z][0]),U[z][1],U[z][2]]):k.push([b(U[z])]);F=k}else F=b(U);return typeof arguments[0]=="string"?F:(arguments[0].text=F,arguments[0])};r.events.push(["preProcessText",P])}(hn.API),hn.API.autoPrint=function(r){var t;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(r){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,n){var i;if((e=e||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(hn.API),function(r){var t={left:0,top:0,bottom:0,right:0},e=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var d=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return d},set:function(F){d=F}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function(F){f=F}});var m=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return m},set:function(F){m=F}});var v=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return v},set:function(F){v=F}});var C=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return C},set:function(F){C=F}});var b=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return b},set:function(F){b=F}});var P=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return P},set:function(F){P=F}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(d){return n.call(this),this.internal.__cell__.headerFunction=typeof d=="function"?d:void 0,this},r.getTextDimensions=function(d,f){n.call(this);var m=(f=f||{}).fontSize||this.getFontSize(),v=f.font||this.getFont(),C=f.scaleFactor||this.internal.scaleFactor,b=0,P=0,F=0,U=this;if(!Array.isArray(d)&&typeof d!="string"){if(typeof d!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");d=String(d)}var k=f.maxWidth;k>0?typeof d=="string"?d=this.splitTextToSize(d,k):Object.prototype.toString.call(d)==="[object Array]"&&(d=d.reduce(function(K,G){return K.concat(U.splitTextToSize(G,k))},[])):d=Array.isArray(d)?d:[d];for(var z=0;z<d.length;z++)b<(F=this.getStringUnitWidth(d[z],{font:v})*m)&&(b=F);return b!==0&&(P=d.length),{w:b/=C,h:Math.max((P*m*this.getLineHeightFactor()-m*(this.getLineHeightFactor()-1))/C,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var d=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(d.left,d.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var d;d=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var f=this.internal.__cell__.lastCell,m=this.internal.__cell__.padding,v=this.internal.__cell__.margins||t,C=this.internal.__cell__.tableHeaderRow,b=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===d.lineNumber?(d.x=(f.x||0)+(f.width||0),d.y=f.y||0):f.y+f.height+d.height+v.bottom>this.getPageHeight()?(this.cellAddPage(),d.y=v.top,b&&C&&(this.printHeaderRow(d.lineNumber,!0),d.y+=C[0].height)):d.y=f.y+f.height||d.y),d.text[0]!==void 0&&(this.rect(d.x,d.y,d.width,d.height,e===!0?"FD":void 0),d.align==="right"?this.text(d.text,d.x+d.width-m,d.y+m,{align:"right",baseline:"top"}):d.align==="center"?this.text(d.text,d.x+d.width/2,d.y+m,{align:"center",baseline:"top",maxWidth:d.width-m-m}):this.text(d.text,d.x+m,d.y+m,{align:"left",baseline:"top",maxWidth:d.width-m-m})),this.internal.__cell__.lastCell=d,this};r.table=function(d,f,m,v,C){if(n.call(this),!m)throw new Error("No data for PDF table.");var b,P,F,U,k=[],z=[],K=[],G={},X={},Y=[],it=[],nt=(C=C||{}).autoSize||!1,wt=C.printHeaders!==!1,Ct=C.css&&C.css["font-size"]!==void 0?16*C.css["font-size"]:C.fontSize||12,st=C.margins||Object.assign({width:this.getPageWidth()},t),ot=typeof C.padding=="number"?C.padding:3,vt=C.headerBackgroundColor||"#c8c8c8",yt=C.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=wt,this.internal.__cell__.margins=st,this.internal.__cell__.table_font_size=Ct,this.internal.__cell__.padding=ot,this.internal.__cell__.headerBackgroundColor=vt,this.internal.__cell__.headerTextColor=yt,this.setFontSize(Ct),v==null)z=k=Object.keys(m[0]),K=k.map(function(){return"left"});else if(Array.isArray(v)&&li(v[0])==="object")for(k=v.map(function(pe){return pe.name}),z=v.map(function(pe){return pe.prompt||pe.name||""}),K=v.map(function(pe){return pe.align||"left"}),b=0;b<v.length;b+=1)X[v[b].name]=v[b].width*(19.049976/25.4);else Array.isArray(v)&&typeof v[0]=="string"&&(z=k=v,K=k.map(function(){return"left"}));if(nt||Array.isArray(v)&&typeof v[0]=="string")for(b=0;b<k.length;b+=1){for(G[U=k[b]]=m.map(function(pe){return pe[U]}),this.setFont(void 0,"bold"),Y.push(this.getTextDimensions(z[b],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),P=G[U],this.setFont(void 0,"normal"),F=0;F<P.length;F+=1)Y.push(this.getTextDimensions(P[F],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);X[U]=Math.max.apply(null,Y)+ot+ot,Y=[]}if(wt){var re={};for(b=0;b<k.length;b+=1)re[k[b]]={},re[k[b]].text=z[b],re[k[b]].align=K[b];var Wt=o.call(this,re,X);it=k.map(function(pe){return new s(d,f,X[pe],Wt,re[pe].text,void 0,re[pe].align)}),this.setTableHeaderRow(it),this.printHeaderRow(1,!1)}var ee=v.reduce(function(pe,De){return pe[De.name]=De.align,pe},{});for(b=0;b<m.length;b+=1){"rowStart"in C&&C.rowStart instanceof Function&&C.rowStart({row:b,data:m[b]},this);var Zt=o.call(this,m[b],X);for(F=0;F<k.length;F+=1){var oe=m[b][k[F]];"cellStart"in C&&C.cellStart instanceof Function&&C.cellStart({row:b,col:F,data:oe},this),a.call(this,new s(d,f,X[k[F]],Zt,oe,b+2,ee[k[F]]))}}return this.internal.__cell__.table_x=d,this.internal.__cell__.table_y=f,this};var o=function(d,f){var m=this.internal.__cell__.padding,v=this.internal.__cell__.table_font_size,C=this.internal.scaleFactor;return Object.keys(d).map(function(b){var P=d[b];return this.splitTextToSize(P.hasOwnProperty("text")?P.text:P,f[b]-m-m)},this).map(function(b){return this.getLineHeightFactor()*b.length*v/C+m+m},this).reduce(function(b,P){return Math.max(b,P)},0)};r.setTableHeaderRow=function(d){n.call(this),this.internal.__cell__.tableHeaderRow=d},r.printHeaderRow=function(d,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var m;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var v=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(v[0],v[1],v[2],v[3],void 0,-1)}this.setFont(void 0,"bold");for(var C=[],b=0;b<this.internal.__cell__.tableHeaderRow.length;b+=1){m=this.internal.__cell__.tableHeaderRow[b].clone(),f&&(m.y=this.internal.__cell__.margins.top||0,C.push(m)),m.lineNumber=d;var P=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,m),this.setTextColor(P)}C.length>0&&this.setTableHeaderRow(C),this.setFont(void 0,"normal"),e=!1}}(hn.API);var EF={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},TF=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],o2=CF(TF),SF=[100,200,300,400,500,600,700,800,900],Xnt=CF(SF);function a2(r){var t=r.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return EF[s=s||"normal"]?s:"normal"}(r.style),n=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(r.weight),i=function(s){return typeof o2[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:t,style:e,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:t,style:[i,e,n].join(" ")}}}function IF(r,t,e,n){var i;for(i=e;i>=0&&i<t.length;i+=n)if(r[t[i]])return r[t[i]];for(i=e;i>=0&&i<t.length;i-=n)if(r[t[i]])return r[t[i]]}var Znt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},PF={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function MF(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Ynt(r,t,e){for(var n=(e=e||{}).defaultFontFamily||"times",i=Object.assign({},Znt,e.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(i[(s=a2(t[o])).family]&&(s.family=i[s.family]),r.hasOwnProperty(s.family)){a=r[s.family];break}if(!(a=a||r[n]))throw new Error("Could not find a font-family for the rule '"+MF(s)+"' and default family '"+n+"'.");if(a=function(d,f){if(f[d])return f[d];var m=o2[d],v=m<=o2.normal?-1:1,C=IF(f,TF,m,v);if(!C)throw new Error("Could not find a matching font-stretch value for "+d);return C}(s.stretch,a),a=function(d,f){if(f[d])return f[d];for(var m=EF[d],v=0;v<m.length;++v)if(f[m[v]])return f[m[v]];throw new Error("Could not find a matching font-style for "+d)}(s.style,a),!(a=function(d,f){if(f[d])return f[d];if(d===400&&f[500])return f[500];if(d===500&&f[400])return f[400];var m=Xnt[d],v=IF(f,SF,m,d<400?-1:1);if(!v)throw new Error("Could not find a matching font-weight for value "+d);return v}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+MF(s)+"'.");return a}function FF(r){return r.trimLeft()}function Jnt(r,t){for(var e=0;e<r.length;){if(r.charAt(e)===t)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function tit(r){var t=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],r.substring(t[0].length)]}var wy,LF,RF,OF=["times"];(function(r){var t,e,n,i,s,a,o,d,f,m=function(at){return at=at||{},this.isStrokeTransparent=at.isStrokeTransparent||!1,this.strokeOpacity=at.strokeOpacity||1,this.strokeStyle=at.strokeStyle||"#000000",this.fillStyle=at.fillStyle||"#000000",this.isFillTransparent=at.isFillTransparent||!1,this.fillOpacity=at.fillOpacity||1,this.font=at.font||"10px sans-serif",this.textBaseline=at.textBaseline||"alphabetic",this.textAlign=at.textAlign||"left",this.lineWidth=at.lineWidth||1,this.lineJoin=at.lineJoin||"miter",this.lineCap=at.lineCap||"butt",this.path=at.path||[],this.transform=at.transform!==void 0?at.transform.clone():new d,this.globalCompositeOperation=at.globalCompositeOperation||"normal",this.globalAlpha=at.globalAlpha||1,this.clip_path=at.clip_path||[],this.currentPoint=at.currentPoint||new a,this.miterLimit=at.miterLimit||10,this.lastPoint=at.lastPoint||new a,this.lineDashOffset=at.lineDashOffset||0,this.lineDash=at.lineDash||[],this.margin=at.margin||[0,0,0,0],this.prevPageLastElemOffset=at.prevPageLastElemOffset||0,this.ignoreClearRect=typeof at.ignoreClearRect!="boolean"||at.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new v(this),t=this.internal.f2,e=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,d=this.internal.Matrix,f=new m}]);var v=function(at){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Tt=at;Object.defineProperty(this,"pdf",{get:function(){return Tt}});var Rt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Rt},set:function(Me){Rt=!!Me}});var Nt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Nt},set:function(Me){Nt=!!Me}});var ae=0;Object.defineProperty(this,"posX",{get:function(){return ae},set:function(Me){isNaN(Me)||(ae=Me)}});var Xt=0;Object.defineProperty(this,"posY",{get:function(){return Xt},set:function(Me){isNaN(Me)||(Xt=Me)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(Me){var Qt;typeof Me=="number"?Qt=[Me,Me,Me,Me]:((Qt=new Array(4))[0]=Me[0],Qt[1]=Me.length>=2?Me[1]:Qt[0],Qt[2]=Me.length>=3?Me[2]:Qt[0],Qt[3]=Me.length>=4?Me[3]:Qt[1]),f.margin=Qt}});var ye=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ye},set:function(Me){ye=Me}});var de=0;Object.defineProperty(this,"lastBreak",{get:function(){return de},set:function(Me){de=Me}});var qe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return qe},set:function(Me){qe=Me}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(Me){Me instanceof m&&(f=Me)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(Me){f.path=Me}});var Ve=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ve},set:function(Me){Ve=Me}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Me){var Qt;Qt=C(Me),this.ctx.fillStyle=Qt.style,this.ctx.isFillTransparent=Qt.a===0,this.ctx.fillOpacity=Qt.a,this.pdf.setFillColor(Qt.r,Qt.g,Qt.b,{a:Qt.a}),this.pdf.setTextColor(Qt.r,Qt.g,Qt.b,{a:Qt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Me){var Qt=C(Me);this.ctx.strokeStyle=Qt.style,this.ctx.isStrokeTransparent=Qt.a===0,this.ctx.strokeOpacity=Qt.a,Qt.a===0?this.pdf.setDrawColor(255,255,255):(Qt.a,this.pdf.setDrawColor(Qt.r,Qt.g,Qt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Me){["butt","round","square"].indexOf(Me)!==-1&&(this.ctx.lineCap=Me,this.pdf.setLineCap(Me))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Me){isNaN(Me)||(this.ctx.lineWidth=Me,this.pdf.setLineWidth(Me))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Me){["bevel","round","miter"].indexOf(Me)!==-1&&(this.ctx.lineJoin=Me,this.pdf.setLineJoin(Me))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Me){isNaN(Me)||(this.ctx.miterLimit=Me,this.pdf.setMiterLimit(Me))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Me){this.ctx.textBaseline=Me}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Me){["right","end","center","left","start"].indexOf(Me)!==-1&&(this.ctx.textAlign=Me)}});var Je=null;function or(Me,Qt){if(Je===null){var Ur=function(Ir){var $e=[];return Object.keys(Ir).forEach(function(Xe){Ir[Xe].forEach(function(er){var gr=null;switch(er){case"bold":gr={family:Xe,weight:"bold"};break;case"italic":gr={family:Xe,style:"italic"};break;case"bolditalic":gr={family:Xe,weight:"bold",style:"italic"};break;case"":case"normal":gr={family:Xe}}gr!==null&&(gr.ref={name:Xe,style:er},$e.push(gr))})}),$e}(Me.getFontList());Je=function(Ir){for(var $e={},Xe=0;Xe<Ir.length;++Xe){var er=a2(Ir[Xe]),gr=er.family,Re=er.stretch,sr=er.style,Br=er.weight;$e[gr]=$e[gr]||{},$e[gr][Re]=$e[gr][Re]||{},$e[gr][Re][sr]=$e[gr][Re][sr]||{},$e[gr][Re][sr][Br]=er}return $e}(Ur.concat(Qt))}return Je}var mr=null;Object.defineProperty(this,"fontFaces",{get:function(){return mr},set:function(Me){Je=null,mr=Me}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Me){var Qt;if(this.ctx.font=Me,(Qt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Me))!==null){var Ur=Qt[1],Ir=(Qt[2],Qt[3]),$e=Qt[4],Xe=(Qt[5],Qt[6]),er=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec($e)[2];$e=Math.floor(er==="px"?parseFloat($e)*this.pdf.internal.scaleFactor:er==="em"?parseFloat($e)*this.pdf.getFontSize():parseFloat($e)*this.pdf.internal.scaleFactor),this.pdf.setFontSize($e);var gr=function(Nr){var Vr,yr,In=[],an=Nr.trim();if(an==="")return OF;if(an in PF)return[PF[an]];for(;an!=="";){switch(yr=null,Vr=(an=FF(an)).charAt(0)){case'"':case"'":yr=Jnt(an.substring(1),Vr);break;default:yr=tit(an)}if(yr===null||(In.push(yr[0]),(an=FF(yr[1]))!==""&&an.charAt(0)!==","))return OF;an=an.replace(/^,/,"")}return In}(Xe);if(this.fontFaces){var Re=Ynt(or(this.pdf,this.fontFaces),gr.map(function(Nr){return{family:Nr,stretch:"normal",weight:Ir,style:Ur}}));this.pdf.setFont(Re.ref.name,Re.ref.style)}else{var sr="";(Ir==="bold"||parseInt(Ir,10)>=700||Ur==="bold")&&(sr="bold"),Ur==="italic"&&(sr+="italic"),sr.length===0&&(sr="normal");for(var Br="",xr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Lr=0;Lr<gr.length;Lr++){if(this.pdf.internal.getFont(gr[Lr],sr,{noFallback:!0,disableWarning:!0})!==void 0){Br=gr[Lr];break}if(sr==="bolditalic"&&this.pdf.internal.getFont(gr[Lr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Br=gr[Lr],sr="bold";else if(this.pdf.internal.getFont(gr[Lr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Br=gr[Lr],sr="normal";break}}if(Br===""){for(var Zr=0;Zr<gr.length;Zr++)if(xr[gr[Zr]]){Br=xr[gr[Zr]];break}}Br=Br===""?"Times":Br,this.pdf.setFont(Br,sr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Me){this.ctx.globalCompositeOperation=Me}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Me){this.ctx.globalAlpha=Me}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Me){this.ctx.lineDashOffset=Me,De.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Me){this.ctx.lineDash=Me,De.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Me){this.ctx.ignoreClearRect=!!Me}})};v.prototype.setLineDash=function(at){this.lineDash=at},v.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},v.prototype.fill=function(){G.call(this,"fill",!1)},v.prototype.stroke=function(){G.call(this,"stroke",!1)},v.prototype.beginPath=function(){this.path=[{type:"begin"}]},v.prototype.moveTo=function(at,Tt){if(isNaN(at)||isNaN(Tt))throw Ui.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Rt=this.ctx.transform.applyToPoint(new a(at,Tt));this.path.push({type:"mt",x:Rt.x,y:Rt.y}),this.ctx.lastPoint=new a(at,Tt)},v.prototype.closePath=function(){var at=new a(0,0),Tt=0;for(Tt=this.path.length-1;Tt!==-1;Tt--)if(this.path[Tt].type==="begin"&&li(this.path[Tt+1])==="object"&&typeof this.path[Tt+1].x=="number"){at=new a(this.path[Tt+1].x,this.path[Tt+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(at.x,at.y)},v.prototype.lineTo=function(at,Tt){if(isNaN(at)||isNaN(Tt))throw Ui.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Rt=this.ctx.transform.applyToPoint(new a(at,Tt));this.path.push({type:"lt",x:Rt.x,y:Rt.y}),this.ctx.lastPoint=new a(Rt.x,Rt.y)},v.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),G.call(this,null,!0)},v.prototype.quadraticCurveTo=function(at,Tt,Rt,Nt){if(isNaN(Rt)||isNaN(Nt)||isNaN(at)||isNaN(Tt))throw Ui.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ae=this.ctx.transform.applyToPoint(new a(Rt,Nt)),Xt=this.ctx.transform.applyToPoint(new a(at,Tt));this.path.push({type:"qct",x1:Xt.x,y1:Xt.y,x:ae.x,y:ae.y}),this.ctx.lastPoint=new a(ae.x,ae.y)},v.prototype.bezierCurveTo=function(at,Tt,Rt,Nt,ae,Xt){if(isNaN(ae)||isNaN(Xt)||isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt))throw Ui.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ye=this.ctx.transform.applyToPoint(new a(ae,Xt)),de=this.ctx.transform.applyToPoint(new a(at,Tt)),qe=this.ctx.transform.applyToPoint(new a(Rt,Nt));this.path.push({type:"bct",x1:de.x,y1:de.y,x2:qe.x,y2:qe.y,x:ye.x,y:ye.y}),this.ctx.lastPoint=new a(ye.x,ye.y)},v.prototype.arc=function(at,Tt,Rt,Nt,ae,Xt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt)||isNaN(ae))throw Ui.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Xt=!!Xt,!this.ctx.transform.isIdentity){var ye=this.ctx.transform.applyToPoint(new a(at,Tt));at=ye.x,Tt=ye.y;var de=this.ctx.transform.applyToPoint(new a(0,Rt)),qe=this.ctx.transform.applyToPoint(new a(0,0));Rt=Math.sqrt(Math.pow(de.x-qe.x,2)+Math.pow(de.y-qe.y,2))}Math.abs(ae-Nt)>=2*Math.PI&&(Nt=0,ae=2*Math.PI),this.path.push({type:"arc",x:at,y:Tt,radius:Rt,startAngle:Nt,endAngle:ae,counterclockwise:Xt})},v.prototype.arcTo=function(at,Tt,Rt,Nt,ae){throw new Error("arcTo not implemented.")},v.prototype.rect=function(at,Tt,Rt,Nt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt))throw Ui.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(at,Tt),this.lineTo(at+Rt,Tt),this.lineTo(at+Rt,Tt+Nt),this.lineTo(at,Tt+Nt),this.lineTo(at,Tt),this.lineTo(at+Rt,Tt),this.lineTo(at,Tt)},v.prototype.fillRect=function(at,Tt,Rt,Nt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt))throw Ui.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!b.call(this)){var ae={};this.lineCap!=="butt"&&(ae.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ae.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(at,Tt,Rt,Nt),this.fill(),ae.hasOwnProperty("lineCap")&&(this.lineCap=ae.lineCap),ae.hasOwnProperty("lineJoin")&&(this.lineJoin=ae.lineJoin)}},v.prototype.strokeRect=function(at,Tt,Rt,Nt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt))throw Ui.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");P.call(this)||(this.beginPath(),this.rect(at,Tt,Rt,Nt),this.stroke())},v.prototype.clearRect=function(at,Tt,Rt,Nt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt))throw Ui.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(at,Tt,Rt,Nt))},v.prototype.save=function(at){at=typeof at!="boolean"||at;for(var Tt=this.pdf.internal.getCurrentPageInfo().pageNumber,Rt=0;Rt<this.pdf.internal.getNumberOfPages();Rt++)this.pdf.setPage(Rt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Tt),at){this.ctx.fontSize=this.pdf.internal.getFontSize();var Nt=new m(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Nt}},v.prototype.restore=function(at){at=typeof at!="boolean"||at;for(var Tt=this.pdf.internal.getCurrentPageInfo().pageNumber,Rt=0;Rt<this.pdf.internal.getNumberOfPages();Rt++)this.pdf.setPage(Rt+1),this.pdf.internal.out("Q");this.pdf.setPage(Tt),at&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},v.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var C=function(at){var Tt,Rt,Nt,ae;if(at.isCanvasGradient===!0&&(at=at.getColor()),!at)return{r:0,g:0,b:0,a:0,style:at};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(at))Tt=0,Rt=0,Nt=0,ae=0;else{var Xt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(at);if(Xt!==null)Tt=parseInt(Xt[1]),Rt=parseInt(Xt[2]),Nt=parseInt(Xt[3]),ae=1;else if((Xt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(at))!==null)Tt=parseInt(Xt[1]),Rt=parseInt(Xt[2]),Nt=parseInt(Xt[3]),ae=parseFloat(Xt[4]);else{if(ae=1,typeof at=="string"&&at.charAt(0)!=="#"){var ye=new pF(at);at=ye.ok?ye.toHex():"#000000"}at.length===4?(Tt=at.substring(1,2),Tt+=Tt,Rt=at.substring(2,3),Rt+=Rt,Nt=at.substring(3,4),Nt+=Nt):(Tt=at.substring(1,3),Rt=at.substring(3,5),Nt=at.substring(5,7)),Tt=parseInt(Tt,16),Rt=parseInt(Rt,16),Nt=parseInt(Nt,16)}}return{r:Tt,g:Rt,b:Nt,a:ae,style:at}},b=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},P=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};v.prototype.fillText=function(at,Tt,Rt,Nt){if(isNaN(Tt)||isNaN(Rt)||typeof at!="string")throw Ui.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Nt=isNaN(Nt)?void 0:Nt,!b.call(this)){var ae=Zt(this.ctx.transform.rotation),Xt=this.ctx.transform.scaleX;ot.call(this,{text:at,x:Tt,y:Rt,scale:Xt,angle:ae,align:this.textAlign,maxWidth:Nt})}},v.prototype.strokeText=function(at,Tt,Rt,Nt){if(isNaN(Tt)||isNaN(Rt)||typeof at!="string")throw Ui.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!P.call(this)){Nt=isNaN(Nt)?void 0:Nt;var ae=Zt(this.ctx.transform.rotation),Xt=this.ctx.transform.scaleX;ot.call(this,{text:at,x:Tt,y:Rt,scale:Xt,renderingMode:"stroke",angle:ae,align:this.textAlign,maxWidth:Nt})}},v.prototype.measureText=function(at){if(typeof at!="string")throw Ui.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Tt=this.pdf,Rt=this.pdf.internal.scaleFactor,Nt=Tt.internal.getFontSize(),ae=Tt.getStringUnitWidth(at)*Nt/Tt.internal.scaleFactor,Xt=function(ye){var de=(ye=ye||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return de}}),this};return new Xt({width:ae*=Math.round(96*Rt/72*1e4)/1e4})},v.prototype.scale=function(at,Tt){if(isNaN(at)||isNaN(Tt))throw Ui.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Rt=new d(at,0,0,Tt,0,0);this.ctx.transform=this.ctx.transform.multiply(Rt)},v.prototype.rotate=function(at){if(isNaN(at))throw Ui.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Tt=new d(Math.cos(at),Math.sin(at),-Math.sin(at),Math.cos(at),0,0);this.ctx.transform=this.ctx.transform.multiply(Tt)},v.prototype.translate=function(at,Tt){if(isNaN(at)||isNaN(Tt))throw Ui.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Rt=new d(1,0,0,1,at,Tt);this.ctx.transform=this.ctx.transform.multiply(Rt)},v.prototype.transform=function(at,Tt,Rt,Nt,ae,Xt){if(isNaN(at)||isNaN(Tt)||isNaN(Rt)||isNaN(Nt)||isNaN(ae)||isNaN(Xt))throw Ui.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ye=new d(at,Tt,Rt,Nt,ae,Xt);this.ctx.transform=this.ctx.transform.multiply(ye)},v.prototype.setTransform=function(at,Tt,Rt,Nt,ae,Xt){at=isNaN(at)?1:at,Tt=isNaN(Tt)?0:Tt,Rt=isNaN(Rt)?0:Rt,Nt=isNaN(Nt)?1:Nt,ae=isNaN(ae)?0:ae,Xt=isNaN(Xt)?0:Xt,this.ctx.transform=new d(at,Tt,Rt,Nt,ae,Xt)};var F=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};v.prototype.drawImage=function(at,Tt,Rt,Nt,ae,Xt,ye,de,qe){var Ve=this.pdf.getImageProperties(at),Je=1,or=1,mr=1,Me=1;Nt!==void 0&&de!==void 0&&(mr=de/Nt,Me=qe/ae,Je=Ve.width/Nt*de/Nt,or=Ve.height/ae*qe/ae),Xt===void 0&&(Xt=Tt,ye=Rt,Tt=0,Rt=0),Nt!==void 0&&de===void 0&&(de=Nt,qe=ae),Nt===void 0&&de===void 0&&(de=Ve.width,qe=Ve.height);for(var Qt,Ur=this.ctx.transform.decompose(),Ir=Zt(Ur.rotate.shx),$e=new d,Xe=($e=($e=($e=$e.multiply(Ur.translate)).multiply(Ur.skew)).multiply(Ur.scale)).applyToRectangle(new o(Xt-Tt*mr,ye-Rt*Me,Nt*Je,ae*or)),er=U.call(this,Xe),gr=[],Re=0;Re<er.length;Re+=1)gr.indexOf(er[Re])===-1&&gr.push(er[Re]);if(K(gr),this.autoPaging)for(var sr=gr[0],Br=gr[gr.length-1],xr=sr;xr<Br+1;xr++){this.pdf.setPage(xr);var Lr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Zr=xr===1?this.posY+this.margin[0]:this.margin[0],Nr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],yr=xr===1?0:Nr+(xr-2)*Vr;if(this.ctx.clip_path.length!==0){var In=this.path;Qt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Qt,this.posX+this.margin[3],-yr+Zr+this.ctx.prevPageLastElemOffset),X.call(this,"fill",!0),this.path=In}var an=JSON.parse(JSON.stringify(Xe));an=z([an],this.posX+this.margin[3],-yr+Zr+this.ctx.prevPageLastElemOffset)[0];var Xn=(xr>sr||xr<Br)&&F.call(this);Xn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Lr,Vr,null).clip().discardPath()),this.pdf.addImage(at,"JPEG",an.x,an.y,an.w,an.h,null,null,Ir),Xn&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(at,"JPEG",Xe.x,Xe.y,Xe.w,Xe.h,null,null,Ir)};var U=function(at,Tt,Rt){var Nt=[];Tt=Tt||this.pdf.internal.pageSize.width,Rt=Rt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ae=this.posY+this.ctx.prevPageLastElemOffset;switch(at.type){default:case"mt":case"lt":Nt.push(Math.floor((at.y+ae)/Rt)+1);break;case"arc":Nt.push(Math.floor((at.y+ae-at.radius)/Rt)+1),Nt.push(Math.floor((at.y+ae+at.radius)/Rt)+1);break;case"qct":var Xt=oe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,at.x1,at.y1,at.x,at.y);Nt.push(Math.floor((Xt.y+ae)/Rt)+1),Nt.push(Math.floor((Xt.y+Xt.h+ae)/Rt)+1);break;case"bct":var ye=pe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,at.x1,at.y1,at.x2,at.y2,at.x,at.y);Nt.push(Math.floor((ye.y+ae)/Rt)+1),Nt.push(Math.floor((ye.y+ye.h+ae)/Rt)+1);break;case"rect":Nt.push(Math.floor((at.y+ae)/Rt)+1),Nt.push(Math.floor((at.y+at.h+ae)/Rt)+1)}for(var de=0;de<Nt.length;de+=1)for(;this.pdf.internal.getNumberOfPages()<Nt[de];)k.call(this);return Nt},k=function(){var at=this.fillStyle,Tt=this.strokeStyle,Rt=this.font,Nt=this.lineCap,ae=this.lineWidth,Xt=this.lineJoin;this.pdf.addPage(),this.fillStyle=at,this.strokeStyle=Tt,this.font=Rt,this.lineCap=Nt,this.lineWidth=ae,this.lineJoin=Xt},z=function(at,Tt,Rt){for(var Nt=0;Nt<at.length;Nt++)switch(at[Nt].type){case"bct":at[Nt].x2+=Tt,at[Nt].y2+=Rt;case"qct":at[Nt].x1+=Tt,at[Nt].y1+=Rt;case"mt":case"lt":case"arc":default:at[Nt].x+=Tt,at[Nt].y+=Rt}return at},K=function(at){return at.sort(function(Tt,Rt){return Tt-Rt})},G=function(at,Tt){for(var Rt,Nt,ae=this.fillStyle,Xt=this.strokeStyle,ye=this.lineCap,de=this.lineWidth,qe=Math.abs(de*this.ctx.transform.scaleX),Ve=this.lineJoin,Je=JSON.parse(JSON.stringify(this.path)),or=JSON.parse(JSON.stringify(this.path)),mr=[],Me=0;Me<or.length;Me++)if(or[Me].x!==void 0)for(var Qt=U.call(this,or[Me]),Ur=0;Ur<Qt.length;Ur+=1)mr.indexOf(Qt[Ur])===-1&&mr.push(Qt[Ur]);for(var Ir=0;Ir<mr.length;Ir++)for(;this.pdf.internal.getNumberOfPages()<mr[Ir];)k.call(this);if(K(mr),this.autoPaging)for(var $e=mr[0],Xe=mr[mr.length-1],er=$e;er<Xe+1;er++){this.pdf.setPage(er),this.fillStyle=ae,this.strokeStyle=Xt,this.lineCap=ye,this.lineWidth=qe,this.lineJoin=Ve;var gr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Re=er===1?this.posY+this.margin[0]:this.margin[0],sr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Br=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],xr=er===1?0:sr+(er-2)*Br;if(this.ctx.clip_path.length!==0){var Lr=this.path;Rt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Rt,this.posX+this.margin[3],-xr+Re+this.ctx.prevPageLastElemOffset),X.call(this,at,!0),this.path=Lr}if(Nt=JSON.parse(JSON.stringify(Je)),this.path=z(Nt,this.posX+this.margin[3],-xr+Re+this.ctx.prevPageLastElemOffset),Tt===!1||er===0){var Zr=(er>$e||er<Xe)&&F.call(this);Zr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],gr,Br,null).clip().discardPath()),X.call(this,at,Tt),Zr&&this.pdf.restoreGraphicsState()}this.lineWidth=de}else this.lineWidth=qe,X.call(this,at,Tt),this.lineWidth=de;this.path=Je},X=function(at,Tt){if((at!=="stroke"||Tt||!P.call(this))&&(at==="stroke"||Tt||!b.call(this))){for(var Rt,Nt,ae=[],Xt=this.path,ye=0;ye<Xt.length;ye++){var de=Xt[ye];switch(de.type){case"begin":ae.push({begin:!0});break;case"close":ae.push({close:!0});break;case"mt":ae.push({start:de,deltas:[],abs:[]});break;case"lt":var qe=ae.length;if(Xt[ye-1]&&!isNaN(Xt[ye-1].x)&&(Rt=[de.x-Xt[ye-1].x,de.y-Xt[ye-1].y],qe>0)){for(;qe>=0;qe--)if(ae[qe-1].close!==!0&&ae[qe-1].begin!==!0){ae[qe-1].deltas.push(Rt),ae[qe-1].abs.push(de);break}}break;case"bct":Rt=[de.x1-Xt[ye-1].x,de.y1-Xt[ye-1].y,de.x2-Xt[ye-1].x,de.y2-Xt[ye-1].y,de.x-Xt[ye-1].x,de.y-Xt[ye-1].y],ae[ae.length-1].deltas.push(Rt);break;case"qct":var Ve=Xt[ye-1].x+2/3*(de.x1-Xt[ye-1].x),Je=Xt[ye-1].y+2/3*(de.y1-Xt[ye-1].y),or=de.x+2/3*(de.x1-de.x),mr=de.y+2/3*(de.y1-de.y),Me=de.x,Qt=de.y;Rt=[Ve-Xt[ye-1].x,Je-Xt[ye-1].y,or-Xt[ye-1].x,mr-Xt[ye-1].y,Me-Xt[ye-1].x,Qt-Xt[ye-1].y],ae[ae.length-1].deltas.push(Rt);break;case"arc":ae.push({deltas:[],abs:[],arc:!0}),Array.isArray(ae[ae.length-1].abs)&&ae[ae.length-1].abs.push(de)}}Nt=Tt?null:at==="stroke"?"stroke":"fill";for(var Ur=!1,Ir=0;Ir<ae.length;Ir++)if(ae[Ir].arc)for(var $e=ae[Ir].abs,Xe=0;Xe<$e.length;Xe++){var er=$e[Xe];er.type==="arc"?nt.call(this,er.x,er.y,er.radius,er.startAngle,er.endAngle,er.counterclockwise,void 0,Tt,!Ur):vt.call(this,er.x,er.y),Ur=!0}else if(ae[Ir].close===!0)this.pdf.internal.out("h"),Ur=!1;else if(ae[Ir].begin!==!0){var gr=ae[Ir].start.x,Re=ae[Ir].start.y;yt.call(this,ae[Ir].deltas,gr,Re),Ur=!0}Nt&&wt.call(this,Nt),Tt&&Ct.call(this)}},Y=function(at){var Tt=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Rt=Tt*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return at-Rt;case"top":return at+Tt-Rt;case"hanging":return at+Tt-2*Rt;case"middle":return at+Tt/2-Rt;case"ideographic":return at;case"alphabetic":default:return at}},it=function(at){return at+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};v.prototype.createLinearGradient=function(){var at=function(){};return at.colorStops=[],at.addColorStop=function(Tt,Rt){this.colorStops.push([Tt,Rt])},at.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},at.isCanvasGradient=!0,at},v.prototype.createPattern=function(){return this.createLinearGradient()},v.prototype.createRadialGradient=function(){return this.createLinearGradient()};var nt=function(at,Tt,Rt,Nt,ae,Xt,ye,de,qe){for(var Ve=Wt.call(this,Rt,Nt,ae,Xt),Je=0;Je<Ve.length;Je++){var or=Ve[Je];Je===0&&(qe?st.call(this,or.x1+at,or.y1+Tt):vt.call(this,or.x1+at,or.y1+Tt)),re.call(this,at,Tt,or.x2,or.y2,or.x3,or.y3,or.x4,or.y4)}de?Ct.call(this):wt.call(this,ye)},wt=function(at){switch(at){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Ct=function(){this.pdf.clip(),this.pdf.discardPath()},st=function(at,Tt){this.pdf.internal.out(e(at)+" "+n(Tt)+" m")},ot=function(at){var Tt;switch(at.align){case"right":case"end":Tt="right";break;case"center":Tt="center";break;case"left":case"start":default:Tt="left"}var Rt=this.pdf.getTextDimensions(at.text),Nt=Y.call(this,at.y),ae=it.call(this,Nt)-Rt.h,Xt=this.ctx.transform.applyToPoint(new a(at.x,Nt)),ye=this.ctx.transform.decompose(),de=new d;de=(de=(de=de.multiply(ye.translate)).multiply(ye.skew)).multiply(ye.scale);for(var qe,Ve,Je,or=this.ctx.transform.applyToRectangle(new o(at.x,Nt,Rt.w,Rt.h)),mr=de.applyToRectangle(new o(at.x,ae,Rt.w,Rt.h)),Me=U.call(this,mr),Qt=[],Ur=0;Ur<Me.length;Ur+=1)Qt.indexOf(Me[Ur])===-1&&Qt.push(Me[Ur]);if(K(Qt),this.autoPaging)for(var Ir=Qt[0],$e=Qt[Qt.length-1],Xe=Ir;Xe<$e+1;Xe++){this.pdf.setPage(Xe);var er=Xe===1?this.posY+this.margin[0]:this.margin[0],gr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Re=this.pdf.internal.pageSize.height-this.margin[2],sr=Re-this.margin[0],Br=this.pdf.internal.pageSize.width-this.margin[1],xr=Br-this.margin[3],Lr=Xe===1?0:gr+(Xe-2)*sr;if(this.ctx.clip_path.length!==0){var Zr=this.path;qe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(qe,this.posX+this.margin[3],-1*Lr+er),X.call(this,"fill",!0),this.path=Zr}var Nr=z([JSON.parse(JSON.stringify(mr))],this.posX+this.margin[3],-Lr+er+this.ctx.prevPageLastElemOffset)[0];at.scale>=.01&&(Ve=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ve*at.scale),Je=this.lineWidth,this.lineWidth=Je*at.scale);var Vr=this.autoPaging!=="text";if(Vr||Nr.y+Nr.h<=Re){if(Vr||Nr.y>=er&&Nr.x<=Br){var yr=Vr?at.text:this.pdf.splitTextToSize(at.text,at.maxWidth||Br-Nr.x)[0],In=z([JSON.parse(JSON.stringify(or))],this.posX+this.margin[3],-Lr+er+this.ctx.prevPageLastElemOffset)[0],an=Vr&&(Xe>Ir||Xe<$e)&&F.call(this);an&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],xr,sr,null).clip().discardPath()),this.pdf.text(yr,In.x,In.y,{angle:at.angle,align:Tt,renderingMode:at.renderingMode}),an&&this.pdf.restoreGraphicsState()}}else Nr.y<Re&&(this.ctx.prevPageLastElemOffset+=Re-Nr.y);at.scale>=.01&&(this.pdf.setFontSize(Ve),this.lineWidth=Je)}else at.scale>=.01&&(Ve=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ve*at.scale),Je=this.lineWidth,this.lineWidth=Je*at.scale),this.pdf.text(at.text,Xt.x+this.posX,Xt.y+this.posY,{angle:at.angle,align:Tt,renderingMode:at.renderingMode,maxWidth:at.maxWidth}),at.scale>=.01&&(this.pdf.setFontSize(Ve),this.lineWidth=Je)},vt=function(at,Tt,Rt,Nt){Rt=Rt||0,Nt=Nt||0,this.pdf.internal.out(e(at+Rt)+" "+n(Tt+Nt)+" l")},yt=function(at,Tt,Rt){return this.pdf.lines(at,Tt,Rt,null,null)},re=function(at,Tt,Rt,Nt,ae,Xt,ye,de){this.pdf.internal.out([t(i(Rt+at)),t(s(Nt+Tt)),t(i(ae+at)),t(s(Xt+Tt)),t(i(ye+at)),t(s(de+Tt)),"c"].join(" "))},Wt=function(at,Tt,Rt,Nt){for(var ae=2*Math.PI,Xt=Math.PI/2;Tt>Rt;)Tt-=ae;var ye=Math.abs(Rt-Tt);ye<ae&&Nt&&(ye=ae-ye);for(var de=[],qe=Nt?-1:1,Ve=Tt;ye>1e-5;){var Je=Ve+qe*Math.min(ye,Xt);de.push(ee.call(this,at,Ve,Je)),ye-=Math.abs(Je-Ve),Ve=Je}return de},ee=function(at,Tt,Rt){var Nt=(Rt-Tt)/2,ae=at*Math.cos(Nt),Xt=at*Math.sin(Nt),ye=ae,de=-Xt,qe=ye*ye+de*de,Ve=qe+ye*ae+de*Xt,Je=4/3*(Math.sqrt(2*qe*Ve)-Ve)/(ye*Xt-de*ae),or=ye-Je*de,mr=de+Je*ye,Me=or,Qt=-mr,Ur=Nt+Tt,Ir=Math.cos(Ur),$e=Math.sin(Ur);return{x1:at*Math.cos(Tt),y1:at*Math.sin(Tt),x2:or*Ir-mr*$e,y2:or*$e+mr*Ir,x3:Me*Ir-Qt*$e,y3:Me*$e+Qt*Ir,x4:at*Math.cos(Rt),y4:at*Math.sin(Rt)}},Zt=function(at){return 180*at/Math.PI},oe=function(at,Tt,Rt,Nt,ae,Xt){var ye=at+.5*(Rt-at),de=Tt+.5*(Nt-Tt),qe=ae+.5*(Rt-ae),Ve=Xt+.5*(Nt-Xt),Je=Math.min(at,ae,ye,qe),or=Math.max(at,ae,ye,qe),mr=Math.min(Tt,Xt,de,Ve),Me=Math.max(Tt,Xt,de,Ve);return new o(Je,mr,or-Je,Me-mr)},pe=function(at,Tt,Rt,Nt,ae,Xt,ye,de){var qe,Ve,Je,or,mr,Me,Qt,Ur,Ir,$e,Xe,er,gr,Re,sr=Rt-at,Br=Nt-Tt,xr=ae-Rt,Lr=Xt-Nt,Zr=ye-ae,Nr=de-Xt;for(Ve=0;Ve<41;Ve++)Ir=(Qt=(Je=at+(qe=Ve/40)*sr)+qe*((mr=Rt+qe*xr)-Je))+qe*(mr+qe*(ae+qe*Zr-mr)-Qt),$e=(Ur=(or=Tt+qe*Br)+qe*((Me=Nt+qe*Lr)-or))+qe*(Me+qe*(Xt+qe*Nr-Me)-Ur),Ve==0?(Xe=Ir,er=$e,gr=Ir,Re=$e):(Xe=Math.min(Xe,Ir),er=Math.min(er,$e),gr=Math.max(gr,Ir),Re=Math.max(Re,$e));return new o(Math.round(Xe),Math.round(er),Math.round(gr-Xe),Math.round(Re-er))},De=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var at,Tt,Rt=(at=this.ctx.lineDash,Tt=this.ctx.lineDashOffset,JSON.stringify({lineDash:at,lineDashOffset:Tt}));this.prevLineDash!==Rt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Rt)}}})(hn.API),function(r){var t=function(s){var a,o,d,f,m,v,C,b,P,F;for(o=[],d=0,f=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;f>d;d+=4)(m=(s.charCodeAt(d)<<24)+(s.charCodeAt(d+1)<<16)+(s.charCodeAt(d+2)<<8)+s.charCodeAt(d+3))!==0?(v=(m=((m=((m=((m=(m-(F=m%85))/85)-(P=m%85))/85)-(b=m%85))/85)-(C=m%85))/85)%85,o.push(v+33,C+33,b+33,P+33,F+33)):o.push(122);return function(U,k){for(var z=k;z>0;z--)U.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},e=function(s){var a,o,d,f,m,v=String,C="length",b=255,P="charCodeAt",F="slice",U="replace";for(s[F](-2),s=s[F](0,-2)[U](/\s/g,"")[U]("z","!!!!!"),d=[],f=0,m=(s+=a="uuuuu"[F](s[C]%5||5))[C];m>f;f+=5)o=52200625*(s[P](f)-33)+614125*(s[P](f+1)-33)+7225*(s[P](f+2)-33)+85*(s[P](f+3)-33)+(s[P](f+4)-33),d.push(b&o>>24,b&o>>16,b&o>>8,b&o);return function(k,z){for(var K=z;K>0;K--)k.pop()}(d,a[C]),v.fromCharCode.apply(v,d)},n=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",d=0;d<s.length;d+=2)o+=String.fromCharCode("0x"+(s[d]+s[d+1]));return o},i=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=Xw(a)).reduce(function(d,f){return d+String.fromCharCode(f)},"")};r.processDataByFilters=function(s,a){var o=0,d=s||"",f=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":d=e(d),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=t(d),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=n(d),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=d.split("").map(function(m){return("0"+m.charCodeAt().toString(16)).slice(-2)}).join("")+">",f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=i(d),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:d,reverseChain:f.reverse().join(" ")}}}(hn.API),function(r){r.loadFile=function(t,e,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(d,f,m){var v=new XMLHttpRequest,C=0,b=function(P){var F=P.length,U=[],k=String.fromCharCode;for(C=0;C<F;C+=1)U.push(k(255&P.charCodeAt(C)));return U.join("")};if(v.open("GET",d,!f),v.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(v.onload=function(){v.status===200?m(b(this.responseText)):m(void 0)}),v.send(null),f&&v.status===200)return b(v.responseText)}(i,s,a)}catch{}return o}(t,e,n)},r.loadImageFile=r.loadFile}(hn.API),function(r){function t(){return(un.html2canvas?Promise.resolve(un.html2canvas):Promise.resolve().then(()=>rAt)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function e(){return(un.DOMPurify?Promise.resolve(un.DOMPurify):Promise.resolve().then(()=>FAt)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var n=function(a){var o=li(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},i=function(a,o){var d=document.createElement(a);for(var f in o.className&&(d.className=o.className),o.innerHTML&&o.dompurify&&(d.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)d.style[f]=o.style[f];return d},s=function a(o){var d=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),f=a.convert(Promise.resolve(),d);return f=(f=f.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(d){switch(n(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(e).then(function(d){return this.set({src:i("div",{innerHTML:a,dompurify:d})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function d(f,m){for(var v=f.nodeType===3?document.createTextNode(f.nodeValue):f.cloneNode(!1),C=f.firstChild;C;C=C.nextSibling)m!==!0&&C.nodeType===1&&C.nodeName==="SCRIPT"||v.appendChild(d(C,m));return f.nodeType===1&&(f.nodeName==="CANVAS"?(v.width=f.width,v.height=f.height,v.getContext("2d").drawImage(f,0,0)):f.nodeName!=="TEXTAREA"&&f.nodeName!=="SELECT"||(v.value=f.value),v.addEventListener("load",function(){v.scrollTop=f.scrollTop,v.scrollLeft=f.scrollLeft},!0)),v}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,o(this.prop.container,d)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var d=this.opt.jsPDF,f=this.opt.fontFaces,m=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,v=Object.assign({async:!0,allowTaint:!0,scale:m,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete v.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=f,f)for(var C=0;C<f.length;++C){var b=f[C],P=b.src.find(function(F){return F.format==="truetype"});P&&d.addFont(P.url,b.ref.name,b.ref.style)}return v.windowHeight=v.windowHeight||0,v.windowHeight=v.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):v.windowHeight,d.context2d.save(!0),o(this.prop.container,v)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(n(a)!=="object")return this;var o=Object.keys(a||{}).map(function(d){if(d in s.template.prop)return function(){this.prop[d]=a[d]};switch(d){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[d]=a[d]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var d=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(d):d})},s.prototype.setMargin=function(a){return this.then(function(){switch(n(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(d,f){return Math.floor(d*f/72*96)}return this.then(function(){(a=a||hn.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,d,f){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),d!=null&&(this.progress.n=d),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,d,f){return this.setProgress(a?this.progress.val+a:null,o||null,d?this.progress.n+d:null,f?this.progress.stack.concat(f):null)},s.prototype.then=function(a,o){var d=this;return this.thenCore(a,o,function(f,m){return d.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(v){return d.updateProgress(null,f),v}).then(f,m).then(function(v){return d.updateProgress(1),v})})},s.prototype.thenCore=function(a,o,d){d=d||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),m=d.call(f,a,o);return s.convert(m,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(d){o=o.thenCore(d)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,hn.getPageSize=function(a,o,d){if(li(a)==="object"){var f=a;a=f.orientation,o=f.unit||o,d=f.format||d}o=o||"mm",d=d||"a4",a=(""+(a||"P")).toLowerCase();var m,v=(""+d).toLowerCase(),C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":m=1;break;case"mm":m=72/25.4;break;case"cm":m=72/2.54;break;case"in":m=72;break;case"px":m=.75;break;case"pc":case"em":m=12;break;case"ex":m=6;break;default:throw"Invalid unit: "+o}var b,P=0,F=0;if(C.hasOwnProperty(v))P=C[v][1]/m,F=C[v][0]/m;else try{P=d[1],F=d[0]}catch{throw new Error("Invalid format: "+d)}if(a==="p"||a==="portrait")a="p",F>P&&(b=F,F=P,P=b);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",P>F&&(b=F,F=P,P=b)}return{width:F,height:P,unit:o,k:m,orientation:a}},r.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(a2):null;var d=new s(o);return o.worker?d:d.from(a).doCallback()}}(hn.API),hn.API.addJS=function(r){return RF=r,this.internal.events.subscribe("postPutResources",function(){wy=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(wy+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),LF=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+RF+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){wy!==void 0&&LF!==void 0&&this.internal.out("/Names <</JavaScript "+wy+" 0 R>>")}),this},function(r){var t;r.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var d=o[1];e.internal.newObjectDeferredBegin(d,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,m=[];for(s=0;s<f;s++){var v=e.internal.newObject();m.push(v);var C=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+C.objId+" 0 R /XYZ null null null]>> endobj")}var b=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<m.length;s++)e.internal.write("(page_"+(s+1)+")"+m[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+b+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(n){n.id=e.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},e.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},e.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var d=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+d.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},e.outline.line=function(n){this.ctx.val+=n+`\r
`},e.outline.makeRef=function(n){return n.id+" 0 R"},e.outline.makeString=function(n){return"("+e.internal.pdfEscape(n)+")"},e.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(hn.API),function(r){var t=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,n,i,s,a,o){var d,f=this.decode.DCT_DECODE,m=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(d=function(v){for(var C,b=256*v.charCodeAt(4)+v.charCodeAt(5),P=v.length,F={width:0,height:0,numcomponents:1},U=4;U<P;U+=2){if(U+=b,t.indexOf(v.charCodeAt(U+1))!==-1){C=256*v.charCodeAt(U+5)+v.charCodeAt(U+6),F={width:256*v.charCodeAt(U+7)+v.charCodeAt(U+8),height:C,numcomponents:v.charCodeAt(U+9)};break}b=256*v.charCodeAt(U+2)+v.charCodeAt(U+3)}return F}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}m={data:e,width:d.width,height:d.height,colorSpace:o,bitsPerComponent:8,filter:f,index:n,alias:i}}return m}}(hn.API);var Gf,xy,UF,DF,NF,eit=function(){var r,t,e;function n(s){var a,o,d,f,m,v,C,b,P,F,U,k,z,K;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},v=null;;){switch(a=this.readUInt32(),P=(function(){var G,X;for(X=[],G=0;G<4;++G)X.push(String.fromCharCode(this.data[this.pos++]));return X}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":v&&this.animation.frames.push(v),this.pos+=4,v={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},m=this.readUInt16(),f=this.readUInt16()||100,v.delay=1e3*m/f,v.disposeOp=this.data[this.pos++],v.blendOp=this.data[this.pos++],v.data=[];break;case"IDAT":case"fdAT":for(P==="fdAT"&&(this.pos+=4,a-=4),s=(v!=null?v.data:void 0)||this.imgData,k=0;0<=a?k<a:k>a;0<=a?++k:--k)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(d=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>d)throw new Error("More transparent colors than palette size");if((F=d-this.transparency.indexed.length)>0)for(z=0;0<=F?z<F:z>F;0<=F?++z:--z)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":C=(U=this.read(a)).indexOf(0),b=String.fromCharCode.apply(String,U.slice(0,C)),this.text[b]=String.fromCharCode.apply(String,U.slice(C+1));break;case"IEND":return v&&this.animation.frames.push(v),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(K=this.colorType)===4||K===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),d=0,f=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function m(v,C,b,P){var F,U,k,z,K,G,X,Y,it,nt,wt,Ct,st,ot,vt,yt,re,Wt,ee,Zt,oe,pe=Math.ceil((f.width-v)/b),De=Math.ceil((f.height-C)/P),at=f.width==pe&&f.height==De;for(ot=a*pe,Ct=at?o:new Uint8Array(ot*De),G=s.length,st=0,U=0;st<De&&d<G;){switch(s[d++]){case 0:for(z=re=0;re<ot;z=re+=1)Ct[U++]=s[d++];break;case 1:for(z=Wt=0;Wt<ot;z=Wt+=1)F=s[d++],K=z<a?0:Ct[U-a],Ct[U++]=(F+K)%256;break;case 2:for(z=ee=0;ee<ot;z=ee+=1)F=s[d++],k=(z-z%a)/a,vt=st&&Ct[(st-1)*ot+k*a+z%a],Ct[U++]=(vt+F)%256;break;case 3:for(z=Zt=0;Zt<ot;z=Zt+=1)F=s[d++],k=(z-z%a)/a,K=z<a?0:Ct[U-a],vt=st&&Ct[(st-1)*ot+k*a+z%a],Ct[U++]=(F+Math.floor((K+vt)/2))%256;break;case 4:for(z=oe=0;oe<ot;z=oe+=1)F=s[d++],k=(z-z%a)/a,K=z<a?0:Ct[U-a],st===0?vt=yt=0:(vt=Ct[(st-1)*ot+k*a+z%a],yt=k&&Ct[(st-1)*ot+(k-1)*a+z%a]),X=K+vt-yt,Y=Math.abs(X-K),nt=Math.abs(X-vt),wt=Math.abs(X-yt),it=Y<=nt&&Y<=wt?K:nt<=wt?vt:yt,Ct[U++]=(F+it)%256;break;default:throw new Error("Invalid filter algorithm: "+s[d-1])}if(!at){var Tt=((C+st*P)*f.width+v)*a,Rt=st*ot;for(z=0;z<pe;z+=1){for(var Nt=0;Nt<a;Nt+=1)o[Tt++]=Ct[Rt++];Tt+=(b-1)*a}}st++}}return s=Lnt(s),f.interlaceMethod==1?(m(0,0,8,8),m(4,0,8,8),m(0,4,4,8),m(2,0,4,4),m(0,2,2,4),m(1,0,2,2),m(0,1,1,2)):m(0,0,1,1),o},n.prototype.decodePalette=function(){var s,a,o,d,f,m,v,C,b;for(o=this.palette,m=this.transparency.indexed||[],f=new Uint8Array((m.length||0)+o.length),d=0,s=0,a=v=0,C=o.length;v<C;a=v+=3)f[d++]=o[a],f[d++]=o[a+1],f[d++]=o[a+2],f[d++]=(b=m[s++])!=null?b:255;return f},n.prototype.copyToImageData=function(s,a){var o,d,f,m,v,C,b,P,F,U,k;if(d=this.colors,F=null,o=this.hasAlphaChannel,this.palette.length&&(F=(k=this._decodedPalette)!=null?k:this._decodedPalette=this.decodePalette(),d=4,o=!0),P=(f=s.data||s).length,v=F||a,m=C=0,d===1)for(;m<P;)b=F?4*a[m/4]:C,U=v[b++],f[m++]=U,f[m++]=U,f[m++]=U,f[m++]=o?v[b++]:255,C=b;else for(;m<P;)b=F?4*a[m/4]:C,f[m++]=v[b++],f[m++]=v[b++],f[m++]=v[b++],f[m++]=o?v[b++]:255,C=b},n.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var i=function(){if(Object.prototype.toString.call(un)==="[object Window]"){try{t=un.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return i(),r=function(s){var a;if(i()===!0)return e.width=s.width,e.height=s.height,e.clearRect(0,0,s.width,s.height),e.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(s){var a,o,d,f,m,v,C,b;if(this.animation){for(b=[],o=m=0,v=(C=this.animation.frames).length;m<v;o=++m)a=C[o],d=s.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(d,f),a.imageData=d,b.push(a.image=r(d));return b}},n.prototype.renderFrame=function(s,a){var o,d,f;return o=(d=this.animation.frames)[a],f=d[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===1?s.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===2&&s.putImageData(f.imageData,f.xOffset,f.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},n.prototype.animate=function(s){var a,o,d,f,m,v,C=this;return o=0,v=this.animation,f=v.numFrames,d=v.frames,m=v.numPlays,(a=function(){var b,P;if(b=o++%f,P=d[b],C.renderFrame(s,b),f>1&&o/f<m)return C.animation._timeout=setTimeout(a,P.delay)})()},n.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},n.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},n}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function rit(r){var t=0;if(r[t++]!==71||r[t++]!==73||r[t++]!==70||r[t++]!==56||(r[t++]+1&253)!=56||r[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[t++]|r[t++]<<8,n=r[t++]|r[t++]<<8,i=r[t++],s=i>>7,a=1<<(7&i)+1;r[t++],r[t++];var o=null,d=null;s&&(o=t,d=a,t+=3*a);var f=!0,m=[],v=0,C=null,b=0,P=null;for(this.width=e,this.height=n;f&&t<r.length;)switch(r[t++]){case 33:switch(r[t++]){case 255:if(r[t]!==11||r[t+1]==78&&r[t+2]==69&&r[t+3]==84&&r[t+4]==83&&r[t+5]==67&&r[t+6]==65&&r[t+7]==80&&r[t+8]==69&&r[t+9]==50&&r[t+10]==46&&r[t+11]==48&&r[t+12]==3&&r[t+13]==1&&r[t+16]==0)t+=14,P=r[t++]|r[t++]<<8,t++;else for(t+=12;;){if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}break;case 249:if(r[t++]!==4||r[t+4]!==0)throw new Error("Invalid graphics extension block.");var F=r[t++];v=r[t++]|r[t++]<<8,C=r[t++],!(1&F)&&(C=null),b=F>>2&7,t++;break;case 254:for(;;){if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}break;default:throw new Error("Unknown graphic control label: 0x"+r[t-1].toString(16))}break;case 44:var U=r[t++]|r[t++]<<8,k=r[t++]|r[t++]<<8,z=r[t++]|r[t++]<<8,K=r[t++]|r[t++]<<8,G=r[t++],X=G>>6&1,Y=1<<(7&G)+1,it=o,nt=d,wt=!1;G>>7&&(wt=!0,it=t,nt=Y,t+=3*Y);var Ct=t;for(t++;;){var st;if(!((st=r[t++])>=0))throw Error("Invalid block size");if(st===0)break;t+=st}m.push({x:U,y:k,width:z,height:K,has_local_palette:wt,palette_offset:it,palette_size:nt,data_offset:Ct,data_length:t-Ct,transparent_index:C,interlaced:!!X,delay:v,disposal:b});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+r[t-1].toString(16))}this.numFrames=function(){return m.length},this.loopCount=function(){return P},this.frameInfo=function(ot){if(ot<0||ot>=m.length)throw new Error("Frame index out of range.");return m[ot]},this.decodeAndBlitFrameBGRA=function(ot,vt){var yt=this.frameInfo(ot),re=yt.width*yt.height,Wt=new Uint8Array(re);kF(r,yt.data_offset,Wt,re);var ee=yt.palette_offset,Zt=yt.transparent_index;Zt===null&&(Zt=256);var oe=yt.width,pe=e-oe,De=oe,at=4*(yt.y*e+yt.x),Tt=4*((yt.y+yt.height)*e+yt.x),Rt=at,Nt=4*pe;yt.interlaced===!0&&(Nt+=4*e*7);for(var ae=8,Xt=0,ye=Wt.length;Xt<ye;++Xt){var de=Wt[Xt];if(De===0&&(De=oe,(Rt+=Nt)>=Tt&&(Nt=4*pe+4*e*(ae-1),Rt=at+(oe+pe)*(ae<<1),ae>>=1)),de===Zt)Rt+=4;else{var qe=r[ee+3*de],Ve=r[ee+3*de+1],Je=r[ee+3*de+2];vt[Rt++]=Je,vt[Rt++]=Ve,vt[Rt++]=qe,vt[Rt++]=255}--De}},this.decodeAndBlitFrameRGBA=function(ot,vt){var yt=this.frameInfo(ot),re=yt.width*yt.height,Wt=new Uint8Array(re);kF(r,yt.data_offset,Wt,re);var ee=yt.palette_offset,Zt=yt.transparent_index;Zt===null&&(Zt=256);var oe=yt.width,pe=e-oe,De=oe,at=4*(yt.y*e+yt.x),Tt=4*((yt.y+yt.height)*e+yt.x),Rt=at,Nt=4*pe;yt.interlaced===!0&&(Nt+=4*e*7);for(var ae=8,Xt=0,ye=Wt.length;Xt<ye;++Xt){var de=Wt[Xt];if(De===0&&(De=oe,(Rt+=Nt)>=Tt&&(Nt=4*pe+4*e*(ae-1),Rt=at+(oe+pe)*(ae<<1),ae>>=1)),de===Zt)Rt+=4;else{var qe=r[ee+3*de],Ve=r[ee+3*de+1],Je=r[ee+3*de+2];vt[Rt++]=qe,vt[Rt++]=Ve,vt[Rt++]=Je,vt[Rt++]=255}--De}}}function kF(r,t,e,n){for(var i=r[t++],s=1<<i,a=s+1,o=a+1,d=i+1,f=(1<<d)-1,m=0,v=0,C=0,b=r[t++],P=new Int32Array(4096),F=null;;){for(;m<16&&b!==0;)v|=r[t++]<<m,m+=8,b===1?b=r[t++]:--b;if(m<d)break;var U=v&f;if(v>>=d,m-=d,U!==s){if(U===a)break;for(var k=U<o?U:F,z=0,K=k;K>s;)K=P[K]>>8,++z;var G=K;if(C+z+(k!==U?1:0)>n)return void Ui.log("Warning, gif stream longer than expected.");e[C++]=G;var X=C+=z;for(k!==U&&(e[C++]=G),K=k;z--;)K=P[K],e[--X]=255&K,K>>=8;F!==null&&o<4096&&(P[o++]=F<<8|G,o>=f+1&&d<12&&(++d,f=f<<1|1)),F=U}else o=a+1,f=(1<<(d=i+1))-1,F=null}return C!==n&&Ui.log("Warning, gif stream shorter than expected."),e}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function l2(r){var t,e,n,i,s,a=Math.floor,o=new Array(64),d=new Array(64),f=new Array(64),m=new Array(64),v=new Array(65535),C=new Array(65535),b=new Array(64),P=new Array(64),F=[],U=0,k=7,z=new Array(64),K=new Array(64),G=new Array(64),X=new Array(256),Y=new Array(2048),it=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],nt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],wt=[0,1,2,3,4,5,6,7,8,9,10,11],Ct=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],st=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ot=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],vt=[0,1,2,3,4,5,6,7,8,9,10,11],yt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Wt(at,Tt){for(var Rt=0,Nt=0,ae=new Array,Xt=1;Xt<=16;Xt++){for(var ye=1;ye<=at[Xt];ye++)ae[Tt[Nt]]=[],ae[Tt[Nt]][0]=Rt,ae[Tt[Nt]][1]=Xt,Nt++,Rt++;Rt*=2}return ae}function ee(at){for(var Tt=at[0],Rt=at[1]-1;Rt>=0;)Tt&1<<Rt&&(U|=1<<k),Rt--,--k<0&&(U==255?(Zt(255),Zt(0)):Zt(U),k=7,U=0)}function Zt(at){F.push(at)}function oe(at){Zt(at>>8&255),Zt(255&at)}function pe(at,Tt,Rt,Nt,ae){for(var Xt,ye=ae[0],de=ae[240],qe=function($e,Xe){var er,gr,Re,sr,Br,xr,Lr,Zr,Nr,Vr,yr=0;for(Nr=0;Nr<8;++Nr){er=$e[yr],gr=$e[yr+1],Re=$e[yr+2],sr=$e[yr+3],Br=$e[yr+4],xr=$e[yr+5],Lr=$e[yr+6];var In=er+(Zr=$e[yr+7]),an=er-Zr,Xn=gr+Lr,Bt=gr-Lr,ct=Re+xr,ft=Re-xr,pt=sr+Br,Dt=sr-Br,Gt=In+pt,le=In-pt,ge=Xn+ct,te=Xn-ct;$e[yr]=Gt+ge,$e[yr+4]=Gt-ge;var he=.707106781*(te+le);$e[yr+2]=le+he,$e[yr+6]=le-he;var ve=.382683433*((Gt=Dt+ft)-(te=Bt+an)),me=.5411961*Gt+ve,Yt=1.306562965*te+ve,ur=.707106781*(ge=ft+Bt),ir=an+ur,tr=an-ur;$e[yr+5]=tr+me,$e[yr+3]=tr-me,$e[yr+1]=ir+Yt,$e[yr+7]=ir-Yt,yr+=8}for(yr=0,Nr=0;Nr<8;++Nr){er=$e[yr],gr=$e[yr+8],Re=$e[yr+16],sr=$e[yr+24],Br=$e[yr+32],xr=$e[yr+40],Lr=$e[yr+48];var Mr=er+(Zr=$e[yr+56]),Fe=er-Zr,nr=gr+Lr,_r=gr-Lr,Fr=Re+xr,Yr=Re-xr,Qr=sr+Br,vr=sr-Br,wn=Mr+Qr,Ai=Mr-Qr,mn=nr+Fr,Dn=nr-Fr;$e[yr]=wn+mn,$e[yr+32]=wn-mn;var gn=.707106781*(Dn+Ai);$e[yr+16]=Ai+gn,$e[yr+48]=Ai-gn;var Hn=.382683433*((wn=vr+Yr)-(Dn=_r+Fe)),xn=.5411961*wn+Hn,vs=1.306562965*Dn+Hn,Kt=.707106781*(mn=Yr+_r),Er=Fe+Kt,cr=Fe-Kt;$e[yr+40]=cr+xn,$e[yr+24]=cr-xn,$e[yr+8]=Er+vs,$e[yr+56]=Er-vs,yr++}for(Nr=0;Nr<64;++Nr)Vr=$e[Nr]*Xe[Nr],b[Nr]=Vr>0?Vr+.5|0:Vr-.5|0;return b}(at,Tt),Ve=0;Ve<64;++Ve)P[it[Ve]]=qe[Ve];var Je=P[0]-Rt;Rt=P[0],Je==0?ee(Nt[0]):(ee(Nt[C[Xt=32767+Je]]),ee(v[Xt]));for(var or=63;or>0&&P[or]==0;)or--;if(or==0)return ee(ye),Rt;for(var mr,Me=1;Me<=or;){for(var Qt=Me;P[Me]==0&&Me<=or;)++Me;var Ur=Me-Qt;if(Ur>=16){mr=Ur>>4;for(var Ir=1;Ir<=mr;++Ir)ee(de);Ur&=15}Xt=32767+P[Me],ee(ae[(Ur<<4)+C[Xt]]),ee(v[Xt]),Me++}return or!=63&&ee(ye),Rt}function De(at){at=Math.min(Math.max(at,1),100),s!=at&&(function(Tt){for(var Rt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Nt=0;Nt<64;Nt++){var ae=a((Rt[Nt]*Tt+50)/100);ae=Math.min(Math.max(ae,1),255),o[it[Nt]]=ae}for(var Xt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ye=0;ye<64;ye++){var de=a((Xt[ye]*Tt+50)/100);de=Math.min(Math.max(de,1),255),d[it[ye]]=de}for(var qe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ve=0,Je=0;Je<8;Je++)for(var or=0;or<8;or++)f[Ve]=1/(o[it[Ve]]*qe[Je]*qe[or]*8),m[Ve]=1/(d[it[Ve]]*qe[Je]*qe[or]*8),Ve++}(at<50?Math.floor(5e3/at):Math.floor(200-2*at)),s=at)}this.encode=function(at,Tt){Tt&&De(Tt),F=new Array,U=0,k=7,oe(65496),oe(65504),oe(16),Zt(74),Zt(70),Zt(73),Zt(70),Zt(0),Zt(1),Zt(1),Zt(0),oe(1),oe(1),Zt(0),Zt(0),function(){oe(65499),oe(132),Zt(0);for(var gr=0;gr<64;gr++)Zt(o[gr]);Zt(1);for(var Re=0;Re<64;Re++)Zt(d[Re])}(),function(gr,Re){oe(65472),oe(17),Zt(8),oe(Re),oe(gr),Zt(3),Zt(1),Zt(17),Zt(0),Zt(2),Zt(17),Zt(1),Zt(3),Zt(17),Zt(1)}(at.width,at.height),function(){oe(65476),oe(418),Zt(0);for(var gr=0;gr<16;gr++)Zt(nt[gr+1]);for(var Re=0;Re<=11;Re++)Zt(wt[Re]);Zt(16);for(var sr=0;sr<16;sr++)Zt(Ct[sr+1]);for(var Br=0;Br<=161;Br++)Zt(st[Br]);Zt(1);for(var xr=0;xr<16;xr++)Zt(ot[xr+1]);for(var Lr=0;Lr<=11;Lr++)Zt(vt[Lr]);Zt(17);for(var Zr=0;Zr<16;Zr++)Zt(yt[Zr+1]);for(var Nr=0;Nr<=161;Nr++)Zt(re[Nr])}(),oe(65498),oe(12),Zt(3),Zt(1),Zt(0),Zt(2),Zt(17),Zt(3),Zt(17),Zt(0),Zt(63),Zt(0);var Rt=0,Nt=0,ae=0;U=0,k=7,this.encode.displayName="_encode_";for(var Xt,ye,de,qe,Ve,Je,or,mr,Me,Qt=at.data,Ur=at.width,Ir=at.height,$e=4*Ur,Xe=0;Xe<Ir;){for(Xt=0;Xt<$e;){for(Ve=$e*Xe+Xt,or=-1,mr=0,Me=0;Me<64;Me++)Je=Ve+(mr=Me>>3)*$e+(or=4*(7&Me)),Xe+mr>=Ir&&(Je-=$e*(Xe+1+mr-Ir)),Xt+or>=$e&&(Je-=Xt+or-$e+4),ye=Qt[Je++],de=Qt[Je++],qe=Qt[Je++],z[Me]=(Y[ye]+Y[de+256>>0]+Y[qe+512>>0]>>16)-128,K[Me]=(Y[ye+768>>0]+Y[de+1024>>0]+Y[qe+1280>>0]>>16)-128,G[Me]=(Y[ye+1280>>0]+Y[de+1536>>0]+Y[qe+1792>>0]>>16)-128;Rt=pe(z,f,Rt,t,n),Nt=pe(K,m,Nt,e,i),ae=pe(G,m,ae,e,i),Xt+=32}Xe+=8}if(k>=0){var er=[];er[1]=k+1,er[0]=(1<<k+1)-1,ee(er)}return oe(65497),new Uint8Array(F)},r=r||50,function(){for(var at=String.fromCharCode,Tt=0;Tt<256;Tt++)X[Tt]=at(Tt)}(),t=Wt(nt,wt),e=Wt(ot,vt),n=Wt(Ct,st),i=Wt(yt,re),function(){for(var at=1,Tt=2,Rt=1;Rt<=15;Rt++){for(var Nt=at;Nt<Tt;Nt++)C[32767+Nt]=Rt,v[32767+Nt]=[],v[32767+Nt][1]=Rt,v[32767+Nt][0]=Nt;for(var ae=-(Tt-1);ae<=-at;ae++)C[32767+ae]=Rt,v[32767+ae]=[],v[32767+ae][1]=Rt,v[32767+ae][0]=Tt-1+ae;at<<=1,Tt<<=1}}(),function(){for(var at=0;at<256;at++)Y[at]=19595*at,Y[at+256>>0]=38470*at,Y[at+512>>0]=7471*at+32768,Y[at+768>>0]=-11059*at,Y[at+1024>>0]=-21709*at,Y[at+1280>>0]=32768*at+8421375,Y[at+1536>>0]=-27439*at,Y[at+1792>>0]=-5329*at}(),De(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Oc(r,t){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function QF(r){function t(nt){if(!nt)throw Error("assert :P")}function e(nt,wt,Ct){for(var st=0;4>st;st++)if(nt[wt+st]!=Ct.charCodeAt(st))return!0;return!1}function n(nt,wt,Ct,st,ot){for(var vt=0;vt<ot;vt++)nt[wt+vt]=Ct[st+vt]}function i(nt,wt,Ct,st){for(var ot=0;ot<st;ot++)nt[wt+ot]=Ct}function s(nt){return new Int32Array(nt)}function a(nt,wt){for(var Ct=[],st=0;st<nt;st++)Ct.push(new wt);return Ct}function o(nt,wt){var Ct=[];return function st(ot,vt,yt){for(var re=yt[vt],Wt=0;Wt<re&&(ot.push(yt.length>vt+1?[]:new wt),!(yt.length<vt+1));Wt++)st(ot[Wt],vt+1,yt)}(Ct,0,nt),Ct}var d=function(){var nt=this;function wt(T,M){for(var H=1<<M-1>>>0;T&H;)H>>>=1;return H?(T&H-1)+H:T}function Ct(T,M,H,W,ut){t(!(W%H));do T[M+(W-=H)]=ut;while(0<W)}function st(T,M,H,W,ut){if(t(2328>=ut),512>=ut)var mt=s(512);else if((mt=s(ut))==null)return 0;return function(_t,xt,St,Ut,ue,be){var Se,_e,Ze=xt,Ne=1<<St,Ae=s(16),fe=s(16);for(t(ue!=0),t(Ut!=null),t(_t!=null),t(0<St),_e=0;_e<ue;++_e){if(15<Ut[_e])return 0;++Ae[Ut[_e]]}if(Ae[0]==ue)return 0;for(fe[1]=0,Se=1;15>Se;++Se){if(Ae[Se]>1<<Se)return 0;fe[Se+1]=fe[Se]+Ae[Se]}for(_e=0;_e<ue;++_e)Se=Ut[_e],0<Ut[_e]&&(be[fe[Se]++]=_e);if(fe[15]==1)return(Ut=new ot).g=0,Ut.value=be[0],Ct(_t,Ze,1,Ne,Ut),Ne;var je,rr=-1,we=Ne-1,Ge=0,Tr=1,Jr=1,Pr=1<<St;for(_e=0,Se=1,ue=2;Se<=St;++Se,ue<<=1){if(Tr+=Jr<<=1,0>(Jr-=Ae[Se]))return 0;for(;0<Ae[Se];--Ae[Se])(Ut=new ot).g=Se,Ut.value=be[_e++],Ct(_t,Ze+Ge,ue,Pr,Ut),Ge=wt(Ge,Se)}for(Se=St+1,ue=2;15>=Se;++Se,ue<<=1){if(Tr+=Jr<<=1,0>(Jr-=Ae[Se]))return 0;for(;0<Ae[Se];--Ae[Se]){if(Ut=new ot,(Ge&we)!=rr){for(Ze+=Pr,je=1<<(rr=Se)-St;15>rr&&!(0>=(je-=Ae[rr]));)++rr,je<<=1;Ne+=Pr=1<<(je=rr-St),_t[xt+(rr=Ge&we)].g=je+St,_t[xt+rr].value=Ze-xt-rr}Ut.g=Se-St,Ut.value=be[_e++],Ct(_t,Ze+(Ge>>St),ue,Pr,Ut),Ge=wt(Ge,Se)}}return Tr!=2*fe[15]-1?0:Ne}(T,M,H,W,ut,mt)}function ot(){this.value=this.g=0}function vt(){this.value=this.g=0}function yt(){this.G=a(5,ot),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Ei,vt)}function re(T,M,H,W){t(T!=null),t(M!=null),t(2147483648>W),T.Ca=254,T.I=0,T.b=-8,T.Ka=0,T.oa=M,T.pa=H,T.Jd=M,T.Yc=H+W,T.Zc=4<=W?H+W-4+1:H,Xt(T)}function Wt(T,M){for(var H=0;0<M--;)H|=de(T,128)<<M;return H}function ee(T,M){var H=Wt(T,M);return ye(T)?-H:H}function Zt(T,M,H,W){var ut,mt=0;for(t(T!=null),t(M!=null),t(4294967288>W),T.Sb=W,T.Ra=0,T.u=0,T.h=0,4<W&&(W=4),ut=0;ut<W;++ut)mt+=M[H+ut]<<8*ut;T.Ra=mt,T.bb=W,T.oa=M,T.pa=H}function oe(T){for(;8<=T.u&&T.bb<T.Sb;)T.Ra>>>=8,T.Ra+=T.oa[T.pa+T.bb]<<Ml-8>>>0,++T.bb,T.u-=8;Rt(T)&&(T.h=1,T.u=0)}function pe(T,M){if(t(0<=M),!T.h&&M<=lc){var H=Tt(T)&ac[M];return T.u+=M,oe(T),H}return T.h=1,T.u=0}function De(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function at(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Tt(T){return T.Ra>>>(T.u&Ml-1)>>>0}function Rt(T){return t(T.bb<=T.Sb),T.h||T.bb==T.Sb&&T.u>Ml}function Nt(T,M){T.u=M,T.h=Rt(T)}function ae(T){T.u>=Yu&&(t(T.u>=Yu),oe(T))}function Xt(T){t(T!=null&&T.oa!=null),T.pa<T.Zc?(T.I=(T.oa[T.pa++]|T.I<<8)>>>0,T.b+=8):(t(T!=null&&T.oa!=null),T.pa<T.Yc?(T.b+=8,T.I=T.oa[T.pa++]|T.I<<8):T.Ka?T.b=0:(T.I<<=8,T.b+=8,T.Ka=1))}function ye(T){return Wt(T,1)}function de(T,M){var H=T.Ca;0>T.b&&Xt(T);var W=T.b,ut=H*M>>>8,mt=(T.I>>>W>ut)+0;for(mt?(H-=ut,T.I-=ut+1<<W>>>0):H=ut+1,W=H,ut=0;256<=W;)ut+=8,W>>=8;return W=7^ut+eo[W],T.b-=W,T.Ca=(H<<W)-1,mt}function qe(T,M,H){T[M+0]=H>>24&255,T[M+1]=H>>16&255,T[M+2]=H>>8&255,T[M+3]=H>>0&255}function Ve(T,M){return T[M+0]<<0|T[M+1]<<8}function Je(T,M){return Ve(T,M)|T[M+2]<<16}function or(T,M){return Ve(T,M)|Ve(T,M+2)<<16}function mr(T,M){var H=1<<M;return t(T!=null),t(0<M),T.X=s(H),T.X==null?0:(T.Mb=32-M,T.Xa=M,1)}function Me(T,M){t(T!=null),t(M!=null),t(T.Xa==M.Xa),n(M.X,0,T.X,0,1<<M.Xa)}function Qt(){this.X=[],this.Xa=this.Mb=0}function Ur(T,M,H,W){t(H!=null),t(W!=null);var ut=H[0],mt=W[0];return ut==0&&(ut=(T*mt+M/2)/M),mt==0&&(mt=(M*ut+T/2)/T),0>=ut||0>=mt?0:(H[0]=ut,W[0]=mt,1)}function Ir(T,M){return T+(1<<M)-1>>>M}function $e(T,M){return((4278255360&T)+(4278255360&M)>>>0&4278255360)+((16711935&T)+(16711935&M)>>>0&16711935)>>>0}function Xe(T,M){nt[M]=function(H,W,ut,mt,_t,xt,St){var Ut;for(Ut=0;Ut<_t;++Ut){var ue=nt[T](xt[St+Ut-1],ut,mt+Ut);xt[St+Ut]=$e(H[W+Ut],ue)}}}function er(){this.ud=this.hd=this.jd=0}function gr(T,M){return((4278124286&(T^M))>>>1)+(T&M)>>>0}function Re(T){return 0<=T&&256>T?T:0>T?0:255<T?255:void 0}function sr(T,M){return Re(T+(T-M+.5>>1))}function Br(T,M,H){return Math.abs(M-H)-Math.abs(T-H)}function xr(T,M,H,W,ut,mt,_t){for(W=mt[_t-1],H=0;H<ut;++H)mt[_t+H]=W=$e(T[M+H],W)}function Lr(T,M,H,W,ut){var mt;for(mt=0;mt<H;++mt){var _t=T[M+mt],xt=_t>>8&255,St=16711935&(St=(St=16711935&_t)+((xt<<16)+xt));W[ut+mt]=(4278255360&_t)+St>>>0}}function Zr(T,M){M.jd=T>>0&255,M.hd=T>>8&255,M.ud=T>>16&255}function Nr(T,M,H,W,ut,mt){var _t;for(_t=0;_t<W;++_t){var xt=M[H+_t],St=xt>>>8,Ut=xt,ue=255&(ue=(ue=xt>>>16)+((T.jd<<24>>24)*(St<<24>>24)>>>5));Ut=255&(Ut=(Ut=Ut+((T.hd<<24>>24)*(St<<24>>24)>>>5))+((T.ud<<24>>24)*(ue<<24>>24)>>>5)),ut[mt+_t]=(4278255360&xt)+(ue<<16)+Ut}}function Vr(T,M,H,W,ut){nt[M]=function(mt,_t,xt,St,Ut,ue,be,Se,_e){for(St=be;St<Se;++St)for(be=0;be<_e;++be)Ut[ue++]=ut(xt[W(mt[_t++])])},nt[T]=function(mt,_t,xt,St,Ut,ue,be){var Se=8>>mt.b,_e=mt.Ea,Ze=mt.K[0],Ne=mt.w;if(8>Se)for(mt=(1<<mt.b)-1,Ne=(1<<Se)-1;_t<xt;++_t){var Ae,fe=0;for(Ae=0;Ae<_e;++Ae)Ae&mt||(fe=W(St[Ut++])),ue[be++]=ut(Ze[fe&Ne]),fe>>=Se}else nt["VP8LMapColor"+H](St,Ut,Ze,Ne,ue,be,_t,xt,_e)}}function yr(T,M,H,W,ut){for(H=M+H;M<H;){var mt=T[M++];W[ut++]=mt>>16&255,W[ut++]=mt>>8&255,W[ut++]=mt>>0&255}}function In(T,M,H,W,ut){for(H=M+H;M<H;){var mt=T[M++];W[ut++]=mt>>16&255,W[ut++]=mt>>8&255,W[ut++]=mt>>0&255,W[ut++]=mt>>24&255}}function an(T,M,H,W,ut){for(H=M+H;M<H;){var mt=(_t=T[M++])>>16&240|_t>>12&15,_t=_t>>0&240|_t>>28&15;W[ut++]=mt,W[ut++]=_t}}function Xn(T,M,H,W,ut){for(H=M+H;M<H;){var mt=(_t=T[M++])>>16&248|_t>>13&7,_t=_t>>5&224|_t>>3&31;W[ut++]=mt,W[ut++]=_t}}function Bt(T,M,H,W,ut){for(H=M+H;M<H;){var mt=T[M++];W[ut++]=mt>>0&255,W[ut++]=mt>>8&255,W[ut++]=mt>>16&255}}function ct(T,M,H,W,ut,mt){if(mt==0)for(H=M+H;M<H;)qe(W,((mt=T[M++])[0]>>24|mt[1]>>8&65280|mt[2]<<8&16711680|mt[3]<<24)>>>0),ut+=32;else n(W,ut,T,M,H)}function ft(T,M){nt[M][0]=nt[T+"0"],nt[M][1]=nt[T+"1"],nt[M][2]=nt[T+"2"],nt[M][3]=nt[T+"3"],nt[M][4]=nt[T+"4"],nt[M][5]=nt[T+"5"],nt[M][6]=nt[T+"6"],nt[M][7]=nt[T+"7"],nt[M][8]=nt[T+"8"],nt[M][9]=nt[T+"9"],nt[M][10]=nt[T+"10"],nt[M][11]=nt[T+"11"],nt[M][12]=nt[T+"12"],nt[M][13]=nt[T+"13"],nt[M][14]=nt[T+"0"],nt[M][15]=nt[T+"0"]}function pt(T){return T==rh||T==jh||T==nh||T==yu}function Dt(){this.eb=[],this.size=this.A=this.fb=0}function Gt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function le(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Dt,this.f.kb=new Gt,this.sd=null}function ge(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function te(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function he(T){return alert("todo:WebPSamplerProcessPlane"),T.T}function ve(T,M){var H=T.T,W=M.ba.f.RGBA,ut=W.eb,mt=W.fb+T.ka*W.A,_t=Yo[M.ba.S],xt=T.y,St=T.O,Ut=T.f,ue=T.N,be=T.ea,Se=T.W,_e=M.cc,Ze=M.dc,Ne=M.Mc,Ae=M.Nc,fe=T.ka,je=T.ka+T.T,rr=T.U,we=rr+1>>1;for(fe==0?_t(xt,St,null,null,Ut,ue,be,Se,Ut,ue,be,Se,ut,mt,null,null,rr):(_t(M.ec,M.fc,xt,St,_e,Ze,Ne,Ae,Ut,ue,be,Se,ut,mt-W.A,ut,mt,rr),++H);fe+2<je;fe+=2)_e=Ut,Ze=ue,Ne=be,Ae=Se,ue+=T.Rc,Se+=T.Rc,mt+=2*W.A,_t(xt,(St+=2*T.fa)-T.fa,xt,St,_e,Ze,Ne,Ae,Ut,ue,be,Se,ut,mt-W.A,ut,mt,rr);return St+=T.fa,T.j+je<T.o?(n(M.ec,M.fc,xt,St,rr),n(M.cc,M.dc,Ut,ue,we),n(M.Mc,M.Nc,be,Se,we),H--):1&je||_t(xt,St,null,null,Ut,ue,be,Se,Ut,ue,be,Se,ut,mt+W.A,null,null,rr),H}function me(T,M,H){var W=T.F,ut=[T.J];if(W!=null){var mt=T.U,_t=M.ba.S,xt=_t==Vh||_t==nh;M=M.ba.f.RGBA;var St=[0],Ut=T.ka;St[0]=T.T,T.Kb&&(Ut==0?--St[0]:(--Ut,ut[0]-=T.width),T.j+T.ka+T.T==T.o&&(St[0]=T.o-T.j-Ut));var ue=M.eb;Ut=M.fb+Ut*M.A,T=ui(W,ut[0],T.width,mt,St,ue,Ut+(xt?0:3),M.A),t(H==St),T&&pt(_t)&&Zo(ue,Ut,xt,mt,St,M.A)}return 0}function Yt(T){var M=T.ma,H=M.ba.S,W=11>H,ut=H==eh||H==mu||H==Vh||H==zA||H==12||pt(H);if(M.memory=null,M.Ib=null,M.Jb=null,M.Nd=null,!cu(M.Oa,T,ut?11:12))return 0;if(ut&&pt(H)&&hr(),T.da)alert("todo:use_scaling");else{if(W){if(M.Ib=he,T.Kb){if(H=T.U+1>>1,M.memory=s(T.U+2*H),M.memory==null)return 0;M.ec=M.memory,M.fc=0,M.cc=M.ec,M.dc=M.fc+T.U,M.Mc=M.cc,M.Nc=M.dc+H,M.Ib=ve,hr()}}else alert("todo:EmitYUV");ut&&(M.Jb=me,W&&Be())}if(W&&!yc){for(T=0;256>T;++T)kl[T]=89858*(T-128)+mc>>GA,bu[T]=-22014*(T-128)+mc,gp[T]=-45773*(T-128),Sr[T]=113618*(T-128)+mc>>GA;for(T=oh;T<Xh;++T)M=76283*(T-16)+mc>>GA,mp[T-oh]=fo(M,255),Zh[T-oh]=fo(M+8>>4,15);yc=1}return 1}function ur(T){var M=T.ma,H=T.U,W=T.T;return t(!(1&T.ka)),0>=H||0>=W?0:(H=M.Ib(T,M),M.Jb!=null&&M.Jb(T,M,H),M.Dc+=H,1)}function ir(T){T.ma.memory=null}function tr(T,M,H,W){return pe(T,8)!=47?0:(M[0]=pe(T,14)+1,H[0]=pe(T,14)+1,W[0]=pe(T,1),pe(T,3)!=0?0:!T.h)}function Mr(T,M){if(4>T)return T+1;var H=T-2>>1;return(2+(1&T)<<H)+pe(M,H)+1}function Fe(T,M){return 120<M?M-120:1<=(H=((H=ba[M-1])>>4)*T+(8-(15&H)))?H:1;var H}function nr(T,M,H){var W=Tt(H),ut=T[M+=255&W].g-8;return 0<ut&&(Nt(H,H.u+8),W=Tt(H),M+=T[M].value,M+=W&(1<<ut)-1),Nt(H,H.u+T[M].g),T[M].value}function _r(T,M,H){return H.g+=T.g,H.value+=T.value<<M>>>0,t(8>=H.g),T.g}function Fr(T,M,H){var W=T.xc;return t((M=W==0?0:T.vc[T.md*(H>>W)+(M>>W)])<T.Wb),T.Ya[M]}function Yr(T,M,H,W){var ut=T.ab,mt=T.c*M,_t=T.C;M=_t+M;var xt=H,St=W;for(W=T.Ta,H=T.Ua;0<ut--;){var Ut=T.gc[ut],ue=_t,be=M,Se=xt,_e=St,Ze=(St=W,xt=H,Ut.Ea);switch(t(ue<be),t(be<=Ut.nc),Ut.hc){case 2:kn(Se,_e,(be-ue)*Ze,St,xt);break;case 0:var Ne=ue,Ae=be,fe=St,je=xt,rr=(Pr=Ut).Ea;Ne==0&&(Fl(Se,_e,null,null,1,fe,je),xr(Se,_e+1,0,0,rr-1,fe,je+1),_e+=rr,je+=rr,++Ne);for(var we=1<<Pr.b,Ge=we-1,Tr=Ir(rr,Pr.b),Jr=Pr.K,Pr=Pr.w+(Ne>>Pr.b)*Tr;Ne<Ae;){var pn=Jr,Yn=Pr,_n=1;for(hu(Se,_e,fe,je-rr,1,fe,je);_n<rr;){var On=(_n&~Ge)+we;On>rr&&(On=rr),(0,cc[pn[Yn++]>>8&15])(Se,_e+ +_n,fe,je+_n-rr,On-_n,fe,je+_n),_n=On}_e+=rr,je+=rr,++Ne&Ge||(Pr+=Tr)}be!=Ut.nc&&n(St,xt-Ze,St,xt+(be-ue-1)*Ze,Ze);break;case 1:for(Ze=Se,Ae=_e,rr=(Se=Ut.Ea)-(je=Se&~(fe=(_e=1<<Ut.b)-1)),Ne=Ir(Se,Ut.b),we=Ut.K,Ut=Ut.w+(ue>>Ut.b)*Ne;ue<be;){for(Ge=we,Tr=Ut,Jr=new er,Pr=Ae+je,pn=Ae+Se;Ae<Pr;)Zr(Ge[Tr++],Jr),uc(Jr,Ze,Ae,_e,St,xt),Ae+=_e,xt+=_e;Ae<pn&&(Zr(Ge[Tr++],Jr),uc(Jr,Ze,Ae,rr,St,xt),Ae+=rr,xt+=rr),++ue&fe||(Ut+=Ne)}break;case 3:if(Se==St&&_e==xt&&0<Ut.b){for(Ae=St,Se=Ze=xt+(be-ue)*Ze-(je=(be-ue)*Ir(Ut.Ea,Ut.b)),_e=St,fe=xt,Ne=[],je=(rr=je)-1;0<=je;--je)Ne[je]=_e[fe+je];for(je=rr-1;0<=je;--je)Ae[Se+je]=Ne[je];ya(Ut,ue,be,St,Ze,St,xt)}else ya(Ut,ue,be,Se,_e,St,xt)}xt=W,St=H}St!=H&&n(W,H,xt,St,mt)}function Qr(T,M){var H=T.V,W=T.Ba+T.c*T.C,ut=M-T.C;if(t(M<=T.l.o),t(16>=ut),0<ut){var mt=T.l,_t=T.Ta,xt=T.Ua,St=mt.width;if(Yr(T,ut,H,W),ut=xt=[xt],t((H=T.C)<(W=M)),t(mt.v<mt.va),W>mt.o&&(W=mt.o),H<mt.j){var Ut=mt.j-H;H=mt.j,ut[0]+=Ut*St}if(H>=W?H=0:(ut[0]+=4*mt.v,mt.ka=H-mt.j,mt.U=mt.va-mt.v,mt.T=W-H,H=1),H){if(xt=xt[0],11>(H=T.ca).S){var ue=H.f.RGBA,be=(W=H.S,ut=mt.U,mt=mt.T,Ut=ue.eb,ue.A),Se=mt;for(ue=ue.fb+T.Ma*ue.A;0<Se--;){var _e=_t,Ze=xt,Ne=ut,Ae=Ut,fe=ue;switch(W){case gu:Gs(_e,Ze,Ne,Ae,fe);break;case eh:ws(_e,Ze,Ne,Ae,fe);break;case rh:ws(_e,Ze,Ne,Ae,fe),Zo(Ae,fe,0,Ne,1,0);break;case Ap:po(_e,Ze,Ne,Ae,fe);break;case mu:ct(_e,Ze,Ne,Ae,fe,1);break;case jh:ct(_e,Ze,Ne,Ae,fe,1),Zo(Ae,fe,0,Ne,1,0);break;case Vh:ct(_e,Ze,Ne,Ae,fe,0);break;case nh:ct(_e,Ze,Ne,Ae,fe,0),Zo(Ae,fe,1,Ne,1,0);break;case zA:ka(_e,Ze,Ne,Ae,fe);break;case yu:ka(_e,Ze,Ne,Ae,fe),Zn(Ae,fe,Ne,1,0);break;case Gh:Qa(_e,Ze,Ne,Ae,fe);break;default:t(0)}xt+=St,ue+=be}T.Ma+=mt}else alert("todo:EmitRescaledRowsYUVA");t(T.Ma<=H.height)}}T.C=M,t(T.C<=T.i)}function vr(T){var M;if(0<T.ua)return 0;for(M=0;M<T.Wb;++M){var H=T.Ya[M].G,W=T.Ya[M].H;if(0<H[1][W[1]+0].g||0<H[2][W[2]+0].g||0<H[3][W[3]+0].g)return 0}return 1}function wn(T,M,H,W,ut,mt){if(T.Z!=0){var _t=T.qd,xt=T.rd;for(t(Nl[T.Z]!=null);M<H;++M)Nl[T.Z](_t,xt,W,ut,W,ut,mt),_t=W,xt=ut,ut+=mt;T.qd=_t,T.rd=xt}}function Ai(T,M){var H=T.l.ma,W=H.Z==0||H.Z==1?T.l.j:T.C;if(W=T.C<W?W:T.C,t(M<=T.l.o),M>W){var ut=T.l.width,mt=H.ca,_t=H.tb+ut*W,xt=T.V,St=T.Ba+T.c*W,Ut=T.gc;t(T.ab==1),t(Ut[0].hc==3),QA(Ut[0],W,M,xt,St,mt,_t),wn(H,W,M,mt,_t,ut)}T.C=T.Ma=M}function mn(T,M,H,W,ut,mt,_t){var xt=T.$/W,St=T.$%W,Ut=T.m,ue=T.s,be=H+T.$,Se=be;ut=H+W*ut;var _e=H+W*mt,Ze=280+ue.ua,Ne=T.Pb?xt:16777216,Ae=0<ue.ua?ue.Wa:null,fe=ue.wc,je=be<_e?Fr(ue,St,xt):null;t(T.C<mt),t(_e<=ut);var rr=!1;t:for(;;){for(;rr||be<_e;){var we=0;if(xt>=Ne){var Ge=be-H;t((Ne=T).Pb),Ne.wd=Ne.m,Ne.xd=Ge,0<Ne.s.ua&&Me(Ne.s.Wa,Ne.s.vb),Ne=xt+Vd}if(St&fe||(je=Fr(ue,St,xt)),t(je!=null),je.Qb&&(M[be]=je.qb,rr=!0),!rr)if(ae(Ut),je.jc){we=Ut,Ge=M;var Tr=be,Jr=je.pd[Tt(we)&Ei-1];t(je.jc),256>Jr.g?(Nt(we,we.u+Jr.g),Ge[Tr]=Jr.value,we=0):(Nt(we,we.u+Jr.g-256),t(256<=Jr.value),we=Jr.value),we==0&&(rr=!0)}else we=nr(je.G[0],je.H[0],Ut);if(Ut.h)break;if(rr||256>we){if(!rr)if(je.nd)M[be]=(je.qb|we<<8)>>>0;else{if(ae(Ut),rr=nr(je.G[1],je.H[1],Ut),ae(Ut),Ge=nr(je.G[2],je.H[2],Ut),Tr=nr(je.G[3],je.H[3],Ut),Ut.h)break;M[be]=(Tr<<24|rr<<16|we<<8|Ge)>>>0}if(rr=!1,++be,++St>=W&&(St=0,++xt,_t!=null&&xt<=mt&&!(xt%16)&&_t(T,xt),Ae!=null))for(;Se<be;)we=M[Se++],Ae.X[(506832829*we&4294967295)>>>Ae.Mb]=we}else if(280>we){if(we=Mr(we-256,Ut),Ge=nr(je.G[4],je.H[4],Ut),ae(Ut),Ge=Fe(W,Ge=Mr(Ge,Ut)),Ut.h)break;if(be-H<Ge||ut-be<we)break t;for(Tr=0;Tr<we;++Tr)M[be+Tr]=M[be+Tr-Ge];for(be+=we,St+=we;St>=W;)St-=W,++xt,_t!=null&&xt<=mt&&!(xt%16)&&_t(T,xt);if(t(be<=ut),St&fe&&(je=Fr(ue,St,xt)),Ae!=null)for(;Se<be;)we=M[Se++],Ae.X[(506832829*we&4294967295)>>>Ae.Mb]=we}else{if(!(we<Ze))break t;for(rr=we-280,t(Ae!=null);Se<be;)we=M[Se++],Ae.X[(506832829*we&4294967295)>>>Ae.Mb]=we;we=be,t(!(rr>>>(Ge=Ae).Xa)),M[we]=Ge.X[rr],rr=!0}rr||t(Ut.h==Rt(Ut))}if(T.Pb&&Ut.h&&be<ut)t(T.m.h),T.a=5,T.m=T.wd,T.$=T.xd,0<T.s.ua&&Me(T.s.vb,T.s.Wa);else{if(Ut.h)break t;_t!=null&&_t(T,xt>mt?mt:xt),T.a=0,T.$=be-H}return 1}return T.a=3,0}function Dn(T){t(T!=null),T.vc=null,T.yc=null,T.Ya=null;var M=T.Wa;M!=null&&(M.X=null),T.vb=null,t(T!=null)}function gn(){var T=new zh;return T==null?null:(T.a=0,T.xb=Kd,ft("Predictor","VP8LPredictors"),ft("Predictor","VP8LPredictors_C"),ft("PredictorAdd","VP8LPredictorsAdd"),ft("PredictorAdd","VP8LPredictorsAdd_C"),kn=Lr,uc=Nr,Gs=yr,ws=In,ka=an,Qa=Xn,po=Bt,nt.VP8LMapColor32b=Ju,nt.VP8LMapColor8b=Hh,T)}function Hn(T,M,H,W,ut){var mt=1,_t=[T],xt=[M],St=W.m,Ut=W.s,ue=null,be=0;t:for(;;){if(H)for(;mt&&pe(St,1);){var Se=_t,_e=xt,Ze=W,Ne=1,Ae=Ze.m,fe=Ze.gc[Ze.ab],je=pe(Ae,2);if(Ze.Oc&1<<je)mt=0;else{switch(Ze.Oc|=1<<je,fe.hc=je,fe.Ea=Se[0],fe.nc=_e[0],fe.K=[null],++Ze.ab,t(4>=Ze.ab),je){case 0:case 1:fe.b=pe(Ae,3)+2,Ne=Hn(Ir(fe.Ea,fe.b),Ir(fe.nc,fe.b),0,Ze,fe.K),fe.K=fe.K[0];break;case 3:var rr,we=pe(Ae,8)+1,Ge=16<we?0:4<we?1:2<we?2:3;if(Se[0]=Ir(fe.Ea,Ge),fe.b=Ge,rr=Ne=Hn(we,1,0,Ze,fe.K)){var Tr,Jr=we,Pr=fe,pn=1<<(8>>Pr.b),Yn=s(pn);if(Yn==null)rr=0;else{var _n=Pr.K[0],On=Pr.w;for(Yn[0]=Pr.K[0][0],Tr=1;Tr<1*Jr;++Tr)Yn[Tr]=$e(_n[On+Tr],Yn[Tr-1]);for(;Tr<4*pn;++Tr)Yn[Tr]=0;Pr.K[0]=null,Pr.K[0]=Yn,rr=1}}Ne=rr;break;case 2:break;default:t(0)}mt=Ne}}if(_t=_t[0],xt=xt[0],mt&&pe(St,1)&&!(mt=1<=(be=pe(St,4))&&11>=be)){W.a=3;break t}var Kn;if(Kn=mt)e:{var tn,jr,Yi,Bs=W,Mi=_t,io=xt,Wn=be,Ji=H,Cs=Bs.m,qi=Bs.s,os=[null],us=1,No=0,mo=Hd[Wn];r:for(;;){if(Ji&&pe(Cs,1)){var Fi=pe(Cs,3)+2,Ha=Ir(Mi,Fi),Al=Ir(io,Fi),Jo=Ha*Al;if(!Hn(Ha,Al,0,Bs,os))break r;for(os=os[0],qi.xc=Fi,tn=0;tn<Jo;++tn){var dl=os[tn]>>8&65535;os[tn]=dl,dl>=us&&(us=dl+1)}}if(Cs.h)break r;for(jr=0;5>jr;++jr){var Li=Kh[jr];!jr&&0<Wn&&(Li+=1<<Wn),No<Li&&(No=Li)}var wu=a(us*mo,ot),jA=us,w=a(jA,yt);if(w==null)var l=null;else t(65536>=jA),l=w;var u=s(No);if(l==null||u==null||wu==null){Bs.a=1;break r}var g=wu;for(tn=Yi=0;tn<us;++tn){var y=l[tn],B=y.G,S=y.H,L=0,O=1,Q=0;for(jr=0;5>jr;++jr){Li=Kh[jr],B[jr]=g,S[jr]=Yi,!jr&&0<Wn&&(Li+=1<<Wn);i:{var q,Z=Li,J=Bs,At=u,gt=g,Lt=Yi,Ft=0,Ot=J.m,kt=pe(Ot,1);if(i(At,0,0,Z),kt){var qt=pe(Ot,1)+1,$t=pe(Ot,1),Jt=pe(Ot,$t==0?1:8);At[Jt]=1,qt==2&&(At[Jt=pe(Ot,8)]=1);var ne=1}else{var se=s(19),Te=pe(Ot,4)+4;if(19<Te){J.a=3;var Ce=0;break i}for(q=0;q<Te;++q)se[_u[q]]=pe(Ot,3);var Oe=void 0,ze=void 0,Le=J,fr=se,Ar=Z,Ke=At,br=0,sn=Le.m,Mn=8,vi=a(128,ot);n:for(;st(vi,0,7,fr,19);){if(pe(sn,1)){var oi=2+2*pe(sn,3);if((Oe=2+pe(sn,oi))>Ar)break n}else Oe=Ar;for(ze=0;ze<Ar&&Oe--;){ae(sn);var bi=vi[0+(127&Tt(sn))];Nt(sn,sn.u+bi.g);var zn=bi.value;if(16>zn)Ke[ze++]=zn,zn!=0&&(Mn=zn);else{var Jn=zn==16,ti=zn-16,qs=zd[ti],ts=pe(sn,qh[ti])+qs;if(ze+ts>Ar)break n;for(var as=Jn?Mn:0;0<ts--;)Ke[ze++]=as}}br=1;break n}br||(Le.a=3),ne=br}(ne=ne&&!Ot.h)&&(Ft=st(gt,Lt,8,At,Z)),ne&&Ft!=0?Ce=Ft:(J.a=3,Ce=0)}if(Ce==0)break r;if(O&&Ti[jr]==1&&(O=g[Yi].g==0),L+=g[Yi].g,Yi+=Ce,3>=jr){var hs,Va=u[0];for(hs=1;hs<Li;++hs)u[hs]>Va&&(Va=u[hs]);Q+=Va}}if(y.nd=O,y.Qb=0,O&&(y.qb=(B[3][S[3]+0].value<<24|B[1][S[1]+0].value<<16|B[2][S[2]+0].value)>>>0,L==0&&256>B[0][S[0]+0].value&&(y.Qb=1,y.qb+=B[0][S[0]+0].value<<8)),y.jc=!y.Qb&&6>Q,y.jc){var ta,es=y;for(ta=0;ta<Ei;++ta){var so=ta,xa=es.pd[so],_c=es.G[0][es.H[0]+so];256<=_c.value?(xa.g=_c.g+256,xa.value=_c.value):(xa.g=0,xa.value=0,so>>=_r(_c,8,xa),so>>=_r(es.G[1][es.H[1]+so],16,xa),so>>=_r(es.G[2][es.H[2]+so],0,xa),_r(es.G[3][es.H[3]+so],24,xa))}}}qi.vc=os,qi.Wb=us,qi.Ya=l,qi.yc=wu,Kn=1;break e}Kn=0}if(!(mt=Kn)){W.a=3;break t}if(0<be){if(Ut.ua=1<<be,!mr(Ut.Wa,be)){W.a=1,mt=0;break t}}else Ut.ua=0;var vc=W,yo=_t,Ba=xt,ko=vc.s,_o=ko.xc;if(vc.c=yo,vc.i=Ba,ko.md=Ir(yo,_o),ko.wc=_o==0?-1:(1<<_o)-1,H){W.xb=fp;break t}if((ue=s(_t*xt))==null){W.a=1,mt=0;break t}mt=(mt=mn(W,ue,0,_t,xt,xt,null))&&!St.h;break t}return mt?(ut!=null?ut[0]=ue:(t(ue==null),t(H)),W.$=0,H||Dn(Ut)):Dn(Ut),mt}function xn(T,M){var H=T.c*T.i,W=H+M+16*M;return t(T.c<=M),T.V=s(W),T.V==null?(T.Ta=null,T.Ua=0,T.a=1,0):(T.Ta=T.V,T.Ua=T.Ba+H+M,1)}function vs(T,M){var H=T.C,W=M-H,ut=T.V,mt=T.Ba+T.c*H;for(t(M<=T.l.o);0<W;){var _t=16<W?16:W,xt=T.l.ma,St=T.l.width,Ut=St*_t,ue=xt.ca,be=xt.tb+St*H,Se=T.Ta,_e=T.Ua;Yr(T,_t,ut,mt),Zi(Se,_e,ue,be,Ut),wn(xt,H,H+_t,ue,be,St),W-=_t,ut+=_t*T.c,H+=_t}t(H==M),T.C=T.Ma=M}function Kt(){this.ub=this.yd=this.td=this.Rb=0}function Er(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function cr(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function dn(){this.Yb=function(){var T=[];return function M(H,W,ut){for(var mt=ut[W],_t=0;_t<mt&&(H.push(ut.length>W+1?[]:0),!(ut.length<W+1));_t++)M(H[_t],W+1,ut)}(T,0,[3,11]),T}()}function qn(){this.jb=s(3),this.Wc=o([4,8],dn),this.Xc=o([4,17],dn)}function Gn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Qn(){this.ld=this.La=this.dd=this.tc=0}function di(){this.Na=this.la=0}function xi(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function mi(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ds(){this.uc=this.M=this.Nb=0,this.wa=Array(new Qn),this.Y=0,this.ya=Array(new mi),this.aa=0,this.l=new Oa}function Po(){this.y=s(16),this.f=s(8),this.ea=s(8)}function $c(){this.cb=this.a=0,this.sc="",this.m=new De,this.Od=new Kt,this.Kc=new Er,this.ed=new Gn,this.Qa=new cr,this.Ic=this.$c=this.Aa=0,this.D=new Ds,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,De),this.ia=0,this.pb=a(4,xi),this.Pa=new qn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Po),this.Hd=0,this.rb=Array(new di),this.sb=0,this.wa=Array(new Qn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new mi),this.L=this.aa=0,this.gd=o([4,2],Qn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Oa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Mo(){var T=new $c;return T!=null&&(T.a=0,T.sc="OK",T.cb=0,T.Xb=0,cl||(cl=il)),T}function Nn(T,M,H){return T.a==0&&(T.a=M,T.sc=H,T.cb=0),0}function nl(T,M,H){return 3<=H&&T[M+0]==157&&T[M+1]==1&&T[M+2]==42}function Fo(T,M){if(T==null)return 0;if(T.a=0,T.sc="OK",M==null)return Nn(T,2,"null VP8Io passed to VP8GetHeaders()");var H=M.data,W=M.w,ut=M.ha;if(4>ut)return Nn(T,7,"Truncated header.");var mt=H[W+0]|H[W+1]<<8|H[W+2]<<16,_t=T.Od;if(_t.Rb=!(1&mt),_t.td=mt>>1&7,_t.yd=mt>>4&1,_t.ub=mt>>5,3<_t.td)return Nn(T,3,"Incorrect keyframe parameters.");if(!_t.yd)return Nn(T,4,"Frame not displayable.");W+=3,ut-=3;var xt=T.Kc;if(_t.Rb){if(7>ut)return Nn(T,7,"cannot parse picture header");if(!nl(H,W,ut))return Nn(T,3,"Bad code word");xt.c=16383&(H[W+4]<<8|H[W+3]),xt.Td=H[W+4]>>6,xt.i=16383&(H[W+6]<<8|H[W+5]),xt.Ud=H[W+6]>>6,W+=7,ut-=7,T.za=xt.c+15>>4,T.Ub=xt.i+15>>4,M.width=xt.c,M.height=xt.i,M.Da=0,M.j=0,M.v=0,M.va=M.width,M.o=M.height,M.da=0,M.ib=M.width,M.hb=M.height,M.U=M.width,M.T=M.height,i((mt=T.Pa).jb,0,255,mt.jb.length),t((mt=T.Qa)!=null),mt.Cb=0,mt.Bb=0,mt.Fb=1,i(mt.Zb,0,0,mt.Zb.length),i(mt.Lb,0,0,mt.Lb)}if(_t.ub>ut)return Nn(T,7,"bad partition length");re(mt=T.m,H,W,_t.ub),W+=_t.ub,ut-=_t.ub,_t.Rb&&(xt.Ld=ye(mt),xt.Kd=ye(mt)),xt=T.Qa;var St,Ut=T.Pa;if(t(mt!=null),t(xt!=null),xt.Cb=ye(mt),xt.Cb){if(xt.Bb=ye(mt),ye(mt)){for(xt.Fb=ye(mt),St=0;4>St;++St)xt.Zb[St]=ye(mt)?ee(mt,7):0;for(St=0;4>St;++St)xt.Lb[St]=ye(mt)?ee(mt,6):0}if(xt.Bb)for(St=0;3>St;++St)Ut.jb[St]=ye(mt)?Wt(mt,8):255}else xt.Bb=0;if(mt.Ka)return Nn(T,3,"cannot parse segment header");if((xt=T.ed).zd=ye(mt),xt.Tb=Wt(mt,6),xt.wb=Wt(mt,3),xt.Pc=ye(mt),xt.Pc&&ye(mt)){for(Ut=0;4>Ut;++Ut)ye(mt)&&(xt.vd[Ut]=ee(mt,6));for(Ut=0;4>Ut;++Ut)ye(mt)&&(xt.od[Ut]=ee(mt,6))}if(T.L=xt.Tb==0?0:xt.zd?1:2,mt.Ka)return Nn(T,3,"cannot parse filter header");var ue=ut;if(ut=St=W,W=St+ue,xt=ue,T.Xb=(1<<Wt(T.m,2))-1,ue<3*(Ut=T.Xb))H=7;else{for(St+=3*Ut,xt-=3*Ut,ue=0;ue<Ut;++ue){var be=H[ut+0]|H[ut+1]<<8|H[ut+2]<<16;be>xt&&(be=xt),re(T.Jc[+ue],H,St,be),St+=be,xt-=be,ut+=3}re(T.Jc[+Ut],H,St,xt),H=St<W?0:5}if(H!=0)return Nn(T,H,"cannot parse partitions");for(H=Wt(St=T.m,7),ut=ye(St)?ee(St,4):0,W=ye(St)?ee(St,4):0,xt=ye(St)?ee(St,4):0,Ut=ye(St)?ee(St,4):0,St=ye(St)?ee(St,4):0,ue=T.Qa,be=0;4>be;++be){if(ue.Cb){var Se=ue.Zb[be];ue.Fb||(Se+=H)}else{if(0<be){T.pb[be]=T.pb[0];continue}Se=H}var _e=T.pb[be];_e.Sc[0]=HA[fo(Se+ut,127)],_e.Sc[1]=pc[fo(Se+0,127)],_e.Eb[0]=2*HA[fo(Se+W,127)],_e.Eb[1]=101581*pc[fo(Se+xt,127)]>>16,8>_e.Eb[1]&&(_e.Eb[1]=8),_e.Qc[0]=HA[fo(Se+Ut,117)],_e.Qc[1]=pc[fo(Se+St,127)],_e.lc=Se+St}if(!_t.Rb)return Nn(T,4,"Not a key frame.");for(ye(mt),_t=T.Pa,H=0;4>H;++H){for(ut=0;8>ut;++ut)for(W=0;3>W;++W)for(xt=0;11>xt;++xt)Ut=de(mt,dp[H][ut][W][xt])?Wt(mt,8):jd[H][ut][W][xt],_t.Wc[H][ut].Yb[W][xt]=Ut;for(ut=0;17>ut;++ut)_t.Xc[H][ut]=_t.Wc[H][gc[ut]]}return T.kc=ye(mt),T.kc&&(T.Bd=Wt(mt,8)),T.cb=1}function il(T,M,H,W,ut,mt,_t){var xt=M[ut].Yb[H];for(H=0;16>ut;++ut){if(!de(T,xt[H+0]))return ut;for(;!de(T,xt[H+1]);)if(xt=M[++ut].Yb[0],H=0,ut==16)return 16;var St=M[ut+1].Yb;if(de(T,xt[H+2])){var Ut=T,ue=0;if(de(Ut,(Se=xt)[(be=H)+3]))if(de(Ut,Se[be+6])){for(xt=0,be=2*(ue=de(Ut,Se[be+8]))+(Se=de(Ut,Se[be+9+ue])),ue=0,Se=VA[be];Se[xt];++xt)ue+=ue+de(Ut,Se[xt]);ue+=3+(8<<be)}else de(Ut,Se[be+7])?(ue=7+2*de(Ut,165),ue+=de(Ut,145)):ue=5+de(Ut,159);else ue=de(Ut,Se[be+4])?3+de(Ut,Se[be+5]):2;xt=St[2]}else ue=1,xt=St[1];St=_t+Wh[ut],0>(Ut=T).b&&Xt(Ut);var be,Se=Ut.b,_e=(be=Ut.Ca>>1)-(Ut.I>>Se)>>31;--Ut.b,Ut.Ca+=_e,Ut.Ca|=1,Ut.I-=(be+1&_e)<<Se,mt[St]=((ue^_e)-_e)*W[(0<ut)+0]}return 16}function fa(T){var M=T.rb[T.sb-1];M.la=0,M.Na=0,i(T.zc,0,0,T.zc.length),T.ja=0}function sc(T,M){if(T==null)return 0;if(M==null)return Nn(T,2,"NULL VP8Io parameter in VP8Decode().");if(!T.cb&&!Fo(T,M))return 0;if(t(T.cb),M.ac==null||M.ac(M)){M.ob&&(T.L=0);var H=Yh[T.L];if(T.L==2?(T.yb=0,T.zb=0):(T.yb=M.v-H>>4,T.zb=M.j-H>>4,0>T.yb&&(T.yb=0),0>T.zb&&(T.zb=0)),T.Va=M.o+15+H>>4,T.Hb=M.va+15+H>>4,T.Hb>T.za&&(T.Hb=T.za),T.Va>T.Ub&&(T.Va=T.Ub),0<T.L){var W=T.ed;for(H=0;4>H;++H){var ut;if(T.Qa.Cb){var mt=T.Qa.Lb[H];T.Qa.Fb||(mt+=W.Tb)}else mt=W.Tb;for(ut=0;1>=ut;++ut){var _t=T.gd[H][ut],xt=mt;if(W.Pc&&(xt+=W.vd[0],ut&&(xt+=W.od[0])),0<(xt=0>xt?0:63<xt?63:xt)){var St=xt;0<W.wb&&(St=4<W.wb?St>>2:St>>1)>9-W.wb&&(St=9-W.wb),1>St&&(St=1),_t.dd=St,_t.tc=2*xt+St,_t.ld=40<=xt?2:15<=xt?1:0}else _t.tc=0;_t.La=ut}}}H=0}else Nn(T,6,"Frame setup failed"),H=T.a;if(H=H==0){if(H){T.$c=0,0<T.Aa||(T.Ic=ah);t:{H=T.Ic,W=4*(St=T.za);var Ut=32*St,ue=St+1,be=0<T.L?St*(0<T.Aa?2:1):0,Se=(T.Aa==2?2:1)*St;if((_t=W+832+(ut=3*(16*H+Yh[T.L])/2*Ut)+(mt=T.Fa!=null&&0<T.Fa.length?T.Kc.c*T.Kc.i:0))!=_t)H=0;else{if(_t>T.Vb){if(T.Vb=0,T.Ec=s(_t),T.Fc=0,T.Ec==null){H=Nn(T,1,"no memory during frame initialization.");break t}T.Vb=_t}_t=T.Ec,xt=T.Fc,T.Ac=_t,T.Bc=xt,xt+=W,T.Gd=a(Ut,Po),T.Hd=0,T.rb=a(ue+1,di),T.sb=1,T.wa=be?a(be,Qn):null,T.Y=0,T.D.Nb=0,T.D.wa=T.wa,T.D.Y=T.Y,0<T.Aa&&(T.D.Y+=St),t(!0),T.oc=_t,T.pc=xt,xt+=832,T.ya=a(Se,mi),T.aa=0,T.D.ya=T.ya,T.D.aa=T.aa,T.Aa==2&&(T.D.aa+=St),T.R=16*St,T.B=8*St,St=(Ut=Yh[T.L])*T.R,Ut=Ut/2*T.B,T.sa=_t,T.ta=xt+St,T.qa=T.sa,T.ra=T.ta+16*H*T.R+Ut,T.Ha=T.qa,T.Ia=T.ra+8*H*T.B+Ut,T.$c=0,xt+=ut,T.mb=mt?_t:null,T.nb=mt?xt:null,t(xt+mt<=T.Fc+T.Vb),fa(T),i(T.Ac,T.Bc,0,W),H=1}}if(H){if(M.ka=0,M.y=T.sa,M.O=T.ta,M.f=T.qa,M.N=T.ra,M.ea=T.Ha,M.Vd=T.Ia,M.fa=T.R,M.Rc=T.B,M.F=null,M.J=0,!fu){for(H=-255;255>=H;++H)ss[255+H]=0>H?-H:H;for(H=-1020;1020>=H;++H)Ul[1020+H]=-128>H?-128:127<H?127:H;for(H=-112;112>=H;++H)dc[112+H]=-16>H?-16:15<H?15:H;for(H=-255;510>=H;++H)Dl[255+H]=0>H?0:255<H?255:H;fu=1}za=It,is=cn,th=Tl,js=Ku,xs=bt,ji=ks,Ll=eu,Au=Uo,Rl=Zu,ll=ru,hc=NA,Xo=Xu,_a=Qh,du=nu,Ol=oc,yn=Pn,Ac=Ro,va=Wo,ro[0]=bs,ro[1]=xe,ro[2]=Lo,ro[3]=Nh,ro[4]=Zc,ro[5]=Ua,ro[6]=ii,ro[7]=vn,ro[8]=Yc,ro[9]=ln,ul[0]=_i,ul[1]=Cr,ul[2]=Gr,ul[3]=Bn,ul[4]=nn,ul[5]=Xc,ul[6]=Ko,hl[0]=pa,hl[1]=ar,hl[2]=Sn,hl[3]=sl,hl[4]=Da,hl[5]=Jc,hl[6]=Na,H=1}else H=0}H&&(H=function(_e,Ze){for(_e.M=0;_e.M<_e.Va;++_e.M){var Ne,Ae=_e.Jc[_e.M&_e.Xb],fe=_e.m,je=_e;for(Ne=0;Ne<je.za;++Ne){var rr=fe,we=je,Ge=we.Ac,Tr=we.Bc+4*Ne,Jr=we.zc,Pr=we.ya[we.aa+Ne];if(we.Qa.Bb?Pr.$b=de(rr,we.Pa.jb[0])?2+de(rr,we.Pa.jb[2]):de(rr,we.Pa.jb[1]):Pr.$b=0,we.kc&&(Pr.Ad=de(rr,we.Bd)),Pr.Za=!de(rr,145)+0,Pr.Za){var pn=Pr.Ob,Yn=0;for(we=0;4>we;++we){var _n,On=Jr[0+we];for(_n=0;4>_n;++_n){On=qd[Ge[Tr+_n]][On];for(var Kn=Gd[de(rr,On[0])];0<Kn;)Kn=Gd[2*Kn+de(rr,On[Kn])];On=-Kn,Ge[Tr+_n]=On}n(pn,Yn,Ge,Tr,4),Yn+=4,Jr[0+we]=On}}else On=de(rr,156)?de(rr,128)?1:3:de(rr,163)?2:0,Pr.Ob[0]=On,i(Ge,Tr,On,4),i(Jr,0,On,4);Pr.Dd=de(rr,142)?de(rr,114)?de(rr,183)?1:3:2:0}if(je.m.Ka)return Nn(_e,7,"Premature end-of-partition0 encountered.");for(;_e.ja<_e.za;++_e.ja){if(je=Ae,rr=(fe=_e).rb[fe.sb-1],Ge=fe.rb[fe.sb+fe.ja],Ne=fe.ya[fe.aa+fe.ja],Tr=fe.kc?Ne.Ad:0)rr.la=Ge.la=0,Ne.Za||(rr.Na=Ge.Na=0),Ne.Hc=0,Ne.Gc=0,Ne.ia=0;else{var tn,jr;if(rr=Ge,Ge=je,Tr=fe.Pa.Xc,Jr=fe.ya[fe.aa+fe.ja],Pr=fe.pb[Jr.$b],we=Jr.ad,pn=0,Yn=fe.rb[fe.sb-1],On=_n=0,i(we,pn,0,384),Jr.Za)var Yi=0,Bs=Tr[3];else{Kn=s(16);var Mi=rr.Na+Yn.Na;if(Mi=cl(Ge,Tr[1],Mi,Pr.Eb,0,Kn,0),rr.Na=Yn.Na=(0<Mi)+0,1<Mi)za(Kn,0,we,pn);else{var io=Kn[0]+3>>3;for(Kn=0;256>Kn;Kn+=16)we[pn+Kn]=io}Yi=1,Bs=Tr[0]}var Wn=15&rr.la,Ji=15&Yn.la;for(Kn=0;4>Kn;++Kn){var Cs=1&Ji;for(io=jr=0;4>io;++io)Wn=Wn>>1|(Cs=(Mi=cl(Ge,Bs,Mi=Cs+(1&Wn),Pr.Sc,Yi,we,pn))>Yi)<<7,jr=jr<<2|(3<Mi?3:1<Mi?2:we[pn+0]!=0),pn+=16;Wn>>=4,Ji=Ji>>1|Cs<<7,_n=(_n<<8|jr)>>>0}for(Bs=Wn,Yi=Ji>>4,tn=0;4>tn;tn+=2){for(jr=0,Wn=rr.la>>4+tn,Ji=Yn.la>>4+tn,Kn=0;2>Kn;++Kn){for(Cs=1&Ji,io=0;2>io;++io)Mi=Cs+(1&Wn),Wn=Wn>>1|(Cs=0<(Mi=cl(Ge,Tr[2],Mi,Pr.Qc,0,we,pn)))<<3,jr=jr<<2|(3<Mi?3:1<Mi?2:we[pn+0]!=0),pn+=16;Wn>>=2,Ji=Ji>>1|Cs<<5}On|=jr<<4*tn,Bs|=Wn<<4<<tn,Yi|=(240&Ji)<<tn}rr.la=Bs,Yn.la=Yi,Jr.Hc=_n,Jr.Gc=On,Jr.ia=43690&On?0:Pr.ia,Tr=!(_n|On)}if(0<fe.L&&(fe.wa[fe.Y+fe.ja]=fe.gd[Ne.$b][Ne.Za],fe.wa[fe.Y+fe.ja].La|=!Tr),je.Ka)return Nn(_e,7,"Premature end-of-file encountered.")}if(fa(_e),fe=Ze,je=1,Ne=(Ae=_e).D,rr=0<Ae.L&&Ae.M>=Ae.zb&&Ae.M<=Ae.Va,Ae.Aa==0)t:{if(Ne.M=Ae.M,Ne.uc=rr,au(Ae,Ne),je=1,Ne=(jr=Ae.D).Nb,rr=(On=Yh[Ae.L])*Ae.R,Ge=On/2*Ae.B,Kn=16*Ne*Ae.R,io=8*Ne*Ae.B,Tr=Ae.sa,Jr=Ae.ta-rr+Kn,Pr=Ae.qa,we=Ae.ra-Ge+io,pn=Ae.Ha,Yn=Ae.Ia-Ge+io,Ji=(Wn=jr.M)==0,_n=Wn>=Ae.Va-1,Ae.Aa==2&&au(Ae,jr),jr.uc)for(Cs=(Mi=Ae).D.M,t(Mi.D.uc),jr=Mi.yb;jr<Mi.Hb;++jr){Yi=jr,Bs=Cs;var qi=(os=(Li=Mi).D).Nb;tn=Li.R;var os=os.wa[os.Y+Yi],us=Li.sa,No=Li.ta+16*qi*tn+16*Yi,mo=os.dd,Fi=os.tc;if(Fi!=0)if(t(3<=Fi),Li.L==1)0<Yi&&yn(us,No,tn,Fi+4),os.La&&va(us,No,tn,Fi),0<Bs&&Ol(us,No,tn,Fi+4),os.La&&Ac(us,No,tn,Fi);else{var Ha=Li.B,Al=Li.qa,Jo=Li.ra+8*qi*Ha+8*Yi,dl=Li.Ha,Li=Li.Ia+8*qi*Ha+8*Yi;qi=os.ld,0<Yi&&(Au(us,No,tn,Fi+4,mo,qi),ll(Al,Jo,dl,Li,Ha,Fi+4,mo,qi)),os.La&&(Xo(us,No,tn,Fi,mo,qi),du(Al,Jo,dl,Li,Ha,Fi,mo,qi)),0<Bs&&(Ll(us,No,tn,Fi+4,mo,qi),Rl(Al,Jo,dl,Li,Ha,Fi+4,mo,qi)),os.La&&(hc(us,No,tn,Fi,mo,qi),_a(Al,Jo,dl,Li,Ha,Fi,mo,qi))}}if(Ae.ia&&alert("todo:DitherRow"),fe.put!=null){if(jr=16*Wn,Wn=16*(Wn+1),Ji?(fe.y=Ae.sa,fe.O=Ae.ta+Kn,fe.f=Ae.qa,fe.N=Ae.ra+io,fe.ea=Ae.Ha,fe.W=Ae.Ia+io):(jr-=On,fe.y=Tr,fe.O=Jr,fe.f=Pr,fe.N=we,fe.ea=pn,fe.W=Yn),_n||(Wn-=On),Wn>fe.o&&(Wn=fe.o),fe.F=null,fe.J=null,Ae.Fa!=null&&0<Ae.Fa.length&&jr<Wn&&(fe.J=Pl(Ae,fe,jr,Wn-jr),fe.F=Ae.mb,fe.F==null&&fe.F.length==0)){je=Nn(Ae,3,"Could not decode alpha data.");break t}jr<fe.j&&(On=fe.j-jr,jr=fe.j,t(!(1&On)),fe.O+=Ae.R*On,fe.N+=Ae.B*(On>>1),fe.W+=Ae.B*(On>>1),fe.F!=null&&(fe.J+=fe.width*On)),jr<Wn&&(fe.O+=fe.v,fe.N+=fe.v>>1,fe.W+=fe.v>>1,fe.F!=null&&(fe.J+=fe.v),fe.ka=jr-fe.j,fe.U=fe.va-fe.v,fe.T=Wn-jr,je=fe.put(fe))}Ne+1!=Ae.Ic||_n||(n(Ae.sa,Ae.ta-rr,Tr,Jr+16*Ae.R,rr),n(Ae.qa,Ae.ra-Ge,Pr,we+8*Ae.B,Ge),n(Ae.Ha,Ae.Ia-Ge,pn,Yn+8*Ae.B,Ge))}if(!je)return Nn(_e,6,"Output aborted.")}return 1}(T,M)),M.bc!=null&&M.bc(M),H&=1}return H?(T.cb=0,H):0}function Vi(T,M,H,W,ut){ut=T[M+H+32*W]+(ut>>3),T[M+H+32*W]=-256&ut?0>ut?0:255:ut}function Ns(T,M,H,W,ut,mt){Vi(T,M,0,H,W+ut),Vi(T,M,1,H,W+mt),Vi(T,M,2,H,W-mt),Vi(T,M,3,H,W-ut)}function Bi(T){return(20091*T>>16)+T}function on(T,M,H,W){var ut,mt=0,_t=s(16);for(ut=0;4>ut;++ut){var xt=T[M+0]+T[M+8],St=T[M+0]-T[M+8],Ut=(35468*T[M+4]>>16)-Bi(T[M+12]),ue=Bi(T[M+4])+(35468*T[M+12]>>16);_t[mt+0]=xt+ue,_t[mt+1]=St+Ut,_t[mt+2]=St-Ut,_t[mt+3]=xt-ue,mt+=4,M++}for(ut=mt=0;4>ut;++ut)xt=(T=_t[mt+0]+4)+_t[mt+8],St=T-_t[mt+8],Ut=(35468*_t[mt+4]>>16)-Bi(_t[mt+12]),Vi(H,W,0,0,xt+(ue=Bi(_t[mt+4])+(35468*_t[mt+12]>>16))),Vi(H,W,1,0,St+Ut),Vi(H,W,2,0,St-Ut),Vi(H,W,3,0,xt-ue),mt++,W+=32}function ks(T,M,H,W){var ut=T[M+0]+4,mt=35468*T[M+4]>>16,_t=Bi(T[M+4]),xt=35468*T[M+1]>>16;Ns(H,W,0,ut+_t,T=Bi(T[M+1]),xt),Ns(H,W,1,ut+mt,T,xt),Ns(H,W,2,ut-mt,T,xt),Ns(H,W,3,ut-_t,T,xt)}function cn(T,M,H,W,ut){on(T,M,H,W),ut&&on(T,M+16,H,W+4)}function Tl(T,M,H,W){is(T,M+0,H,W,1),is(T,M+32,H,W+128,1)}function Ku(T,M,H,W){var ut;for(T=T[M+0]+4,ut=0;4>ut;++ut)for(M=0;4>M;++M)Vi(H,W,M,ut,T)}function bt(T,M,H,W){T[M+0]&&js(T,M+0,H,W),T[M+16]&&js(T,M+16,H,W+4),T[M+32]&&js(T,M+32,H,W+128),T[M+48]&&js(T,M+48,H,W+128+4)}function It(T,M,H,W){var ut,mt=s(16);for(ut=0;4>ut;++ut){var _t=T[M+0+ut]+T[M+12+ut],xt=T[M+4+ut]+T[M+8+ut],St=T[M+4+ut]-T[M+8+ut],Ut=T[M+0+ut]-T[M+12+ut];mt[0+ut]=_t+xt,mt[8+ut]=_t-xt,mt[4+ut]=Ut+St,mt[12+ut]=Ut-St}for(ut=0;4>ut;++ut)_t=(T=mt[0+4*ut]+3)+mt[3+4*ut],xt=mt[1+4*ut]+mt[2+4*ut],St=mt[1+4*ut]-mt[2+4*ut],Ut=T-mt[3+4*ut],H[W+0]=_t+xt>>3,H[W+16]=Ut+St>>3,H[W+32]=_t-xt>>3,H[W+48]=Ut-St>>3,W+=64}function jt(T,M,H){var W,ut=M-32,mt=Do,_t=255-T[ut-1];for(W=0;W<H;++W){var xt,St=mt,Ut=_t+T[M-1];for(xt=0;xt<H;++xt)T[M+xt]=St[Ut+T[ut+xt]];M+=32}}function xe(T,M){jt(T,M,4)}function ar(T,M){jt(T,M,8)}function Cr(T,M){jt(T,M,16)}function Gr(T,M){var H;for(H=0;16>H;++H)n(T,M+32*H,T,M-32,16)}function Bn(T,M){var H;for(H=16;0<H;--H)i(T,M,T[M-1],16),M+=32}function yi(T,M,H){var W;for(W=0;16>W;++W)i(M,H+32*W,T,16)}function _i(T,M){var H,W=16;for(H=0;16>H;++H)W+=T[M-1+32*H]+T[M+H-32];yi(W>>5,T,M)}function nn(T,M){var H,W=8;for(H=0;16>H;++H)W+=T[M-1+32*H];yi(W>>4,T,M)}function Xc(T,M){var H,W=8;for(H=0;16>H;++H)W+=T[M+H-32];yi(W>>4,T,M)}function Ko(T,M){yi(128,T,M)}function en(T,M,H){return T+2*M+H+2>>2}function Lo(T,M){var H,W=M-32;for(W=new Uint8Array([en(T[W-1],T[W+0],T[W+1]),en(T[W+0],T[W+1],T[W+2]),en(T[W+1],T[W+2],T[W+3]),en(T[W+2],T[W+3],T[W+4])]),H=0;4>H;++H)n(T,M+32*H,W,0,W.length)}function Nh(T,M){var H=T[M-1],W=T[M-1+32],ut=T[M-1+64],mt=T[M-1+96];qe(T,M+0,16843009*en(T[M-1-32],H,W)),qe(T,M+32,16843009*en(H,W,ut)),qe(T,M+64,16843009*en(W,ut,mt)),qe(T,M+96,16843009*en(ut,mt,mt))}function bs(T,M){var H,W=4;for(H=0;4>H;++H)W+=T[M+H-32]+T[M-1+32*H];for(W>>=3,H=0;4>H;++H)i(T,M+32*H,W,4)}function Zc(T,M){var H=T[M-1+0],W=T[M-1+32],ut=T[M-1+64],mt=T[M-1-32],_t=T[M+0-32],xt=T[M+1-32],St=T[M+2-32],Ut=T[M+3-32];T[M+0+96]=en(W,ut,T[M-1+96]),T[M+1+96]=T[M+0+64]=en(H,W,ut),T[M+2+96]=T[M+1+64]=T[M+0+32]=en(mt,H,W),T[M+3+96]=T[M+2+64]=T[M+1+32]=T[M+0+0]=en(_t,mt,H),T[M+3+64]=T[M+2+32]=T[M+1+0]=en(xt,_t,mt),T[M+3+32]=T[M+2+0]=en(St,xt,_t),T[M+3+0]=en(Ut,St,xt)}function ii(T,M){var H=T[M+1-32],W=T[M+2-32],ut=T[M+3-32],mt=T[M+4-32],_t=T[M+5-32],xt=T[M+6-32],St=T[M+7-32];T[M+0+0]=en(T[M+0-32],H,W),T[M+1+0]=T[M+0+32]=en(H,W,ut),T[M+2+0]=T[M+1+32]=T[M+0+64]=en(W,ut,mt),T[M+3+0]=T[M+2+32]=T[M+1+64]=T[M+0+96]=en(ut,mt,_t),T[M+3+32]=T[M+2+64]=T[M+1+96]=en(mt,_t,xt),T[M+3+64]=T[M+2+96]=en(_t,xt,St),T[M+3+96]=en(xt,St,St)}function Ua(T,M){var H=T[M-1+0],W=T[M-1+32],ut=T[M-1+64],mt=T[M-1-32],_t=T[M+0-32],xt=T[M+1-32],St=T[M+2-32],Ut=T[M+3-32];T[M+0+0]=T[M+1+64]=mt+_t+1>>1,T[M+1+0]=T[M+2+64]=_t+xt+1>>1,T[M+2+0]=T[M+3+64]=xt+St+1>>1,T[M+3+0]=St+Ut+1>>1,T[M+0+96]=en(ut,W,H),T[M+0+64]=en(W,H,mt),T[M+0+32]=T[M+1+96]=en(H,mt,_t),T[M+1+32]=T[M+2+96]=en(mt,_t,xt),T[M+2+32]=T[M+3+96]=en(_t,xt,St),T[M+3+32]=en(xt,St,Ut)}function vn(T,M){var H=T[M+0-32],W=T[M+1-32],ut=T[M+2-32],mt=T[M+3-32],_t=T[M+4-32],xt=T[M+5-32],St=T[M+6-32],Ut=T[M+7-32];T[M+0+0]=H+W+1>>1,T[M+1+0]=T[M+0+64]=W+ut+1>>1,T[M+2+0]=T[M+1+64]=ut+mt+1>>1,T[M+3+0]=T[M+2+64]=mt+_t+1>>1,T[M+0+32]=en(H,W,ut),T[M+1+32]=T[M+0+96]=en(W,ut,mt),T[M+2+32]=T[M+1+96]=en(ut,mt,_t),T[M+3+32]=T[M+2+96]=en(mt,_t,xt),T[M+3+64]=en(_t,xt,St),T[M+3+96]=en(xt,St,Ut)}function ln(T,M){var H=T[M-1+0],W=T[M-1+32],ut=T[M-1+64],mt=T[M-1+96];T[M+0+0]=H+W+1>>1,T[M+2+0]=T[M+0+32]=W+ut+1>>1,T[M+2+32]=T[M+0+64]=ut+mt+1>>1,T[M+1+0]=en(H,W,ut),T[M+3+0]=T[M+1+32]=en(W,ut,mt),T[M+3+32]=T[M+1+64]=en(ut,mt,mt),T[M+3+64]=T[M+2+64]=T[M+0+96]=T[M+1+96]=T[M+2+96]=T[M+3+96]=mt}function Yc(T,M){var H=T[M-1+0],W=T[M-1+32],ut=T[M-1+64],mt=T[M-1+96],_t=T[M-1-32],xt=T[M+0-32],St=T[M+1-32],Ut=T[M+2-32];T[M+0+0]=T[M+2+32]=H+_t+1>>1,T[M+0+32]=T[M+2+64]=W+H+1>>1,T[M+0+64]=T[M+2+96]=ut+W+1>>1,T[M+0+96]=mt+ut+1>>1,T[M+3+0]=en(xt,St,Ut),T[M+2+0]=en(_t,xt,St),T[M+1+0]=T[M+3+32]=en(H,_t,xt),T[M+1+32]=T[M+3+64]=en(W,H,_t),T[M+1+64]=T[M+3+96]=en(ut,W,H),T[M+1+96]=en(mt,ut,W)}function Sn(T,M){var H;for(H=0;8>H;++H)n(T,M+32*H,T,M-32,8)}function sl(T,M){var H;for(H=0;8>H;++H)i(T,M,T[M-1],8),M+=32}function Qs(T,M,H){var W;for(W=0;8>W;++W)i(M,H+32*W,T,8)}function pa(T,M){var H,W=8;for(H=0;8>H;++H)W+=T[M+H-32]+T[M-1+32*H];Qs(W>>4,T,M)}function Jc(T,M){var H,W=4;for(H=0;8>H;++H)W+=T[M+H-32];Qs(W>>3,T,M)}function Da(T,M){var H,W=4;for(H=0;8>H;++H)W+=T[M-1+32*H];Qs(W>>3,T,M)}function Na(T,M){Qs(128,T,M)}function tu(T,M,H){var W=T[M-H],ut=T[M+0],mt=3*(ut-W)+fc[1020+T[M-2*H]-T[M+H]],_t=pu[112+(mt+4>>3)];T[M-H]=Do[255+W+pu[112+(mt+3>>3)]],T[M+0]=Do[255+ut-_t]}function Wu(T,M,H,W){var ut=T[M+0],mt=T[M+H];return go[255+T[M-2*H]-T[M-H]]>W||go[255+mt-ut]>W}function $u(T,M,H,W){return 4*go[255+T[M-H]-T[M+0]]+go[255+T[M-2*H]-T[M+H]]<=W}function kh(T,M,H,W,ut){var mt=T[M-3*H],_t=T[M-2*H],xt=T[M-H],St=T[M+0],Ut=T[M+H],ue=T[M+2*H],be=T[M+3*H];return 4*go[255+xt-St]+go[255+_t-Ut]>W?0:go[255+T[M-4*H]-mt]<=ut&&go[255+mt-_t]<=ut&&go[255+_t-xt]<=ut&&go[255+be-ue]<=ut&&go[255+ue-Ut]<=ut&&go[255+Ut-St]<=ut}function oc(T,M,H,W){var ut=2*W+1;for(W=0;16>W;++W)$u(T,M+W,H,ut)&&tu(T,M+W,H)}function Pn(T,M,H,W){var ut=2*W+1;for(W=0;16>W;++W)$u(T,M+W*H,1,ut)&&tu(T,M+W*H,1)}function Ro(T,M,H,W){var ut;for(ut=3;0<ut;--ut)oc(T,M+=4*H,H,W)}function Wo(T,M,H,W){var ut;for(ut=3;0<ut;--ut)Pn(T,M+=4,H,W)}function Oo(T,M,H,W,ut,mt,_t,xt){for(mt=2*mt+1;0<ut--;){if(kh(T,M,H,mt,_t))if(Wu(T,M,H,xt))tu(T,M,H);else{var St=T,Ut=M,ue=H,be=St[Ut-2*ue],Se=St[Ut-ue],_e=St[Ut+0],Ze=St[Ut+ue],Ne=St[Ut+2*ue],Ae=27*(je=fc[1020+3*(_e-Se)+fc[1020+be-Ze]])+63>>7,fe=18*je+63>>7,je=9*je+63>>7;St[Ut-3*ue]=Do[255+St[Ut-3*ue]+je],St[Ut-2*ue]=Do[255+be+fe],St[Ut-ue]=Do[255+Se+Ae],St[Ut+0]=Do[255+_e-Ae],St[Ut+ue]=Do[255+Ze-fe],St[Ut+2*ue]=Do[255+Ne-je]}M+=W}}function si(T,M,H,W,ut,mt,_t,xt){for(mt=2*mt+1;0<ut--;){if(kh(T,M,H,mt,_t))if(Wu(T,M,H,xt))tu(T,M,H);else{var St=T,Ut=M,ue=H,be=St[Ut-ue],Se=St[Ut+0],_e=St[Ut+ue],Ze=pu[112+((Ne=3*(Se-be))+4>>3)],Ne=pu[112+(Ne+3>>3)],Ae=Ze+1>>1;St[Ut-2*ue]=Do[255+St[Ut-2*ue]+Ae],St[Ut-ue]=Do[255+be+Ne],St[Ut+0]=Do[255+Se-Ze],St[Ut+ue]=Do[255+_e-Ae]}M+=W}}function eu(T,M,H,W,ut,mt){Oo(T,M,H,1,16,W,ut,mt)}function Uo(T,M,H,W,ut,mt){Oo(T,M,1,H,16,W,ut,mt)}function NA(T,M,H,W,ut,mt){var _t;for(_t=3;0<_t;--_t)si(T,M+=4*H,H,1,16,W,ut,mt)}function Xu(T,M,H,W,ut,mt){var _t;for(_t=3;0<_t;--_t)si(T,M+=4,1,H,16,W,ut,mt)}function Zu(T,M,H,W,ut,mt,_t,xt){Oo(T,M,ut,1,8,mt,_t,xt),Oo(H,W,ut,1,8,mt,_t,xt)}function ru(T,M,H,W,ut,mt,_t,xt){Oo(T,M,1,ut,8,mt,_t,xt),Oo(H,W,1,ut,8,mt,_t,xt)}function Qh(T,M,H,W,ut,mt,_t,xt){si(T,M+4*ut,ut,1,8,mt,_t,xt),si(H,W+4*ut,ut,1,8,mt,_t,xt)}function nu(T,M,H,W,ut,mt,_t,xt){si(T,M+4,1,ut,8,mt,_t,xt),si(H,W+4,1,ut,8,mt,_t,xt)}function ga(){this.ba=new le,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new te,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function zs(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Sl(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Il(){this.ua=0,this.Wa=new Qt,this.vb=new Qt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new yt,this.yc=new ot}function zh(){this.xb=this.a=0,this.l=new Oa,this.ca=new le,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new at,this.Pb=0,this.wd=new at,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Il,this.ab=0,this.gc=a(4,Sl),this.Oc=0}function Hs(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Oa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function iu(T,M,H,W,ut,mt,_t){for(T=T==null?0:T[M+0],M=0;M<_t;++M)ut[mt+M]=T+H[W+M]&255,T=ut[mt+M]}function su(T,M,H,W,ut,mt,_t){var xt;if(T==null)iu(null,null,H,W,ut,mt,_t);else for(xt=0;xt<_t;++xt)ut[mt+xt]=T[M+xt]+H[W+xt]&255}function ma(T,M,H,W,ut,mt,_t){if(T==null)iu(null,null,H,W,ut,mt,_t);else{var xt,St=T[M+0],Ut=St,ue=St;for(xt=0;xt<_t;++xt)Ut=ue+(St=T[M+xt])-Ut,ue=H[W+xt]+(-256&Ut?0>Ut?0:255:Ut)&255,Ut=St,ut[mt+xt]=ue}}function Pl(T,M,H,W){var ut=M.width,mt=M.o;if(t(T!=null&&M!=null),0>H||0>=W||H+W>mt)return null;if(!T.Cc){if(T.ga==null){var _t;if(T.ga=new Hs,(_t=T.ga==null)||(_t=M.width*M.o,t(T.Gb.length==0),T.Gb=s(_t),T.Uc=0,T.Gb==null?_t=0:(T.mb=T.Gb,T.nb=T.Uc,T.rc=null,_t=1),_t=!_t),!_t){_t=T.ga;var xt=T.Fa,St=T.P,Ut=T.qc,ue=T.mb,be=T.nb,Se=St+1,_e=Ut-1,Ze=_t.l;if(t(xt!=null&&ue!=null&&M!=null),Nl[0]=null,Nl[1]=iu,Nl[2]=su,Nl[3]=ma,_t.ca=ue,_t.tb=be,_t.c=M.width,_t.i=M.height,t(0<_t.c&&0<_t.i),1>=Ut)M=0;else if(_t.$a=xt[St+0]>>0&3,_t.Z=xt[St+0]>>2&3,_t.Lc=xt[St+0]>>4&3,St=xt[St+0]>>6&3,0>_t.$a||1<_t.$a||4<=_t.Z||1<_t.Lc||St)M=0;else if(Ze.put=ur,Ze.ac=Yt,Ze.bc=ir,Ze.ma=_t,Ze.width=M.width,Ze.height=M.height,Ze.Da=M.Da,Ze.v=M.v,Ze.va=M.va,Ze.j=M.j,Ze.o=M.o,_t.$a)t:{t(_t.$a==1),M=gn();e:for(;;){if(M==null){M=0;break t}if(t(_t!=null),_t.mc=M,M.c=_t.c,M.i=_t.i,M.l=_t.l,M.l.ma=_t,M.l.width=_t.c,M.l.height=_t.i,M.a=0,Zt(M.m,xt,Se,_e),!Hn(_t.c,_t.i,1,M,null)||(M.ab==1&&M.gc[0].hc==3&&vr(M.s)?(_t.ic=1,xt=M.c*M.i,M.Ta=null,M.Ua=0,M.V=s(xt),M.Ba=0,M.V==null?(M.a=1,M=0):M=1):(_t.ic=0,M=xn(M,_t.c)),!M))break e;M=1;break t}_t.mc=null,M=0}else M=_e>=_t.c*_t.i;_t=!M}if(_t)return null;T.ga.Lc!=1?T.Ga=0:W=mt-H}t(T.ga!=null),t(H+W<=mt);t:{if(M=(xt=T.ga).c,mt=xt.l.o,xt.$a==0){if(Se=T.rc,_e=T.Vc,Ze=T.Fa,St=T.P+1+H*M,Ut=T.mb,ue=T.nb+H*M,t(St<=T.P+T.qc),xt.Z!=0)for(t(Nl[xt.Z]!=null),_t=0;_t<W;++_t)Nl[xt.Z](Se,_e,Ze,St,Ut,ue,M),Se=Ut,_e=ue,ue+=M,St+=M;else for(_t=0;_t<W;++_t)n(Ut,ue,Ze,St,M),Se=Ut,_e=ue,ue+=M,St+=M;T.rc=Se,T.Vc=_e}else{if(t(xt.mc!=null),M=H+W,t((_t=xt.mc)!=null),t(M<=_t.i),_t.C>=M)M=1;else if(xt.ic||Be(),xt.ic){xt=_t.V,Se=_t.Ba,_e=_t.c;var Ne=_t.i,Ae=(Ze=1,St=_t.$/_e,Ut=_t.$%_e,ue=_t.m,be=_t.s,_t.$),fe=_e*Ne,je=_e*M,rr=be.wc,we=Ae<je?Fr(be,Ut,St):null;t(Ae<=fe),t(M<=Ne),t(vr(be));e:for(;;){for(;!ue.h&&Ae<je;){if(Ut&rr||(we=Fr(be,Ut,St)),t(we!=null),ae(ue),256>(Ne=nr(we.G[0],we.H[0],ue)))xt[Se+Ae]=Ne,++Ae,++Ut>=_e&&(Ut=0,++St<=M&&!(St%16)&&Ai(_t,St));else{if(!(280>Ne)){Ze=0;break e}Ne=Mr(Ne-256,ue);var Ge,Tr=nr(we.G[4],we.H[4],ue);if(ae(ue),!(Ae>=(Tr=Fe(_e,Tr=Mr(Tr,ue)))&&fe-Ae>=Ne)){Ze=0;break e}for(Ge=0;Ge<Ne;++Ge)xt[Se+Ae+Ge]=xt[Se+Ae+Ge-Tr];for(Ae+=Ne,Ut+=Ne;Ut>=_e;)Ut-=_e,++St<=M&&!(St%16)&&Ai(_t,St);Ae<je&&Ut&rr&&(we=Fr(be,Ut,St))}t(ue.h==Rt(ue))}Ai(_t,St>M?M:St);break e}!Ze||ue.h&&Ae<fe?(Ze=0,_t.a=ue.h?5:3):_t.$=Ae,M=Ze}else M=mn(_t,_t.V,_t.Ba,_t.c,_t.i,M,vs);if(!M){W=0;break t}}H+W>=mt&&(T.Cc=1),W=1}if(!W)return null;if(T.Cc&&((W=T.ga)!=null&&(W.mc=null),T.ga=null,0<T.Ga))return alert("todo:WebPDequantizeLevels"),null}return T.nb+H*ut}function D(T,M,H,W,ut,mt){for(;0<ut--;){var _t,xt=T,St=M+(H?1:0),Ut=T,ue=M+(H?0:3);for(_t=0;_t<W;++_t){var be=Ut[ue+4*_t];be!=255&&(be*=32897,xt[St+4*_t+0]=xt[St+4*_t+0]*be>>23,xt[St+4*_t+1]=xt[St+4*_t+1]*be>>23,xt[St+4*_t+2]=xt[St+4*_t+2]*be>>23)}M+=mt}}function ht(T,M,H,W,ut){for(;0<W--;){var mt;for(mt=0;mt<H;++mt){var _t=T[M+2*mt+0],xt=15&(Ut=T[M+2*mt+1]),St=4369*xt,Ut=(240&Ut|Ut>>4)*St>>16;T[M+2*mt+0]=(240&_t|_t>>4)*St>>16&240|(15&_t|_t<<4)*St>>16>>4&15,T[M+2*mt+1]=240&Ut|xt}M+=ut}}function zt(T,M,H,W,ut,mt,_t,xt){var St,Ut,ue=255;for(Ut=0;Ut<ut;++Ut){for(St=0;St<W;++St){var be=T[M+St];mt[_t+4*St]=be,ue&=be}M+=H,_t+=xt}return ue!=255}function ie(T,M,H,W,ut){var mt;for(mt=0;mt<ut;++mt)H[W+mt]=T[M+mt]>>8}function Be(){Zo=D,Zn=ht,ui=zt,Zi=ie}function Qe(T,M,H){nt[T]=function(W,ut,mt,_t,xt,St,Ut,ue,be,Se,_e,Ze,Ne,Ae,fe,je,rr){var we,Ge=rr-1>>1,Tr=xt[St+0]|Ut[ue+0]<<16,Jr=be[Se+0]|_e[Ze+0]<<16;t(W!=null);var Pr=3*Tr+Jr+131074>>2;for(M(W[ut+0],255&Pr,Pr>>16,Ne,Ae),mt!=null&&(Pr=3*Jr+Tr+131074>>2,M(mt[_t+0],255&Pr,Pr>>16,fe,je)),we=1;we<=Ge;++we){var pn=xt[St+we]|Ut[ue+we]<<16,Yn=be[Se+we]|_e[Ze+we]<<16,_n=Tr+pn+Jr+Yn+524296,On=_n+2*(pn+Jr)>>3;Pr=On+Tr>>1,Tr=(_n=_n+2*(Tr+Yn)>>3)+pn>>1,M(W[ut+2*we-1],255&Pr,Pr>>16,Ne,Ae+(2*we-1)*H),M(W[ut+2*we-0],255&Tr,Tr>>16,Ne,Ae+(2*we-0)*H),mt!=null&&(Pr=_n+Jr>>1,Tr=On+Yn>>1,M(mt[_t+2*we-1],255&Pr,Pr>>16,fe,je+(2*we-1)*H),M(mt[_t+2*we+0],255&Tr,Tr>>16,fe,je+(2*we+0)*H)),Tr=pn,Jr=Yn}1&rr||(Pr=3*Tr+Jr+131074>>2,M(W[ut+rr-1],255&Pr,Pr>>16,Ne,Ae+(rr-1)*H),mt!=null&&(Pr=3*Jr+Tr+131074>>2,M(mt[_t+rr-1],255&Pr,Pr>>16,fe,je+(rr-1)*H)))}}function hr(){Yo[gu]=$h,Yo[eh]=no,Yo[Ap]=ih,Yo[mu]=Di,Yo[Vh]=vu,Yo[zA]=wa,Yo[Gh]=sh,Yo[rh]=no,Yo[jh]=Di,Yo[nh]=vu,Yo[yu]=wa}function Rr(T){return T&-16384?0>T?0:255:T>>pp}function $r(T,M){return Rr((19077*T>>8)+(26149*M>>8)-14234)}function fn(T,M,H){return Rr((19077*T>>8)-(6419*M>>8)-(13320*H>>8)+8708)}function An(T,M){return Rr((19077*T>>8)+(33050*M>>8)-17685)}function Rn(T,M,H,W,ut){W[ut+0]=$r(T,H),W[ut+1]=fn(T,M,H),W[ut+2]=An(T,M)}function Ci(T,M,H,W,ut){W[ut+0]=An(T,M),W[ut+1]=fn(T,M,H),W[ut+2]=$r(T,H)}function ci(T,M,H,W,ut){var mt=fn(T,M,H);M=mt<<3&224|An(T,M)>>3,W[ut+0]=248&$r(T,H)|mt>>5,W[ut+1]=M}function Xi(T,M,H,W,ut){var mt=240&An(T,M)|15;W[ut+0]=240&$r(T,H)|fn(T,M,H)>>4,W[ut+1]=mt}function Vs(T,M,H,W,ut){W[ut+0]=255,Rn(T,M,H,W,ut+1)}function Gi(T,M,H,W,ut){Ci(T,M,H,W,ut),W[ut+3]=255}function $o(T,M,H,W,ut){Rn(T,M,H,W,ut),W[ut+3]=255}function fo(T,M){return 0>T?0:T>M?M:T}function ol(T,M,H){nt[T]=function(W,ut,mt,_t,xt,St,Ut,ue,be){for(var Se=ue+(-2&be)*H;ue!=Se;)M(W[ut+0],mt[_t+0],xt[St+0],Ut,ue),M(W[ut+1],mt[_t+0],xt[St+0],Ut,ue+H),ut+=2,++_t,++St,ue+=2*H;1&be&&M(W[ut+0],mt[_t+0],xt[St+0],Ut,ue)}}function kA(T,M,H){return H==0?T==0?M==0?6:5:M==0?4:0:H}function ou(T,M,H,W,ut){switch(T>>>30){case 3:is(M,H,W,ut,0);break;case 2:ji(M,H,W,ut);break;case 1:js(M,H,W,ut)}}function au(T,M){var H,W,ut=M.M,mt=M.Nb,_t=T.oc,xt=T.pc+40,St=T.oc,Ut=T.pc+584,ue=T.oc,be=T.pc+600;for(H=0;16>H;++H)_t[xt+32*H-1]=129;for(H=0;8>H;++H)St[Ut+32*H-1]=129,ue[be+32*H-1]=129;for(0<ut?_t[xt-1-32]=St[Ut-1-32]=ue[be-1-32]=129:(i(_t,xt-32-1,127,21),i(St,Ut-32-1,127,9),i(ue,be-32-1,127,9)),W=0;W<T.za;++W){var Se=M.ya[M.aa+W];if(0<W){for(H=-1;16>H;++H)n(_t,xt+32*H-4,_t,xt+32*H+12,4);for(H=-1;8>H;++H)n(St,Ut+32*H-4,St,Ut+32*H+4,4),n(ue,be+32*H-4,ue,be+32*H+4,4)}var _e=T.Gd,Ze=T.Hd+W,Ne=Se.ad,Ae=Se.Hc;if(0<ut&&(n(_t,xt-32,_e[Ze].y,0,16),n(St,Ut-32,_e[Ze].f,0,8),n(ue,be-32,_e[Ze].ea,0,8)),Se.Za){var fe=_t,je=xt-32+16;for(0<ut&&(W>=T.za-1?i(fe,je,_e[Ze].y[15],4):n(fe,je,_e[Ze+1].y,0,4)),H=0;4>H;H++)fe[je+128+H]=fe[je+256+H]=fe[je+384+H]=fe[je+0+H];for(H=0;16>H;++H,Ae<<=2)fe=_t,je=xt+Ql[H],ro[Se.Ob[H]](fe,je),ou(Ae,Ne,16*+H,fe,je)}else if(fe=kA(W,ut,Se.Ob[0]),ul[fe](_t,xt),Ae!=0)for(H=0;16>H;++H,Ae<<=2)ou(Ae,Ne,16*+H,_t,xt+Ql[H]);for(H=Se.Gc,fe=kA(W,ut,Se.Dd),hl[fe](St,Ut),hl[fe](ue,be),Ae=Ne,fe=St,je=Ut,255&(Se=H>>0)&&(170&Se?th(Ae,256,fe,je):xs(Ae,256,fe,je)),Se=ue,Ae=be,255&(H>>=8)&&(170&H?th(Ne,320,Se,Ae):xs(Ne,320,Se,Ae)),ut<T.Ub-1&&(n(_e[Ze].y,0,_t,xt+480,16),n(_e[Ze].f,0,St,Ut+224,8),n(_e[Ze].ea,0,ue,be+224,8)),H=8*mt*T.B,_e=T.sa,Ze=T.ta+16*W+16*mt*T.R,Ne=T.qa,Se=T.ra+8*W+H,Ae=T.Ha,fe=T.Ia+8*W+H,H=0;16>H;++H)n(_e,Ze+H*T.R,_t,xt+32*H,16);for(H=0;8>H;++H)n(Ne,Se+H*T.B,St,Ut+32*H,8),n(Ae,fe+H*T.B,ue,be+32*H,8)}}function lu(T,M,H,W,ut,mt,_t,xt,St){var Ut=[0],ue=[0],be=0,Se=St!=null?St.kd:0,_e=St??new zs;if(T==null||12>H)return 7;_e.data=T,_e.w=M,_e.ha=H,M=[M],H=[H],_e.gb=[_e.gb];t:{var Ze=M,Ne=H,Ae=_e.gb;if(t(T!=null),t(Ne!=null),t(Ae!=null),Ae[0]=0,12<=Ne[0]&&!e(T,Ze[0],"RIFF")){if(e(T,Ze[0]+8,"WEBP")){Ae=3;break t}var fe=or(T,Ze[0]+4);if(12>fe||4294967286<fe){Ae=3;break t}if(Se&&fe>Ne[0]-8){Ae=7;break t}Ae[0]=fe,Ze[0]+=12,Ne[0]-=12}Ae=0}if(Ae!=0)return Ae;for(fe=0<_e.gb[0],H=H[0];;){t:{var je=T;Ne=M,Ae=H;var rr=Ut,we=ue,Ge=Ze=[0];if((Pr=be=[be])[0]=0,8>Ae[0])Ae=7;else{if(!e(je,Ne[0],"VP8X")){if(or(je,Ne[0]+4)!=10){Ae=3;break t}if(18>Ae[0]){Ae=7;break t}var Tr=or(je,Ne[0]+8),Jr=1+Je(je,Ne[0]+12);if(2147483648<=Jr*(je=1+Je(je,Ne[0]+15))){Ae=3;break t}Ge!=null&&(Ge[0]=Tr),rr!=null&&(rr[0]=Jr),we!=null&&(we[0]=je),Ne[0]+=18,Ae[0]-=18,Pr[0]=1}Ae=0}}if(be=be[0],Ze=Ze[0],Ae!=0)return Ae;if(Ne=!!(2&Ze),!fe&&be)return 3;if(mt!=null&&(mt[0]=!!(16&Ze)),_t!=null&&(_t[0]=Ne),xt!=null&&(xt[0]=0),_t=Ut[0],Ze=ue[0],be&&Ne&&St==null){Ae=0;break}if(4>H){Ae=7;break}if(fe&&be||!fe&&!be&&!e(T,M[0],"ALPH")){H=[H],_e.na=[_e.na],_e.P=[_e.P],_e.Sa=[_e.Sa];t:{Tr=T,Ae=M,fe=H;var Pr=_e.gb;rr=_e.na,we=_e.P,Ge=_e.Sa,Jr=22,t(Tr!=null),t(fe!=null),je=Ae[0];var pn=fe[0];for(t(rr!=null),t(Ge!=null),rr[0]=null,we[0]=null,Ge[0]=0;;){if(Ae[0]=je,fe[0]=pn,8>pn){Ae=7;break t}var Yn=or(Tr,je+4);if(4294967286<Yn){Ae=3;break t}var _n=8+Yn+1&-2;if(Jr+=_n,0<Pr&&Jr>Pr){Ae=3;break t}if(!e(Tr,je,"VP8 ")||!e(Tr,je,"VP8L")){Ae=0;break t}if(pn[0]<_n){Ae=7;break t}e(Tr,je,"ALPH")||(rr[0]=Tr,we[0]=je+8,Ge[0]=Yn),je+=_n,pn-=_n}}if(H=H[0],_e.na=_e.na[0],_e.P=_e.P[0],_e.Sa=_e.Sa[0],Ae!=0)break}H=[H],_e.Ja=[_e.Ja],_e.xa=[_e.xa];t:if(Pr=T,Ae=M,fe=H,rr=_e.gb[0],we=_e.Ja,Ge=_e.xa,Tr=Ae[0],je=!e(Pr,Tr,"VP8 "),Jr=!e(Pr,Tr,"VP8L"),t(Pr!=null),t(fe!=null),t(we!=null),t(Ge!=null),8>fe[0])Ae=7;else{if(je||Jr){if(Pr=or(Pr,Tr+4),12<=rr&&Pr>rr-12){Ae=3;break t}if(Se&&Pr>fe[0]-8){Ae=7;break t}we[0]=Pr,Ae[0]+=8,fe[0]-=8,Ge[0]=Jr}else Ge[0]=5<=fe[0]&&Pr[Tr+0]==47&&!(Pr[Tr+4]>>5),we[0]=fe[0];Ae=0}if(H=H[0],_e.Ja=_e.Ja[0],_e.xa=_e.xa[0],M=M[0],Ae!=0)break;if(4294967286<_e.Ja)return 3;if(xt==null||Ne||(xt[0]=_e.xa?2:1),_t=[_t],Ze=[Ze],_e.xa){if(5>H){Ae=7;break}xt=_t,Se=Ze,Ne=mt,T==null||5>H?T=0:5<=H&&T[M+0]==47&&!(T[M+4]>>5)?(fe=[0],Pr=[0],rr=[0],Zt(we=new at,T,M,H),tr(we,fe,Pr,rr)?(xt!=null&&(xt[0]=fe[0]),Se!=null&&(Se[0]=Pr[0]),Ne!=null&&(Ne[0]=rr[0]),T=1):T=0):T=0}else{if(10>H){Ae=7;break}xt=Ze,T==null||10>H||!nl(T,M+3,H-3)?T=0:(Se=T[M+0]|T[M+1]<<8|T[M+2]<<16,Ne=16383&(T[M+7]<<8|T[M+6]),T=16383&(T[M+9]<<8|T[M+8]),1&Se||3<(Se>>1&7)||!(Se>>4&1)||Se>>5>=_e.Ja||!Ne||!T?T=0:(_t&&(_t[0]=Ne),xt&&(xt[0]=T),T=1))}if(!T||(_t=_t[0],Ze=Ze[0],be&&(Ut[0]!=_t||ue[0]!=Ze)))return 3;St!=null&&(St[0]=_e,St.offset=M-St.w,t(4294967286>M-St.w),t(St.offset==St.ha-H));break}return Ae==0||Ae==7&&be&&St==null?(mt!=null&&(mt[0]|=_e.na!=null&&0<_e.na.length),W!=null&&(W[0]=_t),ut!=null&&(ut[0]=Ze),0):Ae}function cu(T,M,H){var W=M.width,ut=M.height,mt=0,_t=0,xt=W,St=ut;if(M.Da=T!=null&&0<T.Da,M.Da&&(xt=T.cd,St=T.bd,mt=T.v,_t=T.j,11>H||(mt&=-2,_t&=-2),0>mt||0>_t||0>=xt||0>=St||mt+xt>W||_t+St>ut))return 0;if(M.v=mt,M.j=_t,M.va=mt+xt,M.o=_t+St,M.U=xt,M.T=St,M.da=T!=null&&0<T.da,M.da){if(!Ur(xt,St,H=[T.ib],mt=[T.hb]))return 0;M.ib=H[0],M.hb=mt[0]}return M.ob=T!=null&&T.ob,M.Kb=T==null||!T.Sd,M.da&&(M.ob=M.ib<3*W/4&&M.hb<3*ut/4,M.Kb=0),1}function uu(T){if(T==null)return 2;if(11>T.S){var M=T.f.RGBA;M.fb+=(T.height-1)*M.A,M.A=-M.A}else M=T.f.kb,T=T.height,M.O+=(T-1)*M.fa,M.fa=-M.fa,M.N+=(T-1>>1)*M.Ab,M.Ab=-M.Ab,M.W+=(T-1>>1)*M.Db,M.Db=-M.Db,M.F!=null&&(M.J+=(T-1)*M.lb,M.lb=-M.lb);return 0}function al(T,M,H,W){if(W==null||0>=T||0>=M)return 2;if(H!=null){if(H.Da){var ut=H.cd,mt=H.bd,_t=-2&H.v,xt=-2&H.j;if(0>_t||0>xt||0>=ut||0>=mt||_t+ut>T||xt+mt>M)return 2;T=ut,M=mt}if(H.da){if(!Ur(T,M,ut=[H.ib],mt=[H.hb]))return 2;T=ut[0],M=mt[0]}}W.width=T,W.height=M;t:{var St=W.width,Ut=W.height;if(T=W.S,0>=St||0>=Ut||!(T>=gu&&13>T))T=2;else{if(0>=W.Rd&&W.sd==null){_t=mt=ut=M=0;var ue=(xt=St*Wd[T])*Ut;if(11>T||(mt=(Ut+1)/2*(M=(St+1)/2),T==12&&(_t=(ut=St)*Ut)),(Ut=s(ue+2*mt+_t))==null){T=1;break t}W.sd=Ut,11>T?((St=W.f.RGBA).eb=Ut,St.fb=0,St.A=xt,St.size=ue):((St=W.f.kb).y=Ut,St.O=0,St.fa=xt,St.Fd=ue,St.f=Ut,St.N=0+ue,St.Ab=M,St.Cd=mt,St.ea=Ut,St.W=0+ue+mt,St.Db=M,St.Ed=mt,T==12&&(St.F=Ut,St.J=0+ue+2*mt),St.Tc=_t,St.lb=ut)}if(M=1,ut=W.S,mt=W.width,_t=W.height,ut>=gu&&13>ut)if(11>ut)T=W.f.RGBA,M&=(xt=Math.abs(T.A))*(_t-1)+mt<=T.size,M&=xt>=mt*Wd[ut],M&=T.eb!=null;else{T=W.f.kb,xt=(mt+1)/2,ue=(_t+1)/2,St=Math.abs(T.fa),Ut=Math.abs(T.Ab);var be=Math.abs(T.Db),Se=Math.abs(T.lb),_e=Se*(_t-1)+mt;M&=St*(_t-1)+mt<=T.Fd,M&=Ut*(ue-1)+xt<=T.Cd,M=(M&=be*(ue-1)+xt<=T.Ed)&St>=mt&Ut>=xt&be>=xt,M&=T.y!=null,M&=T.f!=null,M&=T.ea!=null,ut==12&&(M&=Se>=mt,M&=_e<=T.Tc,M&=T.F!=null)}else M=0;T=M?0:2}}return T!=0||H!=null&&H.fd&&(T=uu(W)),T}var Ei=64,ac=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],lc=24,Ml=32,Yu=8,eo=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Xe("Predictor0","PredictorAdd0"),nt.Predictor0=function(){return 4278190080},nt.Predictor1=function(T){return T},nt.Predictor2=function(T,M,H){return M[H+0]},nt.Predictor3=function(T,M,H){return M[H+1]},nt.Predictor4=function(T,M,H){return M[H-1]},nt.Predictor5=function(T,M,H){return gr(gr(T,M[H+1]),M[H+0])},nt.Predictor6=function(T,M,H){return gr(T,M[H-1])},nt.Predictor7=function(T,M,H){return gr(T,M[H+0])},nt.Predictor8=function(T,M,H){return gr(M[H-1],M[H+0])},nt.Predictor9=function(T,M,H){return gr(M[H+0],M[H+1])},nt.Predictor10=function(T,M,H){return gr(gr(T,M[H-1]),gr(M[H+0],M[H+1]))},nt.Predictor11=function(T,M,H){var W=M[H+0];return 0>=Br(W>>24&255,T>>24&255,(M=M[H-1])>>24&255)+Br(W>>16&255,T>>16&255,M>>16&255)+Br(W>>8&255,T>>8&255,M>>8&255)+Br(255&W,255&T,255&M)?W:T},nt.Predictor12=function(T,M,H){var W=M[H+0];return(Re((T>>24&255)+(W>>24&255)-((M=M[H-1])>>24&255))<<24|Re((T>>16&255)+(W>>16&255)-(M>>16&255))<<16|Re((T>>8&255)+(W>>8&255)-(M>>8&255))<<8|Re((255&T)+(255&W)-(255&M)))>>>0},nt.Predictor13=function(T,M,H){var W=M[H-1];return(sr((T=gr(T,M[H+0]))>>24&255,W>>24&255)<<24|sr(T>>16&255,W>>16&255)<<16|sr(T>>8&255,W>>8&255)<<8|sr(T>>0&255,W>>0&255))>>>0};var Fl=nt.PredictorAdd0;nt.PredictorAdd1=xr,Xe("Predictor2","PredictorAdd2"),Xe("Predictor3","PredictorAdd3"),Xe("Predictor4","PredictorAdd4"),Xe("Predictor5","PredictorAdd5"),Xe("Predictor6","PredictorAdd6"),Xe("Predictor7","PredictorAdd7"),Xe("Predictor8","PredictorAdd8"),Xe("Predictor9","PredictorAdd9"),Xe("Predictor10","PredictorAdd10"),Xe("Predictor11","PredictorAdd11"),Xe("Predictor12","PredictorAdd12"),Xe("Predictor13","PredictorAdd13");var hu=nt.PredictorAdd2;Vr("ColorIndexInverseTransform","MapARGB","32b",function(T){return T>>8&255},function(T){return T}),Vr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(T){return T},function(T){return T>>8&255});var kn,ya=nt.ColorIndexInverseTransform,Ju=nt.MapARGB,QA=nt.VP8LColorIndexInverseTransformAlpha,Hh=nt.MapAlpha,cc=nt.VP8LPredictorsAdd=[];cc.length=16,(nt.VP8LPredictors=[]).length=16,(nt.VP8LPredictorsAdd_C=[]).length=16,(nt.VP8LPredictors_C=[]).length=16;var uc,Gs,ws,ka,Qa,po,za,is,ji,th,js,xs,Ll,Au,Rl,ll,hc,Xo,_a,du,Ol,yn,Ac,va,Zo,Zn,ui,Zi,ss=s(511),Ul=s(2041),dc=s(225),Dl=s(767),fu=0,fc=Ul,pu=dc,Do=Dl,go=ss,gu=0,eh=1,Ap=2,mu=3,Vh=4,zA=5,Gh=6,rh=7,jh=8,nh=9,yu=10,qh=[2,3,7],zd=[3,3,11],Kh=[280,256,256,256,40],Ti=[0,1,1,1,0],_u=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],ba=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Hd=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Vd=8,HA=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],pc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],cl=null,VA=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Wh=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Gd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],jd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],qd=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],dp=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],gc=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ul=[],ro=[],hl=[],fp=1,Kd=2,Nl=[],Yo=[];Qe("UpsampleRgbLinePair",Rn,3),Qe("UpsampleBgrLinePair",Ci,3),Qe("UpsampleRgbaLinePair",$o,4),Qe("UpsampleBgraLinePair",Gi,4),Qe("UpsampleArgbLinePair",Vs,4),Qe("UpsampleRgba4444LinePair",Xi,2),Qe("UpsampleRgb565LinePair",ci,2);var $h=nt.UpsampleRgbLinePair,ih=nt.UpsampleBgrLinePair,no=nt.UpsampleRgbaLinePair,Di=nt.UpsampleBgraLinePair,vu=nt.UpsampleArgbLinePair,wa=nt.UpsampleRgba4444LinePair,sh=nt.UpsampleRgb565LinePair,GA=16,mc=1<<GA-1,oh=-227,Xh=482,pp=6,yc=0,kl=s(256),Sr=s(256),gp=s(256),bu=s(256),mp=s(Xh-oh),Zh=s(Xh-oh);ol("YuvToRgbRow",Rn,3),ol("YuvToBgrRow",Ci,3),ol("YuvToRgbaRow",$o,4),ol("YuvToBgraRow",Gi,4),ol("YuvToArgbRow",Vs,4),ol("YuvToRgba4444Row",Xi,2),ol("YuvToRgb565Row",ci,2);var Ql=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Yh=[0,2,8],Cn=[8,7,6,4,4,2,2,2,1,1,1,1],ah=1;this.WebPDecodeRGBA=function(T,M,H,W,ut){var mt=eh,_t=new ga,xt=new le;_t.ba=xt,xt.S=mt,xt.width=[xt.width],xt.height=[xt.height];var St=xt.width,Ut=xt.height,ue=new ge;if(ue==null||T==null)var be=2;else t(ue!=null),be=lu(T,M,H,ue.width,ue.height,ue.Pd,ue.Qd,ue.format,null);if(be!=0?St=0:(St!=null&&(St[0]=ue.width[0]),Ut!=null&&(Ut[0]=ue.height[0]),St=1),St){xt.width=xt.width[0],xt.height=xt.height[0],W!=null&&(W[0]=xt.width),ut!=null&&(ut[0]=xt.height);t:{if(W=new Oa,(ut=new zs).data=T,ut.w=M,ut.ha=H,ut.kd=1,M=[0],t(ut!=null),((T=lu(ut.data,ut.w,ut.ha,null,null,null,M,null,ut))==0||T==7)&&M[0]&&(T=4),(M=T)==0){if(t(_t!=null),W.data=ut.data,W.w=ut.w+ut.offset,W.ha=ut.ha-ut.offset,W.put=ur,W.ac=Yt,W.bc=ir,W.ma=_t,ut.xa){if((T=gn())==null){_t=1;break t}if(function(Se,_e){var Ze=[0],Ne=[0],Ae=[0];e:for(;;){if(Se==null)return 0;if(_e==null)return Se.a=2,0;if(Se.l=_e,Se.a=0,Zt(Se.m,_e.data,_e.w,_e.ha),!tr(Se.m,Ze,Ne,Ae)){Se.a=3;break e}if(Se.xb=Kd,_e.width=Ze[0],_e.height=Ne[0],!Hn(Ze[0],Ne[0],1,Se,null))break e;return 1}return t(Se.a!=0),0}(T,W)){if(W=(M=al(W.width,W.height,_t.Oa,_t.ba))==0){e:{W=T;r:for(;;){if(W==null){W=0;break e}if(t(W.s.yc!=null),t(W.s.Ya!=null),t(0<W.s.Wb),t((H=W.l)!=null),t((ut=H.ma)!=null),W.xb!=0){if(W.ca=ut.ba,W.tb=ut.tb,t(W.ca!=null),!cu(ut.Oa,H,mu)){W.a=2;break r}if(!xn(W,H.width)||H.da)break r;if((H.da||pt(W.ca.S))&&Be(),11>W.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),W.ca.f.kb.F!=null&&Be()),W.Pb&&0<W.s.ua&&W.s.vb.X==null&&!mr(W.s.vb,W.s.Wa.Xa)){W.a=1;break r}W.xb=0}if(!mn(W,W.V,W.Ba,W.c,W.i,H.o,Qr))break r;ut.Dc=W.Ma,W=1;break e}t(W.a!=0),W=0}W=!W}W&&(M=T.a)}else M=T.a}else{if((T=new Mo)==null){_t=1;break t}if(T.Fa=ut.na,T.P=ut.P,T.qc=ut.Sa,Fo(T,W)){if((M=al(W.width,W.height,_t.Oa,_t.ba))==0){if(T.Aa=0,H=_t.Oa,t((ut=T)!=null),H!=null){if(0<(St=0>(St=H.Md)?0:100<St?255:255*St/100)){for(Ut=ue=0;4>Ut;++Ut)12>(be=ut.pb[Ut]).lc&&(be.ia=St*Cn[0>be.lc?0:be.lc]>>3),ue|=be.ia;ue&&(alert("todo:VP8InitRandom"),ut.ia=1)}ut.Ga=H.Id,100<ut.Ga?ut.Ga=100:0>ut.Ga&&(ut.Ga=0)}sc(T,W)||(M=T.a)}}else M=T.a}M==0&&_t.Oa!=null&&_t.Oa.fd&&(M=uu(_t.ba))}_t=M}mt=_t!=0?null:11>mt?xt.f.RGBA.eb:xt.f.kb.y}else mt=null;return mt};var Wd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(nt,wt){for(var Ct="",st=0;st<4;st++)Ct+=String.fromCharCode(nt[wt++]);return Ct}function m(nt,wt){return(nt[wt+0]<<0|nt[wt+1]<<8|nt[wt+2]<<16)>>>0}function v(nt,wt){return(nt[wt+0]<<0|nt[wt+1]<<8|nt[wt+2]<<16|nt[wt+3]<<24)>>>0}new d;var C=[0],b=[0],P=[],F=new d,U=r,k=function(nt,wt){var Ct={},st=0,ot=!1,vt=0,yt=0;if(Ct.frames=[],!function(Tt,Rt,Nt,ae){for(var Xt=0;Xt<ae;Xt++)if(Tt[Rt+Xt]!=Nt.charCodeAt(Xt))return!0;return!1}(nt,wt,"RIFF",4)){var re,Wt;for(v(nt,wt+=4),wt+=8;wt<nt.length;){var ee=f(nt,wt),Zt=v(nt,wt+=4);wt+=4;var oe=Zt+(1&Zt);switch(ee){case"VP8 ":case"VP8L":Ct.frames[st]===void 0&&(Ct.frames[st]={}),(at=Ct.frames[st]).src_off=ot?yt:wt-8,at.src_size=vt+Zt+8,st++,ot&&(ot=!1,vt=0,yt=0);break;case"VP8X":(at=Ct.header={}).feature_flags=nt[wt];var pe=wt+4;at.canvas_width=1+m(nt,pe),pe+=3,at.canvas_height=1+m(nt,pe),pe+=3;break;case"ALPH":ot=!0,vt=oe+8,yt=wt-8;break;case"ANIM":(at=Ct.header).bgcolor=v(nt,wt),pe=wt+4,at.loop_count=(re=nt)[(Wt=pe)+0]<<0|re[Wt+1]<<8,pe+=2;break;case"ANMF":var De,at;(at=Ct.frames[st]={}).offset_x=2*m(nt,wt),wt+=3,at.offset_y=2*m(nt,wt),wt+=3,at.width=1+m(nt,wt),wt+=3,at.height=1+m(nt,wt),wt+=3,at.duration=m(nt,wt),wt+=3,De=nt[wt++],at.dispose=1&De,at.blend=De>>1&1}ee!="ANMF"&&(wt+=oe)}return Ct}}(U,0);k.response=U,k.rgbaoutput=!0,k.dataurl=!1;var z=k.header?k.header:null,K=k.frames?k.frames:null;if(z){z.loop_counter=z.loop_count,C=[z.canvas_height],b=[z.canvas_width];for(var G=0;G<K.length&&K[G].blend!=0;G++);}var X=K[0],Y=F.WebPDecodeRGBA(U,X.src_off,X.src_size,b,C);X.rgba=Y,X.imgwidth=b[0],X.imgheight=C[0];for(var it=0;it<b[0]*C[0]*4;it++)P[it]=Y[it];return this.width=b,this.height=C,this.data=P,this}(function(r){var t=function(){return typeof Xw=="function"},e=function(C,b,P,F){var U=4,k=a;switch(F){case r.image_compression.FAST:U=1,k=s;break;case r.image_compression.MEDIUM:U=6,k=o;break;case r.image_compression.SLOW:U=9,k=d}C=n(C,b,P,k);var z=Xw(C,{level:U});return r.__addimage__.arrayBufferToBinaryString(z)},n=function(C,b,P,F){for(var U,k,z,K=C.length/b,G=new Uint8Array(C.length+K),X=m(),Y=0;Y<K;Y+=1){if(z=Y*b,U=C.subarray(z,z+b),F)G.set(F(U,P,k),z+Y);else{for(var it,nt=X.length,wt=[];it<nt;it+=1)wt[it]=X[it](U,P,k);var Ct=v(wt.concat());G.set(wt[Ct],z+Y)}k=U}return G},i=function(C){var b=Array.apply([],C);return b.unshift(0),b},s=function(C,b){var P,F=[],U=C.length;F[0]=1;for(var k=0;k<U;k+=1)P=C[k-b]||0,F[k+1]=C[k]-P+256&255;return F},a=function(C,b,P){var F,U=[],k=C.length;U[0]=2;for(var z=0;z<k;z+=1)F=P&&P[z]||0,U[z+1]=C[z]-F+256&255;return U},o=function(C,b,P){var F,U,k=[],z=C.length;k[0]=3;for(var K=0;K<z;K+=1)F=C[K-b]||0,U=P&&P[K]||0,k[K+1]=C[K]+256-(F+U>>>1)&255;return k},d=function(C,b,P){var F,U,k,z,K=[],G=C.length;K[0]=4;for(var X=0;X<G;X+=1)F=C[X-b]||0,U=P&&P[X]||0,k=P&&P[X-b]||0,z=f(F,U,k),K[X+1]=C[X]-z+256&255;return K},f=function(C,b,P){if(C===b&&b===P)return C;var F=Math.abs(b-P),U=Math.abs(C-P),k=Math.abs(C+b-P-P);return F<=U&&F<=k?C:U<=k?b:P},m=function(){return[i,s,a,o,d]},v=function(C){var b=C.map(function(P){return P.reduce(function(F,U){return F+Math.abs(U)},0)});return b.indexOf(Math.min.apply(null,b))};r.processPNG=function(C,b,P,F){var U,k,z,K,G,X,Y,it,nt,wt,Ct,st,ot,vt,yt,re=this.decode.FLATE_DECODE,Wt="";if(this.__addimage__.isArrayBuffer(C)&&(C=new Uint8Array(C)),this.__addimage__.isArrayBufferView(C)){if(C=(z=new eit(C)).imgData,k=z.bits,U=z.colorSpace,G=z.colors,[4,6].indexOf(z.colorType)!==-1){if(z.bits===8){nt=(it=z.pixelBitlength==32?new Uint32Array(z.decodePixels().buffer):z.pixelBitlength==16?new Uint16Array(z.decodePixels().buffer):new Uint8Array(z.decodePixels().buffer)).length,Ct=new Uint8Array(nt*z.colors),wt=new Uint8Array(nt);var ee,Zt=z.pixelBitlength-z.bits;for(vt=0,yt=0;vt<nt;vt++){for(ot=it[vt],ee=0;ee<Zt;)Ct[yt++]=ot>>>ee&255,ee+=z.bits;wt[vt]=ot>>>ee&255}}if(z.bits===16){nt=(it=new Uint32Array(z.decodePixels().buffer)).length,Ct=new Uint8Array(nt*(32/z.pixelBitlength)*z.colors),wt=new Uint8Array(nt*(32/z.pixelBitlength)),st=z.colors>1,vt=0,yt=0;for(var oe=0;vt<nt;)ot=it[vt++],Ct[yt++]=ot>>>0&255,st&&(Ct[yt++]=ot>>>16&255,ot=it[vt++],Ct[yt++]=ot>>>0&255),wt[oe++]=ot>>>16&255;k=8}F!==r.image_compression.NONE&&t()?(C=e(Ct,z.width*z.colors,z.colors,F),Y=e(wt,z.width,1,F)):(C=Ct,Y=wt,re=void 0)}if(z.colorType===3&&(U=this.color_spaces.INDEXED,X=z.palette,z.transparency.indexed)){var pe=z.transparency.indexed,De=0;for(vt=0,nt=pe.length;vt<nt;++vt)De+=pe[vt];if((De/=255)===nt-1&&pe.indexOf(0)!==-1)K=[pe.indexOf(0)];else if(De!==nt){for(it=z.decodePixels(),wt=new Uint8Array(it.length),vt=0,nt=it.length;vt<nt;vt++)wt[vt]=pe[it[vt]];Y=e(wt,z.width,1)}}var at=function(Tt){var Rt;switch(Tt){case r.image_compression.FAST:Rt=11;break;case r.image_compression.MEDIUM:Rt=13;break;case r.image_compression.SLOW:Rt=14;break;default:Rt=12}return Rt}(F);return re===this.decode.FLATE_DECODE&&(Wt="/Predictor "+at+" "),Wt+="/Colors "+G+" /BitsPerComponent "+k+" /Columns "+z.width,(this.__addimage__.isArrayBuffer(C)||this.__addimage__.isArrayBufferView(C))&&(C=this.__addimage__.arrayBufferToBinaryString(C)),(Y&&this.__addimage__.isArrayBuffer(Y)||this.__addimage__.isArrayBufferView(Y))&&(Y=this.__addimage__.arrayBufferToBinaryString(Y)),{alias:P,data:C,index:b,filter:re,decodeParameters:Wt,transparency:K,palette:X,sMask:Y,predictor:at,width:z.width,height:z.height,bitsPerComponent:k,colorSpace:U}}}})(hn.API),function(r){r.processGIF89A=function(t,e,n,i){var s=new rit(t),a=s.width,o=s.height,d=[];s.decodeAndBlitFrameRGBA(0,d);var f={data:d,width:a,height:o},m=new l2(100).encode(f,100);return r.processJPEG.call(this,m,e,n,i)},r.processGIF87A=r.processGIF89A}(hn.API),Oc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var t=0;t<r;t++){var e=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:n,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Oc.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[r]()}catch(e){Ui.log("bit decode error:"+e)}},Oc.prototype.bit1=function(){var r,t=Math.ceil(this.width/8),e=t%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var d=this.palette[s>>7-o&1];this.data[a+4*o]=d.blue,this.data[a+4*o+1]=d.green,this.data[a+4*o+2]=d.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Oc.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),t=r%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,d=15&s,f=this.palette[o];if(this.data[a]=f.blue,this.data[a+1]=f.green,this.data[a+2]=f.red,this.data[a+3]=255,2*i+1>=this.width)break;f=this.palette[d],this.data[a+4]=f.blue,this.data[a+4+1]=f.green,this.data[a+4+2]=f.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},Oc.prototype.bit8=function(){for(var r=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Oc.prototype.bit15=function(){for(var r=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,d=(s>>10&t)/t*255|0,f=s>>15?255:0,m=n*this.width*4+4*i;this.data[m]=d,this.data[m+1]=o,this.data[m+2]=a,this.data[m+3]=f}this.pos+=r}},Oc.prototype.bit16=function(){for(var r=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,d=(a>>5&e)/e*255|0,f=(a>>11)/t*255|0,m=i*this.width*4+4*s;this.data[m]=f,this.data[m+1]=d,this.data[m+2]=o,this.data[m+3]=255}this.pos+=r}},Oc.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Oc.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Oc.prototype.getData=function(){return this.data},function(r){r.processBMP=function(t,e,n,i){var s=new Oc(t,!1),a=s.width,o=s.height,d={data:s.getData(),width:a,height:o},f=new l2(100).encode(d,100);return r.processJPEG.call(this,f,e,n,i)}}(hn.API),QF.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(t,e,n,i){var s=new QF(t),a=s.width,o=s.height,d={data:s.getData(),width:a,height:o},f=new l2(100).encode(d,100);return r.processJPEG.call(this,f,e,n,i)}}(hn.API),hn.API.processRGBA=function(r,t,e){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,d=0,f=0;f<i;f+=4){var m=n[f],v=n[f+1],C=n[f+2],b=n[f+3];s[o++]=m,s[o++]=v,s[o++]=C,a[d++]=b}var P=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:P,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},hn.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Gf=hn.API,xy=Gf.getCharWidthsArray=function(r,t){var e,n,i=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,d=o.fof?o.fof:1,f=t.kerning?t.kerning:i.metadata.Unicode.kerning,m=f.fof?f.fof:1,v=t.doKerning!==!1,C=0,b=r.length,P=0,F=o[0]||d,U=[];for(e=0;e<b;e++)n=r.charCodeAt(e),typeof i.metadata.widthOfString=="function"?U.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(C=v&&li(f[n])==="object"&&!isNaN(parseInt(f[n][P],10))?f[n][P]/m:0,U.push((o[n]||F)/d+C)),P=n;return U},UF=Gf.getStringUnitWidth=function(r,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return Gf.processArabic&&(r=Gf.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,e,i)/e:xy.apply(this,arguments).reduce(function(s,a){return s+a},0)},DF=function(r,t,e,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;i.push(r.slice(0,s));var d=s;for(o=0;s!==a;)o+t[s]>n&&(i.push(r.slice(d,s)),o=0,d=s),o+=t[s],s++;return d!==s&&i.push(r.slice(d,s)),i},NF=function(r,t,e){e||(e={});var n,i,s,a,o,d,f,m=[],v=[m],C=e.textIndent||0,b=0,P=0,F=r.split(" "),U=xy.apply(this,[" ",e])[0];if(d=e.lineIndent===-1?F[0].length+2:e.lineIndent||0){var k=Array(d).join(" "),z=[];F.map(function(G){(G=G.split(/\s*\n/)).length>1?z=z.concat(G.map(function(X,Y){return(Y&&X.length?`
`:"")+X})):z.push(G[0])}),F=z,d=UF.apply(this,[k,e])}for(s=0,a=F.length;s<a;s++){var K=0;if(n=F[s],d&&n[0]==`
`&&(n=n.substr(1),K=1),C+b+(P=(i=xy.apply(this,[n,e])).reduce(function(G,X){return G+X},0))>t||K){if(P>t){for(o=DF.apply(this,[n,i,t-(C+b),t]),m.push(o.shift()),m=[o.pop()];o.length;)v.push([o.shift()]);P=i.slice(n.length-(m[0]?m[0].length:0)).reduce(function(G,X){return G+X},0)}else m=[n];v.push(m),C=P+d,b=U}else m.push(n),C+=b+P,b=U}return f=d?function(G,X){return(X?k:"")+G.join(" ")}:function(G){return G.join(" ")},v.map(f)},Gf.splitTextToSize=function(r,t,e){var n,i=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(m){if(m.widths&&m.kerning)return{widths:m.widths,kerning:m.kerning};var v=this.internal.getFont(m.fontName,m.fontStyle);return v.metadata.Unicode?{widths:v.metadata.Unicode.widths||{0:1},kerning:v.metadata.Unicode.kerning||{}}:{font:v.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/i;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=e.lineIndent;var o,d,f=[];for(o=0,d=n.length;o<d;o++)f=f.concat(NF.apply(this,[n[o],a,s]));return f},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},n={},i=0;i<t.length;i++)e[t[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=t[i];var s=function(v){return"0x"+parseInt(v,10).toString(16)},a=r.__fontmetrics__.compress=function(v){var C,b,P,F,U=["{"];for(var k in v){if(C=v[k],isNaN(parseInt(k,10))?b="'"+k+"'":(k=parseInt(k,10),b=(b=s(k).slice(2)).slice(0,-1)+n[b.slice(-1)]),typeof C=="number")C<0?(P=s(C).slice(3),F="-"):(P=s(C).slice(2),F=""),P=F+P.slice(0,-1)+n[P.slice(-1)];else{if(li(C)!=="object")throw new Error("Don't know what to do with value type "+li(C)+".");P=a(C)}U.push(b+P)}return U.push("}"),U.join("")},o=r.__fontmetrics__.uncompress=function(v){if(typeof v!="string")throw new Error("Invalid argument passed to uncompress.");for(var C,b,P,F,U={},k=1,z=U,K=[],G="",X="",Y=v.length-1,it=1;it<Y;it+=1)(F=v[it])=="'"?C?(P=C.join(""),C=void 0):C=[]:C?C.push(F):F=="{"?(K.push([z,P]),z={},P=void 0):F=="}"?((b=K.pop())[0][b[1]]=z,P=void 0,z=b[0]):F=="-"?k=-1:P===void 0?e.hasOwnProperty(F)?(G+=e[F],P=parseInt(G,16)*k,k=1,G=""):G+=F:e.hasOwnProperty(F)?(X+=e[F],z[P]=parseInt(X,16)*k,k=1,P=void 0,X=""):X+=F;return U},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},m={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(v){var C=v.font,b=m.Unicode[C.postScriptName];b&&(C.metadata.Unicode={},C.metadata.Unicode.widths=b.widths,C.metadata.Unicode.kerning=b.kerning);var P=f.Unicode[C.postScriptName];P&&(C.metadata.Unicode.encoding=P,C.encoding=P.codePages[0])}])}(hn.API),function(r){var t=function(e){for(var n=e.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=e.charCodeAt(s);return i};r.API.events.push(["addFont",function(e){var n=void 0,i=e.font,s=e.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(Ug(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(hn),function(r){function t(){return(un.canvg?Promise.resolve(un.canvg):Promise.resolve().then(()=>kft)).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}hn.API.addSvgAsImage=function(e,n,i,s,a,o,d,f){if(isNaN(n)||isNaN(i))throw Ui.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw Ui.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var m=document.createElement("canvas");m.width=s,m.height=a;var v=m.getContext("2d");v.fillStyle="#fff",v.fillRect(0,0,m.width,m.height);var C={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},b=this;return t().then(function(P){return P.fromString(v,e,C)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(P){return P.render(C)}).then(function(){b.addImage(m.toDataURL("image/jpeg",1),n,i,s,a,d,f)})}}(),hn.API.putTotalPages=function(r){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(t,e);return this},hn.API.viewerPreferences=function(r,t){var e;r=r||{},t=t||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),d=[],f=0,m=0,v=0;function C(P,F){var U,k=!1;for(U=0;U<P.length;U+=1)P[U]===F&&(k=!0);return k}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||t===!0){var b=o.length;for(v=0;v<b;v+=1)e[o[v]].value=e[o[v]].defaultValue,e[o[v]].explicitSet=!1}if(li(r)==="object"){for(i in r)if(s=r[i],C(o,i)&&s!==void 0){if(e[i].type==="boolean"&&typeof s=="boolean")e[i].value=s;else if(e[i].type==="name"&&C(e[i].valueSet,s))e[i].value=s;else if(e[i].type==="integer"&&Number.isInteger(s))e[i].value=s;else if(e[i].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")d.push(String(s[f]-1));else if(s[f].length>1){for(m=0;m<s[f].length;m+=1)typeof s[f][m]!="number"&&(n=!1);n===!0&&d.push([s[f][0]-1,s[f][1]-1].join(" "))}e[i].value="["+d.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var P,F=[];for(P in e)e[P].explicitSet===!0&&(e[P].type==="name"?F.push("/"+P+" /"+e[P].value):F.push("/"+P+" "+e[P].value));F.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+F.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(r){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),d=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+a.length+o.length+i.length+d.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+d),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(hn.API),function(r){var t=r.API,e=t.pdfEscape16=function(s,a){for(var o,d=a.metadata.Unicode.widths,f=["","0","00","000","0000"],m=[""],v=0,C=s.length;v<C;++v){if(o=a.metadata.characterToGlyph(s.charCodeAt(v)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(v),d.indexOf(o)==-1&&(d.push(o),d.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return m.join("");o=o.toString(16),m.push(f[4-o.length],o)}return m.join("")},n=function(s){var a,o,d,f,m,v,C;for(m=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,d=[],v=0,C=(o=Object.keys(s).sort(function(b,P){return b-P})).length;v<C;v++)a=o[v],d.length>=100&&(m+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar`,d=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(f=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),d.push("<"+a+"><"+f+">"));return d.length&&(m+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar
`),m+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,d=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var v=o.metadata.Unicode.widths,C=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),b="",P=0;P<C.length;P++)b+=String.fromCharCode(C[P]);var F=f();m({data:b,addLength1:!0,objectId:F}),d("endobj");var U=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:U}),d("endobj");var k=f();d("<<"),d("/Type /FontDescriptor"),d("/FontName /"+Df(o.fontName)),d("/FontFile2 "+F+" 0 R"),d("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),d("/Flags "+o.metadata.flags),d("/StemV "+o.metadata.stemV),d("/ItalicAngle "+o.metadata.italicAngle),d("/Ascent "+o.metadata.ascender),d("/Descent "+o.metadata.decender),d("/CapHeight "+o.metadata.capHeight),d(">>"),d("endobj");var z=f();d("<<"),d("/Type /Font"),d("/BaseFont /"+Df(o.fontName)),d("/FontDescriptor "+k+" 0 R"),d("/W "+r.API.PDFObject.convert(v)),d("/CIDToGIDMap /Identity"),d("/DW 1000"),d("/Subtype /CIDFontType2"),d("/CIDSystemInfo"),d("<<"),d("/Supplement 0"),d("/Registry (Adobe)"),d("/Ordering ("+o.encoding+")"),d(">>"),d(">>"),d("endobj"),o.objectNumber=f(),d("<<"),d("/Type /Font"),d("/Subtype /Type0"),d("/ToUnicode "+U+" 0 R"),d("/BaseFont /"+Df(o.fontName)),d("/Encoding /"+o.encoding),d("/DescendantFonts ["+z+" 0 R]"),d(">>"),d("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,d=a.out,f=a.newObject,m=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var v=o.metadata.rawData,C="",b=0;b<v.length;b++)C+=String.fromCharCode(v[b]);var P=f();m({data:C,addLength1:!0,objectId:P}),d("endobj");var F=f();m({data:n(o.metadata.toUnicode),addLength1:!0,objectId:F}),d("endobj");var U=f();d("<<"),d("/Descent "+o.metadata.decender),d("/CapHeight "+o.metadata.capHeight),d("/StemV "+o.metadata.stemV),d("/Type /FontDescriptor"),d("/FontFile2 "+P+" 0 R"),d("/Flags 96"),d("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),d("/FontName /"+Df(o.fontName)),d("/ItalicAngle "+o.metadata.italicAngle),d("/Ascent "+o.metadata.ascender),d(">>"),d("endobj"),o.objectNumber=f();for(var k=0;k<o.metadata.hmtx.widths.length;k++)o.metadata.hmtx.widths[k]=parseInt(o.metadata.hmtx.widths[k]*(1e3/o.metadata.head.unitsPerEm));d("<</Subtype/TrueType/Type/Font/ToUnicode "+F+" 0 R/BaseFont/"+Df(o.fontName)+"/FontDescriptor "+U+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),d("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",d=s.x,f=s.y,m=s.options||{},v=s.mutex||{},C=v.pdfEscape,b=v.activeFontKey,P=v.fonts,F=b,U="",k=0,z="",K=P[F].encoding;if(P[F].encoding!=="Identity-H")return{text:o,x:d,y:f,options:m,mutex:v};for(z=o,F=b,Array.isArray(o)&&(z=o[0]),k=0;k<z.length;k+=1)P[F].metadata.hasOwnProperty("cmap")&&(a=P[F].metadata.cmap.unicode.codeMap[z[k].charCodeAt(0)]),a||z[k].charCodeAt(0)<256&&P[F].metadata.hasOwnProperty("Unicode")?U+=z[k]:U+="";var G="";return parseInt(F.slice(1))<14||K==="WinAnsiEncoding"?G=C(U,F).split("").map(function(X){return X.charCodeAt(0).toString(16)}).join(""):K==="Identity-H"&&(G=e(U,P[F])),v.isHex=!0,{text:G,x:d,y:f,options:m,mutex:v}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],d={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var f=0;for(f=0;f<a.length;f+=1)Array.isArray(a[f])&&a[f].length===3?o.push([i(Object.assign({},d,{text:a[f][0]})).text,a[f][1],a[f][2]]):o.push(i(Object.assign({},d,{text:a[f]})).text);s.text=o}else s.text=i(Object.assign({},d,{text:a})).text}])}(hn),function(r){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},r.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(hn.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,d,f,m,v=t,C=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],b=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],P={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},F={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},U=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],k=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),z=!1,K=0;this.__bidiEngine__={};var G=function(st){var ot=st.charCodeAt(),vt=ot>>8,yt=F[vt];return yt!==void 0?v[256*yt+(255&ot)]:vt===252||vt===253?"AL":k.test(vt)?"L":vt===8?"R":"N"},X=function(st){for(var ot,vt=0;vt<st.length;vt++){if((ot=G(st.charAt(vt)))==="L")return!1;if(ot==="R")return!0}return!1},Y=function(st,ot,vt,yt){var re,Wt,ee,Zt,oe=ot[yt];switch(oe){case"L":case"R":z=!1;break;case"N":case"AN":break;case"EN":z&&(oe="AN");break;case"AL":z=!0,oe="R";break;case"WS":oe="N";break;case"CS":yt<1||yt+1>=ot.length||(re=vt[yt-1])!=="EN"&&re!=="AN"||(Wt=ot[yt+1])!=="EN"&&Wt!=="AN"?oe="N":z&&(Wt="AN"),oe=Wt===re?Wt:"N";break;case"ES":oe=(re=yt>0?vt[yt-1]:"B")==="EN"&&yt+1<ot.length&&ot[yt+1]==="EN"?"EN":"N";break;case"ET":if(yt>0&&vt[yt-1]==="EN"){oe="EN";break}if(z){oe="N";break}for(ee=yt+1,Zt=ot.length;ee<Zt&&ot[ee]==="ET";)ee++;oe=ee<Zt&&ot[ee]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Zt=ot.length,ee=yt+1;ee<Zt&&ot[ee]==="NSM";)ee++;if(ee<Zt){var pe=st[yt],De=pe>=1425&&pe<=2303||pe===64286;if(re=ot[ee],De&&(re==="R"||re==="AL")){oe="R";break}}}oe=yt<1||(re=ot[yt-1])==="B"?"N":vt[yt-1];break;case"B":z=!1,i=!0,oe=K;break;case"S":s=!0,oe="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":z=!1;break;case"BN":oe="N"}return oe},it=function(st,ot,vt){var yt=st.split("");return vt&&nt(yt,vt,{hiLevel:K}),yt.reverse(),ot&&ot.reverse(),yt.join("")},nt=function(st,ot,vt){var yt,re,Wt,ee,Zt,oe=-1,pe=st.length,De=0,at=[],Tt=K?b:C,Rt=[];for(z=!1,i=!1,s=!1,re=0;re<pe;re++)Rt[re]=G(st[re]);for(Wt=0;Wt<pe;Wt++){if(Zt=De,at[Wt]=Y(st,Rt,at,Wt),yt=240&(De=Tt[Zt][P[at[Wt]]]),De&=15,ot[Wt]=ee=Tt[De][5],yt>0)if(yt===16){for(re=oe;re<Wt;re++)ot[re]=1;oe=-1}else oe=-1;if(Tt[De][6])oe===-1&&(oe=Wt);else if(oe>-1){for(re=oe;re<Wt;re++)ot[re]=ee;oe=-1}Rt[Wt]==="B"&&(ot[Wt]=0),vt.hiLevel|=ee}s&&function(Nt,ae,Xt){for(var ye=0;ye<Xt;ye++)if(Nt[ye]==="S"){ae[ye]=K;for(var de=ye-1;de>=0&&Nt[de]==="WS";de--)ae[de]=K}}(Rt,ot,pe)},wt=function(st,ot,vt,yt,re){if(!(re.hiLevel<st)){if(st===1&&K===1&&!i)return ot.reverse(),void(vt&&vt.reverse());for(var Wt,ee,Zt,oe,pe=ot.length,De=0;De<pe;){if(yt[De]>=st){for(Zt=De+1;Zt<pe&&yt[Zt]>=st;)Zt++;for(oe=De,ee=Zt-1;oe<ee;oe++,ee--)Wt=ot[oe],ot[oe]=ot[ee],ot[ee]=Wt,vt&&(Wt=vt[oe],vt[oe]=vt[ee],vt[ee]=Wt);De=Zt}De++}}},Ct=function(st,ot,vt){var yt=st.split(""),re={hiLevel:K};return vt||(vt=[]),nt(yt,vt,re),function(Wt,ee,Zt){if(Zt.hiLevel!==0&&m)for(var oe,pe=0;pe<Wt.length;pe++)ee[pe]===1&&(oe=U.indexOf(Wt[pe]))>=0&&(Wt[pe]=U[oe+1])}(yt,vt,re),wt(2,yt,ot,vt,re),wt(1,yt,ot,vt,re),yt.join("")};return this.__bidiEngine__.doBidiReorder=function(st,ot,vt){if(function(re,Wt){if(Wt)for(var ee=0;ee<re.length;ee++)Wt[ee]=ee;o===void 0&&(o=X(re)),f===void 0&&(f=X(re))}(st,ot),a||!d||f)if(a&&d&&o^f)K=o?1:0,st=it(st,ot,vt);else if(!a&&d&&f)K=o?1:0,st=Ct(st,ot,vt),st=it(st,ot);else if(!a||o||d||f){if(a&&!d&&o^f)st=it(st,ot),o?(K=0,st=Ct(st,ot,vt)):(K=1,st=Ct(st,ot,vt),st=it(st,ot));else if(a&&o&&!d&&f)K=1,st=Ct(st,ot,vt),st=it(st,ot);else if(!a&&!d&&o^f){var yt=m;o?(K=1,st=Ct(st,ot,vt),K=0,m=!1,st=Ct(st,ot,vt),m=yt):(K=0,st=Ct(st,ot,vt),st=it(st,ot),K=1,m=!1,st=Ct(st,ot,vt),m=yt,st=it(st,ot))}}else K=0,st=Ct(st,ot,vt);else K=o?1:0,st=Ct(st,ot,vt);return st},this.__bidiEngine__.setOptions=function(st){st&&(a=st.isInputVisual,d=st.isOutputVisual,o=st.isInputRtl,f=st.isOutputRtl,m=st.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text,s=(n.x,n.y,n.options||{}),a=(n.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([e.doBidiReorder(i[o])]);n.text=a}else n.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])}(hn),hn.API.TTFFont=function(){function r(t){var e;if(this.rawData=t,e=this.contents=new xA(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new mit(this),this.registerTTF()}return r.open=function(t){return new r(t)},r.prototype.parse=function(){return this.directory=new nit(this.contents),this.head=new sit(this),this.name=new uit(this),this.cmap=new HF(this),this.toUnicode={},this.hhea=new oit(this),this.maxp=new hit(this),this.hmtx=new Ait(this),this.post=new lit(this),this.os2=new ait(this),this.loca=new git(this),this.glyf=new dit(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var t,e,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,d,f;for(f=[],a=0,o=(d=this.bbox).length;a<o;a++)t=d[a],f.push(Math.round(t*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},r.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},r.prototype.widthOfString=function(t,e,n){var i,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/e)||0;return a*(e/1e3)},r.prototype.lineHeight=function(t,e){var n;return e==null&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},r}();var Uc,xA=function(){function r(t){this.data=t??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(t){return this.data[this.pos++]=t},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},r.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},r.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},r.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(t){var e,n,i;for(i=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(t){return this.writeInt16(t)},r.prototype.readLongLong=function(){var t,e,n,i,s,a,o,d;return t=this.readByte(),e=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),d=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^d)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+d},r.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(t){return this.writeInt32(t)},r.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},r.prototype.write=function(t){var e,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)e=t[n],s.push(this.writeByte(e));return s},r}(),nit=function(){var r;function t(e){var n,i,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(e){var n,i,s,a,o,d,f,m,v,C,b,P,F;for(F in b=Object.keys(e).length,d=Math.log(2),v=16*Math.floor(Math.log(b)/d),a=Math.floor(v/d),m=16*b-v,(i=new xA).writeInt(this.scalarType),i.writeShort(b),i.writeShort(v),i.writeShort(a),i.writeShort(m),s=16*b,f=i.pos+s,o=null,P=[],e)for(C=e[F],i.writeString(F),i.writeInt(r(C)),i.writeInt(f),i.writeInt(C.length),P=P.concat(C),F==="head"&&(o=f),f+=C.length;f%4;)P.push(0),f++;return i.write(P),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(e){var n,i,s,a;for(e=VF.call(e);e.length%4;)e.push(0);for(s=new xA(e),i=0,n=0,a=e.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},t}(),iit={}.hasOwnProperty,Qu=function(r,t){for(var e in t)iit.call(t,e)&&(r[e]=t[e]);function n(){this.constructor=r}return n.prototype=t.prototype,r.prototype=new n,r.__super__=t.prototype,r};Uc=function(){function r(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var sit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new xA).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t}(),zF=function(){function r(t,e){var n,i,s,a,o,d,f,m,v,C,b,P,F,U,k,z,K;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),v=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(d=0;d<256;++d)this.codeMap[d]=t.readByte();break;case 4:for(b=t.readUInt16(),C=b/2,t.pos+=6,s=function(){var G,X;for(X=[],d=G=0;0<=C?G<C:G>C;d=0<=C?++G:--G)X.push(t.readUInt16());return X}(),t.pos+=2,F=function(){var G,X;for(X=[],d=G=0;0<=C?G<C:G>C;d=0<=C?++G:--G)X.push(t.readUInt16());return X}(),f=function(){var G,X;for(X=[],d=G=0;0<=C?G<C:G>C;d=0<=C?++G:--G)X.push(t.readUInt16());return X}(),m=function(){var G,X;for(X=[],d=G=0;0<=C?G<C:G>C;d=0<=C?++G:--G)X.push(t.readUInt16());return X}(),i=(this.length-t.pos+this.offset)/2,o=function(){var G,X;for(X=[],d=G=0;0<=i?G<i:G>i;d=0<=i?++G:--G)X.push(t.readUInt16());return X}(),d=k=0,K=s.length;k<K;d=++k)for(U=s[d],n=z=P=F[d];P<=U?z<=U:z>=U;n=P<=U?++z:--z)m[d]===0?a=n+f[d]:(a=o[m[d]/2+(n-P)-(C-d)]||0)!==0&&(a+=f[d]),this.codeMap[n]=65535&a}t.pos=v}return r.encode=function(t,e){var n,i,s,a,o,d,f,m,v,C,b,P,F,U,k,z,K,G,X,Y,it,nt,wt,Ct,st,ot,vt,yt,re,Wt,ee,Zt,oe,pe,De,at,Tt,Rt,Nt,ae,Xt,ye,de,qe,Ve,Je;switch(yt=new xA,a=Object.keys(t).sort(function(or,mr){return or-mr}),e){case"macroman":for(F=0,U=function(){var or=[];for(P=0;P<256;++P)or.push(0);return or}(),z={0:0},s={},re=0,oe=a.length;re<oe;re++)z[de=t[i=a[re]]]==null&&(z[de]=++F),s[i]={old:t[i],new:z[t[i]]},U[i]=z[t[i]];return yt.writeUInt16(1),yt.writeUInt16(0),yt.writeUInt32(12),yt.writeUInt16(0),yt.writeUInt16(262),yt.writeUInt16(0),yt.write(U),{charMap:s,subtable:yt.data,maxGlyphID:F+1};case"unicode":for(ot=[],v=[],K=0,z={},n={},k=f=null,Wt=0,pe=a.length;Wt<pe;Wt++)z[X=t[i=a[Wt]]]==null&&(z[X]=++K),n[i]={old:X,new:z[X]},o=z[X]-i,k!=null&&o===f||(k&&v.push(k),ot.push(i),f=o),k=i;for(k&&v.push(k),v.push(65535),ot.push(65535),Ct=2*(wt=ot.length),nt=2*Math.pow(Math.log(wt)/Math.LN2,2),C=Math.log(nt/2)/Math.LN2,it=2*wt-nt,d=[],Y=[],b=[],P=ee=0,De=ot.length;ee<De;P=++ee){if(st=ot[P],m=v[P],st===65535){d.push(0),Y.push(0);break}if(st-(vt=n[st].new)>=32768)for(d.push(0),Y.push(2*(b.length+wt-P)),i=Zt=st;st<=m?Zt<=m:Zt>=m;i=st<=m?++Zt:--Zt)b.push(n[i].new);else d.push(vt-st),Y.push(0)}for(yt.writeUInt16(3),yt.writeUInt16(1),yt.writeUInt32(12),yt.writeUInt16(4),yt.writeUInt16(16+8*wt+2*b.length),yt.writeUInt16(0),yt.writeUInt16(Ct),yt.writeUInt16(nt),yt.writeUInt16(C),yt.writeUInt16(it),Xt=0,at=v.length;Xt<at;Xt++)i=v[Xt],yt.writeUInt16(i);for(yt.writeUInt16(0),ye=0,Tt=ot.length;ye<Tt;ye++)i=ot[ye],yt.writeUInt16(i);for(qe=0,Rt=d.length;qe<Rt;qe++)o=d[qe],yt.writeUInt16(o);for(Ve=0,Nt=Y.length;Ve<Nt;Ve++)G=Y[Ve],yt.writeUInt16(G);for(Je=0,ae=b.length;Je<ae;Je++)F=b[Je],yt.writeUInt16(F);return{charMap:n,subtable:yt.data,maxGlyphID:K+1}}},r}(),HF=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,i,s;for(e.pos=this.offset,this.version=e.readUInt16(),s=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=s?i<s:i>s;i=0<=s?++i:--i)n=new zF(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var i,s;return n==null&&(n="macroman"),i=zF.encode(e,n),(s=new xA).writeUInt16(0),s.writeUInt16(1),i.table=s.data.concat(i.subtable),i},t}(),oit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),ait=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var n,i;for(i=[],n=0;n<10;++n)i.push(e.readByte());return i}(),this.charRange=function(){var n,i;for(i=[],n=0;n<4;++n)i.push(e.readInt());return i}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var n,i;for(i=[],n=0;n<2;n=++n)i.push(e.readInt());return i}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),lit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="post",t.prototype.parse=function(e){var n,i,s;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var a;for(i=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],s=[];e.pos<this.offset+this.length;)n=e.readByte(),s.push(this.names.push(e.readString(n)));return s;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 196608:break;case 262144:return this.map=(function(){var o,d,f;for(f=[],a=o=0,d=this.file.maxp.numGlyphs;0<=d?o<d:o>d;a=0<=d?++o:--o)f.push(e.readUInt32());return f}).call(this)}},t}(),cit=function(r,t){this.raw=r,this.length=r.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},uit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="name",t.prototype.parse=function(e){var n,i,s,a,o,d,f,m,v,C,b;for(e.pos=this.offset,e.readShort(),n=e.readShort(),d=e.readShort(),i=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+d+e.readShort()});for(f={},a=v=0,C=i.length;v<C;a=++v)s=i[a],e.pos=s.offset,m=e.readString(s.length),o=new cit(m,s),f[b=s.nameID]==null&&(f[b]=[]),f[s.nameID].push(o);this.strings=f,this.copyright=f[0],this.fontFamily=f[1],this.fontSubfamily=f[2],this.uniqueSubfamily=f[3],this.fontName=f[4],this.version=f[5];try{this.postscriptName=f[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=f[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=f[7],this.manufacturer=f[8],this.designer=f[9],this.description=f[10],this.vendorUrl=f[11],this.designerUrl=f[12],this.license=f[13],this.licenseUrl=f[14],this.preferredFamily=f[15],this.preferredSubfamily=f[17],this.compatibleFull=f[18],this.sampleText=f[19]},t}(),hit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),Ait=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,i,s,a,o,d,f;for(e.pos=this.offset,this.metrics=[],n=0,d=this.file.hhea.numberOfMetrics;0<=d?n<d:n>d;n=0<=d?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var m,v;for(v=[],n=m=0;0<=s?m<s:m>s;n=0<=s?++m:--m)v.push(e.readInt16());return v}(),this.widths=(function(){var m,v,C,b;for(b=[],m=0,v=(C=this.metrics).length;m<v;m++)a=C[m],b.push(a.advance);return b}).call(this),i=this.widths[this.widths.length-1],f=[],n=o=0;0<=s?o<s:o>s;n=0<=s?++o:--o)f.push(this.widths.push(i));return f},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),VF=[].slice,dit=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,i,s,a,o,d,f,m,v,C;return e in this.cache?this.cache[e]:(a=this.file.loca,n=this.file.contents,i=a.indexOf(e),(s=a.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+i,o=(d=new xA(n.read(s))).readShort(),m=d.readShort(),C=d.readShort(),f=d.readShort(),v=d.readShort(),this.cache[e]=o===-1?new pit(d,m,C,f,v):new fit(d,o,m,C,f,v),this.cache[e]))},t.prototype.encode=function(e,n,i){var s,a,o,d,f;for(o=[],a=[],d=0,f=n.length;d<f;d++)s=e[n[d]],a.push(o.length),s&&(o=o.concat(s.encode(i)));return a.push(o.length),{table:o,offsets:a}},t}(),fit=function(){function r(t,e,n,i,s,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),pit=function(){function r(t,e,n,i,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var t,e,n;for(e=new xA(VF.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},r}(),git=function(r){function t(){return t.__super__.constructor.apply(this,arguments)}return Qu(t,Uc),t.prototype.tag="loca",t.prototype.parse=function(e){var n,i;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],i=0,s=this.length;i<s;i+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var i=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<i.length;++o)if(i[o]=s,a<n.length&&n[a]==o){++a,i[o]=s;var d=this.offsets[o],f=this.offsets[o+1]-d;f>0&&(s+=f)}for(var m=new Array(4*i.length),v=0;v<i.length;++v)m[4*v+3]=255&i[v],m[4*v+2]=(65280&i[v])>>8,m[4*v+1]=(16711680&i[v])>>16,m[4*v]=(4278190080&i[v])>>24;return m},t}(),mit=function(){function r(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var t,e,n,i,s;for(e in i=this.font.cmap.tables[0].codeMap,t={},s=this.subset)n=s[e],t[e]=i[n];return t},r.prototype.glyphsFor=function(t){var e,n,i,s,a,o,d;for(i={},a=0,o=t.length;a<o;a++)i[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],i)(n=i[s])!=null&&n.compound&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(s in d=this.glyphsFor(e))n=d[s],i[s]=n;return i},r.prototype.encode=function(t,e){var n,i,s,a,o,d,f,m,v,C,b,P,F,U,k;for(i in n=HF.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),b={0:0},k=n.charMap)b[(d=k[i]).old]=d.new;for(P in C=n.maxGlyphID,a)P in b||(b[P]=C++);return m=function(z){var K,G;for(K in G={},z)G[z[K]]=K;return G}(b),v=Object.keys(m).sort(function(z,K){return z-K}),F=function(){var z,K,G;for(G=[],z=0,K=v.length;z<K;z++)o=v[z],G.push(m[o]);return G}(),s=this.font.glyf.encode(a,F,b),f=this.font.loca.encode(s.offsets,F),U={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(U["OS/2"]=this.font.os2.raw()),this.font.directory.encode(U)},r}();hn.API.PDFObject=function(){var r;function t(){}return r=function(e,n){return(Array(n+1).join("0")+e).slice(-n)},t.convert=function(e){var n,i,s,a;if(Array.isArray(e))return"["+function(){var o,d,f;for(f=[],o=0,d=e.length;o<d;o++)n=e[o],f.push(t.convert(n));return f}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in s=["<<"],e)a=e[i],s.push("/"+i+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+e},t}();const c2={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},By={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},Cy={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class yit{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gd.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Eh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Of.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",d=arguments.length>7&&arguments[7]!==void 0?arguments[7]:c2,f=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",m=arguments.length>9&&arguments[9]!==void 0?arguments[9]:By,v=arguments.length>10&&arguments[10]!==void 0?arguments[10]:Cy;ri(this,"map"),ri(this,"width"),ri(this,"height"),ri(this,"dpi"),ri(this,"format"),ri(this,"unit"),ri(this,"fileName"),ri(this,"markerClassName"),ri(this,"markerCirclePaint"),ri(this,"attributionClassName"),ri(this,"attributionOptions"),ri(this,"northIconOptions"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=d,this.attributionClassName=f,this.attributionOptions=m,this.northIconOptions=v}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let n=0;n<e.length;n++){const i=e.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const d=parseInt(o[1]),f=parseInt(o[2]),m=this.map.unproject([d,f]),v=`point${n}`;t.addSource(v,{type:"geojson",data:{type:"Point",coordinates:[m.lng,m.lat]}}),t.addLayer({id:v,source:v,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;this.addLoader(),this.showLoader();const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(d=>{const f=o[d];Object.keys(f).forEach(m=>{f[m]||delete f[m]})})}let a=this.getRenderedMap(i,s);a.on("load",()=>{this.addNorthIconToMap(a).then(()=>{a.once("idle",()=>{this.addAttributions(a)?a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,e):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,e)}))}):(a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,e):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,e)})))})})})}stripHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}getIconWidth(t,e){const n=t.getContainer(),i=parseInt(n.style.width.replace("px",""));return parseInt(`${i*e}`)}getElementPosition(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=t.getContainer();let s=0,a=0;switch(e){case"top-left":s=0+n,a=0+n;break;case"top-right":s=parseInt(i.style.width.replace("px",""))-n,a=0+n;break;case"bottom-left":s=0+n,a=parseInt(i.style.height.replace("px",""))-n;break;case"bottom-right":s=parseInt(i.style.width.replace("px",""))-n,a=parseInt(i.style.height.replace("px",""))-n;break}return[s,a]}addNorthIconImage(t){const e=this.getIconWidth(t,this.northIconOptions.imageSizeFraction??.08);return new Promise(n=>{const i=new Image(e,e);i.onload=()=>{this.northIconOptions.imageName&&t.addImage(this.northIconOptions.imageName,i),n()};function s(a){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)}this.northIconOptions.image&&(i.src=s(this.northIconOptions.image))})}addNorthIconToMap(t){let e=this.northIconOptions.visibility??"visible";return t.getZoom()<2&&this.width>this.height&&(e="none"),new Promise(n=>{this.addNorthIconImage(t).then(()=>{const i=this.getIconWidth(t,this.northIconOptions.imageSizeFraction??.08)*.8,s=this.getElementPosition(t,this.northIconOptions.position??"top-right",i),a=t.unproject(s),o=this.northIconOptions.imageName??"gl-export-north-icon";t.addSource(o,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{}}}),t.addLayer({id:o,source:o,type:"symbol",layout:{"icon-image":o,"icon-size":1,"icon-rotate":t.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:e},paint:{}}),n()})})}addAttributions(t){var e;if(!this.map.getStyle().glyphs)return!1;const n=t.getContainer(),i=this.attributionOptions.position??"bottom-right",s=this.getElementPosition(t,i,5),a=s[0],o=t.unproject(s),d=n.getElementsByClassName(this.attributionClassName),f=[];if((d==null?void 0:d.length)>0){const U=d.item(0);if(U)for(let k=0;k<U.children.length;k++){const z=U.children.item(k);z&&f.push(this.stripHtml(z.outerHTML))}}else{const U=this.map.getStyle().sources;Object.keys(U).forEach(k=>{const z=U[k];if("attribution"in z){const K=z.attribution;f.push(this.stripHtml(K))}})}if(f.length===0)return!1;const m=f.join(" | "),v="attribution";t.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[o.lng,o.lat]},properties:{attribution:m}}});const C=this.map.getStyle().layers.filter(U=>U.type==="symbol"&&U.layout&&"text-font"in U.layout),b=C.length>0&&C[0].layout?C[0].layout["text-font"]:(e=this.attributionOptions.style)==null?void 0:e.fallbackTextFont;let P=this.attributionOptions.visibility??"visible";t.getZoom()<2&&this.width>this.height&&(P="none");const F=this.attributionOptions.style;return t.addLayer({id:v,source:v,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":b,"text-max-width":parseInt(`${a/F.textSize}`),"text-anchor":i,"text-justify":["top-right","bottom-right"].includes(i)?"right":"left","text-size":F.textSize,"text-allow-overlap":!0,visibility:P},paint:{"text-halo-color":F.textHaloColor,"text-halo-width":F.textHaloWidth,"text-color":F.textColor}}),!0}exportImage(t,e,n){var i;const s=t.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case Eh.PNG:this.toPNG(s,a);break;case Eh.JPEG:this.toJPEG(s,a);break;case Eh.PDF:this.toPDF(t,a);break;case Eh.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(i=e.parentNode)==null||i.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),e.remove(),this.hideLoader()}toPNG(t,e){const n=document.createElement("a");n.href=t.toDataURL(),n.download=e,n.click(),n.remove()}toJPEG(t,e){const n=t.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=e,i.click(),i.remove()}toPDF(t,e){const n=t.getCanvas(),i=new hn({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=t.getCenter();i.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(e)}toSVG(t,e){const n=t.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=e,o.click(),o.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Of.mm&&(e/=25.4),`${e*t}px`}addLoader(){var t;const e=(t=this.map.getCanvas().parentElement)==null?void 0:t.parentElement;if(!e||e.getElementsByClassName("map-export-loader").length>0)return;const n=document.createElement("span");n.classList.add("map-export-loader"),n.classList.add("loader-default"),e.appendChild(n)}showLoader(){var t,e;const n=(t=this.map.getCanvas().parentElement)==null?void 0:t.parentElement;if(!n)return;const i=n.getElementsByClassName("map-export-loader");i&&i.length>0&&((e=i.item(0))==null||e.classList.add("is-active"))}hideLoader(){var t,e;const n=(t=this.map.getCanvas().parentElement)==null?void 0:t.parentElement;if(!n)return;const i=n.getElementsByClassName("map-export-loader");i&&i.length>0&&((e=i.item(0))==null||e.classList.remove("is-active"))}}class _it extends yit{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gd.A4,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Eh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Of.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:c2,d=arguments.length>7&&arguments[7]!==void 0?arguments[7]:By,f=arguments.length>8&&arguments[8]!==void 0?arguments[8]:Cy;super(t,e,n,i,s,a,"maplibregl-marker",o,"maplibregl-ctrl-attrib-inner",d,f)}getRenderedMap(t,e){const n=new DT.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{i[s].data&&n.addImage(s,i[s].data)}),n}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}}let vit=class{constructor(t){ri(this,"controlContainer"),ri(this,"exportContainer"),ri(this,"crosshair"),ri(this,"printableArea"),ri(this,"map"),ri(this,"exportButton"),ri(this,"options",{PageSize:gd.A4,PageOrientation:Fg.Landscape,Format:Eh.PDF,DPI:Qw[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(gd),Filename:"map",markerCirclePaint:c2,attributionOptions:By,northIconOptions:Cy}),ri(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(t.attributionOptions=Object.assign(By,t.attributionOptions),t.northIconOptions=Object.assign(Cy,t.northIconOptions),this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return vnt(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const n=document.createElement("TABLE");n.className="print-table";const i={};(e=this.options.AllowedSizes)==null||e.forEach(m=>{gd[m]&&(i[m]=gd[m])});const s=this.createSelection(i,this.getTranslation().PageSize,"page-size",this.options.PageSize,(m,v)=>JSON.stringify(m[v]));n.appendChild(s);const a=this.createSelection(Fg,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(m,v)=>m[v]);n.appendChild(a);const o=this.createSelection(Eh,this.getTranslation().Format,"format-type",this.options.Format,(m,v)=>m[v]);n.appendChild(o);const d=this.createSelection(Qw,this.getTranslation().DPI,"dpi-type",this.options.DPI,(m,v)=>m[v]);n.appendChild(d),this.exportContainer.appendChild(n);const f=document.createElement("button");return f.type="button",f.textContent=this.getTranslation().Generate,f.classList.add("generate-button"),f.addEventListener("click",()=>{const m=document.getElementById("mapbox-gl-export-page-size"),v=document.getElementById("mapbox-gl-export-page-orientation"),C=document.getElementById("mapbox-gl-export-format-type"),b=document.getElementById("mapbox-gl-export-dpi-type"),P=v.value;let F=JSON.parse(m.value);P===Fg.Portrait&&(F=F.reverse()),this.generateMap(t,F,Number(b.value),C.value,Of.mm,this.options.Filename)}),this.exportContainer.appendChild(f),this.controlContainer}generateMap(t,e,n,i,s,a){new _it(t,e,n,i,s,a,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(t,e,n,i,s){const a=document.createElement("label");a.textContent=e;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(t).forEach(v=>{const C=document.createElement("option");C.setAttribute("value",s(t,v)),C.appendChild(document.createTextNode(v)),C.setAttribute("name",n),i===t[v]&&(C.selected=!0),o.appendChild(C)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const d=document.createElement("TR"),f=document.createElement("TD"),m=document.createElement("TD");return f.appendChild(a),m.appendChild(o),d.appendChild(f),d.appendChild(m),d}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new snt(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new ont(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(t.value);e===Fg.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}};function u2(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(v){a(v)}}function d(m){try{f(n.throw(m))}catch(v){a(v)}}function f(m){m.done?s(m.value):i(m.value).then(o,d)}f((n=n.apply(r,t||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;var Ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ty(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var h2,GF;function jF(){if(GF)return h2;GF=1,h2=t;var r=Object.prototype.hasOwnProperty;function t(){for(var e={},n=0;n<arguments.length;n++){var i=arguments[n];for(var s in i)r.call(i,s)&&(e[s]=i[s])}return e}return h2}var A2={exports:{}},qF;function bit(){return qF||(qF=1,function(r,t){(function(){var e={};r.exports=e,e.simpleFilter=function(n,i){return i.filter(function(s){return e.test(n,s)})},e.test=function(n,i){return e.match(n,i)!==null},e.match=function(n,i,s){s=s||{};var a=0,o=[],d=i.length,f=0,m=0,v=s.pre||"",C=s.post||"",b=s.caseSensitive&&i||i.toLowerCase(),P;n=s.caseSensitive&&n||n.toLowerCase();for(var F=0;F<d;F++)P=i[F],b[F]===n[a]?(P=v+P+C,a+=1,m+=1+m):m=0,f+=m,o[o.length]=P;return a===n.length?(f=b===n?1/0:f,{rendered:o.join(""),score:f}):null},e.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,d,f){var m=o;s.extract&&(m=s.extract(o));var v=e.match(n,m,s);return v!=null&&(a[a.length]={string:v.rendered,score:v.score,index:d,original:o}),a},[]).sort(function(a,o){var d=o.score-a.score;return d||a.index-o.index}))}})()}(A2)),A2.exports}var d2,KF;function wit(){if(KF)return d2;KF=1;var r=function(t){return this.component=t,this.items=[],this.active=t.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};return r.prototype.show=function(){this.element.style.display="block"},r.prototype.hide=function(){this.element.style.display="none"},r.prototype.add=function(t){this.items.push(t)},r.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},r.prototype.isEmpty=function(){return!this.items.length},r.prototype.isVisible=function(){return this.element.style.display==="block"},r.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()},r.prototype.drawItem=function(t,e){var n=document.createElement("li"),i=document.createElement("a");e&&(n.className+=" active"),i.innerHTML=t.string,n.appendChild(i),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))},r.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()},r.prototype.move=function(t){this.active=t,this.draw()},r.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},r.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},r.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()},d2=r,d2}var f2,WF;function xit(){if(WF)return f2;WF=1;var r=jF(),t=bit(),e=wit(),n=function(i,s,a){return a=a||{},this.options=r({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},a),this.el=i,this.data=s||[],this.list=new e(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(o){this.handleKeyUp(o.keyCode,o)}).bind(this),!1),this.el.addEventListener("keydown",(function(o){this.handleKeyDown(o)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(o){this.handlePaste(o)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return n.prototype.handleKeyUp=function(i,s){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),s.stopPropagation());return}this.handleInputChange(this.el.value)}},n.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},n.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},n.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(i.target.value)},100)}},n.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))},n.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},n.prototype.update=function(i){this.data=i,this.handleKeyUp()},n.prototype.clear=function(){this.data=[],this.list.clear()},n.prototype.normalize=function(i){return i=i.toLowerCase(),i},n.prototype.match=function(i,s){return i.indexOf(s)>-1},n.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")},n.prototype.getCandidates=function(i){var s={pre:"<strong>",post:"</strong>",extract:(function(o){return this.getItemValue(o)}).bind(this)},a;this.options.filter?(a=t.filter(this.query,this.data,s),a=a.map((function(o){return{original:o.original,string:this.render(o.original,o.string)}}).bind(this))):a=this.data.map((function(o){var d=this.render(o);return{original:o,string:d}}).bind(this)),i(a)},n.prototype.getItemValue=function(i){return i},n.prototype.render=function(i,s){if(s)return s;for(var a=i.original?this.getItemValue(i.original):this.getItemValue(i),o=this.normalize(a),d=o.lastIndexOf(this.query);d>-1;){var f=d+this.query.length;a=a.slice(0,d)+"<strong>"+a.slice(d,f)+"</strong>"+a.slice(f),d=o.slice(0,d).lastIndexOf(this.query)}return a},n.prototype.renderError=function(i){this.list.drawError(i)},f2=n,f2}var p2,$F;function Bit(){if($F)return p2;$F=1;var r=xit();return p2=r,typeof window<"u"&&(window.Suggestions=r),p2}var Cit=Bit(),Eit=Ty(Cit),Sy={exports:{}},Tit=Sy.exports,XF;function Sit(){return XF||(XF=1,function(r){(function(t,e,n){r.exports?r.exports=n():t[e]=n()})(Tit,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(d){return d.match(e)||[]}function i(d){return n(d).filter(function(f,m){return f&&m})}function s(d){return d=n(d),{language:d[1]||t,extlang:d[2]||t,script:d[3]||t,region:d[4]||t}}function a(d,f,m){Object.defineProperty(d,f,{value:m,enumerable:!0})}function o(d,f,m){function v(C){return n(C)[d]||t}a(v,"pattern",f),a(s,m,v)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})}(Sy)),Sy.exports}var Iit=Sit(),Pit=Ty(Iit),g2,ZF;function Mit(){if(ZF)return g2;ZF=1;var r="Expected a function",t=NaN,e="[object Symbol]",n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,d=typeof Ey=="object"&&Ey&&Ey.Object===Object&&Ey,f=typeof self=="object"&&self&&self.Object===Object&&self,m=d||f||Function("return this")(),v=Object.prototype,C=v.toString,b=Math.max,P=Math.min,F=function(){return m.Date.now()};function U(X,Y,it){var nt,wt,Ct,st,ot,vt,yt=0,re=!1,Wt=!1,ee=!0;if(typeof X!="function")throw new TypeError(r);Y=G(Y)||0,k(it)&&(re=!!it.leading,Wt="maxWait"in it,Ct=Wt?b(G(it.maxWait)||0,Y):Ct,ee="trailing"in it?!!it.trailing:ee);function Zt(Xt){var ye=nt,de=wt;return nt=wt=void 0,yt=Xt,st=X.apply(de,ye),st}function oe(Xt){return yt=Xt,ot=setTimeout(at,Y),re?Zt(Xt):st}function pe(Xt){var ye=Xt-vt,de=Xt-yt,qe=Y-ye;return Wt?P(qe,Ct-de):qe}function De(Xt){var ye=Xt-vt,de=Xt-yt;return vt===void 0||ye>=Y||ye<0||Wt&&de>=Ct}function at(){var Xt=F();if(De(Xt))return Tt(Xt);ot=setTimeout(at,pe(Xt))}function Tt(Xt){return ot=void 0,ee&&nt?Zt(Xt):(nt=wt=void 0,st)}function Rt(){ot!==void 0&&clearTimeout(ot),yt=0,nt=vt=wt=ot=void 0}function Nt(){return ot===void 0?st:Tt(F())}function ae(){var Xt=F(),ye=De(Xt);if(nt=arguments,wt=this,vt=Xt,ye){if(ot===void 0)return oe(vt);if(Wt)return ot=setTimeout(at,Y),Zt(vt)}return ot===void 0&&(ot=setTimeout(at,Y)),st}return ae.cancel=Rt,ae.flush=Nt,ae}function k(X){var Y=typeof X;return!!X&&(Y=="object"||Y=="function")}function z(X){return!!X&&typeof X=="object"}function K(X){return typeof X=="symbol"||z(X)&&C.call(X)==e}function G(X){if(typeof X=="number")return X;if(K(X))return t;if(k(X)){var Y=typeof X.valueOf=="function"?X.valueOf():X;X=k(Y)?Y+"":Y}if(typeof X!="string")return X===0?X:+X;X=X.replace(n,"");var it=s.test(X);return it||a.test(X)?o(X.slice(2),it?2:8):i.test(X)?t:+X}return g2=U,g2}var Fit=Mit(),Lit=Ty(Fit),Rit=jF(),Dc=Ty(Rit),Iy={exports:{}},YF;function Oit(){if(YF)return Iy.exports;YF=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(X,Y,it){return Function.prototype.apply.call(X,Y,it)},e;r&&typeof r.ownKeys=="function"?e=r.ownKeys:Object.getOwnPropertySymbols?e=function(X){return Object.getOwnPropertyNames(X).concat(Object.getOwnPropertySymbols(X))}:e=function(X){return Object.getOwnPropertyNames(X)};function n(G){console&&console.warn&&console.warn(G)}var i=Number.isNaN||function(X){return X!==X};function s(){s.init.call(this)}Iy.exports=s,Iy.exports.once=k,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(G){if(typeof G!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(G){if(typeof G!="number"||G<0||i(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");a=G}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(X){if(typeof X!="number"||X<0||i(X))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+X+".");return this._maxListeners=X,this};function d(G){return G._maxListeners===void 0?s.defaultMaxListeners:G._maxListeners}s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(X){for(var Y=[],it=1;it<arguments.length;it++)Y.push(arguments[it]);var nt=X==="error",wt=this._events;if(wt!==void 0)nt=nt&&wt.error===void 0;else if(!nt)return!1;if(nt){var Ct;if(Y.length>0&&(Ct=Y[0]),Ct instanceof Error)throw Ct;var st=new Error("Unhandled error."+(Ct?" ("+Ct.message+")":""));throw st.context=Ct,st}var ot=wt[X];if(ot===void 0)return!1;if(typeof ot=="function")t(ot,this,Y);else for(var vt=ot.length,yt=P(ot,vt),it=0;it<vt;++it)t(yt[it],this,Y);return!0};function f(G,X,Y,it){var nt,wt,Ct;if(o(Y),wt=G._events,wt===void 0?(wt=G._events=Object.create(null),G._eventsCount=0):(wt.newListener!==void 0&&(G.emit("newListener",X,Y.listener?Y.listener:Y),wt=G._events),Ct=wt[X]),Ct===void 0)Ct=wt[X]=Y,++G._eventsCount;else if(typeof Ct=="function"?Ct=wt[X]=it?[Y,Ct]:[Ct,Y]:it?Ct.unshift(Y):Ct.push(Y),nt=d(G),nt>0&&Ct.length>nt&&!Ct.warned){Ct.warned=!0;var st=new Error("Possible EventEmitter memory leak detected. "+Ct.length+" "+String(X)+" listeners added. Use emitter.setMaxListeners() to increase limit");st.name="MaxListenersExceededWarning",st.emitter=G,st.type=X,st.count=Ct.length,n(st)}return G}s.prototype.addListener=function(X,Y){return f(this,X,Y,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(X,Y){return f(this,X,Y,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(G,X,Y){var it={fired:!1,wrapFn:void 0,target:G,type:X,listener:Y},nt=m.bind(it);return nt.listener=Y,it.wrapFn=nt,nt}s.prototype.once=function(X,Y){return o(Y),this.on(X,v(this,X,Y)),this},s.prototype.prependOnceListener=function(X,Y){return o(Y),this.prependListener(X,v(this,X,Y)),this},s.prototype.removeListener=function(X,Y){var it,nt,wt,Ct,st;if(o(Y),nt=this._events,nt===void 0)return this;if(it=nt[X],it===void 0)return this;if(it===Y||it.listener===Y)--this._eventsCount===0?this._events=Object.create(null):(delete nt[X],nt.removeListener&&this.emit("removeListener",X,it.listener||Y));else if(typeof it!="function"){for(wt=-1,Ct=it.length-1;Ct>=0;Ct--)if(it[Ct]===Y||it[Ct].listener===Y){st=it[Ct].listener,wt=Ct;break}if(wt<0)return this;wt===0?it.shift():F(it,wt),it.length===1&&(nt[X]=it[0]),nt.removeListener!==void 0&&this.emit("removeListener",X,st||Y)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(X){var Y,it,nt;if(it=this._events,it===void 0)return this;if(it.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):it[X]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete it[X]),this;if(arguments.length===0){var wt=Object.keys(it),Ct;for(nt=0;nt<wt.length;++nt)Ct=wt[nt],Ct!=="removeListener"&&this.removeAllListeners(Ct);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Y=it[X],typeof Y=="function")this.removeListener(X,Y);else if(Y!==void 0)for(nt=Y.length-1;nt>=0;nt--)this.removeListener(X,Y[nt]);return this};function C(G,X,Y){var it=G._events;if(it===void 0)return[];var nt=it[X];return nt===void 0?[]:typeof nt=="function"?Y?[nt.listener||nt]:[nt]:Y?U(nt):P(nt,nt.length)}s.prototype.listeners=function(X){return C(this,X,!0)},s.prototype.rawListeners=function(X){return C(this,X,!1)},s.listenerCount=function(G,X){return typeof G.listenerCount=="function"?G.listenerCount(X):b.call(G,X)},s.prototype.listenerCount=b;function b(G){var X=this._events;if(X!==void 0){var Y=X[G];if(typeof Y=="function")return 1;if(Y!==void 0)return Y.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function P(G,X){for(var Y=new Array(X),it=0;it<X;++it)Y[it]=G[it];return Y}function F(G,X){for(;X+1<G.length;X++)G[X]=G[X+1];G.pop()}function U(G){for(var X=new Array(G.length),Y=0;Y<X.length;++Y)X[Y]=G[Y].listener||G[Y];return X}function k(G,X){return new Promise(function(Y,it){function nt(Ct){G.removeListener(X,wt),it(Ct)}function wt(){typeof G.removeListener=="function"&&G.removeListener("error",nt),Y([].slice.call(arguments))}K(G,X,wt,{once:!0}),X!=="error"&&z(G,nt,{once:!0})})}function z(G,X,Y){typeof G.on=="function"&&K(G,"error",X,Y)}function K(G,X,Y,it){if(typeof G.on=="function")it.once?G.once(X,Y):G.on(X,Y);else if(typeof G.addEventListener=="function")G.addEventListener(X,function nt(wt){it.once&&G.removeEventListener(X,nt),Y(wt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G)}return Iy.exports}var Uit=Oit();const JF={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};var Dg={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},errorNoResults:{en:"No results found",de:"Keine Ergebnisse gefunden"},errorConnectionFailed:{en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"}};const Dit=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class Nit{constructor(t,e){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:n=>n.text!==void 0?n.text:n.place_name,render:function(n){if(!n.geometry){const s=n.text,a=s.toLowerCase().indexOf(this.query.toLowerCase()),o=this.query.length,d=s.substring(0,a),f=s.substring(a,a+o),m=s.substring(a+o);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+d+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+f+"</span>"+m+"</div></div></div>"}const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+i.splice(1,i.length).join(",")+"</div></div></div>"},popupRender:n=>{const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+i.splice(1,i.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new Uit.EventEmitter,this.options=Dc({},this.options,e),this.fresh=!0,this.lastSelected=null,this.geocoderApi=t}addTo(t){function e(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=n.onAdd();i.appendChild(s)}if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const n=document.querySelectorAll(t);if(n.length===0)throw new Error("Element "+t+"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,n[0])}else if("addControl"in t)t.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const e=this.container=document.createElement("div");e.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Lit(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const i=document.createElement("div");i.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),e.appendChild(n),e.appendChild(this._inputEl),e.appendChild(i),this._typeahead=new Eit(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e}createIcon(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+t),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width","18"),n.setAttribute("height","18"),"innerHTML"in n)n.innerHTML=e;else{const i=document.createElement("div");i.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";const s=i.firstChild,a=s.firstChild;n.appendChild(a)}return n}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(t){const e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)}_onKeyDown(t){if(t.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();const s=this._inputEl.value;if(!s)return this.fresh=!0,t.keyCode!==9&&this.clear(t),this._clearEl.style.display="none";if(!(t.metaKey||[9,27,37,39,38,40].indexOf(t.keyCode)!==-1)){if(t.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(s);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(s,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}s.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(s)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()}_onChange(){const t=this._typeahead.selected;if(t&&!t.geometry)t.placeId?this._geocode(t.placeId,!0,!0):this._geocode(t.text,!0);else if(t&&JSON.stringify(t)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let e;if(this._removeResultMarkers(),t.properties&&JF[t.properties.short_code])e=Dc({},this.options.flyTo),this._map&&this._map.fitBounds(JF[t.properties.short_code].bbox,e);else if(t.bbox){const n=t.bbox;e=Dc({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],e)}else{const n={zoom:this.options.zoom};e=Dc({},n,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:t})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((n,i)=>(this.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=this.options[i].split(/[\s,]+/):n[i]=this.options[i],i==="proximity"&&this.options[i]&&typeof this.options[i].longitude=="number"&&typeof this.options[i].latitude=="number"&&(n[i]=[this.options[i].longitude,this.options[i].latitude])),n),{})}_geocode(t){return u2(this,arguments,void 0,function(e){var n=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){n._loadingEl.style.display="block",n._eventEmitter.emit("loading",{query:e});const a=n._getConfigForRequest(),o=n._createGeocodeRequest(a,e,i,s),d=n.options.localGeocoder?n.options.localGeocoder(e)||[]:[];try{const f=yield o;yield n._handleGeocodeResponse(f,a,e,i,d)}catch(f){n._handleGeocodeErrorResponse(f,d)}return o}()})}_createGeocodeRequest(t,e,n,i){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&Dit.test(e)?this._createReverseGeocodeRequest(e,t):(t.query=e,this.geocoderApi.getSuggestions?n?this.geocoderApi.searchByPlaceId&&i?this.geocoderApi.searchByPlaceId(t):this.geocoderApi.forwardGeocode(t):this.geocoderApi.getSuggestions(t):this.geocoderApi.forwardGeocode(t))}_createReverseGeocodeRequest(t,e){const n=t.split(/[\s(,)?]+/).map(i=>parseFloat(i)).reverse();return e.query=n,e.limit=1,"proximity"in e&&delete e.proximity,this.geocoderApi.reverseGeocode(e)}_handleGeocodeResponse(t,e,n,i,s){return u2(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let a={};t?a=t:a={type:"FeatureCollection",features:[]},a.config=e,this.fresh&&(this.fresh=!1),a.features=a.features?s.concat(a.features):s;const o=this.options.externalGeocoder?this.options.externalGeocoder(n,a.features,e)||Promise.resolve([]):Promise.resolve([]);try{const f=yield o;a.features=a.features?f.concat(a.features):f}catch{}this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter));let d=[];"suggestions"in a?d=a.suggestions:"place"in a?d=[a.place]:d=a.features,d.length?(this._clearEl.style.display="block",this._typeahead.update(d),(!this.options.showResultsWhileTyping||i)&&this.options.showResultMarkers&&(a.features.length>0||"place"in a)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",a)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))})}_handleGeocodeErrorResponse(t,e){this._loadingEl.style.display="none",e.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(e)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:e}),this._eventEmitter.emit("error",{error:t})}_clear(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(t){this._clear(t),this._inputEl.focus()}_clearOnBlur(t){t.relatedTarget&&this._clear(t)}_onQueryResult(t){if(!("features"in t)||!t.features.length)return;const e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(t){return u2(this,void 0,void 0,function*(){const e=yield this._geocode(t);this._onQueryResult(e)})}_renderError(){const t=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(t)}_renderNoResults(){const t=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(t)}_renderMessage(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)}_localize(t){const e=Pit.language(this.options.language.split(",")[0]);return this.options.language&&(Dg!=null&&Dg[t][e])?Dg[t][e]:Dg[t].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const t=this._typeahead.data.filter(e=>typeof e!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const n=Dc({},{padding:100},this.options.flyTo),i=new this._maplibregl.LngLatBounds;for(const s of t)i.extend(s.geometry.coordinates);this._map.fitBounds(i,n)}return t.length>0&&this._maplibregl&&this._handleResultMarkers(t),this}setInput(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t),this}setProximity(t){return this.options.proximity=t,this}getProximity(){return this.options.proximity}setRenderFunction(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this}getRenderFunction(){return this._typeahead.render}setLanguage(t){return this.options.language=t||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(t){return this.options.zoom=t,this}getFlyTo(){return this.options.flyTo}setFlyTo(t){return this.options.flyTo=t,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(t){return this.placeholder=t||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(t){return this.options.bbox=t,this}getCountries(){return this.options.countries}setCountries(t){return this.options.countries=t,this}getTypes(){return this.options.types}setTypes(t){return this.options.types=t,this}getMinLength(){return this.options.minLength}setMinLength(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this}getLimit(){return this.options.limit}setLimit(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this}getFilter(){return this.options.filter}setFilter(t){return this.options.filter=t,this}setGeocoderApi(t){return this.geocoderApi=t,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(t){if(!this._map)return;this._removeMarker();const n=Dc({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(n);let i;if(this.options.popup){const a=Dc({},{},this.options.popup);i=new this._maplibregl.Popup(a).setHTML(this.options.popupRender(t))}return t.center?(this.mapMarker.setLngLat(t.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(t){if(!this._map)return;this._removeResultMarkers();let n=Dc({},{color:"#4668F2"},this.options.showResultMarkers);for(const i of t){let s;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(s=this.options.showResultMarkers.element.cloneNode(!0),n=Dc(n,{element:s}));const a=new this._maplibregl.Marker(Dc({},n,{element:s}));let o;if(this.options.popup){const f=Dc({},{},this.options.popup);o=new this._maplibregl.Popup(f).setHTML(this.options.popupRender(i))}i.center?(a.setLngLat(i.center).addTo(this._map),this.options.popup&&a.setPopup(o)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(a.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&a.setPopup(o)),this.resultMarkers.push(a)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(t){t.remove()}),this.resultMarkers=[])}on(t,e){return this._eventEmitter.on(t,e),this}once(t){return new Promise(e=>{this._eventEmitter.once(t,e)})}off(t,e){return this._eventEmitter.removeListener(t,e),this}}const bd={defaultOptions:{limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogràfic i Geològic de Catalunya",logoWidth:100,logoOpacity:.6},logoGencatOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100,logoOpacity:.6},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://eines.icgc.cat/recursos//images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTO3D",url:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTOHYBRID",url:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{key:"RASTER",substyles:{TOPO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},ADMIN:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},LIGHT:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},STANDARD:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},Simplified:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},ORTO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},ORTOGREY:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},ORTOHYBRID:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2023",key:"ortofoto_color_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2023",key:"ortofoto_infraroig_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Styles:{TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:{Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};class kit{constructor(t){this.options=t||{}}onAdd(t){let e=bd.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this._img1.style.opacity=e.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this._img2.style.opacity=e.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class Qit{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var jf=tL.prototype,m2="WGS 84";function tL(r){r!==void 0&&(m2=r),this.setEllipsoid(m2)}jf.convertLatLngToUtm=function(r,t,e){var n;if(this.status)return"No ecclipsoid data associated with unknown datum: "+m2;if(!Number.isInteger(e))return"Precision is not integer number.";r=parseFloat(r),t=parseFloat(t);var i=t,s=this.toRadians(r),a=this.toRadians(i);i>=8&&i<=13&&r>54.5&&r<58||r>=56&&r<64&&i>=3&&i<12?n=32:(n=(i+180)/6+1,r>=72&&r<84&&(i>=0&&i<9?n=31:i>=9&&i<21?n=33:i>=21&&i<33?n=35:i>=33&&i<42&&(n=37))),n=parseInt(n);var o=(n-1)*6-180+3,d=this.toRadians(o),f=this.getUtmLetterDesignator(r),m=this.eccSquared/(1-this.eccSquared),v=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),C=Math.tan(s)*Math.tan(s),b=m*Math.cos(s)*Math.cos(s),P=Math.cos(s)*(a-d),F=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),U=parseFloat(.9996*v*(P+(1-C+b)*P*P*P/6+(5-18*C+C*C+72*b-58*m)*P*P*P*P*P/120)+5e5),k=parseFloat(.9996*(F+v*Math.tan(s)*(P*P/2+(5-C+9*b+4*b*b)*P*P*P*P/24+(61-58*C+C*C+600*b-330*m)*P*P*P*P*P*P/720)));return r<0&&(k+=1e7),k=eL(k,e),U=eL(U,e),{Easting:U,Northing:k,ZoneNumber:parseInt(n),ZoneLetter:f}},jf.convertUtmToLatLng=function(r,t,e,n){var i=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=r-5e5,a=t,o=e,d=n;if(r===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(n===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(d)!==-1||(a-=1e7);var f=(o-1)*6-180+3,m=this.eccSquared/(1-this.eccSquared),v=a/.9996,C=v/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),b=C+(3*i/2-27*i*i*i/32)*Math.sin(2*C)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*C)+151*i*i*i/96*Math.sin(6*C);this.toDegrees(b);var P=this.a/Math.sqrt(1-this.eccSquared*Math.sin(b)*Math.sin(b)),F=Math.tan(b)*Math.tan(b),U=m*Math.cos(b)*Math.cos(b),k=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(b)*Math.sin(b),1.5),z=s/(P*.9996),K=b-P*Math.tan(b)/k*(z*z/2-(5+3*F+10*U-4*U*U-9*m)*z*z*z*z/24+(61+90*F+298*U+45*F*F-252*m-3*U*U)*z*z*z*z*z*z/720);K=this.toDegrees(K);var G=(z-(1+2*F+U)*z*z*z/6+(5-2*U+28*F-3*U*U+8*m+24*F*F)*z*z*z*z*z/120)/Math.cos(b);return G=f+this.toDegrees(G),{lat:K,lng:G}},jf.getUtmLetterDesignator=function(r){return r=parseFloat(r),84>=r&&r>=72?"X":72>r&&r>=64?"W":64>r&&r>=56?"V":56>r&&r>=48?"U":48>r&&r>=40?"T":40>r&&r>=32?"S":32>r&&r>=24?"R":24>r&&r>=16?"Q":16>r&&r>=8?"P":8>r&&r>=0?"N":0>r&&r>=-8?"M":-8>r&&r>=-16?"L":-16>r&&r>=-24?"K":-24>r&&r>=-32?"J":-32>r&&r>=-40?"H":-40>r&&r>=-48?"G":-48>r&&r>=-56?"F":-56>r&&r>=-64?"E":-64>r&&r>=-72?"D":-72>r&&r>=-80?"C":"Z"},jf.setEllipsoid=function(r){switch(r){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},jf.toDegrees=function(r){return r/Math.PI*180},jf.toRadians=function(r){return r*Math.PI/180};function eL(r,t){var e=Math.pow(10,t);return Math.round(r*e)/e}var zit=tL;const Hit=Km(zit);class Vit{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new Hit;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const d=e.convertLatLngToUtm(i,s,2),f=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${d.ZoneNumber}${f} X:<b> ${d.Easting}</b> Y:<b> ${d.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const m=`${a}${o}`;this._container.innerHTML=m}),this._container}_lookUTM31(t,e){var n=0,i=0,s=6,a=84;return t>=n&&t<=s&&e>=i&&e<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function rL(r,t){return function(){return r.apply(t,arguments)}}const{toString:Git}=Object.prototype,{getPrototypeOf:y2}=Object,Py=(r=>t=>{const e=Git.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Nc=r=>(r=r.toLowerCase(),t=>Py(t)===r),My=r=>t=>typeof t===r,{isArray:qf}=Array,Ng=My("undefined");function jit(r){return r!==null&&!Ng(r)&&r.constructor!==null&&!Ng(r.constructor)&&Cl(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const nL=Nc("ArrayBuffer");function qit(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&nL(r.buffer),t}const Kit=My("string"),Cl=My("function"),iL=My("number"),Fy=r=>r!==null&&typeof r=="object",Wit=r=>r===!0||r===!1,Ly=r=>{if(Py(r)!=="object")return!1;const t=y2(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},$it=Nc("Date"),Xit=Nc("File"),Zit=Nc("Blob"),Yit=Nc("FileList"),Jit=r=>Fy(r)&&Cl(r.pipe),tst=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||Cl(r.append)&&((t=Py(r))==="formdata"||t==="object"&&Cl(r.toString)&&r.toString()==="[object FormData]"))},est=Nc("URLSearchParams"),[rst,nst,ist,sst]=["ReadableStream","Request","Response","Headers"].map(Nc),ost=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function kg(r,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),qf(r))for(n=0,i=r.length;n<i;n++)t.call(null,r[n],n,r);else{const s=e?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],t.call(null,r[o],o,r)}}function sL(r,t){t=t.toLowerCase();const e=Object.keys(r);let n=e.length,i;for(;n-- >0;)if(i=e[n],t===i.toLowerCase())return i;return null}const wd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,oL=r=>!Ng(r)&&r!==wd;function _2(){const{caseless:r}=oL(this)&&this||{},t={},e=(n,i)=>{const s=r&&sL(t,i)||i;Ly(t[s])&&Ly(n)?t[s]=_2(t[s],n):Ly(n)?t[s]=_2({},n):qf(n)?t[s]=n.slice():t[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&kg(arguments[n],e);return t}const ast=function(r,t,e){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return kg(t,(i,s)=>{e&&Cl(i)?r[s]=rL(i,e):r[s]=i},{allOwnKeys:n}),r},lst=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),cst=(r,t,e,n)=>{r.prototype=Object.create(t.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},ust=(r,t,e,n)=>{let i,s,a;const o={};if(t=t||{},r==null)return t;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,t))&&!o[a]&&(t[a]=r[a],o[a]=!0);r=e!==!1&&y2(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},hst=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;const n=r.indexOf(t,e);return n!==-1&&n===e},Ast=r=>{if(!r)return null;if(qf(r))return r;let t=r.length;if(!iL(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},dst=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&y2(Uint8Array)),fst=(r,t)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(r,s[0],s[1])}},pst=(r,t)=>{let e;const n=[];for(;(e=r.exec(t))!==null;)n.push(e);return n},gst=Nc("HTMLFormElement"),mst=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),aL=(r=>{let{hasOwnProperty:t}=r;return(e,n)=>t.call(e,n)})(Object.prototype),yst=Nc("RegExp"),lL=(r,t)=>{const e=Object.getOwnPropertyDescriptors(r),n={};kg(e,(i,s)=>{let a;(a=t(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},_st=r=>{lL(r,(t,e)=>{if(Cl(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const n=r[e];if(Cl(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},vst=(r,t)=>{const e={},n=i=>{i.forEach(s=>{e[s]=!0})};return qf(r)?n(r):n(String(r).split(t)),e},bst=()=>{},wst=(r,t)=>r!=null&&Number.isFinite(r=+r)?r:t,v2="abcdefghijklmnopqrstuvwxyz",cL="0123456789",uL={DIGIT:cL,ALPHA:v2,ALPHA_DIGIT:v2+v2.toUpperCase()+cL},xst=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uL.ALPHA_DIGIT,e="";const{length:n}=t;for(;r--;)e+=t[Math.random()*n|0];return e};function Bst(r){return!!(r&&Cl(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Cst=r=>{const t=new Array(10),e=(n,i)=>{if(Fy(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const s=qf(n)?[]:{};return kg(n,(a,o)=>{const d=e(a,i+1);!Ng(d)&&(s[o]=d)}),t[i]=void 0,s}}return n};return e(r,0)},Est=Nc("AsyncFunction"),Tst=r=>r&&(Fy(r)||Cl(r))&&Cl(r.then)&&Cl(r.catch),hL=((r,t)=>r?setImmediate:t?((e,n)=>(wd.addEventListener("message",i=>{let{source:s,data:a}=i;s===wd&&a===e&&n.length&&n.shift()()},!1),i=>{n.push(i),wd.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Cl(wd.postMessage)),Sst=typeof queueMicrotask<"u"?queueMicrotask.bind(wd):typeof process<"u"&&process.nextTick||hL,He={isArray:qf,isArrayBuffer:nL,isBuffer:jit,isFormData:tst,isArrayBufferView:qit,isString:Kit,isNumber:iL,isBoolean:Wit,isObject:Fy,isPlainObject:Ly,isReadableStream:rst,isRequest:nst,isResponse:ist,isHeaders:sst,isUndefined:Ng,isDate:$it,isFile:Xit,isBlob:Zit,isRegExp:yst,isFunction:Cl,isStream:Jit,isURLSearchParams:est,isTypedArray:dst,isFileList:Yit,forEach:kg,merge:_2,extend:ast,trim:ost,stripBOM:lst,inherits:cst,toFlatObject:ust,kindOf:Py,kindOfTest:Nc,endsWith:hst,toArray:Ast,forEachEntry:fst,matchAll:pst,isHTMLForm:gst,hasOwnProperty:aL,hasOwnProp:aL,reduceDescriptors:lL,freezeMethods:_st,toObjectSet:vst,toCamelCase:mst,noop:bst,toFiniteNumber:wst,findKey:sL,global:wd,isContextDefined:oL,ALPHABET:uL,generateString:xst,isSpecCompliantForm:Bst,toJSONObject:Cst,isAsyncFn:Est,isThenable:Tst,setImmediate:hL,asap:Sst};function Tn(r,t,e,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}He.inherits(Tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:He.toJSONObject(this.config),code:this.code,status:this.status}}});const AL=Tn.prototype,dL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{dL[r]={value:r}}),Object.defineProperties(Tn,dL),Object.defineProperty(AL,"isAxiosError",{value:!0}),Tn.from=(r,t,e,n,i,s)=>{const a=Object.create(AL);return He.toFlatObject(r,a,function(d){return d!==Error.prototype},o=>o!=="isAxiosError"),Tn.call(a,r.message,t,e,n,i),a.cause=r,a.name=r.name,s&&Object.assign(a,s),a};const Ist=null;function b2(r){return He.isPlainObject(r)||He.isArray(r)}function fL(r){return He.endsWith(r,"[]")?r.slice(0,-2):r}function pL(r,t,e){return r?r.concat(t).map(function(i,s){return i=fL(i),!e&&s?"["+i+"]":i}).join(e?".":""):t}function Pst(r){return He.isArray(r)&&!r.some(b2)}const Mst=He.toFlatObject(He,{},null,function(t){return/^is[A-Z]/.test(t)});function Ry(r,t,e){if(!He.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,e=He.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(F,U){return!He.isUndefined(U[F])});const n=e.metaTokens,i=e.visitor||m,s=e.dots,a=e.indexes,d=(e.Blob||typeof Blob<"u"&&Blob)&&He.isSpecCompliantForm(t);if(!He.isFunction(i))throw new TypeError("visitor must be a function");function f(P){if(P===null)return"";if(He.isDate(P))return P.toISOString();if(!d&&He.isBlob(P))throw new Tn("Blob is not supported. Use a Buffer instead.");return He.isArrayBuffer(P)||He.isTypedArray(P)?d&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function m(P,F,U){let k=P;if(P&&!U&&typeof P=="object"){if(He.endsWith(F,"{}"))F=n?F:F.slice(0,-2),P=JSON.stringify(P);else if(He.isArray(P)&&Pst(P)||(He.isFileList(P)||He.endsWith(F,"[]"))&&(k=He.toArray(P)))return F=fL(F),k.forEach(function(K,G){!(He.isUndefined(K)||K===null)&&t.append(a===!0?pL([F],G,s):a===null?F:F+"[]",f(K))}),!1}return b2(P)?!0:(t.append(pL(U,F,s),f(P)),!1)}const v=[],C=Object.assign(Mst,{defaultVisitor:m,convertValue:f,isVisitable:b2});function b(P,F){if(!He.isUndefined(P)){if(v.indexOf(P)!==-1)throw Error("Circular reference detected in "+F.join("."));v.push(P),He.forEach(P,function(k,z){(!(He.isUndefined(k)||k===null)&&i.call(t,k,He.isString(z)?z.trim():z,F,C))===!0&&b(k,F?F.concat(z):[z])}),v.pop()}}if(!He.isObject(r))throw new TypeError("data must be an object");return b(r),t}function gL(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function w2(r,t){this._pairs=[],r&&Ry(r,this,t)}const mL=w2.prototype;mL.append=function(t,e){this._pairs.push([t,e])},mL.toString=function(t){const e=t?function(n){return t.call(this,n,gL)}:gL;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function Fst(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function yL(r,t,e){if(!t)return r;const n=e&&e.encode||Fst;He.isFunction(e)&&(e={serialize:e});const i=e&&e.serialize;let s;if(i?s=i(t,e):s=He.isURLSearchParams(t)?t.toString():new w2(t,e).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class _L{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){He.forEach(this.handlers,function(n){n!==null&&t(n)})}}const vL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Lst={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:w2,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},x2=typeof window<"u"&&typeof document<"u",B2=typeof navigator=="object"&&navigator||void 0,Rst=x2&&(!B2||["ReactNative","NativeScript","NS"].indexOf(B2.product)<0),Ost=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ust=x2&&window.location.href||"http://localhost",ha={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:x2,hasStandardBrowserEnv:Rst,hasStandardBrowserWebWorkerEnv:Ost,navigator:B2,origin:Ust},Symbol.toStringTag,{value:"Module"})),...Lst};function Dst(r,t){return Ry(r,new ha.classes.URLSearchParams,Object.assign({visitor:function(e,n,i,s){return ha.isNode&&He.isBuffer(e)?(this.append(n,e.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function Nst(r){return He.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function kst(r){const t={},e=Object.keys(r);let n;const i=e.length;let s;for(n=0;n<i;n++)s=e[n],t[s]=r[s];return t}function bL(r){function t(e,n,i,s){let a=e[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),d=s>=e.length;return a=!a&&He.isArray(i)?i.length:a,d?(He.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!He.isObject(i[a]))&&(i[a]=[]),t(e,n,i[a],s)&&He.isArray(i[a])&&(i[a]=kst(i[a])),!o)}if(He.isFormData(r)&&He.isFunction(r.entries)){const e={};return He.forEachEntry(r,(n,i)=>{t(Nst(n),i,e,0)}),e}return null}function Qst(r,t,e){if(He.isString(r))try{return(t||JSON.parse)(r),He.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(0,JSON.stringify)(r)}const Qg={transitional:vL,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,s=He.isObject(t);if(s&&He.isHTMLForm(t)&&(t=new FormData(t)),He.isFormData(t))return i?JSON.stringify(bL(t)):t;if(He.isArrayBuffer(t)||He.isBuffer(t)||He.isStream(t)||He.isFile(t)||He.isBlob(t)||He.isReadableStream(t))return t;if(He.isArrayBufferView(t))return t.buffer;if(He.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Dst(t,this.formSerializer).toString();if((o=He.isFileList(t))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Ry(o?{"files[]":t}:t,d&&new d,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),Qst(t)):t}],transformResponse:[function(t){const e=this.transitional||Qg.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(He.isResponse(t)||He.isReadableStream(t))return t;if(t&&He.isString(t)&&(n&&!this.responseType||i)){const a=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(a)throw o.name==="SyntaxError"?Tn.from(o,Tn.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ha.classes.FormData,Blob:ha.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};He.forEach(["delete","get","head","post","put","patch"],r=>{Qg.headers[r]={}});const zst=He.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hst=r=>{const t={};let e,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),e=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!e||t[e]&&zst[e])&&(e==="set-cookie"?t[e]?t[e].push(n):t[e]=[n]:t[e]=t[e]?t[e]+", "+n:n)}),t},wL=Symbol("internals");function zg(r){return r&&String(r).trim().toLowerCase()}function Oy(r){return r===!1||r==null?r:He.isArray(r)?r.map(Oy):String(r)}function Vst(r){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=e.exec(r);)t[n[1]]=n[2];return t}const Gst=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function C2(r,t,e,n,i){if(He.isFunction(n))return n.call(this,t,e);if(i&&(t=e),!!He.isString(t)){if(He.isString(n))return t.indexOf(n)!==-1;if(He.isRegExp(n))return n.test(t)}}function jst(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,n)=>e.toUpperCase()+n)}function qst(r,t){const e=He.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+e,{value:function(i,s,a){return this[n].call(this,t,i,s,a)},configurable:!0})})}class tl{constructor(t){t&&this.set(t)}set(t,e,n){const i=this;function s(o,d,f){const m=zg(d);if(!m)throw new Error("header name must be a non-empty string");const v=He.findKey(i,m);(!v||i[v]===void 0||f===!0||f===void 0&&i[v]!==!1)&&(i[v||d]=Oy(o))}const a=(o,d)=>He.forEach(o,(f,m)=>s(f,m,d));if(He.isPlainObject(t)||t instanceof this.constructor)a(t,e);else if(He.isString(t)&&(t=t.trim())&&!Gst(t))a(Hst(t),e);else if(He.isHeaders(t))for(const[o,d]of t.entries())s(d,o,n);else t!=null&&s(e,t,n);return this}get(t,e){if(t=zg(t),t){const n=He.findKey(this,t);if(n){const i=this[n];if(!e)return i;if(e===!0)return Vst(i);if(He.isFunction(e))return e.call(this,i,n);if(He.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=zg(t),t){const n=He.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||C2(this,this[n],n,e)))}return!1}delete(t,e){const n=this;let i=!1;function s(a){if(a=zg(a),a){const o=He.findKey(n,a);o&&(!e||C2(n,n[o],o,e))&&(delete n[o],i=!0)}}return He.isArray(t)?t.forEach(s):s(t),i}clear(t){const e=Object.keys(this);let n=e.length,i=!1;for(;n--;){const s=e[n];(!t||C2(this,this[s],s,t,!0))&&(delete this[s],i=!0)}return i}normalize(t){const e=this,n={};return He.forEach(this,(i,s)=>{const a=He.findKey(n,s);if(a){e[a]=Oy(i),delete e[s];return}const o=t?jst(s):String(s).trim();o!==s&&delete e[s],e[o]=Oy(i),n[o]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return He.forEach(this,(n,i)=>{n!=null&&n!==!1&&(e[i]=t&&He.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,n]=t;return e+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(a=>e.set(a)),e}static accessor(t){const n=(this[wL]=this[wL]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=zg(a);n[o]||(qst(i,a),n[o]=!0)}return He.isArray(t)?t.forEach(s):s(t),this}}tl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),He.reduceDescriptors(tl.prototype,(r,t)=>{let{value:e}=r,n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(i){this[n]=i}}}),He.freezeMethods(tl);function E2(r,t){const e=this||Qg,n=t||e,i=tl.from(n.headers);let s=n.data;return He.forEach(r,function(o){s=o.call(e,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function xL(r){return!!(r&&r.__CANCEL__)}function Kf(r,t,e){Tn.call(this,r??"canceled",Tn.ERR_CANCELED,t,e),this.name="CanceledError"}He.inherits(Kf,Tn,{__CANCEL__:!0});function BL(r,t,e){const n=e.config.validateStatus;!e.status||!n||n(e.status)?r(e):t(new Tn("Request failed with status code "+e.status,[Tn.ERR_BAD_REQUEST,Tn.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Kst(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function Wst(r,t){r=r||10;const e=new Array(r),n=new Array(r);let i=0,s=0,a;return t=t!==void 0?t:1e3,function(d){const f=Date.now(),m=n[s];a||(a=f),e[i]=d,n[i]=f;let v=s,C=0;for(;v!==i;)C+=e[v++],v=v%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),f-a<t)return;const b=m&&f-m;return b?Math.round(C*1e3/b):void 0}}function $st(r,t){let e=0,n=1e3/t,i,s;const a=function(f){e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),i=null,s&&(clearTimeout(s),s=null),r.apply(null,f)};return[function(){const f=Date.now(),m=f-e;for(var v=arguments.length,C=new Array(v),b=0;b<v;b++)C[b]=arguments[b];m>=n?a(C,f):(i=C,s||(s=setTimeout(()=>{s=null,a(i)},n-m)))},()=>i&&a(i)]}const Uy=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0;const i=Wst(50,250);return $st(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,d=a-n,f=i(d),m=a<=o;n=a;const v={loaded:a,total:o,progress:o?a/o:void 0,bytes:d,rate:f||void 0,estimated:f&&o&&m?(o-a)/f:void 0,event:s,lengthComputable:o!=null,[t?"download":"upload"]:!0};r(v)},e)},CL=(r,t)=>{const e=r!=null;return[n=>t[0]({lengthComputable:e,total:r,loaded:n}),t[1]]},EL=r=>function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return He.asap(()=>r(...e))},Xst=ha.hasStandardBrowserEnv?((r,t)=>e=>(e=new URL(e,ha.origin),r.protocol===e.protocol&&r.host===e.host&&(t||r.port===e.port)))(new URL(ha.origin),ha.navigator&&/(msie|trident)/i.test(ha.navigator.userAgent)):()=>!0,Zst=ha.hasStandardBrowserEnv?{write(r,t,e,n,i,s){const a=[r+"="+encodeURIComponent(t)];He.isNumber(e)&&a.push("expires="+new Date(e).toGMTString()),He.isString(n)&&a.push("path="+n),He.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Yst(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Jst(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function TL(r,t){return r&&!Yst(t)?Jst(r,t):t}const SL=r=>r instanceof tl?{...r}:r;function xd(r,t){t=t||{};const e={};function n(f,m,v,C){return He.isPlainObject(f)&&He.isPlainObject(m)?He.merge.call({caseless:C},f,m):He.isPlainObject(m)?He.merge({},m):He.isArray(m)?m.slice():m}function i(f,m,v,C){if(He.isUndefined(m)){if(!He.isUndefined(f))return n(void 0,f,v,C)}else return n(f,m,v,C)}function s(f,m){if(!He.isUndefined(m))return n(void 0,m)}function a(f,m){if(He.isUndefined(m)){if(!He.isUndefined(f))return n(void 0,f)}else return n(void 0,m)}function o(f,m,v){if(v in t)return n(f,m);if(v in r)return n(void 0,f)}const d={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(f,m,v)=>i(SL(f),SL(m),v,!0)};return He.forEach(Object.keys(Object.assign({},r,t)),function(m){const v=d[m]||i,C=v(r[m],t[m],m);He.isUndefined(C)&&v!==o||(e[m]=C)}),e}const IL=r=>{const t=xd({},r);let{data:e,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=t;t.headers=a=tl.from(a),t.url=yL(TL(t.baseURL,t.url),r.params,r.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let d;if(He.isFormData(e)){if(ha.hasStandardBrowserEnv||ha.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((d=a.getContentType())!==!1){const[f,...m]=d?d.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([f||"multipart/form-data",...m].join("; "))}}if(ha.hasStandardBrowserEnv&&(n&&He.isFunction(n)&&(n=n(t)),n||n!==!1&&Xst(t.url))){const f=i&&s&&Zst.read(s);f&&a.set(i,f)}return t},tot=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(e,n){const i=IL(r);let s=i.data;const a=tl.from(i.headers).normalize();let{responseType:o,onUploadProgress:d,onDownloadProgress:f}=i,m,v,C,b,P;function F(){b&&b(),P&&P(),i.cancelToken&&i.cancelToken.unsubscribe(m),i.signal&&i.signal.removeEventListener("abort",m)}let U=new XMLHttpRequest;U.open(i.method.toUpperCase(),i.url,!0),U.timeout=i.timeout;function k(){if(!U)return;const K=tl.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders()),X={data:!o||o==="text"||o==="json"?U.responseText:U.response,status:U.status,statusText:U.statusText,headers:K,config:r,request:U};BL(function(it){e(it),F()},function(it){n(it),F()},X),U=null}"onloadend"in U?U.onloadend=k:U.onreadystatechange=function(){!U||U.readyState!==4||U.status===0&&!(U.responseURL&&U.responseURL.indexOf("file:")===0)||setTimeout(k)},U.onabort=function(){U&&(n(new Tn("Request aborted",Tn.ECONNABORTED,r,U)),U=null)},U.onerror=function(){n(new Tn("Network Error",Tn.ERR_NETWORK,r,U)),U=null},U.ontimeout=function(){let G=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const X=i.transitional||vL;i.timeoutErrorMessage&&(G=i.timeoutErrorMessage),n(new Tn(G,X.clarifyTimeoutError?Tn.ETIMEDOUT:Tn.ECONNABORTED,r,U)),U=null},s===void 0&&a.setContentType(null),"setRequestHeader"in U&&He.forEach(a.toJSON(),function(G,X){U.setRequestHeader(X,G)}),He.isUndefined(i.withCredentials)||(U.withCredentials=!!i.withCredentials),o&&o!=="json"&&(U.responseType=i.responseType),f&&([C,P]=Uy(f,!0),U.addEventListener("progress",C)),d&&U.upload&&([v,b]=Uy(d),U.upload.addEventListener("progress",v),U.upload.addEventListener("loadend",b)),(i.cancelToken||i.signal)&&(m=K=>{U&&(n(!K||K.type?new Kf(null,r,U):K),U.abort(),U=null)},i.cancelToken&&i.cancelToken.subscribe(m),i.signal&&(i.signal.aborted?m():i.signal.addEventListener("abort",m)));const z=Kst(i.url);if(z&&ha.protocols.indexOf(z)===-1){n(new Tn("Unsupported protocol "+z+":",Tn.ERR_BAD_REQUEST,r));return}U.send(s||null)})},eot=(r,t)=>{const{length:e}=r=r?r.filter(Boolean):[];if(t||e){let n=new AbortController,i;const s=function(f){if(!i){i=!0,o();const m=f instanceof Error?f:this.reason;n.abort(m instanceof Tn?m:new Kf(m instanceof Error?m.message:m))}};let a=t&&setTimeout(()=>{a=null,s(new Tn(`timeout ${t} of ms exceeded`,Tn.ETIMEDOUT))},t);const o=()=>{r&&(a&&clearTimeout(a),a=null,r.forEach(f=>{f.unsubscribe?f.unsubscribe(s):f.removeEventListener("abort",s)}),r=null)};r.forEach(f=>f.addEventListener("abort",s));const{signal:d}=n;return d.unsubscribe=()=>He.asap(o),d}},rot=function*(r,t){let e=r.byteLength;if(e<t){yield r;return}let n=0,i;for(;n<e;)i=n+t,yield r.slice(n,i),n=i},not=async function*(r,t){for await(const e of iot(r))yield*rot(e,t)},iot=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const t=r.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},PL=(r,t,e,n)=>{const i=not(r,t);let s=0,a,o=d=>{a||(a=!0,n&&n(d))};return new ReadableStream({async pull(d){try{const{done:f,value:m}=await i.next();if(f){o(),d.close();return}let v=m.byteLength;if(e){let C=s+=v;e(C)}d.enqueue(new Uint8Array(m))}catch(f){throw o(f),f}},cancel(d){return o(d),i.return()}},{highWaterMark:2})},Dy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ML=Dy&&typeof ReadableStream=="function",sot=Dy&&(typeof TextEncoder=="function"?(r=>t=>r.encode(t))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),FL=function(r){try{for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return!!r(...e)}catch{return!1}},oot=ML&&FL(()=>{let r=!1;const t=new Request(ha.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!t}),LL=64*1024,T2=ML&&FL(()=>He.isReadableStream(new Response("").body)),Ny={stream:T2&&(r=>r.body)};Dy&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Ny[t]&&(Ny[t]=He.isFunction(r[t])?e=>e[t]():(e,n)=>{throw new Tn(`Response type '${t}' is not supported`,Tn.ERR_NOT_SUPPORT,n)})})})(new Response);const aot=async r=>{if(r==null)return 0;if(He.isBlob(r))return r.size;if(He.isSpecCompliantForm(r))return(await new Request(ha.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(He.isArrayBufferView(r)||He.isArrayBuffer(r))return r.byteLength;if(He.isURLSearchParams(r)&&(r=r+""),He.isString(r))return(await sot(r)).byteLength},lot=async(r,t)=>{const e=He.toFiniteNumber(r.getContentLength());return e??aot(t)},S2={http:Ist,xhr:tot,fetch:Dy&&(async r=>{let{url:t,method:e,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:d,responseType:f,headers:m,withCredentials:v="same-origin",fetchOptions:C}=IL(r);f=f?(f+"").toLowerCase():"text";let b=eot([i,s&&s.toAbortSignal()],a),P;const F=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let U;try{if(d&&oot&&e!=="get"&&e!=="head"&&(U=await lot(m,n))!==0){let X=new Request(t,{method:"POST",body:n,duplex:"half"}),Y;if(He.isFormData(n)&&(Y=X.headers.get("content-type"))&&m.setContentType(Y),X.body){const[it,nt]=CL(U,Uy(EL(d)));n=PL(X.body,LL,it,nt)}}He.isString(v)||(v=v?"include":"omit");const k="credentials"in Request.prototype;P=new Request(t,{...C,signal:b,method:e.toUpperCase(),headers:m.normalize().toJSON(),body:n,duplex:"half",credentials:k?v:void 0});let z=await fetch(P);const K=T2&&(f==="stream"||f==="response");if(T2&&(o||K&&F)){const X={};["status","statusText","headers"].forEach(wt=>{X[wt]=z[wt]});const Y=He.toFiniteNumber(z.headers.get("content-length")),[it,nt]=o&&CL(Y,Uy(EL(o),!0))||[];z=new Response(PL(z.body,LL,it,()=>{nt&&nt(),F&&F()}),X)}f=f||"text";let G=await Ny[He.findKey(Ny,f)||"text"](z,r);return!K&&F&&F(),await new Promise((X,Y)=>{BL(X,Y,{data:G,headers:tl.from(z.headers),status:z.status,statusText:z.statusText,config:r,request:P})})}catch(k){throw F&&F(),k&&k.name==="TypeError"&&/fetch/i.test(k.message)?Object.assign(new Tn("Network Error",Tn.ERR_NETWORK,r,P),{cause:k.cause||k}):Tn.from(k,k&&k.code,r,P)}})};He.forEach(S2,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const RL=r=>`- ${r}`,cot=r=>He.isFunction(r)||r===null||r===!1,OL={getAdapter:r=>{r=He.isArray(r)?r:[r];const{length:t}=r;let e,n;const i={};for(let s=0;s<t;s++){e=r[s];let a;if(n=e,!cot(e)&&(n=S2[(a=String(e)).toLowerCase()],n===void 0))throw new Tn(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+s]=n}if(!n){const s=Object.entries(i).map(o=>{let[d,f]=o;return`adapter ${d} `+(f===!1?"is not supported by the environment":"is not available in the build")});let a=t?s.length>1?`since :
`+s.map(RL).join(`
`):" "+RL(s[0]):"as no adapter specified";throw new Tn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:S2};function I2(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Kf(null,r)}function UL(r){return I2(r),r.headers=tl.from(r.headers),r.data=E2.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),OL.getAdapter(r.adapter||Qg.adapter)(r).then(function(n){return I2(r),n.data=E2.call(r,r.transformResponse,n),n.headers=tl.from(n.headers),n},function(n){return xL(n)||(I2(r),n&&n.response&&(n.response.data=E2.call(r,r.transformResponse,n.response),n.response.headers=tl.from(n.response.headers))),Promise.reject(n)})}const DL="1.7.9",ky={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{ky[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});const NL={};ky.transitional=function(t,e,n){function i(s,a){return"[Axios v"+DL+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(t===!1)throw new Tn(i(a," has been removed"+(e?" in "+e:"")),Tn.ERR_DEPRECATED);return e&&!NL[a]&&(NL[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,a,o):!0}},ky.spelling=function(t){return(e,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function uot(r,t,e){if(typeof r!="object")throw new Tn("options must be an object",Tn.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const o=r[s],d=o===void 0||a(o,s,r);if(d!==!0)throw new Tn("option "+s+" must be "+d,Tn.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new Tn("Unknown option "+s,Tn.ERR_BAD_OPTION)}}const Qy={assertOptions:uot,validators:ky},zu=Qy.validators;class Bd{constructor(t){this.defaults=t,this.interceptors={request:new _L,response:new _L}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=xd(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:s}=e;n!==void 0&&Qy.assertOptions(n,{silentJSONParsing:zu.transitional(zu.boolean),forcedJSONParsing:zu.transitional(zu.boolean),clarifyTimeoutError:zu.transitional(zu.boolean)},!1),i!=null&&(He.isFunction(i)?e.paramsSerializer={serialize:i}:Qy.assertOptions(i,{encode:zu.function,serialize:zu.function},!0)),Qy.assertOptions(e,{baseUrl:zu.spelling("baseURL"),withXsrfToken:zu.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&He.merge(s.common,s[e.method]);s&&He.forEach(["delete","get","head","post","put","patch","common"],P=>{delete s[P]}),e.headers=tl.concat(a,s);const o=[];let d=!0;this.interceptors.request.forEach(function(F){typeof F.runWhen=="function"&&F.runWhen(e)===!1||(d=d&&F.synchronous,o.unshift(F.fulfilled,F.rejected))});const f=[];this.interceptors.response.forEach(function(F){f.push(F.fulfilled,F.rejected)});let m,v=0,C;if(!d){const P=[UL.bind(this),void 0];for(P.unshift.apply(P,o),P.push.apply(P,f),C=P.length,m=Promise.resolve(e);v<C;)m=m.then(P[v++],P[v++]);return m}C=o.length;let b=e;for(v=0;v<C;){const P=o[v++],F=o[v++];try{b=P(b)}catch(U){F.call(this,U);break}}try{m=UL.call(this,b)}catch(P){return Promise.reject(P)}for(v=0,C=f.length;v<C;)m=m.then(f[v++],f[v++]);return m}getUri(t){t=xd(this.defaults,t);const e=TL(t.baseURL,t.url);return yL(e,t.params,t.paramsSerializer)}}He.forEach(["delete","get","head","options"],function(t){Bd.prototype[t]=function(e,n){return this.request(xd(n||{},{method:t,url:e,data:(n||{}).data}))}}),He.forEach(["post","put","patch"],function(t){function e(n){return function(s,a,o){return this.request(xd(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Bd.prototype[t]=e(),Bd.prototype[t+"Form"]=e(!0)});class P2{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},t(function(s,a,o){n.reason||(n.reason=new Kf(s,a,o),e(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=n=>{t.abort(n)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new P2(function(i){t=i}),cancel:t}}}function hot(r){return function(e){return r.apply(null,e)}}function Aot(r){return He.isObject(r)&&r.isAxiosError===!0}const M2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(M2).forEach(r=>{let[t,e]=r;M2[e]=t});function kL(r){const t=new Bd(r),e=rL(Bd.prototype.request,t);return He.extend(e,Bd.prototype,t,{allOwnKeys:!0}),He.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return kL(xd(r,i))},e}const Zs=kL(Qg);Zs.Axios=Bd,Zs.CanceledError=Kf,Zs.CancelToken=P2,Zs.isCancel=xL,Zs.VERSION=DL,Zs.toFormData=Ry,Zs.AxiosError=Tn,Zs.Cancel=Zs.CanceledError,Zs.all=function(t){return Promise.all(t)},Zs.spread=hot,Zs.isAxiosError=Aot,Zs.mergeConfig=xd,Zs.AxiosHeaders=tl,Zs.formToJSON=r=>bL(He.isHTMLForm(r)?new FormData(r):r),Zs.getAdapter=OL.getAdapter,Zs.HttpStatusCode=M2,Zs.default=Zs;const dot="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",fot=5e3;class QL{static async getConfigICGC(){try{const t=await Zs.get(dot,{timeout:fot});return t.data?t.data:(console.log("Resposta sense dades:",t),bd)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),bd}}}const pot={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},got="lines",zy="labels";let Cd,Hg,ms,ni,mot=class{constructor(t){QL.getConfigICGC().then(e=>{Cd={...e.Styles},ms={...e.Layers},Hg={...e.Terrains},ni={...e.defaultOptions},this.initTheMap(t)}).catch(e=>{console.info("Configuracio per defecte",e),Cd={...bd.Styles},ms={...bd.Layers},Hg={...bd.Terrains},ni={...bd.defaultOptions},this.initTheMap(t)})}initTheMap(t){if(!t)t=ni.mapOptions;else for(const n in ni.mapOptions){let i=[ni.mapOptions.center[0],ni.mapOptions.center[1]];ni.mapOptions.center=i,t.hasOwnProperty(n)||(t[n]=ni.mapOptions[n])}t.maxPitch=85,t.maplibreLogo=!1,t.attributionControl=!1;const e=t.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");e?(this.map=new wo.Map({container:t.container,center:t.center,zoom:t.zoom,pitch:t.pitch||0,hash:t.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[t.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new wo.Map(t),this.map.on("load",()=>{if(!e){const n=this.map.getStyle().name,i=t.style;this.map.addControl(new kit({color:i.indexOf("orto")===-1,defaultOptions:ni}),"bottom-left"),this._dealOrto3dStyle(n)}})}addGeocoderICGC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top-right";try{t={...{collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:wo,showResultsWhileTyping:!0,minLength:2},...t};const i={forwardGeocode:async a=>{const o=[];try{const d=ni.geocoder.peliasUrl1+encodeURIComponent(a.query)+ni.geocoder.peliasUrl2,m=await(await fetch(d)).json();for(const v of m.features){const C=v.geometry.coordinates,b={type:"Feature",geometry:{type:"Point",coordinates:C},place_name:v.properties.etiqueta,properties:v.properties,text:v.properties.etiqueta,place_type:["place"],center:C};o.push(b)}}catch(d){console.error(`Failed to forwardGeocode with error: ${d}`)}return{features:o}}};this.map.addControl(new Nit(i,t),e);let s=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");s[0].attributes[2].nodeValue="Cerca...",s[0].addEventListener("input",function(a){a.target.value.length>3})}catch(n){console.error(`Error adding ICGC geocoder: ${n.message}`)}}async loadImage(t){try{return this.map.loadImage(t)}catch(e){console.error(`Error getting loadImage: ${e.message}`)}}getConfigStyles(){try{let t=[];for(const e of Cd)t.push(e.name);return t}catch(t){console.error(`Error retrieving base styles: ${t.message}`)}}getConfigWMSLayers(){try{let t=[];for(const e in ms.WMS)ms.WMS.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving WMS layers: ${t.message}`)}}getConfigOrtoLayers(){try{let t=[];for(const e in ms.Orto)ms.Orto.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving orto image layers: ${t.message}`)}}getConfigVectorLayers(){try{let t=[];for(const e in ms.Vector)ms.Vector.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vector layers: ${t.message}`)}}getConfigVectorAdminLayers(){try{let t=[];for(const e in ms.VectorAdmin)ms.VectorAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving vectorAdmin layers: ${t.message}`)}}getConfigFGBAdminLayers(){try{let t=[];for(const e in ms.FGBAdmin)ms.FGBAdmin.hasOwnProperty(e)&&t.push(e);return t}catch(t){console.error(`Error retrieving FGBAdmin layers: ${t.message}`)}}async fetchData(t,e,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(t.includes(".fgb"))this.addFGBLayerICGC(t,e,n);else{const a=await(await fetch(t)).json();let o=e,d=this._dealOrderLayer(i),f=a.features[0].geometry.type;f.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},d):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},d)),f.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},d):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},d)),f.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},d):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},d))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(t,e,n,i){try{let s;i!==null?s=i.layerPosition:s=zy;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let d="visible",f=this._dealOrderLayer(s),m;if(t.includes(".fgb")){let C=this._getKeyByUrlFGB(t);C===null&&(C="userFGB");const b=await fetch(t),P={type:"FeatureCollection",features:[]};for await(const U of KT(b.body))P.features.push(U);m=P;let F=e;if(this.map.addSource(F,{type:"geojson",data:P}),t.includes("text"))i!==void 0?this.map.addLayer({id:e,type:"symbol",source:F,layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:F,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:d,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let U=e+"Text";this.map.addLayer({id:U,type:"symbol",source:F,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:d,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else m=await(await fetch(t)).json();if(n!=="all"){const C=document.createElement("div");C.id="titleDivMenu",C.textContent=e,a.appendChild(C);const b=document.createElement("div");b.id="titleDivMenuSub",b.textContent=`📂 ${n}`,a.appendChild(b)}let v;if(i.type?v=i.type:v=m.features[0].geometry.type,n==="all")v.includes("ine")&&(i!==void 0?this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),v.includes("olygon")&&(i!==void 0?this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),v.includes("oint")&&(i!==void 0?this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),v.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:e,type:"symbol",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(e);else{let C=n;const b={};m.features.forEach(P=>{const F=P.properties[C],U=F+"-userFieldFilter-"+e;F!==null&&(b[U]||(v.includes("ine")&&(i!==void 0?this.map.addLayer({id:U,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint,filter:["==",`${C}`,F]},f):this.map.addLayer({id:U,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${C}`,F],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),v.includes("olygon")&&(i!==void 0?this.map.addLayer({id:U,type:"fill",source:{type:"geojson",data:m},filter:["==",`${C}`,F],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:U,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${C}`,F],paint:{"fill-color":"blue","fill-opacity":.6}},f)),v.includes("oint")&&(i!==void 0?this.map.addLayer({id:U,type:"circle",source:{type:"geojson",data:m},filter:["==",`${C}`,F],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:U,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${C}`,F],paint:{"circle-color":"red","circle-opacity":.85}},f)),b[U]=!0,this.addMenuItem(U)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(t,e){setTimeout(()=>{try{return this.map.on(t,e)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},100)}setStyle(t,e){try{e!==void 0?this.map.setStyle(t,e):this.map.setStyle(t),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}addControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(t,e)}catch(n){console.error(`Error adding control: ${n.message}`)}}setSky(t){try{t===void 0&&(this.map.style.stylesheet.id.includes("orto")?t={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?t={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?t={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?t={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:t={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(t)}catch(e){console.error(`Error setting sky properties: ${e.message}`)}}addMouseCoordControl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Vit(t),e)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new wo.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),e):this.map.addControl(new wo.GeolocateControl(t),e)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(t,e){try{e===void 0&&(e="top-right"),t===void 0?this.map.addControl(new wo.FullscreenControl({container:HTMLElement}),e):this.map.addControl(new wo.FullscreenControl(t),e)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}addLayer(t,e){try{this.map.addLayer(t,e)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addImage(t,e,n){try{this.map.addImage(t,e,n)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(t,e){try{this.map.addSource(t,e)}catch(n){console.error(`Error adding source: ${n.message}`)}return this}addSprite(t,e,n){try{this.map.addSprite(t,e,n)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(t,e){return this.map.cameraForBounds(t,e)}easeTo(t,e){return this.map.easeTo(t,e),this}fitBounds(t,e,n){return this.map.fitBounds(t,e,n),this}fitScreenCoordinates(t,e,n,i,s){return this.map.fitScreenCoordinates(t,e,n,i,s),this}flyTo(t,e){return this.map.flyTo(t,e),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(t){return this.map.getFeatureState(t)}getFilter(t){return this.map.getFilter(t)}getGlyphs(){return this.map.getGlyphs()}getImage(t){return this.map.getImage(t)}getLayer(t){return this.map.getLayer(t)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(t,e){return this.map.getLayoutProperty(t,e)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(t,e){return this.map.getPaintProperty(t,e)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(t){return this.map.getSource(t)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(t){return this.map.hasControl(t)}hasImage(t){return this.map.hasImage(t)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(t){return this.map.isSourceLoaded(t)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(t,e){return this.map.jumpTo(t,e)}listImages(){return this.map.listImages()}listens(t){return this.map.listens(t)}loadImage(t){return this.map.loadImage(t)}loaded(){return this.map.loaded()}LngLatBounds(t,e){return new wo.LngLatBounds(t,e)}addProtocol(t,e){return this.map.addProtocol(t,e)}moveLayer(t,e){return this.map.moveLayer(t,e)}panBy(t,e,n){return this.map.panBy(t,e,n)}panTo(t,e,n){return this.map.panTo(t,e,n)}project(t){return this.map.project(t)}queryRenderedFeatures(t,e){return this.map.queryRenderedFeatures(t,e)}querySourceFeatures(t,e){return this.map.querySourceFeatures(t,e)}queryTerrainElevation(t){return this.map.queryTerrainElevation(t)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(t){return this.map.removeControl(t)}removeFeatureState(t,e){return this.map.removeFeatureState(t,e)}removeImage(t){return this.map.removeImage(t)}removeLayer(t){try{this.map.removeLayer(t)}catch(e){console.error(`Error removing layer: ${e.message}`)}}removeSource(t){try{this.map.removeSource(t)}catch(e){console.error(`Error removing source: ${e.message}`)}}removeSprite(t){return this.map.removeSprite(t)}resetNorth(t,e){return this.map.resetNorth(t,e)}resetNorthPitch(t,e){return this.map.resetNorthPitch(t,e)}resize(t){return this.map.resize(t)}rotateTo(t,e,n){return this.map.rotateTo(t,e,n)}setBearing(t,e){return this.map.setBearing(t,e)}setCenter(t,e){return this.map.setCenter(t,e)}setEventedParent(t,e){return this.map.setEventedParent(t,e)}setFeatureState(t,e){return this.map.setFeatureState(t,e)}setFilter(t,e,n){return this.map.setFilter(t,e,n)}setGlyphs(t,e){return this.map.setGlyphs(t,e)}setLayerZoomRange(t,e,n){return this.map.setLayerZoomRange(t,e,n)}setLayoutProperty(t,e,n,i){return this.map.setLayoutProperty(t,e,n,i)}setLight(t,e){return this.map.setLight(t,e)}setMaxBounds(t){return this.map.setMaxBounds(t)}setMaxPitch(t){return this.map.setMaxPitch(t)}setMaxZoom(t){return this.map.setMaxZoom(t)}setMinPitch(t){return this.map.setMinPitch(t)}setMinZoom(t){return this.map.setMinZoom(t)}setPadding(t,e){return this.map.setPadding(t,e)}setPaintProperty(t,e,n,i){return this.map.setPaintProperty(t,e,n,i)}setPitch(t,e){return this.map.setPitch(t,e)}setPixelRatio(t){return this.map.setPixelRatio(t)}setRenderWorldCopies(t){return this.map.setRenderWorldCopies(t)}setSprite(t,e){return this.map.setSprite(t,e)}setTerrain(t){return this.map.setTerrain(t)}setTransformRequest(t){return this.map.setTransformRequest(t)}setZoom(t,e){return this.map.setZoom(t,e)}snapToNorth(t,e){return this.map.snapToNorth(t,e)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(t){return this.map.unproject(t)}updateImage(t,e){return this.map.updateImage(t,e)}zoomIn(t,e){return this.map.zoomIn(t,e)}zoomOut(t,e){return this.map.zoomOut(t,e)}zoomTo(t,e,n){return this.map.zoomTo(t,e,n)}addLayerGeoJSON(t,e){try{let n=this._dealOrderLayer(e);this.map.addSource(`${t.id}`,{type:"geojson",data:t.data}),this.map.addLayer({id:`${t.id}-layerIcgcMap`,type:t.type,source:`${t.id}`,layout:t.layout,paint:t.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(t,e,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${e}`,{type:"raster",tiles:[t],tileSize:256},i),this.map.addLayer({id:e,type:"raster",source:e,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(t){try{let e=document.getElementById("map"),n;n=document.createElement("div"),n.id="logos",e.appendChild(n);const i=document.createElement("img");i.src=t.url,i.style.height=t.height;const s=document.getElementById("logos"),a=document.createElement("a");a.id=t.id,a.href=t.href,a.target="_blank",a.style.position="relative",a.style.bottom="1px",a.appendChild(i),s.appendChild(a)}catch(e){console.error(`Error adding logo: ${e.message}`)}}addBasemapsICGC(t){try{const e=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of t)for(const o of Object.keys(ni.baseStyles)){const d=ni.baseStyles[o];if(a===d.url){const f=document.createElement("div");f.className="basemap-item",f.title=d.key,f.style.backgroundImage=`url('${d.image}')`,s.appendChild(f),f.addEventListener("click",()=>e(d.url))}}}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addBasemaps(t){try{const e=a=>{map.setStyle(a.url)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",n.appendChild(i);const s=document.getElementById("basemap-group");t.forEach(a=>{const o=document.createElement("div");o.className="basemap-item",o.title=a.label,o.style.backgroundImage=`url('${a.image}')`,s.appendChild(o),o.addEventListener("click",()=>e(a))})}catch(e){console.error(`Error adding basemaps: ${e.message}`)}}addFeatureQuery(t,e,n){try{let i;this.map.on("mouseenter",t,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",t,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(t)){let o=[s.lngLat.lng,s.lngLat.lat];if(e!==void 0&&e.length>0&&e!=="all"){if(e!==null){let d="";e.forEach(f=>{let m=a[0].properties[f];d=d+`<h4>${m}</h4>`}),i=d,this.addPopup(o,i,n)}}else{let d="";for(const f in a[0].properties)d+="<b>"+f+"</b>:"+a[0].properties[f]+"<br>";i=d,this.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(t,e){try{var n=new wo.ScaleControl(t);this.map.addControl(n,e)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(t,e){try{typeof t=="string"&&(e=t,t=void 0),t===void 0&&(t={PageSize:gd.A4,PageOrientation:Fg.Landscape,Format:Eh.PNG,DPI:Qw[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},e="top-right"),this.map.addControl(new vit(t),e)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addMarker(t){try{let e,n;return t.text===void 0?e=new wo.Marker(t.options).setLngLat(t.coord).addTo(this.map):(n=new wo.Popup({offset:t.textOffset}).setHTML(t.text),e=new wo.Marker(t.options).setLngLat(t.coord).setPopup(n).addTo(this.map)),e}catch(e){return console.error(`Error adding marker: ${e.message}`),null}}addPopup(t,e,n){try{return n.image===void 0?new wo.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${e}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new wo.Popup().setLngLat(t).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${e}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(t){try{t===void 0&&(t="top-right"),this.map.addControl(new wo.FullscreenControl,t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}addMenuItem(t){try{let e;if(t.includes("-userFieldFilter-")?e=t.split("-userFieldFilter-")[0]:e=t,t.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=t,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",t),s.textContent=e,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(t,"visibility",a.target.checked?"visible":"none")})}}catch(e){console.error(`Error adding menu item: ${e.message}`)}}addLayerTree(t){try{let e=t.features,n=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",n.appendChild(i);const s=document.getElementById("filter-group");this.map.addSource(`${t.id}`,{type:t.type,data:e}),e.features.forEach(a=>{const o=a.properties.icon,d=`poi-${o}`;if(!this.map.getLayer(d)){this.map.addLayer({id:d,type:"circle",source:`${t.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const f=document.createElement("input");f.type="checkbox",f.id=d,f.checked=!0,s.appendChild(f);const m=document.createElement("label");m.setAttribute("for",d),m.textContent=o,s.appendChild(m),f.addEventListener("change",v=>{this.map.setLayoutProperty(d,"visibility",v.target.checked?"visible":"none")})}})}catch(e){console.error(`Error adding layer tree: ${e.message}`)}}createNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new wo.NavigationControl(t),e)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(t,e){try{e===void 0&&(e="top-right"),this.map.addControl(new wo.NavigationControl(t),e)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(t,e){try{this.map.addControl(new wo.AttributionControl(t),e)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(t,e,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:zy},i=this._findImageType(t,ms.Orto,ms.VectorAdmin,ms.WMS,ms.Vector),i||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");let o={id:e,tiles:t};this.addLayerWMS(t,e,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(t,e,n){try{let{type:i="line",layerPosition:s=zy,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},d=this._dealOrderLayer(s);if(!t){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",t,"font-weight: bold; font-style: italic;");return}if(t.includes("https")){let f=this._getKeyByUrlVector(t);this.map.addSource(f,{type:"vector",url:t});let m={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:pot.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(m,d),a.visibility==="visible"){let v=this._getLegendByName(f);this.addLegend(v,f)}}else{let f=e;this.map.addSource(f,{type:"vector",url:ni.limitsUrl});let m={id:e,type:i,source:f,"source-layer":t,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?m.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(m.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(m,d)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(t,e,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(t),a={type:"FeatureCollection",features:[]};for await(const d of KT(s.body))a.features.push(d);let o=e;this.map.addSource(o,{type:"geojson",data:a}),t.includes("text")?this.map.addLayer({id:e,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:e,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(t,e){try{let n;for(const s in Hg)if(Hg.hasOwnProperty(s)){const a=Hg[s];a===t&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(t.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),e==null||this.map.addControl(new NQ({pitch:90,bearing:null,minpitchzoom:null}),e)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(t,e){try{this.map.addControl(new Qit({url:t,idLayer:e}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(t,e,n,i,s){const a=[e,n,i,s];for(const o of a)for(const[d,f]of Object.entries(o))if(f===t)return d;return null}_getKeyByUrlFGB(t){for(const e in ms.FGBAdmin)if(ms.FGBAdmin.hasOwnProperty(e)&&ms.FGBAdmin[e]===t)return e;return null}_getLegendByName(t){for(const e in ni.vectorLayers){const n=ni.vectorLayers[e];if(n.key===t)return n.legend}return null}_getKeyByUrlVector(t){for(const e in ms.Vector)if(ms.Vector.hasOwnProperty(e)&&ms.Vector[e]===t)return e;return null}async _raiseText3DStyle(){try{const t=await this.map.loadImage(ni.map3dOptions.imageIcon);this.map.hasImage("stick")||this.map.addImage("stick",t.data),this.map.getStyle().layers.forEach(e=>{if(e["source-layer"]===ni.map3dOptions.sourceLayerFilterId&&e.minzoom>=ni.map3dOptions.minZoomFilter&&t){const n=e.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealStyleMaps(t){try{if(t&&t.indexOf("icgc.cat")!=-1){for(const e in Cd)if(Cd.hasOwnProperty(e)){const n=Cd[e];if(e===t)return n}return Cd[0]}else return t}catch(e){return console.error(`Error dealing with map styles: ${e.message}`),null}}_dealOrto3dStyle(t){try{if(t=="orto3d"){console.log("map"),this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const e=new II({intensity:4}),n=new gb({ambientLight:e});this.map.setTerrain({source:ni.map3dOptions.terrainSource,exaggeration:ni.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(ni.map3dOptions.layerId3d)||(this.map.addLayer(i,ni.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(ni.map3dOptions.layerId3d,ni.map3dOptions.minZoomRange,ni.map3dOptions.maxZoomRange),i.deck.setProps({effects:[n]}),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"})}else this.map.getLayer(ni.map3dOptions.layerId3d)&&(this.map.removeLayer(ni.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrderLayer(t){return t===zy?this._firstSymbolLayer():t===got?this._firstLineLayer():""}_firstSymbolLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="symbol"&&t[n].id.indexOf("contour")===-1&&t[n].id.indexOf("water")===-1){e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_firstLineLayer(){try{const t=this.map.getStyle().layers;let e;for(let n=0;n<t.length;n++)if(t[n].type==="line"){e=t[n].id;break}return e}catch(t){console.error(`Error getting first symbol layer: ${t.message}`)}}_createCitiesMapboxLayer(){try{return new YX({id:ni.map3dOptions.layerId3d,type:kw,data:ni.map3dOptions.urlTilesetCities,loader:Nw,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:ni.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=ni.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=ni.map3dOptions.zfactor},operation:"terrain+draw"})}catch(t){return console.error(`Error adding MapboxLayer: ${t.message}`),null}}};var zL={exports:{}};function yot(r,t){var e=r.getCenter(),n=r.getZoom(),i=r.getBearing(),s=r.getPitch();t.forEach(function(a){a.jumpTo({center:e,zoom:n,bearing:i,pitch:s})})}function _ot(){var r,t=arguments.length;if(t===1)r=arguments[0];else{r=[];for(var e=0;e<t;e++)r.push(arguments[e])}var n=[];r.forEach(function(o,d){n[d]=a.bind(null,o,r.filter(function(f,m){return m!==d}))});function i(){r.forEach(function(o,d){o.on("move",n[d])})}function s(){r.forEach(function(o,d){o.off("move",n[d])})}function a(o,d){s(),yot(o,d),i()}return i(),function(){s(),n=[],r=[]}}var vot=_ot,F2={exports:{}},Wf=typeof Reflect=="object"?Reflect:null,HL=Wf&&typeof Wf.apply=="function"?Wf.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},Hy;Wf&&typeof Wf.ownKeys=="function"?Hy=Wf.ownKeys:Object.getOwnPropertySymbols?Hy=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Hy=function(t){return Object.getOwnPropertyNames(t)};function bot(r){console&&console.warn&&console.warn(r)}var VL=Number.isNaN||function(t){return t!==t};function Ii(){Ii.init.call(this)}F2.exports=Ii,F2.exports.once=Cot,Ii.EventEmitter=Ii,Ii.prototype._events=void 0,Ii.prototype._eventsCount=0,Ii.prototype._maxListeners=void 0;var jL=10;function Vy(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ii,"defaultMaxListeners",{enumerable:!0,get:function(){return jL},set:function(r){if(typeof r!="number"||r<0||VL(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");jL=r}}),Ii.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ii.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||VL(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function qL(r){return r._maxListeners===void 0?Ii.defaultMaxListeners:r._maxListeners}Ii.prototype.getMaxListeners=function(){return qL(this)},Ii.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var d=s[t];if(d===void 0)return!1;if(typeof d=="function")HL(d,this,e);else for(var f=d.length,m=ZL(d,f),n=0;n<f;++n)HL(m[n],this,e);return!0};function KL(r,t,e,n){var i,s,a;if(Vy(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),a=s[t]),a===void 0)a=s[t]=e,++r._eventsCount;else if(typeof a=="function"?a=s[t]=n?[e,a]:[a,e]:n?a.unshift(e):a.push(e),i=qL(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,bot(o)}return r}Ii.prototype.addListener=function(t,e){return KL(this,t,e,!1)},Ii.prototype.on=Ii.prototype.addListener,Ii.prototype.prependListener=function(t,e){return KL(this,t,e,!0)};function wot(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function WL(r,t,e){var n={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},i=wot.bind(n);return i.listener=e,n.wrapFn=i,i}Ii.prototype.once=function(t,e){return Vy(e),this.on(t,WL(this,t,e)),this},Ii.prototype.prependOnceListener=function(t,e){return Vy(e),this.prependListener(t,WL(this,t,e)),this},Ii.prototype.removeListener=function(t,e){var n,i,s,a,o;if(Vy(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():xot(n,s),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},Ii.prototype.off=Ii.prototype.removeListener,Ii.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function $L(r,t,e){var n=r._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?Bot(i):ZL(i,i.length)}Ii.prototype.listeners=function(t){return $L(this,t,!0)},Ii.prototype.rawListeners=function(t){return $L(this,t,!1)},Ii.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):XL.call(r,t)},Ii.prototype.listenerCount=XL;function XL(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Ii.prototype.eventNames=function(){return this._eventsCount>0?Hy(this._events):[]};function ZL(r,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=r[n];return e}function xot(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function Bot(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function Cot(r,t){return new Promise(function(e,n){function i(a){r.removeListener(t,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),e([].slice.call(arguments))}YL(r,t,s,{once:!0}),t!=="error"&&Eot(r,i,{once:!0})})}function Eot(r,t,e){typeof r.on=="function"&&YL(r,"error",t,e)}function YL(r,t,e,n){if(typeof r.on=="function")n.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function i(s){n.once&&r.removeEventListener(t,i),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Tot=F2.exports;(function(r){var t=vot,e=Tot.EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var d=document.body.querySelectorAll(a)[0];if(!d)throw new Error("Cannot find element with specified container selector.");d.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var f=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(f),this._clearSync=t(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n})(zL);var Sot=zL.exports;const Iot=Km(Sot);class Pot{constructor(t,e,n,i){const s=this;setTimeout(function(){s.mapCompare=new Iot(t.map,e.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var L2=function(r,t){return L2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},L2(r,t)};function kc(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");L2(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var R2=function(){return R2=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},R2.apply(this,arguments)};function Ia(r,t,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(m){try{f(n.next(m))}catch(v){a(v)}}function d(m){try{f(n.throw(m))}catch(v){a(v)}}function f(m){m.done?s(m.value):i(m.value).then(o,d)}f((n=n.apply(r,[])).next())})}function Aa(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(f){return function(m){return d([f,m])}}function d(f){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,i=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(r,e)}catch(m){f=[6,m],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Gy(r,t,e){if(arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return r.concat(s||t)}for(var Sh=function(){function r(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return r.prototype.add=function(t,e,n,i){return new r(this.left+t,this.top+e,this.width+n,this.height+i)},r.fromClientRect=function(t,e){return new r(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},r.fromDOMRectList=function(t,e){var n=Array.from(e).find(function(i){return i.width!==0});return n?new r(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),jy=function(r,t){return Sh.fromClientRect(r,t.getBoundingClientRect())},Mot=function(r){var t=r.body,e=r.documentElement;if(!t||!e)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),i=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new Sh(0,0,n,i)},qy=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},Fs=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},JL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fot=typeof Uint8Array>"u"?[]:new Uint8Array(256),Ky=0;Ky<JL.length;Ky++)Fot[JL.charCodeAt(Ky)]=Ky;for(var t4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vg=typeof Uint8Array>"u"?[]:new Uint8Array(256),Wy=0;Wy<t4.length;Wy++)Vg[t4.charCodeAt(Wy)]=Wy;for(var Lot=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,d;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=Vg[r.charCodeAt(n)],a=Vg[r.charCodeAt(n+1)],o=Vg[r.charCodeAt(n+2)],d=Vg[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|d&63;return f},Rot=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},Oot=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},Ed=5,O2=11,U2=2,Uot=O2-Ed,e4=65536>>Ed,Dot=1<<Ed,D2=Dot-1,Not=1024>>Ed,kot=e4+Not,Qot=kot,zot=32,Hot=Qot+zot,Vot=65536>>O2,Got=1<<Uot,jot=Got-1,r4=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},qot=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},Kot=function(r,t){var e=Lot(r),n=Array.isArray(e)?Oot(e):new Uint32Array(e),i=Array.isArray(e)?Rot(e):new Uint16Array(e),s=24,a=r4(i,s/2,n[4]/2),o=n[5]===2?r4(i,(s+n[4])/2):qot(n,Math.ceil((s+n[4])/4));return new Wot(n[0],n[1],n[2],n[3],a,o)},Wot=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Ed],e=(e<<U2)+(t&D2),this.data[e];if(t<=65535)return e=this.index[e4+(t-55296>>Ed)],e=(e<<U2)+(t&D2),this.data[e];if(t<this.highStart)return e=Hot-Vot+(t>>O2),e=this.index[e],e+=t>>Ed&jot,e=this.index[e],e=(e<<U2)+(t&D2),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),n4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$ot=typeof Uint8Array>"u"?[]:new Uint8Array(256),$y=0;$y<n4.length;$y++)$ot[n4.charCodeAt($y)]=$y;var Xot="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",i4=50,Zot=1,s4=2,o4=3,Yot=4,Jot=5,a4=7,l4=8,c4=9,BA=10,N2=11,u4=12,k2=13,tat=14,Gg=15,Q2=16,Xy=17,jg=18,eat=19,h4=20,z2=21,qg=22,H2=23,$f=24,El=25,Kg=26,Wg=27,Xf=28,rat=29,Zf=30,nat=31,Zy=32,Yy=33,V2=34,G2=35,j2=36,$g=37,q2=38,Jy=39,t1=40,K2=41,A4=42,iat=43,sat=[9001,65288],d4="!",Pa="×",e1="÷",W2=Kot(Xot),Ih=[Zf,j2],$2=[Zot,s4,o4,Jot],f4=[BA,l4],p4=[Wg,Kg],oat=$2.concat(f4),g4=[q2,Jy,t1,V2,G2],aat=[Gg,k2],lat=function(r,t){t===void 0&&(t="strict");var e=[],n=[],i=[];return r.forEach(function(s,a){var o=W2.get(s);if(o>i4?(i.push(!0),o-=i4):i.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),e.push(Q2);if(o===Yot||o===N2){if(a===0)return n.push(a),e.push(Zf);var d=e[a-1];return oat.indexOf(d)===-1?(n.push(n[a-1]),e.push(d)):(n.push(a),e.push(Zf))}if(n.push(a),o===nat)return e.push(t==="strict"?z2:$g);if(o===A4||o===rat)return e.push(Zf);if(o===iat)return s>=131072&&s<=196605||s>=196608&&s<=262141?e.push($g):e.push(Zf);e.push(o)}),[n,e,i]},X2=function(r,t,e,n){var i=n[e];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=e;s<=n.length;){s++;var a=n[s];if(a===t)return!0;if(a!==BA)break}if(i===BA)for(var s=e;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var d=e;d<=n.length;){d++;var a=n[d];if(a===t)return!0;if(a!==BA)break}if(o!==BA)break}return!1},m4=function(r,t){for(var e=r;e>=0;){var n=t[e];if(n===BA)e--;else return n}return 0},cat=function(r,t,e,n,i){if(e[n]===0)return Pa;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Pa;var a=s-1,o=s+1,d=t[s],f=a>=0?t[a]:0,m=t[o];if(d===s4&&m===o4)return Pa;if($2.indexOf(d)!==-1)return d4;if($2.indexOf(m)!==-1||f4.indexOf(m)!==-1)return Pa;if(m4(s,t)===l4)return e1;if(W2.get(r[s])===N2||(d===Zy||d===Yy)&&W2.get(r[o])===N2||d===a4||m===a4||d===c4||[BA,k2,Gg].indexOf(d)===-1&&m===c4||[Xy,jg,eat,$f,Xf].indexOf(m)!==-1||m4(s,t)===qg||X2(H2,qg,s,t)||X2([Xy,jg],z2,s,t)||X2(u4,u4,s,t))return Pa;if(d===BA)return e1;if(d===H2||m===H2)return Pa;if(m===Q2||d===Q2)return e1;if([k2,Gg,z2].indexOf(m)!==-1||d===tat||f===j2&&aat.indexOf(d)!==-1||d===Xf&&m===j2||m===h4||Ih.indexOf(m)!==-1&&d===El||Ih.indexOf(d)!==-1&&m===El||d===Wg&&[$g,Zy,Yy].indexOf(m)!==-1||[$g,Zy,Yy].indexOf(d)!==-1&&m===Kg||Ih.indexOf(d)!==-1&&p4.indexOf(m)!==-1||p4.indexOf(d)!==-1&&Ih.indexOf(m)!==-1||[Wg,Kg].indexOf(d)!==-1&&(m===El||[qg,Gg].indexOf(m)!==-1&&t[o+1]===El)||[qg,Gg].indexOf(d)!==-1&&m===El||d===El&&[El,Xf,$f].indexOf(m)!==-1)return Pa;if([El,Xf,$f,Xy,jg].indexOf(m)!==-1)for(var v=s;v>=0;){var C=t[v];if(C===El)return Pa;if([Xf,$f].indexOf(C)!==-1)v--;else break}if([Wg,Kg].indexOf(m)!==-1)for(var v=[Xy,jg].indexOf(d)!==-1?a:s;v>=0;){var C=t[v];if(C===El)return Pa;if([Xf,$f].indexOf(C)!==-1)v--;else break}if(q2===d&&[q2,Jy,V2,G2].indexOf(m)!==-1||[Jy,V2].indexOf(d)!==-1&&[Jy,t1].indexOf(m)!==-1||[t1,G2].indexOf(d)!==-1&&m===t1||g4.indexOf(d)!==-1&&[h4,Kg].indexOf(m)!==-1||g4.indexOf(m)!==-1&&d===Wg||Ih.indexOf(d)!==-1&&Ih.indexOf(m)!==-1||d===$f&&Ih.indexOf(m)!==-1||Ih.concat(El).indexOf(d)!==-1&&m===qg&&sat.indexOf(r[o])===-1||Ih.concat(El).indexOf(m)!==-1&&d===jg)return Pa;if(d===K2&&m===K2){for(var b=e[s],P=1;b>0&&(b--,t[b]===K2);)P++;if(P%2!==0)return Pa}return d===Zy&&m===Yy?Pa:e1},uat=function(r,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=lat(r,t.lineBreak),n=e[0],i=e[1],s=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(i=i.map(function(o){return[El,Zf,A4].indexOf(o)!==-1?$g:o}));var a=t.wordBreak==="keep-all"?s.map(function(o,d){return o&&r[d]>=19968&&r[d]<=40959}):void 0;return[n,i,a]},hat=function(){function r(t,e,n,i){this.codePoints=t,this.required=e===d4,this.start=n,this.end=i}return r.prototype.slice=function(){return Fs.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),Aat=function(r,t){var e=qy(r),n=uat(e,t),i=n[0],s=n[1],a=n[2],o=e.length,d=0,f=0;return{next:function(){if(f>=o)return{done:!0,value:null};for(var m=Pa;f<o&&(m=cat(e,s,i,++f,a))===Pa;);if(m!==Pa||f===o){var v=new hat(e,m,d,f);return d=f,{value:v,done:!1}}return{done:!0,value:null}}}},dat=1,fat=2,Xg=4,y4=8,r1=10,_4=47,Zg=92,pat=9,gat=32,n1=34,Yg=61,mat=35,yat=36,_at=37,i1=39,s1=40,Jg=41,vat=95,el=45,bat=33,wat=60,xat=62,Bat=64,Cat=91,Eat=93,Tat=61,Sat=123,o1=63,Iat=125,v4=124,Pat=126,Mat=128,b4=65533,Z2=42,Td=43,Fat=44,Lat=58,Rat=59,tm=46,Oat=0,Uat=8,Dat=11,Nat=14,kat=31,Qat=127,Hu=-1,w4=48,x4=97,B4=101,zat=102,Hat=117,Vat=122,C4=65,E4=69,T4=70,Gat=85,jat=90,Ma=function(r){return r>=w4&&r<=57},qat=function(r){return r>=55296&&r<=57343},Yf=function(r){return Ma(r)||r>=C4&&r<=T4||r>=x4&&r<=zat},Kat=function(r){return r>=x4&&r<=Vat},Wat=function(r){return r>=C4&&r<=jat},$at=function(r){return Kat(r)||Wat(r)},Xat=function(r){return r>=Mat},a1=function(r){return r===r1||r===pat||r===gat},l1=function(r){return $at(r)||Xat(r)||r===vat},S4=function(r){return l1(r)||Ma(r)||r===el},Zat=function(r){return r>=Oat&&r<=Uat||r===Dat||r>=Nat&&r<=kat||r===Qat},CA=function(r,t){return r!==Zg?!1:t!==r1},c1=function(r,t,e){return r===el?l1(t)||CA(t,e):l1(r)?!0:!!(r===Zg&&CA(r,t))},Y2=function(r,t,e){return r===Td||r===el?Ma(t)?!0:t===tm&&Ma(e):Ma(r===tm?t:r)},Yat=function(r){var t=0,e=1;(r[t]===Td||r[t]===el)&&(r[t]===el&&(e=-1),t++);for(var n=[];Ma(r[t]);)n.push(r[t++]);var i=n.length?parseInt(Fs.apply(void 0,n),10):0;r[t]===tm&&t++;for(var s=[];Ma(r[t]);)s.push(r[t++]);var a=s.length,o=a?parseInt(Fs.apply(void 0,s),10):0;(r[t]===E4||r[t]===B4)&&t++;var d=1;(r[t]===Td||r[t]===el)&&(r[t]===el&&(d=-1),t++);for(var f=[];Ma(r[t]);)f.push(r[t++]);var m=f.length?parseInt(Fs.apply(void 0,f),10):0;return e*(i+o*Math.pow(10,-a))*Math.pow(10,d*m)},Jat={type:2},tlt={type:3},elt={type:4},rlt={type:13},nlt={type:8},ilt={type:21},slt={type:9},olt={type:10},alt={type:11},llt={type:12},clt={type:14},u1={type:23},ult={type:1},hlt={type:25},Alt={type:24},dlt={type:26},flt={type:27},plt={type:28},glt={type:29},mlt={type:31},J2={type:32},I4=function(){function r(){this._value=[]}return r.prototype.write=function(t){this._value=this._value.concat(qy(t))},r.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==J2;)t.push(e),e=this.consumeToken();return t},r.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case n1:return this.consumeStringToken(n1);case mat:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(S4(e)||CA(n,i)){var s=c1(e,n,i)?fat:dat,a=this.consumeName();return{type:5,value:a,flags:s}}break;case yat:if(this.peekCodePoint(0)===Yg)return this.consumeCodePoint(),rlt;break;case i1:return this.consumeStringToken(i1);case s1:return Jat;case Jg:return tlt;case Z2:if(this.peekCodePoint(0)===Yg)return this.consumeCodePoint(),clt;break;case Td:if(Y2(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Fat:return elt;case el:var o=t,d=this.peekCodePoint(0),f=this.peekCodePoint(1);if(Y2(o,d,f))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(c1(o,d,f))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(d===el&&f===xat)return this.consumeCodePoint(),this.consumeCodePoint(),Alt;break;case tm:if(Y2(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case _4:if(this.peekCodePoint(0)===Z2)for(this.consumeCodePoint();;){var m=this.consumeCodePoint();if(m===Z2&&(m=this.consumeCodePoint(),m===_4))return this.consumeToken();if(m===Hu)return this.consumeToken()}break;case Lat:return dlt;case Rat:return flt;case wat:if(this.peekCodePoint(0)===bat&&this.peekCodePoint(1)===el&&this.peekCodePoint(2)===el)return this.consumeCodePoint(),this.consumeCodePoint(),hlt;break;case Bat:var v=this.peekCodePoint(0),C=this.peekCodePoint(1),b=this.peekCodePoint(2);if(c1(v,C,b)){var a=this.consumeName();return{type:7,value:a}}break;case Cat:return plt;case Zg:if(CA(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case Eat:return glt;case Tat:if(this.peekCodePoint(0)===Yg)return this.consumeCodePoint(),nlt;break;case Sat:return alt;case Iat:return llt;case Hat:case Gat:var P=this.peekCodePoint(0),F=this.peekCodePoint(1);return P===Td&&(Yf(F)||F===o1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case v4:if(this.peekCodePoint(0)===Yg)return this.consumeCodePoint(),slt;if(this.peekCodePoint(0)===v4)return this.consumeCodePoint(),ilt;break;case Pat:if(this.peekCodePoint(0)===Yg)return this.consumeCodePoint(),olt;break;case Hu:return J2}return a1(t)?(this.consumeWhiteSpace(),mlt):Ma(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):l1(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:Fs(t)}},r.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},r.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},r.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},r.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();Yf(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;e===o1&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(Fs.apply(void 0,t.map(function(d){return d===o1?w4:d})),16),s=parseInt(Fs.apply(void 0,t.map(function(d){return d===o1?T4:d})),16);return{type:30,start:i,end:s}}var a=parseInt(Fs.apply(void 0,t),16);if(this.peekCodePoint(0)===el&&Yf(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var o=[];Yf(e)&&o.length<6;)o.push(e),e=this.consumeCodePoint();var s=parseInt(Fs.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===s1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===s1?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},r.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Hu)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===i1||e===n1){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Hu||this.peekCodePoint(0)===Jg)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),u1)}for(;;){var i=this.consumeCodePoint();if(i===Hu||i===Jg)return{type:22,value:Fs.apply(void 0,t)};if(a1(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Hu||this.peekCodePoint(0)===Jg?(this.consumeCodePoint(),{type:22,value:Fs.apply(void 0,t)}):(this.consumeBadUrlRemnants(),u1);if(i===n1||i===i1||i===s1||Zat(i))return this.consumeBadUrlRemnants(),u1;if(i===Zg)if(CA(i,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),u1;else t.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;a1(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===Jg||t===Hu)return;CA(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(t){for(var e=5e4,n="";t>0;){var i=Math.min(e,t);n+=Fs.apply(void 0,this._value.splice(0,i)),t-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(t){var e="",n=0;do{var i=this._value[n];if(i===Hu||i===void 0||i===t)return e+=this.consumeStringSlice(n),{type:0,value:e};if(i===r1)return this._value.splice(0,n),ult;if(i===Zg){var s=this._value[n+1];s!==Hu&&s!==void 0&&(s===r1?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):CA(i,s)&&(e+=this.consumeStringSlice(n),e+=Fs(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var t=[],e=Xg,n=this.peekCodePoint(0);for((n===Td||n===el)&&t.push(this.consumeCodePoint());Ma(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===tm&&Ma(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=y4;Ma(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===E4||n===B4)&&((i===Td||i===el)&&Ma(s)||Ma(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=y4;Ma(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[Yat(t),e]},r.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(c1(i,s,a)){var o=this.consumeName();return{type:15,number:e,flags:n,unit:o}}return i===_at?(this.consumeCodePoint(),{type:16,number:e,flags:n}):{type:17,number:e,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(Yf(t)){for(var e=Fs(t);Yf(this.peekCodePoint(0))&&e.length<6;)e+=Fs(this.consumeCodePoint());a1(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return n===0||qat(n)||n>1114111?b4:n}return t===Hu?b4:t},r.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(S4(e))t+=Fs(e);else if(CA(e,this.peekCodePoint(0)))t+=Fs(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},r}(),P4=function(){function r(t){this._tokens=t}return r.create=function(t){var e=new I4;return e.write(t),new r(e.read())},r.parseValue=function(t){return r.create(t).parseComponentValue()},r.parseValues=function(t){return r.create(t).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},r.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},r.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(n.type===32||_lt(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?J2:t},r.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},r}(),em=function(r){return r.type===15},Jf=function(r){return r.type===17},Pi=function(r){return r.type===20},ylt=function(r){return r.type===0},tx=function(r,t){return Pi(r)&&r.value===t},M4=function(r){return r.type!==31},tp=function(r){return r.type!==31&&r.type!==4},Vu=function(r){var t=[],e=[];return r.forEach(function(n){if(n.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}n.type!==31&&e.push(n)}),e.length&&t.push(e),t},_lt=function(r,t){return t===11&&r.type===12||t===28&&r.type===29?!0:t===2&&r.type===3},EA=function(r){return r.type===17||r.type===15},Ys=function(r){return r.type===16||EA(r)},F4=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Vo={type:17,number:0,flags:Xg},ex={type:16,number:50,flags:Xg},TA={type:16,number:100,flags:Xg},rm=function(r,t,e){var n=r[0],i=r[1];return[zi(n,t),zi(typeof i<"u"?i:n,e)]},zi=function(r,t){if(r.type===16)return r.number/100*t;if(em(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},L4="deg",R4="grad",O4="rad",U4="turn",h1={name:"angle",parse:function(r,t){if(t.type===15)switch(t.unit){case L4:return Math.PI*t.number/180;case R4:return Math.PI/200*t.number;case O4:return t.number;case U4:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},D4=function(r){return r.type===15&&(r.unit===L4||r.unit===R4||r.unit===O4||r.unit===U4)},N4=function(r){var t=r.filter(Pi).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Vo,Vo];case"to top":case"bottom":return Jl(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Vo,TA];case"to right":case"left":return Jl(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[TA,TA];case"to bottom":case"top":return Jl(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[TA,Vo];case"to left":case"right":return Jl(270)}return 0},Jl=function(r){return Math.PI*r/180},SA={name:"color",parse:function(r,t){if(t.type===18){var e=vlt[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(r,t.values)}if(t.type===5){if(t.value.length===3){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);return PA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(t.value.length===4){var n=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3),a=t.value.substring(3,4);return PA(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(t.value.length===6){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6);return PA(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(t.value.length===8){var n=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6),a=t.value.substring(6,8);return PA(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(t.type===20){var o=Ph[t.value.toUpperCase()];if(typeof o<"u")return o}return Ph.TRANSPARENT}},IA=function(r){return(255&r)===0},So=function(r){var t=255&r,e=255&r>>8,n=255&r>>16,i=255&r>>24;return t<255?"rgba("+i+","+n+","+e+","+t/255+")":"rgb("+i+","+n+","+e+")"},PA=function(r,t,e,n){return(r<<24|t<<16|e<<8|Math.round(n*255)<<0)>>>0},k4=function(r,t){if(r.type===17)return r.number;if(r.type===16){var e=t===3?1:255;return t===3?r.number/100*e:Math.round(r.number/100*e)}return 0},Q4=function(r,t){var e=t.filter(tp);if(e.length===3){var n=e.map(k4),i=n[0],s=n[1],a=n[2];return PA(i,s,a,1)}if(e.length===4){var o=e.map(k4),i=o[0],s=o[1],a=o[2],d=o[3];return PA(i,s,a,d)}return 0};function rx(r,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-r)*e*6+r:e<1/2?t:e<2/3?(t-r)*6*(2/3-e)+r:r}var z4=function(r,t){var e=t.filter(tp),n=e[0],i=e[1],s=e[2],a=e[3],o=(n.type===17?Jl(n.number):h1.parse(r,n))/(Math.PI*2),d=Ys(i)?i.number/100:0,f=Ys(s)?s.number/100:0,m=typeof a<"u"&&Ys(a)?zi(a,1):1;if(d===0)return PA(f*255,f*255,f*255,1);var v=f<=.5?f*(d+1):f+d-f*d,C=f*2-v,b=rx(C,v,o+1/3),P=rx(C,v,o),F=rx(C,v,o-1/3);return PA(b*255,P*255,F*255,m)},vlt={hsl:z4,hsla:z4,rgb:Q4,rgba:Q4},nm=function(r,t){return SA.parse(r,P4.create(t).parseComponentValue())},Ph={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},blt={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(Pi(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},wlt={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},A1=function(r,t){var e=SA.parse(r,t[0]),n=t[1];return n&&Ys(n)?{color:e,stop:n}:{color:e,stop:null}},H4=function(r,t){var e=r[0],n=r[r.length-1];e.stop===null&&(e.stop=Vo),n.stop===null&&(n.stop=TA);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var d=zi(o,t);d>s?i.push(d):i.push(s),s=d}else i.push(null)}for(var f=null,a=0;a<i.length;a++){var m=i[a];if(m===null)f===null&&(f=a);else if(f!==null){for(var v=a-f,C=i[f-1],b=(m-C)/(v+1),P=1;P<=v;P++)i[f+P-1]=b*P;f=null}}return r.map(function(F,U){var k=F.color;return{color:k,stop:Math.max(Math.min(1,i[U]/t),0)}})},xlt=function(r,t,e){var n=t/2,i=e/2,s=zi(r[0],t)-n,a=i-zi(r[1],e);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},Blt=function(r,t,e){var n=typeof r=="number"?r:xlt(r,t,e),i=Math.abs(t*Math.sin(n))+Math.abs(e*Math.cos(n)),s=t/2,a=e/2,o=i/2,d=Math.sin(n-Math.PI/2)*o,f=Math.cos(n-Math.PI/2)*o;return[i,s-f,s+f,a-d,a+d]},Qc=function(r,t){return Math.sqrt(r*r+t*t)},V4=function(r,t,e,n,i){var s=[[0,0],[0,t],[r,0],[r,t]];return s.reduce(function(a,o){var d=o[0],f=o[1],m=Qc(e-d,n-f);return(i?m<a.optimumDistance:m>a.optimumDistance)?{optimumCorner:o,optimumDistance:m}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},Clt=function(r,t,e,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.min(Math.abs(t),Math.abs(t-n)),a=Math.min(Math.abs(e),Math.abs(e-i)));break;case 2:if(r.shape===0)s=a=Math.min(Qc(t,e),Qc(t,e-i),Qc(t-n,e),Qc(t-n,e-i));else if(r.shape===1){var o=Math.min(Math.abs(e),Math.abs(e-i))/Math.min(Math.abs(t),Math.abs(t-n)),d=V4(n,i,t,e,!0),f=d[0],m=d[1];s=Qc(f-t,(m-e)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(e),Math.abs(e-i)):r.shape===1&&(s=Math.max(Math.abs(t),Math.abs(t-n)),a=Math.max(Math.abs(e),Math.abs(e-i)));break;case 3:if(r.shape===0)s=a=Math.max(Qc(t,e),Qc(t,e-i),Qc(t-n,e),Qc(t-n,e-i));else if(r.shape===1){var o=Math.max(Math.abs(e),Math.abs(e-i))/Math.max(Math.abs(t),Math.abs(t-n)),v=V4(n,i,t,e,!1),f=v[0],m=v[1];s=Qc(f-t,(m-e)/o),a=o*s}break}return Array.isArray(r.size)&&(s=zi(r.size[0],n),a=r.size.length===2?zi(r.size[1],i):s),[s,a]},Elt=function(r,t){var e=Jl(180),n=[];return Vu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){e=N4(i);return}else if(D4(a)){e=h1.parse(r,a);return}}var o=A1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},d1=function(r,t){var e=Jl(180),n=[];return Vu(t).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){e=N4(i);return}else if(D4(a)){e=(h1.parse(r,a)+Jl(270))%Jl(360);return}}var o=A1(r,i);n.push(o)}),{angle:e,stops:n,type:1}},Tlt=function(r,t){var e=Jl(180),n=[],i=1,s=0,a=3,o=[];return Vu(t).forEach(function(d,f){var m=d[0];if(f===0){if(Pi(m)&&m.value==="linear"){i=1;return}else if(Pi(m)&&m.value==="radial"){i=2;return}}if(m.type===18){if(m.name==="from"){var v=SA.parse(r,m.values[0]);n.push({stop:Vo,color:v})}else if(m.name==="to"){var v=SA.parse(r,m.values[0]);n.push({stop:TA,color:v})}else if(m.name==="color-stop"){var C=m.values.filter(tp);if(C.length===2){var v=SA.parse(r,C[1]),b=C[0];Jf(b)&&n.push({stop:{type:16,number:b.number*100,flags:b.flags},color:v})}}}}),i===1?{angle:(e+Jl(180))%Jl(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},G4="closest-side",j4="farthest-side",q4="closest-corner",K4="farthest-corner",W4="circle",$4="ellipse",X4="cover",Z4="contain",Slt=function(r,t){var e=0,n=3,i=[],s=[];return Vu(t).forEach(function(a,o){var d=!0;if(o===0){var f=!1;d=a.reduce(function(v,C){if(f)if(Pi(C))switch(C.value){case"center":return s.push(ex),v;case"top":case"left":return s.push(Vo),v;case"right":case"bottom":return s.push(TA),v}else(Ys(C)||EA(C))&&s.push(C);else if(Pi(C))switch(C.value){case W4:return e=0,!1;case $4:return e=1,!1;case"at":return f=!0,!1;case G4:return n=0,!1;case X4:case j4:return n=1,!1;case Z4:case q4:return n=2,!1;case K4:return n=3,!1}else if(EA(C)||Ys(C))return Array.isArray(n)||(n=[]),n.push(C),!1;return v},d)}if(d){var m=A1(r,a);i.push(m)}}),{size:n,shape:e,stops:i,position:s,type:2}},f1=function(r,t){var e=0,n=3,i=[],s=[];return Vu(t).forEach(function(a,o){var d=!0;if(o===0?d=a.reduce(function(m,v){if(Pi(v))switch(v.value){case"center":return s.push(ex),!1;case"top":case"left":return s.push(Vo),!1;case"right":case"bottom":return s.push(TA),!1}else if(Ys(v)||EA(v))return s.push(v),!1;return m},d):o===1&&(d=a.reduce(function(m,v){if(Pi(v))switch(v.value){case W4:return e=0,!1;case $4:return e=1,!1;case Z4:case G4:return n=0,!1;case j4:return n=1,!1;case q4:return n=2,!1;case X4:case K4:return n=3,!1}else if(EA(v)||Ys(v))return Array.isArray(n)||(n=[]),n.push(v),!1;return m},d)),d){var f=A1(r,a);i.push(f)}}),{size:n,shape:e,stops:i,position:s,type:2}},Ilt=function(r){return r.type===1},Plt=function(r){return r.type===2},nx={name:"image",parse:function(r,t){if(t.type===22){var e={url:t.value,type:0};return r.cache.addImage(t.value),e}if(t.type===18){var n=Y4[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(r,t.values)}throw new Error("Unsupported image type "+t.type)}};function Mlt(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!Y4[r.name])}var Y4={"linear-gradient":Elt,"-moz-linear-gradient":d1,"-ms-linear-gradient":d1,"-o-linear-gradient":d1,"-webkit-linear-gradient":d1,"radial-gradient":Slt,"-moz-radial-gradient":f1,"-ms-radial-gradient":f1,"-o-radial-gradient":f1,"-webkit-radial-gradient":f1,"-webkit-gradient":Tlt},Flt={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(n){return tp(n)&&Mlt(n)}).map(function(n){return nx.parse(r,n)})}},Llt={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,t){return t.map(function(e){if(Pi(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Rlt={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,t){return Vu(t).map(function(e){return e.filter(Ys)}).map(F4)}},Olt={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,t){return Vu(t).map(function(e){return e.filter(Pi).map(function(n){return n.value}).join(" ")}).map(Ult)}},Ult=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},ep;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(ep||(ep={}));var Dlt={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,t){return Vu(t).map(function(e){return e.filter(Nlt)})}},Nlt=function(r){return Pi(r)||Ys(r)},p1=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},klt=p1("top"),Qlt=p1("right"),zlt=p1("bottom"),Hlt=p1("left"),g1=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return F4(e.filter(Ys))}}},Vlt=g1("top-left"),Glt=g1("top-right"),jlt=g1("bottom-right"),qlt=g1("bottom-left"),m1=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Klt=m1("top"),Wlt=m1("right"),$lt=m1("bottom"),Xlt=m1("left"),y1=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return em(e)?e.number:0}}},Zlt=y1("top"),Ylt=y1("right"),Jlt=y1("bottom"),tct=y1("left"),ect={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},rct={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},nct={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,t){return t.filter(Pi).reduce(function(e,n){return e|ict(n.value)},0)}},ict=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},sct={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},oct={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},_1;(function(r){r.NORMAL="normal",r.STRICT="strict"})(_1||(_1={}));var act={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"strict":return _1.STRICT;case"normal":default:return _1.NORMAL}}},lct={name:"line-height",initialValue:"normal",prefix:!1,type:4},J4=function(r,t){return Pi(r)&&r.value==="normal"?1.2*t:r.type===17?t*r.number:Ys(r)?zi(r,t):t},cct={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,t){return t.type===20&&t.value==="none"?null:nx.parse(r,t)}},uct={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},ix={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},v1=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},hct=v1("top"),Act=v1("right"),dct=v1("bottom"),fct=v1("left"),pct={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,t){return t.filter(Pi).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},gct={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},b1=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},mct=b1("top"),yct=b1("right"),_ct=b1("bottom"),vct=b1("left"),bct={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},wct={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},xct={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&tx(t[0],"none")?[]:Vu(t).map(function(e){for(var n={color:Ph.TRANSPARENT,offsetX:Vo,offsetY:Vo,blur:Vo},i=0,s=0;s<e.length;s++){var a=e[s];EA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=SA.parse(r,a)}return n})}},Bct={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Cct={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=Sct[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},Ect=function(r){var t=r.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},Tct=function(r){var t=r.filter(function(d){return d.type===17}).map(function(d){return d.number}),e=t[0],n=t[1];t[2],t[3];var i=t[4],s=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],o=t[13];return t[14],t[15],t.length===16?[e,n,i,s,a,o]:null},Sct={matrix:Ect,matrix3d:Tct},tR={type:16,number:50,flags:Xg},Ict=[tR,tR],Pct={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,t){var e=t.filter(Ys);return e.length!==2?Ict:[e[0],e[1]]}},Mct={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},im;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(im||(im={}));for(var Fct={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"break-all":return im.BREAK_ALL;case"keep-all":return im.KEEP_ALL;case"normal":default:return im.NORMAL}}},Lct={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,t){if(t.type===20)return{auto:!0,order:0};if(Jf(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},eR={name:"time",parse:function(r,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Rct={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,t){return Jf(t)?t.number:1}},Oct={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Uct={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,t){return t.filter(Pi).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},Dct={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,t){var e=[],n=[];return t.forEach(function(i){switch(i.type){case 20:case 0:e.push(i.value);break;case 17:e.push(i.number.toString());break;case 4:n.push(e.join(" ")),e.length=0;break}}),e.length&&n.push(e.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},Nct={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},kct={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,t){if(Jf(t))return t.number;if(Pi(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},Qct={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.filter(Pi).map(function(e){return e.value})}},zct={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ao=function(r,t){return(r&t)!==0},Hct={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},Vct={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var n=[],i=t.filter(M4),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var d=o&&Jf(o)?o.number:1;n.push({counter:a.value,increment:d})}}return n}},Gct={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return[];for(var e=[],n=t.filter(M4),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(Pi(s)&&s.value!=="none"){var o=a&&Jf(a)?a.number:0;e.push({counter:s.value,reset:o})}}return e}},jct={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,t){return t.filter(em).map(function(e){return eR.parse(r,e)})}},qct={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var n=[],i=t.filter(ylt);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},rR=function(r,t,e){if(!r)return"";var n=r[Math.min(t,r.length-1)];return n?e?n.open:n.close:""},Kct={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,t){return t.length===1&&tx(t[0],"none")?[]:Vu(t).map(function(e){for(var n={color:255,offsetX:Vo,offsetY:Vo,blur:Vo,spread:Vo,inset:!1},i=0,s=0;s<e.length;s++){var a=e[s];tx(a,"inset")?n.inset=!0:EA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=SA.parse(r,a)}return n})}},Wct={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,t){var e=[0,1,2],n=[];return t.filter(Pi).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),e.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},$ct={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Xct={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,t){return em(t)?t.number:0}},Zct=function(){function r(t,e){var n,i;this.animationDuration=Hr(t,jct,e.animationDuration),this.backgroundClip=Hr(t,blt,e.backgroundClip),this.backgroundColor=Hr(t,wlt,e.backgroundColor),this.backgroundImage=Hr(t,Flt,e.backgroundImage),this.backgroundOrigin=Hr(t,Llt,e.backgroundOrigin),this.backgroundPosition=Hr(t,Rlt,e.backgroundPosition),this.backgroundRepeat=Hr(t,Olt,e.backgroundRepeat),this.backgroundSize=Hr(t,Dlt,e.backgroundSize),this.borderTopColor=Hr(t,klt,e.borderTopColor),this.borderRightColor=Hr(t,Qlt,e.borderRightColor),this.borderBottomColor=Hr(t,zlt,e.borderBottomColor),this.borderLeftColor=Hr(t,Hlt,e.borderLeftColor),this.borderTopLeftRadius=Hr(t,Vlt,e.borderTopLeftRadius),this.borderTopRightRadius=Hr(t,Glt,e.borderTopRightRadius),this.borderBottomRightRadius=Hr(t,jlt,e.borderBottomRightRadius),this.borderBottomLeftRadius=Hr(t,qlt,e.borderBottomLeftRadius),this.borderTopStyle=Hr(t,Klt,e.borderTopStyle),this.borderRightStyle=Hr(t,Wlt,e.borderRightStyle),this.borderBottomStyle=Hr(t,$lt,e.borderBottomStyle),this.borderLeftStyle=Hr(t,Xlt,e.borderLeftStyle),this.borderTopWidth=Hr(t,Zlt,e.borderTopWidth),this.borderRightWidth=Hr(t,Ylt,e.borderRightWidth),this.borderBottomWidth=Hr(t,Jlt,e.borderBottomWidth),this.borderLeftWidth=Hr(t,tct,e.borderLeftWidth),this.boxShadow=Hr(t,Kct,e.boxShadow),this.color=Hr(t,ect,e.color),this.direction=Hr(t,rct,e.direction),this.display=Hr(t,nct,e.display),this.float=Hr(t,sct,e.cssFloat),this.fontFamily=Hr(t,Dct,e.fontFamily),this.fontSize=Hr(t,Nct,e.fontSize),this.fontStyle=Hr(t,zct,e.fontStyle),this.fontVariant=Hr(t,Qct,e.fontVariant),this.fontWeight=Hr(t,kct,e.fontWeight),this.letterSpacing=Hr(t,oct,e.letterSpacing),this.lineBreak=Hr(t,act,e.lineBreak),this.lineHeight=Hr(t,lct,e.lineHeight),this.listStyleImage=Hr(t,cct,e.listStyleImage),this.listStylePosition=Hr(t,uct,e.listStylePosition),this.listStyleType=Hr(t,ix,e.listStyleType),this.marginTop=Hr(t,hct,e.marginTop),this.marginRight=Hr(t,Act,e.marginRight),this.marginBottom=Hr(t,dct,e.marginBottom),this.marginLeft=Hr(t,fct,e.marginLeft),this.opacity=Hr(t,Rct,e.opacity);var s=Hr(t,pct,e.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Hr(t,gct,e.overflowWrap),this.paddingTop=Hr(t,mct,e.paddingTop),this.paddingRight=Hr(t,yct,e.paddingRight),this.paddingBottom=Hr(t,_ct,e.paddingBottom),this.paddingLeft=Hr(t,vct,e.paddingLeft),this.paintOrder=Hr(t,Wct,e.paintOrder),this.position=Hr(t,wct,e.position),this.textAlign=Hr(t,bct,e.textAlign),this.textDecorationColor=Hr(t,Oct,(n=e.textDecorationColor)!==null&&n!==void 0?n:e.color),this.textDecorationLine=Hr(t,Uct,(i=e.textDecorationLine)!==null&&i!==void 0?i:e.textDecoration),this.textShadow=Hr(t,xct,e.textShadow),this.textTransform=Hr(t,Bct,e.textTransform),this.transform=Hr(t,Cct,e.transform),this.transformOrigin=Hr(t,Pct,e.transformOrigin),this.visibility=Hr(t,Mct,e.visibility),this.webkitTextStrokeColor=Hr(t,$ct,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=Hr(t,Xct,e.webkitTextStrokeWidth),this.wordBreak=Hr(t,Fct,e.wordBreak),this.zIndex=Hr(t,Lct,e.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return IA(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Ao(this.display,4)||Ao(this.display,33554432)||Ao(this.display,268435456)||Ao(this.display,536870912)||Ao(this.display,67108864)||Ao(this.display,134217728)},r}(),Yct=function(){function r(t,e){this.content=Hr(t,Hct,e.content),this.quotes=Hr(t,qct,e.quotes)}return r}(),nR=function(){function r(t,e){this.counterIncrement=Hr(t,Vct,e.counterIncrement),this.counterReset=Hr(t,Gct,e.counterReset)}return r}(),Hr=function(r,t,e){var n=new I4,i=e!==null&&typeof e<"u"?e.toString():t.initialValue;n.write(i);var s=new P4(n.read());switch(t.type){case 2:var a=s.parseComponentValue();return t.parse(r,Pi(a)?a.value:t.initialValue);case 0:return t.parse(r,s.parseComponentValue());case 1:return t.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(t.format){case"angle":return h1.parse(r,s.parseComponentValue());case"color":return SA.parse(r,s.parseComponentValue());case"image":return nx.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return EA(o)?o:Vo;case"length-percentage":var d=s.parseComponentValue();return Ys(d)?d:Vo;case"time":return eR.parse(r,s.parseComponentValue())}break}},Jct="data-html2canvas-debug",tut=function(r){var t=r.getAttribute(Jct);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},sx=function(r,t){var e=tut(r);return e===1||t===e},Gu=function(){function r(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,sx(e,3))debugger;this.styles=new Zct(t,window.getComputedStyle(e,null)),yx(e)&&(this.styles.animationDuration.some(function(n){return n>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=jy(this.context,e),sx(e,4)&&(this.flags|=16)}return r}(),eut="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",iR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",sm=typeof Uint8Array>"u"?[]:new Uint8Array(256),w1=0;w1<iR.length;w1++)sm[iR.charCodeAt(w1)]=w1;for(var rut=function(r){var t=r.length*.75,e=r.length,n,i=0,s,a,o,d;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);var f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(f)?f:new Uint8Array(f);for(n=0;n<e;n+=4)s=sm[r.charCodeAt(n)],a=sm[r.charCodeAt(n+1)],o=sm[r.charCodeAt(n+2)],d=sm[r.charCodeAt(n+3)],m[i++]=s<<2|a>>4,m[i++]=(a&15)<<4|o>>2,m[i++]=(o&3)<<6|d&63;return f},nut=function(r){for(var t=r.length,e=[],n=0;n<t;n+=2)e.push(r[n+1]<<8|r[n]);return e},iut=function(r){for(var t=r.length,e=[],n=0;n<t;n+=4)e.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return e},Sd=5,ox=11,ax=2,sut=ox-Sd,sR=65536>>Sd,out=1<<Sd,lx=out-1,aut=1024>>Sd,lut=sR+aut,cut=lut,uut=32,hut=cut+uut,Aut=65536>>ox,dut=1<<sut,fut=dut-1,oR=function(r,t,e){return r.slice?r.slice(t,e):new Uint16Array(Array.prototype.slice.call(r,t,e))},put=function(r,t,e){return r.slice?r.slice(t,e):new Uint32Array(Array.prototype.slice.call(r,t,e))},gut=function(r,t){var e=rut(r),n=Array.isArray(e)?iut(e):new Uint32Array(e),i=Array.isArray(e)?nut(e):new Uint16Array(e),s=24,a=oR(i,s/2,n[4]/2),o=n[5]===2?oR(i,(s+n[4])/2):put(n,Math.ceil((s+n[4])/4));return new mut(n[0],n[1],n[2],n[3],a,o)},mut=function(){function r(t,e,n,i,s,a){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Sd],e=(e<<ax)+(t&lx),this.data[e];if(t<=65535)return e=this.index[sR+(t-55296>>Sd)],e=(e<<ax)+(t&lx),this.data[e];if(t<this.highStart)return e=hut-Aut+(t>>ox),e=this.index[e],e+=t>>Sd&fut,e=this.index[e],e=(e<<ax)+(t&lx),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),aR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yut=typeof Uint8Array>"u"?[]:new Uint8Array(256),x1=0;x1<aR.length;x1++)yut[aR.charCodeAt(x1)]=x1;var _ut=1,cx=2,ux=3,lR=4,cR=5,vut=7,uR=8,hx=9,Ax=10,hR=11,AR=12,dR=13,fR=14,dx=15,but=function(r){for(var t=[],e=0,n=r.length;e<n;){var i=r.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){var s=r.charCodeAt(e++);(s&64512)===56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),e--)}else t.push(i)}return t},wut=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var e=r.length;if(!e)return"";for(var n=[],i=-1,s="";++i<e;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===e||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},xut=gut(eut),Id="×",pR="÷",But=function(r){return xut.get(r)},Cut=function(r,t,e){var n=e-2,i=t[n],s=t[e-1],a=t[e];if(s===cx&&a===ux)return Id;if(s===cx||s===ux||s===lR||a===cx||a===ux||a===lR)return pR;if(s===uR&&[uR,hx,hR,AR].indexOf(a)!==-1||(s===hR||s===hx)&&(a===hx||a===Ax)||(s===AR||s===Ax)&&a===Ax||a===dR||a===cR||a===vut||s===_ut)return Id;if(s===dR&&a===fR){for(;i===cR;)i=t[--n];if(i===fR)return Id}if(s===dx&&a===dx){for(var o=0;i===dx;)o++,i=t[--n];if(o%2===0)return Id}return pR},Eut=function(r){var t=but(r),e=t.length,n=0,i=0,s=t.map(But);return{next:function(){if(n>=e)return{done:!0,value:null};for(var a=Id;n<e&&(a=Cut(t,s,++n))===Id;);if(a!==Id||n===e){var o=wut.apply(null,t.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},Tut=function(r){for(var t=Eut(r),e=[],n;!(n=t.next()).done;)n.value&&e.push(n.value.slice());return e},Sut=function(r){var t=123;if(r.createRange){var e=r.createRange();if(e.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=t+"px",n.style.display="block",r.body.appendChild(n),e.selectNode(n);var i=e.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===t)return!0}}return!1},Iut=function(r){var t=r.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",r.body.appendChild(t);var e=r.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=t.firstChild,i=qy(n.data).map(function(d){return Fs(d)}),s=0,a={},o=i.every(function(d,f){e.setStart(n,s),e.setEnd(n,s+d.length);var m=e.getBoundingClientRect();s+=d.length;var v=m.x>a.x||m.y>a.y;return a=m,f===0?!0:v});return r.body.removeChild(t),o},Put=function(){return typeof new Image().crossOrigin<"u"},Mut=function(){return typeof new XMLHttpRequest().responseType=="string"},Fut=function(r){var t=new Image,e=r.createElement("canvas"),n=e.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},gR=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},Lut=function(r){var t=r.createElement("canvas"),e=100;t.width=e,t.height=e;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,e,e);var i=new Image,s=t.toDataURL();i.src=s;var a=fx(e,e,0,0,i);return n.fillStyle="red",n.fillRect(0,0,e,e),mR(a).then(function(o){n.drawImage(o,0,0);var d=n.getImageData(0,0,e,e).data;n.fillStyle="red",n.fillRect(0,0,e,e);var f=r.createElement("div");return f.style.backgroundImage="url("+s+")",f.style.height=e+"px",gR(d)?mR(fx(e,e,0,0,f)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),gR(n.getImageData(0,0,e,e).data)}).catch(function(){return!1})},fx=function(r,t,e,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",e.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},mR=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Go={get SUPPORT_RANGE_BOUNDS(){var r=Sut(document);return Object.defineProperty(Go,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Go.SUPPORT_RANGE_BOUNDS&&Iut(document);return Object.defineProperty(Go,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=Fut(document);return Object.defineProperty(Go,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?Lut(document):Promise.resolve(!1);return Object.defineProperty(Go,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=Put();return Object.defineProperty(Go,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=Mut();return Object.defineProperty(Go,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Go,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Go,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},om=function(){function r(t,e){this.text=t,this.bounds=e}return r}(),Rut=function(r,t,e,n){var i=Dut(t,e),s=[],a=0;return i.forEach(function(o){if(e.textDecorationLine.length||o.trim().length>0)if(Go.SUPPORT_RANGE_BOUNDS){var d=yR(n,a,o.length).getClientRects();if(d.length>1){var f=px(o),m=0;f.forEach(function(C){s.push(new om(C,Sh.fromDOMRectList(r,yR(n,m+a,C.length).getClientRects()))),m+=C.length})}else s.push(new om(o,Sh.fromDOMRectList(r,d)))}else{var v=n.splitText(o.length);s.push(new om(o,Out(r,n))),n=v}else Go.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},Out=function(r,t){var e=t.ownerDocument;if(e){var n=e.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(n,t);var s=jy(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return Sh.EMPTY},yR=function(r,t,e){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,t),i.setEnd(r,t+e),i},px=function(r){if(Go.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(r)).map(function(e){return e.segment})}return Tut(r)},Uut=function(r,t){if(Go.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(r)).map(function(n){return n.segment})}return kut(r,t)},Dut=function(r,t){return t.letterSpacing!==0?px(r):Uut(r,t)},Nut=[32,160,4961,65792,65793,4153,4241],kut=function(r,t){for(var e=Aat(r,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=qy(a),d="";o.forEach(function(f){Nut.indexOf(f)===-1?d+=Fs(f):(d.length&&n.push(d),n.push(Fs(f)),d="")}),d.length&&n.push(d)}};!(i=e.next()).done;)s();return n},Qut=function(){function r(t,e,n){this.text=zut(e.data,n.textTransform),this.textBounds=Rut(t,this.text,n,e)}return r}(),zut=function(r,t){switch(t){case 1:return r.toLowerCase();case 3:return r.replace(Hut,Vut);case 2:return r.toUpperCase();default:return r}},Hut=/(^|\s|:|-|\(|\))([a-z])/g,Vut=function(r,t,e){return r.length>0?t+e.toUpperCase():r},_R=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return t}(Gu),vR=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return t}(Gu),bR=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=new XMLSerializer,a=jy(e,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t}(Gu),wR=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(Gu),gx=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return t}(Gu),Gut=[{type:15,flags:0,unit:"px",number:3}],jut=[{type:16,flags:0,number:50}],qut=function(r){return r.width>r.height?new Sh(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new Sh(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},Kut=function(r){var t=r.type===Wut?new Array(r.value.length+1).join("•"):r.value;return t.length===0?r.placeholder||"":t},B1="checkbox",C1="radio",Wut="password",xR=707406591,mx=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=Kut(n),(i.type===B1||i.type===C1)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=qut(i.bounds)),i.type){case B1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=Gut;break;case C1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=jut;break}return i}return t}(Gu),BR=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return t}(Gu),CR=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.value=n.value,i}return t}(Gu),ER=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=SR(e,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?nm(e,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Ph.TRANSPARENT,a=n.contentWindow.document.body?nm(e,getComputedStyle(n.contentWindow.document.body).backgroundColor):Ph.TRANSPARENT;i.backgroundColor=IA(s)?IA(a)?i.styles.backgroundColor:a:s}}catch{}return i}return t}(Gu),$ut=["OL","UL","MENU"],E1=function(r,t,e,n){for(var i=t.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,IR(i)&&i.data.trim().length>0)e.textNodes.push(new Qut(r,i,e.styles));else if(rp(i))if(OR(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return E1(r,o,e,n)});else{var a=TR(r,i);a.styles.isVisible()&&(Xut(i,a,n)?a.flags|=4:Zut(a.styles)&&(a.flags|=2),$ut.indexOf(i.tagName)!==-1&&(a.flags|=8),e.elements.push(a),i.slot,i.shadowRoot?E1(r,i.shadowRoot,a,n):!S1(i)&&!PR(i)&&!I1(i)&&E1(r,i,a,n))}},TR=function(r,t){return vx(t)?new _R(r,t):MR(t)?new vR(r,t):PR(t)?new bR(r,t):Yut(t)?new wR(r,t):Jut(t)?new gx(r,t):tht(t)?new mx(r,t):I1(t)?new BR(r,t):S1(t)?new CR(r,t):LR(t)?new ER(r,t):new Gu(r,t)},SR=function(r,t){var e=TR(r,t);return e.flags|=4,E1(r,t,e,e),e},Xut=function(r,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||_x(r)&&e.styles.isTransparent()},Zut=function(r){return r.isPositioned()||r.isFloating()},IR=function(r){return r.nodeType===Node.TEXT_NODE},rp=function(r){return r.nodeType===Node.ELEMENT_NODE},yx=function(r){return rp(r)&&typeof r.style<"u"&&!T1(r)},T1=function(r){return typeof r.className=="object"},Yut=function(r){return r.tagName==="LI"},Jut=function(r){return r.tagName==="OL"},tht=function(r){return r.tagName==="INPUT"},eht=function(r){return r.tagName==="HTML"},PR=function(r){return r.tagName==="svg"},_x=function(r){return r.tagName==="BODY"},MR=function(r){return r.tagName==="CANVAS"},FR=function(r){return r.tagName==="VIDEO"},vx=function(r){return r.tagName==="IMG"},LR=function(r){return r.tagName==="IFRAME"},RR=function(r){return r.tagName==="STYLE"},rht=function(r){return r.tagName==="SCRIPT"},S1=function(r){return r.tagName==="TEXTAREA"},I1=function(r){return r.tagName==="SELECT"},OR=function(r){return r.tagName==="SLOT"},UR=function(r){return r.tagName.indexOf("-")>0},nht=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},r.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},r.prototype.pop=function(t){var e=this;t.forEach(function(n){return e.counters[n].pop()})},r.prototype.parse=function(t){var e=this,n=t.counterIncrement,i=t.counterReset,s=!0;n!==null&&n.forEach(function(o){var d=e.counters[o.counter];d&&o.increment!==0&&(s=!1,d.length||d.push(1),d[Math.max(0,d.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var d=e.counters[o.counter];a.push(o.counter),d||(d=e.counters[o.counter]=[]),d.push(o.reset)}),a},r}(),DR={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},NR={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},iht={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},sht={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},np=function(r,t,e,n,i,s){return r<t||r>e?lm(r,i,s.length>0):n.integers.reduce(function(a,o,d){for(;r>=o;)r-=o,a+=n.values[d];return a},"")+s},kR=function(r,t,e,n){var i="";do e||r--,i=n(r)+i,r/=t;while(r*t>=t);return i},Ls=function(r,t,e,n,i){var s=e-t+1;return(r<0?"-":"")+(kR(Math.abs(r),s,n,function(a){return Fs(Math.floor(a%s)+t)})+i)},Pd=function(r,t,e){e===void 0&&(e=". ");var n=t.length;return kR(Math.abs(r),n,!1,function(i){return t[Math.floor(i%n)]})+e},ip=1,MA=2,FA=4,am=8,Mh=function(r,t,e,n,i,s){if(r<-9999||r>9999)return lm(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return t[0]+o;for(var d=0;a>0&&d<=4;d++){var f=a%10;f===0&&Ao(s,ip)&&o!==""?o=t[f]+o:f>1||f===1&&d===0||f===1&&d===1&&Ao(s,MA)||f===1&&d===1&&Ao(s,FA)&&r>100||f===1&&d>1&&Ao(s,am)?o=t[f]+(d>0?e[d-1]:"")+o:f===1&&d>0&&(o=e[d-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},QR="十百千萬",zR="拾佰仟萬",HR="マイナス",bx="마이너스",lm=function(r,t,e){var n=e?". ":"",i=e?"、":"",s=e?", ":"",a=e?" ":"";switch(t){case 0:return"•"+a;case 1:return"◦"+a;case 2:return"◾"+a;case 5:var o=Ls(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return Pd(r,"〇一二三四五六七八九",i);case 6:return np(r,1,3999,DR,3,n).toLowerCase();case 7:return np(r,1,3999,DR,3,n);case 8:return Ls(r,945,969,!1,n);case 9:return Ls(r,97,122,!1,n);case 10:return Ls(r,65,90,!1,n);case 11:return Ls(r,1632,1641,!0,n);case 12:case 49:return np(r,1,9999,NR,3,n);case 35:return np(r,1,9999,NR,3,n).toLowerCase();case 13:return Ls(r,2534,2543,!0,n);case 14:case 30:return Ls(r,6112,6121,!0,n);case 15:return Pd(r,"子丑寅卯辰巳午未申酉戌亥",i);case 16:return Pd(r,"甲乙丙丁戊己庚辛壬癸",i);case 17:case 48:return Mh(r,"零一二三四五六七八九",QR,"負",i,MA|FA|am);case 47:return Mh(r,"零壹貳參肆伍陸柒捌玖",zR,"負",i,ip|MA|FA|am);case 42:return Mh(r,"零一二三四五六七八九",QR,"负",i,MA|FA|am);case 41:return Mh(r,"零壹贰叁肆伍陆柒捌玖",zR,"负",i,ip|MA|FA|am);case 26:return Mh(r,"〇一二三四五六七八九","十百千万",HR,i,0);case 25:return Mh(r,"零壱弐参四伍六七八九","拾百千万",HR,i,ip|MA|FA);case 31:return Mh(r,"영일이삼사오육칠팔구","십백천만",bx,s,ip|MA|FA);case 33:return Mh(r,"零一二三四五六七八九","十百千萬",bx,s,0);case 32:return Mh(r,"零壹貳參四五六七八九","拾百千",bx,s,ip|MA|FA);case 18:return Ls(r,2406,2415,!0,n);case 20:return np(r,1,19999,sht,3,n);case 21:return Ls(r,2790,2799,!0,n);case 22:return Ls(r,2662,2671,!0,n);case 22:return np(r,1,10999,iht,3,n);case 23:return Pd(r,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return Pd(r,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return Ls(r,3302,3311,!0,n);case 28:return Pd(r,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case 29:return Pd(r,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case 34:return Ls(r,3792,3801,!0,n);case 37:return Ls(r,6160,6169,!0,n);case 38:return Ls(r,4160,4169,!0,n);case 39:return Ls(r,2918,2927,!0,n);case 40:return Ls(r,1776,1785,!0,n);case 43:return Ls(r,3046,3055,!0,n);case 44:return Ls(r,3174,3183,!0,n);case 45:return Ls(r,3664,3673,!0,n);case 46:return Ls(r,3872,3881,!0,n);case 3:default:return Ls(r,48,57,!0,n)}},VR="data-html2canvas-ignore",GR=function(){function r(t,e,n){if(this.context=t,this.options=n,this.scrolledElements=[],this.referenceElement=e,this.counters=new nht,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(t,e){var n=this,i=oht(t,e);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,o=i.contentWindow,d=o.document,f=cht(i).then(function(){return Ia(n,void 0,void 0,function(){var m,v;return Aa(this,function(C){switch(C.label){case 0:return this.scrolledElements.forEach(dht),o&&(o.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==e.top||o.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),m=this.options.onclone,v=this.clonedReferenceElement,typeof v>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:d.fonts&&d.fonts.ready?[4,d.fonts.ready]:[3,2];case 1:C.sent(),C.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,lht(d)]:[3,4];case 3:C.sent(),C.label=4;case 4:return typeof m=="function"?[2,Promise.resolve().then(function(){return m(d,v)}).then(function(){return i})]:[2,i]}})})});return d.open(),d.write(hht(document.doctype)+"<html></html>"),Aht(this.referenceElement.ownerDocument,s,a),d.replaceChild(d.adoptNode(this.documentElement),d.documentElement),d.close(),f},r.prototype.createElementClone=function(t){if(sx(t,2))debugger;if(MR(t))return this.createCanvasClone(t);if(FR(t))return this.createVideoClone(t);if(RR(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return vx(e)&&(vx(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),UR(e)?this.createCustomElementClone(e):e},r.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return wx(t.style,e),e},r.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=t.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return t.cloneNode(!1)},r.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var n=t.ownerDocument.createElement("img");try{return n.src=t.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var s=t.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,t.width,t.height),0,0);else{var o=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(o){var d=o.getContextAttributes();(d==null?void 0:d.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},r.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var n=e.getContext("2d");try{return n&&(n.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||n.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},r.prototype.appendChildNode=function(t,e,n){(!rp(e)||!rht(e)&&!e.hasAttribute(VR)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!rp(e)||!RR(e))&&t.appendChild(this.cloneNode(e,n))},r.prototype.cloneChildNodes=function(t,e,n){for(var i=this,s=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;s;s=s.nextSibling)if(rp(s)&&OR(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(e,o,n)})}else this.appendChildNode(e,s,n)},r.prototype.cloneNode=function(t,e){if(IR(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var n=t.ownerDocument.defaultView;if(n&&rp(t)&&(yx(t)||T1(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var s=n.getComputedStyle(t),a=n.getComputedStyle(t,":before"),o=n.getComputedStyle(t,":after");this.referenceElement===t&&yx(i)&&(this.clonedReferenceElement=i),_x(i)&&ght(i);var d=this.counters.parse(new nR(this.context,s)),f=this.resolvePseudoContent(t,i,a,cm.BEFORE);UR(t)&&(e=!0),FR(t)||this.cloneChildNodes(t,i,e),f&&i.insertBefore(f,i.firstChild);var m=this.resolvePseudoContent(t,i,o,cm.AFTER);return m&&i.appendChild(m),this.counters.pop(d),(s&&(this.options.copyStyles||T1(t))&&!LR(t)||e)&&wx(s,i),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(S1(t)||I1(t))&&(S1(i)||I1(i))&&(i.value=t.value),i}return t.cloneNode(!1)},r.prototype.resolvePseudoContent=function(t,e,n,i){var s=this;if(n){var a=n.content,o=e.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new nR(this.context,n));var d=new Yct(this.context,n),f=o.createElement("html2canvaspseudoelement");wx(n,f),d.content.forEach(function(v){if(v.type===0)f.appendChild(o.createTextNode(v.value));else if(v.type===22){var C=o.createElement("img");C.src=v.value,C.style.opacity="1",f.appendChild(C)}else if(v.type===18){if(v.name==="attr"){var b=v.values.filter(Pi);b.length&&f.appendChild(o.createTextNode(t.getAttribute(b[0].value)||""))}else if(v.name==="counter"){var P=v.values.filter(tp),F=P[0],U=P[1];if(F&&Pi(F)){var k=s.counters.getCounterValue(F.value),z=U&&Pi(U)?ix.parse(s.context,U.value):3;f.appendChild(o.createTextNode(lm(k,z,!1)))}}else if(v.name==="counters"){var K=v.values.filter(tp),F=K[0],G=K[1],U=K[2];if(F&&Pi(F)){var X=s.counters.getCounterValues(F.value),Y=U&&Pi(U)?ix.parse(s.context,U.value):3,it=G&&G.type===0?G.value:"",nt=X.map(function(st){return lm(st,Y,!1)}).join(it);f.appendChild(o.createTextNode(nt))}}}else if(v.type===20)switch(v.value){case"open-quote":f.appendChild(o.createTextNode(rR(d.quotes,s.quoteDepth++,!0)));break;case"close-quote":f.appendChild(o.createTextNode(rR(d.quotes,--s.quoteDepth,!1)));break;default:f.appendChild(o.createTextNode(v.value))}}),f.className=xx+" "+Bx;var m=i===cm.BEFORE?" "+xx:" "+Bx;return T1(e)?e.className.baseValue+=m:e.className+=m,f}}},r.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},r}(),cm;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(cm||(cm={}));var oht=function(r,t){var e=r.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(VR,"true"),r.body.appendChild(e),e},aht=function(r){return new Promise(function(t){if(r.complete){t();return}if(!r.src){t();return}r.onload=t,r.onerror=t})},lht=function(r){return Promise.all([].slice.call(r.images,0).map(aht))},cht=function(r){return new Promise(function(t,e){var n=r.contentWindow;if(!n)return e("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),t(r))},50)}})},uht=["all","d","content"],wx=function(r,t){for(var e=r.length-1;e>=0;e--){var n=r.item(e);uht.indexOf(n)===-1&&t.style.setProperty(n,r.getPropertyValue(n))}return t},hht=function(r){var t="";return r&&(t+="<!DOCTYPE ",r.name&&(t+=r.name),r.internalSubset&&(t+=r.internalSubset),r.publicId&&(t+='"'+r.publicId+'"'),r.systemId&&(t+='"'+r.systemId+'"'),t+=">"),t},Aht=function(r,t,e){r&&r.defaultView&&(t!==r.defaultView.pageXOffset||e!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(t,e)},dht=function(r){var t=r[0],e=r[1],n=r[2];t.scrollLeft=e,t.scrollTop=n},fht=":before",pht=":after",xx="___html2canvas___pseudoelement_before",Bx="___html2canvas___pseudoelement_after",jR=`{
    content: "" !important;
    display: none !important;
}`,ght=function(r){mht(r,"."+xx+fht+jR+`
         .`+Bx+pht+jR)},mht=function(r,t){var e=r.ownerDocument;if(e){var n=e.createElement("style");n.textContent=t,r.appendChild(n)}},qR=function(){function r(){}return r.getOrigin=function(t){var e=r._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},r.isSameOrigin=function(t){return r.getOrigin(t)===r._origin},r.setContext=function(t){r._link=t.document.createElement("a"),r._origin=r.getOrigin(t.location.href)},r._origin="about:blank",r}(),yht=function(){function r(t,e){this.context=t,this._options=e,this._cache={}}return r.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(Ex(t)||wht(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},r.prototype.match=function(t){return this._cache[t]},r.prototype.loadImage=function(t){return Ia(this,void 0,void 0,function(){var e,n,i,s,a=this;return Aa(this,function(o){switch(o.label){case 0:return e=qR.isSameOrigin(t),n=!Cx(t)&&this._options.useCORS===!0&&Go.SUPPORT_CORS_IMAGES&&!e,i=!Cx(t)&&!e&&!Ex(t)&&typeof this._options.proxy=="string"&&Go.SUPPORT_CORS_XHR&&!n,!e&&this._options.allowTaint===!1&&!Cx(t)&&!Ex(t)&&!i&&!n?[2]:(s=t,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(d,f){var m=new Image;m.onload=function(){return d(m)},m.onerror=f,(xht(s)||n)&&(m.crossOrigin="anonymous"),m.src=s,m.complete===!0&&setTimeout(function(){return d(m)},500),a._options.imageTimeout>0&&setTimeout(function(){return f("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(t){return typeof this._cache[t]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise(function(s,a){var o=Go.SUPPORT_RESPONSE_TYPE?"blob":"text",d=new XMLHttpRequest;d.onload=function(){if(d.status===200)if(o==="text")s(d.response);else{var v=new FileReader;v.addEventListener("load",function(){return s(v.result)},!1),v.addEventListener("error",function(C){return a(C)},!1),v.readAsDataURL(d.response)}else a("Failed to proxy resource "+i+" with status code "+d.status)},d.onerror=a;var f=n.indexOf("?")>-1?"&":"?";if(d.open("GET",""+n+f+"url="+encodeURIComponent(t)+"&responseType="+o),o!=="text"&&d instanceof XMLHttpRequest&&(d.responseType=o),e._options.imageTimeout){var m=e._options.imageTimeout;d.timeout=m,d.ontimeout=function(){return a("Timed out ("+m+"ms) proxying "+i)}}d.send()})},r}(),_ht=/^data:image\/svg\+xml/i,vht=/^data:image\/.*;base64,/i,bht=/^data:image\/.*/i,wht=function(r){return Go.SUPPORT_SVG_DRAWING||!Bht(r)},Cx=function(r){return bht.test(r)},xht=function(r){return vht.test(r)},Ex=function(r){return r.substr(0,4)==="blob"},Bht=function(r){return r.substr(-3).toLowerCase()==="svg"||_ht.test(r)},kr=function(){function r(t,e){this.type=0,this.x=t,this.y=e}return r.prototype.add=function(t,e){return new r(this.x+t,this.y+e)},r}(),sp=function(r,t,e){return new kr(r.x+(t.x-r.x)*e,r.y+(t.y-r.y)*e)},P1=function(){function r(t,e,n,i){this.type=1,this.start=t,this.startControl=e,this.endControl=n,this.end=i}return r.prototype.subdivide=function(t,e){var n=sp(this.start,this.startControl,t),i=sp(this.startControl,this.endControl,t),s=sp(this.endControl,this.end,t),a=sp(n,i,t),o=sp(i,s,t),d=sp(a,o,t);return e?new r(this.start,n,a,d):new r(d,o,s,this.end)},r.prototype.add=function(t,e){return new r(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),tc=function(r){return r.type===1},Cht=function(){function r(t){var e=t.styles,n=t.bounds,i=rm(e.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=rm(e.borderTopRightRadius,n.width,n.height),d=o[0],f=o[1],m=rm(e.borderBottomRightRadius,n.width,n.height),v=m[0],C=m[1],b=rm(e.borderBottomLeftRadius,n.width,n.height),P=b[0],F=b[1],U=[];U.push((s+d)/n.width),U.push((P+v)/n.width),U.push((a+F)/n.height),U.push((f+C)/n.height);var k=Math.max.apply(Math,U);k>1&&(s/=k,a/=k,d/=k,f/=k,v/=k,C/=k,P/=k,F/=k);var z=n.width-d,K=n.height-C,G=n.width-v,X=n.height-F,Y=e.borderTopWidth,it=e.borderRightWidth,nt=e.borderBottomWidth,wt=e.borderLeftWidth,Ct=zi(e.paddingTop,t.bounds.width),st=zi(e.paddingRight,t.bounds.width),ot=zi(e.paddingBottom,t.bounds.width),vt=zi(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?ns(n.left+wt/3,n.top+Y/3,s-wt/3,a-Y/3,pi.TOP_LEFT):new kr(n.left+wt/3,n.top+Y/3),this.topRightBorderDoubleOuterBox=s>0||a>0?ns(n.left+z,n.top+Y/3,d-it/3,f-Y/3,pi.TOP_RIGHT):new kr(n.left+n.width-it/3,n.top+Y/3),this.bottomRightBorderDoubleOuterBox=v>0||C>0?ns(n.left+G,n.top+K,v-it/3,C-nt/3,pi.BOTTOM_RIGHT):new kr(n.left+n.width-it/3,n.top+n.height-nt/3),this.bottomLeftBorderDoubleOuterBox=P>0||F>0?ns(n.left+wt/3,n.top+X,P-wt/3,F-nt/3,pi.BOTTOM_LEFT):new kr(n.left+wt/3,n.top+n.height-nt/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?ns(n.left+wt*2/3,n.top+Y*2/3,s-wt*2/3,a-Y*2/3,pi.TOP_LEFT):new kr(n.left+wt*2/3,n.top+Y*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?ns(n.left+z,n.top+Y*2/3,d-it*2/3,f-Y*2/3,pi.TOP_RIGHT):new kr(n.left+n.width-it*2/3,n.top+Y*2/3),this.bottomRightBorderDoubleInnerBox=v>0||C>0?ns(n.left+G,n.top+K,v-it*2/3,C-nt*2/3,pi.BOTTOM_RIGHT):new kr(n.left+n.width-it*2/3,n.top+n.height-nt*2/3),this.bottomLeftBorderDoubleInnerBox=P>0||F>0?ns(n.left+wt*2/3,n.top+X,P-wt*2/3,F-nt*2/3,pi.BOTTOM_LEFT):new kr(n.left+wt*2/3,n.top+n.height-nt*2/3),this.topLeftBorderStroke=s>0||a>0?ns(n.left+wt/2,n.top+Y/2,s-wt/2,a-Y/2,pi.TOP_LEFT):new kr(n.left+wt/2,n.top+Y/2),this.topRightBorderStroke=s>0||a>0?ns(n.left+z,n.top+Y/2,d-it/2,f-Y/2,pi.TOP_RIGHT):new kr(n.left+n.width-it/2,n.top+Y/2),this.bottomRightBorderStroke=v>0||C>0?ns(n.left+G,n.top+K,v-it/2,C-nt/2,pi.BOTTOM_RIGHT):new kr(n.left+n.width-it/2,n.top+n.height-nt/2),this.bottomLeftBorderStroke=P>0||F>0?ns(n.left+wt/2,n.top+X,P-wt/2,F-nt/2,pi.BOTTOM_LEFT):new kr(n.left+wt/2,n.top+n.height-nt/2),this.topLeftBorderBox=s>0||a>0?ns(n.left,n.top,s,a,pi.TOP_LEFT):new kr(n.left,n.top),this.topRightBorderBox=d>0||f>0?ns(n.left+z,n.top,d,f,pi.TOP_RIGHT):new kr(n.left+n.width,n.top),this.bottomRightBorderBox=v>0||C>0?ns(n.left+G,n.top+K,v,C,pi.BOTTOM_RIGHT):new kr(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=P>0||F>0?ns(n.left,n.top+X,P,F,pi.BOTTOM_LEFT):new kr(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?ns(n.left+wt,n.top+Y,Math.max(0,s-wt),Math.max(0,a-Y),pi.TOP_LEFT):new kr(n.left+wt,n.top+Y),this.topRightPaddingBox=d>0||f>0?ns(n.left+Math.min(z,n.width-it),n.top+Y,z>n.width+it?0:Math.max(0,d-it),Math.max(0,f-Y),pi.TOP_RIGHT):new kr(n.left+n.width-it,n.top+Y),this.bottomRightPaddingBox=v>0||C>0?ns(n.left+Math.min(G,n.width-wt),n.top+Math.min(K,n.height-nt),Math.max(0,v-it),Math.max(0,C-nt),pi.BOTTOM_RIGHT):new kr(n.left+n.width-it,n.top+n.height-nt),this.bottomLeftPaddingBox=P>0||F>0?ns(n.left+wt,n.top+Math.min(X,n.height-nt),Math.max(0,P-wt),Math.max(0,F-nt),pi.BOTTOM_LEFT):new kr(n.left+wt,n.top+n.height-nt),this.topLeftContentBox=s>0||a>0?ns(n.left+wt+vt,n.top+Y+Ct,Math.max(0,s-(wt+vt)),Math.max(0,a-(Y+Ct)),pi.TOP_LEFT):new kr(n.left+wt+vt,n.top+Y+Ct),this.topRightContentBox=d>0||f>0?ns(n.left+Math.min(z,n.width+wt+vt),n.top+Y+Ct,z>n.width+wt+vt?0:d-wt+vt,f-(Y+Ct),pi.TOP_RIGHT):new kr(n.left+n.width-(it+st),n.top+Y+Ct),this.bottomRightContentBox=v>0||C>0?ns(n.left+Math.min(G,n.width-(wt+vt)),n.top+Math.min(K,n.height+Y+Ct),Math.max(0,v-(it+st)),C-(nt+ot),pi.BOTTOM_RIGHT):new kr(n.left+n.width-(it+st),n.top+n.height-(nt+ot)),this.bottomLeftContentBox=P>0||F>0?ns(n.left+wt+vt,n.top+X,Math.max(0,P-(wt+vt)),F-(nt+ot),pi.BOTTOM_LEFT):new kr(n.left+wt+vt,n.top+n.height-(nt+ot))}return r}(),pi;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(pi||(pi={}));var ns=function(r,t,e,n,i){var s=4*((Math.sqrt(2)-1)/3),a=e*s,o=n*s,d=r+e,f=t+n;switch(i){case pi.TOP_LEFT:return new P1(new kr(r,f),new kr(r,f-o),new kr(d-a,t),new kr(d,t));case pi.TOP_RIGHT:return new P1(new kr(r,t),new kr(r+a,t),new kr(d,f-o),new kr(d,f));case pi.BOTTOM_RIGHT:return new P1(new kr(d,t),new kr(d,t+o),new kr(r+a,f),new kr(r,f));case pi.BOTTOM_LEFT:default:return new P1(new kr(d,f),new kr(d-a,f),new kr(r,t+o),new kr(r,t))}},M1=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},Eht=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},F1=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},Tht=function(){function r(t,e,n){this.offsetX=t,this.offsetY=e,this.matrix=n,this.type=0,this.target=6}return r}(),L1=function(){function r(t,e){this.path=t,this.target=e,this.type=1}return r}(),Sht=function(){function r(t){this.opacity=t,this.type=2,this.target=6}return r}(),Iht=function(r){return r.type===0},KR=function(r){return r.type===1},Pht=function(r){return r.type===2},WR=function(r,t){return r.length===t.length?r.some(function(e,n){return e===t[n]}):!1},Mht=function(r,t,e,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(t,e);case 1:return s.add(t+n,e);case 2:return s.add(t+n,e+i);case 3:return s.add(t,e+i)}return s})},$R=function(){function r(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),XR=function(){function r(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new Cht(this.container),this.container.styles.opacity<1&&this.effects.push(new Sht(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new Tht(n,i,s))}if(this.container.styles.overflowX!==0){var a=M1(this.curves),o=F1(this.curves);WR(a,o)?this.effects.push(new L1(a,6)):(this.effects.push(new L1(a,2)),this.effects.push(new L1(o,4)))}}return r.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(d){return!KR(d)});if(e||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),e=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=M1(n.curves),o=F1(n.curves);WR(a,o)||i.unshift(new L1(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(d){return Ao(d.target,t)})},r}(),Tx=function(r,t,e,n){r.container.elements.forEach(function(i){var s=Ao(i.flags,4),a=Ao(i.flags,2),o=new XR(i,r);Ao(i.styles.display,2048)&&n.push(o);var d=Ao(i.flags,8)?[]:n;if(s||a){var f=s||i.styles.isPositioned()?e:t,m=new $R(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var v=i.styles.zIndex.order;if(v<0){var C=0;f.negativeZIndex.some(function(P,F){return v>P.element.container.styles.zIndex.order?(C=F,!1):C>0}),f.negativeZIndex.splice(C,0,m)}else if(v>0){var b=0;f.positiveZIndex.some(function(P,F){return v>=P.element.container.styles.zIndex.order?(b=F+1,!1):b>0}),f.positiveZIndex.splice(b,0,m)}else f.zeroOrAutoZIndexOrTransformedOrOpacity.push(m)}else i.styles.isFloating()?f.nonPositionedFloats.push(m):f.nonPositionedInlineLevel.push(m);Tx(o,m,s?m:e,d)}else i.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),Tx(o,t,e,d);Ao(i.flags,8)&&ZR(i,d)})},ZR=function(r,t){for(var e=r instanceof gx?r.start:1,n=r instanceof gx?r.reversed:!1,i=0;i<t.length;i++){var s=t[i];s.container instanceof wR&&typeof s.container.value=="number"&&s.container.value!==0&&(e=s.container.value),s.listValue=lm(e,s.container.styles.listStyleType,!0),e+=n?-1:1}},Fht=function(r){var t=new XR(r,null),e=new $R(t),n=[];return Tx(t,e,e,n),ZR(t.container,n),e},YR=function(r,t){switch(t){case 0:return ec(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return ec(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return ec(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return ec(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},Lht=function(r,t){switch(t){case 0:return ec(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return ec(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return ec(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return ec(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Rht=function(r,t){switch(t){case 0:return ec(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return ec(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return ec(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return ec(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Oht=function(r,t){switch(t){case 0:return R1(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return R1(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return R1(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return R1(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},R1=function(r,t){var e=[];return tc(r)?e.push(r.subdivide(.5,!1)):e.push(r),tc(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},ec=function(r,t,e,n){var i=[];return tc(r)?i.push(r.subdivide(.5,!1)):i.push(r),tc(e)?i.push(e.subdivide(.5,!0)):i.push(e),tc(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),tc(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},JR=function(r){var t=r.bounds,e=r.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},O1=function(r){var t=r.styles,e=r.bounds,n=zi(t.paddingLeft,e.width),i=zi(t.paddingRight,e.width),s=zi(t.paddingTop,e.width),a=zi(t.paddingBottom,e.width);return e.add(n+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+s+a))},Uht=function(r,t){return r===0?t.bounds:r===2?O1(t):JR(t)},Dht=function(r,t){return r===0?t.bounds:r===2?O1(t):JR(t)},Sx=function(r,t,e){var n=Uht(ap(r.styles.backgroundOrigin,t),r),i=Dht(ap(r.styles.backgroundClip,t),r),s=Nht(ap(r.styles.backgroundSize,t),e,n),a=s[0],o=s[1],d=rm(ap(r.styles.backgroundPosition,t),n.width-a,n.height-o),f=kht(ap(r.styles.backgroundRepeat,t),d,s,n,i),m=Math.round(n.left+d[0]),v=Math.round(n.top+d[1]);return[f,m,v,a,o]},op=function(r){return Pi(r)&&r.value===ep.AUTO},U1=function(r){return typeof r=="number"},Nht=function(r,t,e){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1];if(!a)return[0,0];if(Ys(a)&&o&&Ys(o))return[zi(a,e.width),zi(o,e.height)];var d=U1(s);if(Pi(a)&&(a.value===ep.CONTAIN||a.value===ep.COVER)){if(U1(s)){var f=e.width/e.height;return f<s!=(a.value===ep.COVER)?[e.width,e.width/s]:[e.height*s,e.height]}return[e.width,e.height]}var m=U1(n),v=U1(i),C=m||v;if(op(a)&&(!o||op(o))){if(m&&v)return[n,i];if(!d&&!C)return[e.width,e.height];if(C&&d){var b=m?n:i*s,P=v?i:n/s;return[b,P]}var F=m?n:e.width,U=v?i:e.height;return[F,U]}if(d){var k=0,z=0;return Ys(a)?k=zi(a,e.width):Ys(o)&&(z=zi(o,e.height)),op(a)?k=z*s:(!o||op(o))&&(z=k/s),[k,z]}var K=null,G=null;if(Ys(a)?K=zi(a,e.width):o&&Ys(o)&&(G=zi(o,e.height)),K!==null&&(!o||op(o))&&(G=m&&v?K/n*i:e.height),G!==null&&op(a)&&(K=m&&v?G/i*n:e.width),K!==null&&G!==null)return[K,G];throw new Error("Unable to calculate background-size for element")},ap=function(r,t){var e=r[t];return typeof e>"u"?r[0]:e},kht=function(r,t,e,n,i){var s=t[0],a=t[1],o=e[0],d=e[1];switch(r){case 2:return[new kr(Math.round(n.left),Math.round(n.top+a)),new kr(Math.round(n.left+n.width),Math.round(n.top+a)),new kr(Math.round(n.left+n.width),Math.round(d+n.top+a)),new kr(Math.round(n.left),Math.round(d+n.top+a))];case 3:return[new kr(Math.round(n.left+s),Math.round(n.top)),new kr(Math.round(n.left+s+o),Math.round(n.top)),new kr(Math.round(n.left+s+o),Math.round(n.height+n.top)),new kr(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new kr(Math.round(n.left+s),Math.round(n.top+a)),new kr(Math.round(n.left+s+o),Math.round(n.top+a)),new kr(Math.round(n.left+s+o),Math.round(n.top+a+d)),new kr(Math.round(n.left+s),Math.round(n.top+a+d))];default:return[new kr(Math.round(i.left),Math.round(i.top)),new kr(Math.round(i.left+i.width),Math.round(i.top)),new kr(Math.round(i.left+i.width),Math.round(i.height+i.top)),new kr(Math.round(i.left),Math.round(i.height+i.top))]}},Qht="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",tO="Hidden Text",zht=function(){function r(t){this._data={},this._document=t}return r.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=Qht,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(tO)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(tO)),n.style.lineHeight="normal",i.style.verticalAlign="super";var d=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:d}},r.prototype.getMetrics=function(t,e){var n=t+" "+e;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},r}(),eO=function(){function r(t,e){this.context=t,this.options=e}return r}(),Hht=1e4,Vht=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new zht(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return t.prototype.applyEffects=function(e){for(var n=this;this._activeEffects.length;)this.popEffect();e.forEach(function(i){return n.applyEffect(i)})},t.prototype.applyEffect=function(e){this.ctx.save(),Pht(e)&&(this.ctx.globalAlpha=e.opacity),Iht(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),KR(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return Ia(this,void 0,void 0,function(){var n;return Aa(this,function(i){switch(i.label){case 0:return n=e.element.container.styles,n.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return Ia(this,void 0,void 0,function(){return Aa(this,function(n){switch(n.label){case 0:if(Ao(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,n,i){var s=this;if(n===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+i);else{var a=px(e.text);a.reduce(function(o,d){return s.ctx.fillText(d,o,e.bounds.top+i),o+s.ctx.measureText(d).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var n=e.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=Wht(e.fontFamily).join(", "),s=em(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,n,e.fontWeight,s,i].join(" "),i,s]},t.prototype.renderTextNode=function(e,n){return Ia(this,void 0,void 0,function(){var i,s,a,o,d,f,m,v,C=this;return Aa(this,function(b){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",d=this.fontMetrics.getMetrics(a,o),f=d.baseline,m=d.middle,v=n.paintOrder,e.textBounds.forEach(function(P){v.forEach(function(F){switch(F){case 0:C.ctx.fillStyle=So(n.color),C.renderTextWithLetterSpacing(P,n.letterSpacing,f);var U=n.textShadow;U.length&&P.text.trim().length&&(U.slice(0).reverse().forEach(function(k){C.ctx.shadowColor=So(k.color),C.ctx.shadowOffsetX=k.offsetX.number*C.options.scale,C.ctx.shadowOffsetY=k.offsetY.number*C.options.scale,C.ctx.shadowBlur=k.blur.number,C.renderTextWithLetterSpacing(P,n.letterSpacing,f)}),C.ctx.shadowColor="",C.ctx.shadowOffsetX=0,C.ctx.shadowOffsetY=0,C.ctx.shadowBlur=0),n.textDecorationLine.length&&(C.ctx.fillStyle=So(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(k){switch(k){case 1:C.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top+f),P.bounds.width,1);break;case 2:C.ctx.fillRect(P.bounds.left,Math.round(P.bounds.top),P.bounds.width,1);break;case 3:C.ctx.fillRect(P.bounds.left,Math.ceil(P.bounds.top+m),P.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&P.text.trim().length&&(C.ctx.strokeStyle=So(n.webkitTextStrokeColor),C.ctx.lineWidth=n.webkitTextStrokeWidth,C.ctx.lineJoin=window.chrome?"miter":"round",C.ctx.strokeText(P.text,P.bounds.left,P.bounds.top+f)),C.ctx.strokeStyle="",C.ctx.lineWidth=0,C.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,n,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var s=O1(e),a=F1(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,d,z,z,f,m,v,C,G,b,P,X,F,U,k,z,K,G,X;return Aa(this,function(Y){switch(Y.label){case 0:this.applyEffects(e.getEffects(4)),n=e.container,i=e.curves,s=n.styles,a=0,o=n.textNodes,Y.label=1;case 1:return a<o.length?(d=o[a],[4,this.renderTextNode(d,s)]):[3,4];case 2:Y.sent(),Y.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof _R))return[3,8];Y.label=5;case 5:return Y.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return z=Y.sent(),this.renderReplacedElement(n,i,z),[3,8];case 7:return Y.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof vR&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof bR))return[3,12];Y.label=9;case 9:return Y.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return z=Y.sent(),this.renderReplacedElement(n,i,z),[3,12];case 11:return Y.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof ER&&n.tree?(f=new t(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,f.render(n.tree)]):[3,14];case 13:m=Y.sent(),n.width&&n.height&&this.ctx.drawImage(m,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),Y.label=14;case 14:if(n instanceof mx&&(v=Math.min(n.bounds.width,n.bounds.height),n.type===B1?n.checked&&(this.ctx.save(),this.path([new kr(n.bounds.left+v*.39363,n.bounds.top+v*.79),new kr(n.bounds.left+v*.16,n.bounds.top+v*.5549),new kr(n.bounds.left+v*.27347,n.bounds.top+v*.44071),new kr(n.bounds.left+v*.39694,n.bounds.top+v*.5649),new kr(n.bounds.left+v*.72983,n.bounds.top+v*.23),new kr(n.bounds.left+v*.84,n.bounds.top+v*.34085),new kr(n.bounds.left+v*.39363,n.bounds.top+v*.79)]),this.ctx.fillStyle=So(xR),this.ctx.fill(),this.ctx.restore()):n.type===C1&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+v/2,n.bounds.top+v/2,v/4,0,Math.PI*2,!0),this.ctx.fillStyle=So(xR),this.ctx.fill(),this.ctx.restore())),Ght(n)&&n.value.length){switch(C=this.createFontStyle(s),G=C[0],b=C[1],P=this.fontMetrics.getMetrics(G,b).baseline,this.ctx.font=G,this.ctx.fillStyle=So(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=qht(n.styles.textAlign),X=O1(n),F=0,n.styles.textAlign){case 1:F+=X.width/2;break;case 2:F+=X.width;break}U=X.add(F,0,0,-X.height/2+1),this.ctx.save(),this.path([new kr(X.left,X.top),new kr(X.left+X.width,X.top),new kr(X.left+X.width,X.top+X.height),new kr(X.left,X.top+X.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new om(n.value,U),s.letterSpacing,P),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ao(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(k=n.styles.listStyleImage,k.type!==0)return[3,18];z=void 0,K=k.url,Y.label=15;case 15:return Y.trys.push([15,17,,18]),[4,this.context.cache.match(K)];case 16:return z=Y.sent(),this.ctx.drawImage(z,n.bounds.left-(z.width+10),n.bounds.top),[3,18];case 17:return Y.sent(),this.context.logger.error("Error loading list-style-image "+K),[3,18];case 18:return[3,20];case 19:e.listValue&&n.styles.listStyleType!==-1&&(G=this.createFontStyle(s)[0],this.ctx.font=G,this.ctx.fillStyle=So(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",X=new Sh(n.bounds.left,n.bounds.top+zi(n.styles.paddingTop,n.bounds.width),n.bounds.width,J4(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new om(e.listValue,X),s.letterSpacing,J4(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),Y.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return Ia(this,void 0,void 0,function(){var n,i,k,s,a,k,o,d,k,f,m,k,v,C,k,b,P,k,F,U,k;return Aa(this,function(z){switch(z.label){case 0:if(Ao(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:z.sent(),n=0,i=e.negativeZIndex,z.label=2;case 2:return n<i.length?(k=i[n],[4,this.renderStack(k)]):[3,5];case 3:z.sent(),z.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:z.sent(),s=0,a=e.nonInlineLevel,z.label=7;case 7:return s<a.length?(k=a[s],[4,this.renderNode(k)]):[3,10];case 8:z.sent(),z.label=9;case 9:return s++,[3,7];case 10:o=0,d=e.nonPositionedFloats,z.label=11;case 11:return o<d.length?(k=d[o],[4,this.renderStack(k)]):[3,14];case 12:z.sent(),z.label=13;case 13:return o++,[3,11];case 14:f=0,m=e.nonPositionedInlineLevel,z.label=15;case 15:return f<m.length?(k=m[f],[4,this.renderStack(k)]):[3,18];case 16:z.sent(),z.label=17;case 17:return f++,[3,15];case 18:v=0,C=e.inlineLevel,z.label=19;case 19:return v<C.length?(k=C[v],[4,this.renderNode(k)]):[3,22];case 20:z.sent(),z.label=21;case 21:return v++,[3,19];case 22:b=0,P=e.zeroOrAutoZIndexOrTransformedOrOpacity,z.label=23;case 23:return b<P.length?(k=P[b],[4,this.renderStack(k)]):[3,26];case 24:z.sent(),z.label=25;case 25:return b++,[3,23];case 26:F=0,U=e.positiveZIndex,z.label=27;case 27:return F<U.length?(k=U[F],[4,this.renderStack(k)]):[3,30];case 28:z.sent(),z.label=29;case 29:return F++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var n=this;e.forEach(function(i,s){var a=tc(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),tc(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},t.prototype.renderRepeat=function(e,n,i,s){this.path(e),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},t.prototype.resizeImage=function(e,n,i){var s;if(e.width===n&&e.height===i)return e;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var d=o.getContext("2d");return d.drawImage(e,0,0,e.width,e.height,0,0,n,i),o},t.prototype.renderBackgroundImage=function(e){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,d;return Aa(this,function(f){switch(f.label){case 0:n=e.styles.backgroundImage.length-1,i=function(m){var v,C,b,Ct,Wt,ee,vt,yt,nt,P,Ct,Wt,ee,vt,yt,F,U,k,z,K,G,X,Y,it,nt,wt,Ct,st,ot,vt,yt,re,Wt,ee,Zt,oe,pe,De,at,Tt,Rt,Nt;return Aa(this,function(ae){switch(ae.label){case 0:if(m.type!==0)return[3,5];v=void 0,C=m.url,ae.label=1;case 1:return ae.trys.push([1,3,,4]),[4,s.context.cache.match(C)];case 2:return v=ae.sent(),[3,4];case 3:return ae.sent(),s.context.logger.error("Error loading background-image "+C),[3,4];case 4:return v&&(b=Sx(e,n,[v.width,v.height,v.width/v.height]),Ct=b[0],Wt=b[1],ee=b[2],vt=b[3],yt=b[4],nt=s.ctx.createPattern(s.resizeImage(v,vt,yt),"repeat"),s.renderRepeat(Ct,nt,Wt,ee)),[3,6];case 5:Ilt(m)?(P=Sx(e,n,[null,null,null]),Ct=P[0],Wt=P[1],ee=P[2],vt=P[3],yt=P[4],F=Blt(m.angle,vt,yt),U=F[0],k=F[1],z=F[2],K=F[3],G=F[4],X=document.createElement("canvas"),X.width=vt,X.height=yt,Y=X.getContext("2d"),it=Y.createLinearGradient(k,K,z,G),H4(m.stops,U).forEach(function(Xt){return it.addColorStop(Xt.stop,So(Xt.color))}),Y.fillStyle=it,Y.fillRect(0,0,vt,yt),vt>0&&yt>0&&(nt=s.ctx.createPattern(X,"repeat"),s.renderRepeat(Ct,nt,Wt,ee))):Plt(m)&&(wt=Sx(e,n,[null,null,null]),Ct=wt[0],st=wt[1],ot=wt[2],vt=wt[3],yt=wt[4],re=m.position.length===0?[ex]:m.position,Wt=zi(re[0],vt),ee=zi(re[re.length-1],yt),Zt=Clt(m,Wt,ee,vt,yt),oe=Zt[0],pe=Zt[1],oe>0&&pe>0&&(De=s.ctx.createRadialGradient(st+Wt,ot+ee,0,st+Wt,ot+ee,oe),H4(m.stops,oe*2).forEach(function(Xt){return De.addColorStop(Xt.stop,So(Xt.color))}),s.path(Ct),s.ctx.fillStyle=De,oe!==pe?(at=e.bounds.left+.5*e.bounds.width,Tt=e.bounds.top+.5*e.bounds.height,Rt=pe/oe,Nt=1/Rt,s.ctx.save(),s.ctx.translate(at,Tt),s.ctx.transform(1,0,0,Rt,0,0),s.ctx.translate(-at,-Tt),s.ctx.fillRect(st,Nt*(ot-Tt)+Tt,vt,yt*Nt),s.ctx.restore()):s.ctx.fill())),ae.label=6;case 6:return n--,[2]}})},s=this,a=0,o=e.styles.backgroundImage.slice(0).reverse(),f.label=1;case 1:return a<o.length?(d=o[a],[5,i(d)]):[3,4];case 2:f.sent(),f.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,n,i){return Ia(this,void 0,void 0,function(){return Aa(this,function(s){return this.path(YR(i,n)),this.ctx.fillStyle=So(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,n,i,s){return Ia(this,void 0,void 0,function(){var a,o;return Aa(this,function(d){switch(d.label){case 0:return n<3?[4,this.renderSolidBorder(e,i,s)]:[3,2];case 1:return d.sent(),[2];case 2:return a=Lht(s,i),this.path(a),this.ctx.fillStyle=So(e),this.ctx.fill(),o=Rht(s,i),this.path(o),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,d,f,m,v=this;return Aa(this,function(C){switch(C.label){case 0:return this.applyEffects(e.getEffects(2)),n=e.container.styles,i=!IA(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=jht(ap(n.backgroundClip,0),e.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),IA(n.backgroundColor)||(this.ctx.fillStyle=So(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:C.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(b){v.ctx.save();var P=M1(e.curves),F=b.inset?0:Hht,U=Mht(P,-F+(b.inset?1:-1)*b.spread.number,(b.inset?1:-1)*b.spread.number,b.spread.number*(b.inset?-2:2),b.spread.number*(b.inset?-2:2));b.inset?(v.path(P),v.ctx.clip(),v.mask(U)):(v.mask(P),v.ctx.clip(),v.path(U)),v.ctx.shadowOffsetX=b.offsetX.number+F,v.ctx.shadowOffsetY=b.offsetY.number,v.ctx.shadowColor=So(b.color),v.ctx.shadowBlur=b.blur.number,v.ctx.fillStyle=b.inset?So(b.color):"rgba(0,0,0,1)",v.ctx.fill(),v.ctx.restore()}),C.label=2;case 2:o=0,d=0,f=s,C.label=3;case 3:return d<f.length?(m=f[d],m.style!==0&&!IA(m.color)&&m.width>0?m.style!==2?[3,5]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,2)]:[3,11]):[3,13];case 4:return C.sent(),[3,11];case 5:return m.style!==3?[3,7]:[4,this.renderDashedDottedBorder(m.color,m.width,o,e.curves,3)];case 6:return C.sent(),[3,11];case 7:return m.style!==4?[3,9]:[4,this.renderDoubleBorder(m.color,m.width,o,e.curves)];case 8:return C.sent(),[3,11];case 9:return[4,this.renderSolidBorder(m.color,o,e.curves)];case 10:C.sent(),C.label=11;case 11:o++,C.label=12;case 12:return d++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,n,i,s,a){return Ia(this,void 0,void 0,function(){var o,d,f,m,v,C,b,P,F,U,k,z,K,G,X,Y,X,Y;return Aa(this,function(it){return this.ctx.save(),o=Oht(s,i),d=YR(s,i),a===2&&(this.path(d),this.ctx.clip()),tc(d[0])?(f=d[0].start.x,m=d[0].start.y):(f=d[0].x,m=d[0].y),tc(d[1])?(v=d[1].end.x,C=d[1].end.y):(v=d[1].x,C=d[1].y),i===0||i===2?b=Math.abs(f-v):b=Math.abs(m-C),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(d.slice(0,2)),P=n<3?n*3:n*2,F=n<3?n*2:n,a===3&&(P=n,F=n),U=!0,b<=P*2?U=!1:b<=P*2+F?(k=b/(2*P+F),P*=k,F*=k):(z=Math.floor((b+F)/(P+F)),K=(b-z*P)/(z-1),G=(b-(z+1)*P)/z,F=G<=0||Math.abs(F-K)<Math.abs(F-G)?K:G),U&&(a===3?this.ctx.setLineDash([0,P+F]):this.ctx.setLineDash([P,F])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=So(e),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(tc(d[0])&&(X=d[3],Y=d[0],this.ctx.beginPath(),this.formatPath([new kr(X.end.x,X.end.y),new kr(Y.start.x,Y.start.y)]),this.ctx.stroke()),tc(d[1])&&(X=d[1],Y=d[2],this.ctx.beginPath(),this.formatPath([new kr(X.end.x,X.end.y),new kr(Y.start.x,Y.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return Ia(this,void 0,void 0,function(){var n;return Aa(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=So(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=Fht(e),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},t}(eO),Ght=function(r){return r instanceof CR||r instanceof BR?!0:r instanceof mx&&r.type!==C1&&r.type!==B1},jht=function(r,t){switch(r){case 0:return M1(t);case 2:return Eht(t);case 1:default:return F1(t)}},qht=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Kht=["-apple-system","system-ui"],Wht=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(t){return Kht.indexOf(t)===-1}):r},$ht=function(r){kc(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return t.prototype.render=function(e){return Ia(this,void 0,void 0,function(){var n,i;return Aa(this,function(s){switch(s.label){case 0:return n=fx(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Xht(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=So(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t}(eO),Xht=function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){t(n)},n.onerror=e,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Zht=function(){function r(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Gy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Gy([this.id,this.getTime()+"ms"],t))},r.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Gy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Gy([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},r.instances={},r}(),Yht=function(){function r(t,e){var n;this.windowBounds=e,this.instanceName="#"+r.instanceCount++,this.logger=new Zht({id:this.instanceName,enabled:t.logging}),this.cache=(n=t.cache)!==null&&n!==void 0?n:new yht(this,t)}return r.instanceCount=1,r}(),Jht=function(r,t){return t===void 0&&(t={}),tAt(r,t)};typeof window<"u"&&qR.setContext(window);var tAt=function(r,t){return Ia(void 0,void 0,void 0,function(){var e,n,i,s,a,o,d,f,m,v,C,b,P,F,U,k,z,K,G,X,it,Y,it,nt,wt,Ct,st,ot,vt,yt,re,Wt,ee,Zt,oe,pe,De,at,Tt,Rt;return Aa(this,function(Nt){switch(Nt.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=r.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(n=e.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(nt=t.allowTaint)!==null&&nt!==void 0?nt:!1,imageTimeout:(wt=t.imageTimeout)!==null&&wt!==void 0?wt:15e3,proxy:t.proxy,useCORS:(Ct=t.useCORS)!==null&&Ct!==void 0?Ct:!1},s=R2({logging:(st=t.logging)!==null&&st!==void 0?st:!0,cache:t.cache},i),a={windowWidth:(ot=t.windowWidth)!==null&&ot!==void 0?ot:n.innerWidth,windowHeight:(vt=t.windowHeight)!==null&&vt!==void 0?vt:n.innerHeight,scrollX:(yt=t.scrollX)!==null&&yt!==void 0?yt:n.pageXOffset,scrollY:(re=t.scrollY)!==null&&re!==void 0?re:n.pageYOffset},o=new Sh(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),d=new Yht(s,o),f=(Wt=t.foreignObjectRendering)!==null&&Wt!==void 0?Wt:!1,m={allowTaint:(ee=t.allowTaint)!==null&&ee!==void 0?ee:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},d.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),v=new GR(d,r,m),C=v.clonedReferenceElement,C?[4,v.toIFrame(e,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return b=Nt.sent(),P=_x(C)||eht(C)?Mot(C.ownerDocument):jy(d,C),F=P.width,U=P.height,k=P.left,z=P.top,K=eAt(d,C,t.backgroundColor),G={canvas:t.canvas,backgroundColor:K,scale:(oe=(Zt=t.scale)!==null&&Zt!==void 0?Zt:n.devicePixelRatio)!==null&&oe!==void 0?oe:1,x:((pe=t.x)!==null&&pe!==void 0?pe:0)+k,y:((De=t.y)!==null&&De!==void 0?De:0)+z,width:(at=t.width)!==null&&at!==void 0?at:Math.ceil(F),height:(Tt=t.height)!==null&&Tt!==void 0?Tt:Math.ceil(U)},f?(d.logger.debug("Document cloned, using foreign object rendering"),it=new $ht(d,G),[4,it.render(C)]):[3,3];case 2:return X=Nt.sent(),[3,5];case 3:return d.logger.debug("Document cloned, element located at "+k+","+z+" with size "+F+"x"+U+" using computed rendering"),d.logger.debug("Starting DOM parsing"),Y=SR(d,C),K===Y.styles.backgroundColor&&(Y.styles.backgroundColor=Ph.TRANSPARENT),d.logger.debug("Starting renderer for element at "+G.x+","+G.y+" with size "+G.width+"x"+G.height),it=new Vht(d,G),[4,it.render(Y)];case 4:X=Nt.sent(),Nt.label=5;case 5:return(!((Rt=t.removeContainer)!==null&&Rt!==void 0)||Rt)&&(GR.destroy(b)||d.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),d.logger.debug("Finished rendering"),[2,X]}})})},eAt=function(r,t,e){var n=t.ownerDocument,i=n.documentElement?nm(r,getComputedStyle(n.documentElement).backgroundColor):Ph.TRANSPARENT,s=n.body?nm(r,getComputedStyle(n.body).backgroundColor):Ph.TRANSPARENT,a=typeof e=="string"?nm(r,e):e===null?Ph.TRANSPARENT:4294967295;return t===n.documentElement?IA(i)?IA(s)?a:s:i:a};const rAt=Object.freeze(Object.defineProperty({__proto__:null,default:Jht},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.5.8 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.8/LICENSE */function LA(r){"@babel/helpers - typeof";return LA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},LA(r)}function Ix(r,t){return Ix=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Ix(r,t)}function nAt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D1(r,t,e){return nAt()?D1=Reflect.construct:D1=function(n,i,s){var a=[null];a.push.apply(a,i);var o=Function.bind.apply(n,a),d=new o;return s&&Ix(d,s.prototype),d},D1.apply(null,arguments)}function zc(r){return iAt(r)||sAt(r)||oAt(r)||aAt()}function iAt(r){if(Array.isArray(r))return Px(r)}function sAt(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function oAt(r,t){if(r){if(typeof r=="string")return Px(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Px(r,t)}}function Px(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function aAt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var lAt=Object.hasOwnProperty,rO=Object.setPrototypeOf,cAt=Object.isFrozen,uAt=Object.getPrototypeOf,hAt=Object.getOwnPropertyDescriptor,Fa=Object.freeze,rc=Object.seal,AAt=Object.create,nO=typeof Reflect<"u"&&Reflect,N1=nO.apply,Mx=nO.construct;N1||(N1=function(r,t,e){return r.apply(t,e)}),Fa||(Fa=function(r){return r}),rc||(rc=function(r){return r}),Mx||(Mx=function(r,t){return D1(r,zc(t))});var dAt=nc(Array.prototype.forEach),iO=nc(Array.prototype.pop),um=nc(Array.prototype.push),k1=nc(String.prototype.toLowerCase),Fx=nc(String.prototype.toString),sO=nc(String.prototype.match),Hc=nc(String.prototype.replace),fAt=nc(String.prototype.indexOf),pAt=nc(String.prototype.trim),jo=nc(RegExp.prototype.test),Lx=gAt(TypeError);function nc(r){return function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return N1(r,t,n)}}function gAt(r){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Mx(r,e)}}function Ln(r,t,e){var n;e=(n=e)!==null&&n!==void 0?n:k1,rO&&rO(r,null);for(var i=t.length;i--;){var s=t[i];if(typeof s=="string"){var a=e(s);a!==s&&(cAt(t)||(t[i]=a),s=a)}r[s]=!0}return r}function Md(r){var t=AAt(null),e;for(e in r)N1(lAt,r,[e])===!0&&(t[e]=r[e]);return t}function Q1(r,t){for(;r!==null;){var e=hAt(r,t);if(e){if(e.get)return nc(e.get);if(typeof e.value=="function")return nc(e.value)}r=uAt(r)}function n(i){return console.warn("fallback value for",i),null}return n}var oO=Fa(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Rx=Fa(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ox=Fa(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),mAt=Fa(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ux=Fa(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),yAt=Fa(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),aO=Fa(["#text"]),lO=Fa(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Dx=Fa(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),cO=Fa(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),z1=Fa(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),_At=rc(/\{\{[\w\W]*|[\w\W]*\}\}/gm),vAt=rc(/<%[\w\W]*|[\w\W]*%>/gm),bAt=rc(/\${[\w\W]*}/gm),wAt=rc(/^data-[\-\w.\u00B7-\uFFFF]+$/),xAt=rc(/^aria-[\-\w]+$/),BAt=rc(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),CAt=rc(/^(?:\w+script|data):/i),EAt=rc(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),TAt=rc(/^html$/i),SAt=rc(/^[a-z][.\w]*(-[.\w]+)+$/i),IAt=function(){return typeof window>"u"?null:window},PAt=function(r,t){if(LA(r)!=="object"||typeof r.createPolicy!="function")return null;var e=null,n="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(n)&&(e=t.currentScript.getAttribute(n));var i="dompurify"+(e?"#"+e:"");try{return r.createPolicy(i,{createHTML:function(s){return s},createScriptURL:function(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function uO(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:IAt(),t=function(Kt){return uO(Kt)};if(t.version="2.5.8",t.removed=[],!r||!r.document||r.document.nodeType!==9)return t.isSupported=!1,t;var e=r.document,n=r.document,i=r.DocumentFragment,s=r.HTMLTemplateElement,a=r.Node,o=r.Element,d=r.NodeFilter,f=r.NamedNodeMap,m=f===void 0?r.NamedNodeMap||r.MozNamedAttrMap:f,v=r.HTMLFormElement,C=r.DOMParser,b=r.trustedTypes,P=o.prototype,F=Q1(P,"cloneNode"),U=Q1(P,"nextSibling"),k=Q1(P,"childNodes"),z=Q1(P,"parentNode");if(typeof s=="function"){var K=n.createElement("template");K.content&&K.content.ownerDocument&&(n=K.content.ownerDocument)}var G=PAt(b,e),X=G?G.createHTML(""):"",Y=n,it=Y.implementation,nt=Y.createNodeIterator,wt=Y.createDocumentFragment,Ct=Y.getElementsByTagName,st=e.importNode,ot={};try{ot=Md(n).documentMode?n.documentMode:{}}catch{}var vt={};t.isSupported=typeof z=="function"&&it&&it.createHTMLDocument!==void 0&&ot!==9;var yt=_At,re=vAt,Wt=bAt,ee=wAt,Zt=xAt,oe=CAt,pe=EAt,De=SAt,at=BAt,Tt=null,Rt=Ln({},[].concat(zc(oO),zc(Rx),zc(Ox),zc(Ux),zc(aO))),Nt=null,ae=Ln({},[].concat(zc(lO),zc(Dx),zc(cO),zc(z1))),Xt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ye=null,de=null,qe=!0,Ve=!0,Je=!1,or=!0,mr=!1,Me=!0,Qt=!1,Ur=!1,Ir=!1,$e=!1,Xe=!1,er=!1,gr=!0,Re=!1,sr="user-content-",Br=!0,xr=!1,Lr={},Zr=null,Nr=Ln({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Vr=null,yr=Ln({},["audio","video","img","source","image","track"]),In=null,an=Ln({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xn="http://www.w3.org/1998/Math/MathML",Bt="http://www.w3.org/2000/svg",ct="http://www.w3.org/1999/xhtml",ft=ct,pt=!1,Dt=null,Gt=Ln({},[Xn,Bt,ct],Fx),le,ge=["application/xhtml+xml","text/html"],te="text/html",he,ve=null,me=n.createElement("form"),Yt=function(Kt){return Kt instanceof RegExp||Kt instanceof Function},ur=function(Kt){ve&&ve===Kt||((!Kt||LA(Kt)!=="object")&&(Kt={}),Kt=Md(Kt),le=ge.indexOf(Kt.PARSER_MEDIA_TYPE)===-1?le=te:le=Kt.PARSER_MEDIA_TYPE,he=le==="application/xhtml+xml"?Fx:k1,Tt="ALLOWED_TAGS"in Kt?Ln({},Kt.ALLOWED_TAGS,he):Rt,Nt="ALLOWED_ATTR"in Kt?Ln({},Kt.ALLOWED_ATTR,he):ae,Dt="ALLOWED_NAMESPACES"in Kt?Ln({},Kt.ALLOWED_NAMESPACES,Fx):Gt,In="ADD_URI_SAFE_ATTR"in Kt?Ln(Md(an),Kt.ADD_URI_SAFE_ATTR,he):an,Vr="ADD_DATA_URI_TAGS"in Kt?Ln(Md(yr),Kt.ADD_DATA_URI_TAGS,he):yr,Zr="FORBID_CONTENTS"in Kt?Ln({},Kt.FORBID_CONTENTS,he):Nr,ye="FORBID_TAGS"in Kt?Ln({},Kt.FORBID_TAGS,he):{},de="FORBID_ATTR"in Kt?Ln({},Kt.FORBID_ATTR,he):{},Lr="USE_PROFILES"in Kt?Kt.USE_PROFILES:!1,qe=Kt.ALLOW_ARIA_ATTR!==!1,Ve=Kt.ALLOW_DATA_ATTR!==!1,Je=Kt.ALLOW_UNKNOWN_PROTOCOLS||!1,or=Kt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,mr=Kt.SAFE_FOR_TEMPLATES||!1,Me=Kt.SAFE_FOR_XML!==!1,Qt=Kt.WHOLE_DOCUMENT||!1,$e=Kt.RETURN_DOM||!1,Xe=Kt.RETURN_DOM_FRAGMENT||!1,er=Kt.RETURN_TRUSTED_TYPE||!1,Ir=Kt.FORCE_BODY||!1,gr=Kt.SANITIZE_DOM!==!1,Re=Kt.SANITIZE_NAMED_PROPS||!1,Br=Kt.KEEP_CONTENT!==!1,xr=Kt.IN_PLACE||!1,at=Kt.ALLOWED_URI_REGEXP||at,ft=Kt.NAMESPACE||ct,Xt=Kt.CUSTOM_ELEMENT_HANDLING||{},Kt.CUSTOM_ELEMENT_HANDLING&&Yt(Kt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Xt.tagNameCheck=Kt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Kt.CUSTOM_ELEMENT_HANDLING&&Yt(Kt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Xt.attributeNameCheck=Kt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Kt.CUSTOM_ELEMENT_HANDLING&&typeof Kt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Xt.allowCustomizedBuiltInElements=Kt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),mr&&(Ve=!1),Xe&&($e=!0),Lr&&(Tt=Ln({},zc(aO)),Nt=[],Lr.html===!0&&(Ln(Tt,oO),Ln(Nt,lO)),Lr.svg===!0&&(Ln(Tt,Rx),Ln(Nt,Dx),Ln(Nt,z1)),Lr.svgFilters===!0&&(Ln(Tt,Ox),Ln(Nt,Dx),Ln(Nt,z1)),Lr.mathMl===!0&&(Ln(Tt,Ux),Ln(Nt,cO),Ln(Nt,z1))),Kt.ADD_TAGS&&(Tt===Rt&&(Tt=Md(Tt)),Ln(Tt,Kt.ADD_TAGS,he)),Kt.ADD_ATTR&&(Nt===ae&&(Nt=Md(Nt)),Ln(Nt,Kt.ADD_ATTR,he)),Kt.ADD_URI_SAFE_ATTR&&Ln(In,Kt.ADD_URI_SAFE_ATTR,he),Kt.FORBID_CONTENTS&&(Zr===Nr&&(Zr=Md(Zr)),Ln(Zr,Kt.FORBID_CONTENTS,he)),Br&&(Tt["#text"]=!0),Qt&&Ln(Tt,["html","head","body"]),Tt.table&&(Ln(Tt,["tbody"]),delete ye.tbody),Fa&&Fa(Kt),ve=Kt)},ir=Ln({},["mi","mo","mn","ms","mtext"]),tr=Ln({},["annotation-xml"]),Mr=Ln({},["title","style","font","a","script"]),Fe=Ln({},Rx);Ln(Fe,Ox),Ln(Fe,mAt);var nr=Ln({},Ux);Ln(nr,yAt);var _r=function(Kt){var Er=z(Kt);(!Er||!Er.tagName)&&(Er={namespaceURI:ft,tagName:"template"});var cr=k1(Kt.tagName),dn=k1(Er.tagName);return Dt[Kt.namespaceURI]?Kt.namespaceURI===Bt?Er.namespaceURI===ct?cr==="svg":Er.namespaceURI===Xn?cr==="svg"&&(dn==="annotation-xml"||ir[dn]):!!Fe[cr]:Kt.namespaceURI===Xn?Er.namespaceURI===ct?cr==="math":Er.namespaceURI===Bt?cr==="math"&&tr[dn]:!!nr[cr]:Kt.namespaceURI===ct?Er.namespaceURI===Bt&&!tr[dn]||Er.namespaceURI===Xn&&!ir[dn]?!1:!nr[cr]&&(Mr[cr]||!Fe[cr]):!!(le==="application/xhtml+xml"&&Dt[Kt.namespaceURI]):!1},Fr=function(Kt){um(t.removed,{element:Kt});try{Kt.parentNode.removeChild(Kt)}catch{try{Kt.outerHTML=X}catch{Kt.remove()}}},Yr=function(Kt,Er){try{um(t.removed,{attribute:Er.getAttributeNode(Kt),from:Er})}catch{um(t.removed,{attribute:null,from:Er})}if(Er.removeAttribute(Kt),Kt==="is"&&!Nt[Kt])if($e||Xe)try{Fr(Er)}catch{}else try{Er.setAttribute(Kt,"")}catch{}},Qr=function(Kt){var Er,cr;if(Ir)Kt="<remove></remove>"+Kt;else{var dn=sO(Kt,/^[\r\n\t ]+/);cr=dn&&dn[0]}le==="application/xhtml+xml"&&ft===ct&&(Kt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Kt+"</body></html>");var qn=G?G.createHTML(Kt):Kt;if(ft===ct)try{Er=new C().parseFromString(qn,le)}catch{}if(!Er||!Er.documentElement){Er=it.createDocument(ft,"template",null);try{Er.documentElement.innerHTML=pt?X:qn}catch{}}var Gn=Er.body||Er.documentElement;return Kt&&cr&&Gn.insertBefore(n.createTextNode(cr),Gn.childNodes[0]||null),ft===ct?Ct.call(Er,Qt?"html":"body")[0]:Qt?Er.documentElement:Gn},vr=function(Kt){return nt.call(Kt.ownerDocument||Kt,Kt,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null,!1)},wn=function(Kt){return Kt instanceof v&&(typeof Kt.nodeName!="string"||typeof Kt.textContent!="string"||typeof Kt.removeChild!="function"||!(Kt.attributes instanceof m)||typeof Kt.removeAttribute!="function"||typeof Kt.setAttribute!="function"||typeof Kt.namespaceURI!="string"||typeof Kt.insertBefore!="function"||typeof Kt.hasChildNodes!="function")},Ai=function(Kt){return LA(a)==="object"?Kt instanceof a:Kt&&LA(Kt)==="object"&&typeof Kt.nodeType=="number"&&typeof Kt.nodeName=="string"},mn=function(Kt,Er,cr){vt[Kt]&&dAt(vt[Kt],function(dn){dn.call(t,Er,cr,ve)})},Dn=function(Kt){var Er;if(mn("beforeSanitizeElements",Kt,null),wn(Kt)||jo(/[\u0080-\uFFFF]/,Kt.nodeName))return Fr(Kt),!0;var cr=he(Kt.nodeName);if(mn("uponSanitizeElement",Kt,{tagName:cr,allowedTags:Tt}),Kt.hasChildNodes()&&!Ai(Kt.firstElementChild)&&(!Ai(Kt.content)||!Ai(Kt.content.firstElementChild))&&jo(/<[/\w]/g,Kt.innerHTML)&&jo(/<[/\w]/g,Kt.textContent)||cr==="select"&&jo(/<template/i,Kt.innerHTML)||Kt.nodeType===7||Me&&Kt.nodeType===8&&jo(/<[/\w]/g,Kt.data))return Fr(Kt),!0;if(!Tt[cr]||ye[cr]){if(!ye[cr]&&Hn(cr)&&(Xt.tagNameCheck instanceof RegExp&&jo(Xt.tagNameCheck,cr)||Xt.tagNameCheck instanceof Function&&Xt.tagNameCheck(cr)))return!1;if(Br&&!Zr[cr]){var dn=z(Kt)||Kt.parentNode,qn=k(Kt)||Kt.childNodes;if(qn&&dn)for(var Gn=qn.length,Qn=Gn-1;Qn>=0;--Qn){var di=F(qn[Qn],!0);di.__removalCount=(Kt.__removalCount||0)+1,dn.insertBefore(di,U(Kt))}}return Fr(Kt),!0}return Kt instanceof o&&!_r(Kt)||(cr==="noscript"||cr==="noembed"||cr==="noframes")&&jo(/<\/no(script|embed|frames)/i,Kt.innerHTML)?(Fr(Kt),!0):(mr&&Kt.nodeType===3&&(Er=Kt.textContent,Er=Hc(Er,yt," "),Er=Hc(Er,re," "),Er=Hc(Er,Wt," "),Kt.textContent!==Er&&(um(t.removed,{element:Kt.cloneNode()}),Kt.textContent=Er)),mn("afterSanitizeElements",Kt,null),!1)},gn=function(Kt,Er,cr){if(gr&&(Er==="id"||Er==="name")&&(cr in n||cr in me))return!1;if(!(Ve&&!de[Er]&&jo(ee,Er))&&!(qe&&jo(Zt,Er))){if(!Nt[Er]||de[Er]){if(!(Hn(Kt)&&(Xt.tagNameCheck instanceof RegExp&&jo(Xt.tagNameCheck,Kt)||Xt.tagNameCheck instanceof Function&&Xt.tagNameCheck(Kt))&&(Xt.attributeNameCheck instanceof RegExp&&jo(Xt.attributeNameCheck,Er)||Xt.attributeNameCheck instanceof Function&&Xt.attributeNameCheck(Er))||Er==="is"&&Xt.allowCustomizedBuiltInElements&&(Xt.tagNameCheck instanceof RegExp&&jo(Xt.tagNameCheck,cr)||Xt.tagNameCheck instanceof Function&&Xt.tagNameCheck(cr))))return!1}else if(!In[Er]&&!jo(at,Hc(cr,pe,""))&&!((Er==="src"||Er==="xlink:href"||Er==="href")&&Kt!=="script"&&fAt(cr,"data:")===0&&Vr[Kt])&&!(Je&&!jo(oe,Hc(cr,pe,"")))&&cr)return!1}return!0},Hn=function(Kt){return Kt!=="annotation-xml"&&sO(Kt,De)},xn=function(Kt){var Er,cr,dn,qn;mn("beforeSanitizeAttributes",Kt,null);var Gn=Kt.attributes;if(!(!Gn||wn(Kt))){var Qn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Nt};for(qn=Gn.length;qn--;){Er=Gn[qn];var di=Er,xi=di.name,mi=di.namespaceURI;if(cr=xi==="value"?Er.value:pAt(Er.value),dn=he(xi),Qn.attrName=dn,Qn.attrValue=cr,Qn.keepAttr=!0,Qn.forceKeepAttr=void 0,mn("uponSanitizeAttribute",Kt,Qn),cr=Qn.attrValue,!Qn.forceKeepAttr&&(Yr(xi,Kt),!!Qn.keepAttr)){if(!or&&jo(/\/>/i,cr)){Yr(xi,Kt);continue}mr&&(cr=Hc(cr,yt," "),cr=Hc(cr,re," "),cr=Hc(cr,Wt," "));var Ds=he(Kt.nodeName);if(gn(Ds,dn,cr)){if(Re&&(dn==="id"||dn==="name")&&(Yr(xi,Kt),cr=sr+cr),Me&&jo(/((--!?|])>)|<\/(style|title)/i,cr)){Yr(xi,Kt);continue}if(G&&LA(b)==="object"&&typeof b.getAttributeType=="function"&&!mi)switch(b.getAttributeType(Ds,dn)){case"TrustedHTML":{cr=G.createHTML(cr);break}case"TrustedScriptURL":{cr=G.createScriptURL(cr);break}}try{mi?Kt.setAttributeNS(mi,xi,cr):Kt.setAttribute(xi,cr),wn(Kt)?Fr(Kt):iO(t.removed)}catch{}}}}mn("afterSanitizeAttributes",Kt,null)}},vs=function Kt(Er){var cr,dn=vr(Er);for(mn("beforeSanitizeShadowDOM",Er,null);cr=dn.nextNode();)mn("uponSanitizeShadowNode",cr,null),Dn(cr),xn(cr),cr.content instanceof i&&Kt(cr.content);mn("afterSanitizeShadowDOM",Er,null)};return t.sanitize=function(Kt){var Er=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},cr,dn,qn,Gn,Qn;if(pt=!Kt,pt&&(Kt="<!-->"),typeof Kt!="string"&&!Ai(Kt))if(typeof Kt.toString=="function"){if(Kt=Kt.toString(),typeof Kt!="string")throw Lx("dirty is not a string, aborting")}else throw Lx("toString is not a function");if(!t.isSupported){if(LA(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof Kt=="string")return r.toStaticHTML(Kt);if(Ai(Kt))return r.toStaticHTML(Kt.outerHTML)}return Kt}if(Ur||ur(Er),t.removed=[],typeof Kt=="string"&&(xr=!1),xr){if(Kt.nodeName){var di=he(Kt.nodeName);if(!Tt[di]||ye[di])throw Lx("root node is forbidden and cannot be sanitized in-place")}}else if(Kt instanceof a)cr=Qr("<!---->"),dn=cr.ownerDocument.importNode(Kt,!0),dn.nodeType===1&&dn.nodeName==="BODY"||dn.nodeName==="HTML"?cr=dn:cr.appendChild(dn);else{if(!$e&&!mr&&!Qt&&Kt.indexOf("<")===-1)return G&&er?G.createHTML(Kt):Kt;if(cr=Qr(Kt),!cr)return $e?null:er?X:""}cr&&Ir&&Fr(cr.firstChild);for(var xi=vr(xr?Kt:cr);qn=xi.nextNode();)qn.nodeType===3&&qn===Gn||(Dn(qn),xn(qn),qn.content instanceof i&&vs(qn.content),Gn=qn);if(Gn=null,xr)return Kt;if($e){if(Xe)for(Qn=wt.call(cr.ownerDocument);cr.firstChild;)Qn.appendChild(cr.firstChild);else Qn=cr;return(Nt.shadowroot||Nt.shadowrootmod)&&(Qn=st.call(e,Qn,!0)),Qn}var mi=Qt?cr.outerHTML:cr.innerHTML;return Qt&&Tt["!doctype"]&&cr.ownerDocument&&cr.ownerDocument.doctype&&cr.ownerDocument.doctype.name&&jo(TAt,cr.ownerDocument.doctype.name)&&(mi="<!DOCTYPE "+cr.ownerDocument.doctype.name+`>
`+mi),mr&&(mi=Hc(mi,yt," "),mi=Hc(mi,re," "),mi=Hc(mi,Wt," ")),G&&er?G.createHTML(mi):mi},t.setConfig=function(Kt){ur(Kt),Ur=!0},t.clearConfig=function(){ve=null,Ur=!1},t.isValidAttribute=function(Kt,Er,cr){ve||ur({});var dn=he(Kt),qn=he(Er);return gn(dn,qn,cr)},t.addHook=function(Kt,Er){typeof Er=="function"&&(vt[Kt]=vt[Kt]||[],um(vt[Kt],Er))},t.removeHook=function(Kt){if(vt[Kt])return iO(vt[Kt])},t.removeHooks=function(Kt){vt[Kt]&&(vt[Kt]=[])},t.removeAllHooks=function(){vt={}},t}var MAt=uO();const FAt=Object.freeze(Object.defineProperty({__proto__:null,default:MAt},Symbol.toStringTag,{value:"Module"}));var Nx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hO(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var LAt={},AO={},hm,dO;function ys(){if(dO)return hm;dO=1;var r=function(t){return t&&t.Math===Math&&t};return hm=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof Nx=="object"&&Nx)||r(typeof hm=="object"&&hm)||function(){return this}()||Function("return this")(),hm}var kx={},fO,pO;function Rs(){return pO||(pO=1,fO=function(r){try{return!!r()}catch{return!0}}),fO}var Qx,gO;function Vc(){if(gO)return Qx;gO=1;var r=Rs();return Qx=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Qx}var zx,mO;function H1(){if(mO)return zx;mO=1;var r=Rs();return zx=!r(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),zx}var Hx,yO;function qo(){if(yO)return Hx;yO=1;var r=H1(),t=Function.prototype.call;return Hx=r?t.bind(t):function(){return t.apply(t,arguments)},Hx}var Vx={},_O;function RAt(){if(_O)return Vx;_O=1;var r={}.propertyIsEnumerable,t=Object.getOwnPropertyDescriptor,e=t&&!r.call({1:2},1);return Vx.f=e?function(n){var i=t(this,n);return!!i&&i.enumerable}:r,Vx}var vO,bO;function Gx(){return bO||(bO=1,vO=function(r,t){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:t}}),vO}var jx,wO;function Os(){if(wO)return jx;wO=1;var r=H1(),t=Function.prototype,e=t.call,n=r&&t.bind.bind(e,e);return jx=r?n:function(i){return function(){return e.apply(i,arguments)}},jx}var qx,xO;function Fd(){if(xO)return qx;xO=1;var r=Os(),t=r({}.toString),e=r("".slice);return qx=function(n){return e(t(n),8,-1)},qx}var Kx,BO;function CO(){if(BO)return Kx;BO=1;var r=Os(),t=Rs(),e=Fd(),n=Object,i=r("".split);return Kx=t(function(){return!n("z").propertyIsEnumerable(0)})?function(s){return e(s)==="String"?i(s,""):n(s)}:n,Kx}var EO,TO;function Ld(){return TO||(TO=1,EO=function(r){return r==null}),EO}var Wx,SO;function Gc(){if(SO)return Wx;SO=1;var r=Ld(),t=TypeError;return Wx=function(e){if(r(e))throw new t("Can't call method on "+e);return e},Wx}var $x,IO;function Am(){if(IO)return $x;IO=1;var r=CO(),t=Gc();return $x=function(e){return r(t(e))},$x}var Xx,PO;function Us(){if(PO)return Xx;PO=1;var r=typeof document=="object"&&document.all;return Xx=typeof r>"u"&&r!==void 0?function(t){return typeof t=="function"||t===r}:function(t){return typeof t=="function"},Xx}var Zx,MO;function jc(){if(MO)return Zx;MO=1;var r=Us();return Zx=function(t){return typeof t=="object"?t!==null:r(t)},Zx}var Yx,FO;function Rd(){if(FO)return Yx;FO=1;var r=ys(),t=Us(),e=function(n){return t(n)?n:void 0};return Yx=function(n,i){return arguments.length<2?e(r[n]):r[n]&&r[n][i]},Yx}var Jx,LO;function V1(){if(LO)return Jx;LO=1;var r=Os();return Jx=r({}.isPrototypeOf),Jx}var tB,RO;function dm(){if(RO)return tB;RO=1;var r=ys(),t=r.navigator,e=t&&t.userAgent;return tB=e?String(e):"",tB}var eB,OO;function rB(){if(OO)return eB;OO=1;var r=ys(),t=dm(),e=r.process,n=r.Deno,i=e&&e.versions||n&&n.version,s=i&&i.v8,a,o;return s&&(a=s.split("."),o=a[0]>0&&a[0]<4?1:+(a[0]+a[1])),!o&&t&&(a=t.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=t.match(/Chrome\/(\d+)/),a&&(o=+a[1]))),eB=o,eB}var nB,UO;function DO(){if(UO)return nB;UO=1;var r=rB(),t=Rs(),e=ys(),n=e.String;return nB=!!Object.getOwnPropertySymbols&&!t(function(){var i=Symbol("symbol detection");return!n(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&r&&r<41}),nB}var iB,NO;function kO(){if(NO)return iB;NO=1;var r=DO();return iB=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol",iB}var sB,QO;function zO(){if(QO)return sB;QO=1;var r=Rd(),t=Us(),e=V1(),n=kO(),i=Object;return sB=n?function(s){return typeof s=="symbol"}:function(s){var a=r("Symbol");return t(a)&&e(a.prototype,i(s))},sB}var oB,HO;function G1(){if(HO)return oB;HO=1;var r=String;return oB=function(t){try{return r(t)}catch{return"Object"}},oB}var aB,VO;function Fh(){if(VO)return aB;VO=1;var r=Us(),t=G1(),e=TypeError;return aB=function(n){if(r(n))return n;throw new e(t(n)+" is not a function")},aB}var lB,GO;function lp(){if(GO)return lB;GO=1;var r=Fh(),t=Ld();return lB=function(e,n){var i=e[n];return t(i)?void 0:r(i)},lB}var cB,jO;function OAt(){if(jO)return cB;jO=1;var r=qo(),t=Us(),e=jc(),n=TypeError;return cB=function(i,s){var a,o;if(s==="string"&&t(a=i.toString)&&!e(o=r(a,i))||t(a=i.valueOf)&&!e(o=r(a,i))||s!=="string"&&t(a=i.toString)&&!e(o=r(a,i)))return o;throw new n("Can't convert object to primitive value")},cB}var uB={exports:{}},qO,KO;function ju(){return KO||(KO=1,qO=!1),qO}var hB,WO;function AB(){if(WO)return hB;WO=1;var r=ys(),t=Object.defineProperty;return hB=function(e,n){try{t(r,e,{value:n,configurable:!0,writable:!0})}catch{r[e]=n}return n},hB}var $O;function dB(){if($O)return uB.exports;$O=1;var r=ju(),t=ys(),e=AB(),n="__core-js_shared__",i=uB.exports=t[n]||e(n,{});return(i.versions||(i.versions=[])).push({version:"3.40.0",mode:r?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"}),uB.exports}var fB,XO;function pB(){if(XO)return fB;XO=1;var r=dB();return fB=function(t,e){return r[t]||(r[t]=e||{})},fB}var gB,ZO;function j1(){if(ZO)return gB;ZO=1;var r=Gc(),t=Object;return gB=function(e){return t(r(e))},gB}var mB,YO;function qc(){if(YO)return mB;YO=1;var r=Os(),t=j1(),e=r({}.hasOwnProperty);return mB=Object.hasOwn||function(n,i){return e(t(n),i)},mB}var yB,JO;function tU(){if(JO)return yB;JO=1;var r=Os(),t=0,e=Math.random(),n=r(1 .toString);return yB=function(i){return"Symbol("+(i===void 0?"":i)+")_"+n(++t+e,36)},yB}var _B,eU;function Io(){if(eU)return _B;eU=1;var r=ys(),t=pB(),e=qc(),n=tU(),i=DO(),s=kO(),a=r.Symbol,o=t("wks"),d=s?a.for||a:a&&a.withoutSetter||n;return _B=function(f){return e(o,f)||(o[f]=i&&e(a,f)?a[f]:d("Symbol."+f)),o[f]},_B}var vB,rU;function UAt(){if(rU)return vB;rU=1;var r=qo(),t=jc(),e=zO(),n=lp(),i=OAt(),s=Io(),a=TypeError,o=s("toPrimitive");return vB=function(d,f){if(!t(d)||e(d))return d;var m=n(d,o),v;if(m){if(f===void 0&&(f="default"),v=r(m,d,f),!t(v)||e(v))return v;throw new a("Can't convert object to primitive value")}return f===void 0&&(f="number"),i(d,f)},vB}var bB,nU;function iU(){if(nU)return bB;nU=1;var r=UAt(),t=zO();return bB=function(e){var n=r(e,"string");return t(n)?n:n+""},bB}var wB,sU;function q1(){if(sU)return wB;sU=1;var r=ys(),t=jc(),e=r.document,n=t(e)&&t(e.createElement);return wB=function(i){return n?e.createElement(i):{}},wB}var xB,oU;function aU(){if(oU)return xB;oU=1;var r=Vc(),t=Rs(),e=q1();return xB=!r&&!t(function(){return Object.defineProperty(e("div"),"a",{get:function(){return 7}}).a!==7}),xB}var lU;function K1(){if(lU)return kx;lU=1;var r=Vc(),t=qo(),e=RAt(),n=Gx(),i=Am(),s=iU(),a=qc(),o=aU(),d=Object.getOwnPropertyDescriptor;return kx.f=r?d:function(f,m){if(f=i(f),m=s(m),o)try{return d(f,m)}catch{}if(a(f,m))return n(!t(e.f,f,m),f[m])},kx}var BB={},CB,cU;function uU(){if(cU)return CB;cU=1;var r=Vc(),t=Rs();return CB=r&&t(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),CB}var EB,hU;function La(){if(hU)return EB;hU=1;var r=jc(),t=String,e=TypeError;return EB=function(n){if(r(n))return n;throw new e(t(n)+" is not an object")},EB}var AU;function RA(){if(AU)return BB;AU=1;var r=Vc(),t=aU(),e=uU(),n=La(),i=iU(),s=TypeError,a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,d="enumerable",f="configurable",m="writable";return BB.f=r?e?function(v,C,b){if(n(v),C=i(C),n(b),typeof v=="function"&&C==="prototype"&&"value"in b&&m in b&&!b[m]){var P=o(v,C);P&&P[m]&&(v[C]=b.value,b={configurable:f in b?b[f]:P[f],enumerable:d in b?b[d]:P[d],writable:!1})}return a(v,C,b)}:a:function(v,C,b){if(n(v),C=i(C),n(b),t)try{return a(v,C,b)}catch{}if("get"in b||"set"in b)throw new s("Accessors not supported");return"value"in b&&(v[C]=b.value),v},BB}var TB,dU;function fm(){if(dU)return TB;dU=1;var r=Vc(),t=RA(),e=Gx();return TB=r?function(n,i,s){return t.f(n,i,e(1,s))}:function(n,i,s){return n[i]=s,n},TB}var SB={exports:{}},IB,fU;function W1(){if(fU)return IB;fU=1;var r=Vc(),t=qc(),e=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,i=t(e,"name"),s=i&&(function(){}).name==="something",a=i&&(!r||r&&n(e,"name").configurable);return IB={EXISTS:i,PROPER:s,CONFIGURABLE:a},IB}var PB,pU;function MB(){if(pU)return PB;pU=1;var r=Os(),t=Us(),e=dB(),n=r(Function.toString);return t(e.inspectSource)||(e.inspectSource=function(i){return n(i)}),PB=e.inspectSource,PB}var FB,gU;function DAt(){if(gU)return FB;gU=1;var r=ys(),t=Us(),e=r.WeakMap;return FB=t(e)&&/native code/.test(String(e)),FB}var LB,mU;function RB(){if(mU)return LB;mU=1;var r=pB(),t=tU(),e=r("keys");return LB=function(n){return e[n]||(e[n]=t(n))},LB}var yU,_U;function OB(){return _U||(_U=1,yU={}),yU}var UB,vU;function $1(){if(vU)return UB;vU=1;var r=DAt(),t=ys(),e=jc(),n=fm(),i=qc(),s=dB(),a=RB(),o=OB(),d="Object already initialized",f=t.TypeError,m=t.WeakMap,v,C,b,P=function(z){return b(z)?C(z):v(z,{})},F=function(z){return function(K){var G;if(!e(K)||(G=C(K)).type!==z)throw new f("Incompatible receiver, "+z+" required");return G}};if(r||s.state){var U=s.state||(s.state=new m);U.get=U.get,U.has=U.has,U.set=U.set,v=function(z,K){if(U.has(z))throw new f(d);return K.facade=z,U.set(z,K),K},C=function(z){return U.get(z)||{}},b=function(z){return U.has(z)}}else{var k=a("state");o[k]=!0,v=function(z,K){if(i(z,k))throw new f(d);return K.facade=z,n(z,k,K),K},C=function(z){return i(z,k)?z[k]:{}},b=function(z){return i(z,k)}}return UB={set:v,get:C,has:b,enforce:P,getterFor:F},UB}var bU;function wU(){if(bU)return SB.exports;bU=1;var r=Os(),t=Rs(),e=Us(),n=qc(),i=Vc(),s=W1().CONFIGURABLE,a=MB(),o=$1(),d=o.enforce,f=o.get,m=String,v=Object.defineProperty,C=r("".slice),b=r("".replace),P=r([].join),F=i&&!t(function(){return v(function(){},"length",{value:8}).length!==8}),U=String(String).split("String"),k=SB.exports=function(z,K,G){C(m(K),0,7)==="Symbol("&&(K="["+b(m(K),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),G&&G.getter&&(K="get "+K),G&&G.setter&&(K="set "+K),(!n(z,"name")||s&&z.name!==K)&&(i?v(z,"name",{value:K,configurable:!0}):z.name=K),F&&G&&n(G,"arity")&&z.length!==G.arity&&v(z,"length",{value:G.arity});try{G&&n(G,"constructor")&&G.constructor?i&&v(z,"prototype",{writable:!1}):z.prototype&&(z.prototype=void 0)}catch{}var X=d(z);return n(X,"source")||(X.source=P(U,typeof K=="string"?K:"")),z};return Function.prototype.toString=k(function(){return e(this)&&f(this).source||a(this)},"toString"),SB.exports}var DB,xU;function Od(){if(xU)return DB;xU=1;var r=Us(),t=RA(),e=wU(),n=AB();return DB=function(i,s,a,o){o||(o={});var d=o.enumerable,f=o.name!==void 0?o.name:s;if(r(a)&&e(a,f,o),o.global)d?i[s]=a:n(s,a);else{try{o.unsafe?i[s]&&(d=!0):delete i[s]}catch{}d?i[s]=a:t.f(i,s,{value:a,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return i},DB}var NB={},kB,BU;function NAt(){if(BU)return kB;BU=1;var r=Math.ceil,t=Math.floor;return kB=Math.trunc||function(e){var n=+e;return(n>0?t:r)(n)},kB}var QB,CU;function X1(){if(CU)return QB;CU=1;var r=NAt();return QB=function(t){var e=+t;return e!==e||e===0?0:r(e)},QB}var zB,EU;function kAt(){if(EU)return zB;EU=1;var r=X1(),t=Math.max,e=Math.min;return zB=function(n,i){var s=r(n);return s<0?t(s+i,0):e(s,i)},zB}var HB,TU;function cp(){if(TU)return HB;TU=1;var r=X1(),t=Math.min;return HB=function(e){var n=r(e);return n>0?t(n,9007199254740991):0},HB}var VB,SU;function GB(){if(SU)return VB;SU=1;var r=cp();return VB=function(t){return r(t.length)},VB}var jB,IU;function PU(){if(IU)return jB;IU=1;var r=Am(),t=kAt(),e=GB(),n=function(i){return function(s,a,o){var d=r(s),f=e(d);if(f===0)return!i&&-1;var m=t(o,f),v;if(i&&a!==a){for(;f>m;)if(v=d[m++],v!==v)return!0}else for(;f>m;m++)if((i||m in d)&&d[m]===a)return i||m||0;return!i&&-1}};return jB={includes:n(!0),indexOf:n(!1)},jB}var qB,MU;function FU(){if(MU)return qB;MU=1;var r=Os(),t=qc(),e=Am(),n=PU().indexOf,i=OB(),s=r([].push);return qB=function(a,o){var d=e(a),f=0,m=[],v;for(v in d)!t(i,v)&&t(d,v)&&s(m,v);for(;o.length>f;)t(d,v=o[f++])&&(~n(m,v)||s(m,v));return m},qB}var LU,RU;function KB(){return RU||(RU=1,LU=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),LU}var OU;function QAt(){if(OU)return NB;OU=1;var r=FU(),t=KB(),e=t.concat("length","prototype");return NB.f=Object.getOwnPropertyNames||function(n){return r(n,e)},NB}var UU={},DU;function zAt(){return DU||(DU=1,UU.f=Object.getOwnPropertySymbols),UU}var WB,NU;function HAt(){if(NU)return WB;NU=1;var r=Rd(),t=Os(),e=QAt(),n=zAt(),i=La(),s=t([].concat);return WB=r("Reflect","ownKeys")||function(a){var o=e.f(i(a)),d=n.f;return d?s(o,d(a)):o},WB}var $B,kU;function VAt(){if(kU)return $B;kU=1;var r=qc(),t=HAt(),e=K1(),n=RA();return $B=function(i,s,a){for(var o=t(s),d=n.f,f=e.f,m=0;m<o.length;m++){var v=o[m];!r(i,v)&&!(a&&r(a,v))&&d(i,v,f(s,v))}},$B}var XB,QU;function zU(){if(QU)return XB;QU=1;var r=Rs(),t=Us(),e=/#|\.prototype\./,n=function(d,f){var m=s[i(d)];return m===o?!0:m===a?!1:t(f)?r(f):!!f},i=n.normalize=function(d){return String(d).replace(e,".").toLowerCase()},s=n.data={},a=n.NATIVE="N",o=n.POLYFILL="P";return XB=n,XB}var ZB,HU;function Ra(){if(HU)return ZB;HU=1;var r=ys(),t=K1().f,e=fm(),n=Od(),i=AB(),s=VAt(),a=zU();return ZB=function(o,d){var f=o.target,m=o.global,v=o.stat,C,b,P,F,U,k;if(m?b=r:v?b=r[f]||i(f,{}):b=r[f]&&r[f].prototype,b)for(P in d){if(U=d[P],o.dontCallGetSet?(k=t(b,P),F=k&&k.value):F=b[P],C=a(m?P:f+(v?".":"#")+P,o.forced),!C&&F!==void 0){if(typeof U==typeof F)continue;s(U,F)}(o.sham||F&&F.sham)&&e(U,"sham",!0),n(b,P,U,o)}},ZB}var YB,VU;function GU(){if(VU)return YB;VU=1;var r=ys(),t=dm(),e=Fd(),n=function(i){return t.slice(0,i.length)===i};return YB=function(){return n("Bun/")?"BUN":n("Cloudflare-Workers")?"CLOUDFLARE":n("Deno/")?"DENO":n("Node.js/")?"NODE":r.Bun&&typeof Bun.version=="string"?"BUN":r.Deno&&typeof Deno.version=="object"?"DENO":e(r.process)==="process"?"NODE":r.window&&r.document?"BROWSER":"REST"}(),YB}var JB,jU;function Z1(){if(jU)return JB;jU=1;var r=GU();return JB=r==="NODE",JB}var tC,qU;function GAt(){if(qU)return tC;qU=1;var r=Os(),t=Fh();return tC=function(e,n,i){try{return r(t(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},tC}var eC,KU;function jAt(){if(KU)return eC;KU=1;var r=jc();return eC=function(t){return r(t)||t===null},eC}var rC,WU;function qAt(){if(WU)return rC;WU=1;var r=jAt(),t=String,e=TypeError;return rC=function(n){if(r(n))return n;throw new e("Can't set "+t(n)+" as a prototype")},rC}var nC,$U;function XU(){if($U)return nC;$U=1;var r=GAt(),t=jc(),e=Gc(),n=qAt();return nC=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,s={},a;try{a=r(Object.prototype,"__proto__","set"),a(s,[]),i=s instanceof Array}catch{}return function(o,d){return e(o),n(d),t(o)&&(i?a(o,d):o.__proto__=d),o}}():void 0),nC}var iC,ZU;function Y1(){if(ZU)return iC;ZU=1;var r=RA().f,t=qc(),e=Io(),n=e("toStringTag");return iC=function(i,s,a){i&&!a&&(i=i.prototype),i&&!t(i,n)&&r(i,n,{configurable:!0,value:s})},iC}var sC,YU;function KAt(){if(YU)return sC;YU=1;var r=wU(),t=RA();return sC=function(e,n,i){return i.get&&r(i.get,n,{getter:!0}),i.set&&r(i.set,n,{setter:!0}),t.f(e,n,i)},sC}var oC,JU;function WAt(){if(JU)return oC;JU=1;var r=Rd(),t=KAt(),e=Io(),n=Vc(),i=e("species");return oC=function(s){var a=r(s);n&&a&&!a[i]&&t(a,i,{configurable:!0,get:function(){return this}})},oC}var aC,tD;function $At(){if(tD)return aC;tD=1;var r=V1(),t=TypeError;return aC=function(e,n){if(r(n,e))return e;throw new t("Incorrect invocation")},aC}var lC,eD;function XAt(){if(eD)return lC;eD=1;var r=Io(),t=r("toStringTag"),e={};return e[t]="z",lC=String(e)==="[object z]",lC}var cC,rD;function uC(){if(rD)return cC;rD=1;var r=XAt(),t=Us(),e=Fd(),n=Io(),i=n("toStringTag"),s=Object,a=e(function(){return arguments}())==="Arguments",o=function(d,f){try{return d[f]}catch{}};return cC=r?e:function(d){var f,m,v;return d===void 0?"Undefined":d===null?"Null":typeof(m=o(f=s(d),i))=="string"?m:a?e(f):(v=e(f))==="Object"&&t(f.callee)?"Arguments":v},cC}var hC,nD;function ZAt(){if(nD)return hC;nD=1;var r=Os(),t=Rs(),e=Us(),n=uC(),i=Rd(),s=MB(),a=function(){},o=i("Reflect","construct"),d=/^\s*(?:class|function)\b/,f=r(d.exec),m=!d.test(a),v=function(b){if(!e(b))return!1;try{return o(a,[],b),!0}catch{return!1}},C=function(b){if(!e(b))return!1;switch(n(b)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return m||!!f(d,s(b))}catch{return!0}};return C.sham=!0,hC=!o||t(function(){var b;return v(v.call)||!v(Object)||!v(function(){b=!0})||b})?C:v,hC}var AC,iD;function YAt(){if(iD)return AC;iD=1;var r=ZAt(),t=G1(),e=TypeError;return AC=function(n){if(r(n))return n;throw new e(t(n)+" is not a constructor")},AC}var dC,sD;function oD(){if(sD)return dC;sD=1;var r=La(),t=YAt(),e=Ld(),n=Io(),i=n("species");return dC=function(s,a){var o=r(s).constructor,d;return o===void 0||e(d=r(o)[i])?a:t(d)},dC}var fC,aD;function lD(){if(aD)return fC;aD=1;var r=H1(),t=Function.prototype,e=t.apply,n=t.call;return fC=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(e):function(){return n.apply(e,arguments)}),fC}var pC,cD;function J1(){if(cD)return pC;cD=1;var r=Fd(),t=Os();return pC=function(e){if(r(e)==="Function")return t(e)},pC}var gC,uD;function mC(){if(uD)return gC;uD=1;var r=J1(),t=Fh(),e=H1(),n=r(r.bind);return gC=function(i,s){return t(i),s===void 0?i:e?n(i,s):function(){return i.apply(s,arguments)}},gC}var yC,hD;function AD(){if(hD)return yC;hD=1;var r=Rd();return yC=r("document","documentElement"),yC}var _C,dD;function JAt(){if(dD)return _C;dD=1;var r=Os();return _C=r([].slice),_C}var vC,fD;function tdt(){if(fD)return vC;fD=1;var r=TypeError;return vC=function(t,e){if(t<e)throw new r("Not enough arguments");return t},vC}var bC,pD;function gD(){if(pD)return bC;pD=1;var r=dm();return bC=/(?:ipad|iphone|ipod).*applewebkit/i.test(r),bC}var wC,mD;function yD(){if(mD)return wC;mD=1;var r=ys(),t=lD(),e=mC(),n=Us(),i=qc(),s=Rs(),a=AD(),o=JAt(),d=q1(),f=tdt(),m=gD(),v=Z1(),C=r.setImmediate,b=r.clearImmediate,P=r.process,F=r.Dispatch,U=r.Function,k=r.MessageChannel,z=r.String,K=0,G={},X="onreadystatechange",Y,it,nt,wt;s(function(){Y=r.location});var Ct=function(yt){if(i(G,yt)){var re=G[yt];delete G[yt],re()}},st=function(yt){return function(){Ct(yt)}},ot=function(yt){Ct(yt.data)},vt=function(yt){r.postMessage(z(yt),Y.protocol+"//"+Y.host)};return(!C||!b)&&(C=function(yt){f(arguments.length,1);var re=n(yt)?yt:U(yt),Wt=o(arguments,1);return G[++K]=function(){t(re,void 0,Wt)},it(K),K},b=function(yt){delete G[yt]},v?it=function(yt){P.nextTick(st(yt))}:F&&F.now?it=function(yt){F.now(st(yt))}:k&&!m?(nt=new k,wt=nt.port2,nt.port1.onmessage=ot,it=e(wt.postMessage,wt)):r.addEventListener&&n(r.postMessage)&&!r.importScripts&&Y&&Y.protocol!=="file:"&&!s(vt)?(it=vt,r.addEventListener("message",ot,!1)):X in d("script")?it=function(yt){a.appendChild(d("script"))[X]=function(){a.removeChild(this),Ct(yt)}}:it=function(yt){setTimeout(st(yt),0)}),wC={set:C,clear:b},wC}var xC,_D;function edt(){if(_D)return xC;_D=1;var r=ys(),t=Vc(),e=Object.getOwnPropertyDescriptor;return xC=function(n){if(!t)return r[n];var i=e(r,n);return i&&i.value},xC}var BC,vD;function bD(){if(vD)return BC;vD=1;var r=function(){this.head=null,this.tail=null};return r.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t){var e=this.head=t.next;return e===null&&(this.tail=null),t.item}}},BC=r,BC}var CC,wD;function rdt(){if(wD)return CC;wD=1;var r=dm();return CC=/ipad|iphone|ipod/i.test(r)&&typeof Pebble<"u",CC}var EC,xD;function ndt(){if(xD)return EC;xD=1;var r=dm();return EC=/web0s(?!.*chrome)/i.test(r),EC}var TC,BD;function idt(){if(BD)return TC;BD=1;var r=ys(),t=edt(),e=mC(),n=yD().set,i=bD(),s=gD(),a=rdt(),o=ndt(),d=Z1(),f=r.MutationObserver||r.WebKitMutationObserver,m=r.document,v=r.process,C=r.Promise,b=t("queueMicrotask"),P,F,U,k,z;if(!b){var K=new i,G=function(){var X,Y;for(d&&(X=v.domain)&&X.exit();Y=K.get();)try{Y()}catch(it){throw K.head&&P(),it}X&&X.enter()};!s&&!d&&!o&&f&&m?(F=!0,U=m.createTextNode(""),new f(G).observe(U,{characterData:!0}),P=function(){U.data=F=!F}):!a&&C&&C.resolve?(k=C.resolve(void 0),k.constructor=C,z=e(k.then,k),P=function(){z(G)}):d?P=function(){v.nextTick(G)}:(n=e(n,r),P=function(){n(G)}),b=function(X){K.head||P(),K.add(X)}}return TC=b,TC}var CD,ED;function sdt(){return ED||(ED=1,CD=function(r,t){try{arguments.length===1?console.error(r):console.error(r,t)}catch{}}),CD}var TD,SD;function SC(){return SD||(SD=1,TD=function(r){try{return{error:!1,value:r()}}catch(t){return{error:!0,value:t}}}),TD}var IC,ID;function pm(){if(ID)return IC;ID=1;var r=ys();return IC=r.Promise,IC}var PC,PD;function gm(){if(PD)return PC;PD=1;var r=ys(),t=pm(),e=Us(),n=zU(),i=MB(),s=Io(),a=GU(),o=ju(),d=rB(),f=t&&t.prototype,m=s("species"),v=!1,C=e(r.PromiseRejectionEvent),b=n("Promise",function(){var P=i(t),F=P!==String(t);if(!F&&d===66||o&&!(f.catch&&f.finally))return!0;if(!d||d<51||!/native code/.test(P)){var U=new t(function(K){K(1)}),k=function(K){K(function(){},function(){})},z=U.constructor={};if(z[m]=k,v=U.then(function(){})instanceof k,!v)return!0}return!F&&(a==="BROWSER"||a==="DENO")&&!C});return PC={CONSTRUCTOR:b,REJECTION_EVENT:C,SUBCLASSING:v},PC}var MC={},MD;function mm(){if(MD)return MC;MD=1;var r=Fh(),t=TypeError,e=function(n){var i,s;this.promise=new n(function(a,o){if(i!==void 0||s!==void 0)throw new t("Bad Promise constructor");i=a,s=o}),this.resolve=r(i),this.reject=r(s)};return MC.f=function(n){return new e(n)},MC}var FD;function odt(){if(FD)return AO;FD=1;var r=Ra(),t=ju(),e=Z1(),n=ys(),i=qo(),s=Od(),a=XU(),o=Y1(),d=WAt(),f=Fh(),m=Us(),v=jc(),C=$At(),b=oD(),P=yD().set,F=idt(),U=sdt(),k=SC(),z=bD(),K=$1(),G=pm(),X=gm(),Y=mm(),it="Promise",nt=X.CONSTRUCTOR,wt=X.REJECTION_EVENT,Ct=X.SUBCLASSING,st=K.getterFor(it),ot=K.set,vt=G&&G.prototype,yt=G,re=vt,Wt=n.TypeError,ee=n.document,Zt=n.process,oe=Y.f,pe=oe,De=!!(ee&&ee.createEvent&&n.dispatchEvent),at="unhandledrejection",Tt="rejectionhandled",Rt=0,Nt=1,ae=2,Xt=1,ye=2,de,qe,Ve,Je,or=function(Re){var sr;return v(Re)&&m(sr=Re.then)?sr:!1},mr=function(Re,sr){var Br=sr.value,xr=sr.state===Nt,Lr=xr?Re.ok:Re.fail,Zr=Re.resolve,Nr=Re.reject,Vr=Re.domain,yr,In,an;try{Lr?(xr||(sr.rejection===ye&&$e(sr),sr.rejection=Xt),Lr===!0?yr=Br:(Vr&&Vr.enter(),yr=Lr(Br),Vr&&(Vr.exit(),an=!0)),yr===Re.promise?Nr(new Wt("Promise-chain cycle")):(In=or(yr))?i(In,yr,Zr,Nr):Zr(yr)):Nr(Br)}catch(Xn){Vr&&!an&&Vr.exit(),Nr(Xn)}},Me=function(Re,sr){Re.notified||(Re.notified=!0,F(function(){for(var Br=Re.reactions,xr;xr=Br.get();)mr(xr,Re);Re.notified=!1,sr&&!Re.rejection&&Ur(Re)}))},Qt=function(Re,sr,Br){var xr,Lr;De?(xr=ee.createEvent("Event"),xr.promise=sr,xr.reason=Br,xr.initEvent(Re,!1,!0),n.dispatchEvent(xr)):xr={promise:sr,reason:Br},!wt&&(Lr=n["on"+Re])?Lr(xr):Re===at&&U("Unhandled promise rejection",Br)},Ur=function(Re){i(P,n,function(){var sr=Re.facade,Br=Re.value,xr=Ir(Re),Lr;if(xr&&(Lr=k(function(){e?Zt.emit("unhandledRejection",Br,sr):Qt(at,sr,Br)}),Re.rejection=e||Ir(Re)?ye:Xt,Lr.error))throw Lr.value})},Ir=function(Re){return Re.rejection!==Xt&&!Re.parent},$e=function(Re){i(P,n,function(){var sr=Re.facade;e?Zt.emit("rejectionHandled",sr):Qt(Tt,sr,Re.value)})},Xe=function(Re,sr,Br){return function(xr){Re(sr,xr,Br)}},er=function(Re,sr,Br){Re.done||(Re.done=!0,Br&&(Re=Br),Re.value=sr,Re.state=ae,Me(Re,!0))},gr=function(Re,sr,Br){if(!Re.done){Re.done=!0,Br&&(Re=Br);try{if(Re.facade===sr)throw new Wt("Promise can't be resolved itself");var xr=or(sr);xr?F(function(){var Lr={done:!1};try{i(xr,sr,Xe(gr,Lr,Re),Xe(er,Lr,Re))}catch(Zr){er(Lr,Zr,Re)}}):(Re.value=sr,Re.state=Nt,Me(Re,!1))}catch(Lr){er({done:!1},Lr,Re)}}};if(nt&&(yt=function(Re){C(this,re),f(Re),i(de,this);var sr=st(this);try{Re(Xe(gr,sr),Xe(er,sr))}catch(Br){er(sr,Br)}},re=yt.prototype,de=function(Re){ot(this,{type:it,done:!1,notified:!1,parent:!1,reactions:new z,rejection:!1,state:Rt,value:null})},de.prototype=s(re,"then",function(Re,sr){var Br=st(this),xr=oe(b(this,yt));return Br.parent=!0,xr.ok=m(Re)?Re:!0,xr.fail=m(sr)&&sr,xr.domain=e?Zt.domain:void 0,Br.state===Rt?Br.reactions.add(xr):F(function(){mr(xr,Br)}),xr.promise}),qe=function(){var Re=new de,sr=st(Re);this.promise=Re,this.resolve=Xe(gr,sr),this.reject=Xe(er,sr)},Y.f=oe=function(Re){return Re===yt||Re===Ve?new qe(Re):pe(Re)},!t&&m(G)&&vt!==Object.prototype)){Je=vt.then,Ct||s(vt,"then",function(Re,sr){var Br=this;return new yt(function(xr,Lr){i(Je,Br,xr,Lr)}).then(Re,sr)},{unsafe:!0});try{delete vt.constructor}catch{}a&&a(vt,re)}return r({global:!0,constructor:!0,wrap:!0,forced:nt},{Promise:yt}),o(yt,it,!1,!0),d(it),AO}var LD={},RD,OD;function ym(){return OD||(OD=1,RD={}),RD}var FC,UD;function adt(){if(UD)return FC;UD=1;var r=Io(),t=ym(),e=r("iterator"),n=Array.prototype;return FC=function(i){return i!==void 0&&(t.Array===i||n[e]===i)},FC}var LC,DD;function ND(){if(DD)return LC;DD=1;var r=uC(),t=lp(),e=Ld(),n=ym(),i=Io(),s=i("iterator");return LC=function(a){if(!e(a))return t(a,s)||t(a,"@@iterator")||n[r(a)]},LC}var RC,kD;function ldt(){if(kD)return RC;kD=1;var r=qo(),t=Fh(),e=La(),n=G1(),i=ND(),s=TypeError;return RC=function(a,o){var d=arguments.length<2?i(a):o;if(t(d))return e(r(d,a));throw new s(n(a)+" is not iterable")},RC}var OC,QD;function cdt(){if(QD)return OC;QD=1;var r=qo(),t=La(),e=lp();return OC=function(n,i,s){var a,o;t(n);try{if(a=e(n,"return"),!a){if(i==="throw")throw s;return s}a=r(a,n)}catch(d){o=!0,a=d}if(i==="throw")throw s;if(o)throw a;return t(a),s},OC}var UC,zD;function HD(){if(zD)return UC;zD=1;var r=mC(),t=qo(),e=La(),n=G1(),i=adt(),s=GB(),a=V1(),o=ldt(),d=ND(),f=cdt(),m=TypeError,v=function(b,P){this.stopped=b,this.result=P},C=v.prototype;return UC=function(b,P,F){var U=F&&F.that,k=!!(F&&F.AS_ENTRIES),z=!!(F&&F.IS_RECORD),K=!!(F&&F.IS_ITERATOR),G=!!(F&&F.INTERRUPTED),X=r(P,U),Y,it,nt,wt,Ct,st,ot,vt=function(re){return Y&&f(Y,"normal",re),new v(!0,re)},yt=function(re){return k?(e(re),G?X(re[0],re[1],vt):X(re[0],re[1])):G?X(re,vt):X(re)};if(z)Y=b.iterator;else if(K)Y=b;else{if(it=d(b),!it)throw new m(n(b)+" is not iterable");if(i(it)){for(nt=0,wt=s(b);wt>nt;nt++)if(Ct=yt(b[nt]),Ct&&a(C,Ct))return Ct;return new v(!1)}Y=o(b,it)}for(st=z?b.next:Y.next;!(ot=t(st,Y)).done;){try{Ct=yt(ot.value)}catch(re){f(Y,"throw",re)}if(typeof Ct=="object"&&Ct&&a(C,Ct))return Ct}return new v(!1)},UC}var DC,VD;function udt(){if(VD)return DC;VD=1;var r=Io(),t=r("iterator"),e=!1;try{var n=0,i={next:function(){return{done:!!n++}},return:function(){e=!0}};i[t]=function(){return this},Array.from(i,function(){throw 2})}catch{}return DC=function(s,a){try{if(!a&&!e)return!1}catch{return!1}var o=!1;try{var d={};d[t]=function(){return{next:function(){return{done:o=!0}}}},s(d)}catch{}return o},DC}var NC,GD;function jD(){if(GD)return NC;GD=1;var r=pm(),t=udt(),e=gm().CONSTRUCTOR;return NC=e||!t(function(n){r.all(n).then(void 0,function(){})}),NC}var qD;function hdt(){if(qD)return LD;qD=1;var r=Ra(),t=qo(),e=Fh(),n=mm(),i=SC(),s=HD(),a=jD();return r({target:"Promise",stat:!0,forced:a},{all:function(o){var d=this,f=n.f(d),m=f.resolve,v=f.reject,C=i(function(){var b=e(d.resolve),P=[],F=0,U=1;s(o,function(k){var z=F++,K=!1;U++,t(b,d,k).then(function(G){K||(K=!0,P[z]=G,--U||m(P))},v)}),--U||m(P)});return C.error&&v(C.value),f.promise}}),LD}var KD={},WD;function Adt(){if(WD)return KD;WD=1;var r=Ra(),t=ju(),e=gm().CONSTRUCTOR,n=pm(),i=Rd(),s=Us(),a=Od(),o=n&&n.prototype;if(r({target:"Promise",proto:!0,forced:e,real:!0},{catch:function(f){return this.then(void 0,f)}}),!t&&s(n)){var d=i("Promise").prototype.catch;o.catch!==d&&a(o,"catch",d,{unsafe:!0})}return KD}var $D={},XD;function ddt(){if(XD)return $D;XD=1;var r=Ra(),t=qo(),e=Fh(),n=mm(),i=SC(),s=HD(),a=jD();return r({target:"Promise",stat:!0,forced:a},{race:function(o){var d=this,f=n.f(d),m=f.reject,v=i(function(){var C=e(d.resolve);s(o,function(b){t(C,d,b).then(f.resolve,m)})});return v.error&&m(v.value),f.promise}}),$D}var ZD={},YD;function fdt(){if(YD)return ZD;YD=1;var r=Ra(),t=mm(),e=gm().CONSTRUCTOR;return r({target:"Promise",stat:!0,forced:e},{reject:function(n){var i=t.f(this),s=i.reject;return s(n),i.promise}}),ZD}var JD={},kC,tN;function pdt(){if(tN)return kC;tN=1;var r=La(),t=jc(),e=mm();return kC=function(n,i){if(r(n),t(i)&&i.constructor===n)return i;var s=e.f(n),a=s.resolve;return a(i),s.promise},kC}var eN;function gdt(){if(eN)return JD;eN=1;var r=Ra(),t=Rd(),e=ju(),n=pm(),i=gm().CONSTRUCTOR,s=pdt(),a=t("Promise"),o=e&&!i;return r({target:"Promise",stat:!0,forced:e||i},{resolve:function(d){return s(o&&this===a?n:this,d)}}),JD}var rN;function mdt(){return rN||(rN=1,odt(),hdt(),Adt(),ddt(),fdt(),gdt()),LAt}mdt();function nN(r,t,e,n,i,s,a){try{var o=r[s](a),d=o.value}catch(f){return void e(f)}o.done?t(d):Promise.resolve(d).then(n,i)}function Lh(r){return function(){var t=this,e=arguments;return new Promise(function(n,i){var s=r.apply(t,e);function a(d){nN(s,n,i,a,o,"next",d)}function o(d){nN(s,n,i,a,o,"throw",d)}a(void 0)})}}var iN={},sN={},QC,oN;function qu(){if(oN)return QC;oN=1;var r=uC(),t=String;return QC=function(e){if(r(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return t(e)},QC}var zC,aN;function lN(){if(aN)return zC;aN=1;var r=La();return zC=function(){var t=r(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},zC}var HC,cN;function uN(){if(cN)return HC;cN=1;var r=Rs(),t=ys(),e=t.RegExp,n=r(function(){var a=e("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),i=n||r(function(){return!e("a","y").sticky}),s=n||r(function(){var a=e("^r","gy");return a.lastIndex=2,a.exec("str")!==null});return HC={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:n},HC}var VC={},GC,hN;function ydt(){if(hN)return GC;hN=1;var r=FU(),t=KB();return GC=Object.keys||function(e){return r(e,t)},GC}var AN;function _dt(){if(AN)return VC;AN=1;var r=Vc(),t=uU(),e=RA(),n=La(),i=Am(),s=ydt();return VC.f=r&&!t?Object.defineProperties:function(a,o){n(a);for(var d=i(o),f=s(o),m=f.length,v=0,C;m>v;)e.f(a,C=f[v++],d[C]);return a},VC}var jC,dN;function t_(){if(dN)return jC;dN=1;var r=La(),t=_dt(),e=KB(),n=OB(),i=AD(),s=q1(),a=RB(),o=">",d="<",f="prototype",m="script",v=a("IE_PROTO"),C=function(){},b=function(z){return d+m+o+z+d+"/"+m+o},P=function(z){z.write(b("")),z.close();var K=z.parentWindow.Object;return z=null,K},F=function(){var z=s("iframe"),K="java"+m+":",G;return z.style.display="none",i.appendChild(z),z.src=String(K),G=z.contentWindow.document,G.open(),G.write(b("document.F=Object")),G.close(),G.F},U,k=function(){try{U=new ActiveXObject("htmlfile")}catch{}k=typeof document<"u"?document.domain&&U?P(U):F():P(U);for(var z=e.length;z--;)delete k[f][e[z]];return k()};return n[v]=!0,jC=Object.create||function(z,K){var G;return z!==null?(C[f]=r(z),G=new C,C[f]=null,G[v]=z):G=k(),K===void 0?G:t.f(G,K)},jC}var qC,fN;function vdt(){if(fN)return qC;fN=1;var r=Rs(),t=ys(),e=t.RegExp;return qC=r(function(){var n=e(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),qC}var KC,pN;function bdt(){if(pN)return KC;pN=1;var r=Rs(),t=ys(),e=t.RegExp;return KC=r(function(){var n=e("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),KC}var WC,gN;function $C(){if(gN)return WC;gN=1;var r=qo(),t=Os(),e=qu(),n=lN(),i=uN(),s=pB(),a=t_(),o=$1().get,d=vdt(),f=bdt(),m=s("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,C=v,b=t("".charAt),P=t("".indexOf),F=t("".replace),U=t("".slice),k=function(){var X=/a/,Y=/b*/g;return r(v,X,"a"),r(v,Y,"a"),X.lastIndex!==0||Y.lastIndex!==0}(),z=i.BROKEN_CARET,K=/()??/.exec("")[1]!==void 0,G=k||K||z||d||f;return G&&(C=function(X){var Y=this,it=o(Y),nt=e(X),wt=it.raw,Ct,st,ot,vt,yt,re,Wt;if(wt)return wt.lastIndex=Y.lastIndex,Ct=r(C,wt,nt),Y.lastIndex=wt.lastIndex,Ct;var ee=it.groups,Zt=z&&Y.sticky,oe=r(n,Y),pe=Y.source,De=0,at=nt;if(Zt&&(oe=F(oe,"y",""),P(oe,"g")===-1&&(oe+="g"),at=U(nt,Y.lastIndex),Y.lastIndex>0&&(!Y.multiline||Y.multiline&&b(nt,Y.lastIndex-1)!==`
`)&&(pe="(?: "+pe+")",at=" "+at,De++),st=new RegExp("^(?:"+pe+")",oe)),K&&(st=new RegExp("^"+pe+"$(?!\\s)",oe)),k&&(ot=Y.lastIndex),vt=r(v,Zt?st:Y,at),Zt?vt?(vt.input=U(vt.input,De),vt[0]=U(vt[0],De),vt.index=Y.lastIndex,Y.lastIndex+=vt[0].length):Y.lastIndex=0:k&&vt&&(Y.lastIndex=Y.global?vt.index+vt[0].length:ot),K&&vt&&vt.length>1&&r(m,vt[0],st,function(){for(yt=1;yt<arguments.length-2;yt++)arguments[yt]===void 0&&(vt[yt]=void 0)}),vt&&ee)for(vt.groups=re=a(null),yt=0;yt<ee.length;yt++)Wt=ee[yt],re[Wt[0]]=vt[Wt[1]];return vt}),WC=C,WC}var mN;function wdt(){if(mN)return sN;mN=1;var r=Ra(),t=$C();return r({target:"RegExp",proto:!0,forced:/./.exec!==t},{exec:t}),sN}var XC,yN;function ZC(){if(yN)return XC;yN=1,wdt();var r=qo(),t=Od(),e=$C(),n=Rs(),i=Io(),s=fm(),a=i("species"),o=RegExp.prototype;return XC=function(d,f,m,v){var C=i(d),b=!n(function(){var k={};return k[C]=function(){return 7},""[d](k)!==7}),P=b&&!n(function(){var k=!1,z=/a/;return d==="split"&&(z={},z.constructor={},z.constructor[a]=function(){return z},z.flags="",z[C]=/./[C]),z.exec=function(){return k=!0,null},z[C](""),!k});if(!b||!P||m){var F=/./[C],U=f(C,""[d],function(k,z,K,G,X){var Y=z.exec;return Y===e||Y===o.exec?b&&!X?{done:!0,value:r(F,z,K,G)}:{done:!0,value:r(k,K,z,G)}:{done:!1}});t(String.prototype,d,U[0]),t(o,C,U[1])}v&&s(o[C],"sham",!0)},XC}var YC,_N;function xdt(){if(_N)return YC;_N=1;var r=Os(),t=X1(),e=qu(),n=Gc(),i=r("".charAt),s=r("".charCodeAt),a=r("".slice),o=function(d){return function(f,m){var v=e(n(f)),C=t(m),b=v.length,P,F;return C<0||C>=b?d?"":void 0:(P=s(v,C),P<55296||P>56319||C+1===b||(F=s(v,C+1))<56320||F>57343?d?i(v,C):P:d?a(v,C,C+2):(P-55296<<10)+(F-56320)+65536)}};return YC={codeAt:o(!1),charAt:o(!0)},YC}var JC,vN;function tE(){if(vN)return JC;vN=1;var r=xdt().charAt;return JC=function(t,e,n){return e+(n?r(t,e).length:1)},JC}var eE,bN;function rE(){if(bN)return eE;bN=1;var r=qo(),t=La(),e=Us(),n=Fd(),i=$C(),s=TypeError;return eE=function(a,o){var d=a.exec;if(e(d)){var f=r(d,a,o);return f!==null&&t(f),f}if(n(a)==="RegExp")return r(i,a,o);throw new s("RegExp#exec called on incompatible receiver")},eE}var wN;function Bdt(){if(wN)return iN;wN=1;var r=qo(),t=ZC(),e=La(),n=Ld(),i=cp(),s=qu(),a=Gc(),o=lp(),d=tE(),f=rE();return t("match",function(m,v,C){return[function(b){var P=a(this),F=n(b)?void 0:o(b,m);return F?r(F,b,P):new RegExp(b)[m](s(P))},function(b){var P=e(this),F=s(b),U=C(v,P,F);if(U.done)return U.value;if(!P.global)return f(P,F);var k=P.unicode;P.lastIndex=0;for(var z=[],K=0,G;(G=f(P,F))!==null;){var X=s(G[0]);z[K]=X,X===""&&(P.lastIndex=d(F,i(P.lastIndex),k)),K++}return K===0?null:z}]}),iN}Bdt();var xN={},nE,BN;function Cdt(){if(BN)return nE;BN=1;var r=Os(),t=j1(),e=Math.floor,n=r("".charAt),i=r("".replace),s=r("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,o=/\$([$&'`]|\d{1,2})/g;return nE=function(d,f,m,v,C,b){var P=m+d.length,F=v.length,U=o;return C!==void 0&&(C=t(C),U=a),i(b,U,function(k,z){var K;switch(n(z,0)){case"$":return"$";case"&":return d;case"`":return s(f,0,m);case"'":return s(f,P);case"<":K=C[s(z,1,-1)];break;default:var G=+z;if(G===0)return k;if(G>F){var X=e(G/10);return X===0?k:X<=F?v[X-1]===void 0?n(z,1):v[X-1]+n(z,1):k}K=v[G-1]}return K===void 0?"":K})},nE}var CN;function Edt(){if(CN)return xN;CN=1;var r=lD(),t=qo(),e=Os(),n=ZC(),i=Rs(),s=La(),a=Us(),o=Ld(),d=X1(),f=cp(),m=qu(),v=Gc(),C=tE(),b=lp(),P=Cdt(),F=rE(),U=Io(),k=U("replace"),z=Math.max,K=Math.min,G=e([].concat),X=e([].push),Y=e("".indexOf),it=e("".slice),nt=function(ot){return ot===void 0?ot:String(ot)},wt=function(){return"a".replace(/./,"$0")==="$0"}(),Ct=function(){return/./[k]?/./[k]("a","$0")==="":!1}(),st=!i(function(){var ot=/./;return ot.exec=function(){var vt=[];return vt.groups={a:"7"},vt},"".replace(ot,"$<a>")!=="7"});return n("replace",function(ot,vt,yt){var re=Ct?"$":"$0";return[function(Wt,ee){var Zt=v(this),oe=o(Wt)?void 0:b(Wt,k);return oe?t(oe,Wt,Zt,ee):t(vt,m(Zt),Wt,ee)},function(Wt,ee){var Zt=s(this),oe=m(Wt);if(typeof ee=="string"&&Y(ee,re)===-1&&Y(ee,"$<")===-1){var pe=yt(vt,Zt,oe,ee);if(pe.done)return pe.value}var De=a(ee);De||(ee=m(ee));var at=Zt.global,Tt;at&&(Tt=Zt.unicode,Zt.lastIndex=0);for(var Rt=[],Nt;Nt=F(Zt,oe),!(Nt===null||(X(Rt,Nt),!at));){var ae=m(Nt[0]);ae===""&&(Zt.lastIndex=C(oe,f(Zt.lastIndex),Tt))}for(var Xt="",ye=0,de=0;de<Rt.length;de++){Nt=Rt[de];for(var qe=m(Nt[0]),Ve=z(K(d(Nt.index),oe.length),0),Je=[],or,mr=1;mr<Nt.length;mr++)X(Je,nt(Nt[mr]));var Me=Nt.groups;if(De){var Qt=G([qe],Je,Ve,oe);Me!==void 0&&X(Qt,Me),or=m(r(ee,void 0,Qt))}else or=P(qe,oe,Ve,Je,Me,ee);Ve>=ye&&(Xt+=it(oe,ye,Ve)+or,ye=Ve+qe.length)}return Xt+it(oe,ye)}]},!st||!wt||Ct),xN}Edt();var EN={},iE,TN;function Tdt(){if(TN)return iE;TN=1;var r=jc(),t=Fd(),e=Io(),n=e("match");return iE=function(i){var s;return r(i)&&((s=i[n])!==void 0?!!s:t(i)==="RegExp")},iE}var sE,SN;function oE(){if(SN)return sE;SN=1;var r=Tdt(),t=TypeError;return sE=function(e){if(r(e))throw new t("The method doesn't accept regular expressions");return e},sE}var aE,IN;function lE(){if(IN)return aE;IN=1;var r=Io(),t=r("match");return aE=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[t]=!1,"/./"[e](n)}catch{}}return!1},aE}var PN;function Sdt(){if(PN)return EN;PN=1;var r=Ra(),t=J1(),e=K1().f,n=cp(),i=qu(),s=oE(),a=Gc(),o=lE(),d=ju(),f=t("".slice),m=Math.min,v=o("startsWith"),C=!d&&!v&&!!function(){var b=e(String.prototype,"startsWith");return b&&!b.writable}();return r({target:"String",proto:!0,forced:!C&&!v},{startsWith:function(b){var P=i(a(this));s(b);var F=n(m(arguments.length>1?arguments[1]:void 0,P.length)),U=i(b);return f(P,F,F+U.length)===U}}),EN}Sdt();var cE,MN;function Idt(){if(MN)return cE;MN=1;var r=Io(),t=t_(),e=RA().f,n=r("unscopables"),i=Array.prototype;return i[n]===void 0&&e(i,n,{configurable:!0,value:t(null)}),cE=function(s){i[n][s]=!0},cE}var uE,FN;function Pdt(){if(FN)return uE;FN=1;var r=Rs();return uE=!r(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),uE}var hE,LN;function RN(){if(LN)return hE;LN=1;var r=qc(),t=Us(),e=j1(),n=RB(),i=Pdt(),s=n("IE_PROTO"),a=Object,o=a.prototype;return hE=i?a.getPrototypeOf:function(d){var f=e(d);if(r(f,s))return f[s];var m=f.constructor;return t(m)&&f instanceof m?m.prototype:f instanceof a?o:null},hE}var AE,ON;function UN(){if(ON)return AE;ON=1;var r=Rs(),t=Us(),e=jc(),n=t_(),i=RN(),s=Od(),a=Io(),o=ju(),d=a("iterator"),f=!1,m,v,C;[].keys&&(C=[].keys(),"next"in C?(v=i(i(C)),v!==Object.prototype&&(m=v)):f=!0);var b=!e(m)||r(function(){var P={};return m[d].call(P)!==P});return b?m={}:o&&(m=n(m)),t(m[d])||s(m,d,function(){return this}),AE={IteratorPrototype:m,BUGGY_SAFARI_ITERATORS:f},AE}var dE,DN;function Mdt(){if(DN)return dE;DN=1;var r=UN().IteratorPrototype,t=t_(),e=Gx(),n=Y1(),i=ym(),s=function(){return this};return dE=function(a,o,d,f){var m=o+" Iterator";return a.prototype=t(r,{next:e(+!f,d)}),n(a,m,!1,!0),i[m]=s,a},dE}var fE,NN;function Fdt(){if(NN)return fE;NN=1;var r=Ra(),t=qo(),e=ju(),n=W1(),i=Us(),s=Mdt(),a=RN(),o=XU(),d=Y1(),f=fm(),m=Od(),v=Io(),C=ym(),b=UN(),P=n.PROPER,F=n.CONFIGURABLE,U=b.IteratorPrototype,k=b.BUGGY_SAFARI_ITERATORS,z=v("iterator"),K="keys",G="values",X="entries",Y=function(){return this};return fE=function(it,nt,wt,Ct,st,ot,vt){s(wt,nt,Ct);var yt=function(Rt){if(Rt===st&&oe)return oe;if(!k&&Rt&&Rt in ee)return ee[Rt];switch(Rt){case K:return function(){return new wt(this,Rt)};case G:return function(){return new wt(this,Rt)};case X:return function(){return new wt(this,Rt)}}return function(){return new wt(this)}},re=nt+" Iterator",Wt=!1,ee=it.prototype,Zt=ee[z]||ee["@@iterator"]||st&&ee[st],oe=!k&&Zt||yt(st),pe=nt==="Array"&&ee.entries||Zt,De,at,Tt;if(pe&&(De=a(pe.call(new it)),De!==Object.prototype&&De.next&&(!e&&a(De)!==U&&(o?o(De,U):i(De[z])||m(De,z,Y)),d(De,re,!0,!0),e&&(C[re]=Y))),P&&st===G&&Zt&&Zt.name!==G&&(!e&&F?f(ee,"name",G):(Wt=!0,oe=function(){return t(Zt,this)})),st)if(at={values:yt(G),keys:ot?oe:yt(K),entries:yt(X)},vt)for(Tt in at)(k||Wt||!(Tt in ee))&&m(ee,Tt,at[Tt]);else r({target:nt,proto:!0,forced:k||Wt},at);return(!e||vt)&&ee[z]!==oe&&m(ee,z,oe,{name:st}),C[nt]=oe,at},fE}var kN,QN;function Ldt(){return QN||(QN=1,kN=function(r,t){return{value:r,done:t}}),kN}var pE,zN;function HN(){if(zN)return pE;zN=1;var r=Am(),t=Idt(),e=ym(),n=$1(),i=RA().f,s=Fdt(),a=Ldt(),o=ju(),d=Vc(),f="Array Iterator",m=n.set,v=n.getterFor(f);pE=s(Array,"Array",function(b,P){m(this,{type:f,target:r(b),index:0,kind:P})},function(){var b=v(this),P=b.target,F=b.index++;if(!P||F>=P.length)return b.target=null,a(void 0,!0);switch(b.kind){case"keys":return a(F,!1);case"values":return a(P[F],!1)}return a([F,P[F]],!1)},"values");var C=e.Arguments=e.Array;if(t("keys"),t("values"),t("entries"),!o&&d&&C.name!=="values")try{i(C,"name",{value:"values"})}catch{}return pE}HN();var VN={},GN,jN;function Rdt(){return jN||(jN=1,GN={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),GN}var gE,qN;function Odt(){if(qN)return gE;qN=1;var r=q1(),t=r("span").classList,e=t&&t.constructor&&t.constructor.prototype;return gE=e===Object.prototype?void 0:e,gE}var KN;function Udt(){if(KN)return VN;KN=1;var r=ys(),t=Rdt(),e=Odt(),n=HN(),i=fm(),s=Y1(),a=Io(),o=a("iterator"),d=n.values,f=function(v,C){if(v){if(v[o]!==d)try{i(v,o,d)}catch{v[o]=d}if(s(v,C,!0),t[C]){for(var b in n)if(v[b]!==n[b])try{i(v,b,n[b])}catch{v[b]=n[b]}}}};for(var m in t)f(r[m]&&r[m].prototype,m);return f(e,"DOMTokenList"),VN}Udt();function Ddt(r,t){if(li(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(li(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function Ndt(r){var t=Ddt(r,"string");return li(t)=="symbol"?t:t+""}function mE(r,t,e){return(t=Ndt(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var WN={},yE,$N;function kdt(){if($N)return yE;$N=1;var r=Fh(),t=j1(),e=CO(),n=GB(),i=TypeError,s="Reduce of empty array with no initial value",a=function(o){return function(d,f,m,v){var C=t(d),b=e(C),P=n(C);if(r(f),P===0&&m<2)throw new i(s);var F=o?P-1:0,U=o?-1:1;if(m<2)for(;;){if(F in b){v=b[F],F+=U;break}if(F+=U,o?F<0:P<=F)throw new i(s)}for(;o?F>=0:P>F;F+=U)F in b&&(v=f(v,b[F],F,C));return v}};return yE={left:a(!1),right:a(!0)},yE}var _E,XN;function ZN(){if(XN)return _E;XN=1;var r=Rs();return _E=function(t,e){var n=[][t];return!!n&&r(function(){n.call(null,e||function(){return 1},1)})},_E}var YN;function Qdt(){if(YN)return WN;YN=1;var r=Ra(),t=kdt().left,e=ZN(),n=rB(),i=Z1(),s=!i&&n>79&&n<83,a=s||!e("reduce");return r({target:"Array",proto:!0,forced:a},{reduce:function(o){var d=arguments.length;return t(this,o,d,d>1?arguments[1]:void 0)}}),WN}Qdt();var JN={},t6;function zdt(){if(t6)return JN;t6=1;var r=Ra(),t=J1(),e=K1().f,n=cp(),i=qu(),s=oE(),a=Gc(),o=lE(),d=ju(),f=t("".slice),m=Math.min,v=o("endsWith"),C=!d&&!v&&!!function(){var b=e(String.prototype,"endsWith");return b&&!b.writable}();return r({target:"String",proto:!0,forced:!C&&!v},{endsWith:function(b){var P=i(a(this));s(b);var F=arguments.length>1?arguments[1]:void 0,U=P.length,k=F===void 0?U:m(n(F),U),z=i(b);return f(P,k-z.length,k)===z}}),JN}zdt();var e6={},r6;function Hdt(){if(r6)return e6;r6=1;var r=qo(),t=Os(),e=ZC(),n=La(),i=Ld(),s=Gc(),a=oD(),o=tE(),d=cp(),f=qu(),m=lp(),v=rE(),C=uN(),b=Rs(),P=C.UNSUPPORTED_Y,F=4294967295,U=Math.min,k=t([].push),z=t("".slice),K=!b(function(){var X=/(?:)/,Y=X.exec;X.exec=function(){return Y.apply(this,arguments)};var it="ab".split(X);return it.length!==2||it[0]!=="a"||it[1]!=="b"}),G="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;return e("split",function(X,Y,it){var nt="0".split(void 0,0).length?function(wt,Ct){return wt===void 0&&Ct===0?[]:r(Y,this,wt,Ct)}:Y;return[function(wt,Ct){var st=s(this),ot=i(wt)?void 0:m(wt,X);return ot?r(ot,wt,st,Ct):r(nt,f(st),wt,Ct)},function(wt,Ct){var st=n(this),ot=f(wt);if(!G){var vt=it(nt,st,ot,Ct,nt!==Y);if(vt.done)return vt.value}var yt=a(st,RegExp),re=st.unicode,Wt=(st.ignoreCase?"i":"")+(st.multiline?"m":"")+(st.unicode?"u":"")+(P?"g":"y"),ee=new yt(P?"^(?:"+st.source+")":st,Wt),Zt=Ct===void 0?F:Ct>>>0;if(Zt===0)return[];if(ot.length===0)return v(ee,ot)===null?[ot]:[];for(var oe=0,pe=0,De=[];pe<ot.length;){ee.lastIndex=P?0:pe;var at=v(ee,P?z(ot,pe):ot),Tt;if(at===null||(Tt=U(d(ee.lastIndex+(P?pe:0)),ot.length))===oe)pe=o(ot,pe,re);else{if(k(De,z(ot,oe,pe)),De.length===Zt)return De;for(var Rt=1;Rt<=at.length-1;Rt++)if(k(De,at[Rt]),De.length===Zt)return De;pe=oe=Tt}}return k(De,z(ot,oe)),De}]},G||!K,P),e6}Hdt();var _m={exports:{}},up={exports:{}},Vdt=up.exports,n6;function Gdt(){return n6||(n6=1,(function(){var r,t,e,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?up.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(up.exports=function(){return(r()-i)/1e6},t=process.hrtime,r=function(){var a;return a=t(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(up.exports=function(){return Date.now()-e},e=Date.now()):(up.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(Vdt)),up.exports}var i6;function jdt(){if(i6)return _m.exports;i6=1;for(var r=Gdt(),t=typeof window>"u"?Nx:window,e=["moz","webkit"],n="AnimationFrame",i=t["request"+n],s=t["cancel"+n]||t["cancelRequest"+n],a=0;!i&&a<e.length;a++)i=t[e[a]+"Request"+n],s=t[e[a]+"Cancel"+n]||t[e[a]+"CancelRequest"+n];if(!i||!s){var o=0,d=0,f=[],m=1e3/60;i=function(v){if(f.length===0){var C=r(),b=Math.max(0,m-(C-o));o=b+C,setTimeout(function(){var P=f.slice(0);f.length=0;for(var F=0;F<P.length;F++)if(!P[F].cancelled)try{P[F].callback(o)}catch(U){setTimeout(function(){throw U},0)}},Math.round(b))}return f.push({handle:++d,callback:v,cancelled:!1}),d},s=function(v){for(var C=0;C<f.length;C++)f[C].handle===v&&(f[C].cancelled=!0)}}return _m.exports=function(v){return i.call(t,v)},_m.exports.cancel=function(){s.apply(t,arguments)},_m.exports.polyfill=function(v){v||(v=t),v.requestAnimationFrame=i,v.cancelAnimationFrame=s},_m.exports}var qdt=jdt();const vE=hO(qdt);var s6={},o6,a6;function l6(){return a6||(a6=1,o6=`	
\v\f\r                　\u2028\u2029\uFEFF`),o6}var bE,c6;function Kdt(){if(c6)return bE;c6=1;var r=Os(),t=Gc(),e=qu(),n=l6(),i=r("".replace),s=RegExp("^["+n+"]+"),a=RegExp("(^|[^"+n+"])["+n+"]+$"),o=function(d){return function(f){var m=e(t(f));return d&1&&(m=i(m,s,"")),d&2&&(m=i(m,a,"$1")),m}};return bE={start:o(1),end:o(2),trim:o(3)},bE}var wE,u6;function Wdt(){if(u6)return wE;u6=1;var r=W1().PROPER,t=Rs(),e=l6(),n="​᠎";return wE=function(i){return t(function(){return!!e[i]()||n[i]()!==n||r&&e[i].name!==i})},wE}var h6;function $dt(){if(h6)return s6;h6=1;var r=Ra(),t=Kdt().trim,e=Wdt();return r({target:"String",proto:!0,forced:e("trim")},{trim:function(){return t(this)}}),s6}$dt();var A6,d6;function Xdt(){return d6||(d6=1,A6=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=t[r]||r;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(d){return[parseInt(d[1]),parseInt(d[2]),parseInt(d[3]),parseFloat(d[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(d){return[parseInt(d[1]),parseInt(d[2]),parseInt(d[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(d){return[parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(d){return[parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16)]}}],n=0;n<e.length;n++){var i=e[n].re,s=e[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var d=this.r.toString(16),f=this.g.toString(16),m=this.b.toString(16);return d.length==1&&(d="0"+d),f.length==1&&(f="0"+f),m.length==1&&(m="0"+m),"#"+d+f+m},this.getHelpXML=function(){for(var d=new Array,f=0;f<e.length;f++)for(var m=e[f].example,v=0;v<m.length;v++)d[d.length]=m[v];for(var C in t)d[d.length]=C;var b=document.createElement("ul");b.setAttribute("id","rgbcolor-examples");for(var f=0;f<d.length;f++)try{var P=document.createElement("li"),F=new RGBColor(d[f]),U=document.createElement("div");U.style.cssText="margin: 3px; border: 1px solid black; background:"+F.toHex()+"; color:"+F.toHex(),U.appendChild(document.createTextNode("test"));var k=document.createTextNode(" "+d[f]+" -> "+F.toRGB()+" -> "+F.toHex());P.appendChild(U),P.appendChild(k),b.appendChild(P)}catch{}return b}}),A6}var Zdt=Xdt();const xE=hO(Zdt);var f6={},p6;function Ydt(){if(p6)return f6;p6=1;var r=Ra(),t=J1(),e=PU().indexOf,n=ZN(),i=t([].indexOf),s=!!i&&1/i([1],1,-0)<0,a=s||!n("indexOf");return r({target:"Array",proto:!0,forced:a},{indexOf:function(o){var d=arguments.length>1?arguments[1]:void 0;return s?i(this,o,d)||0:e(this,o,d)}}),f6}Ydt();var g6={},m6;function Jdt(){if(m6)return g6;m6=1;var r=Ra(),t=Os(),e=oE(),n=Gc(),i=qu(),s=lE(),a=t("".indexOf);return r({target:"String",proto:!0,forced:!s("includes")},{includes:function(o){return!!~a(i(n(this)),i(e(o)),arguments.length>1?arguments[1]:void 0)}}),g6}Jdt();var y6={},BE,_6;function tft(){if(_6)return BE;_6=1;var r=Fd();return BE=Array.isArray||function(t){return r(t)==="Array"},BE}var v6;function eft(){if(v6)return y6;v6=1;var r=Ra(),t=Os(),e=tft(),n=t([].reverse),i=[1,2];return r({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return e(this)&&(this.length=this.length),n(this)}}),y6}eft();/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var b6=function(r,t){return(b6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])})(r,t)};function w6(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}b6(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function rft(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var n=r[e];if(n.type===pr.CLOSE_PATH)t+="z";else if(n.type===pr.HORIZ_LINE_TO)t+=(n.relative?"h":"H")+n.x;else if(n.type===pr.VERT_LINE_TO)t+=(n.relative?"v":"V")+n.y;else if(n.type===pr.MOVE_TO)t+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===pr.LINE_TO)t+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===pr.CURVE_TO)t+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===pr.SMOOTH_CURVE_TO)t+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===pr.QUAD_TO)t+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===pr.SMOOTH_QUAD_TO)t+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==pr.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+e+".");t+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return t}function CE(r,t){var e=r[0],n=r[1];return[e*Math.cos(t)-n*Math.sin(t),e*Math.sin(t)+n*Math.cos(t)]}function Kc(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=0;e<r.length;e++)if(typeof r[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof r[e]+" == typeof "+r[e]);return!0}var OA=Math.PI;function EE(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=CE([(t-s)/2,(e-a)/2],-r.xRot/180*OA),d=o[0],f=o[1],m=Math.pow(d,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(i,2);1<m&&(n*=Math.sqrt(m),i*=Math.sqrt(m)),r.rX=n,r.rY=i;var v=Math.pow(n,2)*Math.pow(f,2)+Math.pow(i,2)*Math.pow(d,2),C=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-v)/v)),b=n*f/i*C,P=-i*d/n*C,F=CE([b,P],r.xRot/180*OA);r.cX=F[0]+(t+s)/2,r.cY=F[1]+(e+a)/2,r.phi1=Math.atan2((f-P)/i,(d-b)/n),r.phi2=Math.atan2((-f-P)/i,(-d-b)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*OA),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*OA),r.phi1*=180/OA,r.phi2*=180/OA}function x6(r,t,e){Kc(r,t,e);var n=r*r+t*t-e*e;if(0>n)return[];if(n===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var i=Math.sqrt(n);return[[(r*e+t*i)/(r*r+t*t),(t*e-r*i)/(r*r+t*t)],[(r*e-t*i)/(r*r+t*t),(t*e+r*i)/(r*r+t*t)]]}var Js,Rh=Math.PI/180;function B6(r,t,e){return(1-e)*r+e*t}function C6(r,t,e,n){return r+Math.cos(n/180*OA)*t+Math.sin(n/180*OA)*e}function E6(r,t,e,n){var i=1e-6,s=t-r,a=e-t,o=3*s+3*(n-e)-6*a,d=6*(a-s),f=3*s;return Math.abs(o)<i?[-f/d]:function(m,v,C){var b=m*m/4-v;if(b<-1e-6)return[];if(b<=C)return[-m/2];var P=Math.sqrt(b);return[-m/2-P,-m/2+P]}(d/o,f/o,i)}function T6(r,t,e,n,i){var s=1-i;return r*(s*s*s)+t*(3*s*s*i)+e*(3*s*i*i)+n*(i*i*i)}(function(r){function t(){return i(function(o,d,f){return o.relative&&(o.x1!==void 0&&(o.x1+=d),o.y1!==void 0&&(o.y1+=f),o.x2!==void 0&&(o.x2+=d),o.y2!==void 0&&(o.y2+=f),o.x!==void 0&&(o.x+=d),o.y!==void 0&&(o.y+=f),o.relative=!1),o})}function e(){var o=NaN,d=NaN,f=NaN,m=NaN;return i(function(v,C,b){return v.type&pr.SMOOTH_CURVE_TO&&(v.type=pr.CURVE_TO,o=isNaN(o)?C:o,d=isNaN(d)?b:d,v.x1=v.relative?C-o:2*C-o,v.y1=v.relative?b-d:2*b-d),v.type&pr.CURVE_TO?(o=v.relative?C+v.x2:v.x2,d=v.relative?b+v.y2:v.y2):(o=NaN,d=NaN),v.type&pr.SMOOTH_QUAD_TO&&(v.type=pr.QUAD_TO,f=isNaN(f)?C:f,m=isNaN(m)?b:m,v.x1=v.relative?C-f:2*C-f,v.y1=v.relative?b-m:2*b-m),v.type&pr.QUAD_TO?(f=v.relative?C+v.x1:v.x1,m=v.relative?b+v.y1:v.y1):(f=NaN,m=NaN),v})}function n(){var o=NaN,d=NaN;return i(function(f,m,v){if(f.type&pr.SMOOTH_QUAD_TO&&(f.type=pr.QUAD_TO,o=isNaN(o)?m:o,d=isNaN(d)?v:d,f.x1=f.relative?m-o:2*m-o,f.y1=f.relative?v-d:2*v-d),f.type&pr.QUAD_TO){o=f.relative?m+f.x1:f.x1,d=f.relative?v+f.y1:f.y1;var C=f.x1,b=f.y1;f.type=pr.CURVE_TO,f.x1=((f.relative?0:m)+2*C)/3,f.y1=((f.relative?0:v)+2*b)/3,f.x2=(f.x+2*C)/3,f.y2=(f.y+2*b)/3}else o=NaN,d=NaN;return f})}function i(o){var d=0,f=0,m=NaN,v=NaN;return function(C){if(isNaN(m)&&!(C.type&pr.MOVE_TO))throw new Error("path must start with moveto");var b=o(C,d,f,m,v);return C.type&pr.CLOSE_PATH&&(d=m,f=v),C.x!==void 0&&(d=C.relative?d+C.x:C.x),C.y!==void 0&&(f=C.relative?f+C.y:C.y),C.type&pr.MOVE_TO&&(m=d,v=f),b}}function s(o,d,f,m,v,C){return Kc(o,d,f,m,v,C),i(function(b,P,F,U){var k=b.x1,z=b.x2,K=b.relative&&!isNaN(U),G=b.x!==void 0?b.x:K?0:P,X=b.y!==void 0?b.y:K?0:F;function Y(at){return at*at}b.type&pr.HORIZ_LINE_TO&&d!==0&&(b.type=pr.LINE_TO,b.y=b.relative?0:F),b.type&pr.VERT_LINE_TO&&f!==0&&(b.type=pr.LINE_TO,b.x=b.relative?0:P),b.x!==void 0&&(b.x=b.x*o+X*f+(K?0:v)),b.y!==void 0&&(b.y=G*d+b.y*m+(K?0:C)),b.x1!==void 0&&(b.x1=b.x1*o+b.y1*f+(K?0:v)),b.y1!==void 0&&(b.y1=k*d+b.y1*m+(K?0:C)),b.x2!==void 0&&(b.x2=b.x2*o+b.y2*f+(K?0:v)),b.y2!==void 0&&(b.y2=z*d+b.y2*m+(K?0:C));var it=o*m-d*f;if(b.xRot!==void 0&&(o!==1||d!==0||f!==0||m!==1))if(it===0)delete b.rX,delete b.rY,delete b.xRot,delete b.lArcFlag,delete b.sweepFlag,b.type=pr.LINE_TO;else{var nt=b.xRot*Math.PI/180,wt=Math.sin(nt),Ct=Math.cos(nt),st=1/Y(b.rX),ot=1/Y(b.rY),vt=Y(Ct)*st+Y(wt)*ot,yt=2*wt*Ct*(st-ot),re=Y(wt)*st+Y(Ct)*ot,Wt=vt*m*m-yt*d*m+re*d*d,ee=yt*(o*m+d*f)-2*(vt*f*m+re*o*d),Zt=vt*f*f-yt*o*f+re*o*o,oe=(Math.atan2(ee,Wt-Zt)+Math.PI)%Math.PI/2,pe=Math.sin(oe),De=Math.cos(oe);b.rX=Math.abs(it)/Math.sqrt(Wt*Y(De)+ee*pe*De+Zt*Y(pe)),b.rY=Math.abs(it)/Math.sqrt(Wt*Y(pe)-ee*pe*De+Zt*Y(De)),b.xRot=180*oe/Math.PI}return b.sweepFlag!==void 0&&0>it&&(b.sweepFlag=+!b.sweepFlag),b})}function a(){return function(o){var d={};for(var f in o)d[f]=o[f];return d}}r.ROUND=function(o){function d(f){return Math.round(f*o)/o}return o===void 0&&(o=1e13),Kc(o),function(f){return f.x1!==void 0&&(f.x1=d(f.x1)),f.y1!==void 0&&(f.y1=d(f.y1)),f.x2!==void 0&&(f.x2=d(f.x2)),f.y2!==void 0&&(f.y2=d(f.y2)),f.x!==void 0&&(f.x=d(f.x)),f.y!==void 0&&(f.y=d(f.y)),f.rX!==void 0&&(f.rX=d(f.rX)),f.rY!==void 0&&(f.rY=d(f.rY)),f}},r.TO_ABS=t,r.TO_REL=function(){return i(function(o,d,f){return o.relative||(o.x1!==void 0&&(o.x1-=d),o.y1!==void 0&&(o.y1-=f),o.x2!==void 0&&(o.x2-=d),o.y2!==void 0&&(o.y2-=f),o.x!==void 0&&(o.x-=d),o.y!==void 0&&(o.y-=f),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,d,f){return o===void 0&&(o=!0),d===void 0&&(d=!0),f===void 0&&(f=!0),i(function(m,v,C,b,P){if(isNaN(b)&&!(m.type&pr.MOVE_TO))throw new Error("path must start with moveto");return d&&m.type&pr.HORIZ_LINE_TO&&(m.type=pr.LINE_TO,m.y=m.relative?0:C),f&&m.type&pr.VERT_LINE_TO&&(m.type=pr.LINE_TO,m.x=m.relative?0:v),o&&m.type&pr.CLOSE_PATH&&(m.type=pr.LINE_TO,m.x=m.relative?b-v:b,m.y=m.relative?P-C:P),m.type&pr.ARC&&(m.rX===0||m.rY===0)&&(m.type=pr.LINE_TO,delete m.rX,delete m.rY,delete m.xRot,delete m.lArcFlag,delete m.sweepFlag),m})},r.NORMALIZE_ST=e,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),Kc(o);var d=NaN,f=NaN,m=NaN,v=NaN;return i(function(C,b,P,F,U){var k=Math.abs,z=!1,K=0,G=0;if(C.type&pr.SMOOTH_CURVE_TO&&(K=isNaN(d)?0:b-d,G=isNaN(f)?0:P-f),C.type&(pr.CURVE_TO|pr.SMOOTH_CURVE_TO)?(d=C.relative?b+C.x2:C.x2,f=C.relative?P+C.y2:C.y2):(d=NaN,f=NaN),C.type&pr.SMOOTH_QUAD_TO?(m=isNaN(m)?b:2*b-m,v=isNaN(v)?P:2*P-v):C.type&pr.QUAD_TO?(m=C.relative?b+C.x1:C.x1,v=C.relative?P+C.y1:C.y2):(m=NaN,v=NaN),C.type&pr.LINE_COMMANDS||C.type&pr.ARC&&(C.rX===0||C.rY===0||!C.lArcFlag)||C.type&pr.CURVE_TO||C.type&pr.SMOOTH_CURVE_TO||C.type&pr.QUAD_TO||C.type&pr.SMOOTH_QUAD_TO){var X=C.x===void 0?0:C.relative?C.x:C.x-b,Y=C.y===void 0?0:C.relative?C.y:C.y-P;K=isNaN(m)?C.x1===void 0?K:C.relative?C.x:C.x1-b:m-b,G=isNaN(v)?C.y1===void 0?G:C.relative?C.y:C.y1-P:v-P;var it=C.x2===void 0?0:C.relative?C.x:C.x2-b,nt=C.y2===void 0?0:C.relative?C.y:C.y2-P;k(X)<=o&&k(Y)<=o&&k(K)<=o&&k(G)<=o&&k(it)<=o&&k(nt)<=o&&(z=!0)}return C.type&pr.CLOSE_PATH&&k(b-F)<=o&&k(P-U)<=o&&(z=!0),z?[]:C})},r.MATRIX=s,r.ROTATE=function(o,d,f){d===void 0&&(d=0),f===void 0&&(f=0),Kc(o,d,f);var m=Math.sin(o),v=Math.cos(o);return s(v,m,-m,v,d-d*v+f*m,f-d*m-f*v)},r.TRANSLATE=function(o,d){return d===void 0&&(d=0),Kc(o,d),s(1,0,0,1,o,d)},r.SCALE=function(o,d){return d===void 0&&(d=o),Kc(o,d),s(o,0,0,d,0,0)},r.SKEW_X=function(o){return Kc(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return Kc(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),Kc(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),Kc(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,d,f){return pr.ARC===o.type?function(m,v,C){var b,P,F,U;m.cX||EE(m,v,C);for(var k=Math.min(m.phi1,m.phi2),z=Math.max(m.phi1,m.phi2)-k,K=Math.ceil(z/90),G=new Array(K),X=v,Y=C,it=0;it<K;it++){var nt=B6(m.phi1,m.phi2,it/K),wt=B6(m.phi1,m.phi2,(it+1)/K),Ct=wt-nt,st=4/3*Math.tan(Ct*Rh/4),ot=[Math.cos(nt*Rh)-st*Math.sin(nt*Rh),Math.sin(nt*Rh)+st*Math.cos(nt*Rh)],vt=ot[0],yt=ot[1],re=[Math.cos(wt*Rh),Math.sin(wt*Rh)],Wt=re[0],ee=re[1],Zt=[Wt+st*Math.sin(wt*Rh),ee-st*Math.cos(wt*Rh)],oe=Zt[0],pe=Zt[1];G[it]={relative:m.relative,type:pr.CURVE_TO};var De=function(at,Tt){var Rt=CE([at*m.rX,Tt*m.rY],m.xRot),Nt=Rt[0],ae=Rt[1];return[m.cX+Nt,m.cY+ae]};b=De(vt,yt),G[it].x1=b[0],G[it].y1=b[1],P=De(oe,pe),G[it].x2=P[0],G[it].y2=P[1],F=De(Wt,ee),G[it].x=F[0],G[it].y=F[1],m.relative&&(G[it].x1-=X,G[it].y1-=Y,G[it].x2-=X,G[it].y2-=Y,G[it].x-=X,G[it].y-=Y),X=(U=[G[it].x,G[it].y])[0],Y=U[1]}return G}(o,o.relative?0:d,o.relative?0:f):o})},r.ANNOTATE_ARCS=function(){return i(function(o,d,f){return o.relative&&(d=0,f=0),pr.ARC===o.type&&EE(o,d,f),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(C){var b={};for(var P in C)b[P]=C[P];return b},d=t(),f=n(),m=e(),v=i(function(C,b,P){var F=m(f(d(o(C))));function U(pe){pe>v.maxX&&(v.maxX=pe),pe<v.minX&&(v.minX=pe)}function k(pe){pe>v.maxY&&(v.maxY=pe),pe<v.minY&&(v.minY=pe)}if(F.type&pr.DRAWING_COMMANDS&&(U(b),k(P)),F.type&pr.HORIZ_LINE_TO&&U(F.x),F.type&pr.VERT_LINE_TO&&k(F.y),F.type&pr.LINE_TO&&(U(F.x),k(F.y)),F.type&pr.CURVE_TO){U(F.x),k(F.y);for(var z=0,K=E6(b,F.x1,F.x2,F.x);z<K.length;z++)0<(oe=K[z])&&1>oe&&U(T6(b,F.x1,F.x2,F.x,oe));for(var G=0,X=E6(P,F.y1,F.y2,F.y);G<X.length;G++)0<(oe=X[G])&&1>oe&&k(T6(P,F.y1,F.y2,F.y,oe))}if(F.type&pr.ARC){U(F.x),k(F.y),EE(F,b,P);for(var Y=F.xRot/180*Math.PI,it=Math.cos(Y)*F.rX,nt=Math.sin(Y)*F.rX,wt=-Math.sin(Y)*F.rY,Ct=Math.cos(Y)*F.rY,st=F.phi1<F.phi2?[F.phi1,F.phi2]:-180>F.phi2?[F.phi2+360,F.phi1+360]:[F.phi2,F.phi1],ot=st[0],vt=st[1],yt=function(pe){var De=pe[0],at=pe[1],Tt=180*Math.atan2(at,De)/Math.PI;return Tt<ot?Tt+360:Tt},re=0,Wt=x6(wt,-it,0).map(yt);re<Wt.length;re++)(oe=Wt[re])>ot&&oe<vt&&U(C6(F.cX,it,wt,oe));for(var ee=0,Zt=x6(Ct,-nt,0).map(yt);ee<Zt.length;ee++){var oe;(oe=Zt[ee])>ot&&oe<vt&&k(C6(F.cY,nt,Ct,oe))}}return C});return v.minX=1/0,v.maxX=-1/0,v.minY=1/0,v.maxY=-1/0,v}})(Js||(Js={}));var Wc,S6=function(){function r(){}return r.prototype.round=function(t){return this.transform(Js.ROUND(t))},r.prototype.toAbs=function(){return this.transform(Js.TO_ABS())},r.prototype.toRel=function(){return this.transform(Js.TO_REL())},r.prototype.normalizeHVZ=function(t,e,n){return this.transform(Js.NORMALIZE_HVZ(t,e,n))},r.prototype.normalizeST=function(){return this.transform(Js.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(Js.QT_TO_C())},r.prototype.aToC=function(){return this.transform(Js.A_TO_C())},r.prototype.sanitize=function(t){return this.transform(Js.SANITIZE(t))},r.prototype.translate=function(t,e){return this.transform(Js.TRANSLATE(t,e))},r.prototype.scale=function(t,e){return this.transform(Js.SCALE(t,e))},r.prototype.rotate=function(t,e,n){return this.transform(Js.ROTATE(t,e,n))},r.prototype.matrix=function(t,e,n,i,s,a){return this.transform(Js.MATRIX(t,e,n,i,s,a))},r.prototype.skewX=function(t){return this.transform(Js.SKEW_X(t))},r.prototype.skewY=function(t){return this.transform(Js.SKEW_Y(t))},r.prototype.xSymmetry=function(t){return this.transform(Js.X_AXIS_SYMMETRY(t))},r.prototype.ySymmetry=function(t){return this.transform(Js.Y_AXIS_SYMMETRY(t))},r.prototype.annotateArcs=function(){return this.transform(Js.ANNOTATE_ARCS())},r}(),nft=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},I6=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},ift=function(r){function t(){var e=r.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return w6(t,r),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,n){var i=this;n===void 0&&(n=[]);for(var s=function(v){n.push(v),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<e.length;a++){var o=e[a],d=!(this.curCommandType!==pr.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),f=I6(o)&&(this.curNumber==="0"&&o==="0"||d);if(!I6(o)||f)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||d){if(this.curNumber&&this.curCommandType!==-1){var m=Number(this.curNumber);if(isNaN(m))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===pr.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>m)throw new SyntaxError('Expected positive number, got "'+m+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(m),this.curArgs.length===sft[this.curCommandType]&&(pr.HORIZ_LINE_TO===this.curCommandType?s({type:pr.HORIZ_LINE_TO,relative:this.curCommandRelative,x:m}):pr.VERT_LINE_TO===this.curCommandType?s({type:pr.VERT_LINE_TO,relative:this.curCommandRelative,y:m}):this.curCommandType===pr.MOVE_TO||this.curCommandType===pr.LINE_TO||this.curCommandType===pr.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),pr.MOVE_TO===this.curCommandType&&(this.curCommandType=pr.LINE_TO)):this.curCommandType===pr.CURVE_TO?s({type:pr.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===pr.SMOOTH_CURVE_TO?s({type:pr.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===pr.QUAD_TO?s({type:pr.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===pr.ARC&&s({type:pr.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!nft(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(f)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=pr.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=pr.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=pr.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=pr.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=pr.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=pr.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=pr.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=pr.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=pr.ARC,this.curCommandRelative=o==="a"}else n.push({type:pr.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],d=e(o);Array.isArray(d)?i.push.apply(i,d):i.push(d)}return i}}})},t}(S6),pr=function(r){function t(e){var n=r.call(this)||this;return n.commands=typeof e=="string"?t.parse(e):e,n}return w6(t,r),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=Js.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=e(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},t.encode=function(e){return rft(e)},t.parse=function(e){var n=new ift,i=[];return n.parse(e,i),n.finish(i),i},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(S6),sft=((Wc={})[pr.MOVE_TO]=2,Wc[pr.LINE_TO]=2,Wc[pr.HORIZ_LINE_TO]=1,Wc[pr.VERT_LINE_TO]=1,Wc[pr.CLOSE_PATH]=0,Wc[pr.QUAD_TO]=4,Wc[pr.SMOOTH_QUAD_TO]=2,Wc[pr.CURVE_TO]=6,Wc[pr.SMOOTH_CURVE_TO]=4,Wc[pr.ARC]=7,Wc),P6={},TE,M6;function oft(){if(M6)return TE;M6=1;var r=qo(),t=qc(),e=V1(),n=lN(),i=RegExp.prototype;return TE=function(s){var a=s.flags;return a===void 0&&!("flags"in i)&&!t(s,"flags")&&e(i,s)?r(n,s):a},TE}var F6;function aft(){if(F6)return P6;F6=1;var r=W1().PROPER,t=Od(),e=La(),n=qu(),i=Rs(),s=oft(),a="toString",o=RegExp.prototype,d=o[a],f=i(function(){return d.call({source:"a",flags:"b"})!=="/a/b"}),m=r&&d.name!==a;return(f||m)&&t(o,a,function(){var v=e(this),C=n(v.source),b=n(s(v));return"/"+C+"/"+b},{unsafe:!0}),P6}aft();function e_(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e_=function(t){return typeof t}:e_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e_(r)}function lft(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var cft=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],uft=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function hft(r,t,e,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||e_(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(t,e,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function Aft(r,t,e,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=hft(r,t,e,n,i);a=dft(a,t,e,n,i,s),r.getContext("2d").putImageData(a,t,e)}}function dft(r,t,e,n,i,s){for(var a=r.data,o=2*s+1,d=n-1,f=i-1,m=s+1,v=m*(m+1)/2,C=new L6,b=C,P,F=1;F<o;F++)b=b.next=new L6,F===m&&(P=b);b.next=C;for(var U=null,k=null,z=0,K=0,G=cft[s],X=uft[s],Y=0;Y<i;Y++){b=C;for(var it=a[K],nt=a[K+1],wt=a[K+2],Ct=a[K+3],st=0;st<m;st++)b.r=it,b.g=nt,b.b=wt,b.a=Ct,b=b.next;for(var ot=0,vt=0,yt=0,re=0,Wt=m*it,ee=m*nt,Zt=m*wt,oe=m*Ct,pe=v*it,De=v*nt,at=v*wt,Tt=v*Ct,Rt=1;Rt<m;Rt++){var Nt=K+((d<Rt?d:Rt)<<2),ae=a[Nt],Xt=a[Nt+1],ye=a[Nt+2],de=a[Nt+3],qe=m-Rt;pe+=(b.r=ae)*qe,De+=(b.g=Xt)*qe,at+=(b.b=ye)*qe,Tt+=(b.a=de)*qe,ot+=ae,vt+=Xt,yt+=ye,re+=de,b=b.next}U=C,k=P;for(var Ve=0;Ve<n;Ve++){var Je=Tt*G>>>X;if(a[K+3]=Je,Je!==0){var or=255/Je;a[K]=(pe*G>>>X)*or,a[K+1]=(De*G>>>X)*or,a[K+2]=(at*G>>>X)*or}else a[K]=a[K+1]=a[K+2]=0;pe-=Wt,De-=ee,at-=Zt,Tt-=oe,Wt-=U.r,ee-=U.g,Zt-=U.b,oe-=U.a;var mr=Ve+s+1;mr=z+(mr<d?mr:d)<<2,ot+=U.r=a[mr],vt+=U.g=a[mr+1],yt+=U.b=a[mr+2],re+=U.a=a[mr+3],pe+=ot,De+=vt,at+=yt,Tt+=re,U=U.next;var Me=k,Qt=Me.r,Ur=Me.g,Ir=Me.b,$e=Me.a;Wt+=Qt,ee+=Ur,Zt+=Ir,oe+=$e,ot-=Qt,vt-=Ur,yt-=Ir,re-=$e,k=k.next,K+=4}z+=n}for(var Xe=0;Xe<n;Xe++){K=Xe<<2;var er=a[K],gr=a[K+1],Re=a[K+2],sr=a[K+3],Br=m*er,xr=m*gr,Lr=m*Re,Zr=m*sr,Nr=v*er,Vr=v*gr,yr=v*Re,In=v*sr;b=C;for(var an=0;an<m;an++)b.r=er,b.g=gr,b.b=Re,b.a=sr,b=b.next;for(var Xn=n,Bt=0,ct=0,ft=0,pt=0,Dt=1;Dt<=s;Dt++){K=Xn+Xe<<2;var Gt=m-Dt;Nr+=(b.r=er=a[K])*Gt,Vr+=(b.g=gr=a[K+1])*Gt,yr+=(b.b=Re=a[K+2])*Gt,In+=(b.a=sr=a[K+3])*Gt,pt+=er,Bt+=gr,ct+=Re,ft+=sr,b=b.next,Dt<f&&(Xn+=n)}K=Xe,U=C,k=P;for(var le=0;le<i;le++){var ge=K<<2;a[ge+3]=sr=In*G>>>X,sr>0?(sr=255/sr,a[ge]=(Nr*G>>>X)*sr,a[ge+1]=(Vr*G>>>X)*sr,a[ge+2]=(yr*G>>>X)*sr):a[ge]=a[ge+1]=a[ge+2]=0,Nr-=Br,Vr-=xr,yr-=Lr,In-=Zr,Br-=U.r,xr-=U.g,Lr-=U.b,Zr-=U.a,ge=Xe+((ge=le+m)<f?ge:f)*n<<2,Nr+=pt+=U.r=a[ge],Vr+=Bt+=U.g=a[ge+1],yr+=ct+=U.b=a[ge+2],In+=ft+=U.a=a[ge+3],U=U.next,Br+=er=k.r,xr+=gr=k.g,Lr+=Re=k.b,Zr+=sr=k.a,pt-=er,Bt-=gr,ct-=Re,ft-=sr,k=k.next,K+=n}}return r}var L6=function r(){lft(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function fft(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(e,n){return new OffscreenCanvas(e,n)},createImage(e){return Lh(function*(){var n=yield fetch(e),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(t,"DOMParser"),t}function pft(r){var{DOMParser:t,canvas:e,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:n,createCanvas:e.createCanvas,createImage:e.loadImage}}var gft=Object.freeze({__proto__:null,offscreen:fft,node:pft});function Ud(r){return r.replace(/(?!\u3000)\s+/gm," ")}function R6(r){return r.replace(/^[\n \t]+/,"")}function O6(r){return r.replace(/[\n \t]+$/,"")}function rl(r){var t=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return t.map(parseFloat)}var mft=/^[A-Z-]+$/;function U6(r){return mft.test(r)?r.toLowerCase():r}function SE(r){var t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return t[2]||t[3]||t[4]}function D6(r){if(!r.startsWith("rgb"))return r;var t=3,e=r.replace(/\d+(\.\d+)?/g,(n,i)=>t--&&i?String(Math.round(parseFloat(n))):n);return e}var yft=/(\[[^\]]+\])/g,_ft=/(#[^\s+>~.[:]+)/g,vft=/(\.[^\s+>~.[:]+)/g,bft=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,wft=/(:[\w-]+\([^)]*\))/gi,xft=/(:[^\s+>~.[:]+)/g,Bft=/([^\s+>~.[:]+)/g;function Dd(r,t){var e=t.exec(r);return e?[r.replace(t," "),e.length]:[r,0]}function N6(r){var t=[0,0,0],e=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[e,n]=Dd(e,yft),t[1]+=n,[e,n]=Dd(e,_ft),t[0]+=n,[e,n]=Dd(e,vft),t[1]+=n,[e,n]=Dd(e,bft),t[2]+=n,[e,n]=Dd(e,wft),t[1]+=n,[e,n]=Dd(e,xft),t[1]+=n,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,n]=Dd(e,Bft),t[2]+=n,t.join("")}var Nd=1e-8;function IE(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function r_(r,t){return(r[0]*t[0]+r[1]*t[1])/(IE(r)*IE(t))}function PE(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(r_(r,t))}function ME(r){return r*r*r}function FE(r){return 3*r*r*(1-r)}function LE(r){return 3*r*(1-r)*(1-r)}function RE(r){return(1-r)*(1-r)*(1-r)}function OE(r){return r*r}function UE(r){return 2*r*(1-r)}function DE(r){return(1-r)*(1-r)}class rn{constructor(t,e,n){this.document=t,this.name=e,this.value=n,this.isNormalizedColor=!1}static empty(t){return new rn(t,"EMPTY","")}split(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:e,name:n}=this;return Ud(this.getString()).trim().split(t).map(i=>new rn(e,n,i))}hasValue(t){var{value:e}=this;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){var{value:e}=this,n=typeof e=="string";return!n||!t?n:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);var{value:e}=this,n=parseFloat(e);return this.isString(/%$/)&&(n/=100),n}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){var e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=D6(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return e&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var t=this.getString(),e=/#([^)'"]+)/.exec(t);return e&&(e=e[1]),e||(e=t),this.document.definitions[e]}getFillStyleDefinition(t,e){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,t,e);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){return this.hasValue()?rn.textBaselineMapping[this.getString()]:null}addOpacity(t){for(var e=this.getColor(),n=e.length,i=0,s=0;s<n&&(e[s]===","&&i++,i!==3);s++);if(t.hasValue()&&this.isString()&&i!==3){var a=new xE(e);a.ok&&(a.alpha=t.getNumber(),e=a.toRGBA())}return new rn(this.document,this.name,e)}}rn.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class k6{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:t}=this;return t[t.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class _s{constructor(t,e){this.x=t,this.y=e}static parse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=e,i=e]=rl(t);return new _s(n,i)}static parseScale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=e,i=n]=rl(t);return new _s(n,i)}static parsePath(t){for(var e=rl(t),n=e.length,i=[],s=0;s<n;s+=2)i.push(new _s(e[s],e[s+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){var{x:e,y:n}=this,i=e*t[0]+n*t[2]+t[4],s=e*t[1]+n*t[3]+t[5];this.x=i,this.y=s}}class Q6{constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:t,onClick:e,onMouseMove:n}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:t,events:e,eventElements:n}=this,{style:i}=t.ctx.canvas;i&&(i.cursor=""),e.forEach((s,a)=>{for(var{run:o}=s,d=n[a];d;)o(d),d=d.parent}),this.events=[],this.eventElements=[]}}checkPath(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:d}=s;!i[a]&&e.isPointInPath&&e.isPointInPath(o,d)&&(i[a]=t)})}}checkBoundingBox(t,e){if(!(!this.working||!e)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:d}=s;!i[a]&&e.isPointInBox(o,d)&&(i[a]=t)})}}mapXY(t,e){for(var{window:n,ctx:i}=this.screen,s=new _s(t,e),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(t){var{x:e,y:n}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var z6=typeof window<"u"?window:null,H6=typeof fetch<"u"?fetch.bind(void 0):null;class vm{constructor(t){var{fetch:e=H6,window:n=z6}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=t,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new k6,this.mouse=new Q6(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=e}wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){var{document:e,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:d,minX:f=0,minY:m=0,refX:v,refY:C,clip:b=!1,clipX:P=0,clipY:F=0}=t,U=Ud(i).replace(/^defer\s/,""),[k,z]=U.split(" "),K=k||"xMidYMid",G=z||"meet",X=s/a,Y=o/d,it=Math.min(X,Y),nt=Math.max(X,Y),wt=a,Ct=d;G==="meet"&&(wt*=it,Ct*=it),G==="slice"&&(wt*=nt,Ct*=nt);var st=new rn(e,"refX",v),ot=new rn(e,"refY",C),vt=st.hasValue()&&ot.hasValue();if(vt&&n.translate(-it*st.getPixels("x"),-it*ot.getPixels("y")),b){var yt=it*P,re=it*F;n.beginPath(),n.moveTo(yt,re),n.lineTo(s,re),n.lineTo(s,o),n.lineTo(yt,o),n.closePath(),n.clip()}if(!vt){var Wt=G==="meet"&&it===Y,ee=G==="slice"&&nt===Y,Zt=G==="meet"&&it===X,oe=G==="slice"&&nt===X;K.startsWith("xMid")&&(Wt||ee)&&n.translate(s/2-wt/2,0),K.endsWith("YMid")&&(Zt||oe)&&n.translate(0,o/2-Ct/2),K.startsWith("xMax")&&(Wt||ee)&&n.translate(s-wt,0),K.endsWith("YMax")&&(Zt||oe)&&n.translate(0,o-Ct)}switch(!0){case K==="none":n.scale(X,Y);break;case G==="meet":n.scale(it,it);break;case G==="slice":n.scale(nt,nt);break}n.translate(-f,-m)}start(t){var{enableRedraw:e=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:d,scaleHeight:f,offsetX:m,offsetY:v}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:C,mouse:b}=this,P=1e3/C;if(this.frameDuration=P,this.readyPromise=new Promise(K=>{this.resolveReady=K}),this.isReady()&&this.render(t,s,a,d,f,m,v),!!e){var F=Date.now(),U=F,k=0,z=()=>{F=Date.now(),k=F-U,k>=P&&(U=F-k%P,this.shouldUpdate(i,o)&&(this.render(t,s,a,d,f,m,v),b.runEvents())),this.intervalId=vE(z)};n||b.start(),this.intervalId=vE(z)}}stop(){this.intervalId&&(vE.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,n,i,s,a,o){var{CLIENT_WIDTH:d,CLIENT_HEIGHT:f,viewPort:m,ctx:v,isFirstRender:C}=this,b=v.canvas;m.clear(),b.width&&b.height?m.setCurrent(b.width,b.height):m.setCurrent(d,f);var P=t.getStyle("width"),F=t.getStyle("height");!e&&(C||typeof i!="number"&&typeof s!="number")&&(P.hasValue()&&(b.width=P.getPixels("x"),b.style&&(b.style.width="".concat(b.width,"px"))),F.hasValue()&&(b.height=F.getPixels("y"),b.style&&(b.style.height="".concat(b.height,"px"))));var U=b.clientWidth||b.width,k=b.clientHeight||b.height;if(e&&P.hasValue()&&F.hasValue()&&(U=P.getPixels("x"),k=F.getPixels("y")),m.setCurrent(U,k),typeof a=="number"&&t.getAttribute("x",!0).setValue(a),typeof o=="number"&&t.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var z=rl(t.getAttribute("viewBox").getString()),K=0,G=0;if(typeof i=="number"){var X=t.getStyle("width");X.hasValue()?K=X.getPixels("x")/i:isNaN(z[2])||(K=z[2]/i)}if(typeof s=="number"){var Y=t.getStyle("height");Y.hasValue()?G=Y.getPixels("y")/s:isNaN(z[3])||(G=z[3]/s)}K||(K=G),G||(G=K),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(s);var it=t.getStyle("transform",!0,!0);it.setValue("".concat(it.getString()," scale(").concat(1/K,", ").concat(1/G,")"))}n||v.clearRect(0,0,U,k),t.render(v),C&&(this.isFirstRender=!1)}}vm.defaultWindow=z6,vm.defaultFetch=H6;var{defaultFetch:Cft}=vm,Eft=typeof DOMParser<"u"?DOMParser:null;class n_{constructor(){var{fetch:t=Cft,DOMParser:e=Eft}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=t,this.DOMParser=e}parse(t){var e=this;return Lh(function*(){return t.startsWith("<")?e.parseFromString(t):e.load(t)})()}parseFromString(t){var e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){var e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent);return t}load(t){var e=this;return Lh(function*(){var n=yield e.fetch(t),i=yield n.text();return e.parseFromString(i)})()}}class V6{constructor(t,e){this.type="translate",this.point=null,this.point=_s.parse(e)}apply(t){var{x:e,y:n}=this.point;t.translate(e||0,n||0)}unapply(t){var{x:e,y:n}=this.point;t.translate(-1*e||0,-1*n||0)}applyToPoint(t){var{x:e,y:n}=this.point;t.applyTransform([1,0,0,1,e||0,n||0])}}class G6{constructor(t,e,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=rl(e);this.angle=new rn(t,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),d=n+s.getPixels("y");t.translate(o,d),t.rotate(a.getRadians()),t.translate(-o,-d)}unapply(t){var{cx:e,cy:n,originX:i,originY:s,angle:a}=this,o=e+i.getPixels("x"),d=n+s.getPixels("y");t.translate(o,d),t.rotate(-1*a.getRadians()),t.translate(-o,-d)}applyToPoint(t){var{cx:e,cy:n,angle:i}=this,s=i.getRadians();t.applyTransform([1,0,0,1,e||0,n||0]),t.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),t.applyTransform([1,0,0,1,-e||0,-n||0])}}class j6{constructor(t,e,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=_s.parseScale(e);(i.x===0||i.y===0)&&(i.x=Nd,i.y=Nd),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(e,n||e),t.translate(-a,-o)}unapply(t){var{scale:{x:e,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");t.translate(a,o),t.scale(1/e,1/n||e),t.translate(-a,-o)}applyToPoint(t){var{x:e,y:n}=this.scale;t.applyTransform([e||0,0,0,n||0,0,0])}}class NE{constructor(t,e,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=rl(e),this.originX=n[0],this.originY=n[1]}apply(t){var{originX:e,originY:n,matrix:i}=this,s=e.getPixels("x"),a=n.getPixels("y");t.translate(s,a),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-s,-a)}unapply(t){var{originX:e,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],d=i[1],f=i[3],m=i[5],v=0,C=0,b=1,P=1/(s*(f*b-m*C)-a*(d*b-m*v)+o*(d*C-f*v)),F=e.getPixels("x"),U=n.getPixels("y");t.translate(F,U),t.transform(P*(f*b-m*C),P*(m*v-d*b),P*(o*C-a*b),P*(s*b-o*v),P*(a*m-o*f),P*(o*d-s*m)),t.translate(-F,-U)}applyToPoint(t){t.applyTransform(this.matrix)}}class kE extends NE{constructor(t,e,n){super(t,e,n),this.type="skew",this.angle=null,this.angle=new rn(t,"angle",e)}}class q6 extends kE{constructor(t,e,n){super(t,e,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class K6 extends kE{constructor(t,e,n){super(t,e,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function Tft(r){return Ud(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Sft(r){var[t,e]=r.split("(");return[t.trim(),e.trim().replace(")","")]}class UA{constructor(t,e,n){this.document=t,this.transforms=[];var i=Tft(e);i.forEach(s=>{if(s!=="none"){var[a,o]=Sft(s),d=UA.transformTypes[a];typeof d<"u"&&this.transforms.push(new d(this.document,o,n))}})}static fromElement(t,e){var n=e.getStyle("transform",!1,!0),[i,s=i]=e.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new UA(t,n.getString(),a):null}apply(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].apply(t)}unapply(t){for(var{transforms:e}=this,n=e.length,i=n-1;i>=0;i--)e[i].unapply(t)}applyToPoint(t){for(var{transforms:e}=this,n=e.length,i=0;i<n;i++)e[i].applyToPoint(t)}}UA.transformTypes={translate:V6,rotate:G6,scale:j6,matrix:NE,skewX:q6,skewY:K6};class Hi{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=t,this.node=e,this.captureTextNodes=n,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!e||e.nodeType!==1)){if(Array.from(e.attributes).forEach(o=>{var d=U6(o.nodeName);this.attributes[d]=new rn(t,d,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[d,f]=o.split(":").map(m=>m.trim());this.styles[d]=new rn(t,d,f)}})}var{definitions:s}=t,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(e.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var d=t.createTextNode(o);d.getText().length>0&&this.addChild(d)}})}}getAttribute(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[t];if(!n&&e){var i=new rn(this.document,t,"");return this.attributes[t]=i,i}return n||rn.empty(this.document)}getHrefAttribute(){for(var t in this.attributes)if(t==="href"||t.endsWith(":href"))return this.attributes[t];return rn.empty(this.document)}getStyle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[t];if(i)return i;var s=this.getAttribute(t);if(s!=null&&s.hasValue())return this.styles[t]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(t);if(o!=null&&o.hasValue())return o}}if(e){var d=new rn(this.document,t,"");return this.styles[t]=d,d}return i||rn.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){var e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(t),n.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){var e=UA.fromElement(this.document,this);e&&e.apply(t);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){var e=t instanceof Hi?t:this.document.createElement(t);e.parent=this,Hi.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e,{node:n}=this;if(typeof n.matches=="function")return n.matches(t);var i=(e=n.getAttribute)===null||e===void 0?void 0:e.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===t)}addStylesFromStyleDefinition(){var{styles:t,stylesSpecificity:e}=this.document;for(var n in t)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=t[n],s=e[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(t,e){var n=e.reduce((i,s)=>{var a=t.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(t,e){e.forEach(n=>{var[i,s]=n;t.getStyle(i,!0).setValue(s)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}}Hi.ignoreChildTypes=["title"];class W6 extends Hi{constructor(t,e,n){super(t,e,n)}}function Ift(r){var t=r.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function Pft(r){return typeof process>"u"?r:r.trim().split(",").map(Ift).join(",")}function Mft(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function Fft(r){if(!r)return"";var t=r.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}class da{constructor(t,e,n,i,s,a){var o=a?typeof a=="string"?da.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=t||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=e||o.fontVariant}static parse(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",d=Ud(t).trim().split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return d.forEach(m=>{switch(!0){case(!f.fontStyle&&da.styles.includes(m)):m!=="inherit"&&(n=m),f.fontStyle=!0;break;case(!f.fontVariant&&da.variants.includes(m)):m!=="inherit"&&(i=m),f.fontStyle=!0,f.fontVariant=!0;break;case(!f.fontWeight&&da.weights.includes(m)):m!=="inherit"&&(s=m),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0;break;case!f.fontSize:m!=="inherit"&&([a]=m.split("/")),f.fontStyle=!0,f.fontVariant=!0,f.fontWeight=!0,f.fontSize=!0;break;default:m!=="inherit"&&(o+=m)}}),new da(n,i,s,a,o,e)}toString(){return[Mft(this.fontStyle),this.fontVariant,Fft(this.fontWeight),this.fontSize,Pft(this.fontFamily)].join(" ").trim()}}da.styles="normal|italic|oblique|inherit",da.variants="normal|small-caps|inherit",da.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class ic{constructor(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=t,this.y1=e,this.x2=n,this.y2=i,this.addPoint(t,e),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addBoundingBox(t){if(t){var{x1:e,y1:n,x2:i,y2:s}=t;this.addPoint(e,n),this.addPoint(i,s)}}sumCubic(t,e,n,i,s){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*n+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*s}bezierCurveAdd(t,e,n,i,s){var a=6*e-12*n+6*i,o=-3*e+9*n-9*i+3*s,d=3*n-3*e;if(o===0){if(a===0)return;var f=-d/a;0<f&&f<1&&(t?this.addX(this.sumCubic(f,e,n,i,s)):this.addY(this.sumCubic(f,e,n,i,s)));return}var m=Math.pow(a,2)-4*d*o;if(!(m<0)){var v=(-a+Math.sqrt(m))/(2*o);0<v&&v<1&&(t?this.addX(this.sumCubic(v,e,n,i,s)):this.addY(this.sumCubic(v,e,n,i,s)));var C=(-a-Math.sqrt(m))/(2*o);0<C&&C<1&&(t?this.addX(this.sumCubic(C,e,n,i,s)):this.addY(this.sumCubic(C,e,n,i,s)))}}addBezierCurve(t,e,n,i,s,a,o,d){this.addPoint(t,e),this.addPoint(o,d),this.bezierCurveAdd(!0,t,n,s,o),this.bezierCurveAdd(!1,e,i,a,d)}addQuadraticCurve(t,e,n,i,s,a){var o=t+.6666666666666666*(n-t),d=e+2/3*(i-e),f=o+1/3*(s-t),m=d+1/3*(a-e);this.addBezierCurve(t,e,o,f,d,m,s,a)}isPointInBox(t,e){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=t&&t<=s&&i<=e&&e<=a}}class En extends pr{constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new _s(0,0),this.control=new _s(0,0),this.current=new _s(0,0),this.points=[],this.angles=[]}isEnd(){var{i:t,commands:e}=this;return t>=e.length-1}next(){var t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new _s(this.command[t],this.command[e]);return this.makeAbsolute(n)}getAsControlPoint(t,e){var n=this.getPoint(t,e);return this.control=n,n}getAsCurrentPoint(t,e){var n=this.getPoint(t,e);return this.current=n,n}getReflectedControlPoint(){var t=this.previousCommand.type;if(t!==pr.CURVE_TO&&t!==pr.SMOOTH_CURVE_TO&&t!==pr.QUAD_TO&&t!==pr.SMOOTH_QUAD_TO)return this.current;var{current:{x:e,y:n},control:{x:i,y:s}}=this,a=new _s(2*e-i,2*n-s);return a}makeAbsolute(t){if(this.command.relative){var{x:e,y:n}=this.current;t.x+=e,t.y+=n}return t}addMarker(t,e,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:t}=this,e=t.length,n=0;n<e;n++)if(!t[n]){for(var i=n+1;i<e;i++)if(t[i]){t[n]=t[i];break}}return t}}class DA extends Hi{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var t=1,e=this;e;){var n=e.getStyle("opacity",!1,!0);n.hasValue(!0)&&(t*=n.getNumber()),e=e.parent}return t}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(t.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var d=n.getColor();d!=="inherit"&&(t.fillStyle=d==="none"?"rgba(0,0,0,0)":d)}if(i.hasValue()){var f=new rn(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=f}if(s.isUrlDefinition()){var m=s.getFillStyleDefinition(this,a);m&&(t.strokeStyle=m)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var v=s.getString();v!=="inherit"&&(t.strokeStyle=v==="none"?"rgba(0,0,0,0)":v)}if(a.hasValue()){var C=new rn(this.document,"stroke",t.strokeStyle).addOpacity(a).getString();t.strokeStyle=C}var b=this.getStyle("stroke-width");if(b.hasValue()){var P=b.getPixels();t.lineWidth=P||Nd}var F=this.getStyle("stroke-linecap"),U=this.getStyle("stroke-linejoin"),k=this.getStyle("stroke-miterlimit"),z=this.getStyle("stroke-dasharray"),K=this.getStyle("stroke-dashoffset");if(F.hasValue()&&(t.lineCap=F.getString()),U.hasValue()&&(t.lineJoin=U.getString()),k.hasValue()&&(t.miterLimit=k.getNumber()),z.hasValue()&&z.getString()!=="none"){var G=rl(z.getString());typeof t.setLineDash<"u"?t.setLineDash(G):typeof t.webkitLineDash<"u"?t.webkitLineDash=G:typeof t.mozDash<"u"&&!(G.length===1&&G[0]===0)&&(t.mozDash=G);var X=K.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=X:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=X:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=X)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){var Y=this.getStyle("font"),it=this.getStyle("font-style"),nt=this.getStyle("font-variant"),wt=this.getStyle("font-weight"),Ct=this.getStyle("font-size"),st=this.getStyle("font-family"),ot=new da(it.getString(),nt.getString(),wt.getString(),Ct.hasValue()?"".concat(Ct.getPixels(!0),"px"):"",st.getString(),da.parse(Y.getString(),t.font));it.setValue(ot.fontStyle),nt.setValue(ot.fontVariant),wt.setValue(ot.fontWeight),Ct.setValue(ot.fontSize),st.setValue(ot.fontFamily),t.font=ot.toString(),Ct.isPixels()&&(this.document.emSize=Ct.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}}class gi extends DA{constructor(t,e,n){super(t,e,n),this.type="path",this.pathParser=null,this.pathParser=new En(this.getAttribute("d").getString())}path(t){var{pathParser:e}=this,n=new ic;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case En.MOVE_TO:this.pathM(t,n);break;case En.LINE_TO:this.pathL(t,n);break;case En.HORIZ_LINE_TO:this.pathH(t,n);break;case En.VERT_LINE_TO:this.pathV(t,n);break;case En.CURVE_TO:this.pathC(t,n);break;case En.SMOOTH_CURVE_TO:this.pathS(t,n);break;case En.QUAD_TO:this.pathQ(t,n);break;case En.SMOOTH_QUAD_TO:this.pathT(t,n);break;case En.ARC:this.pathA(t,n);break;case En.CLOSE_PATH:this.pathZ(t,n);break}return n}getBoundingBox(t){return this.path()}getMarkers(){var{pathParser:t}=this,e=t.getMarkerPoints(),n=t.getMarkerAngles(),i=e.map((s,a)=>[s,n[a]]);return i}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);var e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var d=s.getDefinition(),[f,m]=n[0];d.render(t,f,m)}if(a.isUrlDefinition())for(var v=a.getDefinition(),C=1;C<i;C++){var[b,P]=n[C];v.render(t,b,P)}if(o.isUrlDefinition()){var F=o.getDefinition(),[U,k]=n[i];F.render(t,U,k)}}}static pathM(t){var e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){var{pathParser:n}=this,{point:i}=gi.pathM(n),{x:s,y:a}=i;n.addMarker(i),e.addPoint(s,a),t&&t.moveTo(s,a)}static pathL(t){var{current:e}=t,n=t.getAsCurrentPoint();return{current:e,point:n}}pathL(t,e){var{pathParser:n}=this,{current:i,point:s}=gi.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathH(t){var{current:e,command:n}=t,i=new _s((n.relative?e.x:0)+n.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){var{pathParser:n}=this,{current:i,point:s}=gi.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathV(t){var{current:e,command:n}=t,i=new _s(e.x,(n.relative?e.y:0)+n.y);return t.current=i,{current:e,point:i}}pathV(t,e){var{pathParser:n}=this,{current:i,point:s}=gi.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),e.addPoint(a,o),t&&t.lineTo(a,o)}static pathC(t){var{current:e}=t,n=t.getPoint("x1","y1"),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathC(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=gi.pathC(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(t){var{current:e}=t,n=t.getReflectedControlPoint(),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:n,controlPoint:i,currentPoint:s}}pathS(t,e){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=gi.pathS(n);n.addMarker(o,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(t){var{current:e}=t,n=t.getAsControlPoint("x1","y1"),i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathQ(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=gi.pathQ(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(t){var{current:e}=t,n=t.getReflectedControlPoint();t.control=n;var i=t.getAsCurrentPoint();return{current:e,controlPoint:n,currentPoint:i}}pathT(t,e){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=gi.pathT(n);n.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(t){var{current:e,command:n}=t,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:d}=n,f=a*(Math.PI/180),m=t.getAsCurrentPoint(),v=new _s(Math.cos(f)*(e.x-m.x)/2+Math.sin(f)*(e.y-m.y)/2,-Math.sin(f)*(e.x-m.x)/2+Math.cos(f)*(e.y-m.y)/2),C=Math.pow(v.x,2)/Math.pow(i,2)+Math.pow(v.y,2)/Math.pow(s,2);C>1&&(i*=Math.sqrt(C),s*=Math.sqrt(C));var b=(o===d?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(v.y,2)-Math.pow(s,2)*Math.pow(v.x,2))/(Math.pow(i,2)*Math.pow(v.y,2)+Math.pow(s,2)*Math.pow(v.x,2)));isNaN(b)&&(b=0);var P=new _s(b*i*v.y/s,b*-s*v.x/i),F=new _s((e.x+m.x)/2+Math.cos(f)*P.x-Math.sin(f)*P.y,(e.y+m.y)/2+Math.sin(f)*P.x+Math.cos(f)*P.y),U=PE([1,0],[(v.x-P.x)/i,(v.y-P.y)/s]),k=[(v.x-P.x)/i,(v.y-P.y)/s],z=[(-v.x-P.x)/i,(-v.y-P.y)/s],K=PE(k,z);return r_(k,z)<=-1&&(K=Math.PI),r_(k,z)>=1&&(K=0),{currentPoint:m,rX:i,rY:s,sweepFlag:d,xAxisRotation:f,centp:F,a1:U,ad:K}}pathA(t,e){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:d,centp:f,a1:m,ad:v}=gi.pathA(n),C=1-o?1:-1,b=m+C*(v/2),P=new _s(f.x+s*Math.cos(b),f.y+a*Math.sin(b));if(n.addMarkerAngle(P,b-C*Math.PI/2),n.addMarkerAngle(i,b-C*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(m)&&!isNaN(v)){var F=s>a?s:a,U=s>a?1:s/a,k=s>a?a/s:1;t.translate(f.x,f.y),t.rotate(d),t.scale(U,k),t.arc(0,0,F,m,m+v,!!(1-o)),t.scale(1/U,1/k),t.rotate(-d),t.translate(-f.x,-f.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){gi.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}}class QE extends gi{constructor(t,e,n){super(t,e,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Oh extends DA{constructor(t,e,n){super(t,e,new.target===Oh?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(t.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);var e=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(s):e=s}),e}getFontSize(){var{document:t,parent:e}=this,n=da.parse(t.ctx.font).fontSize,i=e.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(t){var e=this.getFontSize();return new ic(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,n){var i=e[n],s=null;if(t.isArabic){var a=e.length,o=e[n-1],d=e[n+1],f="isolated";if((n===0||o===" ")&&n<a-1&&d!==" "&&(f="terminal"),n>0&&o!==" "&&n<a-1&&d!==" "&&(f="medial"),n>0&&o!==" "&&(n===a-1||d===" ")&&(f="initial"),typeof t.glyphs[i]<"u"){var m=t.glyphs[i];s=m instanceof QE?m:m[f]}}else s=t.glyphs[i];return s||(s=t.missingGlyph),s}getText(){return""}getTextFromNode(t){var e=t||this.node,n=Array.from(e.parentNode.childNodes),i=n.indexOf(e),s=n.length-1,a=Ud(e.textContent||"");return i===0&&(a=R6(a)),i===s&&(a=O6(a)),a}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((n,i)=>{this.renderChild(t,this,this,i)});var{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){var{document:e,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=da.parse(e.ctx.font),d=n.getStyle("font-size").getNumber(o.fontSize),f=n.getStyle("font-style").getString(o.fontStyle),m=d/a,v=s.isRTL?i.split("").reverse().join(""):i,C=rl(n.getAttribute("dx").getString()),b=v.length,P=0;P<b;P++){var F=this.getGlyph(s,v,P);t.translate(this.x,this.y),t.scale(m,-m);var U=t.lineWidth;t.lineWidth=t.lineWidth*a/d,f==="italic"&&t.transform(1,0,.4,1,0,0),F.render(t),f==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=U,t.scale(1/m,-1/m),t.translate(-this.x,-this.y),this.x+=d*(F.horizAdvX||s.horizAdvX)/a,typeof C[P]<"u"&&!isNaN(C[P])&&(this.x+=C[P])}return}var{x:k,y:z}=this;t.fillStyle&&t.fillText(i,k,z),t.strokeStyle&&t.strokeText(i,k,z)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),n=!1,i=0;e==="start"||e==="end"&&n?i=t.x-this.minX:e==="end"||e==="start"&&n?i=t.x-this.maxX:i=t.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(t){this.children.forEach((e,n)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{e.adjustChildCoordinatesRecursiveCore(t,e,s,o)}):this.adjustChildCoordinates(t,e,n,i)}adjustChildCoordinates(t,e,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;t.save(),s.setContext(t,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),d=s.getAttribute("dx"),f=s.getAttribute("dy"),m=s.getStyle("font-family").getDefinition(),v=!!m&&m.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),d.hasValue()||d.setValue(s.getInheritedAttribute("dx")),f.hasValue()||f.setValue(s.getInheritedAttribute("dy")));var C=s.measureText(t);return v&&(e.x-=C),a.hasValue()?(e.applyAnchoring(),s.x=a.getPixels("x"),d.hasValue()&&(s.x+=d.getPixels("x"))):(d.hasValue()&&(e.x+=d.getPixels("x")),s.x=e.x),e.x=s.x,v||(e.x+=C),o.hasValue()?(s.y=o.getPixels("y"),f.hasValue()&&(s.y+=f.getPixels("y"))):(f.hasValue()&&(e.y+=f.getPixels("y")),s.y=e.y),e.y=s.y,e.leafTexts.push(s),e.minX=Math.min(e.minX,s.x,s.x+C),e.maxX=Math.max(e.maxX,s.x,s.x+C),s.clearContext(t),t.restore(),s}getChildBoundingBox(t,e,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(t);return a?(s.children.forEach((o,d)=>{var f=e.getChildBoundingBox(t,e,s,d);a.addBoundingBox(f)}),a):null}renderChild(t,e,n,i){var s=n.children[i];s.render(t),s.children.forEach((a,o)=>{e.renderChild(t,e,s,o)})}measureText(t){var{measureCache:e}=this;if(~e)return e;var n=this.getText(),i=this.measureTargetText(t,n);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?e.split("").reverse().join(""):e,o=rl(n.getAttribute("dx").getString()),d=a.length,f=0,m=0;m<d;m++){var v=this.getGlyph(i,a,m);f+=(v.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[m]<"u"&&!isNaN(o[m])&&(f+=o[m])}return f}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);var{width:C}=t.measureText(e);return this.clearContext(t),t.restore(),C}getInheritedAttribute(t){for(var e=this;e instanceof Oh&&e.isFirstChild();){var n=e.parent.getAttribute(t);if(n.hasValue(!0))return n.getValue("0");e=e.parent}return null}}class bm extends Oh{constructor(t,e,n){super(t,e,new.target===bm?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class Lft extends bm{constructor(){super(...arguments),this.type="textNode"}}class hp extends DA{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(t){var e,{document:n}=this,{screen:i,window:s}=n,a=t.canvas;if(i.setDefaults(t),a.style&&typeof t.font<"u"&&s&&typeof s.getComputedStyle<"u"){t.font=s.getComputedStyle(a).getPropertyValue("font");var o=new rn(n,"fontSize",da.parse(t.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:d,height:f}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var m=this.getAttribute("refX"),v=this.getAttribute("refY"),C=this.getAttribute("viewBox"),b=C.hasValue()?rl(C.getString()):null,P=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",F=0,U=0,k=0,z=0;b&&(F=b[0],U=b[1]),this.root||(d=this.getStyle("width").getPixels("x"),f=this.getStyle("height").getPixels("y"),this.type==="marker"&&(k=F,z=U,F=0,U=0)),i.viewPort.setCurrent(d,f),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),b&&(d=b[2],f=b[3]),n.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:d,height:i.viewPort.height,desiredHeight:f,minX:F,minY:U,refX:m.getValue(),refY:v.getValue(),clip:P,clipX:k,clipY:z}),b&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(d,f))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),d=i.getNumber(0),f=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var m=this.getAttribute("preserveAspectRatio");m.hasValue()&&m.setValue(m.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),s.setValue(e),a.hasValue()||a.setValue("0 0 ".concat(d||t," ").concat(f||e)),o.hasValue()){var v=this.getStyle("width"),C=this.getStyle("height");v.hasValue()&&v.setValue("".concat(t,"px")),C.hasValue()&&C.setValue("".concat(e,"px"))}}}class zE extends gi{constructor(){super(...arguments),this.type="rect"}path(t){var e=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),d=a.getPixels("x"),f=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(f=d),o.hasValue()&&!a.hasValue()&&(d=f),d=Math.min(d,i/2),f=Math.min(f,s/2),t){var m=4*((Math.sqrt(2)-1)/3);t.beginPath(),s>0&&i>0&&(t.moveTo(e+d,n),t.lineTo(e+i-d,n),t.bezierCurveTo(e+i-d+m*d,n,e+i,n+f-m*f,e+i,n+f),t.lineTo(e+i,n+s-f),t.bezierCurveTo(e+i,n+s-f+m*f,e+i-d+m*d,n+s,e+i-d,n+s),t.lineTo(e+d,n+s),t.bezierCurveTo(e+d-m*d,n+s,e,n+s-f+m*f,e,n+s-f),t.lineTo(e,n+f),t.bezierCurveTo(e,n+f-m*f,e+d-m*d,n,e+d,n),t.closePath())}return new ic(e,n,e+i,n+s)}getMarkers(){return null}}class $6 extends gi{constructor(){super(...arguments),this.type="circle"}path(t){var e=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,n,i,0,Math.PI*2,!1),t.closePath()),new ic(e-i,n-i,e+i,n+i)}getMarkers(){return null}}class X6 extends gi{constructor(){super(...arguments),this.type="ellipse"}path(t){var e=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return t&&n>0&&i>0&&(t.beginPath(),t.moveTo(s+n,a),t.bezierCurveTo(s+n,a+e*i,s+e*n,a+i,s,a+i),t.bezierCurveTo(s-e*n,a+i,s-n,a+e*i,s-n,a),t.bezierCurveTo(s-n,a-e*i,s-e*n,a-i,s,a-i),t.bezierCurveTo(s+e*n,a-i,s+n,a-e*i,s+n,a),t.closePath()),new ic(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class Z6 extends gi{constructor(){super(...arguments),this.type="line"}getPoints(){return[new _s(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new _s(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){var[{x:e,y:n},{x:i,y:s}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,n),t.lineTo(i,s)),new ic(e,n,i,s)}getMarkers(){var[t,e]=this.getPoints(),n=t.angleTo(e);return[[t,n],[e,n]]}}class HE extends gi{constructor(t,e,n){super(t,e,n),this.type="polyline",this.points=[],this.points=_s.parsePath(this.getAttribute("points").getString())}path(t){var{points:e}=this,[{x:n,y:i}]=e,s=new ic(n,i);return t&&(t.beginPath(),t.moveTo(n,i)),e.forEach(a=>{var{x:o,y:d}=a;s.addPoint(o,d),t&&t.lineTo(o,d)}),s}getMarkers(){var{points:t}=this,e=t.length-1,n=[];return t.forEach((i,s)=>{s!==e&&n.push([i,i.angleTo(t[s+1])])}),n.length>0&&n.push([t[t.length-1],n[n.length-1][1]]),n}}class Y6 extends HE{constructor(){super(...arguments),this.type="polygon"}path(t){var e=super.path(t),[{x:n,y:i}]=this.points;return t&&(t.lineTo(n,i),t.closePath()),e}}class J6 extends Hi{constructor(){super(...arguments),this.type="pattern"}createPattern(t,e,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new hp(this.document,null);a.attributes.viewBox=new rn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new rn(this.document,"width","".concat(i,"px")),a.attributes.height=new rn(this.document,"height","".concat(s,"px")),a.attributes.transform=new rn(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),d=o.getContext("2d"),f=this.getAttribute("x"),m=this.getAttribute("y");f.hasValue()&&m.hasValue()&&d.translate(f.getPixels("x",!0),m.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var v=-1;v<=1;v++)for(var C=-1;C<=1;C++)d.save(),a.attributes.x=new rn(this.document,"x",v*o.width),a.attributes.y=new rn(this.document,"y",C*o.height),a.render(d),d.restore();var b=t.createPattern(o,"repeat");return b}}class tk extends Hi{constructor(){super(...arguments),this.type="marker"}render(t,e,n){if(e){var{x:i,y:s}=e,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,s),a==="auto"&&t.rotate(n),o==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();var d=new hp(this.document,null);d.type=this.type,d.attributes.viewBox=new rn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),d.attributes.refX=new rn(this.document,"refX",this.getAttribute("refX").getValue()),d.attributes.refY=new rn(this.document,"refY",this.getAttribute("refY").getValue()),d.attributes.width=new rn(this.document,"width",this.getAttribute("markerWidth").getValue()),d.attributes.height=new rn(this.document,"height",this.getAttribute("markerHeight").getValue()),d.attributes.overflow=new rn(this.document,"overflow",this.getAttribute("overflow").getValue()),d.attributes.fill=new rn(this.document,"fill",this.getAttribute("fill").getColor("black")),d.attributes.stroke=new rn(this.document,"stroke",this.getAttribute("stroke").getValue("none")),d.children=this.children,d.render(t),t.restore(),o==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),a==="auto"&&t.rotate(-n),t.translate(-i,-s)}}}class ek extends Hi{constructor(){super(...arguments),this.type="defs"}render(){}}class i_ extends DA{constructor(){super(...arguments),this.type="g"}getBoundingBox(t){var e=new ic;return this.children.forEach(n=>{e.addBoundingBox(n.getBoundingBox(t))}),e}}class VE extends Hi{constructor(t,e,n){super(t,e,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(t,e);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(U=>{a.addColorStop(U.offset,this.addParentOpacity(n,U.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:d,viewPort:f}=o.screen,[m]=f.viewPorts,v=new zE(o,null);v.attributes.x=new rn(o,"x",-d/3),v.attributes.y=new rn(o,"y",-d/3),v.attributes.width=new rn(o,"width",d),v.attributes.height=new rn(o,"height",d);var C=new i_(o,null);C.attributes.transform=new rn(o,"transform",this.getAttribute("gradientTransform").getValue()),C.children=[v];var b=new hp(o,null);b.attributes.x=new rn(o,"x",0),b.attributes.y=new rn(o,"y",0),b.attributes.width=new rn(o,"width",m.width),b.attributes.height=new rn(o,"height",m.height),b.children=[C];var P=o.createCanvas(m.width,m.height),F=P.getContext("2d");return F.fillStyle=a,b.render(F),F.createPattern(P,"no-repeat")}return a}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){if(t.hasValue()){var n=new rn(this.document,"color",e);return n.addOpacity(t).getColor()}return e}}class rk extends VE{constructor(t,e,n){super(t,e,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=n?e.getBoundingBox(t):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),d=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===d?null:t.createLinearGradient(s,a,o,d)}}class nk extends VE{constructor(t,e,n){super(t,e,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(t,e){var n=this.getGradientUnits()==="objectBoundingBox",i=e.getBoundingBox(t);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,d=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(d=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var f=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),m=this.getAttribute("fr").getPixels();return t.createRadialGradient(o,d,m,s,a,f)}}class ik extends Hi{constructor(t,e,n){super(t,e,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class s_ extends Hi{constructor(t,e,n){super(t,e,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new rn(t,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){var{initialUnits:t}=this,{progress:e,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*e;return t==="%"&&(s*=100),"".concat(s).concat(t)}update(t){var{parent:e}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,e.animationFrozen=!0,e.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var d=o.getString();a="".concat(d,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:t,values:e}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(e.hasValue()){var i=n.progress*(e.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new rn(t,"from",parseFloat(e.getValue()[s])),n.to=new rn(t,"to",parseFloat(e.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class sk extends s_{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=new xE(e.getColor()),s=new xE(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*t,o=i.g+(s.g-i.g)*t,d=i.b+(s.b-i.b)*t;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(d),")")}return this.getAttribute("from").getColor()}}class ok extends s_{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:t,from:e,to:n}=this.getProgress(),i=rl(e.getString()),s=rl(n.getString()),a=i.map((o,d)=>{var f=s[d];return o+(f-o)*t}).join(" ");return a}}class ak extends Hi{constructor(t,e,n){super(t,e,n),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=t,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var d=a;d.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[d.unicode]>"u"&&(this.glyphs[d.unicode]={}),this.glyphs[d.unicode][d.arabicForm]=d):this.glyphs[d.unicode]=d;break}}}render(){}}class lk extends Hi{constructor(t,e,n){super(t,e,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class ck extends gi{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class uk extends Oh{constructor(){super(...arguments),this.type="tref"}getText(){var t=this.getHrefAttribute().getDefinition();if(t){var e=t.children[0];if(e)return e.getText()}return""}}class hk extends Oh{constructor(t,e,n){super(t,e,n),this.type="a";var{childNodes:i}=e,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);var{document:e,x:n,y:i}=this,{mouse:s}=e.screen,a=new rn(e,"fontSize",da.parse(e.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new ic(n,i-a.getPixels("y"),n+this.measureText(t),i))}else if(this.children.length>0){var o=new i_(this.document,null);o.children=this.children,o.parent=this,o.render(t)}}onClick(){var{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){var t=this.document.ctx;t.canvas.style.cursor="pointer"}}function Ak(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function o_(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ak(Object(e),!0).forEach(function(n){mE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):Ak(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class dk extends Oh{constructor(t,e,n){super(t,e,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(t){var{dataArray:e}=this;t&&t.beginPath(),e.forEach(n=>{var{type:i,points:s}=n;switch(i){case En.LINE_TO:t&&t.lineTo(s[0],s[1]);break;case En.MOVE_TO:t&&t.moveTo(s[0],s[1]);break;case En.CURVE_TO:t&&t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case En.QUAD_TO:t&&t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case En.ARC:{var[a,o,d,f,m,v,C,b]=s,P=d>f?d:f,F=d>f?1:d/f,U=d>f?f/d:1;t&&(t.translate(a,o),t.rotate(C),t.scale(F,U),t.arc(0,0,P,m,m+v,!!(1-b)),t.scale(1/F,1/U),t.rotate(-C),t.translate(-a,-o));break}case En.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();var e=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=t.fillStyle;e==="underline"&&t.beginPath(),i.forEach((a,o)=>{var{p0:d,p1:f,rotation:m,text:v}=a;t.save(),t.translate(d.x,d.y),t.rotate(m),t.fillStyle&&t.fillText(v,0,0),t.strokeStyle&&t.strokeText(v,0,0),t.restore(),e==="underline"&&(o===0&&t.moveTo(d.x,d.y+n/8),t.lineTo(f.x,f.y+n/5))}),e==="underline"&&(t.lineWidth=n/20,t.strokeStyle=s,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,n,i,s,a,o,d,f){var m=a,v=this.measureText(t,d);d===" "&&e==="justify"&&n<i&&(v+=(i-n)/s),f>-1&&(m+=this.getLetterSpacingAt(f));var C=this.textHeight/20,b=this.getEquidistantPointOnPath(m,C,0),P=this.getEquidistantPointOnPath(m+v,C,0),F={p0:b,p1:P},U=b&&P?Math.atan2(P.y-b.y,P.x-b.x):0;if(o){var k=Math.cos(Math.PI/2+U)*o,z=Math.cos(-U)*o;F.p0=o_(o_({},b),{},{x:b.x+k,y:b.y+z}),F.p1=o_(o_({},P),{},{x:P.x+k,y:P.y+z})}return m+=v,{offset:m,segment:F,rotation:U}}measureText(t,e){var{measuresCache:n}=this,i=e||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(t,i);return n.set(i,s),s}setTextData(t){if(!this.glyphInfo){var e=this.getText(),n=e.split(""),i=e.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(G=>G.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),d=this.getStyle("letter-spacing"),f=this.parent.getStyle("letter-spacing"),m=0;!d.hasValue()||d.getValue()==="inherit"?m=f.getPixels():d.hasValue()&&d.getValue()!=="initial"&&d.getValue()!=="unset"&&(m=d.getPixels());var v=[],C=e.length;this.letterSpacingCache=v;for(var b=0;b<C;b++)v.push(typeof s[b]<"u"?s[b]:m);var P=v.reduce((G,X,Y)=>Y===0?0:G+X||0,0),F=this.measureText(t),U=Math.max(F+P,0);this.textWidth=F,this.textHeight=this.getFontSize(),this.glyphInfo=[];var k=this.getPathLength(),z=this.getStyle("startOffset").getNumber(0)*k,K=0;(o==="middle"||o==="center")&&(K=-U/2),(o==="end"||o==="right")&&(K=-U),K+=z,n.forEach((G,X)=>{var{offset:Y,segment:it,rotation:nt}=this.findSegmentToFitChar(t,o,U,k,i,K,a,G,X);K=Y,!(!it.p0||!it.p1)&&this.glyphInfo.push({text:n[X],p0:it.p0,p1:it.p1,rotation:nt})})}}parsePathData(t){if(this.pathLength=-1,!t)return[];var e=[],{pathParser:n}=t;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),d=o.type,f=[];switch(o.type){case En.MOVE_TO:this.pathM(n,f);break;case En.LINE_TO:d=this.pathL(n,f);break;case En.HORIZ_LINE_TO:d=this.pathH(n,f);break;case En.VERT_LINE_TO:d=this.pathV(n,f);break;case En.CURVE_TO:this.pathC(n,f);break;case En.SMOOTH_CURVE_TO:d=this.pathS(n,f);break;case En.QUAD_TO:this.pathQ(n,f);break;case En.SMOOTH_QUAD_TO:d=this.pathT(n,f);break;case En.ARC:f=this.pathA(n);break;case En.CLOSE_PATH:gi.pathZ(n);break}o.type!==En.CLOSE_PATH?e.push({type:d,points:f,start:{x:s,y:a},pathLength:this.calcLength(s,a,d,f)}):e.push({type:En.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){var{x:n,y:i}=gi.pathM(t).point;e.push(n,i)}pathL(t,e){var{x:n,y:i}=gi.pathL(t).point;return e.push(n,i),En.LINE_TO}pathH(t,e){var{x:n,y:i}=gi.pathH(t).point;return e.push(n,i),En.LINE_TO}pathV(t,e){var{x:n,y:i}=gi.pathV(t).point;return e.push(n,i),En.LINE_TO}pathC(t,e){var{point:n,controlPoint:i,currentPoint:s}=gi.pathC(t);e.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(t,e){var{point:n,controlPoint:i,currentPoint:s}=gi.pathS(t);return e.push(n.x,n.y,i.x,i.y,s.x,s.y),En.CURVE_TO}pathQ(t,e){var{controlPoint:n,currentPoint:i}=gi.pathQ(t);e.push(n.x,n.y,i.x,i.y)}pathT(t,e){var{controlPoint:n,currentPoint:i}=gi.pathT(t);return e.push(n.x,n.y,i.x,i.y),En.QUAD_TO}pathA(t){var{rX:e,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:d}=gi.pathA(t);return i===0&&d>0&&(d-=2*Math.PI),i===1&&d<0&&(d+=2*Math.PI),[a.x,a.y,e,n,o,d,s,i]}calcLength(t,e,n,i){var s=0,a=null,o=null,d=0;switch(n){case En.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case En.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),d=.01;d<=1;d+=.01)o=this.getPointOnCubicBezier(d,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case En.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),d=.01;d<=1;d+=.01)o=this.getPointOnQuadraticBezier(d,t,e,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case En.ARC:{s=0;var f=i[4],m=i[5],v=i[4]+m,C=Math.PI/180;if(Math.abs(f-v)<C&&(C=Math.abs(f-v)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),m<0)for(d=f-C;d>v;d-=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(d=f+C;d<v;d+=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],v,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(t,e,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,d=(s-n)/(i-e+Nd),f=Math.sqrt(t*t/(1+d*d));i<e&&(f*=-1);var m=d*f,v=null;if(i===e)v={x:a,y:o+m};else if((o-n)/(a-e+Nd)===d)v={x:a+f,y:o+m};else{var C=0,b=0,P=this.getLineLength(e,n,i,s);if(P<Nd)return null;var F=(a-e)*(i-e)+(o-n)*(s-n);F/=P*P,C=e+F*(i-e),b=n+F*(s-n);var U=this.getLineLength(a,o,C,b),k=Math.sqrt(t*t-U*U);f=Math.sqrt(k*k/(1+d*d)),i<e&&(f*=-1),m=d*f,v={x:C+f,y:b+m}}return v}getPointOnPath(t){var e=this.getPathLength(),n=0,i=null;if(t<-5e-5||t-5e-5>e)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<t)){n+=a.pathLength;continue}var o=t-n,d=0;switch(a.type){case En.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case En.ARC:{var f=a.points[4],m=a.points[5],v=a.points[4]+m;if(d=f+o/a.pathLength*m,m<0&&d<v||m>=0&&d>v)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],d,a.points[6]);break}case En.CURVE_TO:d=o/a.pathLength,d>1&&(d=1),i=this.getPointOnCubicBezier(d,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case En.QUAD_TO:d=o/a.pathLength,d>1&&(d=1),i=this.getPointOnQuadraticBezier(d,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,n,i,s,a,o,d,f){var m=d*ME(t)+a*FE(t)+i*LE(t)+e*RE(t),v=f*ME(t)+o*FE(t)+s*LE(t)+n*RE(t);return{x:m,y:v}}getPointOnQuadraticBezier(t,e,n,i,s,a,o){var d=a*OE(t)+i*UE(t)+e*DE(t),f=o*OE(t)+s*UE(t)+n*DE(t);return{x:d,y:f}}getPointOnEllipticalArc(t,e,n,i,s,a){var o=Math.cos(a),d=Math.sin(a),f={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:t+(f.x*o-f.y*d),y:e+(f.x*d+f.y*o)}}buildEquidistantCache(t,e){var n=this.getPathLength(),i=e||.25,s=t||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var d=this.getPointOnPath(o),f=this.getPointOnPath(o+i);!d||!f||(a+=this.getLineLength(d.x,d.y,f.x,f.y),a>=s&&(this.equidistantCache.points.push({x:d.x,y:d.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(t,e,n){if(this.buildEquidistantCache(e,n),t<0||t-this.getPathLength()>5e-5)return null;var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var Rft=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class fk extends DA{constructor(t,e,n){super(t,e,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(t){var e=this;return Lh(function*(){try{var n=yield e.document.createImage(t);e.image=n}catch(i){console.error('Error while loading image "'.concat(t,'":'),i)}e.loaded=!0})()}loadSvg(t){var e=this;return Lh(function*(){var n=Rft.exec(t);if(n){var i=n[5];n[4]==="base64"?e.image=atob(i):e.image=decodeURIComponent(i)}else try{var s=yield e.document.fetch(t),a=yield s.text();e.image=a}catch(o){console.error('Error while loading image "'.concat(t,'":'),o)}e.loaded=!0})()}renderChildren(t){var{document:e,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),d=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!d)){if(t.save(),t.translate(s,a),this.isSvg){var f=e.canvg.forkString(t,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:d});f.document.documentElement.parent=this,f.render()}else{var m=this.image;e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:m.width,height:d,desiredHeight:m.height}),this.loaded&&(typeof m.complete>"u"||m.complete)&&t.drawImage(m,0,0)}t.restore()}}getBoundingBox(){var t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new ic(t,e,t+n,e+i)}}class pk extends DA{constructor(){super(...arguments),this.type="symbol"}render(t){}}class gk{constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}load(t,e){var n=this;return Lh(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(e),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var d=i.createElement(o);i.definitions[t]=d})}catch(o){console.error('Error while loading font "'.concat(e,'":'),o)}n.loaded=!0})()}}class GE extends Hi{constructor(t,e,n){super(t,e,n),this.type="style";var i=Ud(Array.from(e.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var d=o.split("{"),f=d[0].split(","),m=d[1].split(";");f.forEach(v=>{var C=v.trim();if(C){var b=t.styles[C]||{};if(m.forEach(U=>{var k=U.indexOf(":"),z=U.substr(0,k).trim(),K=U.substr(k+1,U.length-k).trim();z&&K&&(b[z]=new rn(t,z,K))}),t.styles[C]=b,t.stylesSpecificity[C]=N6(C),C==="@font-face"){var P=b["font-family"].getString().replace(/"|'/g,""),F=b.src.getString().split(",");F.forEach(U=>{if(U.indexOf('format("svg")')>0){var k=SE(U);k&&new gk(t).load(P,k)}})}}})}})}}GE.parseExternalUrl=SE;class mk extends DA{constructor(){super(...arguments),this.type="use"}setContext(t){super.setContext(t);var e=this.getAttribute("x"),n=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),n.hasValue()&&t.translate(0,n.getPixels("y"))}path(t){var{element:e}=this;e&&e.path(t)}renderChildren(t){var{document:e,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new hp(e,null),i.attributes.viewBox=new rn(e,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new rn(e,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new rn(e,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new rn(e,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new rn(e,"width",s.getString())),a.hasValue()&&(i.attributes.height=new rn(e,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(t),i.parent=o}}getBoundingBox(t){var{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){var{document:t,element:e}=this;return UA.fromElement(t,e)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function a_(r,t,e,n,i,s){return r[e*n*4+t*4+s]}function l_(r,t,e,n,i,s,a){r[e*n*4+t*4+s]=a}function to(r,t,e){var n=r[t];return n*e}function Uh(r,t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n}class jE extends Hi{constructor(t,e,n){super(t,e,n),this.type="feColorMatrix";var i=rl(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[Uh(a,.213,.787,-.213),Uh(a,.715,-.715,-.715),Uh(a,.072,-.072,.928),0,0,Uh(a,.213,-.213,.143),Uh(a,.715,.285,.14),Uh(a,.072,-.072,-.283),0,0,Uh(a,.213,-.213,-.787),Uh(a,.715,-.715,.715),Uh(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(t,e,n,i,s){for(var{includeOpacity:a,matrix:o}=this,d=t.getImageData(0,0,i,s),f=0;f<s;f++)for(var m=0;m<i;m++){var v=a_(d.data,m,f,i,s,0),C=a_(d.data,m,f,i,s,1),b=a_(d.data,m,f,i,s,2),P=a_(d.data,m,f,i,s,3),F=to(o,0,v)+to(o,1,C)+to(o,2,b)+to(o,3,P)+to(o,4,1),U=to(o,5,v)+to(o,6,C)+to(o,7,b)+to(o,8,P)+to(o,9,1),k=to(o,10,v)+to(o,11,C)+to(o,12,b)+to(o,13,P)+to(o,14,1),z=to(o,15,v)+to(o,16,C)+to(o,17,b)+to(o,18,P)+to(o,19,1);a&&(F=0,U=0,k=0,z*=P/255),l_(d.data,m,f,i,s,0,F),l_(d.data,m,f,i,s,1,U),l_(d.data,m,f,i,s,2,k),l_(d.data,m,f,i,s,3,z)}t.clearRect(0,0,i,s),t.putImageData(d,0,0)}}class wm extends Hi{constructor(){super(...arguments),this.type="mask"}apply(t,e){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var d=new ic;this.children.forEach(P=>{d.addBoundingBox(P.getBoundingBox(t))}),i=Math.floor(d.x1),s=Math.floor(d.y1),a=Math.floor(d.width),o=Math.floor(d.height)}var f=this.removeStyles(e,wm.ignoreStyles),m=n.createCanvas(i+a,s+o),v=m.getContext("2d");n.screen.setDefaults(v),this.renderChildren(v),new jE(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(v,0,0,i+a,s+o);var C=n.createCanvas(i+a,s+o),b=C.getContext("2d");n.screen.setDefaults(b),e.render(b),b.globalCompositeOperation="destination-in",b.fillStyle=v.createPattern(m,"no-repeat"),b.fillRect(0,0,i+a,s+o),t.fillStyle=b.createPattern(C,"no-repeat"),t.fillRect(0,0,i+a,s+o),this.restoreStyles(e,f)}render(t){}}wm.ignoreStyles=["mask","transform","clip-path"];var yk=()=>{};class _k extends Hi{constructor(){super(...arguments),this.type="clipPath"}apply(t){var{document:e}=this,n=Reflect.getPrototypeOf(t),{beginPath:i,closePath:s}=t;n&&(n.beginPath=yk,n.closePath=yk),Reflect.apply(i,t,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=UA.fromElement(e,a)),o&&o.apply(t),a.path(t),n&&(n.closePath=s),o&&o.unapply(t)}}),Reflect.apply(s,t,[]),t.clip(),n&&(n.beginPath=i,n.closePath=s)}render(t){}}class xm extends Hi{constructor(){super(...arguments),this.type="filter"}apply(t,e){var{document:n,children:i}=this,s=e.getBoundingBox(t);if(s){var a=0,o=0;i.forEach(k=>{var z=k.extraFilterDistance||0;a=Math.max(a,z),o=Math.max(o,z)});var d=Math.floor(s.width),f=Math.floor(s.height),m=d+2*a,v=f+2*o;if(!(m<1||v<1)){var C=Math.floor(s.x),b=Math.floor(s.y),P=this.removeStyles(e,xm.ignoreStyles),F=n.createCanvas(m,v),U=F.getContext("2d");n.screen.setDefaults(U),U.translate(-C+a,-b+o),e.render(U),i.forEach(k=>{typeof k.apply=="function"&&k.apply(U,0,0,m,v)}),t.drawImage(F,0,0,m,v,C-a,b-o,m,v),this.restoreStyles(e,P)}}}render(t){}}xm.ignoreStyles=["filter","transform","clip-path"];class vk extends Hi{constructor(t,e,n){super(t,e,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(t,e,n,i,s){}}class bk extends Hi{constructor(){super(...arguments),this.type="feMorphology"}apply(t,e,n,i,s){}}class wk extends Hi{constructor(){super(...arguments),this.type="feComposite"}apply(t,e,n,i,s){}}class xk extends Hi{constructor(t,e,n){super(t,e,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(t,e,n,i,s){var{document:a,blurRadius:o}=this,d=a.window?a.window.document.body:null,f=t.canvas;f.id=a.getUniqueId(),d&&(f.style.display="none",d.appendChild(f)),Aft(f,e,n,i,s,o),d&&d.removeChild(f)}}class Bk extends Hi{constructor(){super(...arguments),this.type="title"}}class Ck extends Hi{constructor(){super(...arguments),this.type="desc"}}var Oft={svg:hp,rect:zE,circle:$6,ellipse:X6,line:Z6,polyline:HE,polygon:Y6,path:gi,pattern:J6,marker:tk,defs:ek,linearGradient:rk,radialGradient:nk,stop:ik,animate:s_,animateColor:sk,animateTransform:ok,font:ak,"font-face":lk,"missing-glyph":ck,glyph:QE,text:Oh,tspan:bm,tref:uk,a:hk,textPath:dk,image:fk,g:i_,symbol:pk,style:GE,use:mk,mask:wm,clipPath:_k,filter:xm,feDropShadow:vk,feMorphology:bk,feComposite:wk,feColorMatrix:jE,feGaussianBlur:xk,title:Bk,desc:Ck};function Ek(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function Uft(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ek(Object(e),!0).forEach(function(n){mE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):Ek(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function Dft(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e}function Nft(r){return qE.apply(this,arguments)}function qE(){return qE=Lh(function*(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((n,i)=>{e.onload=()=>{n(e)},e.onerror=(s,a,o,d,f)=>{i(f)},e.src=r})}),qE.apply(this,arguments)}class Dh{constructor(t){var{rootEmSize:e=12,emSize:n=12,createCanvas:i=Dh.createCanvas,createImage:s=Dh.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(t,e){return typeof e=="boolean"?(n,i)=>t(n,typeof i=="boolean"?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:t}=this;return t[t.length-1]}set emSize(t){var{emSizeStack:e}=this;e.push(t)}popEmSize(){var{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){var e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){var e=t.nodeName.replace(/^[^:]+:/,""),n=Dh.elementTypes[e];return typeof n<"u"?new n(this,t):new W6(this,t)}createTextNode(t){return new Lft(this,t)}setViewBox(t){this.screen.setViewBox(Uft({document:this},t))}}Dh.createCanvas=Dft,Dh.createImage=Nft,Dh.elementTypes=Oft;function Tk(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function kd(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Tk(Object(e),!0).forEach(function(n){mE(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):Tk(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}class Qd{constructor(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new n_(n),this.screen=new vm(t,n),this.options=n;var i=new Dh(this,n),s=i.createDocumentElement(e);this.document=i,this.documentElement=s}static from(t,e){var n=arguments;return Lh(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new n_(i),a=yield s.parse(e);return new Qd(t,a,i)})()}static fromString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new n_(n),s=i.parseFromString(e);return new Qd(t,s,n)}fork(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Qd.from(t,e,kd(kd({},this.options),n))}forkString(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Qd.fromString(t,e,kd(kd({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var t=arguments,e=this;return Lh(function*(){var n=t.length>0&&t[0]!==void 0?t[0]:{};e.start(kd({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield e.ready(),e.stop()})()}start(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:e,screen:n,options:i}=this;n.start(e,kd(kd({enableRedraw:!0},i),t))}stop(){this.screen.stop()}resize(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,n)}}const kft=Object.freeze(Object.defineProperty({__proto__:null,AElement:hk,AnimateColorElement:sk,AnimateElement:s_,AnimateTransformElement:ok,BoundingBox:ic,CB1:ME,CB2:FE,CB3:LE,CB4:RE,Canvg:Qd,CircleElement:$6,ClipPathElement:_k,DefsElement:ek,DescElement:Ck,Document:Dh,Element:Hi,EllipseElement:X6,FeColorMatrixElement:jE,FeCompositeElement:wk,FeDropShadowElement:vk,FeGaussianBlurElement:xk,FeMorphologyElement:bk,FilterElement:xm,Font:da,FontElement:ak,FontFaceElement:lk,GElement:i_,GlyphElement:QE,GradientElement:VE,ImageElement:fk,LineElement:Z6,LinearGradientElement:rk,MarkerElement:tk,MaskElement:wm,Matrix:NE,MissingGlyphElement:ck,Mouse:Q6,PSEUDO_ZERO:Nd,Parser:n_,PathElement:gi,PathParser:En,PatternElement:J6,Point:_s,PolygonElement:Y6,PolylineElement:HE,Property:rn,QB1:OE,QB2:UE,QB3:DE,RadialGradientElement:nk,RectElement:zE,RenderedElement:DA,Rotate:G6,SVGElement:hp,SVGFontLoader:gk,Scale:j6,Screen:vm,Skew:kE,SkewX:q6,SkewY:K6,StopElement:ik,StyleElement:GE,SymbolElement:pk,TRefElement:uk,TSpanElement:bm,TextElement:Oh,TextPathElement:dk,TitleElement:Bk,Transform:UA,Translate:V6,UnknownElement:W6,UseElement:mk,ViewPort:k6,compressSpaces:Ud,default:Qd,getSelectorSpecificity:N6,normalizeAttributeName:U6,normalizeColor:D6,parseExternalUrl:SE,presets:gft,toNumbers:rl,trimLeft:R6,trimRight:O6,vectorMagnitude:IE,vectorsAngle:PE,vectorsRatio:r_},Symbol.toStringTag,{value:"Module"}));rA.CompareMaps=Pot,rA.Config=QL,rA.Map=mot,Object.defineProperty(rA,Symbol.toStringTag,{value:"Module"})});
